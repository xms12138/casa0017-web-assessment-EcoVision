import{g as He,_ as Ct,m as ne,r as De,o as St,a as Tt,b as _t,c as It,d as Mt,e as O,f as Ot,w as vt,t as bt,h as he}from"./index-29052b09.js";const P={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},R={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},_={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},w={POLYGON:"polygon",LINE:"line_string",POINT:"point"},p={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},m={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},L={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},z={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},v={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},I={ACTIVE:"true",INACTIVE:"false"},We=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Lt=-90,me=-85,Nt=90,Ee=85,At=-270,Pt=270,Ze=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:Nt,LAT_MIN:Lt,LAT_RENDERED_MAX:Ee,LAT_RENDERED_MIN:me,LNG_MAX:Pt,LNG_MIN:At,activeStates:I,classes:P,cursors:_,events:L,geojsonTypes:p,interactions:We,meta:v,modes:m,sources:R,types:w,updateActions:z},Symbol.toStringTag,{value:"Module"}));function se(e){return function(t){const n=t.featureTarget;return!n||!n.properties?!1:n.properties.meta===e}}function ze(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function q(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===I.ACTIVE&&e.featureTarget.properties.meta===v.FEATURE}function Oe(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===I.INACTIVE&&e.featureTarget.properties.meta===v.FEATURE}function ae(e){return e.featureTarget===void 0}function ve(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===v.FEATURE}function Q(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===v.VERTEX}function re(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function ue(e){return e.key==="Escape"||e.keyCode===27}function ce(e){return e.key==="Enter"||e.keyCode===13}function Ce(e){return e.key==="Backspace"||e.keyCode===8}function Se(e){return e.key==="Delete"||e.keyCode===46}function Qe(e){return e.key==="1"||e.keyCode===49}function je(e){return e.key==="2"||e.keyCode===50}function et(e){return e.key==="3"||e.keyCode===51}function tt(e){const t=e.key||String.fromCharCode(e.keyCode);return t>="0"&&t<="9"}function wt(){return!0}const Ft=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:q,isBackspaceKey:Ce,isDeleteKey:Se,isDigit1Key:Qe,isDigit2Key:je,isDigit3Key:et,isDigitKey:tt,isEnterKey:ce,isEscapeKey:ue,isFeature:ve,isInactiveFeature:Oe,isOfMetaType:se,isShiftDown:re,isShiftMousedown:ze,isTrue:wt,isVertex:Q,noTarget:ae},Symbol.toStringTag,{value:"Module"}));var be={},le={};le.RADIUS=6378137;le.FLATTENING=1/298.257223563;le.POLAR_RADIUS=63567523142e-4;var Re=le;be.geometry=nt;be.ring=Te;function nt(e){var t=0,n;switch(e.type){case"Polygon":return Ue(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)t+=Ue(e.coordinates[n]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)t+=nt(e.geometries[n]);return t}}function Ue(e){var t=0;if(e&&e.length>0){t+=Math.abs(Te(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(Te(e[n]))}return t}function Te(e){var t,n,o,r,i,s,c,u=0,l=e.length;if(l>2){for(c=0;c<l;c++)c===l-2?(r=l-2,i=l-1,s=0):c===l-1?(r=l-1,i=0,s=1):(r=c,i=c+1,s=c+2),t=e[r],n=e[i],o=e[s],u+=(ge(o[0])-ge(t[0]))*Math.sin(ge(n[1]));u=u*Re.RADIUS*Re.RADIUS/2}return u}function ge(e){return e*Math.PI/180}const ke={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Dt(e,t){const n=ke[e.geometry.type]-ke[t.geometry.type];return n===0&&e.geometry.type===p.POLYGON?e.area-t.area:n}function ot(e){return e.map(t=>(t.geometry.type===p.POLYGON&&(t.area=be.geometry({type:p.FEATURE,property:{},geometry:t.geometry})),t)).sort(Dt).map(t=>(delete t.area,t))}function rt(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function U(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}U.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};U.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};U.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};U.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,n)=>t.v-n.v).map(t=>t.k)};U.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Rt=[v.FEATURE,v.MIDPOINT,v.VERTEX],H={click:Ut,touch:kt};function Ut(e,t,n){return it(e,t,n,n.options.clickBuffer)}function kt(e,t,n){return it(e,t,n,n.options.touchBuffer)}function it(e,t,n,o){if(n.map===null)return[];const r=e?rt(e,o):t,i={};n.options.styles&&(i.layers=n.options.styles.map(l=>l.id).filter(l=>n.map.getLayer(l)!=null));const s=n.map.queryRenderedFeatures(r,i).filter(l=>Rt.indexOf(l.properties.meta)!==-1),c=new U,u=[];return s.forEach(l=>{const h=l.properties.id;c.has(h)||(c.add(h),u.push(l))}),ot(u)}function oe(e,t){const n=H.click(e,null,t),o={mouse:_.NONE};return n[0]&&(o.mouse=n[0].properties.active===I.ACTIVE?_.MOVE:_.POINTER,o.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=_.ADD),t.ui.queueMapClasses(o),t.ui.updateMapClasses(),n[0]}function Le(e,t){const n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}const xt=4,Vt=12,Gt=500;function _e(e,t,n={}){const o=n.fineTolerance!=null?n.fineTolerance:xt,r=n.grossTolerance!=null?n.grossTolerance:Vt,i=n.interval!=null?n.interval:Gt;e.point=e.point||t.point,e.time=e.time||t.time;const s=Le(e.point,t.point);return s<o||s<r&&t.time-e.time<i}const Bt=25,$t=250;function Ie(e,t,n={}){const o=n.tolerance!=null?n.tolerance:Bt,r=n.interval!=null?n.interval:$t;return e.point=e.point||t.point,e.time=e.time||t.time,Le(e.point,t.point)<o&&t.time-e.time<r}const Me=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on(i,s,c){if(n[i]===void 0)throw new Error(`Invalid event type: ${i}`);n[i].push({selector:s,fn:c})},render(i){t.store.featureChanged(i)}},r=function(i,s){const c=n[i];let u=c.length;for(;u--;){const l=c[u];if(l.selector(s)){l.fn.call(o,s)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(o),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(i){r("drag",i)},click(i){r("click",i)},mousemove(i){r("mousemove",i)},mousedown(i){r("mousedown",i)},mouseup(i){r("mouseup",i)},mouseout(i){r("mouseout",i)},keydown(i){r("keydown",i)},keyup(i){r("keyup",i)},touchstart(i){r("touchstart",i)},touchmove(i){r("touchmove",i)},touchend(i){r("touchend",i)},tap(i){r("tap",i)}}};let Jt=(e,t=21)=>(n=t)=>{let o="",r=n|0;for(;r--;)o+=e[Math.random()*e.length|0];return o};const Yt=Jt("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Ne(){return Yt()}const N=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Ne(),this.type=t.geometry.type};N.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};N.prototype.incomingCoords=function(e){this.setCoordinates(e)};N.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};N.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};N.prototype.setProperty=function(e,t){this.properties[e]=t};N.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:p.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};N.prototype.internal=function(e){const t={id:this.id,meta:v.FEATURE,"meta:type":this.type,active:I.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const n in this.properties)t[`user_${n}`]=this.properties[n];return{type:p.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const K=function(e,t){N.call(this,e,t)};K.prototype=Object.create(N.prototype);K.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};K.prototype.updateCoordinate=function(e,t,n){arguments.length===3?this.coordinates=[t,n]:this.coordinates=[e,t],this.changed()};K.prototype.getCoordinate=function(){return this.getCoordinates()};const $=function(e,t){N.call(this,e,t)};$.prototype=Object.create(N.prototype);$.prototype.isValid=function(){return this.coordinates.length>1};$.prototype.addCoordinate=function(e,t,n){this.changed();const o=parseInt(e,10);this.coordinates.splice(o,0,[t,n])};$.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};$.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};$.prototype.updateCoordinate=function(e,t,n){const o=parseInt(e,10);this.coordinates[o]=[t,n],this.changed()};const D=function(e,t){N.call(this,e,t),this.coordinates=this.coordinates.map(n=>n.slice(0,-1))};D.prototype=Object.create(N.prototype);D.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};D.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};D.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};D.prototype.addCoordinate=function(e,t,n){this.changed();const o=e.split(".").map(i=>parseInt(i,10));this.coordinates[o[0]].splice(o[1],0,[t,n])};D.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(o=>parseInt(o,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))};D.prototype.getCoordinate=function(e){const t=e.split(".").map(o=>parseInt(o,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))};D.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};D.prototype.updateCoordinate=function(e,t,n){this.changed();const o=e.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);this.coordinates[r]===void 0&&(this.coordinates[r]=[]),this.coordinates[r][i]=[t,n]};const Kt={MultiPoint:K,MultiLineString:$,MultiPolygon:D},de=(e,t,n,o,r)=>{const i=n.split("."),s=parseInt(i[0],10),c=i[1]?i.slice(1).join("."):null;return e[s][t](c,o,r)},b=function(e,t){if(N.call(this,e,t),delete this.coordinates,this.model=Kt[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};b.prototype=Object.create(N.prototype);b.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(n=>new t(this.ctx,{id:Ne(),type:p.FEATURE,properties:{},geometry:{coordinates:n,type:this.type.replace("Multi","")}}))};b.prototype.isValid=function(){return this.features.every(e=>e.isValid())};b.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};b.prototype.getCoordinate=function(e){return de(this.features,"getCoordinate",e)};b.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===p.POLYGON?e.getCoordinates():e.coordinates)))};b.prototype.updateCoordinate=function(e,t,n){de(this.features,"updateCoordinate",e,t,n),this.changed()};b.prototype.addCoordinate=function(e,t,n){de(this.features,"addCoordinate",e,t,n),this.changed()};b.prototype.removeCoordinate=function(e){de(this.features,"removeCoordinate",e),this.changed()};b.prototype.getFeatures=function(){return this.features};function y(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}y.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};y.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,n)=>(t[n.feature_id]===void 0&&(t[n.feature_id]=!0,this._ctx.store.get(n.feature_id).changed()),t),{})};y.prototype.getSelected=function(){return this._ctx.store.getSelected()};y.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};y.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};y.prototype.getFeature=function(e){return this._ctx.store.get(e)};y.prototype.select=function(e){return this._ctx.store.select(e)};y.prototype.deselect=function(e){return this._ctx.store.deselect(e)};y.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};y.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};y.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};y.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};y.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};y.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)};y.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};y.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};y.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};y.prototype.featuresAt=function(e,t,n="click"){if(n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return H[n](e,t,this._ctx)};y.prototype.newFeature=function(e){const t=e.geometry.type;return t===p.POINT?new K(this._ctx,e):t===p.LINE_STRING?new $(this._ctx,e):t===p.POLYGON?new D(this._ctx,e):new b(this._ctx,e)};y.prototype.isInstanceOf=function(e,t){if(e===p.POINT)return t instanceof K;if(e===p.LINE_STRING)return t instanceof $;if(e===p.POLYGON)return t instanceof D;if(e==="MultiFeature")return t instanceof b;throw new Error(`Unknown feature class: ${e}`)};y.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};y.prototype.onSetup=function(){};y.prototype.onDrag=function(){};y.prototype.onClick=function(){};y.prototype.onMouseMove=function(){};y.prototype.onMouseDown=function(){};y.prototype.onMouseUp=function(){};y.prototype.onMouseOut=function(){};y.prototype.onKeyUp=function(){};y.prototype.onKeyDown=function(){};y.prototype.onTouchStart=function(){};y.prototype.onTouchMove=function(){};y.prototype.onTouchEnd=function(){};y.prototype.onTap=function(){};y.prototype.onStop=function(){};y.prototype.onTrash=function(){};y.prototype.onCombineFeature=function(){};y.prototype.onUncombineFeature=function(){};y.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const st={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Xt=Object.keys(st);function qt(e){const t=Object.keys(e);return function(n,o={}){let r={};const i=t.reduce((c,u)=>(c[u]=e[u],c),new y(n));function s(c){return u=>i[c](r,u)}return{start(){r=i.onSetup(o),Xt.forEach(c=>{const u=st[c];let l=()=>!1;e[u]&&(l=()=>!0),this.on(c,l,s(u))})},stop(){i.onStop(r)},trash(){i.onTrash(r)},combineFeatures(){i.onCombineFeatures(r)},uncombineFeatures(){i.onUncombineFeatures(r)},render(c,u){i.toDisplayFeatures(r,c,u)}}}}function Ht(e){const t=Object.keys(e.options.modes).reduce((a,d)=>(a[d]=qt(e.options.modes[d]),a),{});let n={},o={};const r={};let i=null,s=null;r.drag=function(a,d){d({point:a.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:_.DRAG}),s.drag(a)):a.originalEvent.stopPropagation()},r.mousedrag=function(a){r.drag(a,d=>!_e(n,d))},r.touchdrag=function(a){r.drag(a,d=>!Ie(o,d))},r.mousemove=function(a){if((a.originalEvent.buttons!==void 0?a.originalEvent.buttons:a.originalEvent.which)===1)return r.mousedrag(a);const f=oe(a,e);a.featureTarget=f,s.mousemove(a)},r.mousedown=function(a){n={time:new Date().getTime(),point:a.point};const d=oe(a,e);a.featureTarget=d,s.mousedown(a)},r.mouseup=function(a){const d=oe(a,e);a.featureTarget=d,_e(n,{point:a.point,time:new Date().getTime()})?s.click(a):s.mouseup(a)},r.mouseout=function(a){s.mouseout(a)},r.touchstart=function(a){if(!e.options.touchEnabled)return;o={time:new Date().getTime(),point:a.point};const d=H.touch(a,null,e)[0];a.featureTarget=d,s.touchstart(a)},r.touchmove=function(a){if(e.options.touchEnabled)return s.touchmove(a),r.touchdrag(a)},r.touchend=function(a){if(a.originalEvent.preventDefault(),!e.options.touchEnabled)return;const d=H.touch(a,null,e)[0];a.featureTarget=d,Ie(o,{time:new Date().getTime(),point:a.point})?s.tap(a):s.touchend(a)};const c=a=>{const d=Ce(a),f=Se(a),E=tt(a);return!(d||f||E)};r.keydown=function(a){(a.srcElement||a.target).classList.contains(P.CANVAS)&&((Ce(a)||Se(a))&&e.options.controls.trash?(a.preventDefault(),s.trash()):c(a)?s.keydown(a):Qe(a)&&e.options.controls.point?u(m.DRAW_POINT):je(a)&&e.options.controls.line_string?u(m.DRAW_LINE_STRING):et(a)&&e.options.controls.polygon&&u(m.DRAW_POLYGON))},r.keyup=function(a){c(a)&&s.keyup(a)},r.zoomend=function(){e.store.changeZoom()},r.data=function(a){if(a.dataType==="style"){const{setup:d,map:f,options:E,store:M}=e;E.styles.some(G=>f.getLayer(G.id))||(d.addLayers(),M.setDirty(),M.render())}};function u(a,d,f={}){s.stop();const E=t[a];if(E===void 0)throw new Error(`${a} is not valid`);i=a;const M=E(e,d);s=Me(M,e),f.silent||e.map.fire(L.MODE_CHANGE,{mode:a}),e.store.setDirty(),e.store.render()}const l={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function h(a){let d=!1;Object.keys(a).forEach(f=>{if(l[f]===void 0)throw new Error("Invalid action type");l[f]!==a[f]&&(d=!0),l[f]=a[f]}),d&&e.map.fire(L.ACTIONABLE,{actions:l})}return{start(){i=e.options.defaultMode,s=Me(t[i](e),e)},changeMode:u,actionable:h,currentModeName(){return i},currentModeRender(a,d){return s.render(a,d)},fire(a,d){e.map&&e.map.fire(a,d)},addEventListeners(){e.map.on("mousemove",r.mousemove),e.map.on("mousedown",r.mousedown),e.map.on("mouseup",r.mouseup),e.map.on("data",r.data),e.map.on("touchmove",r.touchmove),e.map.on("touchstart",r.touchstart),e.map.on("touchend",r.touchend),e.container.addEventListener("mouseout",r.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",r.keydown),e.container.addEventListener("keyup",r.keyup))},removeEventListeners(){e.map.off("mousemove",r.mousemove),e.map.off("mousedown",r.mousedown),e.map.off("mouseup",r.mouseup),e.map.off("data",r.data),e.map.off("touchmove",r.touchmove),e.map.off("touchstart",r.touchstart),e.map.off("touchend",r.touchend),e.container.removeEventListener("mouseout",r.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",r.keydown),e.container.removeEventListener("keyup",r.keyup))},trash(a){s.trash(a)},combineFeatures(){s.combineFeatures()},uncombineFeatures(){s.uncombineFeatures()},getMode(){return i}}}function j(e){return[].concat(e).filter(t=>t!==void 0)}function Wt(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(R.HOT)!==void 0))return u();const n=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:n});let o=[],r=[];e.isDirty?r=e.getAllIds():(o=e.getChangedIds().filter(l=>e.get(l)!==void 0),r=e.sources.hot.filter(l=>l.properties.id&&o.indexOf(l.properties.id)===-1&&e.get(l.properties.id)!==void 0).map(l=>l.properties.id)),e.sources.hot=[];const i=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(l=>{const h=l.properties.id||l.properties.parent;return o.indexOf(h)===-1});const s=i!==e.sources.cold.length||r.length>0;o.forEach(l=>c(l,"hot")),r.forEach(l=>c(l,"cold"));function c(l,h){const a=e.get(l).internal(n);e.ctx.events.currentModeRender(a,d=>{d.properties.mode=n,e.sources[h].push(d)})}s&&e.ctx.map.getSource(R.COLD).setData({type:p.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(R.HOT).setData({type:p.FEATURE_COLLECTION,features:e.sources.hot}),u();function u(){e.isDirty=!1,e.clearChangedIds()}}function T(e){this._features={},this._featureIds=new U,this._selectedFeatureIds=new U,this._selectedCoordinates=[],this._changedFeatureIds=new U,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,Wt.call(this),this._emitSelectionChange&&(this.ctx.events.fire(L.SELECTION_CHANGE,{features:this.getSelected().map(n=>n.toGeoJSON()),points:this.getSelectedCoordinates().map(n=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:n.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(L.RENDER,{})}))},this.isDirty=!1}T.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};T.prototype.setDirty=function(){return this.isDirty=!0,this};T.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const o=this.get(e);this.ctx.events.fire(L.CREATE,{features:[o.toGeoJSON()]})}return this};T.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(L.UPDATE,{action:t.action?t.action:z.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};T.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};T.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};T.prototype.getAllIds=function(){return this._featureIds.values()};T.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};T.prototype.delete=function(e,t={}){const n=[];return j(e).forEach(o=>{this._featureIds.has(o)&&(this._featureIds.delete(o),this._selectedFeatureIds.delete(o),t.silent||n.indexOf(this._features[o])===-1&&n.push(this._features[o].toGeoJSON()),delete this._features[o],this.isDirty=!0)}),n.length&&this.ctx.events.fire(L.DELETE,{features:n}),at(this,t),this};T.prototype.get=function(e){return this._features[e]};T.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};T.prototype.select=function(e,t={}){return j(e).forEach(n=>{this._selectedFeatureIds.has(n)||(this._selectedFeatureIds.add(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),this};T.prototype.deselect=function(e,t={}){return j(e).forEach(n=>{this._selectedFeatureIds.has(n)&&(this._selectedFeatureIds.delete(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),at(this,t),this};T.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};T.prototype.setSelected=function(e,t={}){return e=j(e),this.deselect(this._selectedFeatureIds.values().filter(n=>e.indexOf(n)===-1),{silent:t.silent}),this.select(e.filter(n=>!this._selectedFeatureIds.has(n)),{silent:t.silent}),this};T.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};T.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};T.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};T.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};T.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};T.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};T.prototype.setFeatureProperty=function(e,t,n,o={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:o.silent,action:z.CHANGE_PROPERTIES})};function at(e,t={}){const n=e._selectedCoordinates.filter(o=>e._selectedFeatureIds.has(o.feature_id));e._selectedCoordinates.length!==n.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=n}T.prototype.storeMapConfig=function(){We.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};T.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};T.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const Zt=["mode","feature","mouse"];function zt(e){const t={};let n=null,o={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};function i(){s({mode:null,feature:null,mouse:null}),c()}function s(d){r=Object.assign(r,d)}function c(){if(!e.container)return;const d=[],f=[];Zt.forEach(E=>{r[E]!==o[E]&&(d.push(`${E}-${o[E]}`),r[E]!==null&&f.push(`${E}-${r[E]}`))}),d.length>0&&e.container.classList.remove(...d),f.length>0&&e.container.classList.add(...f),o=Object.assign(o,r)}function u(d,f={}){const E=document.createElement("button");return E.className=`${P.CONTROL_BUTTON} ${f.className}`,E.setAttribute("title",f.title),f.container.appendChild(E),E.addEventListener("click",M=>{if(M.preventDefault(),M.stopPropagation(),M.target===n){l(),f.onDeactivate();return}h(d),f.onActivate()},!0),E}function l(){n&&(n.classList.remove(P.ACTIVE_BUTTON),n=null)}function h(d){l();const f=t[d];f&&f&&d!=="trash"&&(f.classList.add(P.ACTIVE_BUTTON),n=f)}function g(){const d=e.options.controls,f=document.createElement("div");return f.className=`${P.CONTROL_GROUP} ${P.CONTROL_BASE}`,d&&(d[w.POINT]&&(t[w.POINT]=u(w.POINT,{container:f,className:P.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(m.DRAW_POINT),onDeactivate:()=>e.events.trash()})),d[w.LINE]&&(t[w.LINE]=u(w.LINE,{container:f,className:P.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(m.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),d[w.POLYGON]&&(t[w.POLYGON]=u(w.POLYGON,{container:f,className:P.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(m.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),d.trash&&(t.trash=u("trash",{container:f,className:P.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),d.combine_features&&(t.combine_features=u("combineFeatures",{container:f,className:P.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),d.uncombine_features&&(t.uncombine_features=u("uncombineFeatures",{container:f,className:P.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),f}function a(){Object.keys(t).forEach(d=>{const f=t[d];f.parentNode&&f.parentNode.removeChild(f),delete t[d]})}return{setActiveButton:h,queueMapClasses:s,updateMapClasses:c,clearMapClasses:i,addButtons:g,removeButtons:a}}function Qt(e){let t=null,n=null;const o={onRemove(){return e.map.off("load",o.connect),clearInterval(n),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",o.connect),clearInterval(n),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(r){if(e.map=r,e.events=Ht(e),e.ui=zt(e),e.container=r.getContainer(),e.store=new T(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=r.boxZoom.isEnabled(),r.boxZoom.disable();const i=r.dragPan.isEnabled();r.dragPan.disable(),r.dragPan.enable(),i||r.dragPan.disable()}return r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval(()=>{r.loaded()&&o.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(R.COLD,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(R.HOT,{data:{type:p.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(r=>{e.map.addLayer(r)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(r=>{e.map.getLayer(r.id)&&e.map.removeLayer(r.id)}),e.map.getSource(R.COLD)&&e.map.removeSource(R.COLD),e.map.getSource(R.HOT)&&e.map.removeSource(R.HOT)}};return e.setup=o,o}const ye="#3bb2d0",Z="#fbb03b",xe="#fff",ut=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Z,ye],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Z,ye],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":xe}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Z,ye]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":xe}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Z}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Z}}];function Y(e,t){this.x=e,this.y=t}Y.prototype={clone(){return new Y(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=o,this.y=r,this},_rotateAround(e,t){const n=Math.cos(e),o=Math.sin(e),r=t.x+n*(this.x-t.x)-o*(this.y-t.y),i=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=r,this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Y};Y.convert=function(e){if(e instanceof Y)return e;if(Array.isArray(e))return new Y(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Y(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function Ae(e,t){const n=t.getBoundingClientRect();return new Y(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function W(e,t,n,o){return{type:p.FEATURE,properties:{meta:v.VERTEX,parent:e,coord_path:n,active:o?I.ACTIVE:I.INACTIVE},geometry:{type:p.POINT,coordinates:t}}}function jt(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function ct(e,t,n){if(e!==null)for(var o,r,i,s,c,u,l,h=0,g=0,a,d=e.type,f=d==="FeatureCollection",E=d==="Feature",M=f?e.features.length:1,A=0;A<M;A++){l=f?e.features[A].geometry:E?e.geometry:e,a=l?l.type==="GeometryCollection":!1,c=a?l.geometries.length:1;for(var G=0;G<c;G++){var F=0,X=0;if(s=a?l.geometries[G]:l,s!==null){u=s.coordinates;var J=s.type;switch(h=n&&(J==="Polygon"||J==="MultiPolygon")?1:0,J){case null:break;case"Point":if(t(u,g,A,F,X)===!1)return!1;g++,F++;break;case"LineString":case"MultiPoint":for(o=0;o<u.length;o++){if(t(u[o],g,A,F,X)===!1)return!1;g++,J==="MultiPoint"&&F++}J==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(o=0;o<u.length;o++){for(r=0;r<u[o].length-h;r++){if(t(u[o][r],g,A,F,X)===!1)return!1;g++}J==="MultiLineString"&&F++,J==="Polygon"&&X++}J==="Polygon"&&F++;break;case"MultiPolygon":for(o=0;o<u.length;o++){for(X=0,r=0;r<u[o].length;r++){for(i=0;i<u[o][r].length-h;i++){if(t(u[o][r][i],g,A,F,X)===!1)return!1;g++}X++}F++}break;case"GeometryCollection":for(o=0;o<s.geometries.length;o++)if(ct(s.geometries[o],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function en(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return lt(e);case"FeatureCollection":return tn(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Pe(e);default:throw new Error("unknown GeoJSON type")}}function lt(e){const t={type:"Feature"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}}),t.properties=dt(e.properties),e.geometry==null?t.geometry=null:t.geometry=Pe(e.geometry),t}function dt(e){const t={};return e&&Object.keys(e).forEach(n=>{const o=e[n];typeof o=="object"?o===null?t[n]=null:Array.isArray(o)?t[n]=o.map(r=>r):t[n]=dt(o):t[n]=o}),t}function tn(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"features":return;default:t[n]=e[n]}}),t.features=e.features.map(n=>lt(n)),t}function Pe(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(n=>Pe(n)),t):(t.coordinates=ft(e.coordinates),t)}function ft(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(n=>ft(n))}function Ve(e,t={}){return pt(e,"mercator",t)}function nn(e,t={}){return pt(e,"wgs84",t)}function pt(e,t,n={}){n=n||{};var o=n.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&jt(e[0])?e=t==="mercator"?Ge(e):Be(e):(o!==!0&&(e=en(e)),ct(e,function(r){var i=t==="mercator"?Ge(r):Be(r);r[0]=i[0],r[1]=i[1]})),e}function Ge(e){var t=Math.PI/180,n=6378137,o=20037508342789244e-9,r=Math.abs(e[0])<=180?e[0]:e[0]-on(e[0])*360,i=[n*r*t,n*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return i[0]>o&&(i[0]=o),i[0]<-o&&(i[0]=-o),i[1]>o&&(i[1]=o),i[1]<-o&&(i[1]=-o),i}function Be(e){var t=180/Math.PI,n=6378137;return[e[0]*t/n,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/n)))*t]}function on(e){return e<0?-1:e>0?1:0}function ht(e,t,n){const o=t.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>Ee||o[1]<me||r[1]>Ee||r[1]<me)return null;const i=Ve(o),s=Ve(r),c=g=>Number(g.toFixed(8)),u=(g,a)=>(g+a)/2,l=nn([u(i[0],s[0]),u(i[1],s[1])]),h=[c(l[0]),c(l[1])];return{type:p.FEATURE,properties:{meta:v.MIDPOINT,parent:e,lng:h[0],lat:h[1],coord_path:n.properties.coord_path},geometry:{type:p.POINT,coordinates:h}}}function fe(e,t={},n=null){const{type:o,coordinates:r}=e.geometry,i=e.properties&&e.properties.id;let s=[];o===p.POINT?s.push(W(i,r,n,u(n))):o===p.POLYGON?r.forEach((h,g)=>{c(h,n!==null?`${n}.${g}`:String(g))}):o===p.LINE_STRING?c(r,n):o.indexOf(p.MULTI_PREFIX)===0&&l();function c(h,g){let a="",d=null;h.forEach((f,E)=>{const M=g!=null?`${g}.${E}`:String(E),A=W(i,f,M,u(M));if(t.midpoints&&d){const F=ht(i,d,A);F&&s.push(F)}d=A;const G=JSON.stringify(f);a!==G&&s.push(A),E===0&&(a=G)})}function u(h){return t.selectedPaths?t.selectedPaths.indexOf(h)!==-1:!1}function l(){const h=o.replace(p.MULTI_PREFIX,"");r.forEach((g,a)=>{const d={type:p.FEATURE,properties:e.properties,geometry:{type:h,coordinates:g}};s=s.concat(fe(d,t,a))})}return s}const k={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:ee,LAT_MAX:te,LAT_RENDERED_MIN:$e,LAT_RENDERED_MAX:Je,LNG_MIN:Ye,LNG_MAX:Ke}=Ze;function rn(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),o=n.map(c=>c[0]),r=n.map(c=>c[1]),i=c=>Math.min.apply(null,c),s=c=>Math.max.apply(null,c);return[i(o),i(r),s(o),s(r)]}function we(e,t){let n=ee,o=te,r=ee,i=te,s=Ke,c=Ye;e.forEach(l=>{const h=rn(l),g=h[1],a=h[3],d=h[0],f=h[2];g>n&&(n=g),a<o&&(o=a),a>r&&(r=a),g<i&&(i=g),d<s&&(s=d),f>c&&(c=f)});const u=t;return n+u.lat>Je&&(u.lat=Je-n),r+u.lat>te&&(u.lat=te-r),o+u.lat<$e&&(u.lat=$e-o),i+u.lat<ee&&(u.lat=ee-i),s+u.lng<=Ye&&(u.lng+=Math.ceil(Math.abs(u.lng)/360)*360),c+u.lng>=Ke&&(u.lng-=Math.ceil(Math.abs(u.lng)/360)*360),u}function Fe(e,t){const n=we(e.map(o=>o.toGeoJSON()),t);e.forEach(o=>{const r=o.getCoordinates(),i=l=>{const h={lng:l[0]+n.lng,lat:l[1]+n.lat};return[h.lng,h.lat]},s=l=>l.map(h=>i(h)),c=l=>l.map(h=>s(h));let u;o.type===p.POINT?u=i(r):o.type===p.LINE_STRING||o.type===p.MULTI_POINT?u=r.map(i):o.type===p.POLYGON||o.type===p.MULTI_LINE_STRING?u=r.map(s):o.type===p.MULTI_POLYGON&&(u=r.map(c)),o.incomingCoords(u)})}const C={};C.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(n=>this.getFeature(n)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};C.fireUpdate=function(){this.fire(L.UPDATE,{action:z.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};C.fireActionable=function(){const e=this.getSelected(),t=e.filter(i=>this.isInstanceOf("MultiFeature",i));let n=!1;if(e.length>1){n=!0;const i=e[0].type.replace("Multi","");e.forEach(s=>{s.type.replace("Multi","")!==i&&(n=!1)})}const o=t.length>0,r=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:o,trash:r})};C.getUniqueIds=function(e){return e.length?e.map(n=>n.properties.id).filter(n=>n!==void 0).reduce((n,o)=>(n.add(o),n),new U).values():[]};C.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};C.onStop=function(){k.enable(this)};C.onMouseMove=function(e,t){return ve(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};C.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};C.onTap=C.onClick=function(e,t){if(ae(t))return this.clickAnywhere(e,t);if(se(v.VERTEX)(t))return this.clickOnVertex(e,t);if(ve(t))return this.clickOnFeature(e,t)};C.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(n=>this.doRender(n))),k.enable(this),this.stopExtendedInteractions(e)};C.clickOnVertex=function(e,t){this.changeMode(m.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:_.MOVE})};C.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};C.clickOnFeature=function(e,t){k.disable(this),this.stopExtendedInteractions(e);const n=re(t),o=this.getSelectedIds(),r=t.featureTarget.properties.id,i=this.isSelected(r);if(!n&&i&&this.getFeature(r).type!==p.POINT)return this.changeMode(m.DIRECT_SELECT,{featureId:r});i&&n?(this.deselect(r),this.updateUIClasses({mouse:_.POINTER}),o.length===1&&k.enable(this)):!i&&n?(this.select(r),this.updateUIClasses({mouse:_.MOVE})):!i&&!n&&(o.forEach(s=>this.doRender(s)),this.setSelected(r),this.updateUIClasses({mouse:_.MOVE})),this.doRender(r)};C.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),q(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&ze(t))return this.startBoxSelect(e,t)};C.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Ae(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};C.onTouchStart=function(e,t){if(q(t))return this.startOnActiveFeature(e,t)};C.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};C.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:_.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(P.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=Ae(t.originalEvent,this.map.getContainer()),o=Math.min(e.boxSelectStartLocation.x,n.x),r=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),s=Math.max(e.boxSelectStartLocation.y,n.y),c=`translate(${o}px, ${i}px)`;e.boxSelectElement.style.transform=c,e.boxSelectElement.style.WebkitTransform=c,e.boxSelectElement.style.width=`${r-o}px`,e.boxSelectElement.style.height=`${s-i}px`};C.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Fe(this.getSelected(),n),e.dragMoveLocation=t.lngLat};C.onTouchEnd=C.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,Ae(t.originalEvent,this.map.getContainer())],o=this.featuresAt(null,n,"click"),r=this.getUniqueIds(o).filter(i=>!this.isSelected(i));r.length&&(this.select(r),r.forEach(i=>this.doRender(i)),this.updateUIClasses({mouse:_.MOVE}))}this.stopExtendedInteractions(e)};C.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?I.ACTIVE:I.INACTIVE,n(t),this.fireActionable(),!(t.properties.active!==I.ACTIVE||t.geometry.type===p.POINT)&&fe(t).forEach(n)};C.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};C.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],n=[],o=e[0].type.replace("Multi","");for(let r=0;r<e.length;r++){const i=e[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach(s=>{t.push(s)}):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){const r=this.newFeature({type:p.FEATURE,properties:n[0].properties,geometry:{type:`Multi${o}`,coordinates:t}});this.addFeature(r),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([r.id]),this.fire(L.COMBINE_FEATURES,{createdFeatures:[r.toGeoJSON()],deletedFeatures:n})}this.fireActionable()};C.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],n=[];for(let o=0;o<e.length;o++){const r=e[o];this.isInstanceOf("MultiFeature",r)&&(r.getFeatures().forEach(i=>{this.addFeature(i),i.properties=r.properties,t.push(i.toGeoJSON()),this.select([i.id])}),this.deleteFeature(r.id,{silent:!0}),n.push(r.toGeoJSON()))}t.length>1&&this.fire(L.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};const gt=se(v.VERTEX),yt=se(v.MIDPOINT),S={};S.fireUpdate=function(){this.fire(L.UPDATE,{action:z.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};S.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};S.startDragging=function(e,t){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};S.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};S.onVertex=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,o=e.selectedCoordPaths.indexOf(n.coord_path);!re(t)&&o===-1?e.selectedCoordPaths=[n.coord_path]:re(t)&&o===-1&&e.selectedCoordPaths.push(n.coord_path);const r=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(r)};S.onMidpoint=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]};S.pathsToCoordinates=function(e,t){return t.map(n=>({feature_id:e,coord_path:n}))};S.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};S.dragFeature=function(e,t,n){Fe(this.getSelected(),n),e.dragMoveLocation=t.lngLat};S.dragVertex=function(e,t,n){const o=e.selectedCoordPaths.map(s=>e.feature.getCoordinate(s)),r=o.map(s=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:s}})),i=we(r,n);for(let s=0;s<o.length;s++){const c=o[s];e.feature.updateCoordinate(e.selectedCoordPaths[s],c[0]+i.lng,c[1]+i.lat)}};S.clickNoTarget=function(){this.changeMode(m.SIMPLE_SELECT)};S.clickInactive=function(){this.changeMode(m.SIMPLE_SELECT)};S.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};S.onSetup=function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===p.POINT)throw new TypeError("direct_select mode doesn't handle point features");const o={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,o.selectedCoordPaths)),this.setSelected(t),k.disable(this),this.setActionableState({trash:!0}),o};S.onStop=function(){k.enable(this),this.clearSelectedCoordinates()};S.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=I.ACTIVE,n(t),fe(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=I.INACTIVE,n(t)),this.fireActionable(e)};S.onTrash=function(e){e.selectedCoordPaths.sort((t,n)=>n.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(m.SIMPLE_SELECT,{}))};S.onMouseMove=function(e,t){const n=q(t),o=gt(t),r=yt(t),i=e.selectedCoordPaths.length===0;return n&&i?this.updateUIClasses({mouse:_.MOVE}):o&&!i?this.updateUIClasses({mouse:_.MOVE}):this.updateUIClasses({mouse:_.NONE}),(o||n||r)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};S.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};S.onTouchStart=S.onMouseDown=function(e,t){if(gt(t))return this.onVertex(e,t);if(q(t))return this.onFeature(e,t);if(yt(t))return this.onMidpoint(e,t)};S.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat};S.onClick=function(e,t){if(ae(t))return this.clickNoTarget(e,t);if(q(t))return this.clickActiveFeature(e,t);if(Oe(t))return this.clickInactive(e,t);this.stopDragging(e)};S.onTap=function(e,t){if(ae(t))return this.clickNoTarget(e,t);if(q(t))return this.clickActiveFeature(e,t);if(Oe(t))return this.clickInactive(e,t)};S.onTouchEnd=S.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const B={};B.onSetup=function(){const e=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:_.ADD}),this.activateUIButton(w.POINT),this.setActionableState({trash:!0}),{point:e}};B.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)};B.onTap=B.onClick=function(e,t){this.updateUIClasses({mouse:_.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(L.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.point.id]})};B.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};B.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.point.id;if(t.properties.active=o?I.ACTIVE:I.INACTIVE,!o)return n(t)};B.onTrash=B.stopDrawingAndRemove;B.onKeyUp=function(e,t){if(ue(t)||ce(t))return this.stopDrawingAndRemove(e,t)};function ie(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const x={};x.onSetup=function(){const e=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),k.disable(this),this.updateUIClasses({mouse:_.ADD}),this.activateUIButton(w.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};x.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&ie(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:_.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};x.clickOnVertex=function(e){return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};x.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Q(t)&&this.updateUIClasses({mouse:_.POINTER})};x.onTap=x.onClick=function(e,t){return Q(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};x.onKeyUp=function(e,t){ue(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)):ce(t)&&this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};x.onStop=function(e){this.updateUIClasses({mouse:_.NONE}),k.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(L.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT,{},{silent:!0})))};x.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.polygon.id;if(t.properties.active=o?I.ACTIVE:I.INACTIVE,!o)return n(t);if(t.geometry.coordinates.length===0)return;const r=t.geometry.coordinates[0].length;if(!(r<3)){if(t.properties.meta=v.FEATURE,n(W(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),r>3){const i=t.geometry.coordinates[0].length-3;n(W(e.polygon.id,t.geometry.coordinates[0][i],`0.${i}`,!1))}if(r<=4){const i=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:p.FEATURE,properties:t.properties,geometry:{coordinates:i,type:p.LINE_STRING}}),r===3)return}return n(t)}};x.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)};const V={};V.onSetup=function(e){e=e||{};const t=e.featureId;let n,o,r="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let i=e.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const s=n.coordinates.length-1;if(n.coordinates[s][0]===i[0]&&n.coordinates[s][1]===i[1])o=s+1,n.addCoordinate(o,...n.coordinates[s]);else if(n.coordinates[0][0]===i[0]&&n.coordinates[0][1]===i[1])r="backwards",o=0,n.addCoordinate(o,...n.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else n=this.newFeature({type:p.FEATURE,properties:{},geometry:{type:p.LINE_STRING,coordinates:[]}}),o=0,this.addFeature(n);return this.clearSelectedFeatures(),k.disable(this),this.updateUIClasses({mouse:_.ADD}),this.activateUIButton(w.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:o,direction:r}};V.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&ie(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&ie(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:_.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};V.clickOnVertex=function(e){return this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]})};V.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Q(t)&&this.updateUIClasses({mouse:_.POINTER})};V.onTap=V.onClick=function(e,t){if(Q(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};V.onKeyUp=function(e,t){ce(t)?this.changeMode(m.SIMPLE_SELECT,{featureIds:[e.line.id]}):ue(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT))};V.onStop=function(e){k.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(L.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT,{},{silent:!0})))};V.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)};V.toDisplayFeatures=function(e,t,n){const o=t.properties.id===e.line.id;if(t.properties.active=o?I.ACTIVE:I.INACTIVE,!o)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=v.FEATURE,n(W(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),n(t))};const mt={simple_select:C,direct_select:S,draw_point:B,draw_polygon:x,draw_line_string:V},sn={defaultMode:m.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ut,modes:mt,controls:{},userProperties:!1,suppressAPIEvents:!0},an={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},un={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Xe(e,t){return e.map(n=>n.source?n:Object.assign({},n,{id:`${n.id}.${t}`,source:t==="hot"?R.HOT:R.COLD}))}function cn(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},un,e.controls):t.controls=Object.assign({},an,e.controls),t=Object.assign({},sn,t),t.styles=Xe(t.styles,"cold").concat(Xe(t.styles,"hot")),t}var ln=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var o,r,i;if(Array.isArray(t)){if(o=t.length,o!=n.length)return!1;for(r=o;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(i=Object.keys(t),o=i.length,o!==Object.keys(n).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=o;r--!==0;){var s=i[r];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n};const qe=He(ln);var dn=pn,fn={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function pn(e){if(!e||!e.type)return null;var t=fn[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e}const hn=He(dn);function Et(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(n=>n).sort())===JSON.stringify(t.map(n=>n).sort())}const gn={Polygon:D,LineString:$,Point:K,MultiPolygon:b,MultiLineString:b,MultiPoint:b};function yn(e,t){t.modes=m;const n=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(o){return H.click({point:o},null,e).map(i=>i.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(o=>e.store.get(o)).map(o=>o.toGeoJSON())}},t.getSelectedPoints=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(o=>({type:p.FEATURE,properties:{},geometry:{type:p.POINT,coordinates:o.coordinates}}))}},t.set=function(o){if(o.type===void 0||o.type!==p.FEATURE_COLLECTION||!Array.isArray(o.features))throw new Error("Invalid FeatureCollection");const r=e.store.createRenderBatch();let i=e.store.getAllIds().slice();const s=t.add(o),c=new U(s);return i=i.filter(u=>!c.has(u)),i.length&&t.delete(i),r(),s},t.add=function(o){const i=JSON.parse(JSON.stringify(hn(o))).features.map(s=>{if(s.id=s.id||Ne(),s.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(s.id)===void 0||e.store.get(s.id).type!==s.geometry.type){const c=gn[s.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${s.geometry.type}.`);const u=new c(e,s);e.store.add(u,{silent:n})}else{const c=e.store.get(s.id),u=c.properties;c.properties=s.properties,qe(u,s.properties)||e.store.featureChanged(c.id,{silent:n}),qe(c.getCoordinates(),s.geometry.coordinates)||c.incomingCoords(s.geometry.coordinates)}return s.id});return e.store.render(),i},t.get=function(o){const r=e.store.get(o);if(r)return r.toGeoJSON()},t.getAll=function(){return{type:p.FEATURE_COLLECTION,features:e.store.getAll().map(o=>o.toGeoJSON())}},t.delete=function(o){return e.store.delete(o,{silent:n}),t.getMode()===m.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===m.DIRECT_SELECT?e.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(o,r={}){return o===m.SIMPLE_SELECT&&t.getMode()===m.SIMPLE_SELECT?(Et(r.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(r.featureIds,{silent:n}),e.store.render()),t):(o===m.DIRECT_SELECT&&t.getMode()===m.DIRECT_SELECT&&r.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(o,r,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(o,r,i){return e.store.setFeatureProperty(o,r,i,{silent:n}),t},t}const mn=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:Ft,ModeHandler:Me,StringSet:U,constrainFeatureMovement:we,createMidPoint:ht,createSupplementaryPoints:fe,createVertex:W,doubleClickZoom:k,euclideanDistance:Le,featuresAt:H,getFeatureAtAndSetCursors:oe,isClick:_e,isEventAtCoordinates:ie,isTap:Ie,mapEventToBoundingBox:rt,moveFeatures:Fe,sortFeatures:ot,stringSetsAreEqual:Et,theme:ut,toDenseArray:j},Symbol.toStringTag,{value:"Module"})),En=function(e,t){e=cn(e);const n={options:e};t=yn(n,t),n.api=t;const o=Qt(n);return t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=w,t.options=e,t};function pe(e){En(e,this)}pe.modes=mt;pe.constants=Ze;pe.lib=mn;ne.accessToken="pk.eyJ1IjoieG1zMTIxMzgiLCJhIjoiY21oaWw5cnRoMDIyazJpc2Q4azF3ZW81eCJ9.p5vgHrhM1hR6Bvl-vjmO7A";const Cn={setup(){const e=De(null),t=De(!1);let n=null,o=null;const r=()=>{n||!e.value||(n=new ne.Map({container:e.value,style:"mapbox://styles/mapbox/standard",center:[-.1276,51.5072],zoom:10.2,pitch:60,bearing:-20,antialias:!0}),n.addControl(new ne.NavigationControl,"top-right"),n.on("load",async()=>{var c;o=new pe({displayControlsDefault:!1,controls:{line_string:!0,trash:!0}}),n.addControl(o,"top-left");try{const u=await fetch("/london_boroughs.geojson");if(!u.ok)console.error("[Boroughs] :",u.status);else{const l=await u.json(),h=["#1d4ed8","#9333ea","#dc2626","#16a34a","#0891b2","#b45309","#7e22ce","#2563eb","#ea580c","#047857","#0f766e","#be185d","#c2410c","#166534","#3b82f6","#6d28d9","#9d174d","#b91c1c","#15803d","#0e7490","#78350f","#312e81","#991b1b","#1e40af","#5b21b6","#9a3412","#14532d","#134e4a","#831843","#7c2d12","#064e3b","#0f172a","#701a75"];(c=l.features)!=null&&c.length&&l.features.forEach((g,a)=>{g.properties=g.properties||{},g.properties._color=h[a%h.length],g.properties._label=g.properties.name||g.properties.NAME||g.properties.borough||`Area ${a+1}`}),n.getSource("london-boroughs")||n.addSource("london-boroughs",{type:"geojson",data:l}),n.getLayer("london-boroughs-fill")||n.addLayer({id:"london-boroughs-fill",type:"fill",source:"london-boroughs",paint:{"fill-color":["get","_color"],"fill-opacity":.35}}),n.getLayer("london-boroughs-outline")||n.addLayer({id:"london-boroughs-outline",type:"line",source:"london-boroughs",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","_color"],"line-width":2.2,"line-opacity":.95}}),n.getLayer("london-boroughs-label")||n.addLayer({id:"london-boroughs-label",type:"symbol",source:"london-boroughs",layout:{"text-field":["get","_label"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12,"text-offset":[0,0],"text-anchor":"center"},paint:{"text-color":"#f1f5f9","text-halo-color":"#020817","text-halo-width":1.2}})}}catch(u){console.error("[Boroughs] :",u)}try{const u=await fetch("/busiest_streets.geojson");if(u.ok){const l=await u.json();n.getSource("busiest-streets")||n.addSource("busiest-streets",{type:"geojson",data:l}),n.getLayer("busiest-streets-line")||n.addLayer({id:"busiest-streets-line",type:"line",source:"busiest-streets",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ff3b30","line-width":8,"line-blur":2,"line-opacity":.95,"line-offset":1.5,"line-translate":[0,-1.5]}})}}catch{console.warn("[Busiest] No existing busiest_streets.geojson")}window._matchMap=n,window._draw=o}))},i=async c=>{let l=c;if(c.length>100){const f=Math.ceil(c.length/100);l=c.filter((A,G)=>G%f===0);const E=c[c.length-1],M=l[l.length-1];(M[0]!==E[0]||M[1]!==E[1])&&l.push(E)}const g="https://api.mapbox.com/matching/v5/mapbox/driving/"+l.map(f=>`${f[0]},${f[1]}`).join(";")+`?geometries=geojson&overview=full&access_token=${ne.accessToken}`,d=await(await fetch(g)).json();if(!d.matchings||!d.matchings.length)throw new Error("No matchings returned");return d.matchings[0].geometry},s=async()=>{var h;if(!o)return;const c=o.getAll();if(!c.features||!c.features.length){alert("");return}t.value=!0;const u=[];for(const g of c.features)if(((h=g.geometry)==null?void 0:h.type)==="LineString")try{const a=await i(g.geometry.coordinates);u.push({type:"Feature",properties:g.properties||{},geometry:a})}catch(a){console.error("Snap failed:",a)}t.value=!1;const l={type:"FeatureCollection",features:u};console.log(" Snapped GeoJSON (save as busiest_streets.geojson):",JSON.stringify(l,null,2)),alert(" GeoJSON"),n.getSource("busiest-streets")?n.getSource("busiest-streets").setData(l):n.addSource("busiest-streets",{type:"geojson",data:l}),n.getLayer("busiest-streets-line")||n.addLayer({id:"busiest-streets-line",type:"line",source:"busiest-streets",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ff3b30","line-width":8,"line-blur":2,"line-opacity":.95,"line-offset":1.5,"line-translate":[0,-1.5]}})};return St(r),Tt(()=>{n&&n.remove()}),{mapContainer:e,snapping:t,onSnapAndExport:s}}},Sn={class:"map-page"},Tn={class:"nav-links"},_n={class:"main-container"},In={class:"map-container-wrapper"},Mn={ref:"mapContainer",class:"map-container"},On={class:"overlay-box"},vn=["disabled"];function bn(e,t,n,o,r,i){const s=_t("router-link");return It(),Mt("div",Sn,[O("nav",null,[t[2]||(t[2]=O("div",{class:"logo"},"ECOVISION MATCH TEST",-1)),O("ul",Tn,[O("li",null,[Ot(s,{to:"/"},{default:vt(()=>[...t[1]||(t[1]=[he("BACK TO MAIN",-1)])]),_:1})])])]),O("div",_n,[t[6]||(t[6]=O("div",{class:"page-header"},[O("h1",{class:"page-title"},"3D Road Visualization & Map Matching"),O("p",{class:"page-subtitle"}," Draw busiest streets, snap to real roads, and see them in 3D style! ")],-1)),O("div",In,[O("div",Mn,null,512),O("div",On,[t[3]||(t[3]=O("div",null," ",-1)),t[4]||(t[4]=O("div",null," ",-1)),O("button",{class:"btn",onClick:t[0]||(t[0]=(...c)=>o.onSnapAndExport&&o.onSnapAndExport(...c)),disabled:o.snapping},bt(o.snapping?"Snapping...":"Snap & Export"),9,vn),t[5]||(t[5]=O("div",{class:"hint"},[he("  "),O("code",null,"busiest_streets_snapped.geojson"),he("  ")],-1))])])])])}const Nn=Ct(Cn,[["render",bn],["__scopeId","data-v-7094588e"]]);export{Nn as default};
