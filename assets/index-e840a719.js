var Lst=Object.defineProperty;var Rst=(i,t,e)=>t in i?Lst(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Wi=(i,t,e)=>(Rst(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();/**
* @vue/shared v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function EB(i){const t=Object.create(null);for(const e of i.split(","))t[e]=1;return e=>e in t}const Aa={},Qy=[],lu=()=>{},G7=()=>!1,CC=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),DB=i=>i.startsWith("onUpdate:"),as=Object.assign,PB=(i,t)=>{const e=i.indexOf(t);e>-1&&i.splice(e,1)},kst=Object.prototype.hasOwnProperty,da=(i,t)=>kst.call(i,t),Hr=Array.isArray,t0=i=>AS(i)==="[object Map]",L0=i=>AS(i)==="[object Set]",OU=i=>AS(i)==="[object Date]",dn=i=>typeof i=="function",ko=i=>typeof i=="string",vh=i=>typeof i=="symbol",Ia=i=>i!==null&&typeof i=="object",H7=i=>(Ia(i)||dn(i))&&dn(i.then)&&dn(i.catch),j7=Object.prototype.toString,AS=i=>j7.call(i),Ost=i=>AS(i).slice(8,-1),W7=i=>AS(i)==="[object Object]",LB=i=>ko(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,cw=EB(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),EC=i=>{const t=Object.create(null);return e=>t[e]||(t[e]=i(e))},zst=/-\w/g,Rc=EC(i=>i.replace(zst,t=>t.slice(1).toUpperCase())),Bst=/\B([A-Z])/g,Fp=EC(i=>i.replace(Bst,"-$1").toLowerCase()),DC=EC(i=>i.charAt(0).toUpperCase()+i.slice(1)),FP=EC(i=>i?`on${DC(i)}`:""),vp=(i,t)=>!Object.is(i,t),wI=(i,...t)=>{for(let e=0;e<i.length;e++)i[e](...t)},$7=(i,t,e,r=!1)=>{Object.defineProperty(i,t,{configurable:!0,enumerable:!1,writable:r,value:e})},PC=i=>{const t=parseFloat(i);return isNaN(t)?i:t};let zU;const LC=()=>zU||(zU=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function R0(i){if(Hr(i)){const t={};for(let e=0;e<i.length;e++){const r=i[e],n=ko(r)?Ust(r):R0(r);if(n)for(const o in n)t[o]=n[o]}return t}else if(ko(i)||Ia(i))return i}const Fst=/;(?![^(]*\))/g,Nst=/:([^]+)/,Vst=/\/\*[^]*?\*\//g;function Ust(i){const t={};return i.replace(Vst,"").split(Fst).forEach(e=>{if(e){const r=e.split(Nst);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t}function gd(i){let t="";if(ko(i))t=i;else if(Hr(i))for(let e=0;e<i.length;e++){const r=gd(i[e]);r&&(t+=r+" ")}else if(Ia(i))for(const e in i)i[e]&&(t+=e+" ");return t.trim()}const Gst="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Hst=EB(Gst);function Z7(i){return!!i||i===""}function jst(i,t){if(i.length!==t.length)return!1;let e=!0;for(let r=0;e&&r<i.length;r++)e=IS(i[r],t[r]);return e}function IS(i,t){if(i===t)return!0;let e=OU(i),r=OU(t);if(e||r)return e&&r?i.getTime()===t.getTime():!1;if(e=vh(i),r=vh(t),e||r)return i===t;if(e=Hr(i),r=Hr(t),e||r)return e&&r?jst(i,t):!1;if(e=Ia(i),r=Ia(t),e||r){if(!e||!r)return!1;const n=Object.keys(i).length,o=Object.keys(t).length;if(n!==o)return!1;for(const s in i){const a=i.hasOwnProperty(s),u=t.hasOwnProperty(s);if(a&&!u||!a&&u||!IS(i[s],t[s]))return!1}}return String(i)===String(t)}function RB(i,t){return i.findIndex(e=>IS(e,t))}const q7=i=>!!(i&&i.__v_isRef===!0),Ta=i=>ko(i)?i:i==null?"":Hr(i)||Ia(i)&&(i.toString===j7||!dn(i.toString))?q7(i)?Ta(i.value):JSON.stringify(i,X7,2):String(i),X7=(i,t)=>q7(t)?X7(i,t.value):t0(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[r,n],o)=>(e[NP(r,o)+" =>"]=n,e),{})}:L0(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>NP(e))}:vh(t)?NP(t):Ia(t)&&!Hr(t)&&!W7(t)?String(t):t,NP=(i,t="")=>{var e;return vh(i)?`Symbol(${(e=i.description)!=null?e:t})`:i};/**
* @vue/reactivity v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Dl;class Wst{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Dl,!t&&Dl&&(this.index=(Dl.scopes||(Dl.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Dl;try{return Dl=this,t()}finally{Dl=e}}}on(){++this._on===1&&(this.prevScope=Dl,Dl=this)}off(){this._on>0&&--this._on===0&&(Dl=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let e,r;for(e=0,r=this.effects.length;e<r;e++)this.effects[e].stop();for(this.effects.length=0,e=0,r=this.cleanups.length;e<r;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,r=this.scopes.length;e<r;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0}}}function $st(){return Dl}let Ra;const VP=new WeakSet;class Y7{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Dl&&Dl.active&&Dl.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,VP.has(this)&&(VP.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||J7(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,BU(this),Q7(this);const t=Ra,e=cu;Ra=this,cu=!0;try{return this.fn()}finally{t9(this),Ra=t,cu=e,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)zB(t);this.deps=this.depsTail=void 0,BU(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?VP.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Vk(this)&&this.run()}get dirty(){return Vk(this)}}let K7=0,uw,hw;function J7(i,t=!1){if(i.flags|=8,t){i.next=hw,hw=i;return}i.next=uw,uw=i}function kB(){K7++}function OB(){if(--K7>0)return;if(hw){let t=hw;for(hw=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let i;for(;uw;){let t=uw;for(uw=void 0;t;){const e=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(r){i||(i=r)}t=e}}if(i)throw i}function Q7(i){for(let t=i.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function t9(i){let t,e=i.depsTail,r=e;for(;r;){const n=r.prevDep;r.version===-1?(r===e&&(e=n),zB(r),Zst(r)):t=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=n}i.deps=t,i.depsTail=e}function Vk(i){for(let t=i.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(e9(t.dep.computed)||t.dep.version!==t.version))return!0;return!!i._dirty}function e9(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===kw)||(i.globalVersion=kw,!i.isSSR&&i.flags&128&&(!i.deps&&!i._dirty||!Vk(i))))return;i.flags|=2;const t=i.dep,e=Ra,r=cu;Ra=i,cu=!0;try{Q7(i);const n=i.fn(i._value);(t.version===0||vp(n,i._value))&&(i.flags|=128,i._value=n,t.version++)}catch(n){throw t.version++,n}finally{Ra=e,cu=r,t9(i),i.flags&=-3}}function zB(i,t=!1){const{dep:e,prevSub:r,nextSub:n}=i;if(r&&(r.nextSub=n,i.prevSub=void 0),n&&(n.prevSub=r,i.nextSub=void 0),e.subs===i&&(e.subs=r,!r&&e.computed)){e.computed.flags&=-5;for(let o=e.computed.deps;o;o=o.nextDep)zB(o,!0)}!t&&!--e.sc&&e.map&&e.map.delete(e.key)}function Zst(i){const{prevDep:t,nextDep:e}=i;t&&(t.nextDep=e,i.prevDep=void 0),e&&(e.prevDep=t,i.nextDep=void 0)}let cu=!0;const i9=[];function Cd(){i9.push(cu),cu=!1}function Ed(){const i=i9.pop();cu=i===void 0?!0:i}function BU(i){const{cleanup:t}=i;if(i.cleanup=void 0,t){const e=Ra;Ra=void 0;try{t()}finally{Ra=e}}}let kw=0;class qst{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class BB{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Ra||!cu||Ra===this.computed)return;let e=this.activeLink;if(e===void 0||e.sub!==Ra)e=this.activeLink=new qst(Ra,this),Ra.deps?(e.prevDep=Ra.depsTail,Ra.depsTail.nextDep=e,Ra.depsTail=e):Ra.deps=Ra.depsTail=e,r9(e);else if(e.version===-1&&(e.version=this.version,e.nextDep)){const r=e.nextDep;r.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=r),e.prevDep=Ra.depsTail,e.nextDep=void 0,Ra.depsTail.nextDep=e,Ra.depsTail=e,Ra.deps===e&&(Ra.deps=r)}return e}trigger(t){this.version++,kw++,this.notify(t)}notify(t){kB();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{OB()}}}function r9(i){if(i.dep.sc++,i.sub.flags&4){const t=i.dep.computed;if(t&&!i.dep.subs){t.flags|=20;for(let r=t.deps;r;r=r.nextDep)r9(r)}const e=i.dep.subs;e!==i&&(i.prevSub=e,e&&(e.nextSub=i)),i.dep.subs=i}}const Uk=new WeakMap,Xm=Symbol(""),Gk=Symbol(""),Ow=Symbol("");function Ls(i,t,e){if(cu&&Ra){let r=Uk.get(i);r||Uk.set(i,r=new Map);let n=r.get(e);n||(r.set(e,n=new BB),n.map=r,n.key=e),n.track()}}function dd(i,t,e,r,n,o){const s=Uk.get(i);if(!s){kw++;return}const a=u=>{u&&u.trigger()};if(kB(),t==="clear")s.forEach(a);else{const u=Hr(i),f=u&&LB(e);if(u&&e==="length"){const g=Number(r);s.forEach((v,y)=>{(y==="length"||y===Ow||!vh(y)&&y>=g)&&a(v)})}else switch((e!==void 0||s.has(void 0))&&a(s.get(e)),f&&a(s.get(Ow)),t){case"add":u?f&&a(s.get("length")):(a(s.get(Xm)),t0(i)&&a(s.get(Gk)));break;case"delete":u||(a(s.get(Xm)),t0(i)&&a(s.get(Gk)));break;case"set":t0(i)&&a(s.get(Xm));break}}OB()}function ly(i){const t=ha(i);return t===i?t:(Ls(t,"iterate",Ow),Pc(i)?t:t.map(gs))}function RC(i){return Ls(i=ha(i),"iterate",Ow),i}const Xst={__proto__:null,[Symbol.iterator](){return UP(this,Symbol.iterator,gs)},concat(...i){return ly(this).concat(...i.map(t=>Hr(t)?ly(t):t))},entries(){return UP(this,"entries",i=>(i[1]=gs(i[1]),i))},every(i,t){return Kh(this,"every",i,t,void 0,arguments)},filter(i,t){return Kh(this,"filter",i,t,e=>e.map(gs),arguments)},find(i,t){return Kh(this,"find",i,t,gs,arguments)},findIndex(i,t){return Kh(this,"findIndex",i,t,void 0,arguments)},findLast(i,t){return Kh(this,"findLast",i,t,gs,arguments)},findLastIndex(i,t){return Kh(this,"findLastIndex",i,t,void 0,arguments)},forEach(i,t){return Kh(this,"forEach",i,t,void 0,arguments)},includes(...i){return GP(this,"includes",i)},indexOf(...i){return GP(this,"indexOf",i)},join(i){return ly(this).join(i)},lastIndexOf(...i){return GP(this,"lastIndexOf",i)},map(i,t){return Kh(this,"map",i,t,void 0,arguments)},pop(){return rb(this,"pop")},push(...i){return rb(this,"push",i)},reduce(i,...t){return FU(this,"reduce",i,t)},reduceRight(i,...t){return FU(this,"reduceRight",i,t)},shift(){return rb(this,"shift")},some(i,t){return Kh(this,"some",i,t,void 0,arguments)},splice(...i){return rb(this,"splice",i)},toReversed(){return ly(this).toReversed()},toSorted(i){return ly(this).toSorted(i)},toSpliced(...i){return ly(this).toSpliced(...i)},unshift(...i){return rb(this,"unshift",i)},values(){return UP(this,"values",gs)}};function UP(i,t,e){const r=RC(i),n=r[t]();return r!==i&&!Pc(i)&&(n._next=n.next,n.next=()=>{const o=n._next();return o.done||(o.value=e(o.value)),o}),n}const Yst=Array.prototype;function Kh(i,t,e,r,n,o){const s=RC(i),a=s!==i&&!Pc(i),u=s[t];if(u!==Yst[t]){const v=u.apply(i,o);return a?gs(v):v}let f=e;s!==i&&(a?f=function(v,y){return e.call(this,gs(v),y,i)}:e.length>2&&(f=function(v,y){return e.call(this,v,y,i)}));const g=u.call(s,f,r);return a&&n?n(g):g}function FU(i,t,e,r){const n=RC(i);let o=e;return n!==i&&(Pc(i)?e.length>3&&(o=function(s,a,u){return e.call(this,s,a,u,i)}):o=function(s,a,u){return e.call(this,s,gs(a),u,i)}),n[t](o,...r)}function GP(i,t,e){const r=ha(i);Ls(r,"iterate",Ow);const n=r[t](...e);return(n===-1||n===!1)&&VB(e[0])?(e[0]=ha(e[0]),r[t](...e)):n}function rb(i,t,e=[]){Cd(),kB();const r=ha(i)[t].apply(i,e);return OB(),Ed(),r}const Kst=EB("__proto__,__v_isRef,__isVue"),n9=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(vh));function Jst(i){vh(i)||(i=String(i));const t=ha(this);return Ls(t,"has",i),t.hasOwnProperty(i)}class a9{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,r){if(e==="__v_skip")return t.__v_skip;const n=this._isReadonly,o=this._isShallow;if(e==="__v_isReactive")return!n;if(e==="__v_isReadonly")return n;if(e==="__v_isShallow")return o;if(e==="__v_raw")return r===(n?o?llt:c9:o?l9:s9).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(r)?t:void 0;const s=Hr(t);if(!n){let u;if(s&&(u=Xst[e]))return u;if(e==="hasOwnProperty")return Jst}const a=Reflect.get(t,e,zs(t)?t:r);if((vh(e)?n9.has(e):Kst(e))||(n||Ls(t,"get",e),o))return a;if(zs(a)){const u=s&&LB(e)?a:a.value;return n&&Ia(u)?jk(u):u}return Ia(a)?n?jk(a):MS(a):a}}class o9 extends a9{constructor(t=!1){super(!1,t)}set(t,e,r,n){let o=t[e];if(!this._isShallow){const u=Ip(o);if(!Pc(r)&&!Ip(r)&&(o=ha(o),r=ha(r)),!Hr(t)&&zs(o)&&!zs(r))return u||(o.value=r),!0}const s=Hr(t)&&LB(e)?Number(e)<t.length:da(t,e),a=Reflect.set(t,e,r,zs(t)?t:n);return t===ha(n)&&(s?vp(r,o)&&dd(t,"set",e,r):dd(t,"add",e,r)),a}deleteProperty(t,e){const r=da(t,e);t[e];const n=Reflect.deleteProperty(t,e);return n&&r&&dd(t,"delete",e,void 0),n}has(t,e){const r=Reflect.has(t,e);return(!vh(e)||!n9.has(e))&&Ls(t,"has",e),r}ownKeys(t){return Ls(t,"iterate",Hr(t)?"length":Xm),Reflect.ownKeys(t)}}class Qst extends a9{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const tlt=new o9,elt=new Qst,ilt=new o9(!0);const Hk=i=>i,U2=i=>Reflect.getPrototypeOf(i);function rlt(i,t,e){return function(...r){const n=this.__v_raw,o=ha(n),s=t0(o),a=i==="entries"||i===Symbol.iterator&&s,u=i==="keys"&&s,f=n[i](...r),g=e?Hk:t?nM:gs;return!t&&Ls(o,"iterate",u?Gk:Xm),{next(){const{value:v,done:y}=f.next();return y?{value:v,done:y}:{value:a?[g(v[0]),g(v[1])]:g(v),done:y}},[Symbol.iterator](){return this}}}}function G2(i){return function(...t){return i==="delete"?!1:i==="clear"?void 0:this}}function nlt(i,t){const e={get(n){const o=this.__v_raw,s=ha(o),a=ha(n);i||(vp(n,a)&&Ls(s,"get",n),Ls(s,"get",a));const{has:u}=U2(s),f=t?Hk:i?nM:gs;if(u.call(s,n))return f(o.get(n));if(u.call(s,a))return f(o.get(a));o!==s&&o.get(n)},get size(){const n=this.__v_raw;return!i&&Ls(ha(n),"iterate",Xm),n.size},has(n){const o=this.__v_raw,s=ha(o),a=ha(n);return i||(vp(n,a)&&Ls(s,"has",n),Ls(s,"has",a)),n===a?o.has(n):o.has(n)||o.has(a)},forEach(n,o){const s=this,a=s.__v_raw,u=ha(a),f=t?Hk:i?nM:gs;return!i&&Ls(u,"iterate",Xm),a.forEach((g,v)=>n.call(o,f(g),f(v),s))}};return as(e,i?{add:G2("add"),set:G2("set"),delete:G2("delete"),clear:G2("clear")}:{add(n){!t&&!Pc(n)&&!Ip(n)&&(n=ha(n));const o=ha(this);return U2(o).has.call(o,n)||(o.add(n),dd(o,"add",n,n)),this},set(n,o){!t&&!Pc(o)&&!Ip(o)&&(o=ha(o));const s=ha(this),{has:a,get:u}=U2(s);let f=a.call(s,n);f||(n=ha(n),f=a.call(s,n));const g=u.call(s,n);return s.set(n,o),f?vp(o,g)&&dd(s,"set",n,o):dd(s,"add",n,o),this},delete(n){const o=ha(this),{has:s,get:a}=U2(o);let u=s.call(o,n);u||(n=ha(n),u=s.call(o,n)),a&&a.call(o,n);const f=o.delete(n);return u&&dd(o,"delete",n,void 0),f},clear(){const n=ha(this),o=n.size!==0,s=n.clear();return o&&dd(n,"clear",void 0,void 0),s}}),["keys","values","entries",Symbol.iterator].forEach(n=>{e[n]=rlt(n,i,t)}),e}function FB(i,t){const e=nlt(i,t);return(r,n,o)=>n==="__v_isReactive"?!i:n==="__v_isReadonly"?i:n==="__v_raw"?r:Reflect.get(da(e,n)&&n in r?e:r,n,o)}const alt={get:FB(!1,!1)},olt={get:FB(!1,!0)},slt={get:FB(!0,!1)};const s9=new WeakMap,l9=new WeakMap,c9=new WeakMap,llt=new WeakMap;function clt(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ult(i){return i.__v_skip||!Object.isExtensible(i)?0:clt(Ost(i))}function MS(i){return Ip(i)?i:NB(i,!1,tlt,alt,s9)}function u9(i){return NB(i,!1,ilt,olt,l9)}function jk(i){return NB(i,!0,elt,slt,c9)}function NB(i,t,e,r,n){if(!Ia(i)||i.__v_raw&&!(t&&i.__v_isReactive))return i;const o=ult(i);if(o===0)return i;const s=n.get(i);if(s)return s;const a=new Proxy(i,o===2?r:e);return n.set(i,a),a}function e0(i){return Ip(i)?e0(i.__v_raw):!!(i&&i.__v_isReactive)}function Ip(i){return!!(i&&i.__v_isReadonly)}function Pc(i){return!!(i&&i.__v_isShallow)}function VB(i){return i?!!i.__v_raw:!1}function ha(i){const t=i&&i.__v_raw;return t?ha(t):i}function hlt(i){return!da(i,"__v_skip")&&Object.isExtensible(i)&&$7(i,"__v_skip",!0),i}const gs=i=>Ia(i)?MS(i):i,nM=i=>Ia(i)?jk(i):i;function zs(i){return i?i.__v_isRef===!0:!1}function Po(i){return h9(i,!1)}function dlt(i){return h9(i,!0)}function h9(i,t){return zs(i)?i:new flt(i,t)}class flt{constructor(t,e){this.dep=new BB,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:ha(t),this._value=e?t:gs(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,r=this.__v_isShallow||Pc(t)||Ip(t);t=r?t:ha(t),vp(t,e)&&(this._rawValue=t,this._value=r?t:gs(t),this.dep.trigger())}}function Ym(i){return zs(i)?i.value:i}const plt={get:(i,t,e)=>t==="__v_raw"?i:Ym(Reflect.get(i,t,e)),set:(i,t,e,r)=>{const n=i[t];return zs(n)&&!zs(e)?(n.value=e,!0):Reflect.set(i,t,e,r)}};function d9(i){return e0(i)?i:new Proxy(i,plt)}class glt{constructor(t,e,r){this.fn=t,this.setter=e,this._value=void 0,this.dep=new BB(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=kw-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Ra!==this)return J7(this,!0),!0}get value(){const t=this.dep.track();return e9(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function mlt(i,t,e=!1){let r,n;return dn(i)?r=i:(r=i.get,n=i.set),new glt(r,n,e)}const H2={},aM=new WeakMap;let Im;function vlt(i,t=!1,e=Im){if(e){let r=aM.get(e);r||aM.set(e,r=[]),r.push(i)}}function _lt(i,t,e=Aa){const{immediate:r,deep:n,once:o,scheduler:s,augmentJob:a,call:u}=e,f=H=>n?H:Pc(H)||n===!1||n===0?fd(H,1):fd(H);let g,v,y,w,I=!1,E=!1;if(zs(i)?(v=()=>i.value,I=Pc(i)):e0(i)?(v=()=>f(i),I=!0):Hr(i)?(E=!0,I=i.some(H=>e0(H)||Pc(H)),v=()=>i.map(H=>{if(zs(H))return H.value;if(e0(H))return f(H);if(dn(H))return u?u(H,2):H()})):dn(i)?t?v=u?()=>u(i,2):i:v=()=>{if(y){Cd();try{y()}finally{Ed()}}const H=Im;Im=g;try{return u?u(i,3,[w]):i(w)}finally{Im=H}}:v=lu,t&&n){const H=v,$=n===!0?1/0:n;v=()=>fd(H(),$)}const D=$st(),R=()=>{g.stop(),D&&D.active&&PB(D.effects,g)};if(o&&t){const H=t;t=(...$)=>{H(...$),R()}}let z=E?new Array(i.length).fill(H2):H2;const N=H=>{if(!(!(g.flags&1)||!g.dirty&&!H))if(t){const $=g.run();if(n||I||(E?$.some((X,K)=>vp(X,z[K])):vp($,z))){y&&y();const X=Im;Im=g;try{const K=[$,z===H2?void 0:E&&z[0]===H2?[]:z,w];z=$,u?u(t,3,K):t(...K)}finally{Im=X}}}else g.run()};return a&&a(N),g=new Y7(v),g.scheduler=s?()=>s(N,!1):N,w=H=>vlt(H,!1,g),y=g.onStop=()=>{const H=aM.get(g);if(H){if(u)u(H,4);else for(const $ of H)$();aM.delete(g)}},t?r?N(!0):z=g.run():s?s(N.bind(null,!0),!0):g.run(),R.pause=g.pause.bind(g),R.resume=g.resume.bind(g),R.stop=R,R}function fd(i,t=1/0,e){if(t<=0||!Ia(i)||i.__v_skip||(e=e||new Map,(e.get(i)||0)>=t))return i;if(e.set(i,t),t--,zs(i))fd(i.value,t,e);else if(Hr(i))for(let r=0;r<i.length;r++)fd(i[r],t,e);else if(L0(i)||t0(i))i.forEach(r=>{fd(r,t,e)});else if(W7(i)){for(const r in i)fd(i[r],t,e);for(const r of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,r)&&fd(i[r],t,e)}return i}/**
* @vue/runtime-core v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function CS(i,t,e,r){try{return r?i(...r):i()}catch(n){kC(n,t,e)}}function _h(i,t,e,r){if(dn(i)){const n=CS(i,t,e,r);return n&&H7(n)&&n.catch(o=>{kC(o,t,e)}),n}if(Hr(i)){const n=[];for(let o=0;o<i.length;o++)n.push(_h(i[o],t,e,r));return n}}function kC(i,t,e,r=!0){const n=t?t.vnode:null,{errorHandler:o,throwUnhandledErrorInProduction:s}=t&&t.appContext.config||Aa;if(t){let a=t.parent;const u=t.proxy,f=`https://vuejs.org/error-reference/#runtime-${e}`;for(;a;){const g=a.ec;if(g){for(let v=0;v<g.length;v++)if(g[v](i,u,f)===!1)return}a=a.parent}if(o){Cd(),CS(o,null,10,[i,u,f]),Ed();return}}ylt(i,e,n,r,s)}function ylt(i,t,e,r=!0,n=!1){if(n)throw i;console.error(i)}const hl=[];let Qu=-1;const i0=[];let Yf=null,Ny=0;const f9=Promise.resolve();let oM=null;function UB(i){const t=oM||f9;return i?t.then(this?i.bind(this):i):t}function xlt(i){let t=Qu+1,e=hl.length;for(;t<e;){const r=t+e>>>1,n=hl[r],o=zw(n);o<i||o===i&&n.flags&2?t=r+1:e=r}return t}function GB(i){if(!(i.flags&1)){const t=zw(i),e=hl[hl.length-1];!e||!(i.flags&2)&&t>=zw(e)?hl.push(i):hl.splice(xlt(t),0,i),i.flags|=1,p9()}}function p9(){oM||(oM=f9.then(m9))}function blt(i){Hr(i)?i0.push(...i):Yf&&i.id===-1?Yf.splice(Ny+1,0,i):i.flags&1||(i0.push(i),i.flags|=1),p9()}function NU(i,t,e=Qu+1){for(;e<hl.length;e++){const r=hl[e];if(r&&r.flags&2){if(i&&r.id!==i.uid)continue;hl.splice(e,1),e--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function g9(i){if(i0.length){const t=[...new Set(i0)].sort((e,r)=>zw(e)-zw(r));if(i0.length=0,Yf){Yf.push(...t);return}for(Yf=t,Ny=0;Ny<Yf.length;Ny++){const e=Yf[Ny];e.flags&4&&(e.flags&=-2),e.flags&8||e(),e.flags&=-2}Yf=null,Ny=0}}const zw=i=>i.id==null?i.flags&2?-1:1/0:i.id;function m9(i){const t=lu;try{for(Qu=0;Qu<hl.length;Qu++){const e=hl[Qu];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),CS(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Qu<hl.length;Qu++){const e=hl[Qu];e&&(e.flags&=-2)}Qu=-1,hl.length=0,g9(),oM=null,(hl.length||i0.length)&&m9()}}let Jl=null,v9=null;function sM(i){const t=Jl;return Jl=i,v9=i&&i.type.__scopeId||null,t}function jo(i,t=Jl,e){if(!t||i._n)return i;const r=(...n)=>{r._d&&uM(-1);const o=sM(t);let s;try{s=i(...n)}finally{sM(o),r._d&&uM(1)}return s};return r._n=!0,r._c=!0,r._d=!0,r}function gc(i,t){if(Jl===null)return i;const e=VC(Jl),r=i.dirs||(i.dirs=[]);for(let n=0;n<t.length;n++){let[o,s,a,u=Aa]=t[n];o&&(dn(o)&&(o={mounted:o,updated:o}),o.deep&&fd(s),r.push({dir:o,instance:e,value:s,oldValue:void 0,arg:a,modifiers:u}))}return i}function Zg(i,t,e,r){const n=i.dirs,o=t&&t.dirs;for(let s=0;s<n.length;s++){const a=n[s];o&&(a.oldValue=o[s].value);let u=a.dir[r];u&&(Cd(),_h(u,e,8,[i.el,a,i,t]),Ed())}}const wlt=Symbol("_vte"),Slt=i=>i.__isTeleport,Tlt=Symbol("_leaveCb");function HB(i,t){i.shapeFlag&6&&i.component?(i.transition=t,HB(i.component.subTree,t)):i.shapeFlag&128?(i.ssContent.transition=t.clone(i.ssContent),i.ssFallback.transition=t.clone(i.ssFallback)):i.transition=t}function _9(i,t){return dn(i)?(()=>as({name:i.name},t,{setup:i}))():i}function y9(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}const lM=new WeakMap;function dw(i,t,e,r,n=!1){if(Hr(i)){i.forEach((I,E)=>dw(I,t&&(Hr(t)?t[E]:t),e,r,n));return}if(fw(r)&&!n){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&dw(i,t,e,r.component.subTree);return}const o=r.shapeFlag&4?VC(r.component):r.el,s=n?null:o,{i:a,r:u}=i,f=t&&t.r,g=a.refs===Aa?a.refs={}:a.refs,v=a.setupState,y=ha(v),w=v===Aa?G7:I=>da(y,I);if(f!=null&&f!==u){if(VU(t),ko(f))g[f]=null,w(f)&&(v[f]=null);else if(zs(f)){f.value=null;const I=t;I.k&&(g[I.k]=null)}}if(dn(u))CS(u,a,12,[s,g]);else{const I=ko(u),E=zs(u);if(I||E){const D=()=>{if(i.f){const R=I?w(u)?v[u]:g[u]:u.value;if(n)Hr(R)&&PB(R,o);else if(Hr(R))R.includes(o)||R.push(o);else if(I)g[u]=[o],w(u)&&(v[u]=g[u]);else{const z=[o];u.value=z,i.k&&(g[i.k]=z)}}else I?(g[u]=s,w(u)&&(v[u]=s)):E&&(u.value=s,i.k&&(g[i.k]=s))};if(s){const R=()=>{D(),lM.delete(i)};R.id=-1,lM.set(i,R),Wl(R,e)}else VU(i),D()}}}function VU(i){const t=lM.get(i);t&&(t.flags|=8,lM.delete(i))}LC().requestIdleCallback;LC().cancelIdleCallback;const fw=i=>!!i.type.__asyncLoader,x9=i=>i.type.__isKeepAlive;function OC(i,t){b9(i,"a",t)}function Alt(i,t){b9(i,"da",t)}function b9(i,t,e=ks){const r=i.__wdc||(i.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return i()});if(zC(t,r,e),e){let n=e.parent;for(;n&&n.parent;)x9(n.parent.vnode)&&Ilt(r,t,e,n),n=n.parent}}function Ilt(i,t,e,r){const n=zC(t,i,r,!0);w9(()=>{PB(r[t],n)},e)}function zC(i,t,e=ks,r=!1){if(e){const n=e[i]||(e[i]=[]),o=t.__weh||(t.__weh=(...s)=>{Cd();const a=ES(e),u=_h(t,e,i,s);return a(),Ed(),u});return r?n.unshift(o):n.push(o),o}}const Nd=i=>(t,e=ks)=>{(!Fw||i==="sp")&&zC(i,(...r)=>t(...r),e)},Mlt=Nd("bm"),k0=Nd("m"),Clt=Nd("bu"),Elt=Nd("u"),BC=Nd("bum"),w9=Nd("um"),Dlt=Nd("sp"),Plt=Nd("rtg"),Llt=Nd("rtc");function Rlt(i,t=ks){zC("ec",i,t)}const S9="components";function Km(i,t){return Olt(S9,i,!0,t)||i}const klt=Symbol.for("v-ndc");function Olt(i,t,e=!0,r=!1){const n=Jl||ks;if(n){const o=n.type;if(i===S9){const a=Sct(o,!1);if(a&&(a===t||a===Rc(t)||a===DC(Rc(t))))return o}const s=UU(n[i]||o[i],t)||UU(n.appContext[i],t);return!s&&r?o:s}}function UU(i,t){return i&&(i[t]||i[Rc(t)]||i[DC(Rc(t))])}function jB(i,t,e,r){let n;const o=e&&e[r],s=Hr(i);if(s||ko(i)){const a=s&&e0(i);let u=!1,f=!1;a&&(u=!Pc(i),f=Ip(i),i=RC(i)),n=new Array(i.length);for(let g=0,v=i.length;g<v;g++)n[g]=t(u?f?nM(gs(i[g])):gs(i[g]):i[g],g,void 0,o&&o[g])}else if(typeof i=="number"){n=new Array(i);for(let a=0;a<i;a++)n[a]=t(a+1,a,void 0,o&&o[a])}else if(Ia(i))if(i[Symbol.iterator])n=Array.from(i,(a,u)=>t(a,u,void 0,o&&o[u]));else{const a=Object.keys(i);n=new Array(a.length);for(let u=0,f=a.length;u<f;u++){const g=a[u];n[u]=t(i[g],g,u,o&&o[u])}}else n=[];return e&&(e[r]=n),n}const Wk=i=>i?H9(i)?VC(i):Wk(i.parent):null,pw=as(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Wk(i.parent),$root:i=>Wk(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>WB(i),$forceUpdate:i=>i.f||(i.f=()=>{GB(i.update)}),$nextTick:i=>i.n||(i.n=UB.bind(i.proxy)),$watch:i=>ict.bind(i)}),HP=(i,t)=>i!==Aa&&!i.__isScriptSetup&&da(i,t),zlt={get({_:i},t){if(t==="__v_skip")return!0;const{ctx:e,setupState:r,data:n,props:o,accessCache:s,type:a,appContext:u}=i;let f;if(t[0]!=="$"){const w=s[t];if(w!==void 0)switch(w){case 1:return r[t];case 2:return n[t];case 4:return e[t];case 3:return o[t]}else{if(HP(r,t))return s[t]=1,r[t];if(n!==Aa&&da(n,t))return s[t]=2,n[t];if((f=i.propsOptions[0])&&da(f,t))return s[t]=3,o[t];if(e!==Aa&&da(e,t))return s[t]=4,e[t];$k&&(s[t]=0)}}const g=pw[t];let v,y;if(g)return t==="$attrs"&&Ls(i.attrs,"get",""),g(i);if((v=a.__cssModules)&&(v=v[t]))return v;if(e!==Aa&&da(e,t))return s[t]=4,e[t];if(y=u.config.globalProperties,da(y,t))return y[t]},set({_:i},t,e){const{data:r,setupState:n,ctx:o}=i;return HP(n,t)?(n[t]=e,!0):r!==Aa&&da(r,t)?(r[t]=e,!0):da(i.props,t)||t[0]==="$"&&t.slice(1)in i?!1:(o[t]=e,!0)},has({_:{data:i,setupState:t,accessCache:e,ctx:r,appContext:n,propsOptions:o,type:s}},a){let u,f;return!!(e[a]||i!==Aa&&a[0]!=="$"&&da(i,a)||HP(t,a)||(u=o[0])&&da(u,a)||da(r,a)||da(pw,a)||da(n.config.globalProperties,a)||(f=s.__cssModules)&&f[a])},defineProperty(i,t,e){return e.get!=null?i._.accessCache[t]=0:da(e,"value")&&this.set(i,t,e.value,null),Reflect.defineProperty(i,t,e)}};function GU(i){return Hr(i)?i.reduce((t,e)=>(t[e]=null,t),{}):i}let $k=!0;function Blt(i){const t=WB(i),e=i.proxy,r=i.ctx;$k=!1,t.beforeCreate&&HU(t.beforeCreate,i,"bc");const{data:n,computed:o,methods:s,watch:a,provide:u,inject:f,created:g,beforeMount:v,mounted:y,beforeUpdate:w,updated:I,activated:E,deactivated:D,beforeDestroy:R,beforeUnmount:z,destroyed:N,unmounted:H,render:$,renderTracked:X,renderTriggered:K,errorCaptured:et,serverPrefetch:rt,expose:lt,inheritAttrs:ht,components:yt,directives:ft,filters:kt}=t;if(f&&Flt(f,r,null),s)for(const Gt in s){const Vt=s[Gt];dn(Vt)&&(r[Gt]=Vt.bind(e))}if(n){const Gt=n.call(e,e);Ia(Gt)&&(i.data=MS(Gt))}if($k=!0,o)for(const Gt in o){const Vt=o[Gt],Qt=dn(Vt)?Vt.bind(e,e):dn(Vt.get)?Vt.get.bind(e,e):lu,fe=!dn(Vt)&&dn(Vt.set)?Vt.set.bind(e):lu,Te=Yl({get:Qt,set:fe});Object.defineProperty(r,Gt,{enumerable:!0,configurable:!0,get:()=>Te.value,set:be=>Te.value=be})}if(a)for(const Gt in a)T9(a[Gt],r,e,Gt);if(u){const Gt=dn(u)?u.call(e):u;Reflect.ownKeys(Gt).forEach(Vt=>{SI(Vt,Gt[Vt])})}g&&HU(g,i,"c");function Ct(Gt,Vt){Hr(Vt)?Vt.forEach(Qt=>Gt(Qt.bind(e))):Vt&&Gt(Vt.bind(e))}if(Ct(Mlt,v),Ct(k0,y),Ct(Clt,w),Ct(Elt,I),Ct(OC,E),Ct(Alt,D),Ct(Rlt,et),Ct(Llt,X),Ct(Plt,K),Ct(BC,z),Ct(w9,H),Ct(Dlt,rt),Hr(lt))if(lt.length){const Gt=i.exposed||(i.exposed={});lt.forEach(Vt=>{Object.defineProperty(Gt,Vt,{get:()=>e[Vt],set:Qt=>e[Vt]=Qt,enumerable:!0})})}else i.exposed||(i.exposed={});$&&i.render===lu&&(i.render=$),ht!=null&&(i.inheritAttrs=ht),yt&&(i.components=yt),ft&&(i.directives=ft),rt&&y9(i)}function Flt(i,t,e=lu){Hr(i)&&(i=Zk(i));for(const r in i){const n=i[r];let o;Ia(n)?"default"in n?o=bd(n.from||r,n.default,!0):o=bd(n.from||r):o=bd(n),zs(o)?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>o.value,set:s=>o.value=s}):t[r]=o}}function HU(i,t,e){_h(Hr(i)?i.map(r=>r.bind(t.proxy)):i.bind(t.proxy),t,e)}function T9(i,t,e,r){let n=r.includes(".")?B9(e,r):()=>e[r];if(ko(i)){const o=t[i];dn(o)&&n0(n,o)}else if(dn(i))n0(n,i.bind(e));else if(Ia(i))if(Hr(i))i.forEach(o=>T9(o,t,e,r));else{const o=dn(i.handler)?i.handler.bind(e):t[i.handler];dn(o)&&n0(n,o,i)}}function WB(i){const t=i.type,{mixins:e,extends:r}=t,{mixins:n,optionsCache:o,config:{optionMergeStrategies:s}}=i.appContext,a=o.get(t);let u;return a?u=a:!n.length&&!e&&!r?u=t:(u={},n.length&&n.forEach(f=>cM(u,f,s,!0)),cM(u,t,s)),Ia(t)&&o.set(t,u),u}function cM(i,t,e,r=!1){const{mixins:n,extends:o}=t;o&&cM(i,o,e,!0),n&&n.forEach(s=>cM(i,s,e,!0));for(const s in t)if(!(r&&s==="expose")){const a=Nlt[s]||e&&e[s];i[s]=a?a(i[s],t[s]):t[s]}return i}const Nlt={data:jU,props:WU,emits:WU,methods:Hb,computed:Hb,beforeCreate:ol,created:ol,beforeMount:ol,mounted:ol,beforeUpdate:ol,updated:ol,beforeDestroy:ol,beforeUnmount:ol,destroyed:ol,unmounted:ol,activated:ol,deactivated:ol,errorCaptured:ol,serverPrefetch:ol,components:Hb,directives:Hb,watch:Ult,provide:jU,inject:Vlt};function jU(i,t){return t?i?function(){return as(dn(i)?i.call(this,this):i,dn(t)?t.call(this,this):t)}:t:i}function Vlt(i,t){return Hb(Zk(i),Zk(t))}function Zk(i){if(Hr(i)){const t={};for(let e=0;e<i.length;e++)t[i[e]]=i[e];return t}return i}function ol(i,t){return i?[...new Set([].concat(i,t))]:t}function Hb(i,t){return i?as(Object.create(null),i,t):t}function WU(i,t){return i?Hr(i)&&Hr(t)?[...new Set([...i,...t])]:as(Object.create(null),GU(i),GU(t??{})):t}function Ult(i,t){if(!i)return t;if(!t)return i;const e=as(Object.create(null),i);for(const r in t)e[r]=ol(i[r],t[r]);return e}function A9(){return{app:null,config:{isNativeTag:G7,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Glt=0;function Hlt(i,t){return function(r,n=null){dn(r)||(r=as({},r)),n!=null&&!Ia(n)&&(n=null);const o=A9(),s=new WeakSet,a=[];let u=!1;const f=o.app={_uid:Glt++,_component:r,_props:n,_container:null,_context:o,_instance:null,version:Act,get config(){return o.config},set config(g){},use(g,...v){return s.has(g)||(g&&dn(g.install)?(s.add(g),g.install(f,...v)):dn(g)&&(s.add(g),g(f,...v))),f},mixin(g){return o.mixins.includes(g)||o.mixins.push(g),f},component(g,v){return v?(o.components[g]=v,f):o.components[g]},directive(g,v){return v?(o.directives[g]=v,f):o.directives[g]},mount(g,v,y){if(!u){const w=f._ceVNode||qn(r,n);return w.appContext=o,y===!0?y="svg":y===!1&&(y=void 0),v&&t?t(w,g):i(w,g,y),u=!0,f._container=g,g.__vue_app__=f,VC(w.component)}},onUnmount(g){a.push(g)},unmount(){u&&(_h(a,f._instance,16),i(null,f._container),delete f._container.__vue_app__)},provide(g,v){return o.provides[g]=v,f},runWithContext(g){const v=r0;r0=f;try{return g()}finally{r0=v}}};return f}}let r0=null;function SI(i,t){if(ks){let e=ks.provides;const r=ks.parent&&ks.parent.provides;r===e&&(e=ks.provides=Object.create(r)),e[i]=t}}function bd(i,t,e=!1){const r=_ct();if(r||r0){let n=r0?r0._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(n&&i in n)return n[i];if(arguments.length>1)return e&&dn(t)?t.call(r&&r.proxy):t}}const I9={},M9=()=>Object.create(I9),C9=i=>Object.getPrototypeOf(i)===I9;function jlt(i,t,e,r=!1){const n={},o=M9();i.propsDefaults=Object.create(null),E9(i,t,n,o);for(const s in i.propsOptions[0])s in n||(n[s]=void 0);e?i.props=r?n:u9(n):i.type.props?i.props=n:i.props=o,i.attrs=o}function Wlt(i,t,e,r){const{props:n,attrs:o,vnode:{patchFlag:s}}=i,a=ha(n),[u]=i.propsOptions;let f=!1;if((r||s>0)&&!(s&16)){if(s&8){const g=i.vnode.dynamicProps;for(let v=0;v<g.length;v++){let y=g[v];if(FC(i.emitsOptions,y))continue;const w=t[y];if(u)if(da(o,y))w!==o[y]&&(o[y]=w,f=!0);else{const I=Rc(y);n[I]=qk(u,a,I,w,i,!1)}else w!==o[y]&&(o[y]=w,f=!0)}}}else{E9(i,t,n,o)&&(f=!0);let g;for(const v in a)(!t||!da(t,v)&&((g=Fp(v))===v||!da(t,g)))&&(u?e&&(e[v]!==void 0||e[g]!==void 0)&&(n[v]=qk(u,a,v,void 0,i,!0)):delete n[v]);if(o!==a)for(const v in o)(!t||!da(t,v))&&(delete o[v],f=!0)}f&&dd(i.attrs,"set","")}function E9(i,t,e,r){const[n,o]=i.propsOptions;let s=!1,a;if(t)for(let u in t){if(cw(u))continue;const f=t[u];let g;n&&da(n,g=Rc(u))?!o||!o.includes(g)?e[g]=f:(a||(a={}))[g]=f:FC(i.emitsOptions,u)||(!(u in r)||f!==r[u])&&(r[u]=f,s=!0)}if(o){const u=ha(e),f=a||Aa;for(let g=0;g<o.length;g++){const v=o[g];e[v]=qk(n,u,v,f[v],i,!da(f,v))}}return s}function qk(i,t,e,r,n,o){const s=i[e];if(s!=null){const a=da(s,"default");if(a&&r===void 0){const u=s.default;if(s.type!==Function&&!s.skipFactory&&dn(u)){const{propsDefaults:f}=n;if(e in f)r=f[e];else{const g=ES(n);r=f[e]=u.call(null,t),g()}}else r=u;n.ce&&n.ce._setProp(e,r)}s[0]&&(o&&!a?r=!1:s[1]&&(r===""||r===Fp(e))&&(r=!0))}return r}const $lt=new WeakMap;function D9(i,t,e=!1){const r=e?$lt:t.propsCache,n=r.get(i);if(n)return n;const o=i.props,s={},a=[];let u=!1;if(!dn(i)){const g=v=>{u=!0;const[y,w]=D9(v,t,!0);as(s,y),w&&a.push(...w)};!e&&t.mixins.length&&t.mixins.forEach(g),i.extends&&g(i.extends),i.mixins&&i.mixins.forEach(g)}if(!o&&!u)return Ia(i)&&r.set(i,Qy),Qy;if(Hr(o))for(let g=0;g<o.length;g++){const v=Rc(o[g]);$U(v)&&(s[v]=Aa)}else if(o)for(const g in o){const v=Rc(g);if($U(v)){const y=o[g],w=s[v]=Hr(y)||dn(y)?{type:y}:as({},y),I=w.type;let E=!1,D=!0;if(Hr(I))for(let R=0;R<I.length;++R){const z=I[R],N=dn(z)&&z.name;if(N==="Boolean"){E=!0;break}else N==="String"&&(D=!1)}else E=dn(I)&&I.name==="Boolean";w[0]=E,w[1]=D,(E||da(w,"default"))&&a.push(v)}}const f=[s,a];return Ia(i)&&r.set(i,f),f}function $U(i){return i[0]!=="$"&&!cw(i)}const $B=i=>i==="_"||i==="_ctx"||i==="$stable",ZB=i=>Hr(i)?i.map(ih):[ih(i)],Zlt=(i,t,e)=>{if(t._n)return t;const r=jo((...n)=>ZB(t(...n)),e);return r._c=!1,r},P9=(i,t,e)=>{const r=i._ctx;for(const n in i){if($B(n))continue;const o=i[n];if(dn(o))t[n]=Zlt(n,o,r);else if(o!=null){const s=ZB(o);t[n]=()=>s}}},L9=(i,t)=>{const e=ZB(t);i.slots.default=()=>e},R9=(i,t,e)=>{for(const r in t)(e||!$B(r))&&(i[r]=t[r])},qlt=(i,t,e)=>{const r=i.slots=M9();if(i.vnode.shapeFlag&32){const n=t._;n?(R9(r,t,e),e&&$7(r,"_",n,!0)):P9(t,r)}else t&&L9(i,t)},Xlt=(i,t,e)=>{const{vnode:r,slots:n}=i;let o=!0,s=Aa;if(r.shapeFlag&32){const a=t._;a?e&&a===1?o=!1:R9(n,t,e):(o=!t.$stable,P9(t,n)),s=t}else t&&(L9(i,t),s={default:1});if(o)for(const a in n)!$B(a)&&s[a]==null&&delete n[a]},Wl=uct;function Ylt(i){return Klt(i)}function Klt(i,t){const e=LC();e.__VUE__=!0;const{insert:r,remove:n,patchProp:o,createElement:s,createText:a,createComment:u,setText:f,setElementText:g,parentNode:v,nextSibling:y,setScopeId:w=lu,insertStaticContent:I}=i,E=(zt,Zt,pe,$e=null,He=null,qe=null,Ti=void 0,Ai=null,_i=!!Zt.dynamicChildren)=>{if(zt===Zt)return;zt&&!nb(zt,Zt)&&($e=Ve(zt),be(zt,He,qe,!0),zt=null),Zt.patchFlag===-2&&(_i=!1,Zt.dynamicChildren=null);const{type:pi,ref:yr,shapeFlag:Li}=Zt;switch(pi){case NC:D(zt,Zt,pe,$e);break;case Mp:R(zt,Zt,pe,$e);break;case TI:zt==null&&z(Zt,pe,$e,Ti);break;case Xl:yt(zt,Zt,pe,$e,He,qe,Ti,Ai,_i);break;default:Li&1?$(zt,Zt,pe,$e,He,qe,Ti,Ai,_i):Li&6?ft(zt,Zt,pe,$e,He,qe,Ti,Ai,_i):(Li&64||Li&128)&&pi.process(zt,Zt,pe,$e,He,qe,Ti,Ai,_i,Ke)}yr!=null&&He?dw(yr,zt&&zt.ref,qe,Zt||zt,!Zt):yr==null&&zt&&zt.ref!=null&&dw(zt.ref,null,qe,zt,!0)},D=(zt,Zt,pe,$e)=>{if(zt==null)r(Zt.el=a(Zt.children),pe,$e);else{const He=Zt.el=zt.el;Zt.children!==zt.children&&f(He,Zt.children)}},R=(zt,Zt,pe,$e)=>{zt==null?r(Zt.el=u(Zt.children||""),pe,$e):Zt.el=zt.el},z=(zt,Zt,pe,$e)=>{[zt.el,zt.anchor]=I(zt.children,Zt,pe,$e,zt.el,zt.anchor)},N=({el:zt,anchor:Zt},pe,$e)=>{let He;for(;zt&&zt!==Zt;)He=y(zt),r(zt,pe,$e),zt=He;r(Zt,pe,$e)},H=({el:zt,anchor:Zt})=>{let pe;for(;zt&&zt!==Zt;)pe=y(zt),n(zt),zt=pe;n(Zt)},$=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i)=>{if(Zt.type==="svg"?Ti="svg":Zt.type==="math"&&(Ti="mathml"),zt==null)X(Zt,pe,$e,He,qe,Ti,Ai,_i);else{const pi=zt.el&&zt.el._isVueCE?zt.el:null;try{pi&&pi._beginPatch(),rt(zt,Zt,He,qe,Ti,Ai,_i)}finally{pi&&pi._endPatch()}}},X=(zt,Zt,pe,$e,He,qe,Ti,Ai)=>{let _i,pi;const{props:yr,shapeFlag:Li,transition:hr,dirs:xr}=zt;if(_i=zt.el=s(zt.type,qe,yr&&yr.is,yr),Li&8?g(_i,zt.children):Li&16&&et(zt.children,_i,null,$e,He,jP(zt,qe),Ti,Ai),xr&&Zg(zt,null,$e,"created"),K(_i,zt,zt.scopeId,Ti,$e),yr){for(const On in yr)On!=="value"&&!cw(On)&&o(_i,On,null,yr[On],qe,$e);"value"in yr&&o(_i,"value",null,yr.value,qe),(pi=yr.onVnodeBeforeMount)&&Uu(pi,$e,zt)}xr&&Zg(zt,null,$e,"beforeMount");const tn=Jlt(He,hr);tn&&hr.beforeEnter(_i),r(_i,Zt,pe),((pi=yr&&yr.onVnodeMounted)||tn||xr)&&Wl(()=>{pi&&Uu(pi,$e,zt),tn&&hr.enter(_i),xr&&Zg(zt,null,$e,"mounted")},He)},K=(zt,Zt,pe,$e,He)=>{if(pe&&w(zt,pe),$e)for(let qe=0;qe<$e.length;qe++)w(zt,$e[qe]);if(He){let qe=He.subTree;if(Zt===qe||N9(qe.type)&&(qe.ssContent===Zt||qe.ssFallback===Zt)){const Ti=He.vnode;K(zt,Ti,Ti.scopeId,Ti.slotScopeIds,He.parent)}}},et=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i=0)=>{for(let pi=_i;pi<zt.length;pi++){const yr=zt[pi]=Ai?Jf(zt[pi]):ih(zt[pi]);E(null,yr,Zt,pe,$e,He,qe,Ti,Ai)}},rt=(zt,Zt,pe,$e,He,qe,Ti)=>{const Ai=Zt.el=zt.el;let{patchFlag:_i,dynamicChildren:pi,dirs:yr}=Zt;_i|=zt.patchFlag&16;const Li=zt.props||Aa,hr=Zt.props||Aa;let xr;if(pe&&qg(pe,!1),(xr=hr.onVnodeBeforeUpdate)&&Uu(xr,pe,Zt,zt),yr&&Zg(Zt,zt,pe,"beforeUpdate"),pe&&qg(pe,!0),(Li.innerHTML&&hr.innerHTML==null||Li.textContent&&hr.textContent==null)&&g(Ai,""),pi?lt(zt.dynamicChildren,pi,Ai,pe,$e,jP(Zt,He),qe):Ti||Vt(zt,Zt,Ai,null,pe,$e,jP(Zt,He),qe,!1),_i>0){if(_i&16)ht(Ai,Li,hr,pe,He);else if(_i&2&&Li.class!==hr.class&&o(Ai,"class",null,hr.class,He),_i&4&&o(Ai,"style",Li.style,hr.style,He),_i&8){const tn=Zt.dynamicProps;for(let On=0;On<tn.length;On++){const Kr=tn[On],Ua=Li[Kr],ga=hr[Kr];(ga!==Ua||Kr==="value")&&o(Ai,Kr,Ua,ga,He,pe)}}_i&1&&zt.children!==Zt.children&&g(Ai,Zt.children)}else!Ti&&pi==null&&ht(Ai,Li,hr,pe,He);((xr=hr.onVnodeUpdated)||yr)&&Wl(()=>{xr&&Uu(xr,pe,Zt,zt),yr&&Zg(Zt,zt,pe,"updated")},$e)},lt=(zt,Zt,pe,$e,He,qe,Ti)=>{for(let Ai=0;Ai<Zt.length;Ai++){const _i=zt[Ai],pi=Zt[Ai],yr=_i.el&&(_i.type===Xl||!nb(_i,pi)||_i.shapeFlag&198)?v(_i.el):pe;E(_i,pi,yr,null,$e,He,qe,Ti,!0)}},ht=(zt,Zt,pe,$e,He)=>{if(Zt!==pe){if(Zt!==Aa)for(const qe in Zt)!cw(qe)&&!(qe in pe)&&o(zt,qe,Zt[qe],null,He,$e);for(const qe in pe){if(cw(qe))continue;const Ti=pe[qe],Ai=Zt[qe];Ti!==Ai&&qe!=="value"&&o(zt,qe,Ai,Ti,He,$e)}"value"in pe&&o(zt,"value",Zt.value,pe.value,He)}},yt=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i)=>{const pi=Zt.el=zt?zt.el:a(""),yr=Zt.anchor=zt?zt.anchor:a("");let{patchFlag:Li,dynamicChildren:hr,slotScopeIds:xr}=Zt;xr&&(Ai=Ai?Ai.concat(xr):xr),zt==null?(r(pi,pe,$e),r(yr,pe,$e),et(Zt.children||[],pe,yr,He,qe,Ti,Ai,_i)):Li>0&&Li&64&&hr&&zt.dynamicChildren?(lt(zt.dynamicChildren,hr,pe,He,qe,Ti,Ai),(Zt.key!=null||He&&Zt===He.subTree)&&k9(zt,Zt,!0)):Vt(zt,Zt,pe,yr,He,qe,Ti,Ai,_i)},ft=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i)=>{Zt.slotScopeIds=Ai,zt==null?Zt.shapeFlag&512?He.ctx.activate(Zt,pe,$e,Ti,_i):kt(Zt,pe,$e,He,qe,Ti,_i):Rt(zt,Zt,_i)},kt=(zt,Zt,pe,$e,He,qe,Ti)=>{const Ai=zt.component=vct(zt,$e,He);if(x9(zt)&&(Ai.ctx.renderer=Ke),yct(Ai,!1,Ti),Ai.asyncDep){if(He&&He.registerDep(Ai,Ct,Ti),!zt.el){const _i=Ai.subTree=qn(Mp);R(null,_i,Zt,pe),zt.placeholder=_i.el}}else Ct(Ai,zt,Zt,pe,He,qe,Ti)},Rt=(zt,Zt,pe)=>{const $e=Zt.component=zt.component;if(lct(zt,Zt,pe))if($e.asyncDep&&!$e.asyncResolved){Gt($e,Zt,pe);return}else $e.next=Zt,$e.update();else Zt.el=zt.el,$e.vnode=Zt},Ct=(zt,Zt,pe,$e,He,qe,Ti)=>{const Ai=()=>{if(zt.isMounted){let{next:Li,bu:hr,u:xr,parent:tn,vnode:On}=zt;{const Ka=O9(zt);if(Ka){Li&&(Li.el=On.el,Gt(zt,Li,Ti)),Ka.asyncDep.then(()=>{zt.isUnmounted||Ai()});return}}let Kr=Li,Ua;qg(zt,!1),Li?(Li.el=On.el,Gt(zt,Li,Ti)):Li=On,hr&&wI(hr),(Ua=Li.props&&Li.props.onVnodeBeforeUpdate)&&Uu(Ua,tn,Li,On),qg(zt,!0);const ga=WP(zt),So=zt.subTree;zt.subTree=ga,E(So,ga,v(So.el),Ve(So),zt,He,qe),Li.el=ga.el,Kr===null&&cct(zt,ga.el),xr&&Wl(xr,He),(Ua=Li.props&&Li.props.onVnodeUpdated)&&Wl(()=>Uu(Ua,tn,Li,On),He)}else{let Li;const{el:hr,props:xr}=Zt,{bm:tn,m:On,parent:Kr,root:Ua,type:ga}=zt,So=fw(Zt);if(qg(zt,!1),tn&&wI(tn),!So&&(Li=xr&&xr.onVnodeBeforeMount)&&Uu(Li,Kr,Zt),qg(zt,!0),hr&&Si){const Ka=()=>{zt.subTree=WP(zt),Si(hr,zt.subTree,zt,He,null)};So&&ga.__asyncHydrate?ga.__asyncHydrate(hr,zt,Ka):Ka()}else{Ua.ce&&Ua.ce._def.shadowRoot!==!1&&Ua.ce._injectChildStyle(ga);const Ka=zt.subTree=WP(zt);E(null,Ka,pe,$e,zt,He,qe),Zt.el=Ka.el}if(On&&Wl(On,He),!So&&(Li=xr&&xr.onVnodeMounted)){const Ka=Zt;Wl(()=>Uu(Li,Kr,Ka),He)}(Zt.shapeFlag&256||Kr&&fw(Kr.vnode)&&Kr.vnode.shapeFlag&256)&&zt.a&&Wl(zt.a,He),zt.isMounted=!0,Zt=pe=$e=null}};zt.scope.on();const _i=zt.effect=new Y7(Ai);zt.scope.off();const pi=zt.update=_i.run.bind(_i),yr=zt.job=_i.runIfDirty.bind(_i);yr.i=zt,yr.id=zt.uid,_i.scheduler=()=>GB(yr),qg(zt,!0),pi()},Gt=(zt,Zt,pe)=>{Zt.component=zt;const $e=zt.vnode.props;zt.vnode=Zt,zt.next=null,Wlt(zt,Zt.props,$e,pe),Xlt(zt,Zt.children,pe),Cd(),NU(zt),Ed()},Vt=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i=!1)=>{const pi=zt&&zt.children,yr=zt?zt.shapeFlag:0,Li=Zt.children,{patchFlag:hr,shapeFlag:xr}=Zt;if(hr>0){if(hr&128){fe(pi,Li,pe,$e,He,qe,Ti,Ai,_i);return}else if(hr&256){Qt(pi,Li,pe,$e,He,qe,Ti,Ai,_i);return}}xr&8?(yr&16&&or(pi,He,qe),Li!==pi&&g(pe,Li)):yr&16?xr&16?fe(pi,Li,pe,$e,He,qe,Ti,Ai,_i):or(pi,He,qe,!0):(yr&8&&g(pe,""),xr&16&&et(Li,pe,$e,He,qe,Ti,Ai,_i))},Qt=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i)=>{zt=zt||Qy,Zt=Zt||Qy;const pi=zt.length,yr=Zt.length,Li=Math.min(pi,yr);let hr;for(hr=0;hr<Li;hr++){const xr=Zt[hr]=_i?Jf(Zt[hr]):ih(Zt[hr]);E(zt[hr],xr,pe,null,He,qe,Ti,Ai,_i)}pi>yr?or(zt,He,qe,!0,!1,Li):et(Zt,pe,$e,He,qe,Ti,Ai,_i,Li)},fe=(zt,Zt,pe,$e,He,qe,Ti,Ai,_i)=>{let pi=0;const yr=Zt.length;let Li=zt.length-1,hr=yr-1;for(;pi<=Li&&pi<=hr;){const xr=zt[pi],tn=Zt[pi]=_i?Jf(Zt[pi]):ih(Zt[pi]);if(nb(xr,tn))E(xr,tn,pe,null,He,qe,Ti,Ai,_i);else break;pi++}for(;pi<=Li&&pi<=hr;){const xr=zt[Li],tn=Zt[hr]=_i?Jf(Zt[hr]):ih(Zt[hr]);if(nb(xr,tn))E(xr,tn,pe,null,He,qe,Ti,Ai,_i);else break;Li--,hr--}if(pi>Li){if(pi<=hr){const xr=hr+1,tn=xr<yr?Zt[xr].el:$e;for(;pi<=hr;)E(null,Zt[pi]=_i?Jf(Zt[pi]):ih(Zt[pi]),pe,tn,He,qe,Ti,Ai,_i),pi++}}else if(pi>hr)for(;pi<=Li;)be(zt[pi],He,qe,!0),pi++;else{const xr=pi,tn=pi,On=new Map;for(pi=tn;pi<=hr;pi++){const Ja=Zt[pi]=_i?Jf(Zt[pi]):ih(Zt[pi]);Ja.key!=null&&On.set(Ja.key,pi)}let Kr,Ua=0;const ga=hr-tn+1;let So=!1,Ka=0;const Jn=new Array(ga);for(pi=0;pi<ga;pi++)Jn[pi]=0;for(pi=xr;pi<=Li;pi++){const Ja=zt[pi];if(Ua>=ga){be(Ja,He,qe,!0);continue}let Qa;if(Ja.key!=null)Qa=On.get(Ja.key);else for(Kr=tn;Kr<=hr;Kr++)if(Jn[Kr-tn]===0&&nb(Ja,Zt[Kr])){Qa=Kr;break}Qa===void 0?be(Ja,He,qe,!0):(Jn[Qa-tn]=pi+1,Qa>=Ka?Ka=Qa:So=!0,E(Ja,Zt[Qa],pe,null,He,qe,Ti,Ai,_i),Ua++)}const oc=So?Qlt(Jn):Qy;for(Kr=oc.length-1,pi=ga-1;pi>=0;pi--){const Ja=tn+pi,Qa=Zt[Ja],xs=Zt[Ja+1],ss=Ja+1<yr?xs.el||xs.placeholder:$e;Jn[pi]===0?E(null,Qa,pe,ss,He,qe,Ti,Ai,_i):So&&(Kr<0||pi!==oc[Kr]?Te(Qa,pe,ss,2):Kr--)}}},Te=(zt,Zt,pe,$e,He=null)=>{const{el:qe,type:Ti,transition:Ai,children:_i,shapeFlag:pi}=zt;if(pi&6){Te(zt.component.subTree,Zt,pe,$e);return}if(pi&128){zt.suspense.move(Zt,pe,$e);return}if(pi&64){Ti.move(zt,Zt,pe,Ke);return}if(Ti===Xl){r(qe,Zt,pe);for(let Li=0;Li<_i.length;Li++)Te(_i[Li],Zt,pe,$e);r(zt.anchor,Zt,pe);return}if(Ti===TI){N(zt,Zt,pe);return}if($e!==2&&pi&1&&Ai)if($e===0)Ai.beforeEnter(qe),r(qe,Zt,pe),Wl(()=>Ai.enter(qe),He);else{const{leave:Li,delayLeave:hr,afterLeave:xr}=Ai,tn=()=>{zt.ctx.isUnmounted?n(qe):r(qe,Zt,pe)},On=()=>{qe._isLeaving&&qe[Tlt](!0),Li(qe,()=>{tn(),xr&&xr()})};hr?hr(qe,tn,On):On()}else r(qe,Zt,pe)},be=(zt,Zt,pe,$e=!1,He=!1)=>{const{type:qe,props:Ti,ref:Ai,children:_i,dynamicChildren:pi,shapeFlag:yr,patchFlag:Li,dirs:hr,cacheIndex:xr}=zt;if(Li===-2&&(He=!1),Ai!=null&&(Cd(),dw(Ai,null,pe,zt,!0),Ed()),xr!=null&&(Zt.renderCache[xr]=void 0),yr&256){Zt.ctx.deactivate(zt);return}const tn=yr&1&&hr,On=!fw(zt);let Kr;if(On&&(Kr=Ti&&Ti.onVnodeBeforeUnmount)&&Uu(Kr,Zt,zt),yr&6)Pi(zt.component,pe,$e);else{if(yr&128){zt.suspense.unmount(pe,$e);return}tn&&Zg(zt,null,Zt,"beforeUnmount"),yr&64?zt.type.remove(zt,Zt,pe,Ke,$e):pi&&!pi.hasOnce&&(qe!==Xl||Li>0&&Li&64)?or(pi,Zt,pe,!1,!0):(qe===Xl&&Li&384||!He&&yr&16)&&or(_i,Zt,pe),$e&&Ge(zt)}(On&&(Kr=Ti&&Ti.onVnodeUnmounted)||tn)&&Wl(()=>{Kr&&Uu(Kr,Zt,zt),tn&&Zg(zt,null,Zt,"unmounted")},pe)},Ge=zt=>{const{type:Zt,el:pe,anchor:$e,transition:He}=zt;if(Zt===Xl){li(pe,$e);return}if(Zt===TI){H(zt);return}const qe=()=>{n(pe),He&&!He.persisted&&He.afterLeave&&He.afterLeave()};if(zt.shapeFlag&1&&He&&!He.persisted){const{leave:Ti,delayLeave:Ai}=He,_i=()=>Ti(pe,qe);Ai?Ai(zt.el,qe,_i):_i()}else qe()},li=(zt,Zt)=>{let pe;for(;zt!==Zt;)pe=y(zt),n(zt),zt=pe;n(Zt)},Pi=(zt,Zt,pe)=>{const{bum:$e,scope:He,job:qe,subTree:Ti,um:Ai,m:_i,a:pi}=zt;ZU(_i),ZU(pi),$e&&wI($e),He.stop(),qe&&(qe.flags|=8,be(Ti,zt,Zt,pe)),Ai&&Wl(Ai,Zt),Wl(()=>{zt.isUnmounted=!0},Zt)},or=(zt,Zt,pe,$e=!1,He=!1,qe=0)=>{for(let Ti=qe;Ti<zt.length;Ti++)be(zt[Ti],Zt,pe,$e,He)},Ve=zt=>{if(zt.shapeFlag&6)return Ve(zt.component.subTree);if(zt.shapeFlag&128)return zt.suspense.next();const Zt=y(zt.anchor||zt.el),pe=Zt&&Zt[wlt];return pe?y(pe):Zt};let Ze=!1;const ye=(zt,Zt,pe)=>{zt==null?Zt._vnode&&be(Zt._vnode,null,null,!0):E(Zt._vnode||null,zt,Zt,null,null,null,pe),Zt._vnode=zt,Ze||(Ze=!0,NU(),g9(),Ze=!1)},Ke={p:E,um:be,m:Te,r:Ge,mt:kt,mc:et,pc:Vt,pbc:lt,n:Ve,o:i};let We,Si;return t&&([We,Si]=t(Ke)),{render:ye,hydrate:We,createApp:Hlt(ye,We)}}function jP({type:i,props:t},e){return e==="svg"&&i==="foreignObject"||e==="mathml"&&i==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:e}function qg({effect:i,job:t},e){e?(i.flags|=32,t.flags|=4):(i.flags&=-33,t.flags&=-5)}function Jlt(i,t){return(!i||i&&!i.pendingBranch)&&t&&!t.persisted}function k9(i,t,e=!1){const r=i.children,n=t.children;if(Hr(r)&&Hr(n))for(let o=0;o<r.length;o++){const s=r[o];let a=n[o];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[o]=Jf(n[o]),a.el=s.el),!e&&a.patchFlag!==-2&&k9(s,a)),a.type===NC&&a.patchFlag!==-1&&(a.el=s.el),a.type===Mp&&!a.el&&(a.el=s.el)}}function Qlt(i){const t=i.slice(),e=[0];let r,n,o,s,a;const u=i.length;for(r=0;r<u;r++){const f=i[r];if(f!==0){if(n=e[e.length-1],i[n]<f){t[r]=n,e.push(r);continue}for(o=0,s=e.length-1;o<s;)a=o+s>>1,i[e[a]]<f?o=a+1:s=a;f<i[e[o]]&&(o>0&&(t[r]=e[o-1]),e[o]=r)}}for(o=e.length,s=e[o-1];o-- >0;)e[o]=s,s=t[s];return e}function O9(i){const t=i.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:O9(t)}function ZU(i){if(i)for(let t=0;t<i.length;t++)i[t].flags|=8}const tct=Symbol.for("v-scx"),ect=()=>bd(tct);function n0(i,t,e){return z9(i,t,e)}function z9(i,t,e=Aa){const{immediate:r,deep:n,flush:o,once:s}=e,a=as({},e),u=t&&r||!t&&o!=="post";let f;if(Fw){if(o==="sync"){const w=ect();f=w.__watcherHandles||(w.__watcherHandles=[])}else if(!u){const w=()=>{};return w.stop=lu,w.resume=lu,w.pause=lu,w}}const g=ks;a.call=(w,I,E)=>_h(w,g,I,E);let v=!1;o==="post"?a.scheduler=w=>{Wl(w,g&&g.suspense)}:o!=="sync"&&(v=!0,a.scheduler=(w,I)=>{I?w():GB(w)}),a.augmentJob=w=>{t&&(w.flags|=4),v&&(w.flags|=2,g&&(w.id=g.uid,w.i=g))};const y=_lt(i,t,a);return Fw&&(f?f.push(y):u&&y()),y}function ict(i,t,e){const r=this.proxy,n=ko(i)?i.includes(".")?B9(r,i):()=>r[i]:i.bind(r,r);let o;dn(t)?o=t:(o=t.handler,e=t);const s=ES(this),a=z9(n,o.bind(r),e);return s(),a}function B9(i,t){const e=t.split(".");return()=>{let r=i;for(let n=0;n<e.length&&r;n++)r=r[e[n]];return r}}const rct=(i,t)=>t==="modelValue"||t==="model-value"?i.modelModifiers:i[`${t}Modifiers`]||i[`${Rc(t)}Modifiers`]||i[`${Fp(t)}Modifiers`];function nct(i,t,...e){if(i.isUnmounted)return;const r=i.vnode.props||Aa;let n=e;const o=t.startsWith("update:"),s=o&&rct(r,t.slice(7));s&&(s.trim&&(n=e.map(g=>ko(g)?g.trim():g)),s.number&&(n=e.map(PC)));let a,u=r[a=FP(t)]||r[a=FP(Rc(t))];!u&&o&&(u=r[a=FP(Fp(t))]),u&&_h(u,i,6,n);const f=r[a+"Once"];if(f){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,_h(f,i,6,n)}}const act=new WeakMap;function F9(i,t,e=!1){const r=e?act:t.emitsCache,n=r.get(i);if(n!==void 0)return n;const o=i.emits;let s={},a=!1;if(!dn(i)){const u=f=>{const g=F9(f,t,!0);g&&(a=!0,as(s,g))};!e&&t.mixins.length&&t.mixins.forEach(u),i.extends&&u(i.extends),i.mixins&&i.mixins.forEach(u)}return!o&&!a?(Ia(i)&&r.set(i,null),null):(Hr(o)?o.forEach(u=>s[u]=null):as(s,o),Ia(i)&&r.set(i,s),s)}function FC(i,t){return!i||!CC(t)?!1:(t=t.slice(2).replace(/Once$/,""),da(i,t[0].toLowerCase()+t.slice(1))||da(i,Fp(t))||da(i,t))}function WP(i){const{type:t,vnode:e,proxy:r,withProxy:n,propsOptions:[o],slots:s,attrs:a,emit:u,render:f,renderCache:g,props:v,data:y,setupState:w,ctx:I,inheritAttrs:E}=i,D=sM(i);let R,z;try{if(e.shapeFlag&4){const H=n||r,$=H;R=ih(f.call($,H,g,v,w,y,I)),z=a}else{const H=t;R=ih(H.length>1?H(v,{attrs:a,slots:s,emit:u}):H(v,null)),z=t.props?a:oct(a)}}catch(H){gw.length=0,kC(H,i,1),R=qn(Mp)}let N=R;if(z&&E!==!1){const H=Object.keys(z),{shapeFlag:$}=N;H.length&&$&7&&(o&&H.some(DB)&&(z=sct(z,o)),N=h0(N,z,!1,!0))}return e.dirs&&(N=h0(N,null,!1,!0),N.dirs=N.dirs?N.dirs.concat(e.dirs):e.dirs),e.transition&&HB(N,e.transition),R=N,sM(D),R}const oct=i=>{let t;for(const e in i)(e==="class"||e==="style"||CC(e))&&((t||(t={}))[e]=i[e]);return t},sct=(i,t)=>{const e={};for(const r in i)(!DB(r)||!(r.slice(9)in t))&&(e[r]=i[r]);return e};function lct(i,t,e){const{props:r,children:n,component:o}=i,{props:s,children:a,patchFlag:u}=t,f=o.emitsOptions;if(t.dirs||t.transition)return!0;if(e&&u>=0){if(u&1024)return!0;if(u&16)return r?qU(r,s,f):!!s;if(u&8){const g=t.dynamicProps;for(let v=0;v<g.length;v++){const y=g[v];if(s[y]!==r[y]&&!FC(f,y))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:r===s?!1:r?s?qU(r,s,f):!0:!!s;return!1}function qU(i,t,e){const r=Object.keys(t);if(r.length!==Object.keys(i).length)return!0;for(let n=0;n<r.length;n++){const o=r[n];if(t[o]!==i[o]&&!FC(e,o))return!0}return!1}function cct({vnode:i,parent:t},e){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===i&&(r.el=i.el),r===i)(i=t.vnode).el=e,t=t.parent;else break}}const N9=i=>i.__isSuspense;function uct(i,t){t&&t.pendingBranch?Hr(i)?t.effects.push(...i):t.effects.push(i):blt(i)}const Xl=Symbol.for("v-fgt"),NC=Symbol.for("v-txt"),Mp=Symbol.for("v-cmt"),TI=Symbol.for("v-stc"),gw=[];let Ql=null;function Wo(i=!1){gw.push(Ql=i?null:[])}function hct(){gw.pop(),Ql=gw[gw.length-1]||null}let Bw=1;function uM(i,t=!1){Bw+=i,i<0&&Ql&&t&&(Ql.hasOnce=!0)}function V9(i){return i.dynamicChildren=Bw>0?Ql||Qy:null,hct(),Bw>0&&Ql&&Ql.push(i),i}function ms(i,t,e,r,n,o){return V9(ve(i,t,e,r,n,o,!0))}function U9(i,t,e,r,n){return V9(qn(i,t,e,r,n,!0))}function hM(i){return i?i.__v_isVNode===!0:!1}function nb(i,t){return i.type===t.type&&i.key===t.key}const G9=({key:i})=>i??null,AI=({ref:i,ref_key:t,ref_for:e})=>(typeof i=="number"&&(i=""+i),i!=null?ko(i)||zs(i)||dn(i)?{i:Jl,r:i,k:t,f:!!e}:i:null);function ve(i,t=null,e=null,r=0,n=null,o=i===Xl?0:1,s=!1,a=!1){const u={__v_isVNode:!0,__v_skip:!0,type:i,props:t,key:t&&G9(t),ref:t&&AI(t),scopeId:v9,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:r,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Jl};return a?(qB(u,e),o&128&&i.normalize(u)):e&&(u.shapeFlag|=ko(e)?8:16),Bw>0&&!s&&Ql&&(u.patchFlag>0||o&6)&&u.patchFlag!==32&&Ql.push(u),u}const qn=dct;function dct(i,t=null,e=null,r=0,n=null,o=!1){if((!i||i===klt)&&(i=Mp),hM(i)){const a=h0(i,t,!0);return e&&qB(a,e),Bw>0&&!o&&Ql&&(a.shapeFlag&6?Ql[Ql.indexOf(i)]=a:Ql.push(a)),a.patchFlag=-2,a}if(Tct(i)&&(i=i.__vccOpts),t){t=fct(t);let{class:a,style:u}=t;a&&!ko(a)&&(t.class=gd(a)),Ia(u)&&(VB(u)&&!Hr(u)&&(u=as({},u)),t.style=R0(u))}const s=ko(i)?1:N9(i)?128:Slt(i)?64:Ia(i)?4:dn(i)?2:0;return ve(i,t,e,r,n,s,o,!0)}function fct(i){return i?VB(i)||C9(i)?as({},i):i:null}function h0(i,t,e=!1,r=!1){const{props:n,ref:o,patchFlag:s,children:a,transition:u}=i,f=t?pct(n||{},t):n,g={__v_isVNode:!0,__v_skip:!0,type:i.type,props:f,key:f&&G9(f),ref:t&&t.ref?e&&o?Hr(o)?o.concat(AI(t)):[o,AI(t)]:AI(t):o,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:t&&i.type!==Xl?s===-1?16:s|16:s,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:u,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&h0(i.ssContent),ssFallback:i.ssFallback&&h0(i.ssFallback),placeholder:i.placeholder,el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return u&&r&&HB(g,u.clone(g)),g}function Gn(i=" ",t=0){return qn(NC,null,i,t)}function Kf(i,t){const e=qn(TI,null,i);return e.staticCount=t,e}function dM(i="",t=!1){return t?(Wo(),U9(Mp,null,i)):qn(Mp,null,i)}function ih(i){return i==null||typeof i=="boolean"?qn(Mp):Hr(i)?qn(Xl,null,i.slice()):hM(i)?Jf(i):qn(NC,null,String(i))}function Jf(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:h0(i)}function qB(i,t){let e=0;const{shapeFlag:r}=i;if(t==null)t=null;else if(Hr(t))e=16;else if(typeof t=="object")if(r&65){const n=t.default;n&&(n._c&&(n._d=!1),qB(i,n()),n._c&&(n._d=!0));return}else{e=32;const n=t._;!n&&!C9(t)?t._ctx=Jl:n===3&&Jl&&(Jl.slots._===1?t._=1:(t._=2,i.patchFlag|=1024))}else dn(t)?(t={default:t,_ctx:Jl},e=32):(t=String(t),r&64?(e=16,t=[Gn(t)]):e=8);i.children=t,i.shapeFlag|=e}function pct(...i){const t={};for(let e=0;e<i.length;e++){const r=i[e];for(const n in r)if(n==="class")t.class!==r.class&&(t.class=gd([t.class,r.class]));else if(n==="style")t.style=R0([t.style,r.style]);else if(CC(n)){const o=t[n],s=r[n];s&&o!==s&&!(Hr(o)&&o.includes(s))&&(t[n]=o?[].concat(o,s):s)}else n!==""&&(t[n]=r[n])}return t}function Uu(i,t,e,r=null){_h(i,t,7,[e,r])}const gct=A9();let mct=0;function vct(i,t,e){const r=i.type,n=(t?t.appContext:i.appContext)||gct,o={uid:mct++,vnode:i,type:r,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Wst(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:D9(r,n),emitsOptions:F9(r,n),emit:null,emitted:null,propsDefaults:Aa,inheritAttrs:r.inheritAttrs,ctx:Aa,data:Aa,props:Aa,attrs:Aa,slots:Aa,refs:Aa,setupState:Aa,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=t?t.root:o,o.emit=nct.bind(null,o),i.ce&&i.ce(o),o}let ks=null;const _ct=()=>ks||Jl;let fM,Xk;{const i=LC(),t=(e,r)=>{let n;return(n=i[e])||(n=i[e]=[]),n.push(r),o=>{n.length>1?n.forEach(s=>s(o)):n[0](o)}};fM=t("__VUE_INSTANCE_SETTERS__",e=>ks=e),Xk=t("__VUE_SSR_SETTERS__",e=>Fw=e)}const ES=i=>{const t=ks;return fM(i),i.scope.on(),()=>{i.scope.off(),fM(t)}},XU=()=>{ks&&ks.scope.off(),fM(null)};function H9(i){return i.vnode.shapeFlag&4}let Fw=!1;function yct(i,t=!1,e=!1){t&&Xk(t);const{props:r,children:n}=i.vnode,o=H9(i);jlt(i,r,o,t),qlt(i,n,e||t);const s=o?xct(i,t):void 0;return t&&Xk(!1),s}function xct(i,t){const e=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,zlt);const{setup:r}=e;if(r){Cd();const n=i.setupContext=r.length>1?wct(i):null,o=ES(i),s=CS(r,i,0,[i.props,n]),a=H7(s);if(Ed(),o(),(a||i.sp)&&!fw(i)&&y9(i),a){if(s.then(XU,XU),t)return s.then(u=>{YU(i,u,t)}).catch(u=>{kC(u,i,0)});i.asyncDep=s}else YU(i,s,t)}else j9(i,t)}function YU(i,t,e){dn(t)?i.type.__ssrInlineRender?i.ssrRender=t:i.render=t:Ia(t)&&(i.setupState=d9(t)),j9(i,e)}let KU;function j9(i,t,e){const r=i.type;if(!i.render){if(!t&&KU&&!r.render){const n=r.template||WB(i).template;if(n){const{isCustomElement:o,compilerOptions:s}=i.appContext.config,{delimiters:a,compilerOptions:u}=r,f=as(as({isCustomElement:o,delimiters:a},s),u);r.render=KU(n,f)}}i.render=r.render||lu}{const n=ES(i);Cd();try{Blt(i)}finally{Ed(),n()}}}const bct={get(i,t){return Ls(i,"get",""),i[t]}};function wct(i){const t=e=>{i.exposed=e||{}};return{attrs:new Proxy(i.attrs,bct),slots:i.slots,emit:i.emit,expose:t}}function VC(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(d9(hlt(i.exposed)),{get(t,e){if(e in t)return t[e];if(e in pw)return pw[e](i)},has(t,e){return e in t||e in pw}})):i.proxy}function Sct(i,t=!0){return dn(i)?i.displayName||i.name:i.name||t&&i.__name}function Tct(i){return dn(i)&&"__vccOpts"in i}const Yl=(i,t)=>mlt(i,t,Fw);function W9(i,t,e){try{uM(-1);const r=arguments.length;return r===2?Ia(t)&&!Hr(t)?hM(t)?qn(i,null,[t]):qn(i,t):qn(i,null,t):(r>3?e=Array.prototype.slice.call(arguments,2):r===3&&hM(e)&&(e=[e]),qn(i,t,e))}finally{uM(1)}}const Act="3.5.24";/**
* @vue/runtime-dom v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Yk;const JU=typeof window<"u"&&window.trustedTypes;if(JU)try{Yk=JU.createPolicy("vue",{createHTML:i=>i})}catch{}const $9=Yk?i=>Yk.createHTML(i):i=>i,Ict="http://www.w3.org/2000/svg",Mct="http://www.w3.org/1998/Math/MathML",sd=typeof document<"u"?document:null,QU=sd&&sd.createElement("template"),Cct={insert:(i,t,e)=>{t.insertBefore(i,e||null)},remove:i=>{const t=i.parentNode;t&&t.removeChild(i)},createElement:(i,t,e,r)=>{const n=t==="svg"?sd.createElementNS(Ict,i):t==="mathml"?sd.createElementNS(Mct,i):e?sd.createElement(i,{is:e}):sd.createElement(i);return i==="select"&&r&&r.multiple!=null&&n.setAttribute("multiple",r.multiple),n},createText:i=>sd.createTextNode(i),createComment:i=>sd.createComment(i),setText:(i,t)=>{i.nodeValue=t},setElementText:(i,t)=>{i.textContent=t},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>sd.querySelector(i),setScopeId(i,t){i.setAttribute(t,"")},insertStaticContent(i,t,e,r,n,o){const s=e?e.previousSibling:t.lastChild;if(n&&(n===o||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),e),!(n===o||!(n=n.nextSibling)););else{QU.innerHTML=$9(r==="svg"?`<svg>${i}</svg>`:r==="mathml"?`<math>${i}</math>`:i);const a=QU.content;if(r==="svg"||r==="mathml"){const u=a.firstChild;for(;u.firstChild;)a.appendChild(u.firstChild);a.removeChild(u)}t.insertBefore(a,e)}return[s?s.nextSibling:t.firstChild,e?e.previousSibling:t.lastChild]}},Ect=Symbol("_vtc");function Dct(i,t,e){const r=i[Ect];r&&(t=(t?[t,...r]:[...r]).join(" ")),t==null?i.removeAttribute("class"):e?i.setAttribute("class",t):i.className=t}const tG=Symbol("_vod"),Pct=Symbol("_vsh"),Lct=Symbol(""),Rct=/(?:^|;)\s*display\s*:/;function kct(i,t,e){const r=i.style,n=ko(e);let o=!1;if(e&&!n){if(t)if(ko(t))for(const s of t.split(";")){const a=s.slice(0,s.indexOf(":")).trim();e[a]==null&&II(r,a,"")}else for(const s in t)e[s]==null&&II(r,s,"");for(const s in e)s==="display"&&(o=!0),II(r,s,e[s])}else if(n){if(t!==e){const s=r[Lct];s&&(e+=";"+s),r.cssText=e,o=Rct.test(e)}}else t&&i.removeAttribute("style");tG in i&&(i[tG]=o?r.display:"",i[Pct]&&(r.display="none"))}const eG=/\s*!important$/;function II(i,t,e){if(Hr(e))e.forEach(r=>II(i,t,r));else if(e==null&&(e=""),t.startsWith("--"))i.setProperty(t,e);else{const r=Oct(i,t);eG.test(e)?i.setProperty(Fp(r),e.replace(eG,""),"important"):i[r]=e}}const iG=["Webkit","Moz","ms"],$P={};function Oct(i,t){const e=$P[t];if(e)return e;let r=Rc(t);if(r!=="filter"&&r in i)return $P[t]=r;r=DC(r);for(let n=0;n<iG.length;n++){const o=iG[n]+r;if(o in i)return $P[t]=o}return t}const rG="http://www.w3.org/1999/xlink";function nG(i,t,e,r,n,o=Hst(t)){r&&t.startsWith("xlink:")?e==null?i.removeAttributeNS(rG,t.slice(6,t.length)):i.setAttributeNS(rG,t,e):e==null||o&&!Z7(e)?i.removeAttribute(t):i.setAttribute(t,o?"":vh(e)?String(e):e)}function aG(i,t,e,r,n){if(t==="innerHTML"||t==="textContent"){e!=null&&(i[t]=t==="innerHTML"?$9(e):e);return}const o=i.tagName;if(t==="value"&&o!=="PROGRESS"&&!o.includes("-")){const a=o==="OPTION"?i.getAttribute("value")||"":i.value,u=e==null?i.type==="checkbox"?"on":"":String(e);(a!==u||!("_value"in i))&&(i.value=u),e==null&&i.removeAttribute(t),i._value=e;return}let s=!1;if(e===""||e==null){const a=typeof i[t];a==="boolean"?e=Z7(e):e==null&&a==="string"?(e="",s=!0):a==="number"&&(e=0,s=!0)}try{i[t]=e}catch{}s&&i.removeAttribute(n||t)}function ip(i,t,e,r){i.addEventListener(t,e,r)}function zct(i,t,e,r){i.removeEventListener(t,e,r)}const oG=Symbol("_vei");function Bct(i,t,e,r,n=null){const o=i[oG]||(i[oG]={}),s=o[t];if(r&&s)s.value=r;else{const[a,u]=Fct(t);if(r){const f=o[t]=Uct(r,n);ip(i,a,f,u)}else s&&(zct(i,a,s,u),o[t]=void 0)}}const sG=/(?:Once|Passive|Capture)$/;function Fct(i){let t;if(sG.test(i)){t={};let r;for(;r=i.match(sG);)i=i.slice(0,i.length-r[0].length),t[r[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):Fp(i.slice(2)),t]}let ZP=0;const Nct=Promise.resolve(),Vct=()=>ZP||(Nct.then(()=>ZP=0),ZP=Date.now());function Uct(i,t){const e=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=e.attached)return;_h(Gct(r,e.value),t,5,[r])};return e.value=i,e.attached=Vct(),e}function Gct(i,t){if(Hr(t)){const e=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{e.call(i),i._stopped=!0},t.map(r=>n=>!n._stopped&&r&&r(n))}else return t}const lG=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,Hct=(i,t,e,r,n,o)=>{const s=n==="svg";t==="class"?Dct(i,r,s):t==="style"?kct(i,e,r):CC(t)?DB(t)||Bct(i,t,e,r,o):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):jct(i,t,r,s))?(aG(i,t,r),!i.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&nG(i,t,r,s,o,t!=="value")):i._isVueCE&&(/[A-Z]/.test(t)||!ko(r))?aG(i,Rc(t),r,o,t):(t==="true-value"?i._trueValue=r:t==="false-value"&&(i._falseValue=r),nG(i,t,r,s))};function jct(i,t,e,r){if(r)return!!(t==="innerHTML"||t==="textContent"||t in i&&lG(t)&&dn(e));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&i.tagName==="IFRAME"||t==="form"||t==="list"&&i.tagName==="INPUT"||t==="type"&&i.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const n=i.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return lG(t)&&ko(e)?!1:t in i}const d0=i=>{const t=i.props["onUpdate:modelValue"]||!1;return Hr(t)?e=>wI(t,e):t};function Wct(i){i.target.composing=!0}function cG(i){const t=i.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const wd=Symbol("_assign");function uG(i,t,e){return t&&(i=i.trim()),e&&(i=PC(i)),i}const hG={created(i,{modifiers:{lazy:t,trim:e,number:r}},n){i[wd]=d0(n);const o=r||n.props&&n.props.type==="number";ip(i,t?"change":"input",s=>{s.target.composing||i[wd](uG(i.value,e,o))}),(e||o)&&ip(i,"change",()=>{i.value=uG(i.value,e,o)}),t||(ip(i,"compositionstart",Wct),ip(i,"compositionend",cG),ip(i,"change",cG))},mounted(i,{value:t}){i.value=t??""},beforeUpdate(i,{value:t,oldValue:e,modifiers:{lazy:r,trim:n,number:o}},s){if(i[wd]=d0(s),i.composing)return;const a=(o||i.type==="number")&&!/^0\d/.test(i.value)?PC(i.value):i.value,u=t??"";a!==u&&(document.activeElement===i&&i.type!=="range"&&(r&&t===e||n&&i.value.trim()===u)||(i.value=u))}},cy={deep:!0,created(i,t,e){i[wd]=d0(e),ip(i,"change",()=>{const r=i._modelValue,n=Nw(i),o=i.checked,s=i[wd];if(Hr(r)){const a=RB(r,n),u=a!==-1;if(o&&!u)s(r.concat(n));else if(!o&&u){const f=[...r];f.splice(a,1),s(f)}}else if(L0(r)){const a=new Set(r);o?a.add(n):a.delete(n),s(a)}else s(Z9(i,o))})},mounted:dG,beforeUpdate(i,t,e){i[wd]=d0(e),dG(i,t,e)}};function dG(i,{value:t,oldValue:e},r){i._modelValue=t;let n;if(Hr(t))n=RB(t,r.props.value)>-1;else if(L0(t))n=t.has(r.props.value);else{if(t===e)return;n=IS(t,Z9(i,!0))}i.checked!==n&&(i.checked=n)}const j2={deep:!0,created(i,{value:t,modifiers:{number:e}},r){const n=L0(t);ip(i,"change",()=>{const o=Array.prototype.filter.call(i.options,s=>s.selected).map(s=>e?PC(Nw(s)):Nw(s));i[wd](i.multiple?n?new Set(o):o:o[0]),i._assigning=!0,UB(()=>{i._assigning=!1})}),i[wd]=d0(r)},mounted(i,{value:t}){fG(i,t)},beforeUpdate(i,t,e){i[wd]=d0(e)},updated(i,{value:t}){i._assigning||fG(i,t)}};function fG(i,t){const e=i.multiple,r=Hr(t);if(!(e&&!r&&!L0(t))){for(let n=0,o=i.options.length;n<o;n++){const s=i.options[n],a=Nw(s);if(e)if(r){const u=typeof a;u==="string"||u==="number"?s.selected=t.some(f=>String(f)===String(a)):s.selected=RB(t,a)>-1}else s.selected=t.has(a);else if(IS(Nw(s),t)){i.selectedIndex!==n&&(i.selectedIndex=n);return}}!e&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function Nw(i){return"_value"in i?i._value:i.value}function Z9(i,t){const e=t?"_trueValue":"_falseValue";return e in i?i[e]:t}const $ct=["ctrl","shift","alt","meta"],Zct={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,t)=>$ct.some(e=>i[`${e}Key`]&&!t.includes(e))},qct=(i,t)=>{const e=i._withMods||(i._withMods={}),r=t.join(".");return e[r]||(e[r]=(n,...o)=>{for(let s=0;s<t.length;s++){const a=Zct[t[s]];if(a&&a(n,t))return}return i(n,...o)})},Xct={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Yct=(i,t)=>{const e=i._withKeys||(i._withKeys={}),r=t.join(".");return e[r]||(e[r]=n=>{if(!("key"in n))return;const o=Fp(n.key);if(t.some(s=>s===o||Xct[s]===o))return i(n)})},Kct=as({patchProp:Hct},Cct);let pG;function Jct(){return pG||(pG=Ylt(Kct))}const q9=(...i)=>{const t=Jct().createApp(...i),{mount:e}=t;return t.mount=r=>{const n=tut(r);if(!n)return;const o=t._component;!dn(o)&&!o.render&&!o.template&&(o.template=n.innerHTML),n.nodeType===1&&(n.textContent="");const s=e(n,!1,Qct(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),s},t};function Qct(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function tut(i){return ko(i)?document.querySelector(i):i}const Np=(i,t)=>{const e=i.__vccOpts||i;for(const[r,n]of t)e[r]=n;return e},eut={};function iut(i,t){const e=Km("router-view");return Wo(),U9(e)}const rut=Np(eut,[["render",iut]]),nut="modulepreload",aut=function(i){return"/casa0017-web-assessment-EcoVision/"+i},gG={},out=function(t,e,r){if(!e||e.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(e.map(o=>{if(o=aut(o),o in gG)return;gG[o]=!0;const s=o.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(!!r)for(let g=n.length-1;g>=0;g--){const v=n[g];if(v.href===o&&(!s||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const f=document.createElement("link");if(f.rel=s?"stylesheet":nut,s||(f.as="script",f.crossOrigin=""),f.href=o,document.head.appendChild(f),s)return new Promise((g,v)=>{f.addEventListener("load",g),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o})};/*!
 * vue-router v4.6.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */const Vy=typeof document<"u";function X9(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function sut(i){return i.__esModule||i[Symbol.toStringTag]==="Module"||i.default&&X9(i.default)}const ua=Object.assign;function qP(i,t){const e={};for(const r in t){const n=t[r];e[r]=pu(n)?n.map(i):i(n)}return e}const mw=()=>{},pu=Array.isArray;function mG(i,t){const e={};for(const r in i)e[r]=r in t?t[r]:i[r];return e}const Y9=/#/g,lut=/&/g,cut=/\//g,uut=/=/g,hut=/\?/g,K9=/\+/g,dut=/%5B/g,fut=/%5D/g,J9=/%5E/g,put=/%60/g,Q9=/%7B/g,gut=/%7C/g,tX=/%7D/g,mut=/%20/g;function XB(i){return i==null?"":encodeURI(""+i).replace(gut,"|").replace(dut,"[").replace(fut,"]")}function vut(i){return XB(i).replace(Q9,"{").replace(tX,"}").replace(J9,"^")}function Kk(i){return XB(i).replace(K9,"%2B").replace(mut,"+").replace(Y9,"%23").replace(lut,"%26").replace(put,"`").replace(Q9,"{").replace(tX,"}").replace(J9,"^")}function _ut(i){return Kk(i).replace(uut,"%3D")}function yut(i){return XB(i).replace(Y9,"%23").replace(hut,"%3F")}function xut(i){return yut(i).replace(cut,"%2F")}function Vw(i){if(i==null)return null;try{return decodeURIComponent(""+i)}catch{}return""+i}const but=/\/$/,wut=i=>i.replace(but,"");function XP(i,t,e="/"){let r,n={},o="",s="";const a=t.indexOf("#");let u=t.indexOf("?");return u=a>=0&&u>a?-1:u,u>=0&&(r=t.slice(0,u),o=t.slice(u,a>0?a:t.length),n=i(o.slice(1))),a>=0&&(r=r||t.slice(0,a),s=t.slice(a,t.length)),r=Iut(r??t,e),{fullPath:r+o+s,path:r,query:n,hash:Vw(s)}}function Sut(i,t){const e=t.query?i(t.query):"";return t.path+(e&&"?")+e+(t.hash||"")}function vG(i,t){return!t||!i.toLowerCase().startsWith(t.toLowerCase())?i:i.slice(t.length)||"/"}function Tut(i,t,e){const r=t.matched.length-1,n=e.matched.length-1;return r>-1&&r===n&&f0(t.matched[r],e.matched[n])&&eX(t.params,e.params)&&i(t.query)===i(e.query)&&t.hash===e.hash}function f0(i,t){return(i.aliasOf||i)===(t.aliasOf||t)}function eX(i,t){if(Object.keys(i).length!==Object.keys(t).length)return!1;for(const e in i)if(!Aut(i[e],t[e]))return!1;return!0}function Aut(i,t){return pu(i)?_G(i,t):pu(t)?_G(t,i):i===t}function _G(i,t){return pu(t)?i.length===t.length&&i.every((e,r)=>e===t[r]):i.length===1&&i[0]===t}function Iut(i,t){if(i.startsWith("/"))return i;if(!i)return t;const e=t.split("/"),r=i.split("/"),n=r[r.length-1];(n===".."||n===".")&&r.push("");let o=e.length-1,s,a;for(s=0;s<r.length;s++)if(a=r[s],a!==".")if(a==="..")o>1&&o--;else break;return e.slice(0,o).join("/")+"/"+r.slice(s).join("/")}const Bf={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let Jk=function(i){return i.pop="pop",i.push="push",i}({}),YP=function(i){return i.back="back",i.forward="forward",i.unknown="",i}({});function Mut(i){if(!i)if(Vy){const t=document.querySelector("base");i=t&&t.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),wut(i)}const Cut=/^[^#]+#/;function Eut(i,t){return i.replace(Cut,"#")+t}function Dut(i,t){const e=document.documentElement.getBoundingClientRect(),r=i.getBoundingClientRect();return{behavior:t.behavior,left:r.left-e.left-(t.left||0),top:r.top-e.top-(t.top||0)}}const UC=()=>({left:window.scrollX,top:window.scrollY});function Put(i){let t;if("el"in i){const e=i.el,r=typeof e=="string"&&e.startsWith("#"),n=typeof e=="string"?r?document.getElementById(e.slice(1)):document.querySelector(e):e;if(!n)return;t=Dut(n,i)}else t=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function yG(i,t){return(history.state?history.state.position-t:-1)+i}const Qk=new Map;function Lut(i,t){Qk.set(i,t)}function Rut(i){const t=Qk.get(i);return Qk.delete(i),t}function kut(i){return typeof i=="string"||i&&typeof i=="object"}function iX(i){return typeof i=="string"||typeof i=="symbol"}let oo=function(i){return i[i.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",i[i.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",i[i.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",i[i.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",i[i.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",i}({});const rX=Symbol("");oo.MATCHER_NOT_FOUND+"",oo.NAVIGATION_GUARD_REDIRECT+"",oo.NAVIGATION_ABORTED+"",oo.NAVIGATION_CANCELLED+"",oo.NAVIGATION_DUPLICATED+"";function p0(i,t){return ua(new Error,{type:i,[rX]:!0},t)}function Jh(i,t){return i instanceof Error&&rX in i&&(t==null||!!(i.type&t))}const Out=["params","query","hash"];function zut(i){if(typeof i=="string")return i;if(i.path!=null)return i.path;const t={};for(const e of Out)e in i&&(t[e]=i[e]);return JSON.stringify(t,null,2)}function But(i){const t={};if(i===""||i==="?")return t;const e=(i[0]==="?"?i.slice(1):i).split("&");for(let r=0;r<e.length;++r){const n=e[r].replace(K9," "),o=n.indexOf("="),s=Vw(o<0?n:n.slice(0,o)),a=o<0?null:Vw(n.slice(o+1));if(s in t){let u=t[s];pu(u)||(u=t[s]=[u]),u.push(a)}else t[s]=a}return t}function xG(i){let t="";for(let e in i){const r=i[e];if(e=_ut(e),r==null){r!==void 0&&(t+=(t.length?"&":"")+e);continue}(pu(r)?r.map(n=>n&&Kk(n)):[r&&Kk(r)]).forEach(n=>{n!==void 0&&(t+=(t.length?"&":"")+e,n!=null&&(t+="="+n))})}return t}function Fut(i){const t={};for(const e in i){const r=i[e];r!==void 0&&(t[e]=pu(r)?r.map(n=>n==null?null:""+n):r==null?r:""+r)}return t}const Nut=Symbol(""),bG=Symbol(""),YB=Symbol(""),nX=Symbol(""),tO=Symbol("");function ab(){let i=[];function t(r){return i.push(r),()=>{const n=i.indexOf(r);n>-1&&i.splice(n,1)}}function e(){i=[]}return{add:t,list:()=>i.slice(),reset:e}}function Qf(i,t,e,r,n,o=s=>s()){const s=r&&(r.enterCallbacks[n]=r.enterCallbacks[n]||[]);return()=>new Promise((a,u)=>{const f=y=>{y===!1?u(p0(oo.NAVIGATION_ABORTED,{from:e,to:t})):y instanceof Error?u(y):kut(y)?u(p0(oo.NAVIGATION_GUARD_REDIRECT,{from:t,to:y})):(s&&r.enterCallbacks[n]===s&&typeof y=="function"&&s.push(y),a())},g=o(()=>i.call(r&&r.instances[n],t,e,f));let v=Promise.resolve(g);i.length<3&&(v=v.then(f)),v.catch(y=>u(y))})}function KP(i,t,e,r,n=o=>o()){const o=[];for(const s of i)for(const a in s.components){let u=s.components[a];if(!(t!=="beforeRouteEnter"&&!s.instances[a]))if(X9(u)){const f=(u.__vccOpts||u)[t];f&&o.push(Qf(f,e,r,s,a,n))}else{let f=u();o.push(()=>f.then(g=>{if(!g)throw new Error(`Couldn't resolve component "${a}" at "${s.path}"`);const v=sut(g)?g.default:g;s.mods[a]=g,s.components[a]=v;const y=(v.__vccOpts||v)[t];return y&&Qf(y,e,r,s,a,n)()}))}}return o}function Vut(i,t){const e=[],r=[],n=[],o=Math.max(t.matched.length,i.matched.length);for(let s=0;s<o;s++){const a=t.matched[s];a&&(i.matched.find(f=>f0(f,a))?r.push(a):e.push(a));const u=i.matched[s];u&&(t.matched.find(f=>f0(f,u))||n.push(u))}return[e,r,n]}/*!
 * vue-router v4.6.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let Uut=()=>location.protocol+"//"+location.host;function aX(i,t){const{pathname:e,search:r,hash:n}=t,o=i.indexOf("#");if(o>-1){let s=n.includes(i.slice(o))?i.slice(o).length:1,a=n.slice(s);return a[0]!=="/"&&(a="/"+a),vG(a,"")}return vG(e,i)+r+n}function Gut(i,t,e,r){let n=[],o=[],s=null;const a=({state:y})=>{const w=aX(i,location),I=e.value,E=t.value;let D=0;if(y){if(e.value=w,t.value=y,s&&s===I){s=null;return}D=E?y.position-E.position:0}else r(w);n.forEach(R=>{R(e.value,I,{delta:D,type:Jk.pop,direction:D?D>0?YP.forward:YP.back:YP.unknown})})};function u(){s=e.value}function f(y){n.push(y);const w=()=>{const I=n.indexOf(y);I>-1&&n.splice(I,1)};return o.push(w),w}function g(){if(document.visibilityState==="hidden"){const{history:y}=window;if(!y.state)return;y.replaceState(ua({},y.state,{scroll:UC()}),"")}}function v(){for(const y of o)y();o=[],window.removeEventListener("popstate",a),window.removeEventListener("pagehide",g),document.removeEventListener("visibilitychange",g)}return window.addEventListener("popstate",a),window.addEventListener("pagehide",g),document.addEventListener("visibilitychange",g),{pauseListeners:u,listen:f,destroy:v}}function wG(i,t,e,r=!1,n=!1){return{back:i,current:t,forward:e,replaced:r,position:window.history.length,scroll:n?UC():null}}function Hut(i){const{history:t,location:e}=window,r={value:aX(i,e)},n={value:t.state};n.value||o(r.value,{back:null,current:r.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function o(u,f,g){const v=i.indexOf("#"),y=v>-1?(e.host&&document.querySelector("base")?i:i.slice(v))+u:Uut()+i+u;try{t[g?"replaceState":"pushState"](f,"",y),n.value=f}catch(w){console.error(w),e[g?"replace":"assign"](y)}}function s(u,f){o(u,ua({},t.state,wG(n.value.back,u,n.value.forward,!0),f,{position:n.value.position}),!0),r.value=u}function a(u,f){const g=ua({},n.value,t.state,{forward:u,scroll:UC()});o(g.current,g,!0),o(u,ua({},wG(r.value,u,null),{position:g.position+1},f),!1),r.value=u}return{location:r,state:n,push:a,replace:s}}function jut(i){i=Mut(i);const t=Hut(i),e=Gut(i,t.state,t.location,t.replace);function r(o,s=!0){s||e.pauseListeners(),history.go(o)}const n=ua({location:"",base:i,go:r,createHref:Eut.bind(null,i)},t,e);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>t.state.value}),n}function Wut(i){return i=location.host?i||location.pathname+location.search:"",i.includes("#")||(i+="#"),jut(i)}let Nm=function(i){return i[i.Static=0]="Static",i[i.Param=1]="Param",i[i.Group=2]="Group",i}({});var Go=function(i){return i[i.Static=0]="Static",i[i.Param=1]="Param",i[i.ParamRegExp=2]="ParamRegExp",i[i.ParamRegExpEnd=3]="ParamRegExpEnd",i[i.EscapeNext=4]="EscapeNext",i}(Go||{});const $ut={type:Nm.Static,value:""},Zut=/[a-zA-Z0-9_]/;function qut(i){if(!i)return[[]];if(i==="/")return[[$ut]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function t(w){throw new Error(`ERR (${e})/"${f}": ${w}`)}let e=Go.Static,r=e;const n=[];let o;function s(){o&&n.push(o),o=[]}let a=0,u,f="",g="";function v(){f&&(e===Go.Static?o.push({type:Nm.Static,value:f}):e===Go.Param||e===Go.ParamRegExp||e===Go.ParamRegExpEnd?(o.length>1&&(u==="*"||u==="+")&&t(`A repeatable param (${f}) must be alone in its segment. eg: '/:ids+.`),o.push({type:Nm.Param,value:f,regexp:g,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):t("Invalid state to consume buffer"),f="")}function y(){f+=u}for(;a<i.length;){if(u=i[a++],u==="\\"&&e!==Go.ParamRegExp){r=e,e=Go.EscapeNext;continue}switch(e){case Go.Static:u==="/"?(f&&v(),s()):u===":"?(v(),e=Go.Param):y();break;case Go.EscapeNext:y(),e=r;break;case Go.Param:u==="("?e=Go.ParamRegExp:Zut.test(u)?y():(v(),e=Go.Static,u!=="*"&&u!=="?"&&u!=="+"&&a--);break;case Go.ParamRegExp:u===")"?g[g.length-1]=="\\"?g=g.slice(0,-1)+u:e=Go.ParamRegExpEnd:g+=u;break;case Go.ParamRegExpEnd:v(),e=Go.Static,u!=="*"&&u!=="?"&&u!=="+"&&a--,g="";break;default:t("Unknown state");break}}return e===Go.ParamRegExp&&t(`Unfinished custom RegExp for param "${f}"`),v(),s(),n}const SG="[^/]+?",Xut={sensitive:!1,strict:!1,start:!0,end:!0};var sl=function(i){return i[i._multiplier=10]="_multiplier",i[i.Root=90]="Root",i[i.Segment=40]="Segment",i[i.SubSegment=30]="SubSegment",i[i.Static=40]="Static",i[i.Dynamic=20]="Dynamic",i[i.BonusCustomRegExp=10]="BonusCustomRegExp",i[i.BonusWildcard=-50]="BonusWildcard",i[i.BonusRepeatable=-20]="BonusRepeatable",i[i.BonusOptional=-8]="BonusOptional",i[i.BonusStrict=.7000000000000001]="BonusStrict",i[i.BonusCaseSensitive=.25]="BonusCaseSensitive",i}(sl||{});const Yut=/[.+*?^${}()[\]/\\]/g;function Kut(i,t){const e=ua({},Xut,t),r=[];let n=e.start?"^":"";const o=[];for(const f of i){const g=f.length?[]:[sl.Root];e.strict&&!f.length&&(n+="/");for(let v=0;v<f.length;v++){const y=f[v];let w=sl.Segment+(e.sensitive?sl.BonusCaseSensitive:0);if(y.type===Nm.Static)v||(n+="/"),n+=y.value.replace(Yut,"\\$&"),w+=sl.Static;else if(y.type===Nm.Param){const{value:I,repeatable:E,optional:D,regexp:R}=y;o.push({name:I,repeatable:E,optional:D});const z=R||SG;if(z!==SG){w+=sl.BonusCustomRegExp;try{`${z}`}catch(H){throw new Error(`Invalid custom RegExp for param "${I}" (${z}): `+H.message)}}let N=E?`((?:${z})(?:/(?:${z}))*)`:`(${z})`;v||(N=D&&f.length<2?`(?:/${N})`:"/"+N),D&&(N+="?"),n+=N,w+=sl.Dynamic,D&&(w+=sl.BonusOptional),E&&(w+=sl.BonusRepeatable),z===".*"&&(w+=sl.BonusWildcard)}g.push(w)}r.push(g)}if(e.strict&&e.end){const f=r.length-1;r[f][r[f].length-1]+=sl.BonusStrict}e.strict||(n+="/?"),e.end?n+="$":e.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const s=new RegExp(n,e.sensitive?"":"i");function a(f){const g=f.match(s),v={};if(!g)return null;for(let y=1;y<g.length;y++){const w=g[y]||"",I=o[y-1];v[I.name]=w&&I.repeatable?w.split("/"):w}return v}function u(f){let g="",v=!1;for(const y of i){(!v||!g.endsWith("/"))&&(g+="/"),v=!1;for(const w of y)if(w.type===Nm.Static)g+=w.value;else if(w.type===Nm.Param){const{value:I,repeatable:E,optional:D}=w,R=I in f?f[I]:"";if(pu(R)&&!E)throw new Error(`Provided param "${I}" is an array but it is not repeatable (* or + modifiers)`);const z=pu(R)?R.join("/"):R;if(!z)if(D)y.length<2&&(g.endsWith("/")?g=g.slice(0,-1):v=!0);else throw new Error(`Missing required param "${I}"`);g+=z}}return g||"/"}return{re:s,score:r,keys:o,parse:a,stringify:u}}function Jut(i,t){let e=0;for(;e<i.length&&e<t.length;){const r=t[e]-i[e];if(r)return r;e++}return i.length<t.length?i.length===1&&i[0]===sl.Static+sl.Segment?-1:1:i.length>t.length?t.length===1&&t[0]===sl.Static+sl.Segment?1:-1:0}function oX(i,t){let e=0;const r=i.score,n=t.score;for(;e<r.length&&e<n.length;){const o=Jut(r[e],n[e]);if(o)return o;e++}if(Math.abs(n.length-r.length)===1){if(TG(r))return 1;if(TG(n))return-1}return n.length-r.length}function TG(i){const t=i[i.length-1];return i.length>0&&t[t.length-1]<0}const Qut={strict:!1,end:!0,sensitive:!1};function tht(i,t,e){const r=Kut(qut(i.path),e),n=ua(r,{record:i,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf==!t.record.aliasOf&&t.children.push(n),n}function eht(i,t){const e=[],r=new Map;t=mG(Qut,t);function n(v){return r.get(v)}function o(v,y,w){const I=!w,E=IG(v);E.aliasOf=w&&w.record;const D=mG(t,v),R=[E];if("alias"in v){const H=typeof v.alias=="string"?[v.alias]:v.alias;for(const $ of H)R.push(IG(ua({},E,{components:w?w.record.components:E.components,path:$,aliasOf:w?w.record:E})))}let z,N;for(const H of R){const{path:$}=H;if(y&&$[0]!=="/"){const X=y.record.path,K=X[X.length-1]==="/"?"":"/";H.path=y.record.path+($&&K+$)}if(z=tht(H,y,D),w?w.alias.push(z):(N=N||z,N!==z&&N.alias.push(z),I&&v.name&&!MG(z)&&s(v.name)),sX(z)&&u(z),E.children){const X=E.children;for(let K=0;K<X.length;K++)o(X[K],z,w&&w.children[K])}w=w||z}return N?()=>{s(N)}:mw}function s(v){if(iX(v)){const y=r.get(v);y&&(r.delete(v),e.splice(e.indexOf(y),1),y.children.forEach(s),y.alias.forEach(s))}else{const y=e.indexOf(v);y>-1&&(e.splice(y,1),v.record.name&&r.delete(v.record.name),v.children.forEach(s),v.alias.forEach(s))}}function a(){return e}function u(v){const y=nht(v,e);e.splice(y,0,v),v.record.name&&!MG(v)&&r.set(v.record.name,v)}function f(v,y){let w,I={},E,D;if("name"in v&&v.name){if(w=r.get(v.name),!w)throw p0(oo.MATCHER_NOT_FOUND,{location:v});D=w.record.name,I=ua(AG(y.params,w.keys.filter(N=>!N.optional).concat(w.parent?w.parent.keys.filter(N=>N.optional):[]).map(N=>N.name)),v.params&&AG(v.params,w.keys.map(N=>N.name))),E=w.stringify(I)}else if(v.path!=null)E=v.path,w=e.find(N=>N.re.test(E)),w&&(I=w.parse(E),D=w.record.name);else{if(w=y.name?r.get(y.name):e.find(N=>N.re.test(y.path)),!w)throw p0(oo.MATCHER_NOT_FOUND,{location:v,currentLocation:y});D=w.record.name,I=ua({},y.params,v.params),E=w.stringify(I)}const R=[];let z=w;for(;z;)R.unshift(z.record),z=z.parent;return{name:D,path:E,params:I,matched:R,meta:rht(R)}}i.forEach(v=>o(v));function g(){e.length=0,r.clear()}return{addRoute:o,resolve:f,removeRoute:s,clearRoutes:g,getRoutes:a,getRecordMatcher:n}}function AG(i,t){const e={};for(const r of t)r in i&&(e[r]=i[r]);return e}function IG(i){const t={path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:i.aliasOf,beforeEnter:i.beforeEnter,props:iht(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function iht(i){const t={},e=i.props||!1;if("component"in i)t.default=e;else for(const r in i.components)t[r]=typeof e=="object"?e[r]:e;return t}function MG(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function rht(i){return i.reduce((t,e)=>ua(t,e.meta),{})}function nht(i,t){let e=0,r=t.length;for(;e!==r;){const o=e+r>>1;oX(i,t[o])<0?r=o:e=o+1}const n=aht(i);return n&&(r=t.lastIndexOf(n,r-1)),r}function aht(i){let t=i;for(;t=t.parent;)if(sX(t)&&oX(i,t)===0)return t}function sX({record:i}){return!!(i.name||i.components&&Object.keys(i.components).length||i.redirect)}function CG(i){const t=bd(YB),e=bd(nX),r=Yl(()=>{const u=Ym(i.to);return t.resolve(u)}),n=Yl(()=>{const{matched:u}=r.value,{length:f}=u,g=u[f-1],v=e.matched;if(!g||!v.length)return-1;const y=v.findIndex(f0.bind(null,g));if(y>-1)return y;const w=EG(u[f-2]);return f>1&&EG(g)===w&&v[v.length-1].path!==w?v.findIndex(f0.bind(null,u[f-2])):y}),o=Yl(()=>n.value>-1&&uht(e.params,r.value.params)),s=Yl(()=>n.value>-1&&n.value===e.matched.length-1&&eX(e.params,r.value.params));function a(u={}){if(cht(u)){const f=t[Ym(i.replace)?"replace":"push"](Ym(i.to)).catch(mw);return i.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>f),f}return Promise.resolve()}return{route:r,href:Yl(()=>r.value.href),isActive:o,isExactActive:s,navigate:a}}function oht(i){return i.length===1?i[0]:i}const sht=_9({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:CG,setup(i,{slots:t}){const e=MS(CG(i)),{options:r}=bd(YB),n=Yl(()=>({[DG(i.activeClass,r.linkActiveClass,"router-link-active")]:e.isActive,[DG(i.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:e.isExactActive}));return()=>{const o=t.default&&oht(t.default(e));return i.custom?o:W9("a",{"aria-current":e.isExactActive?i.ariaCurrentValue:null,href:e.href,onClick:e.navigate,class:n.value},o)}}}),lht=sht;function cht(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const t=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return i.preventDefault&&i.preventDefault(),!0}}function uht(i,t){for(const e in t){const r=t[e],n=i[e];if(typeof r=="string"){if(r!==n)return!1}else if(!pu(n)||n.length!==r.length||r.some((o,s)=>o!==n[s]))return!1}return!0}function EG(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const DG=(i,t,e)=>i??t??e,hht=_9({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:t,slots:e}){const r=bd(tO),n=Yl(()=>i.route||r.value),o=bd(bG,0),s=Yl(()=>{let f=Ym(o);const{matched:g}=n.value;let v;for(;(v=g[f])&&!v.components;)f++;return f}),a=Yl(()=>n.value.matched[s.value]);SI(bG,Yl(()=>s.value+1)),SI(Nut,a),SI(tO,n);const u=Po();return n0(()=>[u.value,a.value,i.name],([f,g,v],[y,w,I])=>{g&&(g.instances[v]=f,w&&w!==g&&f&&f===y&&(g.leaveGuards.size||(g.leaveGuards=w.leaveGuards),g.updateGuards.size||(g.updateGuards=w.updateGuards))),f&&g&&(!w||!f0(g,w)||!y)&&(g.enterCallbacks[v]||[]).forEach(E=>E(f))},{flush:"post"}),()=>{const f=n.value,g=i.name,v=a.value,y=v&&v.components[g];if(!y)return PG(e.default,{Component:y,route:f});const w=v.props[g],I=w?w===!0?f.params:typeof w=="function"?w(f):w:null,D=W9(y,ua({},I,t,{onVnodeUnmounted:R=>{R.component.isUnmounted&&(v.instances[g]=null)},ref:u}));return PG(e.default,{Component:D,route:f})||D}}});function PG(i,t){if(!i)return null;const e=i(t);return e.length===1?e[0]:e}const dht=hht;function fht(i){const t=eht(i.routes,i),e=i.parseQuery||But,r=i.stringifyQuery||xG,n=i.history,o=ab(),s=ab(),a=ab(),u=dlt(Bf);let f=Bf;Vy&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const g=qP.bind(null,Ve=>""+Ve),v=qP.bind(null,xut),y=qP.bind(null,Vw);function w(Ve,Ze){let ye,Ke;return iX(Ve)?(ye=t.getRecordMatcher(Ve),Ke=Ze):Ke=Ve,t.addRoute(Ke,ye)}function I(Ve){const Ze=t.getRecordMatcher(Ve);Ze&&t.removeRoute(Ze)}function E(){return t.getRoutes().map(Ve=>Ve.record)}function D(Ve){return!!t.getRecordMatcher(Ve)}function R(Ve,Ze){if(Ze=ua({},Ze||u.value),typeof Ve=="string"){const Zt=XP(e,Ve,Ze.path),pe=t.resolve({path:Zt.path},Ze),$e=n.createHref(Zt.fullPath);return ua(Zt,pe,{params:y(pe.params),hash:Vw(Zt.hash),redirectedFrom:void 0,href:$e})}let ye;if(Ve.path!=null)ye=ua({},Ve,{path:XP(e,Ve.path,Ze.path).path});else{const Zt=ua({},Ve.params);for(const pe in Zt)Zt[pe]==null&&delete Zt[pe];ye=ua({},Ve,{params:v(Zt)}),Ze.params=v(Ze.params)}const Ke=t.resolve(ye,Ze),We=Ve.hash||"";Ke.params=g(y(Ke.params));const Si=Sut(r,ua({},Ve,{hash:vut(We),path:Ke.path})),zt=n.createHref(Si);return ua({fullPath:Si,hash:We,query:r===xG?Fut(Ve.query):Ve.query||{}},Ke,{redirectedFrom:void 0,href:zt})}function z(Ve){return typeof Ve=="string"?XP(e,Ve,u.value.path):ua({},Ve)}function N(Ve,Ze){if(f!==Ve)return p0(oo.NAVIGATION_CANCELLED,{from:Ze,to:Ve})}function H(Ve){return K(Ve)}function $(Ve){return H(ua(z(Ve),{replace:!0}))}function X(Ve,Ze){const ye=Ve.matched[Ve.matched.length-1];if(ye&&ye.redirect){const{redirect:Ke}=ye;let We=typeof Ke=="function"?Ke(Ve,Ze):Ke;return typeof We=="string"&&(We=We.includes("?")||We.includes("#")?We=z(We):{path:We},We.params={}),ua({query:Ve.query,hash:Ve.hash,params:We.path!=null?{}:Ve.params},We)}}function K(Ve,Ze){const ye=f=R(Ve),Ke=u.value,We=Ve.state,Si=Ve.force,zt=Ve.replace===!0,Zt=X(ye,Ke);if(Zt)return K(ua(z(Zt),{state:typeof Zt=="object"?ua({},We,Zt.state):We,force:Si,replace:zt}),Ze||ye);const pe=ye;pe.redirectedFrom=Ze;let $e;return!Si&&Tut(r,Ke,ye)&&($e=p0(oo.NAVIGATION_DUPLICATED,{to:pe,from:Ke}),Te(Ke,Ke,!0,!1)),($e?Promise.resolve($e):lt(pe,Ke)).catch(He=>Jh(He)?Jh(He,oo.NAVIGATION_GUARD_REDIRECT)?He:fe(He):Vt(He,pe,Ke)).then(He=>{if(He){if(Jh(He,oo.NAVIGATION_GUARD_REDIRECT))return K(ua({replace:zt},z(He.to),{state:typeof He.to=="object"?ua({},We,He.to.state):We,force:Si}),Ze||pe)}else He=yt(pe,Ke,!0,zt,We);return ht(pe,Ke,He),He})}function et(Ve,Ze){const ye=N(Ve,Ze);return ye?Promise.reject(ye):Promise.resolve()}function rt(Ve){const Ze=li.values().next().value;return Ze&&typeof Ze.runWithContext=="function"?Ze.runWithContext(Ve):Ve()}function lt(Ve,Ze){let ye;const[Ke,We,Si]=Vut(Ve,Ze);ye=KP(Ke.reverse(),"beforeRouteLeave",Ve,Ze);for(const Zt of Ke)Zt.leaveGuards.forEach(pe=>{ye.push(Qf(pe,Ve,Ze))});const zt=et.bind(null,Ve,Ze);return ye.push(zt),or(ye).then(()=>{ye=[];for(const Zt of o.list())ye.push(Qf(Zt,Ve,Ze));return ye.push(zt),or(ye)}).then(()=>{ye=KP(We,"beforeRouteUpdate",Ve,Ze);for(const Zt of We)Zt.updateGuards.forEach(pe=>{ye.push(Qf(pe,Ve,Ze))});return ye.push(zt),or(ye)}).then(()=>{ye=[];for(const Zt of Si)if(Zt.beforeEnter)if(pu(Zt.beforeEnter))for(const pe of Zt.beforeEnter)ye.push(Qf(pe,Ve,Ze));else ye.push(Qf(Zt.beforeEnter,Ve,Ze));return ye.push(zt),or(ye)}).then(()=>(Ve.matched.forEach(Zt=>Zt.enterCallbacks={}),ye=KP(Si,"beforeRouteEnter",Ve,Ze,rt),ye.push(zt),or(ye))).then(()=>{ye=[];for(const Zt of s.list())ye.push(Qf(Zt,Ve,Ze));return ye.push(zt),or(ye)}).catch(Zt=>Jh(Zt,oo.NAVIGATION_CANCELLED)?Zt:Promise.reject(Zt))}function ht(Ve,Ze,ye){a.list().forEach(Ke=>rt(()=>Ke(Ve,Ze,ye)))}function yt(Ve,Ze,ye,Ke,We){const Si=N(Ve,Ze);if(Si)return Si;const zt=Ze===Bf,Zt=Vy?history.state:{};ye&&(Ke||zt?n.replace(Ve.fullPath,ua({scroll:zt&&Zt&&Zt.scroll},We)):n.push(Ve.fullPath,We)),u.value=Ve,Te(Ve,Ze,ye,zt),fe()}let ft;function kt(){ft||(ft=n.listen((Ve,Ze,ye)=>{if(!Pi.listening)return;const Ke=R(Ve),We=X(Ke,Pi.currentRoute.value);if(We){K(ua(We,{replace:!0,force:!0}),Ke).catch(mw);return}f=Ke;const Si=u.value;Vy&&Lut(yG(Si.fullPath,ye.delta),UC()),lt(Ke,Si).catch(zt=>Jh(zt,oo.NAVIGATION_ABORTED|oo.NAVIGATION_CANCELLED)?zt:Jh(zt,oo.NAVIGATION_GUARD_REDIRECT)?(K(ua(z(zt.to),{force:!0}),Ke).then(Zt=>{Jh(Zt,oo.NAVIGATION_ABORTED|oo.NAVIGATION_DUPLICATED)&&!ye.delta&&ye.type===Jk.pop&&n.go(-1,!1)}).catch(mw),Promise.reject()):(ye.delta&&n.go(-ye.delta,!1),Vt(zt,Ke,Si))).then(zt=>{zt=zt||yt(Ke,Si,!1),zt&&(ye.delta&&!Jh(zt,oo.NAVIGATION_CANCELLED)?n.go(-ye.delta,!1):ye.type===Jk.pop&&Jh(zt,oo.NAVIGATION_ABORTED|oo.NAVIGATION_DUPLICATED)&&n.go(-1,!1)),ht(Ke,Si,zt)}).catch(mw)}))}let Rt=ab(),Ct=ab(),Gt;function Vt(Ve,Ze,ye){fe(Ve);const Ke=Ct.list();return Ke.length?Ke.forEach(We=>We(Ve,Ze,ye)):console.error(Ve),Promise.reject(Ve)}function Qt(){return Gt&&u.value!==Bf?Promise.resolve():new Promise((Ve,Ze)=>{Rt.add([Ve,Ze])})}function fe(Ve){return Gt||(Gt=!Ve,kt(),Rt.list().forEach(([Ze,ye])=>Ve?ye(Ve):Ze()),Rt.reset()),Ve}function Te(Ve,Ze,ye,Ke){const{scrollBehavior:We}=i;if(!Vy||!We)return Promise.resolve();const Si=!ye&&Rut(yG(Ve.fullPath,0))||(Ke||!ye)&&history.state&&history.state.scroll||null;return UB().then(()=>We(Ve,Ze,Si)).then(zt=>zt&&Put(zt)).catch(zt=>Vt(zt,Ve,Ze))}const be=Ve=>n.go(Ve);let Ge;const li=new Set,Pi={currentRoute:u,listening:!0,addRoute:w,removeRoute:I,clearRoutes:t.clearRoutes,hasRoute:D,getRoutes:E,resolve:R,options:i,push:H,replace:$,go:be,back:()=>be(-1),forward:()=>be(1),beforeEach:o.add,beforeResolve:s.add,afterEach:a.add,onError:Ct.add,isReady:Qt,install(Ve){Ve.component("RouterLink",lht),Ve.component("RouterView",dht),Ve.config.globalProperties.$router=Pi,Object.defineProperty(Ve.config.globalProperties,"$route",{enumerable:!0,get:()=>Ym(u)}),Vy&&!Ge&&u.value===Bf&&(Ge=!0,H(n.location).catch(Ke=>{}));const Ze={};for(const Ke in Bf)Object.defineProperty(Ze,Ke,{get:()=>u.value[Ke],enumerable:!0});Ve.provide(YB,Pi),Ve.provide(nX,u9(Ze)),Ve.provide(tO,u);const ye=Ve.unmount;li.add(Ve),Ve.unmount=function(){li.delete(Ve),li.size<1&&(f=Bf,ft&&ft(),ft=null,u.value=Bf,Ge=!1,Gt=!1),ye()}}};function or(Ve){return Ve.reduce((Ze,ye)=>Ze.then(()=>rt(ye)),Promise.resolve())}return Pi}const pht={class:"home"},ght={class:"loading-status"},mht={class:"loading-bar"},vht={class:"loading-percent"},_ht={class:"debug hidden",id:"debug"},yht={class:"stats"},xht={class:"stat-val"},bht={id:"content"},wht={class:"section"},Sht={class:"box"},Tht={class:"section"},Aht={class:"box"},Iht={class:"section"},Mht={class:"box"},Cht={__name:"Home",setup(i){const t=Po(!0),e=Po(0),r=Po("Initializing..."),n=Po(95),o=Po(null),s=Po(null);let a=null,u=null;const f=[{lat:51.5,lng:-.1,name:"London",aqi:70},{lat:40.7,lng:-74,name:"New York",aqi:85},{lat:35.7,lng:139.7,name:"Tokyo",aqi:50},{lat:39.9,lng:116.4,name:"Beijing",aqi:180},{lat:28.6,lng:77.2,name:"Delhi",aqi:250},{lat:-23.6,lng:-46.7,name:"So Paulo",aqi:100},{lat:19.4,lng:-99.1,name:"Mexico City",aqi:140},{lat:30,lng:31.2,name:"Cairo",aqi:180},{lat:-33.9,lng:151.2,name:"Sydney",aqi:55},{lat:1.3,lng:103.8,name:"Singapore",aqi:60},{lat:48.9,lng:2.3,name:"Paris",aqi:65},{lat:52.5,lng:13.4,name:"Berlin",aqi:55},{lat:55.8,lng:37.6,name:"Moscow",aqi:95},{lat:34.1,lng:-118.2,name:"Los Angeles",aqi:110},{lat:22.3,lng:114.2,name:"Hong Kong",aqi:80},{lat:31.2,lng:121.5,name:"Shanghai",aqi:160},{lat:37.6,lng:127,name:"Seoul",aqi:90}],g=(R,z=!1)=>{if(console.log(R),s.value){const N=document.createElement("div");N.textContent=R,N.style.color=z?"#f00":"#0f0",s.value.appendChild(N)}},v=(R,z)=>{e.value=R,z&&(r.value=z)},y=()=>{const R=[];for(let N=0;N<20;N++){let H=(Math.random()-.5)*90,$=(Math.random()-.5)*360,X=0;const K=[[H,$,X]],et=Math.floor(Math.random()*5e3);for(let rt=0;rt<et;rt++)H+=Math.random()*2-1,$+=Math.random()*2-1,X+=(Math.random()*2-1)*.01,X=Math.max(0,X),K.push([H,$,X]);R.push(K)}return R},w=R=>R<50?"#10b981":R<100?"#84cc16":R<150?"#fbbf24":R<200?"#f97316":"#ef4444",I=R=>R<50?"Good ":R<100?"Moderate ":R<150?"Unhealthy ":R<200?"Very Unhealthy ":"Hazardous ",E=()=>{try{if(v(50,"Creating globe..."),g("Creating globe instance..."),!o.value)throw new Error("Globe container not found");g(" Container found"),a=Globe()(o.value),g(" Globe instance created"),v(60,"Loading textures..."),a.globeImageUrl("https://unpkg.com/three-globe@2.27.2/example/img/earth-blue-marble.jpg").bumpImageUrl("https://unpkg.com/three-globe@2.27.2/example/img/earth-topology.png").backgroundImageUrl("https://unpkg.com/three-globe@2.27.2/example/img/night-sky.png"),g(" Textures configured"),v(70,"Adding paths...");const R=y();a.pathsData(R).pathPoints(z=>z).pathPointLat(z=>z[0]).pathPointLng(z=>z[1]).pathPointAlt(z=>z[2]).pathColor(()=>["rgba(168,85,247,0.8)","rgba(236,72,153,0.8)"]).pathDashLength(.01).pathDashGap(.004).pathDashAnimateTime(1e5).pathStroke(2),g(" Paths added"),v(80,"Adding cities..."),a.pointsData(f).pointAltitude(.01).pointRadius(z=>Math.sqrt(z.aqi)*.03).pointColor(z=>w(z.aqi)).pointLabel(z=>`<div style="background:#000;padding:12px;border:2px solid #a855f7;font-family:'Press Start 2P';font-size:10px;color:#a855f7;"><b style="color:#fff;font-size:11px;"> ${z.name}</b><br/><b>AQI:</b> <span style="color:${w(z.aqi)};font-size:14px;">${z.aqi}</span><br/><b>Status:</b> ${I(z.aqi)}</div>`),g(" Cities added"),v(85,"Configuring atmosphere..."),a.atmosphereColor("#a855f7").atmosphereAltitude(.3),g(" Atmosphere configured"),v(90,"Setting up view..."),a.width(window.innerWidth).height(window.innerHeight).pointOfView({lat:30,lng:0,altitude:2.2},0),g(" View configured"),v(95,"Enabling controls..."),a.controls().enableZoom=!0,a.controls().autoRotate=!0,a.controls().autoRotateSpeed=.3,g(" Controls enabled"),window.addEventListener("scroll",()=>{const z=window.pageYOffset,N=document.body.scrollHeight-window.innerHeight,$=2.2+Math.min(z/N,1)*1.3;a.pointOfView({altitude:$},500)}),window.addEventListener("resize",()=>{a&&(a.width(window.innerWidth),a.height(window.innerHeight))}),u=setInterval(()=>{const z=f[Math.floor(Math.random()*f.length)];n.value=z.aqi},3e3),v(100,"Complete!"),g("=== GLOBE READY ==="),setTimeout(()=>{t.value=!1},500)}catch(R){g(" ERROR: "+R.message,!0),r.value=" Error: "+R.message}},D=()=>{window.scrollTo({top:window.innerHeight,behavior:"smooth"})};return k0(()=>{g("=== ECOVISION STARTING ==="),v(10,"Checking Globe.GL...");let R=0;const z=setInterval(()=>{R++,typeof Globe<"u"?(clearInterval(z),g(" Globe.GL loaded"),v(30,"Globe.GL loaded"),E()):R>50&&(clearInterval(z),g(" Globe.GL failed to load",!0),r.value=" Error: Globe.GL not loaded")},100);window.addEventListener("keydown",N=>{if(N.key==="d"||N.key==="D"){const H=document.getElementById("debug");H&&H.classList.toggle("hidden")}})}),BC(()=>{u&&clearInterval(u)}),(R,z)=>{const N=Km("router-link");return Wo(),ms("div",pht,[ve("div",{id:"loading",class:gd({hidden:!t.value})},[z[0]||(z[0]=ve("div",{class:"loading-title"},"ECOVISION",-1)),ve("div",ght,Ta(r.value),1),ve("div",mht,[ve("div",{class:"loading-fill",style:R0({width:e.value+"%"})},null,4)]),ve("div",vht,Ta(Math.floor(e.value))+"%",1)],2),ve("div",_ht,[z[1]||(z[1]=ve("div",null,[ve("strong",null,"DEBUG INFO")],-1)),ve("div",{id:"debugInfo",ref_key:"debugInfo",ref:s},null,512)]),ve("div",{id:"globeViz",ref_key:"globeContainer",ref:o},null,512),ve("div",yht,[z[3]||(z[3]=ve("div",null,[Gn("CITIES: "),ve("span",{class:"stat-val"},"17")],-1)),ve("div",null,[z[2]||(z[2]=Gn("AQI AVG: ",-1)),ve("span",xht,Ta(n.value),1)]),z[4]||(z[4]=ve("div",null,[Gn("STATUS: "),ve("span",{class:"stat-val"},"LIVE")],-1))]),z[19]||(z[19]=ve("div",{class:"controls"},[Gn("  DRAG TO ROTATE"),ve("br"),Gn("  SCROLL TO ZOOM"),ve("br"),Gn("  CLICK MARKERS ")],-1)),ve("div",bht,[ve("div",{class:"hero"},[z[5]||(z[5]=ve("h1",{class:"glitch","data-text":"ECOVISION LONDON"},"ECOVISION LONDON",-1)),z[6]||(z[6]=ve("p",{class:"subtitle"},"Global Air Quality Monitoring System",-1)),ve("div",{class:"scroll-hint",onClick:D}," SCROLL TO EXPLORE ")]),ve("div",wht,[ve("div",Sht,[z[8]||(z[8]=ve("h2",null," OUR MISSION",-1)),z[9]||(z[9]=ve("p",null,"EcoVision London is a cutting-edge air quality monitoring platform that visualizes pollution data from major cities worldwide.",-1)),z[10]||(z[10]=ve("p",null,"Using advanced sensors and data analytics, we track PM2.5, PM10, NO2, O3, and other pollutants.",-1)),qn(N,{to:"/page2",class:"btn"},{default:jo(()=>[...z[7]||(z[7]=[Gn("EXPLORE LONDON ",-1)])]),_:1})])]),ve("div",Tht,[ve("div",Aht,[z[12]||(z[12]=ve("h2",null," TECHNOLOGY",-1)),z[13]||(z[13]=ve("p",null,"Our platform leverages Globe.GL, an open-source WebGL library that renders stunning 3D geographical data visualizations.",-1)),z[14]||(z[14]=ve("p",null,"The interactive globe displays real-time data with color-coded markers indicating air quality levels.",-1)),qn(N,{to:"/map",class:"btn"},{default:jo(()=>[...z[11]||(z[11]=[Gn("VIEW MAP ",-1)])]),_:1})])]),ve("div",Iht,[ve("div",Mht,[z[16]||(z[16]=ve("h2",null," GLOBAL IMPACT",-1)),z[17]||(z[17]=ve("p",null,"Air pollution affects millions of lives worldwide. EcoVision London makes pollution data accessible and actionable for everyone.",-1)),z[18]||(z[18]=ve("p",null,"Join us in our mission to create awareness and drive change towards cleaner air for future generations.",-1)),qn(N,{to:"/page4",class:"btn"},{default:jo(()=>[...z[15]||(z[15]=[Gn("MEET THE TEAM ",-1)])]),_:1})])])])])}}},Eht=Np(Cht,[["__scopeId","data-v-ff040298"]]);const Dht={class:"page2"},Pht={class:"nav-links"},Lht={class:"cta-section"},Rht={class:"cta-box"},kht={class:"cta-buttons"},Oht={__name:"Page2",setup(i){function t(){window.scrollTo(0,0),document.body.scrollTop=0,document.documentElement.scrollTop=0;const e=document.getElementById("app");e&&(e.scrollTop=0)}return k0(()=>{t();const e={threshold:.1,rootMargin:"0px 0px -100px 0px"},r=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&(o.target.style.opacity="1",o.target.style.transform="translateY(0)")})},e);document.querySelectorAll(".challenge-card, .feature-item").forEach(n=>{n.style.opacity="0",n.style.transform="translateY(50px)",n.style.transition="all 0.6s ease",r.observe(n)})}),OC(()=>{t()}),(e,r)=>{const n=Km("router-link");return Wo(),ms("div",Dht,[ve("nav",null,[r[4]||(r[4]=ve("div",{class:"logo"},"ECOVISION",-1)),ve("ul",Pht,[ve("li",null,[qn(n,{to:"/"},{default:jo(()=>[...r[0]||(r[0]=[Gn("HOME",-1)])]),_:1})]),ve("li",null,[qn(n,{to:"/page2",class:"active"},{default:jo(()=>[...r[1]||(r[1]=[Gn("ABOUT",-1)])]),_:1})]),ve("li",null,[qn(n,{to:"/map"},{default:jo(()=>[...r[2]||(r[2]=[Gn("MAP",-1)])]),_:1})]),ve("li",null,[qn(n,{to:"/page4"},{default:jo(()=>[...r[3]||(r[3]=[Gn("TEAM",-1)])]),_:1})])])]),r[9]||(r[9]=Kf('<div class="pixel-decoration top-left" data-v-a098e632></div><div class="pixel-decoration bottom-right" data-v-a098e632></div><section class="hero" data-v-a098e632><div class="hero-content" data-v-a098e632><h1 data-v-a098e632>Ecovision London</h1><p data-v-a098e632> Mapping London&#39;s vehicle emissions to air quality - Empowering citizens with real-time data for cleaner transport decisions </p></div></section><section class="challenge-section" data-v-a098e632><h2 class="section-title" data-v-a098e632>The Challenge We&#39;re Solving</h2><div class="challenge-grid" data-v-a098e632><div class="challenge-card" data-v-a098e632><span class="card-icon" data-v-a098e632></span><h3 class="card-title" data-v-a098e632>Health Impact</h3><p class="card-text" data-v-a098e632> Vehicle emissions directly affect public health and urban sustainability across London&#39;s 33 boroughs </p></div><div class="challenge-card" data-v-a098e632><span class="card-icon" data-v-a098e632></span><h3 class="card-title" data-v-a098e632>Data Complexity</h3><p class="card-text" data-v-a098e632> Complex air quality reports are difficult for citizens to interpret and use for daily decisions </p></div><div class="challenge-card" data-v-a098e632><span class="card-icon" data-v-a098e632></span><h3 class="card-title" data-v-a098e632>Our Solution</h3><p class="card-text" data-v-a098e632> Interactive visual mapping with hourly data to help citizens make informed transport choices </p></div></div></section><section class="features-section" data-v-a098e632><h2 class="section-title" data-v-a098e632>Key Features</h2><div class="features-list" data-v-a098e632><div class="feature-item" data-v-a098e632><span class="feature-icon" data-v-a098e632></span><div class="feature-content" data-v-a098e632><h3 data-v-a098e632>Real-time Borough Mapping</h3><p data-v-a098e632> Interactive map of all 33 London boroughs with hourly air quality data visualization </p></div></div><div class="feature-item" data-v-a098e632><span class="feature-icon" data-v-a098e632></span><div class="feature-content" data-v-a098e632><h3 data-v-a098e632>24-Hour Time Analysis</h3><p data-v-a098e632> Track pollution patterns throughout the day with interactive time sliders </p></div></div><div class="feature-item" data-v-a098e632><span class="feature-icon" data-v-a098e632></span><div class="feature-content" data-v-a098e632><h3 data-v-a098e632>Cycling vs Car Comparison</h3><p data-v-a098e632> Compare journey times and environmental impact between cycling and driving </p></div></div></div></section>',5)),ve("section",Lht,[ve("div",Rht,[r[7]||(r[7]=ve("h2",null,"Explore the Interactive Map",-1)),r[8]||(r[8]=ve("p",{style:{color:"#ccc","margin-bottom":"2rem","line-height":"1.8"}}," Coming soon - Full interactive experience with historical data from previous month ",-1)),ve("div",kht,[qn(n,{to:"/map",class:"pixel-button primary"},{default:jo(()=>[...r[5]||(r[5]=[Gn("View Map",-1)])]),_:1}),qn(n,{to:"/page4",class:"pixel-button secondary"},{default:jo(()=>[...r[6]||(r[6]=[Gn("Join Us",-1)])]),_:1})])])])])}}},zht=Np(Oht,[["__scopeId","data-v-a098e632"]]);var Bht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fht(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var lX={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(Bht,function(){var e,r,n;function o(a,u){if(!e)e=u;else if(!r)r=u;else{var f="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",g={};e(g),n=u(g),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})))}}o(["exports"],function(a){var u=1e-6,f=typeof Float32Array<"u"?Float32Array:Array;function g(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=h*S-_*m;return T?(d[0]=S*(T=1/T),d[1]=-m*T,d[2]=-_*T,d[3]=h*T,d):null}function v(){var d=new f(9);return f!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d}function y(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=l[4],M=l[5],L=l[6],k=l[7],F=l[8];return d[0]=T*F-M*k,d[1]=_*k-m*F,d[2]=m*M-_*T,d[3]=M*L-S*F,d[4]=h*F-_*L,d[5]=_*S-h*M,d[6]=S*k-T*L,d[7]=m*L-h*k,d[8]=h*T-m*S,d}function w(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3],M=l[4],L=l[5],k=l[6],F=l[7],V=l[8],U=h[0],Z=h[1],q=h[2],Q=h[3],it=h[4],at=h[5],dt=h[6],mt=h[7],_t=h[8];return d[0]=U*m+Z*T+q*k,d[1]=U*_+Z*M+q*F,d[2]=U*S+Z*L+q*V,d[3]=Q*m+it*T+at*k,d[4]=Q*_+it*M+at*F,d[5]=Q*S+it*L+at*V,d[6]=dt*m+mt*T+_t*k,d[7]=dt*_+mt*M+_t*F,d[8]=dt*S+mt*L+_t*V,d}function I(){var d=new f(16);return f!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d}function E(d){var l=new f(16);return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l[9]=d[9],l[10]=d[10],l[11]=d[11],l[12]=d[12],l[13]=d[13],l[14]=d[14],l[15]=d[15],l}function D(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function R(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=l[4],M=l[5],L=l[6],k=l[7],F=l[8],V=l[9],U=l[10],Z=l[11],q=l[12],Q=l[13],it=l[14],at=l[15],dt=h*M-m*T,mt=h*L-_*T,_t=h*k-S*T,Dt=m*L-_*M,At=m*k-S*M,Ot=_*k-S*L,Nt=F*Q-V*q,Ht=F*it-U*q,se=F*at-Z*q,Kt=V*it-U*Q,le=V*at-Z*Q,ge=U*at-Z*it,Se=dt*ge-mt*le+_t*Kt+Dt*se-At*Ht+Ot*Nt;return Se?(d[0]=(M*ge-L*le+k*Kt)*(Se=1/Se),d[1]=(_*le-m*ge-S*Kt)*Se,d[2]=(Q*Ot-it*At+at*Dt)*Se,d[3]=(U*At-V*Ot-Z*Dt)*Se,d[4]=(L*se-T*ge-k*Ht)*Se,d[5]=(h*ge-_*se+S*Ht)*Se,d[6]=(it*_t-q*Ot-at*mt)*Se,d[7]=(F*Ot-U*_t+Z*mt)*Se,d[8]=(T*le-M*se+k*Nt)*Se,d[9]=(m*se-h*le-S*Nt)*Se,d[10]=(q*At-Q*_t+at*dt)*Se,d[11]=(V*_t-F*At-Z*dt)*Se,d[12]=(M*Ht-T*Kt-L*Nt)*Se,d[13]=(h*Kt-m*Ht+_*Nt)*Se,d[14]=(Q*mt-q*Dt-it*dt)*Se,d[15]=(F*Dt-V*mt+U*dt)*Se,d):null}function z(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3],M=l[4],L=l[5],k=l[6],F=l[7],V=l[8],U=l[9],Z=l[10],q=l[11],Q=l[12],it=l[13],at=l[14],dt=l[15],mt=h[0],_t=h[1],Dt=h[2],At=h[3];return d[0]=mt*m+_t*M+Dt*V+At*Q,d[1]=mt*_+_t*L+Dt*U+At*it,d[2]=mt*S+_t*k+Dt*Z+At*at,d[3]=mt*T+_t*F+Dt*q+At*dt,d[4]=(mt=h[4])*m+(_t=h[5])*M+(Dt=h[6])*V+(At=h[7])*Q,d[5]=mt*_+_t*L+Dt*U+At*it,d[6]=mt*S+_t*k+Dt*Z+At*at,d[7]=mt*T+_t*F+Dt*q+At*dt,d[8]=(mt=h[8])*m+(_t=h[9])*M+(Dt=h[10])*V+(At=h[11])*Q,d[9]=mt*_+_t*L+Dt*U+At*it,d[10]=mt*S+_t*k+Dt*Z+At*at,d[11]=mt*T+_t*F+Dt*q+At*dt,d[12]=(mt=h[12])*m+(_t=h[13])*M+(Dt=h[14])*V+(At=h[15])*Q,d[13]=mt*_+_t*L+Dt*U+At*it,d[14]=mt*S+_t*k+Dt*Z+At*at,d[15]=mt*T+_t*F+Dt*q+At*dt,d}function N(d,l,h){var m,_,S,T,M,L,k,F,V,U,Z,q,Q=h[0],it=h[1],at=h[2];return l===d?(d[12]=l[0]*Q+l[4]*it+l[8]*at+l[12],d[13]=l[1]*Q+l[5]*it+l[9]*at+l[13],d[14]=l[2]*Q+l[6]*it+l[10]*at+l[14],d[15]=l[3]*Q+l[7]*it+l[11]*at+l[15]):(_=l[1],S=l[2],T=l[3],M=l[4],L=l[5],k=l[6],F=l[7],V=l[8],U=l[9],Z=l[10],q=l[11],d[0]=m=l[0],d[1]=_,d[2]=S,d[3]=T,d[4]=M,d[5]=L,d[6]=k,d[7]=F,d[8]=V,d[9]=U,d[10]=Z,d[11]=q,d[12]=m*Q+M*it+V*at+l[12],d[13]=_*Q+L*it+U*at+l[13],d[14]=S*Q+k*it+Z*at+l[14],d[15]=T*Q+F*it+q*at+l[15]),d}function H(d,l,h){var m=h[0],_=h[1],S=h[2];return d[0]=l[0]*m,d[1]=l[1]*m,d[2]=l[2]*m,d[3]=l[3]*m,d[4]=l[4]*_,d[5]=l[5]*_,d[6]=l[6]*_,d[7]=l[7]*_,d[8]=l[8]*S,d[9]=l[9]*S,d[10]=l[10]*S,d[11]=l[11]*S,d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15],d}function $(d,l,h){var m=Math.sin(h),_=Math.cos(h),S=l[4],T=l[5],M=l[6],L=l[7],k=l[8],F=l[9],V=l[10],U=l[11];return l!==d&&(d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[4]=S*_+k*m,d[5]=T*_+F*m,d[6]=M*_+V*m,d[7]=L*_+U*m,d[8]=k*_-S*m,d[9]=F*_-T*m,d[10]=V*_-M*m,d[11]=U*_-L*m,d}function X(d,l,h){var m=Math.sin(h),_=Math.cos(h),S=l[0],T=l[1],M=l[2],L=l[3],k=l[8],F=l[9],V=l[10],U=l[11];return l!==d&&(d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[0]=S*_-k*m,d[1]=T*_-F*m,d[2]=M*_-V*m,d[3]=L*_-U*m,d[8]=S*m+k*_,d[9]=T*m+F*_,d[10]=M*m+V*_,d[11]=L*m+U*_,d}function K(d,l,h){var m=Math.sin(h),_=Math.cos(h),S=l[0],T=l[1],M=l[2],L=l[3],k=l[4],F=l[5],V=l[6],U=l[7];return l!==d&&(d[8]=l[8],d[9]=l[9],d[10]=l[10],d[11]=l[11],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[0]=S*_+k*m,d[1]=T*_+F*m,d[2]=M*_+V*m,d[3]=L*_+U*m,d[4]=k*_-S*m,d[5]=F*_-T*m,d[6]=V*_-M*m,d[7]=U*_-L*m,d}function et(d,l){return d[0]=l[0],d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=l[1],d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=l[2],d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function rt(d,l,h){var m,_,S,T=h[0],M=h[1],L=h[2],k=Math.sqrt(T*T+M*M+L*L);return k<u?null:(T*=k=1/k,M*=k,L*=k,m=Math.sin(l),_=Math.cos(l),d[0]=T*T*(S=1-_)+_,d[1]=M*T*S+L*m,d[2]=L*T*S-M*m,d[3]=0,d[4]=T*M*S-L*m,d[5]=M*M*S+_,d[6]=L*M*S+T*m,d[7]=0,d[8]=T*L*S+M*m,d[9]=M*L*S-T*m,d[10]=L*L*S+_,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d)}function lt(d,l){var h=l[0],m=l[1],_=l[2],S=l[4],T=l[5],M=l[6],L=l[8],k=l[9],F=l[10];return d[0]=Math.sqrt(h*h+m*m+_*_),d[1]=Math.sqrt(S*S+T*T+M*M),d[2]=Math.sqrt(L*L+k*k+F*F),d}function ht(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=h+h,M=m+m,L=_+_,k=h*T,F=m*T,V=m*M,U=_*T,Z=_*M,q=_*L,Q=S*T,it=S*M,at=S*L;return d[0]=1-V-q,d[1]=F+at,d[2]=U-it,d[3]=0,d[4]=F-at,d[5]=1-k-q,d[6]=Z+Q,d[7]=0,d[8]=U+it,d[9]=Z-Q,d[10]=1-k-V,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}var yt=z;function ft(){var d=new f(3);return f!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d}function kt(d){var l=new f(3);return l[0]=d[0],l[1]=d[1],l[2]=d[2],l}function Rt(d){var l=d[0],h=d[1],m=d[2];return Math.sqrt(l*l+h*h+m*m)}function Ct(d,l,h){var m=new f(3);return m[0]=d,m[1]=l,m[2]=h,m}function Gt(d,l,h,m){return d[0]=l,d[1]=h,d[2]=m,d}function Vt(d,l,h){return d[0]=l[0]+h[0],d[1]=l[1]+h[1],d[2]=l[2]+h[2],d}function Qt(d,l,h){return d[0]=l[0]-h[0],d[1]=l[1]-h[1],d[2]=l[2]-h[2],d}function fe(d,l,h){return d[0]=l[0]*h[0],d[1]=l[1]*h[1],d[2]=l[2]*h[2],d}function Te(d,l,h){return d[0]=Math.min(l[0],h[0]),d[1]=Math.min(l[1],h[1]),d[2]=Math.min(l[2],h[2]),d}function be(d,l,h){return d[0]=Math.max(l[0],h[0]),d[1]=Math.max(l[1],h[1]),d[2]=Math.max(l[2],h[2]),d}function Ge(d,l,h){return d[0]=l[0]*h,d[1]=l[1]*h,d[2]=l[2]*h,d}function li(d,l,h,m){return d[0]=l[0]+h[0]*m,d[1]=l[1]+h[1]*m,d[2]=l[2]+h[2]*m,d}function Pi(d,l){var h=l[0]-d[0],m=l[1]-d[1],_=l[2]-d[2];return Math.sqrt(h*h+m*m+_*_)}function or(d,l){var h=l[0]-d[0],m=l[1]-d[1],_=l[2]-d[2];return h*h+m*m+_*_}function Ve(d){var l=d[0],h=d[1],m=d[2];return l*l+h*h+m*m}function Ze(d,l){return d[0]=-l[0],d[1]=-l[1],d[2]=-l[2],d}function ye(d,l){var h=l[0],m=l[1],_=l[2],S=h*h+m*m+_*_;return S>0&&(S=1/Math.sqrt(S)),d[0]=l[0]*S,d[1]=l[1]*S,d[2]=l[2]*S,d}function Ke(d,l){return d[0]*l[0]+d[1]*l[1]+d[2]*l[2]}function We(d,l,h){var m=l[0],_=l[1],S=l[2],T=h[0],M=h[1],L=h[2];return d[0]=_*L-S*M,d[1]=S*T-m*L,d[2]=m*M-_*T,d}function Si(d,l,h,m){var _=l[0],S=l[1],T=l[2];return d[0]=_+m*(h[0]-_),d[1]=S+m*(h[1]-S),d[2]=T+m*(h[2]-T),d}function zt(d,l,h){var m=l[0],_=l[1],S=l[2],T=h[3]*m+h[7]*_+h[11]*S+h[15];return d[0]=(h[0]*m+h[4]*_+h[8]*S+h[12])/(T=T||1),d[1]=(h[1]*m+h[5]*_+h[9]*S+h[13])/T,d[2]=(h[2]*m+h[6]*_+h[10]*S+h[14])/T,d}function Zt(d,l,h){var m=l[0],_=l[1],S=l[2];return d[0]=m*h[0]+_*h[3]+S*h[6],d[1]=m*h[1]+_*h[4]+S*h[7],d[2]=m*h[2]+_*h[5]+S*h[8],d}function pe(d,l,h){var m=h[0],_=h[1],S=h[2],T=h[3],M=l[0],L=l[1],k=l[2],F=_*k-S*L,V=S*M-m*k,U=m*L-_*M;return d[0]=M+T*(F+=F)+_*(U+=U)-S*(V+=V),d[1]=L+T*V+S*F-m*U,d[2]=k+T*U+m*V-_*F,d}function $e(d){return d[0]=0,d[1]=0,d[2]=0,d}function He(d,l){return d[0]===l[0]&&d[1]===l[1]&&d[2]===l[2]}var qe=Qt,Ti=fe,Ai=Rt;function _i(){var d=new f(4);return f!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0,d[3]=0),d}function pi(d,l,h){return d[0]=l[0]*h,d[1]=l[1]*h,d[2]=l[2]*h,d[3]=l[3]*h,d}function yr(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=h*h+m*m+_*_+S*S;return T>0&&(T=1/Math.sqrt(T)),d[0]=h*T,d[1]=m*T,d[2]=_*T,d[3]=S*T,d}function Li(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3];return d[0]=h[0]*m+h[4]*_+h[8]*S+h[12]*T,d[1]=h[1]*m+h[5]*_+h[9]*S+h[13]*T,d[2]=h[2]*m+h[6]*_+h[10]*S+h[14]*T,d[3]=h[3]*m+h[7]*_+h[11]*S+h[15]*T,d}function hr(){var d=new f(4);return f!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d[3]=1,d}function xr(d){return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d}function tn(d,l,h){h*=.5;var m=l[0],_=l[1],S=l[2],T=l[3],M=Math.sin(h),L=Math.cos(h);return d[0]=m*L+T*M,d[1]=_*L+S*M,d[2]=S*L-_*M,d[3]=T*L-m*M,d}function On(d,l,h){h*=.5;var m=l[0],_=l[1],S=l[2],T=l[3],M=Math.sin(h),L=Math.cos(h);return d[0]=m*L-S*M,d[1]=_*L+T*M,d[2]=S*L+m*M,d[3]=T*L-_*M,d}ft(),_i();var Kr,Ua,ga,So=yr,Ka=(Kr=ft(),Ua=Ct(1,0,0),ga=Ct(0,1,0),function(d,l,h){var m=Ke(l,h);return m<-.999999?(We(Kr,Ua,l),Ai(Kr)<1e-6&&We(Kr,ga,l),ye(Kr,Kr),function(_,S,T){T*=.5;var M=Math.sin(T);_[0]=M*S[0],_[1]=M*S[1],_[2]=M*S[2],_[3]=Math.cos(T)}(d,Kr,Math.PI),d):m>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(We(Kr,l,h),d[0]=Kr[0],d[1]=Kr[1],d[2]=Kr[2],d[3]=1+m,So(d,d))});function Jn(){var d=new f(2);return f!=Float32Array&&(d[0]=0,d[1]=0),d}function oc(d,l){var h=new f(2);return h[0]=d,h[1]=l,h}function Ja(d,l,h){return d[0]=l,d[1]=h,d}function Qa(d,l,h){return d[0]=l[0]+h[0],d[1]=l[1]+h[1],d}function xs(d,l,h){return d[0]=l[0]-h[0],d[1]=l[1]-h[1],d}function ss(d,l,h){return d[0]=l[0]*h,d[1]=l[1]*h,d}function Hn(d){var l=d[0],h=d[1];return Math.sqrt(l*l+h*h)}function To(d,l){var h=l[0],m=l[1],_=h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),d[0]=l[0]*_,d[1]=l[1]*_,d}function Ih(d,l){return d[0]*l[0]+d[1]*l[1]}hr(),hr(),v();var wu,Gs,kv=xs;function Wp(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}Jn();var J0=function(){if(Gs)return wu;function d(l,h,m,_){this.cx=3*l,this.bx=3*(m-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(_-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=h,this.p2x=m,this.p2y=_}return Gs=1,wu=d,d.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,h){if(h===void 0&&(h=1e-6),l<0)return 0;if(l>1)return 1;for(var m=l,_=0;_<8;_++){var S=this.sampleCurveX(m)-l;if(Math.abs(S)<h)return m;var T=this.sampleCurveDerivativeX(m);if(Math.abs(T)<1e-6)break;m-=S/T}var M=0,L=1;for(m=l,_=0;_<20&&(S=this.sampleCurveX(m),!(Math.abs(S-l)<h));_++)l>S?M=m:L=m,m=.5*(L-M)+M;return m},solve:function(l,h){return this.sampleCurveY(this.solveCurveX(l,h))}},wu}(),jd=Wp(J0);function Ce(d,l){this.x=d,this.y=l}function Bc(d,l){if(Array.isArray(d)){if(!Array.isArray(l)||d.length!==l.length)return!1;for(let h=0;h<d.length;h++)if(!Bc(d[h],l[h]))return!1;return!0}if(typeof d=="object"&&d!==null&&l!==null){if(typeof l!="object"||Object.keys(d).length!==Object.keys(l).length)return!1;for(const h in d)if(!Bc(d[h],l[h]))return!1;return!0}return d===l}Ce.prototype={clone(){return new Ce(this.x,this.y)},add(d){return this.clone()._add(d)},sub(d){return this.clone()._sub(d)},multByPoint(d){return this.clone()._multByPoint(d)},divByPoint(d){return this.clone()._divByPoint(d)},mult(d){return this.clone()._mult(d)},div(d){return this.clone()._div(d)},rotate(d){return this.clone()._rotate(d)},rotateAround(d,l){return this.clone()._rotateAround(d,l)},matMult(d){return this.clone()._matMult(d)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(d){return this.x===d.x&&this.y===d.y},dist(d){return Math.sqrt(this.distSqr(d))},distSqr(d){const l=d.x-this.x,h=d.y-this.y;return l*l+h*h},angle(){return Math.atan2(this.y,this.x)},angleTo(d){return Math.atan2(this.y-d.y,this.x-d.x)},angleWith(d){return this.angleWithSep(d.x,d.y)},angleWithSep(d,l){return Math.atan2(this.x*l-this.y*d,this.x*d+this.y*l)},_matMult(d){const l=d[2]*this.x+d[3]*this.y;return this.x=d[0]*this.x+d[1]*this.y,this.y=l,this},_add(d){return this.x+=d.x,this.y+=d.y,this},_sub(d){return this.x-=d.x,this.y-=d.y,this},_mult(d){return this.x*=d,this.y*=d,this},_div(d){return this.x/=d,this.y/=d,this},_multByPoint(d){return this.x*=d.x,this.y*=d.y,this},_divByPoint(d){return this.x/=d.x,this.y/=d.y,this},_unit(){return this._div(this.mag()),this},_perp(){const d=this.y;return this.y=this.x,this.x=-d,this},_rotate(d){const l=Math.cos(d),h=Math.sin(d),m=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=m,this},_rotateAround(d,l){const h=Math.cos(d),m=Math.sin(d),_=l.y+m*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-m*(this.y-l.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ce},Ce.convert=function(d){if(d instanceof Ce)return d;if(Array.isArray(d))return new Ce(+d[0],+d[1]);if(d.x!==void 0&&d.y!==void 0)return new Ce(+d.x,+d.y);throw new Error("Expected [x, y] or {x, y} point format")};const $p=Math.PI/180,Zp=180/Math.PI;function wr(d){return d*$p}function Fo(d){return d*Zp}const Q0=[[0,0],[1,0],[1,1],[0,1]];function qp(d){if(d<=0)return 0;if(d>=1)return 1;const l=d*d,h=l*d;return 4*(d<.5?h:3*(d-l)+h-.75)}function Xt(d,l,h,m){const _=new jd(d,l,h,m);return function(S){return _.solve(S)}}const ot=Xt(.25,.1,.25,1);function ct(d,l,h){return Math.min(h,Math.max(l,d))}function St(d,l,h){return(h=ct((h-d)/(l-d),0,1))*h*(3-2*h)}function Ft(d,l,h){const m=h-l,_=((d-l)%m+m)%m+l;return _===l?h:_}function Bt(d,l,h){if(!d.length)return h(null,[]);let m=d.length;const _=new Array(d.length);let S=null;d.forEach((T,M)=>{l(T,(L,k)=>{L&&(S=L),_[M]=k,--m==0&&h(S,_)})})}let Wt=1;function ne(){return Wt++}function $t(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log2(d)))}function ie(d,l){d.forEach(h=>{l[h]&&(l[h]=l[h].bind(l))})}function ke(d,l,h){const m={};for(const _ in d)m[_]=l.call(this,d[_],_,d);return m}function Me(d,l,h){const m={};for(const _ in d)l.call(this,d[_],_,d)&&(m[_]=d[_]);return m}function mi(d){return Array.isArray(d)?d.map(mi):typeof d=="object"&&d?ke(d,mi):d}function Gi(d,l){for(let h=0;h<d.length;h++)if(l.indexOf(d[h])>=0)return!0;return!1}const Bi={};function Mi(d){Bi[d]||(typeof console<"u"&&console.warn(d),Bi[d]=!0)}function dr(d,l,h){return(h.y-d.y)*(l.x-d.x)>(l.y-d.y)*(h.x-d.x)}function pr(d){let l=0;for(let h,m,_=0,S=d.length,T=S-1;_<S;T=_++)h=d[_],m=d[T],l+=(m.x-h.x)*(h.y+m.y);return l}function nn([d,l,h]){const m=wr(l+90),_=wr(h);return{x:d*Math.cos(m)*Math.sin(_),y:d*Math.sin(m)*Math.sin(_),z:d*Math.cos(_),azimuthal:l,polar:h}}function Xn(d){return(typeof self<"u"||d!==void 0)&&typeof WorkerGlobalScope<"u"&&(d!==void 0?d:self)instanceof WorkerGlobalScope}function ba(d){const l={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,_,S)=>{const T=_||S;return l[m]=!T||T.toLowerCase(),""}),l["max-age"]){const h=parseInt(l["max-age"],10);isNaN(h)?delete l["max-age"]:l["max-age"]=h}return l}let aa=null;function ea(d,l){return[d[4*l],d[4*l+1],d[4*l+2],d[4*l+3]]}function en(d,l,h,m){for(;l<h;){const _=l+h>>1;d[_]<m?l=_+1:h=_}return l}function Sr(d,l,h,m){for(;l<h;){const _=l+h>>1;d[_]<=m?l=_+1:h=_}return l}function Tn(d){return d>0?1/(1.001-d):1+d}function jn(d){return d>0?1-1/(1.001-d):-d}function sn(d,l,h){return(d-l.min)*(h.max-h.min)/(l.max-l.min)+h.min}const An={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!An.API_URL)return null;try{const d=new URL(An.API_URL);return d.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":d.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function za(d){return An.API_URL_REGEX.test(d)}function No(d){return An.API_SPRITE_REGEX.test(d)}let ml,Mh,Ga,vl,Xo,Bl;function bs(){return ml==null&&(ml=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ml}const ws={now:()=>vl!==void 0?vl:performance.now(),setNow(d){vl=d},restoreNow(){vl=void 0},frame(d){const l=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(l)}},getImageData(d,l=0){const{width:h,height:m}=d;Xo||(Xo=document.createElement("canvas"));const _=Xo.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(h>Xo.width||m>Xo.height)&&(Xo.width=h,Xo.height=m),_.clearRect(-l,-l,h+2*l,m+2*l),_.drawImage(d,0,0,h,m),_.getImageData(-l,-l,h+2*l,m+2*l)},resolveURL:d=>(Mh||(Mh=document.createElement("a")),Mh.href=d,Mh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ga==null&&(Ga=window.matchMedia("(prefers-reduced-motion: reduce)")),Ga.matches)},hasCanvasFingerprintNoise(){if(Bl!==void 0)return Bl;if(!bs())return Bl=!1,!1;const d=new OffscreenCanvas(85,1),l=d.getContext("2d",{willReadFrequently:!0});let h=0;for(let _=0;_<d.width;++_)l.fillStyle=`rgba(${h++},${h++},${h++}, 255)`,l.fillRect(_,0,1,1);const m=l.getImageData(0,0,d.width,d.height);h=0;for(let _=0;_<m.data.length;++_)if(_%4!=3&&h++!==m.data[_])return Bl=!0,!0;return Bl=!1,!1}};function Ov(d,l){const h=d.indexOf("?");if(h<0)return`${d}?${new URLSearchParams(l).toString()}`;const m=new URLSearchParams(d.slice(h));for(const _ in l)m.set(_,l[_]);return`${d.slice(0,h)}?${m.toString()}`}function Xp(d,l={persistentParams:[]}){const h=d.indexOf("?");if(h<0)return d;const m=new URLSearchParams,_=new URLSearchParams(d.slice(h));for(const T of l.persistentParams){const M=_.get(T);M&&m.set(T,M)}const S=m.toString();return`${d.slice(0,h)}${S.length>0?`?${S}`:""}`}const Yp="mapbox-tiles";let Kp=500,ls=50;const Fl=["language","worldview","jobid"];let Yo,Hs;function Fc(){try{return caches}catch{}}function Ch(){const d=Fc();d&&Yo==null&&(Yo=d.open(Yp))}let zv=1/0;const Bv={supported:!1,testSupport:function(d){!tx&&Su&&(YS?ex(d):sc=d)}};let sc,Su,tx=!1,YS=!1;const _l=typeof self<"u"?self:{};function ex(d){const l=d.createTexture();d.bindTexture(d.TEXTURE_2D,l);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Su),d.isContextLost())return;Bv.supported=!0}catch{}d.deleteTexture(l),tx=!0}_l.document&&(Su=_l.document.createElement("img"),Su.onload=function(){sc&&ex(sc),sc=null,YS=!0},Su.onerror=function(){tx=!0,sc=null},Su.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Eh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Eh);class Dh extends Error{constructor(l,h,m){h===401&&za(m)&&(l+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(l),this.status=h,this.url=m}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ix=Xn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Jp=function(d,l){if(!(/^file:/.test(h=d.url)||/^file:/.test(ix())&&!/^\w+:/.test(h))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(m,_){const S=new AbortController,T=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:ix(),referrerPolicy:m.referrerPolicy,signal:S.signal});let M=!1,L=!1;const k=(F=T.url).indexOf("sku=")>0&&za(F);var F;m.type==="json"&&T.headers.set("Accept","application/json");const V=(Z,q,Q)=>{if(L)return;if(Z&&Z.message!=="SecurityError"&&Mi(Z.toString()),q&&Q)return U(q);const it=Date.now();fetch(T).then(at=>{if(at.ok){const dt=k?at.clone():null;return U(at,dt,it)}return _(new Dh(at.statusText,at.status,m.url))}).catch(at=>{at.name!=="AbortError"&&_(new Error(`${at.message} ${m.url}`))})},U=(Z,q,Q)=>{(m.type==="arrayBuffer"?Z.arrayBuffer():m.type==="json"?Z.json():Z.text()).then(it=>{L||(q&&Q&&function(at,dt,mt){if(Ch(),Yo==null)return;const _t=ba(dt.headers.get("Cache-Control")||"");if(_t["no-store"])return;const Dt={status:dt.status,statusText:dt.statusText,headers:new Headers};dt.headers.forEach((Nt,Ht)=>Dt.headers.set(Ht,Nt)),_t["max-age"]&&Dt.headers.set("Expires",new Date(mt+1e3*_t["max-age"]).toUTCString());const At=Dt.headers.get("Expires");if(!At||new Date(At).getTime()-mt<42e4)return;let Ot=Xp(at.url,{persistentParams:Fl});if(dt.status===206){const Nt=at.headers.get("Range");if(!Nt)return;Dt.status=200,Ot=Ov(Ot,{range:Nt})}(function(Nt,Ht){if(Hs===void 0)try{new Response(new ReadableStream),Hs=!0}catch{Hs=!1}Hs?Ht(Nt.body):Nt.blob().then(Ht).catch(se=>Mi(se.message))})(dt,Nt=>{const Ht=new Response((se=dt.status)!==200&&se!==404&&[101,103,204,205,304].includes(se)?null:Nt,Dt);var se;Ch(),Yo!=null&&Yo.then(Kt=>Kt.put(Ot,Ht)).catch(Kt=>Mi(Kt.message))})}(T,q,Q),M=!0,_(null,it,Z.headers))}).catch(it=>{L||_(new Error(it.message))})};return k?function(Z,q){if(Ch(),Yo==null)return q(null);Yo.then(Q=>{let it=Xp(Z.url,{persistentParams:Fl});const at=Z.headers.get("Range");at&&(it=Ov(it,{range:at})),Q.match(it).then(dt=>{const mt=function(_t){if(!_t)return!1;const Dt=new Date(_t.headers.get("Expires")||0),At=ba(_t.headers.get("Cache-Control")||"");return Number(Dt)>Date.now()&&!At["no-cache"]}(dt);Q.delete(it).catch(q),mt&&Q.put(it,dt.clone()).catch(q),q(null,dt,mt)}).catch(q)}).catch(q)}(T,V):V(null,null),{cancel:()=>{L=!0,M||S.abort()}}}(d,l);if(Xn(self)&&self.worker.actor)return self.worker.actor.send("getResource",d,l,void 0,!0)}var h;return function(m,_){const S=new XMLHttpRequest;S.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(S.responseType="arraybuffer");for(const T in m.headers)S.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=m.credentials==="include",S.onerror=()=>{_(new Error(S.statusText))},S.onload=()=>{if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let T=S.response;if(m.type==="json")try{T=JSON.parse(S.response)}catch(L){return _(L)}const M=new Headers;S.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(L=>{const k=L.split(": "),F=k.shift(),V=k.join(": ");M.append(F,V)}),_(null,T,M)}else _(new Dh(S.statusText,S.status,m.url))},S.send(m.body),{cancel:()=>S.abort()}}(d,l)},Wd=function(d,l){return Jp(Object.assign(d,{type:"arrayBuffer"}),l)};function Ur(d){const l=document.createElement("a");return l.href=d,l.protocol===location.protocol&&l.host===location.host}const rx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qp,tg;Qp=[],tg=0;const nx=function(d,l){if(Bv.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),tg>=An.MAX_PARALLEL_IMAGE_REQUESTS){const S={requestParameters:d,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return Qp.push(S),S}tg++;let h=!1;const m=()=>{if(!h)for(h=!0,tg--;Qp.length&&tg<An.MAX_PARALLEL_IMAGE_REQUESTS;){const S=Qp.shift(),{requestParameters:T,callback:M,cancelled:L}=S;L||(S.cancel=nx(T,M).cancel)}},_=Wd(d,(S,T,M)=>{m(),S?l(S):T&&(self.createImageBitmap?function(L,k){const F=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(F).then(V=>{k(null,V)}).catch(V=>{k(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(T,(L,k)=>l(L,k,M)):function(L,k){const F=new Image;F.onload=()=>{k(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame(()=>{F.src=rx})},F.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Blob([new Uint8Array(L)],{type:"image/png"});F.src=L.byteLength?URL.createObjectURL(V):rx}(T,(L,k)=>l(L,k,M)))});return{cancel:()=>{_.cancel(),m()}}};var eg,ig,rg,Ph={exports:{}},KS={exports:{}},Fv={exports:{}},OE=function(){if(rg)return Ph.exports;rg=1;var d=(eg||(eg=1,KS.exports=function(h,m){var _,S,T,M,L,k,F,V;for(S=h.length-(_=3&h.length),T=m,L=3432918353,k=461845907,V=0;V<S;)F=255&h.charCodeAt(V)|(255&h.charCodeAt(++V))<<8|(255&h.charCodeAt(++V))<<16|(255&h.charCodeAt(++V))<<24,++V,T=27492+(65535&(M=5*(65535&(T=(T^=F=(65535&(F=(F=(65535&F)*L+(((F>>>16)*L&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(F=0,_){case 3:F^=(255&h.charCodeAt(V+2))<<16;case 2:F^=(255&h.charCodeAt(V+1))<<8;case 1:T^=F=(65535&(F=(F=(65535&(F^=255&h.charCodeAt(V)))*L+(((F>>>16)*L&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295}return T^=h.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),KS.exports),l=(ig||(ig=1,Fv.exports=function(h,m){for(var _,S=h.length,T=m^S,M=0;S>=4;)_=1540483477*(65535&(_=255&h.charCodeAt(M)|(255&h.charCodeAt(++M))<<8|(255&h.charCodeAt(++M))<<16|(255&h.charCodeAt(++M))<<24))+((1540483477*(_>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),S-=4,++M;switch(S){case 3:T^=(255&h.charCodeAt(M+2))<<16;case 2:T^=(255&h.charCodeAt(M+1))<<8;case 1:T=1540483477*(65535&(T^=255&h.charCodeAt(M)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),Fv.exports);return Ph.exports=d,Ph.exports.murmur3=d,Ph.exports.murmur2=l,Ph.exports}(),ng=Wp(OE);class js{constructor(l,...h){Object.assign(this,h[0]||{}),this.type=l}}class ag extends js{constructor(l,h={}){super("error",Object.assign({error:l},h))}}function $d(d,l,h){h[d]&&h[d].indexOf(l)!==-1||(h[d]=h[d]||[],h[d].push(l))}function og(d,l,h){if(h&&h[d]){const m=h[d].indexOf(l);m!==-1&&h[d].splice(m,1)}}class Nc{on(l,h){return this._listeners=this._listeners||{},$d(l,h,this._listeners),this}off(l,h){return og(l,h,this._listeners),og(l,h,this._oneTimeListeners),this}once(l,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},$d(l,h,this._oneTimeListeners),this):new Promise(m=>{this.once(l,m)})}fire(l,h){const m=typeof l=="string"?new js(l,h):l,_=m.type;if(this.listens(_)){m.target=this;const S=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const L of S)L.call(this,m);const T=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const L of T)og(_,L,this._oneTimeListeners),L.call(this,m);const M=this._eventedParent;if(M){const L=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(m,L),M.fire(m)}}else m instanceof ag&&console.error(m.error);return this}listens(l){return!!(this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l))}setEventedParent(l,h){return this._eventedParent=l,this._eventedParentData=h,this}}class Ba{constructor(l){typeof l=="string"?this.name=l:(this.name=l.name,this.iconsetId=l.iconsetId)}static from(l){return new Ba(l)}static toString(l){return l.iconsetId?`${l.name}${l.iconsetId}`:l.name}static parse(l){const[h,m]=l.split("");return new Ba({name:h,iconsetId:m})}static isEqual(l,h){return l.name===h.name&&l.iconsetId===h.iconsetId}toString(){return Ba.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ax,ox={},sx=function(){if(ax)return ox;ax=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(S){return(S=Math.round(S))<0?0:S>255?255:S}function h(S){return l(S[S.length-1]==="%"?parseFloat(S)/100*255:parseInt(S))}function m(S){return(T=S[S.length-1]==="%"?parseFloat(S)/100:parseFloat(S))<0?0:T>1?1:T;var T}function _(S,T,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?S+(T-S)*M*6:2*M<1?T:3*M<2?S+(T-S)*(2/3-M)*6:S}try{ox.parseCSSColor=function(S){var T,M=S.replace(/ /g,"").toLowerCase();if(M in d)return d[M].slice();if(M[0]==="#")return M.length===4?(T=parseInt(M.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:M.length===7&&(T=parseInt(M.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var L=M.indexOf("("),k=M.indexOf(")");if(L!==-1&&k+1===M.length){var F=M.substr(0,L),V=M.substr(L+1,k-(L+1)).split(","),U=1;switch(F){case"rgba":if(V.length!==4)return null;U=m(V.pop());case"rgb":return V.length!==3?null:[h(V[0]),h(V[1]),h(V[2]),U];case"hsla":if(V.length!==4)return null;U=m(V.pop());case"hsl":if(V.length!==3)return null;var Z=(parseFloat(V[0])%360+360)%360/360,q=m(V[1]),Q=m(V[2]),it=Q<=.5?Q*(q+1):Q+q-Q*q,at=2*Q-it;return[l(255*_(at,it,Z+1/3)),l(255*_(at,it,Z)),l(255*_(at,it,Z-1/3)),U];default:return null}}return null}}catch{}return ox}();class Xr{constructor(l,h,m,_=1){this.r=l,this.g=h,this.b=m,this.a=_}static parse(l){if(!l)return;if(l instanceof Xr)return l;if(typeof l!="string")return;const h=sx.parseCSSColor(l);return h?new Xr(h[0]/255,h[1]/255,h[2]/255,h[3]):void 0}toString(){const[l,h,m,_]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*l)},${Math.round(255*h)},${Math.round(255*m)},${_})`}toNonPremultipliedRenderColor(l){const{r:h,g:m,b:_,a:S}=this;return new JS(l,h,m,_,S)}toPremultipliedRenderColor(l){const{r:h,g:m,b:_,a:S}=this;return new QS(l,h*S,m*S,_*S,S)}clone(){return new Xr(this.r,this.g,this.b,this.a)}}class lx{constructor(l,h,m,_,S,T=!1){if(this.premultiplied=!1,this.premultiplied=T,l){const M=l.image.height,L=M*M;this.premultiplied?(h=S===0?0:h/S*(M-1),m=S===0?0:m/S*(M-1),_=S===0?0:_/S*(M-1)):(h*=M-1,m*=M-1,_*=M-1);const k=Math.floor(h),F=Math.floor(m),V=Math.floor(_),U=Math.ceil(h),Z=Math.ceil(m),q=Math.ceil(_),Q=h-k,it=m-F,at=_-V,dt=l.image.data,mt=4*(k+F*L+V*M),_t=4*(k+F*L+q*M),Dt=4*(k+Z*L+V*M),At=4*(k+Z*L+q*M),Ot=4*(U+F*L+V*M),Nt=4*(U+F*L+q*M),Ht=4*(U+Z*L+V*M),se=4*(U+Z*L+q*M);if(mt<0||se>=dt.length)throw new Error("out of range");this.r=zi(zi(zi(dt[mt],dt[_t],at),zi(dt[Dt],dt[At],at),it),zi(zi(dt[Ot],dt[Nt],at),zi(dt[Ht],dt[se],at),it),Q)/255*(this.premultiplied?S:1),this.g=zi(zi(zi(dt[mt+1],dt[_t+1],at),zi(dt[Dt+1],dt[At+1],at),it),zi(zi(dt[Ot+1],dt[Nt+1],at),zi(dt[Ht+1],dt[se+1],at),it),Q)/255*(this.premultiplied?S:1),this.b=zi(zi(zi(dt[mt+2],dt[_t+2],at),zi(dt[Dt+2],dt[At+2],at),it),zi(zi(dt[Ot+2],dt[Nt+2],at),zi(dt[Ht+2],dt[se+2],at),it),Q)/255*(this.premultiplied?S:1),this.a=S}else this.r=h,this.g=m,this.b=_,this.a=S}toArray(){const{r:l,g:h,b:m,a:_}=this;return[255*l,255*h,255*m,_]}toHslaArray(){let{r:l,g:h,b:m,a:_}=this;if(this.premultiplied){if(_===0)return[0,0,0,0];const q=1/_;l*=q,h*=q,m*=q}const S=Math.min(Math.max(l,0),1),T=Math.min(Math.max(h,0),1),M=Math.min(Math.max(m,0),1),L=Math.min(S,T,M),k=Math.max(S,T,M),F=k-L,V=.5*(L+k);if(F===0)return[0,0,100*V,_];const U=V>.5?F/(2-k-L):F/(k+L);let Z;switch(k){case S:Z=60*((T-M)/F+(T<M?6:0));break;case T:Z=60*((M-S)/F+2);break;default:Z=60*((S-T)/F+4)}return[Z,100*U,100*V,_]}toArray01(){const{r:l,g:h,b:m,a:_}=this;return[l,h,m,_]}toArray01Scaled(l){const{r:h,g:m,b:_}=this;return[h*l,m*l,_*l]}toArray01Linear(){const{r:l,g:h,b:m,a:_}=this;return[Math.pow(l,2.2),Math.pow(h,2.2),Math.pow(m,2.2),_]}}class JS extends lx{constructor(l,h,m,_,S){super(l,h,m,_,S,!1)}}class QS extends lx{constructor(l,h,m,_,S){super(l,h,m,_,S,!0)}}function zi(d,l,h){return d*(1-h)+l*h}function sg(d,l,h){return d.map((m,_)=>zi(m,l[_],h))}Xr.black=new Xr(0,0,0,1),Xr.white=new Xr(1,1,1,1),Xr.transparent=new Xr(0,0,0,0),Xr.red=new Xr(1,0,0,1),Xr.blue=new Xr(0,0,1,1);var Vc=Object.freeze({__proto__:null,array:sg,color:function(d,l,h){return new Xr(zi(d.r,l.r,h),zi(d.g,l.g,h),zi(d.b,l.b,h),zi(d.a,l.a,h))},number:zi});class yl extends Error{constructor(l,h){super(h),this.message=h,this.key=l}}class xl{constructor(l,h=[]){this.parent=l,this.bindings={};for(const[m,_]of h)this.bindings[m]=_}concat(l){return new xl(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Zd={kind:"null"},yi={kind:"number"},kr={kind:"string"},$r={kind:"boolean"},Ss={kind:"color"},qd={kind:"object"},Jr={kind:"value"},lg={kind:"collator"},Lh={kind:"formatted"},cg={kind:"resolvedImage"};function to(d,l){return{kind:"array",itemType:d,N:l}}function Da(d){if(d.kind==="array"){const l=Da(d.itemType);return typeof d.N=="number"?`array<${l}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${l}>`}return d.kind}const zE=[Zd,yi,kr,$r,Ss,Lh,qd,to(Jr),cg];function ug(d,l){if(l.kind==="error")return null;if(d.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!ug(d.itemType,l.itemType))&&(typeof d.N!="number"||d.N===l.N))return null}else{if(d.kind===l.kind)return null;if(d.kind==="value"){for(const h of zE)if(!ug(h,l))return null}}return`Expected ${Da(d)} but found ${Da(l)} instead.`}function cx(d,l){return l.some(h=>h.kind===d.kind)}function hg(d,l){return l.some(h=>h==="null"?d===null:h==="array"?Array.isArray(d):h==="object"?d&&!Array.isArray(d)&&typeof d=="object":h===typeof d)}function Nv(d,l){return d.kind==="array"&&l.kind==="array"?d.N===l.N&&Nv(d.itemType,l.itemType):d.kind===l.kind}class ux{constructor(l,h,m){this.sensitivity=l?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,h){return this.collator.compare(l,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dg{constructor(l,h,m,_,S){this.text=l.normalize?l.normalize():l,this.image=h,this.scale=m,this.fontStack=_,this.textColor=S}}class Za{constructor(l){this.sections=l}static fromString(l){return new Za([new dg(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||!!l.image&&l.image.hasPrimary())}static factory(l){return l instanceof Za?l:Za.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}serialize(){const l=["format"];for(const h of this.sections){if(h.image){const _=h.image.getPrimary().id.toString();l.push(["image",_]);continue}l.push(h.text);const m={};h.fontStack&&(m["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(m["font-scale"]=h.scale),h.textColor&&(m["text-color"]=["rgba"].concat(h.textColor.toNonPremultipliedRenderColor(null).toArray())),l.push(m)}return l}}class Uc{constructor(l,h={}){if(this.id=Ba.from(l),this.options=Object.assign({},h),h.transform){const{a:m,b:_,c:S,d:T,e:M,f:L}=h.transform;this.options.transform=new DOMMatrix([m,_,S,T,M,L])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:l,b:h,c:m,d:_,e:S,f:T}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:l,b:h,c:m,d:_,e:S,f:T}})}static parse(l){let h,m,_,S;try{({name:h,iconsetId:m,params:_,transform:S}=JSON.parse(l)||{})}catch{return null}if(!h)return null;const{a:T,b:M,c:L,d:k,e:F,f:V}=S||{};return new Uc({name:h,iconsetId:m},{params:_,transform:new DOMMatrix([T,M,L,k,F,V])})}scaleSelf(l,h){return this.options.transform.scaleSelf(l,h),this}}class cs{constructor(l,h,m,_,S=!1){this.primaryId=Ba.from(l),this.primaryOptions=h,m&&(this.secondaryId=Ba.from(m)),this.secondaryOptions=_,this.available=S}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Uc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Uc(this.secondaryId,this.secondaryOptions):null}static from(l){return typeof l=="string"?cs.build({name:l}):l}static build(l,h,m,_){return!l||typeof l=="object"&&!("name"in l)?null:new cs(l,m,h,_)}}function Vv(d,l,h,m){return typeof d=="number"&&d>=0&&d<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[d,l,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[d,l,h,m]:[d,l,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xd(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof Xr||d instanceof ux||d instanceof Za||d instanceof cs)return!0;if(Array.isArray(d)){for(const l of d)if(!Xd(l))return!1;return!0}if(typeof d=="object"){for(const l in d)if(!Xd(d[l]))return!1;return!0}return!1}function Ha(d){if(d===null)return Zd;if(typeof d=="string")return kr;if(typeof d=="boolean")return $r;if(typeof d=="number")return yi;if(d instanceof Xr)return Ss;if(d instanceof ux)return lg;if(d instanceof Za)return Lh;if(d instanceof cs)return cg;if(Array.isArray(d)){const l=d.length;let h;for(const m of d){const _=Ha(m);if(h){if(h===_)continue;h=Jr;break}h=_}return to(h||Jr,l)}return qd}function lc(d){const l=typeof d;return d===null?"":l==="string"||l==="number"||l==="boolean"?String(d):d instanceof Za||d instanceof cs||d instanceof Xr?d.toString():JSON.stringify(d)}class Gc{constructor(l,h){this.type=l,this.value=h}static parse(l,h){if(l.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Xd(l[1]))return h.error("invalid value");const m=l[1];let _=Ha(m);const S=h.expectedType;return _.kind!=="array"||_.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(_=S),new Gc(_,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Za?this.value.serialize():this.value}}class oa{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const lr={string:kr,number:yi,boolean:$r,object:qd};class fi{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let m,_=1;const S=l[0];if(S==="array"){let M,L;if(l.length>2){const k=l[1];if(typeof k!="string"||!(k in lr)||k==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);M=lr[k],_++}else M=Jr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return h.error('The length argument to "array" must be a positive integer literal',2);L=l[2],_++}m=to(M,L)}else m=lr[S];const T=[];for(;_<l.length;_++){const M=h.parse(l[_],_,Jr);if(!M)return null;T.push(M)}return new fi(m,T)}evaluate(l){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(l);if(!ug(this.type,Ha(m)))return m;if(h===this.args.length-1)throw new oa(`The expression ${JSON.stringify(this.args[h].serialize())} evaluated to ${Da(Ha(m))} but was expected to be of type ${Da(this.type)}.`)}return null}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=this.type,h=[l.kind];if(l.kind==="array"){const m=l.itemType;if(m.kind==="string"||m.kind==="number"||m.kind==="boolean"){h.push(m.kind);const _=l.N;(typeof _=="number"||this.args.length>1)&&h.push(_)}}return h.concat(this.args.map(m=>m.serialize()))}}class Rh{constructor(l){this.type=Lh,this.sections=l}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const _=[];let S=!1;for(let T=1;T<=l.length-1;++T){const M=l[T];if(S&&typeof M=="object"&&!Array.isArray(M)){S=!1;let L=null;if(M["font-scale"]&&(L=h.parseObjectValue(M["font-scale"],T,"font-scale",yi),!L))return null;let k=null;if(M["text-font"]&&(k=h.parseObjectValue(M["text-font"],T,"text-font",to(kr)),!k))return null;let F=null;if(M["text-color"]&&(F=h.parseObjectValue(M["text-color"],T,"text-color",Ss),!F))return null;const V=_[_.length-1];V.scale=L,V.font=k,V.textColor=F}else{const L=h.parse(l[T],T,Jr);if(!L)return null;const k=L.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,_.push({content:L,scale:null,font:null,textColor:null})}}return new Rh(_)}evaluate(l){return new Za(this.sections.map(h=>{const m=h.content.evaluate(l);return Nv(Ha(m),cg)?new dg("",m,null,null,null):new dg(lc(m),null,h.scale?h.scale.evaluate(l):null,h.font?h.font.evaluate(l).join(","):null,h.textColor?h.textColor.evaluate(l):null)}))}eachChild(l){for(const h of this.sections)l(h.content),h.scale&&l(h.scale),h.font&&l(h.font),h.textColor&&l(h.textColor)}outputDefined(){return!1}serialize(){const l=["format"];for(const h of this.sections){l.push(h.content.serialize());const m={};h.scale&&(m["font-scale"]=h.scale.serialize()),h.font&&(m["text-font"]=h.font.serialize()),h.textColor&&(m["text-color"]=h.textColor.serialize()),l.push(m)}return l}}class $i{constructor(l,h,m,_){this._imageWarnHistory={},this.type=cg,this.namePrimary=l,this.nameSecondary=h,m&&(this.paramsPrimary=m.params,this.iconsetIdPrimary=m.iconset?m.iconset.id:void 0),_&&(this.paramsSecondary=_.params,this.iconsetIdSecondary=_.iconset?_.iconset.id:void 0)}static parse(l,h){if(l.length<2)return h.error("Expected two or more arguments.");let m=1;const _=[];function S(){if(m<l.length){const M=h.parse(l[m],m++,kr);return M?(_.push({image:M,options:{}}),!0):(h.error(_.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function T(){if(m<l.length){const L=l[m];if((M=L)===null||typeof M!="object"||Array.isArray(M))return!0;const k=L.params,F=L.iconset,V=h.concat(m);if(!k&&!F)return m++,!0;if(k){if(typeof k!="object"||k.constructor!==Object)return V.error('Image options "params" should be an object'),!1;const U={},Z=V.concat(void 0,"params");for(const q in k){if(!q)return Z.error("Image parameter name should be non-empty"),!1;const Q=Z.concat(void 0,q).parse(k[q],void 0,Ss,void 0,{typeAnnotation:"coerce"});if(!Q)return!1;U[q]=Q}_[_.length-1].options.params=U}if(F){if(typeof F!="object"||F.constructor!==Object)return V.error('Image options "iconset" should be an object'),!1;if(!F.id)return V.error('Image options "iconset" should have an "id" property'),!1;_[_.length-1].options.iconset=F}return m++,!0}var M;return!0}for(let M=0;M<2;M++)if(!S()||!T())return;return new $i(_[0].image,_[1]?_[1].image:void 0,_[0].options,_[1]?_[1].options:void 0)}evaluateParams(l,h){const m={};if(h){for(const _ in h)if(h[_])try{m[_]=h[_].evaluate(l)}catch{continue}if(Object.keys(m).length!==0)return{params:m}}}evaluate(l){const h={name:this.namePrimary.evaluate(l),iconsetId:this.iconsetIdPrimary},m=this.nameSecondary?{name:this.nameSecondary.evaluate(l),iconsetId:this.iconsetIdSecondary}:void 0,_=cs.build(h,m,this.paramsPrimary?this.evaluateParams(l,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(l,this.paramsSecondary):void 0);if(_&&l.availableImages){const S=_.getPrimary().id;if(_.available=l.availableImages.some(T=>Ba.isEqual(T,S)),_.available){const T=_.getSecondary()?_.getSecondary().id:null;T&&(_.available=l.availableImages.some(M=>Ba.isEqual(M,T)))}}return _}eachChild(l){if(l(this.namePrimary),this.paramsPrimary)for(const h in this.paramsPrimary)this.paramsPrimary[h]&&l(this.paramsPrimary[h]);if(this.nameSecondary&&(l(this.nameSecondary),this.paramsSecondary))for(const h in this.paramsSecondary)this.paramsSecondary[h]&&l(this.paramsSecondary[h])}outputDefined(){return!1}serializeOptions(l,h){const m={};if(h&&(m.iconset={id:h}),l){m.params={};for(const _ in l)l[_]&&(m.params[_]=l[_].serialize())}return Object.keys(m).length>0?m:void 0}serialize(){const l=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const h=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);h&&l.push(h)}if(this.nameSecondary&&(l.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const h=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);h&&l.push(h)}return l}}function Yd(d){return Ni(d)?"string":fg(d)?"number":Gv(d)?"boolean":Array.isArray(d)?"array":d===null?"null":Uv(d)?"object":typeof d}function Uv(d){return d!=null&&!Array.isArray(d)&&typeof d!="function"&&!(d instanceof String||d instanceof Number||d instanceof Boolean)&&typeof d=="object"}function Ni(d){return typeof d=="string"||d instanceof String}function fg(d){return typeof d=="number"||d instanceof Number}function Gv(d){return typeof d=="boolean"||d instanceof Boolean}const tT={"to-boolean":$r,"to-color":Ss,"to-number":yi,"to-string":kr};class cc{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[0],_=[];let S=Zd;if(m==="to-array"){if(!Array.isArray(l[1]))return null;const T=l[1].length;if(h.expectedType){if(h.expectedType.kind!=="array")return h.error(`Expected ${h.expectedType.kind} but found array.`);S=to(h.expectedType.itemType,T)}else{if(!(T>0&&Xd(l[1][0])))return null;S=to(Ha(l[1][0]),T)}for(let M=0;M<T;M++){const L=l[1][M];let k;if(Array.isArray(L))k=h.parse(L,void 0,S.itemType);else{const F=Yd(L);if(F!==S.itemType.kind)return h.error(`Expected ${S.itemType.kind} but found ${F}.`);k=h.registry.literal.parse(["literal",L===void 0?null:L],h)}if(!k)return null;_.push(k)}}else{if((m==="to-boolean"||m==="to-string")&&l.length!==2)return h.error("Expected one argument.");S=tT[m];for(let T=1;T<l.length;T++){const M=h.parse(l[T],T,Jr);if(!M)return null;_.push(M)}}return new cc(S,_)}evaluate(l){if(this.type.kind==="boolean")return!!this.args[0].evaluate(l);if(this.type.kind==="color"){let h,m;for(const _ of this.args){if(h=_.evaluate(l),m=null,h instanceof Xr)return h;if(typeof h=="string"){const S=l.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Vv(h[0],h[1],h[2],h[3]),!m))return new Xr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new oa(m||`Could not parse color from value '${typeof h=="string"?h:String(JSON.stringify(h))}'`)}if(this.type.kind==="number"){let h=null;for(const m of this.args){if(h=m.evaluate(l),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new oa(`Could not convert ${JSON.stringify(h)} to number.`)}return this.type.kind==="formatted"?Za.fromString(lc(this.args[0].evaluate(l))):this.type.kind==="resolvedImage"?cs.build(lc(this.args[0].evaluate(l))):this.type.kind==="array"?this.args.map(h=>h.evaluate(l)):lc(this.args[0].evaluate(l))}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Rh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $i(this.args[0]).serialize();const l=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(h=>{l.push(h.serialize())}),l}}const Hv=["Unknown","Point","LineString","Polygon"];class eo{constructor(l,h,m){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=l,this.options=h,this.iconImageUseTheme=m}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(l){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const l=this.featureDistanceData.center,h=this.featureDistanceData.scale,{x:m,y:_}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(m*h-l[0])+this.featureDistanceData.bearing[1]*(_*h-l[1])}return 0}parseColor(l){let h=this._parseColorCache[l];return h||(h=this._parseColorCache[l]=Xr.parse(l)),h}getConfig(l){return this.options?this.options.get(l):null}}class Vo{constructor(l,h,m,_,S){this.name=l,this.type=h,this._evaluate=m,this.args=_,this._overloadIndex=S}evaluate(l){if(!this._evaluate){const h=Vo.definitions[this.name];this._evaluate=Array.isArray(h)?h[2]:h.overloads[this._overloadIndex][1]}return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(l=>l.serialize()))}static parse(l,h){const m=l[0],_=Vo.definitions[m];if(!_)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=[];let L=null,k=-1;for(const[F,V]of T){if(Array.isArray(F)&&F.length!==l.length-1)continue;M.push(F),k++,L=new Qv(h.registry,h.path,null,h.scope,void 0,h._scope,h.options,h.iconImageUseTheme);const U=[];let Z=!1;for(let q=1;q<l.length;q++){const Q=l[q],it=Array.isArray(F)?F[q-1]:F.type,at=L.parse(Q,1+U.length,it);if(!at){Z=!0;break}U.push(at)}if(!Z)if(Array.isArray(F)&&F.length!==U.length)L.error(`Expected ${F.length} arguments, but found ${U.length} instead.`);else{for(let q=0;q<U.length;q++){const Q=Array.isArray(F)?F[q]:F.type,it=U[q];L.concat(q+1).checkSubtype(Q,it.type)}if(L.errors.length===0)return new Vo(m,S,V,U,k)}}if(M.length===1)h.errors.push(...L.errors);else{const F=(M.length?M:T.map(([U])=>U)).map(kh).join(" | "),V=[];for(let U=1;U<l.length;U++){const Z=h.parse(l[U],1+V.length);if(!Z)return null;V.push(Da(Z.type))}h.error(`Expected arguments of type ${F}, but found (${V.join(", ")}) instead.`)}return null}static register(l,h){Vo.definitions=h;for(const m in h)l[m]=Vo}}function kh(d){return Array.isArray(d)?`(${d.map(Da).join(", ")})`:`(${Da(d.type)}...)`}class Kd{constructor(l,h,m){this.type=lg,this.locale=m,this.caseSensitive=l,this.diacriticSensitive=h}static parse(l,h){if(l.length!==2)return h.error("Expected one argument.");const m=l[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const _=m["case-sensitive"]===void 0?h.parse(!1,1,$r):h.parseObjectValue(m["case-sensitive"],1,"case-sensitive",$r);if(!_)return null;const S=m["diacritic-sensitive"]===void 0?h.parse(!1,1,$r):h.parseObjectValue(m["diacritic-sensitive"],1,"diacritic-sensitive",$r);if(!S)return null;let T=null;return m.locale&&(T=h.parseObjectValue(m.locale,1,"locale",kr),!T)?null:new Kd(_,S,T)}evaluate(l){return new ux(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}serialize(){const l={};return l["case-sensitive"]=this.caseSensitive.serialize(),l["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(l.locale=this.locale.serialize()),["collator",l]}}function Hc(d,l,h=0,m=d.length-1,_=BE){for(;m>h;){if(m-h>600){const L=m-h+1,k=l-h+1,F=Math.log(L),V=.5*Math.exp(2*F/3),U=.5*Math.sqrt(F*V*(L-V)/L)*(k-L/2<0?-1:1);Hc(d,l,Math.max(h,Math.floor(l-k*V/L+U)),Math.min(m,Math.floor(l+(L-k)*V/L+U)),_)}const S=d[l];let T=h,M=m;for(io(d,h,l),_(d[m],S)>0&&io(d,h,m);T<M;){for(io(d,T,M),T++,M--;_(d[T],S)<0;)T++;for(;_(d[M],S)>0;)M--}_(d[h],S)===0?io(d,h,M):(M++,io(d,M,m)),M<=l&&(h=M+1),l<=M&&(m=M-1)}}function io(d,l,h){const m=d[l];d[l]=d[h],d[h]=m}function BE(d,l){return d<l?-1:d>l?1:0}function FE(d){let l=0;for(let h,m,_=0,S=d.length,T=S-1;_<S;T=_++)h=d[_],m=d[T],l+=(m.x-h.x)*(h.y+m.y);return l}function pg(d,l){d[0]=Math.min(d[0],l[0]),d[1]=Math.min(d[1],l[1]),d[2]=Math.max(d[2],l[0]),d[3]=Math.max(d[3],l[1])}function Tu(d,l){return!(d[0]<=l[0]||d[2]>=l[2]||d[1]<=l[1]||d[3]>=l[3])}function eT(d,l,h){const m=d[0]-l[0],_=d[1]-l[1],S=d[0]-h[0],T=d[1]-h[1];return m*T-S*_==0&&m*S<=0&&_*T<=0}function bl(d,l,h=!1){let m=!1;for(let M=0,L=l.length;M<L;M++){const k=l[M];for(let F=0,V=k.length,U=V-1;F<V;U=F++){const Z=k[U],q=k[F];if(eT(d,Z,q))return h;(S=Z)[1]>(_=d)[1]!=(T=q)[1]>_[1]&&_[0]<(T[0]-S[0])*(_[1]-S[1])/(T[1]-S[1])+S[0]&&(m=!m)}}var _,S,T;return m}function iT(d,l,h,m){const _=m[0]-h[0],S=m[1]-h[1],T=(d[0]-h[0])*S-_*(d[1]-h[1]),M=(l[0]-h[0])*S-_*(l[1]-h[1]);return T>0&&M<0||T<0&&M>0}function jv(d,l,h,m){return(_=[m[0]-h[0],m[1]-h[1]])[0]*(S=[l[0]-d[0],l[1]-d[1]])[1]-_[1]*S[0]!=0&&!(!iT(d,l,h,m)||!iT(h,m,d,l));var _,S}function gg(d){const l=new Ce(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h=new Ce(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const m of d[0])l.x>m.x&&(l.x=m.x),l.y>m.y&&(l.y=m.y),h.x<m.x&&(h.x=m.x),h.y<m.y&&(h.y=m.y);return{min:l,max:h}}const Au=8192;function NE(d,l){const h=(180+d[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,_=Math.pow(2,l.z);return[Math.round(h*_*Au),Math.round(m*_*Au)]}function rT(d,l){for(let h=0;h<l.length;h++)if(bl(d,l[h]))return!0;return!1}function VE(d,l,h){for(const m of h)for(let _=0,S=m.length,T=S-1;_<S;T=_++)if(jv(d,l,m[T],m[_]))return!0;return!1}function Iu(d,l){for(let h=0;h<d.length;++h)if(!bl(d[h],l))return!1;for(let h=0;h<d.length-1;++h)if(VE(d[h],d[h+1],l))return!1;return!0}function UE(d,l){for(let h=0;h<l.length;h++)if(Iu(d,l[h]))return!0;return!1}function hx(d,l,h){const m=[];for(let _=0;_<d.length;_++){const S=[];for(let T=0;T<d[_].length;T++){const M=NE(d[_][T],h);pg(l,M),S.push(M)}m.push(S)}return m}function Wv(d,l,h){const m=[];for(let _=0;_<d.length;_++){const S=hx(d[_],l,h);m.push(S)}return m}function dx(d,l,h,m){if(d[0]<h[0]||d[0]>h[2]){const _=.5*m;let S=d[0]-h[0]>_?-m:h[0]-d[0]>_?m:0;S===0&&(S=d[0]-h[2]>_?-m:h[2]-d[0]>_?m:0),d[0]+=S}pg(l,d)}function fx(d,l,h,m){const _=Math.pow(2,m.z)*Au,S=[m.x*Au,m.y*Au],T=[];if(!d)return T;for(const M of d)for(const L of M){const k=[L.x+S[0],L.y+S[1]];dx(k,l,h,_),T.push(k)}return T}function wl(d,l,h,m){const _=Math.pow(2,m.z)*Au,S=[m.x*Au,m.y*Au],T=[];if(!d)return T;for(const L of d){const k=[];for(const F of L){const V=[F.x+S[0],F.y+S[1]];pg(l,V),k.push(V)}T.push(k)}if(l[2]-l[0]<=_/2){(M=l)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const L of T)for(const k of L)dx(k,l,h,_)}var M;return T}class Oh{constructor(l,h){this.type=$r,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Xd(l[1])){const m=l[1];if(m.type==="FeatureCollection")for(let _=0;_<m.features.length;++_){const S=m.features[_].geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Oh(m,m.features[_].geometry)}else if(m.type==="Feature"){const _=m.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Oh(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Oh(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,m){const _=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(!T)return!1;if(m.type==="Polygon"){const M=hx(m.coordinates,S,T),L=fx(h.geometry(),_,S,T);if(!Tu(_,S))return!1;for(const k of L)if(!bl(k,M))return!1}if(m.type==="MultiPolygon"){const M=Wv(m.coordinates,S,T),L=fx(h.geometry(),_,S,T);if(!Tu(_,S))return!1;for(const k of L)if(!rT(k,M))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,m){const _=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(!T)return!1;if(m.type==="Polygon"){const M=hx(m.coordinates,S,T),L=wl(h.geometry(),_,S,T);if(!Tu(_,S))return!1;for(const k of L)if(!Iu(k,M))return!1}if(m.type==="MultiPolygon"){const M=Wv(m.coordinates,S,T),L=wl(h.geometry(),_,S,T);if(!Tu(_,S))return!1;for(const k of L)if(!UE(k,M))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const mg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},px=1/298.257223563,gx=px*(2-px),Jd=Math.PI/180;class Qd{static fromTile(l,h,m){const _=Math.PI*(1-2*(l+.5)/Math.pow(2,h)),S=Math.atan(.5*(Math.exp(_)-Math.exp(-_)))/Jd;return new Qd(S,m)}static get units(){return mg}constructor(l,h){if(l===void 0)throw new Error("No latitude given.");if(h&&!mg[h])throw new Error(`Unknown unit ${h}. Use one of: ${Object.keys(mg).join(", ")}`);const m=6378.137*Jd*(h?mg[h]:1),_=Math.cos(l*Jd),S=1/(1-gx*(1-_*_)),T=Math.sqrt(S);this.kx=m*T*_,this.ky=m*T*S*(1-gx)}distance(l,h){const m=Ws(l[0]-h[0])*this.kx,_=(l[1]-h[1])*this.ky;return Math.sqrt(m*m+_*_)}bearing(l,h){const m=Ws(h[0]-l[0])*this.kx;return Math.atan2(m,(h[1]-l[1])*this.ky)/Jd}destination(l,h,m){const _=m*Jd;return this.offset(l,Math.sin(_)*h,Math.cos(_)*h)}offset(l,h,m){return[l[0]+h/this.kx,l[1]+m/this.ky]}lineDistance(l){let h=0;for(let m=0;m<l.length-1;m++)h+=this.distance(l[m],l[m+1]);return h}area(l){let h=0;for(let m=0;m<l.length;m++){const _=l[m];for(let S=0,T=_.length,M=T-1;S<T;M=S++)h+=Ws(_[S][0]-_[M][0])*(_[S][1]+_[M][1])*(m?-1:1)}return Math.abs(h)/2*this.kx*this.ky}along(l,h){let m=0;if(h<=0)return l[0];for(let _=0;_<l.length-1;_++){const S=l[_],T=l[_+1],M=this.distance(S,T);if(m+=M,m>h)return $v(S,T,(h-(m-M))/M)}return l[l.length-1]}pointToSegmentDistance(l,h,m){let[_,S]=h,T=Ws(m[0]-_)*this.kx,M=(m[1]-S)*this.ky;if(T!==0||M!==0){const L=(Ws(l[0]-_)*this.kx*T+(l[1]-S)*this.ky*M)/(T*T+M*M);L>1?(_=m[0],S=m[1]):L>0&&(_+=T/this.kx*L,S+=M/this.ky*L)}return T=Ws(l[0]-_)*this.kx,M=(l[1]-S)*this.ky,Math.sqrt(T*T+M*M)}pointOnLine(l,h){let m=1/0,_=l[0][0],S=l[0][1],T=0,M=0;for(let L=0;L<l.length-1;L++){let k=l[L][0],F=l[L][1],V=Ws(l[L+1][0]-k)*this.kx,U=(l[L+1][1]-F)*this.ky,Z=0;V===0&&U===0||(Z=(Ws(h[0]-k)*this.kx*V+(h[1]-F)*this.ky*U)/(V*V+U*U),Z>1?(k=l[L+1][0],F=l[L+1][1]):Z>0&&(k+=V/this.kx*Z,F+=U/this.ky*Z)),V=Ws(h[0]-k)*this.kx,U=(h[1]-F)*this.ky;const q=V*V+U*U;q<m&&(m=q,_=k,S=F,T=L,M=Z)}return{point:[_,S],index:T,t:Math.max(0,Math.min(1,M))}}lineSlice(l,h,m){let _=this.pointOnLine(m,l),S=this.pointOnLine(m,h);if(_.index>S.index||_.index===S.index&&_.t>S.t){const k=_;_=S,S=k}const T=[_.point],M=_.index+1,L=S.index;!mx(m[M],T[0])&&M<=L&&T.push(m[M]);for(let k=M+1;k<=L;k++)T.push(m[k]);return mx(m[L],S.point)||T.push(S.point),T}lineSliceAlong(l,h,m){let _=0;const S=[];for(let T=0;T<m.length-1;T++){const M=m[T],L=m[T+1],k=this.distance(M,L);if(_+=k,_>l&&S.length===0&&S.push($v(M,L,(l-(_-k))/k)),_>=h)return S.push($v(M,L,(h-(_-k))/k)),S;_>l&&S.push(L)}return S}bufferPoint(l,h){const m=h/this.ky,_=h/this.kx;return[l[0]-_,l[1]-m,l[0]+_,l[1]+m]}bufferBBox(l,h){const m=h/this.ky,_=h/this.kx;return[l[0]-_,l[1]-m,l[2]+_,l[3]+m]}insideBBox(l,h){return Ws(l[0]-h[0])>=0&&Ws(l[0]-h[2])<=0&&l[1]>=h[1]&&l[1]<=h[3]}}function mx(d,l){return d[0]===l[0]&&d[1]===l[1]}function $v(d,l,h){const m=Ws(l[0]-d[0]);return[d[0]+m*h,d[1]+(l[1]-d[1])*h]}function Ws(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class Zv{constructor(l=[],h=(m,_)=>m<_?-1:m>_?1:0){if(this.data=l,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:h,compare:m}=this,_=h[l];for(;l>0;){const S=l-1>>1,T=h[S];if(m(_,T)>=0)break;h[l]=T,l=S}h[l]=_}_down(l){const{data:h,compare:m}=this,_=this.length>>1,S=h[l];for(;l<_;){let T=1+(l<<1);const M=T+1;if(M<this.length&&m(h[M],h[T])<0&&(T=M),m(h[T],S)>=0)break;h[l]=h[T],l=T}h[l]=S}}var Ne=8192;function vx(d,l){return l.dist-d.dist}const tf=100,ef=50;function vg(d){const l=[1/0,1/0,-1/0,-1/0];if(l.length!==d.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==d[h])return!1;return!0}function _g(d){return d[1]-d[0]+1}function uc(d,l){const h=d[1]>=d[0]&&d[1]<l;return h||console.warn("Distance Expression: Index is out of range"),h}function qv(d,l){if(d[0]>d[1])return[null,null];const h=_g(d);if(l){if(h===2)return[d,null];const m=Math.floor(h/2);return[[d[0],d[0]+m],[d[0]+m,d[1]]]}{if(h===1)return[d,null];const m=Math.floor(h/2)-1;return[[d[0],d[0]+m],[d[0]+m+1,d[1]]]}}function Sl(d,l){const h=[1/0,1/0,-1/0,-1/0];if(!uc(l,d.length))return h;for(let m=l[0];m<=l[1];++m)pg(h,d[m]);return h}function _r(d){const l=[1/0,1/0,-1/0,-1/0];for(let h=0;h<d.length;++h)for(let m=0;m<d[h].length;++m)pg(l,d[h][m]);return l}function rf(d,l,h){if(vg(d)||vg(l))return NaN;let m=0,_=0;return d[2]<l[0]&&(m=l[0]-d[2]),d[0]>l[2]&&(m=d[0]-l[2]),d[1]>l[3]&&(_=d[1]-l[3]),d[3]<l[1]&&(_=l[1]-d[3]),h.distance([0,0],[m,_])}function GE(d){return 360*d-180}function HE(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Xv(d,l){const h=Math.pow(2,l.z),m=(d.y/Ne+l.y)/h;return[GE((d.x/Ne+l.x)/h),HE(m)]}function jE(d,l){const h=[];for(let m=0;m<d.length;++m)h.push(Xv(d[m],l));return h}function Nn(d,l,h){const m=h.pointOnLine(l,d).point;return h.distance(d,m)}function nT(d,l,h,m,_){const S=h.slice(m[0],m[1]+1);let T=1/0;for(let M=l[0];M<=l[1];++M)if((T=Math.min(T,Nn(d[M],S,_)))===0)return 0;return T}function _x(d,l,h,m,_){const S=Math.min(_.pointToSegmentDistance(d,h,m),_.pointToSegmentDistance(l,h,m)),T=Math.min(_.pointToSegmentDistance(h,d,l),_.pointToSegmentDistance(m,d,l));return Math.min(S,T)}function WE(d,l,h,m,_){if(!uc(l,d.length)||!uc(m,h.length))return NaN;let S=1/0;for(let T=l[0];T<l[1];++T)for(let M=m[0];M<m[1];++M){if(jv(d[T],d[T+1],h[M],h[M+1]))return 0;S=Math.min(S,_x(d[T],d[T+1],h[M],h[M+1],_))}return S}function $E(d,l,h,m,_){if(!uc(l,d.length)||!uc(m,h.length))return NaN;let S=1/0;for(let T=l[0];T<=l[1];++T)for(let M=m[0];M<=m[1];++M)if((S=Math.min(S,_.distance(d[T],h[M])))===0)return S;return S}function ZE(d,l,h){if(bl(d,l,!0))return 0;let m=1/0;for(const _ of l){const S=_.length;if(S<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(_[0]!==_[S-1]&&(m=Math.min(m,h.pointToSegmentDistance(d,_[S-1],_[0])))===0||(m=Math.min(m,Nn(d,_,h)))===0)return m}return m}function qE(d,l,h,m){if(!uc(l,d.length))return NaN;for(let S=l[0];S<=l[1];++S)if(bl(d[S],h,!0))return 0;let _=1/0;for(let S=l[0];S<l[1];++S)for(const T of h)for(let M=0,L=T.length,k=L-1;M<L;k=M++){if(jv(d[S],d[S+1],T[k],T[M]))return 0;_=Math.min(_,_x(d[S],d[S+1],T[k],T[M],m))}return _}function aT(d,l){for(const h of d)for(let m=0;m<=h.length-1;++m)if(bl(h[m],l,!0))return!0;return!1}function XE(d,l,h,m=1/0){const _=_r(d),S=_r(l);if(m!==1/0&&rf(_,S,h)>=m)return m;if(Tu(_,S)){if(aT(d,l))return 0}else if(aT(l,d))return 0;let T=m;for(const M of d)for(let L=0,k=M.length,F=k-1;L<k;F=L++)for(const V of l)for(let U=0,Z=V.length,q=Z-1;U<Z;q=U++){if(jv(M[F],M[L],V[q],V[U]))return 0;T=Math.min(T,_x(M[F],M[L],V[q],V[U],h))}return T}function Yv(d,l,h,m,_,S,T){if(S===null||T===null)return;const M=rf(Sl(m,S),Sl(_,T),h);M<l&&d.push({dist:M,range1:S,range2:T})}function YE(d,l,h,m,_=1/0){let S=Math.min(m.distance(d[0],h[0][0]),_);if(S===0)return S;const T=new Zv([{dist:0,range1:[0,d.length-1],range2:[0,0]}],vx),M=l?ef:tf,L=_r(h);for(;T.length;){const k=T.pop();if(k.dist>=S)continue;const F=k.range1;if(_g(F)<=M){if(!uc(F,d.length))return NaN;if(l){const V=qE(d,F,h,m);if((S=Math.min(S,V))===0)return S}else for(let V=F[0];V<=F[1];++V){const U=ZE(d[V],h,m);if((S=Math.min(S,U))===0)return S}}else{const V=qv(F,l);if(V[0]!==null){const U=rf(Sl(d,V[0]),L,m);U<S&&T.push({dist:U,range1:V[0],range2:[0,0]})}if(V[1]!==null){const U=rf(Sl(d,V[1]),L,m);U<S&&T.push({dist:U,range1:V[1],range2:[0,0]})}}}return S}function oT(d,l,h,m,_,S=1/0){let T=Math.min(S,_.distance(d[0],h[0]));if(T===0)return T;const M=new Zv([{dist:0,range1:[0,d.length-1],range2:[0,h.length-1]}],vx),L=l?ef:tf,k=m?ef:tf;for(;M.length;){const F=M.pop();if(F.dist>=T)continue;const V=F.range1,U=F.range2;if(_g(V)<=L&&_g(U)<=k){if(!uc(V,d.length)||!uc(U,h.length))return NaN;if(l&&m?T=Math.min(T,WE(d,V,h,U,_)):l||m?l&&!m?T=Math.min(T,nT(h,U,d,V,_)):!l&&m&&(T=Math.min(T,nT(d,V,h,U,_))):T=Math.min(T,$E(d,V,h,U,_)),T===0)return T}else{const Z=qv(V,l),q=qv(U,m);Yv(M,T,_,d,h,Z[0],q[0]),Yv(M,T,_,d,h,Z[0],q[1]),Yv(M,T,_,d,h,Z[1],q[0]),Yv(M,T,_,d,h,Z[1],q[1])}}return T}function yx(d,l,h,m,_=1/0){let S=_;const T=Sl(d,[0,d.length-1]);for(const M of h)if(!(S!==1/0&&rf(T,Sl(M,[0,M.length-1]),m)>=S)&&(S=Math.min(S,oT(d,l,M,!0,m,S)),S===0))return S;return S}function Kv(d,l,h,m,_=1/0){let S=_;const T=Sl(d,[0,d.length-1]);for(const M of h){if(S!==1/0&&rf(T,_r(M),m)>=S)continue;const L=YE(d,l,M,m,S);if(isNaN(L))return L;if((S=Math.min(S,L))===0)return S}return S}function xx(d){return d==="Point"||d==="MultiPoint"||d==="LineString"||d==="MultiLineString"||d==="Polygon"||d==="MultiPolygon"}class zh{constructor(l,h){this.type=yi,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'distance' expression requires either one argument, but found ' ${l.length-1} instead.`);if(Xd(l[1])){const m=l[1];if(m.type==="FeatureCollection"){for(let _=0;_<m.features.length;++_)if(xx(m.features[_].geometry.type))return new zh(m,m.features[_].geometry)}else if(m.type==="Feature"){if(xx(m.geometry.type))return new zh(m,m.geometry)}else if(xx(m.type))return new zh(m,m)}return h.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(l){const h=l.geometry(),m=l.canonicalID();if(h!=null&&m!=null){if(l.geometryType()==="Point")return function(_,S,T){const M=[];for(const k of _)for(const F of k)M.push(Xv(F,S));const L=new Qd(M[0][1],"meters");return T.type==="Point"||T.type==="MultiPoint"||T.type==="LineString"?oT(M,!1,T.type==="Point"?[T.coordinates]:T.coordinates,T.type==="LineString",L):T.type==="MultiLineString"?yx(M,!1,T.coordinates,L):T.type==="Polygon"||T.type==="MultiPolygon"?Kv(M,!1,T.type==="Polygon"?[T.coordinates]:T.coordinates,L):null}(h,m,this.geometries);if(l.geometryType()==="LineString")return function(_,S,T){const M=[];for(const k of _){const F=[];for(const V of k)F.push(Xv(V,S));M.push(F)}const L=new Qd(M[0][0][1],"meters");if(T.type==="Point"||T.type==="MultiPoint"||T.type==="LineString")return yx(T.type==="Point"?[T.coordinates]:T.coordinates,T.type==="LineString",M,L);if(T.type==="MultiLineString"){let k=1/0;for(let F=0;F<T.coordinates.length;F++){const V=yx(T.coordinates[F],!0,M,L,k);if(isNaN(V))return V;if((k=Math.min(k,V))===0)return k}return k}if(T.type==="Polygon"||T.type==="MultiPolygon"){let k=1/0;for(let F=0;F<M.length;F++){const V=Kv(M[F],!0,T.type==="Polygon"?[T.coordinates]:T.coordinates,L,k);if(isNaN(V))return V;if((k=Math.min(k,V))===0)return k}return k}return null}(h,m,this.geometries);if(l.geometryType()==="Polygon")return function(_,S,T){const M=[];for(const k of function(F,V){const U=F.length;if(U<=1)return[F];const Z=[];let q,Q;for(let it=0;it<U;it++){const at=FE(F[it]);at!==0&&(F[it].area=Math.abs(at),Q===void 0&&(Q=at<0),Q===at<0?(q&&Z.push(q),q=[F[it]]):q.push(F[it]))}return q&&Z.push(q),Z}(_)){const F=[];for(let V=0;V<k.length;++V)F.push(jE(k[V],S));M.push(F)}const L=new Qd(M[0][0][0][1],"meters");if(T.type==="Point"||T.type==="MultiPoint"||T.type==="LineString")return Kv(T.type==="Point"?[T.coordinates]:T.coordinates,T.type==="LineString",M,L);if(T.type==="MultiLineString"){let k=1/0;for(let F=0;F<T.coordinates.length;F++){const V=Kv(T.coordinates[F],!0,M,L,k);if(isNaN(V))return V;if((k=Math.min(k,V))===0)return k}return k}return T.type==="Polygon"||T.type==="MultiPolygon"?function(k,F,V){let U=1/0;for(const Z of k)for(const q of F){const Q=XE(Z,q,V,U);if(isNaN(Q))return Q;if((U=Math.min(U,Q))===0)return U}return U}(T.type==="Polygon"?[T.coordinates]:T.coordinates,M,L):null}(h,m,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function nf(d){if(d instanceof Vo&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof Oh||d instanceof zh)return!1;if(d instanceof of)return d.featureConstant;let l=!0;return d.eachChild(h=>{l&&!nf(h)&&(l=!1)}),l}function yg(d){if(d instanceof Vo&&d.name==="feature-state")return!1;let l=!0;return d.eachChild(h=>{l&&!yg(h)&&(l=!1)}),l}function af(d,l){if(d instanceof Vo&&l.indexOf(d.name)>=0)return!1;let h=!0;return d.eachChild(m=>{h&&!af(m,l)&&(h=!1)}),h}function sT(d,l,h){return[d,l,h].filter(Boolean).join("")}function bx(d,l){switch(d){case"string":return lc(l);case"number":return+l;case"boolean":return!!l;case"color":return Xr.parse(l);case"formatted":return Za.fromString(lc(l));case"resolvedImage":return cs.build(lc(l))}return l}function lT(d,l,h,m){return m!==void 0&&(d=m*Math.round(d/m)),l!==void 0&&d<l&&(d=l),h!==void 0&&d>h&&(d=h),d}class of{constructor(l,h,m,_=!1){this.type=l,this.key=h,this.scope=m,this.featureConstant=_}static parse(l,h){let m=h.expectedType;if(m==null&&(m=Jr),l.length<2||l.length>3)return h.error("Invalid number of arguments for 'config' expression.");const _=h.parse(l[1],1);if(!(_ instanceof Gc))return h.error("Key name of 'config' expression must be a string literal.");let S,T=!0;const M=lc(_.value);if(l.length>=3){const L=h.parse(l[2],2);if(!(L instanceof Gc))return h.error("Scope of 'config' expression must be a string literal.");S=lc(L.value)}if(h.options){const L=sT(M,S,h._scope),k=h.options.get(L);k&&(T=nf(k.value||k.default))}return new of(m,M,S,T)}evaluate(l){const h=sT(this.key,this.scope,l.scope),m=l.getConfig(h);if(!m)return null;const{type:_,value:S,values:T,minValue:M,maxValue:L,stepValue:k}=m,F=m.default.evaluate(l);let V=F;if(S){const U=l.scope;l.scope=(U||"").split("").slice(1).join(""),V=S.evaluate(l),l.scope=U}return _&&(V=bx(_,V)),V===void 0||M===void 0&&L===void 0&&k===void 0||(typeof V=="number"?V=lT(V,M,L,k):Array.isArray(V)&&(V=V.map(U=>typeof U=="number"?lT(U,M,L,k):U))),S!==void 0&&V!==void 0&&T&&!T.includes(V)&&(V=F,_&&(V=bx(_,V))),(_&&_!==this.type||V!==void 0&&!Nv(Ha(V),this.type))&&(V=bx(this.type.kind,V)),V}eachChild(){}outputDefined(){return!1}serialize(){const l=["config",this.key];return this.scope&&l.concat(this.scope),l}}class Jv{constructor(l,h){this.type=h.type,this.name=l,this.boundExpression=h}static parse(l,h){if(l.length!==2||typeof l[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=l[1];return h.scope.has(m)?new Jv(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qv{constructor(l,h=[],m,_=new xl,S=[],T,M,L){this.registry=l,this.path=h,this.key=h.map(k=>typeof k=="string"?`['${k}']`:`[${k}]`).join(""),this.scope=_,this.errors=S,this.expectedType=m,this._scope=T,this.options=M,this.iconImageUseTheme=L}parse(l,h,m,_,S={}){return h||m?this.concat(h,null,m,_)._parse(l,S):this._parse(l,S)}parseObjectValue(l,h,m,_,S,T={}){return this.concat(h,m,_,S)._parse(l,T)}_parse(l,h){function m(_,S,T){return T==="assert"?new fi(S,[_]):T==="coerce"?new cc(S,[_]):_}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=typeof l[0]=="string"?this.registry[l[0]]:void 0;if(_){let S=_.parse(l,this);if(!S)return null;if(this.expectedType){const T=this.expectedType,M=S.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||M.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(T,M))return null}else S=m(S,T,h.typeAnnotation||"coerce");else S=m(S,T,h.typeAnnotation||"assert")}if(!(S instanceof Gc)&&S.type.kind!=="resolvedImage"&&Sx(S)){const T=new eo(this._scope,this.options,this.iconImageUseTheme);try{S=new Gc(S.type,S.evaluate(T))}catch(M){return this.error(M.message),null}}return S}return cc.parse(["to-array",l],this)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,h,m,_){let S=typeof l=="number"?this.path.concat(l):this.path;S=typeof h=="string"?S.concat(h):S;const T=_?this.scope.concat(_):this.scope;return new Qv(this.registry,S,m||null,T,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(l,...h){const m=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new yl(m,l))}checkSubtype(l,h){const m=ug(l,h);return m&&this.error(m),m}}function Sx(d){if(d instanceof Jv)return Sx(d.boundExpression);if(d instanceof Vo&&d.name==="error"||d instanceof Kd||d instanceof Oh||d instanceof zh||d instanceof of)return!1;const l=d instanceof cc||d instanceof fi;let h=!0;return d.eachChild(m=>{h=l?h&&Sx(m):h&&m instanceof Gc}),!!h&&nf(d)&&af(d,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function t_(d,l){const h=d.length-1;let m,_,S=0,T=h,M=0;for(;S<=T;)if(M=Math.floor((S+T)/2),m=d[M],_=d[M+1],m<=l){if(M===h||l<_)return M;S=M+1}else{if(!(m>l))throw new oa("Input is not a number.");T=M-1}return 0}class xg{constructor(l,h,m){this.type=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,S]of m)this.labels.push(_),this.outputs.push(S)}static parse(l,h){if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(l[1],1,yi);if(!m)return null;const _=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let T=1;T<l.length;T+=2){const M=T===1?-1/0:l[T],L=l[T+1],k=T,F=T+1;if(typeof M!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(_.length&&_[_.length-1][0]>=M)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const V=h.parse(L,F,S);if(!V)return null;S=S||V.type,_.push([M,V])}return new xg(S,m,_)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const _=this.input.evaluate(l);if(_<=h[0])return m[0].evaluate(l);const S=h.length;return _>=h[S-1]?m[S-1].evaluate(l):m[t_(h,_)].evaluate(l)}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){const l=["step",this.input.serialize()];for(let h=0;h<this.labels.length;h++)h>0&&l.push(this.labels[h]),l.push(this.outputs[h].serialize());return l}}const cT=.95047,uT=1.08883,hT=4/29,sf=6/29,e_=3*sf*sf,KE=sf*sf*sf,dT=Math.PI/180,JE=180/Math.PI;function Tx(d){return d>KE?Math.pow(d,1/3):d/e_+hT}function Ax(d){return d>sf?d*d*d:e_*(d-hT)}function i_(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function r_(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function Bh(d){const l=r_(d.r),h=r_(d.g),m=r_(d.b),_=Tx((.4124564*l+.3575761*h+.1804375*m)/cT),S=Tx((.2126729*l+.7151522*h+.072175*m)/1);return{l:116*S-16,a:500*(_-S),b:200*(S-Tx((.0193339*l+.119192*h+.9503041*m)/uT)),alpha:d.a}}function Ix(d){let l=(d.l+16)/116,h=isNaN(d.a)?l:l+d.a/500,m=isNaN(d.b)?l:l-d.b/200;return l=1*Ax(l),h=cT*Ax(h),m=uT*Ax(m),new Xr(i_(3.2404542*h-1.5371385*l-.4985314*m),i_(-.969266*h+1.8760108*l+.041556*m),i_(.0556434*h-.2040259*l+1.0572252*m),d.alpha)}function fT(d,l,h){const m=l-d;return d+h*(m>180||m<-180?m-360*Math.round(m/360):m)}const bg={forward:Bh,reverse:Ix,interpolate:function(d,l,h){return{l:zi(d.l,l.l,h),a:zi(d.a,l.a,h),b:zi(d.b,l.b,h),alpha:zi(d.alpha,l.alpha,h)}}},Fh={forward:function(d){const{l,a:h,b:m}=Bh(d),_=Math.atan2(m,h)*JE;return{h:_<0?_+360:_,c:Math.sqrt(h*h+m*m),l,alpha:d.a}},reverse:function(d){const l=d.h*dT,h=d.c;return Ix({l:d.l,a:Math.cos(l)*h,b:Math.sin(l)*h,alpha:d.alpha})},interpolate:function(d,l,h){return{h:fT(d.h,l.h,h),c:zi(d.c,l.c,h),l:zi(d.l,l.l,h),alpha:zi(d.alpha,l.alpha,h)}}};var n_=Object.freeze({__proto__:null,hcl:Fh,lab:bg});class $s{constructor(l,h,m,_,S){this.type=l,this.operator=h,this.interpolation=m,this.input=_,this.labels=[],this.outputs=[];for(const[T,M]of S)this.labels.push(T),this.outputs.push(M)}static interpolationFactor(l,h,m,_){let S=0;if(l.name==="exponential")S=Mx(h,l.base,m,_);else if(l.name==="linear")S=Mx(h,1,m,_);else if(l.name==="cubic-bezier"){const T=l.controlPoints;S=new jd(T[0],T[1],T[2],T[3]).solve(Mx(h,1,m,_))}return S}static parse(l,h){let[m,_,S,...T]=l;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const k=_[1];if(typeof k!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:k}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const k=_.slice(1);if(k.length!==4||k.some(F=>typeof F!="number"||F<0||F>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:k}}}if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length-1>3&&(l.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,yi),!S)return null;const M=[];let L=null;m==="interpolate-hcl"||m==="interpolate-lab"?L=Ss:h.expectedType&&h.expectedType.kind!=="value"&&(L=h.expectedType);for(let k=0;k<T.length;k+=2){const F=T[k],V=T[k+1],U=k+3,Z=k+4;if(typeof F!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(M.length&&M[M.length-1][0]>=F)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const q=h.parse(V,Z,L);if(!q)return null;L=L||q.type,M.push([F,q])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new $s(L,m,_,S,M):h.error(`Type ${Da(L)} is not interpolatable.`)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const _=this.input.evaluate(l);if(_<=h[0])return m[0].evaluate(l);const S=h.length;if(_>=h[S-1])return m[S-1].evaluate(l);const T=t_(h,_),M=$s.interpolationFactor(this.interpolation,_,h[T],h[T+1]),L=m[T].evaluate(l),k=m[T+1].evaluate(l);return this.operator==="interpolate"?Vc[this.type.kind.toLowerCase()](L,k,M):this.operator==="interpolate-hcl"?Fh.reverse(Fh.interpolate(Fh.forward(L),Fh.forward(k),M)):bg.reverse(bg.interpolate(bg.forward(L),bg.forward(k),M))}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){let l;l=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const h=[this.operator,l,this.input.serialize()];for(let m=0;m<this.labels.length;m++)h.push(this.labels[m],this.outputs[m].serialize());return h}}function Mx(d,l,h,m){const _=m-h,S=d-h;return _===0?0:l===1?S/_:(Math.pow(l,S)-1)/(Math.pow(l,_)-1)}class wg{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expectected at least one argument.");let m=null;const _=h.expectedType;_&&_.kind!=="value"&&(m=_);const S=[];for(const M of l.slice(1)){const L=h.parse(M,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!L)return null;m=m||L.type,S.push(L)}const T=_&&S.some(M=>ug(_,M.type));return new wg(T?Jr:m,S)}evaluate(l){let h,m=null,_=0;for(const S of this.args){if(_++,m=S.evaluate(l),m&&m instanceof cs&&!m.available&&(h||(h=m),m=null,_===this.args.length))return h;if(m!==null)break}return m}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=["coalesce"];return this.eachChild(h=>{l.push(h.serialize())}),l}}class Sg{constructor(l,h){this.type=h.type,this.bindings=[].concat(l),this.result=h}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const h of this.bindings)l(h[1]);l(this.result)}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const m=[];for(let S=1;S<l.length-1;S+=2){const T=l[S];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const M=h.parse(l[S+1],S+1);if(!M)return null;m.push([T,M])}const _=h.parse(l[l.length-1],l.length-1,h.expectedType,m);return _?new Sg(m,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const l=["let"];for(const[h,m]of this.bindings)l.push(h,m.serialize());return l.push(this.result.serialize()),l}}class Cx{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,yi),_=h.parse(l[2],2,to(h.expectedType||Jr));return m&&_?new Cx(_.type.itemType,m,_):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new oa("Array index out of bounds: negative index");if(h>=m.length)throw new oa("Array index out of bounds: index exceeds array size");if(h!==Math.floor(h))throw new oa("Array index must be an integer. Use at-interpolated for fractional indices");return m[h]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ex{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,yi),_=h.parse(l[2],2,to(h.expectedType||Jr));return m&&_?new Ex(_.type.itemType,m,_):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new oa(`Array index out of bounds: ${h} < 0.`);if(h>m.length-1)throw new oa(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h===Math.floor(h))return m[h];const _=Math.floor(h),S=Math.ceil(h),T=m[_],M=m[S];if(typeof T!="number"||typeof M!="number")throw new oa(`Cannot interpolate between non-number values at index ${h}.`);const L=h-_;return T*(1-L)+M*L}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Dx{constructor(l,h){this.type=$r,this.needle=l,this.haystack=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Jr),_=h.parse(l[2],2,Jr);return m&&_?cx(m.type,[$r,kr,yi,Zd,Jr])?new Dx(m,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Da(m.type)} instead`):null}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(m==null)return!1;if(!hg(h,["boolean","string","number","null"]))throw new oa(`Expected first argument to be of type boolean, string, number or null, but found ${Da(Ha(h))} instead.`);if(!hg(m,["string","array"]))throw new oa(`Expected second argument to be of type array or string, but found ${Da(Ha(m))} instead.`);return m.indexOf(h)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Tg{constructor(l,h,m){this.type=yi,this.needle=l,this.haystack=h,this.fromIndex=m}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Jr),_=h.parse(l[2],2,Jr);if(!m||!_)return null;if(!cx(m.type,[$r,kr,yi,Zd,Jr]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Da(m.type)} instead`);if(l.length===4){const S=h.parse(l[3],3,yi);return S?new Tg(m,_,S):null}return new Tg(m,_)}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!hg(h,["boolean","string","number","null"]))throw new oa(`Expected first argument to be of type boolean, string, number or null, but found ${Da(Ha(h))} instead.`);if(!hg(m,["string","array"]))throw new oa(`Expected second argument to be of type array or string, but found ${Da(Ha(m))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(l);return m.indexOf(h,_)}return m.indexOf(h)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const l=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),l]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class a_{constructor(l,h,m,_,S,T){this.inputType=l,this.type=h,this.input=m,this.cases=_,this.outputs=S,this.otherwise=T}static parse(l,h){if(l.length<5)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return h.error("Expected an even number of arguments.");let m,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const S={},T=[];for(let k=2;k<l.length-1;k+=2){let F=l[k];const V=l[k+1];Array.isArray(F)||(F=[F]);const U=h.concat(k);if(F.length===0)return U.error("Expected at least one branch label.");for(const q of F){if(typeof q!="number"&&typeof q!="string")return U.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return U.error("Numeric branch labels must be integer values.");if(m){if(U.checkSubtype(m,Ha(q)))return null}else m=Ha(q);if(S[String(q)]!==void 0)return U.error("Branch labels must be unique.");S[String(q)]=T.length}const Z=h.parse(V,k,_);if(!Z)return null;_=_||Z.type,T.push(Z)}const M=h.parse(l[1],1,Jr);if(!M)return null;const L=h.parse(l[l.length-1],l.length-1,_);return L?M.type.kind!=="value"&&h.concat(1).checkSubtype(m,M.type)?null:new a_(m,_,M,S,T,L):null}evaluate(l){const h=this.input.evaluate(l);return(Nv(Ha(h),this.inputType)&&this.outputs[this.cases[h]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["match",this.input.serialize()],h=Object.keys(this.cases).sort(),m=[],_={};for(const T of h){const M=_[this.cases[T]];M===void 0?(_[this.cases[T]]=m.length,m.push([this.cases[T],[T]])):m[M][1].push(T)}const S=T=>this.inputType.kind==="number"?Number(T):T;for(const[T,M]of m)l.push(M.length===1?S(M[0]):M.map(S)),l.push(this.outputs[T].serialize());return l.push(this.otherwise.serialize()),l}}class lf{constructor(l,h,m){this.type=l,this.branches=h,this.otherwise=m}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const _=[];for(let T=1;T<l.length-1;T+=2){const M=h.parse(l[T],T,$r);if(!M)return null;const L=h.parse(l[T+1],T+1,m);if(!L)return null;_.push([M,L]),m=m||L.type}const S=h.parse(l[l.length-1],l.length-1,m);return S?new lf(m,_,S):null}evaluate(l){for(const[h,m]of this.branches)if(h.evaluate(l))return m.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[h,m]of this.branches)l(h),l(m);l(this.otherwise)}outputDefined(){return this.branches.every(([l,h])=>h.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["case"];return this.eachChild(h=>{l.push(h.serialize())}),l}}class o_{constructor(l,h,m,_){this.type=l,this.input=h,this.beginIndex=m,this.endIndex=_}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Jr),_=h.parse(l[2],2,yi);if(!m||!_)return null;if(!cx(m.type,[to(Jr),kr,Jr]))return h.error(`Expected first argument to be of type array or string, but found ${Da(m.type)} instead`);if(l.length===4){const S=h.parse(l[3],3,yi);return S?new o_(m.type,m,_,S):null}return new o_(m.type,m,_)}evaluate(l){const h=this.input.evaluate(l),m=this.beginIndex.evaluate(l);if(!hg(h,["string","array"]))throw new oa(`Expected first argument to be of type array or string, but found ${Da(Ha(h))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(l);return h.slice(m,_)}return h.slice(m)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const l=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),l]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class s_{constructor(l,h){this.type=to(kr),this.str=l,this.delimiter=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,kr),_=h.parse(l[2],2,kr);return m&&_?new s_(m,_):void 0}evaluate(l){const h=this.str.evaluate(l),m=this.delimiter.evaluate(l);return h.split(m)}eachChild(l){l(this.str),l(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function pT(d,l){return d==="=="||d==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function gT(d,l,h,m){return m.compare(l,h)===0}function cf(d,l,h){const m=d!=="=="&&d!=="!=";return class cX{constructor(S,T,M){this.type=$r,this.lhs=S,this.rhs=T,this.collator=M,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const M=S[0];let L=T.parse(S[1],1,Jr);if(!L)return null;if(!pT(M,L.type))return T.concat(1).error(`"${M}" comparisons are not supported for type '${Da(L.type)}'.`);let k=T.parse(S[2],2,Jr);if(!k)return null;if(!pT(M,k.type))return T.concat(2).error(`"${M}" comparisons are not supported for type '${Da(k.type)}'.`);if(L.type.kind!==k.type.kind&&L.type.kind!=="value"&&k.type.kind!=="value")return T.error(`Cannot compare types '${Da(L.type)}' and '${Da(k.type)}'.`);m&&(L.type.kind==="value"&&k.type.kind!=="value"?L=new fi(k.type,[L]):L.type.kind!=="value"&&k.type.kind==="value"&&(k=new fi(L.type,[k])));let F=null;if(S.length===4){if(L.type.kind!=="string"&&k.type.kind!=="string"&&L.type.kind!=="value"&&k.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(F=T.parse(S[3],3,lg),!F)return null}return new cX(L,k,F)}evaluate(S){const T=this.lhs.evaluate(S),M=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const L=Ha(T),k=Ha(M);if(L.kind!==k.kind||L.kind!=="string"&&L.kind!=="number")throw new oa(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${L.kind}, ${k.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const L=Ha(T),k=Ha(M);if(L.kind!=="string"||k.kind!=="string")return l(S,T,M)}return this.collator?h(S,T,M,this.collator.evaluate(S)):l(S,T,M)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}serialize(){const S=[d];return this.eachChild(T=>{S.push(T.serialize())}),S}}}const mT=cf("==",function(d,l,h){return l===h},gT),vT=cf("!=",function(d,l,h){return l!==h},function(d,l,h,m){return!gT(0,l,h,m)}),QE=cf("<",function(d,l,h){return l<h},function(d,l,h,m){return m.compare(l,h)<0}),tD=cf(">",function(d,l,h){return l>h},function(d,l,h,m){return m.compare(l,h)>0}),eD=cf("<=",function(d,l,h){return l<=h},function(d,l,h,m){return m.compare(l,h)<=0}),l_=cf(">=",function(d,l,h){return l>=h},function(d,l,h,m){return m.compare(l,h)>=0});class Px{constructor(l,h,m,_,S,T){this.type=kr,this.number=l,this.locale=h,this.currency=m,this.unit=_,this.minFractionDigits=S,this.maxFractionDigits=T}static parse(l,h){if(l.length!==3)return h.error("Expected two arguments.");const m=h.parse(l[1],1,yi);if(!m)return null;const _=l[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let S=null;if(_.locale&&(S=h.parseObjectValue(_.locale,2,"locale",kr),!S))return null;let T=null;if(_.currency&&(T=h.parseObjectValue(_.currency,2,"currency",kr),!T))return null;let M=null;if(_.unit&&(M=h.parseObjectValue(_.unit,2,"unit",kr),!M))return null;let L=null;if(_["min-fraction-digits"]&&(L=h.parseObjectValue(_["min-fraction-digits"],2,"min-fraction-digits",yi),!L))return null;let k=null;return _["max-fraction-digits"]&&(k=h.parseObjectValue(_["max-fraction-digits"],2,"max-fraction-digits",yi),!k)?null:new Px(m,S,T,M,L,k)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(l):void 0,unit:this.unit?this.unit.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.unit&&l(this.unit),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const l={};return this.locale&&(l.locale=this.locale.serialize()),this.currency&&(l.currency=this.currency.serialize()),this.unit&&(l.unit=this.unit.serialize()),this.minFractionDigits&&(l["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(l["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),l]}}class Lx{constructor(l){this.type=yi,this.input=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=h.parse(l[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Da(m.type)} instead.`):new Lx(m):null}evaluate(l){const h=this.input.evaluate(l);if(typeof h=="string"||Array.isArray(h))return h.length;throw new oa(`Expected value to be of type string or array, but found ${Da(Ha(h))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){const l=["length"];return this.eachChild(h=>{l.push(h.serialize())}),l}}function _T(d){return function(){d=1831565813+(d|=0)|0;let l=Math.imul(d^d>>>15,1|d);return l=l+Math.imul(l^l>>>7,61|l)^l,((l^l>>>14)>>>0)/4294967296}}const uf={"==":mT,"!=":vT,">":tD,"<":QE,">=":l_,"<=":eD,array:fi,at:Cx,"at-interpolated":Ex,boolean:fi,case:lf,coalesce:wg,collator:Kd,format:Rh,image:$i,in:Dx,"index-of":Tg,interpolate:$s,"interpolate-hcl":$s,"interpolate-lab":$s,length:Lx,let:Sg,literal:Gc,match:a_,number:fi,"number-format":Px,object:fi,slice:o_,step:xg,string:fi,"to-boolean":cc,"to-color":cc,"to-number":cc,"to-string":cc,var:Jv,within:Oh,distance:zh,config:of,split:s_};function Rx(d,[l,h,m,_]){l=l.evaluate(d),h=h.evaluate(d),m=m.evaluate(d);const S=_?_.evaluate(d):1,T=Vv(l,h,m,S);if(T)throw new oa(T);return new Xr(l/255,h/255,m/255,S)}function yT(d,[l,h,m,_]){l=l.evaluate(d),h=h.evaluate(d),m=m.evaluate(d);const S=_?_.evaluate(d):1,T=function(k,F,V,U){return typeof k=="number"&&k>=0&&k<=360?typeof F=="number"&&F>=0&&F<=100&&typeof V=="number"&&V>=0&&V<=100?U===void 0||typeof U=="number"&&U>=0&&U<=1?null:`Invalid hsla value [${[k,F,V,U].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof U=="number"?[k,F,V,U]:[k,F,V]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof U=="number"?[k,F,V,U]:[k,F,V]).join(", ")}]: 'h' must be between 0 and 360.`}(l,h,m,S);if(T)throw new oa(T);const M=`hsla(${l}, ${h}%, ${m}%, ${S})`,L=Xr.parse(M);if(!L)throw new oa(`Failed to parse HSLA color: ${M}`);return L}function xT(d,l){return d in l}function c_(d,l){const h=l[d];return h===void 0?null:h}function jc(d){return{type:d}}function Ag(d){if(d instanceof of)return new Set([d.key]);let l=new Set;return d.eachChild(h=>{l=new Set([...l,...Ag(h)])}),l}function u_(d){if(d instanceof Vo&&d.name==="is-active-floor")return!0;let l=!1;return d.eachChild(h=>{!l&&u_(h)&&(l=!0)}),l}function Nh(d){return{result:"success",value:d}}function Mu(d){return{result:"error",value:d}}function kx(d,l){return!!d&&!!d.parameters&&d.parameters.indexOf(l)>-1}function h_(d){return d["property-type"]==="data-driven"}function Ox(d){return kx(d.expression,"measure-light")}function zx(d){return kx(d.expression,"zoom")}function d_(d){return!!d.expression&&d.expression.interpolated}function f_(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)}function Bx(d){return d}function p_(d,l){const h=l.type==="color",m=d.stops&&typeof d.stops[0][0]=="object",_=m||!(m||d.property!==void 0),S=d.type||(d_(l)?"exponential":"interval");if(h&&((d=Object.assign({},d)).stops&&(d.stops=d.stops.map(k=>[k[0],Xr.parse(k[1])])),d.default=Xr.parse(d.default?d.default:l.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!n_[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let T,M,L;if(S==="exponential")T=bT;else if(S==="interval")T=Cu;else if(S==="categorical"){T=iD,M=Object.create(null);for(const k of d.stops)M[k[0]]=k[1];L=typeof d.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);T=rD}if(m){const k={},F=[];for(let Z=0;Z<d.stops.length;Z++){const q=d.stops[Z],Q=q[0].zoom;k[Q]===void 0&&(k[Q]={zoom:Q,type:d.type,property:d.property,default:d.default,stops:[]},F.push(Q)),k[Q].stops.push([q[0].value,q[1]])}const V=[];for(const Z of F)V.push([k[Z].zoom,p_(k[Z],l)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:$s.interpolationFactor.bind(void 0,U),zoomStops:V.map(Z=>Z[0]),evaluate:({zoom:Z},q)=>bT({stops:V,base:d.base},l,Z).evaluate(Z,q)}}if(_){const k=S==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:$s.interpolationFactor.bind(void 0,k),zoomStops:d.stops.map(F=>F[0]),evaluate:({zoom:F})=>T(d,l,F,M,L)}}return{kind:"source",evaluate(k,F){const V=F&&F.properties?F.properties[d.property]:void 0;return V===void 0?hf(d.default,l.default):T(d,l,V,M,L)}}}function hf(d,l,h){return d!==void 0?d:l!==void 0?l:h!==void 0?h:void 0}function iD(d,l,h,m,_){return hf(typeof h===_?m[h]:void 0,d.default,l.default)}function Cu(d,l,h){if(!fg(h))return hf(d.default,l.default);const m=d.stops.length;if(m===1||h<=d.stops[0][0])return d.stops[0][1];if(h>=d.stops[m-1][0])return d.stops[m-1][1];const _=t_(d.stops.map(S=>S[0]),h);return d.stops[_][1]}function bT(d,l,h){const m=d.base!==void 0?d.base:1;if(!fg(h))return hf(d.default,l.default);const _=d.stops.length;if(_===1||h<=d.stops[0][0])return d.stops[0][1];if(h>=d.stops[_-1][0])return d.stops[_-1][1];const S=t_(d.stops.map(F=>F[0]),h),T=function(F,V,U,Z){const q=Z-U,Q=F-U;return q===0?0:V===1?Q/q:(Math.pow(V,Q)-1)/(Math.pow(V,q)-1)}(h,m,d.stops[S][0],d.stops[S+1][0]),M=d.stops[S][1],L=d.stops[S+1][1];let k=Vc[l.type]||Bx;if(d.colorSpace&&d.colorSpace!=="rgb"){const F=n_[d.colorSpace];k=(V,U)=>F.reverse(F.interpolate(F.forward(V),F.forward(U),T))}return typeof M.evaluate=="function"?{evaluate(...F){const V=M.evaluate.apply(void 0,F),U=L.evaluate.apply(void 0,F);if(V!==void 0&&U!==void 0)return k(V,U,T)}}:k(M,L,T)}function rD(d,l,h){return l.type==="color"?h=Xr.parse(h):l.type==="formatted"?h=Za.fromString(h.toString()):l.type==="resolvedImage"?h=cs.build(h.toString()):Yd(h)===l.type||l.type==="enum"&&l.values[h]||(h=void 0),hf(h,d.default,l.default)}Vo.register(uf,{error:[{kind:"error"},[kr],(d,[l])=>{throw new oa(l.evaluate(d))}],typeof:[kr,[Jr],(d,[l])=>Da(Ha(l.evaluate(d)))],"to-rgba":[to(yi,4),[Ss],(d,[l])=>l.evaluate(d).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[to(yi,4),[Ss],(d,[l])=>l.evaluate(d).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ss,[yi,yi,yi],Rx],rgba:[Ss,[yi,yi,yi,yi],Rx],hsl:[Ss,[yi,yi,yi],yT],hsla:[Ss,[yi,yi,yi,yi],yT],has:{type:$r,overloads:[[[kr],(d,[l])=>xT(l.evaluate(d),d.properties())],[[kr,qd],(d,[l,h])=>xT(l.evaluate(d),h.evaluate(d))]]},get:{type:Jr,overloads:[[[kr],(d,[l])=>c_(l.evaluate(d),d.properties())],[[kr,qd],(d,[l,h])=>c_(l.evaluate(d),h.evaluate(d))]]},"feature-state":[Jr,[kr],(d,[l])=>c_(l.evaluate(d),d.featureState||{})],properties:[qd,[],d=>d.properties()],"geometry-type":[kr,[],d=>d.geometryType()],worldview:[kr,[],d=>d.globals.worldview||""],"is-active-floor":[$r,jc(kr),(d,l)=>{if(!(d.globals.activeFloors&&d.globals.activeFloors.size>0))return!1;const h=d.globals.activeFloors;return l.some(m=>{const _=m.evaluate(d);return h.has(_)})}],id:[Jr,[],d=>d.id()],zoom:[yi,[],d=>d.globals.zoom],pitch:[yi,[],d=>d.globals.pitch||0],"distance-from-center":[yi,[],d=>d.distanceFromCenter()],"measure-light":[yi,[kr],(d,[l])=>d.measureLight(l.evaluate(d))],"heatmap-density":[yi,[],d=>d.globals.heatmapDensity||0],"line-progress":[yi,[],d=>d.globals.lineProgress||0],"raster-value":[yi,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[yi,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[yi,[],d=>d.globals.skyRadialProgress||0],accumulated:[Jr,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[yi,jc(yi),(d,l)=>{let h=0;for(const m of l)h+=m.evaluate(d);return h}],"*":[yi,jc(yi),(d,l)=>{let h=1;for(const m of l)h*=m.evaluate(d);return h}],"-":{type:yi,overloads:[[[yi,yi],(d,[l,h])=>l.evaluate(d)-h.evaluate(d)],[[yi],(d,[l])=>-l.evaluate(d)]]},"/":[yi,[yi,yi],(d,[l,h])=>l.evaluate(d)/h.evaluate(d)],"%":[yi,[yi,yi],(d,[l,h])=>l.evaluate(d)%h.evaluate(d)],ln2:[yi,[],()=>Math.LN2],pi:[yi,[],()=>Math.PI],e:[yi,[],()=>Math.E],"^":[yi,[yi,yi],(d,[l,h])=>Math.pow(l.evaluate(d),h.evaluate(d))],sqrt:[yi,[yi],(d,[l])=>Math.sqrt(l.evaluate(d))],log10:[yi,[yi],(d,[l])=>Math.log(l.evaluate(d))/Math.LN10],ln:[yi,[yi],(d,[l])=>Math.log(l.evaluate(d))],log2:[yi,[yi],(d,[l])=>Math.log2(l.evaluate(d))],sin:[yi,[yi],(d,[l])=>Math.sin(l.evaluate(d))],cos:[yi,[yi],(d,[l])=>Math.cos(l.evaluate(d))],tan:[yi,[yi],(d,[l])=>Math.tan(l.evaluate(d))],asin:[yi,[yi],(d,[l])=>Math.asin(l.evaluate(d))],acos:[yi,[yi],(d,[l])=>Math.acos(l.evaluate(d))],atan:[yi,[yi],(d,[l])=>Math.atan(l.evaluate(d))],min:[yi,jc(yi),(d,l)=>Math.min(...l.map(h=>h.evaluate(d)))],max:[yi,jc(yi),(d,l)=>Math.max(...l.map(h=>h.evaluate(d)))],abs:[yi,[yi],(d,[l])=>Math.abs(l.evaluate(d))],round:[yi,[yi],(d,[l])=>{const h=l.evaluate(d);return h<0?-Math.round(-h):Math.round(h)}],floor:[yi,[yi],(d,[l])=>Math.floor(l.evaluate(d))],ceil:[yi,[yi],(d,[l])=>Math.ceil(l.evaluate(d))],"filter-==":[$r,[kr,Jr],(d,[l,h])=>d.properties()[l.value]===h.value],"filter-id-==":[$r,[Jr],(d,[l])=>d.id()===l.value],"filter-type-==":[$r,[kr],(d,[l])=>d.geometryType()===l.value],"filter-<":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m<_}],"filter-id-<":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h<m}],"filter->":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m>_}],"filter-id->":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h>m}],"filter-<=":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m<=_}],"filter-id-<=":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h<=m}],"filter->=":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m>=_}],"filter-id->=":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h>=m}],"filter-has":[$r,[Jr],(d,[l])=>l.value in d.properties()],"filter-has-id":[$r,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[$r,[to(kr)],(d,[l])=>l.value.indexOf(d.geometryType())>=0],"filter-id-in":[$r,[to(Jr)],(d,[l])=>l.value.indexOf(d.id())>=0],"filter-in-small":[$r,[kr,to(Jr)],(d,[l,h])=>h.value.indexOf(d.properties()[l.value])>=0],"filter-in-large":[$r,[kr,to(Jr)],(d,[l,h])=>function(m,_,S,T){for(;S<=T;){const M=S+T>>1;if(_[M]===m)return!0;_[M]>m?T=M-1:S=M+1}return!1}(d.properties()[l.value],h.value,0,h.value.length-1)],all:{type:$r,overloads:[[[$r,$r],(d,[l,h])=>l.evaluate(d)&&h.evaluate(d)],[jc($r),(d,l)=>{for(const h of l)if(!h.evaluate(d))return!1;return!0}]]},any:{type:$r,overloads:[[[$r,$r],(d,[l,h])=>l.evaluate(d)||h.evaluate(d)],[jc($r),(d,l)=>{for(const h of l)if(h.evaluate(d))return!0;return!1}]]},"!":[$r,[$r],(d,[l])=>!l.evaluate(d)],"is-supported-script":[$r,[kr],(d,[l])=>{const h=d.globals&&d.globals.isSupportedScript;return!h||h(l.evaluate(d))}],upcase:[kr,[kr],(d,[l])=>l.evaluate(d).toUpperCase()],downcase:[kr,[kr],(d,[l])=>l.evaluate(d).toLowerCase()],concat:[kr,jc(Jr),(d,l)=>l.map(h=>lc(h.evaluate(d))).join("")],"resolved-locale":[kr,[lg],(d,[l])=>l.evaluate(d).resolvedLocale()],random:[yi,[yi,yi,Jr],(d,l)=>{const[h,m,_]=l.map(T=>T.evaluate(d));if(h>m||h===m)return h;let S;if(typeof _=="string")S=function(T){let M=0;if(T.length===0)return M;for(let L=0;L<T.length;L++)M=(M<<5)-M+T.charCodeAt(L),M|=0;return M}(_);else{if(typeof _!="number")throw new oa(`Invalid seed input: ${_}`);S=_}return h+_T(S)()*(m-h)}]});class g_{constructor(l,h,m,_,S){this.expression=l,this._warningHistory={},this._scope=m,this._options=_,this._iconImageUseTheme=S,this._evaluator=new eo(m,_,S),this._defaultValue=h?function(T){return T.type==="color"&&(f_(T.default)||Array.isArray(T.default))?new Xr(0,0,0,0):T.type==="color"?Xr.parse(T.default)||null:T.default===void 0?null:T.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null,this.configDependencies=Ag(l),this.isIndoorDependent=u_(l)}evaluateWithoutErrorHandling(l,h,m,_,S,T,M,L){return this._evaluator.globals=l,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=_||null,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(l,h,m,_,S,T,M,L,k){this._evaluator||(this._evaluator=new eo(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=l,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=L||null,this._evaluator.iconImageUseTheme=k||null;try{const F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new oa(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(F)} instead.`);return F}catch(F){return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${F.message}`)),this._defaultValue}}}function m_(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in uf}function hc(d,l,h,m,_){const S=new Qv(uf,[],l?function(M){const L={color:Ss,string:kr,number:yi,enum:kr,boolean:$r,formatted:Lh,resolvedImage:cg};return M.type==="array"?to(L[M.value]||Jr,M.length):L[M.type]}(l):void 0,void 0,void 0,h,m,_),T=S.parse(d,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?Nh(new g_(T,l,h,m,_)):Mu(S.errors)}class Ig{constructor(l,h,m,_){this.kind=l,this._styleExpression=h,this.isLightConstant=m,this.isLineProgressConstant=_,this.isStateDependent=l!=="constant"&&!yg(h.expression),this.configDependencies=Ag(h.expression),this.isIndoorDependent=u_(h.expression)}evaluateWithoutErrorHandling(l,h,m,_,S,T){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,_,S,T)}evaluate(l,h,m,_,S,T,M){return this._styleExpression.evaluate(l,h,m,_,S,T,void 0,void 0,M)}}class Eu{constructor(l,h,m,_,S,T){this.kind=l,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=l!=="camera"&&!yg(h.expression),this.isIndoorDependent=u_(h.expression),this.isLightConstant=S,this.isLineProgressConstant=T,this.configDependencies=Ag(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(l,h,m,_,S,T){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,_,S,T)}evaluate(l,h,m,_,S,T){return this._styleExpression.evaluate(l,h,m,_,S,T)}interpolationFactor(l,h,m){return this.interpolationType?$s.interpolationFactor(this.interpolationType,l,h,m):0}}function Fx(d,l,h,m,_){if((d=hc(d,l,h,m,_)).result==="error")return d;const S=d.value.expression,T=nf(S);if(!T&&!h_(l))return Mu([new yl("","data expressions not supported")]);const M=af(S,["zoom","pitch","distance-from-center"]);if(!M&&!zx(l))return Mu([new yl("","zoom expressions not supported")]);const L=af(S,["measure-light"]);if(!L&&!Ox(l))return Mu([new yl("","measure-light expression not supported")]);const k=af(S,["line-progress"]);if(!k&&!function(U){return kx(U.expression,"line-progress")}(l))return Mu([new yl("","line-progress expression not supported")]);const F=l.expression&&l.expression.relaxZoomRestriction,V=__(S);return V||M||F?V instanceof yl?Mu([V]):V instanceof $s&&!d_(l)?Mu([new yl("",'"interpolate" expressions cannot be used with this property')]):Nh(V?new Eu(T&&k?"camera":"composite",d.value,V.labels,V instanceof $s?V.interpolation:void 0,L,k):new Ig(T&&k?"constant":"source",d.value,L,k)):Mu([new yl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class v_{constructor(l,h){this._parameters=l,this._specification=h,Object.assign(this,p_(this._parameters,this._specification))}static deserialize(l){return new v_(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function __(d){let l=null;if(d instanceof Sg)l=__(d.result);else if(d instanceof wg){for(const h of d.args)if(l=__(h),l)break}else(d instanceof xg||d instanceof $s)&&d.input instanceof Vo&&d.input.name==="zoom"&&(l=d);return l instanceof yl||d.eachChild(h=>{const m=__(h);m instanceof yl?l=m:l&&m&&l!==m&&(l=new yl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}var Mg,y_,wT=function(){if(y_)return Mg;y_=1,Mg=l;var d=3;function l(h,m,_){var S=this.cells=[];if(h instanceof ArrayBuffer){this.arrayBuffer=h;var T=new Int32Array(this.arrayBuffer);h=T[0],this.d=(m=T[1])+2*(_=T[2]);for(var M=0;M<this.d*this.d;M++){var L=T[d+M],k=T[d+M+1];S.push(L===k?null:T.subarray(L,k))}var F=T[d+S.length+1];this.keys=T.subarray(T[d+S.length],F),this.bboxes=T.subarray(F),this.insert=this._insertReadonly}else{this.d=m+2*_;for(var V=0;V<this.d*this.d;V++)S.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=h,this.padding=_,this.scale=m/h,this.uid=0;var U=_/m*h;this.min=-U,this.max=h+U}return l.prototype.insert=function(h,m,_,S,T){this._forEachCell(m,_,S,T,this._insertCell,this.uid++),this.keys.push(h),this.bboxes.push(m),this.bboxes.push(_),this.bboxes.push(S),this.bboxes.push(T)},l.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},l.prototype._insertCell=function(h,m,_,S,T,M){this.cells[T].push(M)},l.prototype.query=function(h,m,_,S,T){var M=this.min,L=this.max;if(h<=M&&m<=M&&L<=_&&L<=S&&!T)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(h,m,_,S,this._queryCell,k,{},T),k},l.prototype._queryCell=function(h,m,_,S,T,M,L,k){var F=this.cells[T];if(F!==null)for(var V=this.keys,U=this.bboxes,Z=0;Z<F.length;Z++){var q=F[Z];if(L[q]===void 0){var Q=4*q;(k?k(U[Q+0],U[Q+1],U[Q+2],U[Q+3]):h<=U[Q+2]&&m<=U[Q+3]&&_>=U[Q+0]&&S>=U[Q+1])?(L[q]=!0,M.push(V[q])):L[q]=!1}}},l.prototype._forEachCell=function(h,m,_,S,T,M,L,k){for(var F=this._convertToCellCoord(h),V=this._convertToCellCoord(m),U=this._convertToCellCoord(_),Z=this._convertToCellCoord(S),q=F;q<=U;q++)for(var Q=V;Q<=Z;Q++){var it=this.d*Q+q;if((!k||k(this._convertFromCellCoord(q),this._convertFromCellCoord(Q),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Q+1)))&&T.call(this,h,m,_,S,it,M,L,k))return}},l.prototype._convertFromCellCoord=function(h){return(h-this.padding)/this.scale},l.prototype._convertToCellCoord=function(h){return Math.max(0,Math.min(this.d-1,Math.floor(h*this.scale)+this.padding))},l.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var h=this.cells,m=d+this.cells.length+1+1,_=0,S=0;S<this.cells.length;S++)_+=this.cells[S].length;var T=new Int32Array(m+_+this.keys.length+this.bboxes.length);T[0]=this.extent,T[1]=this.n,T[2]=this.padding;for(var M=m,L=0;L<h.length;L++){var k=h[L];T[d+L]=M,T.set(k,M),M+=k.length}return T[d+h.length]=M,T.set(this.keys,M),T[d+h.length+1]=M+=this.keys.length,T.set(this.bboxes,M),M+=this.bboxes.length,T.buffer},Mg}(),Vh=Wp(wT);const df={};function si(d,l,h={}){Object.defineProperty(d,"_classRegistryKey",{value:l,writable:!1}),df[l]={klass:d,omit:h.omit||[]}}si(Object,"Object"),Vh.serialize=function(d,l){const h=d.toArrayBuffer();return l&&l.add(h),{buffer:h}},Vh.deserialize=function(d){return new Vh(d.buffer)},Object.defineProperty(Vh,"name",{value:"Grid"}),si(Vh,"Grid"),delete Ce.prototype.constructor,typeof DOMMatrix<"u"&&si(DOMMatrix,"DOMMatrix"),si(Xr,"Color"),si(Error,"Error"),si(Za,"Formatted"),si(dg,"FormattedSection"),si(Dh,"AJAXError"),si(cs,"ResolvedImage"),si(v_,"StylePropertyFunction"),si(g_,"StyleExpression",{omit:["_evaluator"]}),si(Ba,"ImageId"),si(Uc,"ImageVariant"),si(Eu,"ZoomDependentExpression"),si(Ig,"ZoomConstantExpression"),si(Vo,"CompoundExpression",{omit:["_evaluate"]});for(const d in uf)df[uf[d]._classRegistryKey]||si(uf[d],`Expression${d}`);function Nx(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&d.constructor.name==="ArrayBuffer")}function Wc(d){return self.ImageBitmap&&d instanceof ImageBitmap}function Du(d,l){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(Nx(d)||Wc(d))return l&&l.add(d),d;if(ArrayBuffer.isView(d))return l&&l.add(d.buffer),d;if(d instanceof ImageData)return l&&l.add(d.data.buffer),d;if(Array.isArray(d)){const h=[];for(const m of d)h.push(Du(m,l));return h}if(d instanceof Map){const h={$name:"Map",entries:[]};for(const[m,_]of d.entries())h.entries.push(Du(m),Du(_,l));return h}if(d instanceof Set){const h={$name:"Set"};let m=0;for(const _ of d.values())h[++m]=Du(_);return h}if(d instanceof DOMMatrix){const h={$name:"DOMMatrix"},m=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const _ of m)h[_]=d[_];return h}if(typeof d=="bigint")return{$name:"BigInt",value:d.toString()};if(typeof d=="object"){const h=d.constructor,m=h._classRegistryKey;if(!m)throw new Error(`Can't serialize object of unregistered class "${h.name}".`);const _=h.serialize?h.serialize(d,l):{};if(!h.serialize){for(const S in d)d.hasOwnProperty(S)&&(df[m].omit.indexOf(S)>=0||(_[S]=Du(d[S],l)));d instanceof Error&&(_.message=d.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(_.$name=m),_}throw new Error("can't serialize object of type "+typeof d)}function Pu(d){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||Nx(d)||Wc(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(Pu);if(typeof d=="object"){const l=d.$name||"Object";if(l==="Map"){const _=d.entries||[],S=new Map;for(let T=0;T<_.length;T+=2)S.set(Pu(_[T]),Pu(_[T+1]));return S}if(l==="Set"){const _=new Set;for(const S of Object.keys(d))S!=="$name"&&_.add(Pu(d[S]));return _}if(l==="DOMMatrix"){let _;return _=d.is2D?[d.a,d.b,d.c,d.d,d.e,d.f]:[d.m11,d.m12,d.m13,d.m14,d.m21,d.m22,d.m23,d.m24,d.m31,d.m32,d.m33,d.m34,d.m41,d.m42,d.m43,d.m44],new DOMMatrix(_)}if(l==="BigInt")return BigInt(d.value);const{klass:h}=df[l];if(!h)throw new Error(`Can't deserialize unregistered class "${l}".`);if(h.deserialize)return h.deserialize(d);const m=Object.create(h.prototype);for(const _ of Object.keys(d))_!=="$name"&&(m[_]=Pu(d[_]));return m}throw new Error("can't deserialize object of type "+typeof d)}const Ci={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519,Osage:d=>d>=66736&&d<=66815,"CJK Unified Ideographs Extension B":d=>d>=131072&&d<=173791};function Vx(d){for(const l of d)if(b_(l.charCodeAt(0)))return!0;return!1}function ST(d){for(const l of d)if(!x_(l.charCodeAt(0)))return!1;return!0}function x_(d){return!(Ci.Arabic(d)||Ci["Arabic Supplement"](d)||Ci["Arabic Extended-A"](d)||Ci["Arabic Presentation Forms-A"](d)||Ci["Arabic Presentation Forms-B"](d))}function b_(d){return!(d!==746&&d!==747&&(d<4352||!(Ci["Bopomofo Extended"](d)||Ci.Bopomofo(d)||Ci["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||Ci["CJK Compatibility Ideographs"](d)||Ci["CJK Compatibility"](d)||Ci["CJK Radicals Supplement"](d)||Ci["CJK Strokes"](d)||!(!Ci["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||d===12336)||Ci["CJK Unified Ideographs Extension A"](d)||Ci["CJK Unified Ideographs"](d)||Ci["Enclosed CJK Letters and Months"](d)||Ci["Hangul Compatibility Jamo"](d)||Ci["Hangul Jamo Extended-A"](d)||Ci["Hangul Jamo Extended-B"](d)||Ci["Hangul Jamo"](d)||Ci["Hangul Syllables"](d)||Ci.Hiragana(d)||Ci["Ideographic Description Characters"](d)||Ci.Kanbun(d)||Ci["Kangxi Radicals"](d)||Ci["Katakana Phonetic Extensions"](d)||Ci.Katakana(d)&&d!==12540||!(!Ci["Halfwidth and Fullwidth Forms"](d)||d===65288||d===65289||d===65293||d>=65306&&d<=65310||d===65339||d===65341||d===65343||d>=65371&&d<=65503||d===65507||d>=65512&&d<=65519)||!(!Ci["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||Ci["Unified Canadian Aboriginal Syllabics"](d)||Ci["Unified Canadian Aboriginal Syllabics Extended"](d)||Ci["Vertical Forms"](d)||Ci["Yijing Hexagram Symbols"](d)||Ci["Yi Syllables"](d)||Ci["Yi Radicals"](d))))}function Ux(d){return!(b_(d)||function(l){return!!(Ci["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Ci["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Ci["Letterlike Symbols"](l)||Ci["Number Forms"](l)||Ci["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Ci["Control Pictures"](l)&&l!==9251||Ci["Optical Character Recognition"](l)||Ci["Enclosed Alphanumerics"](l)||Ci["Geometric Shapes"](l)||Ci["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Ci["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Ci["CJK Symbols and Punctuation"](l)||Ci.Katakana(l)||Ci["Private Use Area"](l)||Ci["CJK Compatibility Forms"](l)||Ci["Small Form Variants"](l)||Ci["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(d))}function Gx(d){return Ci.Arabic(d)||Ci["Arabic Supplement"](d)||Ci["Arabic Extended-A"](d)||Ci["Arabic Presentation Forms-A"](d)||Ci["Arabic Presentation Forms-B"](d)}function TT(d){return d>=1424&&d<=2303||Ci["Arabic Presentation Forms-A"](d)||Ci["Arabic Presentation Forms-B"](d)}function nD(d,l){return!(!l&&TT(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||Ci.Khmer(d))}function aD(d){for(const l of d)if(TT(l.charCodeAt(0)))return!0;return!1}const Ts={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Hx=null,Ko=Ts.unavailable,Lu=null;const AT=function(d){d&&typeof d=="string"&&d.indexOf("NetworkError")>-1&&(Ko=Ts.error),Hx&&Hx(d)};function jx(){Wx.fire(new js("pluginStateChange",{pluginStatus:Ko,pluginURL:Lu}))}const Wx=new Nc,$x=function(){return Ko},Zx=function(){if(Ko!==Ts.deferred||!Lu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ko=Ts.loading,jx(),Lu&&Wd({url:Lu},d=>{d?AT(d):(Ko=Ts.loaded,jx())})},As={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ko===Ts.loaded||As.applyArabicShaping!=null,isLoading:()=>Ko===Ts.loading,setState(d){Ko=d.pluginStatus,Lu=d.pluginURL},isParsing:()=>Ko===Ts.parsing,isParsed:()=>Ko===Ts.parsed,getPluginURL:()=>Lu};class xn{constructor(l,h){this.zoom=l,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.transition=h.transition,this.pitch=h.pitch,this.brightness=h.brightness,this.worldview=h.worldview,this.activeFloors=h.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(l){return function(h,m){for(const _ of h)if(!nD(_.charCodeAt(0),m))return!1;return!0}(l,As.isLoaded())}}class Cg{constructor(l,h,m,_,S){this.property=l,this.value=h,this.expression=function(T,M,L,k,F){if(f_(T))return new v_(T,M);if(m_(T)||Array.isArray(T)&&T.length>0){const V=Fx(T,M,L,k,F);if(V.result==="error")throw new Error(V.value.map(U=>`${U.key}: ${U.message}`).join(", "));return V.value}{let V=T;return typeof T=="string"&&M.type==="color"&&(V=Xr.parse(T)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>V}}}(h===void 0?l.specification.default:h,l.specification,m,_,S)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,h,m,_){return this.property.possiblyEvaluate(this,l,h,m,_)}}class ff{constructor(l,h,m,_){this.property=l,this.value=new Cg(l,void 0,h,m,_)}transitioned(l,h){return new MT(this.property,this.value,h,Object.assign({},l.transition,this.transition),l.now)}untransitioned(){return new MT(this.property,this.value,null,{},0)}}class IT{constructor(l,h,m,_){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues),this._scope=h,this._options=m,this._iconImageUseTheme=_,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(l){return mi(this._values[l].value.value)}setValue(l,h){this._values.hasOwnProperty(l)||(this._values[l]=new ff(this._values[l].property,this._scope,this._options,this._iconImageUseTheme)),this._values[l].value=new Cg(this._values[l].property,h===null?void 0:mi(h),this._scope,this._options,this._iconImageUseTheme),this._values[l].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[l].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[l].value.isIndoorDependent())}setTransitionOrValue(l,h){h&&(this._options=h);const m=this._properties.properties;if(l)for(const _ in l){const S=l[_];if(_.endsWith("-transition")){const T=_.slice(0,-11);m[T]&&this.setTransition(T,S)}else m.hasOwnProperty(_)&&this.setValue(_,S)}}getTransition(l){return mi(this._values[l].transition)}setTransition(l,h){this._values.hasOwnProperty(l)||(this._values[l]=new ff(this._values[l].property)),this._values[l].transition=mi(h)||void 0}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m);const _=this.getTransition(h);_!==void 0&&(l[`${h}-transition`]=_)}return l}transitioned(l,h){const m=new $c(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].transitioned(l,h._values[_]);return m}untransitioned(){const l=new $c(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].untransitioned();return l}isIndoorDependent(){return this._isIndoorDependent}}class MT{constructor(l,h,m,_,S){const T=_.delay||0,M=_.duration||0;S=S||0,this.property=l,this.value=h,this.begin=S+T,this.end=this.begin+M,l.specification.transition&&(_.delay||_.duration)&&(this.prior=m)}possiblyEvaluate(l,h,m){const _=l.now||0,S=this.value.possiblyEvaluate(l,h,m),T=this.prior;if(T){if(_>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(_<this.begin)return T.possiblyEvaluate(l,h,m);{const M=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(l,h,m),S,qp(M))}}return S}}class $c{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,h,m){const _=new Uh(this._properties);for(const S of Object.keys(this._values))_._values[S]=this._values[S].possiblyEvaluate(l,h,m);return _}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class qx{constructor(l,h,m,_){this._properties=l,this._values=Object.create(l.defaultPropertyValues),this._scope=h,this._options=m,this._iconImageUseTheme=_,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(l){return mi(this._values[l].value)}setValue(l,h){this._values[l]=new Cg(this._values[l].property,h===null?void 0:mi(h),this._scope,this._options,this._iconImageUseTheme),this._values[l].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[l].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[l].isIndoorDependent())}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m)}return l}possiblyEvaluate(l,h,m,_){const S=new Uh(this._properties);for(const T of Object.keys(this._values))S._values[T]=this._values[T].possiblyEvaluate(l,h,m,_);return S}isIndoorDependent(){return this._isIndoorDependent}}class Tl{constructor(l,h,m,_){this.property=l,this.value=h,this.parameters=m,this.iconImageUseTheme=_}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,h,m,_){return this.property.evaluate(this.value,this.parameters,l,h,m,_,this.iconImageUseTheme)}}class Uh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Pe{constructor(l){this.specification=l}possiblyEvaluate(l,h){return l.expression.evaluate(h)}interpolate(l,h,m){const _=Vc[this.specification.type];return _?_(l,h,m):l}}class ei{constructor(l,h){this.specification=l,this.overrides=h}possiblyEvaluate(l,h,m,_,S){return l.expression.kind==="constant"||l.expression.kind==="camera"?new Tl(this,{kind:"constant",value:l.expression.evaluate(h,null,{},m,_,void 0,S)},h):new Tl(this,l.expression,h,S)}interpolate(l,h,m){if(l.value.kind!=="constant"||h.value.kind!=="constant")return l;if(l.value.value===void 0||h.value.value===void 0)return new Tl(this,{kind:"constant",value:void 0},l.parameters);const _=Vc[this.specification.type];return _?new Tl(this,{kind:"constant",value:_(l.value.value,h.value.value,m)},l.parameters):l}evaluate(l,h,m,_,S,T,M){return l.kind==="constant"?l.value:l.evaluate(h,m,_,S,T,void 0,M)}}class pf{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,_){return!!l.expression.evaluate(h,null,{},m,_)}interpolate(){return!1}}class Yn{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const h=new xn(0,{});for(const m in l){const _=l[m];_.specification.overridable&&this.overridableProperties.push(m);const S=this.defaultPropertyValues[m]=new Cg(_,void 0),T=this.defaultTransitionablePropertyValues[m]=new ff(_);this.defaultTransitioningPropertyValues[m]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=S.possiblyEvaluate(h)}}}si(ei,"DataDrivenProperty"),si(Pe,"DataConstantProperty"),si(pf,"ColorRampProperty");var Yt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Xx(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function gf(d){if(Array.isArray(d))return d.map(gf);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const l={};for(const h in d)l[h]=gf(d[h]);return l}return Xx(d)}function mf(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const l of d.slice(1))if(!mf(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function w_(d,l="",h=null,m="fill"){if(d==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};mf(d)||(d=Zs(d));const _=d;let S=!0;try{S=function(F){if(!_f(F))return F;let V=gf(F);return vf(V),V=S_(V),V}(_)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(_,null,2)}
        `)}let T=null,M=null;if(m!=="background"&&m!=="sky"&&m!=="slot"){M=Yt[`filter_${m}`];const F=hc(S,M,l,h);if(F.result==="error")throw new Error(F.value.map(V=>`${V.key}: ${V.message}`).join(", "));T=(V,U,Z)=>F.value.evaluate(V,U,{},Z)}let L=null,k=null;if(S!==_){const F=hc(_,M,l,h);if(F.result==="error")throw new Error(F.value.map(V=>`${V.key}: ${V.message}`).join(", "));L=(V,U,Z,q,Q)=>F.value.evaluate(V,U,{},Z,void 0,void 0,q,Q),k=!nf(F.value.expression)}return{filter:T,dynamicFilter:L||void 0,needGeometry:ET(S),needFeature:!!k}}function S_(d){if(!Array.isArray(d))return d;const l=function(h){if(oD.has(h[0])){for(let m=1;m<h.length;m++)if(_f(h[m]))return!0}return h}(d);return l===!0?l:l.map(h=>S_(h))}function vf(d){let l=!1;const h=[];if(d[0]==="case"){for(let m=1;m<d.length-1;m+=2)l=l||_f(d[m]),h.push(d[m+1]);h.push(d[d.length-1])}else if(d[0]==="match"){l=l||_f(d[1]);for(let m=2;m<d.length-1;m+=2)h.push(d[m+1]);h.push(d[d.length-1])}else if(d[0]==="step"){l=l||_f(d[1]);for(let m=1;m<d.length-1;m+=2)h.push(d[m+1])}l&&(d.length=0,d.push("any",...h));for(let m=1;m<d.length;m++)vf(d[m])}function _f(d){if(!Array.isArray(d))return!1;if((l=d[0])==="pitch"||l==="distance-from-center")return!0;var l;for(let h=1;h<d.length;h++)if(_f(d[h]))return!0;return!1}const oD=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function CT(d,l){return d<l?-1:d>l?1:0}function ET(d){if(!Array.isArray(d))return!1;if(d[0]==="within"||d[0]==="distance")return!0;for(let l=1;l<d.length;l++)if(ET(d[l]))return!0;return!1}function Zs(d){if(!d)return!0;const l=d[0];return d.length<=1?l!=="any":l==="=="?Yx(d[1],d[2],"=="):l==="!="?T_(Yx(d[1],d[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Yx(d[1],d[2],l):l==="any"?(h=d.slice(1),["any"].concat(h.map(Zs))):l==="all"?["all"].concat(d.slice(1).map(Zs)):l==="none"?["all"].concat(d.slice(1).map(Zs).map(T_)):l==="in"?Kx(d[1],d.slice(2)):l==="!in"?T_(Kx(d[1],d.slice(2))):l==="has"?DT(d[1]):l!=="!has"||T_(DT(d[1]));var h}function Yx(d,l,h){switch(d){case"$type":return[`filter-type-${h}`,l];case"$id":return[`filter-id-${h}`,l];default:return[`filter-${h}`,d,l]}}function Kx(d,l){if(l.length===0)return!1;switch(d){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(h=>typeof h!=typeof l[0])?["filter-in-large",d,["literal",l.sort(CT)]]:["filter-in-small",d,["literal",l]]}}function DT(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function T_(d){return["!",d]}const Eg="";function Gh(d,l){return l?`${d}${Eg}${l}`:d}let PT;const LT=()=>PT||(PT=new Yn({"icon-size":new ei(Yt.layout_symbol["icon-size"]),"icon-image":new ei(Yt.layout_symbol["icon-image"]),"icon-rotate":new ei(Yt.layout_symbol["icon-rotate"]),"icon-offset":new ei(Yt.layout_symbol["icon-offset"])}));class sD{constructor(l,h,m,_,S,T){this.cachedIconPrimary=null;const M=hc(l,Yt.appearance.condition);if(M.result==="success"&&(this.condition=M.value),this.name=h,m){this.properties=new Uh(LT()),this.unevaluatedLayout=new qx(LT(),_,S,T);for(const L in m)this.unevaluatedLayout.setValue(L,m[L])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(l){this.cachedIconPrimary=l}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(l){return!(this.condition||!l.isHidden||this.name!=="hidden")||this.condition.evaluate(l.globals,l.feature,l.featureState,l.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(l){return this.properties.get(l)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(l,h,m){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(l,void 0,h,m))}serialize(){const l={};return l.condition=this.condition.expression.serialize(),this.name&&(l.name=this.name),this.unevaluatedLayout&&(l.properties=this.unevaluatedLayout.serialize()),l}}const RT="-transition",lD=new Set(["fill","line","background","hillshade","raster"]);class Uo extends Nc{constructor(l,h,m,_,S,T){if(super(),this.id=l.id,this.fqid=Gh(this.id,m),this.type=l.type,this.scope=m,this.lut=_,this.options=S,this.iconImageUseTheme=T,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},l.type!=="custom"){if(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type&&l.type!=="background"&&l.type!=="sky"&&l.type!=="slot"){this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter;const M=hc(this.filter,Yt[`filter_${l.type}`]);M.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...M.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||M.value.isIndoorDependent)}if(l.slot&&(this.slot=l.slot),l.appearances&&this.setAppearances(l.appearances),h.layout&&(this._unevaluatedLayout=new qx(h.layout,this.scope,S,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),h.paint){this._transitionablePaint=new IT(h.paint,this.scope,S);for(const M in l.paint)this.setPaintProperty(M,l.paint[M]);for(const M in l.layout)this.setLayoutProperty(M,l.layout[M]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Uh(h.paint)}}}onAdd(l){}onRemove(l){}isDraped(l){return!this.is3D(!0)&&lD.has(this.type)}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,h){if(this.type==="custom"&&l==="visibility")return void(this.visibility=h);const m=this._unevaluatedLayout;m._properties.properties[l]&&(m.setValue(l,h),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...m.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||m.isIndoorDependent(),l==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(l){this.appearances=[],l.forEach(h=>{this.appearances.push(new sD(h.condition,h.name,h.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(l){return l.endsWith(RT)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}isPaintProperty(l){return!!this._transitionablePaint._properties.properties[l]}setPaintProperty(l,h){const m=this._transitionablePaint,_=m._properties.properties;if(l.endsWith(RT)){const V=l.slice(0,-11);return _[V]&&m.setTransition(V,h||void 0),!1}if(!_[l])return!1;const S=m._values[l],T=S.value.isDataDriven(),M=S.value;m.setValue(l,h),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...m.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||m.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(l);const L=m._values[l].value,k=L.isDataDriven(),F=l.endsWith("pattern")||l==="line-dasharray";return k||T||F||this._handleOverridablePaintPropertyUpdate(l,M,L)}_handleSpecialPaintPropertyUpdate(l){}getProgramIds(){return null}getDefaultProgramParams(l,h,m){return null}_handleOverridablePaintPropertyUpdate(l,h,m){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,h){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,h,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,h)}serialize(){const l={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(l.appearances=this.appearances.map(h=>h.serialize())),Me(l,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}is3D(l){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const l in this.paint._values){const h=this.paint.get(l);if(h instanceof Tl&&h_(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}for(const l of this.appearances)if(!yg(l.condition.expression))return!0;return!1}compileFilter(l){this._filterCompiled||(this._featureFilter=w_(this.filter,this.scope,l),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(l){this._stats&&(l.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(l,h,m){return{}}queryRadius(l){}queryIntersectsFeature(l,h,m,_,S,T,M,L,k){}}const cD={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Dg{constructor(l,h){this._structArray=l,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class In{constructor(){this.capacity=-1,this.resize(0)}static serialize(l,h){return l._trim(),h&&h.add(l.arrayBuffer),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const h=Object.create(this.prototype);return h.arrayBuffer=l.arrayBuffer,h.length=l.length,h.capacity=l.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...l){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...l){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gr(d,l=1){let h=0,m=0;return{members:d.map(_=>{const S=cD[_.type].BYTES_PER_ELEMENT,T=h=Jx(h,Math.max(l,S)),M=_.components||1;return m=Math.max(m,S),h+=S*M,{name:_.name,type:_.type,components:M,offset:T}}),size:Jx(h,Math.max(m,l)),alignment:l}}function Jx(d,l){return Math.ceil(d/l)*l}class us extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const _=2*l;return this.int16[_+0]=h,this.int16[_+1]=m,l}}us.prototype.bytesPerElement=4,si(us,"StructArrayLayout2i4");class Hh extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=3*l;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=_,l}}Hh.prototype.bytesPerElement=6,si(Hh,"StructArrayLayout3i6");class yf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=4*l;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=_,this.int16[T+3]=S,l}}yf.prototype.bytesPerElement=8,si(yf,"StructArrayLayout4i8");class Zc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.float32[1*l+0]=h,l}}Zc.prototype.bytesPerElement=4,si(Zc,"StructArrayLayout1f4");class Qx extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=4*l,T=2*l;return this.int16[S+0]=h,this.int16[S+1]=m,this.float32[T+1]=_,l}}Qx.prototype.bytesPerElement=8,si(Qx,"StructArrayLayout2i1f8");class t1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=4*l;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=_,l}}t1.prototype.bytesPerElement=8,si(t1,"StructArrayLayout3i8");class A_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const M=5*l;return this.int16[M+0]=h,this.int16[M+1]=m,this.int16[M+2]=_,this.int16[M+3]=S,this.int16[M+4]=T,l}}A_.prototype.bytesPerElement=10,si(A_,"StructArrayLayout5i10");class I_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,M)}emplace(l,h,m,_,S,T,M,L){const k=6*l,F=12*l,V=3*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.uint8[F+4]=_,this.uint8[F+5]=S,this.uint8[F+6]=T,this.uint8[F+7]=M,this.float32[V+2]=L,l}}I_.prototype.bytesPerElement=12,si(I_,"StructArrayLayout2i4ub1f12");class qs extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=3*l;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=_,l}}qs.prototype.bytesPerElement=12,si(qs,"StructArrayLayout3f12");class Ru extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const M=6*l,L=3*l;return this.uint16[M+0]=h,this.uint16[M+1]=m,this.uint16[M+2]=_,this.uint16[M+3]=S,this.float32[L+2]=T,l}}Ru.prototype.bytesPerElement=12,si(Ru,"StructArrayLayout4ui1f12");class jh extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=4*l;return this.uint16[T+0]=h,this.uint16[T+1]=m,this.uint16[T+2]=_,this.uint16[T+3]=S,l}}jh.prototype.bytesPerElement=8,si(jh,"StructArrayLayout4ui8");class M_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const M=this.length;return this.resize(M+1),this.emplace(M,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,M){const L=6*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.int16[L+2]=_,this.int16[L+3]=S,this.int16[L+4]=T,this.int16[L+5]=M,l}}M_.prototype.bytesPerElement=12,si(M_,"StructArrayLayout6i12");class C_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k,F,V,U){const Z=this.length;return this.resize(Z+1),this.emplace(Z,l,h,m,_,S,T,M,L,k,F,V,U)}emplace(l,h,m,_,S,T,M,L,k,F,V,U,Z){const q=12*l;return this.int16[q+0]=h,this.int16[q+1]=m,this.int16[q+2]=_,this.int16[q+3]=S,this.uint16[q+4]=T,this.uint16[q+5]=M,this.uint16[q+6]=L,this.uint16[q+7]=k,this.int16[q+8]=F,this.int16[q+9]=V,this.int16[q+10]=U,this.int16[q+11]=Z,l}}C_.prototype.bytesPerElement=24,si(C_,"StructArrayLayout4i4ui4i24");class xf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const M=this.length;return this.resize(M+1),this.emplace(M,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,M){const L=10*l,k=5*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.int16[L+2]=_,this.float32[k+2]=S,this.float32[k+3]=T,this.float32[k+4]=M,l}}xf.prototype.bytesPerElement=20,si(xf,"StructArrayLayout3i3f20");class ku extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=4*l;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=_,this.float32[T+3]=S,l}}ku.prototype.bytesPerElement=16,si(ku,"StructArrayLayout4f16");class e1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint32[1*l+0]=h,l}}e1.prototype.bytesPerElement=4,si(e1,"StructArrayLayout1ul4");class Al extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const _=2*l;return this.uint16[_+0]=h,this.uint16[_+1]=m,l}}Al.prototype.bytesPerElement=4,si(Al,"StructArrayLayout2ui4");class i1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k,F,V,U,Z){const q=this.length;return this.resize(q+1),this.emplace(q,l,h,m,_,S,T,M,L,k,F,V,U,Z)}emplace(l,h,m,_,S,T,M,L,k,F,V,U,Z,q){const Q=20*l,it=10*l;return this.int16[Q+0]=h,this.int16[Q+1]=m,this.int16[Q+2]=_,this.int16[Q+3]=S,this.int16[Q+4]=T,this.float32[it+3]=M,this.float32[it+4]=L,this.float32[it+5]=k,this.float32[it+6]=F,this.int16[Q+14]=V,this.uint32[it+8]=U,this.uint16[Q+18]=Z,this.uint16[Q+19]=q,l}}i1.prototype.bytesPerElement=40,si(i1,"StructArrayLayout5i4f1i1ul2ui40");class E_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,M)}emplace(l,h,m,_,S,T,M,L){const k=8*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.int16[k+2]=_,this.int16[k+4]=S,this.int16[k+5]=T,this.int16[k+6]=M,this.int16[k+7]=L,l}}E_.prototype.bytesPerElement=16,si(E_,"StructArrayLayout3i2i2i16");class bf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const M=4*l,L=8*l;return this.float32[M+0]=h,this.float32[M+1]=m,this.float32[M+2]=_,this.int16[L+6]=S,this.int16[L+7]=T,l}}bf.prototype.bytesPerElement=16,si(bf,"StructArrayLayout2f1f2i16");class wf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const M=this.length;return this.resize(M+1),this.emplace(M,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,M){const L=20*l,k=5*l;return this.uint8[L+0]=h,this.uint8[L+1]=m,this.float32[k+1]=_,this.float32[k+2]=S,this.float32[k+3]=T,this.float32[k+4]=M,l}}wf.prototype.bytesPerElement=20,si(wf,"StructArrayLayout2ub4f20");class Pn extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=3*l;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=_,l}}Pn.prototype.bytesPerElement=6,si(Pn,"StructArrayLayout3ui6");class Sf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt){const At=this.length;return this.resize(At+1),this.emplace(At,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt)}emplace(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt,At){const Ot=30*l,Nt=15*l,Ht=60*l;return this.int16[Ot+0]=h,this.int16[Ot+1]=m,this.int16[Ot+2]=_,this.float32[Nt+2]=S,this.float32[Nt+3]=T,this.uint16[Ot+8]=M,this.uint16[Ot+9]=L,this.uint32[Nt+5]=k,this.uint32[Nt+6]=F,this.uint32[Nt+7]=V,this.uint16[Ot+16]=U,this.uint16[Ot+17]=Z,this.uint16[Ot+18]=q,this.float32[Nt+10]=Q,this.float32[Nt+11]=it,this.uint8[Ht+48]=at,this.uint8[Ht+49]=dt,this.uint8[Ht+50]=mt,this.uint32[Nt+13]=_t,this.int16[Ot+28]=Dt,this.uint8[Ht+58]=At,l}}Sf.prototype.bytesPerElement=60,si(Sf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class r1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt,At,Ot,Nt,Ht,se,Kt,le,ge,Se,ze,De,me){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt,At,Ot,Nt,Ht,se,Kt,le,ge,Se,ze,De,me)}emplace(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt,At,Ot,Nt,Ht,se,Kt,le,ge,Se,ze,De,me,Ee){const ae=20*l,re=40*l,Ie=80*l;return this.float32[ae+0]=h,this.float32[ae+1]=m,this.int16[re+4]=_,this.int16[re+5]=S,this.int16[re+6]=T,this.int16[re+7]=M,this.int16[re+8]=L,this.int16[re+9]=k,this.int16[re+10]=F,this.int16[re+11]=V,this.int16[re+12]=U,this.uint16[re+13]=Z,this.uint16[re+14]=q,this.uint16[re+15]=Q,this.uint16[re+16]=it,this.uint16[re+17]=at,this.uint16[re+18]=dt,this.uint16[re+19]=mt,this.uint16[re+20]=_t,this.uint16[re+21]=Dt,this.uint16[re+22]=At,this.uint16[re+23]=Ot,this.uint16[re+24]=Nt,this.uint16[re+25]=Ht,this.uint16[re+26]=se,this.uint16[re+27]=Kt,this.uint32[ae+14]=le,this.float32[ae+15]=ge,this.float32[ae+16]=Se,this.float32[ae+17]=ze,this.float32[ae+18]=De,this.uint8[Ie+76]=me,this.uint16[re+39]=Ee,l}}r1.prototype.bytesPerElement=80,si(r1,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class n1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const M=this.length;return this.resize(M+1),this.emplace(M,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,M){const L=6*l;return this.float32[L+0]=h,this.float32[L+1]=m,this.float32[L+2]=_,this.float32[L+3]=S,this.float32[L+4]=T,this.float32[L+5]=M,l}}n1.prototype.bytesPerElement=24,si(n1,"StructArrayLayout6f24");class Wh extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const M=5*l;return this.float32[M+0]=h,this.float32[M+1]=m,this.float32[M+2]=_,this.float32[M+3]=S,this.float32[M+4]=T,l}}Wh.prototype.bytesPerElement=20,si(Wh,"StructArrayLayout5f20");class a1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,M)}emplace(l,h,m,_,S,T,M,L){const k=7*l;return this.float32[k+0]=h,this.float32[k+1]=m,this.float32[k+2]=_,this.float32[k+3]=S,this.float32[k+4]=T,this.float32[k+5]=M,this.float32[k+6]=L,l}}a1.prototype.bytesPerElement=28,si(a1,"StructArrayLayout7f28");class Pg extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k,F,V){const U=this.length;return this.resize(U+1),this.emplace(U,l,h,m,_,S,T,M,L,k,F,V)}emplace(l,h,m,_,S,T,M,L,k,F,V,U){const Z=11*l;return this.float32[Z+0]=h,this.float32[Z+1]=m,this.float32[Z+2]=_,this.float32[Z+3]=S,this.float32[Z+4]=T,this.float32[Z+5]=M,this.float32[Z+6]=L,this.float32[Z+7]=k,this.float32[Z+8]=F,this.float32[Z+9]=V,this.float32[Z+10]=U,l}}Pg.prototype.bytesPerElement=44,si(Pg,"StructArrayLayout11f44");class o1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k){const F=this.length;return this.resize(F+1),this.emplace(F,l,h,m,_,S,T,M,L,k)}emplace(l,h,m,_,S,T,M,L,k,F){const V=9*l;return this.float32[V+0]=h,this.float32[V+1]=m,this.float32[V+2]=_,this.float32[V+3]=S,this.float32[V+4]=T,this.float32[V+5]=M,this.float32[V+6]=L,this.float32[V+7]=k,this.float32[V+8]=F,l}}o1.prototype.bytesPerElement=36,si(o1,"StructArrayLayout9f36");class Ou extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const _=2*l;return this.float32[_+0]=h,this.float32[_+1]=m,l}}Ou.prototype.bytesPerElement=8,si(Ou,"StructArrayLayout2f8");class s1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=6*l;return this.uint32[3*l+0]=h,this.uint16[T+2]=m,this.uint16[T+3]=_,this.uint16[T+4]=S,l}}s1.prototype.bytesPerElement=12,si(s1,"StructArrayLayout1ul3ui12");class D_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint16[1*l+0]=h,l}}D_.prototype.bytesPerElement=2,si(D_,"StructArrayLayout1ui2");class P_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it){const at=this.length;return this.resize(at+1),this.emplace(at,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it)}emplace(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at){const dt=16*l;return this.float32[dt+0]=h,this.float32[dt+1]=m,this.float32[dt+2]=_,this.float32[dt+3]=S,this.float32[dt+4]=T,this.float32[dt+5]=M,this.float32[dt+6]=L,this.float32[dt+7]=k,this.float32[dt+8]=F,this.float32[dt+9]=V,this.float32[dt+10]=U,this.float32[dt+11]=Z,this.float32[dt+12]=q,this.float32[dt+13]=Q,this.float32[dt+14]=it,this.float32[dt+15]=at,l}}P_.prototype.bytesPerElement=64,si(P_,"StructArrayLayout16f64");class Tf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,M){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,M)}emplace(l,h,m,_,S,T,M,L){const k=10*l,F=5*l;return this.uint16[k+0]=h,this.uint16[k+1]=m,this.uint16[k+2]=_,this.uint16[k+3]=S,this.float32[F+2]=T,this.float32[F+3]=M,this.float32[F+4]=L,l}}Tf.prototype.bytesPerElement=20,si(Tf,"StructArrayLayout4ui3f20");class l1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.int16[1*l+0]=h,l}}l1.prototype.bytesPerElement=2,si(l1,"StructArrayLayout1i2");class L_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint8[1*l+0]=h,l}}L_.prototype.bytesPerElement=1,si(L_,"StructArrayLayout1ub1");class c1 extends Dg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}c1.prototype.size=40;class kT extends i1{get(l){return new c1(this,l)}}si(kT,"CollisionBoxArray");class R_ extends Dg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(l){this._structArray.uint8[this._pos1+49]=l}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(l){this._structArray.uint8[this._pos1+50]=l}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(l){this._structArray.uint32[this._pos4+13]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(l){this._structArray.uint8[this._pos1+58]=l}}R_.prototype.size=60;class Lg extends Sf{get(l){return new R_(this,l)}}si(Lg,"PlacedSymbolArray");class u1 extends Dg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(l){this._structArray.uint32[this._pos4+14]=l}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(l){this._structArray.float32[this._pos4+18]=l}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}u1.prototype.size=80;class OT extends r1{get(l){return new u1(this,l)}}si(OT,"SymbolInstanceArray");class h1 extends Zc{getoffsetX(l){return this.float32[1*l+0]}}si(h1,"GlyphOffsetArray");class zT extends us{getx(l){return this.int16[2*l+0]}gety(l){return this.int16[2*l+1]}}si(zT,"SymbolLineVertexArray");class k_ extends Dg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}k_.prototype.size=12;class BT extends s1{get(l){return new k_(this,l)}}si(BT,"FeatureIndexArray");class FT extends Al{geta_centroid_pos0(l){return this.uint16[2*l+0]}geta_centroid_pos1(l){return this.uint16[2*l+1]}}si(FT,"FillExtrusionCentroidArray");class NT extends Dg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}NT.prototype.size=6;class VT extends Hh{get(l){return new NT(this,l)}}si(VT,"FillExtrusionWallArray");const UT=gr([{name:"a_pos",components:2,type:"Int16"}],4),uD=gr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),hD=gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vn{constructor(l=[]){this.segments=l}_prepareSegment(l,h,m,_){let S=this.segments[this.segments.length-1];return l>Vn.MAX_VERTEX_ARRAY_LENGTH&&Mi(`Max vertices per segment is ${Vn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!S||S.vertexLength+l>Vn.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==_)&&(S={vertexOffset:h,primitiveOffset:m,vertexLength:0,primitiveLength:0},_!==void 0&&(S.sortKey=_),this.segments.push(S)),S}prepareSegment(l,h,m,_){return this._prepareSegment(l,h.length,m.length,_)}get(){return this.segments}destroy(){for(const l of this.segments)for(const h in l.vaos)l.vaos[h].destroy()}static simpleSegment(l,h,m,_){return new Vn([{vertexOffset:l,primitiveOffset:h,vertexLength:m,primitiveLength:_,vaos:{},sortKey:0}])}}function GT(d,l){return 256*(d=ct(Math.floor(d),0,255))+ct(Math.floor(l),0,255)}Vn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,si(Vn,"SegmentVector");const dD=gr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),fD=gr([{name:"a_pattern_b",components:4,type:"Uint16"}]),pD=gr([{name:"a_dash",components:4,type:"Uint16"}]);class Rg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(l,h,m,_){this.ids.push(kg(l)),this.positions.push(h,m,_)}eachPosition(l,h){const m=kg(l);let _=0,S=this.ids.length-1;for(;_<S;){const T=_+S>>1;this.ids[T]>=m?S=T:_=T+1}for(;this.ids[_]===m;)h(this.positions[3*_],this.positions[3*_+1],this.positions[3*_+2]),_++}static serialize(l,h){const m=new Float64Array(l.ids),_=new Uint32Array(l.positions);return d1(m,_,0,m.length-1),h&&(h.add(m.buffer),h.add(_.buffer)),{ids:m,positions:_}}static deserialize(l){const h=new Rg;let m;h.ids=l.ids,h.positions=l.positions;for(const _ of h.ids)_!==m&&h.uniqueIds.push(_),m=_;return h.indexed=!0,h}}function kg(d){const l=+d;return Number.isSafeInteger(l)?l:ng(String(d))}function d1(d,l,h,m){for(;h<m;){const _=d[h+m>>1];let S=h-1,T=m+1;for(;;){do S++;while(d[S]<_);do T--;while(d[T]>_);if(S>=T)break;O_(d,S,T),O_(l,3*S,3*T),O_(l,3*S+1,3*T+1),O_(l,3*S+2,3*T+2)}T-h<m-T?(d1(d,l,h,T),h=T+1):(d1(d,l,T+1,m),m=T)}}function O_(d,l,h){const m=d[l];d[l]=d[h],d[h]=m}si(Rg,"FeaturePositionMap");class Il{constructor(l){this.gl=l.gl,this.initialized=!1}fetchUniformLocation(l,h){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(l,h),this.initialized=!0),!!this.location}set(l,h,m){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class z_ extends Il{constructor(l){super(l),this.current=0}set(l,h,m){this.fetchUniformLocation(l,h)&&this.current!==m&&(this.current=m,this.gl.uniform1i(this.location,m))}}class ma extends Il{constructor(l){super(l),this.current=0}set(l,h,m){this.fetchUniformLocation(l,h)&&this.current!==m&&(this.current=m,this.gl.uniform1f(this.location,m))}}class dc extends Il{constructor(l){super(l),this.current=[0,0]}set(l,h,m){this.fetchUniformLocation(l,h)&&(m[0]===this.current[0]&&m[1]===this.current[1]||(this.current=m,this.gl.uniform2f(this.location,m[0],m[1])))}}class Af extends Il{constructor(l){super(l),this.current=[0,0,0]}set(l,h,m){this.fetchUniformLocation(l,h)&&(m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]||(this.current=m,this.gl.uniform3f(this.location,m[0],m[1],m[2])))}}class Og extends Il{constructor(l){super(l),this.current=[0,0,0,0]}set(l,h,m){this.fetchUniformLocation(l,h)&&(m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]&&m[3]===this.current[3]||(this.current=m,this.gl.uniform4f(this.location,m[0],m[1],m[2],m[3])))}}class f1 extends Il{constructor(l){super(l),this.current=Xr.transparent.toPremultipliedRenderColor(null)}set(l,h,m){this.fetchUniformLocation(l,h)&&(m.r===this.current.r&&m.g===this.current.g&&m.b===this.current.b&&m.a===this.current.a||(this.current=m,this.gl.uniform4f(this.location,m.r,m.g,m.b,m.a)))}}const HT=new Float32Array(16);class zg extends Il{constructor(l){super(l),this.current=HT}set(l,h,m){if(this.fetchUniformLocation(l,h)){if(m[12]!==this.current[12]||m[0]!==this.current[0])return this.current=m,void this.gl.uniformMatrix4fv(this.location,!1,m);for(let _=1;_<16;_++)if(m[_]!==this.current[_]){this.current=m,this.gl.uniformMatrix4fv(this.location,!1,m);break}}}}const gD=new Float32Array(9),jT=new Float32Array(4);class p1 extends Il{constructor(l){super(l),this.current=jT}set(l,h,m){if(this.fetchUniformLocation(l,h)){for(let _=0;_<4;_++)if(m[_]!==this.current[_]){this.current=m,this.gl.uniformMatrix2fv(this.location,!1,m);break}}}}function g1(d){return[GT(255*d.r,255*d.g),GT(255*d.b,255*d.a)]}function B_(d,l,h,m,_,S,T,M){return!!d&&(d.kind==="composite"||d.kind==="source"?d.evaluate(new xn(0,{brightness:S,worldview:M}),l,h,_,m,T)==="none":d.value==="none")}class F_{constructor(l,h,m,_){this.value=l,this.uniformNames=h.map(S=>`u_${S}`),this.type=m,this.context=_}setUniform(l,h,m,_,S){const T=_.constantOr(this.value);h.set(l,S,T instanceof Xr?T.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):T)}getBinding(l,h){return this.type==="color"?new f1(l):new ma(l)}}class Bg{constructor(l,h){this.uniformNames=h.map(m=>`u_${m}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(l,h){this.pixelRatio=l.pixelRatio||1,this.pattern=l.tl.concat(l.br),this.patternTransition=h?h.tl.concat(h.br):this.pattern}setUniform(l,h,m,_,S){let T=null;S!=="u_pattern"&&S!=="u_dash"||(T=this.pattern),S==="u_pattern_b"&&(T=this.patternTransition),S==="u_pixel_ratio"&&(T=this.pixelRatio),T&&h.set(l,S,T)}getBinding(l,h){return h==="u_pattern"||h==="u_pattern_b"||h==="u_dash"?new Og(l):new ma(l)}}class qc{constructor(l,h,m,_){this.expression=l,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(l,h,m,_,S,T,M,L){const k=this.paintVertexArray.length,F=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new xn(0,{brightness:T,worldview:L}),h,{},S,_,M):this.expression.kind==="constant"&&this.expression.value,V=B_(this.lutExpression,h,{},_,S,T,M,L);this.paintVertexArray.resize(l),this._setPaintValue(k,l,F,V?null:this.context.lut)}updatePaintArray(l,h,m,_,S,T,M,L){const k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:M,worldview:L},m,_,void 0,S):this.expression.kind==="constant"&&this.expression.value,F=B_(this.lutExpression,m,_,S,void 0,M,void 0,L);this._setPaintValue(l,h,k,F?null:this.context.lut)}_setPaintValue(l,h,m,_){if(this.type==="color"){const S=g1(m.toPremultipliedRenderColor(_));for(let T=l;T<h;T++)this.paintVertexArray.emplace(T,S[0],S[1])}else{for(let S=l;S<h;S++)this.paintVertexArray.emplace(S,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nl{constructor(l,h,m,_,S,T){this.expression=l,this.uniformNames=h.map(M=>`u_${M}_t`),this.type=m,this.useIntegerZoom=_,this.context=S,this.maxValue=0,this.paintVertexAttributes=h.map(M=>({name:`a_${M}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(l,h,m,_,S,T,M,L){const k=this.expression.evaluate(new xn(this.context.zoom,{brightness:T,worldview:L}),h,{},S,_,M),F=this.expression.evaluate(new xn(this.context.zoom+1,{brightness:T,worldview:L}),h,{},S,_,M),V=B_(this.lutExpression,h,{},_,S,T,M,L),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,k,F,V?null:this.context.lut)}updatePaintArray(l,h,m,_,S,T,M,L){const k=this.expression.evaluate({zoom:this.context.zoom,brightness:M,worldview:L},m,_,void 0,S),F=this.expression.evaluate({zoom:this.context.zoom+1,brightness:M,worldview:L},m,_,void 0,S),V=B_(this.lutExpression,m,_,S,void 0,M,void 0,L);this._setPaintValue(l,h,k,F,V?null:this.context.lut)}_setPaintValue(l,h,m,_,S){if(this.type==="color"){const T=g1(m.toPremultipliedRenderColor(S)),M=g1(m.toPremultipliedRenderColor(S));for(let L=l;L<h;L++)this.paintVertexArray.emplace(L,T[0],T[1],M[0],M[1])}else{for(let T=l;T<h;T++)this.paintVertexArray.emplace(T,m,_);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(_))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,h,m,_,S){const T=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,M=ct(this.expression.interpolationFactor(T,this.context.zoom,this.context.zoom+1),0,1);h.set(l,S,M)}getBinding(l,h){return new ma(l)}}class Ao{constructor(l,h,m,_,S){this.expression=l,this.layerId=S,this.paintVertexAttributes=(m==="array"?pD:dD).members;for(let T=0;T<h.length;++T);this.paintVertexArray=new _,this.paintTransitionVertexArray=new jh}populatePaintArray(l,h,m,_){const S=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValues(S,l,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(l,h,m,_,S,T,M){this._setPaintValues(l,h,m.patterns&&m.patterns[this.layerId],T)}_setPaintValues(l,h,m,_){if(!_||!m)return;const S=_[m[0]],T=_[m[1]];if(S){if(S){const{tl:M,br:L,pixelRatio:k}=S;for(let F=l;F<h;F++)this.paintVertexArray.emplace(F,M[0],M[1],L[0],L[1],k)}if(T){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:M,br:L}=T;for(let k=l;k<h;k++)this.paintTransitionVertexArray.emplace(k,M[0],M[1],L[0],L[1])}}}upload(l){const h=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,h)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=l.createVertexBuffer(this.paintTransitionVertexArray,fD.members,h))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Xc{constructor(l,h,m=()=>!0){this.binders={},this._buffers=[],this.context=h;const _=[];for(const S in l.paint._values){const T=l.paint.get(S);if(S.endsWith("-use-theme")||!m(S)||!(T instanceof Tl&&h_(T.property.specification)))continue;const M=vD(S,l.type),L=T.value,k=T.property.specification.type,F=!!T.property.useIntegerZoom,V=S==="line-dasharray"||S.endsWith("pattern"),U=l.paint.get(`${S}-use-theme`),Z=S==="line-dasharray"&&l.layout.get("line-cap").value.kind!=="constant"||U&&U.value.kind!=="constant";if(L.kind!=="constant"||Z)if(L.kind==="source"||Z||V){const q=m1(S,k,"source");this.binders[S]=V?new Ao(L,M,k,q,l.id):new qc(L,M,k,q),_.push(`/a_${S}`)}else{const q=m1(S,k,"composite");this.binders[S]=new Nl(L,M,k,F,h,q),_.push(`/z_${S}`)}else this.binders[S]=V?new Bg(L.value,M):new F_(L.value,M,k,h),_.push(`/u_${S}`);U&&(this.binders[S].lutExpression=U.value)}this.cacheKey=_.sort().join("")}getMaxValue(l){const h=this.binders[l];return h instanceof qc||h instanceof Nl?h.maxValue:0}populatePaintArrays(l,h,m,_,S,T,M,L){for(const k in this.binders){const F=this.binders[k];F.context=this.context,(F instanceof qc||F instanceof Nl||F instanceof Ao)&&F.populatePaintArray(l,h,m,_,S,T,M,L)}}setConstantPatternPositions(l,h){for(const m in this.binders){const _=this.binders[m];_ instanceof Bg&&_.setConstantPatternPositions(l,h)}}getPatternTransitionVertexBuffer(l){const h=this.binders[l];return h instanceof Ao?h.paintTransitionVertexBuffer:null}updatePaintArrays(l,h,m,_,S,T,M,L,k,F){let V=!1;const U=Object.keys(l),Z=U.length!==0&&!L,q=Z?U:h.uniqueIds;this.context.lut=S.lut;for(const Q in this.binders){const it=this.binders[Q];if(it.context=this.context,(it instanceof qc||it instanceof Nl||it instanceof Ao)&&it.expression&&it.expression.kind&&it.expression.kind!=="constant"&&(it.expression.isStateDependent===!0||it.expression.isLightConstant===!1)){const at=S.paint.get(Q);it.expression=at.value;for(const dt of q){const mt=l[dt.toString()];h.eachPosition(dt,(_t,Dt,At)=>{const Ot=_.feature(_t);it.updatePaintArray(Dt,At,Ot,mt,T,M,k,F)})}if(!Z)for(const dt of m.uniqueIds){const mt=l[dt.toString()];m.eachPosition(dt,(_t,Dt,At)=>{const Ot=_.feature(_t);it.updatePaintArray(Dt,At,Ot,mt,T,M,k,F)})}V=!0}}return V}defines(){const l=[];for(const h in this.binders){const m=this.binders[h];(m instanceof F_||m instanceof Bg)&&l.push(...m.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l){const h=[];for(const m in this.binders){const _=this.binders[m];if(_ instanceof F_||_ instanceof Bg||_ instanceof Nl)for(const S of _.uniformNames)h.push({name:S,property:m,binding:_.getBinding(l,S)})}return h}setUniforms(l,h,m,_,S){for(const{name:T,property:M,binding:L}of m)this.binders[M].setUniform(l,L,S,_.get(M),T)}updatePaintBuffers(){this._buffers=[];for(const l in this.binders){const h=this.binders[l];(h instanceof qc||h instanceof Nl||h instanceof Ao)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer),h instanceof Ao&&h.paintTransitionVertexBuffer&&this._buffers.push(h.paintTransitionVertexBuffer)}}upload(l){for(const h in this.binders){const m=this.binders[h];(m instanceof qc||m instanceof Nl||m instanceof Ao)&&m.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const h=this.binders[l];(h instanceof qc||h instanceof Nl||h instanceof Ao)&&h.destroy()}}}class Vl{constructor(l,h,m=()=>!0){this.programConfigurations={};for(const _ of l)this.programConfigurations[_.id]=new Xc(_,h,m);this.needsUpload=!1,this._featureMap=new Rg,this._featureMapWithoutIds=new Rg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(l,h,m,_,S,T,M,L,k){for(const F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(l,h,_,S,T,M,L,k);h.id!==void 0?this._featureMap.add(h.id,m,this._bufferOffset,l):(this._featureMapWithoutIds.add(this._idlessCounter,m,this._bufferOffset,l),this._idlessCounter+=1),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,h,m,_,S,T,M,L){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(l,this._featureMap,this._featureMapWithoutIds,h,k,_,S,T,M||0,L)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}const mD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function vD(d,l){return mD[d]||[d.replace(`${l}-`,"").replace(/-/g,"_")]}const _D={"line-pattern":{source:Ru,composite:Ru},"fill-pattern":{source:Ru,composite:Ru},"fill-extrusion-pattern":{source:Ru,composite:Ru},"line-dasharray":{source:jh,composite:jh}},yD={color:{source:Ou,composite:ku},number:{source:Zc,composite:Ou}};function m1(d,l,h){const m=_D[d];return m&&m[h]||yD[l][h]}si(F_,"ConstantBinder"),si(Bg,"PatternConstantBinder"),si(qc,"SourceExpressionBinder"),si(Ao,"PatternCompositeBinder"),si(Nl,"CompositeExpressionBinder"),si(Xc,"ProgramConfiguration",{omit:["_buffers"]}),si(Vl,"ProgramConfigurationSet");const hs=Ne/Math.PI/2,x=5,c=6,p=16383,b=64,A=[b,32,16],C=-hs,P=hs;function O(d,l,h,m=hs){return h=wr(h),[d*Math.sin(h)*m,-l*m,d*Math.cos(h)*m]}function B(d,l,h){return O(Math.cos(wr(d)),Math.sin(wr(d)),l,h)}const G=63710088e-1,j=2*Math.PI*G;class Y{constructor(l,h){if(isNaN(l)||isNaN(h))throw new Error(`Invalid LngLat object: (${l}, ${h})`);if(this.lng=+l,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Y(Ft(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const h=Math.PI/180,m=this.lat*h,_=l.lat*h,S=Math.sin(m)*Math.sin(_)+Math.cos(m)*Math.cos(_)*Math.cos((l.lng-this.lng)*h);return G*Math.acos(Math.min(S,1))}toBounds(l=0){const h=360*l/40075017,m=h/Math.cos(Math.PI/180*this.lat);return new W({lng:this.lng-m,lat:this.lat-h},{lng:this.lng+m,lat:this.lat+h})}toEcef(l){return B(this.lat,this.lng,hs+l*hs/G)}static convert(l){if(l instanceof Y)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Y(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Y(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class W{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1]))}setNorthEast(l){return this._ne=l instanceof Y?new Y(l.lng,l.lat):Y.convert(l),this}setSouthWest(l){return this._sw=l instanceof Y?new Y(l.lng,l.lat):Y.convert(l),this}extend(l){const h=this._sw,m=this._ne;let _,S;if(l instanceof Y)_=l,S=l;else{if(!(l instanceof W))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(W.convert(l)):this.extend(Y.convert(l)):typeof l=="object"&&l!==null&&l.hasOwnProperty("lat")&&(l.hasOwnProperty("lon")||l.hasOwnProperty("lng"))?this.extend(Y.convert(l)):this;if(_=l._sw,S=l._ne,!_||!S)return this}return h||m?(h.lng=Math.min(_.lng,h.lng),h.lat=Math.min(_.lat,h.lat),m.lng=Math.max(S.lng,m.lng),m.lat=Math.max(S.lat,m.lat)):(this._sw=new Y(_.lng,_.lat),this._ne=new Y(S.lng,S.lat)),this}getCenter(){return new Y((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Y(this.getWest(),this.getNorth())}getSouthEast(){return new Y(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:m}=Y.convert(l);let _=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_}static convert(l){if(l)return l instanceof W?l:new W(l)}}const J=0,tt=25.5;function nt(d){return j*Math.cos(d*Math.PI/180)}function ut(d){return(180+d)/360}function st(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function pt(d,l){return d/nt(l)}function xt(d){return 360*d-180}function vt(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Et(d,l){return d*nt(vt(l))}const bt=85.051129;function Pt(d){return Math.cos(wr(ct(d,-bt,bt)))}function Mt(d,l){const h=ct(l,J,tt),m=Math.pow(2,h);return Pt(d)*j/(512*m)}function Tt(d){return 1/Math.cos(d*Math.PI/180)}function Lt(d,l=0){const h=Math.exp(Math.PI*(1-(d.y+l/Ne)/(1<<d.z)*2));return 80150034*h/(h*h+1)/Ne/(1<<d.z)}class qt{constructor(l,h,m=0){this.x=+l,this.y=+h,this.z=+m}static fromLngLat(l,h=0){const m=Y.convert(l);return new qt(ut(m.lng),st(m.lat),pt(h,m.lat))}toLngLat(){return new Y(xt(this.x),vt(this.y))}toAltitude(){return Et(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/j*Tt(vt(this.y))}}function jt(d,l,h,m,_,S,T,M,L){const k=(l+m)/2,F=(h+_)/2,V=new Ce(k,F);M(V),function(U,Z,q,Q,it,at){const dt=q-it,mt=Q-at;return Math.abs((Q-Z)*dt-(q-U)*mt)/Math.hypot(dt,mt)}(V.x,V.y,S.x,S.y,T.x,T.y)>=L?(jt(d,l,h,k,F,S,V,M,L),jt(d,k,F,m,_,V,T,M,L)):d.push(T)}function oe(d,l,h){let m=d[0],_=m.x,S=m.y;l(m);const T=[m];for(let M=1;M<d.length;M++){const L=d[M],{x:k,y:F}=L;l(L),jt(T,_,S,k,F,m,L,l,h),_=k,S=F,m=L}return T}function te(d,l,h,m){if(m(l,h)){const _=l.add(h)._mult(.5);te(d,l,_,m),te(d,_,h,m)}else d.push(h)}function he(d,l){let h=d[0];const m=[h];for(let _=1;_<d.length;_++){const S=d[_];te(m,h,S,l),h=S}return m}const Oe=Math.pow(2,14)-1,Jt=-Oe-1;function Ut(d,l){const h=Math.round(d.x*l),m=Math.round(d.y*l);return d.x=ct(h,Jt,Oe),d.y=ct(m,Jt,Oe),(h<d.x||h>d.x+1||m<d.y||m>d.y+1)&&Mi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function de(d,l,h){const m=d.loadGeometry(),_=d.extent,S=Ne/_;if(l&&h&&h.projection.isReprojectedInTileSpace){const T=1<<l.z,{scale:M,x:L,y:k,projection:F}=h,V=U=>{const Z=xt((l.x+U.x/_)/T),q=vt((l.y+U.y/_)/T),Q=F.project(Z,q);U.x=(Q.x*M-L)*_,U.y=(Q.y*M-k)*_};for(let U=0;U<m.length;U++)if(d.type!==1)m[U]=oe(m[U],V,1);else{const Z=[];for(const q of m[U])q.x<0||q.x>=_||q.y<0||q.y>=_||(V(q),Z.push(q));m[U]=Z}}for(const T of m)for(const M of T)Ut(M,S);return m}function ee(d,l){return{type:d.type,id:d.id,properties:d.properties,geometry:l?de(d):[]}}class Ae{constructor(l,h,m,_,S){this.properties={},this.extent=m,this.type=0,this.id=void 0,this._pbf=l,this._geometry=-1,this._keys=_,this._values=S,l.readFields(Ue,this,h)}loadGeometry(){const l=this._pbf;l.pos=this._geometry;const h=l.readVarint()+l.pos,m=[];let _,S=1,T=0,M=0,L=0;for(;l.pos<h;){if(T<=0){const k=l.readVarint();S=7&k,T=k>>3}if(T--,S===1||S===2)M+=l.readSVarint(),L+=l.readSVarint(),S===1&&(_&&m.push(_),_=[]),_&&_.push(new Ce(M,L));else{if(S!==7)throw new Error(`unknown command ${S}`);_&&_.push(_[0].clone())}}return _&&m.push(_),m}bbox(){const l=this._pbf;l.pos=this._geometry;const h=l.readVarint()+l.pos;let m=1,_=0,S=0,T=0,M=1/0,L=-1/0,k=1/0,F=-1/0;for(;l.pos<h;){if(_<=0){const V=l.readVarint();m=7&V,_=V>>3}if(_--,m===1||m===2)S+=l.readSVarint(),T+=l.readSVarint(),S<M&&(M=S),S>L&&(L=S),T<k&&(k=T),T>F&&(F=T);else if(m!==7)throw new Error(`unknown command ${m}`)}return[M,k,L,F]}toGeoJSON(l,h,m){const _=this.extent*Math.pow(2,m),S=this.extent*l,T=this.extent*h,M=this.loadGeometry();function L(U){return[360*(U.x+S)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+T)/_)*Math.PI))-90]}function k(U){return U.map(L)}let F;if(this.type===1){const U=[];for(const q of M)U.push(q[0]);const Z=k(U);F=U.length===1?{type:"Point",coordinates:Z[0]}:{type:"MultiPoint",coordinates:Z}}else if(this.type===2){const U=M.map(k);F=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=function(q){const Q=q.length;if(Q<=1)return[q];const it=[];let at,dt;for(let mt=0;mt<Q;mt++){const _t=ci(q[mt]);_t!==0&&(dt===void 0&&(dt=_t<0),dt===_t<0?(at&&it.push(at),at=[q[mt]]):at&&at.push(q[mt]))}return at&&it.push(at),it}(M),Z=[];for(const q of U)Z.push(q.map(k));F=Z.length===1?{type:"Polygon",coordinates:Z[0]}:{type:"MultiPolygon",coordinates:Z}}}const V={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(V.id=this.id),V}}function Ue(d,l,h){d===1?l.id=h.readVarint():d===2?function(m,_){const S=m.readVarint()+m.pos;for(;m.pos<S;){const T=_._keys[m.readVarint()],M=_._values[m.readVarint()];_.properties[T]=M}}(h,l):d===3?l.type=h.readVarint():d===4&&(l._geometry=h.pos)}function ci(d){let l=0;for(let h,m,_=0,S=d.length,T=S-1;_<S;T=_++)h=d[_],m=d[T],l+=(m.x-h.x)*(h.y+m.y);return l}Ae.types=["Unknown","Point","LineString","Polygon"];class Le{constructor(l,h){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(Be,this,h),this.length=this._features.length}feature(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];const h=this._pbf.readVarint()+this._pbf.pos;return new Ae(this._pbf,h,this.extent,this._keys,this._values)}}function Be(d,l,h){d===15?l.version=h.readVarint():d===1?l.name=h.readString():d===5?l.extent=h.readVarint():d===2?l._features.push(h.pos):d===3?l._keys.push(h.readString()):d===4&&l._values.push(function(m){let _=null;const S=m.readVarint()+m.pos;for(;m.pos<S;){const T=m.readVarint()>>3;_=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _}(h))}class hi{constructor(l,h){this.layers=l.readFields(ni,{},h)}}function ni(d,l,h){if(d===3){const m=new Le(h,h.readVarint()+h.pos);m.length&&(l[m.name]=m)}}const ii="3d_elevation_id",ai="level";class Ei{constructor(){this._valid=!1}reset(l){return this.feature=l,this._valid=!0,this._geometry=l.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(l,h){return this._valid&&l(h(this._geometry)),this}require(l,h,m){return this.get(l,!0,h,m)}optional(l,h,m){return this.get(l,!1,h,m)}success(){return this._valid}get(l,h,m,_){const S=this.feature.properties.hasOwnProperty(l)?+this.feature.properties[l]:void 0;return this._valid&&S!==void 0&&!Number.isNaN(S)?m(_?_(S):S):h&&(this._valid=!1),this}}class mr{constructor(l,h){this.featureFunc=l,this.vertexFunc=h}parseFeature(l,h,m){return this.featureFunc(l,h,m)}parseVertex(l,h,m){return this.vertexFunc(l,h,m)}}const Ir=new mr((d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).optional("fixed_height_relative",m=>{h.constantHeight=m},Vi.decodeRelativeHeight).geometry(m=>{h.bounds=m},gg).success(),(d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).require("elevation_idx",m=>{h.idx=m}).require("extent",m=>{h.extent=m}).require("height_relative",m=>{h.height=m},Vi.decodeRelativeHeight).geometry(m=>{h.position=m},Vi.getPoint).success()),an=new mr((d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).optional("fixed_height",m=>{h.constantHeight=m},Vi.decodeMetricHeight).geometry(m=>{h.bounds=m},gg).success(),(d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).require("elevation_idx",m=>{h.idx=m}).require("extent",m=>{h.extent=m}).require("height",m=>{h.height=m},Vi.decodeMetricHeight).geometry(m=>{h.position=m},Vi.getPoint).success());class Vi{static getPoint(l){return oc(l[0][0].x,l[0][0].y)}static decodeRelativeHeight(l){return 1e-4*l*5}static decodeMetricHeight(l){return 1e-4*l}static getVersionSchema(l){return l?l==="1.0.1"?an:void 0:Ir}static parse(l){const h=[],m=[],_=l.length,S=new Ei;for(let T=0;T<_;T++){const M=l.feature(T),L=M.properties.version,k=Vi.getVersionSchema(L);if(k===void 0){Mi(`Unknown elevation feature version number ${L||"(unknown)"}`);continue}const F=M.properties.type;if(!F)continue;const V=Ae.types[M.type];if(V==="Point"&&F==="curve_point"){const U={};k.parseVertex(S,M,U)&&h.push(U)}else if(V==="Polygon"&&F==="curve_meta"){const U={};k.parseFeature(S,M,U)&&m.push(U)}}return{vertices:h,features:m}}}class Tr{constructor(l,h){this.pos=l,this.dir=h}intersectsPlane(l,h,m){const _=Ih(h,this.dir);if(Math.abs(_)<1e-6)return!1;const S=((l[0]-this.pos[0])*h[0]+(l[1]-this.pos[1])*h[1])/_;return m[0]=this.pos[0]+this.dir[0]*S,m[1]=this.pos[1]+this.dir[1]*S,!0}}class ir{constructor(l,h){this.pos=l,this.dir=h}intersectsPlane(l,h,m){const _=Ke(h,this.dir);if(Math.abs(_)<1e-6)return!1;const S=((l[0]-this.pos[0])*h[0]+(l[1]-this.pos[1])*h[1]+(l[2]-this.pos[2])*h[2])/_;return m[0]=this.pos[0]+this.dir[0]*S,m[1]=this.pos[1]+this.dir[1]*S,m[2]=this.pos[2]+this.dir[2]*S,!0}closestPointOnSphere(l,h,m){if(function(Z,q){var Q=Z[0],it=Z[1],at=Z[2],dt=q[0],mt=q[1],_t=q[2];return Math.abs(Q-dt)<=u*Math.max(1,Math.abs(Q),Math.abs(dt))&&Math.abs(it-mt)<=u*Math.max(1,Math.abs(it),Math.abs(mt))&&Math.abs(at-_t)<=u*Math.max(1,Math.abs(at),Math.abs(_t))}(this.pos,l)||h===0)return m[0]=m[1]=m[2]=0,!1;const[_,S,T]=this.dir,M=this.pos[0]-l[0],L=this.pos[1]-l[1],k=this.pos[2]-l[2],F=_*_+S*S+T*T,V=2*(M*_+L*S+k*T),U=V*V-4*F*(M*M+L*L+k*k-h*h);if(U<0){const Z=Math.max(-V/2,0),q=M+_*Z,Q=L+S*Z,it=k+T*Z,at=Math.hypot(q,Q,it);return m[0]=q*h/at,m[1]=Q*h/at,m[2]=it*h/at,!1}{const Z=(-V-Math.sqrt(U))/(2*F);if(Z<0){const q=Math.hypot(M,L,k);return m[0]=M*h/q,m[1]=L*h/q,m[2]=k*h/q,!1}return m[0]=M+_*Z,m[1]=L+S*Z,m[2]=k+T*Z,!0}}}class Qr{constructor(l,h,m,_,S){this.TL=l,this.TR=h,this.BR=m,this.BL=_,this.horizon=S}static fromInvProjectionMatrix(l,h,m){const _=[-1,1,1],S=[1,1,1],T=[1,-1,1],M=[-1,-1,1],L=zt(_,_,l),k=zt(S,S,l),F=zt(T,T,l),V=zt(M,M,l);return new Qr(L,k,F,V,h/m)}}function Mr(d,l,h){let m=1/0,_=-1/0;const S=[];for(const T of d){qe(S,T,l);const M=Ke(S,h);m=Math.min(m,M),_=Math.max(_,M)}return[m,_]}function pn(d,l){let h=!0;for(let m=0;m<d.planes.length;m++){const _=d.planes[m];let S=0;for(let T=0;T<l.length;T++)S+=+(Ke(_,l[T])+_[3]>=0);if(S===0)return 0;S!==l.length&&(h=!1)}return h?2:1}function Or(d,l){for(const h of d.projections){const m=Mr(l,d.points[0],h.axis);if(h.projection[1]<m[0]||h.projection[0]>m[1])return 0}return 1}function ar(d,l){let h=0;const m=[0,0,0,0];for(let T=0;T<d.length;T++)m[0]=d[T][0],m[1]=d[T][1],m[2]=d[T][2],m[3]=1,(_=m)[0]*(S=l)[0]+_[1]*S[1]+_[2]*S[2]+_[3]*S[3]>=0&&h++;var _,S;return h}class Gr{constructor(l,h){this.points=l||new Array(8).fill([0,0,0]),this.planes=h||new Array(6).fill([0,0,0,0]),this.bounds=cr.fromPoints(this.points),this.projections=[],this.frustumEdges=[qe([],this.points[2],this.points[3]),qe([],this.points[0],this.points[3]),qe([],this.points[4],this.points[0]),qe([],this.points[5],this.points[1]),qe([],this.points[6],this.points[2]),qe([],this.points[7],this.points[3])];for(const m of this.frustumEdges){const _=[0,-m[2],m[1]],S=[m[2],0,-m[0]];this.projections.push({axis:_,projection:Mr(this.points,this.points[0],_)}),this.projections.push({axis:S,projection:Mr(this.points,this.points[0],S)})}}static fromInvProjectionMatrix(l,h,m,_){const S=Math.pow(2,m),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const F=Li([],k,l),V=1/F[3]/h*S;return(U=F)[0]=(Z=F)[0]*(q=[V,V,_?1/F[3]:V,V])[0],U[1]=Z[1]*q[1],U[2]=Z[2]*q[2],U[3]=Z[3]*q[3],U;var U,Z,q}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const F=ye([],We([],qe([],T[k[0]],T[k[1]]),qe([],T[k[2]],T[k[1]]))),V=-Ke(F,T[k[1]]);return F.concat(V)}),L=[];for(let k=0;k<T.length;k++)L.push([T[k][0],T[k][1],T[k][2]]);return new Gr(L,M)}intersectsPrecise(l,h,m){for(let _=0;_<h.length;_++)if(!ar(l,h[_]))return 0;for(let _=0;_<this.planes.length;_++)if(!ar(l,this.planes[_]))return 0;for(const _ of m)for(const S of this.frustumEdges){const T=We([],_,S),M=Rt(T);if(M===0)continue;Ge(T,T,1/M);const L=Mr(this.points,this.points[0],T),k=Mr(l,this.points[0],T);if(L[0]>k[1]||k[0]>L[1])return 0}return 1}containsPoint(l){for(const h of this.planes){const m=h[3];if(Ke([h[0],h[1],h[2]],l)+m<0)return!1}return!0}}class cr{static fromPoints(l){const h=[1/0,1/0,1/0],m=[-1/0,-1/0,-1/0];for(const _ of l)Te(h,h,_),be(m,m,_);return new cr(h,m)}static fromTileIdAndHeight(l,h,m){const _=1<<l.canonical.z,S=l.canonical.x,T=l.canonical.y;return new cr([S/_,T/_,h],[(S+1)/_,(T+1)/_,m])}static applyTransform(l,h){const m=l.getCorners();for(let _=0;_<m.length;++_)zt(m[_],m[_],h);return cr.fromPoints(m)}static applyTransformFast(l,h){const m=[h[12],h[13],h[14]],_=[...m];for(let S=0;S<3;S++)for(let T=0;T<3;T++){const M=h[4*T+S],L=M*l.min[T],k=M*l.max[T];m[S]+=Math.min(L,k),_[S]+=Math.max(L,k)}return new cr(m,_)}static projectAabbCorners(l,h){const m=l.getCorners();for(let _=0;_<m.length;++_)zt(m[_],m[_],h);return m}constructor(l,h){this.min=l,this.max=h,this.center=Ge([],Vt([],this.min,this.max),.5)}quadrant(l){const h=[l%2==0,l<2],m=kt(this.min),_=kt(this.max);for(let S=0;S<h.length;S++)m[S]=h[S]?this.min[S]:this.center[S],_[S]=h[S]?this.center[S]:this.max[S];return _[2]=this.max[2],new cr(m,_)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}getCorners(){const l=this.min,h=this.max;return[[l[0],l[1],l[2]],[h[0],l[1],l[2]],[h[0],h[1],l[2]],[l[0],h[1],l[2]],[l[0],l[1],h[2]],[h[0],l[1],h[2]],[h[0],h[1],h[2]],[l[0],h[1],h[2]]]}intersects(l){return this.intersectsAabb(l.bounds)?pn(l,this.getCorners()):0}intersectsFlat(l){return this.intersectsAabb(l.bounds)?pn(l,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(l,h){return h||this.intersects(l)?Or(l,this.getCorners()):0}intersectsPreciseFlat(l,h){return h||this.intersectsFlat(l)?Or(l,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(l){for(let h=0;h<3;++h)if(this.min[h]>l.max[h]||l.min[h]>this.max[h])return!1;return!0}intersectsAabbXY(l){return!(this.min[0]>l.max[0]||l.min[0]>this.max[0]||this.min[1]>l.max[1]||l.min[1]>this.max[1])}encapsulate(l){for(let h=0;h<3;h++)this.min[h]=Math.min(this.min[h],l.min[h]),this.max[h]=Math.max(this.max[h],l.max[h])}encapsulatePoint(l){for(let h=0;h<3;h++)this.min[h]=Math.min(this.min[h],l[h]),this.max[h]=Math.max(this.max[h],l[h])}closestPoint(l){return[Math.max(Math.min(this.max[0],l[0]),this.min[0]),Math.max(Math.min(this.max[1],l[1]),this.min[1]),Math.max(Math.min(this.max[2],l[2]),this.min[2])]}}si(cr,"Aabb");class wn{constructor(l,h){this.feature=l,this.metersToTile=h,this.index=0}get(){const l=this.feature.vertices[this.index],h=this.feature.vertexProps[this.index].dir,m=h[1],_=-h[0],S=(l.extent+1)*this.metersToTile;return[new Ce(Math.trunc(l.position[0]+m*S),Math.trunc(l.position[1]+_*S)),new Ce(Math.trunc(l.position[0]-m*S),Math.trunc(l.position[1]-_*S))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Zr{constructor(l,h,m,_,S,T){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Jn(),Jn(),Jn(),Jn(),Jn(),Jn(),Jn()],this.id=l,this.heightRange={min:m,max:m},this.safeArea=h,this.constantHeight=m,this.constantHeight==null&&(this.constantHeight!=null||_.length!==0)){this.vertices=_,this.edges=S,this.edges=this.edges.filter(M=>{return M.a<this.vertices.length&&M.b<this.vertices.length&&!((L=this.vertices[M.a].position)[0]===(k=this.vertices[M.b].position)[0]&&L[1]===k[1]);var L,k}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const M of this.vertices)this.vertexProps.push({dir:oc(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,M.height),this.heightRange.max=Math.max(this.heightRange.max,M.height);for(const M of this.edges){const L=this.vertices[M.a].position,k=this.vertices[M.b].position,F=xs(Jn(),k,L),V=Hn(F),U=ss(Jn(),F,1/V);this.edgeProps.push({vec:F,dir:U,len:V});const Z=this.vertexProps[M.a].dir,q=this.vertexProps[M.b].dir;Qa(Z,Z,U),Qa(q,q,U)}for(const M of this.vertexProps)M.dir[0]===0&&M.dir[1]===0||To(M.dir,M.dir);this.tessellate(T)}}pointElevation(l){if(this.constantHeight!=null)return this.constantHeight;const h=this.getClosestEdge(l);if(h==null)return 0;const[m,_]=h;return zi(this.vertices[this.edges[m].a].height,this.vertices[this.edges[m].b].height,_)}computeSlopeNormal(l,h){const m=this.getClosestEdge(l);if(!m)return Ct(0,0,1);const _=m[0],S=this.edges[_],T=this.edgeProps[_].vec,M=Ct(T[0],T[1],(this.vertices[S.b].height-this.vertices[S.a].height)*h),L=Ct(M[1],-M[0],0);We(L,L,M);const k=Rt(L);return k>0?Ge(L,L,1/k):Gt(L,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(l){if(this.edges.length===0)return;let h=0,m=Number.POSITIVE_INFINITY,_=0;const[S,T,M,L,k,F,V]=this._tmpVec2;Ja(V,l.x,l.y);const U=new Tr(V,null);for(let Z=0;Z<this.edges.length;Z++){const q=this.edges[Z],Q=this.edgeProps[Z].dir;U.dir=Q;const it=this.vertices[q.a].position,at=this.vertices[q.b].position,dt=U.intersectsPlane(it,this.vertexProps[q.a].dir,S),mt=U.intersectsPlane(at,this.vertexProps[q.b].dir,T);if(!dt||!mt)continue;xs(M,T,S),xs(L,V,S);const _t=Ih(M,M),Dt=_t>0?Ih(L,M)/_t:0,At=ct(Dt,0,1),Ot=Math.abs((Dt-At)*this.edgeProps[Z].len);xs(k,V,it),Ja(F,Q[1],-Q[0]);const Nt=Ot+Math.abs(Ih(k,F));Nt<m&&(h=Z,m=Nt,_=At)}return[h,_]}tessellate(l){const h=ft(),m=ft(),_=ft(),S=ft();for(let T=this.edges.length-1;T>=0;--T){const M=this.edges[T].a,L=this.edges[T].b,{position:k,height:F,extent:V}=this.vertices[M],{position:U,height:Z,extent:q}=this.vertices[L],Q=this.vertexProps[M].dir,it=this.vertexProps[L].dir;if(Gt(h,k[0]/l,k[1]/l,F),Gt(m,U[0]/l,U[1]/l,Z),Gt(_,Q[1],-Q[0],0),Ge(_,_,V),Gt(S,it[1],-it[0],0),Ge(S,S,q),this.distSqLines(Ct(h[0]+.5*_[0],h[1]+.5*_[1],h[2]+.5*_[2]),Ct(m[0]-.5*S[0],m[1]-.5*S[1],m[2]-.5*S[2]),Ct(h[0]-.5*_[0],h[1]-.5*_[1],h[2]-.5*_[2]),Ct(m[0]+.5*S[0],m[1]+.5*S[1],m[2]+.5*S[2]))<=.0025000000000000005)continue;const at=this.vertices.length,dt=Qa(Jn(),k,U);this.vertices.push({position:ss(dt,dt,.5),height:.5*(F+Z),extent:.5*(V+q)});const mt=Qa(Jn(),Q,it);this.vertexProps.push({dir:To(mt,mt)}),this.edges.splice(T,1),this.edgeProps.splice(T,1),this.edges.push({a:M,b:at}),this.edges.push({a:at,b:L});const _t=xs(Jn(),this.vertices[at].position,k),Dt=Hn(_t),At={vec:_t,dir:ss(Jn(),_t,1/Dt),len:Dt};this.edgeProps.push(At),this.edgeProps.push(At)}}distSqLines(l,h,m,_){const S=Qt(ft(),h,l),T=Qt(ft(),_,m),M=Qt(ft(),l,m),L=Ke(S,S),k=Ke(S,T),F=Ke(S,M),V=Ke(T,T),U=Ke(T,M),Z=L*V-k*k;if(Z===0)return or(Si(S,m,_,Ke(M,T)/Ke(T,T)),l);const q=(L*U-k*F)/Z;return or(Si(S,l,h,(k*U-F*V)/Z),Si(T,m,_,q))}}class Hi{static parseFrom(l,h){const m=Vi.parse(l);if(!m)return[];let{vertices:_,features:S}=m;const T=1/Lt(h);S.sort((F,V)=>F.id-V.id),_.sort((F,V)=>F.id-V.id||F.idx-V.idx),_=_.filter((F,V,U)=>V===U.findIndex(Z=>Z.id===F.id&&Z.idx===F.idx));const M=new Array;let L=0;const k=_.length;for(const F of S){if(F.constantHeight){M.push(new Zr(F.id,F.bounds,F.constantHeight));continue}for(;L!==k&&_[L].id<F.id;)L++;if(L===k||_[L].id!==F.id)continue;const V=new Array,U=new Array,Z=L;for(;L!==k&&_[L].id===F.id;){const q=_[L];if(V.push({position:q.position,height:q.height,extent:q.extent}),L!==Z&&_[L-1].idx===q.idx-1){const Q=L-Z;U.push({a:Q-1,b:Q})}L++}M.push(new Zr(F.id,F.bounds,void 0,V,U,T))}return M}static getElevationFeature(l,h){if(!h)return;const m=+l.properties[ii];return Number.isNaN(m)?void 0:h.find(_=>_.id===m)}}class Dr{constructor(l,h){this.zScale=1,this.xOffset=0,this.yOffset=0,l.equals(h)||(this.zScale=Math.pow(2,h.z-l.z),this.xOffset=(l.x*this.zScale-h.x)*Ne,this.yOffset=(l.y*this.zScale-h.y)*Ne)}constantElevation(l,h){if(l.constantHeight!=null)return this.computeBiasedHeight(l.constantHeight,h)}pointElevation(l,h,m){const _=this.constantElevation(h,m);return _??(l.x=l.x*this.zScale+this.xOffset,l.y=l.y*this.zScale+this.yOffset,this.computeBiasedHeight(h.pointElevation(l),m))}computeBiasedHeight(l,h){return h<=0?l:l+h*St(0,h,l>=0?l:Math.abs(.5*l))}}si(Zr,"ElevationFeature");class zn{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.projection=l.projection,this.layoutVertexArray=new us,this.indexArray=new Pn,this.segments=new Vn,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Zc),this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){const S=this.layers[0],T=[];let M=null;S.type==="circle"&&(M=S.layout.get("circle-sort-key"));for(const{feature:k,id:F,index:V,sourceLayerIndex:U}of l){const Z=this.layers[0]._featureFilter.needGeometry,q=ee(k,Z);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),q,m))continue;const Q=M?M.evaluate(q,{},m):void 0,it={id:F,properties:k.properties,type:k.type,sourceLayerIndex:U,index:V,geometry:Z?q.geometry:de(k,m,_),patterns:{},sortKey:Q};T.push(it)}M&&T.sort((k,F)=>k.sortKey-F.sortKey);let L=null;_.projection.name==="globe"&&(this.globeExtVertexArray=new M_,L=_.projection);for(const k of T){const{geometry:F,index:V,sourceLayerIndex:U}=k,Z=l[V].feature;this.addFeature(k,F,V,h.availableImages,m,L,h.brightness,h.elevationFeatures),h.featureIndex.insert(Z,F,V,U,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(l,h,m,_,S,T,M){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,UT.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,hD.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=l.createVertexBuffer(this.elevatedLayoutVertexArray,uD.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(l,h,m,_,S,T,M,L){let k;this.elevationMode!=="none"&&(k=Hi.getElevationFeature(l,L));for(const F of h)for(const V of F){const U=V.x,Z=V.y;if(U<0||U>=Ne||Z<0||Z>=Ne)continue;if(T){const it=T.projectTilePoint(U,Z,S),at=T.upVector(S,U,Z);this.addGlobeExtVertex(it,at),this.addGlobeExtVertex(it,at),this.addGlobeExtVertex(it,at),this.addGlobeExtVertex(it,at)}const q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),Q=q.vertexLength;if(this.addCircleVertex(U,Z,-1,-1),this.addCircleVertex(U,Z,1,-1),this.addCircleVertex(U,Z,1,1),this.addCircleVertex(U,Z,-1,1),this.elevationMode!=="none"){const it=k?k.pointElevation(new Ce(U,Z)):0;this.hasElevation=this.hasElevation||it!==0;for(let at=0;at<4;at++)this.elevatedLayoutVertexArray.emplaceBack(it)}this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+2,Q+3),q.vertexLength+=4,q.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{},_,S,M,void 0,this.worldview)}addCircleVertex(l,h,m,_){this.layoutVertexArray.emplaceBack(2*l+(m+1)/2,2*h+(_+1)/2)}addGlobeExtVertex(l,h){this.globeExtVertexArray.emplaceBack(l.x,l.y,l.z,h[0]*16384,h[1]*16384,h[2]*16384)}}function ia(d,l){for(let h=0;h<d.length;h++)if(qa(l,d[h]))return!0;for(let h=0;h<l.length;h++)if(qa(d,l[h]))return!0;return!!Jo(d,l)}function Un(d,l,h){return!!qa(d,l)||!!po(l,d,h)}function Kn(d,l){if(d.length===1)return Ml(l,d[0]);for(let h=0;h<l.length;h++){const m=l[h];for(let _=0;_<m.length;_++)if(qa(d,m[_]))return!0}for(let h=0;h<d.length;h++)if(Ml(l,d[h]))return!0;for(let h=0;h<l.length;h++)if(Jo(d,l[h]))return!0;return!1}function ds(d,l,h){if(d.length>1){if(Jo(d,l))return!0;for(let m=0;m<l.length;m++)if(po(l[m],d,h))return!0}for(let m=0;m<d.length;m++)if(po(d[m],l,h))return!0;return!1}function Jo(d,l){if(d.length===0||l.length===0)return!1;for(let h=0;h<d.length-1;h++){const m=d[h],_=d[h+1];for(let S=0;S<l.length-1;S++)if(fo(m,_,l[S],l[S+1]))return!0}return!1}function fo(d,l,h,m){return dr(d,h,m)!==dr(l,h,m)&&dr(d,l,h)!==dr(d,l,m)}function Io(d,l,h){return(d.x-h.x)*(l.y-h.y)-(d.y-h.y)*(l.x-h.x)}function Xs(d,l,h,m){const _=Io(d,l,m),S=Io(d,l,h);if(Math.sign(_)===Math.sign(S))return;const T=Io(h,m,d),M=T+S-_;return Math.sign(T)!==Math.sign(M)?[T/(T-M),S/(S-_)]:void 0}function po(d,l,h){const m=h*h;if(l.length===1)return d.distSqr(l[0])<m;for(let _=1;_<l.length;_++)if(Ys(d,l[_-1],l[_])<m)return!0;return!1}function Ys(d,l,h){const m=l.distSqr(h);if(m===0)return d.distSqr(l);const _=((d.x-l.x)*(h.x-l.x)+(d.y-l.y)*(h.y-l.y))/m;return d.distSqr(_<0?l:_>1?h:h.sub(l)._mult(_)._add(l))}function Ml(d,l){let h,m,_,S=!1;for(let T=0;T<d.length;T++){h=d[T];for(let M=0,L=h.length-1;M<h.length;L=M++)m=h[M],_=h[L],m.y>l.y!=_.y>l.y&&l.x<(_.x-m.x)*(l.y-m.y)/(_.y-m.y)+m.x&&(S=!S)}return S}function qa(d,l){let h=!1;for(let m=0,_=d.length-1;m<d.length;_=m++){const S=d[m],T=d[_];S.y>l.y!=T.y>l.y&&l.x<(T.x-S.x)*(l.y-S.y)/(T.y-S.y)+S.x&&(h=!h)}return h}function Wn(d,l,h,m,_){for(const T of d)if(l<=T.x&&h<=T.y&&m>=T.x&&_>=T.y)return!0;const S=[new Ce(l,h),new Ce(l,_),new Ce(m,_),new Ce(m,h)];if(d.length>2){for(const T of S)if(qa(d,T))return!0}for(let T=0;T<d.length-1;T++)if(ra(d[T],d[T+1],S))return!0;return!1}function ra(d,l,h){const m=h[0],_=h[2];if(d.x<m.x&&l.x<m.x||d.x>_.x&&l.x>_.x||d.y<m.y&&l.y<m.y||d.y>_.y&&l.y>_.y)return!1;const S=dr(d,l,h[0]);return S!==dr(d,l,h[1])||S!==dr(d,l,h[2])||S!==dr(d,l,h[3])}function hn(d,l,h,m,_,S){let T=l.y-d.y,M=d.x-l.x;if(S=S||0){const L=T*T+M*M;if(L===0)return!0;const k=Math.sqrt(L);T/=k,M/=k}return!((h.x-d.x)*T+(h.y-d.y)*M-S<0||(m.x-d.x)*T+(m.y-d.y)*M-S<0||(_.x-d.x)*T+(_.y-d.y)*M-S<0)}function sa(d,l,h,m,_,S,T){return!(hn(d,l,m,_,S,T)||hn(l,h,m,_,S,T)||hn(h,d,m,_,S,T)||hn(m,_,d,l,h,T)||hn(_,S,d,l,h,T)||hn(S,m,d,l,h,T))}function Xa(d,l,h){const m=l.paint.get(d).value;return m.kind==="constant"?m.value:h.programConfigurations.get(l.id).getMaxValue(d)}function $n(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function Ks(d,l,h,m,_){if(!l[0]&&!l[1])return d;const S=Ce.convert(l)._mult(_);h==="viewport"&&S._rotate(-m);const T=[];for(let M=0;M<d.length;M++)T.push(d[M].sub(S));return T}function If(d,l,h,m){const _=Ce.convert(d)._mult(m);return l==="viewport"&&_._rotate(-h),_}let Yc,Mf;function Cf(d,l,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[d*m-2*Math.PI*6378137/2,l*m-2*Math.PI*6378137/2]}si(zn,"CircleBucket",{omit:["layers"]});class Js{constructor(l,h,m){this.z=l,this.x=h,this.y=m,this.key=Qs(0,l,l,h,m)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}isChildOf(l){const h=this.z-l.z;return l.z===0||l.z<this.z&&l.x===this.x>>h&&l.y===this.y>>h}url(l,h){const m=function(S,T,M){var L=Cf(256*S,256*(T=Math.pow(2,M)-T-1),M),k=Cf(256*(S+1),256*(T+1),M);return L[0]+","+L[1]+","+k[0]+","+k[1]}(this.x,this.y,this.z),_=function(S,T,M){let L,k="";for(let F=S;F>0;F--)L=1<<F-1,k+=(T&L?1:0)+(M&L?2:0);return k}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",m)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fc{constructor(l,h){this.wrap=l,this.canonical=h,this.key=Qs(l,h.z,h.z,h.x,h.y)}}class ja{constructor(l,h,m,_,S){this.overscaledZ=l,this.wrap=h,this.canonical=new Js(m,+_,+S),this.key=h===0&&l===m?this.canonical.key:Qs(h,l,m,_,S)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){const h=this.canonical.z-l;return l>this.canonical.z?new ja(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ja(l,this.wrap,l,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(l,h=!0){if(this.overscaledZ===l&&h)return this.key;if(l>this.canonical.z)return Qs(this.wrap*+h,l,this.canonical.z,this.canonical.x,this.canonical.y);{const m=this.canonical.z-l;return Qs(this.wrap*+h,l,l,this.canonical.x>>m,this.canonical.y>>m)}}isChildOf(l){if(l.wrap!==this.wrap)return!1;const h=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.z<this.canonical.z&&l.canonical.x===this.canonical.x>>h&&l.canonical.y===this.canonical.y>>h}children(l){if(this.overscaledZ>=l)return[new ja(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,_=2*this.canonical.y;return[new ja(h,this.wrap,h,m,_),new ja(h,this.wrap,h,m+1,_),new ja(h,this.wrap,h,m,_+1),new ja(h,this.wrap,h,m+1,_+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new ja(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new ja(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qs(d,l,h,m,_){const S=1<<Math.min(h,22);let T=S*(_%S)+m%S;return d&&h<22&&(T+=S*S*((d<0?-2*d-1:2*d)%(1<<2*(22-h)))),16*(32*T+h)+(l-h)}const $h=[d=>{let l=d.canonical.x-1,h=d.wrap;return l<0&&(l=(1<<d.canonical.z)-1,h--),new ja(d.overscaledZ,h,d.canonical.z,l,d.canonical.y)},d=>{let l=d.canonical.x+1,h=d.wrap;return l===1<<d.canonical.z&&(l=0,h++),new ja(d.overscaledZ,h,d.canonical.z,l,d.canonical.y)},d=>new ja(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(d.canonical.y===0?1<<d.canonical.z:d.canonical.y)-1),d=>new ja(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];si(Js,"CanonicalTileID"),si(ja,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const WT=gr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:N_}=WT,qrt=gr([{name:"a_pos_3",components:3,type:"Int16"}]);var BN=gr([{name:"a_pos",type:"Int16",components:2}]);function $T(d){return d*hs/G}const Xrt=[new cr([C,C,C],[P,P,P]),new cr([C,C,C],[0,0,P]),new cr([0,C,C],[P,0,P]),new cr([C,0,C],[0,P,P]),new cr([0,0,C],[P,P,P])];function FN(d,l,h,m=!0){const _=Ge([],d._camera.position,d.worldSize),S=[l,h,1,1];Li(S,S,d.pixelMatrixInverse),pi(S,S,1/S[3]);const T=ye([],qe([],S,_)),M=d.globeMatrix,L=[M[12],M[13],M[14]],k=qe([],L,_),F=Rt(k),V=ye([],k),U=d.worldSize/(2*Math.PI),Z=Ke(V,T),q=Math.asin(U/F);if(q<Math.acos(Z)){if(!m)return null;const se=[],Kt=[];Ge(se,T,F/Z),ye(Kt,qe(Kt,se,k)),ye(T,Vt(T,k,Ge(T,Kt,Math.tan(q)*F)))}const Q=[];new ir(_,T).closestPointOnSphere(L,U,Q);const it=ye([],ea(M,0)),at=ye([],ea(M,1)),dt=ye([],ea(M,2)),mt=Ke(it,Q),_t=Ke(at,Q),Dt=Ke(dt,Q),At=Fo(Math.asin(-_t/U));let Ot=Fo(Math.atan2(mt,Dt));Ot=d.center.lng+function(se,Kt){const le=(Kt-se+180)%360-180;return le<-180?le+360:le}(d.center.lng,Ot);const Nt=ut(Ot),Ht=ct(st(At),0,1);return new qt(Nt,Ht)}class Yrt{constructor(l,h,m){this.a=qe([],l,m),this.b=qe([],h,m),this.center=m;const _=ye([],this.a),S=ye([],this.b);this.angle=Math.acos(Ke(_,S))}}function xD(d,l){if(d.angle===0)return null;let h;return h=d.a[l]===0?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[l]/d.a[l]/Math.sin(d.angle)-1/Math.tan(d.angle)),h<0||h>1?null:function(m,_,S,T){const M=Math.sin(S);return m*(Math.sin((1-T)*S)/M)+_*(Math.sin(T*S)/M)}(d.a[l],d.b[l],d.angle,ct(h,0,1))+d.center[l]}function zu(d){if(d.z<=1)return Xrt[d.z+2*d.y+d.x];const l=bD(ZT(d));return cr.fromPoints(l)}function Zh(d,l,h){return Ge(d,d,1-h),li(d,d,l,h)}function NN(d,l,h){for(const m of d)zt(m,m,l),Ge(m,m,h)}function VN(d,l,h,m){const _=l/d.worldSize,S=d.globeMatrix;if(h.z<=1){const Ht=zu(h).getCorners();return NN(Ht,S,_),cr.fromPoints(Ht)}const T=ZT(h,m),M=bD(T,hs+$T(d._tileCoverLift));NN(M,S,_);const L=Number.MAX_VALUE,k=[-L,-L,-L],F=[L,L,L];if(T.contains(d.center)){for(const Kt of M)Te(F,F,Kt),be(k,k,Kt);k[2]=0;const Ht=d.point,se=[Ht.x*_,Ht.y*_,0];return Te(F,F,se),be(k,k,se),new cr(F,k)}if(d._tileCoverLift>0){for(const Ht of M)Te(F,F,Ht),be(k,k,Ht);return new cr(F,k)}const V=[S[12]*_,S[13]*_,S[14]*_],U=T.getCenter(),Z=ct(d.center.lat,-bt,bt),q=ct(U.lat,-bt,bt),Q=ut(d.center.lng),it=st(Z);let at=Q-ut(U.lng);const dt=it-st(q);at>.5?at-=1:at<-.5&&(at+=1);let mt=0;Math.abs(at)>Math.abs(dt)?mt=at>=0?1:3:(mt=dt>=0?0:2,li(V,V,[S[4]*_,S[5]*_,S[6]*_],-Math.sin(wr(dt>=0?T.getSouth():T.getNorth()))*hs));const _t=M[mt],Dt=M[(mt+1)%4],At=new Yrt(_t,Dt,V),Ot=[xD(At,0)||_t[0],xD(At,1)||_t[1],xD(At,2)||_t[2]],Nt=Ef(d.zoom);if(Nt>0){const Ht=function({x:Kt,y:le,z:ge},Se,ze,De,me){const Ee=1/(1<<ge);let ae=Kt*Ee,re=ae+Ee,Ie=le*Ee,Re=Ie+Ee,xe=0;const oi=(ae+re)/2-De;return oi>.5?xe=-1:oi<-.5&&(xe=1),ae=((ae+xe)*Se-(De*=Se))*ze+De,re=((re+xe)*Se-De)*ze+De,Ie=(Ie*Se-(me*=Se))*ze+me,Re=(Re*Se-me)*ze+me,[[ae,Re,0],[re,Re,0],[re,Ie,0],[ae,Ie,0]]}(h,l,d._pixelsPerMercatorPixel,Q,it);for(let Kt=0;Kt<M.length;Kt++)Zh(M[Kt],Ht[Kt],Nt);const se=Vt([],Ht[mt],Ht[(mt+1)%4]);Ge(se,se,.5),Zh(Ot,se,Nt)}for(const Ht of M)Te(F,F,Ht),be(k,k,Ht);return F[2]=Math.min(_t[2],Dt[2]),Te(F,F,Ot),be(k,k,Ot),new cr(F,k)}function ZT({x:d,y:l,z:h},m=!1){const _=1/(1<<h),S=new Y(xt(d*_),l===(1<<h)-1&&m?-90:vt((l+1)*_)),T=new Y(xt((d+1)*_),l===0&&m?90:vt(l*_));return new W(S,T)}function bD(d,l=hs){const h=wr(d.getNorth()),m=wr(d.getSouth()),_=Math.cos(h),S=Math.cos(m),T=Math.sin(h),M=Math.sin(m),L=d.getWest(),k=d.getEast();return[O(S,M,L,l),O(S,M,k,l),O(_,T,k,l),O(_,T,L,l)]}function v1(d,l,h,m){const _=1<<h.z,S=(d/Ne+h.x)/_;return B(vt((l/Ne+h.y)/_),xt(S),m)}function qT({min:d,max:l}){return p/Math.max(l[0]-d[0],l[1]-d[1],l[2]-d[2])}const UN=new Float64Array(16);function XT(d){const l=qT(d),h=et(UN,[l,l,l]);return N(h,h,Ze([],d.min))}function wD(d){const l=(m=d.min,(h=UN)[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=m[0],h[13]=m[1],h[14]=m[2],h[15]=1,h);var h,m;const _=1/qT(d);return H(l,l,[_,_,_])}function SD(d){const l=Ne/(2*Math.PI);return d/(2*Math.PI)/l}function GN(d,l){return Ne/(512*Math.pow(2,d))*qT(zu(l))}function HN(d,l,h,m,_){const S=SD(h),T=[d,l,-h/(2*Math.PI)],M=D(new Float64Array(16));return N(M,M,T),H(M,M,[S,S,S]),$(M,M,wr(-_)),X(M,M,wr(-m)),M}function Ef(d){return St(x,c,d)}function jN(d,l){const h=B(l.lat,l.lng),m=function(q){const Q=B(q._center.lat,q._center.lng);let it=We([],Ct(0,1,0),Q);const at=rt([],-q.angle,Q);it=zt(it,it,at),rt(at,-q._pitch,it);const dt=ye([],Q);return Ge(dt,dt,$T(q.cameraToCenterDistance/q.pixelsPerMeter)),zt(dt,dt,at),Vt([],Q,dt)}(d);return T=(_=Qt([],m,h))[0],M=_[1],L=_[2],k=(S=h)[0],F=S[1],V=S[2],Z=(U=Math.sqrt((T*T+M*M+L*L)*(k*k+F*F+V*V)))&&Ke(_,S)/U,Math.acos(Math.min(Math.max(Z,-1),1));var _,S,T,M,L,k,F,V,U,Z}function TD(d,l){return jN(d,l)>Math.PI/2*1.01}const WN=wr(85),Krt=Math.cos(WN),Jrt=Math.sin(WN),Qrt=I(),$N=d=>{const l=[];return d.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l};function ZN(d,l,h,m,_,S,T,M,L){if(S&&d.queryGeometry.isAboveHorizon)return!1;S&&(L*=d.pixelToTileUnitsFactor);const k=d.tileID.canonical,F=h.projection.upVectorScale(k,h.center.lat,h.worldSize).metersToTile;for(const V of l)for(const U of V){const Z=U.add(M),q=_&&h.elevation?h.elevation.exaggeration()*_.getElevationAt(Z.x,Z.y,!0):0,Q=h.projection.projectTilePoint(Z.x,Z.y,k);if(q>0){const mt=h.projection.upVector(k,Z.x,Z.y);Q.x+=mt[0]*F*q,Q.y+=mt[1]*F*q,Q.z+=mt[2]*F*q}const it=S?Z:tnt(Q.x,Q.y,Q.z,m),at=S?d.tilespaceRays.map(mt=>int(mt,q)):d.queryGeometry.screenGeometry,dt=Li([],[Q.x,Q.y,Q.z,1],m);if(!T&&S?L*=dt[3]/h.cameraToCenterDistance:T&&!S&&(L*=h.cameraToCenterDistance/dt[3]),S){const mt=vt((U.y/Ne+k.y)/(1<<k.z));L/=h.projection.pixelsPerMeter(mt,1)/pt(1,mt)}if(Un(at,it,L))return!0}return!1}function tnt(d,l,h,m){const _=Li([],[d,l,h,1],m);return new Ce(_[0]/_[3],_[1]/_[3])}const qN=Ct(0,0,0),ent=Ct(0,0,1);function int(d,l){const h=ft();return qN[2]=l,d.intersectsPlane(qN,ent,h),new Ce(h[0],h[1])}class XN extends zn{}let YN,KN,JN,QN;function t5(d,{width:l,height:h},m,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==l*h*m)throw new RangeError("mismatched image size")}else _=new Uint8Array(l*h*m);return d.width=l,d.height=h,d.data=_,d}function e5(d,l,h){const{width:m,height:_}=l;m===d.width&&_===d.height||(AD(d,l,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,m),height:Math.min(d.height,_)},h,null),d.width=m,d.height=_,d.data=l.data)}function AD(d,l,h,m,_,S,T,M){if(_.width===0||_.height===0)return l;if(_.width>d.width||_.height>d.height||h.x>d.width-_.width||h.y>d.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>l.width||_.height>l.height||m.x>l.width-_.width||m.y>l.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const L=d.data,k=l.data,F=S===4&&M;for(let V=0;V<_.height;V++){const U=((h.y+V)*d.width+h.x)*S,Z=((m.y+V)*l.width+m.x)*S;if(F)for(let q=0;q<_.width;q++){const Q=U+q*S+3,it=Z+q*S;k[it+0]=255,k[it+1]=255,k[it+2]=255,k[it+3]=L[Q]}else if(T)for(let q=0;q<_.width;q++){const Q=U+q*S,it=Z+q*S,at=new Xr(L[Q+0]/255,L[Q+1]/255,L[Q+2]/255,L[Q+3]).toNonPremultipliedRenderColor(T).toArray();k[it+0]=at[0],k[it+1]=at[1],k[it+2]=at[2],k[it+3]=at[3]}else for(let q=0;q<_.width*S;q++)k[Z+q]=L[U+q]}return l}si(XN,"HeatmapBucket",{omit:["layers"]});class Df{constructor(l,h){t5(this,l,1,h)}resize(l){e5(this,new Df(l),1)}clone(){return new Df({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,_,S){AD(l,h,m,_,S,1,null)}}class Mo{constructor(l,h){t5(this,l,4,h)}resize(l){e5(this,new Mo(l),4)}replace(l,h){h?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,_,S,T,M){AD(l,h,m,_,S,4,T,M)}}class i5{constructor(l,h){this.width=l.width,this.height=l.height,this.data=h instanceof Uint8Array?new Float32Array(h.buffer):h}}function _1(d){const l={},h=d.resolution||256,m=d.clips?d.clips.length:1,_=d.image||new Mo({width:h,height:m}),S=(T,M,L)=>{l[d.evaluationKey]=L;const k=d.expression.evaluate(l),F=k?k.toNonPremultipliedRenderColor(null):null;F&&(_.data[T+M+0]=Math.floor(255*F.r),_.data[T+M+1]=Math.floor(255*F.g),_.data[T+M+2]=Math.floor(255*F.b),_.data[T+M+3]=Math.floor(255*F.a))};if(d.clips)for(let T=0,M=0;T<m;++T,M+=4*h)for(let L=0,k=0;L<h;L++,k+=4){const F=L/(h-1),{start:V,end:U}=d.clips[T];S(M,k,V*(1-F)+U*F)}else for(let T=0,M=0;T<h;T++,M+=4)S(0,M,T/(h-1));return _}si(Df,"AlphaImage"),si(Mo,"RGBAImage");const rnt=gr([{name:"a_pos",components:2,type:"Int16"}],4),nnt=gr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ant=gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),ont=gr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function V_(d,l,h=2){const m=l&&l.length,_=m?l[0]*h:d.length;let S=r5(d,0,_,h,!0);const T=[];if(!S||S.next===S.prev)return T;let M,L,k;if(m&&(S=function(F,V,U,Z){const q=[];for(let Q=0,it=V.length;Q<it;Q++){const at=r5(F,V[Q]*Z,Q<it-1?V[Q+1]*Z:F.length,Z,!1);at===at.next&&(at.steiner=!0),q.push(pnt(at))}q.sort(hnt);for(let Q=0;Q<q.length;Q++)U=dnt(q[Q],U);return U}(d,l,S,h)),d.length>80*h){M=d[0],L=d[1];let F=M,V=L;for(let U=h;U<_;U+=h){const Z=d[U],q=d[U+1];Z<M&&(M=Z),q<L&&(L=q),Z>F&&(F=Z),q>V&&(V=q)}k=Math.max(F-M,V-L),k=k!==0?32767/k:0}return y1(S,T,h,M,L,k,0),T}function r5(d,l,h,m,_){let S;if(_===function(T,M,L,k){let F=0;for(let V=M,U=L-k;V<L;V+=k)F+=(T[U]-T[V])*(T[V+1]+T[U+1]),U=V;return F}(d,l,h,m)>0)for(let T=l;T<h;T+=m)S=s5(T/m|0,d[T],d[T+1],S);else for(let T=h-m;T>=l;T-=m)S=s5(T/m|0,d[T],d[T+1],S);return S&&U_(S,S.next)&&(w1(S),S=S.next),S}function Fg(d,l){if(!d)return d;l||(l=d);let h,m=d;do if(h=!1,m.steiner||!U_(m,m.next)&&Ya(m.prev,m,m.next)!==0)m=m.next;else{if(w1(m),m=l=m.prev,m===m.next)break;h=!0}while(h||m!==l);return l}function y1(d,l,h,m,_,S,T){if(!d)return;!T&&S&&function(L,k,F,V){let U=L;do U.z===0&&(U.z=ID(U.x,U.y,k,F,V)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==L);U.prevZ.nextZ=null,U.prevZ=null,function(Z){let q,Q=1;do{let it,at=Z;Z=null;let dt=null;for(q=0;at;){q++;let mt=at,_t=0;for(let At=0;At<Q&&(_t++,mt=mt.nextZ,mt);At++);let Dt=Q;for(;_t>0||Dt>0&&mt;)_t!==0&&(Dt===0||!mt||at.z<=mt.z)?(it=at,at=at.nextZ,_t--):(it=mt,mt=mt.nextZ,Dt--),dt?dt.nextZ=it:Z=it,it.prevZ=dt,dt=it;at=mt}dt.nextZ=null,Q*=2}while(q>1)}(U)}(d,m,_,S);let M=d;for(;d.prev!==d.next;){const L=d.prev,k=d.next;if(S?lnt(d,m,_,S):snt(d))l.push(L.i,d.i,k.i),w1(d),d=k.next,M=k.next;else if((d=k)===M){T?T===1?y1(d=cnt(Fg(d),l),l,h,m,_,S,2):T===2&&unt(d,l,h,m,_,S):y1(Fg(d),l,h,m,_,S,1);break}}}function snt(d){const l=d.prev,h=d,m=d.next;if(Ya(l,h,m)>=0)return!1;const _=l.x,S=h.x,T=m.x,M=l.y,L=h.y,k=m.y,F=Math.min(_,S,T),V=Math.min(M,L,k),U=Math.max(_,S,T),Z=Math.max(M,L,k);let q=m.next;for(;q!==l;){if(q.x>=F&&q.x<=U&&q.y>=V&&q.y<=Z&&x1(_,M,S,L,T,k,q.x,q.y)&&Ya(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function lnt(d,l,h,m){const _=d.prev,S=d,T=d.next;if(Ya(_,S,T)>=0)return!1;const M=_.x,L=S.x,k=T.x,F=_.y,V=S.y,U=T.y,Z=Math.min(M,L,k),q=Math.min(F,V,U),Q=Math.max(M,L,k),it=Math.max(F,V,U),at=ID(Z,q,l,h,m),dt=ID(Q,it,l,h,m);let mt=d.prevZ,_t=d.nextZ;for(;mt&&mt.z>=at&&_t&&_t.z<=dt;){if(mt.x>=Z&&mt.x<=Q&&mt.y>=q&&mt.y<=it&&mt!==_&&mt!==T&&x1(M,F,L,V,k,U,mt.x,mt.y)&&Ya(mt.prev,mt,mt.next)>=0||(mt=mt.prevZ,_t.x>=Z&&_t.x<=Q&&_t.y>=q&&_t.y<=it&&_t!==_&&_t!==T&&x1(M,F,L,V,k,U,_t.x,_t.y)&&Ya(_t.prev,_t,_t.next)>=0))return!1;_t=_t.nextZ}for(;mt&&mt.z>=at;){if(mt.x>=Z&&mt.x<=Q&&mt.y>=q&&mt.y<=it&&mt!==_&&mt!==T&&x1(M,F,L,V,k,U,mt.x,mt.y)&&Ya(mt.prev,mt,mt.next)>=0)return!1;mt=mt.prevZ}for(;_t&&_t.z<=dt;){if(_t.x>=Z&&_t.x<=Q&&_t.y>=q&&_t.y<=it&&_t!==_&&_t!==T&&x1(M,F,L,V,k,U,_t.x,_t.y)&&Ya(_t.prev,_t,_t.next)>=0)return!1;_t=_t.nextZ}return!0}function cnt(d,l){let h=d;do{const m=h.prev,_=h.next.next;!U_(m,_)&&a5(m,h,h.next,_)&&b1(m,_)&&b1(_,m)&&(l.push(m.i,h.i,_.i),w1(h),w1(h.next),h=d=_),h=h.next}while(h!==d);return Fg(h)}function unt(d,l,h,m,_,S){let T=d;do{let M=T.next.next;for(;M!==T.prev;){if(T.i!==M.i&&gnt(T,M)){let L=o5(T,M);return T=Fg(T,T.next),L=Fg(L,L.next),y1(T,l,h,m,_,S,0),void y1(L,l,h,m,_,S,0)}M=M.next}T=T.next}while(T!==d)}function hnt(d,l){let h=d.x-l.x;return h===0&&(h=d.y-l.y,h===0)&&(h=(d.next.y-d.y)/(d.next.x-d.x)-(l.next.y-l.y)/(l.next.x-l.x)),h}function dnt(d,l){const h=function(_,S){let T=S;const M=_.x,L=_.y;let k,F=-1/0;if(U_(_,T))return T;do{if(U_(_,T.next))return T.next;if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){const Q=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(Q<=M&&Q>F&&(F=Q,k=T.x<T.next.x?T:T.next,Q===M))return k}T=T.next}while(T!==S);if(!k)return null;const V=k,U=k.x,Z=k.y;let q=1/0;T=k;do{if(M>=T.x&&T.x>=U&&M!==T.x&&n5(L<Z?M:F,L,U,Z,L<Z?F:M,L,T.x,T.y)){const Q=Math.abs(L-T.y)/(M-T.x);b1(T,_)&&(Q<q||Q===q&&(T.x>k.x||T.x===k.x&&fnt(k,T)))&&(k=T,q=Q)}T=T.next}while(T!==V);return k}(d,l);if(!h)return l;const m=o5(h,d);return Fg(m,m.next),Fg(h,h.next)}function fnt(d,l){return Ya(d.prev,d,l.prev)<0&&Ya(l.next,d,d.next)<0}function ID(d,l,h,m,_){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-h)*_|0)|d<<8))|d<<4))|d<<2))|d<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-m)*_|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function pnt(d){let l=d,h=d;do(l.x<h.x||l.x===h.x&&l.y<h.y)&&(h=l),l=l.next;while(l!==d);return h}function n5(d,l,h,m,_,S,T,M){return(_-T)*(l-M)>=(d-T)*(S-M)&&(d-T)*(m-M)>=(h-T)*(l-M)&&(h-T)*(S-M)>=(_-T)*(m-M)}function x1(d,l,h,m,_,S,T,M){return!(d===T&&l===M)&&n5(d,l,h,m,_,S,T,M)}function gnt(d,l){return d.next.i!==l.i&&d.prev.i!==l.i&&!function(h,m){let _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==m.i&&_.next.i!==m.i&&a5(_,_.next,h,m))return!0;_=_.next}while(_!==h);return!1}(d,l)&&(b1(d,l)&&b1(l,d)&&function(h,m){let _=h,S=!1;const T=(h.x+m.x)/2,M=(h.y+m.y)/2;do _.y>M!=_.next.y>M&&_.next.y!==_.y&&T<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==h);return S}(d,l)&&(Ya(d.prev,d,l.prev)||Ya(d,l.prev,l))||U_(d,l)&&Ya(d.prev,d,d.next)>0&&Ya(l.prev,l,l.next)>0)}function Ya(d,l,h){return(l.y-d.y)*(h.x-l.x)-(l.x-d.x)*(h.y-l.y)}function U_(d,l){return d.x===l.x&&d.y===l.y}function a5(d,l,h,m){const _=KT(Ya(d,l,h)),S=KT(Ya(d,l,m)),T=KT(Ya(h,m,d)),M=KT(Ya(h,m,l));return _!==S&&T!==M||!(_!==0||!YT(d,h,l))||!(S!==0||!YT(d,m,l))||!(T!==0||!YT(h,d,m))||!(M!==0||!YT(h,l,m))}function YT(d,l,h){return l.x<=Math.max(d.x,h.x)&&l.x>=Math.min(d.x,h.x)&&l.y<=Math.max(d.y,h.y)&&l.y>=Math.min(d.y,h.y)}function KT(d){return d>0?1:d<0?-1:0}function b1(d,l){return Ya(d.prev,d,d.next)<0?Ya(d,l,d.next)>=0&&Ya(d,d.prev,l)>=0:Ya(d,l,d.prev)<0||Ya(d,d.next,l)<0}function o5(d,l){const h=MD(d.i,d.x,d.y),m=MD(l.i,l.x,l.y),_=d.next,S=l.prev;return d.next=l,l.prev=d,h.next=_,_.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function s5(d,l,h,m){const _=MD(d,l,h);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function w1(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function MD(d,l,h){return{i:d,x:l,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function S1(d,l){const h=d.length;if(h<=1)return[d];const m=[];let _,S;for(let T=0;T<h;T++){const M=pr(d[T]);M!==0&&(d[T].area=Math.abs(M),S===void 0&&(S=M<0),S===M<0?(_&&m.push(_),_=[d[T]]):_.push(d[T]))}if(_&&m.push(_),l>1)for(let T=0;T<m.length;T++)m[T].length<=l||(Hc(m[T],l,1,m[T].length-1,mnt),m[T]=m[T].slice(0,l));return m}function mnt(d,l){return l.area-d.area}function l5(d,l,h=1){if(!d)return null;const m=typeof d=="string"?cs.from(d).getPrimary():d.getPrimary(),_=typeof d=="string"?null:d.getSecondary();for(const S of[m,_]){if(!S)continue;const T=S.id.toString();l.has(T)||l.set(T,[]),S.scaleSelf(h),l.get(T).push(S)}return{primary:m.toString(),secondary:_?_.toString():null}}function CD(d,l,h,m){const _=m.patternDependencies;let S=!1;for(const T of l){const M=T.paint.get(`${d}-pattern`);M.isConstant()||(S=!0),l5(M.constantOr(null),_,h)&&(S=!0)}return S}function ED(d,l,h,m,_,S){const T=S.patternDependencies;for(const M of l){const L=M.paint.get(`${d}-pattern`).value;if(L.kind!=="constant"){let k=L.evaluate({zoom:m},h,{},S.availableImages);k=k&&k.name?k.name:k;const F=l5(k,T,_);if(!F)continue;const{primary:V,secondary:U}=F;V&&(h.patterns[M.id]=[V,U].filter(Boolean))}}return h}class c5{constructor(){this.polygons=new Map}add(l,...h){const m=this.polygons.get(l);m?m.push(...h):this.polygons.set(l,h)}merge(l){for(const[h,m]of l.polygons)this.add(h,...m)}}class qh{constructor(){this.portals=[]}static isOnBorder(l,h){return l<=0&&h<=0||l>=Ne&&h>=Ne}static evaluate(l){if(l.length===0)return new qh;let h=[];for(const L of l)h.push(...L.portals);if(h.length===0)return new qh;for(const L of h){const k=L.va,F=L.vb;(qh.isOnBorder(k.x,F.x)||qh.isOnBorder(k.y,F.y))&&(L.type="border")}const m=h.filter(L=>L.type!=="unevaluated"),_=h.filter(L=>L.type==="unevaluated");if(_.length===0)return new qh;_.sort((L,k)=>L.hash===k.hash?L.isTunnel===k.isTunnel?0:L.isTunnel?-1:1:L.hash<k.hash?1:-1),h=m.concat(_);let S=m.length,T=S,M=S;do if(T++,T===h.length||h[S].hash!==h[T].hash){if(T-S==2){M<S&&(h[M]=h[S],h[S]=null);const L=h[M],k=h[T-1];L.type=L.isTunnel!==k.isTunnel?"tunnel":"polygon",L.connection={a:L.connection.a,b:k.connection.a},M++}S=T}while(S!==h.length);return h.splice(M),h.sort((L,k)=>L.hash<k.hash?1:-1),{portals:h}}}si(qh,"ElevationPortalGraph"),si(c5,"ElevationPolygons");class vnt{constructor(l,h,m){this.outPositions=l,this.outNormals=h,this.outIndices=m,this.vertexLookup=new Map}addVertex(l,h,m){let _=l[2];m!=null&&(_*=m);const S=`${l[0]},${l[1]},${l[2]},${h[0]},${h[1]},${h[2]}`,T=this.vertexLookup.get(S);if(T!=null)return T;const M=this.outPositions.length;this.vertexLookup.set(S,M);const L=Math.trunc(16384*h[0]),k=Math.trunc(16384*h[1]),F=Math.trunc(16384*h[2]);return this.outPositions.emplaceBack(l[0],l[1],_),this.outNormals.emplaceBack(L,k,F),M}addTriangle(l,h,m){this.outIndices.emplaceBack(l,h,m)}addTriangles(l,h,m){if(l.length===0)return;const _=m.length===1,S=ft(),T=ft();for(let M=0;M<l.length;M+=3){const L=h[l[M+0]],k=h[l[M+1]],F=h[l[M+2]],V=_?m[0]:m[l[M+1]],U=_?m[0]:m[l[M+2]];Gt(S,L.x,L.y,_?m[0]:m[l[M+0]]);const Z=this.addVertex(S,T);Gt(S,k.x,k.y,V);const q=this.addVertex(S,T);Gt(S,F.x,F.y,U);const Q=this.addVertex(S,T);this.outIndices.emplaceBack(Z,q,Q)}}addQuad(l,h,m,_,S,T){const M=this.addVertex(l,S,T),L=this.addVertex(h,S,T),k=this.addVertex(m,S,T),F=this.addVertex(_,S,T);this.addTriangle(M,L,k),this.addTriangle(k,F,M)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class tl{constructor(l,h,m,_){this.unevaluatedPortals=new qh,this.portalPolygons=new c5,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Qx,this.vertexNormals=new t1,this.indexArray=new Pn,this.tileToMeters=Lt(l),this.bridgeProgramConfigurations=new Vl(h,{zoom:m,lut:_},S=>S!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Vl(h,{zoom:m,lut:_},S=>S!=="fill-bridge-guard-rail-color")}addVertices(l,h){const m=this.unevalVertices.length;for(let _=0;_<l.length;_++)this.unevalVertices.push(l[_]),this.unevalHeights.push(h[_]);return m}addTriangles(l,h,m){const _=m?this.unevalTunnelTriangles:this.unevalTriangles;for(const S of l)_.push(S+h)}addRenderableRing(l,h,m,_,S,T){const M=[new Ce(S.min.x,S.min.y),new Ce(S.max.x,S.min.y),new Ce(S.max.x,S.max.y),new Ce(S.min.x,S.max.y)];for(let L=0;L<m-1;L++){const k=h+L,F=k+1,V=this.unevalVertices[k],U=this.unevalVertices[F];if(!(V.x>=S.min.x&&V.x<=S.max.x&&V.y>=S.min.y&&V.y<=S.max.y||U.x>=S.min.x&&U.x<=S.max.x&&U.y>=S.min.y&&U.y<=S.max.y||ra(V,U,M))||this.isOnBorder(V.x,U.x)||this.isOnBorder(V.y,U.y))continue;const Z=tl.computeEdgeHash(this.unevalVertices[k],this.unevalVertices[F]);let q,Q=this.vertexHashLookup.get(tl.computePosHash(V));Q!=null?q=Q.next:(Q=this.vertexHashLookup.get(tl.computePosHash(U)),q=Q!=null?Q.prev:Z),this.unevalEdges.push({polygonIdx:l,a:k,b:F,hash:Z,portalHash:q,isTunnel:_,type:"unevaluated",featureInfo:T})}}addPortalCandidates(l,h,m,_,S){if(h.length===0)return;this.portalPolygons.add(l,{geometry:h,zLevel:S});const T=h[0];this.vertexHashLookup.clear();let M=tl.computeEdgeHash(T[T.length-2],T[T.length-1]);for(let L=0;L<T.length-1;L++){const k=T[L+0],F=T[L+1],V=oc(F.x-k.x,F.y-k.y),U=Hn(V);if(U===0)continue;let Z="unevaluated";const q=_.pointElevation(k),Q=_.pointElevation(F);Math.abs(q)<.01&&Math.abs(Q)<.01?Z="entrance":(this.isOnBorder(k.x,F.x)||this.isOnBorder(k.y,F.y))&&(Z="border");const it=tl.computeEdgeHash(k,F);this.unevaluatedPortals.portals.push({connection:{a:l,b:void 0},va:k,vb:F,vab:V,length:U,hash:it,isTunnel:m,type:Z});const at=tl.computePosHash(k);this.vertexHashLookup.set(at,{prev:M,next:it}),M=it}}construct(l){if(this.unevalVertices.length===0)return;const h=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),m=U=>{U.primitiveLength=this.indexArray.length-U.primitiveOffset},_=new vnt(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(l.portals,this.unevalEdges);const S=h(),T=h(),M=h(),L=(U,Z)=>{U.sort((Q,it)=>Q.type===Z&&it.type!==Z?-1:Q.type!==Z&&it.type===Z?1:0);const q=U.findIndex(Q=>Q.type!==Z);return q>=0?q:U.length};let k=0;this.unevalEdges.length>0&&(k=L(this.unevalEdges,"none"),this.constructBridgeStructures(_,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},this.tileToMeters)),m(M);const F=h(),V=h();if(this.unevalEdges.length>0){const U=this.unevalEdges.splice(k),Z=L(U,"tunnel")+k;this.unevalEdges.push(...U),this.constructTunnelStructures(_,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},{min:k,max:Z})}m(F),_.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),m(V),_.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),m(T),_.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),m(S),this.maskSegments=Vn.simpleSegment(0,V.primitiveOffset,0,V.primitiveLength),this.depthSegments=Vn.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableBridgeSegments=Vn.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.renderableTunnelSegments=Vn.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.shadowCasterSegments=Vn.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength)}update(l,h,m,_,S,T,M,L){this.bridgeProgramConfigurations.updatePaintArrays(l,h,S,m,_,T,M,L),this.tunnelProgramConfigurations.updatePaintArrays(l,h,S,m,_,T,M,L)}upload(l){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=l.createVertexBuffer(this.vertexPositions,ant.members),this.vertexBufferNormal=l.createVertexBuffer(this.vertexNormals,ont.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(l),this.tunnelProgramConfigurations.upload(l))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(l,h,m,_,S){const T=(M,L)=>{for(let k=0;k<L.length-1;k++){const F=L[k].featureIndex,V=L[k+1].vertexStart,U=l.feature(F);M.populatePaintArrays(V,U,F,{},m,h,_,void 0,S)}};T(this.bridgeProgramConfigurations,this.bridgeFeatureSections),T(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(l,h,m,_,S){const T=new Map;for(let M=_;M<S;M++){const L=m[M],k=L.a,F=L.b,V=tl.computePosHash(l[k]),U=tl.computePosHash(l[F]);let Z=T.get(V);Z||(Z={},T.set(V,Z));let q=T.get(U);q||(q={},T.set(U,q)),h[k]<=0&&h[F]<=0||(Z.to=F,q.from=k)}return T}isTerminalVertex(l,h){const m=tl.computePosHash(this.unevalVertices[l]),_=h.get(m);return!_||!_.from||!_.to}constructBridgeStructures(l,h,m,_,S,T){l.clearVertexLookup();const M=this.computeVertexConnections(h,m,_,S.min,S.max),L=1/T,k=.5*L,F=(ze,De)=>Gt(ze,h[De].x,h[De].y,m[De]*L),V=ft(),U=ft(),Z=ft(),q=ft(),Q=ft(),it=(ze,De)=>{const me=M.get(tl.computePosHash(h[De])),Ee=me.from,ae=me.to;if(!Ee||!ae)return;F(V,Ee),F(U,De),F(Z,ae),$e(q),He(V,U)||(qe(Q,U,V),ye(q,Q)),He(Z,U)||(qe(Q,Z,U),Vt(q,q,ye(Q,Q)));const re=Ai(q);return re>0?Ge(ze,q,1/re):void 0};let at=Number.POSITIVE_INFINITY;this.sortSubarray(_,S.min,S.max,(ze,De)=>ze.featureInfo.featureIndex-De.featureInfo.featureIndex);const dt=ft(),mt=ft(),_t=ft(),Dt=ft(),At=ft(),Ot=ft(),Nt=ft(),Ht=ft(),se=ft(),Kt=[ft(),ft(),ft(),ft()],le=[ft(),ft(),ft(),ft()],ge=[{coord:new Ce(0,0),height:0},{coord:new Ce(0,0),height:0}],Se=(ze,De)=>ze>De;for(let ze=S.min;ze<S.max;ze++){const De=_[ze];if(!De.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ge,h,m,De,Se))continue;const[me,Ee]=ge;if(Gt(dt,me.coord.x,me.coord.y,L*me.height),Gt(mt,Ee.coord.x,Ee.coord.y,L*Ee.height),He(dt,mt))continue;qe(_t,mt,dt),ye(_t,_t);const ae=it(Ht,De.a)||_t,re=it(se,De.b)||_t;Gt(Dt,ae[1],-ae[0],0),ye(Dt,Dt),Gt(At,re[1],-re[0],0),ye(At,At),We(Ht,Dt,ae),ye(Ot,Ht),We(Ht,At,re),ye(Nt,Ht),Vt(Kt[0],dt,Ge(Ht,qe(Ht,Dt,Ot),k)),Vt(Kt[1],dt,Ge(Ht,Vt(Ht,Dt,Ot),k)),Vt(Kt[2],dt,Ge(Ht,Ot,k)),Kt[3]=dt,Vt(le[0],mt,Ge(Ht,qe(Ht,At,Nt),k)),Vt(le[1],mt,Ge(Ht,Vt(Ht,At,Nt),k)),Vt(le[2],mt,Ge(Ht,Nt,k)),le[3]=mt,at=this.addFeatureSection(De.featureInfo.featureIndex,at,this.bridgeFeatureSections,l);const Ie=l.addVertex(Kt[0],Dt,T),Re=l.addVertex(Kt[1],Dt,T),xe=l.addVertex(le[0],At,T),oi=l.addVertex(le[1],At,T);l.addTriangle(Ie,Re,xe),l.addTriangle(Re,oi,xe);const ui=l.addVertex(Kt[1],Ot,T),ri=l.addVertex(Kt[2],Ot,T),Xe=l.addVertex(le[1],Nt,T),ji=l.addVertex(le[2],Nt,T);l.addTriangle(ui,ri,Xe),l.addTriangle(ri,ji,Xe),Ze(Dt,Dt),Ze(At,At);const Qe=l.addVertex(Kt[2],Dt,T),Ii=l.addVertex(Kt[3],Dt,T),Zi=l.addVertex(le[2],At,T),fr=l.addVertex(le[3],At,T);l.addTriangle(Qe,Ii,Zi),l.addTriangle(Ii,fr,Zi);const Pr=this.isTerminalVertex(De.a,M),qi=this.isTerminalVertex(De.b,M);me.height<.01&&Pr&&l.addQuad(Kt[3],Kt[2],Kt[1],Kt[0],Ze(ae,ae),T),Ee.height<.01&&qi&&l.addQuad(le[0],le[1],le[2],le[3],re,T)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:l.getVertexCount()})}constructTunnelStructures(l,h,m,_,S,T){l.clearVertexLookup();let M=Number.POSITIVE_INFINITY;const L=(at,dt)=>at.featureInfo.featureIndex-dt.featureInfo.featureIndex;this.sortSubarray(_,S.min,S.max,L),this.sortSubarray(_,T.min,T.max,L);const k=at=>ye(at,at),F=[{coord:new Ce(0,0),height:0},{coord:new Ce(0,0),height:0}],V=(at,dt)=>at<dt,U=ft(),Z=ft(),q=ft(),Q=ft(),it=ft();for(let at=S.min;at<S.max;at++){if(!this.prepareEdgePoints(F,h,m,_[at],V))continue;const[dt,mt]=F,_t=k(Gt(it,-(mt.coord.y-dt.coord.y),mt.coord.x-dt.coord.x,0));M=this.addFeatureSection(_[at].featureInfo.featureIndex,M,this.tunnelFeatureSections,l),l.addQuad(Gt(U,dt.coord.x,dt.coord.y,dt.height),Gt(Z,mt.coord.x,mt.coord.y,mt.height),Gt(q,mt.coord.x,mt.coord.y,_[at].isTunnel?-.1:0),Gt(Q,dt.coord.x,dt.coord.y,_[at].isTunnel?-.1:0),_t)}for(let at=T.min;at<T.max;at++){const dt=_[at];dt.isTunnel&&([dt.a,dt.b]=[dt.b,dt.a]);const mt=h[dt.a],_t=h[dt.b],Dt=k(Gt(it,-(_t.y-mt.y),_t.x-mt.x,0));M=this.addFeatureSection(dt.featureInfo.featureIndex,M,this.tunnelFeatureSections,l),l.addQuad(Gt(U,_t.x,_t.y,0),Gt(Z,mt.x,mt.y,0),Gt(q,mt.x,mt.y,m[dt.a]+4),Gt(Q,_t.x,_t.y,m[dt.b]+4),Dt),l.addQuad(Gt(U,mt.x,mt.y,0),Gt(Z,_t.x,_t.y,0),Gt(q,_t.x,_t.y,m[dt.b]+4),Gt(Q,mt.x,mt.y,m[dt.a]+4),Dt)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:l.getVertexCount()})}setElevatedPoint(l,h,m,_){l.coord.x=h,l.coord.y=m,l.height=_}prepareEdgePoints(l,h,m,_,S){let T=h[_.a].x,M=h[_.a].y,L=h[_.b].x,k=h[_.b].y,F=m[_.a],V=m[_.b];const U=S(F,0),Z=S(V,0);if(U&&Z)return this.setElevatedPoint(l[0],T,M,F),this.setElevatedPoint(l[1],L,k,V),!0;if(!U&&!Z)return!1;if(U){if(!Z){const q=V/(V-F);L=zi(L,T,q),k=zi(k,M,q),V=zi(V,F,q)}}else{const q=F/(F-V);T=zi(T,L,q),M=zi(M,k,q),F=zi(F,V,q)}return this.setElevatedPoint(l[0],T,M,F),this.setElevatedPoint(l[1],L,k,V),!0}prepareEdges(l,h){if(h.length===0)return;h.sort((M,L)=>M.hash===L.hash?L.polygonIdx-M.polygonIdx:L.hash>M.hash?1:-1);let m=0,_=0,S=0,T=h[m].polygonIdx;do _++,(_===h.length||h[m].hash!==h[_].hash)&&((_-m==1||h[_-1].polygonIdx!==T)&&(S<m&&(h[S]=h[m],h[m]=null),h[S].type="none",S++),m=_,m!==h.length&&(T=h[m].polygonIdx));while(m!==h.length);if(h.splice(S),h.length!==0&&l.length!==0){h.sort((k,F)=>k.portalHash<F.portalHash?1:-1);let M=0,L=0;for(;M!==h.length&&L!==l.length;){const k=h[M],F=l[L];k.portalHash>F.hash?M++:F.hash>k.portalHash?L++:(k.type=F.type,M++)}}}isOnBorder(l,h){return l<=0&&h<=0||l>=Ne&&h>=Ne}addFeatureSection(l,h,m,_){return l!==h&&(h=l,m.push({featureIndex:l,vertexStart:_.getVertexCount()}),_.clearVertexLookup()),h}sortSubarray(l,h,m,_){const S=l.slice(h,m);S.sort(_),l.splice(h,S.length,...S)}static computeEdgeHash(l,h){return(l.y===h.y&&l.x>h.x||l.y>h.y)&&([l,h]=[h,l]),BigInt(tl.computePosHash(l))<<32n|BigInt(tl.computePosHash(h))}static computePosHash(l){return((65535&l.x)<<16|65535&l.y)>>>0}}var u5,h5={exports:{}},d5=(u5||(u5=1,function(d,l){(function(h){function m(It,wt){return It>wt?1:It<wt?-1:0}var _=function(It,wt){It===void 0&&(It=m),wt===void 0&&(wt=!1),this._compare=It,this._root=null,this._size=0,this._noDuplicates=!!wt},S={size:{configurable:!0}};function T(It,wt,ce,je,ue){var Je=ue-je;if(Je>0){var vi=je+Math.floor(Je/2),gi={key:wt[vi],data:ce[vi],parent:It};return gi.left=T(gi,wt,ce,je,vi),gi.right=T(gi,wt,ce,vi+1,ue),gi}return null}function M(It,wt,ce,je,ue){if(!(ce>=je)){for(var Je=It[ce+je>>1],vi=ce-1,gi=je+1;;){do vi++;while(ue(It[vi],Je)<0);do gi--;while(ue(It[gi],Je)>0);if(vi>=gi)break;var Ji=It[vi];It[vi]=It[gi],It[gi]=Ji,Ji=wt[vi],wt[vi]=wt[gi],wt[gi]=Ji}M(It,wt,ce,gi,ue),M(It,wt,gi+1,je,ue)}}_.prototype.rotateLeft=function(It){var wt=It.right;wt&&(It.right=wt.left,wt.left&&(wt.left.parent=It),wt.parent=It.parent),It.parent?It===It.parent.left?It.parent.left=wt:It.parent.right=wt:this._root=wt,wt&&(wt.left=It),It.parent=wt},_.prototype.rotateRight=function(It){var wt=It.left;wt&&(It.left=wt.right,wt.right&&(wt.right.parent=It),wt.parent=It.parent),It.parent?It===It.parent.left?It.parent.left=wt:It.parent.right=wt:this._root=wt,wt&&(wt.right=It),It.parent=wt},_.prototype._splay=function(It){for(;It.parent;){var wt=It.parent;wt.parent?wt.left===It&&wt.parent.left===wt?(this.rotateRight(wt.parent),this.rotateRight(wt)):wt.right===It&&wt.parent.right===wt?(this.rotateLeft(wt.parent),this.rotateLeft(wt)):wt.left===It&&wt.parent.right===wt?(this.rotateRight(wt),this.rotateLeft(wt)):(this.rotateLeft(wt),this.rotateRight(wt)):wt.left===It?this.rotateRight(wt):this.rotateLeft(wt)}},_.prototype.splay=function(It){for(var wt,ce,je,ue,Je;It.parent;)(ce=(wt=It.parent).parent)&&ce.parent?((je=ce.parent).left===ce?je.left=It:je.right=It,It.parent=je):(It.parent=null,this._root=It),ue=It.left,Je=It.right,It===wt.left?(ce&&(ce.left===wt?(wt.right?(ce.left=wt.right,ce.left.parent=ce):ce.left=null,wt.right=ce,ce.parent=wt):(ue?(ce.right=ue,ue.parent=ce):ce.right=null,It.left=ce,ce.parent=It)),Je?(wt.left=Je,Je.parent=wt):wt.left=null,It.right=wt,wt.parent=It):(ce&&(ce.right===wt?(wt.left?(ce.right=wt.left,ce.right.parent=ce):ce.right=null,wt.left=ce,ce.parent=wt):(Je?(ce.left=Je,Je.parent=ce):ce.left=null,It.right=ce,ce.parent=It)),ue?(wt.right=ue,ue.parent=wt):wt.right=null,It.left=wt,wt.parent=It)},_.prototype.replace=function(It,wt){It.parent?It===It.parent.left?It.parent.left=wt:It.parent.right=wt:this._root=wt,wt&&(wt.parent=It.parent)},_.prototype.minNode=function(It){if(It===void 0&&(It=this._root),It)for(;It.left;)It=It.left;return It},_.prototype.maxNode=function(It){if(It===void 0&&(It=this._root),It)for(;It.right;)It=It.right;return It},_.prototype.insert=function(It,wt){var ce=this._root,je=null,ue=this._compare;if(this._noDuplicates)for(;ce;){if(je=ce,ue(ce.key,It)===0)return;ce=ue(ce.key,It)<0?ce.right:ce.left}else for(;ce;)je=ce,ce=ue(ce.key,It)<0?ce.right:ce.left;return ce={key:It,data:wt,left:null,right:null,parent:je},je?ue(je.key,ce.key)<0?je.right=ce:je.left=ce:this._root=ce,this.splay(ce),this._size++,ce},_.prototype.find=function(It){for(var wt=this._root,ce=this._compare;wt;){var je=ce(wt.key,It);if(je<0)wt=wt.right;else{if(!(je>0))return wt;wt=wt.left}}return null},_.prototype.contains=function(It){for(var wt=this._root,ce=this._compare;wt;){var je=ce(It,wt.key);if(je===0)return!0;wt=je<0?wt.left:wt.right}return!1},_.prototype.remove=function(It){var wt=this.find(It);if(!wt)return!1;if(this.splay(wt),wt.left)if(wt.right){var ce=this.minNode(wt.right);ce.parent!==wt&&(this.replace(ce,ce.right),ce.right=wt.right,ce.right.parent=ce),this.replace(wt,ce),ce.left=wt.left,ce.left.parent=ce}else this.replace(wt,wt.left);else this.replace(wt,wt.right);return this._size--,!0},_.prototype.removeNode=function(It){if(!It)return!1;if(this.splay(It),It.left)if(It.right){var wt=this.minNode(It.right);wt.parent!==It&&(this.replace(wt,wt.right),wt.right=It.right,wt.right.parent=wt),this.replace(It,wt),wt.left=It.left,wt.left.parent=wt}else this.replace(It,It.left);else this.replace(It,It.right);return this._size--,!0},_.prototype.erase=function(It){var wt=this.find(It);if(wt){this.splay(wt);var ce=wt.left,je=wt.right,ue=null;ce&&(ce.parent=null,ue=this.maxNode(ce),this.splay(ue),this._root=ue),je&&(ce?ue.right=je:this._root=je,je.parent=ue),this._size--}},_.prototype.pop=function(){var It=this._root,wt=null;if(It){for(;It.left;)It=It.left;wt={key:It.key,data:It.data},this.remove(It.key)}return wt},_.prototype.next=function(It){var wt=It;if(wt)if(wt.right)for(wt=wt.right;wt&&wt.left;)wt=wt.left;else for(wt=It.parent;wt&&wt.right===It;)It=wt,wt=wt.parent;return wt},_.prototype.prev=function(It){var wt=It;if(wt)if(wt.left)for(wt=wt.left;wt&&wt.right;)wt=wt.right;else for(wt=It.parent;wt&&wt.left===It;)It=wt,wt=wt.parent;return wt},_.prototype.forEach=function(It){for(var wt=this._root,ce=[],je=!1,ue=0;!je;)wt?(ce.push(wt),wt=wt.left):ce.length>0?(It(wt=ce.pop(),ue++),wt=wt.right):je=!0;return this},_.prototype.range=function(It,wt,ce,je){for(var ue=[],Je=this._compare,vi=this._root;ue.length!==0||vi;)if(vi)ue.push(vi),vi=vi.left;else{if(Je((vi=ue.pop()).key,wt)>0)break;if(Je(vi.key,It)>=0&&ce.call(je,vi))return this;vi=vi.right}return this},_.prototype.keys=function(){for(var It=this._root,wt=[],ce=[],je=!1;!je;)It?(wt.push(It),It=It.left):wt.length>0?(It=wt.pop(),ce.push(It.key),It=It.right):je=!0;return ce},_.prototype.values=function(){for(var It=this._root,wt=[],ce=[],je=!1;!je;)It?(wt.push(It),It=It.left):wt.length>0?(It=wt.pop(),ce.push(It.data),It=It.right):je=!0;return ce},_.prototype.at=function(It){for(var wt=this._root,ce=[],je=!1,ue=0;!je;)if(wt)ce.push(wt),wt=wt.left;else if(ce.length>0){if(wt=ce.pop(),ue===It)return wt;ue++,wt=wt.right}else je=!0;return null},_.prototype.load=function(It,wt,ce){if(It===void 0&&(It=[]),wt===void 0&&(wt=[]),ce===void 0&&(ce=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var je=It.length;return ce&&M(It,wt,0,je-1,this._compare),this._root=T(null,It,wt,0,je),this._size=je,this},_.prototype.min=function(){var It=this.minNode(this._root);return It?It.key:null},_.prototype.max=function(){var It=this.maxNode(this._root);return It?It.key:null},_.prototype.isEmpty=function(){return this._root===null},S.size.get=function(){return this._size},_.createTree=function(It,wt,ce,je,ue){return new _(ce,ue).load(It,wt,je)},Object.defineProperties(_.prototype,S);var L=0,k=1,F=2,V=3,U=0,Z=1,q=2,Q=3;function it(It,wt,ce){wt===null?(It.inOut=!1,It.otherInOut=!0):(It.isSubject===wt.isSubject?(It.inOut=!wt.inOut,It.otherInOut=wt.otherInOut):(It.inOut=!wt.otherInOut,It.otherInOut=wt.isVertical()?!wt.inOut:wt.inOut),wt&&(It.prevInResult=!at(wt,ce)||wt.isVertical()?wt.prevInResult:wt));var je=at(It,ce);It.resultTransition=je?function(ue,Je){var vi,gi=!ue.inOut,Ji=!ue.otherInOut;switch(Je){case U:vi=gi&&Ji;break;case Z:vi=gi||Ji;break;case Q:vi=gi^Ji;break;case q:vi=ue.isSubject?gi&&!Ji:Ji&&!gi}return vi?1:-1}(It,ce):0}function at(It,wt){switch(It.type){case L:switch(wt){case U:return!It.otherInOut;case Z:return It.otherInOut;case q:return It.isSubject&&It.otherInOut||!It.isSubject&&!It.otherInOut;case Q:return!0}break;case F:return wt===U||wt===Z;case V:return wt===q;case k:return!1}return!1}var dt=function(It,wt,ce,je,ue){this.left=wt,this.point=It,this.otherEvent=ce,this.isSubject=je,this.type=ue||L,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},mt={inResult:{configurable:!0}};function _t(It,wt){return It[0]===wt[0]&&It[1]===wt[1]}dt.prototype.isBelow=function(It){var wt=this.point,ce=this.otherEvent.point;return this.left?(wt[0]-It[0])*(ce[1]-It[1])-(ce[0]-It[0])*(wt[1]-It[1])>0:(ce[0]-It[0])*(wt[1]-It[1])-(wt[0]-It[0])*(ce[1]-It[1])>0},dt.prototype.isAbove=function(It){return!this.isBelow(It)},dt.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},mt.inResult.get=function(){return this.resultTransition!==0},dt.prototype.clone=function(){var It=new dt(this.point,this.left,this.otherEvent,this.isSubject,this.type);return It.contourId=this.contourId,It.resultTransition=this.resultTransition,It.prevInResult=this.prevInResult,It.isExteriorRing=this.isExteriorRing,It.inOut=this.inOut,It.otherInOut=this.otherInOut,It},Object.defineProperties(dt.prototype,mt);var Dt=11102230246251565e-32,At=134217729,Ot=(3+8*Dt)*Dt;function Nt(It,wt,ce,je,ue){var Je,vi,gi,Ji,Ri=wt[0],di=je[0],zr=0,ln=0;di>Ri==di>-Ri?(Je=Ri,Ri=wt[++zr]):(Je=di,di=je[++ln]);var Oi=0;if(zr<It&&ln<ce)for(di>Ri==di>-Ri?(gi=Je-((vi=Ri+Je)-Ri),Ri=wt[++zr]):(gi=Je-((vi=di+Je)-di),di=je[++ln]),Je=vi,gi!==0&&(ue[Oi++]=gi);zr<It&&ln<ce;)di>Ri==di>-Ri?(gi=Je-((vi=Je+Ri)-(Ji=vi-Je))+(Ri-Ji),Ri=wt[++zr]):(gi=Je-((vi=Je+di)-(Ji=vi-Je))+(di-Ji),di=je[++ln]),Je=vi,gi!==0&&(ue[Oi++]=gi);for(;zr<It;)gi=Je-((vi=Je+Ri)-(Ji=vi-Je))+(Ri-Ji),Ri=wt[++zr],Je=vi,gi!==0&&(ue[Oi++]=gi);for(;ln<ce;)gi=Je-((vi=Je+di)-(Ji=vi-Je))+(di-Ji),di=je[++ln],Je=vi,gi!==0&&(ue[Oi++]=gi);return Je===0&&Oi!==0||(ue[Oi++]=Je),Oi}function Ht(It){return new Float64Array(It)}var se=33306690738754716e-32,Kt=22204460492503146e-32,le=11093356479670487e-47,ge=Ht(4),Se=Ht(8),ze=Ht(12),De=Ht(16),me=Ht(4);function Ee(It,wt,ce){var je=function(ue,Je,vi,gi,Ji,Ri){var di=(Je-Ri)*(vi-Ji),zr=(ue-Ji)*(gi-Ri),ln=di-zr;if(di===0||zr===0||di>0!=zr>0)return ln;var Oi=Math.abs(di+zr);return Math.abs(ln)>=se*Oi?ln:-function(Cr,cn,Yr,Zn,Mn,mn,rn){var Nr,Qi,Vr,vn,ki,Lr,Cn,Qn,la,Pa,En,wa,Is,Sa,il,Co,Gl,Ms,rl=Cr-Mn,Eo=Yr-Mn,nl=cn-mn,Hl=Zn-mn;ge[0]=(il=(Qn=rl-(Cn=(Lr=At*rl)-(Lr-rl)))*(Pa=Hl-(la=(Lr=At*Hl)-(Lr-Hl)))-((Sa=rl*Hl)-Cn*la-Qn*la-Cn*Pa))-((En=il-(Gl=(Qn=nl-(Cn=(Lr=At*nl)-(Lr-nl)))*(Pa=Eo-(la=(Lr=At*Eo)-(Lr-Eo)))-((Co=nl*Eo)-Cn*la-Qn*la-Cn*Pa)))+(ki=il-En))+(ki-Gl),ge[1]=(Is=Sa-((wa=Sa+En)-(ki=wa-Sa))+(En-ki))-((En=Is-Co)+(ki=Is-En))+(ki-Co),ge[2]=wa-((Ms=wa+En)-(ki=Ms-wa))+(En-ki),ge[3]=Ms;var no=function(zf,Vu){for(var V2=Vu[0],oy=1;oy<4;oy++)V2+=Vu[oy];return V2}(0,ge),Qo=Kt*rn;if(no>=Qo||-no>=Qo||(Nr=Cr-(rl+(ki=Cr-rl))+(ki-Mn),Vr=Yr-(Eo+(ki=Yr-Eo))+(ki-Mn),Qi=cn-(nl+(ki=cn-nl))+(ki-mn),vn=Zn-(Hl+(ki=Zn-Hl))+(ki-mn),Nr===0&&Qi===0&&Vr===0&&vn===0)||(Qo=le*rn+Ot*Math.abs(no),(no+=rl*vn+Hl*Nr-(nl*Vr+Eo*Qi))>=Qo||-no>=Qo))return no;me[0]=(il=(Qn=Nr-(Cn=(Lr=At*Nr)-(Lr-Nr)))*(Pa=Hl-(la=(Lr=At*Hl)-(Lr-Hl)))-((Sa=Nr*Hl)-Cn*la-Qn*la-Cn*Pa))-((En=il-(Gl=(Qn=Qi-(Cn=(Lr=At*Qi)-(Lr-Qi)))*(Pa=Eo-(la=(Lr=At*Eo)-(Lr-Eo)))-((Co=Qi*Eo)-Cn*la-Qn*la-Cn*Pa)))+(ki=il-En))+(ki-Gl),me[1]=(Is=Sa-((wa=Sa+En)-(ki=wa-Sa))+(En-ki))-((En=Is-Co)+(ki=Is-En))+(ki-Co),me[2]=wa-((Ms=wa+En)-(ki=Ms-wa))+(En-ki),me[3]=Ms;var Nu=Nt(4,ge,4,me,Se);me[0]=(il=(Qn=rl-(Cn=(Lr=At*rl)-(Lr-rl)))*(Pa=vn-(la=(Lr=At*vn)-(Lr-vn)))-((Sa=rl*vn)-Cn*la-Qn*la-Cn*Pa))-((En=il-(Gl=(Qn=nl-(Cn=(Lr=At*nl)-(Lr-nl)))*(Pa=Vr-(la=(Lr=At*Vr)-(Lr-Vr)))-((Co=nl*Vr)-Cn*la-Qn*la-Cn*Pa)))+(ki=il-En))+(ki-Gl),me[1]=(Is=Sa-((wa=Sa+En)-(ki=wa-Sa))+(En-ki))-((En=Is-Co)+(ki=Is-En))+(ki-Co),me[2]=wa-((Ms=wa+En)-(ki=Ms-wa))+(En-ki),me[3]=Ms;var Of=Nt(Nu,Se,4,me,ze);me[0]=(il=(Qn=Nr-(Cn=(Lr=At*Nr)-(Lr-Nr)))*(Pa=vn-(la=(Lr=At*vn)-(Lr-vn)))-((Sa=Nr*vn)-Cn*la-Qn*la-Cn*Pa))-((En=il-(Gl=(Qn=Qi-(Cn=(Lr=At*Qi)-(Lr-Qi)))*(Pa=Vr-(la=(Lr=At*Vr)-(Lr-Vr)))-((Co=Qi*Vr)-Cn*la-Qn*la-Cn*Pa)))+(ki=il-En))+(ki-Gl),me[1]=(Is=Sa-((wa=Sa+En)-(ki=wa-Sa))+(En-ki))-((En=Is-Co)+(ki=Is-En))+(ki-Co),me[2]=wa-((Ms=wa+En)-(ki=Ms-wa))+(En-ki),me[3]=Ms;var ay=Nt(Of,ze,4,me,De);return De[ay-1]}(ue,Je,vi,gi,Ji,Ri,Oi)}(It[0],It[1],wt[0],wt[1],ce[0],ce[1]);return je>0?-1:je<0?1:0}function ae(It,wt){var ce=It.point,je=wt.point;return ce[0]>je[0]?1:ce[0]<je[0]?-1:ce[1]!==je[1]?ce[1]>je[1]?1:-1:function(ue,Je,vi,gi){return ue.left!==Je.left?ue.left?1:-1:Ee(vi,ue.otherEvent.point,Je.otherEvent.point)!==0?ue.isBelow(Je.otherEvent.point)?-1:1:!ue.isSubject&&Je.isSubject?1:-1}(It,wt,ce)}function re(It,wt,ce){var je=new dt(wt,!1,It,It.isSubject),ue=new dt(wt,!0,It.otherEvent,It.isSubject);return _t(It.point,It.otherEvent.point)&&console.warn("what is that, a collapsed segment?",It),je.contourId=ue.contourId=It.contourId,ae(ue,It.otherEvent)>0&&(It.otherEvent.left=!0,ue.left=!1),It.otherEvent.otherEvent=ue,It.otherEvent=je,ce.push(ue),ce.push(je),ce}function Ie(It,wt){return It[0]*wt[1]-It[1]*wt[0]}function Re(It,wt){return It[0]*wt[0]+It[1]*wt[1]}function xe(It,wt,ce){var je=function(Ji,Ri,di,zr,ln){var Oi=[Ri[0]-Ji[0],Ri[1]-Ji[1]],Cr=[zr[0]-di[0],zr[1]-di[1]];function cn(Lr,Cn,Qn){return[Lr[0]+Cn*Qn[0],Lr[1]+Cn*Qn[1]]}var Yr=[di[0]-Ji[0],di[1]-Ji[1]],Zn=Ie(Oi,Cr),Mn=Zn*Zn,mn=Re(Oi,Oi);if(Mn>0){var rn=Ie(Yr,Cr)/Zn;if(rn<0||rn>1)return null;var Nr=Ie(Yr,Oi)/Zn;return Nr<0||Nr>1?null:rn===0||rn===1?[cn(Ji,rn,Oi)]:Nr===0||Nr===1?[cn(di,Nr,Cr)]:[cn(Ji,rn,Oi)]}if((Mn=(Zn=Ie(Yr,Oi))*Zn)>0)return null;var Qi=Re(Oi,Yr)/mn,Vr=Qi+Re(Oi,Cr)/mn,vn=Math.min(Qi,Vr),ki=Math.max(Qi,Vr);return vn<=1&&ki>=0?vn===1?[cn(Ji,vn>0?vn:0,Oi)]:ki===0?[cn(Ji,ki<1?ki:1,Oi)]:[cn(Ji,vn>0?vn:0,Oi),cn(Ji,ki<1?ki:1,Oi)]:null}(It.point,It.otherEvent.point,wt.point,wt.otherEvent.point),ue=je?je.length:0;if(ue===0||ue===1&&(_t(It.point,wt.point)||_t(It.otherEvent.point,wt.otherEvent.point))||ue===2&&It.isSubject===wt.isSubject)return 0;if(ue===1)return _t(It.point,je[0])||_t(It.otherEvent.point,je[0])||re(It,je[0],ce),_t(wt.point,je[0])||_t(wt.otherEvent.point,je[0])||re(wt,je[0],ce),1;var Je=[],vi=!1,gi=!1;return _t(It.point,wt.point)?vi=!0:ae(It,wt)===1?Je.push(wt,It):Je.push(It,wt),_t(It.otherEvent.point,wt.otherEvent.point)?gi=!0:ae(It.otherEvent,wt.otherEvent)===1?Je.push(wt.otherEvent,It.otherEvent):Je.push(It.otherEvent,wt.otherEvent),vi&&gi||vi?(wt.type=k,It.type=wt.inOut===It.inOut?F:V,vi&&!gi&&re(Je[1].otherEvent,Je[0].point,ce),2):gi?(re(Je[0],Je[1].point,ce),3):Je[0]!==Je[3].otherEvent?(re(Je[0],Je[1].point,ce),re(Je[1],Je[2].point,ce),3):(re(Je[0],Je[1].point,ce),re(Je[3].otherEvent,Je[2].point,ce),3)}function oi(It,wt){if(It===wt)return 0;if(Ee(It.point,It.otherEvent.point,wt.point)!==0||Ee(It.point,It.otherEvent.point,wt.otherEvent.point)!==0)return _t(It.point,wt.point)?It.isBelow(wt.otherEvent.point)?-1:1:It.point[0]===wt.point[0]?It.point[1]<wt.point[1]?-1:1:ae(It,wt)===1?wt.isAbove(It.point)?-1:1:It.isBelow(wt.point)?-1:1;if(It.isSubject!==wt.isSubject)return It.isSubject?-1:1;var ce=It.point,je=wt.point;return ce[0]===je[0]&&ce[1]===je[1]?(ce=It.otherEvent.point)[0]===(je=wt.otherEvent.point)[0]&&ce[1]===je[1]?0:It.contourId>wt.contourId?1:-1:ae(It,wt)===1?1:-1}var ui=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ri(It,wt,ce,je){var ue,Je=It+1,vi=wt[It].point,gi=wt.length;for(Je<gi&&(ue=wt[Je].point);Je<gi&&ue[0]===vi[0]&&ue[1]===vi[1];){if(!ce[Je])return Je;++Je<gi&&(ue=wt[Je].point)}for(Je=It-1;ce[Je]&&Je>je;)Je--;return Je}ui.prototype.isExterior=function(){return this.holeOf==null};var Xe=Qe,ji=Qe;function Qe(It,wt){if(!(this instanceof Qe))return new Qe(It,wt);if(this.data=It||[],this.length=this.data.length,this.compare=wt||Ii,this.length>0)for(var ce=(this.length>>1)-1;ce>=0;ce--)this._down(ce)}function Ii(It,wt){return It<wt?-1:It>wt?1:0}Qe.prototype={push:function(It){this.data.push(It),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var It=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),It}},peek:function(){return this.data[0]},_up:function(It){for(var wt=this.data,ce=this.compare,je=wt[It];It>0;){var ue=It-1>>1,Je=wt[ue];if(ce(je,Je)>=0)break;wt[It]=Je,It=ue}wt[It]=je},_down:function(It){for(var wt=this.data,ce=this.compare,je=this.length>>1,ue=wt[It];It<je;){var Je=1+(It<<1),vi=Je+1,gi=wt[Je];if(vi<this.length&&ce(wt[vi],gi)<0&&(Je=vi,gi=wt[vi]),ce(gi,ue)>=0)break;wt[It]=gi,It=Je}wt[It]=ue}},Xe.default=ji;var Zi=Math.max,fr=Math.min,Pr=0;function qi(It,wt,ce,je,ue,Je){var vi,gi,Ji,Ri,di,zr;for(vi=0,gi=It.length-1;vi<gi;vi++)if(Ri=It[vi+1],di=new dt(Ji=It[vi],!1,void 0,wt),zr=new dt(Ri,!1,di,wt),di.otherEvent=zr,Ji[0]!==Ri[0]||Ji[1]!==Ri[1]){di.contourId=zr.contourId=ce,Je||(di.isExteriorRing=!1,zr.isExteriorRing=!1),ae(di,zr)>0?zr.left=!0:di.left=!0;var ln=Ji[0],Oi=Ji[1];ue[0]=fr(ue[0],ln),ue[1]=fr(ue[1],Oi),ue[2]=Zi(ue[2],ln),ue[3]=Zi(ue[3],Oi),je.push(di),je.push(zr)}}var Br=[];function Fr(It,wt,ce){typeof It[0][0][0]=="number"&&(It=[It]),typeof wt[0][0][0]=="number"&&(wt=[wt]);var je=function(Oi,Cr,cn){var Yr=null;return Oi.length*Cr.length==0&&(cn===U?Yr=Br:cn===q?Yr=Oi:cn!==Z&&cn!==Q||(Yr=Oi.length===0?Cr:Oi)),Yr}(It,wt,ce);if(je)return je===Br?null:je;var ue=[1/0,1/0,-1/0,-1/0],Je=[1/0,1/0,-1/0,-1/0],vi=function(Oi,Cr,cn,Yr,Zn){var Mn,mn,rn,Nr,Qi,Vr,vn=new Xe(null,ae);for(rn=0,Nr=Oi.length;rn<Nr;rn++)for(Qi=0,Vr=(Mn=Oi[rn]).length;Qi<Vr;Qi++)(mn=Qi===0)&&Pr++,qi(Mn[Qi],!0,Pr,vn,cn,mn);for(rn=0,Nr=Cr.length;rn<Nr;rn++)for(Qi=0,Vr=(Mn=Cr[rn]).length;Qi<Vr;Qi++)mn=Qi===0,Zn===q&&(mn=!1),mn&&Pr++,qi(Mn[Qi],!1,Pr,vn,Yr,mn);return vn}(It,wt,ue,Je,ce);if(je=function(Oi,Cr,cn,Yr,Zn){var Mn=null;return(cn[0]>Yr[2]||Yr[0]>cn[2]||cn[1]>Yr[3]||Yr[1]>cn[3])&&(Zn===U?Mn=Br:Zn===q?Mn=Oi:Zn!==Z&&Zn!==Q||(Mn=Oi.concat(Cr))),Mn}(It,wt,ue,Je,ce))return je===Br?null:je;for(var gi=function(Oi){var Cr,cn,Yr=function(rn){var Nr,Qi,Vr,vn,ki=[];for(Qi=0,Vr=rn.length;Qi<Vr;Qi++)((Nr=rn[Qi]).left&&Nr.inResult||!Nr.left&&Nr.otherEvent.inResult)&&ki.push(Nr);for(var Lr=!1;!Lr;)for(Lr=!0,Qi=0,Vr=ki.length;Qi<Vr;Qi++)Qi+1<Vr&&ae(ki[Qi],ki[Qi+1])===1&&(vn=ki[Qi],ki[Qi]=ki[Qi+1],ki[Qi+1]=vn,Lr=!1);for(Qi=0,Vr=ki.length;Qi<Vr;Qi++)(Nr=ki[Qi]).otherPos=Qi;for(Qi=0,Vr=ki.length;Qi<Vr;Qi++)(Nr=ki[Qi]).left||(vn=Nr.otherPos,Nr.otherPos=Nr.otherEvent.otherPos,Nr.otherEvent.otherPos=vn);return ki}(Oi),Zn={},Mn=[],mn=function(){if(!Zn[Cr]){var rn=Mn.length,Nr=function(ki,Lr,Cn){var Qn=new ui;if(ki.prevInResult!=null){var la=ki.prevInResult,Pa=la.outputContourId;if(la.resultTransition>0){var En=Lr[Pa];if(En.holeOf!=null){var wa=En.holeOf;Lr[wa].holeIds.push(Cn),Qn.holeOf=wa,Qn.depth=Lr[Pa].depth}else Lr[Pa].holeIds.push(Cn),Qn.holeOf=Pa,Qn.depth=Lr[Pa].depth+1}else Qn.holeOf=null,Qn.depth=Lr[Pa].depth}else Qn.holeOf=null,Qn.depth=0;return Qn}(Yr[Cr],Mn,rn),Qi=function(ki){Zn[ki]=!0,ki<Yr.length&&Yr[ki]&&(Yr[ki].outputContourId=rn)},Vr=Cr,vn=Cr;for(Nr.points.push(Yr[Cr].point);Qi(Vr),Qi(Vr=Yr[Vr].otherPos),Nr.points.push(Yr[Vr].point),!((Vr=ri(Vr,Yr,Zn,vn))==vn||Vr>=Yr.length)&&Yr[Vr];);Mn.push(Nr)}};for(Cr=0,cn=Yr.length;Cr<cn;Cr++)mn();return Mn}(function(Oi,Cr,cn,Yr,Zn,Mn){for(var mn,rn,Nr,Qi=new _(oi),Vr=[],vn=Math.min(Yr[2],Zn[2]);Oi.length!==0;){var ki=Oi.pop();if(Vr.push(ki),Mn===U&&ki.point[0]>vn||Mn===q&&ki.point[0]>Yr[2])break;if(ki.left){rn=mn=Qi.insert(ki),mn=mn!==(Nr=Qi.minNode())?Qi.prev(mn):null,rn=Qi.next(rn);var Lr=mn?mn.key:null;if(it(ki,Lr,Mn),rn&&xe(ki,rn.key,Oi)===2&&(it(ki,Lr,Mn),it(rn.key,ki,Mn)),mn&&xe(mn.key,ki,Oi)===2){var Cn=mn;it(Lr,(Cn=Cn!==Nr?Qi.prev(Cn):null)?Cn.key:null,Mn),it(ki,Lr,Mn)}}else rn=mn=Qi.find(ki=ki.otherEvent),mn&&rn&&(mn=mn!==Nr?Qi.prev(mn):null,rn=Qi.next(rn),Qi.remove(ki),rn&&mn&&xe(mn.key,rn.key,Oi))}return Vr}(vi,0,0,ue,Je,ce)),Ji=[],Ri=0;Ri<gi.length;Ri++){var di=gi[Ri];if(di.isExterior()){for(var zr=[di.points],ln=0;ln<di.holeIds.length;ln++)zr.push(gi[di.holeIds[ln]].points);Ji.push(zr)}}return Ji}var Bn={UNION:Z,DIFFERENCE:q,INTERSECTION:U,XOR:Q};h.diff=function(It,wt){return Fr(It,wt,q)},h.intersection=function(It,wt){return Fr(It,wt,U)},h.operations=Bn,h.union=function(It,wt){return Fr(It,wt,Z)},h.xor=function(It,wt){return Fr(It,wt,Q)},Object.defineProperty(h,"__esModule",{value:!0})})(l)}(0,h5.exports)),h5.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function JT(d,l,h,m){const _=[],S=m===0?(T,M,L,k,F,V)=>{T.push(new Ce(V,L+(V-M)/(k-M)*(F-L)))}:(T,M,L,k,F,V)=>{T.push(new Ce(M+(V-L)/(F-L)*(k-M),V))};for(const T of d){const M=[];for(const L of T){if(L.length<=2)continue;const k=[];for(let U=0;U<L.length-1;U++){const Z=L[U].x,q=L[U].y,Q=L[U+1].x,it=L[U+1].y,at=m===0?Z:q,dt=m===0?Q:it;at<l?dt>l&&S(k,Z,q,Q,it,l):at>h?dt<h&&S(k,Z,q,Q,it,h):k.push(L[U]),dt<l&&at>=l&&S(k,Z,q,Q,it,l),dt>h&&at<=h&&S(k,Z,q,Q,it,h)}let F=L[L.length-1];const V=m===0?F.x:F.y;V>=l&&V<=h&&k.push(F),k.length&&(F=k[k.length-1],k[0].x===F.x&&k[0].y===F.y||k.push(k[0]),M.push(k))}M.length&&_.push(M)}return _}function _nt(d,l){const h=DD(d),m=DD([l]),_=d5.intersection(h,m);return _==null?[]:f5(_)}function ynt(d,l){let m=DD(d,65536);const _=[];for(;l.valid();l.next()){const[S,T]=l.get(),M=S.x*65536,L=S.y*65536,k=T.x*65536,F=T.y*65536,V=k-M,U=F-L,Z=Math.hypot(V,U);if(Z===0)continue;const q=Math.trunc(U/Z*3),Q=-Math.trunc(V/Z*3);_.push([[[M,L],[k,F],[k+q,F+Q],[M+q,L+Q],[M,L]]])}return _.length>0&&(m=d5.diff(m,_)),f5(m,1/65536)}function DD(d,l=1){return[d.map(h=>h.map(m=>[m.x*l,m.y*l]))]}function f5(d,l=1){return d.map(h=>h.map((m,_)=>{const S=m.map(T=>new Ce(T[0]*l,T[1]*l).round());return _>0&&S.reverse(),S}))}class PD{constructor(l,h){this.layoutVertexArray=new us,this.indexArray=new Pn,this.lineIndexArray=new Al,this.triangleSegments=new Vn,this.lineSegments=new Vn,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.uploaded=!1,h&&(this.elevatedLayoutVertexArray=new Zc)}update(l,h,m,_,S,T,M,L){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M,L)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,rnt.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.lineIndexBuffer=l.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=l.createVertexBuffer(this.elevatedLayoutVertexArray,nnt.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(l,h,m,_,S,T,M){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,h,m,_,S,T,void 0,M)}}class LD{constructor(l){this.zoom=l.zoom,this.pixelRatio=l.pixelRatio,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=l.lut,this.bufferData=new PD(l,!1),this.elevationBufferData=new PD(l,!0),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.projection=l.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=l.sourceLayerIndex,this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.hasPattern=CD("fill",this.layers,this.pixelRatio,h);const S=this.layers[0].layout.get("fill-sort-key"),T=[];for(const{feature:M,id:L,index:k,sourceLayerIndex:F}of l){const V=this.layers[0]._featureFilter.needGeometry,U=ee(M,V);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),U,m))continue;const Z=S?S.evaluate(U,{},m,h.availableImages):void 0,q={id:L,properties:M.properties,type:M.type,sourceLayerIndex:F,index:k,geometry:V?U.geometry:de(M,m,_),patterns:{},sortKey:Z};T.push(q)}S&&T.sort((M,L)=>M.sortKey-L.sortKey);for(const M of T){const{geometry:L,index:k,sourceLayerIndex:F}=M;if(this.hasPattern){const V=ED("fill",this.layers,M,this.zoom,this.pixelRatio,h);this.patternFeatures.push(V)}else this.addFeature(M,L,k,m,{},h.availableImages,h.brightness,h.elevationFeatures);h.featureIndex.insert(l[k].feature,L,k,F,this.index)}}update(l,h,m,_,S,T,M){this.bufferData.update(l,h,m,_,S,T,M,this.worldview),this.elevationBufferData.update(l,h,m,_,S,T,M,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(l,h,m,_,S,T,M,this.worldview)}addFeatures(l,h,m,_,S,T){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,h,m,_,T,l.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(l){this.bufferData.upload(l),this.elevationBufferData.upload(l),this.elevatedStructures&&this.elevatedStructures.upload(l)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(l,h,m,_,S,T=[],M,L){const k=S1(h,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(l,k,_,m,L):this.addGeometry(k,this.bufferData),this.bufferData.populatePaintArrays(l,m,S,T,_,M,this.worldview),this.elevationBufferData.populatePaintArrays(l,m,S,T,_,M,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(l,h,m,_,S){this.elevatedStructures&&(this.elevatedStructures.construct(l),this.elevatedStructures.populatePaintArrays(h,m,_,S,this.worldview))}addElevatedRoadFeature(l,h,m,_,S){const T=new Array,M=Hi.getElevationFeature(l,S);if(!M)return void this.addGeometry(h,this.bufferData);{const k=this.clipPolygonsToTile(h,1);k.length>0&&T.push({polygons:k,elevationFeature:M,elevationTileID:m})}const L={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(l,{},m),featureIndex:_};for(const k of T)if(k.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new tl(k.elevationTileID,this.layers,this.zoom,this.lut));const V=k.elevationFeature.isTunnel();let U=0;l.properties.hasOwnProperty(ai)&&(U=+l.properties[ai]);for(const Z of k.polygons)this.elevatedStructures.addPortalCandidates(k.elevationFeature.id,Z,V,k.elevationFeature,U)}k.elevationFeature.constantHeight==null&&(k.polygons=this.prepareElevatedPolygons(k.polygons,k.elevationFeature,k.elevationTileID));const F=new Dr(m,k.elevationTileID);this.addElevatedGeometry(k.polygons,F,k.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,_,L)}}addElevatedGeometry(l,h,m,_,S,T){const M={elevation:m,elevationSampler:h,bias:_,index:S,featureInfo:T},[L,k]=this.addGeometry(l,this.elevationBufferData,M);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:L,max:k}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,L),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,k))}addGeometry(l,h,m){let _=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,T=null;m&&(T=m.elevationSampler.constantElevation(m.elevation,m.bias),T!=null&&(_=T,S=T));const M=(L,k,F)=>{if(m!=null)if(k.push(L),T!=null)h.elevatedLayoutVertexArray.emplaceBack(T),F.push(T);else{const V=m.elevationSampler.pointElevation(L,m.elevation,m.bias);h.elevatedLayoutVertexArray.emplaceBack(V),F.push(V),_=Math.min(_,V),S=Math.max(S,V)}};for(const L of l){let k=0;for(const mt of L)k+=mt.length;const F=h.triangleSegments.prepareSegment(k,h.layoutVertexArray,h.indexArray),V=F.vertexLength,U=[],Z=[],q=[],Q=[],it=[],at=h.layoutVertexArray.length;for(const mt of L){if(mt.length===0)continue;mt!==L[0]&&Z.push(U.length/2);const _t=h.lineSegments.prepareSegment(mt.length,h.layoutVertexArray,h.lineIndexArray),Dt=_t.vertexLength;m&&it.push(h.layoutVertexArray.length-at),M(mt[0],q,Q),h.layoutVertexArray.emplaceBack(mt[0].x,mt[0].y),h.lineIndexArray.emplaceBack(Dt+mt.length-1,Dt),U.push(mt[0].x),U.push(mt[0].y);for(let At=1;At<mt.length;At++)M(mt[At],q,Q),h.layoutVertexArray.emplaceBack(mt[At].x,mt[At].y),h.lineIndexArray.emplaceBack(Dt+At-1,Dt+At),U.push(mt[At].x),U.push(mt[At].y);_t.vertexLength+=mt.length,_t.primitiveLength+=mt.length}const dt=V_(U,Z);for(let mt=0;mt<dt.length;mt+=3)h.indexArray.emplaceBack(V+dt[mt],V+dt[mt+1],V+dt[mt+2]);if(dt.length>0&&m&&this.elevationMode==="hd-road-base"){const mt=m.elevation.isTunnel(),_t=m.elevation.safeArea,Dt=this.elevatedStructures.addVertices(q,Q);this.elevatedStructures.addTriangles(dt,Dt,mt);const At=it.length;if(At>0){for(let Ot=0;Ot<At-1;Ot++)this.elevatedStructures.addRenderableRing(m.index,it[Ot]+Dt,it[Ot+1]-it[Ot],mt,_t,m.featureInfo);this.elevatedStructures.addRenderableRing(m.index,it[At-1]+Dt,q.length-it[At-1],mt,_t,m.featureInfo)}}F.vertexLength+=k,F.primitiveLength+=dt.length/3}return[_,S]}prepareElevatedPolygons(l,h,m){const _=1/Lt(m),S=[];for(const T of l){const M=ynt(T,new wn(h,_));S.push(...M)}return S}clipPolygonsToTile(l,h){const m=-h,_=-h,S=Ne+h,T=Ne+h;let M=0;const L=[],k=[];for(;M<l.length;M++){const U=l[M],Z=gg(U);(Z.min.x>=m&&Z.max.x<=S&&Z.min.y>=_&&Z.max.y<=T?L:k).push(U)}if(L.length===l.length)return l;const F=[new Ce(m,_),new Ce(S,_),new Ce(S,T),new Ce(m,T),new Ce(m,_)],V=L;for(const U of k)V.push(..._nt(U,F));return V}}let p5,g5,m5,v5;si(LD,"FillBucket",{omit:["layers","patternFeatures"]}),si(PD,"FillBufferData"),si(tl,"ElevatedStructures");class QT{constructor(l,h,m,_){if(this.triangleCount=h.length/3,this.min=new Ce(0,0),this.max=new Ce(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||l.length===0)return;const[S,T]=[l[0].clone(),l[0].clone()];for(let V=1;V<l.length;++V){const U=l[V];S.x=Math.min(S.x,U.x),S.y=Math.min(S.y,U.y),T.x=Math.max(T.x,U.x),T.y=Math.max(T.y,U.y)}if(_){const V=Math.ceil(Math.max(T.x-S.x,T.y-S.y)/_);m=Math.max(m,V)}if(m===0)return;this.min=S,this.max=T;const M=this.max.sub(this.min);M.x=Math.max(M.x,1),M.y=Math.max(M.y,1);const L=Math.max(M.x,M.y)/m;this.cellsX=Math.max(1,Math.ceil(M.x/L)),this.cellsY=Math.max(1,Math.ceil(M.y/L)),this.xScale=1/L,this.yScale=1/L;const k=[];for(let V=0;V<this.triangleCount;V++){const U=l[h[3*V+0]].sub(this.min),Z=l[h[3*V+1]].sub(this.min),q=l[h[3*V+2]].sub(this.min),Q=Bu(Math.floor(Math.min(U.x,Z.x,q.x)),this.xScale,this.cellsX),it=Bu(Math.floor(Math.max(U.x,Z.x,q.x)),this.xScale,this.cellsX),at=Bu(Math.floor(Math.min(U.y,Z.y,q.y)),this.yScale,this.cellsY),dt=Bu(Math.floor(Math.max(U.y,Z.y,q.y)),this.yScale,this.cellsY),mt=new Ce(0,0),_t=new Ce(0,0),Dt=new Ce(0,0),At=new Ce(0,0);for(let Ot=at;Ot<=dt;++Ot){mt.y=_t.y=Ot*L,Dt.y=At.y=(Ot+1)*L;for(let Nt=Q;Nt<=it;++Nt)mt.x=Dt.x=Nt*L,_t.x=At.x=(Nt+1)*L,(sa(U,Z,q,mt,_t,At)||sa(U,Z,q,mt,At,Dt))&&k.push({cellIdx:Ot*this.cellsX+Nt,triIdx:V})}}if(k.length===0)return;k.sort((V,U)=>V.cellIdx-U.cellIdx||V.triIdx-U.triIdx);let F=0;for(;F<k.length;){const V=k[F].cellIdx,U={start:this.payload.length,len:0};for(;F<k.length&&k[F].cellIdx===V;)++U.len,this.payload.push(k[F++].triIdx);this.cells[V]=U}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(l,h){if(this.triangleCount===0||this.cells.length===0||l.x>this.max.x||this.min.x>l.x||l.y>this.max.y||this.min.y>l.y)return;const m=Bu(l.x-this.min.x,this.xScale,this.cellsX),_=Bu(l.y-this.min.y,this.yScale,this.cellsY),S=this.cells[_*this.cellsX+m];if(S){this._lazyInitLookup();for(let T=0;T<S.len;T++){const M=this.payload[S.start+T],L=Math.floor(M/8),k=1<<M%8;if(!(this.lookup[L]&k)&&(this.lookup[L]|=k,h.push(M),h.length===this.triangleCount))return}}}query(l,h,m){if(this.triangleCount===0||this.cells.length===0||l.x>this.max.x||this.min.x>h.x||l.y>this.max.y||this.min.y>h.y)return;this._lazyInitLookup();const _=Bu(l.x-this.min.x,this.xScale,this.cellsX),S=Bu(h.x-this.min.x,this.xScale,this.cellsX),T=Bu(l.y-this.min.y,this.yScale,this.cellsY),M=Bu(h.y-this.min.y,this.yScale,this.cellsY);for(let L=T;L<=M;L++)for(let k=_;k<=S;k++){const F=this.cells[L*this.cellsX+k];if(F)for(let V=0;V<F.len;V++){const U=this.payload[F.start+V],Z=Math.floor(U/8),q=1<<U%8;if(!(this.lookup[Z]&q)&&(this.lookup[Z]|=q,m.push(U),m.length===this.triangleCount))return}}}}function Bu(d,l,h){return Math.max(0,Math.min(h-1,Math.floor(d*l)))}si(QT,"TriangleGridIndex");class _5{constructor(l){this.zoom=l.zoom,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.footprints=[],this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){for(const m of this.footprints)h.push({footprint:m,id:l})}updateAppearances(l,h,m,_){}populate(l,h,m,_){const S=[];for(const{feature:T,id:M,index:L,sourceLayerIndex:k}of l){const F=this.layers[0]._featureFilter.needGeometry,V=ee(T,F);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),V,m))continue;const U={id:M,properties:T.properties,type:T.type,sourceLayerIndex:k,index:L,geometry:F?V.geometry:de(T,m,_),patterns:{}};S.push(U)}for(const T of S){const{geometry:M,index:L,sourceLayerIndex:k}=T;this.addFeature(T,M,L,m,{},h.availableImages,h.brightness),h.featureIndex.insert(l[L].feature,M,L,k,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(l){}update(l,h,m,_,S,T,M){}destroy(){}addFeature(l,h,m,_,S,T=[],M){for(const L of S1(h,2)){const k=[],F=[],V=[],U=new Ce(1/0,1/0),Z=new Ce(-1/0,-1/0);for(const it of L)if(it.length!==0){it!==L[0]&&V.push(F.length/2);for(let at=0;at<it.length;at++)F.push(it[at].x),F.push(it[at].y),k.push(it[at]),U.x=Math.min(U.x,it[at].x),U.y=Math.min(U.y,it[at].y),Z.x=Math.max(Z.x,it[at].x),Z.y=Math.max(Z.y,it[at].y)}const q=V_(F,V),Q=new QT(k,q,8,256);this.footprints.push({vertices:k,indices:q,grid:Q,min:U,max:Z})}}}si(_5,"ClipBucket",{omit:["layers"]});const xnt=gr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),bnt=gr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),wnt=gr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Snt=gr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Tnt=gr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Ant=gr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Int=gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Mnt}=xnt,T1=Number.MAX_SAFE_INTEGER,y5=T1-1;function x5(d,l,h,m){return d.order<l||d.order===T1||!(d.clipMask&h)||function(_,S){return S.length!==0&&S.find(T=>T===_)===void 0}(m,d.clipScope)}function t2(d,l){return d.x-l.x||d.y-l.y}function b5(d,l){return t2(d.min,l.min)===0&&t2(d.max,l.max)===0}function RD(d,l){return!(d.min.x>l.max.x||d.max.x<l.min.x||d.min.y>l.max.y||d.max.y<l.min.y)}function e2(d,l){if(d.length!==l.length)return!1;for(let h=0;h<d.length;h++)if(d[h].sourceId!==l[h].sourceId||!b5(d[h],l[h])||d[h].order!==l[h].order||d[h].clipMask!==l[h].clipMask||!Bc(d[h].clipScope,l[h].clipScope))return!1;return!0}function w5(d,l,h){const m=1/Ne,_=1/(1<<h.canonical.z),S=(l.x*m+h.canonical.x)*_+h.wrap,T=(l.y*m+h.canonical.y)*_;return{min:new Ce((d.x*m+h.canonical.x)*_+h.wrap,(d.y*m+h.canonical.y)*_),max:new Ce(S,T)}}function Cnt(d,l,h){const m=1<<h.canonical.z,_=((l.x-h.wrap)*m-h.canonical.x)*Ne,S=(l.y*m-h.canonical.y)*Ne;return{min:new Ce(((d.x-h.wrap)*m-h.canonical.x)*Ne,(d.y*m-h.canonical.y)*Ne),max:new Ce(_,S)}}function kD(d,l,h,m,_,S,T){const M=d.indices,L=d.vertices,k=[];for(let F=m;F<m+_;F+=3){const V=l[h[F+0]+S],U=l[h[F+1]+S],Z=l[h[F+2]+S],q=Math.min(V.x,U.x,Z.x),Q=Math.max(V.x,U.x,Z.x),it=Math.min(V.y,U.y,Z.y),at=Math.max(V.y,U.y,Z.y);k.length=0,d.grid.query(new Ce(q,it),new Ce(Q,at),k);for(let dt=0;dt<k.length;dt++){const mt=k[dt];if(sa(L[M[3*mt+0]],L[M[3*mt+1]],L[M[3*mt+2]],V,U,Z,T))return!0}}return!1}function S5(d,l,h,m){if(!d||!h)return!1;let _=d.vertices;if(!l.canonical.equals(m.canonical)||l.wrap!==m.wrap){if(h.vertices.length<d.vertices.length)return S5(h,m,d,l);const S=l.canonical,T=m.canonical,M=Math.pow(2,T.z-S.z);_=d.vertices.map(L=>new Ce((L.x+S.x*Ne)*M-T.x*Ne,(L.y+S.y*Ne)*M-T.y*Ne))}return kD(h,_,d.indices,0,d.indices.length,0,0)}function T5(d,l,h,m){const _=Math.pow(2,m.z-h.z);return new Ce((d+h.x*Ne)*_-m.x*Ne,(l+h.y*Ne)*_-m.y*Ne)}function OD(d,l){const h=[];l.grid.queryPoint(d,h);const m=l.indices,_=l.vertices;for(let S=0;S<h.length;S++){const T=h[S];if(qa([_[m[3*T+0]],_[m[3*T+1]],_[m[3*T+2]]],d))return!0}return!1}const zD=[new Ce(0,0),new Ce(Ne,0),new Ce(Ne,Ne),new Ce(0,Ne)];function A5(d,l){const h=[];let m=[];if(!l||d.length<2)return[d];if(d.length===2)return ra(d[0],d[1],zD)?[d]:[];for(let _=0;_<d.length+2;_++){const S=d[_%d.length],T=d[(_+1)%d.length],M=ra(_===0?d[d.length-1]:d[(_-1)%d.length],S,zD),L=ra(S,T,zD),k=M||L;k&&m.push(S),k&&L||m.length>0&&(m.length>1&&h.push(m),m=[])}return m.length>1&&h.push(m),h}const BD=Ae.types,Ent=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Dnt=["fill-extrusion-flood-light-ground-radius"],Pnt=Math.pow(2,13),Lnt=Math.pow(2,15)-1,I5=new Ce(0,1),Pf=2147483648,M5=7,C5=450;function A1(d,l,h,m,_,S,T,M){d.emplaceBack((l<<1)+T,(h<<1)+S,(Math.floor(m*Pnt)<<1)+_,Math.round(M))}function I1(d,l,h){d.emplaceBack(l.x*Ne,l.y*Ne,h?1:0)}function i2(d,l,h,m,_,S){d.emplaceBack(l.x,l.y,(h.x<<1)+m,(h.y<<1)+_,S)}function M1(d,l,h){d.emplaceBack(l.x,l.y,l.z,h[0]*16384,h[1]*16384,h[2]*16384)}class E5{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class D5{constructor(){this.centroidXY=new Ce(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ce(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ce(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ce(this.max.x-this.min.x,this.max.y-this.min.y)}}class P5{constructor(){this.acc=new Ce(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(l,h){l.min.x===Number.MAX_VALUE&&(l.min.x=l.max.x=h.x,l.min.y=l.max.y=h.y)}appendEdge(l,h,m){this.accCount++,this.acc._add(h);let _=!!this.borders;h.x<l.min.x?(l.min.x=h.x,_=!0):h.x>l.max.x&&(l.max.x=h.x,_=!0),h.y<l.min.y?(l.min.y=h.y,_=!0):h.y>l.max.y&&(l.max.y=h.y,_=!0),((h.x===0||h.x===Ne)&&h.x===m.x)!=((h.y===0||h.y===Ne)&&h.y===m.y)&&this.processBorderOverlap(h,m),_&&this.checkBorderIntersection(h,m)}checkBorderIntersection(l,h){h.x<0!=l.x<0&&this.addBorderIntersection(0,zi(h.y,l.y,(0-h.x)/(l.x-h.x))),h.x>Ne!=l.x>Ne&&this.addBorderIntersection(1,zi(h.y,l.y,(Ne-h.x)/(l.x-h.x))),h.y<0!=l.y<0&&this.addBorderIntersection(2,zi(h.x,l.x,(0-h.y)/(l.y-h.y))),h.y>Ne!=l.y>Ne&&this.addBorderIntersection(3,zi(h.x,l.x,(Ne-h.y)/(l.y-h.y)))}addBorderIntersection(l,h){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const m=this.borders[l];h<m[0]&&(m[0]=h),h>m[1]&&(m[1]=h)}processBorderOverlap(l,h){if(l.x===h.x){if(l.y===h.y)return;const m=l.x===0?0:1;this.addBorderIntersection(m,h.y),this.addBorderIntersection(m,l.y)}else{const m=l.y===0?2:3;this.addBorderIntersection(m,h.x),this.addBorderIntersection(m,l.x)}}centroid(){return this.accCount===0?new Ce(0,0):new Ce(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((l,h)=>l+ +(h[0]!==Number.MAX_VALUE),0):0}}function L5(d,l){const h=d.add(l)._unit(),m=ct(d.x*h.x+d.y*h.y,-1,1);var _,S,T;return _=Math.acos(m),Math.min(4,Math.max(-4,Math.tan(_)))/4*Lnt*((S=d).x*(T=l).y-S.y*T.x<0?-1:1)}const Rnt=[d=>d.x<0,d=>d.x>Ne,d=>d.y<0,d=>d.y>Ne];function knt(d,l,h,m){const _=[4];if(m===0)return _;h._mult(m);const S=d.sub(h),T=l.sub(h),M=[d,l,S,T];for(let L=0;L<4;L++)for(const k of M)if(Rnt[L](k)){_.push(L);break}return _}class FD{constructor(l){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new A_,this.indexArray=new Pn,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut},h=>Dnt.includes(h)),this._segments=new Vn,this.hiddenByLandmarkVertexArray=new L_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Vn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(l,h,m,_=!1){const S=l.length;if(S>2){let T=Math.max(0,this._segments.get().length-1);const M=this._segments._prepareSegment(4*S,this.vertexArray.length,2*this._segmentToGroundQuads[T].length);let L;T!==this._segments.get().length-1&&(T++,this._segmentToGroundQuads[T]=[],this._segmentToRegionTriCounts[T]=[0,0,0,0,0]);{const k=l[0],F=l[1];L=L5(k.sub(l[S-1])._perp()._unit(),F.sub(k)._perp()._unit())}for(let k=0;k<S;k++){const F=k===S-1?0:k+1,V=l[k],U=l[F],Z=l[F===S-1?0:F+1],q=U.sub(V)._perp()._unit(),Q=L5(q,Z.sub(U)._perp()._unit()),it=L,at=Q;if(ND(V,U,h)||_&&O5(V,h)&&O5(U,h)){L=Q;continue}const dt=M.vertexLength;i2(this.vertexArray,V,U,1,1,it),i2(this.vertexArray,V,U,1,0,it),i2(this.vertexArray,V,U,0,1,at),i2(this.vertexArray,V,U,0,0,at),M.vertexLength+=4;const mt=knt(V,U,q,m);for(const _t of mt)this._segmentToGroundQuads[T].push({id:dt,region:_t}),this._segmentToRegionTriCounts[T][_t]+=2,M.primitiveLength+=2;L=Q}}}prepareBorderSegments(){if(!this.hasData())return;const l=this._segments.get(),h=l.length;for(let m=0;m<h;m++)this._segmentToGroundQuads[m].sort((_,S)=>_.region-S.region);for(let m=0;m<h;m++){const _=this._segmentToGroundQuads[m],S=l[m],T=this._segmentToRegionTriCounts[m];T.reduce((L,k)=>L+k,0);let M=0;for(let L=0;L<=4;L++){const k=T[L];if(k!==0){let F=this.regionSegments[L];F||(F=this.regionSegments[L]=new Vn);const V={vertexOffset:S.vertexOffset,primitiveOffset:S.primitiveOffset+M,vertexLength:S.vertexLength,primitiveLength:k};F.get().push(V)}M+=k}for(let L=0;L<_.length;L++){const k=_[L].id;this.indexArray.emplaceBack(k,k+1,k+3),this.indexArray.emplaceBack(k,k+3,k+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(l,h,m,_,S,T,M){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,l,h,m,_,S,T,void 0,M)}upload(l){this.hasData()&&(this.vertexBuffer=l.createVertexBuffer(this.vertexArray,bnt.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=l.createVertexBuffer(this.groundRadiusArray,wnt.members)))}uploadPaintProperties(l){this.hasData()&&this.programConfigurations.upload(l)}update(l,h,m,_,S,T,M,L){this.hasData()&&this.programConfigurations.updatePaintArrays(l,h,m,_,S,T,M,L)}updateHiddenByLandmark(l){this.updateHiddenByLandmarkRange(l.groundVertexArrayOffset,l.groundVertexCount,!!(l.flags&Pf))}updateHiddenByLandmarkRange(l,h,m){if(!this.hasData())return;const _=h+l;if(h!==0){for(let S=l;S<_;++S)this.hiddenByLandmarkVertexArray.emplace(S,m?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(l){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=l.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ant.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let l=0;l<=4;l++){const h=this.regionSegments[l];h&&h.destroy()}}}}class r2{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaling=l.overscaling,this.layers=l.layers,this.pixelRatio=l.pixelRatio,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=l.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Pn,this.footprintVertices=new us,this.footprintSegments=[],this.layoutVertexArray=new yf,this.centroidVertexArray=new FT,this.wallVertexArray=new VT,this.indexArray=new Pn,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut},h=>Ent.includes(h)),this.segments=new Vn,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.groundEffect=new FD(l),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.features=[],this.hasPattern=CD("fill-extrusion",this.layers,this.pixelRatio,h),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Lt(m),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:S,id:T,index:M,sourceLayerIndex:L}of l){const k=this.layers[0]._featureFilter.needGeometry,F=ee(S,k);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),F,m))continue;const V={id:T,sourceLayerIndex:L,index:M,geometry:k?F.geometry:de(S,m,_),properties:S.properties,type:S.type,patterns:{}},U=this.layoutVertexArray.length,Z=BD[V.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:S.id,feature:ED("fill-extrusion",this.layers,V,this.zoom,this.pixelRatio,h)});else if(this.wallMode)for(const q of V.geometry)for(const Q of A5(q,Z))this.addFeature(S.id,V,[Q],M,m,{},h.availableImages,_,h.brightness);else this.addFeature(S.id,V,V.geometry,M,m,{},h.availableImages,_,h.brightness);h.featureIndex.insert(S,V.geometry,M,L,this.index,U)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(l,h,m,_,S,T){for(const{featureId:M,feature:L}of this.features){const k=BD[L.type]==="Polygon",{geometry:F}=L;if(this.wallMode)for(const V of F)for(const U of A5(V,k))this.addFeature(M,L,[U],L.index,h,m,_,S,T);else this.addFeature(M,L,F,L.index,h,m,_,S,T)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(l,h,m,_,S,T,M){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M,this.worldview),this.groundEffect.update(l,h,S,m,_,T,M,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Mnt),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.wallVertexBuffer=l.createVertexBuffer(this.wallVertexArray,Tnt.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=l.createVertexBuffer(this.layoutVertexExtArray,Int.members,!0)),this.groundEffect.upload(l)),this.groundEffect.uploadPaintProperties(l),this.programConfigurations.upload(l),this.uploaded=!0}uploadCentroid(l){this.groundEffect.uploadHiddenByLandmark(l),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Snt.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,h,m,_,S,T,M,L,k){const F=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(h,{})/this.tileToMeter,V=[new Ce(0,0),new Ce(Ne,Ne)],U=L.projection,Z=U.name==="globe",q=this.wallMode||BD[h.type]==="Polygon",Q=new P5;Q.centroidDataIndex=this.centroidData.length;const it=new D5;it.buildingId=l,h.properties&&h.properties.hasOwnProperty("building_id")&&(it.buildingId=h.properties.building_id);const at=this.layers[0].paint.get("fill-extrusion-base").evaluate(h,{},S)<=0,dt=this.layers[0].paint.get("fill-extrusion-height").evaluate(h,{},S);let mt;if(it.height=dt,it.vertexArrayOffset=this.layoutVertexArray.length,it.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new M_),this.wallMode){if(Z)return void Mi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(m.length!==1)return;mt=function(Kt){const le=Kt[0].x===Kt[Kt.length-1].x&&Kt[0].y===Kt[Kt.length-1].y;(function(ri){let Xe=0;const ji=ri.length;for(let Qe=0;Qe<ji;Qe++)Xe+=(ri[(Qe+1)%ji].x-ri[Qe].x)*(ri[(Qe+1)%ji].y+ri[Qe].y);return Xe>=0})(Kt)||(Kt=Kt.reverse());const Se={geometry:[],joinNormals:[],indices:[]},ze=[],De=[],me=[];let Ee=Kt.length;for(;Ee>=2&&Kt[Ee-1].equals(Kt[Ee-2]);)Ee--;if(Ee<(le?3:2))return Se;let ae,re,Ie,Re,xe,oi=0;for(;oi<Ee-1&&Kt[oi].equals(Kt[oi+1]);)oi++;le&&(ae=Kt[Ee-2],xe=Kt[oi].sub(ae)._unit()._perp());for(let ri=oi;ri<Ee;ri++){if(Ie=ri===Ee-1?le?Kt[oi+1]:void 0:Kt[ri+1],Ie&&Kt[ri].equals(Ie))continue;xe&&(Re=xe),ae&&(re=ae),ae=Kt[ri],xe=Ie?Ie.sub(ae)._unit()._perp():Re,Re=Re||xe;let Xe=Re.add(xe);Xe.x===0&&Xe.y===0||Xe._unit();const ji=Xe.x*xe.x+Xe.y*xe.y,Qe=ji!==0?1/ji:1/0,Ii=Re.x*xe.y-Re.y*xe.x>0;let Zi="miter";const fr=2;Zi==="miter"&&Qe>fr&&(Zi="bevel"),Zi==="bevel"&&(Qe>100&&(Zi="flipbevel"),Qe<fr&&(Zi="miter"));const Pr=(qi,Br,Fr,Bn)=>{const It=new Ce(qi.x,qi.y),wt=new Ce(qi.x,qi.y);It.x+=Br.x*Bn,It.y+=Br.y*Bn,wt.x-=Br.x*Math.max(Fr,1),wt.y-=Br.y*Math.max(Fr,1),me.push(Br),ze.push(It),De.push(wt)};if(Zi==="miter")Xe._mult(Qe),Pr(ae,Xe,0,0);else if(Zi==="flipbevel")Xe=xe.mult(-1),Pr(ae,Xe,0,0),Pr(ae,Xe.mult(-1),0,0);else{const qi=-Math.sqrt(Qe*Qe-1),Br=Ii?qi:0,Fr=Ii?0:qi;re&&Pr(ae,Re,Br,Fr),Ie&&Pr(ae,xe,Br,Fr)}}Se.geometry=[...ze,...De.reverse(),ze[0]],Se.joinNormals=[...me,...me.reverse(),me[me.length-1]];const ui=Se.geometry.length-1;for(let ri=0;ri<ui/2;ri++)if(ri+1<ui/2){let Xe=ri,ji=ri+1,Qe=ui-1-ri,Ii=ui-2-ri;Xe=Xe===0?ui-1:Xe-1,ji=ji===0?ui-1:ji-1,Qe=Qe===0?ui-1:Qe-1,Ii=Ii===0?ui-1:Ii-1,Se.indices.push(Qe),Se.indices.push(ji),Se.indices.push(Xe),Se.indices.push(Qe),Se.indices.push(Ii),Se.indices.push(ji)}return Se}(m[0]),m=[mt.geometry]}const _t=(Kt,le)=>Kt<(le.length-1)/2||Kt===le.length-1,Dt=this.wallMode?[m]:S1(m,500);for(let Kt=Dt.length-1;Kt>=0;Kt--){const le=Dt[Kt];(le.length===0||(At=le[0]).every(ge=>ge.x<=0)||At.every(ge=>ge.x>=Ne)||At.every(ge=>ge.y<=0)||At.every(ge=>ge.y>=Ne))&&Dt.splice(Kt,1)}var At;let Ot;if(Z)Ot=N5(Dt,V,S);else{Ot=[];for(const Kt of Dt)Ot.push({polygon:Kt,bounds:V})}const Nt=q?this.edgeRadius:0,Ht=Nt>0&&this.zoom<17,se=(Kt,le)=>{if(Kt.length===0)return!1;const ge=Kt[Kt.length-1];return le.x===ge.x&&le.y===ge.y};for(const{polygon:Kt,bounds:le}of Ot){let ge=0,Se=0;for(const Ee of Kt)q&&!Ee[0].equals(Ee[Ee.length-1])&&Ee.push(Ee[0]),Se+=q?Ee.length-1:Ee.length;const ze=this.segments.prepareSegment((q?5:4)*Se,this.layoutVertexArray,this.indexArray);it.footprintSegIdx<0&&(it.footprintSegIdx=this.footprintSegments.length),it.polygonSegIdx<0&&(it.polygonSegIdx=this.polygonSegments.length);const De={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},me=new E5;if(me.vertexOffset=this.footprintVertices.length,me.indexOffset=3*this.footprintIndices.length,me.ringIndices=[],q){const Ee=[],ae=[];ge=ze.vertexLength;for(let Ie=0;Ie<Kt.length;Ie++){const Re=Kt[Ie];Re.length&&Ie!==0&&ae.push(Ee.length/2);const xe=[];let oi,ui;oi=Re[1].sub(Re[0])._perp()._unit(),me.ringIndices.push(Re.length-1);for(let ri=1;ri<Re.length;ri++){const Xe=Re[ri],ji=Re[ri===Re.length-1?1:ri+1],Qe=Xe.clone();if(Nt){ui=ji.sub(Xe)._perp()._unit();const Ii=oi.add(ui)._unit(),Zi=Nt*Math.min(4,1/(oi.x*Ii.x+oi.y*Ii.y));Qe.x+=Zi*Ii.x,Qe.y+=Zi*Ii.y,Qe.x=Math.round(Qe.x),Qe.y=Math.round(Qe.y),oi=ui}if(!at||Nt!==0&&!Ht||se(xe,Qe)||xe.push(Qe),A1(this.layoutVertexArray,Qe.x,Qe.y,0,0,1,1,0),this.wallMode){const Ii=_t(ri,Re);I1(this.wallVertexArray,mt.joinNormals[ri],!Ii)}ze.vertexLength++,this.footprintVertices.emplaceBack(Xe.x,Xe.y),Ee.push(Xe.x,Xe.y),Z&&M1(this.layoutVertexExtArray,U.projectTilePoint(Qe.x,Qe.y,S),U.upVector(S,Qe.x,Qe.y))}at&&(Nt===0||Ht)&&(xe.length!==0&&se(xe,xe[0])&&xe.pop(),this.groundEffect.addData(xe,le,F))}const re=this.wallMode?mt.indices:V_(Ee,ae);for(let Ie=0;Ie<re.length;Ie+=3)this.footprintIndices.emplaceBack(me.vertexOffset+re[Ie+0],me.vertexOffset+re[Ie+1],me.vertexOffset+re[Ie+2]),this.indexArray.emplaceBack(ge+re[Ie],ge+re[Ie+2],ge+re[Ie+1]),ze.primitiveLength++;me.indexCount+=re.length,me.vertexCount+=this.footprintVertices.length-me.vertexOffset}for(let Ee=0;Ee<Kt.length;Ee++){const ae=Kt[Ee];Q.startRing(it,ae[0]);let re=ae.length>4&&z5(ae[ae.length-2],ae[0],ae[1]),Ie=Nt?Ont(ae[ae.length-2],ae[0],ae[1],Nt):0;const Re=[];let xe,oi,ui;oi=ae[1].sub(ae[0])._perp()._unit();let ri=!0;for(let Xe=1,ji=0;Xe<ae.length;Xe++){let Qe=ae[Xe-1],Ii=ae[Xe];const Zi=ae[Xe===ae.length-1?1:Xe+1];if(Q.appendEdge(it,Ii,Qe),ND(Ii,Qe,le)){Nt&&(oi=Zi.sub(Ii)._perp()._unit(),ri=!ri);continue}const fr=Ii.sub(Qe)._perp(),Pr=fr.x/(Math.abs(fr.x)+Math.abs(fr.y)),qi=fr.y>0?1:0,Br=Qe.dist(Ii);if(ji+Br>32768&&(ji=0),Nt){ui=Zi.sub(Ii)._perp()._unit();let wt=k5(Qe,Ii,Zi,R5(oi,ui),Nt);isNaN(wt)&&(wt=0);const ce=Ii.sub(Qe)._unit();Qe=Qe.add(ce.mult(Ie))._round(),Ii=Ii.add(ce.mult(-wt))._round(),Ie=wt,oi=ui,at&&this.zoom>=17&&(se(Re,Qe)||Re.push(Qe),se(Re,Ii)||Re.push(Ii))}const Fr=ze.vertexLength,Bn=ae.length>4&&z5(Qe,Ii,Zi);let It=B5(ji,re,ri);if(A1(this.layoutVertexArray,Qe.x,Qe.y,Pr,qi,0,0,It),A1(this.layoutVertexArray,Qe.x,Qe.y,Pr,qi,0,1,It),this.wallMode){const wt=_t(Xe-1,ae),ce=mt.joinNormals[Xe-1];I1(this.wallVertexArray,ce,wt),I1(this.wallVertexArray,ce,wt)}if(ji+=Br,It=B5(ji,Bn,!ri),re=Bn,A1(this.layoutVertexArray,Ii.x,Ii.y,Pr,qi,0,0,It),A1(this.layoutVertexArray,Ii.x,Ii.y,Pr,qi,0,1,It),this.wallMode){const wt=_t(Xe,ae),ce=mt.joinNormals[Xe];I1(this.wallVertexArray,ce,wt),I1(this.wallVertexArray,ce,wt)}if(ze.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),ze.primitiveLength+=2,Nt){const wt=ge+(Xe===1?ae.length-2:Xe-2),ce=Xe===1?ge:wt+1;if(this.indexArray.emplaceBack(Fr+1,wt,Fr+3),this.indexArray.emplaceBack(wt,ce,Fr+3),ze.primitiveLength+=2,xe===void 0&&(xe=Fr),!ND(Zi,ae[Xe],le)){const je=Xe===ae.length-1?xe:ze.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,je),this.indexArray.emplaceBack(Fr+3,je+1,je),this.indexArray.emplaceBack(Fr+3,ce,je+1),ze.primitiveLength+=3}ri=!ri}if(Z){const wt=this.layoutVertexExtArray,ce=U.projectTilePoint(Qe.x,Qe.y,S),je=U.projectTilePoint(Ii.x,Ii.y,S),ue=U.upVector(S,Qe.x,Qe.y),Je=U.upVector(S,Ii.x,Ii.y);M1(wt,ce,ue),M1(wt,ce,ue),M1(wt,je,Je),M1(wt,je,Je)}}q&&(ge+=ae.length-1),at&&Nt&&this.zoom>=17&&(Re.length!==0&&se(Re,Re[0])&&Re.pop(),this.groundEffect.addData(Re,le,F,Nt>0))}this.footprintSegments.push(me),De.triangleCount=this.indexArray.length-De.triangleArrayOffset,this.polygonSegments.push(De),++it.footprintSegLen,++it.polygonSegLen}if(it.vertexCount=this.layoutVertexArray.length-it.vertexArrayOffset,it.groundVertexCount=this.groundEffect.vertexArray.length-it.groundVertexArrayOffset,it.vertexCount!==0){if(it.centroidXY=Q.borders?I5:this.encodeCentroid(Q,it),this.centroidData.push(it),Q.borders){this.featuresOnBorder.push(Q);const Kt=this.featuresOnBorder.length-1;for(let le=0;le<Q.borders.length;le++)Q.borders[le][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[le].push(Kt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,_,T,M,S,k,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(h,_,T,M,S,k,this.worldview),this.maxHeight=Math.max(this.maxHeight,dt)}}sortBorders(){for(let l=0;l<this.borderFeatureIndices.length;l++)this.borderFeatureIndices[l].sort((h,m)=>this.featuresOnBorder[h].borders[l][0]-this.featuresOnBorder[m].borders[l][0])}splitToSubtiles(){const l=[];for(let M=0;M<this.centroidData.length;M++){const L=this.centroidData[M],k=+(L.min.y+L.max.y>Ne),F=2*k+(+(L.min.x+L.max.x>Ne)^k);for(let V=0;V<L.polygonSegLen;V++){const U=L.polygonSegIdx+V;l.push({centroidIdx:M,subtile:F,polygonSegmentIdx:U,triangleSegmentIdx:this.polygonSegments[U].triangleSegIdx})}}const h=new Pn;l.sort((M,L)=>M.triangleSegmentIdx===L.triangleSegmentIdx?M.subtile-L.subtile:M.triangleSegmentIdx-L.triangleSegmentIdx);let m=0,_=0,S=0;for(const M of l){if(M.triangleSegmentIdx!==m)break;S++}const T=l.length;for(;_!==l.length;){m=l[_].triangleSegmentIdx;let M=0,L=_,k=_;for(let F=L;F<S&&l[F].subtile===M;F++)k++;for(;L!==S;){const F=l[L];M=F.subtile;const V=this.centroidData[F.centroidIdx].min.clone(),U=this.centroidData[F.centroidIdx].max.clone(),Z={vertexOffset:this.segments.segments[m].vertexOffset,primitiveOffset:h.length,vertexLength:this.segments.segments[m].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let q=L;q<k;q++){const Q=l[q],it=this.polygonSegments[Q.polygonSegmentIdx],at=this.centroidData[Q.centroidIdx].min,dt=this.centroidData[Q.centroidIdx].max,mt=this.indexArray.uint16;for(let _t=it.triangleArrayOffset;_t<it.triangleArrayOffset+it.triangleCount;_t++)h.emplaceBack(mt[3*_t],mt[3*_t+1],mt[3*_t+2]);Z.primitiveLength+=it.triangleCount,V.x=Math.min(V.x,at.x),V.y=Math.min(V.y,at.y),U.x=Math.max(U.x,dt.x),U.y=Math.max(U.y,dt.y)}Z.primitiveLength>0&&this.triangleSubSegments.push({segment:Z,min:V,max:U}),L=k;for(let q=L;q<S&&l[q].subtile===l[L].subtile;q++)k++}_=S;for(let F=_;F<T&&l[F].triangleSegmentIdx===l[_].triangleSegmentIdx;F++)S++}h._trim(),this.indexArray=h}getVisibleSegments(l,h,m){const _=new Vn;if(this.wallMode){for(const Q of this.triangleSubSegments)_.segments.push(Q.segment);return _}let S=0,T=0;const M=1<<l.canonical.z;if(h){const Q=h.getMinMaxForTile(l);Q&&(S=Q.min,T=Q.max)}T+=this.maxHeight;const L=l.toUnwrapped();let k;const F=[L.canonical.x/M+L.wrap,L.canonical.y/M],V=[(L.canonical.x+1)/M+L.wrap,(L.canonical.y+1)/M],U=(Q,it,at)=>[Q[0]*(1-at[0])+it[0]*at[0],Q[1]*(1-at[1])+it[1]*at[1]],Z=[],q=[];for(const Q of this.triangleSubSegments){Z[0]=Q.min.x/Ne,Z[1]=Q.min.y/Ne,q[0]=Q.max.x/Ne,q[1]=Q.max.y/Ne;const it=U(F,V,Z),at=U(F,V,q);if(new cr([it[0],it[1],S],[at[0],at[1],T]).intersectsPrecise(m)===0){k&&(_.segments.push(k),k=void 0);continue}const dt=Q.segment;k&&k.vertexOffset!==dt.vertexOffset&&(_.segments.push(k),k=void 0),k?(k.vertexLength+=dt.vertexLength,k.primitiveLength+=dt.primitiveLength):k={vertexOffset:dt.vertexOffset,primitiveLength:dt.primitiveLength,vertexLength:dt.vertexLength,primitiveOffset:dt.primitiveOffset,sortKey:void 0,vaos:{}}}return k&&_.segments.push(k),_}encodeCentroid(l,h){const m=l.centroid(),_=h.span(),S=Math.min(7,Math.round(_.x*this.tileToMeter/10)),T=Math.min(7,Math.round(_.y*this.tileToMeter/10));return new Ce(ct(m.x,1,Ne-1)<<3|S,ct(m.y,1,Ne-1)<<3|T)}encodeBorderCentroid(l){if(!l.borders)return new Ce(0,0);const h=l.borders,m=Number.MAX_VALUE;if(h[0][0]!==m||h[1][0]!==m){const _=h[0][0]!==m?0:1;return new Ce(6|(h[0][0]!==m?0:65528),(h[_][0]+h[_][1])/2<<3|6)}{const _=h[2][0]!==m?2:3;return new Ce((h[_][0]+h[_][1])/2<<3|6,6|(h[2][0]!==m?0:65528))}}showCentroid(l){const h=this.centroidData[l.centroidDataIndex];h.flags&=2147483647,h.centroidXY.x=0,h.centroidXY.y=0,this.writeCentroidToBuffer(h)}writeCentroidToBuffer(l){this.groundEffect.updateHiddenByLandmark(l);const h=l.vertexArrayOffset,m=l.vertexCount+l.vertexArrayOffset,_=l.flags&Pf?I5:l.centroidXY,S=this.centroidVertexArray.geta_centroid_pos0(h);if(this.centroidVertexArray.geta_centroid_pos1(h)!==_.y||S!==_.x){for(let T=h;T<m;++T)this.centroidVertexArray.emplace(T,_.x,_.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const l of this.centroidData)this.writeCentroidToBuffer(l)}updateReplacement(l,h,m){if(h.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=h.updateTime;const _=h.getReplacementRegionsForTile(l.toUnwrapped());if(e2(this.activeReplacements,_))return;if(this.activeReplacements=_,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const T of this.centroidData)T.flags&=2147483647;const S=[];for(const T of this.activeReplacements){if(T.order<m)continue;const M=Math.max(1,Math.pow(2,T.footprintTileId.canonical.z-l.canonical.z));if(T.footprint.buildingId){const L=T.footprint.buildingId;for(const k of this.centroidData)k.buildingId===L&&(k.flags|=Pf)}else for(const L of this.centroidData)if(!(L.flags&Pf||T.min.x>L.max.x||L.min.x>T.max.x||T.min.y>L.max.y||L.min.y>T.max.y))for(let k=0;k<L.footprintSegLen;k++){const F=this.footprintSegments[L.footprintSegIdx+k];if(S.length=0,znt(this.footprintVertices,F.vertexOffset,F.vertexCount,T.footprintTileId.canonical,l.canonical,S),kD(T.footprint,S,this.footprintIndices.uint16,F.indexOffset,F.indexCount,-F.vertexOffset,-M)){L.flags|=Pf;break}}}for(const T of this.centroidData)this.writeCentroidToBuffer(T);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(l,h,m){let _=!1;for(let S=0;S<m.footprintSegLen;S++){const T=this.footprintSegments[m.footprintSegIdx+S];let M=0;for(const L of T.ringIndices){for(let k=M,F=L+M-1;k<L+M;F=k++){const V=this.footprintVertices.int16[2*(k+T.vertexOffset)+0],U=this.footprintVertices.int16[2*(k+T.vertexOffset)+1],Z=this.footprintVertices.int16[2*(F+T.vertexOffset)+1];U>h!=Z>h&&l<(this.footprintVertices.int16[2*(F+T.vertexOffset)+0]-V)*(h-U)/(Z-U)+V&&(_=!_)}M=L}}return _}getHeightAtTileCoord(l,h){let m=Number.NEGATIVE_INFINITY,_=!0;const S=4*(l+Ne)*Ne+(h+Ne);if(this.partLookup.hasOwnProperty(S)){const T=this.partLookup[S];return T?{height:T.height,hidden:!!(T.flags&Pf)}:void 0}for(const T of this.centroidData)l>T.max.x||T.min.x>l||h>T.max.y||T.min.y>h||T.height<=m||this.footprintContainsPoint(l,h,T)&&(m=T.height,this.partLookup[S]=T,_=!!(T.flags&Pf));if(m!==Number.NEGATIVE_INFINITY)return{height:m,hidden:_};this.partLookup[S]=void 0}}function R5(d,l){const h=d.add(l)._unit();return d.x*h.x+d.y*h.y}function Ont(d,l,h,m){const _=l.sub(d)._perp()._unit(),S=h.sub(l)._perp()._unit();return k5(d,l,h,R5(_,S),m)}function k5(d,l,h,m,_){const S=Math.sqrt(1-m*m);return Math.min(d.dist(l)/3,l.dist(h)/3,_*S/m)}function ND(d,l,h){return d.x<h[0].x&&l.x<h[0].x||d.x>h[1].x&&l.x>h[1].x||d.y<h[0].y&&l.y<h[0].y||d.y>h[1].y&&l.y>h[1].y}function O5(d,l){return d.x<l[0].x||d.x>l[1].x||d.y<l[0].y||d.y>l[1].y}function z5(d,l,h){if(d.x<0||d.x>=Ne||l.x<0||l.x>=Ne||h.x<0||h.x>=Ne)return!1;const m=h.sub(l),_=m.perp(),S=d.sub(l);return(m.x*S.x+m.y*S.y)/Math.sqrt((m.x*m.x+m.y*m.y)*(S.x*S.x+S.y*S.y))>-.866&&_.x*S.x+_.y*S.y<0}function B5(d,l,h){const m=l?2|d:-3&d;return h?1|m:-2&m}function F5(){const d=Math.PI/32,l=Math.tan(d),h=G;return h*Math.sqrt(1+2*l*l)-h}function N5(d,l,h){const m=1<<h.z,_=xt(h.x/m),S=xt((h.x+1)/m),T=vt(h.y/m),M=vt((h.y+1)/m);return function(L,k,F,V,U=0,Z){const q=[];if(!L.length||!F||!V)return q;const Q=(At,Ot)=>{for(const Nt of At)q.push({polygon:Nt,bounds:Ot})},it=Math.ceil(Math.log2(F)),at=Math.ceil(Math.log2(V)),dt=it-at,mt=[];for(let At=0;At<Math.abs(dt);At++)mt.push(dt>0?0:1);for(let At=0;At<Math.min(it,at);At++)mt.push(0),mt.push(1);let _t=L;if(_t=JT(_t,k[0].y-U,k[1].y+U,1),_t=JT(_t,k[0].x-U,k[1].x+U,0),!_t.length)return q;const Dt=[];for(mt.length?Dt.push({polygons:_t,bounds:k,depth:0}):Q(_t,k);Dt.length;){const At=Dt.pop(),Ot=At.depth,Nt=mt[Ot],Ht=At.bounds[0],se=At.bounds[1],Kt=Nt===0?Ht.x:Ht.y,le=Nt===0?se.x:se.y,ge=Z?Z(Nt,Kt,le):.5*(Kt+le),Se=JT(At.polygons,Kt-U,ge+U,Nt),ze=JT(At.polygons,ge-U,le+U,Nt);if(Se.length){const De=[Ht,new Ce(Nt===0?ge:se.x,Nt===1?ge:se.y)];mt.length>Ot+1?Dt.push({polygons:Se,bounds:De,depth:Ot+1}):Q(Se,De)}if(ze.length){const De=[new Ce(Nt===0?ge:Ht.x,Nt===1?ge:Ht.y),se];mt.length>Ot+1?Dt.push({polygons:ze,bounds:De,depth:Ot+1}):Q(ze,De)}}return q}(d,l,Math.ceil((S-_)/11.25),Math.ceil((T-M)/11.25),1,(L,k,F)=>{if(L===0)return .5*(k+F);{const V=vt((h.y+k/Ne)/m);return(st(.5*(vt((h.y+F/Ne)/m)+V))*m-h.y)*Ne}})}function znt(d,l,h,m,_,S){const T=Math.pow(2,m.z-_.z);for(let M=0;M<h;M++){let L=d.int16[2*(M+l)+0],k=d.int16[2*(M+l)+1];L=(L+_.x*Ne)*T-m.x*Ne,k=(k+_.y*Ne)*T-m.y*Ne,S.push(new Ce(L,k))}}let V5,U5;si(r2,"FillExtrusionBucket",{omit:["layers","features"]}),si(D5,"PartData"),si(E5,"FootprintSegment"),si(P5,"BorderCentroidData"),si(FD,"GroundEffect");class Ng extends Ce{constructor(l,h,m){super(l,h),this.z=m}}class G5 extends Ng{constructor(l,h,m,_){super(l,h,m),this.w=_}}function H5(d,l,h,m){const _=h==="x"?"y":"x",S=(m-d[h])/(l[h]-d[h]);d[_]=Math.round(d[_]+(l[_]-d[_])*S),d[h]=m,d.hasOwnProperty("z")&&(d.z=zi(d.z,l.z,S)),d.hasOwnProperty("w")&&(d.w=zi(d.w,l.w,S))}function j5(d,l,h,m){const _=h,S=m;for(const T of["x","y"]){let M=d,L=l;M[T]>=L[T]&&(M=l,L=d),M[T]<_&&L[T]>_&&H5(M,L,T,_),M[T]<S&&L[T]>S&&H5(L,M,T,S)}}function n2(d,l,h,m,_,S){const T=[];for(let M=0;M<d.length;M++){const L=d[M];let k;const F=T.length;let V=0;for(let U=0;U<L.length-1;U++){let Z=L[U],q=L[U+1],Q=0;const it=V;let at,dt;S&&(Q=Math.hypot(q.x-Z.x,q.y-Z.y),V+=Q,at=Z,dt=q),Z.x<l&&q.x<l||(Z.x<l?Z=new Ce(l,Z.y+(l-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round():q.x<l&&(q=new Ce(l,Z.y+(l-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round()),Z.y<h&&q.y<h||(Z.y<h?Z=new Ce(Z.x+(h-Z.y)/(q.y-Z.y)*(q.x-Z.x),h)._round():q.y<h&&(q=new Ce(Z.x+(h-Z.y)/(q.y-Z.y)*(q.x-Z.x),h)._round()),Z.x>=m&&q.x>=m||(Z.x>=m?Z=new Ce(m,Z.y+(m-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round():q.x>=m&&(q=new Ce(m,Z.y+(m-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round()),Z.y>=_&&q.y>=_||(Z.y>=_?Z=new Ce(Z.x+(_-Z.y)/(q.y-Z.y)*(q.x-Z.x),_)._round():q.y>=_&&(q=new Ce(Z.x+(_-Z.y)/(q.y-Z.y)*(q.x-Z.x),_)._round()),k&&Z.equals(k[k.length-1])||(k=[Z],T.push(k),S&&S.push({progress:{min:it+W5(at,dt,Z)*Q,max:1},parentIndex:M,prevPoint:at,nextPoint:dt})),k.push(q),S&&(S[S.length-1].progress.max=it+W5(at,dt,q)*Q,S[S.length-1].nextPoint=dt)))))}if(S&&V>0)for(let U=F;U<T.length;U++)S[U].progress.min/=V,S[U].progress.max/=V}return T}function Bnt(d,l,h,m,_){if(d.length<2)return void m.push(d);const S=[];for(;l.valid();){const[k,F]=l.get();for(let V=0;V<d.length-1;V++){const U=d[V],Z=d[V+1],q=Xs(U,Z,k,F);if(q){const[Q]=q,it=new Ce(zi(U.x,Z.x,Q),zi(U.y,Z.y,Q));S.push({t:V+Q,distance:0,point:it})}}l.next()}if(S.length===0)return void m.push(d);S.sort((k,F)=>k.t-F.t);let T=0,M=0,L=[];for(m.push(L);T!==d.length;){if(M===S.length){for(;T!==d.length;)L.length!==0&&L[L.length-1].equals(d[T])||L.push(d[T]),T++;break}S[M].t<=T?(L.length!==0&&L[L.length-1].equals(S[M].point)||L.push(S[M].point),Math.trunc(S[M].t),M++):(L.length!==0&&L[L.length-1].equals(d[T])||L.push(d[T]),T++)}}function W5(d,l,h){return d.x!==l.x?(h.x-d.x)/(l.x-d.x):d.y!==l.y?(h.y-d.y)/(l.y-d.y):0}function C1(d,l){return d.x*l.x+d.y*l.y}function $5(d,l){if(d.length===1){let h=0;const m=l[h++];let _;for(;!_||m.equals(_);)if(_=l[h++],!_)return 1/0;for(;h<l.length;h++){const S=l[h],T=d[0],M=_.sub(m),L=S.sub(m),k=T.sub(m),F=C1(M,M),V=C1(M,L),U=C1(L,L),Z=C1(k,M),q=C1(k,L),Q=F*U-V*V,it=(U*Z-V*q)/Q,at=(F*q-V*Z)/Q,dt=m.z*(1-it-at)+_.z*it+S.z*at;if(isFinite(dt))return dt}return 1/0}{let h=1/0;for(const m of l)h=Math.min(h,m.z);return h}}function Z5(d,l,h){let m=1/0;Kn(h,l)&&(m=$5(h,l[0]));for(let _=0;_<l.length;_++){const S=l[_],T=d[_];for(let M=0;M<S.length-1;M++){const L=S[M],k=[L,S[M+1],T[M+1],T[M],L];ia(h,k)&&(m=Math.min(m,$5(h,k)))}}return m!==1/0&&m}function q5(d,l,h,m,_,S,T,M,L,k,F){return d.projection.name==="globe"?function(V,U,Z,q,Q,it,at,dt,mt,_t,Dt){const At=[],Ot=[],Nt=V.projection.upVectorScale(Dt,V.center.lat,V.worldSize).metersToTile,Ht=[0,0,0,1],se=[0,0,0,1],Kt=(ge,Se,ze,De)=>{ge[0]=Se,ge[1]=ze,ge[2]=De,ge[3]=1},le=F5();Z>0&&(Z+=le),q+=le;for(const ge of U){const Se=[],ze=[];for(const De of ge){const me=De.x+Q.x,Ee=De.y+Q.y,ae=V.projection.projectTilePoint(me,Ee,Dt),re=V.projection.upVector(Dt,De.x,De.y);let Ie=Z,Re=q;if(at){const xe=X5(me,Ee,Z,q,at,dt,mt,_t);Ie+=xe.base,Re+=xe.top}Z!==0?Kt(Ht,ae.x+re[0]*Nt*Ie,ae.y+re[1]*Nt*Ie,ae.z+re[2]*Nt*Ie):Kt(Ht,ae.x,ae.y,ae.z),Kt(se,ae.x+re[0]*Nt*Re,ae.y+re[1]*Nt*Re,ae.z+re[2]*Nt*Re),zt(Ht,Ht,it),zt(se,se,it),Se.push(new Ng(Ht[0],Ht[1],Ht[2])),ze.push(new Ng(se[0],se[1],se[2]))}At.push(Se),Ot.push(ze)}return[At,Ot]}(d,l,h,m,_,S,T,M,L,k,F):T?function(V,U,Z,q,Q,it,at,dt,mt){const _t=[],Dt=[],At=[0,0,0,1];for(const Ot of V){const Nt=[],Ht=[];for(const se of Ot){const Kt=se.x+q.x,le=se.y+q.y,ge=X5(Kt,le,U,Z,it,at,dt,mt);At[0]=Kt,At[1]=le,At[2]=ge.base,At[3]=1,Li(At,At,Q),At[3]=Math.max(At[3],1e-5);const Se=new Ng(At[0]/At[3],At[1]/At[3],At[2]/At[3]);At[0]=Kt,At[1]=le,At[2]=ge.top,At[3]=1,Li(At,At,Q),At[3]=Math.max(At[3],1e-5);const ze=new Ng(At[0]/At[3],At[1]/At[3],At[2]/At[3]);Nt.push(Se),Ht.push(ze)}_t.push(Nt),Dt.push(Ht)}return[_t,Dt]}(l,h,m,_,S,T,M,L,k):function(V,U,Z,q,Q){const it=[],at=[],dt=Q[8]*U,mt=Q[9]*U,_t=Q[10]*U,Dt=Q[11]*U,At=Q[8]*Z,Ot=Q[9]*Z,Nt=Q[10]*Z,Ht=Q[11]*Z;for(const se of V){const Kt=[],le=[];for(const ge of se){const Se=ge.x+q.x,ze=ge.y+q.y,De=Q[0]*Se+Q[4]*ze+Q[12],me=Q[1]*Se+Q[5]*ze+Q[13],Ee=Q[2]*Se+Q[6]*ze+Q[14],ae=Q[3]*Se+Q[7]*ze+Q[15],re=De+dt,Ie=me+mt,Re=Ee+_t,xe=Math.max(ae+Dt,1e-5),oi=De+At,ui=me+Ot,ri=Ee+Nt,Xe=Math.max(ae+Ht,1e-5);Kt.push(new Ng(re/xe,Ie/xe,Re/xe)),le.push(new Ng(oi/Xe,ui/Xe,ri/Xe))}it.push(Kt),at.push(le)}return[it,at]}(l,h,m,_,S)}function X5(d,l,h,m,_,S,T,M){const L=T*_.getElevationAt(d,l,!0,!0),k=S[0]!==0,F=k?S[1]===0?T*(S[0]/M5-C5):T*function(V,U,Z){const q=Math.floor(U[0]/8),Q=Math.floor(U[1]/8),it=10*(U[0]-8*q),at=10*(U[1]-8*Q),dt=V.getElevationAt(q,Q,!0,!0),mt=V.getMeterToDEM(Z),_t=Math.floor(.5*(it*mt-1)),Dt=Math.floor(.5*(at*mt-1)),At=V.tileCoordToPixel(q,Q),Ot=2*_t+1,Nt=2*Dt+1,Ht=function(ze,De,me,Ee,ae){return[ze.getElevationAtPixel(De,me,!0),ze.getElevationAtPixel(De+ae,me,!0),ze.getElevationAtPixel(De,me+ae,!0),ze.getElevationAtPixel(De+Ee,me+ae,!0)]}(V,At.x-_t,At.y-Dt,Ot,Nt),se=Math.abs(Ht[0]-Ht[1]),Kt=Math.abs(Ht[2]-Ht[3]),le=Math.abs(Ht[0]-Ht[2])+Math.abs(Ht[1]-Ht[3]),ge=Math.min(.25,.5*mt*(se+Kt)/Ot),Se=Math.min(.25,.5*mt*le/Nt);return dt+Math.max(ge*it,Se*at)}(_,S,M):L;return{base:L+(h===0?-1:h),top:k?Math.max(F+m,L+h+2):L+m}}class Fnt{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Nnt{constructor(){this.tasks={},this.taskQueue=[],ie(["process"],this),this.invoker=new Fnt(this.process),this.nextId=0}add(l,h){const m=this.nextId++,_=function({type:S,isSymbolTile:T,zoom:M}){return M=M||0,S==="message"?0:S!=="maybePrepare"||T?S!=="parseTile"||T?S==="parseTile"&&T?300-M:S==="maybePrepare"&&T?400-M:500:200-M:100-M}(h);if(_===0){try{l()}finally{}return null}return this.tasks[m]={fn:l,metadata:h,priority:_,id:m},this.taskQueue.push(m),this.invoker.trigger(),{cancel:()=>{delete this.tasks[m]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(m=>!!this.tasks[m]),!this.taskQueue.length)return;const l=this.pick();if(l===null)return;const h=this.tasks[l];if(delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),!h)return;h.fn()}finally{}}pick(){let l=null,h=1/0;for(let _=0;_<this.taskQueue.length;_++){const S=this.tasks[this.taskQueue[_]];S.priority<h&&(h=S.priority,l=_)}if(l===null)return null;const m=this.taskQueue[l];return this.taskQueue.splice(l,1),m}remove(){this.invoker.remove()}}class Y5{constructor(l,h,m){this.target=l,this.parent=h,this.mapId=m,this.callbacks={},this.cancelCallbacks={},ie(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Nnt}send(l,h,m,_,S=!1,T){const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);m&&(m.metadata=T,this.callbacks[M]=m);const L=new Set;return this.target.postMessage({id:M,type:l,hasCallback:!!m,targetMapId:_,mustQueue:S,sourceMapId:this.mapId,data:Du(h,L)},L),{cancel:()=>{m&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}receive(l){const h=l.data;if(!h)return;const m=h.id;if(m&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){const _=this.cancelCallbacks[m];delete this.cancelCallbacks[m],_&&_.cancel()}else if(h.mustQueue||Xn(self)){const _=this.callbacks[m],S=this.scheduler.add(()=>this.processTask(m,h),_&&_.metadata||{type:"message"});S&&(this.cancelCallbacks[m]=S)}else this.processTask(m,h)}processTask(l,h){if(delete this.cancelCallbacks[l],h.type==="<response>"){const m=this.callbacks[l];delete this.callbacks[l],m&&(h.error?m(Pu(h.error)):m(null,Pu(h.data)))}else{const m=new Set,_=h.hasCallback?(T,M)=>{this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:T?Du(T):null,data:Du(M,m)},m)}:()=>{},S=Pu(h.data);if(this.parent[h.type])this.parent[h.type](h.sourceMapId,S,_);else if(this.parent.getWorkerSource){const T=h.type.split("."),{source:M,scope:L}=S;this.parent.getWorkerSource(h.sourceMapId,T[0],M,L)[T[1]](S,_)}else _(new Error(`Could not find function ${h.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var E1={workerUrl:"",workerClass:null,workerParams:void 0};const VD="mapboxgl_preloaded_worker_pool";class Vg{constructor(){this.active={}}acquire(l,h=Vg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<h;)this.workers.push(E1.workerClass!=null?new E1.workerClass:new self.Worker(E1.workerUrl,E1.workerParams));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.workers&&this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[VD]}numActive(){return Object.keys(this.active).length}}Vg.workerCount=2;class G_{constructor(l,h,m="Worker",_=Vg.workerCount){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=ne();const S=this.workerPool.acquire(this.id,_);for(let T=0;T<S.length;T++){const M=new G_.Actor(S[T],h,this.id);M.name=`${m} ${T}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,h,m){Bt(this.actors,(_,S)=>{_.send(l,h,S)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}let D1,UD;function a2(){return D1||(D1=new Vg),D1}G_.Actor=Y5;class Vnt{constructor(l){this.module=l}createIntArray(l){const h=new Int32Array(l),m=this.module.malloc(h.length*h.BYTES_PER_ELEMENT);return this.module.heap32.set(h,m/h.BYTES_PER_ELEMENT),m}createFloatArray(l){const h=new Float32Array(l),m=this.module.malloc(h.length*h.BYTES_PER_ELEMENT);return this.module.heapF32.set(h,m/h.BYTES_PER_ELEMENT),m}createStringBuffer(l){const h=this.module.malloc(l.length+1);for(let m=0;m<l.length;++m)this.module.heapU8[h+m]=l.charCodeAt(m);return this.module.heapU8[h+l.length]=0,h}readStringBuffer(l){let h="";for(;this.module.heapU8[l]!==0;)h+=String.fromCharCode(this.module.heapU8[l]),++l;return h}setStyle(l){const h=l.entranceColorRgb,m=l.facadeGlazingColorRgb,_=l.roofColorRgb,S=l.wallColorRgb,T=l.normalScale;this.module.setStyle(h[0],h[1],h[2],m[0],m[1],m[2],_[0],_[1],_[2],S[0],S[1],S[2],T[0],T[1],T[2],l.tileToMeters)}setAOOptions(l,h){this.module.setAOOptions(l?1:0,h)}setMetricOptions(l,h){this.module.setMetricOptions(l?1:0,h)}setStructuralOptions(l){this.module.setStructuralOptions(l?1:0)}setFacadeOptions(l,h){this.module.setFacadeOptions(l,h?1:0)}setFauxFacadeOptions(l,h,m){this.module.setFauxFacadeOptions(l?1:0,h?1:0,m)}setFacadeClassifierOptions(l){this.module.setFacadeClassifierOptions(l)}generateMesh(l,h){for(const M of l){const L=this.createStringBuffer(M.roofType),k=[0],F=[];for(const Z of M.coordinates)if(Array.isArray(Z)){for(const q of Z)F.push(q.x),F.push(q.y);k.push(F.length)}const V=this.createIntArray(k),U=this.createFloatArray(F);this.module.addFeature(M.id,M.sourceId,M.minHeight,M.height,L,M.roofType.length,U,V,k.length-1),this.module.free(L),this.module.free(V),this.module.free(U)}for(const M of h){let L;L=M.entrances?JSON.parse(M.entrances):[];const k=this.createFloatArray(L),F=[];for(const U of M.coordinates)F.push(U.x),F.push(U.y);const V=this.createFloatArray(F);this.module.addFacade(M.sourceId,M.crossPerc,M.distanceToRoad,k,L.length,V,F.length),this.module.free(k),this.module.free(V)}if(!this.module.generateMesh()){const M=this.module.getLastError();return this.readStringBuffer(M)}const m=this.module.getMeshCount(),_=new Array(m);for(let M=0;M<m;M++){const L=this.module.getPositionsPtr(M),k=this.module.getPositionsLength(M),F=new Float32Array(this.module.heapF32.buffer,L,k),V=this.module.getNormalsPtr(M),U=this.module.getNormalsLength(M),Z=new Float32Array(this.module.heapF32.buffer,V,U),q=this.module.getColorsPtr(M),Q=this.module.getColorsLength(M),it=new Uint8Array(this.module.heapU8.buffer,q,Q),at=this.module.getAOPtr(M),dt=this.module.getAOLength(M),mt=new Float32Array(this.module.heapF32.buffer,at,dt),_t=this.module.getUVPtr(M),Dt=this.module.getUVLength(M),At=new Float32Array(this.module.heapF32.buffer,_t,Dt),Ot=this.module.getFauxFacadePtr(M),Nt=this.module.getFauxFacadeLength(M),Ht=new Uint8Array(this.module.heapU8.buffer,Ot,Nt),se=this.module.getIndicesPtr(M),Kt=this.module.getIndicesLength(M),le=new Int32Array(this.module.heap32.buffer,se,Kt),ge=this.module.getBuildingPart(M),Se=this.readStringBuffer(ge);_[M]={positions:F,normals:Z,colors:it,ao:mt,uv:At,isFauxFacade:Ht,indices:le,buildingPart:Se}}const S=this.module.getRingCount(),T=[];for(let M=0;M<S;M++){const L=this.module.getRingPtr(M),k=this.module.getRingLength(M),F=new Float32Array(this.module.heapF32.buffer,L,k);T.push(F)}return{meshes:_,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:T}}}let P1,GD,Kc,H_,HD,j_=null,W_=null,K5=null,o2=null;function J5(){return Xn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:GD||An.DRACO_URL}function Q5(){if(Xn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(H_)return H_;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return H_=WebAssembly.validate(d)?An.MESHOPT_SIMD_URL:An.MESHOPT_URL,H_}function Unt(){return o2}const s2={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Gnt={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},L1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tV(d,l,h){const m=h.json.bufferViews.length,_=h.buffers.length;l.bufferView=m,h.json.bufferViews[m]={buffer:_,byteLength:d.byteLength},h.buffers[_]=d}const jD="KHR_draco_mesh_compression";function Hnt(d,l){const h=d.extensions&&d.extensions[jD];if(!h)return;const m=new Kc.Decoder,_=nV(l,h.bufferView),S=new Kc.Mesh;if(!m.DecodeArrayToMesh(_,_.byteLength,S))throw new Error("Failed to decode Draco mesh");const T=l.json.accessors[d.indices],M=s2[T.componentType],L=T.count*M.BYTES_PER_ELEMENT,k=Kc._malloc(L);M===Uint16Array?m.GetTrianglesUInt16Array(S,L,k):m.GetTrianglesUInt32Array(S,L,k),tV(Kc.memory.buffer.slice(k,k+L),T,l),Kc._free(k);for(const F of Object.keys(h.attributes)){const V=m.GetAttributeByUniqueId(S,h.attributes[F]),U=l.json.accessors[d.attributes[F]],Z=Gnt[U.componentType],q=U.count*L1[U.type]*s2[U.componentType].BYTES_PER_ELEMENT,Q=Kc._malloc(q);m.GetAttributeDataArrayForAllPoints(S,V,Kc[Z],q,Q),tV(Kc.memory.buffer.slice(Q,Q+q),U,l),Kc._free(Q)}m.destroy(),S.destroy(),delete d.extensions[jD]}const l2="EXT_meshopt_compression";function jnt(d,l){if(!d.extensions||!d.extensions[l2])return;const h=d.extensions[l2],m=new Uint8Array(l.buffers[h.buffer],h.byteOffset||0,h.byteLength||0),_=new Uint8Array(h.count*h.byteStride);HD.decodeGltfBuffer(_,h.count,h.byteStride,m,h.mode,h.filter),d.buffer=l.buffers.length,d.byteOffset=0,l.buffers[d.buffer]=_.buffer,delete d.extensions[l2]}const eV=1179937895,iV=new TextDecoder("utf8");function rV(d,l){return new URL(d,l).href}function Wnt(d,l,h,m){return fetch(rV(d.uri,m)).then(_=>_.arrayBuffer()).then(_=>{l.buffers[h]=_})}function nV(d,l){const h=d.json.bufferViews[l];return new Uint8Array(d.buffers[h.buffer],h.byteOffset||0,h.byteLength)}function $nt(d,l,h,m){if(d.uri){const _=rV(d.uri,m);return fetch(_).then(S=>S.blob()).then(S=>createImageBitmap(S)).then(S=>{l.images[h]=S})}if(d.bufferView!==void 0){const _=nV(l,d.bufferView),S=new Blob([_],{type:d.mimeType});return createImageBitmap(S).then(T=>{l.images[h]=T})}}function aV(d,l=0,h){const m={json:null,images:[],buffers:[]};if(new Uint32Array(d,l,1)[0]===eV){const F=new Uint32Array(d,l);let V=2;const U=(F[V++]>>2)-3,Z=F[V++]>>2;if(V++,m.json=JSON.parse(iV.decode(F.subarray(V,V+Z))),V+=Z,V<U){const q=F[V++];V++;const Q=l+(V<<2);m.buffers[0]=d.slice(Q,Q+q)}}else m.json=JSON.parse(iV.decode(new Uint8Array(d,l)));const{buffers:_,images:S,meshes:T,extensionsUsed:M,bufferViews:L}=m.json;let k=Promise.resolve();if(_){const F=[];for(let V=0;V<_.length;V++){const U=_[V];U.uri?F.push(Wnt(U,m,V,h)):m.buffers[V]||(m.buffers[V]=null)}k=Promise.all(F)}return k.then(()=>{const F=[],V=M&&M.includes(jD),U=M&&M.includes(l2);if(V&&F.push(function(){if(!Kc)return P1??(P1=function(Z){let q,Q=null;function it(){q=new Uint8Array(Q.buffer)}function at(){throw new Error("Unexpected Draco error.")}const dt={a:{a:at,d:function(mt,_t,Dt){return q.copyWithin(mt,_t,_t+Dt)},c:function(mt){const _t=q.length,Dt=Math.max(mt>>>0,Math.ceil(1.2*_t)),At=Math.ceil((Dt-_t)/65536);try{return Q.grow(At),it(),!0}catch{return!1}},b:at}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Z,dt):Z.then(mt=>mt.arrayBuffer()).then(mt=>WebAssembly.instantiate(mt,dt))).then(mt=>{const{Rb:_t,Qb:Dt,P:At,T:Ot,X:Nt,Ja:Ht,La:se,Qa:Kt,Va:le,Wa:ge,eb:Se,jb:ze,f:De,e:me,yb:Ee,zb:ae,Ab:re,Bb:Ie,Db:Re,Gb:xe}=mt.instance.exports;Q=me;const oi=(()=>{let ui=0,ri=0,Xe=0,ji=0;return Qe=>{Xe&&(_t(ji),_t(ui),ri+=Xe,Xe=ui=0),ui||(ri+=128,ui=Dt(ri));const Ii=Qe.length+7&-8;let Zi=ui;Ii>=ri&&(Xe=Ii,Zi=ji=Dt(Ii));for(let fr=0;fr<Qe.length;fr++)q[Zi+fr]=Qe[fr];return Zi}})();return it(),De(),{memory:me,_free:_t,_malloc:Dt,Mesh:class{constructor(){this.ptr=At()}destroy(){Ot(this.ptr)}},Decoder:class{constructor(){this.ptr=Ht()}destroy(){ze(this.ptr)}DecodeArrayToMesh(ui,ri,Xe){const ji=oi(ui),Qe=se(this.ptr,ji,ri,Xe.ptr);return!!Nt(Qe)}GetAttributeByUniqueId(ui,ri){return{ptr:Kt(this.ptr,ui.ptr,ri)}}GetTrianglesUInt16Array(ui,ri,Xe){le(this.ptr,ui.ptr,ri,Xe)}GetTrianglesUInt32Array(ui,ri,Xe){ge(this.ptr,ui.ptr,ri,Xe)}GetAttributeDataArrayForAllPoints(ui,ri,Xe,ji,Qe){Se(this.ptr,ui.ptr,ri.ptr,Xe,ji,Qe)}},DT_INT8:Ee(),DT_UINT8:ae(),DT_INT16:re(),DT_UINT16:Ie(),DT_UINT32:Re(),DT_FLOAT32:xe()}})}(fetch(J5())),P1.then(Z=>{Kc=Z,P1=void 0}))}()),U&&F.push(function(){if(HD)return;const Z=function(q){let Q;const it=WebAssembly.instantiateStreaming(q,{}).then(mt=>{Q=mt.instance,Q.exports.__wasm_call_ctors()}),at={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},dt={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:it,supported:!0,decodeGltfBuffer(mt,_t,Dt,At,Ot,Nt){(function(Ht,se,Kt,le,ge,Se,ze){const De=Ht.exports.sbrk,me=le+3&-4,Ee=De(me*ge),ae=De(Se.length),re=new Uint8Array(Ht.exports.memory.buffer);re.set(Se,ae);const Ie=se(Ee,le,ge,ae,Se.length);if(Ie===0&&ze&&ze(Ee,me,ge),Kt.set(re.subarray(Ee,Ee+le*ge)),De(Ee-De(0)),Ie!==0)throw new Error(`Malformed buffer data: ${Ie}`)})(Q,Q.exports[dt[Ot]],mt,_t,Dt,At,Q.exports[at[Nt]])}}}(fetch(Q5()));return Z.ready.then(()=>{HD=Z})}()),S)for(let Z=0;Z<S.length;Z++)F.push($nt(S[Z],m,Z,h));return(F.length?Promise.all(F):Promise.resolve()).then(()=>{if(V&&T)for(const{primitives:Z}of T)for(const q of Z)Hnt(q,m);if(U&&T&&L)for(const Z of L)jnt(Z,m);return m})})}function oV(d){return fetch(d).then(l=>l.arrayBuffer()).then(l=>aV(l,0,d))}function WD(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function $D(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ZD{constructor(l,h,m,_){this.context=l,this.format=m,this.useMipmap=_&&_.useMipmap,this.texture=l.gl.createTexture(),this.update(h,{premultiply:_&&_.premultiply})}update(l,h){const m=l&&l instanceof HTMLVideoElement&&l.width===0?l.videoWidth:l.width,_=l&&l instanceof HTMLVideoElement&&l.height===0?l.videoHeight:l.height,{context:S}=this,{gl:T}=S,{x:M,y:L}=h&&h.position?h.position:{x:0,y:0},k=M+m,F=L+_;!this.size||this.size[0]===k&&this.size[1]===F||(T.bindTexture(T.TEXTURE_2D,null),T.deleteTexture(this.texture),this.texture=T.createTexture(),this.size=null),T.bindTexture(T.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA8&&(!h||h.premultiply!==!1));const V=l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||ImageBitmap&&l instanceof ImageBitmap;if(!this.size&&k>0&&F>0){const U=this.useMipmap?Math.floor(Math.log2(Math.max(k,F)))+1:1;T.texStorage2D(T.TEXTURE_2D,U,this.format,k,F),this.size=[k,F]}this.size&&(V?T.texSubImage2D(T.TEXTURE_2D,0,M,L,WD(this.format),$D(this.format),l):"data"in l&&l.data&&T.texSubImage2D(T.TEXTURE_2D,0,M,L,m,_,WD(this.format),$D(this.format),l.data)),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(l,h,m=!1){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),l!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,l),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap&&!m?l===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:l),this.minFilter=l),h!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,h),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,h),this.wrapS=h)}bindExtraParam(l,h,m,_,S){const{context:T}=this,{gl:M}=T;M.bindTexture(M.TEXTURE_2D,this.texture),h!==this.magFilter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,h),this.magFilter=h),l!==this.minFilter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,this.useMipmap?l===M.NEAREST?M.NEAREST_MIPMAP_NEAREST:M.LINEAR_MIPMAP_LINEAR:l),this.minFilter=l),m!==this.wrapS&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,m),this.wrapS=m),_!==this.wrapT&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,_),this.wrapT=_),S!==this.compareMode&&(S?(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_COMPARE_MODE,M.COMPARE_REF_TO_TEXTURE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_COMPARE_FUNC,S)):M.texParameteri(M.TEXTURE_2D,M.TEXTURE_COMPARE_MODE,M.NONE),this.compareMode=S)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class R1{constructor(l,h){this.context=l,this.texture=h}bind(l,h){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),l!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l),this.minFilter=l),h!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,h),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,h),this.wrapS=h)}}const Znt=gr([{name:"a_pos_3f",components:3,type:"Float32"}]),qnt=gr([{name:"a_color_3f",components:3,type:"Float32"}]),Xnt=gr([{name:"a_color_4f",components:4,type:"Float32"}]),Ynt=gr([{name:"a_uv_2f",components:2,type:"Float32"}]),Knt=gr([{name:"a_normal_3f",components:3,type:"Float32"}]),Jnt=gr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Qnt=gr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function sV(d,l){const h=c2(d.projection,d.zoom,d.width,d.height),m=function(S,T,M,L,k){const F=new Y(M.lng-180*Lf,M.lat),V=new Y(M.lng+180*Lf,M.lat),U=S.project(F.lng,F.lat),Z=S.project(V.lng,V.lat),q=-Math.atan2(Z.y-U.y,Z.x-U.x),Q=qt.fromLngLat(M);Q.y=ct(Q.y,-1+Lf,1-Lf);const it=Q.toLngLat(),at=S.project(it.lng,it.lat),dt=qt.fromLngLat(it);dt.x+=Lf;const mt=dt.toLngLat(),_t=S.project(mt.lng,mt.lat),Dt=cV(_t.x-at.x,_t.y-at.y,q),At=qt.fromLngLat(it);At.y+=Lf;const Ot=At.toLngLat(),Nt=S.project(Ot.lng,Ot.lat),Ht=cV(Nt.x-at.x,Nt.y-at.y,q),se=Math.abs(Dt.x)/Math.abs(Ht.y),Kt=D([]);K(Kt,Kt,-q*(1-(k?0:L)));const le=D([]);return H(le,le,[1,1-(1-se)*L,1]),le[4]=-Ht.x/Ht.y*L,K(le,le,q),z(le,Kt,le),le}(d.projection,0,d.center,h,l),_=lV(d);return H(m,m,[_,_,1]),m}function lV(d){const l=d.projection,h=c2(d.projection,d.zoom,d.width,d.height),m=qD(l,d.center),_=qD(l,Y.convert(l.center));return Math.pow(2,m*h+(1-h)*_)}function c2(d,l,h,m,_=1/0){const S=d.range;if(!S)return 0;const T=Math.min(_,Math.max(h,m)),M=Math.log2(T/1024);return St(S[0]+M,S[1]+M,l)}const Lf=1/4e4;function qD(d,l){const h=ct(l.lat,-bt,bt),m=new Y(l.lng-180*Lf,h),_=new Y(l.lng+180*Lf,h),S=d.project(m.lng,h),T=d.project(_.lng,h),M=qt.fromLngLat(m),L=qt.fromLngLat(_),k=T.x-S.x,F=T.y-S.y,V=L.x-M.x,U=L.y-M.y,Z=Math.sqrt((V*V+U*U)/(k*k+F*F));return Math.log2(Z)}function cV(d,l,h){const m=Math.cos(h),_=Math.sin(h);return{x:d*m-l*_,y:d*_+l*m}}function uV(d,l,h){D(d),K(d,d,wr(l[2])),$(d,d,wr(l[0])),X(d,d,wr(l[1])),H(d,d,h),z(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function u2(d,l,h,m,_,S,T,M){const L=[h[0]-l[0],h[1]-l[1],0],k=[m[0]-l[0],m[1]-l[1],0];if(Rt(L)<1e-12||Rt(k)<1e-12)return xr(d);const F=We([],L,k);ye(F,F),Qt(k,m,l),L[2]=(S-_)*M,k[2]=(T-_)*M;const V=L;return We(V,L,k),ye(V,V),Ka(d,F,V)}function h2(d,l,h=!1){const m=Ef(l.zoom),_=function(S,T,M){const L=T.worldSize,k=[S[12],S[13],S[14]],F=vt(k[1]/L),V=xt(k[0]/L),U=D([]),Z=pt(1,F)*L,q=pt(1,0)*L*Mt(F,T.zoom),Q=1/SD(L);let it=q*Q;if(M){const _t=c2(T.projection,T.zoom,T.width,T.height,1024);it=Q*T.projection.pixelSpaceConversion(T.center.lat,L,_t)}const at=B(F,V);Vt(at,at,Ge([],ye([],at),Z*it*k[2]));const dt=function(_t){const Dt=[_t[0],_t[1],_t[2]];let At=[0,1,0];const Ot=We([],At,Dt);return We(At,Dt,Ot),Ve(At)===0&&(At=[0,1,0],We(Ot,Dt,At)),ye(Ot,Ot),ye(At,At),ye(Dt,Dt),[Ot[0],Ot[1],Ot[2],0,At[0],At[1],At[2],0,Dt[0],Dt[1],Dt[2],0,_t[0],_t[1],_t[2],1]}(at);H(U,U,[it,it,it*Z]),N(U,U,[-k[0],-k[1],-k[2]]);const mt=z([],T.globeMatrix,dt);return z(mt,mt,U),z(mt,mt,S),mt}(d,l,h);if(m>0){const S=function(T,M){const L=M.worldSize,k=pt(1,0)*L*Mt(M.center.lat,M.zoom)/SD(L),F=pt(1,M.center.lat)*L,V=D([]);X(V,V,wr(M.center.lng)),$(V,V,wr(M.center.lat)),N(V,V,[0,0,hs]),H(V,V,[k,k,k*F]);const U=M.point;return N(V,V,[-U.x,-U.y,0]),z(V,V,T),z(V,M.globeMatrix,V)}(d,l);return function(T,M,L){const k=(q,Q,it)=>{const at=Rt(q),dt=Rt(Q),mt=Zh(q,Q,it);return Ge(mt,mt,1/Rt(mt)*zi(at,dt,it))},F=k([T[0],T[1],T[2]],[M[0],M[1],M[2]],L),V=k([T[4],T[5],T[6]],[M[4],M[5],M[6]],L),U=k([T[8],T[9],T[10]],[M[8],M[9],M[10]],L),Z=Zh([T[12],T[13],T[14]],[M[12],M[13],M[14]],L);return[F[0],F[1],F[2],0,V[0],V[1],V[2],0,U[0],U[1],U[2],0,Z[0],Z[1],Z[2],1]}(_,S,m)}return _}function XD(d,l,h,m){const _=cr.projectAabbCorners(m,h);let S=Number.MAX_VALUE;for(let M=0;M<_.length;++M){const L=_[M];L[0]=(.5*L[0]+.5)*l.width,L[1]=(.5-.5*L[1])*l.height,L[2]<S&&(S=L[2])}const T=function(M){const L=[];let k=0;for(let Z=1;Z<M.length;Z++)(M[Z][0]<M[k][0]||M[Z][0]===M[k][0]&&M[Z][1]<M[k][1])&&(k=Z);let F,V=k;const U=new Uint8Array(M.length);do{if(U[V])break;L.push(new Ce(M[V][0],M[V][1])),U[V]=1,F=(V+1)%M.length;for(let Z=0;Z<M.length;Z++){if(M[Z][0]===M[F][0]&&M[Z][1]===M[F][1]||M[Z][0]===M[V][0]&&M[Z][1]===M[V][1])continue;const q=[M[Z][0]-M[V][0],M[Z][1]-M[V][1]],Q=[M[F][0]-M[V][0],M[F][1]-M[V][1]],it=q[0]*Q[1]-q[1]*Q[0];(it>0||it===0&&q[0]*Q[0]+q[1]*Q[1]>=0&&q[0]*q[0]+q[1]*q[1]>Q[0]*Q[0]+Q[1]*Q[1])&&(F=Z)}V=F}while(V!==k);return L.length>0&&L.push(L[0]),L}(_);if(ia(d,T))return S}const Ug=64,$_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function d2(d,l,h,m,_,S,T,M,L,k=!1){const F=h.zoom,V=h.project(m),U=Mt(m.lat,F),Z=1/U;D(d),N(d,d,[V.x+T[0]*Z,V.y+T[1]*Z,T[2]]);let q=1,Q=1;const it=h.worldSize;if(k){if(h.projection.name==="mercator"){let _t=0;h.elevation&&(_t=h.elevation.getAtPointOrZero(new qt(V.x/it,V.y/it),0));const Dt=Li([],[V.x,V.y,_t,1],h.projMatrix)[3]/h.cameraToCenterDistance;q=Dt,Q=Dt*Mt(h.center.lat,F)}else if(h.projection.name==="globe"){const _t=h2(d,h),Dt=[0,0,0,1];Li(Dt,Dt,z([],h.projMatrix,_t));const At=Dt[3]/h.cameraToCenterDistance,Ot=Ef(F),Nt=h.projection.pixelsPerMeter(m.lat,it)*Mt(m.lat,F),Ht=h.projection.pixelsPerMeter(h.center.lat,it)*Mt(h.center.lat,F);q=At/zi(Nt,Pt(h.center.lat),Ot),Q=At*U/Nt,q*=Ht,Q*=Ht}}else q=Z;H(d,d,[q,q,Q]);const at=[...d],dt=l.orientation,mt=[];if(uV(mt,[dt[0]+(_?_[0]:0),dt[1]+(_?_[1]:0),dt[2]+(_?_[2]:0)],S),z(d,at,mt),M&&h.elevation){let _t=0;const Dt=[];if(L&&h.elevation){_t=function(Ot,Nt,Ht,se,Kt){const le=Nt.elevation;if(!le)return 0;const ge=cr.projectAabbCorners(Ht,se),Se=pt(1,Kt.lat)*Nt.worldSize,ze=function(ri,Xe){const ji=[0,0,1],Qe=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ii of Qe){const Zi=ri[Ii.corners[0]],fr=ri[Ii.corners[1]],Pr=ri[Ii.corners[2]],qi=[fr[0]-Zi[0],fr[1]-Zi[1],Xe*(fr[2]-Zi[2])],Br=We(qi,qi,[Pr[0]-Zi[0],Pr[1]-Zi[1],Xe*(Pr[2]-Zi[2])]);ye(Br,Br),Ii.dotProductWithUp=Ke(Br,ji)}return Qe.sort((Ii,Zi)=>Ii.dotProductWithUp-Zi.dotProductWithUp),Qe[0].corners}(ge,Se),De=ge[ze[0]],me=ge[ze[1]],Ee=ge[ze[2]],ae=ge[ze[3]],re=le.getAtPointOrZero(new qt(De[0]/Nt.worldSize,De[1]/Nt.worldSize),0),Ie=le.getAtPointOrZero(new qt(me[0]/Nt.worldSize,me[1]/Nt.worldSize),0),Re=le.getAtPointOrZero(new qt(Ee[0]/Nt.worldSize,Ee[1]/Nt.worldSize),0),xe=le.getAtPointOrZero(new qt(ae[0]/Nt.worldSize,ae[1]/Nt.worldSize),0),oi=(re+xe)/2,ui=(Ie+Re)/2;return oi>ui?Ie<Re?u2(Ot,me,ae,De,Ie,xe,re,Se):u2(Ot,Ee,De,ae,Re,re,xe,Se):re<xe?u2(Ot,De,me,Ee,re,Ie,Re,Se):u2(Ot,ae,Ee,me,xe,Re,Ie,Se),Math.max(oi,ui)}(Dt,h,l.aabb,d,m);const At=z([],ht([],Dt),mt);z(d,at,At)}else _t=h.elevation.getAtPointOrZero(new qt(V.x/it,V.y/it),0);_t!==0&&(d[14]+=_t)}}class hV{constructor(l,h,m,_,S){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=l,this.uri=h,this.position=m!=null?new Y(m[0],m[1]):new Y(0,0),this.orientation=_??[0,0,0],this.nodes=S,this.uploaded=!1,this.aabb=new cr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,h){z(l.globalMatrix,h,l.localMatrix);const m=this.nodeOverrides.get(l.name);if(m!==void 0){const T=[];S=m.orientation,D(_=T),X(_,_,wr(S[1])),K(_,_,wr(S[2])),$(_,_,wr(S[0])),z(l.globalMatrix,l.globalMatrix,T)}var _,S;if(l.meshes)for(const T of l.meshes){const M=cr.applyTransformFast(T.aabb,l.globalMatrix);this.aabb.encapsulate(M)}if(l.children)for(const T of l.children)this._applyTransformations(T,l.globalMatrix)}computeBoundsAndApplyParent(){const l=D([]);this.aabb=new cr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.nodes)this._applyTransformations(h,l)}computeModelMatrix(l,h,m,_,S,T,M=!1){d2(this.matrix,this,l.transform,this.position,h,m,_,S,T,M)}upload(l){if(!this.uploaded){for(const h of this.nodes)YD(h,l);for(const h of this.nodes)f2(h);this.uploaded=!0}}destroy(){for(const l of this.nodes)KD(l)}}function k1(d,l,h=!1){d.uploaded||(d.gfxTexture=new ZD(l,d.image,h?l.gl.R8:l.gl.RGBA8,{useMipmap:d.sampler.minFilter>=l.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function tat(d,l,h){d.indexBuffer=l.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=l.createVertexBuffer(d.vertexArray,Znt.members,!1,!0),d.normalArray&&(d.normalBuffer=l.createVertexBuffer(d.normalArray,Knt.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=l.createVertexBuffer(d.texcoordArray,Ynt.members,!1,!0)),d.colorArray&&(d.colorBuffer=l.createVertexBuffer(d.colorArray,(d.colorArray.bytesPerElement===12?qnt:Xnt).members,!1,!0)),d.featureArray&&(d.pbrBuffer=l.createVertexBuffer(d.featureArray,Qnt.members,!0)),d.segments=Vn.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const m=d.material;m.pbrMetallicRoughness.baseColorTexture&&k1(m.pbrMetallicRoughness.baseColorTexture,l),m.pbrMetallicRoughness.metallicRoughnessTexture&&k1(m.pbrMetallicRoughness.metallicRoughnessTexture,l),m.normalTexture&&k1(m.normalTexture,l),m.occlusionTexture&&k1(m.occlusionTexture,l,h),m.emissionTexture&&k1(m.emissionTexture,l)}function YD(d,l,h){if(d.meshes)for(const m of d.meshes)tat(m,l,h);if(d.children)for(const m of d.children)YD(m,l,h)}function f2(d){if(d.meshes)for(const l of d.meshes)l.indexArray.destroy(),l.vertexArray.destroy(),l.colorArray&&l.colorArray.destroy(),l.normalArray&&l.normalArray.destroy(),l.texcoordArray&&l.texcoordArray.destroy(),l.featureArray&&l.featureArray.destroy();if(d.children)for(const l of d.children)f2(l)}function KD(d){if(d.meshes)for(const h of d.meshes)h.vertexBuffer&&(h.vertexBuffer.destroy(),h.indexBuffer.destroy(),h.normalBuffer&&h.normalBuffer.destroy(),h.texcoordBuffer&&h.texcoordBuffer.destroy(),h.colorBuffer&&h.colorBuffer.destroy(),h.pbrBuffer&&h.pbrBuffer.destroy(),h.segments.destroy(),h.material&&((l=h.material).pbrMetallicRoughness.baseColorTexture&&l.pbrMetallicRoughness.baseColorTexture.gfxTexture&&l.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),l.pbrMetallicRoughness.metallicRoughnessTexture&&l.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&l.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),l.normalTexture&&l.normalTexture.gfxTexture&&l.normalTexture.gfxTexture.destroy(),l.emissionTexture&&l.emissionTexture.gfxTexture&&l.emissionTexture.gfxTexture.destroy(),l.occlusionTexture&&l.occlusionTexture.gfxTexture&&l.occlusionTexture.gfxTexture.destroy()));var l;if(d.children)for(const h of d.children)KD(h)}function Gg(d,l){const h=d.json.bufferViews[l.bufferView],m=s2[l.componentType];return new m(d.buffers[h.buffer],(l.byteOffset||0)+(h.byteOffset||0),l.count*(h.byteStride&&h.byteStride!==L1[l.type]*m.BYTES_PER_ELEMENT?h.byteStride/m.BYTES_PER_ELEMENT:L1[l.type]))}function JD(d,l,h,m){const _=s2[l.componentType],S=function(F){switch(F){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(_),T=d.json.bufferViews[l.bufferView],M=T.byteStride?T.byteStride/_.BYTES_PER_ELEMENT:L1[l.type],L=h.float32,k=L.length/h.capacity;for(let F=0,V=0;F<l.count*M;F+=M,V+=k)for(let U=0;U<k;U++)L[V+U]=m[F+U]*S;h._trim()}function eat(d,l,h){const m=d.indices,_=d.attributes,S={};S.indexArray=new Pn;const T=l.json.accessors[m],M=T.count/3;S.indexArray.reserve(M);const L=Gg(l,T);for(let U=0;U<M;U++)S.indexArray.emplaceBack(L[3*U],L[3*U+1],L[3*U+2]);S.indexArray._trim(),S.vertexArray=new qs;const k=l.json.accessors[_.POSITION];S.vertexArray.reserve(k.count);const F=Gg(l,k);for(let U=0;U<k.count;U++)S.vertexArray.emplaceBack(F[3*U],F[3*U+1],F[3*U+2]);if(S.vertexArray._trim(),S.aabb=new cr(k.min,k.max),S.centroid=function(U,Z){const q=[0,0,0],Q=U.length;if(Q>0){for(let it=0;it<Q;it++){const at=3*U[it];q[0]+=Z[at],q[1]+=Z[at+1],q[2]+=Z[at+2]}q[0]/=Q,q[1]/=Q,q[2]/=Q}return q}(L,F),_.COLOR_0!==void 0){const U=l.json.accessors[_.COLOR_0],Z=L1[U.type],q=Gg(l,U);S.colorArray=Z===3?new qs:new ku,S.colorArray.resize(U.count),JD(l,U,S.colorArray,q)}if(_.NORMAL!==void 0){S.normalArray=new qs;const U=l.json.accessors[_.NORMAL];S.normalArray.resize(U.count);const Z=Gg(l,U);JD(l,U,S.normalArray,Z)}if(_.TEXCOORD_0!==void 0&&h.length>0){S.texcoordArray=new Ou;const U=l.json.accessors[_.TEXCOORD_0];S.texcoordArray.resize(U.count);const Z=Gg(l,U);JD(l,U,S.texcoordArray,Z)}if(_._FEATURE_ID_RGBA4444!==void 0){const U=l.json.accessors[_._FEATURE_ID_RGBA4444];l.json.extensionsUsed&&l.json.extensionsUsed.includes("EXT_meshopt_compression")&&(S.featureData=Gg(l,U))}_._FEATURE_RGBA4444!==void 0&&(S.featureData=new Uint32Array(Gg(l,l.json.accessors[_._FEATURE_RGBA4444]).buffer));const V=d.material;return S.material=function(U,Z){const{emissiveFactor:q=[0,0,0],alphaMode:Q="OPAQUE",alphaCutoff:it=.5,normalTexture:at,occlusionTexture:dt,emissiveTexture:mt,doubleSided:_t,name:Dt}=U,{baseColorFactor:At=[1,1,1,1],metallicFactor:Ot=1,roughnessFactor:Nt=1,baseColorTexture:Ht,metallicRoughnessTexture:se}=U.pbrMetallicRoughness||{},Kt=dt?Z[dt.index]:void 0;if(dt&&dt.extensions&&dt.extensions.KHR_texture_transform&&Kt){const le=dt.extensions.KHR_texture_transform;Kt.offsetScale=[le.offset[0],le.offset[1],le.scale[0],le.scale[1]]}return{name:Dt,pbrMetallicRoughness:{baseColorFactor:new Xr(...At),metallicFactor:Ot,roughnessFactor:Nt,baseColorTexture:Ht?Z[Ht.index]:void 0,metallicRoughnessTexture:se?Z[se.index]:void 0},doubleSided:_t,emissiveFactor:new Xr(...q),alphaMode:Q,alphaCutoff:it,normalTexture:at?Z[at.index]:void 0,occlusionTexture:Kt,emissionTexture:mt?Z[mt.index]:void 0,defined:U.defined===void 0}}(V!==void 0?l.json.materials[V]:{defined:!1},h),S}function dV(d,l,h){const{matrix:m,rotation:_,translation:S,scale:T,mesh:M,extras:L,children:k,name:F}=d,V={};if(V.name=F,V.localMatrix=m||function(U,Z,q,Q){var it=Z[0],at=Z[1],dt=Z[2],mt=Z[3],_t=it+it,Dt=at+at,At=dt+dt,Ot=it*_t,Nt=it*Dt,Ht=it*At,se=at*Dt,Kt=at*At,le=dt*At,ge=mt*_t,Se=mt*Dt,ze=mt*At,De=Q[0],me=Q[1],Ee=Q[2];return U[0]=(1-(se+le))*De,U[1]=(Nt+ze)*De,U[2]=(Ht-Se)*De,U[3]=0,U[4]=(Nt-ze)*me,U[5]=(1-(Ot+le))*me,U[6]=(Kt+ge)*me,U[7]=0,U[8]=(Ht+Se)*Ee,U[9]=(Kt-ge)*Ee,U[10]=(1-(Ot+se))*Ee,U[11]=0,U[12]=q[0],U[13]=q[1],U[14]=q[2],U[15]=1,U}([],_||[0,0,0,1],S||[0,0,0],T||[1,1,1]),V.globalMatrix=E(V.localMatrix),M!==void 0){V.meshes=h[M];const U=V.anchor=[0,0];for(const Z of V.meshes){const{min:q,max:Q}=Z.aabb;U[0]+=q[0]+Q[0],U[1]+=q[1]+Q[1]}U[0]=Math.floor(U[0]/V.meshes.length/2),U[1]=Math.floor(U[1]/V.meshes.length/2)}if(L&&(L.id&&(V.id=L.id),L.lights&&(V.lights=function(U){if(!U.length)return[];const Z=function(dt){const mt=atob(dt),_t=new Uint8Array(mt.length);for(let Dt=0;Dt<mt.length;Dt++)_t[Dt]=mt.codePointAt(Dt);return _t}(U),q=[],Q=Z.length/24,it=new Uint16Array(Z.buffer),at=new Float32Array(Z.buffer);for(let dt=0;dt<Q;dt++){const mt=it[2*dt*6]/30,_t=it[2*dt*6+1]/30,Dt=it[2*dt*6+10]/100,At=at[6*dt+1],Ot=at[6*dt+2],Nt=at[6*dt+3],Ht=at[6*dt+4],se=Nt-At,Kt=Ht-Ot,le=Math.hypot(se,Kt);q.push({pos:[At+.5*se,Ot+.5*Kt,_t],normal:[Kt/le,-se/le,0],width:le,height:mt,depth:Dt,points:[At,Ot,Nt,Ht]})}return q}(L.lights)),L.MAPBOX_geometry_bloom&&(V.isGeometryBloom=L.MAPBOX_geometry_bloom)),k){const U=[];for(const Z of k)U.push(dV(l.json.nodes[Z],l,h));V.children=U}return V}function iat(d){if(d.vertices.length===0||d.indices.length===0)return null;const l=new QT(d.vertices,d.indices,8,256),[h,m]=[l.min.clone(),l.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:l,min:h,max:m}}function rat(d){if(!d.extras||!d.extras.ground)return null;const l=d.extras.ground;if(!l||!Array.isArray(l)||l.length===0)return null;const h=l[0];if(!h||!Array.isArray(h)||h.length===0)return null;const m=[];for(const T of h){if(!Array.isArray(T)||T.length!==2)continue;const M=T[0],L=T[1];typeof M=="number"&&typeof L=="number"&&m.push(new Ce(M,L))}if(m.length<3)return null;m.length>1&&m[m.length-1].equals(m[0])&&m.pop();let _=0;for(let T=0;T<m.length;T++){const M=m[T],L=m[(T+1)%m.length],k=m[(T+2)%m.length];_+=(M.x-L.x)*(k.y-L.y)-(k.x-L.x)*(M.y-L.y)}_>0&&m.reverse();const S=V_(m.flatMap(T=>[T.x,T.y]),[]);return S.length===0?null:{vertices:m,indices:S}}function nat(d,l){const h=[],m=[];let _=0;const S=[];for(const T of d){_=h.length;const M=T.vertexArray.float32,L=T.indexArray.uint16;for(let k=0;k<T.vertexArray.length;k++)S[0]=M[3*k+0],S[1]=M[3*k+1],S[2]=M[3*k+2],zt(S,S,l),h.push(new Ce(S[0],S[1]));for(let k=0;k<3*T.indexArray.length;k++)m.push(L[k]+_)}if(m.length%3!=0)return null;for(let T=0;T<m.length;T+=3){const M=h[m[T+0]],L=h[m[T+1]],k=h[m[T+2]];(M.x-L.x)*(k.y-L.y)-(k.x-L.x)*(M.y-L.y)>0&&([m[T+1],m[T+2]]=[m[T+2],m[T+1]])}return{vertices:h,indices:m}}function QD(d){const l=function(L,k){const F=[],V=WebGL2RenderingContext;if(L.json.textures)for(const U of L.json.textures){const Z={magFilter:V.LINEAR,minFilter:V.NEAREST,wrapS:V.REPEAT,wrapT:V.REPEAT};U.sampler!==void 0&&Object.assign(Z,L.json.samplers[U.sampler]),F.push({image:k[U.source],sampler:Z,uploaded:!1})}return F}(d,d.images),h=function(L,k){const F=[];for(const V of L.json.meshes){const U=[];for(const Z of V.primitives)U.push(eat(Z,L,k));F.push(U)}return F}(d,l),{scenes:m,scene:_,nodes:S}=d.json,T=m?m[_||0].nodes:[...S.keys()],M=[];for(const L of T)M.push(dV(S[L],d,h));return function(L,k,F){const V={},U=new Set;for(let Z=0;Z<L.length;Z++){const q=F[k[Z]];if(!q.extras)continue;const Q=q.extras["mapbox:footprint:version"],it=q.extras["mapbox:footprint:id"];(Q||it)&&U.add(Z),Q==="1.0.0"&&it&&(V[it]=Z)}for(let Z=0;Z<L.length;Z++){if(U.has(Z))continue;const q=L[Z],Q=F[k[Z]];if(!Q.extras)continue;let it=null;q.id in V&&(it=nat(L[V[q.id]].meshes,q.localMatrix)),it||(it=rat(Q)),it&&(q.footprint=iat(it))}if(U.size>0){const Z=Array.from(U.values()).sort((q,Q)=>q-Q);for(let q=Z.length-1;q>=0;q--)L.splice(Z[q],1)}}(M,T,d.json.nodes),M}function aat(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const l=d.vertexArray.float32,h=d.aabb.min[0]-1,m=d.aabb.min[1]-1,_=Ug/(d.aabb.max[0]-h+2),S=Ug/(d.aabb.max[1]-m+2);for(let T=0;T<l.length;T+=3){const M=l[T+2],L=(l[T+0]-h)*_|0,k=(l[T+1]-m)*S|0;M>d.heightmap[k*Ug+L]&&(d.heightmap[k*Ug+L]=M)}}function fV(d,l,h,m,_){h.reserve(h.length+4*d.length),m.reserve(m.length+10*d.length),_.reserve(_.length+10*d.length);let S=m.length;for(const T of d){const M=Math.min(10,Math.max(4,1.3*T.height))*l,L=[-T.normal[1],T.normal[0],0],k=Math.min(.29,.1*T.width/T.depth),F=T.width-2*T.depth*l*(k+.01),V=li([],T.pos,L,F/2),U=li([],T.pos,L,-F/2),Z=[V[0],V[1],V[2]+T.height],q=[U[0],U[1],U[2]+T.height],Q=li([],T.normal,L,k);Ge(Q,Q,M);const it=li([],T.normal,L,-k);Ge(it,it,M),Vt(Q,V,Q),Vt(it,U,it),V[2]+=.1,U[2]+=.1,m.emplaceBack(Q[0],Q[1],Q[2]),m.emplaceBack(it[0],it[1],it[2]),m.emplaceBack(V[0],V[1],V[2]),m.emplaceBack(U[0],U[1],U[2]),m.emplaceBack(Z[0],Z[1],Z[2]),m.emplaceBack(q[0],q[1],q[2]),m.emplaceBack(V[0],V[1],V[2]),m.emplaceBack(U[0],U[1],U[2]),m.emplaceBack(Q[0],Q[1],Q[2]),m.emplaceBack(it[0],it[1],it[2]);const at=F/M/2;_.emplaceBack(-at-k,-1,at,.8),_.emplaceBack(at+k,-1,at,.8),_.emplaceBack(-at,0,at,1.3),_.emplaceBack(at,0,at,1.3),_.emplaceBack(at+k,-.8,at,.7),_.emplaceBack(at+k,-.8,at,.7),_.emplaceBack(0,0,at,1.3),_.emplaceBack(0,0,at,1.3),_.emplaceBack(at+k,-1.2,at,.8),_.emplaceBack(at+k,-1.2,at,.8),h.emplaceBack(6+S,4+S,8+S),h.emplaceBack(7+S,9+S,5+S),h.emplaceBack(0+S,1+S,2+S),h.emplaceBack(1+S,3+S,2+S),S+=10}}function oat(d,l){const h={};h.indexArray=new Pn,h.vertexArray=new qs,h.colorArray=new ku,fV(d,l,h.indexArray,h.vertexArray,h.colorArray);const m={defined:!0};m.emissiveFactor=Xr.black;const _={};return _.baseColorFactor=Xr.white,m.pbrMetallicRoughness=_,h.material=m,h.aabb=new cr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),h}const pV=gr([{name:"a_pos_3f",components:3,type:"Float32"}]),sat=gr([{name:"a_normal_3",components:3,type:"Int16"}]),lat=gr([{name:"a_centroid_3",components:3,type:"Int16"}]),gV=gr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),cat=gr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),uat=gr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),hat=gr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),dat=gr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),fat=gr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),mV=Ae.types,p2=32767;function pat(d,l){const h=Ne+l;for(const m of d)for(const _ of m)if(_.x<-l||_.x>h||_.y<-l||_.y>h)return!1;return!0}class vV{constructor(){this.layoutVertexArray=new qs,this.layoutAttenuationArray=new ku,this.layoutColorArray=new Al,this.indexArray=new Pn,this.indexArrayForConflation=new Pn,this.segmentsBucket=new Vn}}class tP{constructor(){this.layoutVertexArray=new qs,this.layoutNormalArray=new Hh,this.layoutCentroidArray=new Hh,this.layoutColorArray=new Al,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new D_,this.layoutAOArray=new Zc,this.indexArray=new Pn,this.indexArrayForConflation=new Pn,this.segmentsBucket=new Vn,this.entranceBloom=new vV}}class _V{constructor(l){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new tP,this.buildingWithFacade=new tP,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=l.zoom,this.canonical=l.canonical,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.worldview=l.worldview,this.lut=l.lut,this.buildingWithFacade.layoutFacadePaintArray=new Al,this.buildingWithFacade.layoutFacadeDataArray=new jh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Al,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.projection=l.projection,this.groundEffect=new FD(l),this.groundEffect.groundRadiusArray=new Zc,this.hasAppearances=null}updateFootprints(l,h){for(const m of this.footprints)h.push({footprint:m,id:l})}updateAppearances(l,h,m,_){}prepare(){return function(){if(o2!=null||K5!=null)return null;if(W_!=null)return W_;const l=fetch(An.BUILDING_GEN_URL);return W_=function(h){let m,_,S,T;function M(){m=new Uint8Array(T.buffer),_=new Int32Array(T.buffer),S=new Float32Array(T.buffer)}function L(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},F={a:{a:L,f:function(V){const U=m.length,Z=Math.max(V>>>0,Math.ceil(1.2*U)),q=Math.ceil((Z-U)/65536);try{return T.grow(q),M(),!0}catch{return!1}},g:L,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(h,F):h.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,F))).then(V=>{const U=V.instance.exports;return(0,U.g)(),T=U.f,M(),new Vnt({setStyle:U.h,setAOOptions:U.i,setMetricOptions:U.j,setStructuralOptions:U.k,setFacadeOptions:U.l,setFauxFacadeOptions:U.m,setFacadeClassifierOptions:U.n,addFeature:U.o,addFacade:U.p,generateMesh:U.q,getLastError:U.r,getOuterRingLength:U.s,getMeshCount:U.t,getPositionsPtr:U.u,getPositionsLength:U.v,getNormalsPtr:U.w,getNormalsLength:U.x,getColorsPtr:U.y,getColorsLength:U.z,getAOPtr:U.A,getAOLength:U.B,getUVPtr:U.C,getUVLength:U.D,getFauxFacadePtr:U.E,getFauxFacadeLength:U.F,getIndicesPtr:U.G,getIndicesLength:U.H,getBuildingPart:U.I,getRingCount:U.J,getRingPtr:U.K,getRingLength:U.L,free:U.M,malloc:U.N,heapU8:m,heap32:_,heapF32:S})})}(l).then(h=>(W_=null,o2=h,o2)).catch(h=>{Mi("Could not load building-gen"),W_=null,K5=h}),W_}()}populate(l,h,m,_){const S=Unt();if(!S)return;const T=Lt(m);this.tileToMeter=T,this.brightness=h.brightness,S.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,T],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:T,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),S.setAOOptions(!1,.3),S.setMetricOptions(!1,16),S.setStructuralOptions(!0),S.setFacadeClassifierOptions(3);const M=new Map,L=new Map;for(const{feature:k}of l){if(mV[k.type]!=="LineString"){M.set(k.id,k.properties.source_id);continue}const F=this.layers[0]._featureFilter.needGeometry,V=ee(k,F);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),V,m))continue;const U=F?V.geometry:de(k,m,_),Z=[];for(const at of U)for(const dt of at)Z.push({x:dt.x,y:dt.y});const q={coordinates:Z,crossPerc:k.properties.cross_perc,distanceToRoad:k.properties.distance_to_road,entrances:k.properties.entrances,sourceId:0},Q=k.properties.source_id;let it=L.get(Q);it||(it=[],L.set(Q,it)),it.push(q)}this.maxHeight=0;for(const{feature:k,id:F,index:V,sourceLayerIndex:U}of l){if(mV[k.type]==="LineString")continue;const Z=this.layers[0]._featureFilter.needGeometry,q=ee(k,Z);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),q,m))continue;const Q=Z?q.geometry:de(k,m,_),it=S1(Q,500);if(!pat(Q,163))continue;const at=this.layers[0],dt=at.layout.get("building-roof-shape").evaluate(k,{},m);if(dt==="flat")continue;const mt=at.layout.get("building-base").evaluate(k,{},m),_t=at.layout.get("building-height").evaluate(k,{},m),Dt=at.layout.get("building-flood-light-ground-radius").evaluate(k,{},m),At=at.paint.get("building-ambient-occlusion-intensity"),Ot=Dt/this.tileToMeter;let Nt=at.layout.get("building-flood-light-wall-radius").evaluate(k,{},m);Nt=ct(Nt,0,2048);const Ht=Nt/2048*p2,se=M.get(F);let Kt;Kt=L.has(se)?L.get(se):[];const le=Kt.length!==0&&at.layout.get("building-facade").evaluate(k,{},m);S.setFacadeOptions(4,!0),S.setFauxFacadeOptions(le,!1,1);let ge=0,Se=0,ze=0,De=0,me=0,Ee=0;if(le){let ue=Math.round(at.layout.get("building-facade-floors").evaluate(k,{},m));if(mt===0){ue=Math.max(1,ue-(Kt.length>0?1:0));let vi=4;if(_t>100){const gi=[10,13,15];vi=gi[k.id?k.id%gi.length:0],S.setFacadeOptions(vi,!0)}me=1.6803*vi/T}else me=mt/T;Ee=_t/T,me=Math.min(me,Ee),ze=at.layout.get("building-facade-unit-width").evaluate(k,{},m)/T,De=(Ee-me)/ue,S.setFauxFacadeOptions(!0,!0,ze);const Je=at.layout.get("building-facade-window").evaluate(k,{},m);ge=Je[0],Se=Je[1]}const ae=[],re=new Ce(1/0,1/0),Ie=new Ce(-1/0,-1/0),Re=new Ce(0,0);let xe=0;for(const ue of it)if(ue.length>0){const Je=[];for(const vi of ue){const gi=[];for(let Ji=vi.length-1;Ji>=0;Ji--){const Ri=vi[Ji];gi.push({x:Ri.x,y:Ri.y}),re.x=Math.min(re.x,Ri.x),re.y=Math.min(re.y,Ri.y),Ie.x=Math.max(Ie.x,Ri.x),Ie.y=Math.max(Ie.y,Ri.y),Re.x+=Ri.x,Re.y+=Ri.y,xe++}Je.push(gi)}ae.push({id:k.id?k.id:0,height:_t,minHeight:mt,sourceId:0,roofType:dt,coordinates:Je})}Re.x/=xe||1,Re.y/=xe||1;const oi=S.generateMesh(ae,Kt);if(typeof oi=="string"){Mi(`Unable to generate building ${k.id}: ${oi}`);continue}if(oi.meshes.length===0||oi.modifiedPolygonRings.length===0)continue;let ui=0;for(const ue of oi.meshes)ui+=ue.positions.length/3;const ri=le?this.buildingWithFacade:this.buildingWithoutFacade,Xe=ri.segmentsBucket.prepareSegment(ui,ri.layoutVertexArray,ri.indexArray),ji=[];let Qe=null,Ii=0,Zi=-1;const fr=ri.layoutVertexArray.length,Pr=ri.indexArray.length;let qi=0;for(const ue of oi.meshes){const Je=ri.layoutVertexArray.length;if(ue.buildingPart==="entrance"){const di=new Array;for(let Cr=0;Cr<ue.positions.length;Cr+=12){const cn=ue.positions[Cr+0],Yr=ue.positions[Cr+1],Zn=ue.positions[Cr+3],Mn=ue.positions[Cr+4],mn=ue.positions[Cr+2],rn=ue.positions[Cr+8]-mn,Nr=1,Qi=Zn-cn,Vr=Mn-Yr,vn=Math.hypot(Qi,Vr);di.push({pos:[cn+.5*Qi,Yr+.5*Vr,mn],normal:[Vr/vn,-Qi/vn,0],width:vn,height:rn,depth:Nr,points:[cn,Yr,Zn,Mn]})}const zr=ri.entranceBloom.segmentsBucket.prepareSegment(10*di.length,ri.entranceBloom.layoutVertexArray,ri.entranceBloom.indexArray),ln=ri.entranceBloom.layoutVertexArray.length;Ii=ri.entranceBloom.indexArray.length,fV(di,.5/this.tileToMeter,ri.entranceBloom.indexArray,ri.entranceBloom.layoutVertexArray,ri.entranceBloom.layoutAttenuationArray);const Oi=ri.entranceBloom.layoutVertexArray.length-ln;Zi=ri.entranceBloom.indexArray.length-Ii;for(let Cr=0;Cr<Oi;Cr++)ri.entranceBloom.layoutColorArray.emplaceBack(65535,65535);zr.vertexLength+=Oi,zr.primitiveLength+=Zi,Qe={part:ue.buildingPart,vertexOffset:ln,vertexLength:Oi}}for(let di=0;di<ue.positions.length;di+=3)qi=Math.max(qi,ue.positions[di+2]),ri.layoutVertexArray.emplaceBack(ue.positions[di],ue.positions[di+1],ue.positions[di+2]);const vi=Math.floor(Re.x),gi=Math.floor(Re.y),Ji=Math.floor(qi);for(let di=0;di<ue.positions.length;di+=3)ri.layoutCentroidArray.emplaceBack(vi,gi,Ji),ri.layoutFloodLightDataArray.emplaceBack(ue.buildingPart==="wall"?Ht:0);for(let di=0;di<ue.normals.length;di+=3)ri.layoutNormalArray.emplaceBack(ue.normals[di+0]*p2,ue.normals[di+1]*p2,ue.normals[di+2]*p2);for(let di=0;di<ue.ao.length;di++)ri.layoutAOArray.emplaceBack(ue.ao[di]);for(let di=0;di<ue.colors.length;di+=3){const zr=1+(ue.ao[di/3]-1)*At;ri.layoutColorArray.emplaceBack(ue.colors[di]*zr<<8|ue.colors[di+1]*zr,ue.colors[di+2]*zr<<8)}if(le){for(let di=0;di<ue.positions.length;di+=3)ri.layoutFacadePaintArray.emplaceBack(65535,255);for(let di=0;di<ue.isFauxFacade.length;di++)if(ue.isFauxFacade[di]){const zr=1|Math.min(65535,Math.floor(ue.uv[2*di]*oi.outerRingLength)),ln=Math.floor(255*ge)<<8|Math.floor(255*Se),Oi=Math.floor(65535*Math.min(1,ze/Ne)),Cr=Math.floor(65535*Math.min(1,De/Ne));ri.layoutFacadeDataArray.emplaceBack(zr,ln,Oi,Cr);const cn=Math.floor(65535*Math.min(1,me/Ne)),Yr=Math.floor(65535*Math.min(1,Ee/Ne));ri.layoutFacadeVerticalRangeArray.emplaceBack(cn,Yr)}else ri.layoutFacadeDataArray.emplaceBack(0,0,0,0),ri.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ri=Xe.vertexLength;for(let di=0;di<ue.indices.length;di+=3)ri.indexArray.emplaceBack(Ri+ue.indices[di],Ri+ue.indices[di+1],Ri+ue.indices[di+2]);Xe.vertexLength+=ue.positions.length/3,Xe.primitiveLength+=ue.indices.length/3,(ue.buildingPart==="roof"||ue.buildingPart==="wall"||ue.buildingPart==="facade_glazing"||ue.buildingPart==="entrance")&&ji.push({part:ue.buildingPart,vertexOffset:Je,vertexLength:ue.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,qi),this.buildingFeatures.push({promoteId:F,feature:q,hasFauxFacade:le,segment:Xe,parts:ji,buildingBloom:Qe});const Br=ri.indexArray.length-Pr,Fr=[],Bn=[],It=new Ce(1/0,1/0),wt=new Ce(-1/0,-1/0),ce=this.groundEffect.vertexArray.length;for(const ue of oi.modifiedPolygonRings){const Je=[],vi=new Ce(1/0,1/0),gi=new Ce(-1/0,-1/0);for(let Ji=0;Ji<ue.length;Ji+=2){const Ri=ue.length-Ji-2;vi.x=Math.min(vi.x,ue[Ri]),vi.y=Math.min(vi.y,ue[Ri+1]),gi.x=Math.max(gi.x,ue[Ri]),gi.y=Math.max(gi.y,ue[Ri+1]);const di=new Ce(ue[Ri],ue[Ri+1]);Je.push(di),Fr.push(di.x,di.y),Bn.push(di.clone())}It.x=Math.min(It.x,vi.x),It.y=Math.min(It.y,vi.y),wt.x=Math.max(wt.x,gi.x),wt.y=Math.max(wt.y,gi.y),this.groundEffect.addData(Je,[vi,gi],Ot)}const je=this.groundEffect.vertexArray.length-ce;for(let ue=0;ue<je;ue++)this.groundEffect.groundRadiusArray.emplaceBack(Dt);(re.x<0||Ie.x>Ne||re.y<0||Ie.y>Ne)&&this.featuresOnBorder.push({featureId:k.id,footprintIndex:this.footprints.length});{const ue=V_(Fr,null,2),Je=new QT(Bn,ue,8,256);let vi=k.id;k.properties&&k.properties.hasOwnProperty("building_id")&&(vi=k.properties.building_id);const gi={vertices:Bn,indices:ue,grid:Je,min:It,max:wt,buildingId:vi,hiddenFlags:0,indicesOffset:Pr,indicesLength:Br,bloomIndicesOffset:Ii,bloomIndicesLength:Zi,groundEffectVertexOffset:ce,groundEffectVertexLength:je,hasFauxFacade:le,segment:Xe,height:qi};k.id!==void 0&&this.featureFootprintLookup.set(k.id,this.footprints.length),this.footprints.push(gi)}this.programConfigurations.populatePaintArrays(ri.layoutVertexArray.length,k,V,{},h.availableImages,m,h.brightness),this.groundEffect.addPaintPropertiesData(k,V,{},h.availableImages,m,h.brightness),h.featureIndex.insert(k,Q,V,U,this.index,fr)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(l,h,m,_,S,T,M){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M),this.groundEffect.update(l,h,S,m,_,T,M),this.evaluate(this.layers[0],l),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(l){const h=m=>{m.layoutVertexBuffer=l.createVertexBuffer(m.layoutVertexArray,pV.members),m.layoutNormalBuffer=l.createVertexBuffer(m.layoutNormalArray,sat.members),m.layoutCentroidBuffer=l.createVertexBuffer(m.layoutCentroidArray,lat.members),m.layoutFloodLightDataBuffer=l.createVertexBuffer(m.layoutFloodLightDataArray,fat.members),m.layoutFacadeDataArray&&m.layoutFacadeDataArray.length&&(m.layoutFacadeDataBuffer=l.createVertexBuffer(m.layoutFacadeDataArray,uat.members)),m.layoutFacadeVerticalRangeArray&&m.layoutFacadeVerticalRangeArray.length&&(m.layoutFacadeVerticalRangeBuffer=l.createVertexBuffer(m.layoutFacadeVerticalRangeArray,hat.members)),m.entranceBloom.layoutVertexArray.length&&(m.entranceBloom.layoutVertexBuffer=l.createVertexBuffer(m.entranceBloom.layoutVertexArray,pV.members),m.entranceBloom.layoutAttenuationBuffer=l.createVertexBuffer(m.entranceBloom.layoutAttenuationArray,dat.members)),this.uploadUpdatedColorBuffer(l),this.uploadUpdatedIndexBuffer(l)};this.uploaded||(h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.groundEffect.upload(l)),this.groundEffect.uploadPaintProperties(l),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){const l=h=>{h.layoutVertexBuffer&&(h.layoutVertexBuffer.destroy(),h.layoutNormalBuffer.destroy(),h.layoutColorBuffer.destroy(),h.segmentsBucket.destroy(),h.indexBuffer&&h.indexBuffer.destroy(),h.entranceBloom.layoutVertexBuffer&&(h.entranceBloom.layoutVertexBuffer.destroy(),h.entranceBloom.layoutColorBuffer.destroy(),h.entranceBloom.layoutAttenuationBuffer.destroy(),h.entranceBloom.indexBuffer.destroy(),h.entranceBloom.segmentsBucket.destroy()))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(l,h,m=!0){let _=!1;const S=m?h:0,T=0|(m?-1:~h);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const M of l){const L=this.footprints[M],k=L.hiddenFlags&T|S;L.hiddenFlags!==k&&(L.hiddenFlags=k,_=!0,this.groundEffect.updateHiddenByLandmarkRange(L.groundEffectVertexOffset,L.groundEffectVertexLength,L.hiddenFlags!==0))}return _&&(this.indexArrayForConflationUploaded=!1),_}uploadUpdatedIndexBuffer(l){if(this.groundEffect.uploadHiddenByLandmark(l),this.indexArrayForConflationUploaded)return;const h=_=>{_.indexArray.length!==0&&(_.indexArrayForConflation.resize(_.indexArray.length),_.indexArrayForConflation.uint16.set(_.indexArray.uint16),_.entranceBloom.indexArrayForConflation.resize(_.entranceBloom.indexArray.length),_.entranceBloom.indexArrayForConflation.uint16.set(_.entranceBloom.indexArray.uint16))};h(this.buildingWithoutFacade),h(this.buildingWithFacade);for(const _ of this.footprints){const S=_.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,T=_.indicesOffset+_.indicesLength;if(_.hiddenFlags!==0){for(let L=_.indicesOffset;L<T;L++)S.indexArrayForConflation.uint16[3*L+0]=0,S.indexArrayForConflation.uint16[3*L+1]=0,S.indexArrayForConflation.uint16[3*L+2]=0;const M=_.bloomIndicesOffset+_.bloomIndicesLength;for(let L=_.bloomIndicesOffset;L<M;L++)S.entranceBloom.indexArrayForConflation.uint16[3*L+0]=0,S.entranceBloom.indexArrayForConflation.uint16[3*L+1]=0,S.entranceBloom.indexArrayForConflation.uint16[3*L+2]=0}}const m=_=>{_.indexArray.length!==0&&(_.indexBuffer?_.indexBuffer.updateData(_.indexArrayForConflation):_.indexBuffer=l.createIndexBuffer(_.indexArrayForConflation,!0),_.entranceBloom.indexBuffer?_.entranceBloom.indexBuffer.updateData(_.entranceBloom.indexArrayForConflation):_.entranceBloom.indexBuffer=l.createIndexBuffer(_.entranceBloom.indexArrayForConflation,!0))};m(this.buildingWithoutFacade),m(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(l){const h=m=>{m.layoutColorBuffer?m.layoutColorBuffer.updateData(m.layoutColorArray):m.layoutColorBuffer=l.createVertexBuffer(m.layoutColorArray,gV.members,!0),m.layoutFacadePaintArray&&(m.layoutFacadePaintBuffer?m.layoutFacadePaintBuffer.updateData(m.layoutFacadePaintArray):m.layoutFacadePaintBuffer=l.createVertexBuffer(m.layoutFacadePaintArray,cat.members,!0)),m.entranceBloom.layoutColorBuffer?m.entranceBloom.layoutColorBuffer.updateData(m.entranceBloom.layoutColorArray):m.entranceBloom.layoutColorBuffer=l.createVertexBuffer(m.entranceBloom.layoutColorArray,gV.members,!0)};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(l,h){const m=l.paint.get("building-ambient-occlusion-intensity");for(const _ of this.buildingFeatures){const S=h[_.promoteId],T=_.feature;T.properties["building-part"]="roof";const M=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),L=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical);T.properties["building-part"]="wall";const k=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),F=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical);T.properties["building-part"]="window";const V=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),U=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical);T.properties["building-part"]="door";const Z=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),q=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical),Q=_.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const at of _.parts){let dt,mt=M;at.part==="roof"?(mt=M,dt=L):at.part==="wall"?(mt=k,dt=F):at.part==="facade_glazing"?(mt=V,dt=U):at.part==="entrance"&&(mt=Z,dt=q),dt=ct(dt,0,1);for(let _t=0;_t<at.vertexLength;_t++){const Dt=at.vertexOffset+_t,At=1+(Q.layoutAOArray.float32[Dt]-1)*m;Q.layoutColorArray.emplace(Dt,mt.r*At*255<<8|mt.g*At*255,mt.b*At*255<<8|255*dt),_.hasFauxFacade&&Q.layoutFacadePaintArray.emplace(Dt,255*V.r<<8|255*V.g,255*V.b<<8|255*U)}}const it=_.buildingBloom;if(it)for(let at=0;at<it.vertexLength;at++)Q.entranceBloom.layoutColorArray.emplace(it.vertexOffset+at,255*Z.r<<8|255*Z.g,255*Z.b<<8|51*q)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(l,h,m){if(h.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=h.updateTime;const _=h.getReplacementRegionsForTile(l.toUnwrapped());if(e2(this.activeReplacements,_))return;this.activeReplacements=_;for(const T of this.footprints)T.hiddenFlags&=-2;const S=[];for(const T of this.activeReplacements){if(T.order<=y5)continue;const M=Math.max(1,Math.pow(2,T.footprintTileId.canonical.z-l.canonical.z));for(const L of this.footprints)L.min.x>T.max.x||L.max.x<T.min.x||L.min.y>T.max.y||L.max.y<T.min.y||(S.length=0,gat(L.vertices,0,L.vertices.length,T.footprintTileId.canonical,l.canonical,S),kD(T.footprint,S,L.indices,0,L.indices.length,0,-M)&&(L.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const T of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(l){if(l.id!==void 0){const h=this.featureFootprintLookup.get(l.id);return this.footprints[h]}return null}getHeightAtTileCoord(l,h){let m=Number.NEGATIVE_INFINITY,_=!0;const S=4*(l+Ne)*Ne+(h+Ne);if(this.footprintLookup.hasOwnProperty(S)){const M=this.footprintLookup[S];return M?{height:M.height,hidden:M.hiddenFlags!==0}:void 0}const T=new Ce(l,h);for(const M of this.footprints)l>M.max.x||M.min.x>l||h>M.max.y||M.min.y>h||M.height<=m||OD(T,M)&&(m=M.height,this.footprintLookup[S]=M,_=M.hiddenFlags!==0);if(m!==Number.NEGATIVE_INFINITY)return{height:m,hidden:_};this.footprintLookup[S]=void 0}}function gat(d,l,h,m,_,S){const T=Math.pow(2,m.z-_.z);for(let M=0;M<h;M++){let L=d[M+l].x,k=d[M+l].y;L=(L+_.x*Ne)*T-m.x*Ne,k=(k+_.y*Ne)*T-m.y*Ne,S.push(new Ce(L,k))}}let yV,xV;si(_V,"BuildingBucket",{omit:["layers"]}),si(tP,"BuildingGeometry"),si(vV,"BuildingBloomGeometry");const mat=gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),vat=gr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:_at}=mat,yat=gr([{name:"a_packed",components:3,type:"Float32"}]),{members:xat}=yat,bat=gr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:wat}=bat;class bV{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.image=new Df({width:l,height:h}),this.positions={},this.uploaded=!1}getDash(l,h){const m=this.getKey(l,h);return this.positions[m]}trim(){const l=this.width,h=this.height=$t(this.nextRow);this.image.resize({width:l,height:h})}getKey(l,h){return l.join(",")+h}getDashRanges(l,h,m){const _=[];let S=l.length%2==1?-l[l.length-1]*m:0,T=l[0]*m,M=!0;_.push({left:S,right:T,isDash:M,zeroLength:l[0]===0});let L=l[0];for(let k=1;k<l.length;k++){M=!M;const F=l[k];S=L*m,L+=F,T=L*m,_.push({left:S,right:T,isDash:M,zeroLength:F===0})}return _}addRoundDash(l,h,m){const _=h/2;for(let S=-m;S<=m;S++){const T=this.width*(this.nextRow+m+S);let M=0,L=l[M];for(let k=0;k<this.width;k++){k/L.right>1&&(L=l[++M]);const F=Math.abs(k-L.left),V=Math.abs(k-L.right),U=Math.min(F,V);let Z;const q=S/m*(_+1);if(L.isDash){const Q=_-Math.abs(q);Z=Math.sqrt(U*U+Q*Q)}else Z=_-Math.sqrt(U*U+q*q);this.image.data[T+k]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(l,h){for(let L=l.length-1;L>=0;--L){const k=l[L],F=l[L+1];k.zeroLength?l.splice(L,1):F&&F.isDash===k.isDash&&(F.left=k.left,l.splice(L,1))}const m=l[0],_=l[l.length-1];m.isDash===_.isDash&&(m.left=_.left-this.width,_.right=m.right+this.width);const S=this.width*this.nextRow;let T=0,M=l[T];for(let L=0;L<this.width;L++){L/M.right>1&&(M=l[++T]);const k=Math.abs(L-M.left),F=Math.abs(L-M.right),V=Math.min(k,F);this.image.data[S+L]=Math.max(0,Math.min(255,(M.isDash?V:-V)+h+128))}}addDash(l,h){const m=this.getKey(l,h);if(this.positions[m])return this.positions[m];const _=h==="round",S=_?7:0,T=2*S+1;if(this.nextRow+T>this.height)return Mi("LineAtlas out of space"),null;l.length===0&&l.push(1);let M=0;for(let F=0;F<l.length;F++)l[F]<0&&(Mi("Negative value is found in line dasharray, replacing values with 0"),l[F]=0),M+=l[F];if(M!==0){const F=this.width/M,V=this.getDashRanges(l,this.width,F);_?this.addRoundDash(V,F,S):this.addRegularDash(V,h==="square"?.5*F:0)}const L=this.nextRow+S;this.nextRow+=T;const k={tl:[L,S],br:[M,0]};return this.positions[m]=k,k}}si(bV,"LineAtlas");const Sat=Ae.types,Tat=Math.cos(Math.PI/180*37.5),Aat=Math.cos(Math.PI/180*5);class eP{constructor(l){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=l.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=l.overscaling,this.pixelRatio=l.pixelRatio,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.projection=l.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new I_,this.layoutVertexArray2=new qs,this.patternVertexArray=new qs,this.indexArray=new Pn,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.segments=new Vn,this.maxLineLength=0,this.zOffsetVertexArray=new qs,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.tessellationStep=l.tessellationStep?l.tessellationStep:Ne/64,this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.hasPattern=CD("line",this.layers,this.pixelRatio,h);const S=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Lt(m);const T=this.layers[0].layout.get("line-elevation-reference");if(T==="hd-road-markup")this.elevationType="road";else{const U=this.layers[0].layout.get("line-z-offset"),Z=U.isConstant()&&!U.constantOr(0);this.elevationType=T!=="sea"&&T!=="ground"&&Z?"none":"offset",this.elevationType==="offset"&&T==="none"&&Mi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&M!==void 0;const L=[];for(const{feature:U,id:Z,index:q,sourceLayerIndex:Q}of l){const it=this.layers[0]._featureFilter.needGeometry,at=ee(U,it);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),at,m))continue;const dt=S?S.evaluate(at,{},m):void 0,mt={id:Z,properties:U.properties,type:U.type,sourceLayerIndex:Q,index:q,geometry:it?at.geometry:de(U,m,_),patterns:{},sortKey:dt};L.push(mt)}S&&L.sort((U,Z)=>U.sortKey-Z.sortKey);const{lineAtlas:k,featureIndex:F}=h,V=this.addConstantDashes(k);for(const U of L){const{geometry:Z,index:q,sourceLayerIndex:Q}=U;if(V&&this.addFeatureDashes(U,k),this.hasPattern){const it=ED("line",this.layers,U,this.zoom,this.pixelRatio,h);this.patternFeatures.push(it)}else this.addFeature(U,Z,q,m,k.positions,h.availableImages,h.brightness,h.elevationFeatures);F.insert(l[q].feature,Z,q,Q,this.index)}}addConstantDashes(l){let h=!1;for(const m of this.layers){const _=m.paint.get("line-dasharray").value,S=m.layout.get("line-cap").value;if(_.kind!=="constant"||S.kind!=="constant")h=!0;else{const T=S.value,M=_.value;if(!M)continue;l.addDash(M,T)}}return h}addFeatureDashes(l,h){const m=this.zoom;for(const _ of this.layers){const S=_.paint.get("line-dasharray").value,T=_.layout.get("line-cap").value;if(S.kind==="constant"&&T.kind==="constant")continue;let M,L;if(S.kind==="constant"){if(M=S.value,!M)continue}else M=S.evaluate({zoom:m},l);L=T.kind==="constant"?T.value:T.evaluate({zoom:m},l),h.addDash(M,L),l.patterns[_.id]=[h.getKey(M,L)]}}update(l,h,m,_,S,T,M,L){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M,L)}addFeatures(l,h,m,_,S,T){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,h,m,_,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,xat)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=l.createVertexBuffer(this.patternVertexArray,wat)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=l.createVertexBuffer(this.zOffsetVertexArray,vat.members,!0)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,_at),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l,h){let m,_;if(h&&h>0?(m=`mapbox_clip_start_${h}`,_=`mapbox_clip_end_${h}`):(m="mapbox_clip_start",_="mapbox_clip_end"),l.properties&&l.properties.hasOwnProperty(m)&&l.properties.hasOwnProperty(_))return{start:+l.properties[m],end:+l.properties[_]}}addFeature(l,h,m,_,S,T,M,L){const k=this.layers[0].layout,F=k.get("line-join").evaluate(l,{}),V=k.get("line-cap").evaluate(l,{}),U=k.get("line-miter-limit"),Z=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(l),this.lineFeature=l;const q=!(!l.properties||!l.properties.hasOwnProperty("mapbox_line_metrics"))&&l.properties.mapbox_line_metrics;this.zOffsetValue=k.get("line-z-offset").value;const Q=this.layers[0].paint.get("line-width").value;if(Q.kind!=="constant"&&Q.isLineProgressConstant===!1&&(this.variableWidthValue=Q),this.elevationType==="road"){const it=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(l,h,_,L,F,V,U,Z)){const[at,dt]=this.clipRuntimeLinesToTile(h,1);for(let mt=0;mt<at.length;mt++){const _t=at[mt],Dt=dt[mt],At={progress:{min:Dt.progress.min,max:Dt.progress.max},nextDir:this.computeSegNextDir(Dt,_t),prevDir:this.computeSegPrevDir(Dt,_t)};this.addLine(_t,l,_,F,V,U,Z,At,q&&Dt.parentIndex>0?Dt.parentIndex:null)}this.fillNonElevatedRoadSegment(it)}}else for(let it=0;it<h.length;it++)this.addLine(h[it],l,_,F,V,U,Z,void 0,q&&it>0?it:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,S,T,_,M,void 0,this.worldview)}computeSegNextDir(l,h){return l.nextPoint.sub(h.at(-2)).unit()}computeSegPrevDir(l,h){return h[1].sub(l.prevPoint).unit()}clipLinesToTile(l,h){return n2(l,-h,-h,Ne+h,Ne+h)}clipRuntimeLinesToTile(l,h){const m=[];return[n2(l,-h,-h,Ne+h,Ne+h,m),m]}addElevatedRoadFeature(l,h,m,_,S,T,M,L){const k=[],F=Hi.getElevationFeature(l,_);if(F){const V=this.clipLinesToTile(h,1),U=this.prepareElevatedLines(V,F,m);for(const Z of U)k.push({geometry:Z,elevation:F,elevationTileID:m,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(k.length===0)return!1;for(const V of k){const U=this.layoutVertexArray.length;this.addLine(V.geometry,l,m,S,T,M,L);const Z=new Dr(m,V.elevationTileID);if(V.elevation)for(let q=U;q<this.layoutVertexArray.length;q++){const Q=new Ce(this.layoutVertexArray.int16[6*q]>>1,this.layoutVertexArray.int16[6*q+1]>>1),it=Z.pointElevation(Q,V.elevation,.05);this.updateHeightRange(it),this.zOffsetVertexArray.emplaceBack(it,0,0)}else this.fillNonElevatedRoadSegment(U)}return!0}prepareElevatedLines(l,h,m){if(h.constantHeight!=null)return l;const _=[],S=1/Lt(m);for(const T of l)Bnt(T,new wn(h,S),0,_);return _}fillNonElevatedRoadSegment(l){for(let h=l;h<this.layoutVertexArray.length;h++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(l){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,l),this.heightRange.max=Math.max(this.heightRange.max,l)):this.heightRange={min:l,max:l}}addLine(l,h,m,_,S,T,M,L,k){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=k?this.lineFeatureClips(h,k):this.lineClips;const F=_==="none";this.patternJoinNone=this.hasPattern&&F,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const V=L&&L.progress.min>0,U=L&&L.progress.max<1;if(this.lineClips){let Ht={min:this.lineClips.start,max:this.lineClips.end},se=1;if(L){const ge=this.lineClips.end-this.lineClips.start;Ht=function(Se,ze,De){return{min:sn(Se.min,ze,De),max:sn(Se.max,ze,De)}}(L.progress,{min:0,max:1},Ht),ge>0&&(se=(Ht.max-Ht.min)/ge)}const Kt=+h.properties.mapbox_clip_feature_len,le=+h.properties.mapbox_clip_seg_len;if(Number.isNaN(Kt)||Number.isNaN(le)){for(let Se=0;Se<l.length-1;Se++)this.totalDistance+=l[Se].dist(l[Se+1]);const ge=this.totalDistance/(Ht.max-Ht.min);this.totalFeatureLength=Number.isFinite(ge)?ge:0,this.lineClips.start=Ht.min,this.lineClips.end=Ht.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Kt,this.distance=le*se,this.lineClips.start=Ht.min,this.lineClips.end=Ht.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Z=Sat[h.type]==="Polygon";let q=l.length;for(;q>=2&&l[q-1].equals(l[q-2]);)q--;let Q=0;for(;Q<q-1&&l[Q].equals(l[Q+1]);)Q++;if(q<(Z?3:2))return;_==="bevel"&&(T=1.05);const it=this.segments.prepareSegment(10*q,this.layoutVertexArray,this.indexArray);let at,dt,mt,_t,Dt,At,Ot,Nt;L&&L.prevDir&&(At=L.prevDir.perp()),L&&L.nextDir&&(Ot=L.nextDir.perp()),this.e1=this.e2=-1,Z&&(at=l[q-2],Dt=l[Q].sub(at)._unit()._perp());for(let Ht=Q;Ht<q;Ht++){if(mt=Ht===q-1?Z?l[Q+1]:void 0:l[Ht+1],mt&&l[Ht].equals(mt))continue;Dt&&(_t=Dt),at&&(dt=at),at=l[Ht],Nt=this.evaluateLineProgressFeatures(dt?dt.dist(at):0),Dt=mt?mt.sub(at)._unit()._perp():_t,_t=_t||Dt;const se=dt&&mt;let Kt=se?_:Z||F?"butt":S;const le=_t.x*Dt.x+_t.y*Dt.y;if(F){const re=function(Ie){if(Ie.patternJoinNone){const Re=Ie.segmentPoints.length/2,xe=Ie.lineSoFar-Ie.segmentStart;for(let oi=0;oi<Re;++oi){const ui=Ie.segmentPoints[2*oi+1],ri=Math.round(Ie.segmentPoints[2*oi])+.5+.25*ui;Ie.patternVertexArray.emplaceBack(ri,xe,Ie.segmentStart),Ie.patternVertexArray.emplaceBack(ri,xe,Ie.segmentStart)}Ie.segmentPoints.length=0}Ie.e1=Ie.e2=-1};if(se&&le<Aat){this.updateDistance(dt,at),this.addCurrentVertex(at,_t,1,1,it,Nt),re(this),this.addCurrentVertex(at,Dt,-1,-1,it,Nt);continue}if(dt){if(!mt){this.updateDistance(dt,at),this.addCurrentVertex(at,_t,1,1,it,Nt),re(this);continue}Kt="miter"}}let ge=_t.add(Dt);ge.x===0&&ge.y===0||ge._unit();const Se=ge.x*Dt.x+ge.y*Dt.y,ze=Se!==0?1/Se:1/0,De=2*Math.sqrt(2-2*Se),me=Se<Tat&&dt&&mt,Ee=_t.x*Dt.y-_t.y*Dt.x>0,ae=this.overscaling<=16?15*Ne/(512*this.overscaling):0;if(se&&Kt==="round"){if(ze<M)Kt="miter";else if(ze<=2){const re=iP(at,-10,Ne+10);Kt=this.elevationType==="offset"&&(re||this.hasCrossSlope)?"miter":"fakeround"}}if(Kt==="miter"&&ze>T&&(Kt="bevel"),Kt==="bevel"&&(ze>2&&(Kt="flipbevel"),ze<T&&(Kt="miter")),dt&&!(Kt==="miter"&&me)&&this.updateDistance(dt,at),Kt==="miter")if(me){const re=at.dist(dt);if(re>2*ae){const Re=at.sub(at.sub(dt)._mult(ae/re)._round());this.updateDistance(dt,Re),this.addCurrentVertex(Re,_t,0,0,it,Nt),dt=Re}this.updateDistance(dt,at),ge._mult(ze),this.addCurrentVertex(at,ge,0,0,it,Nt);const Ie=at.dist(mt);if(Ie>2*ae){const Re=at.add(mt.sub(at)._mult(ae/Ie)._round());this.updateDistance(at,Re),this.addCurrentVertex(Re,Dt,0,0,it,Nt),at=Re}}else ge._mult(ze),this.addCurrentVertex(at,ge,0,0,it,Nt);else if(Kt==="flipbevel"){if(ze>100)ge=Dt.mult(-1);else{const re=ze*_t.add(Dt).mag()/_t.sub(Dt).mag();ge._perp()._mult(re*(Ee?-1:1))}this.addCurrentVertex(at,ge,0,0,it,Nt),this.addCurrentVertex(at,ge.mult(-1),0,0,it,Nt)}else if(Kt==="bevel"||Kt==="fakeround"){Nt!=null&&dt&&this.addCurrentVertex(at,Ot||_t,-1,-1,it,Nt);const re=at.dist(dt)<=2*ae&&Kt!=="bevel",Ie=ge.mult(Ee?1:-1);Ie._mult(ze);const Re=Dt.mult(Ee?-1:1),xe=_t.mult(Ee?-1:1),oi=this.evaluateLineProgressFeatures(this.distance);if(Nt==null&&(this.addHalfVertex(at,Ie.x,Ie.y,!1,!Ee,0,it,oi),re||this.addHalfVertex(at,Ie.x+2*xe.x,Ie.y+2*xe.y,!1,Ee,0,it,oi)),Kt==="fakeround"){const ui=Math.round(180*De/Math.PI/20);this.addHalfVertex(at,xe.x,xe.y,!1,Ee,0,it,oi);for(let ri=0;ri<ui;ri++){let Xe=ri/ui;if(Xe!==.5){const Qe=Xe-.5;Xe+=Xe*Qe*(Xe-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*Qe*Qe+(.848013+le*(.215638*le-1.06021)))}const ji=Re.sub(xe)._mult(Xe)._add(xe)._unit();this.addHalfVertex(at,ji.x,ji.y,!1,Ee,0,it,oi)}this.addHalfVertex(at,Re.x,Re.y,!1,Ee,0,it,oi)}re||Nt!=null||this.addHalfVertex(at,Ie.x+2*Re.x,Ie.y+2*Re.y,!1,Ee,0,it,oi),Nt!=null&&mt&&this.addCurrentVertex(at,At||Dt,1,1,it,Nt)}else if(Kt==="butt")this.addCurrentVertex(at,ge,0,0,it,Nt);else if(Kt==="square"){if(!dt){const re=V?0:-1;this.addCurrentVertex(at,ge,re,re,it,Nt)}if(this.addCurrentVertex(at,ge,0,0,it,Nt),dt){const re=U?0:1;this.addCurrentVertex(at,ge,re,re,it,Nt)}}else if(Kt==="round"){if(dt){const re=!se&&Ot?Ot:_t;this.addCurrentVertex(at,re,0,0,it,Nt),!se&&U||this.addCurrentVertex(at,re,1,1,it,Nt,!0)}if(mt){const re=!se&&At?At:Dt;!se&&V||this.addCurrentVertex(at,re,-1,-1,it,Nt,!0),this.addCurrentVertex(at,re,0,0,it,Nt)}}}}addVerticesTo(l,h,m,_,S,T,M,L,k,F){const V=(h.w-l.w)/this.tessellationStep|0;let U=0;const Z=this.scaledDistance;if(V>1){this.lineSoFar=l.w;const Q=(h.x-l.x)/V,it=(h.y-l.y)/V,at=(h.z-l.z)/V,dt=(h.w-l.w)/V;for(let mt=1;mt<V;++mt){l.x+=Q,l.y+=it,l.z+=at,this.lineSoFar+=dt,U+=dt;const _t=this.evaluateLineProgressFeatures(this.prevDistance+U);this.scaledDistance=(this.prevDistance+U)/this.totalDistance,this.addHalfVertex(l,m,_,F,!1,M,k,_t),this.addHalfVertex(l,S,T,F,!0,-L,k,_t)}}this.lineSoFar=h.w,this.scaledDistance=Z;const q=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(h,m,_,F,!1,M,k,q),this.addHalfVertex(h,S,T,F,!0,-L,k,q)}evaluateLineProgressFeatures(l){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+l)/this.totalFeatureLength):Mi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let h=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(h=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:h}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:h}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:h}}addCurrentVertex(l,h,m,_,S,T,M=!1){const L=h.x+h.y*m,k=h.y-h.x*m,F=h.y*_-h.x,V=-h.y-h.x*_;if(T!=null){const U=this.elevationType==="offset",Z=-10,q=Ne+10,Q=T.zOffset,it=new G5(l.x,l.y,Q,this.lineSoFar),at=!!U&&iP(l,Z,q),dt=this.lineSoFar,mt=this.distance;if(this.currentVertex)if(at){const _t=this.currentVertexIsOutside,Dt=this.currentVertex,At=new G5(l.x,l.y,Q,this.lineSoFar);if(j5(Dt,At,Z,q),!iP(At,Z,q)){if(_t){this.e1=this.e2=-1,this.distance-=Dt.dist(it),this.lineSoFar=Dt.w;const Ot=this.evaluateLineProgressFeatures(Dt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Dt,L,k,M,!1,m,S,Ot),this.addHalfVertex(Dt,F,V,M,!0,-_,S,Ot),this.prevDistance=this.distance}this.distance=this.prevDistance+Dt.dist(At),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Dt,At,L,k,F,V,m,_,S,M),this.distance=mt,this.scaledDistance=this.distance/this.totalDistance}}else{const _t=this.currentVertex;if(this.currentVertexIsOutside){j5(_t,it,Z,q),this.e1=this.e2=-1,this.distance-=_t.dist(it),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=_t.w;const Dt=this.evaluateLineProgressFeatures(_t.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_t,L,k,M,!1,m,S,Dt),this.addHalfVertex(_t,F,V,M,!0,-_,S,Dt),this.prevDistance=this.distance,this.distance=mt,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(_t,it,L,k,F,V,m,_,S,M)}else at||(this.addHalfVertex(l,L,k,M,!1,m,S,T),this.addHalfVertex(l,F,V,M,!0,-_,S,T));this.currentVertex=it,this.currentVertexIsOutside=at,this.lineSoFar=dt}else this.addHalfVertex(l,L,k,M,!1,m,S,T),this.addHalfVertex(l,F,V,M,!0,-_,S,T)}addHalfVertex({x:l,y:h},m,_,S,T,M,L,k){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),T||this.segmentPoints.push(this.lineSoFar-this.segmentStart,M)),this.layoutVertexArray.emplaceBack((l<<1)+(S?1:0),(h<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*_)+128,1+(M===0?0:M<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const V=zi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,V)}const F=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),L.primitiveLength++),T?this.e2=F:this.e1=F,k!=null&&this.zOffsetVertexArray.emplaceBack(k.zOffset,k.variableWidth,k.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(l,h){this.prevDistance=this.distance,this.distance+=l.dist(h),this.updateScaledDistance()}}function iP(d,l,h){return d.x<l||d.x>h||d.y<l||d.y>h}let wV,SV;function TV(d,l,h){return l*(Ne/(d.tileSize*Math.pow(2,h-d.tileID.overscaledZ)))}si(eP,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const AV=(d,l,h)=>(1-h)*d+h*l;function IV(d,l){return 1/TV(d,1,l.tileZoom)}function MV(d,l,h,m){return d.translatePosMatrix(m||l.tileID.projMatrix,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const CV=d=>{const l=[];EV(d)&&l.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&l.push("RENDER_LINE_GRADIENT");const h=d.paint.get("line-trim-offset");h[0]===0&&h[1]===0||l.push("RENDER_LINE_TRIM_OFFSET"),d.paint.get("line-border-width").constantOr(1)!==0&&l.push("RENDER_LINE_BORDER");const m=d.layout.get("line-join").constantOr("miter")==="none",_=!!d.paint.get("line-pattern").constantOr(1);return m&&_&&l.push("LINE_JOIN_NONE"),l};function EV(d){const l=d.paint.get("line-dasharray").value;return l.kind!=="constant"||l.value}let rP;const DV=()=>rP||(rP={layout:wV||(wV=new Yn({"line-cap":new ei(Yt.layout_line["line-cap"]),"line-join":new ei(Yt.layout_line["line-join"]),"line-miter-limit":new Pe(Yt.layout_line["line-miter-limit"]),"line-round-limit":new Pe(Yt.layout_line["line-round-limit"]),"line-sort-key":new ei(Yt.layout_line["line-sort-key"]),"line-z-offset":new ei(Yt.layout_line["line-z-offset"]),"line-elevation-reference":new Pe(Yt.layout_line["line-elevation-reference"]),"line-cross-slope":new Pe(Yt.layout_line["line-cross-slope"]),visibility:new Pe(Yt.layout_line.visibility),"line-width-unit":new Pe(Yt.layout_line["line-width-unit"])})),paint:SV||(SV=new Yn({"line-opacity":new ei(Yt.paint_line["line-opacity"]),"line-color":new ei(Yt.paint_line["line-color"]),"line-translate":new Pe(Yt.paint_line["line-translate"]),"line-translate-anchor":new Pe(Yt.paint_line["line-translate-anchor"]),"line-width":new ei(Yt.paint_line["line-width"]),"line-gap-width":new ei(Yt.paint_line["line-gap-width"]),"line-offset":new ei(Yt.paint_line["line-offset"]),"line-blur":new ei(Yt.paint_line["line-blur"]),"line-dasharray":new ei(Yt.paint_line["line-dasharray"]),"line-pattern":new ei(Yt.paint_line["line-pattern"]),"line-pattern-cross-fade":new Pe(Yt.paint_line["line-pattern-cross-fade"]),"line-gradient":new pf(Yt.paint_line["line-gradient"]),"line-trim-offset":new Pe(Yt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pe(Yt.paint_line["line-trim-fade-range"]),"line-trim-color":new Pe(Yt.paint_line["line-trim-color"]),"line-emissive-strength":new Pe(Yt.paint_line["line-emissive-strength"]),"line-border-width":new ei(Yt.paint_line["line-border-width"]),"line-border-color":new ei(Yt.paint_line["line-border-color"]),"line-occlusion-opacity":new Pe(Yt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},rP);class Iat extends ei{possiblyEvaluate(l,h){return h=new xn(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,transition:h.transition,worldview:h.worldview}),super.possiblyEvaluate(l,h)}evaluate(l,h,m,_){return h=Object.assign({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(l,h,m,_)}}let O1;function PV(d,l){return l>0?l+2*d:d}const Mat=gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cat=gr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Eat=gr([{name:"a_projected_pos",components:4,type:"Float32"}],4);gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dat=gr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Pat=gr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Lat=gr([{name:"a_texb",components:2,type:"Uint16"}]),Rat=gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),kat=gr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const LV=gr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Oat=gr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gr([{name:"triangle",components:3,type:"Uint16"}]),gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),gr([{type:"Float32",name:"offsetX"}]),gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ro=24;function zat(d,l,h){return d.sections.forEach(m=>{m.text=function(_,S,T){const M=S.layout.get("text-transform").evaluate(T,{});return M==="uppercase"?_=_.toLocaleUpperCase():M==="lowercase"&&(_=_.toLocaleLowerCase()),As.applyArabicShaping&&(_=As.applyArabicShaping(_)),_}(m.text,l,h)}),d}const z1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Bat(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}function Fat(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}const nP=4294967296,RV=1/nP,kV=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let g2=class{constructor(d=new Uint8Array(16)){this.buf=ArrayBuffer.isView(d)?d:new Uint8Array(d),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(d,l,h=this.length){for(;this.pos<h;){const m=this.readVarint(),_=m>>3,S=this.pos;this.type=7&m,d(_,l,this),this.pos===S&&this.skip(m)}return l}readMessage(d,l){return this.readFields(d,l,this.readVarint()+this.pos)}readFixed32(){const d=this.dataView.getUint32(this.pos,!0);return this.pos+=4,d}readSFixed32(){const d=this.dataView.getInt32(this.pos,!0);return this.pos+=4,d}readFixed64(){const d=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*nP;return this.pos+=8,d}readSFixed64(){const d=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*nP;return this.pos+=8,d}readFloat(){const d=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,d}readDouble(){const d=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,d}readVarint(d){const l=this.buf;let h,m;return m=l[this.pos++],h=127&m,m<128?h:(m=l[this.pos++],h|=(127&m)<<7,m<128?h:(m=l[this.pos++],h|=(127&m)<<14,m<128?h:(m=l[this.pos++],h|=(127&m)<<21,m<128?h:(m=l[this.pos],h|=(15&m)<<28,function(_,S,T){const M=T.buf;let L,k;if(k=M[T.pos++],L=(112&k)>>4,k<128||(k=M[T.pos++],L|=(127&k)<<3,k<128)||(k=M[T.pos++],L|=(127&k)<<10,k<128)||(k=M[T.pos++],L|=(127&k)<<17,k<128)||(k=M[T.pos++],L|=(127&k)<<24,k<128)||(k=M[T.pos++],L|=(1&k)<<31,k<128))return Z_(_,L,S);throw new Error("Expected varint not more than 10 bytes")}(h,d,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const d=this.readVarint();return d%2==1?(d+1)/-2:d/2}readBoolean(){return!!this.readVarint()}readString(){const d=this.readVarint()+this.pos,l=this.pos;return this.pos=d,d-l>=12&&kV?kV.decode(this.buf.subarray(l,d)):function(h,m,_){let S="",T=m;for(;T<_;){const M=h[T];let L,k,F,V=null,U=M>239?4:M>223?3:M>191?2:1;if(T+U>_)break;U===1?M<128&&(V=M):U===2?(L=h[T+1],(192&L)==128&&(V=(31&M)<<6|63&L,V<=127&&(V=null))):U===3?(L=h[T+1],k=h[T+2],(192&L)==128&&(192&k)==128&&(V=(15&M)<<12|(63&L)<<6|63&k,(V<=2047||V>=55296&&V<=57343)&&(V=null))):U===4&&(L=h[T+1],k=h[T+2],F=h[T+3],(192&L)==128&&(192&k)==128&&(192&F)==128&&(V=(15&M)<<18|(63&L)<<12|(63&k)<<6|63&F,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,U=1):V>65535&&(V-=65536,S+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),S+=String.fromCharCode(V),T+=U}return S}(this.buf,l,d)}readBytes(){const d=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,d);return this.pos=d,l}readPackedVarint(d=[],l){const h=this.readPackedEnd();for(;this.pos<h;)d.push(this.readVarint(l));return d}readPackedSVarint(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readSVarint());return d}readPackedBoolean(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readBoolean());return d}readPackedFloat(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readFloat());return d}readPackedDouble(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readDouble());return d}readPackedFixed32(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readFixed32());return d}readPackedSFixed32(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readSFixed32());return d}readPackedFixed64(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readFixed64());return d}readPackedSFixed64(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readSFixed64());return d}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(d){const l=7&d;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(d,l){this.writeVarint(d<<3|l)}realloc(d){let l=this.length||16;for(;l<this.pos+d;)l*=2;if(l!==this.length){const h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(d){this.realloc(4),this.dataView.setInt32(this.pos,d,!0),this.pos+=4}writeSFixed32(d){this.realloc(4),this.dataView.setInt32(this.pos,d,!0),this.pos+=4}writeFixed64(d){this.realloc(8),this.dataView.setInt32(this.pos,-1&d,!0),this.dataView.setInt32(this.pos+4,Math.floor(d*RV),!0),this.pos+=8}writeSFixed64(d){this.realloc(8),this.dataView.setInt32(this.pos,-1&d,!0),this.dataView.setInt32(this.pos+4,Math.floor(d*RV),!0),this.pos+=8}writeVarint(d){(d=+d||0)>268435455||d<0?function(l,h){let m,_;if(l>=0?(m=l%4294967296|0,_=l/4294967296|0):(m=~(-l%4294967296),_=~(-l/4294967296),4294967295^m?m=m+1|0:(m=0,_=_+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,T,M){M.buf[M.pos++]=127&S|128,S>>>=7,M.buf[M.pos++]=127&S|128,S>>>=7,M.buf[M.pos++]=127&S|128,S>>>=7,M.buf[M.pos++]=127&S|128,M.buf[M.pos]=127&(S>>>=7)}(m,0,h),function(S,T){const M=(7&S)<<4;T.buf[T.pos++]|=M|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(_,h)}(d,this):(this.realloc(4),this.buf[this.pos++]=127&d|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=d>>>7&127))))}writeSVarint(d){this.writeVarint(d<0?2*-d-1:2*d)}writeBoolean(d){this.writeVarint(+d)}writeString(d){d=String(d),this.realloc(4*d.length),this.pos++;const l=this.pos;this.pos=function(m,_,S){for(let T,M,L=0;L<_.length;L++){if(T=_.charCodeAt(L),T>55295&&T<57344){if(!M){T>56319||L+1===_.length?(m[S++]=239,m[S++]=191,m[S++]=189):M=T;continue}if(T<56320){m[S++]=239,m[S++]=191,m[S++]=189,M=T;continue}T=M-55296<<10|T-56320|65536,M=null}else M&&(m[S++]=239,m[S++]=191,m[S++]=189,M=null);T<128?m[S++]=T:(T<2048?m[S++]=T>>6|192:(T<65536?m[S++]=T>>12|224:(m[S++]=T>>18|240,m[S++]=T>>12&63|128),m[S++]=T>>6&63|128),m[S++]=63&T|128)}return S}(this.buf,d,this.pos);const h=this.pos-l;h>=128&&OV(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeFloat(d){this.realloc(4),this.dataView.setFloat32(this.pos,d,!0),this.pos+=4}writeDouble(d){this.realloc(8),this.dataView.setFloat64(this.pos,d,!0),this.pos+=8}writeBytes(d){const l=d.length;this.writeVarint(l),this.realloc(l);for(let h=0;h<l;h++)this.buf[this.pos++]=d[h]}writeRawMessage(d,l){this.pos++;const h=this.pos;d(l,this);const m=this.pos-h;m>=128&&OV(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m}writeMessage(d,l,h){this.writeTag(d,2),this.writeRawMessage(l,h)}writePackedVarint(d,l){l.length&&this.writeMessage(d,Nat,l)}writePackedSVarint(d,l){l.length&&this.writeMessage(d,Vat,l)}writePackedBoolean(d,l){l.length&&this.writeMessage(d,Hat,l)}writePackedFloat(d,l){l.length&&this.writeMessage(d,Uat,l)}writePackedDouble(d,l){l.length&&this.writeMessage(d,Gat,l)}writePackedFixed32(d,l){l.length&&this.writeMessage(d,jat,l)}writePackedSFixed32(d,l){l.length&&this.writeMessage(d,Wat,l)}writePackedFixed64(d,l){l.length&&this.writeMessage(d,$at,l)}writePackedSFixed64(d,l){l.length&&this.writeMessage(d,Zat,l)}writeBytesField(d,l){this.writeTag(d,2),this.writeBytes(l)}writeFixed32Field(d,l){this.writeTag(d,5),this.writeFixed32(l)}writeSFixed32Field(d,l){this.writeTag(d,5),this.writeSFixed32(l)}writeFixed64Field(d,l){this.writeTag(d,1),this.writeFixed64(l)}writeSFixed64Field(d,l){this.writeTag(d,1),this.writeSFixed64(l)}writeVarintField(d,l){this.writeTag(d,0),this.writeVarint(l)}writeSVarintField(d,l){this.writeTag(d,0),this.writeSVarint(l)}writeStringField(d,l){this.writeTag(d,2),this.writeString(l)}writeFloatField(d,l){this.writeTag(d,5),this.writeFloat(l)}writeDoubleField(d,l){this.writeTag(d,1),this.writeDouble(l)}writeBooleanField(d,l){this.writeVarintField(d,+l)}};function Z_(d,l,h){return h?4294967296*l+(d>>>0):4294967296*(l>>>0)+(d>>>0)}function OV(d,l,h){const m=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));h.realloc(m);for(let _=h.pos-1;_>=d;_--)h.buf[_+m]=h.buf[_]}function Nat(d,l){for(let h=0;h<d.length;h++)l.writeVarint(d[h])}function Vat(d,l){for(let h=0;h<d.length;h++)l.writeSVarint(d[h])}function Uat(d,l){for(let h=0;h<d.length;h++)l.writeFloat(d[h])}function Gat(d,l){for(let h=0;h<d.length;h++)l.writeDouble(d[h])}function Hat(d,l){for(let h=0;h<d.length;h++)l.writeBoolean(d[h])}function jat(d,l){for(let h=0;h<d.length;h++)l.writeFixed32(d[h])}function Wat(d,l){for(let h=0;h<d.length;h++)l.writeSFixed32(d[h])}function $at(d,l){for(let h=0;h<d.length;h++)l.writeFixed64(d[h])}function Zat(d,l){for(let h=0;h<d.length;h++)l.writeSFixed64(d[h])}const aP=3;function qat(d,l,h){l.glyphs=[],d===1&&h.readMessage(Xat,l)}function Xat(d,l,h){if(d===3){const{id:m,bitmap:_,width:S,height:T,left:M,top:L,advance:k}=h.readMessage(Yat,{});l.glyphs.push({id:m,bitmap:new Df({width:S+2*aP,height:T+2*aP},_),metrics:{width:S,height:T,left:M,top:L,advance:k}})}else d===4?l.ascender=h.readSVarint():d===5&&(l.descender=h.readSVarint())}function Yat(d,l,h){d===1?l.id=h.readVarint():d===2?l.bitmap=h.readBytes():d===3?l.width=h.readVarint():d===4?l.height=h.readVarint():d===5?l.left=h.readSVarint():d===6?l.top=h.readSVarint():d===7&&(l.advance=h.readVarint())}const zV=aP,el={horizontal:1,vertical:2,horizontalOnly:3};class B1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(l,h){const m=new B1;return m.scale=l||1,m.fontStack=h,m}static forImage(l){const h=new B1;return h.image=l,h}}class q_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,h,m){const _=new q_;for(let S=0;S<l.sections.length;S++){const T=l.sections[S];T.image?_.addImageSection(T,m):_.addTextSection(T,h)}return _}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSections(){return this.sections}getSectionIndex(l){return this.sectionIndex[l]}getCodePoint(l){return this.text.codePointAt(l)}verticalizePunctuation(l){this.text=function(h,m){let _="";for(let S=0;S<h.length;S++){const T=h.charCodeAt(S+1)||null,M=h.charCodeAt(S-1)||null;_+=!m&&(T&&Ux(T)&&!z1[h[S+1]]||M&&Ux(M)&&!z1[h[S-1]])||!z1[h[S]]?h[S]:z1[h[S]]}return _}(this.text,l)}trim(){let l=0;for(let m=0;m<this.text.length&&m2[this.text.charCodeAt(m)];m++)l++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=l&&m2[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(l,h),this.sectionIndex=this.sectionIndex.slice(l,h)}substring(l,h){const m=new q_;return m.text=this.text.substring(l,h),m.sectionIndex=this.sectionIndex.slice(l,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,h)=>Math.max(l,this.sections[h].scale),0)}addTextSection(l,h){this.text+=l.text,this.sections.push(B1.forText(l.scale,l.fontStack||h));const m=this.sections.length-1;for(let _=0;_<l.text.length;++_)this.sectionIndex.push(m)}addImageSection(l,h){const m=l.image?l.image.getPrimary():null;if(!m)return void Mi("Can't add FormattedSection with an empty image.");m.scaleSelf(h);const _=this.getNextImageSectionCharCode();_?(this.text+=String.fromCodePoint(_),this.sections.push(B1.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function oP(d,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q=1){const it=q_.fromFeature(d,_,Q);V===el.vertical&&it.verticalizePunctuation(U);let at=[];const dt=function(Ot,Nt,Ht,se,Kt,le){if(!Ot)return[];const ge=[],Se=function(Ee,ae,re,Ie,Re,xe){let oi=0;for(let ui=0;ui<Ee.length();ui++){const ri=Ee.getSection(ui);oi+=BV(Ee.getCodePoint(ui),ri,Ie,Re,ae,xe)}return oi/Math.max(1,Math.ceil(oi/re))}(Ot,Nt,Ht,se,Kt,le),ze=Ot.text.indexOf("")>=0;let De=0;for(let Ee=0;Ee<Ot.length();Ee++){const ae=Ot.getSection(Ee),re=Ot.getCodePoint(Ee);if(m2[re]||(De+=BV(re,ae,se,Kt,Nt,le)),Ee<Ot.length()-1){const Ie=!((me=re)<11904||!(Ci["Bopomofo Extended"](me)||Ci.Bopomofo(me)||Ci["CJK Compatibility Forms"](me)||Ci["CJK Compatibility Ideographs"](me)||Ci["CJK Compatibility"](me)||Ci["CJK Radicals Supplement"](me)||Ci["CJK Strokes"](me)||Ci["CJK Symbols and Punctuation"](me)||Ci["CJK Unified Ideographs Extension A"](me)||Ci["CJK Unified Ideographs"](me)||Ci["Enclosed CJK Letters and Months"](me)||Ci["Halfwidth and Fullwidth Forms"](me)||Ci.Hiragana(me)||Ci["Ideographic Description Characters"](me)||Ci["Kangxi Radicals"](me)||Ci["Katakana Phonetic Extensions"](me)||Ci.Katakana(me)||Ci["Vertical Forms"](me)||Ci["Yi Radicals"](me)||Ci["Yi Syllables"](me)));(Kat[re]||Ie||ae.image)&&ge.push(NV(Ee+1,De,Se,ge,Jat(re,Ot.getCodePoint(Ee+1),Ie&&ze),!1))}}var me;return VV(NV(Ot.length(),De,Se,ge,0,!0))}(it,k,S,l,m,Z),{processBidirectionalText:mt,processStyledBidirectionalText:_t}=As;if(mt&&it.sections.length===1){const Ot=mt(it.toString(),dt);for(const Nt of Ot){const Ht=new q_;Ht.text=Nt,Ht.sections=it.sections;for(let se=0;se<Nt.length;se++)Ht.sectionIndex.push(0);at.push(Ht)}}else if(_t){const Ot=_t(it.text,it.sectionIndex,dt);for(const Nt of Ot){const Ht=new q_;Ht.text=Nt[0],Ht.sectionIndex=Nt[1],Ht.sections=it.sections,at.push(Ht)}}else at=function(Ot,Nt){const Ht=[],se=Ot.text;let Kt=0;for(const le of Nt)Ht.push(Ot.substring(Kt,le)),Kt=le;return Kt<se.length&&Ht.push(Ot.substring(Kt,se.length)),Ht}(it,dt);const Dt=[],At={positionedLines:Dt,text:it.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ot,Nt,Ht,se,Kt,le,ge,Se,ze,De,me,Ee){let ae=0,re=0,Ie=0;const Re=Se==="right"?1:Se==="left"?0:.5;let xe=!1;for(const Qe of Kt){const Ii=Qe.getSections();for(const Zi of Ii){if(Zi.image)continue;const fr=Nt[Zi.fontStack];if(fr&&(xe=fr.ascender!==void 0&&fr.descender!==void 0,!xe))break}if(!xe)break}let oi=0;for(const Qe of Kt){Qe.trim();const Ii=Qe.getMaxScale(),Zi=(Ii-1)*ro,fr={positionedGlyphs:[],lineOffset:0};Ot.positionedLines[oi]=fr;const Pr=fr.positionedGlyphs;let qi=0;if(!Qe.length()){re+=le,++oi;continue}let Br=0,Fr=0;for(let It=0;It<Qe.length();It++){const wt=Qe.getSection(It),ce=Qe.getSectionIndex(It),je=Qe.getCodePoint(It);let ue=wt.scale,Je=null,vi=null,gi=null,Ji=ro,Ri=0,di=ze;di===el.vertical&&((ui=je)===12312||ui===12313||ui===12316||ui===12540||ui===12448)&&(di=el.horizontal);const zr=!(di===el.horizontal||!me&&!b_(je)||me&&(m2[je]||Gx(je)));if(wt.image){const ln=se.get(wt.image.toString());if(!ln)continue;gi=wt.image,Ot.iconsInText=Ot.iconsInText||!0,vi=ln.paddedRect;const Oi=ln.displaySize;ue=ue*ro/Ee,Je={width:Oi[0],height:Oi[1],left:0,top:-zV,advance:zr?Oi[1]:Oi[0],localGlyph:!1},Ri=xe?-Je.height*ue:Ii*ro-17-Oi[1]*ue,Ji=Je.advance;const Cr=(zr?Oi[0]:Oi[1])*ue-ro*Ii;Cr>0&&Cr>qi&&(qi=Cr)}else{const ln=Ht[wt.fontStack];if(!ln)continue;ln[je]&&(vi=ln[je]);const Oi=Nt[wt.fontStack];if(!Oi)continue;const Cr=Oi.glyphs[je];if(!Cr)continue;if(Je=Cr.metrics,Ji=je!==8203?ro:0,xe){const cn=Oi.ascender!==void 0?Math.abs(Oi.ascender):0,Yr=Oi.descender!==void 0?Math.abs(Oi.descender):0,Zn=(cn+Yr)*ue;Br<Zn&&(Br=Zn,Fr=(cn-Yr)/2*ue),Ri=-cn*ue}else Ri=(Ii-ue)*ro-17}zr?(Ot.verticalizable=!0,Pr.push({glyph:je,image:gi,x:ae,y:re+Ri,vertical:zr,scale:ue,localGlyph:Je.localGlyph,fontStack:wt.fontStack,sectionIndex:ce,metrics:Je,rect:vi}),ae+=Ji*ue+De):(Pr.push({glyph:je,image:gi,x:ae,y:re+Ri,vertical:zr,scale:ue,localGlyph:Je.localGlyph,fontStack:wt.fontStack,sectionIndex:ce,metrics:Je,rect:vi}),ae+=Je.advance*ue+De)}Pr.length!==0&&(Ie=Math.max(ae-De,Ie),xe?UV(Pr,Re,qi,Fr,le*Ii/2):UV(Pr,Re,qi,0,le/2)),ae=0;const Bn=le*Ii+qi;fr.lineOffset=Math.max(qi,Zi),re+=Bn,++oi}var ui;const ri=re,{horizontalAlign:Xe,verticalAlign:ji}=sP(ge);(function(Qe,Ii,Zi,fr,Pr,qi){const Br=(Ii-Zi)*Pr,Fr=-qi*fr;for(const Bn of Qe)for(const It of Bn.positionedGlyphs)It.x+=Br,It.y+=Fr})(Ot.positionedLines,Re,Xe,ji,Ie,ri),Ot.top+=-ji*ri,Ot.bottom=Ot.top+ri,Ot.left+=-Xe*Ie,Ot.right=Ot.left+Ie,Ot.hasBaseline=xe}(At,l,h,m,at,T,M,L,V,k,U,q),!function(Ot){for(const Nt of Ot)if(Nt.positionedGlyphs.length!==0)return!1;return!0}(Dt))return At}const m2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kat={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BV(d,l,h,m,_,S){if(l.image){const T=m.get(l.image.toString());return T?T.displaySize[0]*l.scale*ro/S+_:0}{const T=h[l.fontStack],M=T&&T.glyphs[d];return M?M.metrics.advance*l.scale+_:0}}function FV(d,l,h,m){const _=Math.pow(d-l,2);return m?d<l?_/2:2*_:_+Math.abs(h)*h}function Jat(d,l,h){let m=0;return d===10&&(m-=1e4),h&&(m+=150),d!==40&&d!==65288||(m+=50),l!==41&&l!==65289||(m+=50),m}function NV(d,l,h,m,_,S){let T=null,M=FV(l,h,_,S);for(const L of m){const k=FV(l-L.x,h,_,S)+L.badness;k<=M&&(T=L,M=k)}return{index:d,x:l,priorBreak:T,badness:M}}function VV(d){return d?VV(d.priorBreak).concat(d.index):[]}function sP(d){let l=.5,h=.5;switch(d){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:l,verticalAlign:h}}function UV(d,l,h,m,_){if(!(l||h||m||_))return;const S=d.length-1,T=d[S],M=(T.x+T.metrics.advance*T.scale)*l;for(let L=0;L<=S;L++)d[L].x-=M,d[L].y+=h+m+_}function GV(d){return d.imagePrimary!==void 0&&d.top!==void 0&&d.bottom!==void 0&&d.left!==void 0&&d.right!==void 0}function v2(d,l,h,m){const{horizontalAlign:_,verticalAlign:S}=sP(m),T=h[0]-d.displaySize[0]*_,M=h[1]-d.displaySize[1]*S;return{imagePrimary:d,imageSecondary:l,top:M,bottom:M+d.displaySize[1],left:T,right:T+d.displaySize[0]}}function lP(d,l,h,m,_,S){const T=d.imagePrimary;let M;if(T.content){const it=T.content,at=T.pixelRatio||1;M=[it[0]/at,it[1]/at,T.displaySize[0]-it[2]/at,T.displaySize[1]-it[3]/at]}const L=l.left*S,k=l.right*S;let F,V,U,Z;h==="width"||h==="both"?(Z=_[0]+L-m[3],V=_[0]+k+m[1]):(Z=_[0]+(L+k-T.displaySize[0])/2,V=Z+T.displaySize[0]);const q=l.top*S,Q=l.bottom*S;return h==="height"||h==="both"?(F=_[1]+q-m[0],U=_[1]+Q+m[2]):(F=_[1]+(q+Q-T.displaySize[1])/2,U=F+T.displaySize[1]),{imagePrimary:T,imageSecondary:void 0,top:F,right:V,bottom:U,left:Z,collisionPadding:M}}function HV(d){return!d.imagePrimary.stretchX}function jV(d){return!d.imagePrimary.stretchY}function WV(d){return{width:d.right-d.left,height:d.bottom-d.top}}const Jc=128;function X_(d,l,h){const{expression:m}=l;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new xn(d+1,{worldview:h}))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:_,interpolationType:S}=m;let T=0;for(;T<_.length&&_[T]<=d;)T++;T=Math.max(0,T-1);let M=T;for(;M<_.length&&_[M]<d+1;)M++;M=Math.min(_.length-1,M);const L=_[T],k=_[M];return m.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:k,interpolationType:S}:{kind:"camera",minZoom:L,maxZoom:k,minSize:m.evaluate(new xn(L,{worldview:h})),maxSize:m.evaluate(new xn(k,{worldview:h})),interpolationType:S}}}function cP(d,{uSize:l,uSizeT:h},{lowerSize:m,upperSize:_}){return d.kind==="source"?m/Jc:d.kind==="composite"?zi(m/Jc,_/Jc,h):l}function Y_(d,l,h=1){let m=0,_=0;if(d.kind==="constant")_=d.layoutSize*h;else if(d.kind!=="source"){const{interpolationType:S,minZoom:T,maxZoom:M}=d,L=S?ct($s.interpolationFactor(S,l,T,M),0,1):0;d.kind==="camera"?_=zi(d.minSize,d.maxSize,L)*h:m=L*h}return{uSizeT:m,uSize:_}}class Xh extends Ce{constructor(l,h,m,_,S){super(l,h),this.angle=_,this.z=m,S!==void 0&&(this.segment=S)}clone(){return new Xh(this.x,this.y,this.z,this.angle,this.segment)}}function $V(d,l,h,m,_){if(l.segment===void 0)return!0;let S=l,T=l.segment+1,M=0;for(;M>-h/2;){if(T--,T<0)return!1;M-=d[T].dist(S),S=d[T]}M+=d[T].dist(d[T+1]),T++;const L=[];let k=0;for(;M<h/2;){const F=d[T],V=d[T+1];if(!V)return!1;let U=d[T-1].angleTo(F)-F.angleTo(V);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:M,angleDelta:U}),k+=U;M-L[0].distance>m;)k-=L.shift().angleDelta;if(k>_)return!1;T++,M+=F.dist(V)}return!0}function ZV(d){let l=0;for(let h=0;h<d.length-1;h++)l+=d[h].dist(d[h+1]);return l}function qV(d,l,h){return d?.6*l*h:0}function XV(d,l){return Math.max(d?d.right-d.left:0,l?l.right-l.left:0)}function Qat(d,l,h,m,_,S){const T=qV(h,_,S),M=XV(h,m)*S;let L=0;const k=ZV(d)/2;for(let F=0;F<d.length-1;F++){const V=d[F],U=d[F+1],Z=V.dist(U);if(L+Z>k){const q=(k-L)/Z,Q=zi(V.x,U.x,q),it=zi(V.y,U.y,q),at=new Xh(Q,it,0,U.angleTo(V),F);return!T||$V(d,at,M,T,l)?at:void 0}L+=Z}}function tot(d,l,h,m,_,S,T,M,L){const k=qV(m,S,T),F=XV(m,_),V=F*T,U=d[0].x===0||d[0].x===L||d[0].y===0||d[0].y===L;return l-V<l/4&&(l=V+l/4),YV(d,U?l/2*M%l:(F/2+2*S)*T*M%l,l,k,h,V,U,!1,L)}function YV(d,l,h,m,_,S,T,M,L){const k=S/2,F=ZV(d);let V=0,U=l-h,Z=[];for(let q=0;q<d.length-1;q++){const Q=d[q],it=d[q+1],at=Q.dist(it),dt=it.angleTo(Q);for(;U+h<V+at;){U+=h;const mt=(U-V)/at,_t=zi(Q.x,it.x,mt),Dt=zi(Q.y,it.y,mt);if(_t>=0&&_t<L&&Dt>=0&&Dt<L&&U-k>=0&&U+k<=F){const At=new Xh(_t,Dt,0,dt,q);m&&!$V(d,At,S,m,_)||Z.push(At)}}V+=at}return M||Z.length||T||(Z=YV(d,V/2,h,m,_,S,T,!0,L)),Z}function KV(d){let l=0,h=0;for(const T of d)l+=T.w*T.h,h=Math.max(h,T.w);d.sort((T,M)=>M.h-T.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),h),h:1/0}];let _=0,S=0;for(const T of d)for(let M=m.length-1;M>=0;M--){const L=m[M];if(!(T.w>L.w||T.h>L.h)){if(T.x=L.x,T.y=L.y,S=Math.max(S,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===L.w&&T.h===L.h){const k=m.pop();k&&M<m.length&&(m[M]=k)}else T.h===L.h?(L.x+=T.w,L.w-=T.w):T.w===L.w?(L.y+=T.h,L.h-=T.h):(m.push({x:L.x+T.w,y:L.y,w:L.w-T.w,h:T.h}),L.y+=T.h,L.h-=T.h);break}}return{w:_,h:S,fill:l/(_*S)||0}}si(Xh,"Anchor");const Hg=1;class F1{static getImagePositionScale(l,h,m){if(h&&l&&l.options&&l.options.transform){const _=l.options.transform;return{x:_.a,y:_.d}}return{x:m,y:m}}constructor(l,h,m,_){this.paddedRect=l;const{pixelRatio:S,version:T,stretchX:M,stretchY:L,content:k,sdf:F,usvg:V}=h;this.pixelRatio=S,this.stretchX=M,this.stretchY=L,this.content=k,this.version=T,this.padding=m,this.sdf=F,this.usvg=V,this.scale=F1.getImagePositionScale(_,V,S)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function uP(d,l,h){const m=Uc.parse(d),_=function(S,T,M=[1,1]){return{x:0,y:0,w:(S.data?S.data.width:S.width*M[0])+2*T,h:(S.data?S.data.height:S.height*M[1])+2*T}}(l,h,[m.options.transform.a,m.options.transform.d]);return{bin:_,imagePosition:new F1(_,l,h,m),imageVariant:m}}class JV{constructor(l,h,m){const _=new Map,S=new Map;this.haveRenderCallbacks=[];const T=[];this.addImages(l,_,Hg,T),this.addImages(h,S,2,T);const{w:M,h:L}=KV(T),k=new Mo({width:M||1,height:L||1});for(const[F,V]of l.entries()){const U=_.get(F).paddedRect;Mo.copy(V.data,k,{x:0,y:0},{x:U.x+Hg,y:U.y+Hg},V.data,null,V.sdf)}for(const[F,V]of h.entries()){const U=S.get(F),Z=U.paddedRect;let q=U.padding;const Q=Z.x+q,it=Z.y+q,at=V.data.width,dt=V.data.height;q=q>1?q-1:q,Mo.copy(V.data,k,{x:0,y:0},{x:Q,y:it},V.data,m),Mo.copy(V.data,k,{x:0,y:dt-q},{x:Q,y:it-q},{width:at,height:q},m),Mo.copy(V.data,k,{x:0,y:0},{x:Q,y:it+dt},{width:at,height:q},m),Mo.copy(V.data,k,{x:at-q,y:0},{x:Q-q,y:it},{width:q,height:dt},m),Mo.copy(V.data,k,{x:0,y:0},{x:Q+at,y:it},{width:q,height:dt},m),Mo.copy(V.data,k,{x:at-q,y:dt-q},{x:Q-q,y:it-q},{width:q,height:q},m),Mo.copy(V.data,k,{x:0,y:dt-q},{x:Q+at,y:it-q},{width:q,height:q},m),Mo.copy(V.data,k,{x:0,y:0},{x:Q+at,y:it+dt},{width:q,height:q},m),Mo.copy(V.data,k,{x:at-q,y:0},{x:Q-q,y:it+dt},{width:q,height:q},m)}this.lut=m,this.image=k,this.iconPositions=_,this.patternPositions=S}addImages(l,h,m,_){for(const[S,T]of l.entries()){const{bin:M,imagePosition:L,imageVariant:k}=uP(S,T,m);h.set(S,L),_.push(M),T.hasRenderCallback&&this.haveRenderCallbacks.push(k.id)}}patchUpdatedImages(l,h,m){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(_=>l.hasImage(_,m)),l.dispatchRenderCallbacks(this.haveRenderCallbacks,m);for(const _ of l.getUpdatedImages(m)){for(const S of this.iconPositions.keys()){const T=Uc.parse(S);if(Ba.isEqual(T.id,_)){const M=l.getImage(_,m);this.patchUpdatedImage(this.iconPositions.get(S),M,h,null)}}for(const S of this.patternPositions.keys()){const T=Uc.parse(S);if(Ba.isEqual(T.id,_)){const M=l.getImage(_,m);this.patchUpdatedImage(this.patternPositions.get(S),M,h,this.lut)}}}}patchUpdatedImage(l,h,m,_=null){if(!l||!h||l.version===h.version)return;l.version=h.version;const[S,T]=l.tl,M=l.sdf;if(this.lut||M){const L={width:h.data.width,height:h.data.height},k=new Mo(L);Mo.copy(h.data,k,{x:0,y:0},{x:0,y:0},L,_,M),m.update(k,{position:{x:S,y:T}})}else m.update(h.data,{position:{x:S,y:T}})}}si(F1,"ImagePosition"),si(JV,"ImageAtlas");const N1=1e20;function QV(d,l,h,m,_,S,T,M,L){for(let k=l;k<l+m;k++)t4(d,h*S+k,S,_,T,M,L);for(let k=h;k<h+_;k++)t4(d,k*S+l,1,m,T,M,L)}function t4(d,l,h,m,_,S,T){S[0]=0,T[0]=-N1,T[1]=N1,_[0]=d[l];for(let M=1,L=0,k=0;M<m;M++){_[M]=d[l+M*h];const F=M*M;do{const V=S[L];k=(_[M]-_[V]+F-V*V)/(M-V)/2}while(k<=T[L]&&--L>-1);L++,S[L]=M,T[L]=k,T[L+1]=N1}for(let M=0,L=0;M<m;M++){for(;T[L+1]<M;)L++;const k=S[L],F=M-k;d[l+M*h]=_[k]+F*F}}const Qc=2,hP={none:0,ideographs:1,all:2};class K_{constructor(l,h,m){this.requestManager=l,this.localGlyphMode=h,this.localFontFamily=m,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(l){this.url=l}getGlyphs(l,h){const m=[],_=this.url||An.GLYPHS_URL;for(const S in l)for(const T of l[S])m.push({stack:S,id:T});Bt(m,({stack:S,id:T},M)=>{let L=this.entries[S];L||(L=this.entries[S]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=L.glyphs[T];if(k!==void 0)return void M(null,{stack:S,id:T,glyph:k});if(k=this._tinySDF(L,S,T),k)return L.glyphs[T]=k,void M(null,{stack:S,id:T,glyph:k});const F=Math.floor(T/256);if(256*F>65535)return Mi("glyphs > 65535 not supported"),void M(null,{stack:S,id:T,glyph:k});if(L.ranges[F])return void M(null,{stack:S,id:T,glyph:k});let V=L.requests[F];V||(V=L.requests[F]=[],K_.loadGlyphRange(S,F,_,this.requestManager,(U,Z)=>{if(Z){L.ascender=Z.ascender,L.descender=Z.descender;for(const q in Z.glyphs)this._doesCharSupportLocalGlyph(+q)||(L.glyphs[+q]=Z.glyphs[+q]);L.ranges[F]=!0}for(const q of V)q(U,Z);delete L.requests[F]})),V.push((U,Z)=>{U?M(U):Z&&M(null,{stack:S,id:T,glyph:Z.glyphs[T]||null})})},(S,T)=>{if(S)h(S);else if(T){const M={};for(const{stack:L,id:k,glyph:F}of T)M[L]===void 0&&(M[L]={}),M[L].glyphs===void 0&&(M[L].glyphs={}),M[L].glyphs[k]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},M[L].ascender=this.entries[L].ascender,M[L].descender=this.entries[L].descender;h(null,M)}})}_doesCharSupportLocalGlyph(l){return this.localGlyphMode!==hP.none&&(this.localGlyphMode===hP.all?!!this.localFontFamily:!!this.localFontFamily&&(Ci["CJK Unified Ideographs"](l)||Ci["Hangul Syllables"](l)||Ci.Hiragana(l)||Ci.Katakana(l)||Ci["CJK Symbols and Punctuation"](l)||Ci["CJK Unified Ideographs Extension A"](l)||Ci["CJK Unified Ideographs Extension B"](l)||Ci.Osage(l)))}_tinySDF(l,h,m){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(m))return;let S=l.tinySDF;if(!S){let Q="400";/bold/i.test(h)?Q="900":/medium/i.test(h)?Q="500":/light/i.test(h)&&(Q="200"),S=l.tinySDF=new K_.TinySDF({fontFamily:_,fontWeight:Q,fontSize:24*Qc,buffer:3*Qc,radius:8*Qc}),S.fontWeight=Q}if(this.localGlyphs[S.fontWeight][m])return this.localGlyphs[S.fontWeight][m];const T=String.fromCodePoint(m),{data:M,width:L,height:k,glyphWidth:F,glyphHeight:V,glyphLeft:U,glyphTop:Z,glyphAdvance:q}=S.draw(T);return this.localGlyphs[S.fontWeight][m]={id:m,bitmap:new Df({width:L,height:k},M),metrics:{width:F/Qc,height:V/Qc,left:U/Qc,top:Z/Qc-27,advance:q/Qc,localGlyph:!0}}}}K_.loadGlyphRange=function(d,l,h,m,_){const S=256*l,T=S+255,M=m.transformRequest(m.normalizeGlyphsURL(h).replace("{fontstack}",d).replace("{range}",`${S}-${T}`),Eh.Glyphs);Wd(M,(L,k)=>{if(L)_(L);else if(k){const F={},V=function(U){return new g2(U).readFields(qat,{})}(k);for(const U of V.glyphs)F[U.id]=U;_(null,{glyphs:F,ascender:V.ascender,descender:V.descender})}})},K_.TinySDF=class{constructor({fontSize:d=24,buffer:l=3,radius:h=8,cutoff:m=.25,fontFamily:_="sans-serif",fontWeight:S="normal",fontStyle:T="normal",lang:M=null}={}){this.buffer=l,this.cutoff=m,this.radius=h,this.lang=M;const L=this.size=d+4*l,k=this._createCanvas(L),F=this.ctx=k.getContext("2d",{willReadFrequently:!0});F.font=`${T} ${S} ${d}px ${_}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(d){const l=document.createElement("canvas");return l.width=l.height=d,l}draw(d){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:_,actualBoundingBoxRight:S}=this.ctx.measureText(d),T=Math.ceil(h),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-_))),L=Math.min(this.size-this.buffer,T+Math.ceil(m)),k=M+2*this.buffer,F=L+2*this.buffer,V=Math.max(k*F,0),U=new Uint8ClampedArray(V),Z={data:U,width:k,height:F,glyphWidth:M,glyphHeight:L,glyphTop:T,glyphLeft:0,glyphAdvance:l};if(M===0||L===0)return Z;const{ctx:q,buffer:Q,gridInner:it,gridOuter:at}=this;this.lang&&(q.lang=this.lang),q.clearRect(Q,Q,M,L),q.fillText(d,Q,Q+T);const dt=q.getImageData(Q,Q,M,L);at.fill(N1,0,V),it.fill(0,0,V);for(let mt=0;mt<L;mt++)for(let _t=0;_t<M;_t++){const Dt=dt.data[4*(mt*M+_t)+3]/255;if(Dt===0)continue;const At=(mt+Q)*k+_t+Q;if(Dt===1)at[At]=0,it[At]=N1;else{const Ot=.5-Dt;at[At]=Ot>0?Ot*Ot:0,it[At]=Ot<0?Ot*Ot:0}}QV(at,0,0,k,F,k,this.f,this.v,this.z),QV(it,Q,Q,M,L,k,this.f,this.v,this.z);for(let mt=0;mt<V;mt++){const _t=Math.sqrt(at[mt])-Math.sqrt(it[mt]);U[mt]=Math.round(255-255*(_t/this.radius+this.cutoff))}return Z}};const Fu=Hg;function e4(d,l){return d+l[1]-l[0]}function dP(d,l,h,m,_=1){const S=[],T=d.imagePrimary,M=T.pixelRatio,L=T.paddedRect.w-2*Fu,k=T.paddedRect.h-2*Fu,F=(d.right-d.left)*_,V=(d.bottom-d.top)*_,U=T.stretchX||[[0,L]],Z=T.stretchY||[[0,k]],q=U.reduce(e4,0),Q=Z.reduce(e4,0),it=L-q,at=k-Q;let dt=0,mt=q,_t=0,Dt=Q,At=0,Ot=it,Nt=0,Ht=at;if(T.content&&m){const Kt=T.content;dt=_2(U,0,Kt[0]),_t=_2(Z,0,Kt[1]),mt=_2(U,Kt[0],Kt[2]),Dt=_2(Z,Kt[1],Kt[3]),At=Kt[0]-dt,Nt=Kt[1]-_t,Ot=Kt[2]-Kt[0]-mt,Ht=Kt[3]-Kt[1]-Dt}const se=(Kt,le,ge,Se)=>{const ze=y2(Kt.stretch-dt,mt,F,d.left*_),De=x2(Kt.fixed-At,Ot,Kt.stretch,q),me=y2(le.stretch-_t,Dt,V,d.top*_),Ee=x2(le.fixed-Nt,Ht,le.stretch,Q),ae=y2(ge.stretch-dt,mt,F,d.left*_),re=x2(ge.fixed-At,Ot,ge.stretch,q),Ie=y2(Se.stretch-_t,Dt,V,d.top*_),Re=x2(Se.fixed-Nt,Ht,Se.stretch,Q),xe=new Ce(ze,me),oi=new Ce(ae,me),ui=new Ce(ae,Ie),ri=new Ce(ze,Ie),Xe=new Ce(De/M,Ee/M),ji=new Ce(re/M,Re/M),Qe=l*Math.PI/180;if(Qe){const Br=Math.sin(Qe),Fr=Math.cos(Qe),Bn=[Fr,-Br,Br,Fr];xe._matMult(Bn),oi._matMult(Bn),ri._matMult(Bn),ui._matMult(Bn)}const Ii=Kt.stretch+Kt.fixed,Zi=ge.stretch+ge.fixed,fr=le.stretch+le.fixed,Pr=Se.stretch+Se.fixed,qi=d.imageSecondary;return{tl:xe,tr:oi,bl:ri,br:ui,texPrimary:{x:T.paddedRect.x+Fu+Ii,y:T.paddedRect.y+Fu+fr,w:Zi-Ii,h:Pr-fr},texSecondary:qi?{x:qi.paddedRect.x+Fu+Ii,y:qi.paddedRect.y+Fu+fr,w:Zi-Ii,h:Pr-fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xe,pixelOffsetBR:ji,minFontScaleX:Ot/M/F,minFontScaleY:Ht/M/V,isSDF:h}};if(m&&(T.stretchX||T.stretchY)){const Kt=i4(U,it,q),le=i4(Z,at,Q);for(let ge=0;ge<Kt.length-1;ge++){const Se=Kt[ge],ze=Kt[ge+1];for(let De=0;De<le.length-1;De++)S.push(se(Se,le[De],ze,le[De+1]))}}else S.push(se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:k+1}));return S}function eot(d,l){const h=d.stretchY||[[0,d.paddedRect.h-2*Fu]];return l&&(d.stretchX||d.stretchY)?r4(d.stretchX||[[0,d.paddedRect.w-2*Fu]])*r4(h):1}function _2(d,l,h){let m=0;for(const _ of d)m+=Math.max(l,Math.min(h,_[1]))-Math.max(l,Math.min(h,_[0]));return m}function i4(d,l,h){const m=[{fixed:-Fu,stretch:0}];for(const[_,S]of d){const T=m[m.length-1];m.push({fixed:_-T.stretch,stretch:T.stretch}),m.push({fixed:_-T.stretch,stretch:T.stretch+(S-_)})}return m.push({fixed:l+Fu,stretch:h}),m}function r4(d){return 2*d.length+1}function y2(d,l,h,m){return d/l*h+m}function x2(d,l,h,m){return d-l*h/m}function iot(d,l,h,m){const _=l+d.positionedLines[m].lineOffset;return m===0?h+_/2:h+(_+(l+d.positionedLines[m-1].lineOffset))/2}function rot(d,l=1,h=!1){let m=1/0,_=1/0,S=-1/0,T=-1/0;const M=d[0];for(let Z=0;Z<M.length;Z++){const q=M[Z];(!Z||q.x<m)&&(m=q.x),(!Z||q.y<_)&&(_=q.y),(!Z||q.x>S)&&(S=q.x),(!Z||q.y>T)&&(T=q.y)}const L=Math.min(S-m,T-_);let k=L/2;const F=new Zv([],not);if(L===0)return new Ce(m,_);for(let Z=m;Z<S;Z+=L)for(let q=_;q<T;q+=L)F.push(new J_(Z+k,q+k,k,d));let V=function(Z){let q=0,Q=0,it=0;const at=Z[0];for(let dt=0,mt=at.length,_t=mt-1;dt<mt;_t=dt++){const Dt=at[dt],At=at[_t],Ot=Dt.x*At.y-At.x*Dt.y;Q+=(Dt.x+At.x)*Ot,it+=(Dt.y+At.y)*Ot,q+=3*Ot}return new J_(Q/q,it/q,0,Z)}(d),U=F.length;for(;F.length;){const Z=F.pop();(Z.d>V.d||!V.d)&&(V=Z,h&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,U)),Z.max-V.d<=l||(k=Z.h/2,F.push(new J_(Z.p.x-k,Z.p.y-k,k,d)),F.push(new J_(Z.p.x+k,Z.p.y-k,k,d)),F.push(new J_(Z.p.x-k,Z.p.y+k,k,d)),F.push(new J_(Z.p.x+k,Z.p.y+k,k,d)),U+=4)}return h&&(console.log(`num probes: ${U}`),console.log(`best distance: ${V.d}`)),V.p}function not(d,l){return l.max-d.max}class J_{constructor(l,h,m,_){this.p=new Ce(l,h),this.h=m,this.d=function(S,T){let M=!1,L=1/0;for(let k=0;k<T.length;k++){const F=T[k];for(let V=0,U=F.length,Z=U-1;V<U;Z=V++){const q=F[V],Q=F[Z];q.y>S.y!=Q.y>S.y&&S.x<(Q.x-q.x)*(S.y-q.y)/(Q.y-q.y)+q.x&&(M=!M),L=Math.min(L,Ys(S,q,Q))}}return(M?1:-1)*Math.sqrt(L)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const aot=Object.keys,fP=Number.POSITIVE_INFINITY,oot=Math.sqrt(2);function b2(d,l,h,m){const _=d.collisionPadding||[0,0,0,0],S={top:d.top-_[1],bottom:d.bottom+_[3],left:d.left-_[0],right:d.right+_[2],scaled:!1};return m!==void 0&&function(T,M){T.top*=M,T.bottom*=M,T.left*=M,T.right*=M,T.scaled=!0}(S,m),h&&function(T,M){if(!M)return;const L=wr(M),k=new Ce(T.left,T.top),F=new Ce(T.right,T.top),V=new Ce(T.left,T.bottom),U=new Ce(T.right,T.bottom);k._rotateAround(L,new Ce(0,0)),F._rotateAround(L,new Ce(0,0)),V._rotateAround(L,new Ce(0,0)),U._rotateAround(L,new Ce(0,0)),T.left=Math.min(k.x,F.x,V.x,U.x),T.right=Math.max(k.x,F.x,V.x,U.x),T.top=Math.min(k.y,F.y,V.y,U.y),T.bottom=Math.max(k.y,F.y,V.y,U.y)}(S,h),l?{top:Math.min(l.top,S.top),bottom:Math.max(l.bottom,S.bottom),left:Math.min(l.left,S.left),right:Math.max(l.right,S.right),scaled:l.scaled||S.scaled}:S}function n4(d,[l,h]){let m=0,_=0;if(h===fP){l<0&&(l=0);const S=l/oot;switch(d){case"top-right":case"top-left":_=S-7;break;case"bottom-right":case"bottom-left":_=7-S;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(d){case"top-right":case"bottom-right":m=-S;break;case"top-left":case"bottom-left":m=S;break;case"left":m=l;break;case"right":m=-l}}else{switch(l=Math.abs(l),h=Math.abs(h),d){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(d){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}}return[m,_]}function sot(d,l,h,m,_,S,T,M,L,k,F){const V=d.layers[0],U=V.appearances;if(U.length===0)return{iconBBox:null,iconVerticalBBox:null};let Z=null,q=null;const Q=m.get("icon-rotate").evaluate(_,{},S);l&&(Z=b2(l,Z,Q,T),h)&&(q=b2(h,q,Q+90,T));const[it,at]=m.get("icon-size-scale-range"),dt=ct(1,it,at);for(const mt of U){const _t=mt.getUnevaluatedProperties(),Dt=_t._values["icon-image"].value!==void 0,At=_t._values["icon-size"].value!==void 0,Ot=_t._values["icon-offset"].value!==void 0,Nt=_t._values["icon-rotate"].value!==void 0;if(Dt||At||Ot||Nt){const Ht=Ot?V.getAppearanceValueAndResolveTokens(mt,"icon-offset",_,S,[]):null,se=Ht&&Array.isArray(Ht)?Ht:M,Kt=Nt?V.getAppearanceValueAndResolveTokens(mt,"icon-rotate",_,S,[]):null,le=typeof Kt=="number"?Kt:Q,ge=At?V.getAppearanceValueAndResolveTokens(mt,"icon-size",_,S,[]):null,Se=typeof ge=="number"?ge*L.iconScaleFactor:T;let ze=null,De=null,me=null;if(Dt){const Ee=V.getAppearanceValueAndResolveTokens(mt,"icon-image",_,S,[]);if(Ee){const ae=d.getResolvedImageFromTokens(Ee),re=_t._values["icon-size"],Ie=V1(ae,X_(d.zoom,re,d.worldview),re,S,d.zoom,_,d.pixelRatio,dt,d.worldview);me=k.get(Ie.iconPrimary.toString())}}else l&&(me=l.imagePrimary);me&&(ze=v2(me,null,se,F),d.allowVerticalPlacement&&(De=v2(me,null,se,F))),ze&&(Z=b2(ze,Z,le,Se)),De&&(q=b2(De,q,le+90,Se))}}return{iconBBox:Z,iconVerticalBBox:q}}function w2(d,l,h,m,_,S,T,M,L){if(!l||!l.usvg)return;const k=WV(m),F=WV(_),V=S!=="both"&&S!=="width"||!HV(m)?1:F.width/k.width,U=S!=="both"&&S!=="height"||!jV(m)?1:F.height/k.height;h.scaleSelf(V,U);const Z=h.toString();T.set(Z,h),M.set(Z,l);const{imagePosition:q}=uP(Z,l,Hg);L.set(Z,q)}function a4(d,l,h,m,_,S,T,M,L){if(!d)return;const k=function(F,V,U,Z,q,Q){if(F.kind==="camera")return F.maxSize;if(F.kind==="composite"){const it=V.possiblyEvaluate(new xn(F.maxZoom,{worldview:Q}),U).evaluate(q,{},U),at=V.possiblyEvaluate(new xn(F.minZoom,{worldview:Q}),U).evaluate(q,{},U);return Math.max(it,at)}return V.possiblyEvaluate(new xn(Z,{worldview:Q})).evaluate(q,{},U)}(l,h,m,_,S,L);return d.scaleSelf(k*M*T)}function V1(d,l,h,m,_,S,T,M,L){return{iconPrimary:a4(d.getPrimary(),l,h,m,_,S,T,M,L),iconSecondary:a4(d.getSecondary(),l,h,m,_,S,T,M,L)}}function lot(d,l,h){if(!l)return;const m=h.get(d.toString()),_=h.get(l.toString());m&&_&&(m.paddedRect.w===_.paddedRect.w&&m.paddedRect.h===_.paddedRect.h||Mi(`Mismatch in icon variant sizes: ${d.toString()} and ${l.toString()}`),m.usvg!==_.usvg&&Mi(`Mismatch in icon variant image types: ${d.id} and ${l.id}`))}function o4(d,l,h,m){if(!d)return;const _=l.get(h.toString());if(d.imagePrimary=_,m){const S=l.get(m.toString());d.imageSecondary=S}}function cot(d,l){for(const h in d.horizontal)s4(d.horizontal[h],l);s4(d.vertical,l)}function s4(d,l){if(d){for(const h of d.positionedLines)for(const m of h.positionedGlyphs)if(m.image!==null){const _=m.image.toString();m.rect=l.get(_).paddedRect}}}function pP(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uot(d,l,h,m,_,S,T,M,L){const k=gP(S.horizontal)||S.vertical,F=h.get("icon-text-fit-padding").evaluate(m,{},_);let V,U=l;return l&&L!=="none"&&(d.allowVerticalPlacement&&S.vertical&&(V=lP(l,S.vertical,L,F,M,T)),k&&(U=lP(l,k,L,F,M,T))),{defaultShapedIcon:U,verticallyShapedIcon:V}}function hot(d,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt,mt,_t,Dt){let At=T.textMaxSize.evaluate(l,{},U);At===void 0?At=M*T.textScaleFactor:At*=T.textScaleFactor;const Ot=d.layers[0].layout,Nt=ro,Ht=M*T.textScaleFactor/Nt,se=gP(h.horizontal)||h.vertical;if(it!=="none"&&d.appearanceFeatureData&&l.index<d.appearanceFeatureData.length){const xe=d.appearanceFeatureData[l.index];xe&&(xe.textShaping=se,xe.iconTextFitPadding=Ot.get("icon-text-fit-padding").evaluate(l,{},U),xe.fontScale=Ht)}const Kt=Z.name==="globe",le=d.tilePixelRatio*At/Nt,ge=(ae=d.overscaling,d.zoom>18&&ae>2&&(ae>>=1),Math.max(Ne/(512*ae),1)*Ot.get("symbol-spacing")),Se=Ot.get("text-padding")*d.tilePixelRatio,ze=Ot.get("icon-padding")*d.tilePixelRatio,De=wr(Ot.get("text-max-angle")),me=Ot.get("icon-rotation-alignment")==="map"&&mt!=="point",Ee=ge/2;var ae;d.hasAnyIconTextFit===!1&&it!=="none"&&(d.hasAnyIconTextFit=!0);const re=l.properties?+l.properties[ii]:null,Ie=re&&d.elevationFeatureIdToIndex?d.elevationFeatureIdToIndex.get(re):65535,Re=(xe,oi,ui)=>{if(oi.x<0||oi.x>=Ne||oi.y<0||oi.y>=Ne)return;let ri=null;if(Kt){const{x:Xe,y:ji,z:Qe}=Z.projectTilePoint(oi.x,oi.y,ui);ri={anchor:new Xh(Xe,ji,Qe,0,void 0),up:Z.upVector(ui,oi.x,oi.y)}}(function(Xe,ji,Qe,Ii,Zi,fr,Pr,qi,Br,Fr,Bn,It,wt,ce,je,ue,Je,vi,gi,Ji,Ri,di,zr,ln,Oi,Cr,cn,Yr,Zn,Mn,mn){const rn=Xe.addToLineVertexArray(ji,Ii);let Nr,Qi,Vr,vn,ki,Lr,Cn,Qn=0,la=0,Pa=0,En=0,wa=-1,Is=-1;const Sa={};let il=ng("");const Co=Qe?Qe.anchor:ji,Gl=Yr!=="none";let Ms=0,rl=0;if(Br._unevaluatedLayout.getValue("text-radial-offset")===void 0){const no=Br.layout.get("text-offset").evaluate(Ri,{},Oi);Ms=no[0]*ro,rl=no[1]*ro}else Ms=Br.layout.get("text-radial-offset").evaluate(Ri,{},Oi)*ro,rl=fP;if(Xe.allowVerticalPlacement&&Zi.vertical){const no=Zi.vertical;if(je)Lr=mP(no),qi&&(Cn=mP(qi));else{const Qo=Br.layout.get("text-rotate").evaluate(Ri,{},Oi)+90;Vr=S2(Fr,Co,ji,Bn,It,wt,no,ce,Qo,ue),qi&&(vn=S2(Fr,Co,ji,Bn,It,wt,qi,vi,Qo,null,mn))}}if(fr){const no=Xe.iconSizeData,Qo=Br.layout.get("icon-rotate").evaluate(Ri,{},Oi),Nu=dP(fr,Qo,zr,Gl,di.iconScaleFactor),Of=qi?dP(qi,Qo,zr,Gl,di.iconScaleFactor):void 0;Qi=S2(Fr,Co,ji,Bn,It,wt,fr,vi,Qo,null,Mn);const ay=function(Vu,V2,oy,Tst,IU,MU,Ast,Ist){const CU=Vu.layers[0],EU=CU.appearances;let sy=V2.length;if(oy&&(sy=Math.max(sy,oy.length)),EU.length===0)return sy;const[Mst,Cst]=Tst.get("icon-size-scale-range"),Est=ct(1,Mst,Cst);for(const DU of EU){const PU=DU.getUnevaluatedProperties();if(PU._values["icon-image"].value!==void 0){const LU=CU.getAppearanceValueAndResolveTokens(DU,"icon-image",IU,MU,[]);if(LU){const RU=Vu.getResolvedImageFromTokens(LU);if(RU){const kU=PU._values["icon-size"],Dst=V1(RU,X_(Vu.zoom,kU,Vu.worldview),kU,MU,Vu.zoom,IU,Vu.pixelRatio,Est,Vu.worldview),Pst=Ast.get(Dst.iconPrimary.toString());sy=Math.max(sy,eot(Pst,Ist))}}}}return sy}(Xe,Nu,Of,Br.layout,Ri,Oi,Xe.iconAtlasPositions,Gl);Qn=4*ay;let zf=null;no.kind==="source"?(zf=[Jc*Br.layout.get("icon-size").evaluate(Ri,{},Oi)*di.iconScaleFactor],zf[0]>Yh&&Mi(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${U1}. Reduce your "icon-size".`)):no.kind==="composite"&&(zf=[Jc*di.compositeIconSizes[0].evaluate(Ri,{},Oi)*di.iconScaleFactor,Jc*di.compositeIconSizes[1].evaluate(Ri,{},Oi)*di.iconScaleFactor],(zf[0]>Yh||zf[1]>Yh)&&Mi(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${U1}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Nu,zf,Ji,gi,Ri,void 0,Qe,ji,rn.lineStartIndex,rn.lineLength,-1,ln,Oi,Cr,cn,Xe.symbolInstances.length,ay),wa=Xe.icon.placedSymbolArray.length-1,Of&&(la=4*ay,Xe.addSymbols(Xe.icon,Of,zf,Ji,gi,Ri,el.vertical,Qe,ji,rn.lineStartIndex,rn.lineLength,-1,ln,Oi,Cr,cn,Xe.symbolInstances.length,ay),Is=Xe.icon.placedSymbolArray.length-1)}for(const no in Zi.horizontal){const Qo=no,Nu=Zi.horizontal[Qo];Nr||(il=ng(Nu.text),je?ki=mP(Nu):Nr=S2(Fr,Co,ji,Bn,It,wt,Nu,ce,Br.layout.get("text-rotate").evaluate(Ri,{},Oi),ue));const Of=Nu.positionedLines.length===1;if(Pa+=l4(Xe,Qe,ji,Nu,Pr,Br,je,Ri,ue,rn,Zi.vertical?el.horizontal:el.horizontalOnly,Of?aot(Zi.horizontal):[Qo],Sa,wa,di,ln,Oi,Xe.symbolInstances.length,Cr),Of)break}Zi.vertical&&(En+=l4(Xe,Qe,ji,Zi.vertical,Pr,Br,je,Ri,ue,rn,el.vertical,["vertical"],Sa,Is,di,ln,Oi,Xe.symbolInstances.length,Cr));let Eo=-1;const nl=(no,Qo)=>no?Math.max(no,Qo):Qo;Eo=nl(ki,Eo),Eo=nl(Lr,Eo),Eo=nl(Cn,Eo);const Hl=Eo>-1?1:0;Xe.glyphOffsetArray.length>=65535&&Mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ri.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,Ri.sortKey),Xe.symbolInstances.emplaceBack(ji.x,ji.y,Co.x,Co.y,Co.z,Sa.right>=0?Sa.right:-1,Sa.center>=0?Sa.center:-1,Sa.left>=0?Sa.left:-1,Sa.vertical>=0?Sa.vertical:-1,wa,Is,il,Nr!==void 0?Nr:Xe.collisionBoxArray.length,Nr!==void 0?Nr+1:Xe.collisionBoxArray.length,Vr!==void 0?Vr:Xe.collisionBoxArray.length,Vr!==void 0?Vr+1:Xe.collisionBoxArray.length,Qi!==void 0?Qi:Xe.collisionBoxArray.length,Qi!==void 0?Qi+1:Xe.collisionBoxArray.length,vn||Xe.collisionBoxArray.length,vn?vn+1:Xe.collisionBoxArray.length,Bn,Pa,En,Qn,la,Hl,0,Ms,rl,Eo,0,Gl?1:0,Zn)})(d,oi,ri,xe,h,m,S,_,d.layers[0],d.collisionBoxArray,l.index,l.sourceLayerIndex,d.index,Se,dt,k,0,ze,me,at,l,T,F,V,U,q,Q,it,Ie,_t,Dt)};if(mt==="line")for(const xe of n2(l.geometry,0,0,Ne,Ne)){const oi=tot(xe,ge,De,h.vertical||se,m,Nt,le,d.overscaling,Ne);for(const ui of oi)se&&dot(d,se.text,Ee,ui)||Re(xe,ui,U)}else if(mt==="line-center"){for(const xe of l.geometry)if(xe.length>1){const oi=Qat(xe,De,h.vertical||se,m,Nt,le);oi&&Re(xe,oi,U)}}else if(l.type==="Polygon")for(const xe of S1(l.geometry,0)){const oi=rot(xe,16);Re(xe[0],new Xh(oi.x,oi.y,0,0,void 0),U)}else if(l.type==="LineString")for(const xe of l.geometry)Re(xe,new Xh(xe[0].x,xe[0].y,0,0,void 0),U);else if(l.type==="Point")for(const xe of l.geometry)for(const oi of xe)Re([oi],new Xh(oi.x,oi.y,0,0,void 0),U)}const U1=255,Yh=U1*Jc;function l4(d,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt){const mt=function(At,Ot,Nt,Ht,se,Kt,le,ge){const Se=[];if(Ot.positionedLines.length===0)return Se;const ze=Ht.layout.get("text-rotate").evaluate(Kt,{})*Math.PI/180,De=function(Ie){const Re=Ie[0],xe=Ie[1],oi=Re*xe;return oi>0?[Re,-xe]:oi<0?[-Re,xe]:Re===0?[xe,Re]:[xe,-Re]}(Nt);let me=Math.abs(Ot.top-Ot.bottom);for(const Ie of Ot.positionedLines)me-=Ie.lineOffset;const Ee=Ot.positionedLines.length,ae=me/Ee;let re=Ot.top-Nt[1];for(let Ie=0;Ie<Ee;++Ie){const Re=Ot.positionedLines[Ie];re=iot(Ot,ae,re,Ie);for(const xe of Re.positionedGlyphs){if(!xe.rect)continue;const oi=xe.rect||{};let ui=zV+1,ri=!0,Xe=1,ji=0;if(xe.image){const gi=le.get(xe.image.toString());if(!gi)continue;if(gi.sdf){Mi("SDF images are not supported in formatted text and will be ignored.");continue}ri=!1,Xe=gi.pixelRatio,ui=Hg/Xe}const Qe=(se||ge)&&xe.vertical,Ii=xe.metrics.advance*xe.scale/2,Zi=xe.metrics,fr=xe.rect;if(fr===null)continue;ge&&Ot.verticalizable&&(ji=xe.image?Ii-xe.metrics.width*xe.scale/2:0);const Pr=se?[xe.x+Ii,xe.y]:[0,0];let qi=[0,0],Br=[0,0],Fr=!1;se||(Qe?(Br=[xe.x+Ii+De[0],xe.y+De[1]-ji],Fr=!0):qi=[xe.x+Ii+Nt[0],xe.y+Nt[1]-ji]);const Bn=fr.w*xe.scale/(Xe*(xe.localGlyph?Qc:1)),It=fr.h*xe.scale/(Xe*(xe.localGlyph?Qc:1));let wt,ce,je,ue;if(Qe){const gi=xe.y-re,Ji=new Ce(-Ii,Ii-gi),Ri=-Math.PI/2,di=new Ce(...Br);wt=new Ce(-Ii+qi[0],qi[1]),wt._rotateAround(Ri,Ji)._add(di),wt.x+=-gi+Ii,wt.y-=(Zi.left-ui)*xe.scale;const zr=xe.image?Zi.advance*xe.scale:ro*xe.scale,ln=String.fromCodePoint(xe.glyph);Bat(ln)?wt.x+=(1-ui)*xe.scale:Fat(ln)?wt.x+=zr-Zi.height*xe.scale+(-ui-1)*xe.scale:wt.x+=xe.image||Zi.width+2*ui===fr.w&&Zi.height+2*ui===fr.h?(zr-It)/2:(zr-(Zi.height+2*ui)*xe.scale)/2,ce=new Ce(wt.x,wt.y-Bn),je=new Ce(wt.x+It,wt.y),ue=new Ce(wt.x+It,wt.y-Bn)}else{const gi=(Zi.left-ui)*xe.scale-Ii+qi[0],Ji=(-Zi.top-ui)*xe.scale+qi[1],Ri=gi+Bn,di=Ji+It;wt=new Ce(gi,Ji),ce=new Ce(Ri,Ji),je=new Ce(gi,di),ue=new Ce(Ri,di)}if(ze){let gi;gi=se?new Ce(0,0):Fr?new Ce(De[0],De[1]):new Ce(Nt[0],Nt[1]),wt._rotateAround(ze,gi),ce._rotateAround(ze,gi),je._rotateAround(ze,gi),ue._rotateAround(ze,gi)}const Je=new Ce(0,0),vi=new Ce(0,0);Se.push({tl:wt,tr:ce,bl:je,br:ue,texPrimary:oi,texSecondary:void 0,writingMode:Ot.writingMode,glyphOffset:Pr,sectionIndex:xe.sectionIndex,isSDF:ri,pixelOffsetTL:Je,pixelOffsetBR:vi,minFontScaleX:0,minFontScaleY:0})}}return Se}(0,m,L,S,T,M,_,d.allowVerticalPlacement),_t=d.textSizeData;let Dt=null;_t.kind==="source"?(Dt=[Jc*S.layout.get("text-size").evaluate(M,{},it)*q.textScaleFactor],Dt[0]>Yh&&Mi(`${d.layerIds[0]}: Value for "text-size" is >= ${U1}. Reduce your "text-size".`)):_t.kind==="composite"&&(Dt=[Jc*q.compositeTextSizes[0].evaluate(M,{},it)*q.textScaleFactor,Jc*q.compositeTextSizes[1].evaluate(M,{},it)*q.textScaleFactor],(Dt[0]>Yh||Dt[1]>Yh)&&Mi(`${d.layerIds[0]}: Value for "text-size" is >= ${U1}. Reduce your "text-size".`)),d.addSymbols(d.text,mt,Dt,L,T,M,F,l,h,k.lineStartIndex,k.lineLength,Z,Q,it,dt,!1,at,mt.length);for(const At of V)U[At]=d.text.placedSymbolArray.length-1;return 4*mt.length}function gP(d){for(const l in d)return d[l];return null}function S2(d,l,h,m,_,S,T,M,L,k,F){let V,U,Z,q;if(V=F?F.top:T.top,U=F?F.bottom:T.bottom,Z=F?F.left:T.left,q=F?F.right:T.right,GV(T)&&T.collisionPadding){const Q=T.collisionPadding;Z-=Q[0],V-=Q[1],q+=Q[2],U+=Q[3]}if(L){const Q=new Ce(Z,V),it=new Ce(q,V),at=new Ce(Z,U),dt=new Ce(q,U),mt=wr(L);let _t=new Ce(0,0);k&&(_t=new Ce(k[0],k[1])),Q._rotateAround(mt,_t),it._rotateAround(mt,_t),at._rotateAround(mt,_t),dt._rotateAround(mt,_t),Z=Math.min(Q.x,it.x,at.x,dt.x),q=Math.max(Q.x,it.x,at.x,dt.x),V=Math.min(Q.y,it.y,at.y,dt.y),U=Math.max(Q.y,it.y,at.y,dt.y)}return d.emplaceBack(l.x,l.y,l.z,h.x,h.y,Z,V,q,U,M,m,_,S),d.length-1}function mP(d){GV(d)&&d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const l=d.bottom-d.top;return l>0?Math.max(10,l):null}function dot(d,l,h,m){const _=d.compareText;if(l in _){const S=_[l];for(let T=S.length-1;T>=0;T--)if(m.dist(S[T])<h)return!0}else _[l]=[];return _[l].push(m),!1}function c4(d,l){const h=d.fovAboveCenter,m=d.elevation?d.elevation.getMinElevationBelowMSL()*l:0,_=(d._camera.position[2]*d.worldSize-m)/Math.cos(d._pitch),S=Math.sin(h)*_/Math.sin(Math.max(Math.PI/2-d._pitch-h,.01));let T=Math.sin(d._pitch)*S+_;const M=_*(1/d._horizonShift);if(!d.elevation||d.elevation.exaggeration()===0){let L=Math.max(d.zoom-17,0);d.isOrthographic&&(L/=10),T*=1+L}return Math.min(1.01*T,M)}function G1(d,l){if(!l.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:l};const h=Math.pow(2,-d.z),m=d.x*h,_=(d.x+1)*h,S=d.y*h,T=(d.y+1)*h,M=xt(m),L=xt(_),k=vt(S),F=vt(T),V=l.project(M,k),U=l.project(L,k),Z=l.project(L,F),q=l.project(M,F);let Q=Math.min(V.x,U.x,Z.x,q.x),it=Math.min(V.y,U.y,Z.y,q.y),at=Math.max(V.x,U.x,Z.x,q.x),dt=Math.max(V.y,U.y,Z.y,q.y);const mt=h/16;function _t(At,Ot,Nt,Ht,se,Kt){const le=(Nt+se)/2,ge=(Ht+Kt)/2,Se=l.project(xt(le),vt(ge)),ze=Math.max(0,Q-Se.x,it-Se.y,Se.x-at,Se.y-dt);Q=Math.min(Q,Se.x),at=Math.max(at,Se.x),it=Math.min(it,Se.y),dt=Math.max(dt,Se.y),ze>mt&&(_t(At,Se,Nt,Ht,le,ge),_t(Se,Ot,le,ge,se,Kt))}_t(V,U,m,S,_,S),_t(U,Z,_,S,_,T),_t(Z,q,_,T,m,T),_t(q,V,m,T,m,S),Q-=mt,it-=mt,at+=mt,dt+=mt;const Dt=1/Math.max(at-Q,dt-it);return{scale:Dt,x:Q*Dt,y:it*Dt,x2:at*Dt,y2:dt*Dt,projection:l}}function u4(d,{x:l,y:h},m=0){return new Ce(((l-m)*d.scale-d.x)*Ne,(h*d.scale-d.y)*Ne)}const fot=D(new Float32Array(16));class Rf{constructor(l){this.spec=l,this.name=l.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(l,h){return{x:0,y:0,z:0}}unproject(l,h){return new Y(0,0)}projectTilePoint(l,h,m){return{x:l,y:h,z:0}}locationPoint(l,h,m,_=!0){return l._coordinatePoint(l.locationCoordinate(h,m),_)}pixelsPerMeter(l,h){return pt(1,l)*h}pixelSpaceConversion(l,h,m){return 1}farthestPixelDistance(l){return c4(l,l.pixelsPerMeter)}pointCoordinate(l,h,m,_){const S=l.horizonLineFromTop(!1),T=new Ce(h,Math.max(S,m));return l.rayIntersectionCoordinate(l.pointRayIntersection(T,_))}pointCoordinate3D(l,h,m){const _=new Ce(h,m);if(l.elevation)return l.elevation.pointCoordinate(_);{const S=this.pointCoordinate(l,_.x,_.y,0);return[S.x,S.y,S.z]}}isPointAboveHorizon(l,h){if(l.elevation&&l.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(l,h.x,h.y);const m=l.horizonLineFromTop();return h.y<m}createInversionMatrix(l,h){return fot}createTileMatrix(l,h,m){let _,S,T;const M=m.canonical,L=D(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=G1(M,this);_=1,S=k.x+m.wrap*k.scale,T=k.y,H(L,L,[_/k.scale,_/k.scale,l.pixelsPerMeter/h])}else _=h/l.zoomScale(M.z),S=(M.x+Math.pow(2,M.z)*m.wrap)*_,T=M.y*_;return N(L,L,[S,T,0]),H(L,L,[_/Ne,_/Ne,1]),L}upVector(l,h,m){return[0,0,1]}upVectorScale(l,h,m){return{metersToTile:1}}}class pot extends Rf{constructor(l){super(l),this.range=[4,7],this.center=l.center||[-96,37.5];const[h,m]=this.parallels=l.parallels||[29.5,45.5],_=Math.sin(wr(h));this.n=(_+Math.sin(wr(m)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(l,h){const{n:m,c:_,r0:S}=this,T=wr(l-this.center[0]),M=wr(h),L=Math.sqrt(_-2*m*Math.sin(M))/m;return{x:L*Math.sin(T*m),y:L*Math.cos(T*m)-S,z:0}}unproject(l,h){const{n:m,c:_,r0:S}=this,T=S+h;let M=Math.atan2(l,Math.abs(T))*Math.sign(T);T*m<0&&(M-=Math.PI*Math.sign(l)*Math.sign(T));const L=wr(this.center[0])*m;M=Ft(M,-Math.PI-L,Math.PI-L);const k=ct(Fo(M/m)+this.center[0],-180,180),F=Math.asin(ct((_-(l*l+T*T)*m*m)/(2*m),-1,1)),V=ct(Fo(F),-bt,bt);return new Y(k,V)}}const H1=1.340264,j1=-.081106,W1=893e-6,$1=.003796,T2=Math.sqrt(3)/2;class got extends Rf{project(l,h){h=h/180*Math.PI,l=l/180*Math.PI;const m=Math.asin(T2*Math.sin(h)),_=m*m,S=_*_*_;return{x:.5*(l*Math.cos(m)/(T2*(H1+3*j1*_+S*(7*W1+9*$1*_)))/Math.PI+.5),y:1-.5*(m*(H1+j1*_+S*(W1+$1*_))/Math.PI+1),z:0}}unproject(l,h){l=(2*l-.5)*Math.PI;let m=h=(2*(1-h)-1)*Math.PI,_=m*m,S=_*_*_;for(let F,V,U,Z=0;Z<12&&(V=m*(H1+j1*_+S*(W1+$1*_))-h,U=H1+3*j1*_+S*(7*W1+9*$1*_),F=V/U,m=ct(m-F,-Math.PI/3,Math.PI/3),_=m*m,S=_*_*_,!(Math.abs(F)<1e-12));++Z);const T=T2*l*(H1+3*j1*_+S*(7*W1+9*$1*_))/Math.cos(m),M=Math.asin(Math.sin(m)/T2),L=ct(180*T/Math.PI,-180,180),k=ct(180*M/Math.PI,-bt,bt);return new Y(L,k)}}class mot extends Rf{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0}project(l,h){return{x:.5+l/360,y:.5-h/360,z:0}}unproject(l,h){const m=360*(l-.5),_=ct(360*(.5-h),-bt,bt);return new Y(m,_)}}const Q_=Math.PI/2;function A2(d){return Math.tan((Q_+d)/2)}class vot extends Rf{constructor(l){super(l),this.center=l.center||[0,30];const[h,m]=this.parallels=l.parallels||[30,30];let _=wr(h),S=wr(m);this.southernCenter=_+S<0,this.southernCenter&&(_=-_,S=-S);const T=Math.cos(_),M=A2(_);this.n=_===S?Math.sin(_):Math.log(T/Math.cos(S))/Math.log(A2(S)/M),this.f=T*Math.pow(A2(_),this.n)/this.n}project(l,h){h=wr(h),this.southernCenter&&(h=-h),l=wr(l-this.center[0]);const m=1e-6,{n:_,f:S}=this;S>0?h<-Q_+m&&(h=-Q_+m):h>Q_-m&&(h=Q_-m);const T=S/Math.pow(A2(h),_);let M=T*Math.sin(_*l),L=S-T*Math.cos(_*l);return M=.5*(M/Math.PI+.5),L=.5*(L/Math.PI+.5),{x:M,y:this.southernCenter?L:1-L,z:0}}unproject(l,h){l=(2*l-.5)*Math.PI,this.southernCenter&&(h=1-h),h=(2*(1-h)-.5)*Math.PI;const{n:m,f:_}=this,S=_-h,T=Math.sign(S),M=Math.sign(m)*Math.sqrt(l*l+S*S);let L=Math.atan2(l,Math.abs(S))*T;S*m<0&&(L-=Math.PI*Math.sign(l)*T);const k=ct(Fo(L/m)+this.center[0],-180,180),F=ct(Fo(2*Math.atan(Math.pow(_/M,1/m))-Q_),-bt,bt);return new Y(k,this.southernCenter?-F:F)}}class h4 extends Rf{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(l,h){return{x:ut(l),y:st(h),z:0}}unproject(l,h){const m=xt(l),_=vt(h);return new Y(m,_)}}const d4=wr(bt);class _ot extends Rf{project(l,h){const m=(h=wr(h))*h,_=m*m;return{x:.5*((l=wr(l))*(.8707-.131979*m+_*(_*(.003971*m-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(h*(1.007226+m*(.015085+_*(.028874*m-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(l,h){l=(2*l-.5)*Math.PI;let m=h=(2*(1-h)-1)*Math.PI,_=25,S=0,T=m*m;do{T=m*m;const k=T*T;S=(m*(1.007226+T*(.015085+k*(.028874*T-.044475-.005916*k)))-h)/(1.007226+T*(.045255+k*(.259866*T-.311325-.005916*11*k))),m=ct(m-S,-d4,d4)}while(Math.abs(S)>1e-6&&--_>0);T=m*m;const M=ct(Fo(l/(.8707+T*(T*(T*T*T*(.003971-.001529*T)-.013791)-.131979))),-180,180),L=Fo(m);return new Y(M,L)}}const f4=wr(bt);class yot extends Rf{project(l,h){h=wr(h),l=wr(l);const m=Math.cos(h),_=2/Math.PI,S=Math.acos(m*Math.cos(l/2)),T=Math.sin(S)/S,M=.5*(l*_+2*m*Math.sin(l/2)/T)||0,L=.5*(h+Math.sin(h)/T)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(l,h){let m=l=(2*l-.5)*Math.PI,_=h=(2*(1-h)-1)*Math.PI,S=25;const T=1e-6;let M=0,L=0;do{const k=Math.cos(_),F=Math.sin(_),V=2*F*k,U=F*F,Z=k*k,q=Math.cos(m/2),Q=Math.sin(m/2),it=2*q*Q,at=Q*Q,dt=1-Z*q*q,mt=dt?1/dt:0,_t=dt?Math.acos(k*q)*Math.sqrt(1/dt):0,Dt=.5*(2*_t*k*Q+2*m/Math.PI)-l,At=.5*(_t*F+_)-h,Ot=.5*mt*(Z*at+_t*k*q*U)+1/Math.PI,Nt=mt*(it*V/4-_t*F*Q),Ht=.125*mt*(V*Q-_t*F*Z*it),se=.5*mt*(U*q+_t*at*k)+.5,Kt=Nt*Ht-se*Ot;M=(At*Nt-Dt*se)/Kt,L=(Dt*Ht-At*Ot)/Kt,m=ct(m-M,-Math.PI,Math.PI),_=ct(_-L,-f4,f4)}while((Math.abs(M)>T||Math.abs(L)>T)&&--S>0);return new Y(Fo(m),Fo(_))}}class p4 extends Rf{constructor(l){super(l),this.center=l.center||[0,0],this.parallels=l.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(l,h){const{scale:m,cosPhi:_}=this;return{x:wr(l)*_*m+.5,y:-Math.sin(wr(h))/_*m+.5,z:0}}unproject(l,h){const{scale:m,cosPhi:_}=this,S=-(h-.5)/m,T=ct(Fo((l-.5)/m)/_,-180,180),M=Math.asin(ct(S*_,-1,1)),L=ct(Fo(M),-bt,bt);return new Y(T,L)}}class xot extends h4{constructor(l){super(l),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(l,h,m){const _=v1(l,h,m);return zt(_,_,XT(zu(m))),{x:_[0],y:_[1],z:_[2]}}locationPoint(l,h,m){const _=B(h.lat,h.lng),S=ye([],_),T=m?l._centerAltitude+m:l.elevation?l.elevation.getAtPointOrZero(l.locationCoordinate(h),l._centerAltitude):l._centerAltitude;li(_,_,S,pt(1,0)*Ne*T);const M=D(new Float64Array(16));return z(M,l.pixelMatrix,l.globeMatrix),zt(_,_,M),new Ce(_[0],_[1])}pixelsPerMeter(l,h){return pt(1,0)*h}pixelSpaceConversion(l,h,m){const _=pt(1,l)*h,S=zi(pt(1,45)*h,_,m);return this.pixelsPerMeter(l,h)/S}createTileMatrix(l,h,m){const _=wD(zu(m.canonical));return z(new Float64Array(16),l.globeMatrix,_)}createInversionMatrix(l,h){const{center:m}=l,_=XT(zu(h));return X(_,_,wr(m.lng)),$(_,_,wr(m.lat)),H(_,_,[l._pixelsPerMercatorPixel,l._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(l,h,m,_){return FN(l,h,m,!0)||new qt(0,0)}pointCoordinate3D(l,h,m){const _=this.pointCoordinate(l,h,m,0);return[_.x,_.y,_.z]}isPointAboveHorizon(l,h){return!FN(l,h.x,h.y,!1)}farthestPixelDistance(l){const h=function(_,S){const T=_.cameraToCenterDistance,M=_._centerAltitude*S,L=_._camera,k=_._camera.forward(),F=Vt([],Ge([],k,-T),[0,0,M]),V=_.worldSize/(2*Math.PI),U=[0,0,-V],Z=_.width/_.height,q=Math.tan(_.fovAboveCenter),Q=Ge([],L.up(),q),it=Ge([],L.right(),q*Z),at=ye([],Vt([],Vt([],k,Q),it)),dt=[];let mt;if(new ir(F,at).closestPointOnSphere(U,V,dt)){const _t=Vt([],dt,U),Dt=qe([],_t,F);mt=Math.cos(_.fovAboveCenter)*Rt(Dt)}else{const _t=qe([],F,U),Dt=qe([],U,F);ye(Dt,Dt);const At=Rt(_t)-V;mt=Math.sqrt(At*(At+2*V));const Ot=Math.acos(mt/(V+At))-Math.acos(Ke(k,Dt));mt*=Math.cos(Ot)}return 1.01*mt}(l,this.pixelsPerMeter(l.center.lat,l.worldSize)),m=Ef(l.zoom);if(m>0){const _=c4(l,pt(1,l.center.lat)*l.worldSize),S=l.worldSize/(2*Math.PI),T=Math.max(l.width,l.height)/l.worldSize*Math.PI;return zi(h,_+S*(1-Math.cos(T)),Math.pow(m,10))}return h}upVector(l,h,m){return v1(h,m,l,1)}upVectorScale(l){return{metersToTile:$T(qT(zu(l)))}}}function g4(d){const l=d.parallels,h=!!l&&Math.abs(l[0]+l[1])<.01;switch(d.name){case"mercator":return new h4(d);case"equirectangular":return new mot(d);case"naturalEarth":return new _ot(d);case"equalEarth":return new got(d);case"winkelTripel":return new yot(d);case"albers":return h?new p4(d):new pot(d);case"lambertConformalConic":return h?new p4(d):new vot(d);case"globe":return new xot(d)}throw new Error(`Invalid projection name: ${d.name}`)}const bot=Ae.types,wot=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Z1(d,l,h,m,_,S,T,M,L,k,F,V,U){const Z=M?Math.min(Yh,Math.round(M[0])):0,q=M?Math.min(Yh,Math.round(M[1])):0;d.emplaceBack(l,h,Math.round(32*m),Math.round(32*_),S,T,(Z<<1)+(L?1:0),0+(q<<1),16*k,16*F,256*V,256*U)}function q1(d,l,h){d.emplaceBack(l,h)}function X1(d,l,h,m,_,S,T){d.emplaceBack(l,h,m,_,S,T)}const I2=(d,l,h,m)=>{for(let _=0;_<l;_++)d.emplaceBack(h[0],h[1],h[2],m[0],m[1],m[2])};function ty(d,l,h,m,_){d.emplaceBack(l,h,m,_),d.emplaceBack(l,h,m,_),d.emplaceBack(l,h,m,_),d.emplaceBack(l,h,m,_)}function Sot(d){for(const l of d.sections)if(aD(l.text))return!0;return!1}class vP{constructor(l){this.layoutVertexArray=new C_,this.indexArray=new Pn,this.programConfigurations=l,this.segments=new Vn,this.dynamicLayoutVertexArray=new ku,this.opacityVertexArray=new e1,this.placedSymbolArray=new Lg,this.iconTransitioningVertexArray=new Al,this.globeExtVertexArray=new xf,this.zOffsetVertexArray=new Zc,this.orientationVertexArray=new n1,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(l,h){const m=[],_=this.layoutVertexArray.uint16;for(let S=0;S<h;++S){const T=12*(l+S);m.push(..._.slice(T,T+12))}return m}updateIconVertexData(l,h,m,_,S,T,M,L,k,F,V,U,Z){const q=this.layoutVertexArray.uint16,Q=12*l;q[Q]=h,q[Q+1]=m,q[Q+2]=_,q[Q+3]=S,q[Q+4]=T,q[Q+5]=M,q[Q+6]=L,q[Q+7]=k,q[Q+8]=F,q[Q+9]=V,q[Q+10]=U,q[Q+11]=Z}upload(l,h,m,_,S,T){this.isEmpty()||(m&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Mat.members,!!T),this.indexBuffer=l.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Eat.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,wot,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=l.createVertexBuffer(this.iconTransitioningVertexArray,Lat.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,Cat.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||S)&&(this.zOffsetVertexBuffer=l.createVertexBuffer(this.zOffsetVertexArray,Dat.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=l.createVertexBuffer(this.orientationVertexArray,Pat.members,!0)),this.opacityVertexBuffer.itemSize=1),(m||_)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}si(vP,"SymbolBuffers");class _P{constructor(l,h,m){this.layoutVertexArray=new l,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Vn,this.collisionVertexArray=new wf,this.collisionVertexArrayExt=new ku}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Rat.members,!0),this.collisionVertexBufferExt=l.createVertexBuffer(this.collisionVertexArrayExt,kat.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}si(_P,"CollisionBuffers");class M2{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(T=>T.fqid),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=D([]),this.placementViewportMatrix=D([]);const h=this.layers[0]._unevaluatedLayout._values;this.worldview=l.worldview,this.textSizeData=X_(this.zoom,h["text-size"],this.worldview),this.iconSizeData=X_(this.zoom,h["icon-size"],this.worldview);const m=this.layers[0].layout,_=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.lut=l.lut,this.canOverlap=m.get("text-allow-overlap")||m.get("icon-allow-overlap")||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&_.constantOr(1)!==void 0,this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=m.get("text-writing-mode").map(T=>el[T]),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=l.sourceID,this.projection=l.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(l){const h=this.layers[0].getAppearances();return!(!h||h.length===0)&&h.some(m=>m.getProperty(l)!=null)}createArrays(){this.text=new vP(new Vl(this.layers,{zoom:this.zoom,lut:this.lut},l=>l.startsWith("text")||l.startsWith("symbol"))),this.icon=new vP(new Vl(this.layers,{zoom:this.zoom,lut:this.lut},l=>l.startsWith("icon")||l.startsWith("symbol"))),this.glyphOffsetArray=new h1,this.lineVertexArray=new zT,this.symbolInstances=new OT}calculateGlyphDependencies(l,h,m,_,S){for(const T of l){const M=T.codePointAt(0);if(M===void 0)break;if(h[M]=!0,_&&S&&M<=65535){const L=z1[T];L&&(h[L.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(l,h,m,_,S,T){let M=1;const L=l.getUnevaluatedProperties()._values["icon-size"],k=X_(this.zoom,L,this.worldview),F=Y_(k,h);if(k.kind!=="constant"&&k.kind!=="camera"||(M=F.uSize),k.kind==="composite"){const{minZoom:V,maxZoom:U}=k,Z=L.possiblyEvaluate(new xn(V,{worldview:this.worldview}),_),q=L.possiblyEvaluate(new xn(U,{worldview:this.worldview}),_),Q=Z.evaluate(m,{},_,S);M=Q+(q.evaluate(m,{},_,S)-Q)*F.uSizeT}return k.kind==="source"&&(M=L.possiblyEvaluate(new xn(this.zoom,{worldview:this.worldview}),_).evaluate(m,{},_,S)),M*T}updateFootprints(l,h){}updateReplacement(l,h){if(h.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=h.updateTime;const m=h.getReplacementRegionsForTile(l.toUnwrapped(),!0);return!e2(this.activeReplacements,m)&&(this.activeReplacements=m,!0)}getResolvedImageFromTokens(l){return typeof l=="string"?cs.build(l):l}populate(l,h,m,_){const S=this.layers[0],T=S.layout,M=this.projection.name==="globe",L=T.get("text-font"),k=T.get("text-field"),F=T.get("icon-image"),[V,U]=T.get("icon-size-scale-range"),Z=ct(h.scaleFactor||1,V,U),q=(k.value.kind!=="constant"||k.value.value instanceof Za&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),Q=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,it=this.hasAnyAppearanceProperty("icon-image"),at=T.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!q&&!Q&&!it)return;const dt=h.iconDependencies,mt=h.glyphDependencies,_t=h.availableImages,Dt=new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),At=Ot=>{const Nt=Ot.id.toString();dt.has(Nt)?dt.get(Nt).push(Ot):dt.set(Nt,[Ot])};for(const Ot of l){const{feature:Nt,id:Ht,index:se,sourceLayerIndex:Kt}=Ot,le=S._featureFilter.needGeometry,ge=ee(Nt,le);if(!S._featureFilter.filter(Dt,ge,m))continue;if(le||(ge.geometry=de(Nt,m,_)),M&&Nt.type!==1&&m.z<=5){const Ie=ge.geometry,Re=.98078528056,xe=(oi,ui)=>Ke(v1(oi.x,oi.y,m,1),v1(ui.x,ui.y,m,1))<Re;for(let oi=0;oi<Ie.length;oi++)Ie[oi]=he(Ie[oi],xe)}let Se,ze;if(q){const Ie=S.getValueAndResolveTokens("text-field",ge,m,_t),Re=Za.factory(Ie);Sot(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||$x()==="unavailable"||this.hasRTLText&&As.isParsed())&&(Se=zat(Re,S,ge))}if(Q){const Ie=S.getValueAndResolveTokens("icon-image",ge,m,_t);ze=this.getResolvedImageFromTokens(Ie)}const De=this.layers[0];let me=!1;if(!ze&&it){const Ie=De.getAppearances();for(const Re of Ie)if(Re.getProperty("icon-image")){const xe=De.getAppearanceValueAndResolveTokens(Re,"icon-image",ge,m,_t);if(xe){ze=this.getResolvedImageFromTokens(xe),me=!0;break}}}if(!Se&&!ze)continue;const Ee=this.sortFeaturesByKey?at.evaluate(ge,{},m):void 0,ae={id:Ht,text:Se,icon:ze,index:se,sourceLayerIndex:Kt,geometry:ge.geometry,properties:Nt.properties,type:bot[Nt.type],sortKey:Ee};if(this.features.push(ae),this.appearanceFeatureData.push({id:Ht,properties:Nt.properties,usesAppearanceIconAsPlaceholder:me,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),ze){const Ie=De._unevaluatedLayout._values,{iconPrimary:Re,iconSecondary:xe}=V1(ze,this.iconSizeData,Ie["icon-size"],m,this.zoom,ae,this.pixelRatio,Z,this.worldview);At(Re),xe&&(this.hasAnySecondaryIcon=!0,At(xe))}const re=De.getAppearances();if(re.length!==0&&re.forEach(Ie=>{if(!Ie.getProperty("icon-image"))return;const Re=this.getCombinedIconPrimary(Ie,De,ge,m,_t,ae,Z);Re&&At(Re)}),Se){const Ie=L.evaluate(ge,{},m).join(","),Re=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(el.vertical)>=0;for(const xe of Se.sections)if(xe.image){const oi=xe.image.getPrimary().scaleSelf(this.pixelRatio),ui=oi.id.toString(),ri=dt.get(ui)||[];ri.push(oi),dt.set(ui,ri)}else{const oi=Vx(Se.toString()),ui=xe.fontStack||Ie,ri=mt[ui]=mt[ui]||{};this.calculateGlyphDependencies(xe.text,ri,Re,this.allowVerticalPlacement,oi)}}}if(T.get("symbol-placement")==="line"&&(this.features=function(Ot){const Nt={},Ht={},se=[];let Kt=0;function le(De){se.push(Ot[De]),Kt++}function ge(De,me,Ee){const ae=Ht[De];return delete Ht[De],Ht[me]=ae,se[ae].geometry[0].pop(),se[ae].geometry[0]=se[ae].geometry[0].concat(Ee[0]),ae}function Se(De,me,Ee){const ae=Nt[me];return delete Nt[me],Nt[De]=ae,se[ae].geometry[0].shift(),se[ae].geometry[0]=Ee[0].concat(se[ae].geometry[0]),ae}function ze(De,me,Ee){const ae=Ee?me[0][me[0].length-1]:me[0][0];return`${De}:${ae.x}:${ae.y}`}for(let De=0;De<Ot.length;De++){const me=Ot[De],Ee=me.geometry,ae=me.text?me.text.toString():null;if(!ae){le(De);continue}const re=ze(ae,Ee),Ie=ze(ae,Ee,!0);if(re in Ht&&Ie in Nt&&Ht[re]!==Nt[Ie]){const Re=Se(re,Ie,Ee),xe=ge(re,Ie,se[Re].geometry);delete Nt[re],delete Ht[Ie],Ht[ze(ae,se[xe].geometry,!0)]=xe,se[Re].geometry=null}else re in Ht?ge(re,Ie,Ee):Ie in Nt?Se(re,Ie,Ee):(le(De),Nt[re]=Kt-1,Ht[Ie]=Kt-1)}return se.filter(De=>De.geometry)}(this.features)),T.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",h.elevationFeatures){!this.elevationFeatures&&h.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ot of h.elevationFeatures)this.elevationFeatureIdToIndex.set(Ot.id,this.elevationFeatures.length),this.elevationFeatures.push(Ot)}}else T.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ot,Nt)=>Ot.sortKey-Nt.sortKey)}getCombinedIconPrimary(l,h,m,_,S,T,M){let L,k;const F=l.getUnevaluatedProperties();if(F._values["icon-image"].value!==void 0){const V=h.getAppearanceValueAndResolveTokens(l,"icon-image",m,_,S);L=this.getResolvedImageFromTokens(V)}else{const V=h.getValueAndResolveTokens("icon-image",m,_,S);L=this.getResolvedImageFromTokens(V)}if(L){const V=F._values["icon-size"]||h._unevaluatedLayout._values["icon-size"];k=V1(L,X_(this.zoom,V,this.worldview),V,_,this.zoom,T,this.pixelRatio,M,this.worldview).iconPrimary}return k}updateAppearanceBasedIconTextures(l,h,m,_){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const S=this.layers[0];let T=!1,M=0;const L=S.layout,[k,F]=L.get("icon-size-scale-range"),V=ct(1,k,F);for(let U=0;U<this.symbolInstances.length;U++){const Z=this.symbolInstances.get(U),q=this.appearanceFeatureData[Z.featureIndex];if(q&&Z.placedIconSymbolIndex>=0){const Q=q.id,it=h&&Q!==void 0?h[String(Q)]:void 0,at={type:"Point",id:q.id,properties:q.properties,geometry:[]},dt=this.layers[0].appearances&&this.layers[0].appearances.find(mt=>mt.isActive({globals:_,feature:at,canonical:l,featureState:it}));if(q.activeAppearance===dt)continue;if(dt){q.activeAppearance=dt;const mt={sortKey:void 0,text:void 0,icon:null,index:Z.featureIndex,sourceLayerIndex:Z.featureIndex,geometry:[],properties:q.properties,type:"Point",id:q.id};if(!dt.hasCachedIconPrimary()){const Ot=this.getCombinedIconPrimary(dt,S,at,l,m,mt,V);dt.setCachedIconPrimary(Ot)}const _t=dt.getCachedIconPrimary();if(!_t)continue;const Dt=_t.toString(),At=this.iconAtlasPositions&&this.iconAtlasPositions.get(Dt);if(At){const Ot=S.getAppearanceValueAndResolveTokens(dt,"icon-offset",at,l,m),Nt=Ot&&Array.isArray(Ot)?Ot:[0,0];let Ht=v2(At,void 0,Nt,S.layout.get("icon-anchor").evaluate(at,{},l));const se=S.getAppearanceValueAndResolveTokens(dt,"icon-rotate",at,l,m),Kt=typeof se=="number"?se:0,le=At.sdf,ge=S.layout.get("icon-text-fit").constantOr("none");ge!=="none"&&q.textShaping&&q.iconTextFitPadding&&q.fontScale&&(Ht=lP(Ht,q.textShaping,ge,q.iconTextFitPadding,Nt,q.fontScale));const Se=this.calculateEffectiveAppearanceIconSize(dt,_.zoom,at,l,m,V),ze=0,De=1+(Math.min(Yh,Math.round(Se*Jc))<<1),me=dP(Ht,Kt,le,ge!=="none",V);q.isUsingAppearanceVertexData||(q.isUsingAppearanceVertexData=!0,q.layoutBasedVertexData=this.icon.getIconVertexData(M,Z.numIconVertices));for(let ae=0;ae<me.length;++ae){const re=me[ae],Ie=q.layoutBasedVertexData[0]||Z.tileAnchorX,Re=q.layoutBasedVertexData[1]||Z.tileAnchorY,xe=16*re.pixelOffsetTL.x,oi=16*re.pixelOffsetTL.y,ui=16*re.pixelOffsetBR.x,ri=16*re.pixelOffsetBR.y,Xe=16*re.minFontScaleX,ji=16*re.minFontScaleY;this.icon.updateIconVertexData(M,Ie,Re,Math.round(32*re.tl.x),Math.round(32*re.tl.y),re.texPrimary.x,re.texPrimary.y,ze,De,xe,oi,Xe,ji),this.icon.updateIconVertexData(M+1,Ie,Re,Math.round(32*re.tr.x),Math.round(32*re.tr.y),re.texPrimary.x+re.texPrimary.w,re.texPrimary.y,ze,De,ui,oi,Xe,ji),this.icon.updateIconVertexData(M+2,Ie,Re,Math.round(32*re.bl.x),Math.round(32*re.bl.y),re.texPrimary.x,re.texPrimary.y+re.texPrimary.h,ze,De,xe,ri,Xe,ji),this.icon.updateIconVertexData(M+3,Ie,Re,Math.round(32*re.br.x),Math.round(32*re.br.y),re.texPrimary.x+re.texPrimary.w,re.texPrimary.y+re.texPrimary.h,ze,De,ui,ri,Xe,ji),M+=4}const Ee=Z.numIconVertices-4*me.length;for(let ae=0;ae<Ee;++ae)this.icon.updateIconVertexData(M+ae,0,0,0,0,0,0,0,0,0,0,0,0);T=!0}else M+=Z.numIconVertices}else if(q.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(M,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(M+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(M+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(M+3,0,0,0,0,0,0,0,0,0,0,0,0),T=!0),M+=Z.numIconVertices,q.activeAppearance=null;else if(q.isUsingAppearanceVertexData){const _t=q.layoutBasedVertexData.length/12;for(let Dt=0;Dt<_t;++Dt){const At=Dt*12;this.icon.updateIconVertexData(M+Dt,q.layoutBasedVertexData[At+0],q.layoutBasedVertexData[At+1],q.layoutBasedVertexData[At+2],q.layoutBasedVertexData[At+3],q.layoutBasedVertexData[At+4],q.layoutBasedVertexData[At+5],q.layoutBasedVertexData[At+6],q.layoutBasedVertexData[At+7],q.layoutBasedVertexData[At+8],q.layoutBasedVertexData[At+9],q.layoutBasedVertexData[At+10],q.layoutBasedVertexData[At+11])}M+=_t,q.isUsingAppearanceVertexData=!1,q.activeAppearance=null,T=!0}else M+=Z.numIconVertices,q.activeAppearance=null}}return T}update(l,h,m,_,S,T,M){this.text.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M,this.worldview),this.icon.programConfigurations.updatePaintArrays(l,h,S,m,_,T,M,this.worldview)}updateRoadElevation(l){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let h=!1;const m=Lt(l),_=1/m;let S=!1,T=!1;for(let M=0;M<this.symbolInstances.length;M++){const L=this.symbolInstances.get(M),k=Ct(1,0,0),F=Ct(0,1,0),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:U,numIconVertices:Z,numVerticalIconVertices:q}=L,Q=V>0||U>0,it=Z>0,at=this.elevationFeatures[L.elevationFeatureIndex];if(at){const dt=new Ce(L.tileAnchorX,L.tileAnchorY),mt=.075+at.pointElevation(dt);L.zOffset!==mt&&(h=!0,L.zOffset=mt),mt!==0&&(this.hasAnyZOffset=!0);const _t=at.computeSlopeNormal(dt,_),Dt=Ka(hr(),Ct(0,0,1),_t);pe(k,k,Dt),pe(F,F,Dt),k[2]*=m,F[2]*=m,k[0]===1&&k[1]===0&&k[2]===0&&F[0]===0&&F[1]===1&&F[2]===0||(S=S||Q,T=T||it)}if(Q&&(I2(this.text.orientationVertexArray,V,k,F),I2(this.text.orientationVertexArray,U,k,F)),it){const{placedIconSymbolIndex:dt,verticalPlacedIconSymbolIndex:mt}=L;dt>=0&&I2(this.icon.orientationVertexArray,Z,k,F),mt>=0&&I2(this.icon.orientationVertexArray,q,k,F)}}S||(this.text.orientationVertexArray=void 0),T||(this.icon.orientationVertexArray=void 0),h&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const l=(S,T,M)=>{m+=T,m>S.length&&S.resize(m);for(let L=-T;L<0;L++)S.emplace(L+m,M)},h=(S,T,M)=>{_+=T,_>S.length&&S.resize(_);for(let L=-T;L<0;L++)S.emplace(L+_,M)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let m=0,_=0;for(let S=0;S<this.symbolInstances.length;S++){const T=this.symbolInstances.get(S),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:L,numIconVertices:k}=T,F=T.zOffset,V=k>0;if((M>0||L>0)&&(l(this.text.zOffsetVertexArray,M,F),l(this.text.zOffsetVertexArray,L,F)),V){const{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:Z}=T;U>=0&&h(this.icon.zOffsetVertexArray,k,F),Z>=0&&h(this.icon.zOffsetVertexArray,T.numVerticalIconVertices,F)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l,h,m,_,S){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(T=>T.appearances&&T.appearances.length>0)),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(l,h,m,_){return!!(l&&h&&m)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(l,h,m,_)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=g4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,h){const m=this.lineVertexArray.length;if(l.segment!==void 0)for(const{x:_,y:S}of h)this.lineVertexArray.emplaceBack(_,S);return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q,it,at,dt){const mt=l.indexArray,_t=l.layoutVertexArray,Dt=l.globeExtVertexArray,At=l.segments.prepareSegment(4*dt,_t,mt,this.canOverlap?T.sortKey:void 0),Ot=this.glyphOffsetArray.length,Nt=At.vertexLength,Ht=this.allowVerticalPlacement&&M===el.vertical?Math.PI/2:0,se=T.text&&T.text.sections;for(let ge=0;ge<h.length;ge++){const{tl:Se,tr:ze,bl:De,br:me,texPrimary:Ee,texSecondary:ae,pixelOffsetTL:re,pixelOffsetBR:Ie,minFontScaleX:Re,minFontScaleY:xe,glyphOffset:oi,isSDF:ui,sectionIndex:ri}=h[ge],Xe=At.vertexLength,ji=oi[1];if(Z1(_t,k.x,k.y,Se.x,ji+Se.y,Ee.x,Ee.y,m,ui,re.x,re.y,Re,xe),Z1(_t,k.x,k.y,ze.x,ji+ze.y,Ee.x+Ee.w,Ee.y,m,ui,Ie.x,re.y,Re,xe),Z1(_t,k.x,k.y,De.x,ji+De.y,Ee.x,Ee.y+Ee.h,m,ui,re.x,Ie.y,Re,xe),Z1(_t,k.x,k.y,me.x,ji+me.y,Ee.x+Ee.w,Ee.y+Ee.h,m,ui,Ie.x,Ie.y,Re,xe),L){const{x:Qe,y:Ii,z:Zi}=L.anchor,[fr,Pr,qi]=L.up;X1(Dt,Qe,Ii,Zi,fr,Pr,qi),X1(Dt,Qe,Ii,Zi,fr,Pr,qi),X1(Dt,Qe,Ii,Zi,fr,Pr,qi),X1(Dt,Qe,Ii,Zi,fr,Pr,qi),ty(l.dynamicLayoutVertexArray,Qe,Ii,Zi,Ht)}else ty(l.dynamicLayoutVertexArray,k.x,k.y,k.z,Ht);if(it){const Qe=ae||Ee;q1(l.iconTransitioningVertexArray,Qe.x,Qe.y),q1(l.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y),q1(l.iconTransitioningVertexArray,Qe.x,Qe.y+Qe.h),q1(l.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y+Qe.h)}mt.emplaceBack(Xe,Xe+1,Xe+2),mt.emplaceBack(Xe+1,Xe+2,Xe+3),At.vertexLength+=4,At.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(oi[0]),ge!==h.length-1&&ri===h[ge+1].sectionIndex||l.programConfigurations.populatePaintArrays(_t.length,T,T.index,{},Z,q,Q,se&&se[ri],this.worldview)}const Kt=dt-h.length;Kt!==0&&this._addNullVertices(Kt,_t,m,L,Dt,l,it,At,mt);const le=L?L.anchor:k;l.placedSymbolArray.emplaceBack(le.x,le.y,le.z,k.x,k.y,Ot,this.glyphOffsetArray.length-Ot,Nt,F,V,k.segment,m?m[0]:0,m?m[1]:0,_[0],_[1],M,0,0,0,U,0),l.symbolInstanceIndices.push(at)}_addNullVertices(l,h,m,_,S,T,M,L,k){for(let F=0;F<l;F++){for(let U=0;U<4;U++)Z1(h,0,0,0,0,0,0,m,!1,0,0,0,0),_&&X1(S,0,0,0,0,0,0),ty(T.dynamicLayoutVertexArray,0,0,0,0),M&&q1(T.iconTransitioningVertexArray,0,0);const V=L.vertexLength;k.emplaceBack(V,V+1,V+2),k.emplaceBack(V+1,V+2,V+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(l,h,m,_,S,T,M){l.emplaceBack(h,m,_,S,T,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(l,h,m,_,S,T,M){const L=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=L.vertexLength,F=M.tileAnchorX,V=M.tileAnchorY;for(let Z=0;Z<4;Z++)m.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(m.collisionVertexArrayExt,h,l.padding,M.zOffset),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Ce(l.x1,l.y1)),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Ce(l.x2,l.y1)),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Ce(l.x2,l.y2)),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Ce(l.x1,l.y2)),L.vertexLength+=4;const U=m.indexArray;U.emplaceBack(k,k+1),U.emplaceBack(k+1,k+2),U.emplaceBack(k+2,k+3),U.emplaceBack(k+3,k),L.primitiveLength+=4}_addTextDebugCollisionBoxes(l,h,m,_,S,T){for(let M=_;M<S;M++){const L=m.get(M),k=this.getSymbolInstanceTextSize(l,T,h,M);this._addCollisionDebugVertices(L,k,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,T)}}_addIconDebugCollisionBoxes(l,h,m,_,S,T){for(let M=_;M<S;M++){const L=m.get(M),k=this.getSymbolInstanceIconSize(l,h,T.placedIconSymbolIndex);this._addCollisionDebugVertices(L,k,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,T)}}generateCollisionDebugBuffers(l,h,m){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _P(E_,LV.members,Al),this.iconCollisionBox=new _P(E_,LV.members,Al);const _=Y_(this.iconSizeData,l),S=Y_(this.textSizeData,l,m);for(let T=0;T<this.symbolInstances.length;T++){const M=this.symbolInstances.get(T);this._addTextDebugCollisionBoxes(S,l,h,M.textBoxStartIndex,M.textBoxEndIndex,M),this._addTextDebugCollisionBoxes(S,l,h,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M),this._addIconDebugCollisionBoxes(_,l,h,M.iconBoxStartIndex,M.iconBoxEndIndex,M),this._addIconDebugCollisionBoxes(_,l,h,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M)}}getSymbolInstanceTextSize(l,h,m,_){const S=this.text.placedSymbolArray.get(h.rightJustifiedTextSymbolIndex>=0?h.rightJustifiedTextSymbolIndex:h.centerJustifiedTextSymbolIndex>=0?h.centerJustifiedTextSymbolIndex:h.leftJustifiedTextSymbolIndex>=0?h.leftJustifiedTextSymbolIndex:h.verticalPlacedTextSymbolIndex>=0?h.verticalPlacedTextSymbolIndex:_),T=cP(this.textSizeData,l,S)/ro;return this.tilePixelRatio*T}getSymbolInstanceIconSize(l,h,m){const _=this.icon.placedSymbolArray.get(m),S=cP(this.iconSizeData,l,_);return this.tilePixelRatio*S}_commitDebugCollisionVertexUpdate(l,h,m,_){l.emplaceBack(h,-m,-m,_),l.emplaceBack(h,m,-m,_),l.emplaceBack(h,m,m,_),l.emplaceBack(h,-m,m,_)}_updateTextDebugCollisionBoxes(l,h,m,_,S,T,M){for(let L=_;L<S;L++){const k=m.get(L),F=this.getSymbolInstanceTextSize(l,T,h,L);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,k.padding,T.zOffset)}}_updateIconDebugCollisionBoxes(l,h,m,_,S,T,M){for(let L=_;L<S;L++){const k=m.get(L),F=this.getSymbolInstanceIconSize(l,h,T.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,F,k.padding,T.zOffset)}}updateCollisionDebugBuffers(l,h,m,_){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const S=Y_(this.iconSizeData,l,_),T=Y_(this.textSizeData,l,m);for(let M=0;M<this.symbolInstances.length;M++){const L=this.symbolInstances.get(M);this._updateTextDebugCollisionBoxes(T,l,h,L.textBoxStartIndex,L.textBoxEndIndex,L,m),this._updateTextDebugCollisionBoxes(T,l,h,L.verticalTextBoxStartIndex,L.verticalTextBoxEndIndex,L,m),this._updateIconDebugCollisionBoxes(S,l,h,L.iconBoxStartIndex,L.iconBoxEndIndex,L,_),this._updateIconDebugCollisionBoxes(S,l,h,L.verticalIconBoxStartIndex,L.verticalIconBoxEndIndex,L,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(l,h,m,_,S,T,M,L,k){const F={};if(h<m){const{x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t,featureIndex:Dt}=l.get(h);F.textBox={x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t},F.textFeatureIndex=Dt}if(_<S){const{x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t,featureIndex:Dt}=l.get(_);F.verticalTextBox={x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t},F.verticalTextFeatureIndex=Dt}if(T<M){const{x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t,featureIndex:Dt}=l.get(T);F.iconBox={x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t},F.iconFeatureIndex=Dt}if(L<k){const{x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t,featureIndex:Dt}=l.get(L);F.verticalIconBox={x1:V,y1:U,x2:Z,y2:q,padding:Q,projectedAnchorX:it,projectedAnchorY:at,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:_t},F.verticalIconFeatureIndex=Dt}return F}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(l,h){const m=l.placedSymbolArray.get(h),_=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<_;S+=4)l.indexArray.emplaceBack(S,S+1,S+2),l.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(l),m=Math.cos(l),_=[],S=[],T=[];for(let M=0;M<this.symbolInstances.length;++M){T.push(M);const L=this.symbolInstances.get(M);_.push(0|Math.round(h*L.tileAnchorX+m*L.tileAnchorY)),S.push(L.featureIndex)}return T.sort((M,L)=>_[M]-_[L]||S[L]-S[M]),T}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let l=0;l<this.symbolInstances.length;++l)this.symbolInstanceIndexesSortedZOffset.push(l)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((l,h)=>this.symbolInstances.get(h).zOffset-this.symbolInstances.get(l).zOffset)}addToSortKeyRanges(l,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:S,leftJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:k}=m;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&S!==_&&this.addIndicesForPlacedSymbol(this.text,S),T>=0&&T!==S&&T!==_&&this.addIndicesForPlacedSymbol(this.text,T),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(l){const h=this.symbolInstances.get(this.text.symbolInstanceIndices[l]).elevationFeatureIndex;let m;return this.elevationFeatures&&h<this.elevationFeatures.length&&(m=this.elevationFeatures[h]),m}}function m4(d,l){return l.replace(/{([^{}]+)}/g,(h,m)=>m in d?String(d[m]):"")}let v4,_4,yP;si(M2,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),M2.addDynamicAttributes=ty;class y4{constructor(l){this.type=l.property.overrides?l.property.overrides.runtimeType:Zd,this.defaultValue=l}evaluate(l){if(l.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(l.formattedSection))return h.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}si(y4,"FormatSectionOverride",{omit:["defaultValue"]});const xP=()=>yP||(yP={layout:v4||(v4=new Yn({"symbol-placement":new Pe(Yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Pe(Yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pe(Yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ei(Yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pe(Yt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pe(Yt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Pe(Yt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Pe(Yt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pe(Yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pe(Yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pe(Yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ei(Yt.layout_symbol["icon-size"]),"icon-size-scale-range":new Pe(Yt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ei(Yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ei(Yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ei(Yt.layout_symbol["icon-image"]),"icon-image-use-theme":new Pe({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new ei(Yt.layout_symbol["icon-rotate"]),"icon-padding":new Pe(Yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Pe(Yt.layout_symbol["icon-keep-upright"]),"icon-offset":new ei(Yt.layout_symbol["icon-offset"]),"icon-anchor":new ei(Yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pe(Yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pe(Yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pe(Yt.layout_symbol["text-rotation-alignment"]),"text-field":new ei(Yt.layout_symbol["text-field"]),"text-font":new ei(Yt.layout_symbol["text-font"]),"text-size":new ei(Yt.layout_symbol["text-size"]),"text-size-scale-range":new Pe(Yt.layout_symbol["text-size-scale-range"]),"text-max-width":new ei(Yt.layout_symbol["text-max-width"]),"text-line-height":new ei(Yt.layout_symbol["text-line-height"]),"text-letter-spacing":new ei(Yt.layout_symbol["text-letter-spacing"]),"text-justify":new ei(Yt.layout_symbol["text-justify"]),"text-radial-offset":new ei(Yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pe(Yt.layout_symbol["text-variable-anchor"]),"text-anchor":new ei(Yt.layout_symbol["text-anchor"]),"text-max-angle":new Pe(Yt.layout_symbol["text-max-angle"]),"text-writing-mode":new Pe(Yt.layout_symbol["text-writing-mode"]),"text-rotate":new ei(Yt.layout_symbol["text-rotate"]),"text-padding":new Pe(Yt.layout_symbol["text-padding"]),"text-keep-upright":new Pe(Yt.layout_symbol["text-keep-upright"]),"text-transform":new ei(Yt.layout_symbol["text-transform"]),"text-offset":new ei(Yt.layout_symbol["text-offset"]),"text-allow-overlap":new Pe(Yt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pe(Yt.layout_symbol["text-ignore-placement"]),"text-optional":new Pe(Yt.layout_symbol["text-optional"]),visibility:new Pe(Yt.layout_symbol.visibility)})),paint:_4||(_4=new Yn({"icon-opacity":new ei(Yt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ei(Yt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ei(Yt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ei(Yt.paint_symbol["text-emissive-strength"]),"icon-color":new ei(Yt.paint_symbol["icon-color"]),"icon-halo-color":new ei(Yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ei(Yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ei(Yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Pe(Yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pe(Yt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Pe(Yt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ei(Yt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ei(Yt.paint_symbol["text-occlusion-opacity"]),"text-color":new ei(Yt.paint_symbol["text-color"],{runtimeType:Ss,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new ei(Yt.paint_symbol["text-halo-color"]),"text-halo-width":new ei(Yt.paint_symbol["text-halo-width"]),"text-halo-blur":new ei(Yt.paint_symbol["text-halo-blur"]),"text-translate":new Pe(Yt.paint_symbol["text-translate"]),"text-translate-anchor":new Pe(Yt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pe(Yt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pe(Yt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pe(Yt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pe(Yt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ei(Yt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},yP);class C2 extends Uo{constructor(l,h,m,_){super(l,xP(),h,m,_,l.layout?l.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=D([]),this.hasOcclusionOpacityProperties=l.paint!==void 0&&("icon-occlusion-opacity"in l.paint||"text-occlusion-opacity"in l.paint)}_handleSpecialPaintPropertyUpdate(l){l!=="icon-occlusion-opacity"&&l!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(l,h){super.recalculate(l,h),this.appearances&&this.appearances.forEach(_=>{_.recalculate(l,h,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const m=this.layout.get("text-writing-mode");if(m){const _=[];for(const S of m)_.indexOf(S)<0&&_.push(S);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(l,h,m,_){return this._saturation===l&&this._contrast===h&&this._brightnessMin===m&&this._brightnessMax===_||(this._colorAdjustmentMatrix=function(S,T,M,L){S=jn(S),T=Tn(T);const k=I(),F=S/3,V=1-2*F,U=[V,F,F,0,F,V,F,0,F,F,V,0,0,0,0,1],Z=.5-.5*T,q=L-M;return z(k,[q,0,0,0,0,q,0,0,0,0,q,0,M,M,M,1],[T,0,0,0,0,T,0,0,0,0,T,0,Z,Z,Z,1]),z(k,k,U),k}(l,h,m,_),this._saturation=l,this._contrast=h,this._brightnessMin=m,this._brightnessMax=_),this._colorAdjustmentMatrix}getValueAndResolveTokens(l,h,m,_){const S=this.layout.get(l).evaluate(h,{},m,_),T=this._unevaluatedLayout._values[l];return T.isDataDriven()||m_(T.value)||!S?S:m4(h.properties,S)}getAppearanceValueAndResolveTokens(l,h,m,_,S){const T=l.getProperty(h);if(!T)return;const M=T.evaluate(m,{},_,S),L=l.getUnevaluatedProperties()._values[h];return L.isDataDriven()||m_(L.value)||!M||typeof M!="string"?M:m4(m.properties,M)}createBucket(l){return new M2(l)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const l of xP().paint.overridableProperties){if(!C2.hasPaintOverride(this.layout,l))continue;const h=this.paint.get(l),m=new y4(h),_=new g_(m,h.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Ig("source",_):new Eu("composite",_,h.value.zoomStops,h.value.interpolationType),this.paint._values[l]=new Tl(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(l,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&C2.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,h){const m=l.get("text-field"),_=xP().paint.properties[h];let S=!1;const T=M=>{for(const L of M)if(_.overrides&&_.overrides.hasOverride(L))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Za)T(m.value.value.sections);else if(m.value.kind==="source"){const M=k=>{S||(k instanceof Gc&&Ha(k.value)===Lh?T(k.value.sections):k instanceof Rh?T(k.sections):k.eachChild(M))},L=m.value;L._styleExpression&&M(L._styleExpression.expression)}return S}getProgramIds(){return["symbol"]}getDefaultProgramParams(l,h,m){return{config:new Xc(this,{zoom:h,lut:m}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let x4,b4,w4,S4;var bP=gr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function E2(d,l,h,m,_,S,T,M){const L=[d,l,1,h,m,1,_,S,1],k=[T,M,1],F=y([],L),[V,U,Z]=Zt(k,k,F);return w(L,L,[V,0,0,0,U,0,0,0,Z])}function T4(d,l,h,m,_,S,T,M){const L=function(k,F,V,U,Z,q,Q,it){const at=E2(0,0,1,0,1,1,0,1),dt=E2(k,F,V,U,Z,q,Q,it);return w(dt,dt,y([],at))}(d,l,h,m,_,S,T,M);return[L[2]/L[8]/Ne,L[5]/L[8]/Ne]}function D2(d){return[d[0],Math.min(Math.max(d[1],-bt),bt)]}class A4 extends Nc{constructor(l,h,m,_){super(),this.id=l,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(_),this.options=h,this._dirty=!1}load(l,h){if(this._loaded=h||!1,this.fire(new js("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return l&&(this.coordinates=l),this._loaded=!0,void this._finishLoading();this._imageRequest=nx(this.map._requestManager.transformRequest(this.url,Eh.Image),(m,_)=>{this._imageRequest=null,this._loaded=!0,m?this.fire(new ag(m)):_&&(this.image=_ instanceof HTMLImageElement?ws.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading())})}loaded(){return this._loaded}updateImage(l){return l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}setTexture(l){if(!(l.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new R1(this.map.painter.context,l.handle),this.width=l.dimensions[0],this.height=l.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new js("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(l){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof R1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(l){if(this.coordinates=l,this._boundsArray=void 0,this._unsupportedCoords=!1,!l.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let h=l[0][1],m=l[0][1];for(const S of l)S[1]>m&&(m=S[1]),S[1]<h&&(h=S[1]);const _=(m+h)/2;if(_>bt?this.onNorthPole=!0:_<-bt&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const S=l.map(qt.fromLngLat);this.tileID=function(T){let M=1/0,L=1/0,k=-1/0,F=-1/0;for(const Q of T)M=Math.min(M,Q.x),L=Math.min(L,Q.y),k=Math.max(k,Q.x),F=Math.max(F,Q.y);const V=Math.max(k-M,F-L),U=Math.max(0,Math.floor(-Math.log2(V))),Z=Math.pow(2,U);let q=Math.floor((M+k)/2*Z);return q>1&&(q-=1),new Js(U,q,Math.floor((L+F)/2*Z))}(S),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new js("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof R1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(l){for(const at in this.tiles){const dt=this.tiles[at];dt.state!=="loaded"&&(dt.state="loaded",dt.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const h=G1(new Js(0,0,0),this.map.transform.projection),m=[h.projection.project(this.coordinates[0][0],this.coordinates[0][1]),h.projection.project(this.coordinates[1][0],this.coordinates[1][1]),h.projection.project(this.coordinates[2][0],this.coordinates[2][1]),h.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(at){const dt=at[1].x-at[0].x,mt=at[1].y-at[0].y,_t=at[2].x-at[1].x,Dt=at[2].y-at[1].y,At=at[3].x-at[2].x,Ot=at[3].y-at[2].y,Nt=at[0].x-at[3].x,Ht=at[0].y-at[3].y,se=dt*Dt-_t*mt,Kt=_t*Ot-At*Dt,le=At*Ht-Nt*Ot,ge=Nt*mt-dt*Ht;return se>0&&Kt>0&&le>0&&ge>0||se<0&&Kt<0&&le<0&&ge<0}(m))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const _=G1(this.tileID,this.map.transform.projection),[S,T,M,L]=this.coordinates.map(at=>{const dt=_.projection.project(at[0],at[1]);return u4(_,dt)._round()});this.perspectiveTransform=T4(S.x,S.y,T.x,T.y,M.x,M.y,L.x,L.y);const k=this._boundsArray=new yf;k.emplaceBack(S.x,S.y,0,0),k.emplaceBack(T.x,T.y,Ne,0),k.emplaceBack(L.x,L.y,0,Ne),k.emplaceBack(M.x,M.y,Ne,Ne),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=l.createVertexBuffer(k,bP.members),this.boundsSegments=Vn.simpleSegment(0,0,4,2);const F=[],V=[D2((U=this.coordinates)[0]),D2(U[1]),D2(U[2]),D2(U[3])];var U;const[Z,q,Q,it]=function(at){let dt=at[0][0],mt=dt,_t=at[0][1],Dt=_t;for(let At=1;At<at.length;At++)at[At][0]<dt?dt=at[At][0]:at[At][0]>mt&&(mt=at[At][0]),at[At][1]<_t?_t=at[At][1]:at[At][1]>Dt&&(Dt=at[At][1]);return[dt,_t,mt-dt,Dt-_t]}(V);{const at=new yf,[dt,mt,_t,Dt]=function(me){let Ee=me[0].x,ae=Ee,re=me[0].y,Ie=re;for(let Re=1;Re<me.length;Re++)me[Re].x<Ee?Ee=me[Re].x:me[Re].x>ae&&(ae=me[Re].x),me[Re].y<re?re=me[Re].y:me[Re].y>Ie&&(Ie=me[Re].y);return[Ee,re,ae-Ee,Ie-re]}(m),At=me=>[(me.x-dt)/_t,(me.y-mt)/Dt],[Ot,Nt,Ht,se]=m.map(At),Kt=function(me,Ee,ae,re,Ie,Re,xe,oi){const ui=E2(0,0,1,0,1,1,0,1);return w(ui,ui,y([],E2(me,Ee,ae,re,Ie,Re,xe,oi)))}(Ot[0],Ot[1],Nt[0],Nt[1],Ht[0],Ht[1],se[0],se[1]);this.elevatedGlobePerspectiveTransform=T4(Ot[0],Ot[1],Nt[0],Nt[1],Ht[0],Ht[1],se[0],se[1]);const le=(me,Ee)=>{F.push(me.lng);const ae=Math.round((me.lng-Z)/Q*Ne),re=Math.round((me.lat-q)/it*Ne),Ie=At(Ee),Re=Zt([],[Ie[0],Ie[1],1],Kt),xe=Math.round(Re[0]/Re[2]*Ne),oi=Math.round(Re[1]/Re[2]*Ne);at.emplaceBack(ae,re,xe,oi)},ge=m[3].x-m[0].x,Se=m[3].y-m[0].y,ze=m[2].x-m[1].x,De=m[2].y-m[1].y;for(let me=0;me<65;me++){const Ee=me/64,ae=[m[0].x+Ee*ge,m[0].y+Ee*Se],re=[m[1].x+Ee*ze,m[1].y+Ee*De],Ie=re[0]-ae[0],Re=re[1]-ae[1];for(let xe=0;xe<65;xe++){const oi=xe/64,ui={x:ae[0]+Ie*oi,y:ae[1]+Re*oi};le(h.projection.unproject(ui.x,ui.y),ui)}}this.elevatedGlobeVertexBuffer=l.createVertexBuffer(at,bP.members)}{this.maxLongitudeTriangleSize=0;let at=[],dt=new Pn;const mt=(_t,Dt,At)=>{dt.emplaceBack(_t,Dt,At);const Ot=F[_t],Nt=F[Dt],Ht=F[At],se=Math.min(Math.min(Ot,Nt),Ht),Kt=Math.max(Math.max(Ot,Nt),Ht)-se;Kt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Kt),at.push(se+Kt/2)};for(let _t=0;_t<64;_t++)for(let Dt=0;Dt<64;Dt++){const At=65*_t+Dt,Ot=At+1,Nt=At+65,Ht=Nt+1;mt(At,Nt,Ot),mt(Ot,Nt,Ht)}[at,dt]=function(_t,Dt){const At=Array.from({length:_t.length},(Ht,se)=>se);At.sort((Ht,se)=>_t[Ht]-_t[se]);const Ot=[],Nt=new Pn;for(let Ht=0;Ht<At.length;Ht++){const se=At[Ht];Ot.push(_t[se]);const Kt=3*se,le=Kt+1;Nt.emplaceBack(Dt.uint16[Kt],Dt.uint16[le],Dt.uint16[le+1])}return[Ot,Nt]}(at,dt),this.elevatedGlobeTrianglesCenterLongitudes=at,this.elevatedGlobeIndexBuffer=l.createIndexBuffer(dt)}this.elevatedGlobeSegments=Vn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Q/Ne,0,it/Ne,0,0,q,Z,0])}prepare(){const l=Object.keys(this.tiles).length!==0;if(this.tileID&&!l)return;const h=this.map.painter.context,m=h.gl;!this._dirty||this.texture instanceof R1||(this.texture?this.texture.update(this.image):(this.texture=new ZD(h,this.image,m.RGBA8),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this._dirty=!1),l&&this._prepareData(h)}loadTile(l,h){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},h(null)):(l.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(l){const h=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!h)return null;const m=this.elevatedGlobeTrianglesCenterLongitudes;let _=(S=l+180)+360*Math.round((m[0]-S)/360);var S;const T=new Vn,M=(V,U)=>{T.segments.push({vertexOffset:0,primitiveOffset:V,vertexLength:h.segments[0].vertexLength,primitiveLength:U,sortKey:void 0,vaos:{}})},L=.51*this.maxLongitudeTriangleSize;if(Math.abs(m[0]-_)<=L){const V=Sr(m,0,m.length,_+L);return V===m.length||M(V,en(m,V+1,m.length,_+360-L)-V),T}_<m[0]&&(_+=360);const k=en(m,0,m.length,_-L);if(k===m.length)return M(0,m.length),T;M(0,k-0);const F=Sr(m,k+1,m.length,_+L);return F!==m.length&&M(F,m.length-F),T}}const Tot=(Math.pow(256,2)-1)/16907520;class I4 extends Uo{constructor(l,h,m,_){super(l,{layout:w4||(w4=new Yn({visibility:new Pe(Yt.layout_raster.visibility)})),paint:S4||(S4=new Yn({"raster-opacity":new Pe(Yt.paint_raster["raster-opacity"]),"raster-color":new pf(Yt.paint_raster["raster-color"]),"raster-color-mix":new Pe(Yt.paint_raster["raster-color-mix"]),"raster-color-range":new Pe(Yt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pe(Yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pe(Yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pe(Yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Pe(Yt.paint_raster["raster-saturation"]),"raster-contrast":new Pe(Yt.paint_raster["raster-contrast"]),"raster-resampling":new Pe(Yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Pe(Yt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pe(Yt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pe(Yt.paint_raster["raster-array-band"]),"raster-elevation":new Pe(Yt.paint_raster["raster-elevation"]),"raster-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},h,m,_),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(l){return!(l&&l._source instanceof A4&&(l._source.onNorthPole||l._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(l){l!=="raster-color"&&l!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(l){if(!this.hasColorMap()||!this._curRampRange)return;const h=this._transitionablePaint._values["raster-color"].value.expression,[m,_]=l||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(m)&&isNaN(_)||m===this._curRampRange[0]&&_===this._curRampRange[1]||(this.colorRamp=_1({expression:h,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:m,end:_}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[m,_])}}let M4,C4,E4,D4,P4;class L4 extends Uo{constructor(l,h,m,_){super(l,{layout:M4||(M4=new Yn({visibility:new Pe(Yt["layout_raster-particle"].visibility)})),paint:C4||(C4=new Yn({"raster-particle-array-band":new Pe(Yt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pe(Yt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new pf(Yt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pe(Yt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pe(Yt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pe(Yt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pe(Yt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pe(Yt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},h,m,_),this._updateColorRamp(),this.lastInvalidatedAt=ws.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(l){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(l){return!1}_handleSpecialPaintPropertyUpdate(l){l!=="raster-particle-color"&&l!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),l==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const l=this._transitionablePaint._values["raster-particle-color"].value.expression,h=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=_1({expression:l,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:h}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ws.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Aot extends Uo{constructor(l,h){super(l,{},h,null),this.implementation=l,l.slot&&(this.slot=l.slot)}is3D(l){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(l){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)}onRemove(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)}}function wP(d,l,h){const m=[0,0,1],_=xr([]);return On(_,_,h?-wr(d)+Math.PI:wr(d)),tn(_,_,-wr(l)),pe(m,m,_),ye(m,m)}const R4={None:0,Model:1,Symbol:2,FillExtrusion:4};class P2{constructor(l,h,m,_){this.message=(l?`${l}: `:"")+m,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function SP(d,l){const h=d.indexOf("://")===-1;try{return new URL(d,h&&l?"http://example.com":void 0),!0}catch{return!1}}class k4{constructor(l,h){this.feature=l,this.instancedDataOffset=h,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class O4{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new P_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(l){const h=16*l,m=this.instancedDataArray.float32;let _=Math.floor(m[h+2]);const S=1.05*(m[h+2]-_);return _/=100,[m[h]%1*1.05,m[h+1]%1*1.05,S,_]}tileCoordinatesForInstance(l){const h=16*l,m=this.instancedDataArray.float32;let _=m[h+0];return _=_>Ne?_-Ne:_,new Ce(Math.trunc(_),Math.trunc(m[h+1]))}translationForInstance(l){const h=16*l,m=this.instancedDataArray.float32;return[m[h+4],m[h+5],m[h+6]]}rotationScaleForInstance(l){const h=16*l,m=this.instancedDataArray.float32;return[m[h+7],m[h+8],m[h+9],m[h+10],m[h+11],m[h+12],m[h+13],m[h+14],m[h+15]]}transformForInstance(l){const h=16*l,m=this.instancedDataArray.float32;return[m[h+7],m[h+8],m[h+9],m[h+4],m[h+10],m[h+11],m[h+12],m[h+5],m[h+13],m[h+14],m[h+15],m[h+6],0,0,0,1]}}class TP{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaledZ=this.canonical.z+Math.log2(l.overscaling),this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.projection=l.projection,this.index=l.index,this.worldview=l.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=l.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.tileToMeter=Lt(m);const S=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:T,id:M,index:L,sourceLayerIndex:k}of l){const F=M??(T.properties&&T.properties.hasOwnProperty("id")?T.properties.id:void 0),V=ee(T,S);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),V,m))continue;const U={id:F,sourceLayerIndex:k,index:L,geometry:S?V.geometry:de(T,m,_),properties:T.properties,type:T.type,patterns:{}},Z=this.addFeature(U,U.geometry,V);Z&&h.featureIndex.insert(T,U.geometry,L,k,this.index,this.instancesPerModel[Z].instancedDataArray.length,Ne/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const l=this.layers[0].modelManager,h=this.layers[0].scope;let m=0;for(const _ of this.modelUris){const S=l.getModel(_,h);if(!S)continue;const T=this.instancesPerModel[_];if(T){const M=.5*Pi(S.aabb.max,S.aabb.min)*T.maxScale+T.maxXYTranslationDistance,L=Math.min(Ne,Math.max(M/this.tileToMeter,Ne/32));m=Math.max(L,m)}}return m}update(l,h,m,_){for(const S in this.instancesPerModel){const T=this.instancesPerModel[S];for(const M in l)T.idToFeaturesIndex.hasOwnProperty(M)&&(this.evaluate(T.features[T.idToFeaturesIndex[M]],l[M],T,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let l=!1;for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];for(const _ of m.features){const S=this.layers[0],T=_.feature,M=this.canonical,L=S.paint.get("model-rotation").evaluate(T,{},M),k=S.paint.get("model-scale").evaluate(T,{},M),F=S.paint.get("model-translation").evaluate(T,{},M);He(_.rotation,L)&&He(_.scale,k)&&He(_.translation,F)||(this.evaluate(_,_.featureStates,m,!0),l=!0)}}return l}updateReplacement(l,h,m,_){if(h.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=h.updateTime;const S=h.getReplacementRegionsForTile(l.toUnwrapped(),!0);if(e2(this.activeReplacements,S))return!1;this.activeReplacements=S;let T=!1;for(const M in this.instancesPerModel){const L=this.instancesPerModel[M],k=L.instancedDataArray;for(const F of L.features){const V=F.instancedDataOffset,U=F.instancedDataCount;for(let Z=0;Z<U;Z++){const q=16*(Z+V);let Q=k.float32[q+0];const it=Q>Ne;Q=it?Q-Ne:Q;const at=Math.floor(Q),dt=Math.floor(k.float32[q+1]);let mt=!1;for(const _t of this.activeReplacements)if(!x5(_t,m,R4.Model,_)&&!(_t.min.x>at||at>_t.max.x||_t.min.y>dt||dt>_t.max.y)&&(mt=OD(T5(at,dt,l.canonical,_t.footprintTileId.canonical),_t.footprint),mt))break;k.float32[q]=mt?Q+Ne:Q,T=T||mt!==it}}}return T}isEmpty(){for(const l in this.instancesPerModel)if(this.instancesPerModel[l].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(l){if(!this.uploaded)for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];m.instancedDataArray.length<0||m.instancedDataArray.length===0||(m.instancedDataBuffer?m.instancedDataBuffer.updateData(m.instancedDataArray):m.instancedDataBuffer=l.createVertexBuffer(m.instancedDataArray,Jnt.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];m.instancedDataArray.length!==0&&m.instancedDataBuffer&&m.instancedDataBuffer.destroy()}const l=this.layers[0].modelManager;if(l&&this.modelUris&&this.modelsRequested)for(const h of this.modelUris)l.removeModel(h,"",!0)}addFeature(l,h,m){const _=this.layers[0],S=_.layout.get("model-id").evaluate(m,{},this.canonical);if(!S)return Mi(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),S;(SP(S,!1)||this.styleDefinedModelURLs[S]!==void 0)&&(this.modelUris.includes(S)||this.modelUris.push(S)),this.instancesPerModel[S]||(this.instancesPerModel[S]=new O4);const T=this.instancesPerModel[S],M=T.instancedDataArray,L=new k4(m,M.length);for(const k of h)for(const F of k){if(F.x<0||F.x>=Ne||F.y<0||F.y>=Ne)continue;if(this.lookupDim!==0){const U=(this.lookupDim-1)/Ne,Z=this.lookupDim*(F.y*U|0)+F.x*U|0;if(this.lookup){if(this.lookup[Z]!==0)continue;this.lookup[Z]=1}}this.instanceCount++;const V=M.length;M.resize(V+1),T.instancesEvaluatedElevation.push(0),M.float32[16*V]=F.x,M.float32[16*V+1]=F.y}return L.instancedDataCount=T.instancedDataArray.length-L.instancedDataOffset,L.instancedDataCount>0&&(l.id&&(T.idToFeaturesIndex[l.id]=T.features.length),T.features.push(L),this.evaluate(L,{},T,!1)),S}getModelUris(){return this.modelUris}evaluate(l,h,m,_){const S=this.layers[0],T=l.feature,M=this.canonical,L=l.rotation=S.paint.get("model-rotation").evaluate(T,h,M),k=l.scale=S.paint.get("model-scale").evaluate(T,h,M),F=l.translation=S.paint.get("model-translation").evaluate(T,h,M),V=Object.assign({},S.paint.get("model-color").evaluate(T,h,M));V.a=S.paint.get("model-color-mix-intensity").evaluate(T,h,M);const U=[];this.maxVerticalOffset<F[2]&&(this.maxVerticalOffset=F[2]);const Z=F[0]*F[0]+F[1]*F[1],q=Z>0?Math.sqrt(Z):0;m.maxScale=Math.max(Math.max(m.maxScale,k[0]),Math.max(k[1],k[2])),m.maxXYTranslationDistance=Math.max(m.maxXYTranslationDistance,q),this.maxScale=Math.max(Math.max(this.maxScale,k[0]),Math.max(k[1],k[2])),uV(U,L,k);const Q=Math.round(100*V.a)+V.b/1.05;for(let it=0;it<l.instancedDataCount;++it){const at=l.instancedDataOffset+it,dt=16*at,mt=m.instancedDataArray.float32;let _t=0;_&&(_t=mt[dt+6]-m.instancesEvaluatedElevation[at]);const Dt=0|mt[dt+1];mt[dt]=(0|mt[dt])+V.r/1.05,mt[dt+1]=Dt+V.g/1.05,mt[dt+2]=Q,mt[dt+3]=1/(M.z>10?this.tileToMeter:Lt(M,Dt)),mt[dt+4]=F[0],mt[dt+5]=F[1],mt[dt+6]=F[2]+_t,mt[dt+7]=U[0],mt[dt+8]=U[1],mt[dt+9]=U[2],mt[dt+10]=U[4],mt[dt+11]=U[5],mt[dt+12]=U[6],mt[dt+13]=U[8],mt[dt+14]=U[9],mt[dt+15]=U[10],m.instancesEvaluatedElevation[at]=F[2]}}}let z4,B4;si(TP,"ModelBucket",{omit:["layers"]}),si(O4,"PerModelAttributes"),si(k4,"ModelFeature");class ey{constructor(l,h,m){this._demTile=l,this._dem=this._demTile.dem,this._scale=h,this._offset=m}static create(l,h,m){const _=m||l.findDEMTileFor(h);if(!_||!_.dem)return;const S=_.dem,T=_.tileID,M=1<<h.canonical.z-T.canonical.z;return new ey(_,S.dim/Ne/M,[(h.canonical.x/M-T.canonical.x)*S.dim,(h.canonical.y/M-T.canonical.y)*S.dim])}tileCoordToPixel(l,h){const m=h*this._scale+this._offset[1];return new Ce(Math.floor(l*this._scale+this._offset[0]),Math.floor(m))}getElevationAt(l,h,m,_){const S=l*this._scale+this._offset[0],T=h*this._scale+this._offset[1],M=Math.floor(S),L=Math.floor(T),k=this._dem;return _=!!_,m?zi(zi(k.get(M,L,_),k.get(M,L+1,_),T-L),zi(k.get(M+1,L,_),k.get(M+1,L+1,_),T-L),S-M):k.get(M,L,_)}getElevationAtPixel(l,h,m){return this._dem.get(l,h,!!m)}getMeterToDEM(l){return(1<<this._demTile.tileID.canonical.z)*pt(1,l)*this._dem.stride}}const AP=new Float32Array(262144),jg=new Uint8Array(262144);function F4(d){let l=0;if(d.meshes)for(const h of d.meshes)l=Math.max(l,h.aabb.max[2]);if(d.children)for(const h of d.children)l=Math.max(l,F4(h));return l}function N4(d,l,h){if(d.meshes)for(const m of d.meshes){if(m.aabb.min[0]===1/0)continue;const _=cr.applyTransform(m.aabb,d.globalMatrix);h.insert(l,_.min[0],_.min[1],_.max[0],_.max[1])}if(d.children)for(const m of d.children)N4(m,l,h)}const V4=["","wall","door","roof","window","lamp","logo"];class U4{constructor(l){this.node=l,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:l.id,geometry:[],properties:{height:F4(l)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new cr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let l=0;const h=new cr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const m of this.node.meshes)this.node.lightMeshIndex!==l&&(m.transformedAabb=cr.applyTransformFast(m.aabb,this.node.globalMatrix),h.encapsulate(m.transformedAabb)),l++;this.aabb=h}return this.aabb}}class L2{constructor(l,h,m,_,S,T,M,L){this.id=m,this.layers=l,this.layerIds=this.layers.map(k=>k.fqid),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.modelTraits|=$_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,_&&(this.modelTraits|=$_.HasMapboxMeshFeatures),S&&(this.modelTraits|=$_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=T,this.worldview=L,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const k of h)this.nodesInfo.push(new U4(k)),N4(k,M.featureIndexArray.length,M.grid),M.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,M.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(l,h){for(const m of this.getNodesInfo()){const _=m.node;_.footprint&&h.push({footprint:_.footprint,id:l})}}updateAppearances(l,h,m,_){}update(l){const h=Object.keys(l).length!==0;if(h&&!this.stateDependentLayers.length)return;const m=h?this.stateDependentLayers:this.layers;if(!Bc(l,this.states))for(const _ of m)this.evaluate(_,l);this.states=structuredClone(l)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(l){if(!this.needsUpload)return;const h=this.getNodesInfo();for(const m of h){const _=m.node;this.uploaded?this.updatePbrBuffer(_):YD(_,l,!0)}for(const m of h)f2(m.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(l){let h=!1;if(!l.meshes)return h;for(const m of l.meshes)m.pbrBuffer&&(m.pbrBuffer.updateData(m.featureArray),h=!0);return h}needsReEvaluation(l,h,m){const _=l.transform.projectionOptions,S=l.style.getBrightness(),T=this.brightness!==S;if(!this.uploaded||this.dirty||_.name!==this.projection.name||Y1(m.paint.get("model-color").value,T)||Y1(m.paint.get("model-color-mix-intensity").value,T)||Y1(m.paint.get("model-roughness").value,T)||Y1(m.paint.get("model-emissive-strength").value,T)||Y1(m.paint.get("model-height-based-emissive-strength-multiplier").value,T)){this.projection=_,this.brightness=S;const M=this.getNodesInfo();for(const L of M)L.state=null;return!0}return!1}evaluateTransform(l,h){if(l.transform.zoom===this.zoom)return;this.zoom=l.transform.zoom;const m=this.getNodesInfo(),_=this.id.canonical;for(const S of m){const T=S.feature;S.evaluatedTranslation=h.paint.get("model-translation").evaluate(T,{},_),S.evaluatedScale=h.paint.get("model-scale").evaluate(T,{},_)}}evaluate(l,h){const m=this.getNodesInfo();for(const _ of m){if(!_.node.meshes)continue;const S=_.feature,T=h&&h[S.id];if(Bc(T,_.state))continue;_.state=structuredClone(T);const M=_.node.meshes&&_.node.meshes[0].featureData,L=_.evaluatedColor[2],k=_.evaluatedRMEA[2],F=this.id.canonical;if(_.hasTranslucentParts=!1,M){for(let V=0;V<V4.length;V++){const U=V4[V];U.length&&(S.properties.part=U);const Z=l.paint.get("model-color").evaluate(S,T,F).toPremultipliedRenderColor(null),q=l.paint.get("model-color-mix-intensity").evaluate(S,T,F);_.evaluatedColor[V]=[Z.r,Z.g,Z.b,q],_.evaluatedRMEA[V][0]=l.paint.get("model-roughness").evaluate(S,T,F),_.evaluatedRMEA[V][2]=l.paint.get("model-emissive-strength").evaluate(S,T,F),_.evaluatedRMEA[V][3]=Z.a,_.emissionHeightBasedParams[V]=l.paint.get("model-height-based-emissive-strength-multiplier").evaluate(S,T,F),!_.hasTranslucentParts&&Z.a<1&&(_.hasTranslucentParts=!0)}delete S.properties.part,Mot(_,L!==_.evaluatedColor[2]||k!==_.evaluatedRMEA[2],this.modelTraits)}else _.evaluatedRMEA[0][2]=l.paint.get("model-emissive-strength").evaluate(S,T,F);_.evaluatedTranslation=l.paint.get("model-translation").evaluate(S,T,F),_.evaluatedScale=l.paint.get("model-scale").evaluate(S,T,F),this.updatePbrBuffer(_.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(l,h,m,_){const S=l.findDEMTileFor(m);if(S&&(S.tileID.canonical!==this.terrainTile||h!==this.terrainExaggeration)){if(S.dem&&S.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=S.tileID.overscaledZ;const T=ey.create(l,m,S);if(!T)return;this.modelTraits&$_.HasMapboxMeshFeatures&&this.updateDEM(l,T,m,_);for(const M of this.getNodesInfo()){const L=M.node;if(!L.footprint||!L.footprint.vertices||!L.footprint.vertices.length)continue;const k=L.footprint.vertices;let F=T.getElevationAt(k[0].x,k[0].y,!0,!0);for(let V=1;V<k.length;V++)F=Math.min(F,T.getElevationAt(k[V].x,k[V].y,!0,!0));L.elevation=F}}this.terrainTile=S.tileID.canonical,this.terrainExaggeration=h}}updateDEM(l,h,m,_){let S=h._dem._modifiedForSources[_];if(S===void 0&&(h._dem._modifiedForSources[_]=[],S=h._dem._modifiedForSources[_]),S.includes(m.canonical))return;const T=h._dem.dim;S.push(m.canonical);let M=!1;for(const L of this.getNodesInfo()){const k=L.node;if(!k.footprint||!k.footprint.grid)continue;const F=k.footprint.grid,V=h.tileCoordToPixel(F.min.x,F.min.y),U=h.tileCoordToPixel(F.max.x,F.max.y),Z=Math.min(Math.min(T-U.y,V.x),Math.min(V.y,T-U.x));if(Z<0)continue;const q=ct(Z,2,5);let Q=Math.max(0,V.x-q),it=Math.max(0,V.y-q),at=Math.min(U.x+q,T-1),dt=Math.min(U.y+q,T-1);for(let At=it;At<=dt;++At)for(let Ot=Q;Ot<=at;++Ot)jg[At*T+Ot]=255;let mt=0,_t=0;for(let At=0;At<F.cellsY;++At)for(let Ot=0;Ot<F.cellsX;++Ot){if(!F.cells[At*F.cellsX+Ot])continue;const Nt=h.tileCoordToPixel(F.min.x+Ot/F.xScale,F.min.y+At/F.yScale),Ht=h.tileCoordToPixel(F.min.x+(Ot+1)/F.xScale,F.min.y+(At+1)/F.yScale);for(let se=Nt.y;se<=Math.min(Ht.y+1,T-1);++se)for(let Kt=Nt.x;Kt<=Math.min(Ht.x+1,T-1);++Kt)jg[se*T+Kt]===255&&(jg[se*T+Kt]=0,mt+=h.getElevationAtPixel(Kt,se),_t++)}const Dt=mt/_t;Q=Math.max(1,V.x-q),it=Math.max(1,V.y-q),at=Math.min(U.x+q,T-2),dt=Math.min(U.y+q,T-2),M=!0;for(let At=it;At<=dt;++At)for(let Ot=Q;Ot<=at;++Ot)jg[At*T+Ot]===0&&(AP[At*T+Ot]=h._dem.set(Ot,At,Dt));for(let At=1;At<q;++At){Q=Math.max(1,V.x-At),it=Math.max(1,V.y-At),at=Math.min(U.x+At,T-2),dt=Math.min(U.y+At,T-2);for(let Ot=it;Ot<=dt;++Ot)for(let Nt=Q;Nt<=at;++Nt){const Ht=Ot*T+Nt;if(jg[Ht]===255){let se=0,Kt=0,le=-1,ge=-1;for(let Se=-1;Se<=1;++Se)for(let ze=-1;ze<=1;++ze){const De=(Ot+Se)*T+Nt+ze;if(jg[De]>=At)continue;const me=AP[De],Ee=Math.abs(me);Ee>Kt&&(se=me,Kt=Ee,le=ze,ge=Se)}if(Kt>.1){const Se=1-(At+.5*Math.abs(le*ge))/q;let ze=h._dem.get(Nt,Ot)+se*Se;const De=h._dem.get(Nt+le,Ot+ge),me=h._dem.get(Nt-le,Ot-ge,!0);(ze-De)*(ze-me)>0&&(ze=(De+me)/2),AP[Ht]=h._dem.set(Nt,Ot,ze),jg[Ht]=At}}}}}M&&(h._demTile.needsDEMTextureUpload=!0,h._dem._timestamp=ws.now())}setFilter(l){this.filter=l?w_(l):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(l=>this.filter.filter(new xn(this.id.overscaledZ,{worldview:this.worldview}),l.feature,this.id.canonical)):this.nodesInfo}destroy(){const l=this.getNodesInfo();for(const h of l)f2(h.node),KD(h.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(l,h){if(h.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=h.updateTime;const m=h.getReplacementRegionsForTile(l.toUnwrapped());for(const _ of this.getNodesInfo()){const S=_.node.footprint;_.hiddenByReplacement=!!S&&!m.find(T=>T.footprint===S)}}getHeightAtTileCoord(l,h){const m=[],_=[0,0,0],S=D([]);for(const T of this.getNodesInfo()){const M=T.node.meshes[0],L=M.transformedAabb;if(l<L.min[0]||h<L.min[1]||l>L.max[0]||h>L.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};R(S,T.node.globalMatrix),_[0]=l,_[1]=h,zt(_,_,S);const k=(_[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*Ug|0,F=Math.min(63,(_[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*Ug|0)*Ug+Math.min(63,k),V=M.heightmap[F];if(!(V<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:V,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new Ce(l,h),new Ce(l,h),m),m.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function Y1(d,l){return d instanceof Ig&&!d.isLightConstant&&l}function Iot(d,l,h,m,_,S,T,M){let L=(61440&l|(61440&l)>>4)>>8,k=(3840&l|(3840&l)>>4)>>4,F=240&l|(240&l)>>4;h[3]>0&&(L=zi(L,255*h[0],h[3]),k=zi(k,255*h[1],h[3]),F=zi(F,255*h[2],h[3]));const V=L<<8|k,U=F<<8|Math.floor(255*m[3]),Z=function(At){const Ot=ct(At,0,2);return Math.min(Math.round(.5*Ot*255),255)}(m[2])<<8|15*m[0]<<4|15*m[1],q=ct(_[0],0,1),Q=ct(_[1],0,1),it=ct(_[2],0,1),at=ct(_[3],0,1);let dt,mt,_t,Dt;if(q!==Q&&T!==S&&Q!==q){const At=T-S;mt=1/(At*(Q-q)),_t=-(S+At*q)/(At*(Q-q));const Ot=ct(_[4],-1,1);Dt=Math.pow(10,Ot),dt=255*it<<8|255*at}else dt=65535,mt=0,_t=1,Dt=1;if(d.emplaceBack(V,U,Z,dt,mt,_t,Dt),M){const At=M.length;M.clear();for(let Ot=0;Ot<At;Ot++)M.emplaceBack(V,U,Z,dt,mt,_t,Dt)}}function Mot(d,l,h){const m=d.node;let _=0;const S=h&$_.HasMeshoptCompression;for(const T of m.meshes){if(m.lights&&m.lightMeshIndex===_||!T.featureData)continue;T.featureArray=new Tf,T.featureArray.reserve(T.featureData.length);let M=l;for(const L of T.featureData){const k=S?65535&L:L>>16&65535,F=S?L>>16&65535:65535&L,V=(15&F)<8?15&F:0,U=d.evaluatedRMEA[V],Z=d.evaluatedColor[V],q=d.emissionHeightBasedParams[V];let Q;if(M&&V===2&&m.lights&&(Q=new Tf,Q.resize(10*m.lights.length)),Iot(T.featureArray,k,Z,U,q,T.aabb.min[2],T.aabb.max[2],Q),Q&&M){M=!1;const it=m.meshes[m.lightMeshIndex];it.featureArray=Q,it.featureArray._trim()}}T.featureArray._trim(),_++}}si(L2,"Tiled3dModelBucket",{omit:["layers"]}),si(U4,"Tiled3dModelFeature");const Cot=["id","tile","layer","source","sourceLayer","state"];class Wg{constructor(l,h,m,_,S){this.type="Feature",this._vectorTileFeature=l,this._z=h,this._x=m,this._y=_,this.properties=l?l.properties:{},this.id=S}clone(){const l=new Wg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(l.state=Object.assign({},this.state)),this.layer&&(l.layer=Object.assign({},this.layer)),this.source&&(l.source=this.source),this.sourceLayer&&(l.sourceLayer=this.sourceLayer),l}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const h of Cot)this[h]!==void 0&&(l[h]=this[h]);return l}}class $g extends Nc{constructor(l,h,m,_){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=h,this._modelsInfo=new Map}load(){const l=[];for(const h in this._options.models){const m=this._options.models[h],_=this._modelsInfo.get(h);if(_){const S=_.model;S.position=m.position!=null?new Y(m.position[0],m.position[1]):new Y(0,0),S.orientation=m.orientation!=null?m.orientation:[0,0,0],_.modelSpec=m,$g.applyModelSpecification(S,m),S.computeBoundsAndApplyParent(),this.models.push(S)}else{const S=oV(this.map._requestManager.transformRequest(m.uri,Eh.Model).url).then(T=>{if(!T)return;const M=QD(T),L=new hV(h,m.uri,m.position,m.orientation,M);$g.applyModelSpecification(L,m),L.computeBoundsAndApplyParent(),this.models.push(L),this._modelsInfo.set(h,{modelSpec:m,model:L})}).catch(T=>{this.fire(new ag(new Error(`Could not load model ${h} from ${m.uri}: ${T.message}`)))});l.push(S)}}Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new js("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(h=>{this._loaded=!0,this.fire(new ag(new Error(`Could not load models: ${h.message}`)))})}static applyModelSpecification(l,h){h.nodeOverrides&&$g.convertNodeOverrides(l,h.nodeOverrides),h.materialOverrides&&$g.convertMaterialOverrides(l,h.materialOverrides),h.nodeOverrideNames&&(l.nodeOverrideNames=[...h.nodeOverrideNames]),h.materialOverrideNames&&(l.materialOverrideNames=[...h.materialOverrideNames]),h.featureProperties&&(l.featureProperties=h.featureProperties)}static convertNodeOverrides(l,h){if(Array.isArray(h)&&h.every(m=>typeof m=="string")){l.nodeOverrideNames=[];for(const m of h)l.nodeOverrideNames.push(m)}else Object.entries(h).forEach(([m,_])=>{const S={orientation:[0,0,0]};if(_.hasOwnProperty("orientation")){const T=_.orientation;T&&(S.orientation=T)}l.nodeOverrides.set(m,S)})}static convertMaterialOverrides(l,h){if(Array.isArray(h)&&h.every(m=>typeof m=="string")){l.materialOverrideNames=[];for(const m of h)l.materialOverrideNames.push(m)}else Object.entries(h).forEach(([m,_])=>{const S={color:new Xr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},T=_["model-color"];T!==void 0&&(S.color.r=T[0],S.color.g=T[1],S.color.b=T[2]);const M=_["model-color-mix-intensity"];M!==void 0&&(S.colorMix=M);const L=_["model-emissive-strength"];L!==void 0&&(S.emissionStrength=L);const k=_["model-opacity"];k!==void 0&&(S.opacity=k),l.materialOverrides.set(m,S)})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,h){}serialize(){return this._options}setProperty(l,h){return!1}reload(){const l=Gh(this.id,this.scope);this.map.style.clearSource(l),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(l){this.models=[];const h=new Map;for(const m in l){const _=l[m];if(this._modelsInfo.has(m)){const S=this._modelsInfo.get(m);S&&S.modelSpec.uri===_.uri&&h.set(m,S)}}this._modelsInfo=h,this._options.models=l,this._loaded=!1,this.load()}}function IP(d,l,h,m){const _=1<<d.z;l.lat=vt((m/Ne+d.y)/_),l.lng=xt((h/Ne+d.x)/_)}function Eot(d,l,h,m){const _=d.getNodesInfo()[l];if(!_||_.hiddenByReplacement||!_.node.meshes)return;let S=Number.MAX_VALUE;const T=_.node,M=h.tile,L=m.calculatePosMatrix(M.tileID.toUnwrapped(),m.worldSize),k=_.evaluatedScale;let F=0;m.elevation&&T.elevation&&(F=T.elevation*m.elevation.exaggeration()),N(L,L,[(T.anchor?T.anchor[0]:0)*(k[0]-1),(T.anchor?T.anchor[1]:0)*(k[1]-1),F]),H(L,L,k);const V=h.queryGeometry,U=V.isPointQuery()?V.screenBounds:V.screenGeometry,Z=function(Q){const it=z([],L,Q.globalMatrix);z(it,m.expandedFarZProjMatrix,it);for(let at=0;at<Q.meshes.length;++at){const dt=Q.meshes[at];if(at===Q.lightMeshIndex)continue;const mt=XD(U,m,it,dt.aabb);mt!=null&&(S=Math.min(mt,S))}if(Q.children)for(const at of Q.children)Z(at)};if(Z(T),S===Number.MAX_VALUE)return;const q=new Y(0,0);return IP(M.tileID.canonical,q,_.node.anchor[0],_.node.anchor[1]),{intersectionZ:S,position:q,feature:_.feature}}const Dot={circle:class extends Uo{constructor(d,l,h,m){super(d,{layout:Yc||(Yc=new Yn({"circle-sort-key":new ei(Yt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Pe(Yt.layout_circle["circle-elevation-reference"]),visibility:new Pe(Yt.layout_circle.visibility)})),paint:Mf||(Mf=new Yn({"circle-radius":new ei(Yt.paint_circle["circle-radius"]),"circle-color":new ei(Yt.paint_circle["circle-color"]),"circle-blur":new ei(Yt.paint_circle["circle-blur"]),"circle-opacity":new ei(Yt.paint_circle["circle-opacity"]),"circle-translate":new Pe(Yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Pe(Yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pe(Yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pe(Yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ei(Yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ei(Yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ei(Yt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pe(Yt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}createBucket(d){return new zn(d)}queryRadius(d){const l=d;return Xa("circle-radius",this,l)+Xa("circle-stroke-width",this,l)+$n(this.paint.get("circle-translate"))}queryIntersectsFeature(d,l,h,m,_,S,T,M){const L=If(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h);return ZN(d,m,S,T,M,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,k)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,l,h){const m=$N(this);return{config:new Xc(this,{zoom:l,lut:h}),defines:m,overrideFog:!1}}is3D(d){return!d&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Uo{createBucket(d){return new XN(d)}constructor(d,l,h,m){super(d,{layout:YN||(YN=new Yn({visibility:new Pe(Yt.layout_heatmap.visibility)})),paint:KN||(KN=new Yn({"heatmap-radius":new ei(Yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ei(Yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pe(Yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pf(Yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pe(Yt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(d){return Xa("heatmap-radius",this,d)}queryIntersectsFeature(d,l,h,m,_,S,T,M){const L=this.paint.get("heatmap-radius").evaluate(l,h);return ZN(d,m,S,T,M,!0,!0,new Ce(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,l,h){return d==="heatmap"?{config:new Xc(this,{zoom:l,lut:h}),overrideFog:!1}:{}}},hillshade:class extends Uo{constructor(d,l,h,m){super(d,{layout:JN||(JN=new Yn({visibility:new Pe(Yt.layout_hillshade.visibility)})),paint:QN||(QN=new Yn({"hillshade-illumination-direction":new Pe(Yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pe(Yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pe(Yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pe(Yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pe(Yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pe(Yt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pe(Yt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,l,h){return{overrideFog:!1}}},fill:class extends Uo{constructor(d,l,h,m){super(d,{layout:p5||(p5=new Yn({"fill-sort-key":new ei(Yt.layout_fill["fill-sort-key"]),visibility:new Pe(Yt.layout_fill.visibility),"fill-elevation-reference":new Pe(Yt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ei(Yt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:g5||(g5=new Yn({"fill-antialias":new Pe(Yt.paint_fill["fill-antialias"]),"fill-opacity":new ei(Yt.paint_fill["fill-opacity"]),"fill-color":new ei(Yt.paint_fill["fill-color"]),"fill-outline-color":new ei(Yt.paint_fill["fill-outline-color"]),"fill-translate":new Pe(Yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Pe(Yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ei(Yt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Pe(Yt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Pe(Yt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ei(Yt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ei(Yt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ei(Yt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}getProgramIds(){const d=this.paint.get("fill-pattern"),l=d&&d.constantOr(1),h=[l?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&h.push(l&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),h}getDefaultProgramParams(d,l,h){return{config:new Xc(this,{zoom:l,lut:h}),overrideFog:!1}}recalculate(d,l){super.recalculate(d,l);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new LD(d)}queryRadius(){return $n(this.paint.get("fill-translate"))}queryIntersectsFeature(d,l,h,m,_,S){return!d.queryGeometry.isAboveHorizon&&Kn(Ks(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),m)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(d){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const l=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return d!=null?l&&!d:l}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Uo{constructor(d,l,h,m){super(d,{layout:V5||(V5=new Yn({visibility:new Pe(Yt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pe(Yt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:U5||(U5=new Yn({"fill-extrusion-opacity":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new r2(d)}queryRadius(){return $n(this.paint.get("fill-extrusion-translate"))}is3D(d){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,l,h,m,_,S,T,M,L){const k=If(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(l,h),V=this.paint.get("fill-extrusion-base").evaluate(l,h),U=[0,0],Z=M&&S.elevation,q=S.elevation?S.elevation.exaggeration():1,Q=d.tile.getBucket(this);if(Z&&Q instanceof r2){const _t=Q.centroidVertexArray,Dt=L+1;Dt<_t.length&&(U[0]=_t.geta_centroid_pos0(Dt),U[1]=_t.geta_centroid_pos1(Dt))}if(U[0]===0&&U[1]===1)return!1;S.projection.name==="globe"&&(m=N5([m],[new Ce(0,0),new Ce(Ne,Ne)],d.tileID.canonical).map(_t=>_t.polygon).flat());const it=Z?M:null,[at,dt]=q5(S,m,V,F,k,T,it,U,q,S.center.lat,d.tileID.canonical),mt=d.queryGeometry;return Z5(at,dt,mt.isPointQuery()?mt.screenBounds:mt.screenGeometry)}},building:class extends Uo{constructor(d,l,h,m){super(d,{layout:yV||(yV=new Yn({visibility:new Pe(Yt.layout_building.visibility),"building-facade":new ei(Yt.layout_building["building-facade"]),"building-facade-floors":new ei(Yt.layout_building["building-facade-floors"]),"building-facade-unit-width":new ei(Yt.layout_building["building-facade-unit-width"]),"building-facade-window":new ei(Yt.layout_building["building-facade-window"]),"building-roof-shape":new ei(Yt.layout_building["building-roof-shape"]),"building-height":new ei(Yt.layout_building["building-height"]),"building-base":new ei(Yt.layout_building["building-base"]),"building-flood-light-wall-radius":new ei(Yt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new ei(Yt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new ei(Yt.layout_building["building-flip-roof-orientation"])})),paint:xV||(xV=new Yn({"building-opacity":new Pe(Yt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Pe(Yt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Pe(Yt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Pe(Yt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Pe(Yt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Pe(Yt.paint_building["building-vertical-scale"]),"building-cast-shadows":new Pe(Yt.paint_building["building-cast-shadows"]),"building-color":new ei(Yt.paint_building["building-color"]),"building-emissive-strength":new ei(Yt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Pe(Yt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Pe(Yt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Pe(Yt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Pe(Yt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Pe(Yt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new _V(d)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(d){return!0}queryRadius(d){return 0}queryIntersectsFeature(d,l,h,m,_,S,T,M,L){let k=this.layout.get("building-height").evaluate(l,h);const F=this.layout.get("building-base").evaluate(l,h),V=d.tile.getBucket(this).getFootprint(l);if(V){if(V.hiddenFlags!==0)return!1;k=V.height}const[U,Z]=q5(S,m,F,k,new Ce(0,0),T,null,[0,0],1,S.center.lat,d.tileID.canonical),q=d.queryGeometry;return Z5(U,Z,q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends Uo{constructor(d,l,h,m){const _=DV();super(d,_,l,h,m),_.layout&&(this.layout=new Uh(_.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(d){if(d==="line-gradient"){const l=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=l._styleExpression&&l._styleExpression.expression instanceof xg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,l){super.recalculate(d,l),this.paint._values["line-floorwidth"]=(()=>{if(O1)return O1;const h=DV();return O1=new Iat(h.paint.properties["line-width"].specification),O1.useIntegerZoom=!0,O1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new eP(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,l,h){const m=CV(this);return{config:new Xc(this,{zoom:l,lut:h}),defines:m,overrideFog:!1}}queryRadius(d){const l=d,h=PV(Xa("line-width",this,l),Xa("line-gap-width",this,l)),m=Xa("line-offset",this,l);return h/2+Math.abs(m)+$n(this.paint.get("line-translate"))}queryIntersectsFeature(d,l,h,m,_,S){if(d.queryGeometry.isAboveHorizon)return!1;const T=Ks(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),M=d.pixelToTileUnitsFactor/2*PV(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),L=this.paint.get("line-offset").evaluate(l,h);return L&&(m=function(k,F){const V=[],U=new Ce(0,0);for(let Z=0;Z<k.length;Z++){const q=k[Z],Q=[];for(let it=0;it<q.length;it++){const at=q[it],dt=q[it+1],mt=it===0?U:at.sub(q[it-1])._unit()._perp(),_t=it===q.length-1?U:dt.sub(at)._unit()._perp(),Dt=mt._add(_t)._unit();Dt._mult(1/(Dt.x*_t.x+Dt.y*_t.y)),Q.push(Dt._mult(F)._add(at))}V.push(Q)}return V}(m,L*d.pixelToTileUnitsFactor)),function(k,F,V){for(let U=0;U<F.length;U++){const Z=F[U];if(k.length>=3){for(let q=0;q<Z.length;q++)if(qa(k,Z[q]))return!0}if(ds(k,Z,V))return!0}return!1}(T,m,M)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(d){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:C2,background:class extends Uo{constructor(d,l,h,m){super(d,{layout:x4||(x4=new Yn({visibility:new Pe(Yt.layout_background.visibility)})),paint:b4||(b4=new Yn({"background-pitch-alignment":new Pe(Yt.paint_background["background-pitch-alignment"]),"background-color":new Pe(Yt.paint_background["background-color"]),"background-pattern":new Pe(Yt.paint_background["background-pattern"]),"background-opacity":new Pe(Yt.paint_background["background-opacity"]),"background-emissive-strength":new Pe(Yt.paint_background["background-emissive-strength"]),"background-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,l,h){return{overrideFog:!1}}is3D(d){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:I4,"raster-particle":L4,sky:class extends Uo{constructor(d,l,h,m){super(d,{layout:E4||(E4=new Yn({visibility:new Pe(Yt.layout_sky.visibility)})),paint:D4||(D4=new Yn({"sky-type":new Pe(Yt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pe(Yt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pe(Yt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pe(Yt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pe(Yt.paint_sky["sky-gradient-radius"]),"sky-gradient":new pf(Yt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pe(Yt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pe(Yt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pe(Yt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(d){d==="sky-gradient"?this._updateColorRamp():d!=="sky-atmosphere-sun"&&d!=="sky-atmosphere-halo-color"&&d!=="sky-atmosphere-color"&&d!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const l=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==l.azimuthal||this._lightPosition.polar!==l.polar}return!1}getCenter(d,l){if(this.paint.get("sky-type")==="atmosphere"){const m=this.paint.get("sky-atmosphere-sun"),_=!m,S=d.style.light,T=S.properties.get("position");return _&&S.properties.get("anchor")==="viewport"&&Mi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?wP(T.azimuthal,90-T.polar,l):wP(m[0],90-m[1],l)}const h=this.paint.get("sky-gradient-center");return wP(h[0],90-h[1],l)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return d==="atmosphere"?["skyboxCapture","skybox"]:d==="gradient"?["skyboxGradient"]:null}},slot:class extends Uo{constructor(d,l,h,m){super(d,{paint:P4||(P4=new Yn({}))},l,null)}},model:class extends Uo{constructor(d,l,h,m){super(d,{layout:z4||(z4=new Yn({visibility:new Pe(Yt.layout_model.visibility),"model-id":new ei(Yt.layout_model["model-id"])})),paint:B4||(B4=new Yn({"model-opacity":new ei(Yt.paint_model["model-opacity"]),"model-rotation":new ei(Yt.paint_model["model-rotation"]),"model-scale":new ei(Yt.paint_model["model-scale"]),"model-translation":new ei(Yt.paint_model["model-translation"]),"model-color":new ei(Yt.paint_model["model-color"]),"model-color-mix-intensity":new ei(Yt.paint_model["model-color-mix-intensity"]),"model-type":new Pe(Yt.paint_model["model-type"]),"model-cast-shadows":new Pe(Yt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pe(Yt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pe(Yt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ei(Yt.paint_model["model-emissive-strength"]),"model-roughness":new ei(Yt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ei(Yt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pe(Yt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pe(Yt.paint_model["model-front-cutoff"]),"model-elevation-reference":new Pe(Yt.paint_model["model-elevation-reference"]),"model-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this.layer=d,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new TP(d)}getProgramIds(){return["model"]}is3D(d){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof L2?Ne-1:0}queryRenderedFeatures(d,l,h){const m=l.getSource();if(!(m&&m instanceof $g))return{};const _=m,S={};S[this.id]=[];const T=S[this.id];let M=0;for(const L of _.models){const k=l.getFeatureState(this.sourceLayer,L.id),F={type:"Unknown",id:L.id,properties:L.featureProperties},V=this.paint.get("model-rotation").evaluate(F,k),U=this.paint.get("model-scale").evaluate(F,k),Z=this.paint.get("model-translation").evaluate(F,k),q=this.paint.get("model-elevation-reference");let Q=[];d2(Q,L,h,L.position,V,U,Z,q==="ground",q==="ground",!1),h.projection.name==="globe"&&(Q=h2(Q,h));const it=z([],h.projMatrix,Q),at=XD(d.isPointQuery()?d.screenBounds:d.screenGeometry,h,it,L.aabb);if(at!=null){const dt=new Wg(void 0,0,0,0,L.id);dt.layer=this.layer,dt.properties=structuredClone(L.featureProperties),dt.properties.layer=this.id,dt.properties.uri=L.uri,dt.properties.orientation=L.orientation,dt.sourceLayer=this.sourceLayer,dt.geometry={type:"Point",coordinates:[L.position.lng,L.position.lat]},dt.state=k,dt.source=this.source,T.push({featureIndex:M,feature:dt,intersectionZ:at})}++M}return S}queryIntersectsFeature(d,l,h,m,_,S){if(!this.modelManager)return!1;const T=this.modelManager,M=d.tile.getBucket(this);if(!(M&&M instanceof TP))return!1;for(const L in M.instancesPerModel){const k=M.instancesPerModel[L],F=l.id!==void 0?l.id:l.properties&&l.properties.hasOwnProperty("id")?l.properties.id:void 0;if(k.idToFeaturesIndex.hasOwnProperty(F)){const V=k.features[k.idToFeaturesIndex[F]],U=T.getModel(L,this.scope);if(!U)return!1;let Z=[];const q=new Y(0,0),Q=M.canonical;let it=Number.MAX_VALUE;for(let at=0;at<V.instancedDataCount;++at){const dt=16*(V.instancedDataOffset+at),mt=k.instancedDataArray.float32,_t=[mt[dt+4],mt[dt+5],mt[dt+6]];IP(Q,q,Math.floor(mt[dt]),Math.floor(mt[dt+1])),d2(Z,U,S,q,V.rotation,V.scale,_t,!1,!1,!1),S.projection.name==="globe"&&(Z=h2(Z,S));const Dt=z([],S.projMatrix,Z),At=d.queryGeometry,Ot=XD(At.isPointQuery()?At.screenBounds:At.screenGeometry,S,Dt,U.aabb);Ot!=null&&(it=Math.min(Ot,it))}return it!==Number.MAX_VALUE&&it}}return!1}_handleOverridablePaintPropertyUpdate(d,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven()||d!=="model-color"&&d!=="model-color-mix-intensity"&&d!=="model-rotation"&&d!=="model-scale"&&d!=="model-translation"&&d!=="model-emissive-strength")}_isPropertyZoomDependent(d){const l=this._transitionablePaint._values[d];return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof Eu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Uo{constructor(d,l,h,m){super(d,{layout:m5||(m5=new Yn({"clip-layer-types":new Pe(Yt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pe(Yt.layout_clip["clip-layer-scope"])})),paint:v5||(v5=new Yn({}))},l,h,m)}recalculate(d,l){super.recalculate(d,l)}createBucket(d){return new _5(d)}is3D(d){return!0}}},MP=new Xr(0,0,0),CP={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},EP={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},R2={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Pot={PAINT_ORDER_FILL_AND_STROKE:1},K1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},G4={MASK_TYPE_LUMINANCE:1};function Lot(d,l,h){d===1&&l.icons.push(function(m,_){return function(S){if(S.usvg_tree.height||(S.usvg_tree.height=S.usvg_tree.width),!S.metadata)return S;const{metadata:T}=S;if(T.content_area){const{content_area:M}=T;M.left==null&&(M.left=0),M.top==null&&(M.top=M.left),M.width==null&&(M.width=S.usvg_tree.width),M.height==null&&(M.height=M.width)}if(T.text_placeholder){const{text_placeholder:M}=T;M.top==null&&(M.top=M.left),M.height==null&&(M.height=M.width)}return T.stretch_x&&T.stretch_x.length&&H4(T,"x"),T.stretch_y&&T.stretch_y.length&&H4(T,"y"),S}(m.readFields(Rot,{name:void 0},_))}(h,h.readVarint()+h.pos))}function H4(d,l){const h=[],m=d[`stretch_${l}`];let _=null;for(let S=0;S<m.length;S++)_===null?_=h.length===0?m[0]:h[h.length-1][1]+m[S]:(h.push([_,_+m[S]]),_=null);d[`stretch_${l}_areas`]=h}function Rot(d,l,h){d===1?l.name=h.readString():d===2?l.metadata=function(m,_){return m.readFields(kot,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},_)}(h,h.readVarint()+h.pos):d===3&&(l.usvg_tree=function(m,_){return m.readFields(Bot,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},_)}(h,h.readVarint()+h.pos),l.data="usvg_tree")}function kot(d,l,h){d===1?l.stretch_x=h.readPackedVarint():d===2?l.stretch_y=h.readPackedVarint():d===3?l.content_area=j4(h,h.readVarint()+h.pos):d===4?l.variables.push(function(m,_){return m.readFields(zot,{name:void 0},_)}(h,h.readVarint()+h.pos)):d===5&&(l.text_placeholder=j4(h,h.readVarint()+h.pos))}function j4(d,l){return d.readFields(Oot,{},l)}function Oot(d,l,h){d===1?l.left=h.readVarint():d===2?l.width=h.readVarint():d===3?l.top=h.readVarint():d===4&&(l.height=h.readVarint())}function zot(d,l,h){d===1?l.name=h.readString():d===2&&(l.rgb_color=z2(h.readVarint()),l.value="rgb_color")}function Bot(d,l,h){d===1?l.width=l.height=h.readVarint():d===2?l.height=h.readVarint():d===3?l.children.push(k2(h,h.readVarint()+h.pos)):d===4?l.linear_gradients.push(function(m,_){return m.readFields(jot,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},_)}(h,h.readVarint()+h.pos)):d===5?l.radial_gradients.push(function(m,_){return m.readFields($ot,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},_)}(h,h.readVarint()+h.pos)):d===7?l.clip_paths.push(function(m,_){return m.readFields(Zot,{children:[]},_)}(h,h.readVarint()+h.pos)):d===8&&l.masks.push(function(m,_){const S=m.readFields(qot,{left:0,width:20,mask_type:G4.MASK_TYPE_LUMINANCE,children:[]},_);return S.height==null&&(S.height=S.width),S.top==null&&(S.top=S.left),S}(h,h.readVarint()+h.pos))}function k2(d,l){return d.readFields(Fot,{},l)}function Fot(d,l,h){d===1?(l.group=function(m,_){return m.readFields(Not,{opacity:255,children:[]},_)}(h,h.readVarint()+h.pos),l.node="group"):d===2&&(l.path=function(m,_){return m.readFields(Uot,{paint_order:1,commands:[],step:1,diffs:[],rule:CP.PATH_RULE_NON_ZERO},_)}(h,h.readVarint()+h.pos),l.node="path")}function Not(d,l,h){d===1?l.transform=O2(h,h.readVarint()+h.pos):d===2?l.opacity=h.readVarint():d===5?l.clip_path_idx=h.readVarint():d===6?l.mask_idx=h.readVarint():d===7&&l.children.push(k2(h,h.readVarint()+h.pos))}function O2(d,l){return d.readFields(Vot,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},l)}function Vot(d,l,h){d===1?l.sx=h.readFloat():d===2?l.ky=h.readFloat():d===3?l.kx=h.readFloat():d===4?l.sy=h.readFloat():d===5?l.tx=h.readFloat():d===6&&(l.ty=h.readFloat())}function Uot(d,l,h){d===1?l.fill=function(m,_){return m.readFields(Got,{rgb_color:MP,paint:"rgb_color",opacity:255},_)}(h,h.readVarint()+h.pos):d===2?l.stroke=function(m,_){return m.readFields(Hot,{rgb_color:MP,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},_)}(h,h.readVarint()+h.pos):d===3?l.paint_order=h.readVarint():d===5?h.readPackedVarint(l.commands):d===6?l.step=h.readFloat():d===7?h.readPackedSVarint(l.diffs):d===8&&(l.rule=h.readVarint())}function Got(d,l,h){d===1?(l.rgb_color=z2(h.readVarint()),l.paint="rgb_color"):d===2?(l.linear_gradient_idx=h.readVarint(),l.paint="linear_gradient_idx"):d===3?(l.radial_gradient_idx=h.readVarint(),l.paint="radial_gradient_idx"):d===5&&(l.opacity=h.readVarint())}function z2(d){return new Xr((d>>16&255)/255,(d>>8&255)/255,(255&d)/255,1)}function Hot(d,l,h){d===1?(l.rgb_color=z2(h.readVarint()),l.paint="rgb_color"):d===2?(l.linear_gradient_idx=h.readVarint(),l.paint="linear_gradient_idx"):d===3?(l.radial_gradient_idx=h.readVarint(),l.paint="radial_gradient_idx"):d===5?h.readPackedFloat(l.dasharray):d===6?l.dashoffset=h.readFloat():d===7?l.miterlimit=h.readFloat():d===8?l.opacity=h.readVarint():d===9?l.width=h.readFloat():d===10?l.linecap=h.readVarint():d===11&&(l.linejoin=h.readVarint())}function jot(d,l,h){d===1?l.transform=O2(h,h.readVarint()+h.pos):d===2?l.spread_method=h.readVarint():d===3?l.stops.push(W4(h,h.readVarint()+h.pos)):d===4?l.x1=h.readFloat():d===5?l.y1=h.readFloat():d===6?l.x2=h.readFloat():d===7&&(l.y2=h.readFloat())}function W4(d,l){return d.readFields(Wot,{offset:0,opacity:255,rgb_color:MP},l)}function Wot(d,l,h){d===1?l.offset=h.readFloat():d===2?l.opacity=h.readVarint():d===3&&(l.rgb_color=z2(h.readVarint()))}function $ot(d,l,h){d===1?l.transform=O2(h,h.readVarint()+h.pos):d===2?l.spread_method=h.readVarint():d===3?l.stops.push(W4(h,h.readVarint()+h.pos)):d===4?l.cx=h.readFloat():d===5?l.cy=h.readFloat():d===6?l.r=h.readFloat():d===7?l.fx=h.readFloat():d===8?l.fy=h.readFloat():d===9&&(l.fr=h.readFloat())}function Zot(d,l,h){d===1?l.transform=O2(h,h.readVarint()+h.pos):d===2?l.clip_path_idx=h.readVarint():d===3&&l.children.push(k2(h,h.readVarint()+h.pos))}function qot(d,l,h){d===1?l.left=l.top=h.readFloat():d===2?l.width=l.height=h.readFloat():d===3?l.top=h.readFloat():d===4?l.height=h.readFloat():d===5?l.mask_type=h.readVarint():d===6?l.mask_idx=h.readVarint():d===7&&l.children.push(k2(h,h.readVarint()+h.pos))}class Xot{static calculate(l={},h=[]){const m=new Map,_=new Map;if(Object.keys(l).length===0)return m;h.forEach(S=>{_.set(S.name,S.rgb_color||new Xr(0,0,0))});for(const[S,T]of Object.entries(l))_.has(S)?m.set(_.get(S).toString(),T):console.warn(`Ignoring unknown image variable "${S}"`);return m}}function iy(d,l=255,h){const m=l/255,_=d.toString(),S=h.has(_)?h.get(_).clone():d.clone();return S.a*=m,S.toString()}function J1(d,l){if(!bs()){const h=document.createElement("canvas");return h.width=d,h.height=l,h}return new OffscreenCanvas(d,l)}function Yot(d,l){const h=Xot.calculate(l.params,d.metadata?d.metadata.variables:[]),m=d.usvg_tree,_=m.width,S=m.height,T=l.transform?l.transform:new DOMMatrix,M=Math.max(1,Math.round(_*T.a)),L=Math.max(1,Math.round(S*T.d)),k=new DOMMatrix([M/_,0,0,L/S,0,0]),F=J1(M,L).getContext("2d");return DP(F,k,m,m,h),F.getImageData(0,0,M,L)}function DP(d,l,h,m,_){for(const S of m.children)$4(d,l,h,S,_)}function $4(d,l,h,m,_){m.group?(d.save(),function(S,T,M,L,k){const F=L.mask_idx!=null?M.masks[L.mask_idx]:null,V=L.clip_path_idx!=null?M.clip_paths[L.clip_path_idx]:null;if(L.transform&&(T=ry(L.transform).preMultiplySelf(T)),!function(q,Q,it){return q.opacity!==255||Q||it}(L,V!=null,F!=null))return void DP(S,T,M,L,k);const U=J1(S.canvas.width,S.canvas.height),Z=U.getContext("2d");DP(Z,T,M,L,k),V&&Q4(Z,T,M,V),F&&tU(Z,T,M,F,k),S.globalAlpha=L.opacity/255,S.drawImage(U,0,0)}(d,l,h,m.group,_),d.restore()):m.path&&(d.save(),function(S,T,M,L,k){S.setTransform(T),L.paint_order===Pot.PAINT_ORDER_FILL_AND_STROKE?(Z4(S,M,L,k),X4(S,M,L,k)):(X4(S,M,L,k),Z4(S,M,L,k))}(d,l,h,m.path,_),d.restore())}function Z4(d,l,h,m){const _=h.fill;if(!_)return;const S=_.opacity/255;switch(d.save(),d.beginPath(),eU(h,d),_.paint){case"rgb_color":d.fillStyle=iy(_.rgb_color,_.opacity,m);break;case"linear_gradient_idx":{const T=l.linear_gradients[_.linear_gradient_idx];T.transform&&d.setTransform(ry(T.transform).preMultiplySelf(d.getTransform())),d.fillStyle=Y4(d,T,S,m);break}case"radial_gradient_idx":{const T=l.radial_gradients[_.radial_gradient_idx];T.transform&&d.setTransform(ry(T.transform).preMultiplySelf(d.getTransform())),d.fillStyle=K4(d,T,S,m)}}d.fill(q4(h)),d.restore()}function q4(d){return d.rule===CP.PATH_RULE_NON_ZERO?"nonzero":d.rule===CP.PATH_RULE_EVEN_ODD?"evenodd":void 0}function X4(d,l,h,m){const _=h.stroke;if(!_)return;const S=iU(h);d.lineWidth=_.width,d.miterLimit=_.miterlimit,d.setLineDash(_.dasharray),d.lineDashOffset=_.dashoffset;const T=_.opacity/255;switch(_.paint){case"rgb_color":d.strokeStyle=iy(_.rgb_color,_.opacity,m);break;case"linear_gradient_idx":d.strokeStyle=Y4(d,l.linear_gradients[_.linear_gradient_idx],T,m,!0);break;case"radial_gradient_idx":d.strokeStyle=K4(d,l.radial_gradients[_.radial_gradient_idx],T,m,!0)}switch(_.linejoin){case R2.LINE_JOIN_MITER_CLIP:case R2.LINE_JOIN_MITER:d.lineJoin="miter";break;case R2.LINE_JOIN_ROUND:d.lineJoin="round";break;case R2.LINE_JOIN_BEVEL:d.lineJoin="bevel"}switch(_.linecap){case EP.LINE_CAP_BUTT:d.lineCap="butt";break;case EP.LINE_CAP_ROUND:d.lineCap="round";break;case EP.LINE_CAP_SQUARE:d.lineCap="square"}d.stroke(S)}function Y4(d,l,h,m,_=!1){if(l.stops.length===1){const U=l.stops[0];return iy(U.rgb_color,U.opacity*h,m)}const{x1:S,y1:T,x2:M,y2:L}=l;let k=new DOMPoint(S,T),F=new DOMPoint(M,L);if(_){const U=ry(l.transform);k=U.transformPoint(k),F=U.transformPoint(F)}const V=d.createLinearGradient(k.x,k.y,F.x,F.y);for(const U of l.stops)V.addColorStop(U.offset,iy(U.rgb_color,U.opacity*h,m));return V}function K4(d,l,h,m,_=!1){if(l.stops.length===1){const at=l.stops[0];return iy(at.rgb_color,at.opacity*h,m)}const S=ry(l.transform),{fx:T,fy:M,fr:L,cx:k,cy:F,r:V}=l;let U=new DOMPoint(T,M),Z=new DOMPoint(k,F),q=L,Q=V;if(_){U=S.transformPoint(U),Z=S.transformPoint(Z);const at=(S.a+S.d)/2;q=L*at,Q=l.r*at}const it=d.createRadialGradient(U.x,U.y,q,Z.x,Z.y,Q);for(const at of l.stops)it.addColorStop(at.offset,iy(at.rgb_color,at.opacity*h,m));return it}function J4(d,l,h,m){const _=m.transform?ry(m.transform).preMultiplySelf(l):l,S=J1(d.canvas.width,d.canvas.height),T=S.getContext("2d");for(const L of m.children)if(L.group)J4(T,_,h,L.group);else if(L.path){const k=L.path,F=new Path2D;F.addPath(iU(k),_),T.fill(F,q4(k))}const M=m.clip_path_idx!=null?h.clip_paths[m.clip_path_idx]:null;M&&Q4(T,_,h,M),d.globalCompositeOperation="source-over",d.drawImage(S,0,0)}function Q4(d,l,h,m){const _=J1(d.canvas.width,d.canvas.height);J4(_.getContext("2d"),l,h,m),d.globalCompositeOperation="destination-in",d.drawImage(_,0,0)}function tU(d,l,h,m,_){if(m.children.length===0)return;const S=m.mask_idx!=null?h.masks[m.mask_idx]:null;S&&tU(d,l,h,S,_);const T=d.canvas.width,M=d.canvas.height,L=J1(T,M),k=L.getContext("2d"),F=m.width,V=m.height,U=m.left,Z=m.top,q=new Path2D,Q=new Path2D;Q.rect(U,Z,F,V),q.addPath(Q,l),k.clip(q);for(const dt of m.children)$4(k,l,h,dt,_);const it=k.getImageData(0,0,T,M),at=it.data;if(m.mask_type===G4.MASK_TYPE_LUMINANCE)for(let dt=0;dt<at.length;dt+=4)at[dt+3]=at[dt+3]/255*(.2126*at[dt]+.7152*at[dt+1]+.0722*at[dt+2]);k.putImageData(it,0,0),d.globalCompositeOperation="destination-in",d.drawImage(L,0,0)}function ry(d){return d?new DOMMatrix([d.sx,d.ky,d.kx,d.sy,d.tx,d.ty]):new DOMMatrix}function eU(d,l){const h=d.step;let m=d.diffs[0]*h,_=d.diffs[1]*h;l.moveTo(m,_);for(let S=0,T=2;S<d.commands.length;S++)switch(d.commands[S]){case K1.PATH_COMMAND_MOVE:m+=d.diffs[T++]*h,_+=d.diffs[T++]*h,l.moveTo(m,_);break;case K1.PATH_COMMAND_LINE:m+=d.diffs[T++]*h,_+=d.diffs[T++]*h,l.lineTo(m,_);break;case K1.PATH_COMMAND_QUAD:{const M=m+d.diffs[T++]*h,L=_+d.diffs[T++]*h;m=M+d.diffs[T++]*h,_=L+d.diffs[T++]*h,l.quadraticCurveTo(M,L,m,_);break}case K1.PATH_COMMAND_CUBIC:{const M=m+d.diffs[T++]*h,L=_+d.diffs[T++]*h,k=M+d.diffs[T++]*h,F=L+d.diffs[T++]*h;m=k+d.diffs[T++]*h,_=F+d.diffs[T++]*h,l.bezierCurveTo(M,L,k,F,m,_);break}case K1.PATH_COMMAND_CLOSE:l.closePath()}return l}function iU(d){return eU(d,new Path2D)}class B2{constructor(l){this.capacity=l,this.cache=new Map}get(l){if(!this.cache.has(l))return;const h=this.cache.get(l);return this.cache.delete(l),this.cache.set(l,h),h}put(l,h){this.cache.has(l)?this.cache.delete(l):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(l,h)}delete(l){this.cache.delete(l)}}si(B2,"LRUCache");class PP{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(l){return new Mo(l,l.data)}getFromCache(l,h,m){return this.cacheMap.has(m)||this.cacheMap.set(m,new B2(150)),this.cacheMap.get(m).get(Gh(l.toString(),h))}setInCache(l,h,m,_){this.cacheDependenciesMap.has(_)||this.cacheDependenciesMap.set(_,new Map),this.cacheMap.has(_)||this.cacheMap.set(_,new B2(150));const S=this.cacheDependenciesMap.get(_),T=Gh(l.id.toString(),m);S.get(T)||S.set(T,new Set);const M=this.cacheMap.get(_),L=l.toString();S.get(T).add(L),M.put(Gh(l.toString(),m),h)}removeImagesFromCacheByIds(l,h,m=0){if(!this.cacheMap.has(m)||!this.cacheDependenciesMap.has(m))return;const _=this.cacheMap.get(m),S=this.cacheDependenciesMap.get(m);for(const T of l){const M=Gh(T.toString(),h);if(S.has(M)){for(const L of S.get(M))_.delete(L);S.delete(M)}}}rasterize(l,h,m,_,S=Yot){const T=this.getFromCache(l,m,_);if(T)return T.clone();const M=S(h.icon,l.options),L=PP._getImage(M);return this.setInCache(l,L,m,_),L.clone()}}class rU{constructor(l){this.size=l,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(l,h){const m=this.toIdx(l,h);return{min:this.minimums[m],max:this.maximums[m]}}isLeaf(l,h){return this.leaves[this.toIdx(l,h)]}toIdx(l,h){return h*this.size+l}}function nU(d,l,h,m){let _=0,S=Number.MAX_VALUE;for(let T=0;T<3;T++)if(Math.abs(m[T])<1e-15){if(h[T]<d[T]||h[T]>l[T])return null}else{const M=1/m[T];let L=(d[T]-h[T])*M,k=(l[T]-h[T])*M;if(L>k){const F=L;L=k,k=F}if(L>_&&(_=L),k<S&&(S=k),_>S)return null}return _}function aU(d,l,h,m,_,S,T,M,L,k,F){const V=m-d,U=_-l,Z=S-h,q=T-d,Q=M-l,it=L-h,at=F[1]*it-F[2]*Q,dt=F[2]*q-F[0]*it,mt=F[0]*Q-F[1]*q,_t=V*at+U*dt+Z*mt;if(Math.abs(_t)<1e-15)return null;const Dt=1/_t,At=k[0]-d,Ot=k[1]-l,Nt=k[2]-h,Ht=(At*at+Ot*dt+Nt*mt)*Dt;if(Ht<0||Ht>1)return null;const se=Ot*Z-Nt*U,Kt=Nt*V-At*Z,le=At*U-Ot*V,ge=(F[0]*se+F[1]*Kt+F[2]*le)*Dt;return ge<0||Ht+ge>1?null:(q*se+Q*Kt+it*le)*Dt}function oU(d,l,h){return(d-l)/(h-l)}function sU(d,l,h,m,_,S,T,M,L){const k=1<<h,F=S-m,V=T-_,U=(d+1)/k*F+m,Z=(l+0)/k*V+_,q=(l+1)/k*V+_;M[0]=(d+0)/k*F+m,M[1]=Z,L[0]=U,L[1]=q}class lU{constructor(l){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=l,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const h=function(S){const T=Math.ceil(Math.log2(S.dim/8)),M=[];let L=Math.ceil(Math.pow(2,T));const k=1/L,F=(Z,q,Q,it,at)=>{const dt=it?1:0,mt=(Z+1)*Q-dt,_t=q*Q,Dt=(q+1)*Q-dt;at[0]=Z*Q,at[1]=_t,at[2]=mt,at[3]=Dt};let V=new rU(L);const U=[];for(let Z=0;Z<L*L;Z++){F(Z%L,Math.floor(Z/L),k,!1,U);const q=kf(U[0],U[1],S),Q=kf(U[2],U[1],S),it=kf(U[2],U[3],S),at=kf(U[0],U[3],S);V.minimums.push(Math.min(q,Q,it,at)),V.maximums.push(Math.max(q,Q,it,at)),V.leaves.push(1)}for(M.push(V),L/=2;L>=1;L/=2){const Z=M[M.length-1];V=new rU(L);for(let q=0;q<L*L;q++){F(q%L,Math.floor(q/L),2,!0,U);const Q=Z.getElevation(U[0],U[1]),it=Z.getElevation(U[2],U[1]),at=Z.getElevation(U[2],U[3]),dt=Z.getElevation(U[0],U[3]),mt=Z.isLeaf(U[0],U[1]),_t=Z.isLeaf(U[2],U[1]),Dt=Z.isLeaf(U[2],U[3]),At=Z.isLeaf(U[0],U[3]),Ot=Math.min(Q.min,it.min,at.min,dt.min),Nt=Math.max(Q.max,it.max,at.max,dt.max),Ht=mt&&_t&&Dt&&At;V.maximums.push(Nt),V.minimums.push(Ot),V.leaves.push(Nt-Ot<=5&&Ht?1:0)}M.push(V)}return M}(this.dem),m=h.length-1,_=h[m];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(h,0,0,m,0)}raycastRoot(l,h,m,_,S,T,M=1){return nU([l,h,-100],[m,_,this.maximums[0]*M],S,T)}raycast(l,h,m,_,S,T,M=1){if(!this.nodeCount)return null;const L=this.raycastRoot(l,h,m,_,S,T,M);if(L==null)return null;const k=[],F=[],V=[],U=[],Z=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;Z.length>0;){const{idx:q,t:Q,nodex:it,nodey:at,depth:dt}=Z.pop();if(this.leaves[q]){sU(it,at,dt,l,h,m,_,V,U);const _t=1<<dt,Dt=(it+0)/_t,At=(it+1)/_t,Ot=(at+0)/_t,Nt=(at+1)/_t,Ht=kf(Dt,Ot,this.dem)*M,se=kf(At,Ot,this.dem)*M,Kt=kf(At,Nt,this.dem)*M,le=kf(Dt,Nt,this.dem)*M,ge=aU(V[0],V[1],Ht,U[0],V[1],se,U[0],U[1],Kt,S,T),Se=aU(U[0],U[1],Kt,V[0],U[1],le,V[0],V[1],Ht,S,T),ze=Math.min(ge!==null?ge:Number.MAX_VALUE,Se!==null?Se:Number.MAX_VALUE);if(ze!==Number.MAX_VALUE)return ze;{const De=li([],S,T,Q);if(cU(Ht,se,le,Kt,oU(De[0],V[0],U[0]),oU(De[1],V[1],U[1]))>=De[2])return Q}continue}let mt=0;for(let _t=0;_t<this._siblingOffset.length;_t++){sU((it<<1)+this._siblingOffset[_t][0],(at<<1)+this._siblingOffset[_t][1],dt+1,l,h,m,_,V,U),V[2]=-100,U[2]=this.maximums[this.childOffsets[q]+_t]*M;const Dt=nU(V,U,S,T);if(Dt!=null){const At=Dt;k[_t]=At;let Ot=!1;for(let Nt=0;Nt<mt&&!Ot;Nt++)At>=k[F[Nt]]&&(F.splice(Nt,0,_t),Ot=!0);Ot||(F[mt]=_t),mt++}}for(let _t=0;_t<mt;_t++){const Dt=F[_t];Z.push({idx:this.childOffsets[q]+Dt,t:k[Dt],nodex:(it<<1)+this._siblingOffset[Dt][0],nodey:(at<<1)+this._siblingOffset[Dt][1],depth:dt+1})}}return null}_addNode(l,h,m){return this.minimums.push(l),this.maximums.push(h),this.leaves.push(m),this.childOffsets.push(0),this.nodeCount++}_construct(l,h,m,_,S){if(l[_].isLeaf(h,m)===1)return;this.childOffsets[S]||(this.childOffsets[S]=this.nodeCount);const T=_-1,M=l[T];let L=0,k=0;for(let F=0;F<this._siblingOffset.length;F++){const V=2*h+this._siblingOffset[F][0],U=2*m+this._siblingOffset[F][1],Z=M.getElevation(V,U),q=M.isLeaf(V,U),Q=this._addNode(Z.min,Z.max,q);q&&(L|=1<<F),k||(k=Q)}for(let F=0;F<this._siblingOffset.length;F++)L&1<<F||this._construct(l,2*h+this._siblingOffset[F][0],2*m+this._siblingOffset[F][1],T,k+F)}}function cU(d,l,h,m,_,S){return zi(zi(d,h,S),zi(l,m,S),_)}function kf(d,l,h){const m=h.dim,_=ct(d*m-.5,0,m-1),S=ct(l*m-.5,0,m-1),T=Math.floor(_),M=Math.floor(S),L=Math.min(T+1,m-1),k=Math.min(M+1,m-1);return cU(h.get(T,M),h.get(L,M),h.get(T,k),h.get(L,k),_-T,S-M)}const Kot={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Jot(d,l,h){return(256*d*256+256*l+h)/10-1e4}function Qot(d,l,h){return 256*d+l+h/256-32768}class F2{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(l,h,m,_=!1){if(this.uid=l,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&m!=="mapbox"&&m!=="terrarium")return void Mi(`"${m}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const S=this.dim=h.height-2,T=new Uint32Array(h.data.buffer);if(this.pixels=new Uint8Array(h.data.buffer),this.floatView=new Float32Array(h.data.buffer),this.borderReady=_,this._modifiedForSources={},!_){for(let L=0;L<S;L++)T[this._idx(-1,L)]=T[this._idx(0,L)],T[this._idx(S,L)]=T[this._idx(S-1,L)],T[this._idx(L,-1)]=T[this._idx(L,0)],T[this._idx(L,S)]=T[this._idx(L,S-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(S,-1)]=T[this._idx(S-1,0)],T[this._idx(-1,S)]=T[this._idx(0,S-1)],T[this._idx(S,S)]=T[this._idx(S-1,S-1)]}const M=m==="terrarium"?Qot:Jot;for(let L=0;L<T.length;++L){const k=4*L;this.floatView[L]=M(this.pixels[k],this.pixels[k+1],this.pixels[k+2])}this._timestamp=ws.now()}_buildQuadTree(){this._tree=new lU(this)}get(l,h,m=!1){m&&(l=ct(l,-1,this.dim),h=ct(h,-1,this.dim));const _=this._idx(l,h);return this.floatView[_]}set(l,h,m){const _=this._idx(l,h),S=this.floatView[_];return this.floatView[_]=m,m-S}static getUnpackVector(l){return Kot[l]}_idx(l,h){if(l<-1||l>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(l+1)}static pack(l,h){const m=[0,0,0,0],_=F2.getUnpackVector(h);let S=Math.floor((l+_[3])/_[2]);return m[2]=S%256,S=Math.floor(S/256),m[1]=S%256,S=Math.floor(S/256),m[0]=S,m}getPixels(){return new i5({width:this.stride,height:this.stride},this.pixels)}backfillBorder(l,h,m){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,S=h*this.dim+this.dim,T=m*this.dim,M=m*this.dim+this.dim;switch(h){case-1:_=S-1;break;case 1:S=_+1}switch(m){case-1:T=M-1;break;case 1:M=T+1}const L=-h*this.dim,k=-m*this.dim;for(let F=T;F<M;F++)for(let V=_;V<S;V++){const U=4*this._idx(V,F),Z=4*this._idx(V+L,F+k);this.pixels[U+0]=l.pixels[Z+0],this.pixels[U+1]=l.pixels[Z+1],this.pixels[U+2]=l.pixels[Z+2],this.pixels[U+3]=l.pixels[Z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function tst(d,l,h){d===1?l.headerLength=h.readFixed32():d===2?l.x=h.readVarint():d===3?l.y=h.readVarint():d===4?l.z=h.readVarint():d===5&&l.layers.push(function(m,_){return m.readFields(ast,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},_)}(h,h.readVarint()+h.pos))}function est(d,l,h){d===1?(l.delta_filter=function(m,_){return m.readFields(ist,{blockSize:0},_)}(h,h.readVarint()+h.pos),l.filter="delta_filter"):d===2?(h.readVarint(),l.filter="zigzag_filter"):d===3?(h.readVarint(),l.filter="bitshuffle_filter"):d===4&&(h.readVarint(),l.filter="byteshuffle_filter")}function ist(d,l,h){d===1&&(l.blockSize=h.readVarint())}function rst(d,l,h){d===1?(h.readVarint(),l.codec="gzip_data"):d===2?(h.readVarint(),l.codec="jpeg_image"):d===3?(h.readVarint(),l.codec="webp_image"):d===4&&(h.readVarint(),l.codec="png_image")}function nst(d,l,h){let m=0,_=0;d===1?l.firstByte=h.readFixed64():d===2?l.lastByte=h.readFixed64():d===3?l.filters.push(function(S,T){return S.readFields(est,{},T)}(h,h.readVarint()+h.pos)):d===4?l.codec=function(S,T){return S.readFields(rst,{},T)}(h,h.readVarint()+h.pos):d===5?_=h.readFloat():d===6?m=h.readFloat():d===7?l.bands.push(h.readString()):d===8?l.offset=h.readDouble():d===9&&(l.scale=h.readDouble()),l.offset===0&&(l.offset=_),l.scale===0&&(l.scale=m)}function ast(d,l,h){d===1?l.version=h.readVarint():d===2?l.name=h.readString():d===3?l.units=h.readString():d===4?l.tileSize=h.readVarint():d===5?l.buffer=h.readVarint():d===6?l.pixelFormat=h.readVarint():d===7&&l.dataIndex.push(function(m,_){return m.readFields(nst,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},_)}(h,h.readVarint()+h.pos))}function ost(d,l,h){if(d===2)(function(m,_,S){m.readFields(sst,S,_)})(h,h.readVarint()+h.pos,l);else if(d===3)throw new Error("Not implemented")}function sst(d,l,h){if(d===1){let m=0;const _=h.readVarint()+h.pos;for(;h.pos<_;)l[m++]=h.readVarint()}}function lst(d,l){if(l.length!==4)throw new Error(`Expected data of dimension 4 but got ${l.length}.`);let h=l[3];for(let m=2;m>=1;m--){const _=m===1?1:0,S=m===2?1:0;for(let T=0;T<l[0];T++){const M=l[1]*T;for(let L=_;L<l[1];L++){const k=l[2]*(L+M);for(let F=S;F<l[2];F++){const V=l[3]*(F+k);for(let U=0;U<l[3];U++){const Z=V+U;d[Z]+=d[Z-h]}}}}h*=l[m]}return d}function cst(d){for(let l=0,h=d.length;l<h;l++)d[l]=d[l]>>>1^-(1&d[l]);return d}function ust(d,l){switch(l){case"uint32":return d;case"uint16":for(let h=0;h<d.length;h+=2){const m=d[h],_=d[h+1];d[h]=(240&m)>>4|(61440&m)>>8|(240&_)<<4|61440&_,d[h+1]=15&m|(3840&m)>>4|(15&_)<<8|(3840&_)<<4}return d;case"uint8":for(let h=0;h<d.length;h+=4){const m=d[h],_=d[h+1],S=d[h+2],T=d[h+3];d[h+0]=(192&m)>>6|(192&_)>>4|(192&S)>>2|192&T,d[h+1]=(48&m)>>4|(48&_)>>2|48&S|(48&T)<<2,d[h+2]=(12&m)>>2|12&_|(12&S)<<2|(12&T)<<4,d[h+3]=3&m|(3&_)<<2|(3&S)<<4|(3&T)<<6}return d;default:throw new Error(`Invalid pixel format, "${l}"`)}}si(F2,"DEMData"),si(lU,"DemMinMaxQuadTree",{omit:["dem"]});var Ul=Uint8Array,Q1=Uint16Array,hst=Int32Array,uU=new Ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hU=new Ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dst=new Ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dU=function(d,l){for(var h=new Q1(31),m=0;m<31;++m)h[m]=l+=1<<d[m-1];var _=new hst(h[30]);for(m=1;m<30;++m)for(var S=h[m];S<h[m+1];++S)_[S]=S-h[m]<<5|m;return{b:h,r:_}},fU=dU(uU,2),pU=fU.b,fst=fU.r;pU[28]=258,fst[258]=28;for(var pst=dU(hU,0).b,gU=new Q1(32768),Fa=0;Fa<32768;++Fa){var ny=(43690&Fa)>>1|(21845&Fa)<<1;gU[Fa]=((65280&(ny=(61680&(ny=(52428&ny)>>2|(13107&ny)<<2))>>4|(3855&ny)<<4))>>8|(255&ny)<<8)>>1}var tb=function(d,l,h){for(var m=d.length,_=0,S=new Q1(l);_<m;++_)d[_]&&++S[d[_]-1];var T,M=new Q1(l);for(_=1;_<l;++_)M[_]=M[_-1]+S[_-1]<<1;T=new Q1(1<<l);var L=15-l;for(_=0;_<m;++_)if(d[_])for(var k=_<<4|d[_],F=l-d[_],V=M[d[_]-1]++<<F,U=V|(1<<F)-1;V<=U;++V)T[gU[V]>>L]=k;return T},eb=new Ul(288);for(Fa=0;Fa<144;++Fa)eb[Fa]=8;for(Fa=144;Fa<256;++Fa)eb[Fa]=9;for(Fa=256;Fa<280;++Fa)eb[Fa]=7;for(Fa=280;Fa<288;++Fa)eb[Fa]=8;var mU=new Ul(32);for(Fa=0;Fa<32;++Fa)mU[Fa]=5;var gst=tb(eb,9),mst=tb(mU,5),LP=function(d){for(var l=d[0],h=1;h<d.length;++h)d[h]>l&&(l=d[h]);return l},tu=function(d,l,h){var m=l/8|0;return(d[m]|d[m+1]<<8)>>(7&l)&h},RP=function(d,l){var h=l/8|0;return(d[h]|d[h+1]<<8|d[h+2]<<16)>>(7&l)},vst=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eu=function(d,l,h){var m=new Error(l||vst[d]);if(m.code=d,Error.captureStackTrace&&Error.captureStackTrace(m,eu),!h)throw m;return m},_st=new Ul(0),yst=typeof TextDecoder<"u"&&new TextDecoder;try{yst.decode(_st,{stream:!0})}catch{}const xst={gzip_data:"gzip"};class pc extends Error{constructor(l){super(l),this.name="MRTError"}}const bst={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},vU={uint32:1,uint16:2,uint8:4},wst={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let kP;class N2{constructor(l=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=l}getLayer(l){const h=this.layers[l];if(!h)throw new pc(`Layer '${l}' not found`);return h}getHeaderLength(l){const h=new Uint8Array(l),m=new DataView(l);if(h[0]!==13)throw new pc("File is not a valid MRT.");return m.getUint32(1,!0)}parseHeader(l){const h=new Uint8Array(l),m=this.getHeaderLength(l);if(h.length<m)throw new pc(`Expected header with length >= ${m} but got buffer of length ${h.length}`);const _=new kP(h.subarray(0,m)).readFields(tst,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==_.x||this.y!==_.y||this.z!==_.z))throw new pc(`Invalid attempt to parse header ${_.z}/${_.x}/${_.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=_.x,this.y=_.y,this.z=_.z;for(const S of _.layers)this.layers[S.name]=new _U(S,{cacheSize:this._cacheSize});return this}createDecodingTask(l){const h=[],m=this.getLayer(l.layerName);for(let _ of l.blockIndices){const S=m.dataIndex[_],T=S.firstByte-l.firstByte,M=S.lastByte-l.firstByte;if(m._blocksInProgress.has(_))continue;const L={layerName:m.name,firstByte:T,lastByte:M,pixelFormat:m.pixelFormat,blockIndex:_,blockShape:[S.bands.length].concat(m.bandShape),buffer:m.buffer,codec:S.codec.codec,filters:S.filters.map(k=>k.filter)};m._blocksInProgress.add(_),h.push(L)}return new yU(h,()=>{h.forEach(_=>m._blocksInProgress.delete(_.blockIndex))},(_,S)=>{if(h.forEach(T=>m._blocksInProgress.delete(T.blockIndex)),_)throw _;S.forEach(T=>{this.getLayer(T.layerName).processDecodedData(T)})})}}class _U{constructor({version:l,name:h,units:m,tileSize:_,pixelFormat:S,buffer:T,dataIndex:M},L){if(this.version=l,this.version!==1)throw new pc(`Cannot parse raster layer encoded with MRT version ${l}`);this.name=h,this.units=m,this.tileSize=_,this.buffer=T,this.pixelFormat=bst[S],this.dataIndex=M,this.bandShape=[_+2*T,_+2*T,vU[this.pixelFormat]],this._decodedBlocks=new B2(L?L.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return vU[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:l})=>l).flat()}processDecodedData(l){const h=l.blockIndex.toString();this._decodedBlocks.get(h)||this._decodedBlocks.put(h,l.data)}getBlockForBand(l){let h=0;switch(typeof l){case"string":for(const[m,_]of this.dataIndex.entries()){for(const[S,T]of _.bands.entries())if(T===l)return{bandIndex:h+S,blockIndex:m,blockBandIndex:S};h+=_.bands.length}break;case"number":for(const[m,_]of this.dataIndex.entries()){if(l>=h&&l<h+_.bands.length)return{bandIndex:l,blockIndex:m,blockBandIndex:l-h};h+=_.bands.length}break;default:throw new pc(`Invalid band \`${JSON.stringify(l)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(l){let h=1/0,m=-1/0;const _=[],S=new Set;for(const T of l){const{blockIndex:M}=this.getBlockForBand(T);if(M<0)throw new pc(`Invalid band: ${JSON.stringify(T)}`);const L=this.dataIndex[M];_.includes(M)||_.push(M),S.add(M),h=Math.min(h,L.firstByte),m=Math.max(m,L.lastByte)}if(S.size>this.cacheSize)throw new pc(`Number of blocks to decode (${S.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:h,lastByte:m,blockIndices:_}}hasBand(l){const{blockIndex:h}=this.getBlockForBand(l);return h>=0}hasDataForBand(l){const{blockIndex:h}=this.getBlockForBand(l);return h>=0&&!!this._decodedBlocks.get(h.toString())}getBandView(l){const{blockIndex:h,blockBandIndex:m}=this.getBlockForBand(l);if(h<0)throw new pc(`Band not found: ${JSON.stringify(l)}`);const _=this._decodedBlocks.get(h.toString());if(!_)throw new pc(`Data for band ${JSON.stringify(l)} of layer "${this.name}" not decoded.`);const S=this.dataIndex[h],T=this.bandShape.reduce((k,F)=>k*F,1),M=m*T,L=_.subarray(M,M+T);return{data:L,bytes:new Uint8Array(L.buffer).subarray(L.byteOffset,L.byteOffset+L.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:S.offset,scale:S.scale}}}N2.setPbf=function(d){kP=d};class yU{constructor(l,h,m){this.tasks=l,this._onCancel=h,this._onComplete=m,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(l,h){this._finalized||(this._onComplete(l,h),this._finalized=!0)}}N2.performDecoding=function(d,l){const h=new Uint8Array(d);return Promise.all(l.tasks.map(m=>{const{layerName:_,firstByte:S,lastByte:T,pixelFormat:M,blockShape:L,blockIndex:k,filters:F,codec:V}=m,U=h.subarray(S,T+1),Z=new Uint32Array(L[0]*L[1]*L[2]);let q;if(V!=="gzip_data")throw new pc(`Unhandled codec: ${V}`);return q=function(Q,it){if(!globalThis.DecompressionStream&&it==="gzip_data")return Promise.resolve(((_t=function(Ot){Ot[0]==31&&Ot[1]==139&&Ot[2]==8||eu(6,"invalid gzip data");var Nt=Ot[3],Ht=10;4&Nt&&(Ht+=2+(Ot[10]|Ot[11]<<8));for(var se=(Nt>>3&1)+(Nt>>4&1);se>0;se-=!Ot[Ht++]);return Ht+(2&Nt)}(mt=Q))+8>mt.length&&eu(6,"invalid gzip data"),function(Ot,Nt,Ht,se){var Kt=Ot.length;if(!Kt||Nt.f&&!Nt.l)return Ht||new Ul(0);var le=!Ht,ge=le||Nt.i!=2,Se=Nt.i;le&&(Ht=new Ul(3*Kt));var ze,De,me=function(Zn){var Mn=Ht.length;if(Zn>Mn){var mn=new Ul(Math.max(2*Mn,Zn));mn.set(Ht),Ht=mn}},Ee=Nt.f||0,ae=Nt.p||0,re=Nt.b||0,Ie=Nt.l,Re=Nt.d,xe=Nt.m,oi=Nt.n,ui=8*Kt;do{if(!Ie){Ee=tu(Ot,ae,1);var ri=tu(Ot,ae+1,3);if(ae+=3,!ri){var Xe=Ot[(It=4+((ae+7)/8|0))-4]|Ot[It-3]<<8,ji=It+Xe;if(ji>Kt){Se&&eu(0);break}ge&&me(re+Xe),Ht.set(Ot.subarray(It,ji),re),Nt.b=re+=Xe,Nt.p=ae=8*ji,Nt.f=Ee;continue}if(ri==1)Ie=gst,Re=mst,xe=9,oi=5;else if(ri==2){var Qe=tu(Ot,ae,31)+257,Ii=tu(Ot,ae+10,15)+4,Zi=Qe+tu(Ot,ae+5,31)+1;ae+=14;for(var fr=new Ul(Zi),Pr=new Ul(19),qi=0;qi<Ii;++qi)Pr[dst[qi]]=tu(Ot,ae+3*qi,7);ae+=3*Ii;var Br=LP(Pr),Fr=(1<<Br)-1,Bn=tb(Pr,Br);for(qi=0;qi<Zi;){var It,wt=Bn[tu(Ot,ae,Fr)];if(ae+=15&wt,(It=wt>>4)<16)fr[qi++]=It;else{var ce=0,je=0;for(It==16?(je=3+tu(Ot,ae,3),ae+=2,ce=fr[qi-1]):It==17?(je=3+tu(Ot,ae,7),ae+=3):It==18&&(je=11+tu(Ot,ae,127),ae+=7);je--;)fr[qi++]=ce}}var ue=fr.subarray(0,Qe),Je=fr.subarray(Qe);xe=LP(ue),oi=LP(Je),Ie=tb(ue,xe),Re=tb(Je,oi)}else eu(1);if(ae>ui){Se&&eu(0);break}}ge&&me(re+131072);for(var vi=(1<<xe)-1,gi=(1<<oi)-1,Ji=ae;;Ji=ae){var Ri=(ce=Ie[RP(Ot,ae)&vi])>>4;if((ae+=15&ce)>ui){Se&&eu(0);break}if(ce||eu(2),Ri<256)Ht[re++]=Ri;else{if(Ri==256){Ji=ae,Ie=null;break}var di=Ri-254;Ri>264&&(di=tu(Ot,ae,(1<<(Oi=uU[qi=Ri-257]))-1)+pU[qi],ae+=Oi);var zr=Re[RP(Ot,ae)&gi],ln=zr>>4;if(zr||eu(3),ae+=15&zr,Je=pst[ln],ln>3){var Oi=hU[ln];Je+=RP(Ot,ae)&(1<<Oi)-1,ae+=Oi}if(ae>ui){Se&&eu(0);break}ge&&me(re+131072);var Cr=re+di;if(re<Je){var cn=0-Je,Yr=Math.min(Je,Cr);for(cn+re<0&&eu(3);re<Yr;++re)Ht[re]=(void 0)[cn+re]}for(;re<Cr;++re)Ht[re]=Ht[re-Je]}}Nt.l=Ie,Nt.p=Ji,Nt.b=re,Nt.f=Ee,Ie&&(Ee=1,Nt.m=xe,Nt.d=Re,Nt.n=oi)}while(!Ee);return re!=Ht.length&&le?(ze=Ht,((De=re)==null||De>ze.length)&&(De=ze.length),new Ul(ze.subarray(0,De))):Ht.subarray(0,re)}(mt.subarray(_t,-8),{i:2},new Ul(((at=mt)[(dt=at.length)-4]|at[dt-3]<<8|at[dt-2]<<16|at[dt-1]<<24)>>>0))));var at,dt,mt,_t;const Dt=xst[it];if(!Dt)throw new Error(`Unhandled codec: ${it}`);const At=new globalThis.DecompressionStream(Dt);return new Response(new Blob([Q]).stream().pipeThrough(At)).arrayBuffer().then(Ot=>new Uint8Array(Ot))}(U,V).then(Q=>(function(it,at){it.readFields(ost,at)}(new kP(Q),Z),new wst[M](Z.buffer))),q.then(Q=>{for(let it=F.length-1;it>=0;it--)switch(F[it]){case"delta_filter":lst(Q,L);break;case"zigzag_filter":cst(Q);break;case"bitshuffle_filter":ust(Q,M);break;default:throw new pc(`Unhandled filter "${F[it]}"`)}return{layerName:_,blockIndex:k,data:Q}}).catch(Q=>{throw Q})}))},si(yU,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),si(N2,"MapboxRasterTile"),si(_U,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class xU{constructor(l){this._stringToNumber={},this._numberToString=[];for(let h=0;h<l.length;h++){const m=l[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(l){return this._stringToNumber[l]}decode(l){return this._numberToString[l]}}class bU{constructor(l,h){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Vh(Ne,16,0),this.featureIndexArray=new BT,this.promoteId=h,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(l,h,m,_,S,T=0,M=0){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,_,S,T);const k=this.grid;for(let F=0;F<h.length;F++){const V=h[F],U=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<V.length;Z++){const q=V[Z];U[0]=Math.min(U[0],q.x),U[1]=Math.min(U[1],q.y),U[2]=Math.max(U[2],q.x),U[3]=Math.max(U[3],q.y)}M!==0&&(U[0]-=M,U[1]-=M,U[2]+=M,U[3]+=M),U[0]<Ne&&U[1]<Ne&&U[2]>=0&&U[3]>=0&&k.insert(L,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hi(new g2(this.rawTileData)).layers,this.sourceLayerCoder=new xU(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const l in this.vtLayers)this.vtFeatures[l]=[]}return this.vtLayers}query(l,h){const{tilespaceGeometry:m,transform:_,tileTransform:S,pixelPosMatrix:T,availableImages:M,worldview:L}=h;this.loadVTLayers(),this.serializedLayersCache.clear();const k=h.queryRadius?h.queryRadius:0,F=m.bufferedTilespaceBounds,V=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,(Q,it,at,dt)=>Wn(m.bufferedTilespaceGeometry,Q-k,it-k,at+k,dt+k));V.sort(Sst);let U=null;_.elevation&&V.length>0&&(U=ey.create(_.elevation,this.tileID));const Z={};let q;for(let Q=0;Q<V.length;Q++){const it=V[Q];if(it===q)continue;q=it;const at=this.featureIndexArray.get(it);let dt=null;this.is3DTile?this.loadMatchingModelFeature(Z,at,l,m,_,L):this.loadMatchingFeature(Z,at,l,M,L,(mt,_t,Dt,At=0)=>(dt||(dt=de(mt,this.tileID.canonical,S)),_t.queryIntersectsFeature(m,mt,Dt,dt,this.z,_,T,U,At)))}return Z}loadMatchingFeature(l,h,m,_,S,T){const{featureIndex:M,bucketIndex:L,sourceLayerIndex:k,layoutVertexArrayOffset:F}=h,V=this.bucketLayerIDs[L],U=m.layers,Z=Object.keys(U);if(Z.length&&!Gi(Z,V))return;const q=m.sourceCache,Q=this.sourceLayerCoder.decode(k),it=this.vtLayers[Q].feature(M),at=this.getId(it,Q);for(let dt=0;dt<V.length;dt++){const mt=V[dt];if(!U[mt])continue;const{styleLayer:_t,targets:Dt}=U[mt];let At={};at!==void 0&&(At=q.getFeatureState(_t.sourceLayer,at));const Ot=!T||T(it,_t,At,F);if(!Ot)continue;const Nt=new Wg(it,this.z,this.x,this.y,at);Nt.tile=this.tileID.canonical,Nt.state=At;let Ht=this.serializedLayersCache.get(mt);Ht||(Ht=_t.serialize(),Ht.id=mt,this.serializedLayersCache.set(mt,Ht)),Nt.source=Ht.source,Nt.sourceLayer=Ht["source-layer"],Nt.layer=Object.assign({},Ht),Nt.layer.paint=wU(Ht.paint,_t.paint,it,At,_),Nt.layer.layout=wU(Ht.layout,_t.layout,it,At,_);let se=!1;for(const Kt of Dt){this.updateFeatureProperties(Nt,Kt);const{filter:le}=Kt;if(le){if(it.properties=Nt.properties,le.needGeometry){const ge=ee(it,!0);if(!le.filter(new xn(this.tileID.overscaledZ,{worldview:S}),ge,this.tileID.canonical))continue}else if(!le.filter(new xn(this.tileID.overscaledZ,{worldview:S}),it))continue}se=!0,Kt.targetId&&this.addFeatureVariant(Nt,Kt)}se&&this.appendToResult(l,mt,M,Nt,Ot)}}loadMatchingModelFeature(l,h,m,_,S,T){const{featureIndex:M,bucketIndex:L}=h,k=this.bucketLayerIDs[L],F=m.layers,V=Object.keys(F);if(!V.length||Gi(V,k))for(let U=0;U<k.length;U++){const Z=k[U],{styleLayer:q,targets:Q}=F[Z];if(q.type!=="model")continue;const it=_.tile,at=it.getBucket(q);if(!(at&&at instanceof L2))continue;const dt=Eot(at,M,_,S);if(!dt)continue;const{z:mt,x:_t,y:Dt}=it.tileID.canonical,{feature:At,intersectionZ:Ot,position:Nt}=dt;let Ht={};At.id!==void 0&&(Ht=m.sourceCache.getFeatureState(q.sourceLayer,At.id));const se=new Wg({},mt,_t,Dt,At.id);se.tile=this.tileID.canonical,se.state=Ht,se.properties=At.properties,se.geometry={type:"Point",coordinates:[Nt.lng,Nt.lat]};let Kt=this.serializedLayersCache.get(Z);Kt||(Kt=q.serialize(),Kt.id=Z,this.serializedLayersCache.set(Z,Kt)),se.source=Kt.source,se.sourceLayer=Kt["source-layer"],se.layer=Object.assign({},Kt);let le=!1;for(const ge of Q){this.updateFeatureProperties(se,ge);const{filter:Se}=ge;if(Se){if(At.properties=se.properties,Se.needGeometry){if(!Se.filter(new xn(this.tileID.overscaledZ,{worldview:T}),At,this.tileID.canonical))continue}else if(!Se.filter(new xn(this.tileID.overscaledZ,{worldview:T}),At))continue}le=!0,ge.targetId&&this.addFeatureVariant(se,ge)}le&&this.appendToResult(l,Z,M,se,Ot)}}updateFeatureProperties(l,h,m){if(h.properties){const _={};for(const S in h.properties){const T=h.properties[S].evaluate({zoom:this.z},l._vectorTileFeature,l.state,l.tile,m);T!=null&&(_[S]=T)}l.properties=_}}addFeatureVariant(l,h,m){const _={target:h.target,namespace:h.namespace,uniqueFeatureID:h.uniqueFeatureID};h.properties&&(_.properties=l.properties),l.variants=l.variants||{},l.variants[h.targetId]=l.variants[h.targetId]||[],l.variants[h.targetId].push(_)}appendToResult(l,h,m,_,S){let T=l[h];T===void 0&&(T=l[h]=[]),T.push({featureIndex:m,feature:_,intersectionZ:S})}lookupSymbolFeatures(l,h,m,_,S,T){const M={};this.loadVTLayers();for(const L of l)this.loadMatchingFeature(M,{bucketIndex:h,sourceLayerIndex:m,featureIndex:L,layoutVertexArrayOffset:0},_,S,T);return M}loadFeature(l){const{featureIndex:h,sourceLayerIndex:m}=l;this.loadVTLayers();const _=this.sourceLayerCoder.decode(m),S=this.vtFeatures[_];if(S[h])return S[h];const T=this.vtLayers[_].feature(h);return S[h]=T,T}hasLayer(l){for(const h of this.bucketLayerIDs)for(const m of h)if(l===m)return!0;return!1}getId(l,h){let m=l.id;if(this.promoteId){const _=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[h];if(_!=null)if(Array.isArray(_)){if(!this.promoteIdExpression){const S=hc(_);if(S.result!=="success"){const T=S.value.map(M=>`${M.key}: ${M.message}`).join(", ");return void Mi(`Failed to create expression for promoteId: ${T}`)}this.promoteIdExpression=S.value}m=this.promoteIdExpression.evaluate({zoom:0},l)}else m=l.properties[_];typeof m=="boolean"&&(m=Number(m))}return m}}function wU(d,l,h,m,_){return ke(d,(S,T)=>{const M=l instanceof Uh?l.get(T):null;return M&&M.evaluate?M.evaluate(h,m,void 0,_):M})}function Sst(d,l){return l-d}si(bU,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const SU=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class OP{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(l,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=m>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const S=SU[15&m];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(l,2,1),[M]=new Uint32Array(l,4,1);return new OP(M,T,S,l)}constructor(l,h=64,m=Float64Array,_){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const S=SU.indexOf(this.ArrayType),T=2*l*this.ArrayType.BYTES_PER_ELEMENT,M=l*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-M%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+M+L,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+T+M+L),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+M+L,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=l)}add(l,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=l,this.coords[this._pos++]=h,m}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return zP(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,h,m,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:M}=this,L=[0,S.length-1,0],k=[];for(;L.length;){const F=L.pop()||0,V=L.pop()||0,U=L.pop()||0;if(V-U<=M){for(let it=U;it<=V;it++){const at=T[2*it],dt=T[2*it+1];at>=l&&at<=m&&dt>=h&&dt<=_&&k.push(S[it])}continue}const Z=U+V>>1,q=T[2*Z],Q=T[2*Z+1];q>=l&&q<=m&&Q>=h&&Q<=_&&k.push(S[Z]),(F===0?l<=q:h<=Q)&&(L.push(U),L.push(Z-1),L.push(1-F)),(F===0?m>=q:_>=Q)&&(L.push(Z+1),L.push(V),L.push(1-F))}return k}within(l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:S,nodeSize:T}=this,M=[0,_.length-1,0],L=[],k=m*m;for(;M.length;){const F=M.pop()||0,V=M.pop()||0,U=M.pop()||0;if(V-U<=T){for(let it=U;it<=V;it++)AU(S[2*it],S[2*it+1],l,h)<=k&&L.push(_[it]);continue}const Z=U+V>>1,q=S[2*Z],Q=S[2*Z+1];AU(q,Q,l,h)<=k&&L.push(_[Z]),(F===0?l-m<=q:h-m<=Q)&&(M.push(U),M.push(Z-1),M.push(1-F)),(F===0?l+m>=q:h+m>=Q)&&(M.push(Z+1),M.push(V),M.push(1-F))}return L}}function zP(d,l,h,m,_,S){if(_-m<=h)return;const T=m+_>>1;TU(d,l,T,m,_,S),zP(d,l,h,m,T-1,1-S),zP(d,l,h,T+1,_,1-S)}function TU(d,l,h,m,_,S){for(;_>m;){if(_-m>600){const k=_-m+1,F=h-m+1,V=Math.log(k),U=.5*Math.exp(2*V/3),Z=.5*Math.sqrt(V*U*(k-U)/k)*(F-k/2<0?-1:1);TU(d,l,h,Math.max(m,Math.floor(h-F*U/k+Z)),Math.min(_,Math.floor(h+(k-F)*U/k+Z)),S)}const T=l[2*h+S];let M=m,L=_;for(ib(d,l,m,h),l[2*_+S]>T&&ib(d,l,m,_);M<L;){for(ib(d,l,M,L),M++,L--;l[2*M+S]<T;)M++;for(;l[2*L+S]>T;)L--}l[2*m+S]===T?ib(d,l,m,L):(L++,ib(d,l,L,_)),L<=h&&(m=L+1),h<=L&&(_=L-1)}}function ib(d,l,h,m){BP(d,h,m),BP(l,2*h,2*m),BP(l,2*h+1,2*m+1)}function BP(d,l,h){const m=d[l];d[l]=d[h],d[h]=m}function AU(d,l,h,m){const _=d-h,S=l-m;return _*_+S*S}a.$=Gv,a.A=Uc,a.B=Gh,a.C=2,a.D=G_,a.E=Nc,a.F=F1,a.G=KV,a.H=Uv,a.I=Ba,a.J=Xx,a.K=Yd,a.L=fg,a.M=d_,a.N=h_,a.O=zx,a.P=Ce,a.Q=m_,a.R=Eh,a.S=gf,a.T=ZD,a.U=hc,a.V=P2,a.W=Fx,a.X=af,a.Y=nf,a.Z=yg,a._=Vo,a.a=function(d){return An.API_CDN_URL_REGEX.test(d)},a.a$=yf,a.a0=Ni,a.a1=sx,a.a2=mf,a.a3=class extends P2{},a.a4=f_,a.a5=Ox,a.a6=Yt,a.a7=function(d){const l=d.value;return l?Ni(l)?SP(l,!0)?[]:[new P2(d.key,l,`invalid url "${l}"`)]:[new P2(d.key,l,`string expected, "${Yd(l)}" found`)]:[]},a.a8=IT,a.a9=Yn,a.aA=ct,a.aB=z,a.aC=Li,a.aD=hs,a.aE=qa,a.aF=ut,a.aG=oe,a.aH=function(d,l){const h={};for(let m=0;m<l.length;m++){const _=l[m];_ in d&&(h[_]=d[_])}return h},a.aI=W,a.aJ=st,a.aK=class{constructor(d){this.entries={},this.scheduler=d}request(d,l,h,m){const _=this.entries[d]=this.entries[d]||{callbacks:[]};if(_.result){const[S,T]=_.result;return this.scheduler?this.scheduler.add(()=>{m(S,T)},l):m(S,T),()=>{}}return _.callbacks.push(m),_.cancel||(_.cancel=h((S,T)=>{_.result=[S,T];for(const M of _.callbacks)this.scheduler?this.scheduler.add(()=>{M(S,T)},l):M(S,T);setTimeout(()=>delete this.entries[d],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(S=>S!==m),_.callbacks.length||(_.cancel(),delete this.entries[d]))}}},a.aL=function(d,l,h){const m=JSON.stringify(d.request);return d.data&&(this.deduped.entries[m]={result:[null,d.data]}),this.deduped.request(m,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},_=>{const S=Wd(d.request,(T,M,L)=>{T?_(T):M&&_(null,{vectorTile:h?void 0:new hi(new g2(M)),rawData:M,responseHeaders:new Map(L.entries())})});return()=>{S.cancel(),_()}},l)},a.aM=function(d){return d?{cacheControl:d.get("Cache-Control"),expires:d.get("Expires")}:{cacheControl:void 0,expires:void 0}},a.aN=function(d){zv++,zv>ls&&(d.getActor().send("enforceCacheSizeLimit",Kp),zv=0)},a.aO=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log2(d)))},a.aP=ja,a.aQ=I4,a.aR=L4,a.aS=Y,a.aT=A4,a.aU=function(d,l){const h=document.createElement("video");h.muted=!0,h.onloadstart=function(){l(null,h)};for(let m=0;m<d.length;m++){const _=document.createElement("source");Ur(d[m])||(h.crossOrigin="Anonymous"),_.src=d[m],h.appendChild(_)}return{cancel:()=>{}}},a.aV=R1,a.aW=$g,a.aX=ie,a.aY=G1,a.aZ=xt,a.a_=vt,a.aa=Pe,a.ab=class{constructor(d){this.specification=d}possiblyEvaluate(d,l){return nn(d.expression.evaluate(l))}interpolate(d,l,h){return{x:zi(d.x,l.x,h),y:zi(d.y,l.y,h),z:zi(d.z,l.z,h),azimuthal:zi(d.azimuthal,l.azimuthal,h),polar:zi(d.polar,l.polar,h)}}},a.ac=xn,a.ad=Eu,a.ae=qt,a.af=zt,a.ag=Rt,a.ah=St,a.ai=Uh,a.aj=Ef,a.ak=zi,a.al=Ne,a.am=sg,a.an=wr,a.ao=Xr,a.ap=class{constructor(d){this.specification=d}possiblyEvaluate(d,l){return function([h,m]){const _=nn([1,h,m]);return{x:_.x,y:_.y,z:_.z}}(d.expression.evaluate(l))}interpolate(d,l,h){return{x:zi(d.x,l.x,h),y:zi(d.y,l.y,h),z:zi(d.z,l.z,h)}}},a.aq=function(d,l,h=0,m=!0){const _=new Ce(h,h),S=d.sub(_),T=l.add(_),M=[S,new Ce(T.x,S.y),T,new Ce(S.x,T.y)];return m&&M.push(S.clone()),M},a.ar=function(d,l){const h=[];for(let m=0;m<d.length;m++){const _=Ft(m-1,-1,d.length-1),S=Ft(m+1,-1,d.length-1),T=d[m],M=d[S],L=d[_].sub(T).unit(),k=M.sub(T).unit(),F=k.angleWithSep(L.x,L.y),V=L.add(k).unit().mult(-1*l/Math.sin(F/2));h.push(T.add(V))}return h},a.as=u4,a.at=Wn,a.au=function(d,l,h=0){return Ct(((l.x-h)*d.scale-d.x)*Ne,(l.y*d.scale-d.y)*Ne,Et(l.z,l.y))},a.av=qe,a.aw=ye,a.ax=ir,a.ay=TV,a.az=function(d){let l=1/0,h=1/0,m=-1/0,_=-1/0;for(const S of d)l=Math.min(l,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),_=Math.max(_,S.y);return{min:new Ce(l,h),max:new Ce(m,_)}},a.b=function(d){return An.API_FONTS_REGEX.test(d)},a.b$=OD,a.b0=Pn,a.b1=ne,a.b2=kT,a.b3=M2,a.b4=function(){As.isLoading()||As.isLoaded()||$x()!=="deferred"||Zx()},a.b5=w_,a.b6=ee,a.b7=Wg,a.b8=ba,a.b9=eP,a.bA=K,a.bB=I,a.bC=function(d,l){const{x:h,y:m}=d.point,_=HN(h,m,d.worldSize/d._pixelsPerMercatorPixel,0,0);return z(_,_,wD(zu(l)))},a.bD=g,a.bE=$e,a.bF=Pi,a.bG=li,a.bH=We,a.bI=Ke,a.bJ=Y_,a.bK=el,a.bL=cP,a.bM=function(d,l,h,m,_){const S=5*l+2;d.float32[S+0]=h,d.float32[S+1]=m,d.float32[S+2]=_},a.bN=ty,a.bO=oc,a.bP=ss,a.bQ=Qa,a.bR=kv,a.bS=Ft,a.bT=function(d,l,h,m){var _=new f(4);return _[0]=d,_[1]=l,_[2]=h,_[3]=m,_},a.bU=class{isDataAvailableAtPoint(d){const l=this._source();if(this.isUsingMockSource()||!l||d.y<0||d.y>1)return!1;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(d.x),S=Math.floor((d.x-_)*m),T=Math.floor(d.y*m),M=this.findDEMTileFor(new ja(h,_,h,S,T));return!(!M||!M.dem)}getAtPointOrZero(d,l=0){return this.getAtPoint(d,l)||0}getAtPoint(d,l,h=!0){if(this.isUsingMockSource())return null;l==null&&(l=null);const m=this._source();if(!m||d.y<0||d.y>1)return l;const _=m.getSource().maxzoom,S=1<<_,T=Math.floor(d.x),M=d.x-T,L=new ja(_,T,_,Math.floor(M*S),Math.floor(d.y*S)),k=this.findDEMTileFor(L);if(!k||!k.dem)return l;const F=k.dem,V=1<<k.tileID.canonical.z,U=(M*V-k.tileID.canonical.x)*F.dim,Z=(d.y*V-k.tileID.canonical.y)*F.dim,q=Math.floor(U),Q=Math.floor(Z);return(h?this.exaggeration():1)*zi(zi(F.get(q,Q),F.get(q,Q+1),Z-Q),zi(F.get(q+1,Q),F.get(q+1,Q+1),Z-Q),U-q)}static getAtTileOffset(d,l,h,m){const _=1<<d.canonical.z;return m?m.pointElevation(l):h?h.getAtPointOrZero(new qt(d.wrap+(d.canonical.x+l.x/Ne)/_,(d.canonical.y+l.y/Ne)/_)):0}static getAtTileOffsetFunc(d,l,h,m){return(_,S,T)=>{const M=this.getAtTileOffset(d,_,S,T),L=m.upVector(d.canonical,_.x,_.y);return Ge(L,L,M*m.upVectorScale(d.canonical,l,h).metersToTile),L}}getForTilePoints(d,l,h,m){if(this.isUsingMockSource())return!1;const _=ey.create(this,d,m);return!!_&&(l.forEach(S=>{S[2]=this.exaggeration()*_.getElevationAt(S[0],S[1],h)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const l=this.findDEMTileFor(d);if(!l||!l.dem)return null;const h=l.dem.tree,m=l.tileID,_=1<<d.canonical.z-m.canonical.z;let S=d.canonical.x/_-m.canonical.x,T=d.canonical.y/_-m.canonical.y,M=0;for(let L=0;L<d.canonical.z-m.canonical.z&&!h.leaves[M];L++){S*=2,T*=2;const k=2*Math.floor(T)+Math.floor(S);M=h.childOffsets[M]+k,S%=1,T%=1}return{min:this.exaggeration()*h.minimums[M],max:this.exaggeration()*h.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,l,h){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(d.length===0)return null;let l=!1,h=Number.MAX_VALUE,m=Number.MIN_VALUE;for(const _ of d){const S=this.getMinMaxForTile(_.tileID);S&&(h=Math.min(h,S.min),m=Math.max(m,S.max),l=!0)}return l?{min:h,max:m}:null}},a.bV=n2,a.bW=ia,a.bX=ro,a.bY=x5,a.bZ=R4,a.b_=T5,a.ba=LD,a.bb=de,a.bc=us,a.bd=D_,a.be=BN,a.bf=Vn,a.bg=V_,a.bh=bP,a.bi=function(d,l){const h=Ef(l.zoom);if(h===0)return zu(d);const m=ZT(d),_=bD(m),S=ut(m.getWest())*l.worldSize,T=ut(m.getEast())*l.worldSize,M=st(m.getNorth())*l.worldSize,L=st(m.getSouth())*l.worldSize,k=[S,M,0],F=[T,M,0],V=[S,L,0],U=[T,L,0],Z=R([],l.globeMatrix);return zt(k,k,Z),zt(F,F,Z),zt(V,V,Z),zt(U,U,Z),_[0]=Zh(_[0],V,h),_[1]=Zh(_[1],U,h),_[2]=Zh(_[2],F,h),_[3]=Zh(_[3],k,h),cr.fromPoints(_)},a.bj=XT,a.bk=R,a.bl=v1,a.bm=Zh,a.bn=Hh,a.bo=qrt,a.bp=et,a.bq=N,a.br=N2,a.bs=g2,a.bt=Wd,a.bu=function(d,l){const h=[];for(const m in d)m in l||h.push(m);return h},a.bv=Bt,a.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bx=Bc,a.by=E,a.bz=D,a.c=No,a.c$=function(d){return d*d*d*d*d},a.c0=sP,a.c1=n4,a.c2=pP,a.c3=OP,a.c4=Ge,a.c5=Ai,a.c6=xr,a.c7=function(d,l,h){h*=.5;var m=l[0],_=l[1],S=l[2],T=l[3],M=Math.sin(h),L=Math.cos(h);return d[0]=m*L+_*M,d[1]=_*L-m*M,d[2]=S*L+T*M,d[3]=T*L-S*M,d},a.c8=tn,a.c9=ea,a.cA=Gr,a.cB=lV,a.cC=Js,a.cD=VN,a.cE=function(d,l,h,m,_,S,T,M,L){if(L.name==="globe")return VN(d,l,new Js(h,m,_),!1);const k=G1({z:h,x:m,y:_},L);return new cr([(S+k.x/k.scale)*l,l*(k.y/k.scale),T],[(S+k.x2/k.scale)*l,l*(k.y2/k.scale),M])},a.cF=function(d,l,h){return d[0]=Math.min(l[0],h[0]),d[1]=Math.min(l[1],h[1]),d[2]=Math.min(l[2],h[2]),d[3]=Math.min(l[3],h[3]),d},a.cG=function(d,l,h){return d[0]=Math.max(l[0],h[0]),d[1]=Math.max(l[1],h[1]),d[2]=Math.max(l[2],h[2]),d[3]=Math.max(l[3],h[3]),d},a.cH=function(d){const l=Math.round((d+45+360)%360/90)%4;return Q0[l]},a.cI=bt,a.cJ=pi,a.cK=c,a.cL=function(d){const l=D(new Float64Array(16));z(l,d.pixelMatrix,d.globeMatrix);const h=[0,C,0],m=[0,P,0];return zt(h,h,l),zt(m,m,l),[h[0]>0&&h[0]<=d.width&&h[1]>0&&h[1]<=d.height&&!TD(d,new Y(d.center.lat,90)),m[0]>0&&m[0]<=d.width&&m[1]>0&&m[1]<=d.height&&!TD(d,new Y(d.center.lat,-90))]},a.cM=function(d,l){const{scale:h}=d.tileTransform,m=h*Ne/(d.tileSize*Math.pow(2,l.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return function(_,S,T){var M=S[1],L=S[2],k=S[3],F=T[0],V=T[1];return _[0]=S[0]*F,_[1]=M*F,_[2]=L*V,_[3]=k*V,_}(new Float32Array(4),l.inverseAdjustmentMatrix,[m,m])},a.cN=c2,a.cO=yt,a.cP=sV,a.cQ=function(d){const l=sV(d,!0);return g([],[l[0],l[1],l[4],l[5]])},a.cR=H,a.cS=Qr,a.cT=$,a.cU=function(d){const{x:l,y:h}=d.point,{lng:m,lat:_}=d._center;return HN(l,h,d.worldSize,m,_)},a.cV=fe,a.cW=Fo,a.cX=Qs,a.cY=ra,a.cZ=x,a.c_=function(d,l,h){let m=0;for(let _=0;_<2;++_)d[_]>0&&(m+=(d[_]-0)*(d[_]-0)),l[_]<0&&(m+=(0-l[_])*(0-l[_]));return m},a.ca=function(d,l){return d[0]=-l[0],d[1]=-l[1],d[2]=-l[2],d[3]=l[3],d},a.cb=ht,a.cc=function(d,l,h,m,_){var S=1/Math.tan(l/2);if(d[0]=S/h,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=S,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,_!=null&&_!==1/0){var T=1/(m-_);d[10]=(_+m)*T,d[14]=2*_*m*T}else d[10]=-1,d[14]=-2*m;return d},a.cd=function(d,l,h,m,_,S,T){var M=1/(l-h),L=1/(m-_),k=1/(S-T);return d[0]=-2*M,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*L,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*k,d[11]=0,d[12]=(l+h)*M,d[13]=(_+m)*L,d[14]=(T+S)*k,d[15]=1,d},a.ce=pt,a.cf=function(d,l,h){d[4*l+0]=h[0],d[4*l+1]=h[1],d[4*l+2]=h[2],d[4*l+3]=h[3]},a.cg=z_,a.ch=Af,a.ci=ma,a.cj=dc,a.ck=zg,a.cl=g4,a.cm=function(){var d=new f(4);return f!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},a.cn=function(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3],M=Math.sin(h),L=Math.cos(h);return d[0]=m*L+S*M,d[1]=_*L+T*M,d[2]=m*-M+S*L,d[3]=_*-M+T*L,d},a.co=function(d,l){return d[0]===l[0]&&d[1]===l[1]&&d[2]===l[2]&&d[3]===l[3]},a.cp=He,a.cq=function(d){var l=d[0],h=d[1],m=d[2],_=d[3];return Math.sqrt(l*l+h*h+m*m+_*_)},a.cr=So,a.cs=pe,a.ct=fc,a.cu=3,a.cv=2,a.cw=7,a.cx=6,a.cy=Si,a.cz=ft,a.d=function(d){return An.API_TILEJSON_REGEX.test(d)},a.d$=$N,a.d0=nt,a.d1=45,a.d2=Og,a.d3=function(d,l,h){const m=Math.sqrt(d*d+l*l+h*h),_=m>0?Math.acos(h/m)*Zp:0;let S=d!==0||l!==0?Math.atan2(-l,-d)*Zp+90:0;return S<0&&(S+=360),[m,S,_]},a.d4=Ct,a.d5=nn,a.d6=Lt,a.d7=Vt,a.d8=cr,a.d9=Qt,a.dA=f1,a.dB=class extends Il{constructor(d){super(d),this.current=gD}set(d,l,h){if(this.fetchUniformLocation(d,l)){for(let m=0;m<9;m++)if(h[m]!==this.current[m]){this.current=h,this.gl.uniformMatrix3fv(this.location,!1,h);break}}}},a.dC=qp,a.dD=function(d,l,h){const m=Ef(h.zoom),_=d.style.map._antialias,S=d.terrain&&d.terrain.exaggeration()>0;return m===0&&!_&&!S},a.dE=function(d){const l=d.pixelsPerMeter,h=l/pt(1,d.center.lat),m=D(new Float64Array(16));return N(m,m,[d.point.x,d.point.y,0]),H(m,m,[h,h,l]),Float32Array.from(m)},a.dF=ZT,a.dG=function(d){const l=bt-5;d=ct(d,-l,l)/l*90;const h=Math.pow(Math.abs(Math.sin(wr(d))),3);return Math.round(h*(A.length-1))},a.dH=function(d,l,h,m){const _=l.getNorth(),S=l.getSouth(),T=l.getWest(),M=l.getEast(),L=1<<d.z,k=M-T,F=_-S,V=k/b,U=-F/A[h],Z=[0,V,0,U,0,0,_,T,0];if(d.z>0){const q=180/m;w(Z,Z,[q/k+1,0,0,0,q/F+1,0,-.5*q/V,.5*q/U,1])}return Z[2]=L,Z[5]=d.x,Z[8]=d.y,Z},a.dI=zu,a.dJ=function(d,l,h){const m=D(new Float64Array(16)),_=(l/(1<<d)-.5)*Math.PI*2;return X(m,h.globeMatrix,_),Float32Array.from(m)},a.dK=i5,a.dL=$T,a.dM=function(d,l){return[Math.pow(d[0],2.2)*l,Math.pow(d[1],2.2)*l,Math.pow(d[2],2.2)*l]},a.dN=v,a.dO=function(d,l){var h=Math.sin(l),m=Math.cos(l);return d[0]=m,d[1]=h,d[2]=0,d[3]=-h,d[4]=m,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},a.dP=Zt,a.dQ=GN,a.dR=Tn,a.dS=jn,a.dT=256,a.dU=function(d,l){const h=[0,0,0];return zt(h,h,XT(zu(l.canonical))),zt(h,h,d),h},a.dV=d=>({u_matrix:new zg(d),u_texsize:new dc(d),u_pixels_to_tile_units:new p1(d),u_device_pixel_ratio:new ma(d),u_width_scale:new ma(d),u_floor_width_scale:new ma(d),u_image:new z_(d),u_units_to_pixels:new dc(d),u_tile_units_to_pixels:new ma(d),u_alpha_discard_threshold:new ma(d),u_trim_offset:new dc(d),u_trim_fade_range:new dc(d),u_trim_color:new Og(d),u_emissive_strength:new ma(d),u_zbias_factor:new ma(d),u_tile_to_meter:new ma(d),u_ground_shadow_factor:new Af(d),u_pattern_transition:new ma(d)}),a.dW=d=>({u_matrix:new zg(d),u_pixels_to_tile_units:new p1(d),u_device_pixel_ratio:new ma(d),u_width_scale:new ma(d),u_floor_width_scale:new ma(d),u_units_to_pixels:new dc(d),u_dash_image:new z_(d),u_gradient_image:new z_(d),u_image_height:new ma(d),u_texsize:new dc(d),u_tile_units_to_pixels:new ma(d),u_alpha_discard_threshold:new ma(d),u_trim_offset:new dc(d),u_trim_fade_range:new dc(d),u_trim_color:new Og(d),u_emissive_strength:new ma(d),u_zbias_factor:new ma(d),u_tile_to_meter:new ma(d),u_ground_shadow_factor:new Af(d)}),a.dX=d=>({u_camera_to_center_distance:new ma(d),u_extrude_scale:new p1(d),u_device_pixel_ratio:new ma(d),u_matrix:new zg(d),u_inv_rot_matrix:new zg(d),u_merc_center:new dc(d),u_tile_id:new Af(d),u_zoom_transition:new ma(d),u_up_dir:new Af(d),u_emissive_strength:new ma(d)}),a.dY=bf,a.dZ=Oat,a.d_=class{constructor(d,l,h,m){this.context=d,this.format=m,this.size=h,this.texture=d.gl.createTexture();const[_,S,T]=this.size,{gl:M}=d;M.bindTexture(M.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in l&&l.data&&M.texImage3D(M.TEXTURE_3D,0,this.format,_,S,T,0,WD(this.format),$D(this.format),l.data)}bind(d,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_3D,this.texture),d!==this.minFilter&&(m.texParameteri(m.TEXTURE_3D,m.TEXTURE_MAG_FILTER,d),m.texParameteri(m.TEXTURE_3D,m.TEXTURE_MIN_FILTER,d),this.minFilter=d),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_3D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_3D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},a.da=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},a.db=oV,a.dc=QD,a.dd=hV,a.de=SP,a.df=function(d,l){return d.readFields(Lot,{icons:[]},l)},a.dg=a2,a.dh=K_,a.di=hP,a.dj=ix,a.dk=AT,a.dl=Xp,a.dm=ng,a.dn=mi,a.dp=function(d){const l=d.indexOf(Eg);return l>=0?d.slice(0,l):d},a.dq=function(d){return d.indexOf(Eg)>=0},a.dr=function(d){const l=d.lastIndexOf(Eg);return l>=0?d.slice(l+1):""},a.ds=function(d){const l=[],h=d.id;return h===void 0&&l.push({message:`layers.${h}: missing required property "id"`}),d.render===void 0&&l.push({message:`layers.${h}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&l.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),l},a.dt=function(d,l,h,m){return d.type==="custom"?new Aot(d,l):new Dot[d.type](d,l,h,m)},a.du=Me,a.dv=function(d){const l=d.indexOf(Eg);return l>=0?d.slice(l+1):""},a.dw=class extends Wg{constructor(d,l){super(d._vectorTileFeature,d._z,d._x,d._y,d.id),d.state&&(this.state=Object.assign({},d.state)),this.target=l.target,this.namespace=l.namespace,l.properties&&(this.properties=l.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=d.source,this.sourceLayer=d.sourceLayer,this.layer=d.layer)}toJSON(){const d=super.toJSON();return d.target=this.target,d.namespace=this.namespace,d}},a.dx=Wx,a.dy=Jp,a.dz=function(d){return d({pluginStatus:Ko,pluginURL:Lu}),Wx.on("pluginStateChange",d),d},a.e=An,a.e$=function([d,l,h]){const m=Math.hypot(d,l,h),_=Math.atan2(d,h),S=.5*Math.PI-Math.acos(-l/m);return new Y(Fo(_),Fo(S))},a.e0=(d,l,h,m,_,S)=>{const T=d.transform,M=T.projection.name==="globe";let L;if(S.paint.get("circle-pitch-alignment")==="map")if(M){const F=GN(T.zoom,l.canonical)*T._pixelsPerMercatorPixel;L=Float32Array.from([F,0,0,F])}else L=T.calculatePixelsToTileUnitsMatrix(h);else L=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(T.projection),u_matrix:d.translatePosMatrix(l.projMatrix,h,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ws.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:Qrt,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:S.paint.get("circle-emissive-strength")};if(M){k.u_inv_rot_matrix=m,k.u_merc_center=_,k.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],k.u_zoom_transition=Ef(T.zoom);const F=_[0]*Ne,V=_[1]*Ne;k.u_up_dir=T.projection.upVector(new Js(0,0,0),F,V)}return k},a.e1=CV,a.e2=cs,a.e3=(d,l,h,m,_,S,T,M,L,k)=>{const F=d.transform,V=F.pitch<15?AV(.07,.7,ct((14-F.zoom)/5,0,1)):.07,U=h.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:MV(d,l,h,m),u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:F.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:_,u_width_scale:S,u_floor_width_scale:T,u_image:0,u_tile_units_to_pixels:IV(l,F),u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:M,u_trim_fade_range:h.paint.get("line-trim-fade-range"),u_trim_color:h.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:h.lut).toArray01(),u_emissive_strength:h.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:Lt(l.tileID.canonical,0),u_ground_shadow_factor:L,u_pattern_transition:k}},a.e4=(d,l,h,m,_,S,T,M,L,k)=>{const F=d.transform,V=F.calculatePixelsToTileUnitsMatrix(l),U=h.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Z=F.pitch<15?AV(.07,.7,ct((14-F.zoom)/5,0,1)):.07;return{u_matrix:MV(d,l,h,m),u_pixels_to_tile_units:V,u_device_pixel_ratio:S,u_width_scale:T,u_floor_width_scale:M,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:EV(h)&&l.lineAtlasTexture?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:IV(l,d.transform),u_alpha_discard_threshold:0,u_trim_offset:L,u_trim_fade_range:h.paint.get("line-trim-fade-range"),u_trim_color:h.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:h.lut).toArray01(),u_emissive_strength:h.paint.get("line-emissive-strength"),u_zbias_factor:Z,u_tile_to_meter:Lt(l.tileID.canonical,0),u_ground_shadow_factor:k}},a.e5=$t,a.e6=_1,a.e7=Et,a.e8=$h,a.e9=r2,a.eA=IP,a.eB=d2,a.eC=h2,a.eD=[1,1,1],a.eE=ey,a.eF=_i,a.eG=function(d,l,h,m){var _=l[0],S=l[1],T=l[2],M=l[3];return d[0]=_+m*(h[0]-_),d[1]=S+m*(h[1]-S),d[2]=T+m*(h[2]-T),d[3]=M+m*(h[3]-M),d},a.eH=$_,a.eI=Al,a.eJ=Ou,a.eK=function(d,l,h,m,_,S,T,M,L,k,F,V,U,Z,q,Q){var it=new f(16);return it[0]=d,it[1]=l,it[2]=h,it[3]=m,it[4]=_,it[5]=S,it[6]=T,it[7]=M,it[8]=L,it[9]=k,it[10]=F,it[11]=V,it[12]=U,it[13]=Z,it[14]=q,it[15]=Q,it},a.eL=G,a.eM=o1,a.eN=Pg,a.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ce(1/0,1/0),max:new Ce(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,l=!1){const h=w5(new Ce(0,0),new Ce(Ne,Ne),d),m=[];if(l&&!RD(h,this._globalClipBounds))return m;for(const _ of this._activeRegions){if(_.hiddenByOverlap||!RD(h,_))continue;const S=Cnt(_.min,_.max,d);m.push({min:S.min,max:S.max,sourceId:this._sourceIds[_.priority],footprint:_.footprint,footprintTileId:_.tileId,order:_.order,clipMask:_.clipMask,clipScope:_.clipScope})}return m}setSources(d){this._setSources(d.map(l=>({getSourceId:()=>l.cache.id,getFootprints:()=>{const h=[];for(const m of l.cache.getVisibleCoordinates()){const _=l.cache.getTile(m).buckets[l.layer];_&&_.updateFootprints(m.toUnwrapped(),h)}return h},getOrder:()=>l.order,getClipMask:()=>l.clipMask,getClipScope:()=>l.clipScope})))}_addSource(d){const l=d.getFootprints();if(l.length===0)return;const h=d.getOrder(),m=d.getClipMask(),_=d.getClipScope();for(const S of l){if(!S.footprint)continue;const T=w5(S.footprint.min,S.footprint.max,S.id);this._activeRegions.push({min:T.min,max:T.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:S.id,footprint:S.footprint,order:h,clipMask:m,clipScope:_})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((l,h)=>l.priority-h.priority||t2(l.min,h.min)||t2(l.max,h.max)||l.order-h.order||l.clipMask-h.clipMask||function(m,_){const S=(T,M)=>T+M;return m.length-_.length||m.reduce(S,"").localeCompare(_.reduce(S,""))}(l.clipScope,h.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let l=0;for(;!d&&l!==this._activeRegions.length;){const h=this._activeRegions[l],m=this._prevRegions[l];d=h.priority!==m.priority||!b5(h,m)||h.order!==m.order||h.clipMask!==m.clipMask||!Bc(h.clipScope,m.clipScope),this._activeRegions[l].hiddenByOverlap=m.hiddenByOverlap,++l}}if(d){++this._updateTime;for(const h of this._activeRegions)h.order!==T1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,h.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,h.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,h.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,h.max.y));const l=h=>{const m=this._activeRegions;if(h>=m.length)return h;const _=m[h].priority;for(;h<m.length&&m[h].priority===_;)++h;return h};if(this._sourceIds.length>1){let h=0,m=l(h);for(;h!==m;){let _=h;const S=h;for(;_!==m;){const T=this._activeRegions[_];T.hiddenByOverlap=!1;for(let M=0;M<S;M++){const L=this._activeRegions[M];if(!L.hiddenByOverlap&&T.order===T1&&RD(T,L)&&(T.hiddenByOverlap=S5(T.footprint,T.tileId,L.footprint,L.tileId),T.hiddenByOverlap))break}++_}h=m,m=l(h)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let l=d.length-1;l>=0;l--)this._addSource(d[l]);this._computeReplacement()}},a.eP=T1,a.eQ=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,l){const h=new us,m=new Pn,_=[],S=d+1+2,T=l[0]+1,M=l[0]+1+(1+l.length),L=(k,F,V)=>{let U=k===S-1?k-2:k===0?k:k-1;return U+=V?24575:0,[U,F]};for(let k=0;k<S;++k)h.emplaceBack(...L(k,0,!0));for(let k=0;k<T;++k)for(let F=0;F<S;++F)h.emplaceBack(...L(F,k,(F===0||F===S-1)&&!0));for(let k=0;k<l.length;++k){const F=l[k];for(let V=0;V<S;++V)h.emplaceBack(...L(V,F,!0))}for(let k=0;k<l.length;++k){const F=m.length,V=l[k]+1+2,U=new Pn;for(let Q=0;Q<V-1;Q++){const it=Q===V-2,at=it?S*(M-l.length+k-Q):S;for(let dt=0;dt<S-1;dt++){const mt=Q*S+dt;Q===0||it||dt===0||dt===S-2?(U.emplaceBack(mt+1,mt,mt+at),U.emplaceBack(mt+at,mt+at+1,mt+1)):(m.emplaceBack(mt+1,mt,mt+at),m.emplaceBack(mt+at,mt+at+1,mt+1))}}const Z=Vn.simpleSegment(0,F,h.length,m.length-F);for(let Q=0;Q<U.uint16.length;Q+=3)m.emplaceBack(U.uint16[Q],U.uint16[Q+1],U.uint16[Q+2]);const q=Vn.simpleSegment(0,F,h.length,m.length-F);_.push({withoutSkirts:Z,withSkirts:q})}return{vertices:h,indices:m,segments:_}}_createGrid(d){const l=this._fillGridMeshWithLods(b,A);this._gridSegments=l.segments,this._gridBuffer=d.createVertexBuffer(l.vertices,BN.members),this._gridIndexBuffer=d.createIndexBuffer(l.indices,!0)}_createPoles(d){const l=new Pn;for(let T=0;T<=b;T++)l.emplaceBack(0,T+1,T+2);this._poleIndexBuffer=d.createIndexBuffer(l,!0);const h=new Wh,m=new Wh,_=new Wh,S=new Wh;this._poleSegments=[];for(let T=0,M=0;T<x;T++){const L=360/(1<<T);h.emplaceBack(0,-hs,0,.5,0),m.emplaceBack(0,-hs,0,.5,1),_.emplaceBack(0,-hs,0,.5,.5),S.emplaceBack(0,-hs,0,.5,.5);for(let k=0;k<=b;k++){let F=k/b,V=0;const U=zi(0,L,F),[Z,q,Q]=O(Krt,Jrt,U,hs);h.emplaceBack(Z,q,Q,F,V),m.emplaceBack(Z,q,Q,F,1-V);const it=wr(U);F=.5+.5*Math.sin(it),V=.5+.5*Math.cos(it),_.emplaceBack(Z,q,Q,F,V),S.emplaceBack(Z,q,Q,F,1-V)}this._poleSegments.push(Vn.simpleSegment(M,0,66,64)),M+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(h,N_,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(m,N_,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(_,N_,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(S,N_,!1)}getGridBuffers(d,l){return[this._gridBuffer,this._gridIndexBuffer,l?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,l){return[l?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,l?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},a.eR=y5,a.eS=Xt,a.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.eU=ot,a.eV=Tt,a.eW=function(d,l,h){return d[0]=l[0]/h[0],d[1]=l[1]/h[1],d[2]=l[2]/h[2],d},a.eX=Ti,a.eY=B,a.eZ=Ve,a.e_=Gt,a.ea=F5,a.eb=Pf,a.ec=C5,a.ed=M5,a.ee=Mt,a.ef=function(d,l){if(d===l){var h=l[1],m=l[2],_=l[3],S=l[6],T=l[7],M=l[11];d[1]=l[4],d[2]=l[8],d[3]=l[12],d[4]=h,d[6]=l[9],d[7]=l[13],d[8]=m,d[9]=S,d[11]=l[14],d[12]=_,d[13]=T,d[14]=M}else d[0]=l[0],d[1]=l[4],d[2]=l[8],d[3]=l[12],d[4]=l[1],d[5]=l[5],d[6]=l[9],d[7]=l[13],d[8]=l[2],d[9]=l[6],d[10]=l[10],d[11]=l[14],d[12]=l[3],d[13]=l[7],d[14]=l[11],d[15]=l[15];return d},a.eg=Tot,a.eh=gr,a.ei=l1,a.ej=256,a.ek=wD,a.el=qs,a.em=X,a.en=function(d,l){return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[4],d[4]=l[5],d[5]=l[6],d[6]=l[8],d[7]=l[9],d[8]=l[10],d},a.eo=Wh,a.ep=a1,a.eq=_T,a.er=function(d,l,h,m,_){return ct((d-l)/(h-l)*(_-m)+m,m,_)},a.es=On,a.et=function(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=l[4],M=l[5],L=l[6],k=l[7],F=l[8],V=F*T-M*k,U=-F*S+M*L,Z=k*S-T*L,q=h*V+m*U+_*Z;return q?(d[0]=V*(q=1/q),d[1]=(-F*m+_*k)*q,d[2]=(M*m-_*T)*q,d[3]=U*q,d[4]=(F*h-_*L)*q,d[5]=(-M*h+_*S)*q,d[6]=Z*q,d[7]=(-k*h+m*L)*q,d[8]=(T*h-m*S)*q,d):null},a.eu=2,a.ev=Ze,a.ew=hr,a.ex=lt,a.ey=function(d,l){var h=new f(3);lt(h,l);var m=1/h[0],_=1/h[1],S=1/h[2],T=l[0]*m,M=l[1]*_,L=l[2]*S,k=l[4]*m,F=l[5]*_,V=l[6]*S,U=l[8]*m,Z=l[9]*_,q=l[10]*S,Q=T+F+q,it=0;return Q>0?(it=2*Math.sqrt(Q+1),d[3]=.25*it,d[0]=(V-Z)/it,d[1]=(U-L)/it,d[2]=(M-k)/it):T>F&&T>q?(it=2*Math.sqrt(1+T-F-q),d[3]=(V-Z)/it,d[0]=.25*it,d[1]=(M+k)/it,d[2]=(U+L)/it):F>q?(it=2*Math.sqrt(1+F-T-q),d[3]=(U-L)/it,d[0]=(M+k)/it,d[1]=.25*it,d[2]=(V+Z)/it):(it=2*Math.sqrt(1+q-T-F),d[3]=(M-k)/it,d[0]=(U+L)/it,d[1]=(V+Z)/it,d[2]=.25*it),d},a.ez=function(d,l){var h=2*Math.acos(l[3]),m=Math.sin(h/2);return m>u?(d[0]=l[0]/m,d[1]=l[1]/m,d[2]=l[2]/m):(d[0]=1,d[1]=0,d[2]=0),h},a.f=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(+("0x"+h))))},a.f0=yr,a.f1=qD,a.f2=function(d){const l=d.navigator?d.navigator.userAgent:null;return!!function(h){if(aa==null){const m=h.navigator?h.navigator.userAgent:null;aa=!!h.safari||!(!m||!(/\b(iPad|iPhone|iPod)\b/.test(m)||m.match("Safari")&&!m.match("Chrome")))}return aa}(d)&&!(!l||!(l.match("Version/15.4")||l.match("Version/15.5")||l.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.f3=function(d,l){Kp=d,ls=l},a.f4=TD,a.f5=jN,a.f6=function(d){const l=[0,0,0],h=D(new Float64Array(16));return z(h,d.pixelMatrix,d.globeMatrix),zt(l,l,h),new Ce(l[0],l[1])},a.f7=function(){const d=D1;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(VD),D1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.f8=function(){a2().acquire(VD)},a.f9=$x,a.fA=Ae,a.fB=function(d){let l=0;if(new Uint32Array(d,0,1)[0]!==eV){const h=new Uint32Array(d,0,7),[,,m,_,S,T]=h;l=h.byteLength+_+S+T+S,(m!==d.byteLength||l>=d.byteLength)&&Mi("Invalid b3dm header information.")}return aV(d,l)},a.fC=function(d,l){const h=QD(d);for(const m of h){for(const _ of m.meshes)aat(_);m.lights&&(m.lightMeshIndex=m.meshes.length,m.meshes.push(oat(m.lights,l)))}return h},a.fD=L2,a.fE=Xn,a.fF=Y5,a.fG=As,a.fH=Ts,a.fI=function(d){Ch(),Yo!=null&&Yo.then(l=>{l.keys().then(h=>{for(let m=0;m<h.length-d;m++)l.delete(h[m]).catch(_=>Mi(_.message))}).catch(h=>Mi(h.message))}).catch(l=>Mi(l.message))},a.fa=function(d,l,h=!1){if(Ko===Ts.deferred||Ko===Ts.loading||Ko===Ts.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Lu=ws.resolveURL(d),Ko=Ts.deferred,Hx=l,jx(),h||Zx()},a.fb=function(d){H_=ws.resolveURL(d),j_||(j_=new G_(a2(),new Nc)),j_.broadcast("setMeshoptUrl",H_)},a.fc=Q5,a.fd=function(d){GD=ws.resolveURL(d),j_||(j_=new G_(a2(),new Nc)),j_.broadcast("setDracoUrl",GD)},a.fe=J5,a.ff=E1,a.fg=function(d){const l=Fc();if(!l)return;const h=l.delete(Yp);d&&h.then(()=>d()).catch(d)},a.fh=Vg,a.fi=si,a.fj=Df,a.fk=Qc,a.fl=xU,a.fm=bU,a.fn=bV,a.fo=ii,a.fp="hd_road_elevation",a.fq=Hi,a.fr=ke,a.fs=qh,a.ft=uP,a.fu=Hg,a.fv=function(d,l,h,m,_,S,T,M=1,L,k,F){d.createArrays(),d.tilePixelRatio=Ne/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const V=d.layers[0].layout,U=d.layers[0]._unevaluatedLayout._values,Z={};Z.scaleFactor=M,Z.textSizeScaleRange=V.get("text-size-scale-range"),Z.iconSizeScaleRange=V.get("icon-size-scale-range");const[q,Q]=Z.textSizeScaleRange,[it,at]=Z.iconSizeScaleRange;Z.textScaleFactor=ct(Z.scaleFactor,q,Q),Z.iconScaleFactor=ct(Z.scaleFactor,it,at);const dt=U["text-size"],mt=U["icon-size"];if(d.textSizeData.kind==="composite"){const{minZoom:Ht,maxZoom:se}=d.textSizeData;Z.compositeTextSizes=[dt.possiblyEvaluate(new xn(Ht,{worldview:F}),S),dt.possiblyEvaluate(new xn(se,{worldview:F}),S)]}if(d.iconSizeData.kind==="composite"){const{minZoom:Ht,maxZoom:se}=d.iconSizeData;Z.compositeIconSizes=[mt.possiblyEvaluate(new xn(Ht,{worldview:F}),S),mt.possiblyEvaluate(new xn(se,{worldview:F}),S)]}Z.layoutTextSize=dt.possiblyEvaluate(new xn(T+1,{worldview:F}),S),Z.layoutIconSize=mt.possiblyEvaluate(new xn(T+1,{worldview:F}),S),Z.textMaxSize=dt.possiblyEvaluate(new xn(18,{worldview:F}),S);const _t=V.get("symbol-placement"),Dt=V.get("text-rotation-alignment")==="map"&&_t!=="point",At=V.get("text-size");let Ot=!1;const Nt=[];for(const Ht of d.features){const se=V.get("text-font").evaluate(Ht,{},S).join(","),Kt=At.evaluate(Ht,{},S)*Z.textScaleFactor,le=Z.layoutTextSize.evaluate(Ht,{},S)*Z.textScaleFactor,ge=Z.layoutIconSize.evaluate(Ht,{},S)*Z.iconScaleFactor,Se={horizontal:{},vertical:void 0},ze=Ht.text;let De,me=[0,0];if(ze){const fr=ze.toString(),Pr=V.get("text-letter-spacing").evaluate(Ht,{},S)*ro,qi=V.get("text-line-height").evaluate(Ht,{},S)*ro,Br=ST(fr)?Pr:0,Fr=V.get("text-anchor").evaluate(Ht,{},S),Bn=V.get("text-variable-anchor");if(!Bn){const ue=V.get("text-radial-offset").evaluate(Ht,{},S);if(ue)me=n4(Fr,[ue*ro,fP]);else{const Je=V.get("text-offset").evaluate(Ht,{},S);me=[Je[0]*ro,Je[1]*ro]}}let It=Dt?"center":V.get("text-justify").evaluate(Ht,{},S);const wt=_t==="point",ce=wt?V.get("text-max-width").evaluate(Ht,{},S)*ro:1/0,je=ue=>{d.allowVerticalPlacement&&Vx(fr)&&(Se.vertical=oP(ze,l,h,_,se,ce,qi,Fr,ue,Br,me,el.vertical,!0,le,Kt,L))};if(!Dt&&Bn){const ue=It==="auto"?Bn.map(vi=>pP(vi)):[It];let Je=!1;for(let vi=0;vi<ue.length;vi++){const gi=ue[vi];if(!Se.horizontal[gi])if(Je)Se.horizontal[gi]=Se.horizontal[0];else{const Ji=oP(ze,l,h,_,se,ce,qi,"center",gi,Br,me,el.horizontal,!1,le,Kt,L);Ji&&(Se.horizontal[gi]=Ji,Je=Ji.positionedLines.length===1)}}je("left")}else{if(It==="auto"&&(It=pP(Fr)),wt||V.get("text-writing-mode").indexOf("horizontal")>=0||!Vx(fr)){const ue=oP(ze,l,h,_,se,ce,qi,Fr,It,Br,me,el.horizontal,!1,le,Kt,L);ue&&(Se.horizontal[It]=ue)}je(wt?"left":It)}}let Ee,ae,re,Ie,Re,xe,oi=!1;const ui=V.get("icon-text-fit").evaluate(Ht,{},S);if(Ht.icon&&Ht.icon.hasPrimary()){const fr=V1(Ht.icon,d.iconSizeData,U["icon-size"],S,d.zoom,Ht,L,Z.iconScaleFactor,F);Ee=fr.iconPrimary,re=fr.iconSecondary;const Pr=Ee.toString();if(ae=m.get(Pr),ae&&(Re=V.get("icon-offset").evaluate(Ht,{},S),xe=V.get("icon-anchor").evaluate(Ht,{},S),De=v2(_.get(Pr),re?_.get(re.toString()):void 0,Re,xe),oi=ae.sdf,d.sdfIcons===void 0?d.sdfIcons=ae.sdf:d.sdfIcons!==ae.sdf&&Mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==d.pixelRatio||V.get("icon-rotate").constantOr(1)!==0)&&(d.iconsNeedLinear=!0)),re){const qi=re.toString();Ie=m.get(qi)}}Ot=Ot||!(!Ht.icon||!Ht.icon.hasSecondary());const ri=gP(Se.horizontal)||Se.vertical;d.iconsInText||(d.iconsInText=!!ri&&ri.iconsInText);const Xe=le*Z.textScaleFactor/ro,{defaultShapedIcon:ji,verticallyShapedIcon:Qe}=uot(d,De,V,Ht,S,Se,Xe,Re,ui);ui!=="none"&&De&&(HV(De)||jV(De))&&(w2(0,ae,Ee,De,ji,ui,k,m,_),w2(0,Ie,re,De,ji,ui,k,m,_),Qe&&(w2(0,ae,Ee,De,Qe,ui,k,m,_),w2(0,Ie,re,De,Qe,ui,k,m,_))),De=ji;const{iconBBox:Ii,iconVerticalBBox:Zi}=sot(d,De,Qe,V,Ht,S,ge,Re,Z,_,xe);Nt.push({feature:Ht,shapedTextOrientations:Se,shapedText:ri,shapedIcon:De,iconPrimary:Ee,iconSecondary:re,iconOffset:Re,iconAnchor:xe,verticallyShapedIcon:Qe,layoutTextSize:le,layoutIconSize:ge,textOffset:me,isSDFIcon:oi,iconTextFit:ui,iconCollisionBounds:Ii,iconVerticalCollisionBounds:Zi})}return{featureData:Nt,sizes:Z,hasAnySecondaryIcon:Ot,textAlongLine:Dt,symbolPlacement:_t}},a.fw=JV,a.fx=function(d,l,h,m,_,S,T,M,L,k){d.iconAtlasPositions=k.iconPositions;const{featureData:F,hasAnySecondaryIcon:V,sizes:U,textAlongLine:Z,symbolPlacement:q}=l;for(const Q of F){const{shapedIcon:it,verticallyShapedIcon:at,feature:dt,shapedTextOrientations:mt,shapedText:_t,layoutTextSize:Dt,textOffset:At,isSDFIcon:Ot,iconPrimary:Nt,iconSecondary:Ht,iconTextFit:se,iconOffset:Kt,iconCollisionBounds:le,iconVerticalCollisionBounds:ge}=Q;o4(it,k.iconPositions,Nt,Ht),o4(at,k.iconPositions,Nt,Ht),cot(mt,k.iconPositions),lot(Nt,Ht,k.iconPositions),(_t||it)&&hot(d,dt,mt,it,at,L,U,Dt,0,At,Ot,m,_,T,M,V,se,Kt,Z,q,le,ge)}h&&d.generateCollisionDebugBuffers(S,d.collisionBoxArray,U.textScaleFactor)},a.fy=hi,a.fz=F2,a.g=function(d,l){return Jp(Object.assign(d,{method:"GET"}),l)},a.h=function(d){return d.indexOf("mapbox:")===0},a.i=function(d){return An.API_STYLE_REGEX.test(d)&&!No(d)},a.j=za,a.k=Bv,a.l=function(d){return decodeURIComponent(atob(d).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.m=function(d,l){return Jp(Object.assign(d,{type:"json"}),l)},a.n=nx,a.o=ws,a.p=function(d,l){return Jp(Object.assign(d,{method:"POST"}),l)},a.q=Mo,a.r=bs,a.s=function(d){try{const l=self[d];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=function(){return UD||(UD=new Vg),UD},a.u=function(){return function d(l){return l?(l^Math.random()*(16>>l/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},a.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},a.w=Mi,a.x=PP,a.y=ag,a.z=js}),o(["./shared"],function(a){function u(Xt){const ot=Xt?Xt.url.toString():void 0;return ot?performance.getEntriesByName(ot):[]}function f(Xt){if(typeof Xt=="number"||typeof Xt=="boolean"||typeof Xt=="string"||Xt==null)return JSON.stringify(Xt);if(Array.isArray(Xt)){let ct="[";for(const St of Xt)ct+=`${f(St)},`;return`${ct}]`}let ot="{";for(const ct of Object.keys(Xt).sort())ot+=`${ct}:${f(Xt[ct])},`;return`${ot}}`}function g(Xt){let ot="";for(const ct of a.bw)ot+=`/${f(Xt[ct])}`;return ot}class v{constructor(ot){this.keyCache={},this._layers={},this._layerConfigs={},ot&&this.replace(ot)}replace(ot,ct){this._layerConfigs={},this._layers={},this.update(ot,[],ct)}update(ot,ct,St){this._options=St;for(const Bt of ot)this._layerConfigs[Bt.id]=Bt,(this._layers[Bt.id]=a.dt(Bt,this.scope,null,this._options)).compileFilter(St),this.keyCache[Bt.id]&&delete this.keyCache[Bt.id];for(const Bt of ct)delete this.keyCache[Bt],delete this._layerConfigs[Bt],delete this._layers[Bt];this.familiesBySource={};const Ft=function(Bt,Wt){const ne={};for(let ie=0;ie<Bt.length;ie++){const ke=Bt[ie];let Me=Wt&&Wt[ke.id];Me||(ke.type==="symbol"?Me=ke.id:(Me=g(ke),ke.type==="line"&&ke.paint&&function Gi(Bi){return typeof Bi=="string"&&Bi==="line-progress"||(Array.isArray(Bi)?Bi.some(Gi):!(!Bi||typeof Bi!="object")&&Object.values(Bi).some(Gi))}(ke.paint["line-width"])&&(Me+=`/${f(ke.paint["line-width"])}`))),Wt&&(Wt[ke.id]=Me);let mi=ne[Me];mi||(mi=ne[Me]=[]),mi.push(ke)}const $t=[];for(const ie in ne)$t.push(ne[ie]);return $t}(Object.values(this._layerConfigs),this.keyCache);for(const Bt of Ft){const Wt=Bt.map(mi=>this._layers[mi.id]),ne=Wt[0];if(ne.visibility==="none")continue;const $t=ne.source||"";let ie=this.familiesBySource[$t];ie||(ie=this.familiesBySource[$t]={});const ke=ne.sourceLayer||"_geojsonTileLayer";let Me=ie[ke];Me||(Me=ie[ke]=[]),Me.push(Wt)}}}const y=1*a.fk;class w{constructor(ot){const ct={},St=[];for(const ne in ot){const $t=ot[ne],ie=ct[ne]={};for(const ke in $t.glyphs){const Me=$t.glyphs[+ke];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const mi=Me.metrics.localGlyph?y:1,Gi={x:0,y:0,w:Me.bitmap.width+2*mi,h:Me.bitmap.height+2*mi};St.push(Gi),ie[ke]=Gi}}const{w:Ft,h:Bt}=a.G(St),Wt=new a.fj({width:Ft||1,height:Bt||1});for(const ne in ot){const $t=ot[ne];for(const ie in $t.glyphs){const ke=$t.glyphs[+ie];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const Me=ct[ne][ie],mi=ke.metrics.localGlyph?y:1;a.fj.copy(ke.bitmap,Wt,{x:0,y:0},{x:Me.x+mi,y:Me.y+mi},ke.bitmap)}}this.image=Wt,this.positions=ct}}function I(Xt,ot,ct){Xt[ot]?ct&&(Xt[ot].center=ct):Xt[ot]={floorIds:new Set,center:ct||[0,0],floors:{}}}function E(Xt,ot,ct,St){for(const Ft of ot)I(Xt,Ft),Xt[Ft].floors[ct]=St,Xt[Ft].floorIds.add(ct)}function D(Xt){return{id:Xt.properties.id.toString(),center:Xt.properties.center.toString().split(";").map(Number)}}function R(Xt){return{id:Xt.properties.id.toString(),isDefault:!!Xt.properties.is_default&&Xt.properties.is_default,connections:Xt.properties.connected_floor_ids?new Set(Xt.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Xt.properties.conflicted_floor_ids?new Set(Xt.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Xt.properties.building_ids?new Set(Xt.properties.building_ids.toString().split(";")):new Set,name:Xt.properties.name.toString(),zIndex:Xt.properties.z_index}}function z(Xt,ot){return ot.every(ct=>Xt.properties&&Xt.properties[ct]!=null)}function N(Xt){return z(Xt,["type","id","name"])&&Xt.properties.type==="building"}function H(Xt){return z(Xt,["type","id","name","z_index"])&&Xt.properties.type==="floor"}a.fi(w,"GlyphAtlas");class ${constructor(ot){this.tileID=new a.aP(ot.tileID.overscaledZ,ot.tileID.wrap,ot.tileID.canonical.z,ot.tileID.canonical.x,ot.tileID.canonical.y),this.tileZoom=ot.tileZoom,this.uid=ot.uid,this.zoom=ot.zoom,this.lut=ot.lut,this.canonical=ot.tileID.canonical,this.pixelRatio=ot.pixelRatio,this.tileSize=ot.tileSize,this.source=ot.source,this.scope=ot.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ot.showCollisionBoxes,this.collectResourceTiming=!!ot.request&&ot.request.collectResourceTiming,this.promoteId=ot.promoteId,this.isSymbolTile=ot.isSymbolTile,this.tileTransform=a.aY(ot.tileID.canonical,ot.projection),this.projection=ot.projection,this.worldview=ot.worldview,this.localizableLayerIds=ot.localizableLayerIds,this.brightness=ot.brightness,this.extraShadowCaster=!!ot.extraShadowCaster,this.tessellationStep=ot.tessellationStep,this.scaleFactor=ot.scaleFactor,this.worldview=ot.worldview,this.indoor=ot.indoor}parse(ot,ct,St,Ft,Bt,Wt){this.status="parsing",this.data=ot,this.collisionBoxArray=new a.b2;const ne=new a.fl(Object.keys(ot.layers).sort()),$t=new a.fm(this.tileID,this.promoteId);$t.bucketLayerIDs=[];const ie={},ke=new a.fn(256,256),Me={featureIndex:$t,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ke,availableImages:St,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Mi=this.indoor.indoorState.activeFloorsVisible,dr=function(pr,nn,Xn){const ba=function(en,Sr){if(!en)return a.w("No source layers defined in indoor specification"),Sr;if(en.size===0)return Sr;const Tn=en.difference(Sr);for(const jn of Tn)a.w(`Missing source layer required in indoor specification: ${jn}`);return Sr.intersection(Sr)}(nn.sourceLayers,new Set(Object.keys(pr.layers))),aa=nn.indoorState,ea=function(en,Sr,Tn,jn){const sn=new Set,An=new Set,za=new Set,No=new Map,ml={},Mh=Ga=>{const vl=No.get(Ga)||new Set;for(const Xo of sn)if((No.get(Xo)||new Set).has(Ga)||vl.has(Xo))return!0;return!1};for(const Ga of Sr){const vl=en.layers[Ga];if(vl)for(let Xo=0;Xo<vl.length;Xo++){const Bl=vl.feature(Xo);if(N(Bl)){const{id:bs,center:ws}=D(Bl);I(ml,bs,ws),sn.add(bs)}else if(H(Bl)){const{id:bs,isDefault:ws,connections:Ov,conflicts:Xp,buildings:Yp,name:Kp,zIndex:ls}=R(Bl);E(ml,Yp,bs,{name:Kp,zIndex:ls}),No.set(bs,Xp),(bs===jn||Ov.has(jn))&&sn.add(bs),An.add(bs),ws&&za.add(bs)}}else a.w(`indoor source layer not found: ${Ga}`)}if(Tn)for(const Ga of Tn)An.has(Ga)&&(Mh(Ga)||sn.add(Ga));for(const Ga of za)sn.has(Ga)||Mh(Ga)||sn.add(Ga);return{buildings:ml,activeFloors:sn}}(pr,ba,aa.lastActiveFloors,aa.selectedFloorId);return Xn.send("setIndoorData",ea),ea}(ot,this.indoor,Bt);Me.activeFloors=Mi?dr.activeFloors:void 0}const mi=[],Gi=ct.familiesBySource[this.source];for(const Mi in Gi){const dr=ot.layers[Mi];if(!dr)continue;let pr=!1,nn=!1,Xn=!1;for(const en of Gi[Mi])en[0].type==="symbol"?pr=!0:nn=!0,en[0].is3D()&&en[0].type!=="model"&&(Xn=!0);if(this.extraShadowCaster&&!Xn||this.isSymbolTile===!0&&!pr||this.isSymbolTile===!1&&!nn)continue;dr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ba=ne.encode(Mi),aa=[];let ea=!1;for(let en=0,Sr=0;en<dr.length;en++){const Tn=dr.feature(en),jn=$t.getId(Tn,Mi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Mi)){const sn=Tn.properties?Tn.properties.worldview:null;if(this.worldview&&typeof sn=="string")if(sn==="all")Tn.properties.$localized=!0;else{if(!sn.split(",").includes(this.worldview))continue;Tn.properties.$localized=!0,Tn.properties.worldview=this.worldview}}!ea&&Tn.properties&&Tn.properties.hasOwnProperty(a.fo)&&(ea=!0),aa.push({feature:Tn,id:jn,index:Sr,sourceLayerIndex:ba}),Sr++}ea&&!Me.elevationFeatures&&ot.layers.hasOwnProperty(a.fp)&&(Me.elevationFeatures=a.fq.parseFrom(ot.layers[a.fp],this.canonical));for(const en of Gi[Mi]){const Sr=en[0];if(this.extraShadowCaster&&(!Sr.is3D()||Sr.type==="model")||this.isSymbolTile!==void 0&&Sr.type==="symbol"!==this.isSymbolTile||Sr.minzoom&&this.zoom<Math.floor(Sr.minzoom)||Sr.maxzoom&&this.zoom>=Sr.maxzoom||Sr.visibility==="none")continue;X(en,this.zoom,Me.brightness,St,this.worldview);const Tn=ie[Sr.id]=Sr.createBucket({index:$t.bucketLayerIDs.length,layers:en,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ba,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ft,worldview:this.worldview});$t.bucketLayerIDs.push(en.map(sn=>a.B(sn.id,sn.scope)));let jn=Tn.prepare?Tn.prepare():null;jn!=null?(jn=jn.then(()=>Tn.populate(aa,Me,this.tileID.canonical,this.tileTransform)),mi.push(jn)):Tn.populate(aa,Me,this.tileID.canonical,this.tileTransform)}}const Bi=()=>{let Mi,dr,pr,nn,Xn,ba;ke.trim();const aa={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ea=()=>{if(Mi)return this.status="done",Wt(Mi);if(this.extraShadowCaster)this.status="done",Wt(null,{buckets:Object.values(ie).filter(Sr=>!Sr.isEmpty()),featureIndex:$t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Me.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(dr&&pr&&nn){const Sr=new w(dr),Tn=new Map;for(const[An,za]of pr.entries()){const{imagePosition:No}=a.ft(An,za,a.fu);Tn.set(An,No)}const jn={};for(const An in ie){const za=ie[An];za instanceof a.b3&&(X(za.layers,this.zoom,Me.brightness,St,this.worldview),jn[An]=a.fv(za,dr,Sr.positions,pr,Tn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Xn,this.worldview))}const sn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Bt,pr,Xn,()=>{sn.iconsPending=!1,en(jn,Sr,sn)}),this.rasterizeIfNeeded(Bt,nn,ba,()=>{sn.patternsPending=!1,en(jn,Sr,sn)})}},en=(Sr,Tn,jn,sn)=>{if(jn.iconsPending||jn.patternsPending)return;const An=new a.fw(pr,nn,this.lut);for(const za in ie){const No=ie[za];if(za in Sr)a.fx(No,Sr[za],this.showCollisionBoxes,St,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,pr,An);else if(No.hasPattern&&(No instanceof a.b9||No instanceof a.ba||No instanceof a.e9)){X(No.layers,this.zoom,Me.brightness,St,this.worldview);const ml=Object.fromEntries(An.patternPositions);No.addFeatures(Me,this.tileID.canonical,ml,St,this.tileTransform,this.brightness)}}this.status="done",Wt(null,{buckets:Object.values(ie).filter(za=>!za.isEmpty()),featureIndex:$t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tn.image,lineAtlas:ke,imageAtlas:An,brightness:Me.brightness})};if(!this.extraShadowCaster){const Sr=a.fr(Me.glyphDependencies,sn=>Object.keys(sn).map(Number));Object.keys(Sr).length?Bt.send("getGlyphs",{uid:this.uid,stacks:Sr},(sn,An)=>{Mi||(Mi=sn,dr=An,ea())},void 0,!1,aa):dr={};const Tn=Array.from(Me.iconDependencies.keys()).map(sn=>a.I.parse(sn));Tn.length?Bt.send("getImages",{images:Tn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sn,An)=>{Mi||(Mi=sn,pr=new Map,Xn=this.updateImageMapAndGetImageTaskQueue(pr,An,Me.iconDependencies),ea())},void 0,!1,aa):(pr=new Map,Xn=new Map);const jn=Array.from(Me.patternDependencies.keys()).map(sn=>a.I.parse(sn));jn.length?Bt.send("getImages",{images:jn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sn,An)=>{Mi||(Mi=sn,nn=new Map,ba=this.updateImageMapAndGetImageTaskQueue(nn,An,Me.patternDependencies),ea())},void 0,!1,aa):(nn=new Map,ba=new Map)}if(Me.elevationFeatures&&Me.elevationFeatures.length>0){const Sr=[];for(const jn of Object.values(ie))if(jn instanceof a.ba){const sn=jn.getUnevaluatedPortalGraph();sn&&Sr.push(sn)}const Tn=a.fs.evaluate(Sr);for(const jn of Object.values(ie))if(jn instanceof a.ba){const sn=ot.layers[ne.decode(jn.sourceLayerIndex)];jn.setEvaluatedPortalGraph(Tn,sn,this.tileID.canonical,Me.availableImages,Me.brightness)}}ea()};mi.length>0?Promise.allSettled(mi).then(Bi).catch(Wt):Bi()}updateParameters(ot){this.scaleFactor=ot.scaleFactor,this.showCollisionBoxes=ot.showCollisionBoxes,this.projection=ot.projection,this.brightness=ot.brightness,this.tileTransform=a.aY(ot.tileID.canonical,ot.projection),this.extraShadowCaster=ot.extraShadowCaster,this.lut=ot.lut,this.worldview=ot.worldview,this.indoor=ot.indoor}rasterizeIfNeeded(ot,ct,St,Ft){Array.from(ct.values()).some(Bt=>Bt.usvg)?this.rasterize(ot,ct,St,Ft):Ft()}updateImageMapAndGetImageTaskQueue(ot,ct,St){const Ft=new Map;for(const Bt of ct.keys()){const Wt=St.get(Bt)||[];for(const ne of Wt){const $t=ne.toString(),ie=ct.get(ne.id.toString());ie.usvg?Ft.has($t)||(Ft.set($t,ne),ot.set($t,Object.assign({},ie))):ot.set($t,ie)}}return Ft}rasterize(ot,ct,St,Ft){this.rasterizeTask=ot.send("rasterizeImages",{scope:this.scope,tasks:St},(Bt,Wt)=>{if(!Bt)for(const[ne,$t]of Wt.entries()){const ie=Object.assign(ct.get(ne),{data:$t});ct.set(ne,ie)}Ft()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function X(Xt,ot,ct,St,Ft){const Bt=new a.ac(ot,{brightness:ct,worldview:Ft});for(const Wt of Xt)Wt.recalculate(Bt,St)}class K extends a.E{constructor(ot,ct,St,Ft,Bt,Wt,ne){super(),this.actor=ot,this.layerIndex=ct,this.availableImages=St,this.availableModels=Ft,this.loadVectorData=Wt||a.aL,this.loading={},this.loaded={},this.deduped=new a.aK(ot.scheduler),this.isSpriteLoaded=Bt,this.scheduler=ot.scheduler,this.brightness=ne}loadTile(ot,ct){const St=ot.uid,Ft=ot&&ot.request,Bt=Ft&&Ft.collectResourceTiming,Wt=this.loading[St]=new $(ot);Wt.abort=this.loadVectorData(ot,(ne,$t)=>{const ie=!this.loading[St];if(delete this.loading[St],Wt.cancelRasterize(),ie||ne||!$t)return Wt.status="done",ie||(this.loaded[St]=Wt),ct(ne);const ke=$t.rawData,Me={},mi=a.aM($t.responseHeaders);mi&&mi.expires&&(Me.expires=mi.expires),mi&&mi.cacheControl&&(Me.cacheControl=mi.cacheControl),Wt.vectorTile=$t.vectorTile||new a.fy(new a.bs(ke));const Gi=()=>{Wt.parse(Wt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Bi,Mi)=>{if(Bi||!Mi)return ct(Bi);const dr={};if(Bt){const pr=u(Ft);pr.length>0&&(dr.resourceTiming=JSON.parse(JSON.stringify(pr)))}ct(null,Object.assign({rawTileData:ke.slice(0),responseHeaders:$t.responseHeaders},Mi,Me,dr))})};this.isSpriteLoaded?Gi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Gi,{type:"parseTile",isSymbolTile:ot.isSymbolTile,zoom:ot.tileZoom}):Gi()}),this.loaded=this.loaded||{},this.loaded[St]=Wt})}reloadTile(ot,ct){const St=this.loaded,Ft=ot.uid;if(St&&St[Ft]){const Bt=St[Ft];Bt.updateParameters(ot);const Wt=(ne,$t)=>{const ie=Bt.reloadCallback;ie&&(delete Bt.reloadCallback,Bt.parse(Bt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ie)),ct(ne,$t)};Bt.status==="parsing"?Bt.reloadCallback=Wt:Bt.status==="done"&&(Bt.vectorTile?Bt.parse(Bt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Wt):Wt())}else ct(null,void 0)}abortTile(ot,ct){const St=ot.uid,Ft=this.loading[St];Ft&&(Ft.abort&&Ft.abort(),delete this.loading[St]),ct()}removeTile(ot,ct){const St=this.loaded,Ft=ot.uid;St&&St[Ft]&&delete St[Ft],ct()}}class et{loadTile(ot,ct){const{uid:St,encoding:Ft,rawImageData:Bt,padding:Wt}=ot,ne=ImageBitmap&&Bt instanceof ImageBitmap?this.getImageData(Bt,Wt):Bt;ct(null,new a.fz(St,ne,Ft,Wt<1))}reloadTile(ot,ct){ct(null,null)}abortTile(ot,ct){ct()}removeTile(ot,ct){ct()}getImageData(ot,ct){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ot.width,ot.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ot.width,this.offscreenCanvas.height=ot.height,this.offscreenCanvasContext.drawImage(ot,0,0,ot.width,ot.height);const St=this.offscreenCanvasContext.getImageData(-ct,-ct,ot.width+2*ct,ot.height+2*ct);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),St}}a.br.setPbf(a.bs);class rt{constructor(ot){this._mrt=new a.br(ot.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ot.uid,this.tileID=ot.tileID,this.source=ot.source}parse(ot,ct){const St=this._mrt;this.status="parsing",this._entireBuffer=ot;try{St.parseHeader(ot),this._isHeaderLoaded=!0;const Ft=[];for(const Bt in St.layers){const Wt=St.getLayer(Bt),ne=Wt.getDataRange(Wt.getBandList()),$t=St.createDecodingTask(ne),ie=ot.slice(ne.firstByte,ne.lastByte+1),ke=a.br.performDecoding(ie,$t).then(Me=>$t.complete(null,Me)).catch(Me=>$t.complete(Me,null));Ft.push(ke)}Promise.allSettled(Ft).then(()=>ct(null,St)).catch(Bt=>ct(Bt))}catch(Ft){ct(Ft)}}}class lt{constructor(ot){this.actor=ot,this.loading={},this.loaded={}}loadTile(ot,ct){const St=ot.uid,Ft=ot.request,Bt=this.loading[St]=new rt(ot),{cancel:Wt}=a.bt(Ft,(ne,$t,ie)=>{const ke=!this.loading[St];if(delete this.loading[St],ke||ne||!$t)return Bt.status="done",ke||(this.loaded[St]=Bt),ct(ne);Bt.parse($t,(Me,mi)=>{if(Me||!mi)return ct(Me);ct(null,mi,ie)}),this.loaded[St]=Bt});Bt.abort=Wt}reloadTile(ot,ct){ct(null,void 0)}abortTile(ot,ct){const St=ot.uid,Ft=this.loading[St];Ft&&(Ft.abort&&Ft.abort(),delete this.loading[St]),ct()}removeTile(ot,ct){const St=ot.uid;this.loaded[St]&&delete this.loaded[St],ct()}decodeRasterArray(ot,ct){a.br.performDecoding(ot.buffer,ot.task).then(St=>ct(null,St)).catch(St=>ct(St))}}const ht=a.fA.prototype.toGeoJSON;class yt{constructor(ot){this._feature=ot,this.extent=a.al,this.type=ot.type,this.properties=ot.tags,"id"in ot&&!isNaN(ot.id)&&(this.id=parseInt(ot.id,10))}loadGeometry(){if(this._feature.type===1){const ot=[];for(const ct of this._feature.geometry)ot.push([new a.P(ct[0],ct[1])]);return ot}{const ot=[];for(const ct of this._feature.geometry){const St=[];for(const Ft of ct)St.push(new a.P(Ft[0],Ft[1]));ot.push(St)}return ot}}toGeoJSON(ot,ct,St){return ht.call(this,ot,ct,St)}}class ft{constructor(ot,ct){this.name=ot,this.extent=a.al,this.length=ct.length,this._jsonFeatures=ct}feature(ot){return new yt(this._jsonFeatures[ot])}}class kt{constructor(ot){this.layers={},this.extent=a.al;for(const ct of Object.keys(ot))this.layers[ct]=new ft(ct,ot[ct])}}const Rt=64/4096,Ct=128;class Gt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ot=[],ct){for(const St of ot){const Ft=St.id;if(Ft==null)continue;let Bt=this.features.get(Ft);Bt&&this.updateCache(Bt,ct),St.geometry?(Bt=Qt(St),this.updateCache(Bt,ct),this.features.set(Ft,Bt)):this.features.delete(Ft),this.updateCache(Bt,ct)}}updateCache(ot,ct){for(const{canonical:St,uid:Ft}of Object.values(ct)){const{z:Bt,x:Wt,y:ne}=St;Vt(ot,Math.pow(2,Bt),Wt,ne)&&delete ct[Ft]}}getTile(ot,ct,St){const Ft=Math.pow(2,ot),Bt=[];for(const Wt of this.features.values())Vt(Wt,Ft,ct,St)&&Bt.push(Ge(Wt,Ft,ct,St));return{features:Bt}}getFeatures(){return[...this.features.values()]}}function Vt({minX:Xt,minY:ot,maxX:ct,maxY:St},Ft,Bt,Wt){return Xt<(Bt+1+Rt)/Ft&&ot<(Wt+1+Rt)/Ft&&ct>(Bt-Rt)/Ft&&St>(Wt-Rt)/Ft}function Qt(Xt){const{id:ot,geometry:ct,properties:St}=Xt;if(!ct)return;if(ct.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ft,coordinates:Bt}=ct,Wt={id:ot,type:1,geometry:[],tags:St,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ne=Wt.geometry;if(Ft==="Point")fe(Bt,ne,Wt);else if(Ft==="MultiPoint")for(const $t of Bt)fe($t,ne,Wt);else if(Ft==="LineString")Wt.type=2,Te(Bt,ne,Wt);else if(Ft==="MultiLineString")Wt.type=2,be(Bt,ne,Wt);else if(Ft==="Polygon")Wt.type=3,be(Bt,ne,Wt,!0);else{if(Ft!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Wt.type=3;for(const $t of Bt)be($t,ne,Wt,!0)}return Wt}function fe([Xt,ot],ct,St){const Ft=a.aF(Xt);let Bt=a.aJ(ot);Bt=Bt<0?0:Bt>1?1:Bt,ct.push(Ft,Bt),St.minX=Math.min(St.minX,Ft),St.minY=Math.min(St.minY,Bt),St.maxX=Math.max(St.maxX,Ft),St.maxY=Math.max(St.maxY,Bt)}function Te(Xt,ot,ct,St=!1,Ft=!1){const Bt=[];for(const Wt of Xt)fe(Wt,Bt,ct);ot.push(Bt),St&&function(Wt,ne){let $t=0;for(let ie=0,ke=Wt.length,Me=ke-2;ie<ke;Me=ie,ie+=2)$t+=(Wt[ie]-Wt[Me])*(Wt[ie+1]+Wt[Me+1]);if($t>0===ne)for(let ie=0,ke=Wt.length;ie<ke/2;ie+=2){const Me=Wt[ie],mi=Wt[ie+1];Wt[ie]=Wt[ke-2-ie],Wt[ie+1]=Wt[ke-1-ie],Wt[ke-2-ie]=Me,Wt[ke-1-ie]=mi}}(Bt,Ft)}function be(Xt,ot,ct,St=!1){for(let Ft=0;Ft<Xt.length;Ft++)Te(Xt[Ft],ot,ct,St,Ft===0)}function Ge(Xt,ot,ct,St){const{id:Ft,type:Bt,geometry:Wt,tags:ne}=Xt,$t=[];if(Bt===1)(function(ie,ke,Me,mi,Gi){for(let Bi=0;Bi<ie.length;Bi+=2){const Mi=Math.round(a.al*(ie[Bi+0]*ke-Me)),dr=Math.round(a.al*(ie[Bi+1]*ke-mi));Gi.push([Mi,dr])}})(Wt,ot,ct,St,$t);else for(const ie of Wt)li(ie,ot,ct,St,$t);return{id:Ft,type:Bt,geometry:$t,tags:ne}}function li(Xt,ot,ct,St,Ft){const Bt=-Ct,Wt=a.al+Ct;let ne;for(let $t=0;$t<Xt.length-2;$t+=2){let ie=Math.round(a.al*(Xt[$t+0]*ot-ct)),ke=Math.round(a.al*(Xt[$t+1]*ot-St)),Me=Math.round(a.al*(Xt[$t+2]*ot-ct)),mi=Math.round(a.al*(Xt[$t+3]*ot-St));const Gi=Me-ie,Bi=mi-ke;ie<Bt&&Me<Bt||(ie<Bt?(ke+=Math.round(Bi*((Bt-ie)/Gi)),ie=Bt):Me<Bt&&(mi=ke+Math.round(Bi*((Bt-ie)/Gi)),Me=Bt),ke<Bt&&mi<Bt||(ke<Bt?(ie+=Math.round(Gi*((Bt-ke)/Bi)),ke=Bt):mi<Bt&&(Me=ie+Math.round(Gi*((Bt-ke)/Bi)),mi=Bt),ie>=Wt&&Me>=Wt||(ie>=Wt?(ke+=Math.round(Bi*((Wt-ie)/Gi)),ie=Wt):Me>=Wt&&(mi=ke+Math.round(Bi*((Wt-ie)/Gi)),Me=Wt),ke>=Wt&&mi>=Wt||(ke>=Wt?(ie+=Math.round(Gi*((Wt-ke)/Bi)),ke=Wt):mi>=Wt&&(Me=ie+Math.round(Gi*((Wt-ke)/Bi)),mi=Wt),ne&&ie===ne[ne.length-1][0]&&ke===ne[ne.length-1][1]||(ne=[[ie,ke]],Ft.push(ne)),ne.push([Me,mi])))))}}function Pi({name:Xt,features:ot},ct){ct.writeStringField(1,Xt),ct.writeVarintField(5,a.al);const St=new Map,Ft=new Map,Bt={keys:St,values:Ft,feature:null};for(const Wt of ot)Bt.feature=Wt,ct.writeMessage(2,or,Bt);for(const Wt of St.keys())ct.writeStringField(3,Wt);for(const Wt of Ft.keys())ct.writeMessage(4,We,Wt)}function or(Xt,ot){const ct=Xt.feature;ct.id!==void 0&&Number.isSafeInteger(+ct.id)&&ot.writeVarintField(1,+ct.id),ct.tags&&ot.writeMessage(2,Ve,Xt),ot.writeVarintField(3,ct.type),ot.writeMessage(4,Ke,ct)}function Ve({keys:Xt,values:ot,feature:ct},St){for(const Ft of Object.keys(ct.tags)){let Bt=ct.tags[Ft];if(Bt===null)continue;let Wt=Xt.get(Ft);Wt===void 0&&(Wt=Xt.size,Xt.set(Ft,Wt)),St.writeVarint(Wt);const ne=typeof Bt;ne!=="string"&&ne!=="boolean"&&ne!=="number"&&(Bt=JSON.stringify(Bt));let $t=ot.get(Bt);$t===void 0&&($t=ot.size,ot.set(Bt,$t)),St.writeVarint($t)}}function Ze(Xt,ot){return(ot<<3)+(7&Xt)}function ye(Xt){return Xt<<1^Xt>>31}function Ke(Xt,ot){const{geometry:ct,type:St}=Xt;let Ft=0,Bt=0;if(St===1){ot.writeVarint(Ze(1,ct.length));for(const Wt of ct){const ne=Wt[0]-Ft,$t=Wt[1]-Bt;ot.writeVarint(ye(ne)),ot.writeVarint(ye($t)),Ft+=ne,Bt+=$t}}else for(const Wt of ct){ot.writeVarint(Ze(1,1));const ne=Wt.length-(St===3?1:0);for(let $t=0;$t<ne;$t++){$t===1&&ot.writeVarint(Ze(2,ne-1));const ie=Wt[$t][0]-Ft,ke=Wt[$t][1]-Bt;ot.writeVarint(ye(ie)),ot.writeVarint(ye(ke)),Ft+=ie,Bt+=ke}St===3&&ot.writeVarint(Ze(7,1))}}function We(Xt,ot){const ct=typeof Xt;ct==="string"?ot.writeStringField(1,Xt):ct==="boolean"?ot.writeBooleanField(7,Xt):ct==="number"&&(Xt%1!=0?ot.writeDoubleField(3,Xt):Xt<0?ot.writeSVarintField(6,Xt):ot.writeVarintField(5,Xt))}const Si={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xt=>Xt},zt=Math.fround||(Zt=new Float32Array(1),Xt=>(Zt[0]=+Xt,Zt[0]));var Zt;const pe=3,$e=5,He=6;class qe{constructor(ot){this.options=Object.assign(Object.create(Si),ot),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ot){const{log:ct,minZoom:St,maxZoom:Ft}=this.options;ct&&console.time("total time");const Bt=`prepare ${ot.length} points`;ct&&console.time(Bt),this.points=ot;const Wt=[];for(let $t=0;$t<ot.length;$t++){const ie=ot[$t];if(!ie.geometry)continue;const[ke,Me]=ie.geometry.coordinates,mi=zt(_i(ke)),Gi=zt(pi(Me));Wt.push(mi,Gi,1/0,$t,-1,1),this.options.reduce&&Wt.push(0)}let ne=this.trees[Ft+1]=this._createTree(Wt);ct&&console.timeEnd(Bt);for(let $t=Ft;$t>=St;$t--){const ie=+Date.now();ne=this.trees[$t]=this._createTree(this._cluster(ne,$t)),ct&&console.log("z%d: %d clusters in %dms",$t,ne.numItems,+Date.now()-ie)}return ct&&console.timeEnd("total time"),this}getClusters(ot,ct){let St=((ot[0]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,ot[1]));let Bt=ot[2]===180?180:((ot[2]+180)%360+360)%360-180;const Wt=Math.max(-90,Math.min(90,ot[3]));if(ot[2]-ot[0]>=360)St=-180,Bt=180;else if(St>Bt){const Me=this.getClusters([St,Ft,180,Wt],ct),mi=this.getClusters([-180,Ft,Bt,Wt],ct);return Me.concat(mi)}const ne=this.trees[this._limitZoom(ct)],$t=ne.range(_i(St),pi(Wt),_i(Bt),pi(Ft)),ie=ne.data,ke=[];for(const Me of $t){const mi=this.stride*Me;ke.push(ie[mi+$e]>1?Ti(ie,mi,this.clusterProps):this.points[ie[mi+pe]])}return ke}getChildren(ot){const ct=this._getOriginId(ot),St=this._getOriginZoom(ot),Ft="No cluster with the specified id.",Bt=this.trees[St];if(!Bt)throw new Error(Ft);const Wt=Bt.data;if(ct*this.stride>=Wt.length)throw new Error(Ft);const ne=this.options.radius/(this.options.extent*Math.pow(2,St-1)),$t=Bt.within(Wt[ct*this.stride],Wt[ct*this.stride+1],ne),ie=[];for(const ke of $t){const Me=ke*this.stride;Wt[Me+4]===ot&&ie.push(Wt[Me+$e]>1?Ti(Wt,Me,this.clusterProps):this.points[Wt[Me+pe]])}if(ie.length===0)throw new Error(Ft);return ie}getLeaves(ot,ct,St){const Ft=[];return this._appendLeaves(Ft,ot,ct=ct||10,St=St||0,0),Ft}getTile(ot,ct,St){const Ft=this.trees[this._limitZoom(ot)],Bt=Math.pow(2,ot),{extent:Wt,radius:ne}=this.options,$t=ne/Wt,ie=(St-$t)/Bt,ke=(St+1+$t)/Bt,Me={features:[]};return this._addTileFeatures(Ft.range((ct-$t)/Bt,ie,(ct+1+$t)/Bt,ke),Ft.data,ct,St,Bt,Me),ct===0&&this._addTileFeatures(Ft.range(1-$t/Bt,ie,1,ke),Ft.data,Bt,St,Bt,Me),ct===Bt-1&&this._addTileFeatures(Ft.range(0,ie,$t/Bt,ke),Ft.data,-1,St,Bt,Me),Me.features.length?Me:null}getClusterExpansionZoom(ot){let ct=this._getOriginZoom(ot)-1;for(;ct<=this.options.maxZoom;){const St=this.getChildren(ot);if(ct++,St.length!==1)break;ot=St[0].properties.cluster_id}return ct}_appendLeaves(ot,ct,St,Ft,Bt){const Wt=this.getChildren(ct);for(const ne of Wt){const $t=ne.properties;if($t&&$t.cluster?Bt+$t.point_count<=Ft?Bt+=$t.point_count:Bt=this._appendLeaves(ot,$t.cluster_id,St,Ft,Bt):Bt<Ft?Bt++:ot.push(ne),ot.length===St)break}return Bt}_createTree(ot){const ct=new a.c3(ot.length/this.stride|0,this.options.nodeSize,Float32Array);for(let St=0;St<ot.length;St+=this.stride)ct.add(ot[St],ot[St+1]);return ct.finish(),ct.data=ot,ct}_addTileFeatures(ot,ct,St,Ft,Bt,Wt){for(const ne of ot){const $t=ne*this.stride,ie=ct[$t+$e]>1;let ke,Me,mi;if(ie)ke=Ai(ct,$t,this.clusterProps),Me=ct[$t],mi=ct[$t+1];else{const Mi=this.points[ct[$t+pe]];ke=Mi.properties;const[dr,pr]=Mi.geometry.coordinates;Me=_i(dr),mi=pi(pr)}const Gi={type:1,geometry:[[Math.round(this.options.extent*(Me*Bt-St)),Math.round(this.options.extent*(mi*Bt-Ft))]],tags:ke};let Bi;Bi=ie||this.options.generateId?ct[$t+pe]:this.points[ct[$t+pe]].id,Bi!==void 0&&(Gi.id=Bi),Wt.features.push(Gi)}}_limitZoom(ot){return Math.max(this.options.minZoom,Math.min(Math.floor(+ot),this.options.maxZoom+1))}_cluster(ot,ct){const{radius:St,extent:Ft,reduce:Bt,minPoints:Wt}=this.options,ne=St/(Ft*Math.pow(2,ct)),$t=ot.data,ie=[],ke=this.stride;for(let Me=0;Me<$t.length;Me+=ke){if($t[Me+2]<=ct)continue;$t[Me+2]=ct;const mi=$t[Me],Gi=$t[Me+1],Bi=ot.within($t[Me],$t[Me+1],ne),Mi=$t[Me+$e];let dr=Mi;for(const pr of Bi){const nn=pr*ke;$t[nn+2]>ct&&(dr+=$t[nn+$e])}if(dr>Mi&&dr>=Wt){let pr,nn=mi*Mi,Xn=Gi*Mi,ba=-1;const aa=(Me/ke<<5)+(ct+1)+this.points.length;for(const ea of Bi){const en=ea*ke;if($t[en+2]<=ct)continue;$t[en+2]=ct;const Sr=$t[en+$e];nn+=$t[en]*Sr,Xn+=$t[en+1]*Sr,$t[en+4]=aa,Bt&&(pr||(pr=this._map($t,Me,!0),ba=this.clusterProps.length,this.clusterProps.push(pr)),Bt(pr,this._map($t,en)))}$t[Me+4]=aa,ie.push(nn/dr,Xn/dr,1/0,aa,-1,dr),Bt&&ie.push(ba)}else{for(let pr=0;pr<ke;pr++)ie.push($t[Me+pr]);if(dr>1)for(const pr of Bi){const nn=pr*ke;if(!($t[nn+2]<=ct)){$t[nn+2]=ct;for(let Xn=0;Xn<ke;Xn++)ie.push($t[nn+Xn])}}}}return ie}_getOriginId(ot){return ot-this.points.length>>5}_getOriginZoom(ot){return(ot-this.points.length)%32}_map(ot,ct,St){if(ot[ct+$e]>1){const Wt=this.clusterProps[ot[ct+He]];return St?Object.assign({},Wt):Wt}const Ft=this.points[ot[ct+pe]].properties,Bt=this.options.map(Ft);return St&&Bt===Ft?Object.assign({},Bt):Bt}}function Ti(Xt,ot,ct){return{type:"Feature",id:Xt[ot+pe],properties:Ai(Xt,ot,ct),geometry:{type:"Point",coordinates:[(St=Xt[ot],360*(St-.5)),yr(Xt[ot+1])]}};var St}function Ai(Xt,ot,ct){const St=Xt[ot+$e],Ft=St>=1e4?`${Math.round(St/1e3)}k`:St>=1e3?Math.round(St/100)/10+"k":St,Bt=Xt[ot+He],Wt=Bt===-1?{}:Object.assign({},ct[Bt]);return Object.assign(Wt,{cluster:!0,cluster_id:Xt[ot+pe],point_count:St,point_count_abbreviated:Ft})}function _i(Xt){return Xt/360+.5}function pi(Xt){const ot=Math.sin(Xt*Math.PI/180),ct=.5-.25*Math.log((1+ot)/(1-ot))/Math.PI;return ct<0?0:ct>1?1:ct}function yr(Xt){const ot=(180-360*Xt)*Math.PI/180;return 360*Math.atan(Math.exp(ot))/Math.PI-90}function Li(Xt,ot,ct,St){let Ft=St;const Bt=ot+(ct-ot>>1);let Wt,ne=ct-ot;const $t=Xt[ot],ie=Xt[ot+1],ke=Xt[ct],Me=Xt[ct+1];for(let mi=ot+3;mi<ct;mi+=3){const Gi=hr(Xt[mi],Xt[mi+1],$t,ie,ke,Me);if(Gi>Ft)Wt=mi,Ft=Gi;else if(Gi===Ft){const Bi=Math.abs(mi-Bt);Bi<ne&&(Wt=mi,ne=Bi)}}Ft>St&&(Wt-ot>3&&Li(Xt,ot,Wt,St),Xt[Wt+2]=Ft,ct-Wt>3&&Li(Xt,Wt,ct,St))}function hr(Xt,ot,ct,St,Ft,Bt){let Wt=Ft-ct,ne=Bt-St;if(Wt!==0||ne!==0){const $t=((Xt-ct)*Wt+(ot-St)*ne)/(Wt*Wt+ne*ne);$t>1?(ct=Ft,St=Bt):$t>0&&(ct+=Wt*$t,St+=ne*$t)}return Wt=Xt-ct,ne=ot-St,Wt*Wt+ne*ne}function xr(Xt,ot,ct,St){const Ft={id:Xt??null,type:ot,geometry:ct,tags:St,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")tn(Ft,ct);else if(ot==="Polygon")tn(Ft,ct[0]);else if(ot==="MultiLineString")for(const Bt of ct)tn(Ft,Bt);else if(ot==="MultiPolygon")for(const Bt of ct)tn(Ft,Bt[0]);return Ft}function tn(Xt,ot){for(let ct=0;ct<ot.length;ct+=3)Xt.minX=Math.min(Xt.minX,ot[ct]),Xt.minY=Math.min(Xt.minY,ot[ct+1]),Xt.maxX=Math.max(Xt.maxX,ot[ct]),Xt.maxY=Math.max(Xt.maxY,ot[ct+1])}function On(Xt,ot,ct,St){if(!ot.geometry)return;const Ft=ot.geometry.coordinates;if(Ft&&Ft.length===0)return;const Bt=ot.geometry.type,Wt=Math.pow(ct.tolerance/((1<<ct.maxZoom)*ct.extent),2);let ne=[],$t=ot.id;if(ct.promoteId?$t=ot.properties[ct.promoteId]:ct.generateId&&($t=St||0),Bt==="Point")Kr(Ft,ne);else if(Bt==="MultiPoint")for(const ie of Ft)Kr(ie,ne);else if(Bt==="LineString")Ua(Ft,ne,Wt,!1);else if(Bt==="MultiLineString"){if(ct.lineMetrics){for(const ie of Ft)ne=[],Ua(ie,ne,Wt,!1),Xt.push(xr($t,"LineString",ne,ot.properties));return}ga(Ft,ne,Wt,!1)}else if(Bt==="Polygon")ga(Ft,ne,Wt,!0);else{if(Bt!=="MultiPolygon"){if(Bt==="GeometryCollection"){for(const ie of ot.geometry.geometries)On(Xt,{id:$t,geometry:ie,properties:ot.properties},ct,St);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ie of Ft){const ke=[];ga(ie,ke,Wt,!0),ne.push(ke)}}Xt.push(xr($t,Bt,ne,ot.properties))}function Kr(Xt,ot){ot.push(So(Xt[0]),Ka(Xt[1]),0)}function Ua(Xt,ot,ct,St){let Ft,Bt,Wt=0;for(let $t=0;$t<Xt.length;$t++){const ie=So(Xt[$t][0]),ke=Ka(Xt[$t][1]);ot.push(ie,ke,0),$t>0&&(Wt+=St?(Ft*ke-ie*Bt)/2:Math.sqrt(Math.pow(ie-Ft,2)+Math.pow(ke-Bt,2))),Ft=ie,Bt=ke}const ne=ot.length-3;ot[2]=1,Li(ot,0,ne,ct),ot[ne+2]=1,ot.size=Math.abs(Wt),ot.start=0,ot.end=ot.size}function ga(Xt,ot,ct,St){for(let Ft=0;Ft<Xt.length;Ft++){const Bt=[];Ua(Xt[Ft],Bt,ct,St),ot.push(Bt)}}function So(Xt){return Xt/360+.5}function Ka(Xt){const ot=Math.sin(Xt*Math.PI/180),ct=.5-.25*Math.log((1+ot)/(1-ot))/Math.PI;return ct<0?0:ct>1?1:ct}function Jn(Xt,ot,ct,St,Ft,Bt,Wt,ne){if(St/=ot,Bt>=(ct/=ot)&&Wt<St)return Xt;if(Wt<ct||Bt>=St)return null;const $t=[];for(const ie of Xt){const ke=ie.geometry;let Me=ie.type;const mi=Ft===0?ie.minX:ie.minY,Gi=Ft===0?ie.maxX:ie.maxY;if(mi>=ct&&Gi<St){$t.push(ie);continue}if(Gi<ct||mi>=St)continue;let Bi=[];if(Me==="Point"||Me==="MultiPoint")oc(ke,Bi,ct,St,Ft);else if(Me==="LineString")Ja(ke,Bi,ct,St,Ft,!1,ne.lineMetrics);else if(Me==="MultiLineString")xs(ke,Bi,ct,St,Ft,!1);else if(Me==="Polygon")xs(ke,Bi,ct,St,Ft,!0);else if(Me==="MultiPolygon")for(const Mi of ke){const dr=[];xs(Mi,dr,ct,St,Ft,!0),dr.length&&Bi.push(dr)}if(Bi.length){if(ne.lineMetrics&&Me==="LineString"){for(const Mi of Bi)$t.push(xr(ie.id,Me,Mi,ie.tags));continue}Me!=="LineString"&&Me!=="MultiLineString"||(Bi.length===1?(Me="LineString",Bi=Bi[0]):Me="MultiLineString"),Me!=="Point"&&Me!=="MultiPoint"||(Me=Bi.length===3?"Point":"MultiPoint"),$t.push(xr(ie.id,Me,Bi,ie.tags))}}return $t.length?$t:null}function oc(Xt,ot,ct,St,Ft){for(let Bt=0;Bt<Xt.length;Bt+=3){const Wt=Xt[Bt+Ft];Wt>=ct&&Wt<=St&&ss(ot,Xt[Bt],Xt[Bt+1],Xt[Bt+2])}}function Ja(Xt,ot,ct,St,Ft,Bt,Wt){let ne=Qa(Xt);const $t=Ft===0?Hn:To;let ie,ke,Me=Xt.start;for(let dr=0;dr<Xt.length-3;dr+=3){const pr=Xt[dr],nn=Xt[dr+1],Xn=Xt[dr+2],ba=Xt[dr+3],aa=Xt[dr+4],ea=Ft===0?pr:nn,en=Ft===0?ba:aa;let Sr=!1;Wt&&(ie=Math.sqrt(Math.pow(pr-ba,2)+Math.pow(nn-aa,2))),ea<ct?en>ct&&(ke=$t(ne,pr,nn,ba,aa,ct),Wt&&(ne.start=Me+ie*ke)):ea>St?en<St&&(ke=$t(ne,pr,nn,ba,aa,St),Wt&&(ne.start=Me+ie*ke)):ss(ne,pr,nn,Xn),en<ct&&ea>=ct&&(ke=$t(ne,pr,nn,ba,aa,ct),Sr=!0),en>St&&ea<=St&&(ke=$t(ne,pr,nn,ba,aa,St),Sr=!0),!Bt&&Sr&&(Wt&&(ne.end=Me+ie*ke),ot.push(ne),ne=Qa(Xt)),Wt&&(Me+=ie)}let mi=Xt.length-3;const Gi=Xt[mi],Bi=Xt[mi+1],Mi=Ft===0?Gi:Bi;Mi>=ct&&Mi<=St&&ss(ne,Gi,Bi,Xt[mi+2]),mi=ne.length-3,Bt&&mi>=3&&(ne[mi]!==ne[0]||ne[mi+1]!==ne[1])&&ss(ne,ne[0],ne[1],ne[2]),ne.length&&ot.push(ne)}function Qa(Xt){const ot=[];return ot.size=Xt.size,ot.start=Xt.start,ot.end=Xt.end,ot}function xs(Xt,ot,ct,St,Ft,Bt){for(const Wt of Xt)Ja(Wt,ot,ct,St,Ft,Bt,!1)}function ss(Xt,ot,ct,St){Xt.push(ot,ct,St)}function Hn(Xt,ot,ct,St,Ft,Bt){const Wt=(Bt-ot)/(St-ot);return ss(Xt,Bt,ct+(Ft-ct)*Wt,1),Wt}function To(Xt,ot,ct,St,Ft,Bt){const Wt=(Bt-ct)/(Ft-ct);return ss(Xt,ot+(St-ot)*Wt,Bt,1),Wt}function Ih(Xt,ot){const ct=[];for(let St=0;St<Xt.length;St++){const Ft=Xt[St],Bt=Ft.type;let Wt;if(Bt==="Point"||Bt==="MultiPoint"||Bt==="LineString")Wt=wu(Ft.geometry,ot);else if(Bt==="MultiLineString"||Bt==="Polygon"){Wt=[];for(const ne of Ft.geometry)Wt.push(wu(ne,ot))}else if(Bt==="MultiPolygon"){Wt=[];for(const ne of Ft.geometry){const $t=[];for(const ie of ne)$t.push(wu(ie,ot));Wt.push($t)}}ct.push(xr(Ft.id,Bt,Wt,Ft.tags))}return ct}function wu(Xt,ot){const ct=[];ct.size=Xt.size,Xt.start!==void 0&&(ct.start=Xt.start,ct.end=Xt.end);for(let St=0;St<Xt.length;St+=3)ct.push(Xt[St]+ot,Xt[St+1],Xt[St+2]);return ct}function Gs(Xt,ot){if(Xt.transformed)return Xt;const ct=1<<Xt.z,St=Xt.x,Ft=Xt.y;for(const Bt of Xt.features){const Wt=Bt.geometry,ne=Bt.type;if(Bt.geometry=[],ne===1)for(let $t=0;$t<Wt.length;$t+=2)Bt.geometry.push(kv(Wt[$t],Wt[$t+1],ot,ct,St,Ft));else for(let $t=0;$t<Wt.length;$t++){const ie=[];for(let ke=0;ke<Wt[$t].length;ke+=2)ie.push(kv(Wt[$t][ke],Wt[$t][ke+1],ot,ct,St,Ft));Bt.geometry.push(ie)}}return Xt.transformed=!0,Xt}function kv(Xt,ot,ct,St,Ft,Bt){return[Math.round(ct*(Xt*St-Ft)),Math.round(ct*(ot*St-Bt))]}function Wp(Xt,ot,ct,St,Ft){const Bt=ot===Ft.maxZoom?0:Ft.tolerance/((1<<ot)*Ft.extent),Wt={features:[],numPoints:0,numSimplified:0,numFeatures:Xt.length,source:null,x:ct,y:St,z:ot,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ne of Xt)J0(Wt,ne,Bt,Ft);return Wt}function J0(Xt,ot,ct,St){const Ft=ot.geometry,Bt=ot.type,Wt=[];if(Xt.minX=Math.min(Xt.minX,ot.minX),Xt.minY=Math.min(Xt.minY,ot.minY),Xt.maxX=Math.max(Xt.maxX,ot.maxX),Xt.maxY=Math.max(Xt.maxY,ot.maxY),Bt==="Point"||Bt==="MultiPoint")for(let ne=0;ne<Ft.length;ne+=3)Wt.push(Ft[ne],Ft[ne+1]),Xt.numPoints++,Xt.numSimplified++;else if(Bt==="LineString")jd(Wt,Ft,Xt,ct,!1,!1);else if(Bt==="MultiLineString"||Bt==="Polygon")for(let ne=0;ne<Ft.length;ne++)jd(Wt,Ft[ne],Xt,ct,Bt==="Polygon",ne===0);else if(Bt==="MultiPolygon")for(let ne=0;ne<Ft.length;ne++){const $t=Ft[ne];for(let ie=0;ie<$t.length;ie++)jd(Wt,$t[ie],Xt,ct,!0,ie===0)}if(Wt.length){let ne=ot.tags||null;if(Bt==="LineString"&&St.lineMetrics){ne={};for(const ie in ot.tags)ne[ie]=ot.tags[ie];ne.mapbox_clip_start=Ft.start/Ft.size,ne.mapbox_clip_end=Ft.end/Ft.size}const $t={geometry:Wt,type:Bt==="Polygon"||Bt==="MultiPolygon"?3:Bt==="LineString"||Bt==="MultiLineString"?2:1,tags:ne};ot.id!==null&&($t.id=ot.id),Xt.features.push($t)}}function jd(Xt,ot,ct,St,Ft,Bt){const Wt=St*St;if(St>0&&ot.size<(Ft?Wt:St))return void(ct.numPoints+=ot.length/3);const ne=[];for(let $t=0;$t<ot.length;$t+=3)(St===0||ot[$t+2]>Wt)&&(ct.numSimplified++,ne.push(ot[$t],ot[$t+1])),ct.numPoints++;Ft&&function($t,ie){let ke=0;for(let Me=0,mi=$t.length,Gi=mi-2;Me<mi;Gi=Me,Me+=2)ke+=($t[Me]-$t[Gi])*($t[Me+1]+$t[Gi+1]);if(ke>0===ie)for(let Me=0,mi=$t.length;Me<mi/2;Me+=2){const Gi=$t[Me],Bi=$t[Me+1];$t[Me]=$t[mi-2-Me],$t[Me+1]=$t[mi-1-Me],$t[mi-2-Me]=Gi,$t[mi-1-Me]=Bi}}(ne,Bt),Xt.push(ne)}const Ce={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Bc{constructor(ot,ct){const St=(ct=this.options=function(Bt,Wt){for(const ne in Wt)Bt[ne]=Wt[ne];return Bt}(Object.create(Ce),ct)).debug;if(St&&console.time("preprocess data"),ct.maxZoom<0||ct.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ct.promoteId&&ct.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ft=function(Bt,Wt){const ne=[];if(Bt.type==="FeatureCollection")for(let $t=0;$t<Bt.features.length;$t++)On(ne,Bt.features[$t],Wt,$t);else On(ne,Bt.type==="Feature"?Bt:{geometry:Bt},Wt);return ne}(ot,ct);this.tiles={},this.tileCoords=[],St&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ct.indexMaxZoom,ct.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ft=function(Bt,Wt){const ne=Wt.buffer/Wt.extent;let $t=Bt;const ie=Jn(Bt,1,-1-ne,ne,0,-1,2,Wt),ke=Jn(Bt,1,1-ne,2+ne,0,-1,2,Wt);return(ie||ke)&&($t=Jn(Bt,1,-ne,1+ne,0,-1,2,Wt)||[],ie&&($t=Ih(ie,1).concat($t)),ke&&($t=$t.concat(Ih(ke,-1)))),$t}(Ft,ct),Ft.length&&this.splitTile(Ft,0,0,0),St&&(Ft.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ot,ct,St,Ft,Bt,Wt,ne){const $t=[ot,ct,St,Ft],ie=this.options,ke=ie.debug;for(;$t.length;){Ft=$t.pop(),St=$t.pop(),ct=$t.pop(),ot=$t.pop();const Me=1<<ct,mi=$p(ct,St,Ft);let Gi=this.tiles[mi];if(!Gi&&(ke>1&&console.time("creation"),Gi=this.tiles[mi]=Wp(ot,ct,St,Ft,ie),this.tileCoords.push({z:ct,x:St,y:Ft}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ct,St,Ft,Gi.numFeatures,Gi.numPoints,Gi.numSimplified),console.timeEnd("creation"));const Sr=`z${ct}`;this.stats[Sr]=(this.stats[Sr]||0)+1,this.total++}if(Gi.source=ot,Bt==null){if(ct===ie.indexMaxZoom||Gi.numPoints<=ie.indexMaxPoints)continue}else{if(ct===ie.maxZoom||ct===Bt)continue;if(Bt!=null){const Sr=Bt-ct;if(St!==Wt>>Sr||Ft!==ne>>Sr)continue}}if(Gi.source=null,ot.length===0)continue;ke>1&&console.time("clipping");const Bi=.5*ie.buffer/ie.extent,Mi=.5-Bi,dr=.5+Bi,pr=1+Bi;let nn=null,Xn=null,ba=null,aa=null,ea=Jn(ot,Me,St-Bi,St+dr,0,Gi.minX,Gi.maxX,ie),en=Jn(ot,Me,St+Mi,St+pr,0,Gi.minX,Gi.maxX,ie);ot=null,ea&&(nn=Jn(ea,Me,Ft-Bi,Ft+dr,1,Gi.minY,Gi.maxY,ie),Xn=Jn(ea,Me,Ft+Mi,Ft+pr,1,Gi.minY,Gi.maxY,ie),ea=null),en&&(ba=Jn(en,Me,Ft-Bi,Ft+dr,1,Gi.minY,Gi.maxY,ie),aa=Jn(en,Me,Ft+Mi,Ft+pr,1,Gi.minY,Gi.maxY,ie),en=null),ke>1&&console.timeEnd("clipping"),$t.push(nn||[],ct+1,2*St,2*Ft),$t.push(Xn||[],ct+1,2*St,2*Ft+1),$t.push(ba||[],ct+1,2*St+1,2*Ft),$t.push(aa||[],ct+1,2*St+1,2*Ft+1)}}getTile(ot,ct,St){ot=+ot,ct=+ct,St=+St;const Ft=this.options,{extent:Bt,debug:Wt}=Ft;if(ot<0||ot>24)return null;const ne=1<<ot,$t=$p(ot,ct=ct+ne&ne-1,St);if(this.tiles[$t])return Gs(this.tiles[$t],Bt);Wt>1&&console.log("drilling down to z%d-%d-%d",ot,ct,St);let ie,ke=ot,Me=ct,mi=St;for(;!ie&&ke>0;)ke--,Me>>=1,mi>>=1,ie=this.tiles[$p(ke,Me,mi)];return ie&&ie.source?(Wt>1&&(console.log("found parent tile z%d-%d-%d",ke,Me,mi),console.time("drilling down")),this.splitTile(ie.source,ke,Me,mi,ot,ct,St),Wt>1&&console.timeEnd("drilling down"),this.tiles[$t]?Gs(this.tiles[$t],Bt):null):null}}function $p(Xt,ot,ct){return 32*((1<<Xt)*ct+ot)+Xt}function Zp(Xt,ot){const ct=Xt.tileID.canonical;if(!this._geoJSONIndex)return void ot(null,null);const St=this._geoJSONIndex.getTile(ct.z,ct.x,ct.y);if(!St)return void ot(null,null);const Ft=ie=>ie.tags&&"3d_elevation_id"in ie.tags&&"source"in ie.tags&&ie.tags.source==="elevation",Bt=St.features.filter(ie=>Ft(ie));let Wt={_geojsonTileLayer:St.features};Bt.length>0&&(Wt={_geojsonTileLayer:St.features.filter(ie=>!Ft(ie)),hd_road_elevation:Bt});const ne=new kt(Wt),$t=function(ie){const ke=new a.bs;for(const Me of Object.keys(ie))ke.writeMessage(3,Pi,{name:Me,features:ie[Me]});return ke.finish()}(Wt).buffer;ot(null,{vectorTile:ne,rawData:$t})}class wr extends K{constructor(ot,ct,St,Ft,Bt,Wt,ne){super(ot,ct,St,Ft,Bt,Zp,ne),Wt&&(this.loadGeoJSON=Wt),this._dynamicIndex=new Gt}loadData(ot,ct){const St=ot&&ot.request,Ft=St&&St.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ot,(Bt,Wt)=>{if(Bt||!Wt)return ct(Bt);if(typeof Wt!="object")return ct(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`));{try{if(ot.filter){const $t=a.U(ot.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($t.result==="error")throw new Error($t.value.map(ie=>`${ie.key}: ${ie.message}`).join(", "));Wt.features=Wt.features.filter(ie=>$t.value.evaluate({zoom:0},ie))}ot.dynamic?(Wt.type==="Feature"&&(Wt={type:"FeatureCollection",features:[Wt]}),ot.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Wt.features,this.loaded),ot.cluster&&(Wt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ot.cluster?new qe(function({superclusterOptions:$t,clusterProperties:ie}){if(!ie||!$t)return $t;const ke={},Me={},mi={accumulated:null,zoom:0},Gi={properties:null},Bi=Object.keys(ie);for(const Mi of Bi){const[dr,pr]=ie[Mi],nn=a.U(pr),Xn=a.U(typeof dr=="string"?[dr,["accumulated"],["get",Mi]]:dr);ke[Mi]=nn.value,Me[Mi]=Xn.value}return $t.map=Mi=>{Gi.properties=Mi;const dr={};for(const pr of Bi)dr[pr]=ke[pr].evaluate(mi,Gi);return dr},$t.reduce=(Mi,dr)=>{Gi.properties=dr;for(const pr of Bi)mi.accumulated=Mi[pr],Mi[pr]=Me[pr].evaluate(mi,Gi)},$t}(ot)).load(Wt.features):ot.dynamic?this._dynamicIndex:function($t,ie){return new Bc($t,ie)}(Wt,ot.geojsonVtOptions)}catch($t){return ct($t)}const ne={};if(Ft){const $t=u(St);$t&&(ne.resourceTiming={},ne.resourceTiming[ot.source]=JSON.parse(JSON.stringify($t)))}ct(null,ne)}})}reloadTile(ot,ct){const St=this.loaded;return St&&St[ot.uid]?ot.partial?ct(null,void 0):super.reloadTile(ot,ct):this.loadTile(ot,ct)}loadGeoJSON(ot,ct){if(ot.request)a.m(ot.request,ct);else{if(typeof ot.data!="string")return ct(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ct(null,JSON.parse(ot.data))}catch{return ct(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ot,ct){try{ct(null,this._geoJSONIndex.getClusterExpansionZoom(ot.clusterId))}catch(St){ct(St)}}getClusterChildren(ot,ct){try{ct(null,this._geoJSONIndex.getChildren(ot.clusterId))}catch(St){ct(St)}}getClusterLeaves(ot,ct){try{ct(null,this._geoJSONIndex.getLeaves(ot.clusterId,ot.limit,ot.offset))}catch(St){ct(St)}}}class Fo{constructor(ot,ct,St){this.tileID=new a.aP(ot.tileID.overscaledZ,ot.tileID.wrap,ot.tileID.canonical.z,ot.tileID.canonical.x,ot.tileID.canonical.y),this.tileZoom=ot.tileZoom,this.uid=ot.uid,this.zoom=ot.zoom,this.canonical=ot.tileID.canonical,this.pixelRatio=ot.pixelRatio,this.tileSize=ot.tileSize,this.source=ot.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ot.projection,this.brightness=ct,this.worldview=St}parse(ot,ct,St,Ft){this.status="parsing";const Bt=new a.aP(St.tileID.overscaledZ,St.tileID.wrap,St.tileID.canonical.z,St.tileID.canonical.x,St.tileID.canonical.y),Wt=[],ne=ct.familiesBySource[St.source],$t=new a.fm(Bt,St.promoteId);$t.bucketLayerIDs=[],$t.is3DTile=!0,a.fB(ot).then(ie=>{if(!ie)return Ft(new Error("Could not parse tile"));const ke=ie.json.extensionsUsed&&ie.json.extensionsUsed.includes("MAPBOX_mesh_features")||ie.json.asset.extras&&ie.json.asset.extras.MAPBOX_mesh_features,Me=ie.json.extensionsUsed&&ie.json.extensionsUsed.includes("EXT_meshopt_compression"),mi=new a.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Gi in ne)for(const Bi of ne[Gi]){const Mi=Bi[0];$t.bucketLayerIDs.push(Bi.map(nn=>a.B(nn.id,nn.scope))),Mi.recalculate(mi,[]);const dr=a.fC(ie,1/a.d6(St.tileID.canonical)),pr=new a.fD(Bi,dr,Bt,ke,Me,this.brightness,$t,this.worldview);ke||(pr.needsUpload=!0),Wt.push(pr),pr.evaluate(Mi)}this.status="done",Ft(null,{buckets:Wt,featureIndex:$t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ie=>Ft(new Error(ie.message)))}}class Q0{constructor(ot,ct,St,Ft,Bt,Wt,ne,$t){this.actor=ot,this.layerIndex=ct,this.availableImages=St,this.availableModels=Ft,this.brightness=ne,this.loading={},this.loaded={},this.worldview=$t}loadTile(ot,ct){const St=ot.uid,Ft=this.loading[St]=new Fo(ot,this.brightness,this.worldview);a.bt(ot.request,(Bt,Wt)=>{const ne=!this.loading[St];return delete this.loading[St],ne||Bt?(Ft.status="done",ne||(this.loaded[St]=Ft),ct(Bt)):Wt&&Wt.byteLength!==0?void Ft.parse(Wt,this.layerIndex,ot,($t,ie)=>{Ft.status="done",this.loaded=this.loaded||{},this.loaded[St]=Ft,$t||!ie?ct($t):ct(null,ie)}):(Ft.status="done",this.loaded[St]=Ft,ct())})}reloadTile(ot,ct){const St=this.loaded,Ft=ot.uid;if(St&&St[Ft]){const Bt=St[Ft];Bt.projection=ot.projection,Bt.brightness=ot.brightness;const Wt=(ne,$t)=>{Bt.reloadCallback&&(delete Bt.reloadCallback,this.loadTile(ot,ct)),ct(ne,$t)};Bt.status==="parsing"?Bt.reloadCallback=Wt:Bt.status==="done"&&this.loadTile(ot,ct)}}abortTile(ot,ct){const St=ot.uid;this.loading[St]&&delete this.loading[St],ct()}removeTile(ot,ct){const St=this.loaded,Ft=ot.uid;St&&St[Ft]&&delete St[Ft],ct()}}class qp{constructor(ot){this.self=ot,this.actor=new a.fF(ot,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.cl({name:"mercator"}),this.workerSourceTypes={vector:K,geojson:wr,"raster-dem":et,"raster-array":lt,"batched-model":Q0},this.workerSources={},this.self.registerWorkerSource=(ct,St)=>{if(this.workerSourceTypes[ct])throw new Error(`Worker source with name "${ct}" already registered.`);this.workerSourceTypes[ct]=St},this.self.registerRTLTextPlugin=ct=>{if(a.fG.isParsed())throw new Error("RTL text plugin already registered.");a.fG.setState({pluginStatus:a.fH.parsed,pluginURL:a.fG.getPluginURL()}),a.fG.applyArabicShaping=ct.applyArabicShaping,a.fG.processBidirectionalText=ct.processBidirectionalText,a.fG.processStyledBidirectionalText=ct.processStyledBidirectionalText;for(const St of this.rtlPluginParsingListeners)St(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ot,ct,St){delete this.layerIndexes[ot],delete this.availableImages[ot],delete this.availableModels[ot],delete this.workerSources[ot],St()}checkIfReady(ot,ct,St){St()}setReferrer(ot,ct){this.referrer=ct}spriteLoaded(ot,ct){this.isSpriteLoaded[ot]||(this.isSpriteLoaded[ot]={});const{scope:St,isLoaded:Ft}=ct;if(this.isSpriteLoaded[ot][St]=Ft,this.workerSources[ot]&&this.workerSources[ot][St])for(const Bt in this.workerSources[ot][St]){const Wt=this.workerSources[ot][St][Bt];for(const ne in Wt){const $t=Wt[ne];$t instanceof K&&($t.isSpriteLoaded=Ft,$t.fire(new a.z("isSpriteLoaded")))}}}setImages(ot,ct,St){this.availableImages[ot]||(this.availableImages[ot]={});const{scope:Ft,images:Bt}=ct;if(this.availableImages[ot][Ft]=Bt,this.workerSources[ot]&&this.workerSources[ot][Ft]){for(const Wt in this.workerSources[ot][Ft]){const ne=this.workerSources[ot][Ft][Wt];for(const $t in ne)ne[$t].availableImages=Bt}St()}else St()}setModels(ot,{scope:ct,models:St},Ft){if(this.availableModels[ot]||(this.availableModels[ot]={}),this.availableModels[ot][ct]=St,this.workerSources[ot]&&this.workerSources[ot][ct]){for(const Bt in this.workerSources[ot][ct]){const Wt=this.workerSources[ot][ct][Bt];for(const ne in Wt)Wt[ne].availableModels=St}Ft()}else Ft()}setProjection(ot,ct){this.projections[ot]=a.cl(ct)}setBrightness(ot,ct,St){this.brightness=ct,St()}setWorldview(ot,ct,St){this.worldview=ct,St()}setLayers(ot,ct,St){this.getLayerIndex(ot,ct.scope).replace(ct.layers,ct.options),St()}updateLayers(ot,ct,St){this.getLayerIndex(ot,ct.scope).update(ct.layers,ct.removedIds,ct.options),St()}loadTile(ot,ct,St){ct.projection=this.projections[ot]||this.defaultProjection,this.getWorkerSource(ot,ct.type,ct.source,ct.scope).loadTile(ct,St)}decodeRasterArray(ot,ct,St){this.getWorkerSource(ot,ct.type,ct.source,ct.scope).decodeRasterArray(ct,St)}reloadTile(ot,ct,St){ct.projection=this.projections[ot]||this.defaultProjection,this.getWorkerSource(ot,ct.type,ct.source,ct.scope).reloadTile(ct,St)}abortTile(ot,ct,St){this.getWorkerSource(ot,ct.type,ct.source,ct.scope).abortTile(ct,St)}removeTile(ot,ct,St){this.getWorkerSource(ot,ct.type,ct.source,ct.scope).removeTile(ct,St)}removeSource(ot,ct,St){if(!(this.workerSources[ot]&&this.workerSources[ot][ct.scope]&&this.workerSources[ot][ct.scope][ct.type]&&this.workerSources[ot][ct.scope][ct.type][ct.source]))return;const Ft=this.workerSources[ot][ct.scope][ct.type][ct.source];delete this.workerSources[ot][ct.scope][ct.type][ct.source],Ft.removeSource!==void 0?Ft.removeSource(ct,St):St()}loadWorkerSource(ot,ct,St){try{this.self.importScripts(ct.url),St()}catch(Ft){St(Ft.toString())}}syncRTLPluginState(ot,ct,St){if(a.fG.isParsed())St(null,!0);else if(a.fG.isParsing())this.rtlPluginParsingListeners.push(St);else try{a.fG.setState(ct);const Ft=a.fG.getPluginURL();!a.fG.isLoaded()||a.fG.isParsed()||a.fG.isParsing()||Ft==null||(a.fG.setState({pluginStatus:a.fH.parsing,pluginURL:a.fG.getPluginURL()}),this.self.importScripts(Ft),a.fG.isParsed()?St(null,!0):this.rtlPluginParsingListeners.push(St))}catch(Ft){St(Ft.toString())}}setDracoUrl(ot,ct){this.dracoUrl=ct}getAvailableImages(ot,ct){this.availableImages[ot]||(this.availableImages[ot]={});let St=this.availableImages[ot][ct];return St||(St=[]),St}getAvailableModels(ot,ct){this.availableModels[ot]||(this.availableModels[ot]={});let St=this.availableModels[ot][ct];return St||(St={}),St}getLayerIndex(ot,ct){this.layerIndexes[ot]||(this.layerIndexes[ot]={});let St=this.layerIndexes[ot][ct];return St||(St=this.layerIndexes[ot][ct]=new v,St.scope=ct),St}getWorkerSource(ot,ct,St,Ft){const Bt=this.workerSources;return Bt[ot]||(Bt[ot]={}),Bt[ot][Ft]||(Bt[ot][Ft]={}),Bt[ot][Ft][ct]||(Bt[ot][Ft][ct]={}),this.isSpriteLoaded[ot]||(this.isSpriteLoaded[ot]={}),Bt[ot][Ft][ct][St]||(Bt[ot][Ft][ct][St]=new this.workerSourceTypes[ct]({send:(Wt,ne,$t,ie,ke,Me)=>this.actor.send(Wt,ne,$t,ot,ke,Me),scheduler:this.actor.scheduler},this.getLayerIndex(ot,Ft),this.getAvailableImages(ot,Ft),this.getAvailableModels(ot,Ft),this.isSpriteLoaded[ot][Ft],void 0,this.brightness,this.worldview)),Bt[ot][Ft][ct][St]}rasterizeImagesWorker(ot,ct,St){const Ft=new Map;for(const[Bt,{image:Wt,imageVariant:ne}]of ct.tasks.entries()){const $t=this.imageRasterizer.rasterize(ne,Wt,ct.scope,ot);Ft.set(Bt,$t)}St(void 0,Ft)}removeRasterizedImages(ot,ct,St){this.imageRasterizer.removeImagesFromCacheByIds(ct.imageIds,ct.scope,ot),St()}enforceCacheSizeLimit(ot,ct){a.fI(ct)}getWorkerPerformanceMetrics(ot,ct,St){St(void 0,void 0)}}return a.fE(self)&&(self.worker=new qp(self)),qp}),o(["./shared"],function(a){var u="3.16.0";const f={create:"create",load:"load",fullLoad:"fullLoad"},g={mark(x){performance.mark(x)},measure(x,c,p){performance.measure(x,c,p)}};function v(x){const c=x.name.split("?")[0];return a.a(c)&&c.includes("mapbox-gl.js")?"javascript":a.a(c)&&c.includes("mapbox-gl.css")?"css":a.b(c)?"fontRange":a.c(c)?"sprite":a.i(c)?"style":a.d(c)?"tilejson":"other"}var y,w={},I=function(){if(y)return w;function x(b){return!c(b)}function c(b){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,P,O=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(O);try{P=new Worker(B),C=!0}catch{C=!1}return P&&P.terminate(),URL.revokeObjectURL(B),C}()?function(){var C=document.createElement("canvas");C.width=C.height=1;var P=C.getContext("2d");if(!P)return!1;var O=P.getImageData(0,0,1,1);return O&&O.width===C.width}()?(p[A=b&&b.failIfMajorPerformanceCaveat]===void 0&&(p[A]=function(C){var P,O=function(B){var G=document.createElement("canvas"),j=Object.create(x.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=B,G.getContext("webgl2",j)}(C);if(!O)return!1;try{P=O.createShader(O.VERTEX_SHADER)}catch{return!1}return!(!P||O.isContextLost())&&(O.shaderSource(P,"void main() {}"),O.compileShader(P),O.getShaderParameter(P,O.COMPILE_STATUS)===!0)}(A)),p[A]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var A}y=1,w.supported=x,w.notSupportedReason=c;var p={};return x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},w}();function E(x,c,p){const b=document.createElement(x);return c!=null&&(b.className=c),p&&p.appendChild(b),b}function D(x,c,p){const b=document.createElementNS("http://www.w3.org/2000/svg",x);for(const A of Object.keys(c))b.setAttributeNS(null,A,String(c[A]));return p&&p.appendChild(b),b}const R=typeof document<"u"?document.documentElement&&document.documentElement.style:null,z=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect";let N;function H(){R&&z&&(N=R[z],R[z]="none")}function $(){R&&z&&(R[z]=N)}function X(x){x.preventDefault(),x.stopPropagation(),window.removeEventListener("click",X,!0)}function K(){window.addEventListener("click",X,!0),window.setTimeout(()=>{window.removeEventListener("click",X,!0)},0)}function et(x,c){const p=x.getBoundingClientRect();return ht(x,p,c)}function rt(x,c){const p=x.getBoundingClientRect(),b=[];for(let A=0;A<c.length;A++)b.push(ht(x,p,c[A]));return b}function lt(x){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&x.button===2&&x.ctrlKey?0:x.button}function ht(x,c,p){const b=x.offsetWidth===c.width?1:x.offsetWidth/c.width;return new a.P((p.clientX-c.left)*b,(p.clientY-c.top)*b)}const yt="01",ft="NO_ACCESS_TOKEN";class kt{constructor(c,p,b){this._transformRequestFn=c,this._customAccessToken=p,this._silenceAuthErrors=!!b,this._createSkuToken()}_createSkuToken(){const c=function(){let p="";for(let b=0;b<10;b++)p+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yt,p].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=c.token,this._skuTokenExpiresAt=c.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(c,p){return this._transformRequestFn&&this._transformRequestFn(c,p)||{url:c}}normalizeStyleURL(c,p){if(!a.h(c))return c;const b=Ct(c);return b.params.push(`sdk=js-${u}`),b.path=`/styles/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||p)}normalizeGlyphsURL(c,p){if(!a.h(c))return c;const b=Ct(c);return b.path=`/fonts/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||p)}normalizeModelURL(c,p){if(!a.h(c))return c;const b=Ct(c);return b.path=`/models/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||p)}normalizeSourceURL(c,p,b,A){if(!a.h(c))return c;const C=Ct(c);return C.path=`/v4/${C.authority}.json`,C.params.push("secure"),b&&C.params.push(`language=${b}`),A&&C.params.push(`worldview=${A}`),this._makeAPIURL(C,this._customAccessToken||p)}normalizeIconsetURL(c,p){const b=Ct(c);return a.h(c)?(b.path=`/styles/v1${b.path}/iconset.pbf`,this._makeAPIURL(b,this._customAccessToken||p)):Gt(b)}normalizeSpriteURL(c,p,b,A){const C=Ct(c);return a.h(c)?(C.path=`/styles/v1${C.path}/sprite${p}${b}`,this._makeAPIURL(C,this._customAccessToken||A)):(C.path+=`${p}${b}`,Gt(C))}normalizeTileURL(c,p,b){if(this._isSkuTokenExpired()&&this._createSkuToken(),c&&!a.h(c))return c;const A=Ct(c);A.path=A.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${p||b&&A.authority!=="raster"&&b===512?"@2x":""}${a.k.supported?".webp":"$1"}`),A.authority==="raster"?A.path=`/${a.e.RASTER_URL_PREFIX}${A.path}`:A.authority==="rasterarrays"?A.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${A.path}`:A.authority==="3dtiles"?A.path=`/${a.e.TILES3D_URL_PREFIX}${A.path}`:(A.path=A.path.replace(/^.+\/v4\//,"/"),A.path=`/${a.e.TILE_URL_VERSION}${A.path}`);const C=this._customAccessToken||function(P){for(const O of P){const B=O.match(/^access_token=(.*)$/);if(B)return B[1]}return null}(A.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&C&&this._skuToken&&A.params.push(`sku=${this._skuToken}`),this._makeAPIURL(A,C)}canonicalizeTileURL(c,p){const b=Ct(c);if(!b.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!b.path.match(/\.[\w]+$/))return c;let A="mapbox://";b.path.match(/^\/raster\/v1\//)?A+=`raster/${b.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:b.path.match(/^\/rasterarrays\/v1\//)?A+=`rasterarrays/${b.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:A+=`tiles/${b.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let C=b.params;return p&&(C=C.filter(P=>!P.match(/^access_token=/))),C.length&&(A+=`?${C.join("&")}`),A}canonicalizeTileset(c,p){const b=!!p&&a.h(p),A=[];for(const C of c.tiles||[])a.j(C)?A.push(this.canonicalizeTileURL(C,b)):A.push(C);return A}_makeAPIURL(c,p){const b="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",A=Ct(a.e.API_URL);if(c.protocol=A.protocol,c.authority=A.authority,c.protocol==="http"){const C=c.params.indexOf("secure");C>=0&&c.params.splice(C,1)}if(A.path!=="/"&&(c.path=`${A.path}${c.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Gt(c);if(p=p||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!p)throw new Error(`An API access token is required to use Mapbox GL. ${b}`);if(p[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${b}`)}return c.params=c.params.filter(C=>C.indexOf("access_token")===-1),c.params.push(`access_token=${p||""}`),Gt(c)}}const Rt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ct(x){const c=x.match(Rt);if(!c)throw new Error("Unable to parse URL object");return{protocol:c[1],authority:c[2],path:c[3]||"/",params:c[4]?c[4].split("&"):[]}}function Gt(x){const c=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${c}`}const Vt="mapbox.eventData";function Qt(x){if(!x)return null;const c=x.split(".");if(!c||c.length!==3)return null;try{return JSON.parse(a.l(c[1]))}catch{return null}}class fe{constructor(c){this.type=c,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(c){const p=Qt(a.e.ACCESS_TOKEN);let b="";return b=p&&p.u?a.f(p.u):a.e.ACCESS_TOKEN||"",c?`${Vt}.${c}:${b}`:`${Vt}:${b}`}fetchEventData(){const c=a.s("localStorage"),p=this.getStorageKey(),b=this.getStorageKey("uuid"),A=this.getStorageKey("uuidTimestamp");if(c)try{const C=localStorage.getItem(p);C&&(this.eventData=JSON.parse(C));const P=localStorage.getItem(b);P&&(this.anonId=P);const O=localStorage.getItem(A);O&&(this.anonIdTimestamp=Number(O));const B=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<B)&&this.refreshUUID()}catch{a.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=a.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const c=a.s("localStorage"),p=this.getStorageKey(),b=this.getStorageKey("uuid"),A=this.getStorageKey("uuidTimestamp"),C=this.anonId,P=this.anonIdTimestamp;if(c&&C)try{localStorage.setItem(b,C),Object.keys(this.eventData).length>=1&&localStorage.setItem(p,JSON.stringify(this.eventData)),P&&localStorage.setItem(A,P.toString())}catch{a.w("Unable to write to LocalStorage")}}processRequests(c){}postEvent(c,p,b,A){if(!a.e.EVENTS_URL)return;const C=Ct(a.e.EVENTS_URL);C.params.push(`access_token=${A||a.e.ACCESS_TOKEN||""}`);const P={event:this.type,created:new Date(c).toISOString()},O=p?Object.assign(P,p):P,B={url:Gt(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=a.p(B,G=>{this.pendingRequest=null,b(G),this.saveEventData(),this.processRequests(A)})}queueRequest(c,p){this.queue.push(c),this.processRequests(p)}}const Te=new class extends fe{constructor(x){super("appUserTurnstile"),this._customAccessToken=x}postTurnstileEvent(x,c){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(x)&&x.some(p=>a.h(p)||a.j(p))&&this.queueRequest(Date.now(),c)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const c=Qt(a.e.ACCESS_TOKEN),p=c?c.u:a.e.ACCESS_TOKEN;let b=p!==this.eventData.tokenU;a.v(this.anonId)||(this.refreshUUID(),b=!0);const A=this.queue.shift();if(this.eventData.lastSuccess){const C=new Date(this.eventData.lastSuccess),P=new Date(A),O=(A-this.eventData.lastSuccess)/864e5;b=b||O>=1||O<-1||C.getDate()!==P.getDate()}else b=!0;b?this.postEvent(A,{sdkIdentifier:"mapbox-gl-js",sdkVersion:u,skuId:yt,"enabled.telemetry":!1,userId:this.anonId},C=>{C||(this.eventData.lastSuccess=A,this.eventData.tokenU=p)},x):this.processRequests()}},be=Te.postTurnstileEvent.bind(Te),Ge=new class extends fe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(x,c,p,b){this.skuToken=c,this.errorCb=b,a.e.EVENTS_URL&&(p||a.e.ACCESS_TOKEN?this.queueRequest({id:x,timestamp:Date.now()},p):this.errorCb(new Error(ft)))}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{id:c,timestamp:p}=this.queue.shift();c&&this.success[c]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID(),this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:u,skuId:yt,skuToken:this.skuToken,userId:this.anonId},b=>{b?this.errorCb(b):c&&(this.success[c]=!0)},x))}remove(){this.errorCb=null}},li=Ge.postMapLoadEvent.bind(Ge),Pi=new class extends fe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(x){let c=this.mapInstanceIdMap.get(x);return c||(c=a.u(),this.mapInstanceIdMap.set(x,c)),c}getEventId(x){const c=this.eventIdPerMapInstanceMap.get(x)||0;return this.eventIdPerMapInstanceMap.set(x,c+1),c}postStyleLoadEvent(x,c){const{map:p,style:b,importedStyles:A}=c;if(!a.e.EVENTS_URL||!x&&!a.e.ACCESS_TOKEN)return;const C=this.getMapInstanceId(p),P={mapInstanceId:C,eventId:this.getEventId(C),style:b};A.length&&(P.importedStyles=A),this.queueRequest({timestamp:Date.now(),payload:P},x)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},x)}},or=Pi.postStyleLoadEvent.bind(Pi),Ve=new class extends fe{constructor(x){super("metrics"),x&&(this.data=x)}postMetricsEvent(x){if(!a.e.EVENTS_URL||!x&&!a.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},x)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},x)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Ze=Ve.postMetricsEvent.bind(Ve),ye=new class extends fe{constructor(){super("gljs.performance")}postPerformanceEvent(x,c){a.e.EVENTS_URL&&(x||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:c},x)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,performanceData:p}=this.queue.shift(),b=function(A){const C=performance.getEntriesByType("resource"),P=performance.getEntriesByType("mark"),O=function(J){const tt={};if(J){for(const nt in J)if(nt!=="other")for(const ut of J[nt]){const st=`${nt}ResolveRangeMin`,pt=`${nt}ResolveRangeMax`,xt=`${nt}RequestCount`,vt=`${nt}RequestCachedCount`;tt[st]=Math.min(tt[st]||1/0,ut.startTime),tt[pt]=Math.max(tt[pt]||-1/0,ut.responseEnd);const Et=bt=>{tt[bt]===void 0&&(tt[bt]=0),++tt[bt]};ut.transferSize!==void 0&&ut.transferSize===0&&Et(vt),Et(xt)}}return tt}(function(J,tt){const nt={};if(J)for(const ut of J){const st=tt(ut);nt[st]===void 0&&(nt[st]=[]),nt[st].push(ut)}return nt}(C,v)),B=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=G?G.effectiveType:void 0,Y={counters:[],metadata:[],attributes:[]},W=(J,tt,nt)=>{nt!=null&&J.push({name:tt,value:nt.toString()})};for(const J in O)W(Y.counters,J,O[J]);if(A.interactionRange[0]!==1/0&&A.interactionRange[1]!==-1/0&&(W(Y.counters,"interactionRangeMin",A.interactionRange[0]),W(Y.counters,"interactionRangeMax",A.interactionRange[1])),P)for(const J of Object.values(f)){const tt=P.find(nt=>nt.name===J);tt&&W(Y.counters,J,tt.startTime)}return W(Y.counters,"visibilityHidden",A.visibilityHidden),W(Y.attributes,"style",function(J){if(J)for(const tt of J){const nt=tt.name.split("?")[0];if(a.i(nt)){const ut=nt.split("/").slice(-2);if(ut.length===2)return`mapbox://styles/${ut[0]}/${ut[1]}`}}}(C)),W(Y.attributes,"terrainEnabled",A.terrainEnabled?"true":"false"),W(Y.attributes,"fogEnabled",A.fogEnabled?"true":"false"),W(Y.attributes,"projection",A.projection),W(Y.attributes,"zoom",A.zoom),W(Y.metadata,"devicePixelRatio",B),W(Y.metadata,"connectionEffectiveType",j),W(Y.metadata,"navigatorUserAgent",navigator.userAgent),W(Y.metadata,"screenWidth",window.screen.width),W(Y.metadata,"screenHeight",window.screen.height),W(Y.metadata,"windowWidth",window.innerWidth),W(Y.metadata,"windowHeight",window.innerHeight),W(Y.metadata,"mapWidth",A.width/B),W(Y.metadata,"mapHeight",A.height/B),W(Y.metadata,"webglRenderer",A.renderer),W(Y.metadata,"webglVendor",A.vendor),W(Y.metadata,"sdkVersion",u),W(Y.metadata,"sdkIdentifier","mapbox-gl-js"),Y}(p);for(const A of b.metadata);for(const A of b.counters);for(const A of b.attributes);this.postEvent(c,b,()=>{},x)}},Ke=ye.postPerformanceEvent.bind(ye),We=new class extends fe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(x,c,p,b){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const A=Ct(a.e.API_URL+a.e.SESSION_PATH);A.params.push(`sku=${c||""}`),A.params.push(`access_token=${b||a.e.ACCESS_TOKEN||""}`);const C={url:Gt(A),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(C,P=>{this.pendingRequest=null,p(P),this.saveEventData(),this.processRequests(b)})}getSessionAPI(x,c,p,b){this.skuToken=c,this.errorCb=b,a.e.SESSION_PATH&&a.e.API_URL&&(p||a.e.ACCESS_TOKEN?this.queueRequest({id:x,timestamp:Date.now()},p):this.errorCb(new Error(ft)))}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{id:c,timestamp:p}=this.queue.shift();c&&this.success[c]||this.getSession(p,this.skuToken,b=>{b?this.errorCb(b):c&&(this.success[c]=!0)},x)}remove(){this.errorCb=null}},Si=We.getSessionAPI.bind(We),zt=new Set;function Zt(x,c){c?zt.add(x):zt.delete(x)}class pe{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(c,p){this._updatedSourceCaches[c]=p,this.setDirty()}discardSourceCacheUpdate(c){delete this._updatedSourceCaches[c]}updateLayer(c){const p=c.scope;this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._updatedLayers[p].add(c.id),this.setDirty()}removeLayer(c){const p=c.scope;this._removedLayers[p]=this._removedLayers[p]||{},this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._removedLayers[p][c.id]=c,this._updatedLayers[p].delete(c.id),this._updatedPaintProps.delete(c.fqid),this.setDirty()}getRemovedLayer(c){return this._removedLayers[c.scope]?this._removedLayers[c.scope][c.id]:null}discardLayerRemoval(c){this._removedLayers[c.scope]&&delete this._removedLayers[c.scope][c.id]}getLayerUpdatesByScope(){const c={};for(const p in this._updatedLayers)c[p]=c[p]||{},c[p].updatedIds=Array.from(this._updatedLayers[p].values());for(const p in this._removedLayers)c[p]=c[p]||{},c[p].removedIds=Object.keys(this._removedLayers[p]);return c}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(c){this._updatedPaintProps.add(c.fqid),this.setDirty()}getUpdatedImages(c){return this._updatedImages[c]?Array.from(this._updatedImages[c].values()):[]}updateImage(c,p){this._updatedImages[p]=this._updatedImages[p]||new Set,this._updatedImages[p].add(a.I.toString(c)),this.setDirty()}resetUpdatedImages(c){this._updatedImages[c]&&this._updatedImages[c].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function $e(x){const{userImage:c}=x;return!!(c&&c.render&&c.render())&&(x.data.replace(new Uint8Array(c.data.buffer)),!0)}class He extends a.E{constructor(c){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=c,c!=="raster"&&a.r()&&(this.imageRasterizerDispatcher=new a.D(a.t(),this,"Image Rasterizer Worker",1))}addScope(c){this.loaded.set(c,!1),this.imageProviders.set(c,new Map),this.images.set(c,new Map),this.updatedImages.set(c,new Set),this.callbackDispatchedThisFrame.set(c,new Set),this.patterns.set(c,new Map),this.atlasImage.set(c,new a.q({width:1,height:1}))}removeScope(c){this.loaded.delete(c),this.imageProviders.delete(c),this.images.delete(c),this.updatedImages.delete(c),this.callbackDispatchedThisFrame.delete(c),this.patterns.delete(c),this.atlasImage.delete(c);const p=this.atlasTexture.get(c);p&&(p.destroy(),this.atlasTexture.delete(c))}addImageProvider(c,p){this.imageProviders.has(p)||this.imageProviders.set(p,new Map),this.imageProviders.get(p).set(c.id,c)}removeImageProvider(c,p){this.imageProviders.has(p)&&this.imageProviders.get(p).delete(c)}getPendingImageProviders(){const c=[];for(const p of this.imageProviders.values())for(const b of p.values())b.hasPendingRequests()&&c.push(b);return c}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.x),this._imageRasterizer}isLoaded(){for(const c of this.loaded.keys())if(!this.loaded.get(c))return!1;return!0}setLoaded(c,p){if(this.loaded.get(p)!==c&&(this.loaded.set(p,c),c)){for(const{ids:b,callback:A}of this.requestors)this._notify(b,p,A);this.requestors=[]}}hasImage(c,p){return!!this.getImage(c,p)}getImage(c,p){return this.images.get(p).get(c.toString())}addImage(c,p,b){this._validate(c,b)&&this.images.get(p).set(c.toString(),b)}_validate(c,p){let b=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new a.y(new Error(`Image "${c.name}" has invalid "stretchX" value`))),b=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new a.y(new Error(`Image "${c.name}" has invalid "stretchY" value`))),b=!1),this._validateContent(p.content,p)||(this.fire(new a.y(new Error(`Image "${c.name}" has invalid "content" value`))),b=!1),b}_validateStretch(c,p){if(!c)return!0;let b=0;for(const A of c){if(A[0]<b||A[1]<A[0]||p<A[1])return!1;b=A[1]}return!0}_validateContent(c,p){return c?c.length!==4||!p.usvg&&(c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3])?!1:!(c[2]<c[0]||c[3]<c[1]):!0}updateImage(c,p,b){const A=this.images.get(p).get(c.toString());b.version=A.version+1,this.images.get(p).set(c.toString(),b),this.updatedImages.get(p).add(c),this.removeFromImageRasterizerCache(c,p)}clearUpdatedImages(c){this.updatedImages.get(c).clear()}removeFromImageRasterizerCache(c,p){this.spriteFormat!=="raster"&&(a.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[c],scope:p}):this.imageRasterizer.removeImagesFromCacheByIds([c],p))}removeImage(c,p){const b=this.images.get(p),A=b.get(c.toString());b.delete(c.toString()),this.patterns.get(p).delete(c.toString()),this.removeFromImageRasterizerCache(c,p),A.userImage&&A.userImage.onRemove&&A.userImage.onRemove()}listImages(c){return Array.from(this.images.get(c).keys()).map(p=>a.I.from(p))}getImages(c,p,b){const A=[],C=[],P=this.imageProviders.get(p);for(const j of c){if(!j.iconsetId){A.push(j);continue}const Y=P.get(j.iconsetId);Y&&(this.getImage(j,p)?C.push(j):Y.addPendingRequest(j))}if(A.length===0)return void this._notify(C,p,b);let O=!0;const B=!!this.loaded.get(p),G=this.images.get(p);if(!B)for(const j of A)G.has(j.toString())||(O=!1);B||O?this._notify(A,p,b):this.requestors.push({ids:A,scope:p,callback:b})}rasterizeImages(c,p){const b=new Map,{tasks:A,scope:C}=c;for(const[P,O]of A.entries()){const B=this.getImage(O.id,C);B&&b.set(P,{image:B,imageVariant:O})}this._rasterizeImages(C,b,p)}_rasterizeImages(c,p,b){if(a.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:p,scope:c},b);else{const A=new Map;for(const[C,{image:P,imageVariant:O}]of p.entries())A.set(C,this.imageRasterizer.rasterize(O,P,c,0));b(void 0,A)}}getUpdatedImages(c){return this.updatedImages.get(c)||new Set}_notify(c,p,b){const A=this.images.get(p),C=new Map;for(const P of c){if(!A.get(P.toString())){if(P.iconsetId)continue;this.fire(new a.z("styleimagemissing",{id:P.name}))}const O=A.get(P.toString());if(!O){a.w(`Image "${P.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const B={data:O.usvg?null:O.data.clone(),pixelRatio:O.pixelRatio,sdf:O.sdf,usvg:O.usvg,version:O.version,stretchX:O.stretchX,stretchY:O.stretchY,content:O.content,hasRenderCallback:!!(O.userImage&&O.userImage.render)};O.usvg&&Object.assign(B,{width:O.icon.usvg_tree.width,height:O.icon.usvg_tree.height}),C.set(a.I.toString(P),B)}b(null,C)}getPixelSize(c){const{width:p,height:b}=this.atlasImage.get(c);return{width:p,height:b}}getPattern(c,p,b){const A=c.toString(),C=this.patterns.get(p),P=C.get(A),O=this.getImage(c,p);if(!O)return null;if(P){if(P.position.version===O.version)return P.position;P.position.version=O.version}else{if(O.usvg&&!O.data){const B=this.getPatternInFlightId(A,p);if(this.patternsInFlight.has(B))return null;this.patternsInFlight.add(B);const G=new a.A(c).scaleSelf(a.o.devicePixelRatio),j=new Map([[G.toString(),{image:O,imageVariant:G}]]);return this._rasterizeImages(p,j,(Y,W)=>this.storePatternImage(G,p,O,b,W)),null}this.storePattern(c,p,O)}return this._updatePatternAtlas(p,b),C.get(A).position}getPatternInFlightId(c,p){return a.B(c,p)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(c,p,b,A,C){const P=c.toString(),O=C?C.get(P):void 0;O&&(b.data=O,this.storePattern(c.id,p,b),this._updatePatternAtlas(p,A),this.patternsInFlight.delete(this.getPatternInFlightId(c.id.toString(),p)))}storePattern(c,p,b){const A={w:b.data.width+2*a.C,h:b.data.height+2*a.C,x:0,y:0},C=new a.F(A,b,a.C);this.patterns.get(p).set(c.toString(),{bin:A,position:C})}destroyAtlasTextures(){for(const c of this.atlasTexture.values())c&&c.destroy();this.atlasTexture.clear()}bind(c,p){const b=c.gl;let A=this.atlasTexture.get(p);A?this.dirty&&(A.update(this.atlasImage.get(p)),this.dirty=!1):(A=new a.T(c,this.atlasImage.get(p),b.RGBA8),this.atlasTexture.set(p,A)),A.bind(b.LINEAR,b.CLAMP_TO_EDGE)}_updatePatternAtlas(c,p){const b=this.patterns.get(c),A=Array.from(b.values()).map(({bin:G})=>G),{w:C,h:P}=a.G(A),O=this.atlasImage.get(c);O.resize({width:C||1,height:P||1});const B=this.images.get(c);for(const[G,{bin:j,position:Y}]of b.entries()){let W=Y.padding;const J=j.x+W,tt=j.y+W,nt=B.get(G).data,ut=nt.width,st=nt.height;W=W>1?W-1:W,a.q.copy(nt,O,{x:0,y:0},{x:J,y:tt},{width:ut,height:st},p),a.q.copy(nt,O,{x:0,y:st-W},{x:J,y:tt-W},{width:ut,height:W},p),a.q.copy(nt,O,{x:0,y:0},{x:J,y:tt+st},{width:ut,height:W},p),a.q.copy(nt,O,{x:ut-W,y:0},{x:J-W,y:tt},{width:W,height:st},p),a.q.copy(nt,O,{x:0,y:0},{x:J+ut,y:tt},{width:W,height:st},p),a.q.copy(nt,O,{x:ut-W,y:st-W},{x:J-W,y:tt-W},{width:W,height:W},p),a.q.copy(nt,O,{x:0,y:st-W},{x:J+ut,y:tt-W},{width:W,height:W},p),a.q.copy(nt,O,{x:0,y:0},{x:J+ut,y:tt+st},{width:W,height:W},p),a.q.copy(nt,O,{x:ut-W,y:0},{x:J-W,y:tt+st},{width:W,height:W},p)}this.dirty=!0}beginFrame(){for(const c of this.images.keys())this.callbackDispatchedThisFrame.set(c,new Set)}dispatchRenderCallbacks(c,p){const b=this.images.get(p);for(const A of c){if(this.callbackDispatchedThisFrame.get(p).has(A.toString()))continue;this.callbackDispatchedThisFrame.get(p).add(A.toString());const C=b.get(A.toString());$e(C)&&this.updateImage(A,p,C)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function qe(x){const c=x.value,p=x.valueSpec,b=x.style,A=x.styleSpec,C=x.key,P=x.arrayElementValidator||Hn;if(!Array.isArray(c))return[new a.V(C,c,`array expected, ${a.K(c)} found`)];if(p.length&&c.length!==p.length)return[new a.V(C,c,`array length ${p.length} expected, length ${c.length} found`)];if(p["min-length"]&&c.length<p["min-length"])return[new a.V(C,c,`array length at least ${p["min-length"]} expected, length ${c.length} found`)];let O={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum,function:void 0};A.$version<7&&(O.function=p.function),a.H(p.value)&&(O=p.value);let B=[];for(let G=0;G<c.length;G++)B=B.concat(P({array:c,arrayIndex:G,value:c[G],valueSpec:O,style:b,styleSpec:A,key:`${C}[${G}]`},!0));return B}function Ti(x){const c=x.key,p=x.value,b=x.valueSpec;if(!a.L(p))return[new a.V(c,p,`number expected, ${a.K(p)} found`)];if(p!=p)return[new a.V(c,p,"number expected, NaN found")];if("minimum"in b){let A=b.minimum;if(Array.isArray(b.minimum)&&(A=b.minimum[x.arrayIndex]),p<A)return[new a.V(c,p,`${p} is less than the minimum value ${A}`)]}if("maximum"in b){let A=b.maximum;if(Array.isArray(b.maximum)&&(A=b.maximum[x.arrayIndex]),p>A)return[new a.V(c,p,`${p} is greater than the maximum value ${A}`)]}return[]}function Ai(x){const c=x.key,p=x.value;if(!a.H(p))return[new a.V(c,p,`object expected, ${a.K(p)} found`)];const b=x.valueSpec,A=a.J(p.type);let C,P,O,B={};const G=A!=="categorical"&&p.property===void 0,j=!G,Y=function(nt){const ut=nt.stops;return Array.isArray(ut)&&Array.isArray(ut[0])&&a.H(ut[0][0])}(p),W=To({key:x.key,value:x.value,valueSpec:x.styleSpec.function,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{stops:function(nt){if(A==="identity")return[new a.V(nt.key,nt.value,'identity function may not have a "stops" property')];let ut=[];const st=nt.value;return ut=ut.concat(qe({key:nt.key,value:st,valueSpec:nt.valueSpec,style:nt.style,styleSpec:nt.styleSpec,arrayElementValidator:J})),Array.isArray(st)&&st.length===0&&ut.push(new a.V(nt.key,st,"array must have at least one stop")),ut},default:function(nt){return Hn({key:nt.key,value:nt.value,valueSpec:b,style:nt.style,styleSpec:nt.styleSpec})}}});return A==="identity"&&G&&W.push(new a.V(x.key,x.value,'missing required property "property"')),A==="identity"||p.stops||W.push(new a.V(x.key,x.value,'missing required property "stops"')),A==="exponential"&&b.expression&&!a.M(b)&&W.push(new a.V(x.key,x.value,"exponential functions not supported")),x.styleSpec.$version>=8&&(j&&!a.N(b)?W.push(new a.V(x.key,x.value,"property functions not supported")):G&&!a.O(b)&&W.push(new a.V(x.key,x.value,"zoom functions not supported"))),A!=="categorical"&&!Y||p.property!==void 0||W.push(new a.V(x.key,x.value,'"property" property is required')),W;function J(nt){let ut=[];const st=nt.value,pt=nt.key;if(!Array.isArray(st))return[new a.V(pt,st,`array expected, ${a.K(st)} found`)];if(st.length!==2)return[new a.V(pt,st,`array length 2 expected, length ${st.length} found`)];if(Y){if(!a.H(st[0]))return[new a.V(pt,st,`object expected, ${a.K(st[0])} found`)];const xt=st[0];if(xt.zoom===void 0)return[new a.V(pt,st,"object stop key must have zoom")];if(xt.value===void 0)return[new a.V(pt,st,"object stop key must have value")];const vt=a.J(xt.zoom);if(typeof vt!="number")return[new a.V(pt,xt.zoom,"stop zoom values must be numbers")];if(O&&O>vt)return[new a.V(pt,xt.zoom,"stop zoom values must appear in ascending order")];vt!==O&&(O=vt,P=void 0,B={}),ut=ut.concat(To({key:`${pt}[0]`,value:st[0],valueSpec:{zoom:{}},style:nt.style,styleSpec:nt.styleSpec,objectElementValidators:{zoom:Ti,value:tt}}))}else ut=ut.concat(tt({key:`${pt}[0]`,value:st[0],style:nt.style,styleSpec:nt.styleSpec},st));return a.Q(a.S(st[1]))?ut.concat([new a.V(`${pt}[1]`,st[1],"expressions are not allowed in function stops.")]):ut.concat(Hn({key:`${pt}[1]`,value:st[1],valueSpec:b,style:nt.style,styleSpec:nt.styleSpec}))}function tt(nt,ut){const st=a.K(nt.value),pt=a.J(nt.value),xt=nt.value!==null?nt.value:ut;if(C){if(st!==C)return[new a.V(nt.key,xt,`${st} stop domain type must match previous stop domain type ${C}`)]}else C=st;if(st!=="number"&&st!=="string"&&st!=="boolean"&&typeof pt!="number"&&typeof pt!="string"&&typeof pt!="boolean")return[new a.V(nt.key,xt,"stop domain value must be a number, string, or boolean")];if(st!=="number"&&A!=="categorical"){let vt=`number expected, ${st} found`;return a.N(b)&&A===void 0&&(vt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(nt.key,xt,vt)]}return A!=="categorical"||st!=="number"||typeof pt=="number"&&isFinite(pt)&&Math.floor(pt)===pt?A!=="categorical"&&st==="number"&&typeof pt=="number"&&typeof P=="number"&&P!==void 0&&pt<P?[new a.V(nt.key,xt,"stop domain values must appear in ascending order")]:(P=pt,A==="categorical"&&pt in B?[new a.V(nt.key,xt,"stop domain values must be unique")]:(B[pt]=!0,[])):[new a.V(nt.key,xt,`integer expected, found ${String(pt)}`)]}}function _i(x){const c=(x.expressionContext==="property"?a.W:a.U)(a.S(x.value),x.valueSpec);if(c.result==="error")return c.value.map(b=>new a.V(`${x.key}${b.key}`,x.value,b.message));const p=c.value.expression||c.value._styleExpression.expression;if(x.expressionContext==="property"&&x.propertyKey==="text-font"&&!p.outputDefined())return[new a.V(x.key,x.value,`Invalid data expression for "${x.propertyKey}". Output values must be contained as literals within the expression.`)];if(x.expressionContext==="property"&&x.propertyType==="layout"&&!a.Z(p))return[new a.V(x.key,x.value,'"feature-state" data expressions are not supported with layout properties.')];if(x.expressionContext==="filter")return pi(p,x);if(x.expressionContext==="appearance")return yr(p,x);if(x.expressionContext&&x.expressionContext.indexOf("cluster")===0){if(!a.X(p,["zoom","feature-state"]))return[new a.V(x.key,x.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(x.expressionContext==="cluster-initial"&&!a.Y(p))return[new a.V(x.key,x.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pi(x,c){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(c.valueSpec&&c.valueSpec.expression)for(const A of c.valueSpec.expression.parameters)p.delete(A);if(p.size===0)return[];const b=[];return x instanceof a._&&p.has(x.name)?[new a.V(c.key,c.value,`["${x.name}"] expression is not supported in a filter for a ${c.object.type} layer with id: ${c.object.id}`)]:(x.eachChild(A=>{b.push(...pi(A,c))}),b)}function yr(x,c){const p=new Set;if(c.valueSpec&&c.valueSpec.expression)for(const A of c.valueSpec.expression.parameters)p.add(A);if(p.size===0)return[];const b=[];return x instanceof a._&&!p.has(x.name)?[new a.V(c.key,c.value,`["${x.name}"] is not an allowed parameter`)]:(x.eachChild(A=>{b.push(...yr(A,c))}),b)}function Li(x){const c=x.key,p=x.value,b=x.valueSpec,A=[];return Array.isArray(b.values)?b.values.indexOf(a.J(p))===-1&&A.push(new a.V(c,p,`expected one of [${b.values.join(", ")}], ${JSON.stringify(p)} found`)):Object.keys(b.values).indexOf(a.J(p))===-1&&A.push(new a.V(c,p,`expected one of [${Object.keys(b.values).join(", ")}], ${JSON.stringify(p)} found`)),A}function hr(x){return a.a2(a.S(x.value))?_i(Object.assign({},x,{expressionContext:"filter",valueSpec:x.styleSpec[`filter_${x.layerType||"fill"}`]})):xr(x)}function xr(x){const c=x.value,p=x.key;if(!Array.isArray(c))return[new a.V(p,c,`array expected, ${a.K(c)} found`)];if(c.length<1)return[new a.V(p,c,"filter array must have at least 1 element")];const b=x.styleSpec;let A=Li({key:`${p}[0]`,value:c[0],valueSpec:b.filter_operator});switch(a.J(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&a.J(c[1])==="$type"&&A.push(new a.V(p,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&A.push(new a.V(p,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(a.a0(c[1])||A.push(new a.V(`${p}[1]`,c[1],`string expected, ${a.K(c[1])} found`)));for(let C=2;C<c.length;C++)a.J(c[1])==="$type"?A=A.concat(Li({key:`${p}[${C}]`,value:c[C],valueSpec:b.geometry_type})):a.a0(c[C])||a.L(c[C])||a.$(c[C])||A.push(new a.V(`${p}[${C}]`,c[C],`string, number, or boolean expected, ${a.K(c[C])} found.`));break;case"any":case"all":case"none":for(let C=1;C<c.length;C++)A=A.concat(xr({key:`${p}[${C}]`,value:c[C],style:x.style,styleSpec:x.styleSpec}));break;case"has":case"!has":c.length!==2?A.push(new a.V(p,c,`filter array for "${c[0]}" operator must have 2 elements`)):a.a0(c[1])||A.push(new a.V(`${p}[1]`,c[1],`string expected, ${a.K(c[1])} found`))}return A}function tn(x,c){const p=x.key,b=x.style,A=x.layer,C=x.styleSpec,P=x.value,O=x.objectKey,B=C[`${c}_${x.layerType}`];if(!B)return[];const G=O.match(/^(.*)-use-theme$/);if(G&&B[G[1]])return a.Q(a.S(P))?[].concat(Hn({key:p,value:P,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:b,styleSpec:C,expressionContext:"property",propertyType:c,propertyKey:O})):Hn({key:p,value:P,valueSpec:{type:"string"},style:b,styleSpec:C});const j=O.match(/^(.*)-transition$/);if(c==="paint"&&j&&B[j[1]]&&B[j[1]].transition)return Hn({key:p,value:P,valueSpec:C.transition,style:b,styleSpec:C});const Y=x.valueSpec||B[O];if(!Y)return[new a.a3(p,P,`unknown property "${O}"`)];let W;if(a.a0(P)&&a.N(Y)&&!Y.tokens&&(W=/^{([^}]+)}$/.exec(P))){const tt=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new a.V(p,P,`"${O}" does not support interpolation syntax
Use an identity property function instead: ${tt}.`)]}const J=[];if(x.layerType==="symbol")O!=="text-field"||!b||b.glyphs||b.imports||J.push(new a.V(p,P,'use of "text-field" requires a style "glyphs" property')),O==="text-font"&&a.a4(a.S(P))&&a.J(P.type)==="identity"&&J.push(new a.V(p,P,'"text-font" does not support identity functions'));else if(x.layerType==="model"&&c==="paint"&&A&&A.layout&&A.layout.hasOwnProperty("model-id")&&a.N(Y)&&(a.a5(Y)||a.O(Y))){const tt=a.W(a.S(P),Y).value,nt="expression"in tt&&tt.expression||"_styleExpression"in tt&&tt._styleExpression&&tt._styleExpression.expression;nt&&!a.X(nt,["measure-light"])&&(O==="model-emissive-strength"&&a.Y(nt)&&a.Z(nt)||J.push(new a.V(p,P,`${O} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return J.concat(Hn({key:x.key,value:P,valueSpec:Y,style:b,styleSpec:C,expressionContext:"property",propertyType:c,propertyKey:O}))}function On(x){return tn(x,"paint")}function Kr(x){return tn(x,"layout")}function Ua(x){let c=[];const p=x.value,b=x.key,A=x.style,C=x.styleSpec;if(!a.H(p))return[new a.V(b,p,"object expected")];p.type||p.ref||c.push(new a.V(b,p,'either "type" or "ref" is required'));let P=a.J(p.type);const O=a.J(p.ref);if(p.id){const B=a.J(p.id);for(let G=0;G<x.arrayIndex;G++){const j=A.layers[G];a.J(j.id)===B&&c.push(new a.V(b,p.id,`duplicate layer id "${B}", previously used at line ${j.id.__line__}`))}}if("ref"in p){let B;["type","source","source-layer","filter","layout"].forEach(G=>{G in p&&c.push(new a.V(b,p[G],`"${G}" is prohibited for ref layers`))}),A.layers.forEach(G=>{a.J(G.id)===O&&(B=G)}),B?B.ref?c.push(new a.V(b,p.ref,"ref cannot reference another ref layer")):P=a.J(B.type):typeof O=="string"&&c.push(new a.V(b,p.ref,`ref layer "${O}" not found`))}else if(P!=="background"&&P!=="sky"&&P!=="slot")if(p.source)if(a.a0(p.source)){const B=A.sources&&A.sources[p.source],G=B&&a.J(B.type);B?G==="vector"&&P==="raster"?c.push(new a.V(b,p.source,`layer "${p.id}" requires a raster source`)):G==="raster"&&P!=="raster"?c.push(new a.V(b,p.source,`layer "${p.id}" requires a vector source`)):G!=="vector"||p["source-layer"]?G==="raster-dem"&&P!=="hillshade"?c.push(new a.V(b,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(P)?P==="line"&&p.paint&&(p.paint["line-gradient"]||p.paint["line-trim-offset"])&&G==="geojson"&&!B.lineMetrics?c.push(new a.V(b,p,`layer "${p.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):P==="raster-particle"&&G!=="raster-array"&&c.push(new a.V(b,p.source,`layer "${p.id}" requires a 'raster-array' source.`)):c.push(new a.V(b,p.source,"raster-array source can only be used with layer type 'raster'.")):c.push(new a.V(b,p,`layer "${p.id}" must specify a "source-layer"`)):c.push(new a.V(b,p.source,`source "${p.source}" not found`))}else c.push(new a.V(`${b}.source`,p.source,'"source" must be a string'));else c.push(new a.V(b,p,'missing required property "source"'));return c=c.concat(To({key:b,value:p,valueSpec:C.layer,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Hn({key:`${b}.type`,value:p.type,valueSpec:C.layer.type,style:x.style,styleSpec:x.styleSpec,object:p,objectKey:"type"}),filter:B=>hr(Object.assign({layerType:P},B)),layout:B=>To({layer:p,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>Kr(Object.assign({layerType:P},G))}}),paint:B=>To({layer:p,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>On(Object.assign({layerType:P,layer:p},G))}}),appearances(B){const G=qe({key:B.key,value:B.value,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:W=>function(J){const{key:tt,layer:nt,layerType:ut}=J,st=a.J(J.value),pt=a.J(st.name),xt=a.J(st.condition),vt=To({key:tt,value:st,valueSpec:J.styleSpec.appearance,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{condition:Et=>function(bt){const Pt=[];return Pt.push(..._i({key:bt.key,value:bt.object.condition,valueSpec:a.a6.appearance.condition,expressionContext:"appearance"})),Pt}(Object.assign({layer:nt,layerType:ut},Et)),properties:Et=>function(bt){const Pt=[],{styleSpec:Mt,layer:Tt,layerType:Lt}=bt,qt=Mt[`paint_${Lt}`],jt=Mt[`layout_${Lt}`],oe=bt.object[bt.objectKey];for(const te in oe){const he=te in qt?"paint":te in jt?"layout":void 0;if(!he){Pt.push(new a.V(bt.key,te,`unknown property "${te}" for layer type "${Lt}"`));continue}const Oe=Object.assign({},bt,{key:`${bt.key}.${te}`,object:oe,objectKey:te,layer:Tt,layerType:Lt,value:oe[te],valueSpec:he==="paint"?qt[te]:jt[te]});Pt.push(...tn(Oe,he))}return Pt}(Object.assign({layer:nt,layerType:ut},Et))}});return pt!=="hidden"&&xt===void 0&&vt.push(new a.V(J.key,"name",'Appearance with name different than "hidden" must have a condition')),vt}(Object.assign({layerType:P,layer:p},W))}),j=Array.isArray(B.value)?B.value:[],Y=new Set;return j.forEach((W,J)=>{const tt=a.J(W.name);if(tt)if(Y.has(tt)){const nt=a.J(p.id);G.push(new a.V(B.key,tt,`Duplicated appearance name "${tt}" for layer "${nt}"`))}else Y.add(tt)}),G}}})),c}function ga({key:x,value:c}){return a.a0(c)?[]:[new a.V(x,c,`string expected, ${a.K(c)} found`)]}const So={promoteId:function x({key:c,value:p}){if(a.a0(p))return ga({key:c,value:p});if(Array.isArray(p)){const A=[],C=a.S(p),P=a.U(C);return P.result==="error"&&P.value.forEach(O=>{A.push(new a.V(`${c}${O.key}`,null,`${O.message}`))}),a.X(P.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||A.push(new a.V(`${c}`,null,"promoteId expression should be only feature dependent")),A}if(!a.H(p))return[new a.V(c,p,`string, expression or object expected, "${a.K(p)}" found`)];const b=[];for(const A in p)b.push(...x({key:`${c}.${A}`,value:p[A]}));return b}};function Ka(x){const c=x.value,p=x.key,b=x.styleSpec,A=x.style;if(!a.H(c))return[new a.V(p,c,`object expected, ${a.K(c)} found`)];if(!("type"in c))return[new a.V(p,c,'"type" is required')];const C=a.J(c.type);let P=[];switch(["vector","raster","raster-dem","raster-array"].includes(C)&&("url"in c||"tiles"in c||P.push(new a.a3(p,c,'Either "url" or "tiles" is required.'))),C){case"vector":case"raster":case"raster-dem":case"raster-array":return P=P.concat(To({key:p,value:c,valueSpec:b[`source_${C.replace("-","_")}`],style:x.style,styleSpec:b,objectElementValidators:So})),P;case"geojson":if(P=To({key:p,value:c,valueSpec:b.source_geojson,style:A,styleSpec:b,objectElementValidators:So}),"cluster"in c&&"clusterProperties"in c){if(!a.H(c.clusterProperties))return[new a.V(`${p}.clusterProperties`,c,`object expected, ${a.K(c)} found`)];for(const O in c.clusterProperties){const B=c.clusterProperties[O];if(!Array.isArray(B))return[new a.V(`${p}.clusterProperties.${O}`,B,"array expected")];const[G,j]=B,Y=typeof G=="string"?[G,["accumulated"],["get",O]]:G;P.push(..._i({key:`${p}.${O}.map`,value:j,expressionContext:"cluster-map"})),P.push(..._i({key:`${p}.${O}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}}return P;case"video":return To({key:p,value:c,valueSpec:b.source_video,style:A,styleSpec:b});case"image":return To({key:p,value:c,valueSpec:b.source_image,style:A,styleSpec:b});case"canvas":return[new a.V(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Li({key:`${p}.type`,value:c.type,valueSpec:{values:Jn(b)}})}}function Jn(x){return x.source.reduce((c,p)=>{const b=x[p];return b.type.type==="enum"&&(c=c.concat(Object.keys(b.type.values||{}))),c},[])}function oc(x){const c=x.value,p=x.styleSpec,b=p.light,A=x.style;if(c===void 0)return[];if(!a.H(c))return[new a.V("light",c,`object expected, ${a.K(c)} found`)];let C=[];for(const P in c){const O=P.match(/^(.*)-transition$/),B=P.match(/^(.*)-use-theme$/);C=C.concat(B&&b[B[1]]?Hn({key:P,value:c[P],valueSpec:{type:"string"},style:A,styleSpec:p}):O&&b[O[1]]&&b[O[1]].transition?Hn({key:P,value:c[P],valueSpec:p.transition,style:A,styleSpec:p}):b[P]?Hn({key:P,value:c[P],valueSpec:b[P],style:A,styleSpec:p}):[new a.V(P,c[P],`unknown property "${P}"`)])}return C}function Ja(x){const c=x.value;if(!c)return[];const p=x.key;if(!a.H(c))return[new a.V(p,c,`object expected, ${a.K(c)} found`)];let b=[];const A=x.styleSpec,C=A["light-3d"],P=x.style,O=x.style.lights;for(const j of["type","id"])if(!(j in c))return b=b.concat([new a.V(p,c,`missing property "${j}"`)]),b;if(!a.a0(c.type))return b=b.concat([new a.V(`${p}.type`,c.type,"string expected")]),b;if(O)for(let j=0;j<x.arrayIndex;j++){const Y=a.J(c.type),W=O[j];a.J(W.type)===Y&&b.push(new a.V(p,c.id,`duplicate light type "${c.type}", previously defined at line ${W.id.__line__}`))}const B=`properties_light_${c.type}`;if(!(B in A))return b=b.concat([new a.V(`${p}.type`,c,`Invalid light type ${c.type}`)]),b;const G=A[B];for(const j in c)if(j==="properties"){const Y=c[j];if(!a.H(Y))return b=b.concat([new a.V("properties",Y,`object expected, ${a.K(Y)} found`)]),b;for(const W in Y){const J=W.match(/^(.*)-transition$/),tt=W.match(/^(.*)-use-theme$/);b=b.concat(tt&&G[tt[1]]?Hn({key:j,value:Y[W],valueSpec:{type:"string"},style:P,styleSpec:A}):J&&G[J[1]]&&G[J[1]].transition?Hn({key:j,value:c[j],valueSpec:A.transition,style:P,styleSpec:A}):G[W]?Hn({key:W,value:Y[W],valueSpec:G[W],style:P,styleSpec:A}):[new a.a3(x.key,Y[W],`unknown property "${W}"`)])}}else b=b.concat(C[j]?Hn({key:j,value:c[j],valueSpec:C[j],style:P,styleSpec:A}):[new a.a3(j,c[j],`unknown property "${j}"`)]);return b}function Qa(x){const c=x.value,p=x.key,b=x.style,A=x.styleSpec,C=A.terrain;if(c==null)return[];if(!a.H(c))return[new a.V("terrain",c,`object expected, ${a.K(c)} found`)];let P=[];for(const O in c){const B=O.match(/^(.*)-transition$/),G=O.match(/^(.*)-use-theme$/);P=P.concat(G&&C[G[1]]?Hn({key:O,value:c[O],valueSpec:{type:"string"},style:b,styleSpec:A}):B&&C[B[1]]&&C[B[1]].transition?Hn({key:O,value:c[O],valueSpec:A.transition,style:b,styleSpec:A}):C[O]?Hn({key:O,value:c[O],valueSpec:C[O],style:b,styleSpec:A}):[new a.a3(O,c[O],`unknown property "${O}"`)])}if(c.source)if(a.a0(c.source)){const O=b.sources&&b.sources[c.source],B=O&&a.J(O.type);O?B!=="raster-dem"&&P.push(new a.V(`${p}.source`,c.source,`terrain cannot be used with a source of type ${B}, it only be used with a "raster-dem" source type`)):P.push(new a.V(`${p}.source`,c.source,`source "${c.source}" not found`))}else P.push(new a.V(`${p}.source`,c.source,"source must be a string"));else P.push(new a.V(p,c,'terrain is missing required property "source"'));return P}function xs(x){const c=x.value,p=x.style,b=x.styleSpec,A=b.fog;if(c===void 0)return[];if(!a.H(c))return[new a.V("fog",c,`object expected, ${a.K(c)} found`)];let C=[];for(const P in c){const O=P.match(/^(.*)-transition$/),B=P.match(/^(.*)-use-theme$/);C=C.concat(B&&A[B[1]]?Hn({key:P,value:c[P],valueSpec:{type:"string"},style:p,styleSpec:b}):O&&A[O[1]]&&A[O[1]].transition?Hn({key:P,value:c[P],valueSpec:b.transition,style:p,styleSpec:b}):A[P]?Hn({key:P,value:c[P],valueSpec:A[P],style:p,styleSpec:b}):[new a.a3(P,c[P],`unknown property "${P}"`)])}return C}const ss={"*":()=>[],array:qe,boolean:function(x){const c=x.value,p=x.key;return a.$(c)?[]:[new a.V(p,c,`boolean expected, ${a.K(c)} found`)]},number:Ti,color:function({key:x,value:c}){return a.a0(c)?a.a1.parseCSSColor(c)===null?[new a.V(x,c,`color expected, "${c}" found`)]:[]:[new a.V(x,c,`color expected, ${a.K(c)} found`)]},enum:Li,filter:hr,function:Ai,layer:Ua,object:To,source:Ka,model:a.a7,light:oc,"light-3d":Ja,terrain:Qa,fog:xs,string:ga,formatted:function(x){return ga(x).length===0?[]:_i(x)},resolvedImage:function(x){return ga(x).length===0?[]:_i(x)},projection:function(x){const c=x.value,p=x.styleSpec,b=p.projection,A=x.style;if(a.H(c)){let C=[];for(const P in c)C=C.concat(Hn({key:P,value:c[P],valueSpec:b[P],style:A,styleSpec:p}));return C}return a.a0(c)?[]:[new a.V("projection",c,`object or string expected, ${a.K(c)} found`)]},import:function(x){const c=x.key,{value:p,styleSpec:b}=x;if(!a.H(p))return[new a.V(c,p,"import must be an object")];const{data:A,...C}=p;Object.defineProperty(C,"__line__",{value:p.__line__,enumerable:!1});let P=To(Object.assign({},x,{value:C,valueSpec:b.import}));return a.J(C.id)===""&&P.push(new a.V(`${x.key}.id`,C,"import id can't be an empty string")),A&&(P=P.concat(wu(A,b,{key:`${x.key}.data`}))),P},iconset:function(x){const c=x.value,p=x.key,b=x.styleSpec,A=x.style;if(!a.H(c))return[new a.V(p,c,"object expected")];if(!c.type)return[new a.V(p,c,'"type" is required')];const C=a.J(c.type);let P=[];if(P=P.concat(To({key:p,value:c,valueSpec:b[`iconset_${C}`],style:A,styleSpec:b})),function(O,B){return!(O!=="source"||!B.source)}(C,c)){const O=A.sources&&A.sources[c.source],B=O&&a.J(O.type);O?B!=="raster-array"&&P.push(new a.V(p,c.source,`iconset cannot be used with a source of type ${String(B)}, it only be used with a "raster-array" source type`)):P.push(new a.V(p,c.source,`source "${c.source}" not found`))}return P}};function Hn(x,c=!1){const p=x.value,b=x.valueSpec,A=x.styleSpec;if(b.expression){if(a.a4(a.J(p)))return Ai(x);if(a.Q(a.S(p)))return _i(x)}if(b.type&&ss[b.type]){const C=ss[b.type](x);return c===!0&&C.length>0&&Array.isArray(x.value)?_i(x):C}return To(Object.assign({},x,{valueSpec:b.type?A[b.type]:b}))}function To(x){const c=x.key,p=x.value,b=x.valueSpec||{},A=x.objectElementValidators||{},C=x.style,P=x.styleSpec;if(!a.H(p))return[new a.V(c,p,`object expected, ${a.K(p)} found`)];let O=[];for(const B in p){const G=B.split(".")[0];let j;A[G]?j=A[G]:b[G]?j=Hn:A["*"]?j=A["*"]:b["*"]&&(j=Hn),j?O=O.concat(j({key:(c&&`${c}.`)+B,value:p[B],valueSpec:b[G]||b["*"],style:C,styleSpec:P,object:p,objectKey:B},p)):O.push(new a.a3(c,p[B],`unknown property "${B}"`))}for(const B in b){if(A[B])continue;const G=b[B];G.required&&G.default===void 0&&p[B]===void 0&&O.push(new a.V(c,p,`missing required property "${B}"`))}return O}function Ih({key:x,value:c}){const p=ga({key:x,value:c});if(p.length)return p;const b=c;return b.indexOf("{fontstack}")===-1&&p.push(new a.V(x,c,'"glyphs" url must include a "{fontstack}" token')),b.indexOf("{range}")===-1&&p.push(new a.V(x,c,'"glyphs" url must include a "{range}" token')),p}function wu(x,c=a.a6,p={}){return To({key:p.key||"",value:x,valueSpec:Object.assign(c.$root,{"*":{type:"*"}}),styleSpec:c,style:x,objectElementValidators:{glyphs:Ih}})}function Gs(x,c=a.a6){return Xt(wu(x,c))}const kv=x=>Xt(Ka(x)),Wp=x=>Xt(oc(x)),J0=x=>Xt(Ja(x)),jd=x=>Xt(Qa(x)),Ce=x=>Xt(xs(x)),Bc=x=>Xt(function(c){const p=c.value,b=c.style,A=c.styleSpec,C=A.snow;if(p===void 0)return[];if(!a.H(p))return[new a.V("snow",p,`object expected, ${a.K(p)} found`)];let P=[];for(const O in p){const B=O.match(/^(.*)-transition$/);P=P.concat(B&&C[B[1]]&&C[B[1]].transition?Hn({key:O,value:p[O],valueSpec:A.transition,style:b,styleSpec:A}):C[O]?Hn({key:O,value:p[O],valueSpec:C[O],style:b,styleSpec:A}):[new a.a3(O,p[O],`unknown property "${O}"`)])}return P}(x)),$p=x=>Xt(function(c){const p=c.value,b=c.style,A=c.styleSpec,C=A.rain;if(p===void 0)return[];if(!a.H(p))return[new a.V("rain",p,`object expected, ${a.K(p)} found`)];let P=[];for(const O in p){const B=O.match(/^(.*)-transition$/);P=P.concat(B&&C[B[1]]&&C[B[1]].transition?Hn({key:O,value:p[O],valueSpec:A.transition,style:b,styleSpec:A}):C[O]?Hn({key:O,value:p[O],valueSpec:C[O],style:b,styleSpec:A}):[new a.a3(O,p[O],`unknown property "${O}"`)])}return P}(x)),Zp=x=>Xt(Ua(x)),wr=x=>Xt(hr(x)),Fo=x=>Xt(On(x)),Q0=x=>Xt(Kr(x)),qp=x=>Xt(a.a7(x));function Xt(x){return x.slice().sort((c,p)=>c.line&&p.line?c.line-p.line:0)}function ot(x,c){let p=!1;if(c&&c.length)for(const b of c)b instanceof a.a3?a.w(b.message):(x.fire(new a.y(new Error(b.message))),p=!0);return p}const ct=a.a6.light;let St;class Ft extends a.E{constructor(c,p="flat"){super(),this._transitionable=new a.a8(St||(St=new a.a9({anchor:new a.aa(ct.anchor),position:new a.ab(ct.position),color:new a.aa(ct.color),intensity:new a.aa(ct.intensity)}))),this.setLight(c,p),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,p,b={}){this._validate(Wp,c,b)||(this._transitionable.setTransitionOrValue(c),this.id=p)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,b){return(!b||b.validate!==!1)&&ot(this,c.call(Gs,Object.assign({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}const Bt=a.a6.terrain;let Wt=class extends a.E{constructor(x,c,p,b,A){super(),this.scope=p,this._transitionable=new a.a8(new a.a9({source:new a.aa(Bt.source),exaggeration:new a.aa(Bt.exaggeration)}),p,b),this._transitionable.setTransitionOrValue(x,b),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c,this.worldview=A}get(){return this._transitionable.serialize()}set(x,c){this._transitionable.setTransitionOrValue(x,c)}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}getExaggeration(x){return this._transitioning.possiblyEvaluate(new a.ac(x,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const x=this._transitionable._values.exaggeration;if(!x)return null;const c=x.value.expression;if(!c)return null;let p=-1,b=-1,A=1;for(const C of c.zoomStops)A=c.evaluate(new a.ac(C,{worldview:this.worldview})),A>.01?(p=C,b=-1):b=C;return A<.01&&p>0&&b>p?[p,b]:null}isZoomDependent(){const x=this._transitionable._values.exaggeration;return x!=null&&x.value!=null&&x.value.expression!=null&&x.value.expression instanceof a.ad}};const ne=45,$t=65,ie=.05;function ke(x,c,p,b){const A=a.ah(ne,$t,p),[C,P]=Me(x,b);let O=1-Math.min(1,Math.exp((c-C)/(P-C)*-6));return O*=O*O,O=Math.min(1,1.00747*O),O*A*x.alpha}function Me(x,c){const p=.5/Math.tan(.5*c);return[x.range[0]+p,x.range[1]+p]}function mi(x,c,p,b,A){const C=a.af([],[c,p,b],A.mercatorFogMatrix);return ke(x,a.ag(C),A.pitch,A._fov)}function Gi(x,c,p,b,A,C,P){const O=[[p,b,0],[A,b,0],[A,C,0],[p,C,0]];let B=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const j of O){const Y=a.af([],j,c),W=a.ag(Y);B=Math.min(B,W),G=Math.max(G,W)}return[ke(x,B,P.pitch,P._fov),ke(x,G,P.pitch,P._fov)]}const Bi=a.a6.fog;class Mi extends a.E{constructor(c,p,b,A){super();const C=new a.a9({range:new a.aa(Bi.range),color:new a.aa(Bi.color),"color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.aa(Bi["high-color"]),"high-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.aa(Bi["space-color"]),"space-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.aa(Bi["horizon-blend"]),"star-intensity":new a.aa(Bi["star-intensity"]),"vertical-range":new a.aa(Bi["vertical-range"])});this._transitionable=new a.a8(C,b,new Map(A)),this.set(c,A),this._transitioning=this._transitionable.untransitioned(),this._transform=p,this.properties=new a.ai(C),this.scope=b}get state(){const c=this._transform,p=c.projection.name==="globe",b=a.aj(c.zoom),A=this.properties.get("range"),C=[.5,3];return{range:p?[a.ak(C[0],A[0],b),a.ak(C[1],A[1],b)]:A,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,p,b={}){if(this._validate(Ce,c,b))return;const A=Object.assign({},c);for(const C of Object.keys(Bi))A[C]===void 0&&(A[C]=Bi[C].default);this._options=A,this._transitionable.setTransitionOrValue(this._options,p)}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.ah(ne,$t,c))*p.a}getOpacityAtLatLng(c,p){return this._transform.projection.supportsFog?function(b,A,C){const P=a.ae.fromLngLat(A),O=C.elevation?C.elevation.getAtPointOrZero(P):0;return mi(b,P.x,P.y,O,C)}(this.state,c,p):0}getOpacityForTile(c){if(!this._transform.projection.supportsFog)return[1,1];const p=this._transform.calculateFogTileMatrix(c.toUnwrapped());return Gi(this.state,p,0,0,a.al,a.al,this._transform)}getOpacityForBounds(c,p,b,A,C){return this._transform.projection.supportsFog?Gi(this.state,c,p,b,A,C,this._transform):[1,1]}getFovAdjustedRange(c){return this._transform.projection.supportsFog?Me(this.state,c):[0,1]}isVisibleOnFrustum(c){if(!this._transform.projection.supportsFog)return!1;const p=[4,5,6,7];for(const b of p){const A=c.points[b];let C;if(A[2]>=0)C=A;else{const P=c.points[b-4];C=a.am(P,A,P[2]/(P[2]-A[2]))}if(mi(this.state,C[0],C[1],0,this._transform)>=ie)return!0}return!1}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,p,b){return(!b||b.validate!==!1)&&ot(this,c.call(Gs,Object.assign({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}let dr,pr,nn,Xn,ba=class extends a.E{constructor(x,c,p,b){super();const A=dr||(dr=new a.a9({density:new a.aa(a.a6.snow.density),intensity:new a.aa(a.a6.snow.intensity),color:new a.aa(a.a6.snow.color),opacity:new a.aa(a.a6.snow.opacity),vignette:new a.aa(a.a6.snow.vignette),"vignette-color":new a.aa(a.a6.snow["vignette-color"]),"center-thinning":new a.aa(a.a6.snow["center-thinning"]),direction:new a.aa(a.a6.snow.direction),"flake-size":new a.aa(a.a6.snow["flake-size"])}));this._transitionable=new a.a8(A,p,new Map(b)),this.set(x,b),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(A),this.scope=p}get state(){const x=this.properties.get("opacity"),c=this.properties.get("color"),p=this.properties.get("direction"),b=a.an(p[0]),A=-Math.max(a.an(p[1]),.01),C=[Math.cos(b)*Math.cos(A),Math.sin(b)*Math.cos(A),Math.sin(A)],P=this.properties.get("vignette"),O=this.properties.get("vignette-color");return O.a=P,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(c.r,c.g,c.b,c.a*x),direction:C,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:O}}get(){return this._transitionable.serialize()}set(x,c,p={}){if(this._validate(Bc,x,p))return;const b=Object.assign({},x),A=a.a6.snow;for(const C of Object.keys(A))b[C]===void 0&&(b[C]=A[C].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,c)}updateConfig(x){this._transitionable.setTransitionOrValue(this._options,new Map(x))}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}_validate(x,c,p){return(!p||p.validate!==!1)&&ot(this,x.call(Gs,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}},aa=class extends a.E{constructor(x,c,p,b){super();const A=pr||(pr=new a.a9({density:new a.aa(a.a6.rain.density),intensity:new a.aa(a.a6.rain.intensity),color:new a.aa(a.a6.rain.color),opacity:new a.aa(a.a6.rain.opacity),vignette:new a.aa(a.a6.rain.vignette),"vignette-color":new a.aa(a.a6.rain["vignette-color"]),"center-thinning":new a.aa(a.a6.rain["center-thinning"]),direction:new a.aa(a.a6.rain.direction),"droplet-size":new a.aa(a.a6.rain["droplet-size"]),"distortion-strength":new a.aa(a.a6.rain["distortion-strength"])}));this._transitionable=new a.a8(A,p,new Map(b)),this.set(x,b),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(A),this.scope=p}get state(){const x=this.properties.get("opacity"),c=this.properties.get("color"),p=this.properties.get("direction"),b=a.an(p[0]),A=-Math.max(a.an(p[1]),.01),C=[Math.cos(b)*Math.cos(A),Math.sin(b)*Math.cos(A),Math.sin(A)],P=this.properties.get("vignette-color");return P.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(c.r,c.g,c.b,c.a*x),direction:C,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(x,c,p={}){if(this._validate($p,x,p))return;const b=Object.assign({},x),A=a.a6.rain;for(const C of Object.keys(A))b[C]===void 0&&(b[C]=A[C].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,c)}updateConfig(x){this._transitionable.setTransitionOrValue(this._options,new Map(x))}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}_validate(x,c,p){return(!p||p.validate!==!1)&&ot(this,x.call(Gs,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}};class ea extends a.E{constructor(c,p,b,A){super(),this.scope=b,this._options=c,this.properties=new a.ai(p),this._transitionable=new a.a8(p,b,new Map(A)),this._transitionable.setTransitionOrValue(c.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(c){this._transitionable.setTransitionOrValue(this._options.properties,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(c,p){this._options=c,this._transitionable.setTransitionOrValue(c.properties,p)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class en{constructor(c,p,b){this.screenBounds=c,this.cameraPoint=b.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(c,p){let b,A;if(c instanceof a.P||typeof c[0]=="number"){const C=a.P.convert(c);b=[C],A=p.isPointAboveHorizon(C)}else{const C=a.P.convert(c[0]),P=a.P.convert(c[1]),O=C.add(P)._div(2);b=[C,P],A=a.aq(C,P).every(B=>p.isPointAboveHorizon(B))&&p.isPointAboveHorizon(O)}return new en(b,A,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return a.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const p=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],A=a.aq(p,b,0,!1);return this.cameraPoint.y>b.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<b.x?A.splice(3,0,this.cameraPoint):this.cameraPoint.x>=b.x?A[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(A[3]=this.cameraPoint)),a.ar(A,c)}bufferedCameraGeometryGlobe(c){const p=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],A=a.aq(p,b,c),C=this.cameraPoint.clone();switch(3*((C.y>p.y)+(C.y>b.y))+((C.x>p.x)+(C.x>b.x))){case 0:A[0]=C,A[4]=C.clone();break;case 1:A.splice(1,0,C);break;case 2:A[1]=C;break;case 3:A.splice(4,0,C);break;case 5:A.splice(2,0,C);break;case 6:A[3]=C;break;case 7:A.splice(3,0,C);break;case 8:A[2]=C}return A}containsTile(c,p,b,A=0){const C=Math.max(c.queryPadding,c.evaluateQueryRenderedFeaturePadding())/p._pixelsPerMercatorPixel+1,P=b?this._bufferedCameraMercator(C,p):this._bufferedScreenMercator(C,p);let O=c.tileID.wrap+(P.unwrapped?A:0);const B=P.polygon.map(ut=>a.as(c.tileTransform,ut,O));if(!a.at(B,0,0,a.al,a.al))return;O=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?A:0);const G=this.screenGeometryMercator.polygon.map(ut=>a.au(c.tileTransform,ut,O)),j=G.map(ut=>new a.P(ut[0],ut[1])),Y=p.getFreeCameraOptions().position||new a.ae(0,0,0),W=a.au(c.tileTransform,Y,O),J=G.map(ut=>{const st=a.av(ut,ut,W);return a.aw(st,st),new a.ax(W,st)}),tt=a.ay(c,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:J,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(nt=a.az(B),nt.min.x=a.aA(nt.min.x,0,a.al),nt.min.y=a.aA(nt.min.y,0,a.al),nt.max.x=a.aA(nt.max.x,0,a.al),nt.max.y=a.aA(nt.max.y,0,a.al),nt),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:tt};var nt}_bufferedScreenMercator(c,p){const b=jn(c);if(this._screenRaycastCache[b])return this._screenRaycastCache[b];{let A;return A=p.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),p):{polygon:this.bufferedScreenGeometry(c).map(C=>p.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[b]=A,A}}_bufferedCameraMercator(c,p){const b=jn(c);if(this._cameraRaycastCache[b])return this._cameraRaycastCache[b];{let A;return A=p.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),p):{polygon:this.bufferedCameraGeometry(c).map(C=>p.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[b]=A,A}}_projectAndResample(c,p){const b=function(C,P){const O=a.aB([],P.pixelMatrix,P.globeMatrix),B=[0,-a.aD,0,1],G=[0,a.aD,0,1],j=[0,0,0,1];a.aC(B,B,O),a.aC(G,G,O),a.aC(j,j,O);const Y=new a.P(B[0]/B[3],B[1]/B[3]),W=new a.P(G[0]/G[3],G[1]/G[3]),J=a.aE(C,Y)&&B[3]<j[3],tt=a.aE(C,W)&&G[3]<j[3];if(!J&&!tt)return null;const nt=function(Pt,Mt,Tt){for(let Lt=1;Lt<Pt.length;Lt++){const qt=Tn(Mt.pointCoordinate3D(Pt[Lt-1]).x),jt=Tn(Mt.pointCoordinate3D(Pt[Lt]).x);if(Tt<0){if(qt<jt)return{idx:Lt,t:-qt/(jt-1-qt)}}else if(jt<qt)return{idx:Lt,t:(1-qt)/(jt+1-qt)}}return null}(C,P,J?-1:1);if(!nt)return null;const{idx:ut,t:st}=nt;let pt=ut>1?Sr(C.slice(0,ut),P):[],xt=ut<C.length?Sr(C.slice(ut),P):[];pt=pt.map(Pt=>new a.P(Tn(Pt.x),Pt.y)),xt=xt.map(Pt=>new a.P(Tn(Pt.x),Pt.y));const vt=[...pt];vt.length===0&&vt.push(xt[xt.length-1]);const Et=a.ak(vt[vt.length-1].y,(xt.length===0?pt[0]:xt[0]).y,st);let bt;return bt=J?[new a.P(0,Et),new a.P(0,0),new a.P(1,0),new a.P(1,Et)]:[new a.P(1,Et),new a.P(1,1),new a.P(0,1),new a.P(0,Et)],vt.push(...bt),xt.length===0?vt.push(pt[0]):vt.push(...xt),{polygon:vt.map(Pt=>new a.ae(Pt.x,Pt.y)),unwrapped:!1}}(c,p);if(b)return b;const A=function(C,P){let O=!1,B=-1/0,G=0;for(let Y=0;Y<C.length-1;Y++)C[Y].x>B&&(B=C[Y].x,G=Y);for(let Y=0;Y<C.length-1;Y++){const W=(G+Y)%(C.length-1),J=C[W],tt=C[W+1];Math.abs(J.x-tt.x)>.5&&(J.x<tt.x?(J.x+=1,W===0&&(C[C.length-1].x+=1)):(tt.x+=1,W+1===C.length-1&&(C[0].x+=1)),O=!0)}const j=a.aF(P.center.lng);return O&&j<Math.abs(j-1)&&C.forEach(Y=>{Y.x-=1}),{polygon:C,unwrapped:O}}(Sr(c,p).map(C=>new a.P(Tn(C.x),C.y)),p);return{polygon:A.polygon.map(C=>new a.ae(C.x,C.y)),unwrapped:A.unwrapped}}}function Sr(x,c){return a.aG(x,p=>{const b=c.pointCoordinate3D(p);p.x=b.x,p.y=b.y},1/256)}function Tn(x){return x<0?1+x%1:x%1}function jn(x){return 100*x|0}function sn(x,c,p,b,A){const C=function(O,B){if(O)return A(O);if(B){if(x.url&&B.tiles&&x.tiles&&delete x.tiles,B.variants){if(!Array.isArray(B.variants))return A(new Error("variants must be an array"));for(const j of B.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return A(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return A(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){B=Object.assign(B,j);break}}}const G=a.aH(Object.assign({},B,x),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=c.canonicalizeTileset(G,x.url),A(null,G)}},P=function(O,B,G){if(!O)return null;if(!B&&!G)return O;G=G||O.worldview_default;const j=Object.values(O.language||{});if(j.length===0)return null;const Y=Object.values(O.worldview||{});if(Y.length===0)return null;const W=j.every(tt=>tt===B),J=Y.every(tt=>tt===G);return W&&J?O:B in(O.language_options||{})||G in(O.worldview_options||{})?null:O.language_options&&O.worldview_options?O:null}(x.data,p,b);return P?a.o.frame(()=>C(null,P)):x.url?a.m(c.transformRequest(c.normalizeSourceURL(x.url,null,p,b),a.R.Source),C):a.o.frame(()=>{const{data:O,...B}=x;C(null,B)})}function An(x,c){const p=Math.pow(2,c.z),b=Math.floor(a.aF(x.getWest())*p),A=Math.floor(a.aJ(x.getNorth())*p),C=Math.ceil(a.aF(x.getEast())*p),P=Math.ceil(a.aJ(x.getSouth())*p);return c.x>=b&&c.x<C&&c.y>=A&&c.y<P}class za{constructor(c,p,b){this.bounds=c?a.aI.convert(this.validateBounds(c)):null,this.minzoom=p||0,this.maxzoom=b||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}addExtraBounds(c){if(c){this.extraBounds||(this.extraBounds=[]);for(const p of c)this.extraBounds.push(a.aI.convert(this.validateBounds(p)))}}contains(c){if(c.z>this.maxzoom||c.z<this.minzoom||this.bounds&&!An(this.bounds,c))return!1;if(!this.extraBounds)return!0;for(const p of this.extraBounds)if(An(p,c))return!0;return!1}static fromTileJSON(c){if(!c.bounds&&!c.extra_bounds)return null;const p=new za(c.bounds,c.minzoom,c.maxzoom);return p.addExtraBounds(c.extra_bounds),p}}class No extends a.E{constructor(c,p,b,A){if(super(),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,a.aH(p,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},p),this._collectResourceTiming=!!p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A),this._tileWorkers={},this._deduped=new a.aK}load(c){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const p=Array.isArray(this.map._language)?this.map._language.join():this.map._language,b=this.map.getWorldview();this._tileJSONRequest=sn(this._options,this.map._requestManager,p,b,(A,C)=>{if(this._tileJSONRequest=null,this._loaded=!0,A)p&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${p}`),b&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${b}`),this.fire(new a.y(A));else if(C){if(Object.assign(this,C),this.hasWorldviews=!!C.worldview_options,C.worldview_default&&(this.worldviewDefault=C.worldview_default),C.vector_layers){this.vectorLayers=C.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const P of C.vector_layers)this.vectorLayerIds.push(P.id),C.worldview&&C.worldview[P.source]&&this.localizableLayerIds.add(P.id)}this.tileBounds=za.fromTileJSON(C),be(C.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}c&&c(A)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(c){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(c,p){const b=c.tileID.canonical.url(this.tiles,this.scheme),A=this.map._requestManager.normalizeTileURL(b),C=this.map._requestManager.transformRequest(A,a.R.Tile),P=this.map.style?this.map.style.getLut(this.scope):null,O=P?{image:P.image.clone()}:null,B={request:C,data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,lut:O,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&a.h(b)&&(B.localizableLayerIds=this.localizableLayerIds),B.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",B,G.bind(this));else if(c.actor=this._tileWorkers[A]=this._tileWorkers[A]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",B,G.bind(this),void 0,!0);else{const j=a.aL.call({deduped:this._deduped},B,(Y,W)=>{if(Y||!W)G.call(this,Y);else{const J=a.aM(W.responseHeaders);B.data={cacheControl:J.cacheControl,expires:J.expires,rawData:W.rawData.slice(0)},c.actor&&c.actor.send("loadTile",B,G.bind(this),void 0,!0)}},!0);c.request={cancel:j}}function G(j,Y){return delete c.request,c.aborted?p(null):j&&j.status!==404?p(j):(Y&&Y.resourceTiming&&(c.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&c.setExpiryData(Y),c.loadVectorData(Y,this.map.painter),a.aN(this.dispatcher),p(null,Y),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c,p){c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ml extends a.E{constructor(c,p,b,A){super(),this.id=c,this.dispatcher=b,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},p),Object.assign(this,a.aH(p,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const p=this.map.getWorldview();this._tileJSONRequest=sn(this._options,this.map._requestManager,null,p,(b,A)=>{this._tileJSONRequest=null,this._loaded=!0,b?this.fire(new a.y(b)):A&&(Object.assign(this,A),A.raster_layers&&(this.rasterLayers=A.raster_layers,this.rasterLayerIds=this.rasterLayers.map(C=>C.id)),this.tileBounds=za.fromTileJSON(A),be(A.tiles),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),c&&c(b)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(c){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,p){const b=a.o.devicePixelRatio>=2,A=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),b,this.tileSize);c.request=a.n(this.map._requestManager.transformRequest(A,a.R.Tile),(C,P,O)=>{if(delete c.request,c.aborted)return c.state="unloaded",p(null);if(C)return c.state="errored",p(C);if(!P)return p(null);const B=a.aM(O);this.map._refreshExpiredTiles&&c.setExpiryData(B),c.setTexture(P,this.map.painter),c.state="loaded",a.aN(this.dispatcher),p(null)})}abortTile(c,p){c.request&&(c.request.cancel(),delete c.request),p&&p()}unloadTile(c,p){c.texture&&c.texture instanceof a.T?(c.destroy(!0),c.texture&&c.texture instanceof a.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),p&&p()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Mh([x,c],p,b,{scaled:A=!0}={}){const{tileSize:C,buffer:P}=b,{x:O,y:B,z:G}=p;if(!isFinite(O)||!isFinite(B)||!isFinite(G))throw new Error("Invalid MRT header");const j=2**G,Y=j*a.aF(x),W=j*a.aJ(c);return function([J,tt],nt,{scaled:ut=!0}={}){if(!nt)throw new Error("bandView is undefined");const{data:st,tileSize:pt,buffer:xt,offset:vt,scale:Et,dimension:bt}=nt;if(J<-xt||J>pt+xt||tt<-xt||tt>pt+xt)throw new Error(`Point (${J}, ${tt}) out of bounds for tileSize=${pt}, buffer=${xt}`);const Pt=(tt+xt)*(pt+2*xt)+(J+xt);if(new Uint32Array(st.buffer)[Pt]===4294967295)return null;let Mt=[];Mt=ut?[]:new nt.data.constructor(bt);for(let Tt=0;Tt<bt;Tt++)Mt[Tt]=Math.round(1e12*(st[bt*Pt+Tt]*Et+vt))/1e12;return Mt}([Math.min(Math.max(-P,Math.floor((Y-O)*C)),C-1+P),Math.min(Math.max(-P,Math.floor((W-B)*C)),C-1+P)],b,{scaled:A})}class Ga extends ml{constructor(c,p,b,A){super(c,p,b,A),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},p)}triggerRepaint(c){const p=this.map.painter._terrain,b=this.map.style.getSourceCache(this.id);p&&p.enabled&&b&&p._clearRenderCacheForTile(b.id,c.tileID),this.map.triggerRepaint()}loadTile(c,p){const b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),A=this.map._requestManager.transformRequest(b,a.R.Tile),C={request:A,uid:c.uid,tileID:c.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};c.source=this.id,c.scope=this.scope,c.requestParams=A,c.actor||(c.actor=this.dispatcher.getActor());const P=(O,B,G)=>{if(delete c.request,c.aborted)return c.state="unloaded",p(null);if(O)return O.name==="AbortError"?void 0:(c.state="errored",p(O));if(this.map._refreshExpiredTiles&&B){const j=a.aM(G);c.setExpiryData(j)}if(this.partial&&c.state!=="expired")c.state="empty";else if(!this.partial){if(!B)return p(null);c.state="loaded",c._isHeaderLoaded=!0,c._mrt=B}p(null)};c.request=this.partial?c.fetchHeader(void 0,P.bind(this)):c.actor.send("loadTile",C,P.bind(this),void 0,!0)}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c,p){const b=c.texturePerLayer;if(c.flushAllQueues(),b.size){c.destroy(!0);for(const A of b.values())this.map.painter.saveTileTexture(A)}else c.destroy()}prepareTile(c,p,b,A){c._isHeaderLoaded&&(c.state!=="empty"&&(c.state="reloading"),c.fetchBandForRender(p,b,A,(C,P)=>{if(C)return c.state="errored",this.fire(new a.y(C)),void this.triggerRepaint(c);P&&(c._isHeaderLoaded=!0,c.setTexturePerLayer(b,P,this.map.painter),c.state="loaded",this.triggerRepaint(c))}))}getInitialBand(c){if(!this.rasterLayers)return 0;const p=this.rasterLayers.find(({id:C})=>C===c),b=p&&p.fields,A=b&&b.bands&&b.bands;return A?A[0]:0}getTextureDescriptor(c,p,b){if(!c)return;const A=p.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!A)return;let C=null;p instanceof a.aQ?C=p.paint.get("raster-array-band"):p instanceof a.aR&&(C=p.paint.get("raster-particle-array-band"));const P=C||this.getInitialBand(A);if(P==null)return;if(!c.textureDescriptorPerLayer.get(p.id))return void this.prepareTile(c,A,p.id,P);if(c.updateNeeded(p.id,P)&&!b)return;const O=c.textureDescriptorPerLayer.get(p.id);return Object.assign({},O,{texture:c.texturePerLayer.get(p.id)})}getImages(c,p){const b=new Map;for(const A of c)for(const C of p){const[P,O]=C.split("/"),B=A.getLayer(P);if(!B||!B.hasBand(O)||!B.hasDataForBand(O))continue;const{bytes:G,tileSize:j,buffer:Y}=B.getBandView(O),W=j+2*Y,J={data:new a.q({width:W,height:W},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};b.set(C,J)}return b}queryRasterArrayValueByBandId(c,p,b){const A=p._mrt;return new Promise(C=>{const P={},O=new Set;for(const[B,G]of Object.entries(A.layers)){if(b.layerName&&B!==b.layerName)continue;const j={};P[B]=j;for(const{bands:Y}of G.dataIndex)for(const W of Y)b.bands&&!b.bands.includes(W)||(O.add(a.B(B,W)),p.fetchBand(B,null,W,J=>{a.o.frame(()=>{j[W]=J?null:Mh([c.lng,c.lat],A,G.getBandView(W)),O.delete(a.B(B,W)),O.size===0&&C(P)})},!1))}O.size===0&&C(P)})}_loadTileForQuery(c,p){if(this._loadTileLoaded[c.uid])return void p(null,c._mrt);if(this._loadTilePending[c.uid])return void this._loadTilePending[c.uid].push(p);this._loadTilePending[c.uid]=[p];const b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),A=this.map._requestManager.transformRequest(b,a.R.Tile);c.actor.send("loadTile",{request:A,uid:c.uid,tileID:c.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(C,P,O)=>{if(C)return this._loadTilePending[c.uid].forEach(B=>B(C,null)),void delete this._loadTilePending[c.uid];if(!P)return this._loadTilePending[c.uid].forEach(B=>B(null,null)),void delete this._loadTilePending[c.uid];if(this.map._refreshExpiredTiles&&P){const B=a.aM(O);c.setExpiryData(B)}c._mrt=P,c._isHeaderLoaded=!0,c.state="loaded",this._loadTilePending[c.uid].forEach(B=>B(null,P)),this._loadTileLoaded[c.uid]=!0,delete this._loadTilePending[c.uid]},void 0,!0)}queryRasterArrayValueByAllBands(c,p,b){return new Promise((A,C)=>{this._loadTileForQuery(p,(P,O)=>{P?C(P):A(O?this.queryRasterArrayValueByBandId(c,p,b):null)})})}queryRasterArrayValue(c,p){const b=a.aS.convert(c),A=this.findLoadedParent(b);return A&&A._mrt?p.bands||!this.partial?this.queryRasterArrayValueByBandId(b,A,p):this.queryRasterArrayValueByAllBands(b,A,p):Promise.resolve(null)}findLoadedParent(c){const p=a.ae.fromLngLat(c,this.map.transform.tileSize),b=this.maxzoom+1,A=1<<b,C=Math.floor(p.x),P=Math.floor((p.x-C)*A),O=Math.floor(p.y*A),B=this.map.style.getSourceCache(this.id),G=new a.aP(b,C,b,P,O);return B.findLoadedParent(G,this.minzoom)}}const vl={vector:No,raster:ml,"raster-dem":class extends ml{constructor(x,c,p,b){super(x,c,p,b),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(x,c){const p=this.map._requestManager.normalizeTileURL(x.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function b(A,C){A&&(x.state="errored",c(A)),C&&(x.dem=C,x.dem.onDeserialize(),x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0,x.state="loaded",c(null))}x.request=a.n(this.map._requestManager.transformRequest(p,a.R.Tile),(function(A,C,P){if(delete x.request,x.aborted)x.state="unloaded",c(null);else if(A)x.state="errored",c(A);else if(C){const O=a.aM(P);this.map._refreshExpiredTiles&&x.setExpiryData(O);const B=ImageBitmap&&C instanceof ImageBitmap&&a.r(),G=1-(C.width-a.aO(C.width))/2;G<1||x.neighboringTiles||(x.neighboringTiles=this._getNeighboringTiles(x.tileID));const j=B?C:a.o.getImageData(C,G),Y={uid:x.uid,tileID:x.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:G};x.actor&&x.state!=="expired"||(x.actor=this.dispatcher.getActor(),x.actor.send("loadTile",Y,b.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(x){const c=x.canonical,p=Math.pow(2,c.z),b=(c.x-1+p)%p,A=c.x===0?x.wrap-1:x.wrap,C=(c.x+1+p)%p,P=c.x+1===p?x.wrap+1:x.wrap,O={};return O[new a.aP(x.overscaledZ,A,c.z,b,c.y).key]={backfilled:!1},O[new a.aP(x.overscaledZ,P,c.z,C,c.y).key]={backfilled:!1},c.y>0&&(O[new a.aP(x.overscaledZ,A,c.z,b,c.y-1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,x.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,P,c.z,C,c.y-1).key]={backfilled:!1}),c.y+1<p&&(O[new a.aP(x.overscaledZ,A,c.z,b,c.y+1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,x.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,P,c.z,C,c.y+1).key]={backfilled:!1}),O}},"raster-array":Ga,geojson:class extends a.E{constructor(x,c,p,b){super(),this.id=x,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(b),this._data=c.data,this._options=Object.assign({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.minzoom!==void 0&&(this.minzoom=c.minzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const A=a.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*A,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*A,extent:a.al,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:a.al,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*A,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter,dynamic:c.dynamic},c.workerOptions)}onAdd(x){this.map=x,this.setData(this._data)}setData(x){return this._data=x,this._updateWorkerData(),this}updateData(x){if(!this._options.dynamic)return this.fire(new a.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof x!="string"&&(x.type==="Feature"&&(x={type:"FeatureCollection",features:[x]}),x.type!=="FeatureCollection"))return this.fire(new a.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof x!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const c=new Map;for(const p of this._data.features)c.set(p.id,p);for(const p of x.features)c.set(p.id,p);this._data.features=[...c.values()]}else this._data=x;return this._updateWorkerData(!0),this}getClusterExpansionZoom(x,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:x,source:this.id,scope:this.scope},c),this}getClusterChildren(x,c){return this.actor.send("geojson.getClusterChildren",{clusterId:x,source:this.id,scope:this.scope},c),this}getClusterLeaves(x,c,p,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:x,limit:c,offset:p},b),this}_updateWorkerData(x=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.z("dataloading",{dataType:"source"})),this._loaded=!1;const c=Object.assign({append:x},this.workerOptions);c.scope=this.scope;const p=this._data;typeof p=="string"?(c.request=this.map._requestManager.transformRequest(a.o.resolveURL(p),a.R.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(p),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(b,A)=>{if(this._loaded=!0,this._pendingLoad=null,b)this.fire(new a.y(b));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&A&&A.resourceTiming&&A.resourceTiming[this.id]&&(C.resourceTiming=A.resourceTiming[this.id]),x&&(this._partialReload=!0),this.fire(new a.z("data",C)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(x),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const x=a.B(this.id,this.scope);this.map.style.clearSource(x),this._updateWorkerData()}loadTile(x,c){const p=x.actor?"reloadTile":"loadTile";x.actor=this.actor;const b=this.map.style?this.map.style.getLut(this.scope):null,A=b?{image:b.image.clone()}:null,C=this._partialReload,P={type:this.type,uid:x.uid,tileID:x.tileID,tileZoom:x.tileZoom,zoom:x.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:A,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:x.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:C,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};x.request=this.actor.send(p,P,(O,B)=>C&&!B?(x.state="loaded",c(null)):(delete x.request,x.destroy(),x.aborted?c(null):O?c(O):(x.loadVectorData(B,this.map.painter,p==="reloadTile"),c(null))),void 0,p==="loadTile")}abortTile(x){x.request&&(x.request.cancel(),delete x.request),x.aborted=!0}unloadTile(x,c){this.actor.send("removeTile",{uid:x.uid,type:this.type,source:this.id,scope:this.scope}),x.destroy()}onRemove(x){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aT{constructor(x,c,p,b){super(x,c,p,b),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const x=this.options;this.urls=[];for(const c of x.urls)this.urls.push(this.map._requestManager.transformRequest(c,a.R.Source).url);a.aU(this.urls,(c,p)=>{this._loaded=!0,c?this.fire(new a.y(c)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(x){if(this.video){const c=this.video.seekable;x<c.start(0)||x>c.end(0)?this.fire(new a.y(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=x}}getVideo(){return this.video}onAdd(x){this.map||(this.map=x,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const x=this.map.painter.context,c=x.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(x,this.video,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(x)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aT,model:a.aW,"batched-model":class extends a.E{constructor(x,c,p,b){super(),this.type="batched-model",this.id=x,this.tileSize=512,this._options=c,this.tiles=this._options.tiles,this.maxzoom=c.maxzoom||19,this.minzoom=c.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=p,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(b)}onAdd(x){this.map=x,this.load()}reload(){this.cancelTileJSONRequest();const x=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(x))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(x){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=sn(this._options,this.map._requestManager,c,p,(b,A)=>{this._tileJSONRequest=null,this._loaded=!0,b?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new a.y(b))):A&&(Object.assign(this,A),A.bounds&&(this.tileBounds=new za(A.bounds,this.minzoom,this.maxzoom)),be(A.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),x&&x(b)})}hasTransition(){return!1}hasTile(x){return!this.tileBounds||this.tileBounds.contains(x.canonical)}loaded(){return this._loaded}loadTile(x,c){const p=this.map._requestManager.normalizeTileURL(x.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(p,a.R.Tile),data:void 0,uid:x.uid,tileID:x.tileID,tileZoom:x.tileZoom,zoom:x.tileID.overscaledZ,tileSize:this.tileSize*x.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:x.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.o.devicePixelRatio,promoteId:this.promoteId};if(x.actor&&x.state!=="expired")if(x.state==="loading")x.reloadCallback=c;else{if(x.buckets){const C=Object.values(x.buckets);for(const P of C)P.dirty=!0;return void(x.state="loaded")}x.request=x.actor.send("reloadTile",b,A.bind(this))}else x.actor=this.dispatcher.getActor(),x.request=x.actor.send("loadTile",b,A.bind(this),void 0,!0);function A(C,P){return x.aborted?c(null):C&&C.status!==404?c(C):(this.map._refreshExpiredTiles&&P&&x.setExpiryData(P),x.loadModelData(P,this.map.painter),x.state="loaded",void c(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends a.aT{constructor(x,c,p,b){super(x,c,p,b),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(C=>typeof C!="number"))||this.fire(new a.y(new a.V(`sources.${x}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.y(new a.V(`sources.${x}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new a.y(new a.V(`sources.${x}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new a.y(new a.V(`sources.${x}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.y(new a.V(`sources.${x}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(x){this.map=x,this.load(),this.canvas&&this.animate&&this.play()}onRemove(x){this.pause()}prepare(){let x=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,x=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,x=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?!x&&!this._playing||this.texture instanceof a.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(c,this.canvas,c.gl.RGBA8,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const x of[this.canvas.width,this.canvas.height])if(isNaN(x)||x<=0)return!0;return!1}},custom:class extends a.E{constructor(x,c,p,b){super(),this.id=x,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=c,this.setEventedParent(b),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new za(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,a.aH(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(x){this.map=x,this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(x),this.load()}onRemove(x){this._implementation.onRemove&&this._implementation.onRemove(x)}hasTile(x){if(this._implementation.hasTile){const{x:c,y:p,z:b}=x.canonical;return this._implementation.hasTile({x:c,y:p,z:b})}return!this.tileBounds||this.tileBounds.contains(x.canonical)}loadTile(x,c){const{x:p,y:b,z:A}=x.tileID.canonical,C=new AbortController;x.request=Promise.resolve(this._implementation.loadTile({x:p,y:b,z:A},{signal:C.signal})).then((function(P){return delete x.request,x.aborted?(x.state="unloaded",c(null)):P===void 0?(x.state="errored",c(null)):P===null?(this.loadTileData(x,{width:this.tileSize,height:this.tileSize,data:null}),x.state="loaded",c(null)):function(O){return O instanceof ImageData||O instanceof HTMLCanvasElement||O instanceof ImageBitmap||O instanceof HTMLImageElement}(P)?(this.loadTileData(x,P),x.state="loaded",void c(null)):(x.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(P=>{P.name!=="AbortError"&&(x.state="errored",c(P))}),x.request.cancel=()=>C.abort()}loadTileData(x,c){x.setTexture(c,this.map.painter)}unloadTile(x,c){if(x.texture&&x.texture instanceof a.T?(x.destroy(!0),x.texture&&x.texture instanceof a.T&&this.map.painter.saveTileTexture(x.texture)):x.destroy(),this._implementation.unloadTile){const{x:p,y:b,z:A}=x.tileID.canonical;this._implementation.unloadTile({x:p,y:b,z:A})}c&&c()}abortTile(x,c){x.request&&x.request.cancel&&(x.request.cancel(),delete x.request),c&&c()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(x=>({x:x.canonical.x,y:x.canonical.y,z:x.canonical.z}))}_clearTiles(){const x=a.B(this.id,this.scope);this.map.style.clearSource(x)}_update(){this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}}},Xo=function(x,c,p,b){const A=new vl[c.type](x,c,p,b);if(A.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${A.id}`);return a.aX(["load","abort","unload","serialize","prepare"],A),A};function Bl(x,c,p=""){return`${p}:${c.id||""}:${c.layer.id}:${function(b){if("layerId"in b)return`layer:${b.layerId}`;{const{featuresetId:A,importId:C}=b;return`featureset:${A}${C?`:import:${C}`:""}`}}(x.target)}`}function bs(x,c,p,b=""){if(x.uniqueFeatureID){const A=Bl(x,c,b);if(p.has(A))return!0;p.add(A)}return!1}function ws(x,c,p,b,A=!1){const C=c.sourceCache.transform,P=c.sourceCache.tilesIn(x,c.has3DLayers,A);P.sort(Yp);const O=[];for(const B of P){const G=B.tile.queryRenderedFeatures(c,B,p,b,C,A);Object.keys(G).length&&O.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:G})}for(const B in c.layers){const G=c.layers[B];if(G.styleLayer){const j=G.styleLayer.queryRenderedFeatures(x,c.sourceCache,b);Object.keys(j).length&&O.push({wrappedTileID:0,queryResults:j})}}return O.length===0?{}:function(B){const G={},j={};for(const Y of B){const W=Y.queryResults,J=Y.wrappedTileID,tt=j[J]=j[J]||{};for(const nt in W){const ut=W[nt],st=tt[nt]=tt[nt]||{},pt=G[nt]=G[nt]||[];for(const xt of ut)st[xt.featureIndex]||(st[xt.featureIndex]=!0,pt.push(xt))}}return G}(O)}function Ov(x,c,p,b,A,C){const P={},O=b.queryRenderedSymbols(x),B=[];for(const G of Object.keys(O).map(Number))B.push(A[G]);B.sort(Yp);for(const G of B){const j=G.featureIndex.lookupSymbolFeatures(O[G.bucketInstanceId],G.bucketIndex,G.sourceLayerIndex,c,p,C);for(const Y in j){const W=P[Y]=P[Y]||[],J=j[Y];J.sort((tt,nt)=>{const ut=G.featureSortOrder;if(ut){const st=ut.indexOf(tt.featureIndex);return ut.indexOf(nt.featureIndex)-st}return nt.featureIndex-tt.featureIndex});for(const tt of J)W.push(tt)}}return P}function Xp(x,c){const p=x.getRenderableIds().map(C=>x.getTileByID(C)),b=[],A={};for(let C=0;C<p.length;C++){const P=p[C],O=P.tileID.canonical.key;A[O]||(A[O]=!0,P.querySourceFeatures(b,c))}return b}function Yp(x,c){const p=x.tileID,b=c.tileID;return p.overscaledZ-b.overscaledZ||p.canonical.y-b.canonical.y||p.wrap-b.wrap||p.canonical.x-b.canonical.x}function Kp(x,c){const p={};if(!c)return p;for(const b of x){const A=b.layerIds.map(C=>c.getLayer(C)).filter(Boolean);if(A.length!==0){b.layers=A,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(C=>A.filter(P=>P.id===C)[0]));for(const C of A)p[C.fqid]=b}}return p}const ls=32,Fl=33,Yo=new Uint16Array(8184);for(let x=0;x<2046;x++){let c=x+2,p=0,b=0,A=0,C=0,P=0,O=0;for(1&c?A=C=P=ls:p=b=O=ls;(c>>=1)>1;){const G=p+A>>1,j=b+C>>1;1&c?(A=p,C=b,p=P,b=O):(p=A,b=C,A=P,C=O),P=G,O=j}const B=4*x;Yo[B+0]=p,Yo[B+1]=b,Yo[B+2]=A,Yo[B+3]=C}const Hs=new Uint16Array(2178),Fc=new Uint8Array(1089),Ch=new Uint16Array(1089);function zv(x){return x===0?-.03125:x===32?.03125:0}const Bv=(()=>({type:2,extent:a.al,loadGeometry:()=>[[new a.P(0,0),new a.P(a.al+1,0),new a.P(a.al+1,a.al+1),new a.P(0,a.al+1),new a.P(0,0)]]}))();class sc{constructor(c,p,b,A,C,P){this.tileID=c,this.uid=a.b1(),this.uses=0,this.tileSize=p,this.tileZoom=b,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=C,A&&A.style&&(this._lastUpdatedBrightness=A.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",A&&A.transform&&(this.projection=A.transform.projection),this.worldview=P,this._hasAppearances=null}registerFadeDuration(c){const p=c+this.timeAdded;p<a.o.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(c,p,b){if(this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=Kp(c.buckets,p.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const C=this.buckets[A];if(C instanceof a.b3){if(this.hasSymbolBuckets=!0,!b)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const C=this.buckets[A];if(C instanceof a.b3&&C.hasRTLText){this.hasRTLText=!0,a.b4();break}}this.queryPadding=0;for(const A in this.buckets){const C=this.buckets[A],P=p.style.getOwnLayer(A);if(!P)continue;const O=P.queryRadius(C);this.queryPadding=Math.max(this.queryPadding,O)}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage),c.lineAtlas&&(this.lineAtlas=c.lineAtlas),this._lastUpdatedBrightness=c.brightness}else this.collisionBoxArray=new a.b2}unloadVectorData(){if(this.hasData()){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(c,p,b){c&&(c.resourceTiming&&(this.resourceTiming=c.resourceTiming),this.buckets=Object.assign({},this.buckets,Kp(c.buckets,p.style)),c.featureIndex&&(this.latestFeatureIndex=c.featureIndex))}getBucket(c){return this.buckets[c.fqid]}upload(c,p){for(const C in this.buckets){const P=this.buckets[C];if(P.uploadPending()){let O={},B=[],G={zoom:0,pitch:0,brightness:0,worldview:""};if(p){if(p.style){B=p.style.listImages();const j=P.layers[0],Y=j.sourceLayer||"_geojsonTileLayer",W=p.style.getLayerSourceCache(j);W&&(O=W._state.getState(Y,void 0))}G={zoom:p.transform.zoom||0,pitch:p.transform.pitch||0,brightness:p.style.getBrightness()||0,worldview:p.worldview||""}}P.upload(c,this.tileID.canonical,O,B,G)}}const b=c.gl,A=this.imageAtlas;A&&!A.uploaded&&(this.imageAtlasTexture=new a.T(c,A.image,b.RGBA8,{useMipmap:!!A.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(c,this.glyphAtlasImage,b.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(c,this.lineAtlas.image,b.R8),this.lineAtlas.uploaded=!0)}prepare(c,p,b){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture,b),!p||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const A=p.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(p)),(this._lastUpdatedBrightness||A||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&A&&Math.abs(this._lastUpdatedBrightness-A)<.001||(this.updateBuckets(p,this._lastUpdatedBrightness!==A),this._lastUpdatedBrightness=A))}evaluateQueryRenderedFeaturePadding(){let c=0;for(const p in this.buckets){const b=this.buckets[p];b.evaluateQueryRenderedFeaturePadding&&(c=Math.max(c,b.evaluateQueryRenderedFeaturePadding()))}return c}queryRenderedFeatures(c,p,b,A,C,P){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const O=this.evaluateQueryRenderedFeaturePadding(),B=function(G,j){const Y=a.bp([],[.5*G.width,.5*-G.height,1]);return a.bq(Y,Y,[1,-1,0]),a.aB(Y,Y,G.calculateProjMatrix(j.toUnwrapped())),Float32Array.from(Y)}(C,this.tileID);return this.latestFeatureIndex.query(c,{tilespaceGeometry:p,pixelPosMatrix:B,transform:A,availableImages:b,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:O})}querySourceFeatures(c,p){const b=this.latestFeatureIndex;if(!b||!b.rawTileData)return;const A=b.loadVTLayers(),C=p?p.sourceLayer:"",P=A._geojsonTileLayer||A[C];if(!P)return;const O=a.b5(p&&p.filter),{z:B,x:G,y:j}=this.tileID.canonical,Y={z:B,x:G,y:j};for(let W=0;W<P.length;W++){const J=P.feature(W);if(O.needGeometry){const ut=a.b6(J,!0);if(!O.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ut,this.tileID.canonical))continue}else if(!O.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),J))continue;const tt=b.getId(J,C),nt=new a.b7(J,B,G,j,tt);nt.tile=Y,c.push(nt)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(c){const p=this.expirationTime;if(c.cacheControl){const b=a.b8(c.cacheControl);b["max-age"]&&(this.expirationTime=Date.now()+1e3*b["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const b=Date.now();let A=!1;if(this.expirationTime>b)A=!1;else if(p)if(this.expirationTime<p)A=!0;else{const C=this.expirationTime-p;C?this.expirationTime=b+Math.max(C,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(c){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&c&&this.updateBuckets(c)}hasAppearances(c){for(const p in this.buckets)if(c.style.hasLayer(p)&&this.buckets[p].layers.some(b=>b.appearances&&b.appearances.length>0))return!0;return!1}updateBuckets(c,p){if(!this.latestFeatureIndex||!c.style)return;const b=this.latestFeatureIndex.loadVTLayers(),A=c.style.listImages(),C=c.style.getBrightness();for(const P in this.buckets){if(!c.style.hasLayer(P))continue;const O=this.buckets[P],B=O.layers[0],G=B.sourceLayer||"_geojsonTileLayer",j=b[G],Y=c.style.getLayerSourceCache(B);let W={};Y&&(W=Y._state.getState(G,void 0));const J=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},tt=Object.keys(W).length>0&&!p;if(O.hasAppearances=O.layers.some(ut=>ut.appearances&&ut.appearances.length>0),(tt&&O.stateDependentLayers.length!==0||p)&&O.update(W,j,A,J,tt?O.stateDependentLayers:O.layers,p,C),tt&&O.stateDependentLayers.length!==0||p||O.hasAppearances){const ut={zoom:c.transform.zoom,pitch:c.transform.pitch,brightness:c.style.getBrightness()||0,worldview:c.worldview};O.updateAppearances(this.tileID.canonical,W,A,ut)}(O instanceof a.b9||O instanceof a.ba)&&c._terrain&&c._terrain.enabled&&Y&&O.uploadPending()&&c._terrain._clearRenderCacheForTile(Y.id,this.tileID);const nt=c&&c.style&&c.style.getOwnLayer(P);nt&&(this.queryPadding=Math.max(this.queryPadding,nt.queryRadius(O)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=a.o.now()+c}setTexture(c,p){const b=p.context,A=b.gl;this.texture=this.texture||p.getTileTexture(c.width),this.texture&&this.texture instanceof a.T?this.texture.update(c):(this.texture=new a.T(b,c,A.RGBA8,{useMipmap:!0}),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE))}setDependencies(c,p){const b={};for(const A of p)b[A]=!0;this.dependencies[c]=b}hasDependency(c,p){for(const b of c){const A=this.dependencies[b];if(A){for(const C of p)if(A[C])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(c,p){if(!p||p.name==="mercator"||this._tileDebugBuffer)return;const b=a.bb(Bv,this.tileID.canonical,this.tileTransform)[0],A=new a.bc,C=new a.bd;for(let P=0;P<b.length;P++){const{x:O,y:B}=b[P];A.emplaceBack(O,B),C.emplaceBack(P)}C.emplaceBack(0),this._tileDebugIndexBuffer=c.createIndexBuffer(C),this._tileDebugBuffer=c.createVertexBuffer(A,a.be.members),this._tileDebugSegments=a.bf.simpleSegment(0,0,A.length,C.length)}_makeTileBoundsBuffers(c,p){if(this._tileBoundsBuffer||!p||p.name==="mercator")return;const b=a.bb(Bv,this.tileID.canonical,this.tileTransform)[0];let A,C;if(this.isRaster){const P=function(O,B){const G=a.aY(O,B),j=Math.pow(2,O.z);for(let ut=0;ut<Fl;ut++)for(let st=0;st<Fl;st++){const pt=a.aZ((O.x+(st+zv(st))/ls)/j),xt=a.a_((O.y+(ut+zv(ut))/ls)/j),vt=B.project(pt,xt),Et=ut*Fl+st;Hs[2*Et+0]=Math.round((vt.x*G.scale-G.x)*a.al),Hs[2*Et+1]=Math.round((vt.y*G.scale-G.y)*a.al)}Fc.fill(0),Ch.fill(0);for(let ut=2045;ut>=0;ut--){const st=4*ut,pt=Yo[st+0],xt=Yo[st+1],vt=Yo[st+2],Et=Yo[st+3],bt=pt+vt>>1,Pt=xt+Et>>1,Mt=bt+Pt-xt,Tt=Pt+pt-bt,Lt=xt*Fl+pt,qt=Et*Fl+vt,jt=Pt*Fl+bt,oe=Math.hypot((Hs[2*Lt+0]+Hs[2*qt+0])/2-Hs[2*jt+0],(Hs[2*Lt+1]+Hs[2*qt+1])/2-Hs[2*jt+1])>=16;Fc[jt]=Fc[jt]||(oe?1:0),ut<1022&&(Fc[jt]=Fc[jt]||Fc[(xt+Tt>>1)*Fl+(pt+Mt>>1)]||Fc[(Et+Tt>>1)*Fl+(vt+Mt>>1)])}const Y=new a.a$,W=new a.b0;let J=0;function tt(ut,st){const pt=st*Fl+ut;return Ch[pt]===0&&(Y.emplaceBack(Hs[2*pt+0],Hs[2*pt+1],ut*a.al/ls,st*a.al/ls),Ch[pt]=++J),Ch[pt]-1}function nt(ut,st,pt,xt,vt,Et){const bt=ut+pt>>1,Pt=st+xt>>1;if(Math.abs(ut-vt)+Math.abs(st-Et)>1&&Fc[Pt*Fl+bt])nt(vt,Et,ut,st,bt,Pt),nt(pt,xt,vt,Et,bt,Pt);else{const Mt=tt(ut,st),Tt=tt(pt,xt),Lt=tt(vt,Et);W.emplaceBack(Mt,Tt,Lt)}}return nt(0,0,ls,ls,ls,0),nt(ls,ls,0,0,0,ls),{vertices:Y,indices:W}}(this.tileID.canonical,p);A=P.vertices,C=P.indices}else{A=new a.a$,C=new a.b0;for(const{x:O,y:B}of b)A.emplaceBack(O,B,0,0);const P=a.bg(A.int16.subarray(0,4*A.length),void 0,4);for(let O=0;O<P.length;O+=3)C.emplaceBack(P[O],P[O+1],P[O+2])}this._tileBoundsBuffer=c.createVertexBuffer(A,a.bh.members),this._tileBoundsIndexBuffer=c.createIndexBuffer(C),this._tileBoundsSegments=a.bf.simpleSegment(0,0,A.length,C.length)}_makeGlobeTileDebugBuffers(c,p){const b=p.projection;if(!b||b.name!=="globe"||p.freezeTileCoverage)return;const A=this.tileID.canonical,C=a.bi(A,p),P=a.bj(C),O=a.aj(p.zoom);let B;O>0&&(B=a.bk(new Float64Array(16),p.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(c,A,p,P,B,O),this._makeGlobeTileDebugTextBuffer(c,A,p,P,B,O)}_globePoint(c,p,b,A,C,P,O){let B=a.bl(c,p,b);if(P){const G=1<<b.z,j=a.aF(A.center.lng),Y=a.aJ(A.center.lat),W=(b.x+.5)/G-j;let J=0;W>.5?J=-1:W<-.5&&(J=1);let tt=(c/a.al+b.x)/G+J,nt=(p/a.al+b.y)/G;tt=(tt-j)*A._pixelsPerMercatorPixel+j,nt=(nt-Y)*A._pixelsPerMercatorPixel+Y;const ut=[tt*A.worldSize,nt*A.worldSize,0];a.af(ut,ut,P),B=a.bm(B,ut,O)}return a.af(B,B,C)}_makeGlobeTileDebugBorderBuffer(c,p,b,A,C,P){const O=new a.bc,B=new a.bd,G=new a.bn,j=(W,J,tt,nt,ut)=>{const st=(tt-W)/(ut-1),pt=(nt-J)/(ut-1),xt=O.length;for(let vt=0;vt<ut;vt++){const Et=W+vt*st,bt=J+vt*pt;O.emplaceBack(Et,bt);const Pt=this._globePoint(Et,bt,p,b,A,C,P);G.emplaceBack(Pt[0],Pt[1],Pt[2]),B.emplaceBack(xt+vt)}},Y=a.al;j(0,0,Y,0,16),j(Y,0,Y,Y,16),j(Y,Y,0,Y,16),j(0,Y,0,0,16),this._tileDebugIndexBuffer=c.createIndexBuffer(B),this._tileDebugBuffer=c.createVertexBuffer(O,a.be.members),this._globeTileDebugBorderBuffer=c.createVertexBuffer(G,a.bo.members),this._tileDebugSegments=a.bf.simpleSegment(0,0,O.length,B.length)}_makeGlobeTileDebugTextBuffer(c,p,b,A,C,P){const O=a.al/4,B=new a.bc,G=new a.b0,j=new a.bn,Y=25;G.reserve(32),B.reserve(Y),j.reserve(Y);const W=(J,tt)=>Y*J+tt;for(let J=0;J<Y;J++){const tt=J*O;for(let nt=0;nt<Y;nt++){const ut=nt*O;B.emplaceBack(ut,tt);const st=this._globePoint(ut,tt,p,b,A,C,P);j.emplaceBack(st[0],st[1],st[2])}}for(let J=0;J<4;J++)for(let tt=0;tt<4;tt++){const nt=W(J,tt),ut=W(J,tt+1),st=W(J+1,tt),pt=W(J+1,tt+1);G.emplaceBack(nt,ut,st),G.emplaceBack(st,ut,pt)}this._tileDebugTextIndexBuffer=c.createIndexBuffer(G),this._tileDebugTextBuffer=c.createVertexBuffer(B,a.be.members),this._globeTileDebugTextBuffer=c.createVertexBuffer(j,a.bo.members),this._tileDebugTextSegments=a.bf.simpleSegment(0,0,Y,32)}destroy(c=!1){for(const p in this.buckets)this.buckets[p].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!c&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.br.setPbf(a.bs);class Su extends sc{constructor(c,p,b,A,C){super(c,p,b,A,C),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(c){return this._mrt&&this._mrt.getLayer(c)}setTexturePerLayer(c,p,b){const A=b.context,C=A.gl;let P=this.texturePerLayer.get(c)||b.getTileTexture(p.width);P&&P instanceof a.T?P.update(p,{premultiply:!1}):P=new a.T(A,p,C.RGBA8,{premultiply:!1}),this.texturePerLayer.has(c)||this.texturePerLayer.set(c,P)}flushQueues(c){const p=this._workQueuePerLayer.get(c)||[],b=this._fetchQueuePerLayer.get(c)||[];for(;p.length;)p.pop()();for(;b.length;)b.pop()()}flushAllQueues(){for(const c of this._workQueuePerLayer.keys()){const p=this._workQueuePerLayer.get(c)||[];for(;p.length;)p.pop()()}for(const c of this._fetchQueuePerLayer.keys()){const p=this._fetchQueuePerLayer.get(c)||[];for(;p.length;)p.pop()()}}fetchHeader(c=16384,p){const b=this._mrt=new a.br(30),A=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(c-1)}});return this.entireBuffer=null,this.request=a.bt(A,(C,P,O)=>{if(C)p(C);else try{const B=b.getHeaderLength(P);if(B>c)return void(this.request=this.fetchHeader(B,p));b.parseHeader(P),this._isHeaderLoaded=!0;let G=0;for(const j of Object.values(b.layers))G=Math.max(G,j.dataIndex[j.dataIndex.length-1].lastByte);P.byteLength>=G&&(this.entireBuffer=P),p(null,this.entireBuffer||P,O)}catch(B){p(B)}}),this.request}fetchBandForRender(c,p,b,A){this.fetchBand(c,p,b,C=>{if(C)return void A(C);this.updateTextureDescriptor(c,p,b);const P=this.textureDescriptorPerLayer.get(p);A(null,P?P.img:null)})}fetchBand(c,p,b,A,C=!0){const P=this._mrt;if(!this._isHeaderLoaded||!P)return void A(new Error("Tile header is not ready"));const O=this.actor;if(!O)return void A(new Error("Can't fetch tile band without an actor"));let B;const G=a.B(String(b),a.B(this.tileID.key,c));let j=this._taskQueue.get(G);j?j.add(A):(j=new Set,j.add(A),this._taskQueue.set(G,j));const Y=(nt,ut)=>{B.complete(nt,ut),nt?A(nt):(j.values().forEach(st=>st(null,ut)),this._taskQueue.delete(G))},W=(nt,ut)=>{if(nt)return A(nt);const st=O.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ut,task:B},Y,void 0,!0);if(p!==null){const pt=this._workQueuePerLayer.get(p)||[];pt.push(()=>{st&&st.cancel(),B.cancel()}),this._workQueuePerLayer.has(p)||this._workQueuePerLayer.set(p,pt)}};let J;try{J=P.getLayer(c)}catch(nt){if(this.state==="reloading")return;throw nt}if(!J)return void A(new Error(`Unknown sourceLayer "${c}"`));if(J.hasDataForBand(b))return j.values().forEach(nt=>nt(null,null)),void this._taskQueue.delete(G);const tt=J.getDataRange([b]);if(B=P.createDecodingTask(tt),!B||B.tasks.length)if(p!==null&&this.flushQueues(p),this.entireBuffer)W(null,this.entireBuffer.slice(tt.firstByte,tt.lastByte+1));else{const nt=Object.assign({},this.requestParams,{headers:{Range:`bytes=${tt.firstByte}-${tt.lastByte}`}}),ut=a.bt(nt,W);if(p!==null){const st=this._fetchQueuePerLayer.get(p)||[];st.push(()=>{ut.cancel(),B.cancel()}),this._fetchQueuePerLayer.has(p)||this._fetchQueuePerLayer.set(p,st)}}}updateNeeded(c,p){return(!this.textureDescriptorPerLayer.get(c)||this.textureDescriptorPerLayer.get(c).band!==p||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(c,p,b){if(!this._mrt)return;const A=this._mrt.getLayer(c);if(!A||!A.hasBand(b)||!A.hasDataForBand(b))return;const{bytes:C,tileSize:P,buffer:O,offset:B,scale:G}=A.getBandView(b),j=P+2*O,Y=new a.q({width:j,height:j},C),W=this.texturePerLayer.get(p);W&&W instanceof a.T&&W.update(Y,{premultiply:!1}),this.textureDescriptorPerLayer.set(p,{layer:c,band:b,img:Y,buffer:O,offset:B,tileSize:P,format:A.pixelFormat,mix:[G,256*G,65536*G,16777216*G]})}destroy(c=!1){if(super.destroy(c),delete this._mrt,!c)for(const p of this.texturePerLayer.values())p&&p instanceof a.T&&p.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class tx{constructor(c,p){this.max=c,this.onRemove=p,this.reset()}reset(){for(const c in this.data)for(const p of this.data[c])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(c,p,b){const A=c.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const C={value:p,timeout:void 0};if(b!==void 0&&(C.timeout=setTimeout(()=>{this.remove(c,C)},b)),this.data[A].push(C),this.order.push(A),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const p=this.data[c].shift();return p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),p.value}getByKey(c){const p=this.data[c];return p?p[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,p){if(!this.has(c))return this;const b=c.wrapped().key,A=p===void 0?0:this.data[b].indexOf(p),C=this.data[b][A];return this.data[b].splice(A,1),C.timeout&&clearTimeout(C.timeout),this.data[b].length===0&&delete this.data[b],this.onRemove(C.value),this.order.splice(this.order.indexOf(b),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(c){const p=[];for(const b in this.data)for(const A of this.data[b])c(A.value)||p.push(A);for(const b of p)this.remove(b.value.tileID,b)}}class YS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,p,b){const A=String(p);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][A]=this.stateChanges[c][A]||{},Object.assign(this.stateChanges[c][A],b),this.deletedStates[c]===null){this.deletedStates[c]={};for(const C in this.state[c])C!==A&&(this.deletedStates[c][C]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][A]===null){this.deletedStates[c][A]={};for(const C in this.state[c][A])b[C]||(this.deletedStates[c][A][C]=null)}else for(const C in b)this.deletedStates[c]&&this.deletedStates[c][A]&&this.deletedStates[c][A][C]===null&&delete this.deletedStates[c][A][C]}removeFeatureState(c,p,b){if(this.deletedStates[c]===null)return;const A=String(p);if(this.deletedStates[c]=this.deletedStates[c]||{},b&&p!==void 0)this.deletedStates[c][A]!==null&&(this.deletedStates[c][A]=this.deletedStates[c][A]||{},this.deletedStates[c][A][b]=null);else if(p!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][A])for(b in this.deletedStates[c][A]={},this.stateChanges[c][A])this.deletedStates[c][A][b]=null;else this.deletedStates[c][A]=null;else this.deletedStates[c]=null}getState(c,p){const b=this.state[c]||{},A=this.stateChanges[c]||{},C=this.deletedStates[c];if(C===null)return{};if(p!==void 0){const O=String(p),B=Object.assign({},b[O],A[O]);if(C){const G=C[p];if(G===null)return{};for(const j in G)delete B[j]}return B}const P=Object.assign({},b,A);if(C)for(const O in C)delete P[O];return P}initializeTileState(c,p){c.refreshFeatureState(p)}coalesceChanges(c,p){const b={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const C={};for(const P in this.stateChanges[A])this.state[A][P]||(this.state[A][P]={}),Object.assign(this.state[A][P],this.stateChanges[A][P]),C[P]=this.state[A][P];b[A]=C}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const C={};if(this.deletedStates[A]===null)for(const P in this.state[A])C[P]={},this.state[A][P]={};else for(const P in this.deletedStates[A]){if(this.deletedStates[A][P]===null)this.state[A][P]={};else if(this.state[A][P])for(const O of Object.keys(this.deletedStates[A][P]))delete this.state[A][P][O];C[P]=this.state[A][P]}b[A]=b[A]||{},Object.assign(b[A],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(b).length!==0)for(const A in c)c[A].refreshFeatureState(p)}}class _l extends a.E{constructor(c,p,b){super(),this.id=c,this._onlySymbols=b,p.on("data",A=>{A.dataType==="source"&&A.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),p.on("error",()=>{this._sourceErrored=!0}),this._source=p,this._tiles={},this._cache=new tx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new YS,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(c){this.map=c,this._minTileCacheSize=this._minTileCacheSize===void 0&&c?c._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&c?c._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const c in this._tiles)if(!this._tiles[c].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(c,p){return c.isSymbolTile=this._onlySymbols,c.isExtraShadowCaster=this._shadowCasterTiles[c.tileID.key],this._source.loadTile(c,p)}_unloadTile(c){if(this._source.unloadTile)return this._source.unloadTile(c)}_abortTile(c){if(this._source.abortTile)return this._source.abortTile(c)}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const b=this._tiles[p];b.upload(c,this.map?this.map.painter:void 0),b.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(ex).map(c=>c.key)}getRenderableIds(c,p){const b=[];for(const A in this._tiles)this._isIdRenderable(+A,c,p)&&b.push(this._tiles[A]);return c?b.sort((A,C)=>{const P=A.tileID,O=C.tileID,B=new a.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle),G=new a.P(O.canonical.x,O.canonical.y)._rotate(this.transform.angle);return P.overscaledZ-O.overscaledZ||G.y-B.y||G.x-B.x}).map(A=>A.tileID.key):b.map(A=>A.tileID).sort(ex).map(A=>A.key)}hasRenderableParent(c){const p=this.findLoadedParent(c,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(c,p,b){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(p||!this._tiles[c].holdingForFade())&&(b||!this._shadowCasterTiles[c])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(+c,"reloading")}}_reloadTile(c,p){const b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=p),this._loadTile(b,this._tileLoaded.bind(this,b,c,p)))}_tileLoaded(c,p,b,A,C){if(A){if(c.state="errored",A.status!==404)this._source.fire(new a.y(A,{tile:c}));else{if(this._source.fire(new a.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:c})),!(c.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const O=this.map.painter.terrain;this.update(this.transform,O.getScaledDemTileSize(),!0),O.resetTileLookupCache(this.id)}else this.update(this.transform)}return}c.timeAdded=a.o.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(p,c),this._source.type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null);let P=new Map;C&&C.responseHeaders&&(P=C.responseHeaders),this._source.fire(new a.z("data",{dataType:"source",tile:c,coord:c.tileID,sourceCacheId:this.id,responseHeaders:P}))}_backfillDEM(c){const p=this.getRenderableIds();for(let A=0;A<p.length;A++){const C=p[A];if(c.neighboringTiles&&c.neighboringTiles[C]){const P=this.getTileByID(C);b(c,P),b(P,c)}}function b(A,C){if(!A.dem||A.dem.borderReady)return;A.needsHillshadePrepare=!0,A.needsDEMTextureUpload=!0;let P=C.tileID.canonical.x-A.tileID.canonical.x;const O=C.tileID.canonical.y-A.tileID.canonical.y,B=Math.pow(2,A.tileID.canonical.z),G=C.tileID.key;P===0&&O===0||Math.abs(O)>1||(Math.abs(P)>1&&(Math.abs(P+B)===1?P+=B:Math.abs(P-B)===1&&(P-=B)),C.dem&&A.dem&&(A.dem.backfillBorder(C.dem,P,O),A.neighboringTiles&&A.neighboringTiles[G]&&(A.neighboringTiles[G].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,p,b,A){for(const C in this._tiles){let P=this._tiles[C];if(A[C]||!P.hasData()||P.tileID.overscaledZ<=p||P.tileID.overscaledZ>b)continue;let O=P.tileID;for(;P&&P.tileID.overscaledZ>p+1;){const G=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[G.key],P&&P.hasData()&&(O=G)}let B=O;for(;B.overscaledZ>p;)if(B=B.scaledTo(B.overscaledZ-1),c[B.key]){A[O.key]=O;break}}}findLoadedParent(c,p){if(c.key in this._loadedParentTiles){const b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=p?b:null}for(let b=c.overscaledZ-1;b>=p;b--){const A=c.scaledTo(b),C=this._getLoadedTile(A);if(C)return C}}_getLoadedTile(c){const p=this._tiles[c.key];return p&&p.hasData()?p:this._cache.getByKey(this._source.reparseOverscaled?c.wrapped().key:c.canonical.key)}updateCacheSize(c,p){p=p||this._source.tileSize;const b=Math.ceil(c.width/p)+1,A=Math.ceil(c.height/p)+1,C=Math.floor(b*A*5),P=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,C):C,O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(O)}handleWrapJump(c){const p=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,p){const b={};for(const A in this._tiles){const C=this._tiles[A];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+p),b[C.tileID.key]=C}this._tiles=b;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(+A,this._tiles[A])}}update(c,p,b,A,C){if(this.transform=c,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!b)return;this.updateCacheSize(c,p),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const P=this._source.type==="batched-model";let O,B=this._source.maxzoom;const G=this.map&&this.map.painter?this.map.painter._terrain:null;if(G&&G.sourceCache===this&&G.attenuationRange()){const W=G.attenuationRange()[0],J=Math.floor(W)-Math.log2(G.getDemUpscale());B>J&&(B=J)}if(this.used||this.usedForTerrain){if(this._source.tileID)O=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(W=>new a.aP(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y));else if(this.tileCoverLift!==0){const W=c.clone();W.tileCoverLift=this.tileCoverLift,O=W.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!b,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:P}),this._source.minzoom<=1&&c.projection.name==="globe"&&(O.push(new a.aP(1,0,1,0,0)),O.push(new a.aP(1,0,1,1,0)),O.push(new a.aP(1,0,1,0,1)),O.push(new a.aP(1,0,1,1,1)))}else if(O=c.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!b,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:P}),this._source.hasTile){const W=this._source.hasTile.bind(this._source);O=O.filter(J=>W(J))}}else O=[];if(O.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Eh(this._source.type)){const W=c.coveringZoomLevel({tileSize:p||this._source.tileSize,roundZoom:this._source.roundZoom&&!b}),J=Math.min(W,this._source.maxzoom);if(P){const tt=c.extendTileCover(O,J);for(const nt of tt)O.push(nt)}else if(C){const tt=c.extendTileCoverToNearPlane(O,this.transform.getFrustum(J),J);for(const nt of tt)O.push(nt)}else if(this.castsShadows&&A){const tt=c.extendTileCover(O,J,A);for(const nt of tt)this._shadowCasterTiles[nt.key]=!0,O.push(nt)}}const j=this._updateRetainedTiles(O);if(Eh(this._source.type)&&O.length!==0){const W={},J={},tt=Object.keys(j);for(const ut of tt){const st=j[ut],pt=this._tiles[ut];if(!pt||pt.fadeEndTime&&pt.fadeEndTime<=a.o.now())continue;const xt=this.findLoadedParent(st,Math.max(st.overscaledZ-_l.maxOverzooming,this._source.minzoom));xt&&(this._addTile(xt.tileID),W[xt.tileID.key]=xt.tileID),J[ut]=st}const nt=O[O.length-1].overscaledZ;for(const ut in this._tiles){const st=this._tiles[ut];if(j[ut]||!st.hasData())continue;let pt=st.tileID;for(;pt.overscaledZ>nt;){pt=pt.scaledTo(pt.overscaledZ-1);const xt=this._tiles[pt.key];if(xt&&xt.hasData()&&J[pt.key]){j[ut]=st.tileID;break}}}for(const ut in W)j[ut]||(this._coveredTiles[ut]=!0,j[ut]=W[ut])}for(const W in j)this._tiles[W].clearFadeHold();const Y=a.bu(this._tiles,j);for(const W of Y){const J=this._tiles[W];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(+W)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(+c)}_updateRetainedTiles(c){const p={};if(c.length===0)return p;const b={},A=c.reduce((G,j)=>Math.min(G,j.overscaledZ),1/0),C=c[0].overscaledZ,P=Math.max(C-_l.maxOverzooming,this._source.minzoom),O=Math.max(C+_l.maxUnderzooming,this._source.minzoom),B={};for(const G of c){const j=this._addTile(G);p[G.key]=G,j.hasData()||A<this._source.maxzoom&&(B[G.key]=G)}this._retainLoadedChildren(B,A,O,p);for(const G of c){let j=this._tiles[G.key];if(j.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const W=G.children(this._source.maxzoom)[0],J=this.getTile(W);if(J&&J.hasData()){p[W.key]=W;continue}}else{const W=G.children(this._source.maxzoom);if(p[W[0].key]&&p[W[1].key]&&p[W[2].key]&&p[W[3].key])continue}let Y=j.wasRequested();for(let W=G.overscaledZ-1;W>=P;--W){const J=G.scaledTo(W);if(b[J.key]||(b[J.key]=!0,j=this.getTile(J),!j&&Y&&(j=this._addTile(J)),j&&(p[J.key]=J,Y=j.wasRequested(),j.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const p=[];let b,A=this._tiles[c].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){b=this._loadedParentTiles[A.key];break}p.push(A.key);const C=A.scaledTo(A.overscaledZ-1);if(b=this._getLoadedTile(C),b)break;A=C}for(const C of p)this._loadedParentTiles[C]=b}}_addTile(c){let p=this._tiles[c.key];if(p)return p.isExtraShadowCaster!==!0||this._shadowCasterTiles[c.key]||this._reloadTile(c.key,"reloading"),p;p=this._cache.getAndRemove(c),p&&(this._setTileReloadTimer(c.key,p),p.tileID=c,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,p)));const b=!!p;if(!b){const A=this.map?this.map.painter:null,C=this._source.tileSize*c.overscaleFactor();p=this._source.type==="raster-array"?new Su(c,C,this.transform.tileZoom,A,this._isRaster):new sc(c,C,this.transform.tileZoom,A,this._isRaster,this._source.worldview),this._loadTile(p,this._tileLoaded.bind(this,p,c.key,p.state))}return p.uses++,this._tiles[c.key]=p,b||this._source.fire(new a.z("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(c,p){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const b=p.getExpiryTimeout();b&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},b))}_removeTile(c){const p=this._tiles[c];p&&(p.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),p.uses>0||(p.hasData()&&p.state!=="reloading"||p.state==="empty"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(+c);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(c,p,b){const A=[],C=this.transform;if(!C)return A;const P=C.projection.name==="globe",O=a.aF(C.center.lng);for(const B in this._tiles){const G=this._tiles[B];if(b&&G.clearQueryDebugViz(),G.holdingForFade())continue;let j;if(P){const Y=G.tileID.canonical;if(Y.z===0){const W=[Math.abs(a.aA(O,...Dh(Y,-1))-O),Math.abs(a.aA(O,...Dh(Y,1))-O)];j=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(a.aA(O,...Dh(Y,-1))-O),Math.abs(a.aA(O,...Dh(Y,0))-O),Math.abs(a.aA(O,...Dh(Y,1))-O)];j=[W.indexOf(Math.min(...W))-1]}}else j=[0];for(const Y of j){const W=c.containsTile(G,C,p,Y);W&&A.push(W)}}return A}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(c){return this._getRenderableCoordinates(c)}_getRenderableCoordinates(c,p){const b=this.getRenderableIds(c,p).map(C=>this._tiles[C].tileID),A=this.transform.projection.name==="globe";for(const C of b)C.projMatrix=this.transform.calculateProjMatrix(C.toUnwrapped()),C.expandedProjMatrix=A?this.transform.calculateProjMatrix(C.toUnwrapped(),!1,!0):C.projMatrix;return b}sortCoordinatesByDistance(c){const p=c.slice(),b=this.transform._camera.position,A=this.transform._camera.forward(),C={};for(const P of p){const O=1/(1<<P.canonical.z);C[P.key]=((P.canonical.x+.5)*O+P.wrap-b[0])*A[0]+((P.canonical.y+.5)*O-b[1])*A[1]-b[2]*A[2]}return p.sort((P,O)=>C[P.key]-C[O.key]),p}hasTransition(){if(this._source.hasTransition())return!0;if(Eh(this._source.type))for(const c in this._tiles){const p=this._tiles[c];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=a.o.now())return!0}return!1}setFeatureState(c,p,b){this._state.updateState(c=c||"_geojsonTileLayer",p,b)}removeFeatureState(c,p,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",p,b)}getFeatureState(c,p){return this._state.getState(c=c||"_geojsonTileLayer",p)}setDependencies(c,p,b){const A=this._tiles[c];A&&A.setDependencies(p,b)}reloadTilesForDependencies(c,p){for(const b in this._tiles)this._tiles[b].hasDependency(c,p)&&this._reloadTile(+b,"reloading");this._cache.filter(b=>!b.hasDependency(c,p))}_preloadTiles(c,p){if(!this._sourceLoaded){const B=()=>{this._sourceLoaded&&(this._source.off("data",B),this._preloadTiles(c,p))};return void this._source.on("data",B)}const b=new Map,A=Array.isArray(c)?c:[c],C=this.map.painter.terrain,P=this.usedForTerrain&&C?C.getScaledDemTileSize():this._source.tileSize;for(const B of A){const G=B.coveringTiles({tileSize:P,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of G)b.set(j.key,j);this.usedForTerrain&&B.updateElevation(!1)}const O=Array.from(b.values());a.bv(O,(B,G)=>{const j=new sc(B,this._source.tileSize*B.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(j,Y=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),G(Y,j)})},p)}}function ex(x,c){const p=Math.abs(2*x.wrap)-+(x.wrap<0),b=Math.abs(2*c.wrap)-+(c.wrap<0);return x.overscaledZ-c.overscaledZ||b-p||c.canonical.y-x.canonical.y||c.canonical.x-x.canonical.x}function Eh(x){return x==="raster"||x==="image"||x==="video"||x==="custom"}function Dh(x,c){const p=1<<x.z;return[x.x/p+c,(x.x+1)/p+c]}_l.maxOverzooming=10,_l.maxUnderzooming=3;class ix{constructor(c){this.style=c,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const c=!1,p=!1;for(const b in this.style._mergedLayers){const A=this.style._mergedLayers[b];if(A.type==="fill-extrusion"||A.type==="building")this.layers.push({layer:A,visible:c,visibilityChanged:p});else if(A.type==="model"){const C=this.style.getLayerSource(A);C&&C.type==="batched-model"&&this.layers.push({layer:A,visible:c,visibilityChanged:p})}}}onNewFrame(c){this.layersGotHidden=!1;for(const p of this.layers){const b=p.layer;let A=!1;b.type==="fill-extrusion"?A=!b.isHidden(c)&&b.paint.get("fill-extrusion-opacity")>0:b.type==="building"?A=!b.isHidden(c)&&b.paint.get("building-opacity")>0:b.type==="model"&&(A=!b.isHidden(c)&&b.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!A&&p.visible,p.visible=A}}updateZOffset(c,p){this.currentBuildingBuckets=[];for(const A of this.layers){const C=A.layer,P=this.style.getLayerSourceCache(C);let O=1;C.type==="fill-extrusion"?O=A.visible?C.paint.get("fill-extrusion-vertical-scale"):0:C.type==="building"&&(O=A.visible?C.paint.get("building-vertical-scale"):0);let B=P?P.getTile(p):null;if(!B&&P)for(const G in P._tiles){const j=P._tiles[G];if(p.canonical.isChildOf(j.tileID.canonical)){B=j;break}}this.currentBuildingBuckets.push({bucket:B?B.getBucket(C):null,tileID:B?B.tileID:p,verticalScale:O})}c.hasAnyZOffset=!1;let b=!1;for(let A=0;A<c.symbolInstances.length;A++){const C=c.symbolInstances.get(A),P=C.zOffset,O=this._getHeightAtTileOffset(p,C.tileAnchorX,C.tileAnchorY);C.zOffset=O!==Number.NEGATIVE_INFINITY?O:P,b||P===C.zOffset||(b=!0),c.hasAnyZOffset||C.zOffset===0||(c.hasAnyZOffset=!0)}b&&(c.zOffsetBuffersNeedUpload=!0,c.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(c,p,b,A){let C=p,P=b;if(c.canonical.z!==A.canonical.z){const O=A.canonical,B=1/(1<<c.canonical.z-O.z);C=(p+c.canonical.x*a.al)*B-O.x*a.al|0,P=(b+c.canonical.y*a.al)*B-O.y*a.al|0}return{tileX:C,tileY:P}}_getHeightAtTileOffset(c,p,b){let A,C;for(let P=0;P<this.layers.length;++P){const O=this.layers[P].layer;if(O.type!=="fill-extrusion"&&O.type!=="building")continue;const{bucket:B,tileID:G,verticalScale:j}=this.currentBuildingBuckets[P];if(!B)continue;const{tileX:Y,tileY:W}=this._mapCoordToOverlappingTile(c,p,b,G),J=B.getHeightAtTileCoord(Y,W);J&&J.height!==void 0&&(J.hidden?A=J.height:C=Math.max(J.height*j,C||0))}if(C!==void 0)return C;for(let P=0;P<this.layers.length;++P){const O=this.layers[P];if(O.layer.type!=="model"||!O.visible)continue;const{bucket:B,tileID:G}=this.currentBuildingBuckets[P];if(!B)continue;const{tileX:j,tileY:Y}=this._mapCoordToOverlappingTile(c,p,b,G),W=B.getHeightAtTileCoord(j,Y);if(W&&!W.hidden)return W.height===void 0&&A!==void 0?Math.min(W.maxHeight,A)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Jp(x,c){const p={};for(const b in x)b!=="ref"&&(p[b]=x[b]);return a.bw.forEach(b=>{b in c&&(p[b]=c[b])}),p}function Wd(x){x=x.slice();const c=Object.create(null);for(let p=0;p<x.length;p++)c[x[p].id]=x[p];for(let p=0;p<x.length;p++)"ref"in x[p]&&(x[p]=Jp(x[p],c[x[p].ref]));return x}const Ur={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function rx(x,c,p){p.push({command:Ur.addSource,args:[x,c[x]]})}function Qp(x,c,p){c.push({command:Ur.removeSource,args:[x]}),p[x]=!0}function tg(x,c,p,b){Qp(x,p,b),rx(x,c,p)}function nx(x,c,p){let b;for(b in x[p])if(x[p].hasOwnProperty(b)&&b!=="data"&&!a.bx(x[p][b],c[p][b]))return!1;for(b in c[p])if(c[p].hasOwnProperty(b)&&b!=="data"&&!a.bx(x[p][b],c[p][b]))return!1;return!0}function eg(x,c,p,b,A,C){let P;for(P in c=c||{},x=x||{})x.hasOwnProperty(P)&&(a.bx(x[P],c[P])||p.push({command:C,args:[b,P,c[P],A]}));for(P in c)c.hasOwnProperty(P)&&!x.hasOwnProperty(P)&&(a.bx(x[P],c[P])||p.push({command:C,args:[b,P,c[P],A]}))}function ig(x){return x.id}function rg(x,c){return x[c.id]=c,x}function Ph(x,c,p){const b=c.createTileMatrix(x,x.worldSize,p.toUnwrapped());return a.aB(new Float32Array(16),x.projMatrix,b)}function KS(x,c,p){if(c.projection.name===p.projection.name)return x.projMatrix;const b=p.clone();return b.setProjection(c.projection),Ph(b,c.getProjection(),x)}function Fv(x,c,p){return c.name===p.projection.name?x.projMatrix:Ph(p,c,x)}class OE{constructor(c,p){this.reset(c,p)}reset(c,p){this.points=c||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=a.aA(c,0,1);let p=1,b=this._distances[p];const A=c*this.paddedLength+this.padding;for(;b<A&&p<this._distances.length;)b=this._distances[++p];const C=p-1,P=this._distances[C],O=b-P,B=O>0?(A-P)/O:0;return this.points[C].mult(1-B).add(this.points[p].mult(B))}}class ng{constructor(c,p,b){const A=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/b),this.yCellCount=Math.ceil(p/b);for(let P=0;P<this.xCellCount*this.yCellCount;P++)A.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,p,b,A,C){this._forEachCell(p,b,A,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(b),this.bboxes.push(A),this.bboxes.push(C)}insertCircle(c,p,b,A){this._forEachCell(p-A,b-A,p+A,b+A,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(b),this.circles.push(A)}_insertBoxCell(c,p,b,A,C,P){this.boxCells[C].push(P)}_insertCircleCell(c,p,b,A,C,P){this.circleCells[C].push(P)}_query(c,p,b,A,C,P){if(b<0||c>this.width||A<0||p>this.height)return!C&&[];const O=[];if(c<=0&&p<=0&&this.width<=b&&this.height<=A){if(C)return!0;for(let B=0;B<this.boxKeys.length;B++)O.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const G=this.circles[3*B],j=this.circles[3*B+1],Y=this.circles[3*B+2];O.push({key:this.circleKeys[B],x1:G-Y,y1:j-Y,x2:G+Y,y2:j+Y})}return P?O.filter(P):O}return this._forEachCell(c,p,b,A,this._queryCell,O,{hitTest:C,seenUids:{box:{},circle:{}}},P),C?O.length>0:O}_queryCircle(c,p,b,A,C){const P=c-b,O=c+b,B=p-b,G=p+b;if(O<0||P>this.width||G<0||B>this.height)return!A&&[];const j=[];return this._forEachCell(P,B,O,G,this._queryCellCircle,j,{hitTest:A,circle:{x:c,y:p,radius:b},seenUids:{box:{},circle:{}}},C),A?j.length>0:j}query(c,p,b,A,C){return this._query(c,p,b,A,!1,C)}hitTest(c,p,b,A,C){return this._query(c,p,b,A,!0,C)}hitTestCircle(c,p,b,A){return this._queryCircle(c,p,b,!0,A)}_queryCell(c,p,b,A,C,P,O,B){const G=O.seenUids,j=this.boxCells[C];if(j!==null){const W=this.bboxes;for(const J of j)if(!G.box[J]){G.box[J]=!0;const tt=4*J;if(c<=W[tt+2]&&p<=W[tt+3]&&b>=W[tt+0]&&A>=W[tt+1]&&(!B||B(this.boxKeys[J]))){if(O.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[J],x1:W[tt],y1:W[tt+1],x2:W[tt+2],y2:W[tt+3]})}}}const Y=this.circleCells[C];if(Y!==null){const W=this.circles;for(const J of Y)if(!G.circle[J]){G.circle[J]=!0;const tt=3*J;if(this._circleAndRectCollide(W[tt],W[tt+1],W[tt+2],c,p,b,A)&&(!B||B(this.circleKeys[J]))){if(O.hitTest)return P.push(!0),!0;{const nt=W[tt],ut=W[tt+1],st=W[tt+2];P.push({key:this.circleKeys[J],x1:nt-st,y1:ut-st,x2:nt+st,y2:ut+st})}}}}}_queryCellCircle(c,p,b,A,C,P,O,B){const G=O.circle,j=O.seenUids,Y=this.boxCells[C];if(Y!==null){const J=this.bboxes;for(const tt of Y)if(!j.box[tt]){j.box[tt]=!0;const nt=4*tt;if(this._circleAndRectCollide(G.x,G.y,G.radius,J[nt+0],J[nt+1],J[nt+2],J[nt+3])&&(!B||B(this.boxKeys[tt])))return P.push(!0),!0}}const W=this.circleCells[C];if(W!==null){const J=this.circles;for(const tt of W)if(!j.circle[tt]){j.circle[tt]=!0;const nt=3*tt;if(this._circlesCollide(J[nt],J[nt+1],J[nt+2],G.x,G.y,G.radius)&&(!B||B(this.circleKeys[tt])))return P.push(!0),!0}}}_forEachCell(c,p,b,A,C,P,O,B){const G=this._convertToXCellCoord(c),j=this._convertToYCellCoord(p),Y=this._convertToXCellCoord(b),W=this._convertToYCellCoord(A);for(let J=G;J<=Y;J++)for(let tt=j;tt<=W;tt++)if(C.call(this,c,p,b,A,this.xCellCount*tt+J,P,O,B))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,p,b,A,C,P){const O=A-c,B=C-p,G=b+P;return G*G>O*O+B*B}_circleAndRectCollide(c,p,b,A,C,P,O){const B=(P-A)/2,G=Math.abs(c-(A+B));if(G>B+b)return!1;const j=(O-C)/2,Y=Math.abs(p-(C+j));if(Y>j+b)return!1;if(G<=B||Y<=j)return!0;const W=G-B,J=Y-j;return W*W+J*J<=b*b}}const js={unknown:0,flipRequired:1,flipNotRequired:2},ag=Math.tan(85*Math.PI/180);function $d(x,c,p,b,A,C,P){const O=a.bB();if(p)if(C.name==="globe"){const B=a.bC(A,c);a.aB(O,O,B)}else{const B=a.bD([],P);O[0]=B[0],O[1]=B[1],O[4]=B[2],O[5]=B[3],b||a.bA(O,O,A.angle)}else a.aB(O,A.labelPlaneMatrix,x);return O}function og(x,c,p,b,A,C,P){const O=$d(x,c,p,b,A,C,P);return C.name==="globe"&&p||(O[2]=O[6]=O[10]=O[14]=0),O}function Nc(x,c,p,b,A,C,P){if(p){if(C.name==="globe"){const O=$d(x,c,p,b,A,C,P);return a.bk(O,O),a.aB(O,x,O),O}{const O=a.by(x),B=a.bz([]);return B[0]=P[0],B[1]=P[1],B[4]=P[2],B[5]=P[3],a.aB(O,O,B),b||a.bA(O,O,-A.angle),O}}return A.glCoordMatrix}function Ba(x,c,p,b){const A=[x,c,p,1];p?a.aC(A,A,b):yl(A,A,b);const C=A[3];return A[0]/=C,A[1]/=C,A[2]/=C,A}function ax(x,c){return Math.min(.5+x/c*.5,1.5)}function ox(x,c){const p=x[0]/x[3],b=x[1]/x[3];return p>=-c[0]&&p<=c[0]&&b>=-c[1]&&b<=c[1]}function sx(x,c,p,b,A,C,P,O,B,G,j=1){const Y=p.transform,W=b?x.textSizeData:x.iconSizeData,J=a.bJ(W,p.transform.zoom,j),tt=Y.projection.name==="globe",nt=[256/p.width*2+1,256/p.height*2+1],ut=b?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;ut.clear();let st=null;tt&&(st=b?x.text.globeExtVertexArray:x.icon.globeExtVertexArray);const pt=x.lineVertexArray,xt=b?x.text.placedSymbolArray:x.icon.placedSymbolArray,vt=p.transform.width/p.transform.height;let Et,bt=!1;for(let Pt=0;Pt<xt.length;Pt++){const Mt=xt.get(Pt),{numGlyphs:Tt,writingMode:Lt}=Mt;if(Lt!==a.bK.vertical||bt||Et===a.bK.horizontal||(bt=!0),Et=Lt,(Mt.hidden||Lt===a.bK.vertical)&&!bt){Vc(Tt,ut);continue}bt=!1;const qt=new a.P(Mt.tileAnchorX,Mt.tileAnchorY),jt=x.elevationType==="road",oe=!!Y.elevation||jt;let{x:te,y:he,z:Oe}=Y.projection.projectTilePoint(qt.x,qt.y,G.canonical),Jt=null;if(oe){const ai=jt?x.getElevationFeatureForText(Pt):null;Jt={getElevation:B,elevation:Y.elevation,elevationFeature:ai};const[Ei,mr,Ir]=B(qt,Y.elevation,ai);te+=Ei,he+=mr,Oe+=Ir}const Ut=[te,he,Oe,1];if(a.aC(Ut,Ut,c),!ox(Ut,nt)){Vc(Tt,ut);continue}const de=Ut[3],ee=ax(p.transform.getCameraToCenterDistance(Y.projection),de),Ae=a.bL(W,J,Mt),Ue=P?Ae/ee:Ae*ee,ci=Ba(te,he,Oe,A);if(ci[3]<=0){Vc(Tt,ut);continue}let Le={};const Be=a.an(x.layers[0].layout.get("text-max-angle")),hi=Math.cos(Be),ni=P?null:Jt,ii=JS(Mt,Ue,!1,O,c,A,C,x.glyphOffsetArray,pt,ut,st,ci,qt,Le,vt,ni,Y.projection,G,P,hi);bt=ii.useVertical,ni&&ii.needsFlipping&&(Le={}),(ii.notEnoughRoom||bt||ii.needsFlipping&&JS(Mt,Ue,!0,O,c,A,C,x.glyphOffsetArray,pt,ut,st,ci,qt,Le,vt,ni,Y.projection,G,P,hi).notEnoughRoom)&&Vc(Tt,ut)}b?(x.text.dynamicLayoutVertexBuffer.updateData(ut),st&&x.text.globeExtVertexBuffer&&x.text.globeExtVertexBuffer.updateData(st)):(x.icon.dynamicLayoutVertexBuffer.updateData(ut),st&&x.icon.globeExtVertexBuffer&&x.icon.globeExtVertexBuffer.updateData(st))}function Xr(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut){const{lineStartIndex:st,glyphStartIndex:pt,segment:xt}=O,vt=pt+O.numGlyphs,Et=st+O.lineLength,bt=c.getoffsetX(pt),Pt=c.getoffsetX(vt-1),Mt=sg(x*bt,p,b,A,C,P,xt,st,Et,B,G,j,Y,W,!0,J,tt,nt,ut);if(!Mt)return null;const Tt=sg(x*Pt,p,b,A,C,P,xt,st,Et,B,G,j,Y,W,!0,J,tt,nt,ut);return Tt?{first:Mt,last:Tt}:null}function lx(x,c,p,b){return x===a.bK.horizontal&&Math.abs(b)>Math.abs(p)?{useVertical:!0}:x===a.bK.vertical?b>0?{needsFlipping:!0}:null:c!==js.unknown&&function(A,C){return A===0||Math.abs(C/A)>ag}(p,b)?c===js.flipRequired?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null}function JS(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st,pt,xt){const vt=c/24,Et=x.lineOffsetX*vt,bt=x.lineOffsetY*vt,{lineStartIndex:Pt,glyphStartIndex:Mt,numGlyphs:Tt,segment:Lt,writingMode:qt,flipState:jt}=x,oe=Pt+x.lineLength,te=he=>{if(j){const[de,ee,Ae]=he.up,Ue=G.length;a.bM(j,Ue+0,de,ee,Ae),a.bM(j,Ue+1,de,ee,Ae),a.bM(j,Ue+2,de,ee,Ae),a.bM(j,Ue+3,de,ee,Ae)}const[Oe,Jt,Ut]=he.point;a.bN(G,Oe,Jt,Ut,he.angle)};if(Tt>1){const he=Xr(vt,O,Et,bt,p,Y,W,x,B,C,J,nt,!1,ut,st,pt,xt);if(!he)return{notEnoughRoom:!0};if(b&&!p){let[Oe,Jt,Ut]=he.first.point,[de,ee,Ae]=he.last.point;[Oe,Jt]=Ba(Oe,Jt,Ut,P),[de,ee]=Ba(de,ee,Ae,P);const Ue=lx(qt,jt,(de-Oe)*tt,ee-Jt);if(x.flipState=Ue&&Ue.needsFlipping?js.flipRequired:js.flipNotRequired,Ue)return Ue}te(he.first);for(let Oe=Mt+1;Oe<Mt+Tt-1;Oe++){const Jt=sg(vt*O.getoffsetX(Oe),Et,bt,p,Y,W,Lt,Pt,oe,B,C,J,nt,!1,!1,ut,st,pt,xt);if(!Jt)return G.length-=4*(Oe-Mt),{notEnoughRoom:!0};te(Jt)}te(he.last)}else{if(b&&!p){const Oe=Ba(W.x,W.y,0,A),Jt=Pt+Lt+1,Ut=new a.P(B.getx(Jt),B.gety(Jt)),de=Ba(Ut.x,Ut.y,0,A),ee=de[3]>0?de:zi(W,Ut,Oe,1,A,void 0,ut,st.canonical),Ae=lx(qt,jt,(ee[0]-Oe[0])*tt,ee[1]-Oe[1]);if(x.flipState=Ae&&Ae.needsFlipping?js.flipRequired:js.flipNotRequired,Ae)return Ae}const he=sg(vt*O.getoffsetX(Mt),Et,bt,p,Y,W,Lt,Pt,oe,B,C,J,nt,!1,!1,ut,st,pt,xt);if(!he)return{notEnoughRoom:!0};te(he)}return{}}function QS(x,c,p,b,A){const{x:C,y:P,z:O}=b.projectTilePoint(x.x,x.y,c);if(!A)return Ba(C,P,O,p);const[B,G,j]=A.getElevation(x,A.elevation,A.elevationFeature);return Ba(C+B,P+G,O+j,p)}function zi(x,c,p,b,A,C,P,O){const B=QS(x.sub(c)._unit()._add(x),O,A,P,C);return a.av(B,p,B),a.aw(B,B),a.bG(B,p,B,b)}function sg(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st,pt){const xt=b?x-c:x+c;let vt=xt>0?1:-1,Et=0;b&&(vt*=-1,Et=Math.PI),vt<0&&(Et+=Math.PI);let bt=O+P+(vt>0?0:1)|0,Pt=A,Mt=A,Tt=0,Lt=0;const qt=Math.abs(xt),jt=[],oe=[];let te=C,he=te,Oe=a.bE([]);const Jt=()=>zi(he,te,Mt,qt-Tt+1,j,W,nt,ut.canonical);for(;Tt+Lt<=qt;){if(bt+=vt,bt<O||bt>=B)return null;if(Mt=Pt,he=te,jt.push(Mt),J&&oe.push(he),te=new a.P(G.getx(bt),G.gety(bt)),Pt=Y[bt],!Pt){const ni=QS(te,ut.canonical,j,nt,W);Pt=ni[3]>0?Y[bt]=ni:Jt()}Tt+=Lt;const Be=a.av([],Pt,Mt),hi=a.bF(Mt,Pt);if(p&&hi>0&&Lt>0&&a.bI(Oe,Be)/(Lt*hi)<pt)return null;Lt=hi,Oe=Be}tt&&W&&(Y[bt]&&(Pt=Jt(),Lt=a.bF(Mt,Pt),Oe=a.av([],Pt,Mt)),Y[bt]=Pt);const Ut=(qt-Tt)/Lt,de=te.sub(he)._mult(Ut)._add(he),ee=a.bG([],Mt,Oe,Ut);let Ae=[0,0,1],Ue=Oe[0],ci=Oe[1];if(st&&(Ae=nt.upVector(ut.canonical,de.x,de.y),Ae[0]!==0||Ae[1]!==0||Ae[2]!==1)){const Be=[Ae[2],0,-Ae[0]],hi=a.bH([],Ae,Be);a.aw(Be,Be),a.aw(hi,hi),Ue=a.bI(Oe,Be),ci=a.bI(Oe,hi)}if(p){const Be=a.bH([],Ae,Oe);a.aw(Be,Be),a.bG(ee,ee,Be,p*vt)}const Le=Et+Math.atan2(ci,Ue);return jt.push(ee),J&&oe.push(de),{point:ee,angle:Le,path:jt,tilePath:oe,up:Ae}}function Vc(x,c){const p=c.length,b=p+4*x;c.resize(b),c.float32.fill(-1/0,4*p,4*b)}function yl(x,c,p){const b=c[0],A=c[1];return x[0]=p[0]*b+p[4]*A+p[12],x[1]=p[1]*b+p[5]*A+p[13],x[3]=p[3]*b+p[7]*A+p[15],x}const xl=100;class Zd{constructor(c,p,b=new ng(c.width+200,c.height+200,25),A=new ng(c.width+200,c.height+200,25)){this.transform=c,this.grid=b,this.ignoredGrid=A,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+xl,this.screenBottomBoundary=c.height+xl,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=p}placeCollisionBox(c,p,b,A,C,P,O,B,G,j,Y){let W=b.projectedAnchorX,J=b.projectedAnchorY,tt=b.projectedAnchorZ;const nt=b.tileAnchorX,ut=b.tileAnchorY,st=b.elevation,pt=b.tileID,xt=c.getProjection();if(st&&pt){const[oe,te,he]=xt.upVector(pt.canonical,b.tileAnchorX,b.tileAnchorY),Oe=xt.upVectorScale(pt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=oe*st*Oe,J+=te*st*Oe,tt+=he*st*Oe}const vt=c.projection.name==="globe",Et=c.projection.name==="globe"?a.aj(this.transform.zoom):0;if(pt&&vt&&Et<1&&!P){const oe=1<<pt.canonical.z,te=a.bO(nt,ut);a.bP(te,te,1/a.al),a.bQ(te,te,a.bO(pt.canonical.x,pt.canonical.y)),a.bP(te,te,1/oe),a.bR(te,te,a.bO(A[0],A[1])),te[0]=a.bS(te[0],-.5,.5),a.bP(te,te,a.al);const he=a.bT(te[0],te[1],a.al/(2*Math.PI),1);a.aC(he,he,C),W=a.ak(W,he[0],Et),J=a.ak(J,he[1],Et),tt=a.ak(tt,he[2],Et)}const bt=this.projectAndGetPerspectiveRatio(j,W,J,tt,b.tileID,xt.name==="globe"||!!st||this.transform.pitch>0,xt),Pt=G*bt.perspectiveRatio,Mt=(b.x1*p+O.x-b.padding)*Pt+bt.point.x,Tt=(b.y1*p+O.y-b.padding)*Pt+bt.point.y,Lt=(b.x2*p+O.x+b.padding)*Pt+bt.point.x,qt=(b.y2*p+O.y+b.padding)*Pt+bt.point.y,jt=bt.perspectiveRatio<=.55||bt.occluded;return!this.isInsideGrid(Mt,Tt,Lt,qt)||!B&&this.grid.hitTest(Mt,Tt,Lt,qt,Y)||jt?{box:[],offscreen:!1,occluded:bt.occluded}:{box:[Mt,Tt,Lt,qt],offscreen:this.isOffscreen(Mt,Tt,Lt,qt),occluded:!1}}placeCollisionCircles(c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut){const st=[],pt=this.transform.elevation,xt=c.getProjection(),vt=c.elevationType==="road",Et=!!pt||vt,bt=a.bU.getAtTileOffsetFunc(ut,this.transform.center.lat,this.transform.worldSize,xt),Pt=new a.P(b.tileAnchorX,b.tileAnchorY),Mt=new a.P(b.tileAnchorX,b.tileAnchorY);let{x:Tt,y:Lt,z:qt}=xt.projectTilePoint(Mt.x,Mt.y,ut.canonical),jt=null;if(Et){const hi=vt?c.getElevationFeatureForText(A):null;jt={getElevation:bt,elevation:pt,elevationFeature:hi};const[ni,ii,ai]=bt(Pt,pt,hi);Tt+=ni,Lt+=ii,qt+=ai}const oe=xt.name==="globe",te=this.projectAndGetPerspectiveRatio(B,Tt,Lt,qt,ut,oe||!!pt||this.transform.pitch>0,xt),{perspectiveRatio:he}=te,Oe=(W?O/he:O*he)/a.bX,Jt=Ba(Tt,Lt,qt,G),Ut=b.lineOffsetX*Oe,de=b.lineOffsetY*Oe,ee=a.an(c.layers[0].layout.get("text-max-angle")),Ae=Math.cos(ee),Ue=te.signedDistanceFromCamera>0?Xr(Oe,P,Ut,de,vt&&b.flipState===1,Jt,Mt,b,C,G,{},Et&&!W?jt:null,W&&Et,xt,ut,W,Ae):null;let ci=!1,Le=!1,Be=!0;if(Ue&&!te.occluded){const hi=.5*tt*he+nt,ni=new a.P(-100,-100),ii=new a.P(this.screenRightBoundary,this.screenBottomBoundary),ai=new OE,{first:Ei,last:mr}=Ue,Ir=Ei.path.length;let an=[];for(let ir=Ir-1;ir>=1;ir--)an.push(Ei.path[ir]);for(let ir=1;ir<mr.path.length;ir++)an.push(mr.path[ir]);const Vi=2.5*hi;j&&(an=an.map(([ir,Qr,Mr],pn)=>(Et&&!oe&&(Mr=bt(pn<Ir-1?Ei.tilePath[Ir-1-pn]:mr.tilePath[pn-Ir+2],pt,jt.elevationFeature)[2]),Ba(ir,Qr,Mr,j))),an.some(ir=>ir[3]<=0)&&(an=[]));let Tr=[];if(an.length>0){let ir=1/0,Qr=-1/0,Mr=1/0,pn=-1/0;for(const Or of an)ir=Math.min(ir,Or[0]),Mr=Math.min(Mr,Or[1]),Qr=Math.max(Qr,Or[0]),pn=Math.max(pn,Or[1]);Qr>=ni.x&&ir<=ii.x&&pn>=ni.y&&Mr<=ii.y&&(Tr=[an.map(Or=>new a.P(Or[0],Or[1]))],(ir<ni.x||Qr>ii.x||Mr<ni.y||pn>ii.y)&&(Tr=a.bV(Tr,ni.x,ni.y,ii.x,ii.y)))}for(const ir of Tr){ai.reset(ir,.25*hi);let Qr=0;Qr=ai.length<=.5*hi?1:Math.ceil(ai.paddedLength/Vi)+1;for(let Mr=0;Mr<Qr;Mr++){const pn=Mr/Math.max(Qr-1,1),Or=ai.lerp(pn),ar=Or.x+xl,Gr=Or.y+xl;st.push(ar,Gr,hi,0);const cr=ar-hi,wn=Gr-hi,Zr=ar+hi,Hi=Gr+hi;if(Be=Be&&this.isOffscreen(cr,wn,Zr,Hi),Le=Le||this.isInsideGrid(cr,wn,Zr,Hi),!p&&this.grid.hitTestCircle(ar,Gr,hi,J)&&(ci=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:ci,occluded:!1}}}}return{circles:!Y&&ci||!Le?[]:st,offscreen:Be,collisionDetected:ci,occluded:te.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let b=1/0,A=1/0,C=-1/0,P=-1/0;for(const j of c){const Y=new a.P(j.x+xl,j.y+xl);b=Math.min(b,Y.x),A=Math.min(A,Y.y),C=Math.max(C,Y.x),P=Math.max(P,Y.y),p.push(Y)}const O=this.grid.query(b,A,C,P).concat(this.ignoredGrid.query(b,A,C,P)),B={},G={};for(const j of O){const Y=j.key;if(B[Y.bucketInstanceId]===void 0&&(B[Y.bucketInstanceId]={}),B[Y.bucketInstanceId][Y.featureIndex])continue;const W=[new a.P(j.x1,j.y1),new a.P(j.x2,j.y1),new a.P(j.x2,j.y2),new a.P(j.x1,j.y2)];a.bW(p,W)&&(B[Y.bucketInstanceId][Y.featureIndex]=!0,G[Y.bucketInstanceId]===void 0&&(G[Y.bucketInstanceId]=[]),G[Y.bucketInstanceId].push(Y.featureIndex))}return G}insertCollisionBox(c,p,b,A,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:A,collisionGroupID:C},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,p,b,A,C){const P=p?this.ignoredGrid:this.grid,O={bucketInstanceId:b,featureIndex:A,collisionGroupID:C};for(let B=0;B<c.length;B+=4)P.insertCircle(O,c[B],c[B+1],c[B+2])}projectAndGetPerspectiveRatio(c,p,b,A,C,P,O){const B=[p,b,A,1];let G=!1;A||this.transform.pitch>0?(a.aC(B,B,c),this.fogState&&C&&O.name!=="globe"&&(G=function(W,J,tt,nt,ut,st){const pt=st.calculateFogTileMatrix(ut),xt=[J,tt,nt];return a.af(xt,xt,pt),ke(W,a.ag(xt),st.pitch,st._fov)}(this.fogState,p,b,A,C.toUnwrapped(),this.transform)>.9)):yl(B,B,c);const j=B[3];return{point:new a.P((B[0]/j+1)/2*this.transform.width+xl,(-B[1]/j+1)/2*this.transform.height+xl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(O)/j*.5,1.5),signedDistanceFromCamera:j,occluded:P&&B[2]>j||G}}isOffscreen(c,p,b,A){return b<xl||c>=this.screenRightBoundary||A<xl||p>this.screenBottomBoundary}isInsideGrid(c,p,b,A){return b>=0&&c<this.gridRightBoundary&&A>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const c=a.bz([]);return a.bq(c,c,[-100,-100,0]),c}}class yi{constructor(c,p,b,A){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):A&&b?1:0,this.placed=b}isHidden(){return this.opacity===0&&!this.placed}}class kr{constructor(c,p,b,A,C,P=!1){this.text=new yi(c?c.text:null,p,b,C),this.icon=new yi(c?c.icon:null,p,A,C),this.clipped=P}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $r{constructor(c,p,b,A=!1){this.text=c,this.icon=p,this.skipFade=b,this.clipped=A}}class Ss{constructor(){this.invProjMatrix=a.bB(),this.viewportMatrix=a.bB(),this.circles=[]}}class qd{constructor(c,p,b,A,C){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=b,this.bucketIndex=A,this.tileID=C}}class Jr{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:b=>b.collisionGroupID===p}}return this.collisionGroups[c]}}function lg(x,c,p,b,A){const{horizontalAlign:C,verticalAlign:P}=a.c0(x),O=-(C-.5)*c,B=-(P-.5)*p,G=a.c1(x,b);return new a.P(O+G[0]*A,B+G[1]*A)}function Lh(x,c,p,b,A){const C=new a.P(x,c);return p&&C._rotate(b?A:-A),C}class cg{constructor(c,p,b,A,C,P){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Zd(this.transform,C),this.buildingIndex=P,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Jr(b),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,p,b,A,C=1){const P=b.getBucket(p),O=b.latestFeatureIndex;if(!P||!O||p.fqid!==P.layerIds[0])return;const B=P.layers[0].layout,G=P.layers[0].paint,j=b.collisionBoxArray,Y=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),W=b.tileSize/a.al,J=b.tileID.toUnwrapped();this.transform.setProjection(P.projection);const tt=(nt=b.tileID,ut=P.getProjection(),st=this.transform,ut.name===this.projection?st.calculateProjMatrix(nt.toUnwrapped()):Ph(st,ut,nt));var nt,ut,st;const pt=B.get("text-pitch-alignment")==="map",xt=B.get("text-rotation-alignment")==="map";p.compileFilter(p.options);const vt=p.dynamicFilter(),Et=p.dynamicFilterNeedsFeature(),bt=this.transform.calculatePixelsToTileUnitsMatrix(b),Pt=og(tt,b.tileID.canonical,pt,xt,this.transform,P.getProjection(),bt);let Mt=null;const Tt=P.getProjection().createInversionMatrix(this.transform,b.tileID.canonical);if(pt){const Ut=Nc(tt,b.tileID.canonical,pt,xt,this.transform,P.getProjection(),bt);Mt=a.aB([],this.transform.labelPlaneMatrix,Ut)}let Lt=null;vt&&b.latestFeatureIndex&&(Lt={unwrappedTileID:J,dynamicFilter:vt,dynamicFilterNeedsFeature:Et}),this.retainedQueryData[P.bucketInstanceId]=new qd(P.bucketInstanceId,O,P.sourceLayerIndex,P.index,b.tileID);const[qt,jt]=P.layers[0].layout.get("text-size-scale-range"),oe=a.aA(C,qt,jt),[te,he]=B.get("icon-size-scale-range"),Oe=a.aA(C,te,he),Jt={bucket:P,layout:B,paint:G,posMatrix:tt,invMatrix:Tt,mercatorCenter:[a.aF(this.transform.center.lng),a.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Pt,labelToScreenMatrix:Mt,clippingData:Lt,scale:Y,textPixelRatio:W,holdingForFade:b.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:a.bJ(P.textSizeData,this.transform.zoom,oe),partiallyEvaluatedIconSize:a.bJ(P.iconSizeData,this.transform.zoom,Oe),collisionGroup:this.collisionGroups.get(P.sourceID),latestFeatureIndex:b.latestFeatureIndex};if(A)for(const Ut of P.sortKeyRanges){const{sortKey:de,symbolInstanceStart:ee,symbolInstanceEnd:Ae}=Ut;c.push({sortKey:de,symbolInstanceStart:ee,symbolInstanceEnd:Ae,parameters:Jt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:Jt})}attemptAnchorPlacement(c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st,pt,xt,vt,Et){const{textOffset0:bt,textOffset1:Pt,crossTileID:Mt}=nt,Tt=[bt,Pt],Lt=lg(c,P,O,Tt,B),qt=this.collisionIndex.placeCollisionBox(st,B,p,b,A,C,Lh(Lt.x,Lt.y,G,j,this.transform.angle),tt,Y,W,J.predicate);if(xt){const jt=st.getSymbolInstanceIconSize(Et,this.transform.zoom,nt.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(st,jt,xt,b,A,C,Lh(Lt.x,Lt.y,G,j,this.transform.angle),tt,Y,W,J.predicate).box.length===0)return}if(qt.box.length>0){let jt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Mt]&&this.prevPlacement.placements[Mt]&&this.prevPlacement.placements[Mt].text&&(jt=this.prevPlacement.variableOffsets[Mt].anchor),this.variableOffsets[Mt]={textOffset:Tt,width:P,height:O,anchor:c,textScale:B,prevAnchor:jt},this.markUsedJustification(st,c,nt,pt),st.allowVerticalPlacement&&(this.markUsedOrientation(st,pt,nt),this.placedOrientations[Mt]=pt),{shift:Lt,placedGlyphBoxes:qt}}}placeLayerBucketPart(c,p,b,A,C=1){const{bucket:P,layout:O,paint:B,posMatrix:G,textLabelPlaneMatrix:j,labelToScreenMatrix:Y,clippingData:W,textPixelRatio:J,mercatorCenter:tt,invMatrix:nt,holdingForFade:ut,collisionBoxArray:st,partiallyEvaluatedTextSize:pt,partiallyEvaluatedIconSize:xt,collisionGroup:vt,latestFeatureIndex:Et}=c.parameters,bt=O.get("text-optional"),Pt=O.get("icon-optional"),Mt=O.get("text-allow-overlap"),Tt=O.get("icon-allow-overlap"),Lt=O.get("text-rotation-alignment")==="map",qt=O.get("icon-rotation-alignment")==="map",jt=O.get("text-pitch-alignment")==="map",oe=B.get("symbol-z-offset"),te=O.get("symbol-elevation-reference")==="sea",he=O.get("symbol-placement"),[Oe,Jt]=O.get("text-size-scale-range"),[Ut,de]=O.get("icon-size-scale-range"),ee=a.aA(C,Oe,Jt),Ae=a.aA(C,Ut,de),Ue=O.get("text-variable-anchor"),ci=Lt&&he!=="point",Le=qt&&he!=="point",Be=Ue&&P.hasTextData(),hi=P.hasIconTextFit()&&Be&&P.hasIconData();this.transform.setProjection(P.projection);const ni=Be||ci,ii=Le||hi;let ai=Mt&&(Tt||!P.hasIconData()||Pt),Ei=Tt&&(Mt||!P.hasTextData()||bt);const mr=!oe.isConstant();!P.collisionArrays&&st&&P.deserializeCollisionBoxes(st),b&&A&&P.updateCollisionDebugBuffers(this.transform.zoom,st,ee,Ae);const Ir=(Vi,Tr,ir)=>{const{crossTileID:Qr,numVerticalGlyphVertices:Mr}=Vi;let pn=null;if(W&&W.dynamicFilterNeedsFeature||mr){const Wn=this.retainedQueryData[P.bucketInstanceId];pn=Et.loadFeature({featureIndex:Vi.featureIndex,bucketIndex:Wn.bucketIndex,sourceLayerIndex:Wn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(W&&!(0,W.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:P.worldview},pn,this.retainedQueryData[P.bucketInstanceId].tileID.canonical,new a.P(Vi.tileAnchorX,Vi.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[Qr]=new $r(!1,!1,!1,!0),void p.add(Qr);const Or=oe.evaluate(pn,{});if(p.has(Qr))return;if(ut)return void(this.placements[Qr]=new $r(!1,!1,!1));let ar=!1,Gr=!1,cr=!0,wn=!1,Zr=!1,Hi=null,Dr={box:null,offscreen:null,occluded:null},zn={box:null},ia=null,Un=null,Kn=null,ds=0,Jo=0,fo=0;ir.textFeatureIndex?ds=ir.textFeatureIndex:Vi.useRuntimeCollisionCircles&&(ds=Vi.featureIndex),ir.verticalTextFeatureIndex&&(Jo=ir.verticalTextFeatureIndex);const Io=P.elevationFeatures?P.elevationFeatures[Vi.elevationFeatureIndex]:void 0,Xs=Wn=>{Wn.tileID=this.retainedQueryData[P.bucketInstanceId].tileID;const ra=this.transform.elevation;Wn.elevation=te?Or:Or+a.bU.getAtTileOffset(Wn.tileID,new a.P(Wn.tileAnchorX,Wn.tileAnchorY),ra,Io),Wn.elevation+=Vi.zOffset},po=ir.textBox;if(po){Xs(po);const Wn=hn=>{let sa=a.bK.horizontal;if(P.allowVerticalPlacement&&!hn&&this.prevPlacement){const Xa=this.prevPlacement.placedOrientations[Qr];Xa&&(this.placedOrientations[Qr]=Xa,sa=Xa,this.markUsedOrientation(P,sa,Vi))}return sa},ra=(hn,sa)=>{if(P.allowVerticalPlacement&&Mr>0&&ir.verticalTextBox){for(const Xa of P.writingModes)if(Xa===a.bK.vertical?(Dr=sa(),zn=Dr):Dr=hn(),Dr&&Dr.box&&Dr.box.length)break}else Dr=hn()};if(Ue){let hn=Ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qr]){const $n=this.prevPlacement.variableOffsets[Qr];hn.indexOf($n.anchor)>0&&(hn=hn.filter(Ks=>Ks!==$n.anchor),hn.unshift($n.anchor))}const sa=($n,Ks,If)=>{const Yc=P.getSymbolInstanceTextSize(pt,Vi,this.transform.zoom,Tr),Mf=($n.x2-$n.x1)*Yc+2*$n.padding,Cf=($n.y2-$n.y1)*Yc+2*$n.padding,Js=Vi.hasIconTextFit&&!Tt?Ks:null;Js&&Xs(Js);let fc={box:[],offscreen:!1,occluded:!1};const ja=Mt?2*hn.length:hn.length;for(let Qs=0;Qs<ja;++Qs){const $h=this.attemptAnchorPlacement(hn[Qs%hn.length],$n,tt,nt,ni,Mf,Cf,Yc,Lt,jt,J,G,vt,Qs>=hn.length,Vi,Tr,P,If,Js,pt,xt);if($h&&(fc=$h.placedGlyphBoxes,fc&&fc.box&&fc.box.length)){ar=!0,Hi=$h.shift;break}}return fc};ra(()=>sa(po,ir.iconBox,a.bK.horizontal),()=>{const $n=ir.verticalTextBox;return $n&&Xs($n),P.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&Mr>0&&$n?sa($n,ir.verticalIconBox,a.bK.vertical):{box:null,offscreen:null,occluded:null}}),Dr&&(ar=Dr.box,cr=Dr.offscreen,wn=Dr.occluded);const Xa=Wn(!(!Dr||!Dr.box));if(!ar&&this.prevPlacement){const $n=this.prevPlacement.variableOffsets[Qr];$n&&(this.variableOffsets[Qr]=$n,this.markUsedJustification(P,$n.anchor,Vi,Xa))}}else{const hn=(sa,Xa)=>{const $n=P.getSymbolInstanceTextSize(pt,Vi,this.transform.zoom,Tr),Ks=this.collisionIndex.placeCollisionBox(P,$n,sa,tt,nt,ni,new a.P(0,0),Mt,J,G,vt.predicate);return Ks&&Ks.box&&Ks.box.length&&(this.markUsedOrientation(P,Xa,Vi),this.placedOrientations[Qr]=Xa),Ks};ra(()=>hn(po,a.bK.horizontal),()=>{const sa=ir.verticalTextBox;return P.allowVerticalPlacement&&Mr>0&&sa?(Xs(sa),hn(sa,a.bK.vertical)):{box:null,offscreen:null,occluded:null}}),Wn(!!(Dr&&Dr.box&&Dr.box.length))}}if(ia=Dr,ar=ia&&ia.box&&ia.box.length>0,cr=ia&&ia.offscreen,wn=ia&&ia.occluded,Vi.useRuntimeCollisionCircles){const Wn=Vi.centerJustifiedTextSymbolIndex>=0?Vi.centerJustifiedTextSymbolIndex:Vi.verticalPlacedTextSymbolIndex,ra=P.text.placedSymbolArray.get(Wn),hn=a.bL(P.textSizeData,pt,ra),sa=O.get("text-padding");Un=this.collisionIndex.placeCollisionCircles(P,Mt,ra,Wn,P.lineVertexArray,P.glyphOffsetArray,hn,G,j,Y,b,jt,vt.predicate,Vi.collisionCircleDiameter*hn/a.bX,sa,this.retainedQueryData[P.bucketInstanceId].tileID),ar=Mt||Un.circles.length>0&&!Un.collisionDetected,cr=cr&&Un.offscreen,wn=Un.occluded}if(ir.iconFeatureIndex&&(fo=ir.iconFeatureIndex),ir.iconBox){const Wn=ra=>{Xs(ra);const hn=Vi.hasIconTextFit&&Hi?Lh(Hi.x,Hi.y,Lt,jt,this.transform.angle):new a.P(0,0),sa=P.getSymbolInstanceIconSize(xt,this.transform.zoom,Vi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(P,sa,ra,tt,nt,ii,hn,Tt,J,G,vt.predicate)};zn&&zn.box&&zn.box.length&&ir.verticalIconBox?(Kn=Wn(ir.verticalIconBox),Gr=Kn.box.length>0):(Kn=Wn(ir.iconBox),Gr=Kn.box.length>0),cr=cr&&Kn.offscreen,Zr=Kn.occluded}const Ys=bt||Vi.numHorizontalGlyphVertices===0&&Mr===0,Ml=Pt||Vi.numIconVertices===0;if(Ys||Ml?Ml?Ys||(Gr=Gr&&ar):ar=Gr&&ar:Gr=ar=Gr&&ar,ar&&ia&&ia.box&&this.collisionIndex.insertCollisionBox(ia.box,O.get("text-ignore-placement"),P.bucketInstanceId,zn&&zn.box&&Jo?Jo:ds,vt.ID),Gr&&Kn&&this.collisionIndex.insertCollisionBox(Kn.box,O.get("icon-ignore-placement"),P.bucketInstanceId,fo,vt.ID),Un&&(ar&&this.collisionIndex.insertCollisionCircles(Un.circles,O.get("text-ignore-placement"),P.bucketInstanceId,ds,vt.ID),b)){const Wn=P.bucketInstanceId;let ra=this.collisionCircleArrays[Wn];ra===void 0&&(ra=this.collisionCircleArrays[Wn]=new Ss);for(let hn=0;hn<Un.circles.length;hn+=4)ra.circles.push(Un.circles[hn+0]),ra.circles.push(Un.circles[hn+1]),ra.circles.push(Un.circles[hn+2]),ra.circles.push(Un.collisionDetected?1:0)}const qa=P.projection.name!=="globe";ai=ai&&(qa||!wn),Ei=Ei&&(qa||!Zr),this.placements[Qr]=new $r(ar||ai,Gr||Ei,cr||P.justReloaded),p.add(Qr)},an=this.retainedQueryData[P.bucketInstanceId].tileID;if(P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,an),P.elevationType==="road"&&P.updateRoadElevation(an.canonical),P.updateZOffset(),P.sortFeaturesByY){const Vi=P.getSortedSymbolIndexes(this.transform.angle);for(let Tr=Vi.length-1;Tr>=0;--Tr){const ir=Vi[Tr];Ir(P.symbolInstances.get(ir),ir,P.collisionArrays[ir])}P.hasAnyZOffset&&a.w(`${P.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(P.hasAnyZOffset){const Vi=P.getSortedIndexesByZOffset();for(let Tr=0;Tr<Vi.length;++Tr){const ir=Vi[Tr];Ir(P.symbolInstances.get(ir),ir,P.collisionArrays[ir])}}else for(let Vi=c.symbolInstanceStart;Vi<c.symbolInstanceEnd;Vi++)Ir(P.symbolInstances.get(Vi),Vi,P.collisionArrays[Vi]);if(b&&P.bucketInstanceId in this.collisionCircleArrays){const Vi=this.collisionCircleArrays[P.bucketInstanceId];a.bk(Vi.invProjMatrix,G),Vi.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1}markUsedJustification(c,p,b,A){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:B,crossTileID:G}=b,j=a.c2(p),Y=A===a.bK.vertical?B:j==="left"?C:j==="center"?P:j==="right"?O:-1;C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=Y>=0&&C!==Y?0:G),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=Y>=0&&P!==Y?0:G),O>=0&&(c.text.placedSymbolArray.get(O).crossTileID=Y>=0&&O!==Y?0:G),B>=0&&(c.text.placedSymbolArray.get(B).crossTileID=Y>=0&&B!==Y?0:G)}markUsedOrientation(c,p,b){const A=p===a.bK.horizontal||p===a.bK.horizontalOnly?p:0,C=p===a.bK.vertical?p:0,{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:G}=b,j=c.text.placedSymbolArray;P>=0&&(j.get(P).placedOrientation=A),O>=0&&(j.get(O).placedOrientation=A),B>=0&&(j.get(B).placedOrientation=A),G>=0&&(j.get(G).placedOrientation=C)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let b=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const A=p?p.symbolFadeChange(c):1,C=p?p.opacities:{},P=p?p.variableOffsets:{},O=p?p.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],j=C[B];j?(this.opacities[B]=new kr(j,A,G.text,G.icon,null,G.clipped),b=b||G.text!==j.text.placed||G.icon!==j.icon.placed):(this.opacities[B]=new kr(null,A,G.text,G.icon,G.skipFade,G.clipped),b=b||G.text||G.icon)}for(const B in C){const G=C[B];if(!this.opacities[B]){const j=new kr(G,A,!1,!1);j.isHidden()||(this.opacities[B]=j,b=b||G.text.placed||G.icon.placed)}}for(const B in P)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=P[B]);for(const B in O)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=O[B]);b?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)}updateLayerOpacities(c,p,b,A){const C=new Set;for(const P of p){const O=P.getBucket(c);O&&P.latestFeatureIndex&&c.fqid===O.layerIds[0]&&(this.updateBucketOpacities(O,C,P,P.collisionBoxArray,b,A,P.tileID,c.scope),O.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(O,P.tileID),O.elevationType==="road"&&O.updateRoadElevation(P.tileID.canonical),O.updateZOffset())}}updateBucketOpacities(c,p,b,A,C,P,O,B){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const G=c.layers[0].layout,j=c.layers[0].paint,Y=!!c.layers[0].dynamicFilter(),W=new kr(null,0,!1,!1,!0),J=G.get("text-allow-overlap"),tt=G.get("icon-allow-overlap"),nt=G.get("text-variable-anchor"),ut=G.get("text-rotation-alignment")==="map",st=G.get("text-pitch-alignment")==="map",pt=j.get("symbol-z-offset"),xt=G.get("symbol-elevation-reference")==="sea",vt=!pt.isConstant(),Et=new kr(null,0,J&&(tt||!c.hasIconData()||G.get("icon-optional")),tt&&(J||!c.hasTextData()||G.get("text-optional")),!0);!c.collisionArrays&&A&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(A);const bt=(Mt,Tt,Lt)=>{for(let qt=0;qt<Tt/4;qt++)Mt.opacityVertexArray.emplaceBack(Lt)};let Pt=0;P&&c.updateReplacement(O,P);for(let Mt=0;Mt<c.symbolInstances.length;Mt++){const Tt=c.symbolInstances.get(Mt),{numHorizontalGlyphVertices:Lt,numVerticalGlyphVertices:qt,crossTileID:jt,numIconVertices:oe,tileAnchorX:te,tileAnchorY:he}=Tt;let Oe=null;const Jt=this.retainedQueryData[c.bucketInstanceId];vt&&Tt&&Jt&&(Oe=b.latestFeatureIndex.loadFeature({featureIndex:Tt.featureIndex,bucketIndex:Jt.bucketIndex,sourceLayerIndex:Jt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ut=pt.evaluate(Oe,{}),de=p.has(jt);let ee=this.opacities[jt];de?ee=W:ee||(ee=Et,this.opacities[jt]=ee),p.add(jt);const Ae=Lt>0||qt>0,Ue=oe>0,ci=this.placedOrientations[jt],Le=ci===a.bK.vertical,Be=ci===a.bK.horizontal||ci===a.bK.horizontalOnly;!Ae&&!Ue||ee.isHidden()||Pt++;let hi=!1;if((Ae||Ue)&&P)for(const ni of c.activeReplacements){if(a.bY(ni,C,a.bZ.Symbol,B)||ni.min.x>te||te>ni.max.x||ni.min.y>he||he>ni.max.y)continue;const ii=a.b_(te,he,O.canonical,ni.footprintTileId.canonical);if(hi=a.b$(ii,ni.footprint),hi)break}if(Ae){const ni=hi?Za:dg(ee.text);bt(c.text,Lt,Le?Za:ni),bt(c.text,qt,Be?Za:ni);const ii=ee.text.isHidden(),{leftJustifiedTextSymbolIndex:ai,centerJustifiedTextSymbolIndex:Ei,rightJustifiedTextSymbolIndex:mr,verticalPlacedTextSymbolIndex:Ir}=Tt,an=c.text.placedSymbolArray,Vi=ii||Le?1:0;ai>=0&&(an.get(ai).hidden=Vi),Ei>=0&&(an.get(Ei).hidden=Vi),mr>=0&&(an.get(mr).hidden=Vi),Ir>=0&&(an.get(Ir).hidden=ii||Be?1:0);const Tr=this.variableOffsets[jt];Tr&&this.markUsedJustification(c,Tr.anchor,Tt,ci);const ir=this.placedOrientations[jt];ir&&(this.markUsedJustification(c,"left",Tt,ir),this.markUsedOrientation(c,ir,Tt))}if(Ue){const ni=hi?Za:dg(ee.icon),{placedIconSymbolIndex:ii,verticalPlacedIconSymbolIndex:ai}=Tt,Ei=c.icon.placedSymbolArray,mr=ee.icon.isHidden()?1:0;ii>=0&&(bt(c.icon,oe,Le?Za:ni),Ei.get(ii).hidden=mr),ai>=0&&(bt(c.icon,Tt.numVerticalIconVertices,Be?Za:ni),Ei.get(ai).hidden=mr)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const ni=c.collisionArrays[Mt];if(ni){let ii=new a.P(0,0),ai=!0;if(ni.textBox||ni.verticalTextBox){if(nt){const mr=this.variableOffsets[jt];mr?(ii=lg(mr.anchor,mr.width,mr.height,mr.textOffset,mr.textScale),ut&&ii._rotate(st?this.transform.angle:-this.transform.angle)):ai=!1}Y&&(ai=!ee.clipped),ni.textBox&&to(c.textCollisionBox.collisionVertexArray,ee.text.placed,!ai||Le,Ut,xt,ii.x,ii.y),ni.verticalTextBox&&to(c.textCollisionBox.collisionVertexArray,ee.text.placed,!ai||Be,Ut,xt,ii.x,ii.y)}const Ei=ai&&!!(!Be&&ni.verticalIconBox);ni.iconBox&&to(c.iconCollisionBox.collisionVertexArray,ee.icon.placed,Ei,Ut,xt,Tt.hasIconTextFit?ii.x:0,Tt.hasIconTextFit?ii.y:0),ni.verticalIconBox&&to(c.iconCollisionBox.collisionVertexArray,ee.icon.placed,!Ei,Ut,xt,Tt.hasIconTextFit?ii.x:0,Tt.hasIconTextFit?ii.y:0)}}}if(c.fullyClipped=Pt===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const Mt=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Mt.invProjMatrix,c.placementViewportMatrix=Mt.viewportMatrix,c.collisionCircleArray=Mt.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,p){const b=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*b>c}setStale(){this.stale=!0}}function to(x,c,p,b,A,C,P){x.emplaceBack(c?1:0,p?1:0,C||0,P||0,b,A?1:0),x.emplaceBack(c?1:0,p?1:0,C||0,P||0,b,A?1:0),x.emplaceBack(c?1:0,p?1:0,C||0,P||0,b,A?1:0),x.emplaceBack(c?1:0,p?1:0,C||0,P||0,b,A?1:0)}const Da=Math.pow(2,25),zE=Math.pow(2,24),ug=Math.pow(2,17),cx=Math.pow(2,16),hg=Math.pow(2,9),Nv=Math.pow(2,8),ux=Math.pow(2,1);function dg(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const c=x.placed?1:0,p=Math.floor(127*x.opacity);return p*Da+c*zE+p*ug+c*cx+p*hg+c*Nv+p*ux+c}const Za=0;class Uc{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,p,b,A,C,P){const O=this._bucketParts;for(;this._currentTileIndex<c.length;)if(p.getBucketParts(O,A,c[this._currentTileIndex],this._sortAcrossTiles,P),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((B,G)=>B.sortKey-G.sortKey));this._currentPartIndex<O.length;){const B=O[this._currentPartIndex];if(p.placeLayerBucketPart(B,this._seenCrossTileIDs,b,B.symbolInstanceStart===0,P),this._currentPartIndex++,C())return!0}return!1}}class cs{constructor(c,p,b,A,C,P,O,B,G){this.placement=new cg(c,C,P,O,B,G),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(c,p,b,A,C){const P=a.o.now(),O=()=>{const B=a.o.now()-P;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=p[c[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=G)&&(!B.maxzoom||B.maxzoom>G)){const j=B,Y=j.layout.get("symbol-z-elevate"),W=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,J=j.layout.get("symbol-z-order"),tt=J==="viewport-y"||J==="auto"&&!(J!=="viewport-y"&&W),nt=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),ut=tt&&nt,st=this._inProgressLayer=this._inProgressLayer||new Uc(j),pt=a.B(B.source,B.scope);if(st.continuePlacement(Y||ut?A[pt]:b[pt],this.placement,this._showCollisionBoxes,B,O,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Vv=512/a.al/2;class Xd{constructor(c,p,b){this.tileID=c,this.bucketInstanceId=b,this.index=new a.c3(p.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const A=c.canonical.x*a.al,C=c.canonical.y*a.al;for(let P=0;P<p.length;P++){const{key:O,crossTileID:B,tileAnchorX:G,tileAnchorY:j}=p.get(P),Y=Math.floor((A+G)*Vv),W=Math.floor((C+j)*Vv);this.index.add(Y,W),this.keys.push(O),this.crossTileIDs.push(B)}this.index.finish()}findMatches(c,p,b){const A=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),C=Vv/Math.pow(2,p.canonical.z-this.tileID.canonical.z),P=p.canonical.x*a.al,O=p.canonical.y*a.al;for(let B=0;B<c.length;B++){const G=c.get(B);if(G.crossTileID)continue;const{key:j,tileAnchorX:Y,tileAnchorY:W}=G,J=Math.floor((P+Y)*C),tt=Math.floor((O+W)*C),nt=this.index.range(J-A,tt-A,J+A,tt+A).sort((ut,st)=>ut-st);for(const ut of nt){const st=this.crossTileIDs[ut];if(this.keys[ut]===j&&!b.has(st)){b.add(st),G.crossTileID=st;break}}}}}class Ha{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class lc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const p=Math.round((c-this.lng)/360);if(p!==0)for(const b in this.indexes){const A=this.indexes[b],C={};for(const P in A){const O=A[P];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+p),C[O.tileID.key]=O}this.indexes[b]=C}this.lng=c}addBucket(c,p,b){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let C=0;C<p.symbolInstances.length;C++)p.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const A=this.usedCrossTileIDs[c.overscaledZ];for(const C in this.indexes){const P=this.indexes[C];if(Number(C)>c.overscaledZ)for(const O in P){const B=P[O];B.tileID.isChildOf(c)&&B.findMatches(p.symbolInstances,c,A)}else{const O=P[c.scaledTo(Number(C)).key];O&&O.findMatches(p.symbolInstances,c,A)}}for(let C=0;C<p.symbolInstances.length;C++){const P=p.symbolInstances.get(C);P.crossTileID||(P.crossTileID=b.generate(),A.add(P.crossTileID))}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Xd(c,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(c,p){for(const b of p.crossTileIDs)this.usedCrossTileIDs[c].delete(b)}removeStaleBuckets(c){let p=!1;for(const b in this.indexes){const A=this.indexes[b];for(const C in A)c[A[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,A[C]),delete A[C],p=!0)}return p}}class Gc{constructor(){this.layerIndexes={},this.crossTileIDs=new Ha,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,p,b,A){let C=this.layerIndexes[c.fqid];C===void 0&&(C=this.layerIndexes[c.fqid]=new lc);let P=!1;const O={};A.name!=="globe"&&C.handleWrapJump(b);for(const B of p){const G=B.getBucket(c);G&&c.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(B.tileID,G,this.crossTileIDs)&&(P=!0),O[G.bucketInstanceId]=!0)}return C.removeStaleBuckets(O)&&(P=!0),P}pruneUnusedLayers(c){const p={};c.forEach(b=>{p[b]=!0});for(const b in this.layerIndexes)p[b]||delete this.layerIndexes[b]}}const oa=771;class lr{constructor(c,p,b,A){this.blendFunction=c,this.blendColor=p.toNonPremultipliedRenderColor(null),this.mask=b,this.blendEquation=A}}lr.Replace=[1,0,1,0],lr.disabled=new lr(lr.Replace,a.ao.transparent,[!1,!1,!1,!1]),lr.unblended=new lr(lr.Replace,a.ao.transparent,[!0,!0,!0,!0]),lr.alphaBlended=new lr([1,oa,1,oa],a.ao.transparent,[!0,!0,!0,!0]),lr.alphaBlendedNonPremultiplied=new lr([770,oa,770,oa],a.ao.transparent,[!0,!0,!0,!0]),lr.multiply=new lr([774,0,774,0],a.ao.transparent,[!0,!0,!0,!0]),lr.additive=new lr([1,1,1,1],a.ao.transparent,[!0,!0,!0,!0]);class fi{constructor(c,p,b){this.func=c,this.mask=p,this.range=b}}fi.ReadOnly=!1,fi.ReadWrite=!0,fi.disabled=new fi(519,fi.ReadOnly,[0,1]);const Rh=7680;class $i{constructor(c,p,b,A,C,P){this.test=c,this.ref=p,this.mask=b,this.fail=A,this.depthFail=C,this.pass=P}}$i.disabled=new $i({func:519,mask:0},0,0,Rh,Rh,Rh);const Yd=1029,Uv=2305;class Ni{constructor(c,p,b){this.enable=c,this.mode=p,this.frontFace=b}}function fg(x,c){const p=a.c9(x,3);a.cb(x,c),a.cf(x,3,p)}function Gv(x,c){const p=a.c6([]);return a.c7(p,p,-c),a.c8(p,p,-x),p}function tT(x,c){const p=[x[0],x[1],0],b=[c[0],c[1],0];if(a.ag(p)>=1e-15){const P=a.aw([],p);a.c4(b,P,a.bI(b,P)),c[0]=b[0],c[1]=b[1]}const A=a.bH([],c,x);if(a.c5(A)<1e-15)return null;const C=Math.atan2(-A[1],A[0]);return Gv(Math.atan2(Math.sqrt(x[0]*x[0]+x[1]*x[1]),-x[2]),C)}Ni.disabled=new Ni(!1,Yd,Uv),Ni.backCCW=new Ni(!0,Yd,Uv),Ni.backCW=new Ni(!0,Yd,2304),Ni.frontCW=new Ni(!0,1028,2304),Ni.frontCCW=new Ni(!0,1028,Uv);class cc{constructor(c,p){this.position=c,this.orientation=p}get position(){return this._position}set position(c){if(c){const p=c instanceof a.ae?c:new a.ae(c[0],c[1],c[2]);this._renderWorldCopies&&(p.x=a.bS(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(c,p,b){if(this.orientation=null,!this.position)return;const A=this.position,C=b||(this._elevation?this._elevation.getAtPointOrZero(a.ae.fromLngLat(c)):0),P=a.ae.fromLngLat(c,C),O=[P.x-A.x,P.y-A.y,P.z-A.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=tT(O,p)}setPitchBearing(c,p){this.orientation=Gv(a.an(c),a.an(-p))}}class Hv{constructor(c,p){this._transform=a.bz([]),this.orientation=p,this.position=c}get mercatorPosition(){const c=this.position;return new a.ae(c[0],c[1],c[2])}get position(){const c=a.c9(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var p;c&&a.cf(this._transform,3,[(p=c)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||a.c6([]),c&&fg(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,p){this._orientation=Gv(c,p),fg(this._transform,this._orientation)}forward(){const c=a.c9(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=a.c9(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=a.c9(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,p){const b=new Float64Array(16);return a.bk(b,this.getWorldToCamera(c,p)),b}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(c,p,b){const A=this.position;a.c4(A,A,-c);const C=new Float64Array(16);return a.bp(C,[b,b,b]),a.bq(C,C,A),C[10]*=p,C}getWorldToCamera(c,p){const b=new Float64Array(16),A=new Float64Array(4),C=this.position;return a.ca(A,this._orientation),a.c4(C,C,-c),a.cb(b,A),a.bq(b,b,C),b[1]*=-1,b[5]*=-1,b[9]*=-1,b[13]*=-1,b[8]*=p,b[9]*=p,b[10]*=p,b[11]*=p,b}getCameraToClipPerspective(c,p,b,A){const C=new Float64Array(16);return a.cc(C,c,p,b,A),C}getCameraToClipOrthographic(c,p,b,A,C,P){const O=new Float64Array(16);return a.cd(O,c,p,b,A,C,P),O}getDistanceToElevation(c,p=!1){const b=c===0?0:a.ce(c,p?a.a_(this.position[1]):this.position[1]),A=this.forward();return(b-this.position[2])/A[2]}clone(){return new Hv([...this.position],[...this.orientation])}}const eo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Vo{constructor(c=0,p=0,b=0,A=0){if(isNaN(c)||c<0||isNaN(p)||p<0||isNaN(b)||b<0||isNaN(A)||A<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=b,this.right=A}interpolate(c,p,b){return p.top!=null&&c.top!=null&&(this.top=a.ak(c.top,p.top,b)),p.bottom!=null&&c.bottom!=null&&(this.bottom=a.ak(c.bottom,p.bottom,b)),p.left!=null&&c.left!=null&&(this.left=a.ak(c.left,p.left,b)),p.right!=null&&c.right!=null&&(this.right=a.ak(c.right,p.right,b)),this}getCenter(c,p){const b=a.aA((this.left+c-this.right)/2,0,c),A=a.aA((this.top+p-this.bottom)/2,0,p);return new a.P(b,A)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Vo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const kh=15;class Kd{constructor(c,p,b,A,C,P,O){this.tileSize=512,this._renderWorldCopies=C===void 0||C,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=b??0,this._maxPitch=A??60,this.setProjection(P),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new a.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Vo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Hv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const c=new Kd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c._allowWorldUnderZoom=this._allowWorldUnderZoom,c}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<kh}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(c,p=!1){const b=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||b)&&this._updateCameraOnTerrain(),(c||b)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return a.aH(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=a.cl(this.projectionOptions);const b=this.getProjection(),A=!a.bx(p,b);return A&&this._calcMatrices(),this.mercatorFromTransition=!1,A}setOrthographicProjectionAtLowPitch(c){return this._orthographicProjectionAtLowPitch!==c&&(this._orthographicProjectionAtLowPitch=c,this._calcMatrices(),!0)}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.cl({name:"mercator"});const p=c!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bS(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const p=-c*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=a.cm(),a.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const p=a.aA(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=a.an(c),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(c){this._tileCoverLift!==c&&(this._tileCoverLift=c)}_updateCameraOnTerrain(){const c=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,p=this.elevation&&c===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||c===Number.NEGATIVE_INFINITY&&(!p||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const b=this._elevation;p||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&b.exaggeration()&&this._centerAltitudeValidForExaggeration!==b.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*b.exaggeration(),this._centerAltitudeValidForExaggeration=b.exaggeration()):(this._centerAltitude=c||0,this._centerAltitudeValidForExaggeration=b.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const c=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(c)}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],b=this.horizonLineFromTop();let A=0,C=0;for(let P=0;P<p.length;P++){const O=new a.P(p[P][0]*this.width,b+p[P][1]*(this.height-b)),B=c.pointCoordinate(O);if(!B)continue;const G=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);A+=B[3]*G,C+=G}return C===0?NaN:A/C}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),b=this.pixelsPerMeter/this.worldSize*p,A=this._mercatorZfromZoom(c),C=this._mercatorZfromZoom(this._maxZoom),P=Math.max(A-b,C);this._setZoom(this._zoomFromMercatorZ(P))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let b;b=c.z<this._camera.position[2]?[p.x,p.y,p.z]:[c.x,c.y,c.z];const A=a.ag(a.av([],this._camera.position,b));return a.aA(this._zoomFromMercatorZ(A),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let p=!1;if(c.orientation&&!a.co(c.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(c.orientation)),c.position){const b=[c.position.x,c.position.y,c.position.z];a.cp(b,this._camera.position)||(this._setCameraPosition(b),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,p=new cc;return p.position=new a.ae(c[0],c[1],c[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(c){if(!a.cq(c))return!1;a.cr(c,c);const p=a.cs([],[0,0,-1],c),b=a.cs([],[0,-1,0],c);if(b[2]<0)return!1;const A=tT(p,b);return!!A&&(this._camera.orientation=A,!0)}_setCameraPosition(c){const p=this.zoomScale(this.minZoom)*this.tileSize,b=this.zoomScale(this.maxZoom)*this.tileSize,A=this.cameraToCenterDistance;c[2]=a.aA(c[2],A/b,A/p),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,p,b){this._unmodified=!1,this._edgeInsets.interpolate(c,p,b),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(c){const p=[new a.ct(0,c)];if(this.renderWorldCopies){const b=this.pointCoordinate(new a.P(0,0)),A=this.pointCoordinate(new a.P(this.width,0)),C=this.pointCoordinate(new a.P(this.width,this.height)),P=this.pointCoordinate(new a.P(0,this.height)),O=Math.floor(Math.min(b.x,A.x,C.x,P.x)),B=Math.floor(Math.max(b.x,A.x,C.x,P.x)),G=1;for(let j=O-G;j<=B+G;j++)j!==0&&p.push(new a.ct(j,c))}return p}isLODDisabled(c){return(!c||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(c,p,b){let A=[];const C=b!=null,P=!C;if(P&&this.zoom<p||C&&b[0]===0&&b[1]===0)return A;const O=new Set,B=(j,Y,W,J,tt)=>{const nt=a.cX(Y,j,W,J,tt);O.has(nt)||(A.push(new a.aP(j,Y,W,J,tt)),O.add(nt))};for(let j=0;j<c.length;j++){const Y=c[j];if(P&&Y.canonical.z!==p)continue;const W=Y.canonical,J=Y.overscaledZ,tt=Y.wrap,nt=1<<W.z,ut=W.x+1<nt,st=W.x>0,pt=W.y+1<nt,xt=W.y>0,vt=Y.wrap-(st?0:1),Et=Y.wrap+(ut?0:1),bt=st?W.x-1:nt-1,Pt=ut?W.x+1:0;if(C)b[0]<0?(B(J,Et,W.z,Pt,W.y),b[1]<0&&pt&&(B(J,tt,W.z,W.x,W.y+1),B(J,Et,W.z,Pt,W.y+1)),b[1]>0&&xt&&(B(J,tt,W.z,W.x,W.y-1),B(J,Et,W.z,Pt,W.y-1))):b[0]>0?(B(J,vt,W.z,bt,W.y),b[1]<0&&pt&&(B(J,tt,W.z,W.x,W.y+1),B(J,vt,W.z,bt,W.y+1)),b[1]>0&&xt&&(B(J,tt,W.z,W.x,W.y-1),B(J,vt,W.z,bt,W.y-1))):b[1]<0&&pt?B(J,tt,W.z,W.x,W.y+1):xt&&B(J,tt,W.z,W.x,W.y-1);else{const Mt=Y.visibleQuadrants;1&Mt&&(B(J,vt,W.z,bt,W.y),xt&&(B(J,tt,W.z,W.x,W.y-1),B(J,vt,W.z,bt,W.y-1))),2&Mt&&(B(J,Et,W.z,Pt,W.y),xt&&(B(J,tt,W.z,W.x,W.y-1),B(J,Et,W.z,Pt,W.y-1))),4&Mt&&(B(J,vt,W.z,bt,W.y),pt&&(B(J,tt,W.z,W.x,W.y+1),B(J,vt,W.z,bt,W.y+1))),8&Mt&&(B(J,Et,W.z,Pt,W.y),pt&&(B(J,tt,W.z,W.x,W.y+1),B(J,Et,W.z,Pt,W.y+1)))}}const G=[];for(const j of A)A.some(Y=>j.isChildOf(Y))||G.push(j);if(A=G.filter(j=>!c.some(Y=>!!(j.overscaledZ<p&&Y.isChildOf(j))||j.equals(Y)||j.isChildOf(Y))),P){const j=1<<p,Y=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[j*Y.x,j*Y.y],J=4,tt=J*J;A=A.filter(nt=>{const ut=nt.canonical.x+.5-W[0],st=nt.canonical.y+.5-W[1];return ut*ut+st*st<tt})}return A}extendTileCoverToNearPlane(c,p,b){const A=[],C=new Set;for(const pt of c)C.add(pt.key);const P=(pt,xt,vt,Et,bt)=>{const Pt=a.cX(xt,pt,vt,Et,bt);C.has(Pt)||(A.push(new a.aP(pt,xt,vt,Et,bt)),C.add(Pt))},O=c.reduce((pt,xt)=>Math.max(pt,xt.overscaledZ),b),B=1<<b,G=[new a.P(0,0),new a.P(a.al,0),new a.P(a.al,a.al),new a.P(0,a.al)],j=new a.P(0,0),Y=new a.P(0,0),W=(pt,xt)=>{const vt=Math.floor(pt[0]),Et=Math.floor(pt[1]),bt=(pt[0]-vt)*a.al,Pt=(pt[1]-Et)*a.al,Mt=Math.floor(xt[0]),Tt=Math.floor(xt[1]),Lt=(xt[0]-Mt)*a.al,qt=(xt[1]-Tt)*a.al;for(let jt=-1;jt<=1;jt++){const oe=vt+jt;if(!(oe<0||oe>=B)){j.x=bt-jt*a.al,Y.x=Lt-(oe-Mt)*a.al;for(let te=-1;te<=1;te++){const he=Et+te;j.y=Pt-te*a.al,Y.y=qt-(he-Tt)*a.al,a.cY(j,Y,G)&&P(O,0,b,oe,he)}}}},J=p.points,tt=J[a.cu],nt=J[a.cv],ut=this._projectToGround(tt,J[a.cw]),st=this._projectToGround(nt,J[a.cx]);return W(tt,ut),W(nt,st),A}_projectToGround(c,p){return a.cy(a.cz(),c,p,c[2]/(c[2]-p[2]))}coveringTiles(c){let p=this.coveringZoomLevel(c);const b=p,A=this.elevation&&this.elevation.exaggeration(),C=A&&!c.isTerrainDEM,P=this.projection.name==="mercator";if(c.minzoom!==void 0&&p<c.minzoom)return[];c.maxzoom!==void 0&&p>c.maxzoom&&(p=c.maxzoom);const O=this.locationCoordinate(this.center),B=this.center.lat,G=1<<p,j=[G*O.x,G*O.y,0],Y=this.projection.name==="globe",W=!Y,J=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,W),tt=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),nt=G*a.ce(1,this.center.lat),ut=this._camera.position[2]/a.ce(1,this.center.lat),st=[G*tt.x,G*tt.y,ut*(W?1:nt)],pt=Y||A,xt=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),vt=this.isLODDisabled(!0)?p:0;let Et;if(this._elevation&&c.isTerrainDEM)Et=1e4*this._elevation.exaggeration();else if(this._elevation){const Ut=this._elevation.getMinMaxForVisibleTiles();Et=Ut?Ut.max:this._centerAltitude}else Et=this._centerAltitude;const bt=c.isTerrainDEM?-Et:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pt=this.projection.isReprojectedInTileSpace?a.cB(this):1,Mt=Ut=>{const ee=new a.ae(Ut.x+25e-6,Ut.y,Ut.z),Ae=new a.ae(Ut.x,Ut.y+25e-6,Ut.z),Ue=Ut.toLngLat(),ci=ee.toLngLat(),Le=Ae.toLngLat(),Be=this.locationCoordinate(Ue),hi=this.locationCoordinate(ci),ni=this.locationCoordinate(Le),ii=Math.hypot(hi.x-Be.x,hi.y-Be.y),ai=Math.hypot(ni.x-Be.x,ni.y-Be.y);return Math.sqrt(ii*ai)*Pt/25e-6},Tt=Ut=>{const de=Et,ee=bt;return{aabb:a.cE(this,G,0,0,0,Ut,ee,de,this.projection),zoom:0,x:0,y:0,minZ:ee,maxZ:de,wrap:Ut,fullyVisible:!1}},Lt=[];let qt=[];const jt=p,oe=c.reparseOverscaled?b:p,te=(ut-this._centerAltitude)*nt,he=Ut=>{if(!this._elevation||!Ut.tileID||!P)return;const de=this._elevation.getMinMaxForTile(Ut.tileID),ee=Ut.aabb;de?(ee.min[2]=de.min,ee.max[2]=de.max,ee.center[2]=(ee.min[2]+ee.max[2])/2):(Ut.shouldSplit=Jt(Ut),Ut.shouldSplit||(ee.min[2]=ee.max[2]=ee.center[2]=this._centerAltitude))},Oe=(Ut,de)=>{if(.707*de<Ut)return 1;const ee=de/Ut;return ee/(1.4144271570014144+(Math.pow(1.1,ee-1.4144271570014144+1)-1)/(1.1-1)-1)},Jt=Ut=>{if(Ut.zoom<vt)return!0;if(Ut.zoom===jt)return!1;if(Ut.shouldSplit!=null)return Ut.shouldSplit;const de=Ut.aabb.distanceX(st),ee=Ut.aabb.distanceY(st);let Ae=te,Ue=1;if(Y){Ae=Ut.aabb.distanceZ(st);const ai=Math.pow(2,Ut.zoom),Ei=a.a_((Ut.y+1)/ai),mr=a.a_(Ut.y/ai),Ir=Math.min(Math.max(B,Ei),mr),an=a.d0(Ir)/a.d0(B);if(Ue=Ir===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,an/this._mercatorScaleRatio),this.zoom<=a.cZ&&Ut.zoom===jt-1&&an>=.9)return!0}else if(C&&(Ae=Ut.aabb.distanceZ(st)*nt),this.projection.isReprojectedInTileSpace&&b<=5){const ai=Math.pow(2,Ut.zoom),Ei=Mt(new a.ae((Ut.x+.5)/ai,(Ut.y+.5)/ai));Ue=Ei>.85?1:Ei}if(!P&&!Y){const ai=Math.sqrt(de*de+ee*ee+Ae*Ae);let Ei=(1<<jt-Ut.zoom)*xt*Ue;return Ei*=Oe(Math.max(Ae,te),ai),ai<Ei}let ci=Number.MAX_VALUE,Le=0;const Be=Ut.aabb.getCorners(),hi=[];for(const ai of Be){a.av(hi,ai,st),Y||(C?hi[2]*=nt:hi[2]=te);const Ei=a.bI(hi,this._camera.forward());Ei<ci&&(ci=Ei,Le=Math.abs(hi[2]))}let ni=(1<<jt-Ut.zoom)*xt*Ue;if(ni*=Oe(Math.max(Le,te),ci),ci<ni)return!0;const ii=Ut.aabb.closestPoint(j);return ii[0]===j[0]&&ii[1]===j[1]};if(this.renderWorldCopies)for(let Ut=1;Ut<=3;Ut++)Lt.push(Tt(-Ut)),Lt.push(Tt(Ut));for(Lt.push(Tt(0));Lt.length>0;){const Ut=Lt.pop(),de=Ut.x,ee=Ut.y;let Ae=Ut.fullyVisible;const Ue=()=>this.projection.name==="globe"&&(Ut.y===0||Ut.y===(1<<Ut.zoom)-1);if(!Ae){let ci=pt?Ut.aabb.intersects(J):Ut.aabb.intersectsFlat(J);if(ci===0&&Ue()){const Le=new a.cC(Ut.zoom,de,ee);ci=a.cD(this,G,Le,!0).intersects(J)}if(ci===0)continue;Ae=ci===2}if(Ut.zoom!==jt&&Jt(Ut))for(let ci=0;ci<4;ci++){const Le=(de<<1)+ci%2,Be=(ee<<1)+(ci>>1),hi={aabb:P?Ut.aabb.quadrant(ci):a.cE(this,G,Ut.zoom+1,Le,Be,Ut.wrap,Ut.minZ,Ut.maxZ,this.projection),zoom:Ut.zoom+1,x:Le,y:Be,wrap:Ut.wrap,fullyVisible:Ae,tileID:void 0,shouldSplit:void 0,minZ:Ut.minZ,maxZ:Ut.maxZ};C&&!Y&&(hi.tileID=new a.aP(Ut.zoom+1===jt?oe:Ut.zoom+1,Ut.wrap,Ut.zoom+1,Le,Be),he(hi)),Lt.push(hi)}else{const ci=Ut.zoom===jt?oe:Ut.zoom;if(c.minzoom&&c.minzoom>ci)continue;let Le=0;if(!Ae){let ii=pt?Ut.aabb.intersectsPrecise(J):Ut.aabb.intersectsPreciseFlat(J);if(ii===0&&Ue()){const ai=new a.cC(Ut.zoom,de,ee);ii=a.cD(this,G,ai,!0).intersectsPrecise(J)}if(ii===0)continue;if(c.calculateQuadrantVisibility)if(J.containsPoint(Ut.aabb.center))Le=15;else for(let ai=0;ai<4;ai++)Ut.aabb.quadrant(ai).intersects(J)!==0&&(Le|=1<<ai)}const Be=j[0]-(.5+de+(Ut.wrap<<Ut.zoom))*(1<<p-Ut.zoom),hi=j[1]-.5-ee,ni=Ut.tileID?Ut.tileID:new a.aP(ci,Ut.wrap,Ut.zoom,de,ee);c.calculateQuadrantVisibility&&(ni.visibleQuadrants=Le),qt.push({tileID:ni,distanceSq:Be*Be+hi*hi})}}if(this.fogCullDistSq){const Ut=this.fogCullDistSq,de=this.horizonLineFromTop();qt=qt.filter(ee=>{const Ae=[0,0,0,1],Ue=[a.al,a.al,0,1],ci=this.calculateFogTileMatrix(ee.tileID.toUnwrapped());a.aC(Ae,Ae,ci),a.aC(Ue,Ue,ci);const Le=a.cF([],Ae,Ue),Be=a.cG([],Ae,Ue),hi=a.c_(Le,Be);if(hi===0)return!0;let ni=!1;const ii=this._elevation;if(ii&&hi>Ut&&de!==0){const ai=this.calculateProjMatrix(ee.tileID.toUnwrapped());let Ei;c.isTerrainDEM||(Ei=ii.getMinMaxForTile(ee.tileID)),Ei||(Ei={min:bt,max:Et});const mr=a.cH(this.rotation),Ir=[mr[0]*a.al,mr[1]*a.al,Ei.max];a.af(Ir,Ir,ai),ni=(1-Ir[1])*this.height*.5<de}return hi<Ut||ni})}return qt.sort((Ut,de)=>Ut.distanceSq-de.distanceSq).map(Ut=>Ut.tileID)}resize(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log2(c)}project(c){const p=a.aA(c.lat,-a.cI,a.cI),b=this.projection.project(c.lng,p);return new a.P(b.x*this.worldSize,b.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,p){let b,A;const C=this.centerPoint;if(this.projection.name==="globe"){const O=this.worldSize;b=(p.x-C.x)/O,A=(p.y-C.y)/O}else{const O=this.pointCoordinate(p),B=this.pointCoordinate(C);b=O.x-B.x,A=O.y-B.y}const P=this.locationCoordinate(c);this.setLocation(new a.ae(P.x-b,P.y-A))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c,p){return this.projection.locationPoint(this,c,p)}locationPoint3D(c,p){return this.projection.locationPoint(this,c,p,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c,p){return this.coordinateLocation(this.pointCoordinate3D(c,p))}locationCoordinate(c,p){const b=p?a.ce(p,c.lat):void 0,A=this.projection.project(c.lng,c.lat);return new a.ae(A.x,A.y,b)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,p){const b=p??this._centerAltitude,A=[c.x,c.y,0,1],C=[c.x,c.y,1,1];a.aC(A,A,this.pixelMatrixInverse),a.aC(C,C,this.pixelMatrixInverse);const P=C[3];a.cJ(A,A,1/A[3]),a.cJ(C,C,1/P);const O=A[2],B=C[2];return{p0:A,p1:C,t:O===B?0:(b-O)/(B-O)}}screenPointToMercatorRay(c){const p=[c.x,c.y,0,1],b=[c.x,c.y,1,1];return a.aC(p,p,this.pixelMatrixInverse),a.aC(b,b,this.pixelMatrixInverse),a.cJ(p,p,1/p[3]),a.cJ(b,b,1/b[3]),p[2]=a.ce(p[2],this._center.lat)*this.worldSize,b[2]=a.ce(b[2],this._center.lat)*this.worldSize,a.cJ(p,p,1/this.worldSize),a.cJ(b,b,1/this.worldSize),new a.ax([p[0],p[1],p[2]],a.aw([],a.av([],b,p)))}rayIntersectionCoordinate(c){const{p0:p,p1:b,t:A}=c,C=a.ce(p[2],this._center.lat),P=a.ce(b[2],this._center.lat);return new a.ae(a.ak(p[0],b[0],A)/this.worldSize,a.ak(p[1],b[1],A)/this.worldSize,a.ak(C,P,A))}pointCoordinate(c,p=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,p)}pointCoordinate3D(c,p){if(!this.elevation)return this.pointCoordinate(c,p);let b=this.projection.pointCoordinate3D(this,c.x,c.y);if(b)return new a.ae(b[0],b[1],b[2]);let A=0,C=this.horizonLineFromTop();if(c.y>C)return this.pointCoordinate(c,p);const P=.02*C,O=c.clone();for(let B=0;B<10&&C-A>P;B++){O.y=a.ak(A,C,.66);const G=this.projection.pointCoordinate3D(this,O.x,O.y);G?(C=O.y,b=G):A=O.y}return b?new a.ae(b[0],b[1],b[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=a.cK)return!this.isPointAboveHorizon(c);const p=this.pointCoordinate(c);return p.y>=0&&p.y<=1}_coordinatePoint(c,p){const b=p&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,A=[c.x*this.worldSize,c.y*this.worldSize,b+c.toAltitude(),1];return a.aC(A,A,this.pixelMatrix),A[3]>0?new a.P(A[0]/A[3],A[1]/A[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:p}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,C=this.pointLocation3D(new a.P(p,c)),P=this.pointLocation3D(new a.P(A,c)),O=this.pointLocation3D(new a.P(A,b)),B=this.pointLocation3D(new a.P(p,b));let G=Math.min(C.lng,P.lng,O.lng,B.lng),j=Math.max(C.lng,P.lng,O.lng,B.lng),Y=Math.min(C.lat,P.lat,O.lat,B.lat),W=Math.max(C.lat,P.lat,O.lat,B.lat);const J=Math.pow(2,-this.zoom)/16*270,tt=this.projection.name==="globe"?1:4,nt=(ut,st,pt,xt,vt)=>{const Et=(ut+pt)/2,bt=(st+xt)/2,Pt=new a.P(Et,bt),{lng:Mt,lat:Tt}=this.pointLocation3D(Pt),Lt=Math.max(0,G-Mt,Y-Tt,Mt-j,Tt-W);G=Math.min(G,Mt),j=Math.max(j,Mt),Y=Math.min(Y,Tt),W=Math.max(W,Tt),(vt<tt||Lt>J)&&(nt(ut,st,Et,bt,vt+1),nt(Et,bt,pt,xt,vt+1))};if(nt(p,c,A,c,1),nt(A,c,A,b,1),nt(A,b,p,b,1),nt(p,b,p,c,1),this.projection.name==="globe"){const[ut,st]=a.cL(this);ut?(W=90,j=180,G=-180):st&&(Y=-90,j=180,G=-180)}return new a.aI(new a.aS(G,Y),new a.aS(j,W))}_getBoundsRectangular(c,p){const{top:b,left:A}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,P=this.width-this._edgeInsets.right,O=new a.P(A,b),B=new a.P(P,b),G=new a.P(P,C),j=new a.P(A,C);let Y=this.pointCoordinate(O,c),W=this.pointCoordinate(B,c);const J=this.pointCoordinate(G,p),tt=this.pointCoordinate(j,p),nt=(ut,st)=>(st.y-ut.y)/(st.x-ut.x);return Y.y>1&&W.y>=0?Y=new a.ae((1-tt.y)/nt(tt,Y)+tt.x,1):Y.y<0&&W.y<=1&&(Y=new a.ae(-tt.y/nt(tt,Y)+tt.x,0)),W.y>1&&Y.y>=0?W=new a.ae((1-J.y)/nt(J,W)+J.x,1):W.y<0&&Y.y<=1&&(W=new a.ae(-J.y/nt(J,W)+J.x,0)),new a.aI().extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(tt)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const p=c.visibleDemTiles.reduce((b,A)=>{if(A.dem){const C=A.dem.tree;b.min=Math.min(b.min,C.minimums[0]),b.max=Math.max(b.max,C.maximums[0])}return b},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(p.min*c.exaggeration(),p.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,b=this.height/2-p*(1-this._horizonShift);return c?Math.max(0,b):b}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-a.cI,this.maxLat=a.cI,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aF(this.minLng)*this.tileSize,this.worldMaxX=a.aF(this.maxLng)*this.tileSize,this.worldMinY=a.aJ(this.maxLat)*this.tileSize,this.worldMaxY=a.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,p){return this.projection.createTileMatrix(this,p,c)}calculateDistanceTileData(c){const p=c.key,b=this._distanceTileDataCache;if(b[p])return b[p];const A=c.canonical,C=1/this.height,P=this.cameraWorldSize,O=P/this.zoomScale(A.z),B=(A.x+Math.pow(2,A.z)*c.wrap)*O,G=A.y*O,j=this.point;j.x*=P/this.worldSize,j.y*=P/this.worldSize;const Y=this.angle,W=Math.sin(-Y),J=-Math.cos(-Y);return b[p]={bearing:[W,J],center:[(j.x-B)*C,(j.y-G)*C],scale:O/a.al*C},b[p]}calculateFogTileMatrix(c){const p=c.key,b=this._fogTileMatrixCache;if(b[p])return b[p];const A=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return a.aB(A,this.worldToFogMatrix,A),b[p]=new Float32Array(A),b[p]}calculateProjMatrix(c,p=!1,b=!1){const A=c.key;let C;if(C=b?this._expandedProjMatrixCache:p?this._alignedProjMatrixCache:this._projMatrixCache,C[A])return C[A];const P=this.calculatePosMatrix(c,this.worldSize);let O;return O=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:b?this.expandedFarZProjMatrix:p?this.alignedProjMatrix:this.projMatrix,a.aB(P,O,P),C[A]=new Float32Array(P),C[A]}calculatePixelsToTileUnitsMatrix(c){const p=c.tileID.key,b=this._pixelsToTileUnitsCache;if(b[p])return b[p];const A=a.cM(c,this);return b[p]=A,b[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const c=1/this.worldSize,p=a.bp([],[c,c,c]);return a.aB(p,p,this.globeMatrix),p}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const p=a.ce(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(p),A=this._camera.forward(),C=a.ce(1,this._center.lat);b[2]/=C,A[2]/=C,a.aw(A,A);const P=c.raycast(b,A,c.exaggeration());if(P){const O=a.bG([],b,A,P),B=new a.ae(O[0],O[1],a.ce(O[2],a.a_(O[1]))),G=(B.z+a.ag([B.x-b[0],B.y-b[1],B.z-b[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const p=this._elevation,b=a.ce(1,this._center.lat)*this.worldSize,A=this._computeCameraPosition(b),C=p.getAtPointOrZero(new a.ae(...A)),P=this.pixelsPerMeter/this.worldSize*C,O=this._minimumHeightOverTerrain(),B=A[2]-P;if(B<=O)if(B<0||c){const G=this.locationCoordinate(this._center,this._centerAltitude),j=[A[0],A[1],G.z-A[2]],Y=a.ag(j);j[2]-=(O-B)/this._pixelsPerMercatorPixel;const W=a.ag(j);if(W===0)return;a.c4(j,j,Y/W*this._pixelsPerMercatorPixel),this._camera.position=[A[0],A[1],G.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const W=this.center;return W.lat=a.aA(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(W.lng=a.aA(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const p=this._unmodified,{x:b,y:A}=this.point;let C=0,P=b,O=A;const B=this.width/2,G=this.height/2,j=this.worldMinY*this.scale,Y=this.worldMaxY*this.scale;if(A-G<j&&(O=j+G),A+G>Y&&(O=Y-G),Y-j<this.height&&(C=Math.max(C,this.height/(Y-j)),O=(Y+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,tt=this.worldSize/2-(W+J)/2;P=(b+tt+this.worldSize)%this.worldSize-tt,P-B<W&&(P=W+B),P+B>J&&(P=J-B),J-W<this.width&&(C=Math.max(C,this.width/(J-W)),P=(J+W)/2)}P===b&&O===A||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(P,O))),C&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,p=this.projection.name==="globe",b=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ce(1,this.center.lat)/a.ce(1,a.d1));const A=a.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,A),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C=this.projection.zAxisUnit==="meters"?b:1,P=this._camera.getWorldToCamera(this.worldSize,C);let O;const B=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(B[8]=2*-c.x/this.width,B[9]=2*c.y/this.height,this.isOrthographic){let Tt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Lt=Tt*this.aspect,qt=-Lt,jt=-Tt;Lt-=c.x,qt-=c.x,Tt+=c.y,jt+=c.y,O=this._camera.getCameraToClipOrthographic(qt,Lt,jt,Tt,this._nearZ,this._farZ),((oe,te,he,Oe)=>{for(let Jt=0;Jt<16;Jt++)oe[Jt]=a.ak(te[Jt],he[Jt],Oe)})(O,O,B,a.c$(this.pitch>=kh?1:this.pitch/kh))}else O=B;const G=a.cO([],B,P);let j=a.cO([],O,P);if(this.projection.isReprojectedInTileSpace){const Tt=this.locationCoordinate(this.center),Lt=a.bz([]);a.bq(Lt,Lt,[Tt.x*this.worldSize,Tt.y*this.worldSize,0]),a.aB(Lt,Lt,a.cP(this)),a.bq(Lt,Lt,[-Tt.x*this.worldSize,-Tt.y*this.worldSize,0]),a.aB(j,j,Lt),a.aB(G,G,Lt),this.inverseAdjustmentMatrix=a.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cR([],j,[this.worldSize,this.worldSize,this.worldSize/C,1]),this.projMatrix=j,this.invProjMatrix=a.bk(new Float64Array(16),this.projMatrix),p){const Tt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Tt[8]=2*-c.x/this.width,Tt[9]=2*c.y/this.height,this.expandedFarZProjMatrix=a.cO([],Tt,P)}else this.expandedFarZProjMatrix=this.projMatrix;const Y=a.bk([],O);this.frustumCorners=a.cS.fromInvProjectionMatrix(Y,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!p);const W=new Float32Array(16);a.bz(W),a.cR(W,W,[1,-1,1]),a.cT(W,W,this._pitch),a.bA(W,W,this.angle);const J=a.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.by(J);const tt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-c.x/this.width,J[9]=2*(c.y+tt)/this.height,this.skyboxMatrix=a.aB(W,J,W);const nt=this.point,ut=nt.x,st=nt.y,pt=this.width%2/2,xt=this.height%2/2,vt=Math.cos(this.angle),Et=Math.sin(this.angle),bt=ut-Math.round(ut)+vt*pt+Et*xt,Pt=st-Math.round(st)+vt*xt+Et*pt,Mt=new Float64Array(j);if(a.bq(Mt,Mt,[bt>.5?bt-1:bt,Pt>.5?Pt-1:Pt,0]),this.alignedProjMatrix=Mt,j=a.bB(),a.cR(j,j,[this.width/2,-this.height/2,1]),a.bq(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=a.bB(),a.cR(j,j,[1,-1,1]),a.bq(j,j,[-1,-1,0]),a.cR(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=a.aB(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},j=a.bk(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cU(this);const Tt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.af(Tt,Tt,P),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,b=this._camera.position,A=1/this.height/this._pixelsPerMercatorPixel,C=[c,c,p];a.c4(C,C,A),a.c4(b,b,-1),a.cV(b,b,C);const P=a.bB();a.bq(P,P,b),a.cR(P,P,C),this.mercatorFogMatrix=P,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,p,A)}_computeCameraPosition(c){const p=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,b=this._camera.forward(),A=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-c/this.worldSize*this._centerAltitude;return[A.x/this.worldSize-b[0]*C,A.y/this.worldSize-b[1]*C,c/this.worldSize*this._centerAltitude-b[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),b=this._camera.position[2],A=c[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),A>0&&(C=Math.min((p-b)/A,1)),this._camera.position=a.bG([],this._camera.position,c,C),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,p=this._camera.forward(),{pitch:b,bearing:A}=this._camera.getPitchBearing(),C=a.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,P=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.an(this._maxPitch)),O=Math.max((c[2]-C)/Math.cos(b),P),B=this._zoomFromMercatorZ(O);a.bG(c,c,p,O),this._pitch=a.aA(b,a.an(this.minPitch),a.an(this.maxPitch)),this.angle=a.bS(A,-Math.PI,Math.PI),this._setZoom(a.aA(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ae(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,c)*this.tileSize))}zoomFromMercatorZAdjusted(c){let p=0,b=a.cK,A=0,C=1/0;for(;b-p>1e-6&&b>p;){const P=p+.5*(b-p),O=this.tileSize*Math.pow(2,P),B=this.getCameraToCenterDistance(this.projection,P,O),G=this.scaleZoom(B/(Math.max(0,c)*this.tileSize)),j=Math.abs(P-G);j<C&&(C=j,A=P),P<G?p=P:b=P}return A}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,p){const b=Math.min(c.x,p.x),A=Math.max(c.x,p.x),C=Math.min(c.y,p.y),P=Math.max(c.y,p.y);if(C<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const O=[new a.P(b,C),new a.P(A,P),new a.P(b,P),new a.P(A,C)],B=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const j of O){const Y=this.pointRayIntersection(j);if(Y.t<0)return!0;const W=this.rayIntersectionCoordinate(Y);if(W.x<B||W.y<0||W.x>G||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(c,p){const b=a.ag(a.av([],this._camera.position,c)),A=this._zoomFromMercatorZ(b)+p;return b-this._mercatorZfromZoom(A)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([p,b,A],C){const P=[p,b,A,1];a.aC(P,P,C);const O=P[3]=Math.max(P[3],1e-6);return P[0]/=O,P[1]/=O,P[2]/=O,P}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,c))}}getCameraToCenterDistance(c,p=this.zoom,b=this.worldSize){const A=a.cN(c,p,this.width,this.height,1024),C=c.pixelSpaceConversion(this.center.lat,b,A);let P=.5/Math.tan(.5*this._fov)*this.height*C;return this.isOrthographic&&(P=a.ak(1,P,a.c$(this.pitch>=kh?1:this.pitch/kh))),P}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.aB(c,c,this.globeMatrix),c}getFrustum(c){return a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,this.projection.zAxisUnit==="meters")}}const Hc=(x,c)=>{if(c>0&&x.terrain&&a.w("Cutoff is currently disabled on terrain"),c<=0||x.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const p=x.transform,b=Math.max(Math.abs(p._zoom-(x.minCutoffZoom-1)),1),A=p.isLODDisabled(!1)?a.ah(60,45,p.pitch):a.ah(30,15,p.pitch),C=p._farZ-p._nearZ,P=c*p.height,O=((1-(B=A))*p.cameraToCenterDistance+B*(p._farZ+P))*b;var B;return{shouldRenderCutoff:A<1,uniformValues:{u_cutoff_params:[p._nearZ,p._farZ,(O-p._nearZ)/C,(O-P-p._nearZ)/C]}}},io={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class BE{constructor(c,p){this.aabb=c,this.lastCascade=p}}class FE{add(c,p){const b=this.receivers[c.key];b!==void 0?(b.aabb.min[0]=Math.min(b.aabb.min[0],p.min[0]),b.aabb.min[1]=Math.min(b.aabb.min[1],p.min[1]),b.aabb.min[2]=Math.min(b.aabb.min[2],p.min[2]),b.aabb.max[0]=Math.max(b.aabb.max[0],p.max[0]),b.aabb.max[1]=Math.max(b.aabb.max[1],p.max[1]),b.aabb.max[2]=Math.max(b.aabb.max[2],p.max[2])):this.receivers[c.key]=new BE(p,null)}clear(){this.receivers={}}get(c){return this.receivers[c.key]}computeRequiredCascades(c,p,b){const A=a.d8.fromPoints(c.points);let C=0;for(const P in this.receivers){const O=this.receivers[P];if(!O||!A.intersectsAabb(O.aabb))continue;O.aabb.min=A.closestPoint(O.aabb.min),O.aabb.max=A.closestPoint(O.aabb.max);const B=O.aabb.getCorners();for(let G=0;G<b.length;G++){let j=!0;for(const Y of B){const W=[Y[0]*p,Y[1]*p,Y[2]];if(a.af(W,W,b[G].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){j=!1;break}}if(O.lastCascade=G,C=Math.max(C,G),j)break}}return C+1}}class pg{constructor(c){this.painter=c,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new FE,this._depthMode=new fi(c.context.gl.LEQUAL,fi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,c.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),c.tp.registerParameter(io,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),c.tp.registerParameter(io,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),c.tp.registerParameter(io,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),c.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const c of this._cascades)c.texture.destroy(),c.framebuffer.destroy();this._cascades=[]}updateShadowParameters(c,p){const b=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!p||!p.properties)return;const A=p.properties.get("shadow-intensity");if(!p.shadowsEnabled()||A<=0||(this._shadowLayerCount=b.style.order.reduce((tt,nt)=>{const ut=b.style._mergedLayers[nt];return tt+(ut.hasShadowPass()&&!ut.isHidden(c.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const C=b.context,P=io.shadowMapResolution,O=io.shadowMapResolution;if(this._cascades.length===0||io.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let tt=0;tt<io.cascadeCount;++tt){const nt=b._shadowMapDebug,ut=C.gl,st=C.createFramebuffer(P,O,nt,"texture"),pt=new a.T(C,{width:P,height:O,data:null},ut.DEPTH_COMPONENT16);if(st.depthAttachment.set(pt.texture),nt){const xt=new a.T(C,{width:P,height:O,data:null},ut.RGBA8);st.colorAttachment.set(xt.texture)}this._cascades.push({framebuffer:st,texture:pt,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cA,scale:0})}}this.shadowDirection=eT(p);let B=0;if(c.elevation){const tt=c.elevation,nt=[1e4,-1e4];tt.visibleDemTiles.filter(ut=>ut.dem).forEach(ut=>{const st=ut.dem.tree;nt[0]=Math.min(nt[0],st.minimums[0]),nt[1]=Math.max(nt[1],st.maximums[0])}),nt[0]!==1e4&&(B=(nt[1]-nt[0])*tt.exaggeration())}const G=1.5*c.cameraToCenterDistance,j=3*G,Y=new Float64Array(16);for(let tt=0;tt<this._cascades.length;++tt){const nt=this._cascades[tt];let ut=c.height/50,st=1;io.cascadeCount===1?st=j:tt===0?st=G:(ut=G,st=j);const[pt,xt]=iT(c,this.shadowDirection,ut,st,io.shadowMapResolution,B);nt.scale=c.scale,nt.matrix=pt,nt.boundingSphereRadius=xt,a.bk(Y,nt.matrix),nt.frustum=a.cA.fromInvProjectionMatrix(Y,1,0,!0),nt.far=st}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=A,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/io.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=io.shadowMapResolution,this._uniformValues.u_shadowmap_0=eo.ShadowMap0,this._uniformValues.u_shadowmap_1=eo.ShadowMap0+1,this._groundShadowTiles=b.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const J=b.transform.elevation;for(const tt of this._groundShadowTiles){let nt={min:0,max:0};if(J){const ut=J.getMinMaxForTile(tt);ut&&(nt=ut)}this.addShadowReceiver(tt.toUnwrapped(),nt.min,nt.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(c){this._enabled=c}drawShadowPass(c,p){if(!this.enabled)return;const b=this.painter,A=b.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(b.transform.getFrustum(0),b.transform.worldSize,this._cascades),A.viewport.set([0,0,io.shadowMapResolution,io.shadowMapResolution]);for(let C=0;C<this._numCascadesToRender;++C){b.currentShadowCascade=C,A.bindFramebuffer.set(this._cascades[C].framebuffer.framebuffer),A.clear({color:a.ao.white,depth:1});for(const P of c.order){const O=c._mergedLayers[P];if(!O.hasShadowPass()||O.isHidden(b.transform.zoom))continue;const B=c.getLayerSourceCache(O),G=B?p[B.id]:void 0;(O.type==="model"||G&&G.length)&&b.renderLayer(b,B,O,G)}}b.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const c=this.painter,p=c.style,b=c.context,A=b.gl,C=p.directionalLight,P=p.ambientLight;if(!C||!P)return;const O=[],B=Hc(c,c.longestCutoffRange);B.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),O.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&O.push("NORMAL_OFFSET");const G=bl(p,C,P),j=new fi(A.LEQUAL,fi.ReadOnly,c.depthRangeFor3D),Y=new $i({func:A.EQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.KEEP);for(const W of this._groundShadowTiles){const J=W.toUnwrapped(),tt=c.isTileAffectedByFog(W),nt=c.getOrCreateProgram("groundShadow",{defines:O,overrideFog:tt});this.setupShadows(J,nt),c.uploadCommonUniforms(b,nt,J,null,B);const ut={u_matrix:c.transform.calculateProjMatrix(J),u_ground_shadow_factor:G};nt.draw(c,A.TRIANGLES,j,Y,lr.multiply,Ni.disabled,ut,"ground_shadow",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments,null,c.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?lr.unblended:lr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(c){const p=this.painter.transform,b=p.calculatePosMatrix(c,p.worldSize);return a.aB(b,this._cascades[this.painter.currentShadowCascade].matrix,b),Float32Array.from(b)}calculateShadowPassMatrixFromMatrix(c){const p=a.by(c);return a.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,c),p}setupShadows(c,p,b){if(!this.enabled)return;const A=this.painter.transform,C=this.painter.context,P=C.gl,O=this._uniformValues,B=new Float64Array(16),G=A.calculatePosMatrix(c,A.worldSize);for(let j=0;j<this._cascades.length;j++)a.aB(B,this._cascades[j].matrix,G),O[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),C.activeTexture.set(P.TEXTURE0+eo.ShadowMap0+j),this._cascades[j].texture.bindExtraParam(P.LINEAR,P.LINEAR,P.CLAMP_TO_EDGE,P.CLAMP_TO_EDGE,P.GREATER);if(this.useNormalOffset=!!b,this.useNormalOffset){const j=a.d6(c.canonical),Y=2/A.tileSize*a.al/io.shadowMapResolution,W=Y*this._cascades[0].boundingSphereRadius,J=Y*this._cascades[this._cascades.length-1].boundingSphereRadius,tt=(b==="vector-tile"?1:3)*function(nt,ut,st,pt,xt){const vt=a.aA((nt-22)/-22,0,1);return .125*(1-vt)+4*vt}(A.zoom);O.u_shadow_normal_offset=[j,W*tt,J*tt],O.u_shadow_bias=[1e-4,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(C,O)}setupShadowsFromMatrix(c,p,b=!1){if(!this.enabled)return;const A=this.painter.context,C=A.gl,P=this._uniformValues,O=new Float64Array(16);for(let B=0;B<io.cascadeCount;B++)a.aB(O,this._cascades[B].matrix,c),P[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),A.activeTexture.set(C.TEXTURE0+eo.ShadowMap0+B),this._cascades[B].texture.bindExtraParam(C.LINEAR,C.LINEAR,C.CLAMP_TO_EDGE,C.CLAMP_TO_EDGE,C.GREATER);if(this.useNormalOffset=b,b){const B=io.normalOffset;P.u_shadow_normal_offset=[1,B,B],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(A,P)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(c,p,b,A){if(A[2]>=0)return{};const C=function(B,G,j){const Y=j/(1<<B.canonical.z);return new a.d8([B.canonical.x*Y+B.wrap*j,B.canonical.y*Y+B.wrap*j,0],[(B.canonical.x+1)*Y+B.wrap*j,(B.canonical.y+1)*Y+B.wrap*j,G])}(c,p,b).getCorners(),P=p/-A[2];A[0]<0?(a.d7(C[0],C[0],[A[0]*P,0,0]),a.d7(C[3],C[3],[A[0]*P,0,0])):A[0]>0&&(a.d7(C[1],C[1],[A[0]*P,0,0]),a.d7(C[2],C[2],[A[0]*P,0,0])),A[1]<0?(a.d7(C[0],C[0],[0,A[1]*P,0]),a.d7(C[1],C[1],[0,A[1]*P,0])):A[1]>0&&(a.d7(C[2],C[2],[0,A[1]*P,0]),a.d7(C[3],C[3],[0,A[1]*P,0]));const O={};return O.vertices=C,O.planes=[Tu(C[1],C[0],C[4]),Tu(C[2],C[1],C[5]),Tu(C[3],C[2],C[6]),Tu(C[0],C[3],C[7])],O}addShadowReceiver(c,p,b){this._receivers.add(c,a.d8.fromTileIdAndHeight(c,p,b))}getMaxCascadeForTile(c){const p=this._receivers.get(c);return p&&p.lastCascade?p.lastCascade:0}}function Tu(x,c,p){const b=a.av([],p,c),A=a.av([],x,c),C=a.bH([],b,A),P=a.ag(C);return P===0?[0,0,1,0]:(a.c4(C,C,1/P),[C[0],C[1],C[2],-a.bI(C,c)])}function eT(x){const c=x.properties.get("direction"),p=a.d3(c.x,c.y,c.z);p[2]=a.aA(p[2],0,75);const b=a.d5([p[0],p[1],p[2]]);return a.d4(b.x,b.y,b.z)}function bl(x,c,p){const b=c.properties.get("color-use-theme")==="none",A=c.properties.get("color"),C=c.properties.get("intensity"),P=c.properties.get("direction"),O=[P.x,P.y,P.z],B=p.properties.get("color-use-theme")==="none",G=p.properties.get("color"),j=p.properties.get("intensity"),Y=Math.max(a.bI([0,0,1],O),0),W=[0,0,0];a.c4(W,G.toPremultipliedRenderColor(B?null:x.getLut(c.scope)).toArray01Linear().slice(0,3),j);const J=[0,0,0];return a.c4(J,A.toPremultipliedRenderColor(b?null:x.getLut(p.scope)).toArray01Linear().slice(0,3),Y*C),a.da([W[0]>0?W[0]/(W[0]+J[0]):0,W[1]>0?W[1]/(W[1]+J[1]):0,W[2]>0?W[2]/(W[2]+J[2]):0])}function iT(x,c,p,b,A,C){const P=x.zoom,O=x.scale,B=x.worldSize,G=1/B,j=x.aspect,Y=Math.sqrt(1+j*j)*Math.tan(.5*x.fovX),W=Y*Y,J=b-p,tt=b+p;let nt,ut;W>J/tt?(nt=b,ut=b*Y):(nt=.5*tt*(1+W),ut=.5*Math.sqrt(J*J+2*(b*b+p*p)*W+tt*tt*W*W));const st=x.projection.pixelsPerMeter(x.center.lat,B),pt=x._camera.getCameraToWorldMercator(),xt=[0,0,-nt*G];a.af(xt,xt,pt);let vt=ut*G;const Et=x._edgeInsets;if(!(Et.left===0&&Et.top===0&&Et.right===0&&Et.bottom===0||Et.left===Et.right&&Et.top===Et.bottom)){const Ae=x._camera.getWorldToCamera(x.worldSize,x.projection.zAxisUnit==="meters"?st:1),Ue=x._camera.getCameraToClipPerspective(x._fov,x.width/x.height,p,b);Ue[8]=2*-x.centerOffset.x/x.width,Ue[9]=2*x.centerOffset.y/x.height;const ci=new Float64Array(16);a.cO(ci,Ue,Ae);const Le=new Float64Array(16);a.bk(Le,ci);const Be=a.cA.fromInvProjectionMatrix(Le,B,P,!0);for(const hi of Be.points){const ni=((bt=hi)[0]/=O,bt[1]/=O,bt[2]=a.ce(bt[2],x._center.lat),bt);vt=Math.max(vt,a.c5(a.d9([],xt,ni)))}}var bt;vt*=A/(A-1);const Pt=Math.acos(c[2]),Mt=Math.atan2(-c[0],-c[1]),Tt=new Hv;Tt.position=xt,Tt.setPitchBearing(Pt,Mt);const Lt=Tt.getWorldToCamera(B,st),qt=vt*B,jt=Math.min(x._mercatorZfromZoom(17)*B*-2,-2*qt),oe=Tt.getCameraToClipOrthographic(-qt,qt,-qt,qt,jt,(qt+C*st)/c[2]),te=new Float64Array(16);a.aB(te,oe,Lt);const he=a.d4(Math.floor(1e6*xt[0])/1e6*B,Math.floor(1e6*xt[1])/1e6*B,0),Oe=.5*A,Jt=[0,0,0];a.af(Jt,he,te),a.c4(Jt,Jt,Oe);const Ut=[Math.floor(Jt[0]),Math.floor(Jt[1]),Math.floor(Jt[2])],de=[0,0,0];a.av(de,Jt,Ut),a.c4(de,de,-1/Oe);const ee=new Float64Array(16);return a.bz(ee),a.bq(ee,ee,de),a.aB(te,ee,te),[te,qt]}class jv extends a.E{constructor(c){super(),this.requestManager=c,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(c,p){return a.db(this.requestManager.transformRequest(p,a.R.Model).url).then(b=>{if(!b)return;const A=a.dc(b),C=new a.dd(c,p,void 0,void 0,A);return C.computeBoundsAndApplyParent(),C}).catch(b=>{if(b&&b.status===404)return null;this.fire(new a.y(new Error(`Could not load model ${c} from ${p}: ${b.message}`)))})}load(c,p,b={forceReload:!1}){this.models[p]||(this.models[p]={});const A=Object.keys(c),C=[],P=[];for(const O of A){const B=c[O];this.hasURLBeenRequested(B)&&!b.forceReload||(this.modelByURL[B]={modelId:O,scope:p},C.push(this.loadModel(O,B)),P.push(O)),this.models[p][O]||(this.models[p][O]={model:null,numReferences:1})}this.numModelsLoading[p]=(this.numModelsLoading[p]||0)+P.length,Promise.allSettled(C).then(O=>{for(let B=0;B<O.length;B++){const{status:G}=O[B];if(G==="rejected")continue;const{value:j}=O[B];this.models[p][P[B]]||(this.models[p][P[B]]={model:null,numReferences:1}),this.models[p][P[B]].model=j}this.numModelsLoading[p]-=P.length,this.fire(new a.z("data",{dataType:"style"}))}).catch(O=>{this.fire(new a.y(new Error(`Could not load models: ${O.message}`)))})}isLoaded(){for(const c in this.numModelsLoading)if(this.numModelsLoading[c]>0)return!1;return!0}hasModel(c,p,b={exactIdMatch:!1}){return!!(b.exactIdMatch?this.getModel(c,p):this.getModelByURL(this.modelUris[p][c]))}getModel(c,p){return this.models[p]||(this.models[p]={}),this.models[p][c]?this.models[p][c].model:void 0}getModelByURL(c){if(!c)return null;const p=this.modelByURL[c];return p?this.models[p.scope][p.modelId].model:null}hasModelBeenAdded(c,p){return this.models[p]&&this.models[p][c]!==void 0}getModelURIs(c){return this.modelUris[c]||{}}addModel(c,p,b){this.models[b]||(this.models[b]={}),this.modelUris[b]||(this.modelUris[b]={});const A=this.requestManager.normalizeModelURL(p);if((this.hasModel(c,b,{exactIdMatch:!0})||this.hasModelBeenAdded(c,b))&&this.modelUris[b][c]===A)this.models[b][c].numReferences++;else if(this.hasURLBeenRequested(A)){const{scope:C,modelId:P}=this.modelByURL[A];this.models[C][P].numReferences++}else this.modelUris[b][c]=A,this.load({[c]:this.modelUris[b][c]},b)}addModelURLs(c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const b=this.modelUris[p];for(const A in c)b[A]=this.requestManager.normalizeModelURL(c[A])}reloadModels(c){this.load(this.modelUris[c],c,{forceReload:!0})}addModelsFromBucket(c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const b={};for(const A of c)this.hasModel(A,p,{exactIdMatch:!0})||this.hasURLBeenRequested(A)?this.models[p][A].numReferences++:this.modelUris[p][A]&&!this.hasURLBeenRequested(A)?b[A]=this.modelUris[p][A]:!this.hasURLBeenRequested(A)&&a.de(A,!1)&&(this.modelUris[p][A]=this.requestManager.normalizeModelURL(A),b[A]=this.modelUris[p][A]);this.load(b,p)}hasURLBeenRequested(c){return this.modelByURL[c]!==void 0}removeModel(c,p,b=!1,A=!1){if(this.models[p]&&this.models[p][c]&&(this.models[p][c].numReferences--,this.models[p][c].numReferences===0||A)){const C=this.modelUris[p][c];b||delete this.modelUris[p][c],delete this.modelByURL[C];const P=this.models[p][c].model;if(!P)return;delete this.models[p][c],P.destroy()}}destroy(){for(const c of Object.keys(this.models))for(const p of Object.keys(this.models[c])){const b=this.models[c][p].model;delete this.models[c][p],b&&b.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(c){return this.models[c]||(this.models[c]={}),Object.keys(this.models[c])}upload(c,p){this.models[p]||(this.models[p]={});for(const b in this.models[p])this.models[p][b].model&&this.models[p][b].model.upload(c.context)}}const gg=a.a6.colorTheme,Au=new a.a9({data:new a.aa(gg.data)});function NE(x){if(!x.metadata||!x.metadata.content_area)return;const c=a.o.devicePixelRatio,{left:p,top:b,width:A,height:C}=x.metadata.content_area,P=p*c,O=b*c;return[P,O,P+A*c,O+C*c]}function rT(x){if(x)return x.map(([c,p])=>[c*a.o.devicePixelRatio,p*a.o.devicePixelRatio])}class VE{constructor(c,p,b){this.id=c,this.scope=p,this.sourceCache=b,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(c){this.missingRequests.has(c.name)||this.pendingRequests.has(c.name)||this.pendingRequests.add(c.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const c=new Map;if(!this.sourceCache.loaded())return c;const p=this.sourceCache.getVisibleCoordinates();if(p.length===0)return c;const b=this.sourceCache.getSource();if(!(b instanceof Ga))return c;const A=p.map(P=>this.sourceCache.getTile(P)),C=b.getImages(A,Array.from(this.pendingRequests));for(const[P,O]of C)c.set(a.I.from({name:P,iconsetId:this.id}),O),this.pendingRequests.delete(P);for(const P of this.pendingRequests)this.missingRequests.add(P);return this.pendingRequests.clear(),c}}const Iu=(x,c)=>ot(x,c&&c.filter(p=>p.identifier!=="source.canvas")),UE=a.aH(Ur,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),hx=a.aH(Ur,["setCenter","setZoom","setBearing","setPitch"]),Wv=new Set(["background","sky","slot","custom"]),dx={version:8,layers:[],sources:{}},fx={duration:300,delay:0};class wl extends a.E{constructor(c,p={}){super(),this.map=c,this.scope=p.scope||"",this.globalId=null,this.fragments=[],this.importDepth=p.importDepth||0,this.importsCache=p.importsCache||new Map,this.resolvedImports=p.resolvedImports||new Set,this.transition=Object.assign({},fx),this._buildingIndex=new ix(this),this.crossTileSymbolIndex=new Gc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=p.styleChanges||new pe,this.dispatcher=p.dispatcher?p.dispatcher:new a.D(a.dg(),this),p.imageManager?this.imageManager=p.imageManager:(this.imageManager=new He(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=p.glyphManager?p.glyphManager:new a.dh(c._requestManager,p.localFontFamily?a.di.all:p.localIdeographFontFamily?a.di.ideographs:a.di.none,p.localFontFamily||p.localIdeographFontFamily),p.modelManager?this.modelManager=p.modelManager:(this.modelManager=new jv(c._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=p.configOptions?p.configOptions:new Map,this._configDependentLayers=p.configDependentLayers?p.configDependentLayers:new Set,this._indoorDependentLayers=p.indoorDependentLayers?p.indoorDependentLayers:new Set,this._config=p.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:p.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=p.initialConfig,this.dispatcher.broadcast("setReferrer",a.dj());const b=this;this._rtlTextPluginCallback=wl.registerForPluginStateChange(A=>{b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},(C,P)=>{if(a.dk(C),P&&P.every(O=>O))for(const O in b._sourceCaches){const B=b._sourceCaches[O],G=B.getSource().type;G!=="vector"&&G!=="geojson"||B.reload()}})}),this.on("data",A=>{if(A.dataType!=="source"||A.sourceDataType!=="metadata")return;const C=this.getOwnSource(A.sourceId);if(C&&C.vectorLayerIds)for(const P in this._layers){const O=this._layers[P];O.source===C.id&&this._validateLayer(O)}})}load(c){return c?(typeof c=="string"?this.loadURL(c):this.loadJSON(c),this):this}_getGlobalId(c){if(!c)return null;if(typeof c=="string"){if(a.h(c))return c;const p=a.dl(c);if(!p.startsWith("http"))try{return new URL(p,location.href).toString()}catch{return p}return p}return`json://${a.dm(JSON.stringify(c))}`}_diffStyle(c,p,b){this.globalId=this._getGlobalId(c);const A=(C,P)=>{try{P(null,this.setState(C,b))}catch(O){P(O,!1)}};if(typeof c=="string"){const C=this.map._requestManager.normalizeStyleURL(c),P=this.map._requestManager.transformRequest(C,a.R.Style);a.m(P,(O,B)=>{O?this.fire(new a.y(O)):B&&A(B,p)})}else typeof c=="object"&&A(c,p)}loadURL(c,p={}){this.fire(new a.z("dataloading",{dataType:"style"}));const b=typeof p.validate=="boolean"?p.validate:!a.h(c);this.globalId=this._getGlobalId(c),c=this.map._requestManager.normalizeStyleURL(c,p.accessToken),this.resolvedImports.add(c);const A=this.importsCache.get(c);if(A)return this._load(A,b);const C=this.map._requestManager.transformRequest(c,a.R.Style);this._request=a.m(C,(P,O)=>{if(this._request=null,P)this.fire(new a.y(P));else if(O)return this.importsCache.set(c,O),this._load(O,b)})}loadJSON(c,p={}){this.fire(new a.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(c),this._request=a.o.frame(()=>{this._request=null,this._load(c,p.validate!==!1)})}loadEmpty(){this.fire(new a.z("dataloading",{dataType:"style"})),this._load(dx,!1)}_loadImports(c,p,b){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const A=[];for(const C of c){const P=this._createFragmentStyle(C),O=new Promise(j=>{P.once("style.import.load",j),P.once("error",j)}).then(()=>this.mergeAll());if(A.push(O),this.resolvedImports.has(C.url)){P.loadEmpty();continue}const B=C.data||this.importsCache.get(C.url);B?(P.loadJSON(B,{validate:p}),this._isInternalStyle(B)&&(P.globalId=null)):C.url?P.loadURL(C.url,{validate:p}):P.loadEmpty();const G={style:P,id:C.id,config:C.config};if(b){const j=this.fragments.findIndex(({id:Y})=>Y===b);this.fragments=this.fragments.slice(0,j).concat(G).concat(this.fragments.slice(j))}else this.fragments.push(G)}return Promise.allSettled(A)}getImportGlobalIds(c=this,p=new Set){for(const b of c.fragments)b.style.globalId&&p.add(b.style.globalId),this.getImportGlobalIds(b.style,p);return[...p.values()]}_createFragmentStyle(c){const p=this.scope?a.B(c.id,this.scope):c.id;let b;const A=this._initialConfig&&this._initialConfig[p];(c.config||A)&&(b=Object.assign({},c.config,A));const C=new wl(this.map,{scope:p,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:b,configOptions:this.options,colorThemeOverride:c["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return C.setEventedParent(this.map,{style:C}),C}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(c){return this.isRootStyle()&&(c.fragment||!!c.schema&&c.fragment!==!1)}_load(c,p){if(this._isInternalStyle(c)){const C=Object.assign({},dx,{imports:[{id:"basemap",data:c,url:""}]},c.center?{center:c.center}:{},c.bearing?{bearing:c.bearing}:{},c.pitch?{pitch:c.pitch}:{},c.zoom?{zoom:c.zoom}:{},c.light?{light:c.light}:{});return this._importedAsBasemap=!0,void this._load(C,p)}if(this.updateConfig(this._config,c.schema),p&&Iu(this,Gs(c)))return;this._loaded=!0,this.stylesheet=a.dn(c);const b=()=>{for(const B in c.sources)this.addSource(B,c.sources[B],{validate:!1,isInitialLoad:!0});if(c.iconsets)for(const B in c.iconsets)this.addIconset(B,c.iconsets[B]);c.sprite?this._loadIconset(c.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&c.glyphs&&this.glyphManager.setURL(c.glyphs);const C=Wd(this.stylesheet.layers);if(this._order=C.map(B=>B.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const B=this.stylesheet.lights[0];this.light=new Ft(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ft(this.stylesheet.light)),this._layers={};for(const B of C){const G=a.dt(B,this.scope,this._styleColorTheme.lut,this.options);G.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(G.fqid),G.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(G.fqid),this._hasAppearances=this._hasAppearances||G.getAppearances().length!==0,G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G;const j=this.getOwnLayerSourceCache(G),Y=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&G.canCastShadows()&&Y&&(j.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.z("data",{dataType:"style"}));const O=this.isRootStyle();c.imports?this._loadImports(c.imports,p).then(()=>{this._reloadImports(),this.fire(new a.z(O?"style.load":"style.import.load"))}).catch(B=>{this.fire(new a.y(new Error("Failed to load imports",B))),this.fire(new a.z(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.z(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const A=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(A){const C=this._evaluateColorThemeData(A);this._loadColorTheme(C).then(()=>{b()}).catch(P=>{a.w(`Couldn't load color theme from the stylesheet: ${P}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let c,p,b,A,C,P,O,B,G,j;const Y={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(c=W.light),W.stylesheet.lights)for(const J of W.stylesheet.lights)J.type==="ambient"&&W.ambientLight!=null&&(p=W.ambientLight),J.type==="directional"&&W.directionalLight!=null&&(b=W.directionalLight);A=this._prioritizeTerrain(A,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(C=W.fog),W.stylesheet.snow&&W.snow!=null&&(P=W.snow),W.stylesheet.rain&&W.rain!=null&&(O=W.rain),W.stylesheet.camera!=null&&(j=W.stylesheet.camera),W.stylesheet.projection!=null&&(B=W.stylesheet.projection),W.stylesheet.transition!=null&&(G=W.stylesheet.transition),Y[W.scope]=W._styleColorTheme}}),this.light=c,this.ambientLight=p,this.directionalLight=b,this.fog=C,this.snow=P,this.rain=O,this._styleColorThemeForScope=Y,A===null?delete this.terrain:this.terrain=A,this.camera=j||{"camera-projection":"perspective"},this.projection=B||{name:"mercator"},this.transition=Object.assign({},fx,G),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(c){const p=b=>{for(const A of b.fragments)p(A.style);c(b)};p(this)}_prioritizeTerrain(c,p,b){const A=c&&c.drapeRenderMode===0;return b===null?p&&p.drapeRenderMode===0?p:A?c:null:p!=null&&(!c||A||p&&p.drapeRenderMode===1)?p:c}mergeTerrain(){let c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{c=this._prioritizeTerrain(c,p.terrain,p.stylesheet.terrain)}),c===null?delete this.terrain:this.terrain=c}mergeProjection(){let c;this.forEachFragmentStyle(p=>{p.stylesheet.projection!=null&&(c=p.stylesheet.projection)}),this.projection=c||{name:"mercator"}}mergeSources(){const c={},p={},b={};this.forEachFragmentStyle(A=>{for(const C in A._sourceCaches){const P=a.B(C,A.scope);c[P]=A._sourceCaches[C]}for(const C in A._otherSourceCaches){const P=a.B(C,A.scope);p[P]=A._otherSourceCaches[C]}for(const C in A._symbolSourceCaches){const P=a.B(C,A.scope);b[P]=A._symbolSourceCaches[C]}}),this._mergedSourceCaches=c,this._mergedOtherSourceCaches=p,this._mergedSymbolSourceCaches=b}mergeIndoor(){this.forEachFragmentStyle(c=>{if(c.stylesheet&&c.stylesheet.indoor)for(const p of Object.values(c.stylesheet.indoor)){const b=p,A=a.B(b.sourceId,c.scope);this._mergedIndoor[A]=new Set(b.sourceLayers||[])}})}mergeLayers(){const c={},p=[],b={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(P=>{for(const O of P._order){const B=P._layers[O];if(B.type==="slot"){const G=a.dp(O);if(c[G])continue;c[G]=[]}B.slot&&c[B.slot]?c[B.slot].push(B):p.push(B)}}),this._mergedOrder=[];let A=-1;const C=(P=[])=>{for(const O of P)if(O.type==="slot"){const B=a.dp(O.id);c[B]&&C(c[B]),this._mergedSlots.push(B)}else{const B=a.B(O.id,O.scope);this._mergedOrder.push(B),b[B]=O,O.is3D(!!this.terrain)&&(this._has3DLayers=!0,A=this._mergedOrder.length-1),O.type==="circle"&&(this._hasCircleLayers=!0),O.type==="symbol"&&(this._hasSymbolLayers=!0),O.type==="clip"&&(this._clipLayerPresent=!0)}};if(C(p),this._has3DLayers){const P={};for(let O=0;O<this._mergedOrder.length;++O){const B=this._mergedOrder[O];P[B]=O===A?1:O<A?b[B].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((O,B)=>P[O]-P[B])}this._mergedLayers=b,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(c){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,c),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(c){return c.data?function(p,b,A,C){const P=Object.assign({},b);for(const B of Object.keys(gg))P[B]===void 0&&(P[B]=gg[B].default);const O=new a.a8(Au,p,new Map(A));return O.setTransitionOrValue(P,A),O.untransitioned().possiblyEvaluate(new a.ac(0,{worldview:void 0}))}(this.scope,c,this.options).get("data"):null}_loadColorTheme(c){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const p=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((b,A)=>{const C="data:image/png;base64,";if(!c||c.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void b();let P=c;P.startsWith(C)||(P=C+P);const O=a.I.from("mapbox-reserved-lut"),B=new Image;B.src=P,B.onerror=()=>{this._styleColorTheme.lutLoading=!1,A(new Error("Failed to load image data"))},B.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==p)return void b();this._styleColorTheme.lutLoading=!1;const{width:G,height:j,data:Y}=a.o.getImageData(B);if(j>32)return void A(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==j*j)return void A(new Error("The width of the image must be equal to the height squared."));this.getImage(O)&&this.removeImage(O),this.addImage(O,{data:new a.q({width:G,height:j},Y),pixelRatio:1,sdf:!1,usvg:!1,version:0});const W=this.imageManager.getImage(O,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:c},b()):A(new Error("Missing LUT image."))}})}getLut(c){const p=this._styleColorThemeForScope[c];return p?p.lut:null}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(c){this._spriteRequest=function(p,b,A){let C,P,O;const B=a.o.devicePixelRatio>1?"@2x":"";let G=a.m(b.transformRequest(b.normalizeSpriteURL(p,B,".json"),a.R.SpriteJSON),(W,J)=>{G=null,O||(O=W,C=J,Y())}),j=a.n(b.transformRequest(b.normalizeSpriteURL(p,B,".png"),a.R.SpriteImage),(W,J)=>{j=null,O||(O=W,P=J,Y())});function Y(){if(O)A(O);else if(C&&P){const W=a.o.getImageData(P),J={};for(const tt in C){const{width:nt,height:ut,x:st,y:pt,sdf:xt,pixelRatio:vt,stretchX:Et,stretchY:bt,content:Pt}=C[tt],Mt=new a.q({width:nt,height:ut});a.q.copy(W,Mt,{x:st,y:pt},{x:0,y:0},{width:nt,height:ut},null),J[tt]={data:Mt,pixelRatio:vt!==void 0?vt:1,sdf:xt!==void 0&&xt,stretchX:Et,stretchY:bt,content:Pt,usvg:!1,version:0}}A(null,J)}}return{cancel(){G&&(G.cancel(),G=null),j&&(j.cancel(),j=null)}}}(c,this.map._requestManager,(p,b)=>{if(this._spriteRequest=null,p)this.fire(new a.y(p));else if(b){const A=new Map;for(const C in b)A.set(a.I.from(C),b[C]);this.addImages(A)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))})}addIconset(c,p){if(p.type==="sprite")return void this._loadSprite(p.url);const b=this.getOwnSourceCache(p.source);if(!b)return void this.fire(new a.y(new Error(`Source "${p.source}" as specified by iconset "${c}" does not exist and cannot be used as an iconset source`)));const A=b.getSource();if(A.type!=="raster-array")return void this.fire(new a.y(new Error(`Source "${p.source}" as specified by iconset "${c}" is not a "raster-array" source and cannot be used as an iconset source`)));A.partial=!1;const C=new VE(c,this.scope,b);this.imageManager.addImageProvider(C,this.scope)}removeIconset(c){this.imageManager.removeImageProvider(c,this.scope)}_loadIconset(c){if(!a.h(c)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(c);const p=this.map._spriteFormat==="auto";var b,A;this._spriteRequest=(A=(C,P)=>{if(this._spriteRequest=null,C)p?this._loadSprite(c):this.fire(new a.y(C));else if(P){const O=new Map;for(const B in P)O.set(a.I.from(B),P[B]);this.addImages(O)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))},a.bt((b=this.map._requestManager).transformRequest(b.normalizeIconsetURL(c),a.R.Iconset),(C,P)=>{if(C)return void A(C);const O={},B=a.df(new a.bs(P));for(const G of B.icons){const j={version:1,pixelRatio:a.o.devicePixelRatio,content:NE(G),stretchX:G.metadata?rT(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?rT(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};O[G.name]=j}A(null,O)}))}_validateLayer(c){const p=this.getOwnSource(c.source);if(!p)return;const b=c.sourceLayer;b&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(b)===-1)&&this.fire(new a.y(new Error(`Source layer "${b}" does not exist on source "${p.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:c}of this.fragments)if(!c.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((c,p)=>{const b=this.fragments[p];return b&&b.style&&(c.data=b.style.serialize()),c})}_serializeSources(){const c={};for(const p in this._sourceCaches){const b=this._sourceCaches[p].getSource();c[b.id]||(c[b.id]=b.serialize())}return c}_serializeLayers(c){const p=[];for(const b of c){const A=this._layers[b];A&&A.type!=="custom"&&p.push(A.serialize())}return p}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(c){return c?this.order:this._mergedOrder}isLayerDraped(c){return!!this.terrain&&c.isDraped(this.getLayerSourceCache(c))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(c){const p=this.getOwnLayer(c);if(p)return p;this.fire(new a.y(new Error(`The layer '${c}' does not exist in the map's style.`)))}_checkSource(c){const p=this.getOwnSource(c);if(p)return p;this.fire(new a.y(new Error(`The source '${c}' does not exist in the map's style.`)))}precompilePrograms(c,p){const b=this.map.painter;if(b)for(let A=c.minzoom||0;A<(c.maxzoom||25.5);A++){const C=c.getProgramIds();if(C)for(const P of C){const O=c.getDefaultProgramParams(P,p.zoom,this._styleColorTheme.lut);O&&(b.style=this,this.fog&&(b._fogVisible=!0,O.overrideFog=!0,b.getOrCreateProgram(P,O)),b._fogVisible=!1,O.overrideFog=!1,b.getOrCreateProgram(P,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,b.getOrCreateProgram(P,O)))}}}update(c){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c);const p=this.calculateLightsBrightness();c.brightness=p||0,p!==this._brightness&&(this._brightness=p,this.dispatcher.broadcast("setBrightness",p)),c.worldview!==this._worldview&&(this._worldview=c.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const b=this._changes.isDirty();let A=!1;if(this._changes.isDirty()){const O=this._changes.getLayerUpdatesByScope();for(const B in O){const{updatedIds:G,removedIds:j}=O[B];(G||j)&&(this._updateWorkerLayers(B,G,j),A=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(c),this.light&&this.light.updateTransitions(c),this.ambientLight&&this.ambientLight.updateTransitions(c),this.directionalLight&&this.directionalLight.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this.snow&&this.snow.updateTransitions(c),this.rain&&this.rain.updateTransitions(c),this._changes.reset()}const C={};for(const O in this._mergedSourceCaches){const B=this._mergedSourceCaches[O];C[O]=B.used,B.used=!1,B.tileCoverLift=0}for(const O of this._mergedOrder){const B=this._mergedLayers[O];if(B.recalculate(c,this._availableImages),!B.isHidden(c.zoom)){const G=this.getLayerSourceCache(B);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,B.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(B,c)}):this.precompilePrograms(B,c))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&A&&this.mergeLayers();const P=this.imageManager.getPendingImageProviders();for(const O of P)O.sourceCache.used=!0;for(const O in C){const B=this._mergedSourceCaches[O];C[O]!==B.used&&B.getSource().fire(new a.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:B.getSource().id}))}this.light&&this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.snow&&this.snow.recalculate(c),this.rain&&this.rain.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),b&&this.fire(new a.z("data",{dataType:"style"}))}updateImageProviders(){const c=this.imageManager.getPendingImageProviders();for(const p of c){const b=p.resolvePendingRequests(),A=this.getFragmentStyle(p.scope);A&&A.addImages(b)}}_updateTilesForChangedImages(){const c={};for(const p in this._mergedSourceCaches){const b=this._mergedSourceCaches[p].getSource().scope;c[b]=c[b]||this._changes.getUpdatedImages(b),c[b].length!==0&&this._mergedSourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c[b])}for(const p in c)this._changes.resetUpdatedImages(p)}_updateWorkerLayers(c,p,b){const A=this.getFragmentStyle(c);A&&this.dispatcher.broadcast("updateLayers",{layers:p?A._serializeLayers(p):[],scope:c,removedIds:b||[],options:A.options})}setState(c,p){if(this._checkLoaded(),Iu(this,Gs(c)))return!1;(c=a.dn(c)).layers=Wd(c.layers);const b=function(P,O){if(!P)return[{command:Ur.setStyle,args:[O]}];let B=[];try{if(!a.bx(P.version,O.version))return[{command:Ur.setStyle,args:[O]}];if(a.bx(P.center,O.center)||B.push({command:Ur.setCenter,args:[O.center]}),a.bx(P.zoom,O.zoom)||B.push({command:Ur.setZoom,args:[O.zoom]}),a.bx(P.bearing,O.bearing)||B.push({command:Ur.setBearing,args:[O.bearing]}),a.bx(P.pitch,O.pitch)||B.push({command:Ur.setPitch,args:[O.pitch]}),a.bx(P.sprite,O.sprite)||B.push({command:Ur.setSprite,args:[O.sprite]}),a.bx(P.glyphs,O.glyphs)||B.push({command:Ur.setGlyphs,args:[O.glyphs]}),a.bx(P.imports,O.imports)||function(J=[],tt=[],nt){tt=tt||[];const ut=(J=J||[]).map(ig),st=tt.map(ig),pt=J.reduce(rg,{}),xt=tt.reduce(rg,{}),vt=ut.slice();let Et,bt,Pt,Mt;for(Et=0,bt=0;Et<ut.length;Et++)Pt=ut[Et],xt.hasOwnProperty(Pt)?bt++:(nt.push({command:Ur.removeImport,args:[Pt]}),vt.splice(vt.indexOf(Pt,bt),1));for(Et=0,bt=0;Et<st.length;Et++)Pt=st[st.length-1-Et],vt[vt.length-1-Et]!==Pt&&(pt.hasOwnProperty(Pt)?(nt.push({command:Ur.removeImport,args:[Pt]}),vt.splice(vt.lastIndexOf(Pt,vt.length-bt),1)):bt++,Mt=vt[vt.length-Et],nt.push({command:Ur.addImport,args:[xt[Pt],Mt]}),vt.splice(vt.length-Et,0,Pt));for(const Tt of tt){const Lt=pt[Tt.id];Lt&&(delete Lt.data,a.bx(Lt,Tt)||nt.push({command:Ur.updateImport,args:[Tt.id,Tt]}))}}(P.imports,O.imports,B),a.bx(P.transition,O.transition)||B.push({command:Ur.setTransition,args:[O.transition]}),a.bx(P.light,O.light)||B.push({command:Ur.setLight,args:[O.light]}),a.bx(P.fog,O.fog)||B.push({command:Ur.setFog,args:[O.fog]}),a.bx(P.snow,O.snow)||B.push({command:Ur.setSnow,args:[O.snow]}),a.bx(P.rain,O.rain)||B.push({command:Ur.setRain,args:[O.rain]}),a.bx(P.projection,O.projection)||B.push({command:Ur.setProjection,args:[O.projection]}),a.bx(P.lights,O.lights)||B.push({command:Ur.setLights,args:[O.lights]}),a.bx(P.camera,O.camera)||B.push({command:Ur.setCamera,args:[O.camera]}),a.bx(P.iconsets,O.iconsets)||function(J,tt,nt){let ut;for(ut in tt=tt||{},J=J||{})J.hasOwnProperty(ut)&&(tt.hasOwnProperty(ut)||nt.push({command:Ur.removeIconset,args:[ut]}));for(ut in tt){if(!tt.hasOwnProperty(ut))continue;const st=tt[ut];J.hasOwnProperty(ut)?a.bx(J[ut],st)||(nt.push({command:Ur.removeIconset,args:[ut]}),nt.push({command:Ur.addIconset,args:[ut,st]})):nt.push({command:Ur.addIconset,args:[ut,st]})}}(P.iconsets,O.iconsets,B),!a.bx(P["color-theme"],O["color-theme"]))return[{command:Ur.setStyle,args:[O]}];const G={},j=[];(function(J,tt,nt,ut){let st;for(st in tt=tt||{},J=J||{})J.hasOwnProperty(st)&&(tt.hasOwnProperty(st)||Qp(st,nt,ut));for(st in tt){if(!tt.hasOwnProperty(st))continue;const pt=tt[st];J.hasOwnProperty(st)?a.bx(J[st],pt)||(J[st].type==="geojson"&&pt.type==="geojson"&&nx(J,tt,st)?nt.push({command:Ur.setGeoJSONSourceData,args:[st,pt.data]}):tg(st,tt,nt,ut)):rx(st,tt,nt)}})(P.sources,O.sources,j,G);const Y=[];P.layers&&P.layers.forEach(J=>{J.source&&G[J.source]?B.push({command:Ur.removeLayer,args:[J.id]}):Y.push(J)});let W=P.terrain;W&&G[W.source]&&(B.push({command:Ur.setTerrain,args:[void 0]}),W=void 0),B=B.concat(j),a.bx(W,O.terrain)||B.push({command:Ur.setTerrain,args:[O.terrain]}),function(J,tt,nt){tt=tt||[];const ut=(J=J||[]).map(ig),st=tt.map(ig),pt=J.reduce(rg,{}),xt=tt.reduce(rg,{}),vt=ut.slice(),Et=Object.create(null);let bt,Pt,Mt,Tt,Lt,qt,jt;for(bt=0,Pt=0;bt<ut.length;bt++)Mt=ut[bt],xt.hasOwnProperty(Mt)?Pt++:(nt.push({command:Ur.removeLayer,args:[Mt]}),vt.splice(vt.indexOf(Mt,Pt),1));for(bt=0,Pt=0;bt<st.length;bt++)Mt=st[st.length-1-bt],vt[vt.length-1-bt]!==Mt&&(pt.hasOwnProperty(Mt)?(nt.push({command:Ur.removeLayer,args:[Mt]}),vt.splice(vt.lastIndexOf(Mt,vt.length-Pt),1)):Pt++,qt=vt[vt.length-bt],nt.push({command:Ur.addLayer,args:[xt[Mt],qt]}),vt.splice(vt.length-bt,0,Mt),Et[Mt]=!0);for(bt=0;bt<st.length;bt++)if(Mt=st[bt],Tt=pt[Mt],Lt=xt[Mt],!Et[Mt]&&!a.bx(Tt,Lt))if(a.bx(Tt.source,Lt.source)&&a.bx(Tt["source-layer"],Lt["source-layer"])&&a.bx(Tt.type,Lt.type)){for(jt in eg(Tt.layout,Lt.layout,nt,Mt,null,Ur.setLayoutProperty),eg(Tt.paint,Lt.paint,nt,Mt,null,Ur.setPaintProperty),a.bx(Tt.slot,Lt.slot)||nt.push({command:Ur.setSlot,args:[Mt,Lt.slot]}),a.bx(Tt.filter,Lt.filter)||nt.push({command:Ur.setFilter,args:[Mt,Lt.filter]}),a.bx(Tt.minzoom,Lt.minzoom)&&a.bx(Tt.maxzoom,Lt.maxzoom)||nt.push({command:Ur.setLayerZoomRange,args:[Mt,Lt.minzoom,Lt.maxzoom]}),Tt)Tt.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&jt!=="slot"&&(jt.indexOf("paint.")===0?eg(Tt[jt],Lt[jt],nt,Mt,jt.slice(6),Ur.setPaintProperty):a.bx(Tt[jt],Lt[jt])||nt.push({command:Ur.setLayerProperty,args:[Mt,jt,Lt[jt]]}));for(jt in Lt)Lt.hasOwnProperty(jt)&&!Tt.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&jt!=="slot"&&(jt.indexOf("paint.")===0?eg(Tt[jt],Lt[jt],nt,Mt,jt.slice(6),Ur.setPaintProperty):a.bx(Tt[jt],Lt[jt])||nt.push({command:Ur.setLayerProperty,args:[Mt,jt,Lt[jt]]}))}else nt.push({command:Ur.removeLayer,args:[Mt]}),qt=vt[vt.lastIndexOf(Mt)+1],nt.push({command:Ur.addLayer,args:[Lt,qt]})}(Y,O.layers,B)}catch(G){console.warn("Unable to compute style diff:",G),B=[{command:Ur.setStyle,args:[O]}]}return B}(this.serialize(),c).filter(P=>!(P.command in hx));if(b.length===0)return!1;const A=b.filter(P=>!(P.command in UE));if(A.length>0)throw new Error(`Unimplemented: ${A.map(P=>P.command).join(", ")}.`);const C=[];return b.forEach(P=>{C.push(this[P.command](...P.args))}),p&&Promise.all(C).then(p).catch(p),this.stylesheet=c,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(c){if(c.size===0)return this;for(const[p,b]of c.entries()){if(this.getImage(p))return this.fire(new a.y(new Error(`An image with the name "${p.name}" already exists.`)));this.imageManager.addImage(p,this.scope,b),this._changes.updateImage(p,this.scope)}return this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this}addImage(c,p){return this.getImage(c)?this.fire(new a.y(new Error(`An image with the name "${c.name}" already exists.`))):(this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this)}updateImage(c,p,b=!1){this.imageManager.updateImage(c,this.scope,p),b&&(this._changes.updateImage(c,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})))}getImage(c){return this.imageManager.getImage(c,this.scope)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c,this.scope),this._changes.updateImage(c,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(c){return this.modelManager.addModelURLs(c,this.scope),this._updateWorkerModels(),this.fire(new a.z("data",{dataType:"style"})),this}addModel(c,p,b={}){return this._checkLoaded(),this._validate(qp,`models.${c}`,p,null,b)||(this.modelManager.addModel(c,p,this.scope),this.fire(new a.z("data",{dataType:"style"}))),this}hasModel(c){return this.modelManager.hasModel(c,this.scope)}removeModel(c){return this.hasModel(c)?(this.modelManager.removeModel(c,this.scope,!1,!0),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(c,p,b={}){if(this._checkLoaded(),this.getOwnSource(c)!==void 0)throw new Error(`There is already a source with ID "${c}".`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(kv,`sources.${c}`,p,null,b))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const A=Xo(c,p,this.dispatcher,this);A.scope=this.scope,A.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(A.id),source:A.serialize(),sourceId:A.id}));const C=P=>{const O=(P?"symbol:":"other:")+A.id,B=a.B(O,this.scope),G=this._sourceCaches[O]=new _l(B,A,P);(P?this._symbolSourceCaches:this._otherSourceCaches)[A.id]=G,G.onAdd(this.map)};C(!1),p.type!=="vector"&&p.type!=="geojson"||C(!0),A.onAdd&&A.onAdd(this.map),b.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(c){this._checkLoaded();const p=this.getOwnSource(c);if(!p)throw new Error("There is no source with this ID");for(const A in this._layers)if(this._layers[A].source===c)return this.fire(new a.y(new Error(`Source "${c}" cannot be removed while layer "${A}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===c)return this.fire(new a.y(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const A=Object.entries(this.stylesheet.iconsets).find(([C,P])=>P.type==="source"&&P.source===c);if(A)return this.fire(new a.y(new Error(`Source "${c}" cannot be removed while iconset "${A[0]}" is using it.`)))}const b=this.getOwnSourceCaches(c);for(const A of b){const C=a.dp(A.id);delete this._sourceCaches[C],this._changes.discardSourceCacheUpdate(A.id),A.fire(new a.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:A.getSource().id})),A.setEventedParent(null),A.clearTiles()}return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],this.mergeSources(),p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(c,p){this._checkLoaded(),this.getOwnSource(c).setData(p),this._changes.setDirty()}getOwnSource(c){const p=this.getOwnSourceCache(c);return p&&p.getSource()}getOwnSources(){const c=[];for(const p in this._otherSourceCaches){const b=this.getOwnSourceCache(p);b&&c.push(b.getSource())}return c}areTilesLoaded(){const c=this._mergedSourceCaches;for(const p in c){const b=c[p]._tiles;for(const A in b){const C=b[A];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}setLights(c){if(this._checkLoaded(),!c)return delete this.ambientLight,void delete this.directionalLight;const p=this._getTransitionParameters();for(const C of c){if(this._validate(J0,"lights",C))return;switch(C.type){case"ambient":if(this.ambientLight){const P=this.ambientLight;P.set(C),P.updateTransitions(p)}else this.ambientLight=new ea(C,nn||(nn=new a.a9({color:new a.aa(a.a6.properties_light_ambient.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const P=this.directionalLight;P.set(C),P.updateTransitions(p)}else this.directionalLight=new ea(C,Xn||(Xn=new a.a9({direction:new a.ap(a.a6.properties_light_directional.direction),color:new a.aa(a.a6.properties_light_directional.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_directional.intensity),"cast-shadows":new a.aa(a.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new a.aa(a.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.aa(a.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const b=Object.assign(p,{worldview:this.map.getWorldview()}),A=new a.ac(this.z||0,b);this.ambientLight&&this.ambientLight.recalculate(A),this.directionalLight&&this.directionalLight.recalculate(A),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const c=this.directionalLight,p=this.ambientLight;if(!c||!p)return;const b=W=>.2126*(W[0]<=.03928?W[0]/12.92:Math.pow((W[0]+.055)/1.055,2.4))+.7152*(W[1]<=.03928?W[1]/12.92:Math.pow((W[1]+.055)/1.055,2.4))+.0722*(W[2]<=.03928?W[2]/12.92:Math.pow((W[2]+.055)/1.055,2.4)),A=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),C=c.properties.get("intensity"),P=c.properties.get("direction"),O=1-a.d3(P.x,P.y,P.z)[2]/90,B=b(A)*C*O,G=p.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=p.properties.get("intensity"),Y=b(G)*j;return Number(((B+Y)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const c=[];return this.directionalLight&&c.push(this.directionalLight.get()),this.ambientLight&&c.push(this.ambientLight.get()),c}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(c){if(c==null||c===""&&this.isRootStyle())return this;if(a.dq(c)){const p=a.dr(c),b=this.fragments.find(({id:C})=>C===p);if(!b)return;const A=a.dp(c);return b.style.getFragmentStyle(A)}{const p=this.fragments.find(({id:b})=>b===c);return p?p.style:void 0}}setFeaturesetSelectors(c){if(!c)return;const p={},b=(A,C="")=>`${A}::${C}`;this._featuresetSelectors={};for(const A in c){const C=this._featuresetSelectors[A]=[];for(const P of c[A].selectors){if(P.featureNamespace){const B=this.getOwnLayer(P.layer);if(!B){a.w(`Layer is undefined for selector: ${P.layer}`);continue}const G=b(B.source,B.sourceLayer);if(G in p&&p[G]!==P.featureNamespace){a.w(`"featureNamespace ${P.featureNamespace} of featureset ${A}'s selector is not associated to the same source, skip this selector`);continue}p[G]=P.featureNamespace}let O;if(P.properties)for(const B in P.properties){const G=a.U(P.properties[B]);G.result==="success"&&(O=O||{},O[B]=G.value)}C.push({layerId:P.layer,namespace:P.featureNamespace,properties:O,uniqueFeatureID:P._uniqueFeatureID})}}}getFeaturesetDescriptors(c){const p=this.getFragmentStyle(c);if(!p||!p.stylesheet.featuresets)return[];const b=[];for(const A in p.stylesheet.featuresets)b.push({featuresetId:A,importId:p.scope?p.scope:void 0});return b}getFeaturesetLayers(c,p){const b=this.getFragmentStyle(p),A=b.stylesheet.featuresets;if(!A||!A[c])return this.fire(new a.y(new Error(`The featureset '${c}' does not exist in the map's style and cannot be queried.`))),[];const C=[];for(const P of A[c].selectors){const O=b.getOwnLayer(P.layer);O&&C.push(O)}return C}getConfigProperty(c,p){const b=this.getFragmentStyle(c);if(!b)return null;const A=a.B(p,b.scope),C=b.options.get(A),P=C?C.value||C.default:null;return P?P.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(c,p){const b=a.B(c,p);return this._mergedIndoor[b]}setIndoorData(c,p){this.map.indoor.setIndoorData(p)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(c,p,b){const A=this.getFragmentStyle(c);if(!A)return;const C=A.stylesheet.schema;if(!C||!C[p])return;const P=a.U(b);if(P.result!=="success")return void Iu(this,P.value);const O=P.value.expression,B=a.B(p,A.scope),G=A.options.get(B);if(!G)return;let j;const{minValue:Y,maxValue:W,stepValue:J,type:tt,values:nt}=C[p],ut=a.U(C[p].default);ut.result==="success"&&(j=ut.value.expression),j?(this.options.set(B,Object.assign({},G,{value:O,default:j,minValue:Y,maxValue:W,stepValue:J,type:tt,values:nt})),this.updateConfigDependencies(p)):this.fire(new a.y(new Error(`No schema defined for the config option "${p}" in the "${c}" fragment.`)))}getConfig(c){const p=this.getFragmentStyle(c);if(!p)return null;const b=p.stylesheet.schema;if(!b)return null;const A={};for(const C in b){const P=a.B(C,p.scope),O=p.options.get(P),B=O?O.value||O.default:null;A[C]=B?B.serialize():null}return A}setConfig(c,p){const b=this.getFragmentStyle(c);b&&(b.updateConfig(p,b.stylesheet.schema),this.updateConfigDependencies())}getSchema(c){const p=this.getFragmentStyle(c);return p?p.stylesheet.schema:null}setSchema(c,p){const b=this.getFragmentStyle(c);b&&(b.stylesheet.schema=p,b.updateConfig(b._config,p),this.updateConfigDependencies())}updateConfig(c,p){if(this._config=c,c||p)if(p)for(const b in p){let A,C;const P=a.U(p[b].default);if(P.result==="success"&&(A=P.value.expression),c&&c[b]!==void 0){const W=a.U(c[b]);W.result==="success"&&(C=W.value.expression)}const{minValue:O,maxValue:B,stepValue:G,type:j,values:Y}=p[b];if(A){const W=a.B(b,this.scope);this.options.set(W,{default:A,value:C,minValue:O,maxValue:B,stepValue:G,type:j,values:Y})}else this.fire(new a.y(new Error(`No schema defined for config option "${b}".`)))}else this.fire(new a.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(c,p=()=>!0){for(const b of c){const A=this.getLayer(b);A&&p(A)&&(A.possiblyEvaluateVisibility(),this._updateLayer(A),this._changes.setDirty())}}updateConfigDependencies(c){this._updateLayers(this._configDependentLayers,p=>!c||p.expressionDependencies.configDependencies.has(c)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(p=>{const b=p._styleColorTheme.colorThemeOverride?p._styleColorTheme.colorThemeOverride:p._styleColorTheme.colorTheme;if(b){const A=p._evaluateColorThemeData(b);(!p._styleColorTheme.lut&&A!==""||p._styleColorTheme.lut&&A!==p._styleColorTheme.lut.data)&&p.setColorTheme(b)}}),this._changes.setDirty()}addLayer(c,p,b={}){this._checkLoaded();const A=c.id;if(this._layers[A])return void this.fire(new a.y(new Error(`Layer with id "${A}" already exists on this map`)));let C;if(c.type==="custom"){if(Iu(this,a.ds(c)))return;C=a.dt(c,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof c.source=="object"&&(this.addSource(A,c.source),c=a.dn(c),c=Object.assign(c,{source:A})),this._validate(Zp,`layers.${A}`,c,{arrayIndex:-1},b))return;C=a.dt(c,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(C),C.setEventedParent(this,{layer:{id:A}})}const P=a.B(C.source,C.scope);C.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P),C.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P);let O=this._order.length;if(p){const Y=this._order.indexOf(p);if(Y===-1)return void this.fire(new a.y(new Error(`Layer with id "${p}" does not exist on this map.`)));C.slot===this._layers[p].slot?O=Y:a.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(O,0,A),this._layerOrderChanged=!0,this._layers[A]=C;const B=this.getOwnLayerSourceCache(C),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&C.canCastShadows()&&G&&(B.castsShadows=!0);const j=this._changes.getRemovedLayer(C);if(j&&C.source&&B&&C.type!=="custom"){this._changes.discardLayerRemoval(C);const Y=a.B(C.source,C.scope);j.type!==C.type?this._changes.updateSourceCache(Y,"clear"):(this._changes.updateSourceCache(Y,"reload"),B.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),C.scope=this.scope,this.mergeLayers()}moveLayer(c,p){this._checkLoaded();const b=this._checkLayer(c);if(!b||c===p)return;const A=this._order.indexOf(c);this._order.splice(A,1);let C=this._order.length;if(p){const P=this._order.indexOf(p);if(P===-1)return void this.fire(new a.y(new Error(`Layer with id "${p}" does not exist on this map.`)));b.slot===this._layers[p].slot?C=P:a.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,c),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(c){this._checkLoaded();const p=this._checkLayer(c);if(!p)return;p.setEventedParent(null);const b=this._order.indexOf(c);this._order.splice(b,1),delete this._layers[c],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(p.fqid),this._indoorDependentLayers.delete(p.fqid),this._changes.removeLayer(p);const A=this.getOwnLayerSourceCache(p);if(A&&A.castsShadows){let C=!1;for(const P in this._layers)if(this._layers[P].source===p.source&&this._layers[P].canCastShadows()){C=!0;break}A.castsShadows=C}p.onRemove&&p.onRemove(this.map),this.mergeLayers()}getOwnLayer(c){return this._layers[c]}hasLayer(c){return c in this._mergedLayers}hasLayerType(c){for(const p in this._layers)if(this._layers[p].type===c)return!0;return!1}setLayerZoomRange(c,p,b){this._checkLoaded();const A=this._checkLayer(c);A&&(A.minzoom===p&&A.maxzoom===b||(p!=null&&(A.minzoom=p),b!=null&&(A.maxzoom=b),this._updateLayer(A)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(c,p){this._checkLoaded();const b=this._checkLayer(c);b&&b.slot!==p&&(b.slot=p,this._updateLayer(b))}setFilter(c,p,b={}){this._checkLoaded();const A=this._checkLayer(c);if(A&&!a.bx(A.filter,p))return p==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(wr,`layers.${A.id}.filter`,p,{layerType:A.type},b)||(A.filter=a.dn(p),this._updateLayer(A)))}getFilter(c){const p=this._checkLayer(c);if(p)return a.dn(p.filter)}setLayoutProperty(c,p,b,A={}){this._checkLoaded();const C=this._checkLayer(c);if(C&&!a.bx(C.getLayoutProperty(p),b)){if(b!=null&&(!A||A.validate!==!1)&&Iu(C,Q0.call(Gs,{key:`layers.${c}.layout.${p}`,layerType:C.type,objectKey:p,value:b,styleSpec:a.a6,style:{glyphs:!0,sprite:!0}})))return;C.setLayoutProperty(p,b),C.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),C.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(C.fqid),this._updateLayer(C)}}setLayerProperty(c,p,b,A={}){this._checkLoaded();const C=this._checkLayer(c);C&&(p==="appearances"?(C.setAppearances(b),this._changes.setDirty()):C.isPaintProperty(p)?this.setPaintProperty(c,p,b,A):this.setLayoutProperty(c,p,b,A))}getLayoutProperty(c,p){const b=this._checkLayer(c);if(b)return b.getLayoutProperty(p)}setPaintProperty(c,p,b,A={}){this._checkLoaded();const C=this._checkLayer(c);if(!C||a.bx(C.getPaintProperty(p),b)||b!=null&&(!A||A.validate!==!1)&&Iu(C,Fo.call(Gs,{key:`layers.${c}.paint.${p}`,layerType:C.type,objectKey:p,value:b,styleSpec:a.a6})))return;const P=C.setPaintProperty(p,b);C.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),C.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(C.fqid),P&&this._updateLayer(C),this._changes.updatePaintProperties(C)}getPaintProperty(c,p){const b=this._checkLayer(c);if(b)return b.getPaintProperty(p)}setFeatureState(c,p){if(this._checkLoaded(),"target"in c){if("featuresetId"in c.target){const{featuresetId:B,importId:G}=c.target,j=this.getFragmentStyle(G),Y=j.getFeaturesetLayers(B);for(const{source:W,sourceLayer:J}of Y)j.setFeatureState({id:c.id,source:W,sourceLayer:J},p)}else if("layerId"in c.target){const{layerId:B}=c.target,G=this.getLayer(B);this.setFeatureState({id:c.id,source:G.source,sourceLayer:G.sourceLayer},p)}return}const b=c.source,A=c.sourceLayer,C=this._checkSource(b);if(!C)return;const P=C.type;if(P==="geojson"&&A)return void this.fire(new a.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(P==="vector"&&!A)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided.")));const O=this.getOwnSourceCaches(b);for(const B of O)B.setFeatureState(A,c.id,p)}removeFeatureState(c,p){if(this._checkLoaded(),"target"in c){if("featuresetId"in c.target){const{featuresetId:B,importId:G}=c.target,j=this.getFragmentStyle(G),Y=j.getFeaturesetLayers(B);for(const{source:W,sourceLayer:J}of Y)j.removeFeatureState({id:c.id,source:W,sourceLayer:J},p)}else if("layerId"in c.target){const{layerId:B}=c.target,G=this.getLayer(B);this.removeFeatureState({id:c.id,source:G.source,sourceLayer:G.sourceLayer},p)}return}const b=c.source,A=this._checkSource(b);if(!A)return;const C=A.type,P=C==="vector"?c.sourceLayer:void 0;if(C==="vector"&&!P)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new a.y(new Error("A feature id is required to remove its specific state property.")));const O=this.getOwnSourceCaches(b);for(const B of O)B.removeFeatureState(P,c.id,p)}getFeatureState(c){if(this._checkLoaded(),"target"in c){let C;if("featuresetId"in c.target){const{featuresetId:P,importId:O}=c.target,B=this.getFragmentStyle(O),G=B.getFeaturesetLayers(P);for(const{source:j,sourceLayer:Y}of G){const W=B.getFeatureState({id:c.id,source:j,sourceLayer:Y});if(W&&!C)C=W;else if(!a.bx(C,W))return void this.fire(new a.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in c.target){const{layerId:P}=c.target,O=this.getLayer(P);C=this.getFeatureState({id:c.id,source:O.source,sourceLayer:O.sourceLayer})}return C}const p=c.source,b=c.sourceLayer,A=this._checkSource(p);if(A){if(A.type!=="vector"||b)return c.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(p)[0].getFeatureState(b,c.id);this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(c){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,c),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const c=this.getTerrain(),p=c&&this.terrain&&this.terrain.scope===this.scope?c:this.stylesheet.terrain;return a.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:p,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},b=>b!==void 0)}_updateFilteredLayers(c){for(const p of Object.values(this._mergedLayers))c(p)&&this._updateLayer(p)}_updateLayer(c){this._changes.updateLayer(c);const p=this.getLayerSourceCache(c),b=a.B(c.source,c.scope),A=this._changes.getUpdatedSourceCaches();c.source&&!A[b]&&p&&p.getSource().type!=="raster"&&(this._changes.updateSourceCache(b,"reload"),p.pause()),c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const p=O=>this._mergedLayers[O].is3D(!!this.terrain),b=this.order,A={},C=[];for(let O=b.length-1;O>=0;O--){const B=b[O];if(p(B)){A[B]=O;for(const G of c){const j=G[B];if(j)for(const Y of j)C.push(Y)}}}C.sort((O,B)=>B.intersectionZ-O.intersectionZ);const P=[];for(let O=b.length-1;O>=0;O--){const B=b[O];if(p(B))for(let G=C.length-1;G>=0;G--){const j=C[G].feature;if(j.layer&&A[j.layer.id]<O)break;P.push(j),C.pop()}else for(const G of c){const j=G[B];if(j)for(const Y of j)P.push(Y.feature)}}return P}queryRasterValue(c,p,b){const A=this.getOwnSource(c);return A?A.type!=="raster-array"?(this.fire(new a.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):A.queryRasterArrayValue(p,b):(this.fire(new a.y(new Error(`Source with id "${c}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(c,p,b){let A;p&&!Array.isArray(p)&&p.filter&&(this._validate(wr,"queryRenderedFeatures.filter",p.filter,null,p),A=a.b5(p.filter));const C={},P=j=>{if(Wv.has(j.type))return;const Y=this.getOwnLayerSourceCache(j),W=C[Y.id]=C[Y.id]||{sourceCache:Y,layers:{},has3DLayers:!1};j.is3D(!!this.terrain)&&(W.has3DLayers=!0),W.layers[j.fqid]=W.layers[j.fqid]||{styleLayer:j,targets:[]},W.layers[j.fqid].targets.push({filter:A})};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new a.y(new Error("parameters.layers must be an Array."))),[];for(const j of p.layers){const Y=this._layers[j];if(!Y)return this.fire(new a.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];P(Y)}}else for(const j in this._layers)P(this._layers[j]);const O=this._queryRenderedFeatures(c,C,b),B=this._flattenAndSortRenderedFeatures(O),G=[];for(const j of B)a.dv(j.layer.id)===this.scope&&G.push(j);return G}queryRenderedFeatureset(c,p,b){let A;p&&!Array.isArray(p)&&p.filter&&(this._validate(wr,"queryRenderedFeatures.filter",p.filter,null,p),A=a.b5(p.filter));const C="mock",P=[];if(p&&p.target)P.push(Object.assign({},p,{targetId:C,filter:A}));else{const j=this.getFeaturesetDescriptors();for(const Y of j)P.push({targetId:C,filter:A,target:Y});for(const{style:Y}of this.fragments){const W=Y.getFeaturesetDescriptors();for(const J of W)P.push({targetId:C,filter:A,target:J})}}const O=this.queryRenderedTargets(c,P,b),B=[],G=new Set;for(const j of O)for(const Y of j.variants[C])bs(Y,j,G)||B.push(new a.dw(j,Y));return B}queryRenderedTargets(c,p,b){const A={},C=(O,B,G,j)=>{const Y=A[B.id]=A[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};if(Y.layers[O.fqid]=Y.layers[O.fqid]||{styleLayer:O,targets:[]},O.is3D(!!this.terrain)&&(Y.has3DLayers=!0),!j)return G.uniqueFeatureID=!1,void Y.layers[O.fqid].targets.push(G);Y.layers[O.fqid].targets.push(Object.assign({},G,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const O of p)if("featuresetId"in O.target){const{featuresetId:B,importId:G}=O.target,j=this.getFragmentStyle(G);if(!j||!j._featuresetSelectors)continue;const Y=j._featuresetSelectors[B];if(!Y){this.fire(new a.y(new Error(`The featureset '${B}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const W of Y){const J=j.getOwnLayer(W.layerId);J&&!Wv.has(J.type)&&C(J,j.getOwnLayerSourceCache(J),O,W)}}else if("layerId"in O.target){const{layerId:B}=O.target,G=this.getLayer(B);if(!G||Wv.has(G.type))continue;C(G,this.getLayerSourceCache(G),O)}const P=this._queryRenderedFeatures(c,A,b);return this._flattenAndSortRenderedFeatures(P)}_queryRenderedFeatures(c,p,b){const A=[],C=!!this.map._showQueryGeometry,P=en.createFromScreenPoints(c,b);for(const O in p){const B=ws(P,p[O],this._availableImages,b,C);Object.keys(B).length&&A.push(B)}if(this.placement)for(const O in p){if(!p[O].sourceCache._onlySymbols)continue;const B=Ov(P.screenGeometry,p[O],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(B).length&&A.push(B)}return A}querySourceFeatures(c,p){const b=p&&p.filter;b&&this._validate(wr,"querySourceFeatures.filter",b,null,p);let A=[];const C=this.getOwnSourceCaches(c);for(const P of C)A=A.concat(Xp(P,p));return A}addSourceType(c,p,b){return wl.getSourceType(c)?b(new Error(`A source type called "${c}" already exists.`)):(wl.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},b):b(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(c,p,b={}){this._checkLoaded();const A=this.light.getLight();let C=!1;for(const O in c)if(!a.bx(c[O],A[O])){C=!0;break}if(!C)return;const P=this._getTransitionParameters();this.light.setLight(c,p,b),this.light.updateTransitions(P)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(c,p=1){if(this._checkLoaded(),!c)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),p===0&&delete this.terrain,c===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let b=c;const A=c.source==null;if(p===1){if(this.disableElevatedTerrain)return;if(typeof b.source=="object"){const O="terrain-dem-src";this.addSource(O,b.source),b=a.dn(b),b=Object.assign(b,{source:O})}const C=Object.assign({},b),P={};if(this.terrain&&A){C.source=this.terrain.get().source;const O=this.terrain?this.getFragmentStyle(this.terrain.scope):null;O&&(P.style=O.serialize())}if(this._validate(jd,"terrain",C,P))return}if(!this.terrain||this.terrain.scope!==this.scope&&!A||this.terrain&&p!==this.terrain.drapeRenderMode){if(!b)return;this._createTerrain(b,p),this.fire(new a.z("data",{dataType:"style"}))}else{const C=this.terrain,P=C.get();for(const O of Object.keys(a.a6.terrain))!b.hasOwnProperty(O)&&a.a6.terrain[O].default&&(b[O]=a.a6.terrain[O].default);for(const O in c)if(!a.bx(c[O],P[O])){C.set(c,this.options),this.stylesheet.terrain=c;const B=this._getTransitionParameters({duration:0});C.updateTransitions(B),this.fire(new a.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const p=this.fog=new Mi(c,this.map.transform,this.scope,this.options);this.stylesheet.fog=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}_createSnow(c){const p=this.snow=new ba(c,this.map.transform,this.scope,this.options);this.stylesheet.snow=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}_createRain(c){const p=this.rain=new aa(c,this.map.transform,this.scope,this.options);this.stylesheet.rain=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog;if(!a.bx(p.get(),c)){p.set(c,this.options),this.stylesheet.fog=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}}else this._createFog(c);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(c){if(this._checkLoaded(),!c)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const p=this.snow;if(!a.bx(p.get(),c)){p.set(c,this.options),this.stylesheet.snow=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}}else this._createSnow(c);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(c){if(this._checkLoaded(),!c)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const p=this.rain;if(!a.bx(p.get(),c)){p.set(c,this.options),this.stylesheet.rain=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}}else this._createRain(c);this._markersNeedUpdate=!0}_reloadColorTheme(){const c=()=>{for(const A in this._layers)this._layers[A].lut=this._styleColorTheme.lut;for(const A in this._sourceCaches)this._sourceCaches[A].clearTiles()},p=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!p)return this._styleColorTheme.lut=null,void c();const b=this._evaluateColorThemeData(p);this._loadColorTheme(b).then(()=>{this.fire(new a.z("colorthemeset")),c()}).catch(A=>{a.w(`Couldn't set color theme: ${A}`)})}setColorTheme(c){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=c,this._reloadColorTheme()}setImportColorTheme(c,p){const b=this.getFragmentStyle(c);b&&(b._styleColorTheme.colorThemeOverride=p,b._reloadColorTheme())}_getTransitionParameters(c){return{now:a.o.now(),transition:Object.assign(this.transition,c)}}updateDrapeFirstLayers(){if(!this.terrain)return;const c=[],p=[];for(const b of this._mergedOrder)this.isLayerDraped(this._mergedLayers[b])?c.push(b):p.push(b);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...p)}_createTerrain(c,p){const b=this.terrain=new Wt(c,p,this.scope,this.options,this.map.getWorldview());p===1&&(this.stylesheet.terrain=c),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const A=this._getTransitionParameters({duration:0});b.updateTransitions(A)}_force3DLayerUpdate(){for(const c in this._layers){const p=this._layers[c];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const p=this._layers[c];p.type==="symbol"&&this._updateLayer(p)}}_validate(c,p,b,A,C={}){if(C&&C.validate===!1)return!1;const P=Object.assign({},this.serialize());return Iu(this,c.call(Gs,Object.assign({key:p,style:P,value:b,styleSpec:a.a6},A)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._mergedLayers)this._mergedLayers[c].setEventedParent(null);for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles(),this._mergedSourceCaches[c].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(c){const p=this.getSourceCaches(c);for(const b of p)b.clearTiles()}clearSources(){for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles()}clearLayers(){for(const c in this._mergedLayers){const p=this._mergedLayers[c];p._clear&&p._clear()}}reloadSource(c){const p=this.getSourceCaches(c);for(const b of p)b.resume(),b.reload()}reloadSources(){for(const c of this.getSources())c.reload&&c.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(c=>{c.modelManager.reloadModels(c.scope)})}updateSources(c){let p;this.directionalLight&&(p=eT(this.directionalLight));const b=new Set;for(const A in this._mergedLayers){const C=this._mergedLayers[A];C.hasElevation()&&!b.has(C.source)&&b.add(C.source)}for(const A in this._mergedSourceCaches){const C=this._mergedSourceCaches[A],P=b.has(C._source.id);C.update(c,void 0,void 0,p,P)}}_generateCollisionBoxes(){for(const c in this._sourceCaches){const p=this._sourceCaches[c];p.resume(),p.reload()}}_updatePlacement(c,p,b,A,C,P,O=!1){let B=!1,G=!1;const j={},Y={};for(const W of this._mergedOrder){const J=this._mergedLayers[W];if(J.type!=="symbol")continue;const tt=a.B(J.source,J.scope);let nt=j[tt];if(!nt){const st=this.getLayerSourceCache(J);if(!st)continue;const pt=st.getRenderableIds(!0).map(xt=>st.getTileByID(xt));Y[tt]=pt.slice(),nt=j[tt]=pt.sort((xt,vt)=>vt.tileID.overscaledZ-xt.tileID.overscaledZ||(xt.tileID.isLessThan(vt.tileID)?-1:1))}const ut=this.crossTileSymbolIndex.addLayer(J,nt,p.center.lng,p.projection);B=B||ut}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),O=O||this._layerOrderChanged||A===0,this._layerOrderChanged&&this.fire(new a.z("neworder")),(O||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.o.now(),p.zoom))&&(this.pauseablePlacement=new cs(p,this._mergedOrder,O,b,A,C,this.placement,this.fog&&p.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,Y,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.o.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B){this._buildingIndex.onNewFrame(p.zoom);for(let W=0;W<this._mergedOrder.length;W++){const J=this._mergedLayers[this._mergedOrder[W]];if(J.type!=="symbol")continue;const tt=this.isLayerClipped(J);this.placement.updateLayerOpacities(J,j[a.B(J.source,J.scope)],W,tt?P:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.o.now())}}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}addImport(c,p){this._checkLoaded();const b=this.stylesheet.imports=this.stylesheet.imports||[];if(b.findIndex(({id:C})=>C===c.id)!==-1)return void this.fire(new a.y(new Error(`Import with id '${c.id}' already exists in the map's style.`)));if(!p)return b.push(c),this._loadImports([c],!0);const A=b.findIndex(({id:C})=>C===p);return A===-1&&this.fire(new a.y(new Error(`Import with id "${p}" does not exist on this map.`))),this.stylesheet.imports=b.slice(0,A).concat(c).concat(b.slice(A)),this._loadImports([c],!0,p)}updateImport(c,p){this._checkLoaded();const b=this.stylesheet.imports||[],A=this.getImportIndex(c);return A===-1?this:typeof p=="string"?(this.setImportUrl(c,p),this):(p.url&&p.url!==b[A].url&&this.setImportUrl(c,p.url),a.bx(p.config,b[A].config)||this.setImportConfig(c,p.config,p.data.schema),a.bx(p.data,b[A].data)||this.setImportData(c,p.data),this)}moveImport(c,p){this._checkLoaded();let b=this.stylesheet.imports||[];const A=this.getImportIndex(c);if(A===-1)return this;const C=this.getImportIndex(p);if(C===-1)return this;const P=b[A],O=this.fragments[A];return b=b.filter(({id:B})=>B!==c),this.fragments=this.fragments.filter(({id:B})=>B!==c),this.stylesheet.imports=b.slice(0,C).concat(P).concat(b.slice(C)),this.fragments=this.fragments.slice(0,C).concat(O).concat(this.fragments.slice(C)),this.mergeLayers(),this}setImportUrl(c,p){this._checkLoaded();const b=this.stylesheet.imports||[],A=this.getImportIndex(c);if(A===-1)return this;b[A].url=p;const C=this.fragments[A];return C.style=this._createFragmentStyle(b[A]),C.style.on("style.import.load",()=>this.mergeAll()),C.style.loadURL(p),this}setImportData(c,p){this._checkLoaded();const b=this.getImportIndex(c),A=this.stylesheet.imports||[];return b===-1?this:p?(this.fragments[b].style.setState(p),this._reloadImports(),this):(delete A[b].data,this.setImportUrl(c,A[b].url))}setImportConfig(c,p,b){this._checkLoaded();const A=this.getImportIndex(c),C=this.stylesheet.imports||[];if(A===-1)return this;p?C[A].config=p:delete C[A].config;const P=this.fragments[A];b&&P.style.stylesheet&&(P.style.stylesheet.schema=b);const O=P.style.stylesheet&&P.style.stylesheet.schema;return P.config=p,P.style.updateConfig(p,O),this.updateConfigDependencies(),this}removeImport(c){this._checkLoaded();const p=this.stylesheet.imports||[],b=this.getImportIndex(c);b!==-1&&(p.splice(b,1),this.fragments[b].style._remove(),this.fragments.splice(b,1),this._reloadImports())}getImportIndex(c){const p=(this.stylesheet.imports||[]).findIndex(b=>b.id===c);return p===-1&&this.fire(new a.y(new Error(`Import '${c}' does not exist in the map's style and cannot be updated.`))),p}getLayer(c){return this._mergedLayers[c]}getSources(){const c=[];for(const p in this._mergedOtherSourceCaches){const b=this._mergedOtherSourceCaches[p];b&&c.push(b.getSource())}return c}getSource(c,p){const b=this.getSourceCache(c,p);return b&&b.getSource()}getLayerSource(c){const p=this.getLayerSourceCache(c);return p&&p.getSource()}getSourceCache(c,p){const b=a.B(c,p);return this._mergedOtherSourceCaches[b]}getLayerSourceCache(c){const p=a.B(c.source,c.scope);return c.type==="symbol"?this._mergedSymbolSourceCaches[p]:this._mergedOtherSourceCaches[p]}getSourceCaches(c){if(c==null)return Object.values(this._mergedSourceCaches);const p=[];return this._mergedOtherSourceCaches[c]&&p.push(this._mergedOtherSourceCaches[c]),this._mergedSymbolSourceCaches[c]&&p.push(this._mergedSymbolSourceCaches[c]),p}updateSourceCaches(){const c=this._changes.getUpdatedSourceCaches();for(const p in c){const b=c[p];b==="reload"?this.reloadSource(p):b==="clear"&&this.clearSource(p)}}updateLayers(c){const p=this._changes.getUpdatedPaintProperties();for(const b of p){const A=this.getLayer(b);A&&A.updateTransitions(c)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(c){this.stylesheet.glyphs=c,this.glyphManager.setURL(c)}getImages(c,p,b){this.imageManager.getImages(p.images,p.scope,b),this._updateTilesForChangedImages();const A=P=>{if(P){const O=p.images.map(B=>a.I.toString(B));P.setDependencies(p.tileID.key,p.type,O)}},C=a.B(p.source,p.scope);A(this._mergedOtherSourceCaches[C]),A(this._mergedSymbolSourceCaches[C]),p.images.some(P=>P.iconsetId)&&this.fire(new a.z("data",{dataType:"style"}))}rasterizeImages(c,p,b){this.imageManager.rasterizeImages(p,b)}getGlyphs(c,p,b){this.glyphManager.getGlyphs(p.stacks,b)}getResource(c,p,b){return a.dy(p,b)}getOwnSourceCache(c){return this._otherSourceCaches[c]}getOwnLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}getOwnSourceCaches(c){const p=[];return this._otherSourceCaches[c]&&p.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&p.push(this._symbolSourceCaches[c]),p}_isSourceCacheLoaded(c){const p=this.getOwnSourceCaches(c);return p.length===0?(this.fire(new a.y(new Error(`There is no source with ID '${c}'`))),!1):p.every(b=>b.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(c,p){if(!this._clipLayerPresent&&c.type!=="fill-extrusion"&&c.type!=="building")return!1;const b=c.type==="fill-extrusion"&&(c.sourceLayer==="building"||c.sourceLayer==="procedural_buildings"),A=c.type==="building";if(c.is3D(!!this.terrain)){if(b||A||p&&p.type==="batched-model"||c.type==="model")return!0}else if(c.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(c=>{c.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}wl.getSourceType=function(x){return vl[x]},wl.setSourceType=function(x,c){vl[x]=c},wl.registerForPluginStateChange=a.dz;class Oh extends a.E{constructor(c){super(),this._style=c,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},a.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(c){c===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=c,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(c){this._activeFloorsVisible=c,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(c){for(const[p,b]of Object.entries(c.buildings))if(this._buildings[p])for(const A of b.floorIds)this._buildings[p].floors[A]||(this._buildings[p].floors[A]=b.floors[A]);else this._buildings[p]=b;for(const p of c.activeFloors)this._activeFloors.add(p);this._updateIndoorSelector()}getIndoorTileOptions(c,p){const b=this._style.getIndoorSourceLayers(c,p);return b&&this._indoorState?{sourceLayers:b,indoorState:this._indoorState}:null}_updateUI(c,p,b){const A=function(C,P,O,B){let G=null,j=Number.MAX_SAFE_INTEGER;if(B<16)return null;for(const[Y,W]of Object.entries(C)){const J=W.center;if(J){const tt=P.distanceTo(a.aS.convert(J));tt<j&&O.contains(J)&&(j=tt,G=Y)}}return G}(this._buildings,p,b,c);A!==this._closestBuildingId&&(this._closestBuildingId=A,this._updateIndoorSelector())}_updateIndoorSelector(){const c=this._buildings,p=this._closestBuildingId,b=p&&c?c[p]:void 0;if(!b)return void this.fire(new a.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let A=null;for(const P of b.floorIds)if(this._activeFloors&&this._activeFloors.has(P)){A=P;break}const C=Array.from(b.floorIds).map(P=>({id:P,name:b.floors[P].name,zIndex:b.floors[P].zIndex})).sort((P,O)=>O.zIndex-P.zIndex);this.fire(new a.z("selector-update",{selectedFloorId:A,activeFloorsVisible:this._activeFloorsVisible,floors:C}))}_updateActiveFloors(){const c=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:c,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var mg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,px=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,gx=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Jd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,mx=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,$v=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ws=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Zv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ne=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,vx=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const tf=[];Sl(mg,tf),Sl(gx,tf),Sl(px,tf);const ef={"_prelude_fog.vertex.glsl":mx,"_prelude_terrain.vertex.glsl":Qd,"_prelude_shadow.vertex.glsl":Ne,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":$v,"_prelude_shadow.fragment.glsl":vx,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ws,"_prelude_raster_particle.glsl":Zv},vg={};_r("",Qd),_r($v,mx),_r(vx,Ne),_r(Ws,""),_r(Zv,"");const _g=_r(px,gx),uc=mg;var qv={background:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:_r(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:_r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:_r("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_r(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:_r(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:_r("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:_r("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:_r("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:_r(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:_r(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:_r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:_r(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:_r(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:_r(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:_r("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:_r("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:_r(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:_r(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:_r("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:_r(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jd),skyboxGradient:_r(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jd),skyboxCapture:_r(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:_r(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:_r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:_r(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:_r("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:_r("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:_r("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:_r("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Sl(x,c){const p=x.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let b of p)if(b=b.trim(),b[0]==="#"&&b.includes("if")&&!b.includes("endif")){b=b.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const A=b.split(" ");for(const C of A)c.includes(C)||c.push(C)}}function _r(x,c){const p=/#include\s+"([^"]+)"/g,b=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,A={},C=[],P=[];if(x=x.replace(p,(B,G)=>(P.push(G),"")),(c=c.replace(p,(B,G)=>(C.push(G),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...tf];Sl(x,O),Sl(c,O);for(const B of[...C,...P])ef[B]||console.error(`Undefined include: ${B}`),vg[B]||(vg[B]=[],Sl(ef[B],vg[B])),O=[...O,...vg[B]];return{fragmentSource:x=x.replace(b,(B,G,j,Y,W)=>(A[W]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${j} ${Y} ${W};
#else
uniform ${j} ${Y} u_${W};
#endif
`:G==="initialize"?`
#ifdef HAS_UNIFORM_u_${W}
    ${j} ${Y} ${W} = u_${W};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${j} ${Y} ${W};
#endif
`:G==="initialize-attribute"?"":void 0)),vertexSource:c=c.replace(b,(B,G,j,Y,W)=>{const J=`MATERIAL_ATTRIBUTE_OFFSET_${W}`,tt=Y==="float"?"vec2":Y,nt=`GET_ATTRIBUTE_${tt}(a_${W}, materialInfo, ${J})`,ut=W.match(/color/)?"color":tt;return G==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${W}
in ${j} ${Y} a_${W};
#endif
`:A[W]?G==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
    #if !defined(${J})
        in ${j} ${tt} a_${W};
    #endif
out ${j} ${Y} ${W};
#else
uniform ${j} ${Y} u_${W};
#endif
`:G==="initialize"?ut==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${j} ${Y} ${W} = u_${W};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${W}) 
    #ifdef ${J}
        ${W} = unpack_mix_${ut}(${nt}, u_${W}_t);
    #else
        ${W} = unpack_mix_${ut}(a_${W}, u_${W}_t);
    #endif
#else
    ${j} ${Y} ${W} = u_${W};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${j} ${Y} a_${W};
    out ${j} ${Y} ${W};
#endif
`:G==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${W} = a_${W};
#endif
`:void 0:G==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
    #if !defined(${J})
        in ${j} ${tt} a_${W};
    #endif  
#else
uniform ${j} ${Y} u_${W};
#endif
`:G==="define-instanced"?ut==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${W}0;
in vec4 a_${W}1;
in vec4 a_${W}2;
in vec4 a_${W}3;
#else
uniform ${j} ${Y} u_${W};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${tt} a_${W};
#else
uniform ${j} ${Y} u_${W};
#endif
`:G==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${j} ${Y} ${W} = a_${W};
#endif
`:ut==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    #ifdef ${J}
        ${j} ${Y} ${W} = ${nt};
    #else
        ${j} ${Y} ${W} = a_${W};
    #endif
#else
    ${j} ${Y} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    #ifdef ${J}
        ${j} ${Y} ${W} = unpack_mix_${ut}(${nt}, u_${W}_t);
    #else
        ${j} ${Y} ${W} = unpack_mix_${ut}(a_${W}, u_${W}_t);
    #endif
#else
    ${j} ${Y} ${W} = u_${W};
#endif
`}),usedDefines:O,vertexIncludes:C,fragmentIncludes:P}}class rf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,p,b,A,C,P,O,B){this.context=c;let G=this.boundPaintVertexBuffers.length!==A.length;for(let Y=0;!G&&Y<A.length;Y++)this.boundPaintVertexBuffers[Y]!==A[Y]&&(G=!0);let j=this.boundDynamicVertexBuffers.length!==O.length;for(let Y=0;!j&&Y<O.length;Y++)this.boundDynamicVertexBuffers[Y]!==O[Y]&&(j=!0);if(!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==b||G||j||this.boundIndexBuffer!==C||this.boundVertexOffset!==P)this.freshBind(p,b,A,C,P,O,B);else{c.bindVertexArrayOES.set(this.vao);for(const Y of O)Y&&(Y.bind(),B&&Y.instanceCount&&Y.setVertexAttribDivisor(c.gl,p,B));C&&C.dynamicDraw&&C.bind()}}freshBind(c,p,b,A,C,P,O){const B=this.context,G=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=A,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=P,p.enableAttributes(G,c),p.bind(),p.setVertexAttribPointers(G,c,C);for(const j of b)j.enableAttributes(G,c),j.bind(),j.setVertexAttribPointers(G,c,C);for(const j of P)j&&(j.enableAttributes(G,c),j.bind(),j.setVertexAttribPointers(G,c,C),O&&j.instanceCount&&j.setVertexAttribDivisor(G,c,O));A&&A.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function GE(x,c){const p=Math.pow(2,c.canonical.z),b=c.canonical.y;return[new a.ae(0,b/p).toLngLat().lat,new a.ae(0,(b+1)/p).toLngLat().lat]}function HE(x,c,p,b,A,C,P){const O=x.context,B=O.gl,G=p.hillshadeFBO;if(!G)return;x.prepareDrawTile();const j=x.isTileAffectedByFog(c),Y=x.getOrCreateProgram("hillshade",{overrideFog:j});O.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get());const W=((ut,st,pt,xt)=>{const vt=pt.paint.get("hillshade-shadow-color"),Et=pt.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",bt=pt.paint.get("hillshade-highlight-color"),Pt=pt.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Mt=pt.paint.get("hillshade-accent-color"),Tt=pt.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Lt=pt.paint.get("hillshade-emissive-strength");let qt=a.an(pt.paint.get("hillshade-illumination-direction"));if(pt.paint.get("hillshade-illumination-anchor")==="viewport")qt-=ut.transform.angle;else if(ut.style&&ut.style.enable3dLights()&&ut.style.directionalLight){const oe=ut.style.directionalLight.properties.get("direction"),te=a.d3(oe.x,oe.y,oe.z);qt=a.an(te[1])}const jt=!ut.options.moving;return{u_matrix:xt||ut.transform.calculateProjMatrix(st.tileID.toUnwrapped(),jt),u_image:0,u_latrange:GE(0,st.tileID),u_light:[pt.paint.get("hillshade-exaggeration"),qt],u_shadow:vt.toPremultipliedRenderColor(Et?null:pt.lut),u_highlight:bt.toPremultipliedRenderColor(Pt?null:pt.lut),u_emissive_strength:Lt,u_accent:Mt.toPremultipliedRenderColor(Tt?null:pt.lut)}})(x,p,b,x.terrain?c.projMatrix:null);x.uploadCommonUniforms(O,Y,c.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:tt,tileBoundsSegments:nt}=x.getTileBoundsBuffers(p);Y.draw(x,B.TRIANGLES,A,C,P,Ni.disabled,W,b.id,J,tt,nt)}function Xv(x,c,p){if(!c.needsDEMTextureUpload)return;const b=x.context,A=b.gl;b.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||x.getTileTexture(p.stride);const C=p.getPixels();c.demTexture?c.demTexture.update(C,{premultiply:!1}):c.demTexture=new a.T(b,C,A.R32F,{premultiply:!1}),c.needsDEMTextureUpload=!1}function jE(x,c,p){const b=x.context,A=b.gl;if(!c.dem)return;const C=c.dem;if(b.activeTexture.set(A.TEXTURE1),Xv(x,c,C),!c.demTexture)return;c.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const P=C.dim;b.activeTexture.set(A.TEXTURE0);let O=c.hillshadeFBO;if(!O){const W=new a.T(b,{width:P,height:P,data:null},A.RGBA8);W.bind(A.LINEAR,A.CLAMP_TO_EDGE),O=c.hillshadeFBO=b.createFramebuffer(P,P,!0,"renderbuffer"),O.colorAttachment.set(W.texture)}b.bindFramebuffer.set(O.framebuffer),b.viewport.set([0,0,P,P]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:j}=x.getMercatorTileBoundsBuffers(),Y=[];x.linearFloatFilteringSupported()&&Y.push("TERRAIN_DEM_FLOAT_FORMAT"),x.getOrCreateProgram("hillshadePrepare",{defines:Y}).draw(x,A.TRIANGLES,fi.disabled,$i.disabled,lr.unblended,Ni.disabled,((W,J)=>{const tt=J.stride,nt=a.bB();return a.cd(nt,0,a.al,-a.al,0,0,1),a.bq(nt,nt,[0,-a.al,0]),{u_matrix:nt,u_image:1,u_dimension:[tt,tt],u_zoom:W.overscaledZ}})(c.tileID,C),p.id,B,G,j),c.needsHillshadePrepare=!1}class Nn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nT extends Nn{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class _x extends Nn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class WE extends Nn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class $E extends Nn{getDefault(){return[!0,!0,!0,!0]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ZE extends Nn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class qE extends Nn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class aT extends Nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class XE extends Nn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Yv extends Nn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}}class YE extends Nn{getDefault(){return[0,1]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class oT extends Nn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}}class yx extends Nn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Kv extends Nn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}}class xx extends Nn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO,c.ONE,c.ZERO]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.blendFuncSeparate(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class zh extends Nn{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(c){const p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class nf extends Nn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(c,c),this.current=c,this.dirty=!1)}}class yg extends Nn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}}class af extends Nn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class sT extends Nn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let bx=class extends Nn{getDefault(){return null}set(x){(x!==this.current||this.dirty)&&(this.gl.useProgram(x),this.current=x,this.dirty=!1)}};class lT extends Nn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class of extends Nn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Jv extends Nn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Qv extends Nn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Sx extends Nn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class t_ extends Nn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class xg extends Nn{getDefault(){return null}set(c){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class cT extends Nn{getDefault(){return null}set(c){this.gl&&(c!==this.current||this.dirty)&&(this.gl.bindVertexArray(c),this.current=c,this.dirty=!1)}}class uT extends Nn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class hT extends Nn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class sf extends Nn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class e_ extends Nn{constructor(c,p){super(c),this.context=c,this.parent=p}getDefault(){return null}}class KE extends e_{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class dT extends e_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class JE extends e_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,this.attachment(),p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Tx extends dT{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ax=(x,c,p)=>({u_matrix:x,u_image0:0,u_skirt_height:c,u_ground_shadow_factor:p}),i_=(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt)=>({u_proj_matrix:Float32Array.from(x),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(b),u_merc_matrix:p,u_zoom_transition:A,u_merc_center:C,u_image0:0,u_frustum_tl:P,u_frustum_tr:O,u_frustum_br:B,u_frustum_bl:G,u_globe_pos:j,u_globe_radius:Y,u_viewport:W,u_grid_matrix:nt?Float32Array.from(nt):new Float32Array(9),u_skirt_height:J,u_far_z_cutoff:tt});function r_(x,c){return x!=null&&c!=null&&!(!x.hasData()||!c.hasData())&&x.demTexture!=null&&c.demTexture!=null&&x.tileID.key!==c.tileID.key}const Bh=new class{constructor(){this.operations={}}newMorphing(x,c,p,b,A){if(x in this.operations){const C=this.operations[x];C.to.tileID.key!==p.tileID.key&&(C.queued=p)}else this.operations[x]={startTime:b,phase:0,duration:A,from:c,to:p,queued:null}}getMorphValuesForProxy(x){if(!(x in this.operations))return null;const c=this.operations[x];return{from:c.from,to:c.to,phase:c.phase}}update(x){for(const c in this.operations){const p=this.operations[c];for(p.phase=(x-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,x)){delete this.operations[c];break}}}_nextOp(x,c){return!!x.queued&&(x.from=x.to,x.to=x.queued,x.queued=null,x.phase=0,x.startTime=c,!0)}_validOp(x){return x.from.hasData()&&x.to.hasData()}},Ix={0:null,1:"TERRAIN_VERTEX_MORPHING"};function fT(x,c,p){if(c===0)return 0;const b=c<1&&p===514?.25/c:1;return 6*Math.pow(1.5,22-x)*Math.max(c,1)*b}function bg(x,c){const p=1<<x.z;return!c&&(x.x===0||x.x===p-1)||x.y===0||x.y===p-1}const Fh=x=>({u_matrix:x});function n_(x,c,p,b,A){if(A>0){const C=a.o.now(),P=(C-x.timeAdded)/A,O=c?(C-c.timeAdded)/A:-1,B=p.getSource(),G=b.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),j=!c||Math.abs(c.tileID.overscaledZ-G)>Math.abs(x.tileID.overscaledZ-G),Y=j&&x.refreshedUponExpiration?1:a.aA(j?P:1-O,0,1);return c?{opacity:1,mix:1-Y,isFading:P<1}:{opacity:Y,mix:0,isFading:P<1}}return{opacity:1,mix:0,isFading:!1}}class $s extends _l{constructor(c){const p=Xo("mock-dem",{type:"raster-dem",maxzoom:c.transform.maxZoom},c.style.dispatcher,c.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,p){c.state="loaded",p(null)}}class Mx extends _l{constructor(c){const p=Xo("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},c.style.dispatcher,c.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,p,b){if(c.freezeTileCoverage)return;this.transform=c;const A=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,P)=>{if(C[P.key]="",!this._tiles[P.key]){const O=new sc(P,this._source.tileSize*P.overscaleFactor(),c.tileZoom,void 0,void 0,this._source.worldview);O.state="loaded",this._tiles[P.key]=O}return C},{});for(const C in this._tiles)C in A||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(c){const p=this.proxyCachedFBO[c];if(p!==void 0){const b=Object.values(p);this.renderCachePool.push(...b),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wg extends a.aP{constructor(c,p,b){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=p,this.projMatrix=b}}class Sg extends a.bU{constructor(c,p){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},c.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[b,A,C]=function(B){const G=new a.bc,j=new a.b0,Y=131;G.reserve(17161),j.reserve(33800);const W=a.al/128,J=a.al+W/2,tt=J+W;for(let ut=-W;ut<tt;ut+=W)for(let st=-W;st<tt;st+=W){const pt=st<0||st>J||ut<0||ut>J?24575:0,xt=a.aA(Math.round(st),0,a.al),vt=a.aA(Math.round(ut),0,a.al);G.emplaceBack(xt+pt,vt)}const nt=(ut,st)=>{const pt=st*Y+ut;j.emplaceBack(pt+1,pt,pt+Y),j.emplaceBack(pt+Y,pt+Y+1,pt+1)};for(let ut=1;ut<129;ut++)for(let st=1;st<129;st++)nt(st,ut);return[0,129].forEach(ut=>{for(let st=0;st<130;st++)nt(st,ut),nt(ut,st)}),[G,j,32768]}(),P=c.context;this.gridBuffer=P.createVertexBuffer(b,a.be.members),this.gridIndexBuffer=P.createIndexBuffer(A),this.gridSegments=a.bf.simpleSegment(0,0,b.length,A.length),this.gridNoSkirtSegments=a.bf.simpleSegment(0,0,b.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Mx(p.map),this.orthoMatrix=a.bB(),a.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.al,0,a.al,0,1);const O=P.gl;this._overlapStencilMode=new $i({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $s(p.map),this._pendingGroundEffectLayers=[]}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),this._style=c,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,p,b){if(c&&c.terrain){this._style!==c&&(this.style=c,this._evaluationZoom=void 0);const A=c.terrain.properties,C=c.terrain.drapeRenderMode===0,P=c.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.o.now();const O=c.terrain&&c.terrain.scope,B=A.get("source"),G=C?this._mockSourceCache:c.getSourceCache(B,O);if(!G)return void a.w(`Couldn't find terrain source "${B}".`);if(this.sourceCache=G,this._attenuationRange=c.terrain.getAttenuationRange(),this._exaggeration=P?this.calculateExaggeration(p):A.get("exaggeration"),!p.projection.requiresDraping&&P&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Y=this.getScaledDemTileSize();this.sourceCache.update(p,Y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),p.updateElevation(!0,b),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0,this._previousZoom=p.zoom}else this._disable()}calculateExaggeration(c){if(this._attenuationRange&&c.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(c.zoom);const p=this._previousCameraAltitude,b=c.getFreeCameraOptions().position.z/c.pixelsPerMeter*c.worldSize;this._previousCameraAltitude=b;const A=p!=null?b-p:Number.MAX_VALUE;if(Math.abs(A)<2)return this._exaggeration;const C=c.zoom,P=this._style.terrain;if(!this._previousUpdateTimestamp)return P.getExaggeration(C);let O=C-this._previousZoom;const B=this._previousUpdateTimestamp;let G=C;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(C-G)>.5&&(O=.5*(C-G+O)),O*A<0&&(G+=O)),this._evaluationZoom=G;const j=P.getExaggeration(G),Y=j===P.getExaggeration(Math.max(0,G-.1));if(Y&&Math.abs(j-this._exaggeration)<.01)return j;let W=Math.min(.1,.00375*(this._updateTimestamp-B));return(Y||j<.1||Math.abs(O)<1e-4)&&(W=Math.min(.2,4*W)),a.ak(this._exaggeration,j,W)}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(c){c.dataType==="source"&&c.coord?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._mergedSourceCaches)this._style._mergedSourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,b=this.painter.transform;this._initializing&&(this._initializing=b._centerAltitude===0&&this.getAtPointOrZero(a.ae.fromLngLat(b.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const A=this.proxyCoords=p.getIds().map(B=>{const G=p.getTileByID(B).tileID;return G.projMatrix=b.calculateProjMatrix(G.toUnwrapped()),G});(function(B,G){const j=G.transform.pointCoordinate(G.transform.getCameraPoint()),Y=new a.P(j.x,j.y);B.sort((W,J)=>{if(J.overscaledZ-W.overscaledZ)return J.overscaledZ-W.overscaledZ;const tt=new a.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),nt=new a.P(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ut=Y.mult(1<<W.canonical.z);return ut.x-=.5,ut.y-=.5,ut.distSqr(tt)-ut.distSqr(nt)})})(A,this.painter);const C=this.proxyToSource||{};this.proxyToSource={},A.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const P=this._style._mergedSourceCaches;for(const B in P){const G=P[B];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,c[B],C),G.usedForTerrain))continue;const j=c[B];G.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[p.id]=A.map(B=>new wg(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(A),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1;const O={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const G=this.terrainTileForTile[B.key];if(!G)continue;const j=G.tileID.key;j in O||(this._visibleDemTiles.push(G),O[j]=j)}}_assignTerrainTiles(c){this._initializing||c.forEach(p=>{if(this.terrainTileForTile[p.key])return;const b=this._findTileCoveringTileID(p,this.sourceCache);b&&(this.terrainTileForTile[p.key]=b)})}_prepareDEMTextures(){const c=this.painter.context,p=c.gl;for(const b in this.terrainTileForTile){const A=this.terrainTileForTile[b],C=A.dem;!C||A.demTexture&&!A.needsDEMTextureUpload||(c.activeTexture.set(p.TEXTURE1),Xv(this.painter,A,C))}}_prepareDemTileUniforms(c,p,b,A){if(!p||p.demTexture==null)return!1;const C=c.tileID.canonical,P=Math.pow(2,p.tileID.canonical.z-C.z),O=A||"";return b[`u_dem_tl${O}`]=[C.x*P%1,C.y*P%1],b[`u_dem_scale${O}`]=P,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let c=0;const p=this._visibleDemTiles.reduce((b,A)=>{if(!A.dem)return b;const C=A.dem.tree.minimums[0];return C>0&&c++,b+C},0);return c?p/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,p=c.gl;c.activeTexture.set(p.TEXTURE2);const b=this._getLoadedAreaMinimum(),A=new a.dK({width:1,height:1},new Float32Array([b]));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(A,{premultiply:!1}):C=this._emptyDEMTexture=new a.T(c,A,p.R32F,{premultiply:!1}),C}setupElevationDraw(c,p,b){const A=this.painter.context,C=A.gl,P={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};P.u_exaggeration=this.exaggeration();let O=null,B=null,G=1;if(b&&b.morphing&&this._useVertexMorphing){const J=b.morphing.srcDemTile,tt=b.morphing.dstDemTile;G=b.morphing.phase,J&&tt&&(this._prepareDemTileUniforms(c,J,P,"_prev")&&(B=J),this._prepareDemTileUniforms(c,tt,P)&&(O=tt))}const j=J=>J&&J.demTexture&&this.painter.linearFloatFilteringSupported()?C.LINEAR:C.NEAREST;let Y=null;var W;if(this.enabled?B&&O?(Y=O.demTexture,A.activeTexture.set(C.TEXTURE4),B.demTexture.bind(j(B),C.CLAMP_TO_EDGE),P.u_dem_lerp=G):(O=this.terrainTileForTile[c.tileID.key],Y=this._prepareDemTileUniforms(c,O,P)?O.demTexture:this.emptyDEMTexture):Y=this.emptyDEMTexture,A.activeTexture.set(C.TEXTURE2),Y&&(P.u_dem_size=(W=Y).size[0]===1?1:W.size[0]-2,Y.bind(j(O),C.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(b&&b.useDepthForOcclusion,p,P),b&&b.useMeterToDem&&O){const J=(1<<O.tileID.canonical.z)*a.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;P.u_meter_to_dem=J}if(b&&b.labelPlaneMatrixInv&&(P.u_label_plane_matrix_inv=b.labelPlaneMatrixInv),p.setTerrainUniformValues(A,P),this.painter.transform.projection.name==="globe"){const J=this.globeUniformValues(this.painter.transform,c.tileID.canonical,b&&b.useDenormalizedUpVectorScale);p.setGlobeUniformValues(A,J)}}globeUniformValues(c,p,b){const A=c.projection;return{u_tile_tl_up:A.upVector(p,0,0),u_tile_tr_up:A.upVector(p,a.al,0),u_tile_br_up:A.upVector(p,a.al,a.al),u_tile_bl_up:A.upVector(p,0,a.al),u_tile_up_scale:b?a.dL(1):A.upVectorScale(p,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const p=this.painter,b=this.painter.context;c.length!==0&&(b.bindFramebuffer.set(null),b.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(A,C,P,O,B){if(A.transform.projection.name==="globe")(function(G,j,Y,W,J){const tt=G.context,nt=tt.gl;let ut,st;const pt=G.transform,xt=a.dD(G,tt,pt),vt=(oe,te)=>{if(st===te)return;const he=[Ix[te],"PROJECTION_GLOBE_VIEW"];xt&&he.push("CUSTOM_ANTIALIASING");const Oe=G.isTileAffectedByFog(oe);ut=G.getOrCreateProgram("globeRaster",{defines:he,overrideFog:Oe}),st=te},Et=G.colorModeForRenderPass(),bt=new fi(nt.LEQUAL,fi.ReadWrite,G.depthRangeFor3D);Bh.update(J);const Pt=a.dE(pt),Mt=[a.aF(pt.center.lng),a.aJ(pt.center.lat)],Tt=G.globeSharedBuffers,Lt=[pt.width*a.o.devicePixelRatio,pt.height*a.o.devicePixelRatio],qt=Float32Array.from(pt.globeMatrix),jt={useDenormalizedUpVectorScale:!0};{const oe=G.transform,te=fT(oe.zoom,j.exaggeration(),j.sourceCache._source.tileSize);st=-1;const he=nt.TRIANGLES;for(const Oe of W){const Jt=Y.getTile(Oe),Ut=$i.disabled,de=j.prevTerrainTileForTile[Oe.key],ee=j.terrainTileForTile[Oe.key];r_(de,ee)&&Bh.newMorphing(Oe.key,de,ee,J,250),tt.activeTexture.set(nt.TEXTURE0),Jt.texture&&Jt.texture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE);const Ae=Bh.getMorphValuesForProxy(Oe.key),Ue=Ae?1:0;Ae&&Object.assign(jt,{morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:a.dC(Ae.phase)}});const ci=a.dF(Oe.canonical),Le=a.dG(ci.getCenter().lat),Be=a.dH(Oe.canonical,ci,Le,oe.worldSize/oe._pixelsPerMercatorPixel),hi=a.bj(a.dI(Oe.canonical)),ni=i_(oe.expandedFarZProjMatrix,qt,Pt,hi,a.aj(oe.zoom),Mt,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Lt,te,oe._farZ,Be);if(vt(Oe,Ue),ut&&(j.setupElevationDraw(Jt,ut,jt),G.uploadCommonUniforms(tt,ut,Oe.toUnwrapped()),Tt)){const[ii,ai,Ei]=Tt.getGridBuffers(Le,te!==0);ut.draw(G,he,bt,Ut,Et,Ni.backCCW,ni,"globe_raster",ii,ai,Ei)}}}if(Tt&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xt&&oe.push("CUSTOM_ANTIALIASING"),ut=G.getOrCreateProgram("globeRaster",{defines:oe});for(const te of W){const{x:he,y:Oe,z:Jt}=te.canonical,Ut=Oe===0,de=Oe===(1<<Jt)-1,[ee,Ae,Ue,ci]=Tt.getPoleBuffers(Jt,!1);if(ci&&(Ut||de)){const Le=Y.getTile(te);tt.activeTexture.set(nt.TEXTURE0),Le.texture&&Le.texture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE);let Be=a.dJ(Jt,he,pt);const hi=a.bj(a.dI(te.canonical)),ni=(ii,ai)=>ii.draw(G,nt.TRIANGLES,bt,$i.disabled,Et,Ni.disabled,i_(pt.expandedFarZProjMatrix,Be,Be,hi,0,Mt,pt.frustumCorners.TL,pt.frustumCorners.TR,pt.frustumCorners.BR,pt.frustumCorners.BL,pt.globeCenterInViewSpace,pt.globeRadius,Lt,0,pt._farZ),"globe_pole_raster",ai,Ue,ci);j.setupElevationDraw(Le,ut,jt),G.uploadCommonUniforms(tt,ut,te.toUnwrapped()),Ut&&G.renderDefaultNorthPole&&ni(ut,ee),de&&G.renderDefaultSouthPole&&(Be=a.cR(a.bB(),Be,[1,-1,1]),ni(ut,Ae))}}}})(A,C,P,O,B);else{const G=A.context,j=G.gl;let Y,W;const J=A.shadowRenderer,tt=Hc(A,A.longestCutoffRange),nt=Et=>{if(W===Et)return;const bt=[];bt.push(Ix[Et]),tt.shouldRenderCutoff&&bt.push("RENDER_CUTOFF"),J&&(bt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&bt.push("NORMAL_OFFSET")),Y=A.getOrCreateProgram("terrainRaster",{defines:bt}),W=Et},ut=A.colorModeForRenderPass(),st=new fi(j.LEQUAL,fi.ReadWrite,A.depthRangeFor3D);Bh.update(B);const pt=A.transform,xt=fT(pt.zoom,C.exaggeration(),C.sourceCache._source.tileSize);let vt=[0,0,0];if(J){const Et=A.style.directionalLight,bt=A.style.ambientLight;Et&&bt&&(vt=bl(A.style,Et,bt))}{W=-1;const Et=j.TRIANGLES,[bt,Pt]=[C.gridIndexBuffer,C.gridSegments];for(const Mt of O){const Tt=P.getTile(Mt),Lt=$i.disabled,qt=C.prevTerrainTileForTile[Mt.key],jt=C.terrainTileForTile[Mt.key];r_(qt,jt)&&Bh.newMorphing(Mt.key,qt,jt,B,250),G.activeTexture.set(j.TEXTURE0),Tt.texture&&Tt.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const oe=Bh.getMorphValuesForProxy(Mt.key),te=oe?1:0;let he;oe&&(he={morphing:{srcDemTile:oe.from,dstDemTile:oe.to,phase:a.dC(oe.phase)}});const Oe=Ax(Mt.projMatrix,bg(Mt.canonical,pt.renderWorldCopies)?xt/10:xt,vt);if(nt(te),!Y)continue;C.setupElevationDraw(Tt,Y,he);const Jt=Mt.toUnwrapped();J&&J.setupShadows(Jt,Y),A.uploadCommonUniforms(G,Y,Jt,null,tt),Y.draw(A,Et,st,Lt,ut,Ni.backCCW,Oe,"terrain_raster",C.gridBuffer,bt,Pt)}}}}(p,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const p=this.painter,b=this.painter.context,A=this.proxySourceCache,C=this.proxiedCoords[A.id],P=this._drapedRenderBatches.shift(),O=p.style.order,B=[];let G=0;for(const j of C){const Y=A.getTileByID(j.proxyTileKey),W=A.proxyCachedFBO[j.key]?A.proxyCachedFBO[j.key][c]:void 0,J=W!==void 0?A.renderCache[W]:this.pool[G++],tt=W!==void 0;if(Y.texture=J.tex,tt&&!J.dirty){B.push(Y.tileID);continue}let nt;b.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(b.clear({color:a.ao.transparent,stencil:0}),J.dirty=!1);for(let ut=P.start;ut<=P.end;++ut){const st=p.style._mergedLayers[O[ut]];if(st.isHidden(p.transform.zoom))continue;const pt=p.style.getLayerSourceCache(st),xt=pt?this.proxyToSource[j.key][pt.id]:[j];if(!xt)continue;const vt=xt;b.viewport.set([0,0,J.fb.width,J.fb.height]),nt!==(pt?pt.id:null)&&(this._setupStencil(J,xt,st,pt),nt=pt?pt.id:null),p.renderLayer(p,pt,st,vt)}if(this._drapedRenderBatches.length===0)for(const ut of this._pendingGroundEffectLayers){const st=p.style._mergedLayers[O[ut]];if(st.isHidden(p.transform.zoom))continue;const pt=p.style.getLayerSourceCache(st),xt=pt?this.proxyToSource[j.key][pt.id]:[j];if(!xt)continue;const vt=xt;b.viewport.set([0,0,J.fb.width,J.fb.height]),nt!==(pt?pt.id:null)&&(this._setupStencil(J,xt,st,pt),nt=pt?pt.id:null),p.renderLayer(p,pt,st,vt)}this.renderedToTile?(J.dirty=!0,B.push(Y.tileID)):tt||--G,G===5&&(G=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,b.bindFramebuffer.set(null),b.viewport.set([0,0,p.width,p.height]),P.end+1}postRender(){}isLayerOrderingCorrect(c){const p=c.order.length;let b=-1,A=p;for(let C=0;C<p;++C)this._style.isLayerDraped(c._mergedLayers[c.order[C]])?b=Math.max(b,C):A=Math.min(A,C);return A>b}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{c=Math.min(c,p.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,p,b){if(!this._visibleDemTiles)return null;const A=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const P=C.tileID,O=1<<P.overscaledZ,{x:B,y:G}=P.canonical,j=B/O,Y=(B+1)/O,W=G/O,J=(G+1)/O;return{minx:j,miny:W,maxx:Y,maxy:J,t:C.dem.tree.raycastRoot(j,W,Y,J,c,p,b),tile:C}});A.sort((C,P)=>(C.t!==null?C.t:Number.MAX_VALUE)-(P.t!==null?P.t:Number.MAX_VALUE));for(const C of A){if(C.t==null)return null;const P=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,c,p,b);if(P!=null)return P}return null}_createFBO(){const c=this.painter.context,p=c.gl,b=this.drapeBufferSize;c.activeTexture.set(p.TEXTURE0);const A=new a.T(c,{width:b[0],height:b[1],data:null},p.RGBA8);A.bind(p.LINEAR,p.CLAMP_TO_EDGE);const C=c.createFramebuffer(b[0],b[1],!0,null);return C.colorAttachment.set(A.texture),C.depthAttachment=new Tx(c,C.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,b[0],b[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:C,tex:A,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const p=this._style._mergedLayers[c],b=p.isHidden(this.painter.transform.zoom);return p.type==="hillshade"||p.type==="custom"?!b&&p.shouldRedrape():!b&&p.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const b of this._style.getSources())if(b instanceof No){c=!0;break}if(!c)return;const p={};for(let b=0;b<this._style.order.length;++b){const A=this._style._mergedLayers[this._style.order[b]],C=this._style.getLayerSourceCache(A);if(C&&!p[C.id]&&!A.isHidden(this.painter.transform.zoom)&&A.type==="line"&&A.widthExpression()instanceof a.ad){p[C.id]=!0;for(const P of this.proxyCoords){const O=this.proxyToSource[P.key][C.id];if(O)for(const B of O)this._clearRenderCacheForTile(C.id,B)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const b in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[b]._source instanceof ml){c=!0;break}if(!c)return;const p={};for(let b=0;b<this._style.order.length;++b){const A=this._style._mergedLayers[this._style.order[b]],C=this._style.getLayerSourceCache(A);if(!C||p[C.id]||A.isHidden(this.painter.transform.zoom)||A.type!=="raster")continue;const P=A.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const B=this.proxyToSource[O.key][C.id];if(B)for(const G of B){const j=n_(C.getTile(G),C.findLoadedParent(G,0),C,this.painter.transform,P);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(C.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const c=this._style.order,p=c.length;if(p===0)return;const b=[];this._pendingGroundEffectLayers=[];let A,C=0,P=this._style._mergedLayers[c[C]];for(;!this._style.isLayerDraped(P)&&P.isHidden(this.painter.transform.zoom)&&++C<p;)P=this._style._mergedLayers[c[C]];for(;C<p;++C){const O=this._style._mergedLayers[c[C]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?A===void 0&&(A=C):(O.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(C),A!==void 0&&(b.push({start:A,end:C-1}),A=void 0)))}if(A!==void 0&&b.push({start:A,end:C-1}),b.length!==0){const O=b[b.length-1];this._pendingGroundEffectLayers.every(B=>B>O.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=b}_setupRenderCache(c){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const P=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let O=0;O<P.length;++O){const B=Object.values(P[O]);p.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const b=this.proxyCoords,A=this._tilesDirty;for(let P=b.length-1;P>=0;P--){const O=b[P];if(p.getTileByID(O.key),p.proxyCachedFBO[O.key]!==void 0){const B=c[O.key],G=this.proxyToSource[O.key];let j=0;for(const Y in G){const W=G[Y],J=B[Y];if(!J||J.length!==W.length||W.some((tt,nt)=>tt!==J[nt]||A[Y]&&A[Y].hasOwnProperty(tt.key))){j=-1;break}++j}for(const Y in p.proxyCachedFBO[O.key])p.renderCache[p.proxyCachedFBO[O.key][Y]].dirty=j<0||j!==Object.values(B).length}}const C=[...this._drapedRenderBatches];C.sort((P,O)=>O.end-O.start-(P.end-P.start));for(const P of C)for(const O of b){if(p.proxyCachedFBO[O.key])continue;let B=p.renderCachePool.pop();B===void 0&&p.renderCache.length<50&&(B=p.renderCache.length,p.renderCache.push(this._createFBO())),B!==void 0&&(p.proxyCachedFBO[O.key]={},p.proxyCachedFBO[O.key][P.start]=B,p.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(c,p,b,A){if(!A||!this._sourceTilesOverlap[A.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,P=C.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let O;if(b.isTileClipped())O=p.length,this._overlapStencilMode.test={func:P.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:P.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,b.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):$i.disabled}_renderTileClippingMasks(c,p){const b=this.painter,A=this.painter.context,C=A.gl;b._tileClippingMaskIDs={},A.setColorMode(lr.disabled),A.setDepthMode(fi.disabled);const P=b.getOrCreateProgram("clippingMask");for(const O of c){const B=b._tileClippingMaskIDs[O.key]=--p;P.draw(b,C.TRIANGLES,fi.disabled,new $i({func:C.ALWAYS,mask:0},B,255,C.KEEP,C.KEEP,C.REPLACE),lr.disabled,Ni.disabled,Fh(O.projMatrix),"$clipping",b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}}pointCoordinate(c){const p=this.painter.transform;if(c.x<0||c.x>p.width||c.y<0||c.y>p.height)return null;const b=[c.x,c.y,1,1];a.aC(b,b,p.pixelMatrixInverse),a.cJ(b,b,1/b[3]),b[0]/=p.worldSize,b[1]/=p.worldSize;const A=p._camera.position,C=a.ce(1,p.center.lat),P=[A[0],A[1],A[2]/C,0],O=a.d9([],b.slice(0,3),P);a.aw(O,O);const B=this.raycast(P,O,this._exaggeration);return B!==null&&B?(a.bG(P,P,O,B),P[3]=P[2],P[2]*=C,P):null}_setupProxiedCoordsForOrtho(c,p,b){if(c.getSource()instanceof a.aT)return this._setupProxiedCoordsForImageSource(c,p,b);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const A=this.proxiedCoords[c.id]=[],C=this.proxyCoords;for(let B=0;B<C.length;B++){const G=C[B],j=this._findTileCoveringTileID(G,c);if(j){const Y=this._createProxiedId(G,j,b[G.key]&&b[G.key][c.id]);A.push(Y),this.proxyToSource[G.key][c.id]=[Y]}}let P=!1;const O=new Set;for(let B=0;B<p.length;B++){const G=c.getTile(p[B]);if(!G||!G.hasData())continue;const j=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==G.tileID.canonical.z){const Y=this.proxyToSource[j.tileID.key][c.id],W=this._createProxiedId(j.tileID,G,b[j.tileID.key]&&b[j.tileID.key][c.id]);Y?Y.splice(Y.length-1,0,W):this.proxyToSource[j.tileID.key][c.id]=[W];const J=this.proxyToSource[j.tileID.key][c.id];O.has(J)||O.add(J),A.push(W),P=!0}}if(this._sourceTilesOverlap[c.id]=P,P&&this._debugParams.sortTilesHiZFirst)for(const B of O)B.sort((G,j)=>j.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(c,p,b){if(!c.getSource().loaded())return;const A=this.proxiedCoords[c.id]=[],C=this.proxyCoords,P=c.getSource(),O=P.tileID;if(!O)return;const B=new a.P(O.x,O.y)._div(1<<O.z),G=P.coordinates.map(a.ae.fromLngLat).reduce((Y,W)=>(Y.min.x=Math.min(Y.min.x,W.x-B.x),Y.min.y=Math.min(Y.min.y,W.y-B.y),Y.max.x=Math.max(Y.max.x,W.x-B.x),Y.max.y=Math.max(Y.max.y,W.y-B.y),Y),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(Y,W)=>{const J=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),tt=Y.canonical.y/(1<<Y.canonical.z),nt=a.al/(1<<Y.canonical.z),ut=W.wrap+W.canonical.x/(1<<W.canonical.z),st=W.canonical.y/(1<<W.canonical.z);return J+nt<ut+G.min.x||J>ut+G.max.x||tt+nt<st+G.min.y||tt>st+G.max.y};for(let Y=0;Y<C.length;Y++){const W=C[Y];for(let J=0;J<p.length;J++){const tt=c.getTile(p[J]);if(!tt||!tt.hasData()||j(W,tt.tileID))continue;const nt=this._createProxiedId(W,tt,b[W.key]&&b[W.key][c.id]),ut=this.proxyToSource[W.key][c.id];ut?ut.push(nt):this.proxyToSource[W.key][c.id]=[nt],A.push(nt)}}}_createProxiedId(c,p,b){let A=this.orthoMatrix;if(b){const C=b.find(P=>P.key===p.tileID.key);if(C)return C}if(p.tileID.key!==c.key){const C=c.canonical.z-p.tileID.canonical.z;let P,O,B;A=a.bB();const G=p.tileID.wrap-c.wrap<<c.overscaledZ;C>0?(P=a.al>>C,O=P*((p.tileID.canonical.x<<C)-c.canonical.x+G),B=P*((p.tileID.canonical.y<<C)-c.canonical.y)):(P=a.al<<-C,O=a.al*(p.tileID.canonical.x-(c.canonical.x+G<<-C)),B=a.al*(p.tileID.canonical.y-(c.canonical.y<<-C))),a.cd(A,0,P,0,P,0,1),a.bq(A,A,[O,B,0])}return new wg(p.tileID,c.key,A)}_findTileCoveringTileID(c,p){let b=p.getTile(c);if(b&&b.hasData())return b;const A=this._findCoveringTileCache[p.id],C=A[c.key];if(b=C?p.getTileByID(C):null,b&&b.hasData()||C===null)return b;let P=b?b.tileID:c,O=P.overscaledZ;const B=p.getSource().minzoom,G=[];if(!C){const Y=p.getSource().maxzoom;if(c.canonical.z>=Y){const W=c.canonical.z-Y;p.getSource().reparseOverscaled?(O=Math.max(c.canonical.z+2,p.transform.tileZoom),P=new a.aP(O,c.wrap,Y,c.canonical.x>>W,c.canonical.y>>W)):W!==0&&(O=Y,P=new a.aP(O,c.wrap,Y,c.canonical.x>>W,c.canonical.y>>W))}P.key!==c.key&&(G.push(P.key),b=p.getTile(P))}const j=Y=>{G.forEach(W=>{A[W]=Y}),G.length=0};for(O-=1;O>=B&&(!b||!b.hasData());O--){b&&j(b.tileID.key);const Y=P.calculateScaledKey(O);if(b=p.getTileByID(Y),b&&b.hasData())break;const W=A[Y];if(W===null)break;W===void 0?G.push(Y):b=p.getTileByID(W)}return j(b?b.tileID.key:null),b&&b.hasData()?b:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,p){let b=this._tilesDirty[c];b||(b=this._tilesDirty[c]={}),b[p.key]=!0}}function Cx(x,c,p){const b=function(O,B,G){const j=a.bI(B,O),Y=a.bI(G,[.2126,.7152,.0722]),W=(tt,nt,ut)=>(1-ut)*tt+ut*nt,J=W(1-.3*Math.min(Y,1),1,Math.min(j+1,1));return W(.92,1,Math.asin(a.aA(B[2],-1,1))/Math.PI+.5)*J}(x,[0,0,1],c),A=[0,0,0];a.c4(A,p.slice(0,3),b);const C=[0,0,0];a.c4(C,c.slice(0,3),x[2]);const P=[0,0,0];return a.d7(P,A,C),a.da(P)}const Ex=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dx=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Tg{static cacheKey(c,p,b,A){let C=`${p}${A?A.cacheKey:""}`;for(const P of b)c.usedDefines.includes(P)&&(C+=`/${P}`);return C}constructor(c,p,b,A,C,P){const O=c.gl;this.program=O.createProgram(),this.configuration=A,this.name=p,this.fixedDefines=[...P];let B=A?A.defines():[];B=B.concat(P.map(tt=>`#define ${tt}`));const G=`#version 300 es
`;let j=G+B.concat("precision mediump float;",uc,_g.fragmentSource).join(`
`);for(const tt of b.fragmentIncludes)j+=`
${ef[tt]}`;j+=`
${b.fragmentSource}`;let Y=G+B.concat("precision highp float;",uc,_g.vertexSource).join(`
`);for(const tt of b.vertexIncludes)Y+=`
${ef[tt]}`;this.forceManualRenderingForInstanceIDShaders=c.forceManualRenderingForInstanceIDShaders&&b.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Y+=`
uniform int u_instanceID;
`),Y+=`
${b.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Y=Y.replaceAll("gl_InstanceID","u_instanceID"));const W=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(W,j),O.compileShader(W),O.attachShader(this.program,W);const J=O.createShader(O.VERTEX_SHADER);O.isContextLost()?this.failedToCreate=!0:(O.shaderSource(J,Y),O.compileShader(J),O.attachShader(this.program,J),this.attributes={},O.linkProgram(this.program),O.deleteShader(J),O.deleteShader(W),this.fixedUniforms=C(c),this.binderUniforms=A?A.getUniforms(c):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(tt=>({u_instanceID:new a.cg(tt)}))(c)),(P.includes("TERRAIN")||p.indexOf("symbol")!==-1||p.indexOf("circle")!==-1)&&(this.terrainUniforms=(tt=>({u_dem:new a.cg(tt),u_dem_prev:new a.cg(tt),u_dem_tl:new a.cj(tt),u_dem_scale:new a.ci(tt),u_dem_tl_prev:new a.cj(tt),u_dem_scale_prev:new a.ci(tt),u_dem_size:new a.ci(tt),u_dem_lerp:new a.ci(tt),u_exaggeration:new a.ci(tt),u_depth:new a.cg(tt),u_depth_size_inv:new a.cj(tt),u_depth_range_unpack:new a.cj(tt),u_occluder_half_size:new a.ci(tt),u_occlusion_depth_offset:new a.ci(tt),u_meter_to_dem:new a.ci(tt),u_label_plane_matrix_inv:new a.ck(tt)}))(c)),P.includes("GLOBE")&&(this.globeUniforms=(tt=>({u_tile_tl_up:new a.ch(tt),u_tile_tr_up:new a.ch(tt),u_tile_br_up:new a.ch(tt),u_tile_bl_up:new a.ch(tt),u_tile_up_scale:new a.ci(tt)}))(c)),P.includes("FOG")&&(this.fogUniforms=(tt=>({u_fog_matrix:new a.ck(tt),u_fog_range:new a.cj(tt),u_fog_color:new a.d2(tt),u_fog_horizon_blend:new a.ci(tt),u_fog_vertical_limit:new a.cj(tt),u_fog_temporal_offset:new a.ci(tt),u_frustum_tl:new a.ch(tt),u_frustum_tr:new a.ch(tt),u_frustum_br:new a.ch(tt),u_frustum_bl:new a.ch(tt),u_globe_pos:new a.ch(tt),u_globe_radius:new a.ci(tt),u_globe_transition:new a.ci(tt),u_is_globe:new a.cg(tt),u_viewport:new a.cj(tt)}))(c)),P.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(tt=>({u_cutoff_params:new a.d2(tt)}))(c)),P.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(tt=>({u_lighting_ambient_color:new a.ch(tt),u_lighting_directional_dir:new a.ch(tt),u_lighting_directional_color:new a.ch(tt),u_ground_radiance:new a.ch(tt)}))(c)),P.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(tt=>({u_light_matrix_0:new a.ck(tt),u_light_matrix_1:new a.ck(tt),u_fade_range:new a.cj(tt),u_shadow_normal_offset:new a.ch(tt),u_shadow_intensity:new a.ci(tt),u_shadow_texel_size:new a.ci(tt),u_shadow_map_resolution:new a.ci(tt),u_shadow_direction:new a.ch(tt),u_shadow_bias:new a.ch(tt),u_shadowmap_0:new a.cg(tt),u_shadowmap_1:new a.cg(tt)}))(c)))}getAttributeLocation(c,p){let b=this.attributes[p];return b===void 0&&(b=this.attributes[p]=c.getAttribLocation(this.program,p)),b}setTerrainUniformValues(c,p){if(!this.terrainUniforms)return;const b=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const A in p)b[A]&&b[A].set(this.program,A,p[A])}}setGlobeUniformValues(c,p){if(!this.globeUniforms)return;const b=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const A in p)b[A]&&b[A].set(this.program,A,p[A])}}setFogUniformValues(c,p){if(!this.fogUniforms)return;const b=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}}setCutoffUniformValues(c,p){if(!this.cutoffUniforms)return;const b=this.cutoffUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}}setLightsUniformValues(c,p){if(!this.lightsUniforms)return;const b=this.lightsUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}}setShadowUniformValues(c,p){if(this.failedToCreate||!this.shadowUniforms)return;const b=this.shadowUniforms;c.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}_drawDebugWireframe(c,p,b,A,C,P,O,B,G,j){const Y=c.options.wireframe;if(Y.terrain===!1&&Y.layers2D===!1&&Y.layers3D===!1)return;const W=c.context;if(!(()=>!(!Y.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Y.layers2D||c._terrain&&c._terrain.renderingToTexture||!Ex.includes(this.name))||!(!Y.layers3D||!Dx.includes(this.name)))())return;const J=W.gl,tt=c.wireframeDebugCache.getLinesFromTrianglesBuffer(c.frameCounter,C,W);if(!tt)return;const nt=[...this.fixedDefines];nt.push("DEBUG_WIREFRAME");const ut=c.getOrCreateProgram(this.name,{config:this.configuration,defines:nt});W.program.set(ut.program);const st=(vt,Et,bt)=>{if(Et[vt]&&bt[vt])for(const Pt in Et[vt])bt[vt][Pt]&&bt[vt][Pt].set(bt.program,Pt,Et[vt][Pt].current)};G&&G.setUniforms(ut.program,W,ut.binderUniforms,O,{zoom:B}),st("fixedUniforms",this,ut),st("terrainUniforms",this,ut),st("globeUniforms",this,ut),st("fogUniforms",this,ut),st("lightsUniforms",this,ut),st("shadowUniforms",this,ut),tt.bind(),W.setColorMode(new lr([J.ONE,J.ONE_MINUS_SRC_ALPHA,J.ZERO,J.ONE],a.ao.transparent,[!0,!0,!0,!1])),W.setDepthMode(new fi(p.func===J.LESS?J.LEQUAL:p.func,fi.ReadOnly,p.range)),W.setStencilMode($i.disabled);const pt=3*P.primitiveLength*2,xt=3*P.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const vt=j||1;for(let Et=0;Et<vt;++Et)ut.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Et),J.drawElements(J.LINES,pt,J.UNSIGNED_SHORT,xt)}else j&&j>1?J.drawElementsInstanced(J.LINES,pt,J.UNSIGNED_SHORT,xt,j):J.drawElements(J.LINES,pt,J.UNSIGNED_SHORT,xt);C.bind(),W.program.set(this.program),W.setDepthMode(p),W.setStencilMode(b),W.setColorMode(A)}checkUniforms(c,p,b){if(this.fixedDefines.includes(p)){for(const A of Object.keys(b))if(!b[A].initialized)throw new Error(`Program '${this.name}', from draw '${c}': uniform ${A} not set but required by ${p} being defined`)}}draw(c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut){const st=c.context,pt=st.gl;if(this.failedToCreate)return;st.program.set(this.program),st.setDepthMode(b),st.setStencilMode(A),st.setColorMode(C),st.setCullFace(P);for(const Et of Object.keys(this.fixedUniforms))this.fixedUniforms[Et].set(this.program,Et,O[Et]);tt&&tt.setUniforms(this.program,st,this.binderUniforms,W,{zoom:J});const xt={[pt.POINTS]:1,[pt.LINES]:2,[pt.TRIANGLES]:3,[pt.LINE_STRIP]:1}[p];this.checkUniforms(B,"RENDER_SHADOWS",this.shadowUniforms);const vt=ut&&ut>0?1:void 0;for(const Et of Y.get()){const bt=Et.vaos||(Et.vaos={});if((bt[B]||(bt[B]=new rf)).bind(st,this,G,tt?tt.getPaintVertexBuffers():[],j,Et.vertexOffset,nt||[],vt),this.forceManualRenderingForInstanceIDShaders){const Pt=ut||1;for(let Mt=0;Mt<Pt;++Mt)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Mt),j?pt.drawElements(p,Et.primitiveLength*xt,pt.UNSIGNED_SHORT,Et.primitiveOffset*xt*2):pt.drawArrays(p,Et.vertexOffset,Et.vertexLength)}else ut&&ut>1?pt.drawElementsInstanced(p,Et.primitiveLength*xt,pt.UNSIGNED_SHORT,Et.primitiveOffset*xt*2,ut):j?pt.drawElements(p,Et.primitiveLength*xt,pt.UNSIGNED_SHORT,Et.primitiveOffset*xt*2):pt.drawArrays(p,Et.vertexOffset,Et.vertexLength);p===pt.TRIANGLES&&j&&this._drawDebugWireframe(c,b,A,C,j,Et,W,J,tt,ut)}}}function a_(x,c,p=0){const b=Math.pow(2,c.tileID.overscaledZ),A=c.tileSize*Math.pow(2,x.transform.tileZoom)/b,C=A*(c.tileID.canonical.x+c.tileID.wrap*b),P=A*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ay(c,1,x.transform.tileZoom),u_pixel_coord_upper:[C>>16,P>>16],u_pixel_coord_lower:[65535&C,65535&P],u_pattern_transition:p}}const lf={terrain:0,flat:1},o_=a.bB(),s_=(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st)=>{const pt=c.style.light,xt=pt.properties.get("position"),vt=[xt.x,xt.y,xt.z],Et=a.dN();pt.properties.get("anchor")==="viewport"&&(a.dO(Et,-c.transform.angle),a.dP(vt,vt,Et));const bt=pt.properties.get("color").toPremultipliedRenderColor(null),Pt=c.transform,Mt={u_matrix:x,u_lightpos:vt,u_lightintensity:pt.properties.get("intensity"),u_lightcolor:[bt.r,bt.g,bt.b],u_vertical_gradient:+p,u_opacity:b,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:o_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:lf[G],u_base_type:lf[j],u_ao:A,u_edge_radius:C,u_width_scale:P,u_flood_light_color:tt,u_vertical_scale:nt,u_flood_light_intensity:ut,u_ground_shadow_factor:st};return Pt.projection.name==="globe"&&(Mt.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],Mt.u_zoom_transition=Y,Mt.u_inv_rot_matrix=J,Mt.u_merc_center=W,Mt.u_up_dir=Pt.projection.upVector(new a.cC(0,0,0),W[0]*a.al,W[1]*a.al),Mt.u_height_lift=B),Mt},pT=(x,c,p,b,A,C)=>({u_matrix:x,u_edge_radius:c,u_width_scale:p,u_vertical_scale:b,u_height_type:lf[A],u_base_type:lf[C]}),gT=(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st)=>{const pt=s_(x,c,p,b,A,C,P,O,G,j,Y,W,J,tt,nt,ut,1,[0,0,0]),xt={u_height_factor:-Math.pow(2,O.overscaledZ)/B.tileSize/8};return Object.assign(pt,a_(c,B,st),xt)},cf=(x,c,p,b,A,C,P,O,B,G,j)=>({u_matrix:c,u_opacity:p,u_ao_pass:b?1:0,u_meter_to_tile:A,u_ao:C,u_flood_light_intensity:P,u_flood_light_color:O,u_attenuation:B,u_edge_radius:G,u_fb:0,u_fb_size:j,u_dynamic_offset:1}),mT=(x,c,p)=>({u_matrix:x,u_emissive_strength:c,u_ground_shadow_factor:p}),vT=(x,c,p,b,A,C=0)=>Object.assign(mT(x,c,A),a_(p,b,C)),QE=(x,c,p,b)=>({u_matrix:x,u_world:p,u_emissive_strength:c,u_ground_shadow_factor:b}),tD=(x,c,p,b,A,C,P=0)=>Object.assign(vT(x,c,p,b,C,P),{u_world:A}),eD=(x,c)=>({u_matrix:x,u_ground_shadow_factor:c}),l_=(x,c,p,b,A)=>({u_matrix:x,u_camera_pos:[c[0],c[1],c[2]],u_depth_bias:p,u_height_scale:b,u_reset_depth:A}),Px=(x,c,p,b,A,C,P,O,B)=>({u_matrix:x,u_normal_matrix:c,u_opacity:p,u_faux_facade_ao_intensity:b,u_camera_pos:A,u_tile_to_meter:C,u_facade_emissive_chance:P,u_flood_light_color:O,u_flood_light_intensity:B}),Lx=x=>({u_matrix:x}),_T=x=>({u_matrix:x}),uf=(x,c,p,b,A,C,P,O)=>{const B=a.al/C.tileSize;return{u_matrix:x,u_inv_rot_matrix:c,u_camera_to_center_distance:p.getCameraToCenterDistance(O),u_extrude_scale:[p.pixelsToGLUnits[0]/B,p.pixelsToGLUnits[1]/B],u_zoom_transition:b,u_tile_id:P,u_merc_center:A}},Rx=(x,c,p=1)=>({u_matrix:x,u_color:c,u_overlay:0,u_overlay_scale:p}),yT=a.bB(),xT=(x,c,p,b,A,C,P)=>{const O=x.transform,B=O.projection.name==="globe",G=B?a.dQ(O.zoom,c.canonical)*O._pixelsPerMercatorPixel:a.ay(p,1,C),j={u_matrix:c.projMatrix,u_extrude_scale:G,u_intensity:P,u_inv_rot_matrix:yT,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){j.u_inv_rot_matrix=b,j.u_merc_center=A,j.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],j.u_zoom_transition=a.aj(O.zoom);const Y=A[0]*a.al,W=A[1]*a.al;j.u_up_dir=O.projection.upVector(new a.cC(0,0,0),Y,W)}return j};function c_(x,[c,p,b,A],[C,P]){if(C===P)return[0,0,0,0];const O=255*(x-1)/(x*(P-C));return[c*O,p*O,b*O,A*O]}function jc(x,c,[p,b]){return p===b?0:.5/x+(c-p)*(x-1)/(x*(b-p))}const Ag=(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st,pt,xt,vt)=>({u_matrix:x,u_normalize_matrix:c,u_globe_matrix:p,u_merc_matrix:b,u_grid_matrix:A,u_tl_parent:C,u_scale_parent:G,u_fade_t:j.mix,u_opacity:j.opacity*Y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Y.paint.get("raster-brightness-min"),u_brightness_high:Y.paint.get("raster-brightness-max"),u_saturation_factor:a.dS(Y.paint.get("raster-saturation")),u_contrast_factor:a.dR(Y.paint.get("raster-contrast")),u_spin_weights:u_(Y.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:J,u_zoom_transition:P,u_merc_center:O,u_cutoff_params:B,u_colorization_mix:c_(a.dT,nt,st),u_colorization_offset:jc(a.dT,ut,st),u_color_ramp:tt,u_texture_offset:[xt/(pt+2*xt),pt/(pt+2*xt)],u_texture_res:[pt+2*xt,pt+2*xt],u_emissive_strength:vt});function u_(x){x*=Math.PI/180;const c=Math.sin(x),p=Math.cos(x);return[(2*p+1)/3,(-Math.sqrt(3)*c-p+1)/3,(Math.sqrt(3)*c-p+1)/3]}const Nh=.05,Mu=(x,c,p,b,A,C,P,O,B,G,j,Y)=>({u_matrix:x,u_normalize_matrix:c,u_globe_matrix:p,u_merc_matrix:b,u_grid_matrix:A,u_tl_parent:C,u_scale_parent:G,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:Y,u_zoom_transition:P,u_merc_center:O,u_cutoff_params:B}),kx=(x,c,p,b,A,C,P,O,B,G)=>({u_particle_texture:x,u_particle_texture_side_len:c,u_tile_offset:p,u_velocity:b,u_color_ramp:C,u_velocity_res:A,u_max_speed:P,u_uv_offset:O,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nh,Nh]}),h_=(x,c,p,b,A,C,P,O,B,G)=>({u_particle_texture:x,u_particle_texture_side_len:c,u_velocity:p,u_velocity_res:b,u_max_speed:A,u_speed_factor:C,u_reset_rate:P,u_rand_seed:Math.random(),u_uv_offset:O,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nh,Nh]}),Ox=a.bB(),zx=(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st,pt,xt,vt,Et,bt,Pt)=>{const Mt=A.transform,Tt={u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:Mt.getCameraToCenterDistance(pt),u_rotate_symbol:+p,u_aspect_ratio:Mt.width/Mt.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:O,u_is_text:+G,u_elevation_from_sea:B?1:0,u_pitch_with_map:+b,u_texsize:j,u_texsize_icon:Y,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ox,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ox,u_up_vector:[0,-1,0],u_color_adj_mat:Et,u_icon_transition:bt||0,u_gamma_scale:b?A.transform.getCameraToCenterDistance(pt)*Math.cos(A.terrain?0:A.transform._pitch):1,u_device_pixel_ratio:a.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Pt||1,u_ground_shadow_factor:xt,u_inv_matrix:a.bk(a.bB(),P),u_normal_scale:vt,u_lutTexture:eo.LUT};return pt.name==="globe"&&(Tt.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],Tt.u_zoom_transition=tt,Tt.u_inv_rot_matrix=ut,Tt.u_merc_center=nt,Tt.u_camera_forward=Mt._camera.forward(),Tt.u_ecef_origin=a.dU(Mt.globeMatrix,J.toUnwrapped()),Tt.u_tile_matrix=Float32Array.from(Mt.globeMatrix),Tt.u_up_vector=st),Tt},d_=(x,c,p,b)=>({u_matrix:x,u_emissive_strength:c,u_opacity:p,u_color:b}),f_=(x,c,p,b,A,C,P,O,B)=>Object.assign(function(G,j,Y,W,J,tt){const{width:nt,height:ut}=W.imageManager.getPixelSize(j),st=Math.pow(2,tt.tileID.overscaledZ),pt=tt.tileSize*Math.pow(2,W.transform.tileZoom)/st,xt=pt*(tt.tileID.canonical.x+tt.tileID.wrap*st),vt=pt*tt.tileID.canonical.y;return{u_image:0,u_pattern_tl:Y.tl,u_pattern_br:Y.br,u_texsize:[nt,ut],u_pattern_size:Y.displaySize,u_pattern_units_to_pixels:J?[W.transform.width,-1*W.transform.height]:[1/a.ay(tt,1,W.transform.tileZoom),1/a.ay(tt,1,W.transform.tileZoom)],u_pixel_coord_upper:[xt>>16,vt>>16],u_pixel_coord_lower:[65535&xt,65535&vt]}}(0,C,P,b,O,B),{u_matrix:x,u_emissive_strength:c,u_opacity:p}),Bx=new Float32Array(a.bz([])),p_=(x,c,p,b,A,C,P,O,B,G,j,Y,W,J=[0,0,0],tt,nt,ut)=>{const st=A.style.light,pt=st.properties.get("position"),xt=[-pt.x,-pt.y,pt.z],vt=a.dN();st.properties.get("anchor")==="viewport"&&(a.dO(vt,-A.transform.angle),a.dP(xt,xt,vt));const Et=j.alphaMode==="MASK",bt=st.properties.get("color").toNonPremultipliedRenderColor(null),Pt=W.paint.get("model-ambient-occlusion-intensity"),Mt=W.paint.get("model-color").constantOr(a.ao.white).toNonPremultipliedRenderColor(null);return Mt.a=W.paint.get("model-color-mix-intensity").constantOr(0),ut&&(Mt.r=ut[0],Mt.g=ut[1],Mt.b=ut[2],Mt.a=ut[3]),nt&&(Mt.r=nt.color.r,Mt.g=nt.color.g,Mt.b=nt.color.b,Mt.a=nt.colorMix,Y=nt.emissionStrength,C=nt.opacity),{u_matrix:x,u_lighting_matrix:c,u_normal_matrix:p,u_node_matrix:b||Bx,u_lightpos:xt,u_lightintensity:st.properties.get("intensity"),u_lightcolor:[bt.r,bt.g,bt.b],u_camera_pos:J,u_opacity:C,u_baseTextureIsAlpha:0,u_alphaMask:+Et,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:O.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:B,u_roughnessFactor:G,u_baseColorTexture:eo.BaseColor,u_metallicRoughnessTexture:eo.MetallicRoughness,u_normalTexture:eo.Normal,u_occlusionTexture:eo.Occlusion,u_emissionTexture:eo.Emission,u_lutTexture:eo.LUT,u_color_mix:Mt.toArray01(),u_aoIntensity:Pt,u_emissive_strength:Y,u_occlusionTextureTransform:tt||[0,0,0,0]}},hf=(x,c=Bx,p=Bx)=>({u_matrix:x,u_instance:c,u_node_matrix:p}),iD={fillExtrusion:x=>({u_matrix:new a.ck(x),u_lightpos:new a.ch(x),u_lightintensity:new a.ci(x),u_lightcolor:new a.ch(x),u_vertical_gradient:new a.ci(x),u_opacity:new a.ci(x),u_edge_radius:new a.ci(x),u_width_scale:new a.ci(x),u_ao:new a.cj(x),u_height_type:new a.cg(x),u_base_type:new a.cg(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_up_dir:new a.ch(x),u_height_lift:new a.ci(x),u_flood_light_color:new a.ch(x),u_vertical_scale:new a.ci(x),u_flood_light_intensity:new a.ci(x),u_ground_shadow_factor:new a.ch(x)}),fillExtrusionDepth:x=>({u_matrix:new a.ck(x),u_edge_radius:new a.ci(x),u_width_scale:new a.ci(x),u_vertical_scale:new a.ci(x),u_height_type:new a.cg(x),u_base_type:new a.cg(x)}),fillExtrusionPattern:x=>({u_matrix:new a.ck(x),u_lightpos:new a.ch(x),u_lightintensity:new a.ci(x),u_lightcolor:new a.ch(x),u_vertical_gradient:new a.ci(x),u_height_factor:new a.ci(x),u_edge_radius:new a.ci(x),u_width_scale:new a.ci(x),u_ao:new a.cj(x),u_height_type:new a.cg(x),u_base_type:new a.cg(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_up_dir:new a.ch(x),u_height_lift:new a.ci(x),u_image:new a.cg(x),u_texsize:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_tile_units_to_pixels:new a.ci(x),u_opacity:new a.ci(x),u_pattern_transition:new a.ci(x)}),fillExtrusionGroundEffect:x=>({u_matrix:new a.ck(x),u_opacity:new a.ci(x),u_ao_pass:new a.ci(x),u_meter_to_tile:new a.ci(x),u_ao:new a.cj(x),u_flood_light_intensity:new a.ci(x),u_flood_light_color:new a.ch(x),u_attenuation:new a.ci(x),u_edge_radius:new a.ci(x),u_fb:new a.cg(x),u_fb_size:new a.ci(x),u_dynamic_offset:new a.ci(x)}),fill:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_ground_shadow_factor:new a.ch(x)}),fillPattern:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_image:new a.cg(x),u_texsize:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_tile_units_to_pixels:new a.ci(x),u_ground_shadow_factor:new a.ch(x),u_pattern_transition:new a.ci(x)}),fillOutline:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_world:new a.cj(x),u_ground_shadow_factor:new a.ch(x)}),fillOutlinePattern:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_world:new a.cj(x),u_image:new a.cg(x),u_texsize:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_tile_units_to_pixels:new a.ci(x),u_ground_shadow_factor:new a.ch(x),u_pattern_transition:new a.ci(x)}),building:x=>({u_matrix:new a.ck(x),u_normal_matrix:new a.ck(x),u_opacity:new a.ci(x),u_faux_facade_ao_intensity:new a.ci(x),u_camera_pos:new a.ch(x),u_tile_to_meter:new a.ci(x),u_facade_emissive_chance:new a.ci(x),u_flood_light_color:new a.ch(x),u_flood_light_intensity:new a.ci(x)}),buildingBloom:x=>({u_matrix:new a.ck(x)}),buildingDepth:x=>({u_matrix:new a.ck(x)}),elevatedStructuresDepth:x=>({u_matrix:new a.ck(x),u_depth_bias:new a.ci(x)}),elevatedStructures:x=>({u_matrix:new a.ck(x),u_ground_shadow_factor:new a.ch(x)}),elevatedStructuresDepthReconstruct:x=>({u_matrix:new a.ck(x),u_camera_pos:new a.ch(x),u_depth_bias:new a.ci(x),u_height_scale:new a.ci(x),u_reset_depth:new a.ci(x)}),circle:a.dX,collisionBox:x=>({u_matrix:new a.ck(x),u_inv_rot_matrix:new a.ck(x),u_camera_to_center_distance:new a.ci(x),u_extrude_scale:new a.cj(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_tile_id:new a.ch(x)}),collisionCircle:x=>({u_matrix:new a.ck(x),u_inv_matrix:new a.ck(x),u_camera_to_center_distance:new a.ci(x),u_viewport_size:new a.cj(x)}),debug:x=>({u_color:new a.dA(x),u_matrix:new a.ck(x),u_overlay:new a.cg(x),u_overlay_scale:new a.ci(x)}),clippingMask:x=>({u_matrix:new a.ck(x)}),heatmap:x=>({u_extrude_scale:new a.ci(x),u_intensity:new a.ci(x),u_matrix:new a.ck(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_up_dir:new a.ch(x)}),heatmapTexture:x=>({u_image:new a.cg(x),u_color_ramp:new a.cg(x),u_opacity:new a.ci(x)}),hillshade:x=>({u_matrix:new a.ck(x),u_image:new a.cg(x),u_latrange:new a.cj(x),u_light:new a.cj(x),u_shadow:new a.dA(x),u_highlight:new a.dA(x),u_emissive_strength:new a.ci(x),u_accent:new a.dA(x)}),hillshadePrepare:x=>({u_matrix:new a.ck(x),u_image:new a.cg(x),u_dimension:new a.cj(x),u_zoom:new a.ci(x)}),line:a.dW,linePattern:a.dV,raster:x=>({u_matrix:new a.ck(x),u_normalize_matrix:new a.ck(x),u_globe_matrix:new a.ck(x),u_merc_matrix:new a.ck(x),u_grid_matrix:new a.dB(x),u_tl_parent:new a.cj(x),u_scale_parent:new a.ci(x),u_fade_t:new a.ci(x),u_opacity:new a.ci(x),u_image0:new a.cg(x),u_image1:new a.cg(x),u_brightness_low:new a.ci(x),u_brightness_high:new a.ci(x),u_saturation_factor:new a.ci(x),u_contrast_factor:new a.ci(x),u_spin_weights:new a.ch(x),u_perspective_transform:new a.cj(x),u_raster_elevation:new a.ci(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_cutoff_params:new a.d2(x),u_colorization_mix:new a.d2(x),u_colorization_offset:new a.ci(x),u_color_ramp:new a.cg(x),u_texture_offset:new a.cj(x),u_texture_res:new a.cj(x),u_emissive_strength:new a.ci(x)}),rasterParticle:x=>({u_matrix:new a.ck(x),u_normalize_matrix:new a.ck(x),u_globe_matrix:new a.ck(x),u_merc_matrix:new a.ck(x),u_grid_matrix:new a.dB(x),u_tl_parent:new a.cj(x),u_scale_parent:new a.ci(x),u_fade_t:new a.ci(x),u_opacity:new a.ci(x),u_image0:new a.cg(x),u_image1:new a.cg(x),u_raster_elevation:new a.ci(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_cutoff_params:new a.d2(x)}),rasterParticleTexture:x=>({u_texture:new a.cg(x),u_opacity:new a.ci(x)}),rasterParticleDraw:x=>({u_particle_texture:new a.cg(x),u_particle_texture_side_len:new a.ci(x),u_tile_offset:new a.cj(x),u_velocity:new a.cg(x),u_color_ramp:new a.cg(x),u_velocity_res:new a.cj(x),u_max_speed:new a.ci(x),u_uv_offset:new a.cj(x),u_data_scale:new a.cj(x),u_data_offset:new a.ci(x),u_particle_pos_scale:new a.ci(x),u_particle_pos_offset:new a.cj(x)}),rasterParticleUpdate:x=>({u_particle_texture:new a.cg(x),u_particle_texture_side_len:new a.ci(x),u_velocity:new a.cg(x),u_velocity_res:new a.cj(x),u_max_speed:new a.ci(x),u_speed_factor:new a.ci(x),u_reset_rate:new a.ci(x),u_rand_seed:new a.ci(x),u_uv_offset:new a.cj(x),u_data_scale:new a.cj(x),u_data_offset:new a.ci(x),u_particle_pos_scale:new a.ci(x),u_particle_pos_offset:new a.cj(x)}),symbol:x=>({u_is_size_zoom_constant:new a.cg(x),u_is_size_feature_constant:new a.cg(x),u_size_t:new a.ci(x),u_size:new a.ci(x),u_camera_to_center_distance:new a.ci(x),u_rotate_symbol:new a.cg(x),u_aspect_ratio:new a.ci(x),u_fade_change:new a.ci(x),u_matrix:new a.ck(x),u_label_plane_matrix:new a.ck(x),u_coord_matrix:new a.ck(x),u_is_text:new a.cg(x),u_elevation_from_sea:new a.cg(x),u_pitch_with_map:new a.cg(x),u_texsize:new a.cj(x),u_texsize_icon:new a.cj(x),u_texture:new a.cg(x),u_texture_icon:new a.cg(x),u_gamma_scale:new a.ci(x),u_device_pixel_ratio:new a.ci(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_camera_forward:new a.ch(x),u_tile_matrix:new a.ck(x),u_up_vector:new a.ch(x),u_ecef_origin:new a.ch(x),u_is_halo:new a.cg(x),u_icon_transition:new a.ci(x),u_color_adj_mat:new a.ck(x),u_scale_factor:new a.ci(x),u_ground_shadow_factor:new a.ch(x),u_inv_matrix:new a.ck(x),u_normal_scale:new a.ci(x),u_lutTexture:new a.cg(x)}),background:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_opacity:new a.ci(x),u_color:new a.dA(x)}),backgroundPattern:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_opacity:new a.ci(x),u_image:new a.cg(x),u_pattern_tl:new a.cj(x),u_pattern_br:new a.cj(x),u_texsize:new a.cj(x),u_pattern_size:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_pattern_units_to_pixels:new a.cj(x)}),terrainRaster:x=>({u_matrix:new a.ck(x),u_image0:new a.cg(x),u_skirt_height:new a.ci(x),u_ground_shadow_factor:new a.ch(x)}),skybox:x=>({u_matrix:new a.ck(x),u_sun_direction:new a.ch(x),u_cubemap:new a.cg(x),u_opacity:new a.ci(x),u_temporal_offset:new a.ci(x)}),skyboxGradient:x=>({u_matrix:new a.ck(x),u_color_ramp:new a.cg(x),u_center_direction:new a.ch(x),u_radius:new a.ci(x),u_opacity:new a.ci(x),u_temporal_offset:new a.ci(x)}),skyboxCapture:x=>({u_matrix_3f:new a.dB(x),u_sun_direction:new a.ch(x),u_sun_intensity:new a.ci(x),u_color_tint_r:new a.d2(x),u_color_tint_m:new a.d2(x),u_luminance:new a.ci(x)}),globeRaster:x=>({u_proj_matrix:new a.ck(x),u_globe_matrix:new a.ck(x),u_normalize_matrix:new a.ck(x),u_merc_matrix:new a.ck(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_image0:new a.cg(x),u_grid_matrix:new a.dB(x),u_skirt_height:new a.ci(x),u_far_z_cutoff:new a.ci(x),u_frustum_tl:new a.ch(x),u_frustum_tr:new a.ch(x),u_frustum_br:new a.ch(x),u_frustum_bl:new a.ch(x),u_globe_pos:new a.ch(x),u_globe_radius:new a.ci(x),u_viewport:new a.cj(x)}),globeAtmosphere:x=>({u_frustum_tl:new a.ch(x),u_frustum_tr:new a.ch(x),u_frustum_br:new a.ch(x),u_frustum_bl:new a.ch(x),u_horizon:new a.ci(x),u_transition:new a.ci(x),u_fadeout_range:new a.ci(x),u_atmosphere_fog_color:new a.d2(x),u_high_color:new a.d2(x),u_space_color:new a.d2(x),u_temporal_offset:new a.ci(x),u_horizon_angle:new a.ci(x)}),model:x=>({u_matrix:new a.ck(x),u_lighting_matrix:new a.ck(x),u_normal_matrix:new a.ck(x),u_node_matrix:new a.ck(x),u_lightpos:new a.ch(x),u_lightintensity:new a.ci(x),u_lightcolor:new a.ch(x),u_camera_pos:new a.ch(x),u_opacity:new a.ci(x),u_baseColorFactor:new a.d2(x),u_emissiveFactor:new a.d2(x),u_metallicFactor:new a.ci(x),u_roughnessFactor:new a.ci(x),u_baseTextureIsAlpha:new a.cg(x),u_alphaMask:new a.cg(x),u_alphaCutoff:new a.ci(x),u_baseColorTexture:new a.cg(x),u_metallicRoughnessTexture:new a.cg(x),u_normalTexture:new a.cg(x),u_occlusionTexture:new a.cg(x),u_emissionTexture:new a.cg(x),u_lutTexture:new a.cg(x),u_color_mix:new a.d2(x),u_aoIntensity:new a.ci(x),u_emissive_strength:new a.ci(x),u_occlusionTextureTransform:new a.d2(x)}),modelDepth:x=>({u_matrix:new a.ck(x),u_instance:new a.ck(x),u_node_matrix:new a.ck(x)}),groundShadow:x=>({u_matrix:new a.ck(x),u_ground_shadow_factor:new a.ch(x)}),stars:x=>({u_matrix:new a.ck(x),u_up:new a.ch(x),u_right:new a.ch(x),u_intensity_multiplier:new a.ci(x)}),snowParticle:x=>({u_modelview:new a.ck(x),u_projection:new a.ck(x),u_time:new a.ci(x),u_cam_pos:new a.ch(x),u_velocityConeAperture:new a.ci(x),u_velocity:new a.ci(x),u_horizontalOscillationRadius:new a.ci(x),u_horizontalOscillationRate:new a.ci(x),u_boxSize:new a.ci(x),u_billboardSize:new a.ci(x),u_simpleShapeParameters:new a.cj(x),u_screenSize:new a.cj(x),u_thinningCenterPos:new a.cj(x),u_thinningShape:new a.ch(x),u_thinningAffectedRatio:new a.ci(x),u_thinningParticleOffset:new a.ci(x),u_particleColor:new a.d2(x),u_direction:new a.ch(x)}),rainParticle:x=>({u_modelview:new a.ck(x),u_projection:new a.ck(x),u_time:new a.ci(x),u_cam_pos:new a.ch(x),u_texScreen:new a.cg(x),u_velocityConeAperture:new a.ci(x),u_velocity:new a.ci(x),u_boxSize:new a.ci(x),u_rainDropletSize:new a.cj(x),u_distortionStrength:new a.ci(x),u_rainDirection:new a.ch(x),u_color:new a.d2(x),u_screenSize:new a.cj(x),u_thinningCenterPos:new a.cj(x),u_thinningShape:new a.ch(x),u_thinningAffectedRatio:new a.ci(x),u_thinningParticleOffset:new a.ci(x),u_shapeDirectionalPower:new a.ci(x),u_shapeNormalPower:new a.ci(x),u_mode:new a.ci(x)}),vignette:x=>({u_vignetteShape:new a.ch(x),u_vignetteColor:new a.d2(x)}),occlusion:x=>({u_matrix:new a.ck(x),u_anchorPos:new a.ch(x),u_screenSizePx:new a.cj(x),u_occluderSizePx:new a.cj(x),u_color:new a.d2(x)})};class Cu{constructor(c,p,b,A){this.id=Cu.uniqueIdxCounter,Cu.uniqueIdxCounter++,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!b,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||A||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=Cu.uniqueIdxCounter,Cu.uniqueIdxCounter++;const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Cu.uniqueIdxCounter=0;const bT={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class rD{constructor(c,p,b,A,C,P){this.length=p.length,this.attributes=b,this.itemSize=p.bytesPerElement,this.dynamicDraw=A,this.instanceCount=P,this.context=c;const O=c.gl;this.buffer=O.createBuffer(),c.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||C||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,p){for(let b=0;b<this.attributes.length;b++){const A=p.getAttributeLocation(c,this.attributes[b].name);A!==-1&&c.enableVertexAttribArray(A)}}setVertexAttribPointers(c,p,b){for(let A=0;A<this.attributes.length;A++){const C=this.attributes[A],P=p.getAttributeLocation(c,C.name);P!==-1&&c.vertexAttribPointer(P,C.components,c[bT[C.type]],!1,this.itemSize,C.offset+this.itemSize*(b||0))}}setVertexAttribDivisor(c,p,b){for(let A=0;A<this.attributes.length;A++){const C=p.getAttributeLocation(c,this.attributes[A].name);C!==-1&&this.instanceCount&&this.instanceCount>0&&c.vertexAttribDivisor(C,b)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class g_{constructor(c,p,b,A,C){this.context=c,this.width=p,this.height=b;const P=this.framebuffer=c.gl.createFramebuffer();A&&(this.colorAttachment=new KE(c,P)),C&&(this.depthAttachmentType=C,this.depthAttachment=C==="renderbuffer"?new dT(c,P):new JE(c,P))}destroy(){const c=this.context.gl;if(this.colorAttachment){const p=this.colorAttachment.get();p&&c.deleteTexture(p)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const p=this.depthAttachment.get();p&&c.deleteRenderbuffer(p)}else{const p=this.depthAttachment.get();p&&c.deleteTexture(p)}c.deleteFramebuffer(this.framebuffer)}}class m_{constructor(c,p){this.gl=c,this.clearColor=new nT(this),this.clearDepth=new _x(this),this.clearStencil=new WE(this),this.colorMask=new $E(this),this.depthMask=new ZE(this),this.stencilMask=new qE(this),this.stencilFunc=new aT(this),this.stencilOp=new XE(this),this.stencilTest=new Yv(this),this.depthRange=new YE(this),this.depthTest=new oT(this),this.depthFunc=new yx(this),this.blend=new Kv(this),this.blendFunc=new xx(this),this.blendColor=new zh(this),this.blendEquation=new nf(this),this.cullFace=new yg(this),this.cullFaceSide=new af(this),this.frontFace=new sT(this),this.program=new bx(this),this.activeTexture=new lT(this),this.viewport=new of(this),this.bindFramebuffer=new Jv(this),this.bindRenderbuffer=new Qv(this),this.bindTexture=new Sx(this),this.bindVertexBuffer=new t_(this),this.bindElementBuffer=new xg(this),this.bindVertexArrayOES=new cT(this),this.pixelStoreUnpack=new uT(this),this.pixelStoreUnpackPremultiplyAlpha=new hT(this),this.pixelStoreUnpackFlipY=new sf(this),this.options=p?Object.assign({},p):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=p&&!!p.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=c.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),this.maxPointSize=c.getParameter(c.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,p,b){return new Cu(this,c,p,b)}createVertexBuffer(c,p,b,A,C){return new rD(this,c,p,b,A,C)}createRenderbuffer(c,p,b){const A=this.gl,C=A.createRenderbuffer();return this.bindRenderbuffer.set(C),A.renderbufferStorage(A.RENDERBUFFER,c,p,b),this.bindRenderbuffer.set(null),C}createFramebuffer(c,p,b,A){return new g_(this,c,p,b,A)}clear({color:c,depth:p,stencil:b,colorMask:A}){const C=this.gl;let P=0;c&&(P|=C.COLOR_BUFFER_BIT,this.clearColor.set(c.toNonPremultipliedRenderColor(null)),this.colorMask.set(A||[!0,!0,!0,!0])),p!==void 0&&(P|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),b!==void 0&&(P|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),C.clear(P)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){a.bx(c.blendFunction,lr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor),c.blendEquation?this.blendEquation.set(c.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(c.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let hc;function Ig(x,c,p,b,A,C,P){const O=x.context,B=O.gl,G=x.transform,j=[a.aF(G.center.lng),a.aJ(G.center.lat)],Y=p.layout.get("symbol-placement"),W=p.layout.get("text-variable-anchor"),J=p.layout.get("icon-rotation-alignment")==="map",tt=p.layout.get("text-rotation-alignment")==="map",nt=Y!=="point",ut=[];let st=0,pt=0;for(let Tt=0;Tt<b.length;Tt++){const Lt=b[Tt],qt=c.getTile(Lt),jt=qt.getBucket(p);if(!jt)continue;const oe=jt.getProjection().createInversionMatrix(G,Lt.canonical),te=[],he=KS(Lt,jt,G),Oe=!P&&J&&nt,Jt=P&&tt&&nt,Ut=W&&jt.hasTextData(),de=jt.hasIconTextFit()&&Ut&&jt.hasIconData(),ee=Oe||Jt||P&&Ut||de,Ae=jt.projection.name==="globe",Ue=Ae?a.aj(G.zoom):0;Ae&&(te.push("PROJECTION_GLOBE_VIEW"),ee&&te.push("PROJECTED_POS_ON_VIEWPORT"));const ci=x.getOrCreateProgram("collisionBox",{defines:te});let Le=he;A[0]===0&&A[1]===0||(Le=x.translatePosMatrix(he,qt,A,C));const Be=P?jt.textCollisionBox:jt.iconCollisionBox,hi=jt.collisionCircleArray;if(hi.length>0){const ii=a.bB(),ai=Le;a.cO(ii,jt.placementInvProjMatrix,G.glCoordMatrix),a.cO(ii,ii,jt.placementViewportMatrix),ut.push({circleArray:hi,circleOffset:pt,transform:ai,invTransform:ii,projection:jt.getProjection()}),st+=hi.length/4,pt=st}if(!Be)continue;x.terrain&&x.terrain.setupElevationDraw(qt,ci);const ni=Ae?[Lt.canonical.x,Lt.canonical.y,1<<Lt.canonical.z]:[0,0,0];ci.draw(x,B.LINES,fi.disabled,$i.disabled,x.colorModeForRenderPass(),Ni.disabled,uf(Le,oe,G,Ue,j,qt,ni,jt.getProjection()),p.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,G.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt])}if(!P||!ut.length)return;const xt=x.getOrCreateProgram("collisionCircle"),vt=new a.dY;vt.resize(4*st),vt._trim();let Et=0;for(const Tt of ut)for(let Lt=0;Lt<Tt.circleArray.length/4;Lt++){const qt=4*Lt,jt=Tt.circleArray[qt+0],oe=Tt.circleArray[qt+1],te=Tt.circleArray[qt+2],he=Tt.circleArray[qt+3];vt.emplace(Et++,jt,oe,te,he,0),vt.emplace(Et++,jt,oe,te,he,1),vt.emplace(Et++,jt,oe,te,he,2),vt.emplace(Et++,jt,oe,te,he,3)}(!hc||hc.length<2*st)&&(hc=function(Tt){const Lt=2*Tt,qt=new a.b0;qt.resize(Lt),qt._trim();for(let jt=0;jt<Lt;jt++){const oe=6*jt;qt.uint16[oe+0]=4*jt+0,qt.uint16[oe+1]=4*jt+1,qt.uint16[oe+2]=4*jt+2,qt.uint16[oe+3]=4*jt+2,qt.uint16[oe+4]=4*jt+3,qt.uint16[oe+5]=4*jt+0}return qt}(st));const bt=O.createIndexBuffer(hc,!0),Pt=O.createVertexBuffer(vt,a.dZ.members,!0);for(const Tt of ut){const Lt={u_matrix:Tt.transform,u_inv_matrix:Tt.invTransform,u_camera_to_center_distance:(Mt=G).getCameraToCenterDistance(Tt.projection),u_viewport_size:[Mt.width,Mt.height]};xt.draw(x,B.TRIANGLES,fi.disabled,$i.disabled,x.colorModeForRenderPass(),Ni.disabled,Lt,p.id,Pt,bt,a.bf.simpleSegment(0,2*Tt.circleOffset,Tt.circleArray.length,Tt.circleArray.length/2),null,G.zoom)}var Mt;Pt.destroy(),bt.destroy()}const Eu=a.bB();function Fx(x){const c=x._camera.getWorldToCamera(x.worldSize,1),p=a.aB([],c,x.globeMatrix);a.bk(p,p);const b=[0,0,0],A=[0,1,0,0];return a.aC(A,A,p),b[0]=A[0],b[1]=A[1],b[2]=A[2],a.aw(b,b),b}function v_({width:x,height:c,anchor:p,textOffset:b,textScale:A},C){const{horizontalAlign:P,verticalAlign:O}=a.c0(p),B=-(P-.5)*x,G=-(O-.5)*c,j=a.c1(p,b);return new a.P((B/A+j[0])*C,(G/A+j[1])*C)}function __(x,c,p,b,A,C,P,O,B,G){const j=x.text.placedSymbolArray,Y=x.text.dynamicLayoutVertexArray,W=x.icon.dynamicLayoutVertexArray,J={},tt=x.getProjection(),nt=Fv(P,tt,A),ut=A.elevation,st=tt.upVectorScale(P.canonical,A.center.lat,A.worldSize).metersToTile;Y.clear();for(let pt=0;pt<j.length;pt++){const xt=j.get(pt),{tileAnchorX:vt,tileAnchorY:Et,numGlyphs:bt}=xt,Pt=xt.hidden||!xt.crossTileID||x.allowVerticalPlacement&&!xt.placedOrientation?null:b[xt.crossTileID];if(Pt){let Mt=0,Tt=0,Lt=0;const qt=x.elevationType==="road";if(ut||qt){const ee=qt?x.getElevationFeatureForText(pt):null,Ae=a.bU.getAtTileOffset(P,new a.P(vt,Et),ut,ee),[Ue,ci,Le]=tt.upVector(P.canonical,vt,Et);Mt=Ae*Ue*st,Tt=Ae*ci*st,Lt=Ae*Le*st}let[jt,oe,te,he]=Ba(xt.projectedAnchorX+Mt,xt.projectedAnchorY+Tt,xt.projectedAnchorZ+Lt,p?nt:C);const Oe=ax(A.getCameraToCenterDistance(tt),he);let Jt=a.bL(x.textSizeData,B,xt)*Oe/a.bX;p&&(Jt*=x.tilePixelRatio/O);const Ut=v_(Pt,Jt);p?({x:jt,y:oe,z:te}=tt.projectTilePoint(vt+Ut.x,Et+Ut.y,P.canonical),[jt,oe,te]=Ba(jt+Mt,oe+Tt,te+Lt,C)):(c&&Ut._rotate(-A.angle),jt+=Ut.x,oe+=Ut.y,te=0);const de=x.allowVerticalPlacement&&xt.placedOrientation===a.bK.vertical?Math.PI/2:0;for(let ee=0;ee<bt;ee++)a.bN(Y,jt,oe,te,de);G&&xt.associatedIconIndex>=0&&(J[xt.associatedIconIndex]={x:jt,y:oe,z:te,angle:de})}else Vc(bt,Y)}if(G){W.clear();const pt=x.icon.placedSymbolArray;for(let xt=0;xt<pt.length;xt++){const vt=pt.get(xt),{numGlyphs:Et}=vt,bt=J[xt];if(vt.hidden||!bt)Vc(Et,W);else{const{x:Pt,y:Mt,z:Tt,angle:Lt}=bt;for(let qt=0;qt<Et;qt++)a.bN(W,Pt,Mt,Tt,Lt)}}x.icon.dynamicLayoutVertexBuffer.updateData(W)}x.text.dynamicLayoutVertexBuffer.updateData(Y)}function Mg(x,c,p,b,A,C,P={}){const O=p.paint.get("icon-translate"),B=p.paint.get("text-translate"),G=p.paint.get("icon-translate-anchor"),j=p.paint.get("text-translate-anchor"),Y=p.layout.get("icon-rotation-alignment"),W=p.layout.get("text-rotation-alignment"),J=p.layout.get("icon-pitch-alignment"),tt=p.layout.get("text-pitch-alignment"),nt=p.layout.get("icon-keep-upright"),ut=p.layout.get("text-keep-upright"),st=p.paint.get("icon-color-saturation"),pt=p.paint.get("icon-color-contrast"),xt=p.paint.get("icon-color-brightness-min"),vt=p.paint.get("icon-color-brightness-max"),Et=p.layout.get("symbol-elevation-reference")==="sea",bt=p.layout.get("icon-image-use-theme")==="none",Pt=x.context,Mt=Pt.gl,Tt=x.transform,Lt=Y==="map",qt=W==="map",jt=J==="map",oe=tt==="map",te=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let he=!1;const Oe=x.depthModeForSublayer(0,fi.ReadOnly),Jt=new fi(x.context.gl.LEQUAL,fi.ReadOnly,x.depthRangeFor3D),Ut=[a.aF(Tt.center.lng),a.aJ(Tt.center.lat)],de=p.layout.get("text-variable-anchor"),ee=Tt.projection.name==="globe",Ae=[],Ue=[0,-1,0];for(const ci of b){const Le=c.getTile(ci),Be=Le.getBucket(p);if(!Be||Be.projection.name==="mercator"&&ee||Be.fullyClipped)continue;const hi=Be.projection.name==="globe",ni=hi?a.aj(Tt.zoom):0,ii=Fv(ci,Be.getProjection(),Tt),ai=Tt.calculatePixelsToTileUnitsMatrix(Le),Ei=de&&Be.hasTextData(),mr=Be.hasIconTextFit()&&Ei&&Be.hasIconData(),Ir=Be.getProjection().createInversionMatrix(Tt,ci.canonical),an=(1<<Le.tileID.canonical.z)*a.al/x.transform.worldSize,Vi=Zr=>{let Hi=[0,0,0];if(Zr){const Dr=x.style.directionalLight,zn=x.style.ambientLight;Dr&&zn&&(Hi=bl(x.style,Dr,zn))}return Hi},Tr=Zr=>{Tt.depthOcclusionForSymbolsAndCircles&&(p.hasOcclusionOpacityProperties||x.terrain)&&(Zr.push("DEPTH_D24"),Zr.push("DEPTH_OCCLUSION"))},ir=Zr=>{p.lut&&!bt&&(p.lut.texture||(p.lut.texture=new a.d_(x.context,p.lut.image,[p.lut.image.height,p.lut.image.height,p.lut.image.height],Pt.gl.RGBA8)),Pt.activeTexture.set(Pt.gl.TEXTURE0+eo.LUT),p.lut.texture&&p.lut.texture.bind(Pt.gl.LINEAR,Pt.gl.CLAMP_TO_EDGE),Zr.push("APPLY_LUT_ON_GPU"))},Qr=()=>{const Zr=Lt&&p.layout.get("symbol-placement")!=="point",Hi=[];Tr(Hi),ir(Hi);const Dr=Zr||mr,zn=Be.elevationType==="road",ia=x.shadowRenderer,Un=zn&&jt&&!!ia&&ia.enabled,Kn=Vi(Un),ds=zn&&jt&&!x.terrain?Jt:Oe,Jo=p.paint.get("icon-image-cross-fade");x.terrainRenderModeElevated()&&jt&&Hi.push("PITCH_WITH_MAP_TERRAIN"),hi&&(Hi.push("PROJECTION_GLOBE_VIEW"),Dr&&Hi.push("PROJECTED_POS_ON_VIEWPORT")),Jo>0&&Be.hasAnySecondaryIcon&&Hi.push("ICON_TRANSITION"),!Be.icon.zOffsetVertexBuffer||zn&&x.terrain||Hi.push("Z_OFFSET"),st===0&&pt===0&&xt===0&&vt===1||Hi.push("COLOR_ADJUSTMENT"),Be.sdfIcons&&Hi.push("RENDER_SDF"),Un&&Hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),zn&&jt&&!x.terrain&&Be.icon.orientationVertexBuffer&&Hi.push("ELEVATED_ROADS");const fo=Be.icon.programConfigurations.get(p.id),Io=x.getOrCreateProgram("symbol",{config:fo,defines:Hi}),Xs=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0],po=Be.iconSizeData,Ys=a.bJ(po,Tt.zoom),Ml=jt||!Tt.isOrthographic,qa=$d(ii,Le.tileID.canonical,jt,Lt,Tt,Be.getProjection(),ai),Wn=Nc(ii,Le.tileID.canonical,jt,Lt,Tt,Be.getProjection(),ai),ra=x.translatePosMatrix(Wn,Le,O,G,!0),hn=x.translatePosMatrix(ii,Le,O,G),sa=Dr?Eu:qa,Xa=Lt&&!jt&&!Zr;let $n=Ue;!ee&&!Tt.mercatorFromTransition||Lt||($n=Fx(Tt));const Ks=hi?$n:Ue,If=p.getColorAdjustmentMatrix(st,pt,xt,vt),Yc=zx(po.kind,Ys,Xa,jt,x,hn,sa,ra,Et,!1,Xs,[0,0],0,ci,ni,Ut,Ir,Ks,Be.getProjection(),Kn,an,If,Jo,null),Mf=Le.imageAtlasTexture?Le.imageAtlasTexture:null,Cf=p.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear,Js=Be.sdfIcons||x.options.rotating||x.options.zooming||Cf||Ml?Mt.LINEAR:Mt.NEAREST,fc=Be.sdfIcons&&p.paint.get("icon-halo-width").constantOr(1)!==0,ja=x.terrain&&jt&&Zr?a.bk(a.bB(),qa):Eu;if(Zr&&Be.icon){const Qs=a.bU.getAtTileOffsetFunc(ci,Tt.center.lat,Tt.worldSize,Be.getProjection()),$h=og(ii,Le.tileID.canonical,jt,Lt,Tt,Be.getProjection(),ai),WT=p.layout.get("icon-size-scale-range"),N_=a.aA(x.scaleFactor,WT[0],WT[1]);sx(Be,ii,x,!1,$h,Wn,jt,nt,Qs,ci,N_)}return{program:Io,buffers:Be.icon,uniformValues:Yc,atlasTexture:Mf,atlasTextureIcon:null,atlasInterpolation:Js,atlasInterpolationIcon:null,isSDF:Be.sdfIcons,hasHalo:fc,depthMode:ds,tile:Le,renderWithShadows:Un,labelPlaneMatrixInv:ja}},Mr=()=>{const Zr=qt&&p.layout.get("symbol-placement")!=="point",Hi=[],Dr=Zr||de||mr,zn=Be.elevationType==="road",ia=x.shadowRenderer,Un=zn&&oe&&!!ia&&ia.enabled,Kn=Vi(Un),ds=zn&&oe&&!x.terrain?Jt:Oe;x.terrainRenderModeElevated()&&oe&&Hi.push("PITCH_WITH_MAP_TERRAIN"),hi&&(Hi.push("PROJECTION_GLOBE_VIEW"),Dr&&Hi.push("PROJECTED_POS_ON_VIEWPORT")),!Be.text.zOffsetVertexBuffer||zn&&x.terrain||Hi.push("Z_OFFSET"),Be.iconsInText&&Hi.push("RENDER_TEXT_AND_SYMBOL"),Hi.push("RENDER_SDF"),Un&&Hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),zn&&oe&&!x.terrain&&Be.text.orientationVertexBuffer&&Hi.push("ELEVATED_ROADS"),Tr(Hi);const Jo=Be.text.programConfigurations.get(p.id),fo=x.getOrCreateProgram("symbol",{config:Jo,defines:Hi});let Io,Xs=[0,0],po=null;const Ys=Be.textSizeData;Be.iconsInText&&(Xs=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0],po=Le.imageAtlasTexture?Le.imageAtlasTexture:null,Io=oe||!Tt.isOrthographic||x.options.rotating||x.options.zooming||Ys.kind==="composite"||Ys.kind==="camera"?Mt.LINEAR:Mt.NEAREST);const Ml=Le.glyphAtlasTexture?Le.glyphAtlasTexture.size:[0,0],qa=p.layout.get("text-size-scale-range"),Wn=a.aA(x.scaleFactor,qa[0],qa[1]),ra=a.bJ(Ys,Tt.zoom,Wn),hn=$d(ii,Le.tileID.canonical,oe,qt,Tt,Be.getProjection(),ai),sa=Nc(ii,Le.tileID.canonical,oe,qt,Tt,Be.getProjection(),ai),Xa=x.translatePosMatrix(sa,Le,B,j,!0),$n=x.translatePosMatrix(ii,Le,B,j),Ks=Dr?Eu:hn,If=qt&&!oe&&!Zr;let Yc=Ue;!ee&&!Tt.mercatorFromTransition||qt||(Yc=Fx(Tt));const Mf=zx(Ys.kind,ra,If,oe,x,$n,Ks,Xa,Et,!0,Ml,Xs,0,ci,ni,Ut,Ir,hi?Yc:Ue,Be.getProjection(),Kn,an,null,null,Wn),Cf=Le.glyphAtlasTexture?Le.glyphAtlasTexture:null,Js=Mt.LINEAR,fc=p.paint.get("text-halo-width").constantOr(1)!==0,ja=x.terrain&&oe&&Zr?a.bk(a.bB(),hn):Eu;if(Zr&&Be.text){const Qs=a.bU.getAtTileOffsetFunc(ci,Tt.center.lat,Tt.worldSize,Be.getProjection()),$h=og(ii,Le.tileID.canonical,oe,qt,Tt,Be.getProjection(),ai);sx(Be,ii,x,!0,$h,sa,oe,ut,Qs,ci,Wn)}return{program:fo,buffers:Be.text,uniformValues:Mf,atlasTexture:Cf,atlasTextureIcon:po,atlasInterpolation:Js,atlasInterpolationIcon:Io,isSDF:!0,hasHalo:fc,depthMode:ds,tile:Le,renderWithShadows:Un,labelPlaneMatrixInv:ja}},pn=Be.icon.segments.get().length,Or=Be.text.segments.get().length,ar=pn&&!P.onlyText?Qr():null,Gr=Or&&!P.onlyIcons?Mr():null,cr=p.paint.get("icon-opacity").constantOr(1),wn=p.paint.get("text-opacity").constantOr(1);if(te&&Be.canOverlap){he=!0;const Zr=cr&&!P.onlyText?Be.icon.segments.get():[],Hi=wn&&!P.onlyIcons?Be.text.segments.get():[];for(const Dr of Zr)Ae.push({segments:new a.bf([Dr]),sortKey:Dr.sortKey,state:ar});for(const Dr of Hi)Ae.push({segments:new a.bf([Dr]),sortKey:Dr.sortKey,state:Gr})}else P.onlyText||Ae.push({segments:cr?Be.icon.segments:new a.bf([]),sortKey:0,state:ar}),P.onlyIcons||Ae.push({segments:wn?Be.text.segments:new a.bf([]),sortKey:0,state:Gr})}he&&Ae.sort((ci,Le)=>ci.sortKey-Le.sortKey);for(const ci of Ae){const Le=ci.state;if(Le)if(x.terrain?x.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:Tt.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}):x.setupDepthForOcclusion(Tt.depthOcclusionForSymbolsAndCircles,Le.program),Pt.activeTexture.set(Mt.TEXTURE0),Le.atlasTexture&&Le.atlasTexture.bind(Le.atlasInterpolation,Mt.CLAMP_TO_EDGE,!0),Le.atlasTextureIcon&&(Pt.activeTexture.set(Mt.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Mt.CLAMP_TO_EDGE,!0)),Le.renderWithShadows&&x.shadowRenderer.setupShadows(Le.tile.tileID.toUnwrapped(),Le.program,"vector-tile"),x.uploadCommonLightUniforms(x.context,Le.program),Le.hasHalo){const Be=Le.uniformValues;Be.u_is_halo=1,y_(Le.buffers,ci.segments,p,x,Le.program,Le.depthMode,A,C,Be,2),Be.u_is_halo=0}else{if(Le.isSDF){const Be=Le.uniformValues;Le.hasHalo&&(Be.u_is_halo=1,y_(Le.buffers,ci.segments,p,x,Le.program,Le.depthMode,A,C,Be,1)),Be.u_is_halo=0}y_(Le.buffers,ci.segments,p,x,Le.program,Le.depthMode,A,C,Le.uniformValues,1)}}}function y_(x,c,p,b,A,C,P,O,B,G){const j=[x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer,x.iconTransitioningVertexBuffer,x.globeExtVertexBuffer,x.zOffsetVertexBuffer,x.orientationVertexBuffer];A.draw(b,b.context.gl.TRIANGLES,C,P,O,Ni.disabled,B,p.id,x.layoutVertexBuffer,x.indexBuffer,c,p.paint,b.transform.zoom,x.programConfigurations.get(p.id),j,G)}function wT(x,c){const p=1<<x.canonical.z,b=(c.x*p-x.canonical.x-x.wrap*p)*a.al,A=(c.y*p-x.canonical.y)*a.al,C=a.e7(c.z,c.y);return a.d4(b,A,C)}function Vh(x,c,p,b,A){if(!p.layout||p.layout.get("fill-elevation-reference")==="none"||p.paint.get("fill-opacity").constantOr(1)===0)return;const C=x.context.gl,P=new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D),O=new fi(x.context.gl.GREATER,fi.ReadWrite,x.depthRangeFor3D),B=function(J){let tt=.01;return J.isOrthographic&&(tt=a.ak(1e-4,tt,a.c$(J.pitch>=kh?1:J.pitch/kh))),2*tt}(x.transform),G=x.transform.getFreeCameraOptions().position,j="elevatedStructuresDepthReconstruct",Y=x.getOrCreateProgram(j,{defines:["DEPTH_RECONSTRUCTION"]}),W=x.getOrCreateProgram(j);for(const J of b){const tt=c.getTile(J),nt=tt.getBucket(p);if(!nt)continue;const ut=nt.elevatedStructures;if(!ut)continue;const st=nt.elevationBufferData.heightRange,pt=wT(J.toUnwrapped(),G),xt=x.translatePosMatrix(J.projMatrix,tt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));let vt,Et,bt,Pt;if(A==="initialize"){if(!st||st.min>=1||ut.depthSegments.segments[0].primitiveLength===0)continue;vt=l_(xt,pt,B,1,0),Et=P,bt=ut.depthSegments,Pt=Y}else if(A==="reset"){if(!st||st.min>=0||ut.maskSegments.segments[0].primitiveLength===0)continue;vt=l_(xt,pt,0,0,1),Et=O,bt=ut.maskSegments,Pt=Y}else if(A==="geometry"){if(ut.depthSegments.segments[0].primitiveLength===0)continue;vt=l_(xt,pt,B,1,0),Et=P,bt=ut.depthSegments,Pt=W}Pt.draw(x,C.TRIANGLES,Et,$i.disabled,lr.disabled,Ni.disabled,vt,p.id,ut.vertexBuffer,ut.indexBuffer,bt,p.paint,x.transform.zoom)}}function df(x,c,p){const{painter:b,sourceCache:A,layer:C,coords:P,colorMode:O,elevationType:B,terrainEnabled:G,pass:j}=x,Y=b.context.gl,W=C.paint.get("fill-pattern"),J=C.paint.get("fill-pattern-cross-fade"),tt=W.constantOr(null);let nt=B;B!=="road"||c&&!G||(nt="none");const ut=nt==="road",st=x.painter.shadowRenderer,pt=ut&&!!st&&st.enabled,xt=new fi(b.context.gl.LEQUAL,fi.ReadOnly,b.depthRangeFor3D);let vt=[0,0,0];if(pt){const Pt=b.style.directionalLight,Mt=b.style.ambientLight;Pt&&Mt&&(vt=bl(b.style,Pt,Mt))}const Et=W&&W.constantOr(1),bt=(Pt,Mt)=>{let Tt,Lt,qt,jt,oe;Mt?(Tt=Et&&!C.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",qt=Y.LINES):(Tt=Et?"fillPattern":"fill",qt=Y.TRIANGLES);for(const te of P){const he=A.getTile(te);if(Et&&!he.patternsLoaded())continue;const Oe=he.getBucket(C);if(!Oe)continue;const Jt=c?Oe.elevationBufferData:Oe.bufferData;if(Jt.isEmpty())continue;b.prepareDrawTile();const Ut=Jt.programConfigurations.get(C.id),de=b.isTileAffectedByFog(te),ee=[],Ae=[];ut&&(ee.push("ELEVATED_ROADS"),Ae.push(Jt.elevatedLayoutVertexBuffer)),pt&&ee.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Et&&(b.context.activeTexture.set(Y.TEXTURE0),he.imageAtlasTexture&&he.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Ut.updatePaintBuffers());let Ue=!1;if(tt&&he.imageAtlas){const ni=he.imageAtlas,ii=a.e2.from(tt),ai=ii.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),Ei=ii.getSecondary(),mr=ni.patternPositions.get(ai),Ir=Ei?ni.patternPositions.get(Ei.scaleSelf(a.o.devicePixelRatio).toString()):null;Ue=!!mr&&!!Ir,mr&&Ut.setConstantPatternPositions(mr,Ir)}J>0&&(Ue||Ut.getPatternTransitionVertexBuffer("fill-pattern"))&&ee.push("FILL_PATTERN_TRANSITION");const ci=b.getOrCreateProgram(Tt,{config:Ut,overrideFog:de,defines:ee}),Le=b.translatePosMatrix(te.projMatrix,he,C.paint.get("fill-translate"),C.paint.get("fill-translate-anchor"));pt&&st.setupShadows(he.tileID.toUnwrapped(),ci,"vector-tile");const Be=C.paint.get("fill-emissive-strength");if(Mt){jt=Jt.lineIndexBuffer,oe=Jt.lineSegments;const ni=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[Y.drawingBufferWidth,Y.drawingBufferHeight];Lt=Tt==="fillOutlinePattern"&&Et?tD(Le,Be,b,he,ni,vt,J):QE(Le,Be,ni,vt)}else jt=Jt.indexBuffer,oe=Jt.triangleSegments,Lt=Et?vT(Le,Be,b,he,vt,J):mT(Le,Be,vt);b.uploadCommonUniforms(b.context,ci,te.toUnwrapped());let hi=Pt;(B==="road"&&!G||B==="offset")&&(hi=xt),ci.draw(b,qt,hi,p||b.stencilModeForClipping(te),O,Ni.disabled,Lt,C.id,Jt.layoutVertexBuffer,jt,oe,C.paint,b.transform.zoom,Ut,Ae)}};b.renderPass===j&&bt(b.depthModeForSublayer(1,b.renderPass==="opaque"?fi.ReadWrite:fi.ReadOnly),!1),nt==="none"&&b.renderPass==="translucent"&&C.paint.get("fill-antialias")&&bt(b.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,fi.ReadOnly),!0)}function si(x,c,p,b,A,C,P,O){p.resetLayerRenderingStats(x);const B=x.context,G=B.gl,j=x.transform,Y=p.paint.get("fill-extrusion-pattern"),W=p.paint.get("fill-extrusion-pattern-cross-fade"),J=Y.constantOr(null),tt=Y.constantOr(1),nt=p.paint.get("fill-extrusion-opacity"),ut=x.style.enable3dLights(),st=p.paint.get(ut&&!tt?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pt=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),st],xt=p.layout.get("fill-extrusion-edge-radius"),vt=xt>0&&!p.paint.get("fill-extrusion-rounded-roof"),Et=vt?0:xt,bt=j.projection.name==="globe"?a.ea():0,Pt=j.projection.name==="globe",Mt=Pt?a.aj(j.zoom):0,Tt=[a.aF(j.center.lng),a.aJ(j.center.lat)],Lt=p.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",qt=p.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Lt?null:p.lut).toArray01().slice(0,3),jt=p.paint.get("fill-extrusion-flood-light-intensity"),oe=p.paint.get("fill-extrusion-vertical-scale"),te=p.paint.get("fill-extrusion-line-width").constantOr(1)!==0,he=p.paint.get("fill-extrusion-height-alignment"),Oe=p.paint.get("fill-extrusion-base-alignment"),Jt=Hc(x,p.paint.get("fill-extrusion-cutoff-fade-range")),Ut=[];let de;Pt&&Ut.push("PROJECTION_GLOBE_VIEW"),pt[0]>0&&Ut.push("FAUX_AO"),vt&&Ut.push("ZERO_ROOF_RADIUS"),O&&Ut.push("HAS_CENTROID"),jt>0&&Ut.push("FLOOD_LIGHT"),Jt.shouldRenderCutoff&&Ut.push("RENDER_CUTOFF"),te&&Ut.push("RENDER_WALL_MODE");const ee=x.renderPass==="shadow",Ae=x.shadowRenderer,Ue=ee&&!!Ae,ci=ee?Ni.disabled:Ni.backCCW;x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!0);let Le=[0,0,0];if(Ae){const ni=x.style.directionalLight,ii=x.style.ambientLight;ni&&ii&&(Le=bl(x.style,ni,ii)),ee||(Ut.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ae.useNormalOffset&&Ut.push("NORMAL_OFFSET")),de=Ut.concat(["SHADOWS_SINGLE_CASCADE"])}const Be=Ue?"fillExtrusionDepth":tt?"fillExtrusionPattern":"fillExtrusion",hi=p.getLayerRenderingStats();for(const ni of b){const ii=c.getTile(ni),ai=ii.getBucket(p);if(!ai||ai.projection.name!==j.projection.name)continue;let Ei=!1;Ae&&(Ei=Ae.getMaxCascadeForTile(ni.toUnwrapped())===0);const mr=x.isTileAffectedByFog(ni),Ir=ai.programConfigurations.get(p.id);let an=!1;if(J&&ii.imageAtlas){const Or=ii.imageAtlas,ar=a.e2.from(J),Gr=ar.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),cr=ar.getSecondary(),wn=Or.patternPositions.get(Gr),Zr=cr?Or.patternPositions.get(cr.scaleSelf(a.o.devicePixelRatio).toString()):null;an=!!wn&&!!Zr,wn&&Ir.setConstantPatternPositions(wn,Zr)}W>0&&(an||Ir.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ut.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Vi=x.getOrCreateProgram(Be,{config:Ir,defines:Ei?de:Ut,overrideFog:mr});if(x.terrain&&x.terrain.setupElevationDraw(ii,Vi,{useMeterToDem:!0}),!ai.centroidVertexBuffer){const Or=Vi.getAttributeLocation(G,"a_centroid_pos");Or!==-1&&G.vertexAttrib2f(Or,0,0)}!ee&&Ae&&Ae.setupShadows(ii.tileID.toUnwrapped(),Vi,"vector-tile"),tt&&(x.context.activeTexture.set(G.TEXTURE0),ii.imageAtlasTexture&&ii.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ir.updatePaintBuffers());const Tr=p.paint.get("fill-extrusion-vertical-gradient"),ir=1/ai.tileToMeter;let Qr;if(ee&&Ae){if(ST(ii.tileID,ai.maxHeight,x))continue;const Or=Ae.calculateShadowPassMatrixFromTile(ii.tileID.toUnwrapped());Qr=pT(Or,Et,ir,oe,he,Oe)}else{const Or=x.translatePosMatrix(ni.expandedProjMatrix,ii,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),ar=j.projection.createInversionMatrix(j,ni.canonical);Qr=tt?gT(Or,x,Tr,nt,pt,Et,ir,ni,ii,bt,he,Oe,Mt,Tt,ar,qt,oe,W):s_(Or,x,Tr,nt,pt,Et,ir,ni,bt,he,Oe,Mt,Tt,ar,qt,oe,jt,Le)}x.uploadCommonUniforms(B,Vi,ni.toUnwrapped(),null,Jt);let Mr=ai.segments;if(j.projection.name==="mercator"&&!ee&&(Mr=ai.getVisibleSegments(ii.tileID,x.terrain,x.transform.getFrustum(0)),!Mr.get().length))continue;if(hi)if(ee)for(const Or of Mr.get())hi.numRenderedVerticesInShadowPass+=Or.primitiveLength;else for(const Or of Mr.get())hi.numRenderedVerticesInTransparentPass+=Or.primitiveLength;const pn=[];(x.terrain||O)&&pn.push(ai.centroidVertexBuffer),Pt&&pn.push(ai.layoutVertexExtBuffer),te&&pn.push(ai.wallVertexBuffer),Vi.draw(x,B.gl.TRIANGLES,A,C,P,ci,Qr,p.id,ai.layoutVertexBuffer,ai.indexBuffer,Mr,p.paint,x.transform.zoom,Ir,pn)}x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!1)}class Nx{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Wc(x,c,p,b,A,C,P,O,B,G,j,Y,W,J,tt,nt,ut,st,pt,xt){const vt=c.context,Et=vt.gl,bt=c.transform,Pt=c.transform.zoom,Mt=[],Tt=x.translate,Lt=x.translateAnchor,qt=x.edgeRadius,jt=Hc(c,x.cutoffFadeRange);j==="clear"?(Mt.push("CLEAR_SUBPASS"),xt&&(Mt.push("CLEAR_FROM_TEXTURE"),vt.activeTexture.set(Et.TEXTURE0),xt.bind(Et.LINEAR,Et.CLAMP_TO_EDGE))):j==="sdf"&&Mt.push("SDF_SUBPASS"),st&&Mt.push("HAS_CENTROID"),jt.shouldRenderCutoff&&Mt.push("RENDER_CUTOFF");const oe=(te,he,Oe,Jt,Ut)=>{let de=Mt;he.groundRadiusBuffer!=null&&(de=Mt.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ee=he.programConfigurations.get(b.id),Ae=c.isTileAffectedByFog(te),Ue=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:ee,defines:de,overrideFog:Ae}),ci=cf(c,Jt,Y,G,Ut,[W,J*Ut],tt,nt,ut,Pt>=17?0:qt*Ut,xt?xt.size[0]:0),Le=[];st&&Le.push(he.hiddenByLandmarkVertexBuffer),he.groundRadiusBuffer!=null&&Le.push(he.groundRadiusBuffer),c.uploadCommonUniforms(vt,Ue,te.toUnwrapped(),null,jt),Ue.draw(c,vt.gl.TRIANGLES,C,P,O,B,ci,b.id,he.vertexBuffer,he.indexBuffer,Oe,b.paint,Pt,ee,Le)};for(const te of A){const he=p.getTile(te),Oe=he.getBucket(b);if(!Oe||Oe.projection.name!==bt.projection.name||!Oe.groundEffect||Oe.groundEffect&&!Oe.groundEffect.hasData())continue;const Jt=Oe.groundEffect,Ut=1/Oe.tileToMeter;{const de=c.translatePosMatrix(te.projMatrix,he,Tt,Lt),ee=Jt.getDefaultSegment();oe(te,Jt,ee,de,Ut)}if(pt)for(let de=0;de<4;de++){const ee=a.e8[de](te),Ae=p.getTile(ee);if(!Ae)continue;const Ue=Ae.getBucket(b);if(!Ue||Ue.projection.name!==bt.projection.name||!Ue.groundEffect||Ue.groundEffect&&!Ue.groundEffect.hasData())continue;const ci=Ue.groundEffect;let Le,Be;de===0?(Le=[-a.al,0,0],Be=1):de===1?(Le=[a.al,0,0],Be=0):de===2?(Le=[0,-a.al,0],Be=3):(Le=[0,a.al,0],Be=2);const hi=ci.regionSegments[Be];if(!hi)continue;const ni=new Float32Array(16);a.bq(ni,te.projMatrix,Le),oe(te,ci,hi,c.translatePosMatrix(ni,he,Tt,Lt),Ut)}}}function Du(x,c,p,b,A,C,P){b.centroidVertexArray.length===0&&b.createCentroidsBuffer();const O=C?C.findDEMTileFor(p):null;if(!(O&&O.dem||P))return;C&&O&&O.dem&&b.selfDEMTileTimestamp!==O.dem._timestamp&&(b.borderDoneWithNeighborZ=[-1,-1,-1,-1],b.selfDEMTileTimestamp=O.dem._timestamp);const B=st=>new a.P(Math.ceil((st+a.ec)*a.ed),0),G=st=>{const pt=c.getSource().minzoom,xt=Et=>{const bt=c.getTileByID(Et);if(bt&&bt.hasData())return bt.getBucket(A)},vt=[0,-1,1];for(const Et of vt){if(st.overscaledZ+Et<pt)continue;const bt=xt(st.calculateScaledKey(st.overscaledZ+Et));if(bt)return bt}},j=[0,0,0],Y=(st,pt)=>(j[0]=Math.min(st.min.y,pt.min.y),j[1]=Math.max(st.max.y,pt.max.y),j[2]=a.al-pt.min.x>st.max.x?pt.min.x-a.al:st.max.x,j),W=(st,pt)=>(j[0]=Math.min(st.min.x,pt.min.x),j[1]=Math.max(st.max.x,pt.max.x),j[2]=a.al-pt.min.y>st.max.y?pt.min.y-a.al:st.max.y,j),J=[(st,pt)=>Y(st,pt),(st,pt)=>Y(pt,st),(st,pt)=>W(st,pt),(st,pt)=>W(pt,st)],tt=(st,pt,xt,vt,Et,bt,Pt)=>{if(!C)return 0;const Mt=[[bt?xt:st,bt?st:xt,0],[bt?xt:pt,bt?pt:xt,0]],Tt=Pt<0?a.al+Pt:Pt,Lt=[bt?Tt:(st+pt)/2,bt?(st+pt)/2:Tt,0];return xt===0&&Pt<0||xt!==0&&Pt>0?C.getForTilePoints(Et,[Lt],!0,vt):Mt.push(Lt),C.getForTilePoints(p,Mt,!0,O),Math.max(Mt[0][2],Mt[1][2],Lt[2])/C.exaggeration()};for(let st=0;st<4;st++){const pt=b.borderFeatureIndices[st];if(pt.length===0)continue;const xt=a.e8[st](p),vt=G(xt);if(!(vt&&vt instanceof a.e9))continue;const Et=C?C.findDEMTileFor(xt):null;if(!(Et&&Et.dem||P)||(C&&Et&&Et.dem&&b.borderDEMTileTimestamp[st]!==Et.dem._timestamp&&(b.borderDoneWithNeighborZ[st]=-1,b.borderDEMTileTimestamp[st]=Et.dem._timestamp),b.borderDoneWithNeighborZ[st]===vt.canonical.z))continue;vt.centroidVertexArray.length===0&&vt.createCentroidsBuffer();const bt=(st<2?1:5)-st,Pt=vt.borderDoneWithNeighborZ[bt]!==b.canonical.z,Mt=vt.borderFeatureIndices[bt];let Tt=0;if(b.canonical.z!==vt.canonical.z){for(const Lt of pt)b.showCentroid(b.featuresOnBorder[Lt]);if(Pt)for(const Lt of Mt)vt.showCentroid(vt.featuresOnBorder[Lt]);b.borderDoneWithNeighborZ[st]=vt.canonical.z,vt.borderDoneWithNeighborZ[bt]=b.canonical.z}for(const Lt of pt){const qt=b.featuresOnBorder[Lt],jt=b.centroidData[qt.centroidDataIndex],oe=qt.borders[st];let te;for(;Tt<Mt.length;){te=vt.featuresOnBorder[Mt[Tt]];const he=te.borders[bt];if(he[1]>oe[0]+3||he[0]>oe[0]-3)break;vt.showCentroid(te),Tt++}if(te&&Tt<Mt.length){const he=Tt;let Oe=0;for(;!(te.borders[bt][0]>oe[1]-3)&&(Oe++,++Tt!==Mt.length);)te=vt.featuresOnBorder[Mt[Tt]];te=vt.featuresOnBorder[Mt[he]];let Jt=!1;if(Oe>=1){const ee=te.borders[bt];Math.abs(oe[0]-ee[0])<3&&Math.abs(oe[1]-ee[1])<3&&(Oe=1,Jt=!0,Tt=he+1)}else if(Oe===0){b.showCentroid(qt);continue}const Ut=vt.centroidData[te.centroidDataIndex];P&&Jt&&(((nt=jt).flags|(ut=Ut).flags)&a.eb?(nt.flags|=a.eb,ut.flags|=a.eb):(nt.flags&=~a.eb,ut.flags&=~a.eb));const de=qt.intersectsCount()>1||te.intersectsCount()>1;if(Oe>1)Tt=he,jt.centroidXY=Ut.centroidXY=new a.P(0,0);else if(Et&&Et.dem&&!de){const ee=J[st](jt,Ut),Ae=st%2?a.al-1:0,Ue=tt(ee[0],Math.min(a.al-1,ee[1]),Ae,Et,xt,st<2,ee[2]);jt.centroidXY=Ut.centroidXY=B(Ue)}else de?jt.centroidXY=Ut.centroidXY=new a.P(0,0):(jt.centroidXY=b.encodeBorderCentroid(qt),Ut.centroidXY=vt.encodeBorderCentroid(te));b.writeCentroidToBuffer(jt),vt.writeCentroidToBuffer(Ut)}else b.showCentroid(qt)}b.borderDoneWithNeighborZ[st]=vt.canonical.z,vt.borderDoneWithNeighborZ[bt]=b.canonical.z}var nt,ut;(b.needsCentroidUpdate||!b.centroidVertexBuffer&&b.centroidVertexArray.length!==0)&&b.uploadCentroid(x)}const Pu=[1,0,0],Ci=[0,1,0],Vx=[0,0,1];function ST(x,c,p){const b=p.transform,A=p.shadowRenderer;if(!A)return!0;const C=x.toUnwrapped(),P=b.tileSize*A._cascades[p.currentShadowCascade].scale;let O=c;if(b.elevation){const nt=b.elevation.getMinMaxForTile(x);nt&&(O+=nt.max)}const B=[...A.shadowDirection];B[2]=-B[2];const G=A.computeSimplifiedTileShadowVolume(C,O,P,B);if(!G)return!1;const j=[Pu,Ci,Vx,B,[B[0],0,B[2]],[0,B[1],B[2]]],Y=b.projection.name==="globe",W=b.scaleZoom(P),J=a.cA.fromInvProjectionMatrix(b.invProjMatrix,b.worldSize,W,!Y),tt=A.getCurrentCascadeFrustum();return J.intersectsPrecise(G.vertices,G.planes,j)===0||tt.intersectsPrecise(G.vertices,G.planes,j)===0}function x_(x){const{painter:c,source:p,layer:b,coords:A}=x;let C=x.defines;const P=c.context,O=c.renderPass==="shadow",B=c.renderPass==="light-beam",G=c.shadowRenderer,j=a.ee(c.transform.center.lat,c.transform.zoom),Y=Hc(c,b.paint.get("building-cutoff-fade-range"));Y.shouldRenderCutoff&&(C=C.concat("RENDER_CUTOFF")),x.floodLightIntensity>0&&(C=C.concat("FLOOD_LIGHT"));for(const W of A){const J=p.getTile(W),tt=J.getBucket(b);if(!tt)continue;G&&G.getMaxCascadeForTile(W.toUnwrapped())===0&&(C=C.concat("SHADOWS_SINGLE_CASCADE"));const nt=tt.programConfigurations.get(b.id);let ut,st,pt,xt=c.translatePosMatrix(W.expandedProjMatrix,J,[0,0],"map");if(xt=a.cR(a.bB(),xt,[1,1,x.verticalScale]),O&&G){if(ST(J.tileID,tt.maxHeight*j,c))continue;let Et=G.calculateShadowPassMatrixFromTile(J.tileID.toUnwrapped());Et=a.cR(a.bB(),Et,[1,1,x.verticalScale]),pt=_T(Et),ut=st=c.getOrCreateProgram("buildingDepth",{config:nt,defines:C,overrideFog:!1})}else if(B)ut=st=c.getOrCreateProgram("buildingBloom",{config:nt,defines:C,overrideFog:!1}),pt=Lx(xt);else{const Et=c.transform.calculatePosMatrix(W.toUnwrapped(),c.transform.worldSize);a.cR(Et,Et,[1,1,x.verticalScale]);const bt=a.bB();a.cR(bt,Et,[1,-1,1/j]),a.bk(bt,bt),a.ef(bt,bt);const Pt=c.transform.getFreeCameraOptions().position,Mt=1<<W.canonical.z;if(pt=Px(xt,bt,x.opacity,x.facadeAOIntensity,[((Pt.x-W.wrap)*Mt-W.canonical.x)*a.al,(Pt.y*Mt-W.canonical.y)*a.al,Pt.z*Mt*a.al],tt.tileToMeter,x.facadeEmissiveChance,x.floodLightColor,x.floodLightIntensity),st=c.getOrCreateProgram("building",{config:nt,defines:C,overrideFog:!1}),x.depthOnly===!0)ut=st;else{const Tt=C.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ut=c.getOrCreateProgram("building",{config:nt,defines:Tt,overrideFog:!1})}G&&(G.setupShadowsFromMatrix(Et,st,!0),ut!==st&&G.setupShadowsFromMatrix(Et,ut,!0))}const vt=(Et,bt)=>{if(B){const Pt=Et.entranceBloom;bt.draw(c,P.gl.TRIANGLES,x.depthMode,$i.disabled,x.blendMode,Ni.disabled,pt,b.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segmentsBucket,b.paint,c.transform.zoom,nt,[Pt.layoutAttenuationBuffer,Pt.layoutColorBuffer])}else{const Pt=Et.segmentsBucket;let Mt=[Et.layoutNormalBuffer,Et.layoutCentroidBuffer,Et.layoutColorBuffer,Et.layoutFloodLightDataBuffer];Et.layoutFacadePaintBuffer&&(Mt=Mt.concat([Et.layoutFacadeDataBuffer,Et.layoutFacadeVerticalRangeBuffer,Et.layoutFacadePaintBuffer])),bt.draw(c,P.gl.TRIANGLES,x.depthMode,$i.disabled,x.blendMode,O?Ni.disabled:Ni.backCW,pt,b.id,Et.layoutVertexBuffer,Et.indexBuffer,Pt,b.paint,c.transform.zoom,nt,Mt)}};c.uploadCommonUniforms(P,st,W.toUnwrapped(),null,Y),tt.buildingWithoutFacade&&vt(tt.buildingWithoutFacade,st),tt.buildingWithFacade&&(ut!==st&&c.uploadCommonUniforms(P,ut,W.toUnwrapped(),null,Y),vt(tt.buildingWithFacade,ut))}}function b_(x,c,p,b,A,C,P,O,B,G,j,Y,W){const J=x.context.gl,tt=x.depthModeForSublayer(1,fi.ReadOnly,J.LEQUAL,!0),nt=.1*(1-(ut=j))+3*ut;var ut;const st=x._showOverdrawInspector,pt=Y,xt=new Nx;st||Wc(xt,x,c,p,b,tt,new $i({func:J.ALWAYS,mask:255},255,255,J.KEEP,J.KEEP,J.REPLACE),new lr([J.ONE,J.ONE,J.ONE,J.ONE],a.ao.transparent,[!1,!1,!1,!0],J.MIN),Ni.disabled,A,"sdf",C,P,O,B,G,nt,pt,!1);{const vt=st?$i.disabled:new $i({func:J.EQUAL,mask:255},255,255,J.KEEP,J.DECR,J.DECR),Et=st?x.colorModeForRenderPass():new lr([J.ONE_MINUS_DST_ALPHA,J.DST_ALPHA,J.ONE,J.ONE],a.ao.transparent,[!0,!0,!0,!0]);Wc(xt,x,c,p,b,tt,vt,Et,Ni.disabled,A,"color",C,P,O,B,G,nt,pt,!1)}}function Ux(x){return[x[0]*a.eg,x[1]*a.eg,x[2]*a.eg,0]}function Gx(x,c,p,b,A,C,P,O,B){const G=b.getSource(),j=p.globeSharedBuffers;if(!j)return;let Y,W,J;if(c&&(Y=b.getTile(c)),G instanceof a.aT?(W=G.texture,J=a.dJ(0,0,p.transform)):Y&&c&&(W=Y.texture,J=a.dJ(c.canonical.z,c.canonical.x,p.transform)),!W||!J)return;x||(J=a.cR(a.bB(),J,[1,-1,1]));const tt=p.context,nt=tt.gl,ut=A.paint.get("raster-resampling")==="nearest"?nt.NEAREST:nt.LINEAR,st=p.colorModeForDrapableLayerRenderPass(C),pt=P.defines;pt.push("GLOBE_POLES");const xt=new fi(nt.LEQUAL,fi.ReadWrite,p.depthRangeFor3D),vt=Float32Array.from(p.transform.expandedFarZProjMatrix),Et=Float32Array.from(a.bj(a.dI(new a.cC(0,0,0))));p.terrain&&p.terrain.prepareDrawTile(),tt.activeTexture.set(nt.TEXTURE0),W.bind(ut,nt.CLAMP_TO_EDGE),tt.activeTexture.set(nt.TEXTURE1),W.bind(ut,nt.CLAMP_TO_EDGE),"useMipmap"in W&&tt.extTextureFilterAnisotropic&&p.transform.pitch>20&&nt.texParameterf(nt.TEXTURE_2D,tt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,tt.extTextureFilterAnisotropicMax);const[bt,Pt,Mt,Tt]=c?j.getPoleBuffers(c.canonical.z,!1):j.getPoleBuffers(0,!0),Lt=A.paint.get("raster-elevation");let qt;x?(qt=bt,p.renderDefaultNorthPole=Lt!==0):(qt=Pt,p.renderDefaultSouthPole=Lt!==0);const jt=Ux(P.mix),oe=((he,Oe,Jt,Ut,de,ee,Ae,Ue,ci,Le,Be,hi,ni)=>Ag(he,Oe,Jt,new Float32Array(16),new Float32Array(9),[0,0],Ut,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ee,[0,0],Ue,2,Le,Be,hi,1,0,ni))(vt,Et,J,a.aj(p.transform.zoom),0,A,0,Lt,0,jt,P.offset,P.range,C),te=p.getOrCreateProgram("raster",{defines:pt});p.uploadCommonUniforms(tt,te,null),te.draw(p,nt.TRIANGLES,xt,B,st,O,oe,A.id,qt,Mt,Tt)}function TT(x){const c=x._nearZ,p=x.projection.farthestPixelDistance(x),b=p-c,A=.2*x.height,C=c+A;return[c,p,(C-A-c)/b,(C-c)/b]}function nD(x,c,p,b){if(x)return c instanceof Ga&&x instanceof Su?c.getTextureDescriptor(x,p,!0):{texture:x.texture,mix:Ux(b.mix),offset:b.offset,buffer:0,tileSize:1}}var aD=a.eh([{name:"a_index",type:"Int16",components:1}]);class Ts{constructor(c,p,b,A){const C={width:b[0],height:b[1],data:null},P=c.gl;this.targetColorTexture=new a.T(c,C,P.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(c,C,P.RGBA8,{useMipmap:!1}),this.context=c,this.updateParticleTexture(p,A),this.lastInvalidatedAt=0}updateParticleTexture(c,p){if(this.particleTextureDimension===p.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const b=this.context.gl,A=p.width*p.height;this.particleTexture0=new a.T(this.context,p,b.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,p,b.RGBA8,{premultiply:!1,useMipmap:!1});const C=new a.ei;C.reserve(A);for(let P=0;P<A;P++)C.emplaceBack(P);this.particleIndexBuffer=this.context.createVertexBuffer(C,aD.members,!0),this.particleSegment=a.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=p.width}update(c){return!(this.lastInvalidatedAt<c&&(this.lastInvalidatedAt=a.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Hx(x,c,p){if(!x)return null;const b=c.getTextureDescriptor(x,p,!0);if(!b)return null;let{texture:A,mix:C,offset:P,tileSize:O,buffer:B,format:G}=b;if(!A||!G)return null;let j=!1;return G==="uint32"&&(j=!0,C[3]=0,C=c_(a.ej,C,[0,p.paint.get("raster-particle-max-speed")]),P=jc(a.ej,P,[0,p.paint.get("raster-particle-max-speed")])),{texture:A,textureOffset:[B/(O+2*B),O/(O+2*B)],tileSize:O,scalarData:j,scale:C,offset:P,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function Ko(x){const c=x._nearZ,p=x.projection.farthestPixelDistance(x),b=p-c,A=.2*x.height,C=c+A;return[c,p,(C-A-c)/b,(C-c)/b]}const Lu=new a.ao(1,0,0,1),AT=new a.ao(0,1,0,1),jx=new a.ao(0,0,1,1),Wx=new a.ao(1,0,1,1),$x=new a.ao(0,1,1,1);function Zx(x,c,p,b,A,C){for(let P=0;P<p.length;P++)if(A){const G=new a.ao(b.r*.8,b.g*.8,b.b*.8,1);As(x,c,p[P],b,-1,-1,C),As(x,c,p[P],b,-1,1,C),As(x,c,p[P],b,1,1,C),As(x,c,p[P],b,1,-1,C),As(x,c,p[P],G,0,0,C)}else As(x,c,p[P],b,0,0,C)}function As(x,c,p,b,A,C,P){const O=x.context,B=x.transform,G=O.gl,j=B.projection.name==="globe",Y=j?["PROJECTION_GLOBE_VIEW"]:[];let W=a.by(p.projMatrix);if(j&&a.aj(B.zoom)>0){const jt=a.bi(p.canonical,B),oe=a.ek(jt);W=a.aB(new Float32Array(16),B.globeMatrix,oe),a.aB(W,B.projMatrix,W)}const J=a.bB();J[12]+=2*A/(a.o.devicePixelRatio*B.width),J[13]+=2*C/(a.o.devicePixelRatio*B.height),a.aB(W,J,W);const tt=x.getOrCreateProgram("debug",{defines:Y}),nt=c.getTileByID(p.key);x.terrain&&x.terrain.setupElevationDraw(nt,tt);const ut=fi.disabled,st=$i.disabled,pt=x.colorModeForRenderPass(),xt="$debug";O.activeTexture.set(G.TEXTURE0),x.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),j?nt._makeGlobeTileDebugBuffers(x.context,B):nt._makeDebugTileBoundsBuffers(x.context,B.projection);const vt=nt._tileDebugBuffer||x.debugBuffer,Et=nt._tileDebugIndexBuffer||x.debugIndexBuffer,bt=nt._tileDebugSegments||x.debugSegments;if(tt.draw(x,G.LINE_STRIP,ut,st,pt,Ni.disabled,Rx(W,b.toPremultipliedRenderColor(null)),xt,vt,Et,bt,null,null,null,[nt._globeTileDebugBorderBuffer]),P){const jt=nt.latestRawTileData,oe=Math.floor((jt&&jt.byteLength||0)/1024);let te=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(te+=` => ${p.overscaledZ}`),te+=` ${nt.state}`,te+=` ${oe}kb`,function(he,Oe){he.initDebugOverlayCanvas();const Jt=he.debugOverlayCanvas,Ut=he.context.gl,de=he.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,Jt.width,Jt.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(Oe,5,5),de.strokeText(Oe,5,5),he.debugOverlayTexture.update(Jt),he.debugOverlayTexture.bind(Ut.LINEAR,Ut.CLAMP_TO_EDGE)}(x,te)}const Pt=c.getTile(p).tileSize,Mt=512/Math.min(Pt,512)*(p.overscaledZ/B.zoom)*.5,Tt=nt._tileDebugTextBuffer||x.debugBuffer,Lt=nt._tileDebugTextIndexBuffer||x.quadTriangleIndexBuffer,qt=nt._tileDebugTextSegments||x.debugSegments;tt.draw(x,G.TRIANGLES,ut,st,lr.alphaBlended,Ni.disabled,Rx(W,a.ao.transparent.toPremultipliedRenderColor(null),Mt),xt,Tt,Lt,qt,null,null,null,[nt._globeTileDebugTextBuffer])}function xn(x,c,p,b){ff(x,0,c+p/2,x.transform.width,p,b)}function Cg(x,c,p,b){ff(x,c-p/2,0,p,x.transform.height,b)}function ff(x,c,p,b,A,C){const P=x.context,O=P.gl;O.enable(O.SCISSOR_TEST),O.scissor(c*a.o.devicePixelRatio,p*a.o.devicePixelRatio,b*a.o.devicePixelRatio,A*a.o.devicePixelRatio),P.clear({color:C}),O.disable(O.SCISSOR_TEST)}const IT=a.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:MT}=IT;function $c(x,c,p,b){x.emplaceBack(c,p,b)}class qx{constructor(c){this.vertexArray=new a.el,this.indices=new a.b0,$c(this.vertexArray,-1,-1,1),$c(this.vertexArray,1,-1,1),$c(this.vertexArray,-1,1,1),$c(this.vertexArray,1,1,1),$c(this.vertexArray,-1,-1,-1),$c(this.vertexArray,1,-1,-1),$c(this.vertexArray,-1,1,-1),$c(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,MT),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=a.bf.simpleSegment(0,0,36,12)}}function Tl(x,c,p,b,A,C){const P=x.context.gl,O=c.paint.get("sky-atmosphere-color"),B=c.paint.get("sky-atmosphere-halo-color"),G=c.paint.get("sky-atmosphere-sun-intensity"),j=((Y,W,J,tt,nt)=>({u_matrix_3f:Y,u_sun_direction:W,u_sun_intensity:J,u_color_tint_r:[tt.r,tt.g,tt.b,tt.a],u_color_tint_m:[nt.r,nt.g,nt.b,nt.a],u_luminance:5e-5}))(a.en(a.dN(),b),A,G,O.toPremultipliedRenderColor(null),B.toPremultipliedRenderColor(null));P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+C,c.skyboxTexture,0),p.draw(x,P.TRIANGLES,fi.disabled,$i.disabled,lr.unblended,Ni.frontCW,j,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Uh=a.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Pe{constructor(c){const p=new a.eo;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const b=new a.b0;b.emplaceBack(0,1,2),b.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(p,Uh.members),this.indexBuffer=c.createIndexBuffer(b),this.segments=a.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ei=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class pf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Yn{constructor(c){this.colorModeAlphaBlendedWriteRGB=new lr([1,oa,1,oa],a.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new lr([1,0,1,0],a.ao.transparent,[!1,!1,!1,!0]),this.params=new pf,this.updateNeeded=!0,c.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),c.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),c.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(c){const p=c.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Pe(p);const b=this.params.sizeRange,A=this.params.intensityRange,C=function(j){const Y=a.eq(30),W=[];for(let J=0;J<j;++J){const tt=2*Math.PI*Y(),nt=Math.acos(1-2*Y())-.5*Math.PI;W.push(a.d4(Math.cos(nt)*Math.cos(tt),Math.cos(nt)*Math.sin(tt),Math.sin(nt)))}return W}(this.params.starsCount),P=a.eq(300),O=new a.ep,B=new a.b0;let G=0;for(let j=0;j<C.length;++j){const Y=a.c4([],C[j],200),W=Math.max(0,1+.01*b*(1*P()-.5)),J=Math.max(0,1+.01*A*(1*P()-.5));O.emplaceBack(Y[0],Y[1],Y[2],-1,-1,W,J),O.emplaceBack(Y[0],Y[1],Y[2],1,-1,W,J),O.emplaceBack(Y[0],Y[1],Y[2],1,1,W,J),O.emplaceBack(Y[0],Y[1],Y[2],-1,1,W,J),B.emplaceBack(G+0,G+1,G+2),B.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=p.createVertexBuffer(O,ei.members),this.starsIdx=p.createIndexBuffer(B),this.starsSegments=a.bf.simpleSegment(0,0,O.length,B.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(c,p){const b=c.context,A=b.gl,C=c.transform,P=new fi(A.LEQUAL,fi.ReadOnly,[0,1]),O=a.aj(C.zoom),B=c.style.getLut(p.scope),G=p.properties.get("color-use-theme")==="none",j=p.properties.get("color").toNonPremultipliedRenderColor(G?null:B),Y=p.properties.get("high-color-use-theme")==="none",W=p.properties.get("high-color").toNonPremultipliedRenderColor(Y?null:B),J=p.properties.get("space-color-use-theme")==="none",tt=p.properties.get("space-color").toNonPremultipliedRenderColor(J?null:B),nt=5e-4,ut=a.er(p.properties.get("horizon-blend"),0,1,nt,.25),st=a.dD(c,b,C)&&ut===nt?C.worldSize/(2*Math.PI*1.025)-1:C.globeRadius,pt=c.frameCounter/1e3%1,xt=a.ag(C.globeCenterInViewSpace),vt=Math.sqrt(Math.pow(xt,2)-Math.pow(st,2)),Et=Math.acos(vt/xt),bt=Pt=>{const Mt=C.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Pt&&Mt.push("ALPHA_PASS");const Tt=c.getOrCreateProgram("globeAtmosphere",{defines:Mt}),Lt=((jt,oe,te,he,Oe,Jt,Ut,de,ee,Ae,Ue,ci)=>({u_frustum_tl:jt,u_frustum_tr:oe,u_frustum_br:te,u_frustum_bl:he,u_horizon:Oe,u_transition:Jt,u_fadeout_range:Ut,u_atmosphere_fog_color:de.toArray01(),u_high_color:ee.toArray01(),u_space_color:Ae.toArray01(),u_temporal_offset:Ue,u_horizon_angle:ci}))(C.frustumCorners.TL,C.frustumCorners.TR,C.frustumCorners.BR,C.frustumCorners.BL,C.frustumCorners.horizon,O,ut,j,W,tt,pt,Et);c.uploadCommonUniforms(b,Tt);const qt=this.atmosphereBuffer;qt&&Tt.draw(c,A.TRIANGLES,P,$i.disabled,Pt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ni.backCW,Lt,Pt?"atmosphere_glow_alpha":"atmosphere_glow",qt.vertexBuffer,qt.indexBuffer,qt.segments)};bt(!1),bt(!0)}drawStars(c,p){const b=a.aA(p.properties.get("star-intensity"),0,1);if(b===0)return;const A=c.context,C=A.gl,P=c.transform,O=c.getOrCreateProgram("stars"),B=a.c6([]);a.c8(B,B,-P._pitch),a.c7(B,B,-P.angle),a.c8(B,B,a.an(P._center.lat)),a.es(B,B,-a.an(P._center.lng));const G=a.cb(new Float32Array(16),B),j=a.aB([],P.starsProjMatrix,G),Y=a.en([],G),W=a.et([],Y),J=[0,1,0];a.dP(J,J,W),a.c4(J,J,this.params.sizeMultiplier);const tt=[1,0,0];a.dP(tt,tt,W),a.c4(tt,tt,this.params.sizeMultiplier);const nt=(ut=J,st=tt,pt=b,{u_matrix:Float32Array.from(j),u_up:ut,u_right:st,u_intensity_multiplier:pt});var ut,st,pt;c.uploadCommonUniforms(A,O),this.starsVx&&this.starsIdx&&O.draw(c,C.TRIANGLES,fi.disabled,$i.disabled,this.colorModeAlphaBlendedWriteRGB,Ni.disabled,nt,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Yt{constructor(){this.visibleTiles=[]}updateBorders(c,p){const b=[],A=[],C=c._getRenderableCoordinates(!1,!0);for(const B of C){const G=c.getTile(B);if(!G.hasData())continue;const j=G.getBucket(p);j&&(j.isEmpty()||(b.push(B.key),A.push({bucket:j,tileID:B.canonical})))}let P=b.length!==this.visibleTiles.length;if(!P){b.sort();for(let B=0;B<b.length;B++)if(b[B]!==this.visibleTiles[B]){P=!0;break}}if(!P)return;const O=new Set;this.visibleTiles=b,A.sort((B,G)=>B.tileID.z-G.tileID.z||B.tileID.x-G.tileID.x||B.tileID.y-G.tileID.y);for(const B of A){const G=new Array,j=new Array,Y=B.bucket;for(const W of Y.featuresOnBorder)O.has(W.featureId)?j.push(W.footprintIndex):(O.add(W.featureId),G.push(W.footprintIndex));Y.updateFootprintHiddenFlags(G,a.eu,!1),Y.updateFootprintHiddenFlags(j,a.eu,!0)}}}function Xx(x,c){const p=[...x],b=c.cameraWorldSizeForFog/c.worldSize,A=a.bz([]);return a.cR(A,A,[b,b,1]),a.aB(p,A,p),a.aB(p,c.worldToFogMatrix,p),p}function gf(x,c,p,b,A){const C=p.material,P=b.context,{baseColorTexture:O,metallicRoughnessTexture:B}=C.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:j,emissionTexture:Y}=C;function W(tt,nt,ut){if(tt&&(x.push(nt),P.activeTexture.set(P.gl.TEXTURE0+ut),tt.gfxTexture)){const{minFilter:st,magFilter:pt,wrapS:xt,wrapT:vt}=tt.sampler;tt.gfxTexture.bindExtraParam(st,pt,xt,vt)}}W(O,"HAS_TEXTURE_u_baseColorTexture",eo.BaseColor),W(B,"HAS_TEXTURE_u_metallicRoughnessTexture",eo.MetallicRoughness),W(G,"HAS_TEXTURE_u_normalTexture",eo.Normal),W(j,"HAS_TEXTURE_u_occlusionTexture",eo.Occlusion),W(Y,"HAS_TEXTURE_u_emissionTexture",eo.Emission),A&&(A.texture||(A.texture=new a.d_(b.context,A.image,[A.image.height,A.image.height,A.image.height],P.gl.RGBA8)),P.activeTexture.set(P.gl.TEXTURE0+eo.LUT),A.texture&&A.texture.bind(P.gl.LINEAR,P.gl.CLAMP_TO_EDGE),x.push("APPLY_LUT_ON_GPU")),p.texcoordBuffer&&(x.push("HAS_ATTRIBUTE_a_uv_2f"),c.push(p.texcoordBuffer)),p.colorBuffer&&(x.push(p.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),c.push(p.colorBuffer)),p.normalBuffer&&(x.push("HAS_ATTRIBUTE_a_normal_3f"),c.push(p.normalBuffer)),p.pbrBuffer&&(x.push("HAS_ATTRIBUTE_a_pbr"),x.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),c.push(p.pbrBuffer)),C.alphaMode!=="OPAQUE"&&C.alphaMode!=="MASK"||x.push("UNPREMULT_TEXTURE_IN_SHADER"),C.defined||x.push("DIFFUSE_SHADED");const J=b.shadowRenderer;J&&(x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),J.useNormalOffset&&x.push("NORMAL_OFFSET"))}function mf(x,c,p,b,A,C){const P=p.paint.get("model-opacity").constantOr(1),O=c.context,B=new fi(c.context.gl.LEQUAL,x.isLightMesh?fi.ReadOnly:fi.ReadWrite,c.depthRangeFor3D),G=c.transform,j=x.mesh,Y=j.material,W=Y.pbrMetallicRoughness,J=c.style.fog;let tt;tt=c.transform.projection.zAxisUnit==="pixels"?[...x.nodeModelMatrix]:a.aB([],b.zScaleMatrix,x.nodeModelMatrix),a.aB(tt,b.negCameraPosMatrix,tt);const nt=a.bk([],tt);a.ef(nt,nt);const ut=p.paint.get("model-color-use-theme").constantOr("default")==="none",st=p.paint.get("model-emissive-strength").constantOr(0),pt=p_(new Float32Array(x.worldViewProjection),new Float32Array(tt),new Float32Array(nt),null,c,P,W.baseColorFactor,Y.emissiveFactor,W.metallicFactor,W.roughnessFactor,Y,st,p,void 0,void 0,x.materialOverride,x.modelColor),xt={defines:[]},vt=[],Et=c.shadowRenderer;Et&&(Et.useNormalOffset=!1),gf(xt.defines,vt,j,c,ut?null:p.lut);let bt=null;if(J){const Tt=Xx(x.nodeModelMatrix,c.transform);if(bt=new Float32Array(Tt),G.projection.name!=="globe"){const Lt=j.aabb.min,qt=j.aabb.max,[jt,oe]=J.getOpacityForBounds(Tt,Lt[0],Lt[1],qt[0],qt[1]);xt.overrideFog=jt>=ie||oe>=ie}}const Pt=Hc(c,p.paint.get("model-cutoff-fade-range"));Pt.shouldRenderCutoff&&xt.defines.push("RENDER_CUTOFF");const Mt=c.getOrCreateProgram("model",xt);c.uploadCommonUniforms(O,Mt,null,bt,Pt),c.renderPass!=="shadow"&&Et&&Et.setupShadowsFromMatrix(x.nodeModelMatrix,Mt),Mt.draw(c,O.gl.TRIANGLES,B,A,C,j.material.doubleSided?Ni.disabled:Ni.backCCW,pt,p.id,j.vertexBuffer,j.indexBuffer,j.segments,p.paint,c.transform.zoom,void 0,vt)}function w_(x,c,p){return x.type==="vector"?c.scope:p?"basemap":""}function S_(x,c,p,b,A,C,P,O,B){const G=x.transform,j=!!c.isGeometryBloom&&c.isGeometryBloom;if(j&&x.renderPass==="shadow")return;const Y=G.projection.name==="globe"?a.eC(p,G):[...p];a.aB(Y,Y,c.globalMatrix);const W=a.aB([],b,Y);if(c.meshes)for(const J of c.meshes){const tt=O.get(J.material.name);if(tt&&tt.opacity<=0)continue;if(J.material.alphaMode!=="BLEND"){P.push({mesh:J,depth:0,modelIndex:A,worldViewProjection:W,nodeModelMatrix:Y,isLightMesh:j,materialOverride:tt,modelColor:B});continue}const nt=a.af([],J.centroid,W);!G.isOrthographic&&nt[2]<=0||C.push({mesh:J,depth:nt[2],modelIndex:A,worldViewProjection:W,nodeModelMatrix:Y,isLightMesh:j,materialOverride:tt,modelColor:B})}if(c.children)for(const J of c.children)S_(x,J,p,b,A,C,P,O,B)}function vf(x,c,p,b){const A=p.shadowRenderer;if(!A)return;const C=A.getShadowPassDepthMode(),P=A.getShadowPassColorMode(),O=A.calculateShadowPassMatrixFromMatrix(c),B=hf(O);p.getOrCreateProgram("modelDepth",{defines:p._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(p,p.context.gl.TRIANGLES,C,$i.disabled,P,Ni.disabled,B,b.id,x.vertexBuffer,x.indexBuffer,x.segments,b.paint,p.transform.zoom,void 0,void 0)}function _f(x,c,p,b,A,C){for(const P of A){const O=Object.assign({},b);O.part=P;const B={type:"Unknown",id:c,properties:O},G={orientation:x.paint.get("model-rotation").evaluate(B,p)};C.set(P,G)}}function oD(x,c,p,b,A,C){for(const P of A){const O=Object.assign({},b);O.part=P;const B={type:"Unknown",id:c,properties:O},G={color:x.paint.get("model-color").evaluate(B,p),colorMix:x.paint.get("model-color-mix-intensity").evaluate(B,p),opacity:x.paint.get("model-opacity").evaluate(B,p),emissionStrength:x.paint.get("model-emissive-strength").evaluate(B,p)};C.set(P,G)}}function CT(x,c,p,b,A,C){if(p===1)for(const O of A)mf(O,x,c,C[O.modelIndex],$i.disabled,x.colorModeForRenderPass());else{for(const O of A)mf(O,x,c,C[O.modelIndex],$i.disabled,lr.disabled);for(const O of A)mf(O,x,c,C[O.modelIndex],x.stencilModeFor3D(),x.colorModeForRenderPass());x.resetStencilClippingMasks()}const P=lr.additive;for(const O of b)mf(O,x,c,C[O.modelIndex],$i.disabled,O.isLightMesh?P:x.colorModeForRenderPass())}function ET(x,c,p){const b=c.updateZoomBasedPaintProperties(),A=function(C,P,O){let B,G,j,Y=C.terrain?C.terrain.exaggeration():0;if(C.terrain&&Y>0){const W=C.terrain,J=W.findDEMTileFor(O);J&&J.dem?B=a.eE.create(W,O,J):Y=0}if(Y===0&&(P.terrainElevationMin=0,P.terrainElevationMax=0),Y===P.validForExaggeration&&(Y===0||B&&B._demTile&&B._demTile.tileID===P.validForDEMTile.id&&B._dem._timestamp===P.validForDEMTile.timestamp))return!1;for(const W in P.instancesPerModel){const J=P.instancesPerModel[W];for(let tt=0;tt<J.instancedDataArray.length;++tt){const nt=(B?Y*B.getElevationAt(0|J.instancedDataArray.float32[16*tt],0|J.instancedDataArray.float32[16*tt+1],!0,!0):0)+J.instancesEvaluatedElevation[tt];J.instancedDataArray.float32[16*tt+6]=nt,G=G?Math.min(P.terrainElevationMin,nt):nt,j=j?Math.max(P.terrainElevationMax,nt):nt}}return P.terrainElevationMin=G||0,P.terrainElevationMax=j||0,P.validForExaggeration=Y,P.validForDEMTile=B&&B._demTile?{id:B._demTile.tileID,timestamp:B._dem._timestamp}:{id:void 0,timestamp:0},!0}(x,c,p);(b||A)&&(c.uploaded=!1,c.upload(x.context))}const Zs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.d8([0,0,0],[a.al,a.al,0])};function Yx(x,c){const p=1<<x.canonical.z,b=c.getFreeCameraOptions().position,A=c.elevation,C=x.canonical.x/p,P=(x.canonical.x+1)/p,O=x.canonical.y/p,B=(x.canonical.y+1)/p;let G=c._centerAltitude;if(A){const J=A.getMinMaxForTile(x);J&&J.max>G&&(G=J.max)}const j=a.aA(b.x,C,P)-b.x,Y=a.aA(b.y,O,B)-b.y,W=a.ce(G,c.center.lat)-b.z;return c._zoomFromMercatorZ(Math.sqrt(j*j+Y*Y+W*W))}function Kx(x,c,p,b,A,C,P){const O=x.context,B=x.renderPass==="shadow",G=x.shadowRenderer,j=B&&G?G.getShadowPassDepthMode():new fi(O.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D),Y=x.isTileAffectedByFog(C),W=x.transform.projection.name==="globe";if(p.meshes)for(const J of p.meshes){const tt=W?[]:["MODEL_POSITION_ON_GPU"],nt=[];let ut,st,pt;const xt=!W&&b.instancedDataArray.length>20;xt&&tt.push("INSTANCED_ARRAYS");const vt=Hc(x,c.paint.get("model-cutoff-fade-range"));if(vt.shouldRenderCutoff&&tt.push("RENDER_CUTOFF"),B&&G)ut=x.getOrCreateProgram("modelDepth",{defines:tt}),st=hf(P.shadowTileMatrix,P.shadowTileMatrix,Float32Array.from(p.globalMatrix)),pt=G.getShadowPassColorMode();else{gf(tt,nt,J,x,c.paint.get("model-color-use-theme").constantOr("default")==="none"?null:c.lut),ut=x.getOrCreateProgram("model",{defines:tt,overrideFog:Y});const bt=J.material,Pt=bt.pbrMetallicRoughness,Mt=c.paint.get("model-opacity").constantOr(1),Tt=c.paint.get("model-emissive-strength").constantOr(0);st=p_(C.expandedProjMatrix,Float32Array.from(p.globalMatrix),new Float32Array(16),null,x,Mt,Pt.baseColorFactor,bt.emissiveFactor,Pt.metallicFactor,Pt.roughnessFactor,bt,Tt,c,A),G&&(P.shadowUniformsInitialized?ut.setShadowUniformValues(O,G.getShadowUniformValues()):(G.setupShadows(C.toUnwrapped(),ut,"model-tile"),P.shadowUniformsInitialized=!0)),pt=vt.shouldRenderCutoff||Mt<1||bt.alphaMode!=="OPAQUE"?lr.alphaBlended:lr.unblended}x.uploadCommonUniforms(O,ut,C.toUnwrapped(),null,vt);const Et=J.material.doubleSided?Ni.disabled:Ni.backCCW;if(xt)nt.push(b.instancedDataBuffer),ut.draw(x,O.gl.TRIANGLES,j,$i.disabled,pt,Et,st,c.id,J.vertexBuffer,J.indexBuffer,J.segments,c.paint,x.transform.zoom,void 0,nt,b.instancedDataArray.length);else{const bt=B?"u_instance":"u_normal_matrix";for(let Pt=0;Pt<b.instancedDataArray.length;++Pt)st[bt]=new Float32Array(b.instancedDataArray.arrayBuffer,64*Pt,16),ut.draw(x,O.gl.TRIANGLES,j,$i.disabled,pt,Et,st,c.id,J.vertexBuffer,J.indexBuffer,J.segments,c.paint,x.transform.zoom,void 0,nt)}}if(p.children)for(const J of p.children)Kx(x,c,J,b,A,C,P)}const DT=[1,-1,1];function T_(x,c,p,b){if(!p.modelManager)return!0;const A=p.modelManager;if(!p.shadowRenderer)return!0;const C=p.shadowRenderer,P=c.aabb;let O=!0,B=x.maxHeight;if(B===0){let j=0;for(const Y in x.instancesPerModel){const W=A.getModel(Y,b);W?j=Math.max(j,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):O=!1}B=x.maxScale*j*1.41+x.maxVerticalOffset,O&&(x.maxHeight=B)}P.max[2]=B,P.min[2]+=x.terrainElevationMin,P.max[2]+=x.terrainElevationMax,a.af(P.min,P.min,c.tileMatrix),a.af(P.max,P.max,c.tileMatrix);const G=P.intersects(C.getCurrentCascadeFrustum());return p.currentShadowCascade===0&&(x.isInsideFirstShadowMapFrustum=G===2),G===0}function Eg(x,c){const p=x.uniformValues.u_cutoff_params[0],b=x.uniformValues.u_cutoff_params[1],A=x.uniformValues.u_cutoff_params[2],C=x.uniformValues.u_cutoff_params[3];return b===p||C===A?1:a.aA(((c-p)/(b-p)-A)/(C-A),0,1)}function Gh(x,c,p,b){if(c.pitch<20)return 1;const A=c.getWorldToCameraMatrix();a.aB(A,A,x);const C=a.bT(p.min[0],p.min[1],p.min[2],1);let P=a.aC(a.eF(),C,A),O=P,B=P;C[1]=p.max[1],P=a.aC(a.eF(),C,A),O=P[1]<O[1]?P:O,B=P[1]>B[1]?P:B,C[0]=p.max[0],P=a.aC(a.eF(),C,A),O=P[1]<O[1]?P:O,B=P[1]>B[1]?P:B,C[1]=p.min[1],P=a.aC(a.eF(),C,A),O=P[1]<O[1]?P:O,B=P[1]>B[1]?P:B;const G=a.aA(b[0],0,1),j=100*c.pixelsPerMeter*a.aA(b[1],0,1),Y=a.aA(b[2],0,1),W=a.eG(a.eF(),O,B,G),J=Math.tan(.5*c.fovX),tt=-W[2]*J;if(j===0)return W[1]<-Math.abs(tt)?Y:1;const nt=(-Math.abs(tt)-W[1])/j,ut=(pt,xt,vt)=>(1-vt)*pt+vt*xt,st=a.aA(ut(1,Y,nt),Y,1);return ut(1,st,a.aA((c.pitch-20)/20,0,1))}class PT{}class LT{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(c,p,b){{const Y=this._storage.get(p.id);if(Y)return Y.lastUsedFrameIdx=c,Y.buf}const A=b.gl,C=A.getBufferParameter(A.ELEMENT_ARRAY_BUFFER,A.BUFFER_SIZE),P=new ArrayBuffer(C),O=new Int16Array(P);A.getBufferSubData(A.ELEMENT_ARRAY_BUFFER,0,new Int16Array(P));const B=new a.eI;for(let Y=0;Y<C/2;Y+=3){const W=O[Y],J=O[Y+1],tt=O[Y+2];B.emplaceBack(W,J),B.emplaceBack(J,tt),B.emplaceBack(tt,W)}const G=b.bindVertexArrayOES.current,j=new PT;return j.buf=new Cu(b,B),j.lastUsedFrameIdx=c,this._storage.set(p.id,j),b.bindVertexArrayOES.set(G),j.buf}update(c){for(const[p,b]of this._storage)c-b.lastUsedFrameIdx>30&&(b.buf.destroy(),this._storage.delete(p))}destroy(){for(const[c,p]of this._storage)p.buf.destroy(),this._storage.delete(c)}}class sD{constructor(c){this.occluderSize=30,this.depthOffset=-1e-4,c.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),c.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const RT=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class lD{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Uo{constructor(c,p){this.revealStart=11,this.revealRange=2,c.registerParameter(this,[...p,"Reveal"],"revealStart",{min:0,max:17,step:.05}),c.registerParameter(this,[...p,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const cD=a.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Dg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(c,p){const b=c.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const P=new a.eJ,O=new a.b0;P.emplaceBack(-1,-1),P.emplaceBack(1,-1),P.emplaceBack(1,1),P.emplaceBack(-1,1),O.emplaceBack(0,1,2),O.emplaceBack(0,2,3),this.vignetteVx=c.context.createVertexBuffer(P,cD.members),this.vignetteIdx=c.context.createIndexBuffer(O)}const A=a.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){c.uploadCommonUniforms(c.context,b);const P={u_vignetteShape:(C={vignetteShape:[p.start,p.range,Math.pow(10,p.fadePower)],vignetteColor:[p.color.r,p.color.g,p.color.b,p.color.a*p.strength]}).vignetteShape,u_vignetteColor:C.vignetteColor};b.draw(c,c.context.gl.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,P,"vignette",this.vignetteVx,this.vignetteIdx,A)}var C}}class In{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(c,p){const b=c.getFreeCameraOptions().position,A=b.toAltitude(),C=b.toLngLat(),P=a.an(C.lng),O=a.an(C.lat),B=c.pixelsPerMeter/p,G=P*a.eL,j=a.eL*Math.log(Math.tan(Math.PI/4+O/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Y=-this._offsetYPrev+j,W=-this._elevationPrev+A;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*B,this._accumulatedOffsetY+=Y*B,this._accumulatedElevation+=W*B,this._offsetXPrev=G,this._offsetYPrev=j,this._elevationPrev=A}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function gr(x,c){return[-(x[0]-Math.floor(x[0]/c)*c),-(x[1]-Math.floor(x[1]/c)*c),-(x[2]-Math.floor(x[2]/c)*c)]}function Jx(x){const c=a.eq(1323123451230),p=[];for(let b=0;b<x;++b){const A=2*c()-1,C=2*c()-1,P=2*c()-1;p.push(a.d4(A,C,P))}return p}function us(x,c,p,b,A){const C=a.aA((A-p)/(b-p),0,1);return(1-C)*x+C*c}class Hh{constructor(c){this._movement=new In,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Dg,this._ppmScaleFactor=c}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(c,p){const b=c.transform;this._movement.update(b,this._ppmScaleFactor);const A=b.starsProjMatrix,C=a.c6([]);a.c8(C,C,a.an(90)-b._pitch),a.c7(C,C,-b.angle);const P=a.cb(new Float32Array(16),C),O=a.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),B=a.ef([],O),G=a.aB([],B,P),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*p,this._prevTime=j,{projectionMatrix:A,modelviewMatrix:G}}}class yf extends Hh{constructor(c){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Uo(c.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(c){const p=c.context;if(!this.particlesVx){const b=Jx(this.particlesCount),A=new a.eM,C=new a.b0;let P=0;const O=a.eq(1323123451230);for(let B=0;B<b.length;++B){const G=b[B],j=[2*O()-1,O(),O(),O()];A.emplaceBack(G[0],G[1],G[2],-1,-1,...j),A.emplaceBack(G[0],G[1],G[2],1,-1,...j),A.emplaceBack(G[0],G[1],G[2],1,1,...j),A.emplaceBack(G[0],G[1],G[2],-1,1,...j),C.emplaceBack(P+0,P+1,P+2),C.emplaceBack(P+0,P+2,P+3),P+=4}this.particlesVx=p.createVertexBuffer(A,RT.members),this.particlesIdx=p.createIndexBuffer(C)}}draw(c){if(!this._params.overrideStyleParameters&&!c.style.rain)return;const p=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=c.transform.zoom;if(p.revealStart>b)return;const A=us(0,1,p.revealStart,p.revealStart+p.revealRange,b);if(!this.particlesVx||!this.particlesIdx)return;const C=structuredClone(this._params);let P=[-C.direction.x,C.direction.y,-100];a.aw(P,P);const O=structuredClone(this._vignetteParams);O.strength*=A,C.overrideStyleParameters||(C.intensity=c.style.rain.state.density,C.timeFactor=c.style.rain.state.intensity,C.color=structuredClone(c.style.rain.state.color),P=structuredClone(c.style.rain.state.direction),C.screenThinning.intensity=c.style.rain.state.centerThinning,C.dropletSizeX=c.style.rain.state.dropletSize[0],C.dropletSizeYScale=c.style.rain.state.dropletSize[1]/c.style.rain.state.dropletSize[0],C.distortionStrength=100*c.style.rain.state.distortionStrength,O.strength=1,O.color=structuredClone(c.style.rain.state.vignetteColor));const B=this.updateOnRender(c,C.timeFactor),G=c.context,j=G.gl,Y=c.transform;this.screenTexture&&this.screenTexture.size[0]===c.width&&this.screenTexture.size[1]===c.height||(this.screenTexture=new a.T(G,{width:c.width,height:c.height,data:null},j.RGBA8)),C.distortionStrength>0&&(G.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,c.width,c.height));const W=c.getOrCreateProgram("rainParticle");c.uploadCommonUniforms(G,W),G.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const J=[C.color.r,C.color.g,C.color.b,C.color.a],tt=(nt,ut)=>{const st=gr(this._movement.getPosition(),nt),pt=C.dropletSizeX,xt=C.dropletSizeX*C.dropletSizeYScale,vt=c.width/2,Et=c.height/2,bt=us(0,C.screenThinning.start,0,1,C.screenThinning.intensity),Pt=us(.001,C.screenThinning.range,0,1,C.screenThinning.intensity),Mt=us(0,C.screenThinning.particleOffset,0,1,C.screenThinning.intensity),Tt=(Lt={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:st,velocityConeAperture:C.velocityConeAperture,velocity:C.velocity,boxSize:nt,rainDropletSize:[pt,xt],distortionStrength:C.distortionStrength,rainDirection:P,color:J,screenSize:[Y.width,Y.height],thinningCenterPos:[vt,Et],thinningShape:[bt,Pt,Math.pow(10,C.screenThinning.fadePower)],thinningAffectedRatio:C.screenThinning.affectedRatio,thinningParticleOffset:Mt,shapeDirectionalPower:C.shapeDirPower,shapeNormalPower:C.shapeNormalPower,mode:ut?0:1},{u_modelview:Float32Array.from(Lt.modelview),u_projection:Float32Array.from(Lt.projection),u_time:Lt.time,u_cam_pos:Lt.camPos,u_texScreen:0,u_velocityConeAperture:Lt.velocityConeAperture,u_velocity:Lt.velocity,u_boxSize:Lt.boxSize,u_rainDropletSize:Lt.rainDropletSize,u_distortionStrength:Lt.distortionStrength,u_rainDirection:Lt.rainDirection,u_color:Lt.color,u_screenSize:Lt.screenSize,u_thinningCenterPos:Lt.thinningCenterPos,u_thinningShape:Lt.thinningShape,u_thinningAffectedRatio:Lt.thinningAffectedRatio,u_thinningParticleOffset:Lt.thinningParticleOffset,u_shapeDirectionalPower:Lt.shapeDirectionalPower,u_shapeNormalPower:Lt.shapeNormalPower,u_mode:Lt.mode});var Lt;const qt=Math.round(C.intensity*this.particlesCount),jt=a.bf.simpleSegment(0,0,4*qt,2*qt);W.draw(c,j.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,Tt,"rain_particles",this.particlesVx,this.particlesIdx,jt)};C.distortionStrength>0&&tt(C.boxSize,!0),tt(C.boxSize,!1),this._vignette.draw(c,O)}}const Zc=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Qx extends Hh{constructor(c){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Uo(c.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(c){const p=c.context;if(!this.particlesVx){const b=Jx(this.particlesCount),A=new a.eN,C=new a.b0;let P=0;const O=a.eq(1323123451230);for(let B=0;B<b.length;++B){const G=b[B],j=O(),Y=O(),W=O(),J=[B/b.length,j,Y,W],tt=[O(),O()];A.emplaceBack(G[0],G[1],G[2],-1,-1,...J,...tt),A.emplaceBack(G[0],G[1],G[2],1,-1,...J,...tt),A.emplaceBack(G[0],G[1],G[2],1,1,...J,...tt),A.emplaceBack(G[0],G[1],G[2],-1,1,...J,...tt),C.emplaceBack(P+0,P+1,P+2),C.emplaceBack(P+0,P+2,P+3),P+=4}this.particlesVx=p.createVertexBuffer(A,Zc.members),this.particlesIdx=p.createIndexBuffer(C)}}draw(c){if(!this._params.overrideStyleParameters&&!c.style.snow)return;const p=structuredClone(this._params);let b=[-p.direction.x,p.direction.y,-100];a.aw(b,b);const A=structuredClone(this._vignetteParams),C=p.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},P=c.transform.zoom;if(C.revealStart>P)return;const O=us(0,1,C.revealStart,C.revealStart+C.revealRange,P);A.strength*=O,p.overrideStyleParameters||(p.intensity=c.style.snow.state.density,p.timeFactor=c.style.snow.state.intensity,p.color=structuredClone(c.style.snow.state.color),b=structuredClone(c.style.snow.state.direction),p.screenThinning.intensity=c.style.snow.state.centerThinning,p.billboardSize=2.79*c.style.snow.state.flakeSize,A.strength=1,A.color=structuredClone(c.style.snow.state.vignetteColor));const B=this.updateOnRender(c,p.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=c.context,j=G.gl,Y=c.transform,W=c.getOrCreateProgram("snowParticle");c.uploadCommonUniforms(G,W),((J,tt,nt)=>{const ut=gr(this._movement.getPosition(),J),st=Y.width/2,pt=Y.height/2,xt=us(0,nt.screenThinning.start,0,1,nt.screenThinning.intensity),vt=us(.001,nt.screenThinning.range,0,1,nt.screenThinning.intensity),Et=us(0,nt.screenThinning.particleOffset,0,1,nt.screenThinning.intensity),bt=(Pt={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ut,velocityConeAperture:nt.velocityConeAperture,velocity:nt.velocity,horizontalOscillationRadius:nt.horizontalOscillationRadius,horizontalOscillationRate:nt.horizontalOscillationRate,boxSize:J,billboardSize:1*nt.billboardSize,simpleShapeParameters:[nt.shapeFadeStart,nt.shapeFadePower],screenSize:[Y.width,Y.height],thinningCenterPos:[st,pt],thinningShape:[xt,vt,Math.pow(10,nt.screenThinning.fadePower)],thinningAffectedRatio:nt.screenThinning.affectedRatio,thinningParticleOffset:Et,color:[nt.color.r,nt.color.g,nt.color.b,nt.color.a],direction:b},{u_modelview:Float32Array.from(Pt.modelview),u_projection:Float32Array.from(Pt.projection),u_time:Pt.time,u_cam_pos:Pt.camPos,u_velocityConeAperture:Pt.velocityConeAperture,u_velocity:Pt.velocity,u_horizontalOscillationRadius:Pt.horizontalOscillationRadius,u_horizontalOscillationRate:Pt.horizontalOscillationRate,u_boxSize:Pt.boxSize,u_billboardSize:Pt.billboardSize,u_simpleShapeParameters:Pt.simpleShapeParameters,u_screenSize:Pt.screenSize,u_thinningCenterPos:Pt.thinningCenterPos,u_thinningShape:Pt.thinningShape,u_thinningAffectedRatio:Pt.thinningAffectedRatio,u_thinningParticleOffset:Pt.thinningParticleOffset,u_particleColor:Pt.color,u_direction:Pt.direction});var Pt;const Mt=Math.round(nt.intensity*this.particlesCount),Tt=a.bf.simpleSegment(0,0,4*Mt,2*Mt);this.particlesVx&&this.particlesIdx&&W.draw(c,j.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,bt,"snow_particles",this.particlesVx,this.particlesIdx,Tt)})(p.boxSize,0,p),this._vignette.draw(c,A)}}const t1={symbol:function(x,c,p,b,A){if(x.renderPass!=="translucent")return;const C=$i.disabled,P=x.colorModeForRenderPass(),O=p.layout.get("text-variable-anchor"),B=p.layout.get("text-size-scale-range"),G=a.aA(x.scaleFactor,B[0],B[1]);O&&function(W,J,tt,nt,ut,st,pt,xt){const vt=J.transform,Et=ut==="map",bt=st==="map";for(const Pt of W){const Mt=nt.getTile(Pt),Tt=Mt.getBucket(tt);if(!Tt||!Tt.text||!Tt.text.segments.get().length)continue;const Lt=a.bJ(Tt.textSizeData,vt.zoom,xt),qt=Fv(Pt,Tt.getProjection(),vt),jt=vt.calculatePixelsToTileUnitsMatrix(Mt),oe=$d(qt,Mt.tileID.canonical,bt,Et,vt,Tt.getProjection(),jt),te=Tt.hasIconTextFit()&&Tt.hasIconData();Lt&&__(Tt,Et,bt,pt,vt,oe,Pt,Math.pow(2,vt.zoom-Mt.tileID.overscaledZ),Lt,te)}}(b,x,p,c,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),A,G);const j=p.paint.get("icon-opacity").constantOr(1)!==0,Y=p.paint.get("text-opacity").constantOr(1)!==0;p.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||Y)?Mg(x,c,p,b,C,P):(j&&Mg(x,c,p,b,C,P,{onlyIcons:!0}),Y&&Mg(x,c,p,b,C,P,{onlyText:!0})),c.map.showCollisionBoxes&&(Ig(x,c,p,b,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Ig(x,c,p,b,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(x,c,p,b){if(x.renderPass!=="translucent")return;const A=p.paint.get("circle-opacity"),C=p.paint.get("circle-stroke-width"),P=p.paint.get("circle-stroke-opacity"),O=p.layout.get("circle-sort-key").constantOr(1)!==void 0,B=p.paint.get("circle-emissive-strength");if(A.constantOr(1)===0&&(C.constantOr(1)===0||P.constantOr(1)===0))return;const G=x.context,j=G.gl,Y=x.transform,W=!(!x.terrain||!x.terrain.enabled),J=p.layout.get("circle-elevation-reference"),tt=x.depthModeForSublayer(0,fi.ReadOnly),nt=new fi(x.context.gl.LEQUAL,fi.ReadOnly,x.depthRangeFor3D),ut=J==="none"||W?tt:nt,st=$i.disabled,pt=x.colorModeForDrapableLayerRenderPass(B),xt=Y.projection.name==="globe",vt=[a.aF(Y.center.lng),a.aJ(Y.center.lat)],Et=[];for(let Pt=0;Pt<b.length;Pt++){const Mt=b[Pt],Tt=c.getTile(Mt),Lt=Tt.getBucket(p);if(!Lt||Lt.projection.name!==Y.projection.name)continue;const qt=Lt.programConfigurations.get(p.id),jt=Lt.layoutVertexBuffer,oe=Lt.globeExtVertexBuffer,te=Lt.indexBuffer,he=a.d$(p),Oe=[oe],Jt=x.isTileAffectedByFog(Mt);xt&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),x.terrain&&Y.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION"),Lt.hasElevation&&!x.terrain&&(he.push("ELEVATED_ROADS"),Oe.push(Lt.elevatedLayoutVertexBuffer));const Ut=x.getOrCreateProgram("circle",{config:qt,defines:he,overrideFog:Jt}),de=Y.projection.createInversionMatrix(Y,Mt.canonical),ee={programConfiguration:qt,program:Ut,layoutVertexBuffer:jt,dynamicBuffers:Oe,indexBuffer:te,uniformValues:a.e0(x,Mt,Tt,de,vt,p),tile:Tt};if(O){const Ae=Lt.segments.get();for(const Ue of Ae)Et.push({segments:new a.bf([Ue]),sortKey:Ue.sortKey,state:ee})}else Et.push({segments:Lt.segments,sortKey:0,state:ee})}O&&Et.sort((Pt,Mt)=>Pt.sortKey-Mt.sortKey);const bt={useDepthForOcclusion:Y.depthOcclusionForSymbolsAndCircles};for(const Pt of Et){const{programConfiguration:Mt,program:Tt,layoutVertexBuffer:Lt,dynamicBuffers:qt,indexBuffer:jt,uniformValues:oe,tile:te}=Pt.state,he=Pt.segments;x.terrain&&x.terrain.setupElevationDraw(te,Tt,bt),x.uploadCommonUniforms(G,Tt,te.tileID.toUnwrapped()),Tt.draw(x,j.TRIANGLES,ut,st,pt,Ni.disabled,oe,p.id,Lt,jt,he,p.paint,Y.zoom,Mt,qt)}},heatmap:function(x,c,p,b){if(p.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const A=x.context,C=A.gl,P=$i.disabled,O=new lr([C.ONE,C.ONE,C.ONE,C.ONE],a.ao.transparent,[!0,!0,!0,!0]);(function(J,tt,nt,ut){const st=J.gl,pt=tt.width*ut,xt=tt.height*ut;J.activeTexture.set(st.TEXTURE1),J.viewport.set([0,0,pt,xt]);let vt=nt.heatmapFbo;if(!vt||vt&&(vt.width!==pt||vt.height!==xt)){vt&&vt.destroy();const Et=st.createTexture();st.bindTexture(st.TEXTURE_2D,Et),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_WRAP_S,st.CLAMP_TO_EDGE),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_WRAP_T,st.CLAMP_TO_EDGE),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_MIN_FILTER,st.LINEAR),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_MAG_FILTER,st.LINEAR),vt=nt.heatmapFbo=J.createFramebuffer(pt,xt,!0,null),function(bt,Pt,Mt,Tt,Lt,qt){const jt=bt.gl;jt.texImage2D(jt.TEXTURE_2D,0,bt.extRenderToTextureHalfFloat?jt.RGBA16F:jt.RGBA,Lt,qt,0,jt.RGBA,bt.extRenderToTextureHalfFloat?jt.HALF_FLOAT:jt.UNSIGNED_BYTE,null),Tt.colorAttachment.set(Mt)}(J,0,Et,vt,pt,xt)}else st.bindTexture(st.TEXTURE_2D,vt.colorAttachment.get()),J.bindFramebuffer.set(vt.framebuffer)})(A,x,p,x.transform.projection.name==="globe"?.5:.25),A.clear({color:a.ao.transparent});const B=x.transform,G=B.projection.name==="globe",j=G?["PROJECTION_GLOBE_VIEW"]:[],Y=G?Ni.frontCCW:Ni.disabled,W=[a.aF(B.center.lng),a.aJ(B.center.lat)];for(let J=0;J<b.length;J++){const tt=b[J];if(c.hasRenderableParent(tt))continue;const nt=c.getTile(tt),ut=nt.getBucket(p);if(!ut||ut.projection.name!==B.projection.name)continue;const st=x.isTileAffectedByFog(tt),pt=ut.programConfigurations.get(p.id),xt=x.getOrCreateProgram("heatmap",{config:pt,defines:j,overrideFog:st}),{zoom:vt}=x.transform;x.terrain&&x.terrain.setupElevationDraw(nt,xt),x.uploadCommonUniforms(A,xt,tt.toUnwrapped());const Et=B.projection.createInversionMatrix(B,tt.canonical);xt.draw(x,C.TRIANGLES,fi.disabled,P,O,Y,xT(x,tt,nt,Et,W,vt,p.paint.get("heatmap-intensity")),p.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,p.paint,x.transform.zoom,pt,G?[ut.globeExtVertexBuffer]:null)}A.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(A,C){const P=A.context,O=P.gl,B=C.heatmapFbo;if(!B)return;P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,B.colorAttachment.get()),P.activeTexture.set(O.TEXTURE1);let G=C.colorRampTexture;G||(G=C.colorRampTexture=new a.T(P,C.colorRamp,O.RGBA8)),G.bind(O.LINEAR,O.CLAMP_TO_EDGE),A.getOrCreateProgram("heatmapTexture").draw(A,O.TRIANGLES,fi.disabled,$i.disabled,A.colorModeForRenderPass(),Ni.disabled,((j,Y,W,J)=>({u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}))(0,C),C.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,C.paint,A.transform.zoom)}(x,p))},line:function(x,c,p,b){if(x.renderPass!=="translucent")return;const A=p.paint.get("line-opacity"),C=p.paint.get("line-width");if(A.constantOr(1)===0||C.constantOr(1)===0)return;const P=p.paint.get("line-emissive-strength"),O=p.paint.get("line-occlusion-opacity"),B=p.layout.get("line-elevation-reference"),G=p.layout.get("line-width-unit")==="meters",j=B==="sea",Y=!(!x.terrain||!x.terrain.enabled),W=x.context,J=W.gl;if(p.hasElevatedBuckets&&x.transform.projection.name==="globe")return;const tt=p.layout.get("line-cross-slope"),nt=tt!==void 0,ut=tt<1,st=x.colorModeForDrapableLayerRenderPass(P),pt=x.terrain&&x.terrain.renderingToTexture,xt=pt?1:a.o.devicePixelRatio,vt=p.paint.get("line-dasharray"),Et=vt.constantOr(1),bt=p.layout.get("line-cap"),Pt=vt.constantOr(null),Mt=bt.constantOr(null),Tt=p.paint.get("line-pattern"),Lt=Tt.constantOr(1),qt=p.paint.get("line-pattern-cross-fade"),jt=Tt.constantOr(null),oe=p.paint.get("line-opacity").constantOr(1);let te=!Lt&&oe!==1||x.depthOcclusion&&O>0&&O<1;const he=p.paint.get("line-gradient"),Oe=Lt?"linePattern":"line",Jt=a.e1(p);let Ut;if(pt&&x.terrain&&x.terrain.clipOrMaskOverlapStencilType()&&(te=!1),O!==0&&x.depthOcclusion){const Ue=p.paint._values["line-opacity"];Ue&&Ue.value&&Ue.value.kind==="constant"?Ut=Ue.value:a.w(`Occlusion opacity for layer ${p.id} is supported only when line-opacity isn't data-driven.`)}C.value.kind!=="constant"&&C.value.isLineProgressConstant===!1&&Jt.push("VARIABLE_LINE_WIDTH");const de=(Ue,ci,Le,Be,hi,ni)=>{for(const ii of Ue){const ai=c.getTile(ii);if(Lt&&!ai.patternsLoaded())continue;const Ei=ai.getBucket(p);if(!Ei||Ei.elevationType!=="none"&&!hi||Ei.elevationType==="none"&&hi)continue;x.prepareDrawTile();const mr=[...ci],Ir=x.shadowRenderer,an=Ei.elevationType==="road"&&!!Ir&&Ir.enabled;let Vi=[0,0,0];if(an){const Hi=x.style.directionalLight,Dr=x.style.ambientLight;Hi&&Dr&&(Vi=bl(x.style,Hi,Dr)),mr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Tr=Ei.programConfigurations.get(p.id);let ir=!1;if(jt&&ai.imageAtlas){const Hi=a.e2.from(jt),Dr=Hi.getPrimary().scaleSelf(xt).toString(),zn=ai.imageAtlas.patternPositions.get(Dr),ia=Hi.getSecondary(),Un=ia?ai.imageAtlas.patternPositions.get(ia.scaleSelf(xt).toString()):null;ir=!!zn&&!!Un,zn&&Tr.setConstantPatternPositions(zn,Un)}qt>0&&(ir||Tr.getPatternTransitionVertexBuffer("line-pattern"))&&mr.push("LINE_PATTERN_TRANSITION");const Qr=x.isTileAffectedByFog(ii),Mr=x.getOrCreateProgram(Oe,{config:Tr,defines:mr,overrideFog:Qr});if(!Lt&&Pt&&Mt&&ai.lineAtlas){const Hi=ai.lineAtlas.getDash(Pt,Mt);Hi&&Tr.setConstantPatternPositions(Hi)}an&&Ir.setupShadows(ai.tileID.toUnwrapped(),Mr,"vector-tile");let[pn,Or]=p.paint.get("line-trim-offset");(Mt==="round"||Mt==="square")&&pn!==Or&&(pn===0&&(pn-=1),Or===1&&(Or+=1));const ar=pt?ii.projMatrix:null,Gr=G?1/Ei.tileToMeter/a.ay(ai,1,x.transform.zoom):1,cr=G?1/Ei.tileToMeter/a.ay(ai,1,Math.floor(x.transform.zoom)):1,wn=Lt?a.e3(x,ai,p,ar,xt,Gr,cr,[pn,Or],Vi,qt):a.e4(x,ai,p,ar,Ei.lineClipsArray.length,xt,Gr,cr,[pn,Or],Vi);if(he){const Hi=Ei.gradients[p.id];let Dr=Hi.texture;if(p.gradientVersion!==Hi.version){let zn=256;if(p.stepInterpolant){const ia=c.getSource().maxzoom,Un=ii.canonical.z===ia?Math.ceil(1<<x.transform.maxZoom-ii.canonical.z):1;zn=a.aA(a.e5(Ei.maxLineLength/a.al*1024*Un),256,W.maxTextureSize)}Hi.gradient=a.e6({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:Hi.gradient||void 0,clips:Ei.lineClipsArray}),Hi.texture?Hi.texture.update(Hi.gradient):Hi.texture=new a.T(W,Hi.gradient,J.RGBA8),Hi.version=p.gradientVersion,Dr=Hi.texture}W.activeTexture.set(J.TEXTURE1),Dr.bind(p.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}Et&&(W.activeTexture.set(J.TEXTURE0),ai.lineAtlasTexture&&ai.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),Tr.updatePaintBuffers()),Lt&&(W.activeTexture.set(J.TEXTURE0),ai.imageAtlasTexture&&ai.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Tr.updatePaintBuffers()),hi&&!j&&x.terrain.setupElevationDraw(ai,Mr),x.uploadCommonUniforms(W,Mr,ii.toUnwrapped());const Zr=Hi=>{Ut!=null&&(Ut.value=oe*O),Mr.draw(x,J.TRIANGLES,Le,Hi,st,Ni.disabled,wn,p.id,Ei.layoutVertexBuffer,Ei.indexBuffer,Ei.segments,p.paint,x.transform.zoom,Tr,[Ei.layoutVertexBuffer2,Ei.patternVertexBuffer,Ei.zOffsetVertexBuffer]),Ut!=null&&(Ut.value=oe)};if(te&&!hi){const Hi=x.stencilModeForClipping(ii).ref;Hi===0&&pt&&W.clear({stencil:0});const Dr={func:J.EQUAL,mask:255};wn.u_alpha_discard_threshold=.8,Zr(new $i(Dr,Hi,255,J.KEEP,J.KEEP,J.INVERT)),wn.u_alpha_discard_threshold=0,Zr(new $i(Dr,Hi,255,J.KEEP,J.KEEP,J.KEEP))}else wn.u_alpha_discard_threshold=te&&hi&&ni?.8:0,Zr(hi?Be:x.stencilModeForClipping(ii))}};let ee=x.depthModeForSublayer(0,fi.ReadOnly);const Ae=new fi(x.depthOcclusion?J.GREATER:J.LEQUAL,fi.ReadOnly,x.depthRangeFor3D);if(p.hasNonElevatedBuckets){const Ue=!pt&&x.terrain;O!==0&&Ue?a.w(`Occlusion opacity for layer ${p.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ue?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${p.id}.`):de(b,Jt,ee,$i.disabled,!1,!0)}if(p.hasElevatedBuckets){B==="hd-road-markup"?Y||(ee=Ae,Jt.push("ELEVATED_ROADS")):(Jt.push("ELEVATED"),ee=Ae,nt&&Jt.push(ut?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&Jt.push("ELEVATION_REFERENCE_SEA"));const Ue=te?x.stencilModeFor3D():$i.disabled;x.forceTerrainMode=!0,de(b,Jt,ee,Ue,!0,!0),te&&de(b,Jt,ee,Ue,!0,!1),x.forceTerrainMode=!1}te&&(x.resetStencilClippingMasks(),pt&&W.clear({stencil:0})),O===0||x.depthOcclusion||pt||x.layersWithOcclusionOpacity.push(x.currentLayer)},fill:function(x,c,p,b){const A=p.paint.get("fill-color"),C=p.paint.get("fill-opacity");if(C.constantOr(1)===0)return;const P=p.paint.get("fill-emissive-strength"),O=x.colorModeForDrapableLayerRenderPass(P),B=p.paint.get("fill-pattern"),G=x.opaquePassEnabledForLayer()&&!B.constantOr(1)&&A.constantOr(a.ao.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";let j="none";p.layout.get("fill-elevation-reference")!=="none"?j="road":p.paint.get("fill-z-offset").constantOr(1)!==0&&(j="offset");const Y=!(!x.terrain||!x.terrain.enabled),W={painter:x,sourceCache:c,layer:p,coords:b,colorMode:O,elevationType:j,terrainEnabled:Y,pass:G};if(x.renderPass!=="shadow")if(j!=="offset"){if(df(W,!1),j==="road"){const J=!Y&&x.renderPass==="translucent";J&&Vh(x,c,p,b,"geometry"),df(W,!0,$i.disabled),J&&function(tt){const{painter:nt,sourceCache:ut,layer:st,coords:pt,colorMode:xt}=tt,vt=nt.context.gl,Et=tt.painter.shadowRenderer,bt=!!Et&&Et.enabled,Pt=new fi(nt.context.gl.LEQUAL,fi.ReadOnly,nt.depthRangeFor3D);let Mt=[0,0,0];if(bt){const Lt=nt.style.directionalLight,qt=nt.style.ambientLight;Lt&&qt&&(Mt=bl(nt.style,Lt,qt))}const Tt=Lt=>{for(const qt of pt){const jt=ut.getTile(qt),oe=jt.getBucket(st);if(!oe)continue;const te=oe.elevatedStructures;if(!te)continue;let he,Oe;if(Lt?(he=te.renderableBridgeSegments,Oe=te.bridgeProgramConfigurations.get(st.id)):(he=te.renderableTunnelSegments,Oe=te.tunnelProgramConfigurations.get(st.id)),!he||he.segments[0].primitiveLength===0)continue;Oe.updatePaintBuffers(),nt.prepareDrawTile();const Jt=nt.isTileAffectedByFog(qt),Ut=[];bt&&Ut.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const de=nt.getOrCreateProgram("elevatedStructures",{config:Oe,overrideFog:Jt,defines:Ut}),ee=nt.translatePosMatrix(qt.projMatrix,jt,st.paint.get("fill-translate"),st.paint.get("fill-translate-anchor"));bt&&Et.setupShadows(jt.tileID.toUnwrapped(),de,"vector-tile");const Ae=eD(ee,Mt);nt.uploadCommonUniforms(nt.context,de,qt.toUnwrapped()),de.draw(nt,vt.TRIANGLES,Pt,$i.disabled,xt,Ni.backCCW,Ae,st.id,te.vertexBuffer,te.indexBuffer,he,st.paint,nt.transform.zoom,Oe,[te.vertexBufferNormal])}};Tt(!0),Tt(!1)}(W)}}else df(W,!1,x.stencilModeFor3D());else x.shadowRenderer&&j==="road"&&!Y&&function(J){const{painter:tt,sourceCache:nt,layer:ut,coords:st}=J,pt=tt.context.gl,xt=J.painter.shadowRenderer;for(const vt of st){const Et=nt.getTile(vt),bt=Et.getBucket(ut);if(!bt)continue;const Pt=bt.elevatedStructures;if(!Pt||!Pt.shadowCasterSegments||Pt.shadowCasterSegments.segments[0].primitiveLength===0)continue;tt.prepareDrawTile();const Mt=bt.bufferData.programConfigurations.get(ut.id),Tt=tt.isTileAffectedByFog(vt),Lt=tt.getOrCreateProgram("elevatedStructuresDepth",{config:Mt,overrideFog:Tt}),qt=xt.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());tt.uploadCommonUniforms(tt.context,Lt,vt.toUnwrapped());const jt={u_matrix:qt,u_depth_bias:0};Lt.draw(tt,pt.TRIANGLES,xt.getShadowPassDepthMode(),$i.disabled,xt.getShadowPassColorMode(),Ni.disabled,jt,ut.id,Pt.vertexBuffer,Pt.indexBuffer,Pt.shadowCasterSegments,ut.paint,tt.transform.zoom,Mt)}}(W)},"fill-extrusion":function(x,c,p,b){const A=p.paint.get("fill-extrusion-opacity"),C=x.context,P=C.gl,O=x.terrain,B=O&&O.renderingToTexture;if(A===0)return;const G=x.conflationActive&&x.style.isLayerClipped(p,c.getSource()),j=x.style.order.indexOf(p.fqid);if(G&&function(Y,W,J,tt,nt){for(const ut of tt){const st=W.getTile(ut).getBucket(J);st&&(st.updateReplacement(ut,Y.replacementSource,nt),st.uploadCentroid(Y.context))}}(x,c,p,b,j),O||G)for(const Y of b){const W=c.getTile(Y).getBucket(p);W&&Du(x.context,c,Y,W,p,O,G)}if(x.renderPass==="shadow"&&x.shadowRenderer){const Y=x.shadowRenderer;if(O&&A<.65&&p._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ad)return;const W=Y.getShadowPassDepthMode(),J=Y.getShadowPassColorMode();si(x,c,p,b,W,$i.disabled,J,G)}else if(x.renderPass==="translucent"){const Y=!p.paint.get("fill-extrusion-pattern").constantOr(1),W=p.paint.get("fill-extrusion-color").constantOr(a.ao.white);if(!B&&W.a!==0){const J=new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D);A===1&&Y?si(x,c,p,b,J,$i.disabled,lr.unblended,G):(si(x,c,p,b,J,$i.disabled,lr.disabled,G),si(x,c,p,b,J,x.stencilModeFor3D(),x.colorModeForRenderPass(),G),x.resetStencilClippingMasks())}if(x.style.enable3dLights()&&Y&&(!O&&x.transform.projection.name!=="globe"||B)){const J=p.paint.get("fill-extrusion-opacity"),tt=p.paint.get("fill-extrusion-ambient-occlusion-intensity"),nt=p.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ut=p.paint.get("fill-extrusion-flood-light-intensity"),st=p.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",pt=p.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(st?null:p.lut).toArray01().slice(0,3),xt=tt>0&&nt>0,vt=ut>0,Et=(Mt,Tt,Lt)=>(1-Lt)*Mt+Lt*Tt,bt=new Nx;bt.translate=p.paint.get("fill-extrusion-translate"),bt.translateAnchor=p.paint.get("fill-extrusion-translate-anchor"),bt.edgeRadius=p.layout.get("fill-extrusion-edge-radius"),bt.cutoffFadeRange=p.paint.get("fill-extrusion-cutoff-fade-range");const Pt=Mt=>{const Tt=x.depthModeForSublayer(1,fi.ReadOnly,P.LEQUAL,!0),Lt=p.paint.get(Mt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qt=Et(.1,3,Lt),jt=x._showOverdrawInspector;if(!jt){const oe=new $i({func:P.ALWAYS,mask:255},255,255,P.KEEP,P.KEEP,P.REPLACE),te=new lr([P.ONE,P.ONE,P.ONE,P.ONE],a.ao.transparent,[!1,!1,!1,!0],P.MIN);Wc(bt,x,c,p,b,Tt,oe,te,Ni.disabled,Mt,"sdf",J,tt,nt,ut,pt,qt,G,!1)}{const oe=jt?$i.disabled:new $i({func:P.EQUAL,mask:255},255,255,P.KEEP,P.DECR,P.DECR),te=jt?x.colorModeForRenderPass():new lr([P.ONE_MINUS_DST_ALPHA,P.DST_ALPHA,P.ONE,P.ONE],a.ao.transparent,[!0,!0,!0,!0]);Wc(bt,x,c,p,b,Tt,oe,te,Ni.disabled,Mt,"color",J,tt,nt,ut,pt,qt,G,!1)}};if(B){const Mt=(Tt,Lt,qt)=>{const jt=x.depthModeForSublayer(1,fi.ReadOnly,P.LEQUAL,!1),oe=p.paint.get(Tt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),te=Et(.1,3,oe);{const he=new lr([P.ONE,P.ONE,P.ONE,P.ONE],a.ao.transparent,[!1,!1,!1,!0]);Wc(bt,x,c,p,b,jt,$i.disabled,he,Ni.disabled,Tt,"clear",J,tt,nt,ut,pt,te,G,Lt)}{const he=new $i({func:P.ALWAYS,mask:255},255,255,P.KEEP,P.KEEP,P.REPLACE),Oe=new lr([P.ONE,P.ONE,P.ONE,P.ONE],a.ao.transparent,[!1,!1,!1,!0],P.MIN);Wc(bt,x,c,p,b,jt,he,Oe,Ni.disabled,Tt,"sdf",J,tt,nt,ut,pt,te,G,Lt)}{const he=Tt?P.ZERO:P.ONE_MINUS_DST_ALPHA,Oe=new $i({func:P.EQUAL,mask:255},255,255,P.KEEP,P.DECR,P.DECR),Jt=new lr([he,P.DST_ALPHA,P.ONE_MINUS_DST_ALPHA,P.ZERO],a.ao.transparent,[!0,!0,!0,!0]);Wc(bt,x,c,p,b,jt,Oe,Jt,Ni.disabled,Tt,"color",J,tt,nt,ut,pt,te,G,Lt)}{const he=new lr([P.ONE,P.ONE,P.ONE,Tt?P.ZERO:P.ONE],a.ao.transparent,[!1,!1,!1,!0],Tt?P.FUNC_ADD:P.MAX);Wc(bt,x,c,p,b,jt,$i.disabled,he,Ni.disabled,Tt,"clear",J,tt,nt,ut,pt,te,G,Lt,qt)}};if(xt||vt){let Tt;if(x.prepareDrawTile(),O){const Lt=O.drapeBufferSize[0],qt=O.drapeBufferSize[1];Tt=O.framebufferCopyTexture,Tt&&(!Tt||Tt.size[0]===Lt&&Tt.size[1]===qt)||(Tt&&Tt.destroy(),Tt=O.framebufferCopyTexture=new a.T(C,new a.q({width:Lt,height:qt}),P.RGBA8)),Tt.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,Lt,qt)}xt&&Mt(!0,!1,Tt),vt&&Mt(!1,!0,Tt)}}else xt&&Pt(!0),vt&&Pt(!1),(xt||vt)&&x.resetStencilClippingMasks()}}},building:function(x,c,p,b){x.currentLayer<x.firstLightBeamLayer&&(x.firstLightBeamLayer=x.currentLayer);const A=p.paint.get("building-ambient-occlusion-ground-intensity"),C=p.paint.get("building-ambient-occlusion-ground-radius"),P=p.paint.get("building-ambient-occlusion-ground-attenuation"),O=p.paint.get("building-opacity");if(O<=0)return;let B=A>0&&C>0,G=!0;const j=p.paint.get("building-vertical-scale");if(j<=0)return;(!x.shadowRenderer||j<1)&&(G=!1);const Y=x.conflationActive&&x.style.isLayerClipped(p,c.getSource()),W=x.style.order.indexOf(p.fqid);if(function(J,tt,nt,ut,st,pt){for(const xt of pt){const vt=tt.getTile(xt).getBucket(nt);vt&&(st&&vt.updateReplacement(xt,J.replacementSource,ut),vt.uploadUpdatedIndexBuffer(J.context))}}(x,c,p,W,Y,b),function(J,tt,nt,ut){for(const st of ut){const pt=tt.getTile(st).getBucket(nt);pt&&pt.needsEvaluation()&&pt.uploadUpdatedColorBuffer(J.context)}}(x,c,p,b),p.resetLayerRenderingStats(x),x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!0),x.renderPass==="shadow"&&x.shadowRenderer){const J=x.shadowRenderer,tt=[],nt=J.getShadowPassDepthMode();x_({painter:x,source:c,layer:p,coords:b,defines:tt,blendMode:J.getShadowPassColorMode(),depthMode:nt,opacity:O,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(x.renderPass==="translucent"){let J=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];G&&(J=J.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),x.shadowRenderer&&x.shadowRenderer.useNormalOffset&&(J=J.concat("NORMAL_OFFSET"));const tt=p.paint.get("building-facade-emissive-chance"),nt=p.paint.get("building-ambient-occlusion-intensity"),ut=p.paint.get("building-flood-light-intensity"),st=p.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pt=p.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(st?null:p.lut).toArray01().slice(0,3),xt=p.paint.get("building-flood-light-ground-attenuation"),vt=ut>0,Et=new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D);O<1&&x_({painter:x,source:c,layer:p,coords:b,defines:J,blendMode:lr.disabled,depthMode:Et,opacity:O,verticalScale:j,facadeEmissiveChance:tt,facadeAOIntensity:nt,floodLightIntensity:ut,floodLightColor:pt,depthOnly:!0});const bt=x.colorModeForRenderPass();x_({painter:x,source:c,layer:p,coords:b,defines:J,blendMode:bt,depthMode:Et,opacity:O,verticalScale:j,facadeEmissiveChance:tt,facadeAOIntensity:nt,floodLightIntensity:ut,floodLightColor:pt}),B&&b_(x,c,p,b,!0,O,A,C,ut,pt,P,Y),vt&&b_(x,c,p,b,!1,O,A,C,ut,pt,xt,Y)}else if(x.renderPass==="light-beam"){const J=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],tt=new fi(x.context.gl.LEQUAL,fi.ReadOnly,x.depthRangeFor3D);x_({painter:x,source:c,layer:p,coords:b,defines:J,blendMode:lr.alphaBlended,depthMode:tt,opacity:O,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!1),x.resetStencilClippingMasks()},hillshade:function(x,c,p,b){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent"||x.style.disableElevatedTerrain)return;const A=x.context,C=x.terrain&&x.terrain.renderingToTexture,[P,O]=x.renderPass!=="translucent"||C?[{},b]:x.stencilConfigForOverlap(b);for(const B of O){const G=c.getTile(B);if(G.needsHillshadePrepare&&x.renderPass==="offscreen")jE(x,G,p);else if(x.renderPass==="translucent"){const j=x.depthModeForSublayer(0,fi.ReadOnly),Y=p.paint.get("hillshade-emissive-strength"),W=x.colorModeForDrapableLayerRenderPass(Y),J=C&&x.terrain?x.terrain.stencilModeForRTTOverlap(B):P[B.overscaledZ];HE(x,B,G,p,j,J,W)}}A.viewport.set([0,0,x.width,x.height]),x.resetStencilClippingMasks()},raster:function(x,c,p,b,A,C){if(x.renderPass!=="translucent"||p.paint.get("raster-opacity")===0)return;const P=x.transform.projection.name==="globe",O=p.paint.get("raster-elevation")!==0,B=O&&P;if(x.renderElevatedRasterBackface&&!B)return;const G=x.context,j=G.gl,Y=c.getSource(),W=function(bt,Pt,Mt,Tt){const Lt=Pt.paint.get("raster-color"),qt=bt.type==="raster-array",jt=[],oe=Pt.paint.get("raster-resampling"),te=Pt.paint.get("raster-color-mix");let he=Pt.paint.get("raster-color-range");const Oe=[te[0],te[1],te[2],0],Jt=te[3];let Ut=oe==="nearest"?Tt.NEAREST:Tt.LINEAR;if(qt&&(jt.push("RASTER_ARRAY"),Lt||jt.push("RASTER_COLOR"),oe==="linear"&&jt.push("RASTER_ARRAY_LINEAR"),Ut=Tt.NEAREST,!he&&bt.rasterLayers)){const de=bt.rasterLayers.find(({id:ee})=>ee===Pt.sourceLayer);de&&de.fields&&de.fields.range&&(he=de.fields.range)}if(he=he||[0,1],Lt){jt.push("RASTER_COLOR"),Mt.activeTexture.set(Tt.TEXTURE2),Pt.updateColorRamp(he);let de=Pt.colorRampTexture;de||(de=Pt.colorRampTexture=new a.T(Mt,Pt.colorRamp,Tt.RGBA8)),de.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}return{mix:Oe,range:he,offset:Jt,defines:jt,resampling:Ut}}(Y,p,G,j);if(Y instanceof a.aT&&!b.length&&!P)return;const J=p.paint.get("raster-emissive-strength"),tt=x.colorModeForDrapableLayerRenderPass(J),nt=x.terrain&&x.terrain.renderingToTexture,ut=!x.options.moving,st=p.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(Y instanceof a.aT&&!b.length&&(Y.onNorthPole||Y.onSouthPole)){const bt=O?x.stencilModeFor3D():$i.disabled;return void Gx(!!Y.onNorthPole,null,x,c,p,J,W,Ni.disabled,bt)}if(!b.length)return;const[pt,xt]=Y instanceof a.aT||nt?[{},b]:x.stencilConfigForOverlap(b),vt=xt[xt.length-1].overscaledZ;B&&W.defines.push("PROJECTION_GLOBE_VIEW"),O&&W.defines.push("RENDER_CUTOFF");const Et=(bt,Pt,Mt)=>{for(const Tt of bt){const Lt=Tt.toUnwrapped(),qt=c.getTile(Tt);if(nt&&(!qt||!qt.hasData()))continue;G.activeTexture.set(j.TEXTURE0);const jt=nD(qt,Y,p,W);if(!jt||!jt.texture)continue;const{texture:oe,mix:te,offset:he,tileSize:Oe,buffer:Jt}=jt;let Ut,de;nt?(Ut=fi.disabled,de=Tt.projMatrix):O?(Ut=new fi(j.LEQUAL,fi.ReadWrite,x.depthRangeFor3D),de=P?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(Lt,ut)):(Ut=x.depthModeForSublayer(Tt.overscaledZ-vt,p.paint.get("raster-opacity")===1?fi.ReadWrite:fi.ReadOnly,j.LESS),de=x.transform.calculateProjMatrix(Lt,ut));const ee=x.terrain&&nt?x.terrain.stencilModeForRTTOverlap(Tt):pt[Tt.overscaledZ],Ae=C?0:p.paint.get("raster-fade-duration");qt.registerFadeDuration(Ae);const Ue=c.findLoadedParent(Tt,0),ci=n_(qt,Ue,c,x.transform,Ae);let Le,Be;!ci.isFading&&qt.refreshedUponExpiration&&(qt.refreshedUponExpiration=!1),x.terrain&&x.terrain.prepareDrawTile(),G.activeTexture.set(j.TEXTURE0),oe.bind(st,j.CLAMP_TO_EDGE),G.activeTexture.set(j.TEXTURE1),Ue?(Ue.texture&&Ue.texture.bind(st,j.CLAMP_TO_EDGE),Le=Math.pow(2,Ue.tileID.overscaledZ-qt.tileID.overscaledZ),Be=[qt.tileID.canonical.x*Le%1,qt.tileID.canonical.y*Le%1]):oe.bind(st,j.CLAMP_TO_EDGE),"useMipmap"in oe&&G.extTextureFilterAnisotropic&&x.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const hi=x.transform;let ni;const ii=O?TT(hi):[0,0,0,0];let ai,Ei,mr,Ir,an,Vi=0;if(B&&Y instanceof a.aT&&Y.coordinates.length>3)ai=Float32Array.from(a.bj(a.dI(new a.cC(0,0,0)))),Ei=Float32Array.from(hi.globeMatrix),mr=Float32Array.from(a.dE(hi)),Ir=[a.aF(hi.center.lng),a.aJ(hi.center.lat)],ni=Y.elevatedGlobePerspectiveTransform,an=Y.elevatedGlobeGridMatrix||new Float32Array(9);else if(B){const Mr=a.dF(Tt.canonical);Vi=a.dG(Mr.getCenter().lat),ai=Float32Array.from(a.bj(a.dI(Tt.canonical))),Ei=Float32Array.from(hi.globeMatrix),mr=Float32Array.from(a.dE(hi)),Ir=[a.aF(hi.center.lng),a.aJ(hi.center.lat)],ni=[0,0],an=Float32Array.from(a.dH(Tt.canonical,Mr,Vi,hi.worldSize/hi._pixelsPerMercatorPixel))}else ni=Y instanceof a.aT?Y.perspectiveTransform:[0,0],ai=new Float32Array(16),Ei=new Float32Array(9),mr=new Float32Array(16),Ir=[0,0],an=new Float32Array(9);const Tr=Ag(de,ai,Ei,mr,an,Be||[0,0],a.aj(x.transform.zoom),Ir,ii,Le||1,ci,p,ni,O?p.paint.get("raster-elevation"):0,2,te,he,W.range,Oe,Jt,J),ir=x.isTileAffectedByFog(Tt),Qr=x.getOrCreateProgram("raster",{defines:W.defines,overrideFog:ir});if(x.uploadCommonUniforms(G,Qr,Lt),Y instanceof a.aT){const Mr=Y.elevatedGlobeVertexBuffer,pn=Y.elevatedGlobeIndexBuffer;if(nt||!P)Y.boundsBuffer&&Y.boundsSegments&&Qr.draw(x,j.TRIANGLES,Ut,$i.disabled,tt,Ni.disabled,Tr,p.id,Y.boundsBuffer,x.quadTriangleIndexBuffer,Y.boundsSegments);else if(Mr&&pn){const Or=hi.zoom<=a.cZ?Y.elevatedGlobeSegments:Y.getSegmentsForLongitude(hi.center.lng);Or&&Qr.draw(x,j.TRIANGLES,Ut,$i.disabled,tt,Pt,Tr,p.id,Mr,pn,Or)}}else if(B){Ut=new fi(j.LEQUAL,fi.ReadOnly,x.depthRangeFor3D);const Mr=x.globeSharedBuffers;if(Mr){const[pn,Or,ar]=Mr.getGridBuffers(Vi,!1);Qr.draw(x,j.TRIANGLES,Ut,Mt||ee,x.colorModeForRenderPass(),Pt,Tr,p.id,pn,Or,ar)}}else{const{tileBoundsBuffer:Mr,tileBoundsIndexBuffer:pn,tileBoundsSegments:Or}=x.getTileBoundsBuffers(qt);Qr.draw(x,j.TRIANGLES,Ut,ee,tt,Ni.disabled,Tr,p.id,Mr,pn,Or)}}if(!(Y instanceof a.aT)&&B)for(const Tt of bt){const Lt=Tt.canonical.y===(1<<Tt.canonical.z)-1;Tt.canonical.y===0&&Gx(!0,Tt,x,c,p,J,W,Pt,Mt||$i.disabled),Lt&&Gx(!1,Tt,x,c,p,J,W,Pt===Ni.frontCW?Ni.backCW:Ni.frontCW,Mt||$i.disabled)}};B?Et(xt,x.renderElevatedRasterBackface?Ni.backCW:Ni.frontCW,x.stencilModeFor3D()):Et(xt,Ni.disabled,void 0),x.resetStencilClippingMasks()},"raster-particle":function(x,c,p,b,A,C){x.renderPass==="offscreen"&&function(P,O,B,G){if(!G.length)return;const j=P.context,Y=j.gl,W=O.getSource();if(!(W instanceof Ga))return;const J=Math.ceil(Math.sqrt(B.paint.get("raster-particle-count")));let tt=B.particlePositionRGBAImage;if(!tt||tt.width!==J){const xt=function(vt){const Et=vt*vt,bt=new Uint8Array(4*Et),Pt=function(Tt){return Tt|=0,Tt=Math.imul(2747636419^Tt,2654435769),Tt=Math.imul(Tt^Tt>>>16,2654435769),((Tt=Math.imul(Tt^Tt>>>16,2654435769))>>>0)/4294967296},Mt=1/1.1;for(let Tt=0;Tt<Et;Tt++){const Lt=Mt*(Pt(2*Tt+0)+Nh),qt=Mt*(Pt(2*Tt+1)+Nh),jt=255*Lt%1,oe=255*qt%1,te=jt,he=qt-oe/255,Oe=oe;bt[4*Tt+0]=255*(Lt-jt/255),bt[4*Tt+1]=255*te,bt[4*Tt+2]=255*he,bt[4*Tt+3]=255*Oe}return bt}(J);tt=B.particlePositionRGBAImage=new a.q({width:J,height:J},xt)}let nt=B.particleFramebuffer;nt?nt.width!==J&&(nt.destroy(),nt=B.particleFramebuffer=j.createFramebuffer(J,J,!0,null)):nt=B.particleFramebuffer=j.createFramebuffer(J,J,!0,null);const ut=[];for(const xt of G){const vt=O.getTile(xt);if(!(vt instanceof Su))continue;const Et=Hx(vt,W,B);if(!Et)continue;const bt=[vt.tileSize,vt.tileSize];let Pt=B.tileFramebuffer;Pt||(Pt=B.tileFramebuffer=j.createFramebuffer(bt[0],bt[1],!0,null));let Mt=vt.rasterParticleState;Mt||(Mt=vt.rasterParticleState=new Ts(j,xt,bt,tt));const Tt=Mt.update(B.lastInvalidatedAt);Mt.particleTextureDimension!==J&&Mt.updateParticleTexture(xt,tt);const Lt=Mt.targetColorTexture;Mt.targetColorTexture=Mt.backgroundColorTexture,Mt.backgroundColorTexture=Lt;const qt=Mt.particleTexture0;Mt.particleTexture0=Mt.particleTexture1,Mt.particleTexture1=qt,ut.push([xt,Et,Mt,Tt])}if(ut.length===0)return;const st=a.o.now(),pt=B.previousDrawTimestamp?.001*(st-B.previousDrawTimestamp):.0167;if(B.previousDrawTimestamp=st,B.hasColorMap()){j.activeTexture.set(Y.TEXTURE0+2);let xt=B.colorRampTexture;xt||(xt=B.colorRampTexture=new a.T(j,B.colorRamp,Y.RGBA8)),xt.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}j.bindFramebuffer.set(B.tileFramebuffer.framebuffer),function(xt,vt,Et){const bt=xt.context,Pt=bt.gl,Mt=vt.tileFramebuffer;bt.activeTexture.set(Pt.TEXTURE0);const Tt={u_texture:0,u_opacity:1.05*(qt=vt.paint.get("raster-particle-fade-opacity-factor"))/(qt+.05)},Lt=xt.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var qt;for(const jt of Et){const[,,oe,te]=jt;Mt.colorAttachment.set(oe.targetColorTexture.texture),bt.viewport.set([0,0,Mt.width,Mt.height]),bt.clear({color:a.ao.transparent}),te&&(oe.backgroundColorTexture.bind(Pt.NEAREST,Pt.CLAMP_TO_EDGE),Lt.draw(xt,Pt.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,Tt,vt.id,xt.viewportBuffer,xt.quadTriangleIndexBuffer,xt.viewportSegments))}}(P,B,ut),function(xt,vt,Et,bt){const Pt=xt.context,Mt=Pt.gl,Tt=Et.tileFramebuffer,Lt=xt.transform.projection.name==="globe",qt=Et.paint.get("raster-particle-max-speed");for(const jt of bt){const[oe,te,he]=jt;Pt.activeTexture.set(Mt.TEXTURE0+0),te.texture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE),Tt.colorAttachment.set(he.targetColorTexture.texture);const Oe=xt.getOrCreateProgram("rasterParticleDraw",{defines:te.defines,overrideFog:!1});Pt.activeTexture.set(Mt.TEXTURE0+1);const Jt=te.scalarData?[]:[0,1,2,3].map(ee=>a.e8[ee](oe));Jt.push(oe);const Ut=oe.canonical.x,de=oe.canonical.y;for(const ee of Jt){const Ae=vt.getTile(Lt?ee.wrapped():ee);if(!Ae)continue;const Ue=Ae.rasterParticleState;if(!Ue)continue;const ci=ee.canonical.x+(1<<ee.canonical.z)*(ee.wrap-oe.wrap),Le=ee.canonical.y;Ue.particleTexture0.bind(Mt.NEAREST,Mt.CLAMP_TO_EDGE);const Be=kx(1,Ue.particleTexture0.size[0],[ci-Ut,Le-de],0,te.texture.size,2,qt,te.textureOffset,te.scale,te.offset);Oe.draw(xt,Mt.POINTS,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,Be,Et.id,Ue.particleIndexBuffer,void 0,Ue.particleSegment)}}}(P,O,B,ut),j.bindFramebuffer.set(B.particleFramebuffer.framebuffer),function(xt,vt,Et,bt){const Pt=xt.context,Mt=Pt.gl,Tt=vt.paint.get("raster-particle-max-speed"),Lt=bt*vt.paint.get("raster-particle-speed-factor")*.15,qt=function(oe){return Math.pow(oe,6)}(.01+1*vt.paint.get("raster-particle-reset-rate-factor")),jt=vt.particleFramebuffer;Pt.viewport.set([0,0,jt.width,jt.height]);for(const oe of Et){const[,te,he]=oe;Pt.activeTexture.set(Mt.TEXTURE0+0),te.texture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE),Pt.activeTexture.set(Mt.TEXTURE0+1);const Oe=he.particleTexture0;Oe.bind(Mt.NEAREST,Mt.CLAMP_TO_EDGE);const Jt=h_(1,Oe.size[0],0,te.texture.size,Tt,Lt,qt,te.textureOffset,te.scale,te.offset);jt.colorAttachment.set(he.particleTexture1.texture),Pt.clear({color:a.ao.transparent}),xt.getOrCreateProgram("rasterParticleUpdate",{defines:te.defines}).draw(xt,Mt.TRIANGLES,fi.disabled,$i.disabled,lr.unblended,Ni.disabled,Jt,vt.id,xt.viewportBuffer,xt.quadTriangleIndexBuffer,xt.viewportSegments)}}(P,B,ut,pt)}(x,c,p,b),x.renderPass==="translucent"&&(function(P,O,B,G,j){const Y=P.context,W=Y.gl,J=O.getSource().tileSize,tt=5*(1-a.ah(a.cK,a.cK+1,P.transform.zoom))*J+B.paint.get("raster-particle-elevation"),nt=!P.options.moving,ut=P.transform.projection.name==="globe";if(!G.length)return;const[st,pt]=P.stencilConfigForOverlap(G),xt=[];ut&&xt.push("PROJECTION_GLOBE_VIEW");const vt=P.stencilModeFor3D();for(const Et of pt){const bt=Et.toUnwrapped(),Pt=O.getTile(Et);if(!Pt.rasterParticleState)continue;const Mt=Pt.rasterParticleState,Tt=100;Pt.registerFadeDuration(Tt);const Lt=O.findLoadedParent(Et,0),qt=n_(Pt,Lt,O,P.transform,Tt);let jt,oe;P.terrain&&P.terrain.prepareDrawTile(),Y.activeTexture.set(W.TEXTURE0),Mt.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Y.activeTexture.set(W.TEXTURE1),Lt&&Lt.rasterParticleState?(Lt.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),jt=Math.pow(2,Lt.tileID.overscaledZ-Pt.tileID.overscaledZ),oe=[Pt.tileID.canonical.x*jt%1,Pt.tileID.canonical.y*jt%1]):Mt.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const te=ut?Float32Array.from(P.transform.expandedFarZProjMatrix):P.transform.calculateProjMatrix(bt,nt),he=P.transform,Oe=Ko(he),Jt=a.dF(Et.canonical),Ut=a.dG(Jt.getCenter().lat);let de,ee,Ae,Ue,ci;ut?(de=Float32Array.from(a.bj(a.dI(Et.canonical))),ee=Float32Array.from(he.globeMatrix),Ae=Float32Array.from(a.dE(he)),Ue=[a.aF(he.center.lng),a.aJ(he.center.lat)],ci=Float32Array.from(a.dH(Et.canonical,Jt,Ut,he.worldSize/he._pixelsPerMercatorPixel))):(de=new Float32Array(16),ee=new Float32Array(9),Ae=new Float32Array(16),Ue=[0,0],ci=new Float32Array(9));const Le=Mu(te,de,ee,Ae,ci,oe||[0,0],a.aj(P.transform.zoom),Ue,Oe,jt||1,qt,tt),Be=P.isTileAffectedByFog(Et),hi=P.getOrCreateProgram("rasterParticle",{defines:xt,overrideFog:Be});if(P.uploadCommonUniforms(Y,hi,bt),ut){const ni=new fi(W.LEQUAL,fi.ReadOnly,P.depthRangeFor3D),ii=0,ai=P.globeSharedBuffers;if(ai){const[Ei,mr,Ir]=ai.getGridBuffers(Ut,ii!==0);hi.draw(P,W.TRIANGLES,ni,vt,lr.alphaBlended,P.renderElevatedRasterBackface?Ni.frontCCW:Ni.backCCW,Le,B.id,Ei,mr,Ir)}}else{const ni=P.depthModeForSublayer(0,fi.ReadOnly),ii=st[Et.overscaledZ],{tileBoundsBuffer:ai,tileBoundsIndexBuffer:Ei,tileBoundsSegments:mr}=P.getTileBoundsBuffers(Pt);hi.draw(P,W.TRIANGLES,ni,ii,lr.alphaBlended,Ni.disabled,Le,B.id,ai,Ei,mr)}}P.resetStencilClippingMasks()}(x,c,p,b),x.style.map.triggerRepaint())},background:function(x,c,p,b){const A=p.paint.get("background-color"),C=p.paint.get("background-color-use-theme").constantOr("default")==="none",P=p.paint.get("background-opacity"),O=p.paint.get("background-emissive-strength"),B=p.paint.get("background-pitch-alignment")==="viewport";if(P===0)return;const G=x.context,j=G.gl,Y=x.transform,W=Y.tileSize,J=p.paint.get("background-pattern");let tt;if(J!==void 0&&(J===null||(tt=x.imageManager.getPattern(a.I.from(J.toString()),p.scope,x.style.getLut(p.scope)),!tt)))return;const nt=!J&&A.a===1&&P===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==nt)return;const ut=$i.disabled,st=x.depthModeForSublayer(0,nt==="opaque"?fi.ReadWrite:fi.ReadOnly),pt=x.colorModeForDrapableLayerRenderPass(O),xt=J?"backgroundPattern":"background";let vt,Et=b;if(Et||(vt=x.getBackgroundTiles(),Et=Object.values(vt).map(bt=>bt.tileID)),J&&(G.activeTexture.set(j.TEXTURE0),x.imageManager.bind(x.context,p.scope)),B){const bt=x.getOrCreateProgram(xt,{overrideFog:!1,overrideRtt:!0}),Pt=new Float32Array(a.bz([])),Mt=new a.aP(0,0,0,0,0),Tt=J?f_(Pt,O,P,x,0,p.scope,tt,B,{tileID:Mt,tileSize:W}):d_(Pt,O,P,A.toPremultipliedRenderColor(C?null:p.lut));bt.draw(x,j.TRIANGLES,st,ut,pt,Ni.disabled,Tt,p.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments)}else for(const bt of Et){const Pt=x.isTileAffectedByFog(bt),Mt=x.getOrCreateProgram(xt,{overrideFog:Pt}),Tt=bt.toUnwrapped(),Lt=b?bt.projMatrix:x.transform.calculateProjMatrix(Tt);x.prepareDrawTile();const qt=c?c.getTile(bt):vt?vt[bt.key]:new sc(bt,W,Y.zoom,x),jt=J?f_(Lt,O,P,x,0,p.scope,tt,B,{tileID:bt,tileSize:W}):d_(Lt,O,P,A.toPremultipliedRenderColor(C?null:p.lut));x.uploadCommonUniforms(G,Mt,Tt);const{tileBoundsBuffer:oe,tileBoundsIndexBuffer:te,tileBoundsSegments:he}=x.getTileBoundsBuffers(qt);Mt.draw(x,j.TRIANGLES,st,ut,pt,Ni.disabled,jt,p.id,oe,te,he)}},sky:function(x,c,p){const b=x._atmosphere?a.aj(x.transform.zoom):1,A=p.paint.get("sky-opacity")*b;if(A===0)return;const C=x.context,P=p.paint.get("sky-type"),O=new fi(C.gl.LEQUAL,fi.ReadOnly,[0,1]),B=x.frameCounter/1e3%1;P==="atmosphere"?x.renderPass==="offscreen"?p.needsSkyboxCapture(x)&&(function(G,j,Y,W){const J=G.context,tt=J.gl;let nt=j.skyboxFbo;if(!nt){nt=j.skyboxFbo=J.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new qx(J),j.skyboxTexture=J.gl.createTexture(),tt.bindTexture(tt.TEXTURE_CUBE_MAP,j.skyboxTexture),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_WRAP_S,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_WRAP_T,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_MIN_FILTER,tt.LINEAR),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_MAG_FILTER,tt.LINEAR);for(let xt=0;xt<6;++xt)tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,tt.RGBA,32,32,0,tt.RGBA,tt.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(nt.framebuffer),J.viewport.set([0,0,32,32]);const ut=j.getCenter(G,!0),st=G.getOrCreateProgram("skyboxCapture"),pt=new Float64Array(16);a.bz(pt),a.em(pt,pt,.5*-Math.PI),Tl(G,j,st,pt,ut,0),a.bz(pt),a.em(pt,pt,.5*Math.PI),Tl(G,j,st,pt,ut,1),a.bz(pt),a.cT(pt,pt,.5*-Math.PI),Tl(G,j,st,pt,ut,2),a.bz(pt),a.cT(pt,pt,.5*Math.PI),Tl(G,j,st,pt,ut,3),a.bz(pt),Tl(G,j,st,pt,ut,4),a.bz(pt),a.em(pt,pt,Math.PI),Tl(G,j,st,pt,ut,5),J.viewport.set([0,0,G.width,G.height])}(x,p),p.markSkyboxValid(x)):x.renderPass==="sky"&&function(G,j,Y,W,J){const tt=G.context,nt=tt.gl,ut=G.transform,st=G.getOrCreateProgram("skybox");tt.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_CUBE_MAP,j.skyboxTexture);const pt=((xt,vt,Et,bt,Pt)=>({u_matrix:xt,u_sun_direction:vt,u_cubemap:0,u_opacity:bt,u_temporal_offset:Pt}))(ut.skyboxMatrix,j.getCenter(G,!1),0,W,J);G.uploadCommonUniforms(tt,st),st.draw(G,nt.TRIANGLES,Y,$i.disabled,G.colorModeForRenderPass(),Ni.backCW,pt,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(x,p,O,A,B):P==="gradient"&&x.renderPass==="sky"&&function(G,j,Y,W,J){const tt=G.context,nt=tt.gl,ut=G.transform,st=G.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new qx(tt)),tt.activeTexture.set(nt.TEXTURE0);let pt=j.colorRampTexture;pt||(pt=j.colorRampTexture=new a.T(tt,j.colorRamp,nt.RGBA8)),pt.bind(nt.LINEAR,nt.CLAMP_TO_EDGE);const xt=((vt,Et,bt,Pt,Mt)=>({u_matrix:vt,u_color_ramp:0,u_center_direction:Et,u_radius:a.an(bt),u_opacity:Pt,u_temporal_offset:Mt}))(ut.skyboxMatrix,j.getCenter(G,!1),j.paint.get("sky-gradient-radius"),W,J);G.uploadCommonUniforms(tt,st),st.draw(G,nt.TRIANGLES,Y,$i.disabled,G.colorModeForRenderPass(),Ni.backCW,xt,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(x,p,O,A,B)},custom:function(x,c,p,b){const A=x.context,C=p.implementation;if(!x.transform.projection.unsupportedLayers||!x.transform.projection.unsupportedLayers.includes("custom")||x.terrain&&(x.terrain.renderingToTexture||x.renderPass==="offscreen")&&p.isDraped(c)){if(x.renderPass==="offscreen"){const P=C.prerender;if(P){if(x.setCustomLayerDefaults(),A.setColorMode(x.colorModeForRenderPass()),x.transform.projection.name==="globe"){const O=x.transform.pointMerc;P.call(C,A.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),a.aj(x.transform.zoom),[O.x,O.y],x.transform.pixelsPerMeterRatio)}else P.call(C,A.gl,x.transform.customLayerMatrix());A.setDirty(),x.setBaseState()}}else if(x.renderPass==="translucent"){if(x.terrain&&x.terrain.renderingToTexture){const O=C.renderToTile;if(O){const B=b[0].canonical,G={x:B.x+b[0].wrap*(C.wrapTileId?0:1<<B.z),y:B.y,z:B.z};A.setDepthMode(fi.disabled),A.setStencilMode($i.disabled),A.setColorMode(x.colorModeForRenderPass()),x.setCustomLayerDefaults(),O.call(C,A.gl,G),A.setDirty(),x.setBaseState()}return}x.setCustomLayerDefaults(),A.setColorMode(x.colorModeForRenderPass()),A.setStencilMode($i.disabled);const P=C.renderingMode==="3d"?new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,fi.ReadOnly);if(A.setDepthMode(P),x.transform.projection.name==="globe"){const O=x.transform.pointMerc;C.render(A.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),a.aj(x.transform.zoom),[O.x,O.y],x.transform.pixelsPerMeterRatio)}else C.render(A.gl,x.transform.customLayerMatrix());A.setDirty(),x.setBaseState(),A.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(x,c,p,b){if(x.renderPass==="opaque")return;const A=p.paint.get("model-opacity").constantOr(1),C=p.paint.get("model-elevation-reference"),P=C==="ground",O=C==="ground";if(A===0)return;const B=p.paint.get("model-cast-shadows");if(x.renderPass==="shadow"&&(!B||x.terrain&&A<.65&&p._transitionablePaint._values["model-opacity"].value.expression instanceof a.ad))return;const G=x.shadowRenderer,j=p.paint.get("model-receive-shadows");G&&(G.useNormalOffset=!0,j||(G.enabled=!1));const Y=()=>{G&&(G.useNormalOffset=!0,j||(G.enabled=!0))},W=c.getSource();if(x.renderPass==="light-beam"&&W.type!=="batched-model")return;if(W.type==="vector"||W.type==="geojson")return function(vt,Et,bt,Pt,Mt){const Tt=vt.transform,Lt=Tt.projection.name==="globe",qt=Tt.getFreeCameraOptions().position;if(!vt.modelManager)return;const jt=vt.modelManager;bt.modelManager=jt;const oe=vt.shadowRenderer;if(!bt._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const te=bt._unevaluatedLayout._values["model-id"],he=Object.assign({},bt.layout.get("model-id").parameters),Oe=vt.style.order.indexOf(bt.fqid);for(const Jt of Pt){const Ut=Et.getTile(Jt).getBucket(bt);if(!Ut||Ut.projection.name!==Tt.projection.name)continue;const de=Ut.getModelUris();if(de&&!Ut.modelsRequested&&(jt.addModelsFromBucket(de,Mt),Ut.modelsRequested=!0),Lt)he.zoom=Jt.overscaledZ;else{const ni=Yx(Jt,Tt);he.zoom=ni}const ee=te.possiblyEvaluate(he);if(ET(vt,Ut,Jt),Zs.shadowUniformsInitialized=!1,Zs.useSingleShadowCascade=!!oe&&oe.getMaxCascadeForTile(Jt.toUnwrapped())===0,vt.renderPass==="shadow"&&oe){if(vt.currentShadowCascade===1&&Ut.isInsideFirstShadowMapFrustum)continue;const ni=Tt.calculatePosMatrix(Jt.toUnwrapped(),Tt.worldSize);if(Zs.tileMatrix.set(ni),Zs.shadowTileMatrix=Float32Array.from(oe.calculateShadowPassMatrixFromMatrix(ni)),Zs.aabb.min=[0,0,0],Zs.aabb.max[0]=Zs.aabb.max[1]=a.al,Zs.aabb.max[2]=0,T_(Ut,Zs,vt,bt.scope))continue}const Ae=1<<Jt.canonical.z,Ue=[((qt.x-Jt.wrap)*Ae-Jt.canonical.x)*a.al,(qt.y*Ae-Jt.canonical.y)*a.al,qt.z*Ae*a.al];vt.conflationActive&&Object.keys(Ut.instancesPerModel).length>0&&vt.style.isLayerClipped(bt,Et.getSource())&&Ut.updateReplacement(Jt,vt.replacementSource,Oe,Mt)&&(Ut.uploaded=!1,Ut.upload(vt.context));let ci=0;const Le=new Array,Be=new Array,hi=new Array;for(let ni in Ut.instancesPerModel){const ii=Ut.instancesPerModel[ni];ii.features.length>0&&!Lt&&(ni=ee.evaluate(ii.features[0].feature,{}));const ai=jt.getModel(ni,Mt);if(ai||jt.hasURLBeenRequested(ni)||Ut.modelUris.includes(ni)||(Ut.modelUris.push(ni),Ut.modelsRequested=!1),ai&&ai.uploaded)if(Lt){const Ei=a.c4([],[qt.x,qt.y,qt.z],vt.transform.worldSize);a.ev(Ei,Ei);for(let mr=0;mr<ii.instancedDataArray.length;++mr){const Ir=[0,0,0],an=[1,1,1],Vi=a.ew(),Tr=ii.tileCoordinatesForInstance(mr),ir=ii.transformForInstance(mr);a.ex(an,ir),a.ey(Vi,ir),a.ez(Ir,Vi);const Qr=ii.translationForInstance(mr),Mr=new a.aS(0,0);a.eA(Ut.canonical,Mr,Tr.x,Tr.y);const pn=a.bB();a.eB(pn,ai,vt.transform,Mr,Ir,an,Qr,!0,!1,!1);const Or=ii.colorForInstance(mr),ar=a.bz([]),Gr=a.ee(Mr.lat,vt.transform.zoom),cr=a.bp([],[1,1,1/Gr]);a.bq(ar,ar,Ei),hi.push({zScaleMatrix:cr,negCameraPosMatrix:ar});for(const wn of ai.nodes)S_(vt,wn,pn,vt.transform.expandedFarZProjMatrix,ci,Le,Be,ai.materialOverrides,Or);++ci}}else for(const Ei of ai.nodes)Kx(vt,bt,Ei,ii,Ue,Jt,Zs)}if(Lt)if(vt.renderPass==="shadow"){for(const ni of Be)vf(ni.mesh,ni.nodeModelMatrix,vt,bt);for(const ni of Le)vf(ni.mesh,ni.nodeModelMatrix,vt,bt)}else CT(vt,bt,1,Le,Be,hi)}}(x,c,p,b,w_(W,p,x.style._importedAsBasemap)),void Y();if(!W.loaded())return;if(W.type==="batched-model")return function(vt,Et,bt,Pt){bt.resetLayerRenderingStats(vt);const Mt=vt.context,Tt=vt.transform,Lt=vt.style.fog,qt=vt.shadowRenderer;if(Tt.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Tt.projection.name} projection is not yet implemented`);const jt=vt.transform.getFreeCameraOptions().position,oe=a.c4([],[jt.x,jt.y,jt.z],vt.transform.worldSize),te=a.ev([],oe),he=a.bz([]),Oe=a.ee(Tt.center.lat,Tt.zoom),Jt=a.bp([],[1,1,1/Oe]);a.bq(he,he,te);const Ut=bt.paint.get("model-opacity").constantOr(1),de=new fi(Mt.gl.LEQUAL,fi.ReadWrite,vt.depthRangeFor3D),ee=new fi(Mt.gl.LEQUAL,fi.ReadOnly,vt.depthRangeFor3D),Ae=new a.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ue=vt.renderPass==="shadow",ci=Ue&&qt?qt.getCurrentCascadeFrustum():Tt.getFrustum(Tt.scaleZoom(Tt.worldSize)),Le=bt.paint.get("model-front-cutoff"),Be=Le[2]<1,hi=Hc(vt,bt.paint.get("model-cutoff-fade-range")),ni=bt.getLayerRenderingStats();(function(ii,ai,Ei,mr){const Ir=ii.terrain?ii.terrain.exaggeration():0,an=ii.transform.zoom;for(const Vi of mr){const Tr=ai.getTile(Vi).getBucket(Ei);Tr&&(Tr.setFilter(Ei.filter),ii.conflationActive&&Tr.updateReplacement(Vi,ii.replacementSource),Tr.evaluateTransform(ii,Ei),ii.terrain&&Ir>0&&Tr.elevationUpdate(ii.terrain,Ir,Vi,Ei.source),Tr.needsReEvaluation(ii,an,Ei)&&Tr.evaluate(Ei))}})(vt,Et,bt,Pt),function(){let ii,ai,Ei;Be?(ii=Pt.length-1,ai=-1,Ei=-1):(ii=0,ai=Pt.length,Ei=1);const mr=new Float64Array(16),Ir=a.cz(),an=new a.P(0,0);for(let Vi=ii;Vi!==ai;Vi+=Ei){const Tr=Pt[Vi],ir=Et.getTile(Tr).getBucket(bt);if(!ir||!ir.uploaded)continue;let Qr=!1;qt&&(Qr=qt.getMaxCascadeForTile(Tr.toUnwrapped())===0);const Mr=Tt.calculatePosMatrix(Tr.toUnwrapped(),Tt.worldSize),pn=ir.modelTraits;!Ue&&Be&&(a.bk(mr,Mr),a.af(Ir,oe,mr),an.x=Ir[0],an.y=Ir[1]);const Or=[];ir.setFilter(bt.filter);for(const ar of ir.getNodesInfo()){if(ar.hiddenByReplacement||!ar.node.meshes)continue;const Gr=ar.node;let cr=0;vt.terrain&&Gr.elevation&&(cr=Gr.elevation*vt.terrain.exaggeration());const wn=(()=>{const Io=ar.aabb;return Ae.min=[...Io.min],Ae.max=[...Io.max],Ae.min[2]+=cr,Ae.max[2]+=cr,a.af(Ae.min,Ae.min,Mr),a.af(Ae.max,Ae.max,Mr),Ae})(),Zr=ar.evaluatedScale;if(Zr[0]<=1&&Zr[1]<=1&&Zr[2]<=1&&wn.intersects(ci)===0)continue;if(!Ue&&Be){const Io=.16666666666666666;ar.cameraCollisionOpacity=oe[0]>wn.min[0]&&oe[0]<wn.max[0]&&oe[1]>wn.min[1]&&oe[1]<wn.max[1]&&oe[2]*Oe<wn.max[2]&&Gr.footprint&&a.b$(an,Gr.footprint)?Math.max(ar.cameraCollisionOpacity-Io,0):Math.min(1,ar.cameraCollisionOpacity+Io)}const Hi=[...Mr],Dr=1/a.d6(Tr.canonical),zn=Gr.anchor?Gr.anchor[0]:0,ia=Gr.anchor?Gr.anchor[1]:0;a.bq(Hi,Hi,[zn*(Zr[0]-1)+ar.evaluatedTranslation[0]*Dr,ia*(Zr[1]-1)+ar.evaluatedTranslation[1]*Dr,cr+ar.evaluatedTranslation[2]]),a.cp(Zr,a.eD)||a.cR(Hi,Hi,Zr);const Un=a.aB([],Hi,Gr.globalMatrix),Kn=a.aB([],Tt.expandedFarZProjMatrix,Un),ds=a.aB([],Tt.expandedFarZProjMatrix,Hi),Jo=a.aC([],[zn,ia,cr,1],Kn)[2];Gr.hidden=!1;let fo=Ut;Ue||(Be&&(fo*=ar.cameraCollisionOpacity,fo*=Gh(Hi,Tt,ar.aabb,Le)),fo*=Eg(hi,Jo)),fo!==0?Or.push({nodeInfo:ar,depth:Jo,opacity:fo,wvpForNode:Kn,wvpForTile:ds,nodeModelMatrix:Un,tileModelMatrix:Hi}):Gr.hidden=!0}Ue||Or.sort((ar,Gr)=>!Be||ar.opacity===1&&Gr.opacity===1?ar.depth<Gr.depth?-1:1:ar.opacity===1?-1:Gr.opacity===1?1:ar.depth>Gr.depth?-1:1);for(const ar of Or){const Gr=ar.nodeInfo,cr=Gr.node;let wn=a.aB([],Jt,ar.tileModelMatrix);a.aB(wn,he,wn);const Zr=a.bk([],wn);a.ef(Zr,Zr),a.cR(Zr,Zr,DT),wn=a.aB(wn,wn,cr.globalMatrix);const Hi=vt.renderPass==="light-beam",Dr=bt.paint.get("model-color-use-theme").constantOr("default")==="none",zn=pn&a.eH.HasMapboxMeshFeatures,ia=zn?0:Gr.evaluatedRMEA[0][2];for(let Un=0;Un<cr.meshes.length;++Un){const Kn=cr.meshes[Un],ds=Un===cr.lightMeshIndex;let Jo=ar.wvpForNode;if(ds){if(!Hi&&!vt.terrain&&vt.shadowRenderer){vt.currentLayer<vt.firstLightBeamLayer&&(vt.firstLightBeamLayer=vt.currentLayer);continue}Jo=ar.wvpForTile}else if(Hi)continue;const fo={defines:[]},Io=[];if(!Ue&&qt&&(qt.useNormalOffset=!!Kn.normalBuffer),gf(fo.defines,Io,Kn,vt,Dr?null:bt.lut),zn||fo.defines.push("DIFFUSE_SHADED"),Qr&&fo.defines.push("SHADOWS_SINGLE_CASCADE"),ni&&(Ue?ni.numRenderedVerticesInShadowPass+=Kn.vertexArray.length:ni.numRenderedVerticesInTransparentPass+=Kn.vertexArray.length),Ue){vf(Kn,ar.nodeModelMatrix,vt,bt);continue}let Xs=null;if(Lt){const ra=Xx(ar.nodeModelMatrix,vt.transform);if(Xs=new Float32Array(ra),Tt.projection.name!=="globe"){const hn=Kn.aabb.min,sa=Kn.aabb.max,[Xa,$n]=Lt.getOpacityForBounds(ra,hn[0],hn[1],sa[0],sa[1]);fo.overrideFog=Xa>=ie||$n>=ie}}const po=Kn.material;let Ys;po.occlusionTexture&&po.occlusionTexture.offsetScale&&(Ys=po.occlusionTexture.offsetScale,fo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ml=vt.getOrCreateProgram("model",fo);!Ue&&qt&&qt.setupShadowsFromMatrix(ar.tileModelMatrix,Ml,qt.useNormalOffset),vt.uploadCommonUniforms(Mt,Ml,null,Xs);const qa=po.pbrMetallicRoughness;qa.metallicFactor=.9,qa.roughnessFactor=.5;const Wn=p_(new Float32Array(Jo),new Float32Array(wn),new Float32Array(Zr),new Float32Array(cr.globalMatrix),vt,ar.opacity,qa.baseColorFactor,po.emissiveFactor,qa.metallicFactor,qa.roughnessFactor,po,ia,bt,[0,0,0],Ys);!ds&&(Gr.hasTranslucentParts||ar.opacity<1)&&Ml.draw(vt,Mt.gl.TRIANGLES,de,$i.disabled,lr.disabled,Ni.backCCW,Wn,bt.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,bt.paint,vt.transform.zoom,void 0,Io),Ml.draw(vt,Mt.gl.TRIANGLES,ds?ee:de,$i.disabled,ds||ar.opacity<1||Gr.hasTranslucentParts?lr.alphaBlended:lr.unblended,Ni.backCCW,Wn,bt.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,bt.paint,vt.transform.zoom,void 0,Io)}}}}()}(x,c,p,b),void Y();if(W.type!=="model")return;const J=W.getModels(),tt=[],nt=x.transform.getFreeCameraOptions().position,ut=a.c4([],[nt.x,nt.y,nt.z],x.transform.worldSize);a.ev(ut,ut);const st=[],pt=[];let xt=0;for(const vt of J){const Et=c.getFeatureState("",vt.id),bt={type:"Unknown",id:vt.id,properties:vt.featureProperties},Pt=p.paint.get("model-rotation").evaluate(bt,Et),Mt=p.paint.get("model-scale").evaluate(bt,Et),Tt=p.paint.get("model-translation").evaluate(bt,Et);_f(p,vt.id,Et,vt.featureProperties,vt.nodeOverrideNames,vt.nodeOverrides),oD(p,vt.id,Et,vt.featureProperties,vt.materialOverrideNames,vt.materialOverrides),vt.nodeOverrides.size>0&&vt.computeBoundsAndApplyParent(),vt.computeModelMatrix(x,Pt,Mt,Tt,O,P,!1);const Lt=a.bz([]),qt=a.ee(vt.position.lat,x.transform.zoom),jt=a.bp([],[1,1,1/qt]);a.bq(Lt,Lt,ut),tt.push({zScaleMatrix:jt,negCameraPosMatrix:Lt});for(const oe of vt.nodes)S_(x,oe,vt.matrix,x.transform.expandedFarZProjMatrix,xt,st,pt,vt.materialOverrides);xt++}if(st.sort((vt,Et)=>Et.depth-vt.depth),x.renderPass!=="shadow")CT(x,p,A,st,pt,tt),Y();else{for(const vt of pt)vf(vt.mesh,vt.nodeModelMatrix,x,p);for(const vt of st)vf(vt.mesh,vt.nodeModelMatrix,x,p);Y()}}},A_={line:function(x,c,p){if(x.hasElevatedBuckets=!1,x.hasNonElevatedBuckets=!1,x._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||x._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(c){const b=c.getVisibleCoordinates();for(const A of b){const C=c.getTile(A).getBucket(x);if(C&&(C.elevationType!=="none"?x.hasElevatedBuckets=!0:x.hasNonElevatedBuckets=!0,x.hasElevatedBuckets&&x.hasNonElevatedBuckets))break}}}else x.hasNonElevatedBuckets=!0},model:function(x,c,p){const b=c.getSource();if(!b.loaded())return;if(b.type==="vector"||b.type==="geojson"){const C=w_(b,x,p.style._importedAsBasemap);return void(p.modelManager&&p.modelManager.upload(p,C))}if(b.type==="batched-model"||b.type!=="model")return;const A=b.getModels();for(const C of A)C.upload(p.context)},raster:function(x,c,p){const b=c.getSource();if(!(b instanceof Ga&&b.loaded()))return;const A=x.sourceLayer||b.rasterLayerIds&&b.rasterLayerIds[0];if(!A)return;const C=x.paint.get("raster-array-band")||b.getInitialBand(A);if(C==null)return;const P=c.getIds().map(O=>c.getTileByID(O));for(const O of P)O.updateNeeded(x.id,C)&&b.prepareTile(O,A,x.id,C)},"raster-particle":function(x,c,p){const b=c.getSource();if(!(b instanceof Ga&&b.loaded()))return;const A=x.sourceLayer||b.rasterLayerIds&&b.rasterLayerIds[0];if(!A)return;const C=x.paint.get("raster-particle-array-band")||b.getInitialBand(A);if(C==null)return;const P=c.getIds().map(O=>c.getTileByID(O));for(const O of P)O.updateNeeded(x.id,C)&&b.prepareTile(O,A,x.id,C)}},I_={fill:Vh},qs={fill:function(x,c,p,b){if(!p.layout||p.layout.get("fill-elevation-reference")==="none"||p.paint.get("fill-opacity").constantOr(1)===0)return;const A=x.context.gl,C=new fi(A.LEQUAL,fi.ReadOnly,x.depthRangeFor3D),P=new $i({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),O=x.transform.getFreeCameraOptions().position,B=x.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const G of b){const j=c.getTile(G),Y=j.getBucket(p);if(!Y)continue;const W=Y.elevatedStructures;if(!W||W.depthSegments.segments[0].primitiveLength===0)continue;const J=wT(G.toUnwrapped(),O),tt=x.translatePosMatrix(G.projMatrix,j,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor")),nt=l_(tt,J,0,1,0);B.draw(x,A.TRIANGLES,C,P,lr.disabled,Ni.disabled,nt,p.id,W.vertexBuffer,W.indexBuffer,W.depthSegments,p.paint,x.transform.zoom)}}};class Ru{constructor(c,p,b,A,C,P){this.context=new m_(c,p),this.transform=b,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=C,this._timeStamp=a.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const O=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of O)this._debugParams.enabledLayers[G]=!0;C.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),C.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),C.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),C.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),C.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const G of O)C.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],G);this.occlusionParams=new sD(C),this.setup(),this.numSublayers=_l.maxUnderzooming+_l.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new pg(this),this._wireframeDebugCache=new LT,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const B=new a.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,B,c.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=A,this.worldview=P}updateTerrain(c,p){const b=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(b||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Sg(this,c));const A=this._terrain;this.transform.elevation=b?A:null,A.update(c,this.transform,p),this.transform.elevation&&!A.enabled&&(this.transform.elevation=null)}_updateFog(c){const p=c.fog;if(!p||this.transform.projection.name==="globe"||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[b,A]=p.getFovAdjustedRange(this.transform._fov);if(b>A)return void(this.transform.fogCullDistSq=null);const C=b+.78*(A-b);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(c){c&&!this._terrain&&(this._terrain=new Sg(this,this.style)),this._forceTerrainMode=c}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(c,p){if(this.width=c*a.o.devicePixelRatio,this.height=p*a.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style.order)this.style._mergedLayers[b].resize()}setup(){const c=this.context,p=new a.bc;p.emplaceBack(0,0),p.emplaceBack(a.al,0),p.emplaceBack(0,a.al),p.emplaceBack(a.al,a.al),this.tileExtentBuffer=c.createVertexBuffer(p,a.be.members),this.tileExtentSegments=a.bf.simpleSegment(0,0,4,2);const b=new a.bc;b.emplaceBack(0,0),b.emplaceBack(a.al,0),b.emplaceBack(0,a.al),b.emplaceBack(a.al,a.al),this.debugBuffer=c.createVertexBuffer(b,a.be.members),this.debugSegments=a.bf.simpleSegment(0,0,4,5);const A=new a.bc;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(-1,1),A.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(A,a.be.members),this.viewportSegments=a.bf.simpleSegment(0,0,4,2);const C=new a.a$;C.emplaceBack(0,0,0,0),C.emplaceBack(a.al,0,a.al,0),C.emplaceBack(0,a.al,0,a.al),C.emplaceBack(a.al,a.al,a.al,a.al),this.mercatorBoundsBuffer=c.createVertexBuffer(C,a.bh.members),this.mercatorBoundsSegments=a.bf.simpleSegment(0,0,4,2);const P=new a.b0;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(P);const O=new a.bd;for(const G of[0,1,3,2,0])O.emplaceBack(G);this.debugIndexBuffer=c.createIndexBuffer(O),this.emptyTexture=new a.T(c,new a.q({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA8),this.identityMat=a.bB();const B=this.context.gl;this.stencilClearMode=new $i({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,c.TRIANGLES,fi.disabled,this.stencilClearMode,lr.disabled,Ni.disabled,Fh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,p,b){if(!p||this.currentStencilSource===p.id||!c.isTileClipped()||!b||b.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const B of b)if(this._tileClippingMaskIDs[B.key]===void 0){O=!0;break}if(!O)return}this.currentStencilSource=p.id;const A=this.context,C=A.gl;this.nextStencilID+b.length>256&&this.clearStencil(),A.setColorMode(lr.disabled),A.setDepthMode(fi.disabled);const P=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of b){const B=p.getTile(O),G=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:Y,tileBoundsSegments:W}=this.getTileBoundsBuffers(B);P.draw(this,C.TRIANGLES,fi.disabled,new $i({func:C.ALWAYS,mask:0},G,255,C.KEEP,C.KEEP,C.REPLACE),lr.disabled,Ni.disabled,Fh(O.projMatrix),"$clipping",j,Y,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,p=this.context.gl;return new $i({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const p=this.context.gl;return new $i({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(c){const p=this.context.gl,b=c.sort((P,O)=>O.overscaledZ-P.overscaledZ),A=b[b.length-1].overscaledZ,C=b[0].overscaledZ-A+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const P={};for(let O=0;O<C;O++)P[O+A]=new $i({func:p.GEQUAL,mask:255},O+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=C,[P,b]}return[{[A]:$i.disabled},b]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new lr([c.CONSTANT_COLOR,c.ONE,c.CONSTANT_COLOR,c.ONE],new a.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?lr.unblended:lr.alphaBlended}colorModeForDrapableLayerRenderPass(c){const p=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new lr([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.CONSTANT_ALPHA,p.ONE_MINUS_SRC_ALPHA],new a.ao(0,0,0,c===void 0?0:c),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(c,p,b,A=!1){if(this.depthOcclusion)return new fi(this.context.gl.GREATER,fi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!A)return fi.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new fi(b||this.context.gl.LEQUAL,p,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const c=this.context.gl,p=Math.ceil(this.width),b=Math.ceil(this.height),A=this.context.bindFramebuffer.get(),C=c.getParameter(c.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===p&&this.depthFBO.height===b||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),p!==0&&b!==0&&(this.depthFBO=new g_(this.context,p,b,!1,"texture"),this.depthTexture=new a.T(this.context,{width:p,height:b,data:null},c.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(A),c.bindTexture(c.TEXTURE_2D,C),this.depthFBO&&(c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.bindFramebuffer(c.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),c.blitFramebuffer(0,0,p,b,0,0,p,b,c.DEPTH_BUFFER_BIT,c.NEAREST),c.bindFramebuffer(c.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((c,p)=>c+p/this._fpsHistory.length,0))}render(c,p){const b=a.o.now();this._dt=b-this._timeStamp,this._timeStamp=b,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=c.map.repaint,this.style=c,this.options=p;const A=this.style._mergedLayers,C=!(!this.terrain||!this.terrain.enabled),P=()=>this.style._getOrder(C).filter(Jt=>{const Ut=A[Jt];return!(Ut.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ut.type]});let O=P(),B=!1,G=!1,j=null;for(const Jt of O){const Ut=A[Jt];Ut.type==="circle"?B=!0:Ut.type==="building"?j=Ut:Ut.type==="symbol"&&(Ut.hasOcclusionOpacityProperties?G=!0:B=!0)}let Y=O.map(Jt=>A[Jt]);const W=this.style._mergedSourceCaches;this.imageManager=c.imageManager,this.modelManager=c.modelManager,this.symbolFadeChange=c.placement.symbolFadeChange(a.o.now()),this.imageManager.beginFrame();let J=0,tt=!1;for(const Jt in W){const Ut=W[Jt];Ut.used&&(Ut.prepare(this.context),Ut.getSource().usedInConflation&&++J)}let nt=!1;for(const Jt of Y)Jt.isHidden(this.transform.zoom)||(Jt.type==="clip"&&(nt=!0),this.prepareLayer(Jt));const ut={},st={},pt={},xt={},vt={};for(const Jt in W){const Ut=W[Jt];ut[Jt]=Ut.getVisibleCoordinates(),st[Jt]=ut[Jt].slice().reverse(),pt[Jt]=Ut.getVisibleCoordinates(!0).reverse(),xt[Jt]=Ut.getShadowCasterCoordinates(),vt[Jt]=Ut.sortCoordinatesByDistance(ut[Jt])}const Et=Jt=>{const Ut=this.style.getLayerSourceCache(Jt);return Ut&&Ut.used?Ut.getSource():null};if(J||nt||this._clippingActiveLastFrame){const Jt=[],Ut=[];let de=0;for(const ee of Y)this.isSourceForClippingOrConflation(ee,Et(ee))&&(Jt.push(ee),Ut.push(de)),de++;if(Jt&&(nt||Jt.length>1)||this._clippingActiveLastFrame){nt=!1;const ee=[];for(let Ae=0;Ae<Jt.length;Ae++){const Ue=Jt[Ae],ci=Ut[Ae],Le=this.style.getLayerSourceCache(Ue);if(!Le||!Le.used||!Le.getSource().usedInConflation&&Ue.type!=="clip"&&Ue.type!=="building")continue;let Be=a.eP,hi=a.bZ.None;const ni=[];let ii=!0;if(Ue.type==="building")Be=a.eR;else if(Ue.type==="clip"){Be=ci;for(const ai of Ue.layout.get("clip-layer-types"))hi|=ai==="model"?a.bZ.Model:ai==="symbol"?a.bZ.Symbol:a.bZ.FillExtrusion;for(const ai of Ue.layout.get("clip-layer-scope"))ni.push(ai);Ue.isHidden(this.transform.zoom)?ii=!1:nt=!0}ii&&ee.push({layer:Ue.fqid,cache:Le,order:Be,clipMask:hi,clipScope:ni})}this.replacementSource.setSources(ee),tt=!0}}this._clippingActiveLastFrame=nt,tt||this.replacementSource.clear(),this.conflationActive=tt,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Jt=0;Jt<Y.length;Jt++){const Ut=Y[Jt],de=Ut.cutoffRange();if(this.longestCutoffRange=Math.max(de,this.longestCutoffRange),de>0){const ee=Et(Ut);ee&&(this.minCutoffZoom=Math.max(ee.minzoom,this.minCutoffZoom)),Ut.minzoom&&(this.minCutoffZoom=Math.max(Ut.minzoom,this.minCutoffZoom))}Ut.is3D(C)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Jt),this._lastOcclusionLayer=Jt)}const bt=this.style&&this.style.fog;bt?(this._fogVisible=bt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=bt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pt),this.opaquePassCutoff=0,O=P(),Y=O.map(Jt=>A[Jt]));const Pt=this._shadowRenderer;if(Pt){Pt.updateShadowParameters(this.transform,this.style.directionalLight);for(const Jt in W)for(const Ut of ut[Jt]){let de={min:0,max:0};this.terrain&&(de=this.terrain.getMinMaxForTile(Ut)||de),Pt.addShadowReceiver(Ut.toUnwrapped(),de.min,de.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Yn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Mt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Tt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Mt&&!this._snow&&(this._snow=new Qx(this)),!Mt&&this._snow&&(this._snow.destroy(),delete this._snow),Tt&&!this._rain&&(this._rain=new yf(this)),!Tt&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),j){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Yt);const Jt=this.style.getLayerSourceCache(j);this.buildingTileBorderManager.updateBorders(Jt,j)}if(!zt.has(this.context.gl))return;this.renderPass="offscreen";for(const Jt of Y){const Ut=c.getLayerSourceCache(Jt);if(!Jt.hasOffscreenPass()||Jt.isHidden(this.transform.zoom))continue;const de=Ut?st[Ut.id]:void 0;(Jt.type==="custom"||Jt.type==="raster"||Jt.type==="raster-particle"||Jt.isSky()||de&&de.length)&&this.renderLayer(this,Ut,Jt,de)}this.depthRangeFor3D=[0,1-(Y.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,xt)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Lt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),qt=(()=>{if(p.showOverdrawInspector)return a.ao.black;const Jt=this.style.fog;if(Jt&&this.transform.projection.supportsFog){const Ut=this.style.getLut(Jt.scope);if(!Lt){const de=Jt.properties.get("color-use-theme")==="none",ee=Jt.properties.get("color").toNonPremultipliedRenderColor(de?null:Ut).toArray01();return new a.ao(...ee)}if(Lt){const de=Jt.properties.get("space-color-use-theme")==="none",ee=Jt.properties.get("space-color").toNonPremultipliedRenderColor(de?null:Ut).toArray01();return new a.ao(...ee)}}return a.ao.transparent})();if(this.context.clear({color:qt,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Lt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=O.length-1;this.currentLayer>=0;this.currentLayer--){const Jt=Y[this.currentLayer],Ut=c.getLayerSourceCache(Jt);if(Jt.isSky())continue;const de=Ut?(Jt.is3D(C)?vt:st)[Ut.id]:void 0;this._renderTileClippingMasks(Jt,Ut,de),this.renderLayer(this,Ut,Jt,de)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Lt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<O.length;this.currentLayer++){const Jt=Y[this.currentLayer],Ut=c.getLayerSourceCache(Jt);Jt.isSky()&&this.renderLayer(this,Ut,Jt,Ut?st[Ut.id]:void 0)}function jt(Jt,Ut){let de;return Ut&&(de=(Jt.type==="symbol"?pt:Jt.is3D(C)?vt:st)[Ut.id]),de}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<O.length;){const Jt=Y[this.currentLayer];if(Jt.type==="raster"||Jt.type==="raster-particle"){const Ut=c.getLayerSourceCache(Jt);this.renderLayer(this,Ut,Jt,jt(Jt,Ut))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let oe=0;Pt&&(oe=Pt.getShadowCastingLayerCount());let te=!1,he=-1;for(let Jt=0;Jt<O.length;++Jt){const Ut=Y[Jt];Ut.isHidden(this.transform.zoom)||Ut.is3D(C)&&(he=Jt)}G&&he===-1&&(B=!0);let Oe=!1;for(;this.currentLayer<O.length;){const Jt=Y[this.currentLayer],Ut=c.getLayerSourceCache(Jt);if(Jt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Jt)){if(Jt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Oe&&Jt.is3D(C)&&!C){const de=this.currentLayer,ee=Ae=>{for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const Ue=Y[this.currentLayer];if(I_[Ue.type]){const ci=this.style.getLayerSourceCache(Ue);I_[Ue.type](this,ci,Ue,jt(Ue,ci),Ae)}}};ee("initialize"),ee("reset"),this.currentLayer=de,Oe=!0}if(B&&!te&&this.terrain&&!this.transform.isOrthographic&&(te=!0,this.blitDepth()),G&&he!==-1&&this.currentLayer===he+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Jt,Ut,Ut?ut[Ut.id]:void 0),this.renderLayer(this,Ut,Jt,jt(Jt,Ut)),!this.terrain&&Pt&&oe>0&&Jt.hasShadowPass()&&--oe==0){{this.clearStencil(),this.resetStencilClippingMasks();const de=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const ee=Y[this.currentLayer];if(qs[ee.type]){const Ae=this.style.getLayerSourceCache(ee);qs[ee.type](this,Ae,ee,jt(ee,Ae))}}this.currentLayer=de}if(Pt.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const de=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=de;this.currentLayer++){const ee=Y[this.currentLayer];if(!ee.hasLightBeamPass())continue;const Ae=c.getLayerSourceCache(ee);this.renderLayer(this,Ae,ee,Ae?st[Ae.id]:void 0)}this.currentLayer=de,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const de=this.currentLayer;this.depthOcclusion=!0;for(const ee of this.layersWithOcclusionOpacity){this.currentLayer=ee;const Ae=Y[this.currentLayer],Ue=c.getLayerSourceCache(Ae),ci=Ue?st[Ue.id]:void 0;this.terrain||this._renderTileClippingMasks(Ae,Ue,Ue?ut[Ue.id]:void 0),this.renderLayer(this,Ue,Ae,ci)}this.depthOcclusion=!1,this.currentLayer=de,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Jt=null;Y.forEach(Ut=>{const de=c.getLayerSourceCache(Ut);de&&!Ut.isHidden(this.transform.zoom)&&de.getVisibleCoordinates().length&&(!Jt||Jt.getSource().maxzoom<de.getSource().maxzoom)&&(Jt=de)}),Jt&&this.options.showTileBoundaries&&Zx(this,Jt,Jt.getVisibleCoordinates(),a.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Zx(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Jt){const Ut=Jt.transform.padding;xn(Jt,Jt.transform.height-(Ut.top||0),3,Lu),xn(Jt,Ut.bottom||0,3,AT),Cg(Jt,Ut.left||0,3,jx),Cg(Jt,Jt.transform.width-(Ut.right||0),3,Wx);const de=Jt.transform.centerPoint;(function(ee,Ae,Ue,ci){ff(ee,Ae-1,Ue-10,2,20,ci),ff(ee,Ae-10,Ue-1,20,2,ci)})(Jt,de.x,Jt.transform.height-de.y,$x)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),tt||(this.conflationActive=!1)}prepareLayer(c){this.gpuTimingStart(c);const{unsupportedLayers:p}=this.transform.projection,b=!p||!p.includes(c.type);if(A_[c.type]&&(b||this.terrain&&c.type==="custom")){const A=this.style.getLayerSourceCache(c);A_[c.type](c,A,this)}this.gpuTimingEnd()}renderLayer(c,p,b,A){b.isHidden(this.transform.zoom)||(b.type==="background"||b.type==="sky"||b.type==="custom"||b.type==="model"||b.type==="raster"||b.type==="raster-particle"||A&&A.length)&&(this.id=b.id,this.gpuTimingStart(b),c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes(b.type)&&(!c.terrain||b.type!=="custom")||b.type==="clip"||t1[b.type](c,p,b,A,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery,b=this.context.gl;let A=this.gpuTimers[c.id];A||(A=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:b.createQuery()}),A.calls++,b.beginQuery(p.TIME_ELAPSED_EXT,A.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,p=this.context.gl,b=p.createQuery();this.deferredRenderGpuTimeQueries.push(b),p.beginQuery(c.TIME_ELAPSED_EXT,b)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const p={};for(const b in c){const A=c[b],C=this.context.extTimerQuery,P=C.getQueryParameter(A.query,this.context.gl.QUERY_RESULT)/1e6;C.deleteQueryEXT(A.query),p[b]=P}return p}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.gl;let b=0;for(const A of c)b+=p.getQueryParameter(A,p.QUERY_RESULT)/1e6,p.deleteQuery(A);return b}translatePosMatrix(c,p,b,A,C){if(!b[0]&&!b[1])return c;const P=C?A==="map"?this.transform.angle:0:A==="viewport"?-this.transform.angle:0;if(P){const G=Math.sin(P),j=Math.cos(P);b=[b[0]*j-b[1]*G,b[0]*G+b[1]*j]}const O=[C?b[0]:a.ay(p,b[0],this.transform.zoom),C?b[1]:a.ay(p,b[1],this.transform.zoom),0],B=new Float32Array(16);return a.bq(B,c,O),B}saveTileTexture(c){if(c.context!==this.context)return;const p=c.size[0],b=this._tileTextures[p];b?b.push(c):this._tileTextures[p]=[c]}getTileTexture(c){const p=this._tileTextures[c];return p&&p.length>0?p.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(c,p,b){const A=b===void 0?this.terrain&&this.terrain.renderingToTexture:b,C=[];return this.style&&this.style.enable3dLights()&&(c==="globeRaster"||c==="terrainRaster"?(C.push("LIGHTING_3D_MODE"),C.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):A||C.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||C.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(C.push("TERRAIN"),this.linearFloatFilteringSupported()&&C.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&C.push("GLOBE"),!this._fogVisible||A||p!==void 0&&!p||C.push("FOG","FOG_DITHERING"),A&&C.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&C.push("OVERDRAW_INSPECTOR"),C}getOrCreateProgram(c,p){this.cache=this.cache||{};const b=p&&p.defines||[],A=p&&p.config,C=this.currentGlobalDefines(c,p&&p.overrideFog,p&&p.overrideRtt).concat(b),P=Tg.cacheKey(qv[c],c,C,A);return this.cache[P]||(this.cache[P]=new Tg(this.context,c,qv[c],A,iD[c],C)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(c,p){if(this.style.enable3dLights()){const b=this.style.directionalLight,A=this.style.ambientLight;if(b&&A){const C=((P,O,B)=>{const G=P.properties.get("direction"),j=P.properties.get("color-use-theme")==="none",Y=P.properties.get("color").toNonPremultipliedRenderColor(j?null:B.getLut(P.scope)).toArray01(),W=P.properties.get("intensity"),J=O.properties.get("color-use-theme")==="none",tt=O.properties.get("color").toNonPremultipliedRenderColor(J?null:B.getLut(O.scope)).toArray01(),nt=O.properties.get("intensity"),ut=[G.x,G.y,G.z],st=a.dM(tt,nt),pt=a.dM(Y,W);return{u_lighting_ambient_color:st,u_lighting_directional_dir:ut,u_lighting_directional_color:pt,u_ground_radiance:Cx(ut,pt,st)}})(b,A,this.style);p.setLightsUniformValues(c,C)}}}uploadCommonUniforms(c,p,b,A,C){if(this.uploadCommonLightUniforms(c,p),this.terrain&&this.terrain.renderingToTexture)return;const P=this.style.fog;if(P){const O=P.getOpacity(this.transform.pitch),B=((G,j,Y,W,J,tt,nt,ut,st,pt,xt,vt)=>{const Et=G.transform,bt=j.properties.get("color-use-theme")==="none",Pt=j.properties.get("color").toNonPremultipliedRenderColor(bt?null:G.style.getLut(j.scope)).toArray01();Pt[3]=W;const Mt=G.frameCounter/1e3%1,[Tt,Lt]=j.properties.get("vertical-range");return{u_fog_matrix:Y?Et.calculateFogTileMatrix(Y):vt||G.identityMat,u_fog_range:j.getFovAdjustedRange(Et._fov),u_fog_color:Pt,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Tt,Lt),Lt],u_fog_temporal_offset:Mt,u_frustum_tl:J,u_frustum_tr:tt,u_frustum_br:nt,u_frustum_bl:ut,u_globe_pos:st,u_globe_radius:pt,u_viewport:xt,u_globe_transition:a.aj(Et.zoom),u_is_globe:+(Et.projection.name==="globe")}})(this,P,b,O,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.o.devicePixelRatio,this.transform.height*a.o.devicePixelRatio],A);p.setFogUniformValues(c,B)}C&&p.setCutoffUniformValues(c,C.uniformValues)}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,p=c.createTexture();return c.bindTexture(c.TEXTURE_2D,p),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,p=this._backgroundTiles={},b=this.transform.coveringTiles({tileSize:512});for(const A of b)p[A.key]=c[A.key]||new sc(A,512,this.transform.tileZoom,this,void 0,this.worldview);return p}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(c,p){return!(!c.is3D(!(!this.terrain||!this.terrain.enabled))||c.type!=="clip"&&c.type!=="building"&&(c.minzoom&&c.minzoom>this.transform.zoom||(this.style._clipLayerPresent||c.sourceLayer!=="building"&&c.sourceLayer!=="procedural_buildings")&&(!p||p.type!=="batched-model")))}isTileAffectedByFog(c){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let p=this._cachedTileFogOpacities[c.key];return p||(this._cachedTileFogOpacities[c.key]=p=this.style.fog.getOpacityForTile(c)),p[0]>=ie||p[1]>=ie}setupDepthForOcclusion(c,p,b){const A=this.context,C=A.gl,P=!!b;var O;b||(b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),A.activeTexture.set(C.TEXTURE3),c&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),b.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],b.u_depth_range_unpack=[2/((O=this.depthRangeFor3D)[1]-O[0]),-1-2*O[0]/(O[1]-O[0])],b.u_occluder_half_size=.5*this.occlusionParams.occluderSize,b.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),A.activeTexture.set(C.TEXTURE0),P||p.setTerrainUniformValues(A,b)}}function jh(x,c){let p=!1,b=null;const A=()=>{b=null,p&&(x(),b=setTimeout(A,c),p=!1)};return()=>(p=!0,b||A(),b)}class M_{constructor(c){this._hashName=c&&encodeURIComponent(c),a.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=jh(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const p=C_(c);if(this._hashName){const b=this._hashName;let A=!1;const C=location.hash.slice(1).split("&").map(P=>{const O=P.split("=")[0];return O===b?(A=!0,`${O}=${p}`):P}).filter(P=>P);return A||C.push(`${b}=${p}`),`#${C.join("&")}`}return`#${p}`}_getCurrentHash(){const c=location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(p=b)}),(p&&p[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(b=>isNaN(Number(b)))){const b=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(p[3]||0):c.getBearing();return c.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:b,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function C_(x,c){const p=x.getCenter(),b=Math.round(100*x.getZoom())/100,A=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,A),P=Math.round(p.lng*C)/C,O=Math.round(p.lat*C)/C,B=x.getBearing(),G=x.getPitch();let j=c?`/${P}/${O}/${b}`:`${b}/${O}/${P}`;return(B||G)&&(j+="/"+Math.round(10*B)/10),G&&(j+=`/${Math.round(G)}`),j}const xf={linearity:.3,easing:a.eS(0,0,.3,1)},ku=Object.assign({deceleration:2500,maxSpeed:1400},xf),e1=Object.assign({deceleration:20,maxSpeed:1400},xf),Al=Object.assign({deceleration:1e3,maxSpeed:360},xf),i1=Object.assign({deceleration:1e3,maxSpeed:90},xf);class E_{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.o.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,p=a.o.now();for(;c.length>0&&p-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const p={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)p.zoom+=C.zoomDelta||0,p.bearing+=C.bearingDelta||0,p.pitch+=C.pitchDelta||0,C.panDelta&&p.pan._add(C.panDelta),C.around&&(p.around=C.around),C.pinchAround&&(p.pinchAround=C.pinchAround);const b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(p.pan.mag()){const C=wf(p.pan.mag(),b,Object.assign({},ku,c||{}));A.offset=p.pan.mult(C.amount/p.pan.mag()),A.center=this._map.transform.center,bf(A,C)}if(p.zoom){const C=wf(p.zoom,b,e1);A.zoom=this._map.transform.zoom+C.amount,bf(A,C)}if(p.bearing){const C=wf(p.bearing,b,Al);A.bearing=this._map.transform.bearing+a.aA(C.amount,-179,179),bf(A,C)}if(p.pitch){const C=wf(p.pitch,b,i1);A.pitch=this._map.transform.pitch+C.amount,bf(A,C)}if(A.zoom||A.bearing){const C=p.pinchAround===void 0?p.around:p.pinchAround;A.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),A.noMoveStart=!0,A}}function bf(x,c){(!x.duration||x.duration<c.duration)&&(x.duration=c.duration,x.easing=c.easing)}function wf(x,c,p){const{maxSpeed:b,linearity:A,deceleration:C}=p,P=a.aA(x*A/(c/1e3),-b,b),O=Math.abs(P)/(C*A);return{easing:p.easing,duration:1e3*O,amount:P*(O/2)}}class Pn extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,b,A={}){const C=et(p.getCanvasContainer(),b),P=p.unproject(C);super(c,Object.assign({point:C,lngLat:P,originalEvent:b},A)),this._defaultPrevented=!1,this.target=p}}class Sf extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p,b){const A=c==="touchend"?b.changedTouches:b.touches,C=rt(p.getCanvasContainer(),A),P=C.map(B=>p.unproject(B)),O=C.reduce((B,G,j,Y)=>B.add(G.div(Y.length)),new a.P(0,0));super(c,{points:C,point:O,lngLats:P,lngLat:p.unproject(O),originalEvent:b}),this._defaultPrevented=!1}}class r1 extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,p){super("wheel",{originalEvent:p}),this._defaultPrevented=!1}}class n1{constructor(c,p){this._map=c,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new r1(this._map,c))}mousedown(c,p){return this._mousedownPos=p,this._firePreventable(new Pn(c.type,this._map,c))}mouseup(c){this._map.fire(new Pn(c.type,this._map,c))}preclick(c){const p=new MouseEvent("preclick",c);this._map.fire(new Pn(p.type,this._map,p))}click(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Pn(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Pn(c.type,this._map,c))}mouseover(c){this._map.fire(new Pn(c.type,this._map,c))}mouseout(c){this._map.fire(new Pn(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Sf(c.type,this._map,c))}touchmove(c){this._map.fire(new Sf(c.type,this._map,c))}touchend(c){this._map.fire(new Sf(c.type,this._map,c))}touchcancel(c){this._map.fire(new Sf(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Pn(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Pn(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class a1{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,p){this.isEnabled()&&c.shiftKey&&c.button===0&&(H(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(c,p){if(!this._active)return;const b=p,A=this._startPos,C=this._lastPos;if(!A||!C||C.equals(b)||!this._box&&b.dist(A)<this._clickTolerance)return;this._lastPos=b,this._box||(this._box=E("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const P=Math.min(A.x,b.x),O=Math.max(A.x,b.x),B=Math.min(A.y,b.y),G=Math.max(A.y,b.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${P}px,${B}px)`,this._box.style.width=O-P+"px",this._box.style.height=G-B+"px")})}mouseupWindow(c,p){if(!this._active)return;const b=this._startPos,A=p;if(b&&c.button===0){if(this.reset(),K(),b.x!==A.x||b.y!==A.y)return this._map.fire(new a.z("boxzoomend",{originalEvent:c})),{cameraAnimation:C=>C.fitScreenCoordinates(b,A,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$(),delete this._startPos,delete this._lastPos}_fireEvent(c,p){return this._map.fire(new a.z(c,{originalEvent:p}))}}function Pg(x,c){const p={};for(let b=0;b<x.length;b++)p[x[b].identifier]=c[b];return p}class o1{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,p,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),b.length===this.numTouches&&(this.centroid=function(A){const C=new a.P(0,0);for(const P of A)C._add(P);return C.div(A.length)}(p),this.touches=Pg(b,p)))}touchmove(c,p,b){if(this.aborted||!this.centroid)return;const A=Pg(b,p);for(const C in this.touches){const P=A[C];(!P||P.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(c,p,b){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),b.length===0){const A=!this.aborted&&this.centroid;if(this.reset(),A)return A}}}class Ou{constructor(c){this.singleTap=new o1(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,p,b){this.singleTap.touchstart(c,p,b)}touchmove(c,p,b){this.singleTap.touchmove(c,p,b)}touchend(c,p,b){const A=this.singleTap.touchend(c,p,b);if(A){const C=c.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(A)<30;if(C&&P||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=A,this.count===this.numTaps)return this.reset(),A}}}class s1{constructor(){this._zoomIn=new Ou({numTouches:1,numTaps:2}),this._zoomOut=new Ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,p,b){this._zoomIn.touchstart(c,p,b),this._zoomOut.touchstart(c,p,b)}touchmove(c,p,b){this._zoomIn.touchmove(c,p,b),this._zoomOut.touchmove(c,p,b)}touchend(c,p,b){const A=this._zoomIn.touchend(c,p,b),C=this._zoomOut.touchend(c,p,b);return A?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(A)},{originalEvent:c})}):C?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const D_={0:1,2:2},P_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Tf{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,p){return!1}_move(c,p){return{}}mousedown(c,p){if(this._lastPoint)return;const b=lt(c);this._correctButton(c,b)&&(this._lastPoint=p,this._eventButton=b)}mousemoveWindow(c,p){const b=this._lastPoint;if(b){if(c.preventDefault(),this._eventButton!=null&&function(A,C){const P=D_[C];return A.buttons===void 0||(A.buttons&P)!==P}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(b,p)}}mouseupWindow(c){this._lastPoint&&lt(c)===this._eventButton&&(this._moved&&K(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class l1 extends Tf{mousedown(c,p){super.mousedown(c,p),this._lastPoint&&(this._active=!0)}_correctButton(c,p){return p===0&&!c.ctrlKey}_move(c,p){return{around:p,panDelta:p.sub(c)}}}class L_ extends Tf{constructor(c){super(c),this._pitchRotateKey=c.pitchRotateKey?P_[c.pitchRotateKey]:void 0}_correctButton(c,p){return this._pitchRotateKey?p===0&&c[this._pitchRotateKey]:p===0&&c.ctrlKey||p===2}_move(c,p){const b=.8*(p.x-c.x);if(b)return this._active=!0,{bearingDelta:b}}contextmenu(c){this._pitchRotateKey||c.preventDefault()}}class c1 extends Tf{constructor(c){super(c),this._pitchRotateKey=c.pitchRotateKey?P_[c.pitchRotateKey]:void 0}_correctButton(c,p){return this._pitchRotateKey?p===0&&c[this._pitchRotateKey]:p===0&&c.ctrlKey||p===2}_move(c,p){const b=-.5*(p.y-c.y);if(b)return this._active=!0,{pitchDelta:b}}contextmenu(c){this._pitchRotateKey||c.preventDefault()}}class kT{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),a.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(c,p,b){return this._calculateTransform(c,p,b)}touchmove(c,p,b){if(this._active&&!(b.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(b.length===1&&!a.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,p,b)}}touchend(c,p,b){this._calculateTransform(c,p,b),this._active&&b.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,p,b){b.length>0&&(this._active=!0);const A=Pg(b,p),C=new a.P(0,0),P=new a.P(0,0);let O=0;for(const G in A){const j=A[G],Y=this._touches[G];Y&&(C._add(j),P._add(j.sub(Y)),O++,A[G]=j)}if(this._touches=A,O<this._minTouches||!P.mag())return;const B=P.div(O);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(O),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=E("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class R_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,p,b){return{}}touchstart(c,p,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([p[0],p[1]]))}touchmove(c,p,b){const A=this._firstTwoTouches;if(!A)return;c.preventDefault();const[C,P]=A,O=Lg(b,p,C),B=Lg(b,p,P);if(!O||!B)return;const G=this._aroundCenter?null:O.add(B).div(2);return this._move([O,B],G,c)}touchend(c,p,b){if(!this._firstTwoTouches)return;const[A,C]=this._firstTwoTouches,P=Lg(b,p,A),O=Lg(b,p,C);P&&O||(this._active&&K(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Lg(x,c,p){for(let b=0;b<x.length;b++)if(x[b].identifier===p)return c[b]}function u1(x,c){return Math.log2(x/c)}class OT extends R_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,p){const b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(u1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:u1(this._distance,b),pinchAround:p}}}function h1(x,c){return 180*x.angleWith(c)/Math.PI}class zT extends R_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,p){const b=this._vector;if(this._vector=c[0].sub(c[1]),b&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:h1(this._vector,b),pinchAround:p}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const p=25/(Math.PI*this._minDiameter)*360,b=this._startVector;if(!b)return!1;const A=h1(c,b);return Math.abs(A)<p}}function k_(x){return Math.abs(x.y)>Math.abs(x.x)}class BT extends R_{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,k_(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,p,b){const A=this._lastPoints;if(!A)return;const C=c[0].sub(A[0]),P=c[1].sub(A[1]);return this._map._cooperativeGestures&&!a.eT()&&b.touches.length<3||(this._valid=this.gestureBeginsVertically(C,P,b.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+P.y)/2*-.5})}gestureBeginsVertically(c,p,b){if(this._valid!==void 0)return this._valid;const A=c.mag()>=2,C=p.mag()>=2;if(!A&&!C)return;if(!A||!C)return this._firstMove==null&&(this._firstMove=b),b-this._firstMove<100&&void 0;const P=c.y>0==p.y>0;return k_(c)&&k_(p)&&P}}const FT={panStep:100,bearingStep:15,pitchStep:10};class NT{constructor(){const c=FT;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let p=0,b=0,A=0,C=0,P=0;switch(c.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:c.shiftKey?b=-1:(c.preventDefault(),C=-1);break;case 39:c.shiftKey?b=1:(c.preventDefault(),C=1);break;case 38:c.shiftKey?A=1:(c.preventDefault(),P=-1);break;case 40:c.shiftKey?A=-1:(c.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(b=0,A=0),{cameraAnimation:O=>{const B=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:VT,zoom:p?Math.round(B)+p*(c.shiftKey?2:1):B,bearing:O.getBearing()+b*this._bearingStep,pitch:O.getPitch()+A*this._pitchStep,offset:[-C*this._panStep,-P*this._panStep],center:O.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function VT(x){return x*(2-x)}const UT=4.000244140625,uD=1/450;class hD{constructor(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=uD,a.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||a.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const b=a.o.now(),A=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,p!==0&&p%UT==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":A>400?(this._type=null,this._lastValue=p,this._timeout=window.setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(A*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=et(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>UT?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&j!==0&&(j=1/j);const Y=p(),W=Math.pow(2,Y),J=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(J*j))),this._type==="wheel"&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const b=typeof this._targetZoom=="number"?this._targetZoom:p(),A=this._startZoom,C=this._easing;let P,O=!1;if(this._type==="wheel"&&A&&C){const G=Math.min((a.o.now()-this._lastWheelEventTime)/200,1),j=C(G);P=a.ak(A,b,j),G<1?this._frameId||(this._frameId=!0):O=!0}else P=b,O=!0;this._active=!0,O&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let B=P-p();return B*this._lastDelta<0&&(B=0),{noInertia:!0,needsRenderFrame:!O,zoomDelta:B,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let p=a.eU;if(this._prevEase){const b=this._prevEase,A=(a.o.now()-b.start)/b.duration,C=b.easing(A+.01)-b.easing(A),P=.27/Math.sqrt(C*C+1e-4)*.01,O=Math.sqrt(.0729-P*P);p=a.eS(P,O,.25,1)}return this._prevEase={start:a.o.now(),duration:c,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=E("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Vn{constructor(c,p){this._clickZoom=c,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class GT{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,p){return c.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:b.getZoom()+(c.shiftKey?-1:1),around:b.unproject(p)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dD{constructor(){this._tap=new Ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,p,b){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?b.length>0&&(this._swipePoint=p[0],this._swipeTouch=b[0].identifier):this._tap.touchstart(c,p,b))}touchmove(c,p,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;const A=p[0],C=A.y-this._swipePoint.y;return this._swipePoint=A,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,p,b)}touchend(c,p,b){this._tapTime?this._swipePoint&&b.length===0&&this.reset():this._tap.touchend(c,p,b)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fD{constructor(c,p,b){this._el=c,this._mousePan=p,this._touchPan=b}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pD{constructor(c,p,b){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rg{constructor(c,p,b,A){this._el=c,this._touchZoom=p,this._touchRotate=b,this._tapDragZoom=A,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kg=x=>x.zoom||x.drag||x.pitch||x.rotate;class d1 extends a.z{}class O_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,p){const b=a.av([],p,c);this.radius=a.ag(b[2]<0?a.eW([],b,this.constants):[b[0],b[1],0])}projectRay(c){a.eW(c,c,this.constants),a.aw(c,c),a.eX(c,c,this.constants);const p=a.c4([],c,this.radius);if(p[2]>0){const b=a.c4([],[0,0,1],a.bI(p,[0,0,1])),A=a.c4([],a.aw([],[p[0],p[1],0]),this.radius),C=a.d7([],p,a.c4([],a.av([],a.d7([],A,b),p),2));p[0]=C[0],p[1]=C[1]}return p}}function Il(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class z_{constructor(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new E_(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new O_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),a.aX(["handleEvent","handleWindowEvent"],this);const b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[window,"blur",void 0]];for(const[A,C,P]of this._listeners){const O=A===document?this.handleWindowEvent:this.handleEvent;A.addEventListener(C,O,P)}}destroy(){for(const[c,p,b]of this._listeners){const A=c===document?this.handleWindowEvent:this.handleEvent;c.removeEventListener(p,A,b)}}_addDefaultHandlers(c){const p=this._map,b=p.getCanvasContainer();this._add("mapEvent",new n1(p,c));const A=p.boxZoom=new a1(p,c);this._add("boxZoom",A);const C=new s1,P=new GT;p.doubleClickZoom=new Vn(P,C),this._add("tapZoom",C),this._add("clickZoom",P);const O=new dD;this._add("tapDragZoom",O);const B=p.touchPitch=new BT(p);this._add("touchPitch",B);const G=new L_(c),j=new c1(c);p.dragRotate=new pD(c,G,j),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const Y=new l1(c),W=new kT(p,c);p.dragPan=new fD(b,Y,W),this._add("mousePan",Y),this._add("touchPan",W,["touchZoom","touchRotate"]);const J=new zT,tt=new OT;p.touchZoomRotate=new Rg(b,tt,J,O),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",tt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wh(p));const nt=p.scrollZoom=new hD(p,this);this._add("scrollZoom",nt,["mousePan"]);const ut=p.keyboard=new NT;this._add("keyboard",ut);for(const st of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[st]&&p[st].enable(c[st])}_add(c,p,b){this._handlers.push({handlerName:c,handler:p,allowed:b}),this._handlersById[c]=p}stop(c){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,p,b){for(const A in c)if(A!==b&&(!p||p.indexOf(A)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const p=[];for(const b of c)this._el.contains(b.target)&&p.push(b);return p}handleEvent(c,p){this._updatingCamera=!0;const b=c.type==="renderFrame",A=b?void 0:c,C={needsRenderFrame:!1},P={},O={},B=c.touches?this._getMapTouches(c.touches):void 0,G=B?rt(this._el,B):b?void 0:et(this._el,c);for(const{handlerName:W,handler:J,allowed:tt}of this._handlers){if(!J.isEnabled())continue;let nt;this._blockedByActive(O,tt,W)?J.reset():J[p||c.type]&&(nt=J[p||c.type](c,G,B),this.mergeHandlerResult(C,P,nt,W,A),nt&&nt.needsRenderFrame&&this._triggerRenderFrame()),(nt||J.isActive())&&(O[W]=J)}const j={};for(const W in this._previousActiveHandlers)O[W]||(j[W]=A);this._previousActiveHandlers=O,(Object.keys(j).length||Il(C))&&(this._changes.push([C,P,j]),this._triggerRenderFrame()),(Object.keys(O).length||Il(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Y}=C;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))}mergeHandlerResult(c,p,b,A,C){if(!b)return;Object.assign(c,b);const P={handlerName:A,originalEvent:b.originalEvent||C};b.zoomDelta!==void 0&&(p.zoom=P),b.panDelta!==void 0&&(p.drag=P),b.pitchDelta!==void 0&&(p.pitch=P),b.bearingDelta!==void 0&&(p.rotate=P)}_applyChanges(){const c={},p={},b={};for(const[A,C,P]of this._changes)A.panDelta&&(c.panDelta=(c.panDelta||new a.P(0,0))._add(A.panDelta)),A.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(c.around=A.around),A.aroundCoord!==void 0&&(c.aroundCoord=A.aroundCoord),A.pinchAround!==void 0&&(c.pinchAround=A.pinchAround),A.noInertia&&(c.noInertia=A.noInertia),Object.assign(p,C),Object.assign(b,P);this._updateMapTransform(c,p,b),this._changes=[]}_updateMapTransform(c,p,b){const A=this._map,C=A.transform,P=pt=>[pt.x,pt.y,pt.z];if((pt=>{const xt=this._eventsInProgress.drag;return xt&&!this._handlersById[xt.handlerName].isActive()})()&&!Il(c)){const pt=C.zoom;C.cameraElevationReference="sea",this._originalZoom!=null&&C._orthographicProjectionAtLowPitch&&C.projection.name!=="globe"&&C.pitch===0?(C.cameraElevationReference="ground",C.zoom=this._originalZoom):(C.recenterOnTerrain(),C.cameraElevationReference="ground"),pt!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&A._stop(!0),!Il(c))return void this._fireEvents(p,b,!0);let{panDelta:O,zoomDelta:B,bearingDelta:G,pitchDelta:j,around:Y,aroundCoord:W,pinchAround:J}=c;C._isCameraConstrained&&(B>0&&(B=0),C._isCameraConstrained=!1),J!==void 0&&(Y=J),(B||(pt=>p[pt]&&!this._eventsInProgress[pt])("drag"))&&Y&&(this._dragOrigin=P(C.pointCoordinate3D(Y)),this._originalZoom=C.zoom,this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",A._stop(!0),Y=Y||A.transform.centerPoint,G&&(C.bearing+=G),j&&(C.pitch+=j),C._updateCameraState();const tt=[0,0,0];if(O)if(C.projection.name==="mercator"){const pt=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(Y).dir),xt=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(Y.sub(O)).dir);tt[0]=xt[0]-pt[0],tt[1]=xt[1]-pt[1]}else{const pt=C.pointCoordinate(Y);if(C.projection.name==="globe"){O=O.rotate(-C.angle);const xt=C._pixelsPerMercatorPixel/C.worldSize;tt[0]=-O.x*a.eV(a.a_(pt.y))*xt,tt[1]=-O.y*a.eV(C.center.lat)*xt}else{const xt=C.pointCoordinate(Y.sub(O));pt&&xt&&(tt[0]=xt.x-pt.x,tt[1]=xt.y-pt.y)}}const nt=C.zoom,ut=[0,0,0];if(B){const pt=P(W||C.pointCoordinate3D(Y)),xt={dir:a.aw([],a.av([],pt,C._camera.position))};if(xt.dir[2]<0){const vt=C.zoomDeltaToMovement(pt,B);a.c4(ut,xt.dir,vt)}}const st=a.d7(tt,tt,ut);C._translateCameraConstrained(st),B&&Math.abs(C.zoom-nt)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,b,!0)}_fireEvents(c,p,b){const A=kg(this._eventsInProgress),C=kg(c),P={};for(const j in c){const{originalEvent:Y}=c[j];this._eventsInProgress[j]||(P[`${j}start`]=Y),this._eventsInProgress[j]=c[j]}!A&&C&&this._fireEvent("movestart",C.originalEvent);for(const j in P)this._fireEvent(j,P[j]);C&&this._fireEvent("move",C.originalEvent);for(const j in c){const{originalEvent:Y}=c[j];this._fireEvent(j,Y)}const O={};let B;for(const j in this._eventsInProgress){const{handlerName:Y,originalEvent:W}=this._eventsInProgress[j];this._handlersById[Y].isActive()||(delete this._eventsInProgress[j],B=p[Y]||W,O[`${j}end`]=B)}for(const j in O)this._fireEvent(j,O[j]);const G=kg(this._eventsInProgress);if(b&&(A||C)&&!G){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;j?(Y(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:B})):(this._map.fire(new a.z("moveend",{originalEvent:B})),Y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,p){this._map.fire(new a.z(c,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new d1("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ma="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class dc extends a.E{constructor(c,p){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,this._respectPrefersReducedMotion=p.respectPrefersReducedMotion!==!1,a.aX(["_renderFrameCallback"],this)}getCenter(){return new a.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(c,p){return this.jumpTo({center:c},p)}panBy(c,p,b){return c=a.P.convert(c).mult(-1),this.panTo(this.transform.center,Object.assign({offset:c},p),b)}panTo(c,p,b){return this.easeTo(Object.assign({center:c},p),b)}getZoom(){return this.transform.zoom}setZoom(c,p){return this.jumpTo({zoom:c},p),this}zoomTo(c,p,b){return this.easeTo(Object.assign({zoom:c},p),b)}zoomIn(c,p){return this.zoomTo(this.getZoom()+1,c,p),this}zoomOut(c,p){return this.zoomTo(this.getZoom()-1,c,p),this}getBearing(){return this.transform.bearing}setBearing(c,p){return this.jumpTo({bearing:c},p),this}getPadding(){return this.transform.padding}setPadding(c,p){return this.jumpTo({padding:c},p),this}rotateTo(c,p,b){return this.easeTo(Object.assign({bearing:c},p),b)}resetNorth(c,p){return this.rotateTo(0,Object.assign({duration:1e3},c),p),this}resetNorthPitch(c,p){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},c),p),this}snapToNorth(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this}getPitch(){return this.transform.pitch}setPitch(c,p){return this.jumpTo({pitch:c},p),this}cameraForBounds(c,p){c=a.aI.convert(c);const b=p&&p.bearing||0,A=p&&p.pitch||0,C=c.getNorthWest(),P=c.getSouthEast();return this._cameraForBounds(this.transform,C,P,b,A,p)}_extendPadding(c){const p={top:0,right:0,bottom:0,left:0};return c==null?Object.assign({},p,this.transform.padding):typeof c=="number"?{top:c,bottom:c,right:c,left:c}:Object.assign({},p,c)}_extendCameraOptions(c){return(c=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=this._extendPadding(c.padding),c}_minimumAABBFrustumDistance(c,p){const b=p.max[0]-p.min[0],A=p.max[1]-p.min[1];return b/A>c.aspect?b/(2*Math.tan(.5*c.fovX)*c.aspect):A/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,p,b,A,C,P){const O=c.clone(),B=this._extendCameraOptions(P);O.bearing=A,O.pitch=C;const G=a.aS.convert(p),j=a.aS.convert(b),Y=.5*(G.lat+j.lat),W=.5*(G.lng+j.lng),J=a.eY(Y,W),tt=a.aw([],J),nt=a.aw([],a.bH([],tt,[0,1,0])),ut=a.bH([],nt,tt),st=[nt[0],nt[1],nt[2],0,ut[0],ut[1],ut[2],0,tt[0],tt[1],tt[2],0,0,0,0,1],pt=[J,a.eY(G.lat,G.lng),a.eY(j.lat,G.lng),a.eY(j.lat,j.lng),a.eY(G.lat,j.lng),a.eY(Y,G.lng),a.eY(Y,j.lng),a.eY(G.lat,W),a.eY(j.lat,W)];let xt=a.d8.fromPoints(pt.map(ee=>[a.bI(nt,ee),a.bI(ut,ee),a.bI(tt,ee)]));const vt=a.af([],xt.center,st);a.eZ(vt)===0&&a.e_(vt,0,0,1),a.aw(vt,vt),a.c4(vt,vt,a.aD),O.center=a.e$(vt);const Et=O.getWorldToCameraMatrix(),bt=a.bk(new Float64Array(16),Et);xt=a.d8.applyTransform(xt,a.aB([],Et,st));const Pt=this._extendAABB(xt,O,B,A);if(!Pt)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xt=Pt,a.af(vt,vt,Et);const Mt=.5*(xt.max[2]-xt.min[2]),Tt=this._minimumAABBFrustumDistance(O,xt),Lt=a.c4([],[0,0,1],Mt),qt=a.d7(Lt,vt,Lt),jt=Tt+(O.pitch===0?0:a.bF(vt,qt)),oe=O.globeCenterInViewSpace,te=a.av([],vt,[oe[0],oe[1],oe[2]]);a.aw(te,te),a.c4(te,te,jt);const he=a.d7([],vt,te);a.af(he,he,bt);const Oe=a.eL/a.aD,Jt=a.ag(he),Ut=a.ce(Math.max(Jt*Oe-a.eL,Number.EPSILON),0),de=Math.min(O.zoomFromMercatorZAdjusted(Ut),B.maxZoom);return de>.5*(a.cZ+a.cK)?(O.setProjection({name:"mercator"}),O.zoom=de,this._cameraForBounds(O,p,b,A,C,P)):{center:O.center,zoom:de,bearing:A,pitch:C}}_extendAABB(c,p,b,A){const C=.5*((b.padding.left||0)+(b.padding.right||0)),P=.5*((b.padding.top||0)+(b.padding.bottom||0)),O=P,B=C,G=C,j=P,Y=p.width-(B+G),W=p.height-(O+j),J=a.av([],c.max,c.min),tt=Math.min(Y/J[0],W/J[1]),nt=Math.min(p.scaleZoom(p.scale*tt),b.maxZoom);if(isNaN(nt))return null;const ut=p.scale/p.zoomScale(nt),st=new a.d8([c.min[0]-B*ut,c.min[1]-j*ut,c.min[2]],[c.max[0]+G*ut,c.max[1]+O*ut,c.max[2]]),pt=(typeof b.offset.x=="number"&&typeof b.offset.y=="number"?new a.P(b.offset.x,b.offset.y):a.P.convert(b.offset)).rotate(-a.an(A));return st.center[0]-=pt.x*ut,st.center[1]+=pt.y*ut,st}queryTerrainElevation(c,p){const b=this.transform.elevation;return b?(p=Object.assign({},{exaggerated:!0},p),b.getAtPoint(a.ae.fromLngLat(c),null,p.exaggerated)):null}_cameraForBounds(c,p,b,A,C,P){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,p,b,A,C,P);const O=c.clone(),B=this._extendCameraOptions(P);O.bearing=A,O.pitch=C;const G=a.aS.convert(p),j=a.aS.convert(b),Y=new a.aS(G.lng,j.lat),W=new a.aS(j.lng,G.lat),J=O.project(G),tt=O.project(j),nt=this.queryTerrainElevation(G),ut=this.queryTerrainElevation(j),st=this.queryTerrainElevation(Y),pt=this.queryTerrainElevation(W),xt=[[J.x,J.y,Math.min(nt||0,ut||0,st||0,pt||0)],[tt.x,tt.y,Math.max(nt||0,ut||0,st||0,pt||0)]];let vt=a.d8.fromPoints(xt);const Et=O.getWorldToCameraMatrix(),bt=a.bk(new Float64Array(16),Et);vt=a.d8.applyTransform(vt,Et);const Pt=this._extendAABB(vt,O,B,A);if(!Pt)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");vt=Pt;const Mt=.5*a.av([],vt.max,vt.min)[2],Tt=this._minimumAABBFrustumDistance(O,vt),Lt=[0,0,1,0];a.aC(Lt,Lt,Et),a.f0(Lt,Lt);const qt=a.c4([],Lt,Tt+Mt),jt=a.d7([],vt.center,qt);a.af(vt.center,vt.center,bt),a.af(jt,jt,bt);const oe=O.unproject(new a.P(vt.center[0],vt.center[1])),te=a.f1(O.projection,oe),he=Math.pow(2,te),Oe=Math.min(O._zoomFromMercatorZ(jt[2]*O.pixelsPerMeter*he/O.worldSize),B.maxZoom);return O.mercatorFromTransition&&Oe<.5*(a.cZ+a.cK)?(O.setProjection({name:"globe"}),O.zoom=Oe,this._cameraForBounds(O,p,b,A,C,P)):{center:oe,zoom:Oe,bearing:A,pitch:C}}fitBounds(c,p,b){const A=this.cameraForBounds(c,p);return this._fitInternal(A,p,b)}fitScreenCoordinates(c,p,b,A,C){const P=a.P.convert(c),O=a.P.convert(p),B=new a.P(Math.min(P.x,O.x),Math.min(P.y,O.y)),G=new a.P(Math.max(P.x,O.x),Math.max(P.y,O.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(P,O))return this;const j=this.transform.pointLocation3D(B),Y=this.transform.pointLocation3D(G),W=this.transform.pointLocation3D(new a.P(B.x,G.y)),J=this.transform.pointLocation3D(new a.P(G.x,B.y)),tt=[Math.min(j.lng,Y.lng,W.lng,J.lng),Math.min(j.lat,Y.lat,W.lat,J.lat)],nt=[Math.max(j.lng,Y.lng,W.lng,J.lng),Math.max(j.lat,Y.lat,W.lat,J.lat)],ut=A&&A.pitch?A.pitch:this.getPitch(),st=this._cameraForBounds(this.transform,tt,nt,b,ut,A);return this._fitInternal(st,A,C)}_fitInternal(c,p,b){return c?(p=Object.assign(c,p)).linear?this.easeTo(p,b):this.flyTo(p,b):this}jumpTo(c,p){this.stop();const b=c.preloadOnly?this.transform.clone():this.transform;let A=!1,C=!1,P=!1;"zoom"in c&&b.zoom!==+c.zoom&&(A=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=a.aS.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(C=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(P=!0,b.pitch=+c.pitch);const O=typeof c.padding=="number"?this._extendPadding(c.padding):c.padding;if(c.padding!=null&&!b.isPaddingEqual(O))if(c.retainPadding===!1){const B=b.clone();B.padding=O,b.setLocationAtPoint(b.center,B.centerPoint)}else b.padding=O;return c.preloadOnly?(this._preloadTiles(b),this):(this.fire(new a.z("movestart",p)).fire(new a.z("move",p)),A&&this.fire(new a.z("zoomstart",p)).fire(new a.z("zoom",p)).fire(new a.z("zoomend",p)),C&&this.fire(new a.z("rotatestart",p)).fire(new a.z("rotate",p)).fire(new a.z("rotateend",p)),P&&this.fire(new a.z("pitchstart",p)).fire(new a.z("pitch",p)).fire(new a.z("pitchend",p)),this.fire(new a.z("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(ma),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,p){const b=this.transform;if(!b.projection.supportsFreeCamera)return a.w(ma),this;this.stop();const A=b.zoom,C=b.pitch,P=b.bearing;b.setFreeCameraOptions(c);const O=A!==b.zoom,B=C!==b.pitch,G=P!==b.bearing;return this.fire(new a.z("movestart",p)).fire(new a.z("move",p)),O&&this.fire(new a.z("zoomstart",p)).fire(new a.z("zoom",p)).fire(new a.z("zoomend",p)),G&&this.fire(new a.z("rotatestart",p)).fire(new a.z("rotate",p)).fire(new a.z("rotateend",p)),B&&this.fire(new a.z("pitchstart",p)).fire(new a.z("pitch",p)).fire(new a.z("pitchend",p)),this.fire(new a.z("moveend",p)),this}easeTo(c,p){this._stop(!1,c.easeId),((c=Object.assign({offset:[0,0],duration:500,easing:a.eU},c)).animate===!1||this._prefersReducedMotion(c))&&(c.duration=0);const b=this.transform,A=this.getZoom(),C=this.getBearing(),P=this.getPitch(),O=this.getPadding(),B="zoom"in c?+c.zoom:A,G="bearing"in c?this._normalizeBearing(c.bearing,C):C,j="pitch"in c?+c.pitch:P,Y=this._extendPadding(c.padding),W=a.P.convert(c.offset);let J,tt,nt;if(b.projection.name==="globe"){const Lt=a.ae.fromLngLat(b.center),qt=W.rotate(-b.angle);Lt.x+=qt.x/b.worldSize,Lt.y+=qt.y/b.worldSize;const jt=Lt.toLngLat(),oe=a.aS.convert(c.center||jt);this._normalizeCenter(oe),J=b.centerPoint.add(qt),tt=new a.P(Lt.x,Lt.y).mult(b.worldSize),nt=new a.P(a.aF(oe.lng),a.aJ(oe.lat)).mult(b.worldSize).sub(tt)}else{J=b.centerPoint.add(W);const Lt=b.pointLocation(J),qt=a.aS.convert(c.center||Lt);this._normalizeCenter(qt),tt=b.project(Lt),nt=b.project(qt).sub(tt)}const ut=b.zoomScale(B-A);let st,pt;c.around&&(st=a.aS.convert(c.around),pt=b.locationPoint(st));const xt=this._zooming||B!==A,vt=this._rotating||C!==G,Et=this._pitching||j!==P,bt=!b.isPaddingEqual(Y),Pt=c.retainPadding===!1?b.clone():b,Mt=Lt=>qt=>{if(xt&&(Lt.zoom=a.ak(A,B,qt)),vt&&(Lt.bearing=a.ak(C,G,qt)),Et&&(Lt.pitch=a.ak(P,j,qt)),bt&&(Pt.interpolatePadding(O,Y,qt),J=Pt.centerPoint.add(W)),st)Lt.setLocationAtPoint(st,pt);else{const jt=Lt.zoomScale(Lt.zoom-A),oe=B>A?Math.min(2,ut):Math.max(.5,ut),te=Math.pow(oe,1-qt),he=Lt.unproject(tt.add(nt.mult(qt*te)).mult(jt));Lt.setLocationAtPoint(Lt.renderWorldCopies?he.wrap():he,J)}return c.preloadOnly||this._fireMoveEvents(p),Lt};if(c.preloadOnly){const Lt=this._emulate(Mt,c.duration,b);return this._preloadTiles(Lt),this}const Tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xt,this._rotating=vt,this._pitching=Et,this._padding=bt,this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,Tt),this._ease(Mt(b),Lt=>{b.cameraElevationReference==="sea"&&b.recenterOnTerrain(),this._afterEase(p,Lt)},c),this}_prepareEase(c,p,b={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),p||b.moving||this.fire(new a.z("movestart",c)),this._zooming&&!b.zooming&&this.fire(new a.z("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new a.z("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new a.z("pitchstart",c))}_fireMoveEvents(c){this.fire(new a.z("move",c)),this._zooming&&this.fire(new a.z("zoom",c)),this._rotating&&this.fire(new a.z("rotate",c)),this._pitching&&this.fire(new a.z("pitch",c))}_afterEase(c,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const b=this._zooming,A=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new a.z("zoomend",c)),A&&this.fire(new a.z("rotateend",c)),C&&this.fire(new a.z("pitchend",c)),this.fire(new a.z("moveend",c))}flyTo(c,p){if(this._prefersReducedMotion(c)){const ee=a.aH(c,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ee,p)}this.stop(),c=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:a.eU},c);const b=this.transform,A=this.getZoom(),C=this.getBearing(),P=this.getPitch(),O=this.getPadding(),B="zoom"in c?a.aA(+c.zoom,b.minZoom,b.maxZoom):A,G="bearing"in c?this._normalizeBearing(c.bearing,C):C,j="pitch"in c?+c.pitch:P,Y=this._extendPadding(c.padding),W=b.zoomScale(B-A),J=a.P.convert(c.offset);let tt=b.centerPoint.add(J);const nt=b.pointLocation(tt),ut=a.aS.convert(c.center||nt);this._normalizeCenter(ut);const st=b.project(nt),pt=b.project(ut).sub(st);let xt=c.curve;const vt=Math.max(b.width,b.height),Et=vt/W,bt=pt.mag();if("minZoom"in c){const ee=a.aA(Math.min(c.minZoom,A,B),b.minZoom,b.maxZoom),Ae=vt/b.zoomScale(ee-A);xt=Math.sqrt(Ae/bt*2)}const Pt=xt*xt;function Mt(ee){const Ae=(Et*Et-vt*vt+(ee?-1:1)*Pt*Pt*bt*bt)/(2*(ee?Et:vt)*Pt*bt);return Math.log(Math.sqrt(Ae*Ae+1)-Ae)}function Tt(ee){return(Math.exp(ee)-Math.exp(-ee))/2}function Lt(ee){return(Math.exp(ee)+Math.exp(-ee))/2}const qt=Mt(0);let jt=function(ee){return Lt(qt)/Lt(qt+xt*ee)},oe=function(ee){return vt*((Lt(qt)*(Tt(Ae=qt+xt*ee)/Lt(Ae))-Tt(qt))/Pt)/bt;var Ae},te=(Mt(1)-qt)/xt;if(Math.abs(bt)<1e-6||!isFinite(te)){if(Math.abs(vt-Et)<1e-6)return this.easeTo(c,p);const ee=Et<vt?-1:1;te=Math.abs(Math.log(Et/vt))/xt,oe=function(){return 0},jt=function(Ae){return Math.exp(ee*xt*Ae)}}c.duration="duration"in c?+c.duration:1e3*te/("screenSpeed"in c?+c.screenSpeed/xt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const he=C!==G,Oe=j!==P,Jt=!b.isPaddingEqual(Y),Ut=c.retainPadding===!1?b.clone():b,de=ee=>Ae=>{const Ue=Ae*te,ci=1/jt(Ue);ee.zoom=Ae===1?B:A+ee.scaleZoom(ci),he&&(ee.bearing=a.ak(C,G,Ae)),Oe&&(ee.pitch=a.ak(P,j,Ae)),Jt&&(Ut.interpolatePadding(O,Y,Ae),tt=Ut.centerPoint.add(J));const Le=Ae===1?ut:ee.unproject(st.add(pt.mult(oe(Ue))).mult(ci));return ee.setLocationAtPoint(ee.renderWorldCopies?Le.wrap():Le,tt),ee._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(p),ee};if(c.preloadOnly){const ee=this._emulate(de,c.duration,b);return this._preloadTiles(ee),this}return this._zooming=!0,this._rotating=he,this._pitching=Oe,this._padding=Jt,this._prepareEase(p,!1),this._ease(de(b),()=>this._afterEase(p),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(c){}_cancelRenderFrame(c){}_stop(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const b=this._onEaseEnd;this._onEaseEnd=void 0,b.call(this,p)}if(!c){const b=this.handlers;b&&b.stop(!1)}return this}_ease(c,p,b){b.animate===!1||b.duration===0?(c(1),p()):(this._easeStart=a.o.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((a.o.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,p){c=a.bS(c,-180,180);const b=Math.abs(c-p);return Math.abs(c-360-p)<b&&(c-=360),Math.abs(c+360-p)<b&&(c+=360),c}_normalizeCenter(c){const p=this.transform;if(p.maxBounds||p.projection.name!=="globe"&&!p.renderWorldCopies)return;const b=c.lng-p.center.lng;c.lng+=b>180?-360:b<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&a.o.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,p,b){const A=Math.ceil(15*p/1e3),C=[],P=c(b.clone());for(let O=0;O<=A;O++){const B=P(O/A);C.push(B.clone())}return C}_preloadTiles(c,p){}}class Af{constructor(c={}){this.options=c,a.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const p=this.options&&this.options.compact,b=c._getUIString("AttributionControl.ToggleAttribution");this._map=c,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=E("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",b);const A=E("span","mapboxgl-ctrl-icon",this._compactButton);return A.setAttribute("aria-hidden","true"),A.setAttribute("title",b),this._innerContainer=E("div","mapboxgl-ctrl-attrib-inner",this._container),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(c){const b=p.reduce((A,C,P)=>(C.value&&(A+=`${C.key}=${C.value}${P<p.length-1?"&":""}`),A),"?");c.href=`${a.e.FEEDBACK_URL}/${b}#${C_(this._map,!0)}`,c.rel="noopener nofollow"}}_updateData(c){!c||(c.dataType!=="source"||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility")&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const A=this._map.style.stylesheet;this.styleOwner=A.owner,this.styleId=A.id}const p=this._map.style._mergedSourceCaches;for(const A in p){const C=p[A];if(C.used){const P=C.getSource();P.attribution&&c.indexOf(P.attribution)<0&&c.push(P.attribution)}}c.sort((A,C)=>A.length-C.length),c=c.filter((A,C)=>{for(let P=C+1;P<c.length;P++)if(c[P].indexOf(A)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const b=c.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,c.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Og{constructor(){a.aX(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=E("div","mapboxgl-ctrl");const p=E("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const p in c){const b=c[p].getSource();if(b.hasOwnProperty("mapbox_logo")&&!b.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class f1{constructor(){a.aX(["_onIndoorUpdate"],this)}onAdd(c){return this._map=c,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",p=>this._onIndoorUpdate(p)),this._container}_createButton(c,p){const b=E("button",c,this._container);return b.type="button",b.addEventListener("click",p),b}_createSeparator(){return E("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(c,p){this._map&&(c.setAttribute("aria-label",p),c.textContent=p)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(c){if(!c||!c.floors)return this._model=c,void(this._container.style.display="none");const p=this._model;this._model=c,this._container.style.display="inline-block",this._container.style.borderRadius="8px",p&&Array.from(this._container.children).forEach(b=>b.remove()),c.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(c.floors,c.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const c=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const p=this._map;this._model&&p&&p._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});E("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&c.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(c),this._createSeparator()}_updateBuildingsButtonState(){const c=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");c&&this._model&&(this._model.activeFloorsVisible?c.classList.remove("mapboxgl-ctrl-level-button-selected"):c.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(c,p){for(let b=0;b<c.length;b++){const A=c[b],C=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(A.id)});this._setButtonTitle(C,A.zIndex.toString()),this._model&&A.id===this._model.selectedFloorId&&p&&C.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(C),b<c.length-1&&this._createSeparator()}}}class HT{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p}remove(c){const p=this._currentlyRunning,b=p?this._queue.concat(p):this._queue;for(const A of b)if(A.id===c)return void(A.cancelled=!0)}run(c=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const b of p)if(!b.cancelled&&(b.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class zg{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const p=a.dC((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,p,b){this._start=this.getValue(p),this._end=c,this._startTime=p,this._endTime=p+b}}const gD={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class jT extends a.z{constructor(c,p,b,A){const{point:C,lngLat:P,originalEvent:O,target:B}=c;super(c.type,{point:C,lngLat:P,originalEvent:O,target:B}),this.preventDefault=()=>{c.preventDefault()},this.id=p,this.interaction=b,this.feature=A}}class p1{constructor(c){this.map=c,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(c,p){if(this.typeById.has(c))throw new Error(`Interaction id "${c}" already exists.`);const b=p.filter;let A=p.type;b&&this.filters.set(c,a.b5(b)),A==="mouseover"&&(A="mouseenter"),A==="mouseout"&&(A="mouseleave");const C=this.interactionsByType.get(A)||new Map;A==="mouseenter"||A==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(c,p)):C.size===0&&this.map.on(A,this.handleType),C.size===0&&this.interactionsByType.set(A,C),C.set(c,p),this.typeById.set(c,A)}get(c){const p=this.typeById.get(c);if(!p)return;const b=this.interactionsByType.get(p);return b?b.get(c):void 0}remove(c){const p=this.typeById.get(c);if(!p)return;this.typeById.delete(c),this.filters.delete(c);const b=this.interactionsByType.get(p);b&&(b.delete(c),p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.delete(c),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):b.size===0&&this.map.off(p,this.handleType))}queryTargets(c,p){const b=[];for(const[A,C]of p)C.target&&b.push({targetId:A,target:C.target,filter:this.filters.get(A)});return this.map.style.queryRenderedTargets(c,b,this.map.transform)}handleMove(c){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const p=this.queryTargets(c.point,Array.from(this.delegatedInteractions).reverse());p.length&&(c.type="mouseenter",this.handleType(c,p));const b=new Map;for(const[A,{feature:C}]of this.prevHoveredFeatures)this.hoveredFeatures.has(A)||b.set(C.id,C);b.size&&(c.type="mouseleave",this.handleType(c,Array.from(b.values())))}handleOut(c){const p=Array.from(this.hoveredFeatures.values()).map(({feature:b})=>b);p.length&&(c.type="mouseleave",this.handleType(c,p)),this.hoveredFeatures.clear()}handleType(c,p){const b=c.type==="mouseenter";if(b&&!this.interactionsByType.has(c.type))return void a.w("mouseenter interaction required for mouseleave to work.");const A=Array.from(this.interactionsByType.get(c.type)).reverse(),C=!!p;p=p||this.queryTargets(c.point,A);let P=!1;const O=new Set;for(const B of p){for(const[G,j]of A){if(!j.target)continue;const Y=B.variants?B.variants[G]:null;if(Y){for(const W of Y){if(bs(W,B,O,G))continue;const J=new a.dw(B,W),tt=Bl(W,B,G);C&&J.id!==void 0&&(J.state=this.map.getFeatureState(J));const nt=b?this.prevHoveredFeatures.get(tt):null,ut=new jT(c,G,j,J),st=nt?nt.stop:j.handler(ut);if(b&&this.hoveredFeatures.set(tt,{feature:B,stop:st}),st!==!1){P=!0;break}}if(P)break}}if(P)break}if(!P)for(const[B,G]of A){const{handler:j,target:Y}=G;if(!Y&&j(new jT(c,B,G,null))!==!1)break}}}function g1(x,c){if(Array.isArray(x)&&Array.isArray(c)){const p=new Set(x),b=new Set(c);return p.size===b.size&&x.every(A=>b.has(A))}return a.bx(x,c)}const B_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},F_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bg{constructor(c,p,b=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new L_({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,b&&(this.mousePitch=new c1({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),a.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),H()}move(c,p){const b=this.map,A=this.mouseRotate.mousemoveWindow(c,p),C=A&&A.bearingDelta;if(C&&b.setBearing(b.getBearing()+C),this.mousePitch){const P=this.mousePitch.mousemoveWindow(c,p),O=P&&P.pitchDelta;O&&b.setPitch(b.getPitch()+O)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(Object.assign({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),et(this.element,c)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,et(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=rt(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=rt(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function qc(x,c,p){if(x=new a.aS(x.lng,x.lat),c){const b=new a.aS(x.lng-360,x.lat),A=new a.aS(x.lng+360,x.lat),C=360*Math.ceil(Math.abs(x.lng-p.center.lng)/360),P=p.locationPoint3D(x).distSqr(c),O=c.x<0||c.y<0||c.x>p.width||c.y>p.height;p.locationPoint3D(b).distSqr(c)<P&&(O||Math.abs(b.lng-p.center.lng)<C)?x=b:p.locationPoint3D(A).distSqr(c)<P&&(O||Math.abs(A.lng-p.center.lng)<C)&&(x=A)}for(;Math.abs(x.lng-p.center.lng)>180;){const b=p.locationPoint3D(x);if(b.x>=0&&b.y>=0&&b.x<=p.width&&b.y<=p.height)break;x.lng>p.center.lng?x.lng-=360:x.lng+=360}return x}const Nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ao={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Xc extends a.E{constructor(c,p){super(),(c instanceof HTMLElement||p)&&(c=Object.assign({element:c},p)),a.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:b="center",color:A="#3FB1CE",scale:C=1,draggable:P=!1,clickTolerance:O=0,rotation:B=Ao.rotation,rotationAlignment:G=Ao.rotationAlignment,pitchAlignment:j=Ao.pitchAlignment,occludedOpacity:Y=Ao.occludedOpacity,altitude:W=Ao.altitude}=c||{};this._anchor=b,this._color=A,this._scale=C,this._draggable=P,this._clickTolerance=O,this._rotation=B,this._rotationAlignment=G,this._pitchAlignment=j,this._occludedOpacity=Y,this._altitude=W,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),c&&c.element?(this._element=c.element,this._offset=a.P.convert(c&&c.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(c&&c.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",nt=>{nt.preventDefault()}),this._element.addEventListener("mousedown",nt=>{nt.preventDefault()});const J=this._element.classList;for(const nt in Nl)J.remove(`mapboxgl-marker-anchor-${nt}`);J.add(`mapboxgl-marker-anchor-${this._anchor}`);const tt=c&&c.className?c.className.trim().split(/\s+/):[];J.add(...tt),this._popup=null}_createDefaultMarker(){const c=E("div"),p=D("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},c);if(this._altitude===0){const b=D("radialGradient",{id:"shadowGradient"},D("defs",{},p));D("stop",{offset:"10%","stop-opacity":.4},b),D("stop",{offset:"100%","stop-opacity":.05},b),D("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},p)}return D("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},p),D("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},p),D("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},p),c}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=a.aS.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(c){return c===this._altitude||(this._defaultMarker&&(this._altitude===0&&c!==0||this._altitude!==0&&c===0)&&(this._element=this._createDefaultMarker()),this._altitude=c||Ao.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const A=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[A,-1*(38.1-13.5+A)],"bottom-right":[-A,-1*(38.1-13.5+A)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,c._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const p=c.code,b=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&b!==32&&b!==13||this.togglePopup()}_onMapClick(c){const p=c.originalEvent.target,b=this._element;this._popup&&(p===b||b.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,p=this._pos;if(!c||!p)return!1;const b=c.unproject(p,this._altitude),A=c.getFreeCameraOptions();if(!A.position)return!1;const C=A.position.toLngLat();return C.distanceTo(b)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const p=this._pos;if(!p||p.x<0||p.x>c.transform.width||p.y<0||p.y>c.transform.height)return void this._clearFadeTimer();const b=c.unproject(p,this._altitude);let A;c._showingGlobe()&&a.f4(c.transform,this._lngLat)?A=0:(A=1-c._queryFogOpacity(b),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(A*=this._occludedOpacity)),this._element.style.opacity=`${A}`,this._element.style.pointerEvents=A>0?"auto":"none",this._popup&&this._popup._setOpacity(A),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Nl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const c=this._pos,p=this._map,b=this.getPitchAlignment();if(!p||!c||b!=="map")return"";if(!p._showingGlobe()){const B=p.getPitch();return B?`rotateX(${B}deg)`:""}const A=a.cW(a.f5(p.transform,this._lngLat)),C=c.sub(a.f6(p.transform)),P=Math.abs(C.x)+Math.abs(C.y);if(P===0)return"";const O=A/P;return`rotateX(${-C.y*O}deg) rotateY(${C.x*O}deg)`}_calculateZTransform(){const c=this._pos,p=this._map;if(!p||!c)return"";let b=0;const A=this.getRotationAlignment();if(A==="map")if(p._showingGlobe()){const C=p.project(new a.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),P=p.project(new a.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(C);b=a.cW(Math.atan2(P.y,P.x))-90}else b=-p.getBearing();else if(A==="horizon"){const C=a.ah(4,6,p.getZoom()),P=a.f6(p.transform);P.y+=C*p.transform.height;const O=c.sub(P),B=a.cW(Math.atan2(O.y,O.x));b=(B>90?B-270:B+90)*(1-C)}return b+=this._rotation,b?`rotateZ(${b}deg)`:""}_update(c){cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=qc(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat,this._altitude),c===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=a.P.convert(c),this._update(),this}addClassName(c){return this._element.classList.add(c),this}removeClassName(c){return this._element.classList.remove(c),this}toggleClassName(c){return this._element.classList.toggle(c)}_onMove(c){const p=this._map;if(!p)return;const b=this._pointerdownPos,A=this._positionDelta;if(b&&A){if(!this._isDragging){const C=this._clickTolerance||p._clickTolerance;if(c.point.dist(b)<C)return;this._isDragging=!0}this._pos=c.point.sub(A),this._lngLat=p.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.z("dragstart"))),this.fire(new a.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.z("dragend")),this._state="inactive"}_addDragHandler(c){const p=this._map,b=this._pos;p&&b&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(b),this._pointerdownPos=c.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const p=this._map;return p&&(c?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||Ao.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||Ao.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||Ao.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||Ao.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},mD={maxWidth:100,unit:"metric"},vD={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_D={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},yD=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function m1(x=new a.P(0,0),c="bottom"){if(typeof x=="number"){const p=Math.round(Math.sqrt(.5*Math.pow(x,2)));switch(c){case"top":return new a.P(0,x);case"top-left":return new a.P(p,p);case"top-right":return new a.P(-p,p);case"bottom":return new a.P(0,-x);case"bottom-left":return new a.P(p,-p);case"bottom-right":return new a.P(-p,-p);case"left":return new a.P(x,0);case"right":return new a.P(-x,0)}return new a.P(0,0)}return x instanceof a.P||Array.isArray(x)?a.P.convert(x):a.P.convert(x[c]||[0,0])}return{version:u,supported:I.supported,setRTLTextPlugin:a.fa,getRTLTextPluginStatus:a.f9,Map:class extends dc{constructor(x){g.mark(f.create);const c=x;if((x=Object.assign({},B_,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(x.antialias&&a.f2(window)&&(x.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Kd(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies,null,null),x),this._repaint=!!x.repaint,this._interactive=x.interactive,this._minTileCacheSize=x.minTileCacheSize,this._maxTileCacheSize=x.maxTileCacheSize,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=x.crossSourceCollisions,this._collectResourceTiming=x.collectResourceTiming,this._language=this._parseLanguage(x.language),this._worldview=x.worldview,this._renderTaskQueue=new HT,this._domRenderTaskQueue=new HT,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.b1(),this._locale=Object.assign({},gD,x.locale),this._clickTolerance=x.clickTolerance,this._cooperativeGestures=x.cooperativeGestures,this._performanceMetricsCollection=x.performanceMetricsCollection,this._tessellationStep=x.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=x.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=x.scaleFactor,this._requestManager=new kt(x.transformRequest,x.accessToken,x.testMode),this._silenceAuthErrors=!!x.testMode,this._contextCreateOptions=x.contextCreateOptions?Object.assign({},x.contextCreateOptions):{},typeof x.container=="string"){const p=document.getElementById(x.container);if(!p)throw new Error(`Container '${x.container.toString()}' not found.`);this._container=p}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),x.maxBounds&&this.setMaxBounds(x.maxBounds),this._spriteFormat=x.spriteFormat,a.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lD),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new z_(this,x),this._localFontFamily=x.localFontFamily,this._localIdeographFontFamily=x.localIdeographFontFamily,(x.style||!x.testMode)&&this.setStyle(x.style||a.e.DEFAULT_STYLE,{config:x.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),x.projection&&this.setProjection(x.projection),x.hash&&(this._hash=new M_(typeof x.hash=="string"&&x.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){c.center==null&&c.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch});const p=x.bounds;p&&(this.resize(),this.fitBounds(p,Object.assign({},x.fitBoundsOptions,{duration:0})))}this.resize(),x.attributionControl&&this.addControl(new Af({customAttribution:x.customAttribution})),this._logoControl=new Og,this.addControl(this._logoControl,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",p=>{this._update(p.dataType==="style"),this.fire(new a.z(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new a.z(`${p.dataType}dataloading`,p))}),this._interactions=new p1(this)}_getMapId(){return this._mapId}addControl(x,c){if(c===void 0&&(c=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=x.onAdd(this);this._controls.push(x);const b=this._controlPositions[c];return c.indexOf("bottom")!==-1?b.insertBefore(p,b.firstChild):b.appendChild(p),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(x);return c>-1&&this._controls.splice(c,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(x){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new a.z("movestart",x)).fire(new a.z("move",x)),this.fire(new a.z("resize",x)),c&&this.fire(new a.z("moveend",x)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(x){return this.transform.setMaxBounds(a.aI.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x?this.setZoom(x):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x?this.setZoom(x):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x?this.setPitch(x):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x?this.setPitch(x):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(x){return this._scaleFactor=x,this.painter.scaleFactor=x,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(c=>c.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(x){return x==="auto"?navigator.language:Array.isArray(x)?x.length===0?void 0:x.map(c=>c==="auto"?navigator.language:c):x}setLanguage(x){const c=this._parseLanguage(x);if(!this.style||c===this._language)return this;this._language=c,this.style.reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(x){return this.style&&x!==this._worldview?(this._worldview=x,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(x){return this._lazyInitEmptyStyle(),x?typeof x=="string"&&(x={name:x}):x=null,this._useExplicitProjection=!!x,this._prioritizeAndUpdateProjection(x,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const x=this.transform,c=x.projection.name;let p;c==="globe"&&x.zoom>=a.cK?(x.setMercatorFromTransition(),p=!0):c==="mercator"&&x.zoom<a.cK&&(x.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(x,c){return this._updateProjection(x||c||{name:"mercator"})}_updateProjection(x){let c;const p=this.transform.mercatorFromTransition;c=x.name==="globe"&&this.transform.zoom>=a.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(x),this.style.applyProjectionUpdate();const b=this.transform.getProjection().name==="mercator"&&p!==this.transform.mercatorFromTransition;return(c||b)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(x,c){return this.transform.locationPoint3D(a.aS.convert(x),c)}unproject(x,c){return this.transform.pointLocation3D(a.P.convert(x),c)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(x,c,p){const b=A=>{let C=[];if(Array.isArray(c)){const P=c.filter(O=>this.getLayer(O));C=P.length?this.queryRenderedFeatures(A,{layers:P}):[]}else C=this.queryRenderedFeatures(A,{target:c});return C};if(x==="mouseenter"||x==="mouseover"){let A=!1;return{listener:p,targets:c,delegates:{mousemove:P=>{const O=b(P.point);O.length?A||(A=!0,p.call(this,new Pn(x,this,P.originalEvent,{features:O}))):A=!1},mouseout:()=>{A=!1}}}}if(x==="mouseleave"||x==="mouseout"){let A=!1;return{listener:p,targets:c,delegates:{mousemove:O=>{b(O.point).length?A=!0:A&&(A=!1,p.call(this,new Pn(x,this,O.originalEvent)))},mouseout:O=>{A&&(A=!1,p.call(this,new Pn(x,this,O.originalEvent)))}}}}{const A=C=>{const P=b(C.point);P.length&&(C.features=P,p.call(this,C),delete C.features)};return{listener:p,targets:c,delegates:{[x]:A}}}}on(x,c,p){if(typeof c=="function"||p===void 0)return super.on(x,c);if(typeof c=="string"&&(c=[c]),!this._areTargetsValid(c))return this;const b=this._createDelegatedListener(x,c,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(b);for(const A in b.delegates)this.on(A,b.delegates[A]);return this}once(x,c,p){if(typeof c=="function"||p===void 0)return super.once(x,c);if(typeof c=="string"&&(c=[c]),!this._areTargetsValid(c))return this;const b=this._createDelegatedListener(x,c,p);for(const A in b.delegates)this.once(A,b.delegates[A]);return this}off(x,c,p){if(typeof c=="function"||p===void 0)return super.off(x,c);if(typeof c=="string"&&(c=[c]),!this._areTargetsValid(c))return this;const b=this._delegatedListeners?this._delegatedListeners[x]:void 0;return b&&(A=>{for(let C=0;C<A.length;C++){const P=A[C];if(P.listener===p&&g1(P.targets,c)){for(const O in P.delegates)this.off(O,P.delegates[O]);return A.splice(C,1),this}}})(b),this}queryRenderedFeatures(x,c){if(!this.style)return[];if(x===void 0||x instanceof a.P||Array.isArray(x)||c!==void 0||(c=x,x=void 0),x=x||[[0,0],[this.transform.width,this.transform.height]],!c){const C=this.style.queryRenderedFeatures(x,void 0,this.transform),P=this.style.queryRenderedFeatureset(x,void 0,this.transform);return C.concat(P)}let p=!0;if(c.target&&(p=this._isTargetValid(c.target),p&&!c.layers))return this.style.queryRenderedFeatureset(x,c,this.transform);let b=!0;if(c.layers&&Array.isArray(c.layers)){for(const C of c.layers)if(!this._isValidId(C)){b=!1;break}if(b&&!c.target)return this.style.queryRenderedFeatures(x,c,this.transform)}let A=[];return b&&(A=A.concat(this.style.queryRenderedFeatures(x,c,this.transform))),p&&(A=A.concat(this.style.queryRenderedFeatureset(x,c,this.transform))),A}querySourceFeatures(x,c){return!x||typeof x=="string"&&!this._isValidId(x)?[]:this.style.querySourceFeatures(x,c)}queryRasterValue(x,c,p){return this._isValidId(x)?this.style.queryRasterValue(x,c,p):Promise.resolve(null)}isPointOnSurface(x){const{name:c}=this.transform.projection;return c!=="globe"&&c!=="mercator"&&a.w(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(x))}addInteraction(x,c){return this._interactions.add(x,c),this}removeInteraction(x){return this._interactions.remove(x),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(x){return this._cooperativeGestures=x,this}setStyle(x,c){return c=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c),this.style&&x&&c.diff!==!1&&c.localFontFamily===this._localFontFamily&&c.localIdeographFontFamily===this._localIdeographFontFamily&&!c.config?(this.style._diffStyle(x,(p,b)=>{if(p){const A=typeof p=="string"?p:p instanceof Error?p.message:p.error;a.w(`Unable to perform style diff: ${A}. Rebuilding the style from scratch.`),this._updateStyle(x,c)}else b&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(x,c))}_getUIString(x){const c=this._locale[x];if(c==null)throw new Error(`Missing UI string '${x}'`);return c}_updateStyle(x,c){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),x){const p=Object.assign({},c);c&&c.config&&(p.initialConfig=c.config,delete p.config),this.style=new wl(this,p).load(x),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(x){return x==null?(this.fire(new a.y(new Error("IDs can't be empty."))),!1):!a.dq(x)||(this.fire(new a.y(new Error(`IDs can't contain special symbols: "${x}".`))),!1)}_isTargetValid(x){return"featuresetId"in x?this._isValidId("importId"in x?x.importId:x.featuresetId):"layerId"in x&&this._isValidId(x.layerId)}_areTargetsValid(x){if(Array.isArray(x)){for(const c of x)if(!this._isValidId(c))return!1;return!0}return this._isTargetValid(x)}addSource(x,c){return this._isValidId(x)?(this._lazyInitEmptyStyle(),this.style.addSource(x,c),this._update(!0)):this}isSourceLoaded(x){return!!this._isValidId(x)&&!!this.style&&this.style._isSourceCacheLoaded(x)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(x,c,p){this._lazyInitEmptyStyle(),this.style.addSourceType(x,c,p)}removeSource(x){return this._isValidId(x)?(this.style.removeSource(x),this._updateTerrain(),this._update(!0)):this}getSource(x){return this._isValidId(x)?this.style.getOwnSource(x):null}addImage(x,c,{pixelRatio:p=1,sdf:b=!1,stretchX:A,stretchY:C,content:P}={}){this._lazyInitEmptyStyle();const O=a.I.from(x);if(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap){const{width:B,height:G,data:j}=a.o.getImageData(c);this.style.addImage(O,{data:new a.q({width:B,height:G},j),pixelRatio:p,stretchX:A,stretchY:C,content:P,sdf:b,version:0,usvg:!1})}else if(c.width===void 0||c.height===void 0)this.fire(new a.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:B,height:G}=c,j=c;this.style.addImage(O,{data:new a.q({width:B,height:G},new Uint8Array(j.data)),pixelRatio:p,stretchX:A,stretchY:C,content:P,sdf:b,usvg:!1,version:0,userImage:j}),j.onAdd&&j.onAdd(this,x)}}updateImage(x,c){this._lazyInitEmptyStyle();const p=a.I.from(x),b=this.style.getImage(p);if(!b)return void this.fire(new a.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const A=c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap?a.o.getImageData(c):c,{width:C,height:P,data:O}=A;if(C===void 0||P===void 0)return void this.fire(new a.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(C!==(b.usvg?b.icon.usvg_tree.width:b.data.width)||P!==(b.usvg?b.icon.usvg_tree.height:b.data.height))return void this.fire(new a.y(new Error(`The width and height of the updated image (${C}, ${P})
                must be that same as the previous version of the image
                (${b.data.width}, ${b.data.height})`)));const B=!(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap);let G=!1;b.usvg?(b.data=new a.q({width:C,height:P},new Uint8Array(O)),b.usvg=!1,b.icon=void 0,G=!0):b.data.replace(O,B),this.style.updateImage(p,b,G)}hasImage(x){return x?!!this.style&&!!this.style.getImage(a.I.from(x)):(this.fire(new a.y(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(a.I.from(x))}loadImage(x,c){a.n(this._requestManager.transformRequest(x,a.R.Image),(p,b)=>{c(p,b instanceof HTMLImageElement?a.o.getImageData(b):b)})}listImages(){return this.style.listImages().map(x=>x.name)}addModel(x,c){this._lazyInitEmptyStyle(),this.style.addModel(x,c)}hasModel(x){return x?this.style.hasModel(x):(this.fire(new a.y(new Error("Missing required model id"))),!1)}removeModel(x){this.style.removeModel(x)}listModels(){return this.style.listModels()}addLayer(x,c){return this._isValidId(x.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(x,c),this._update(!0)):this}getSlot(x){const c=this.getLayer(x);return c&&c.slot||null}setSlot(x,c){return this.style.setSlot(x,c),this.style.mergeLayers(),this._update(!0)}addImport(x,c){return this.style.addImport(x,c).catch(p=>this.fire(new a.y(new Error("Failed to add import",p)))),this}updateImport(x,c){return typeof c!="string"&&c.id!==x?(this.removeImport(x),this.addImport(c)):(this.style.updateImport(x,c),this._update(!0))}removeImport(x){return this.style.removeImport(x),this}moveImport(x,c){return this.style.moveImport(x,c),this._update(!0)}moveLayer(x,c){return this._isValidId(x)?(this.style.moveLayer(x,c),this._update(!0)):this}removeLayer(x){return this._isValidId(x)?(this.style.removeLayer(x),this._update(!0)):this}getLayer(x){if(!this._isValidId(x))return null;const c=this.style.getOwnLayer(x);return c?c.type==="custom"?c.implementation:c.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(x,c,p){return this._isValidId(x)?(this.style.setLayerZoomRange(x,c,p),this._update(!0)):this}setFilter(x,c,p={}){return this._isValidId(x)?(this.style.setFilter(x,c,p),this._update(!0)):this}getFilter(x){return this._isValidId(x)?this.style.getFilter(x):null}setPaintProperty(x,c,p,b={}){return this._isValidId(x)?(this.style.setPaintProperty(x,c,p,b),this._update(!0)):this}getPaintProperty(x,c){return this._isValidId(x)?this.style.getPaintProperty(x,c):null}setLayoutProperty(x,c,p,b={}){return this._isValidId(x)?(this.style.setLayoutProperty(x,c,p,b),this._update(!0)):this}getLayoutProperty(x,c){return this._isValidId(x)?this.style.getLayoutProperty(x,c):null}setLayerProperty(x,c,p,b={}){return this._isValidId(x)?(this.style.setLayerProperty(x,c,p,b),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(x){return this.style.setGlyphsUrl(x),this._update(!0)}getSchema(x){return this.style.getSchema(x)}setSchema(x,c){return this.style.setSchema(x,c),this._update(!0)}getConfig(x){return this.style.getConfig(x)}setConfig(x,c){return this.style.setConfig(x,c),this._update(!0)}getConfigProperty(x,c){return this.style.getConfigProperty(x,c)}setConfigProperty(x,c,p){return this.style.setConfigProperty(x,c,p),this._update(!0)}getFeaturesetDescriptors(x){return this.style.getFeaturesetDescriptors(x)}setLights(x){if(this._lazyInitEmptyStyle(),x&&x.length===1&&x[0].type==="flat"){const c=x[0];c.properties?this.style.setFlatLight(c.properties,c.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(x),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const x=this.style.getLights()||[];return x.length===0&&x.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),x}setLight(x,c={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:x}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(x){return this._lazyInitEmptyStyle(),!x&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(x),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(x){return this._lazyInitEmptyStyle(),this.style.setFog(x),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(x){return this._lazyInitEmptyStyle(),this.style.setSnow(x),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(x){return this._lazyInitEmptyStyle(),this.style.setRain(x),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(x){return this._lazyInitEmptyStyle(),this.style.setColorTheme(x),this._update(!0)}setImportColorTheme(x,c){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(x,c),this._update(!0)}setCamera(x){return this.style.setCamera(x),this._triggerCameraUpdate(x)}_triggerCameraUpdate(x){return this._update(this.transform.setOrthographicProjectionAtLowPitch(x["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(x){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aS.convert(x),this.transform):0}setFeatureState(x,c){return x.source&&!this._isValidId(x.source)?this:(this.style.setFeatureState(x,c),this._update())}removeFeatureState(x,c){return x.source&&!this._isValidId(x.source)?this:(this.style.removeFeatureState(x,c),this._update())}getFeatureState(x){return x.source&&!this._isValidId(x.source)?null:this.style.getFeatureState(x)}_selectIndoorFloor(x){this.indoor.selectFloor(x)}_setIndoorActiveFloorsVisibility(x){this.indoor.setActiveFloorsVisibility(x)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new f1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const x=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let p,b,A,C=this._container;for(;C&&(!b||!A);){const P=window.getComputedStyle(C).transform;P&&P!=="none"&&(p=P.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&p[0]!=="0"&&p[0]!=="1"&&(b=p[0]),p[3]&&p[3]!=="0"&&p[3]!=="1"&&(A=p[3])),C=C.parentElement}this._containerWidth=b?Math.abs(x/b):x,this._containerHeight=A?Math.abs(c/A):c}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Oh(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const x=this._container;x.classList.add("mapboxgl-map"),(this._missingCSSCanary=E("div","mapboxgl-canary",x)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=E("div","mapboxgl-canvas-container",x);this._canvas=E("canvas","mapboxgl-canvas",c),this._interactive&&(c.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=E("div","mapboxgl-control-container",x),b=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(A=>{b[A]=E("div",`mapboxgl-ctrl-${A}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,c){const p=a.o.devicePixelRatio||1;this._canvas.width=p*Math.ceil(x),this._canvas.height=p*Math.ceil(c),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${c}px`}_addMarker(x){this._markers.push(x)}_removeMarker(x){const c=this._markers.indexOf(x);c!==-1&&this._markers.splice(c,1)}_addPopup(x){this._popups.push(x)}_removePopup(x){const c=this._popups.indexOf(x);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const x=Object.assign({},I.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl2",x);c?(Zt(c,!0),this.painter=new Ru(c,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.k.testSupport(c)):this.fire(new a.y(new Error("Failed to initialize WebGL")))}_contextLost(x){x.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.z("webglcontextlost",{originalEvent:x}))}_contextRestored(x){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.z("webglcontextrestored",{originalEvent:x}))}_onMapScroll(x){if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(x){return this.style?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_requestDomTask(x){!this.loaded()||this.loaded()&&!this.isMoving()?x():this._domRenderTaskQueue.add(x)}_render(x){let c;this.fire(new a.z("renderstart")),++this._frameId;const p=this.painter.context.extTimerQuery,b=a.o.now(),A=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(c=A.createQuery(),A.beginQuery(p.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(x),this._domRenderTaskQueue.run(x),this._removed)return;this._updateProjectionTransition();const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,j=this.transform.pitch,Y=a.o.now(),W=new a.ac(G,{now:Y,fadeDuration:C,pitch:j,transition:this.style.transition,worldview:this._worldview});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let P=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),P=this._updateAverageElevation(b),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):P=this._updateAverageElevation(b);const O=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),O&&(this._placementDirty=O.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,g.mark(f.load),this.fire(new a.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const G=a.o.now()-b;A.endQuery(p.TIME_ELAPSED_EXT),setTimeout(()=>{const j=A.getQueryParameter(c,A.QUERY_RESULT)/1e6;A.deleteQuery(c),this.fire(new a.z("gpu-timing-frame",{cpuTime:G,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(G);this.fire(new a.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(G);this.fire(new a.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||P;if(B||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(P=this._updateAverageElevation(b,!0)),P)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new a.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new a.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,g.mark(f.fullLoad),this._performanceMetricsCollection&&Ke(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(x){for(const c of this._markers)x&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!x||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(x,c=!1){const p=A=>(this.transform.averageElevation=A,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);const b=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(b||(c||x-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(x)){const A=this.transform.averageElevation;let C=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=x;const P=Math.abs(A-C);if(P>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(C),p(C);this._averageElevation.easeTo(C,x,300)}else if(P>1e-4)return this._averageElevation.jumpTo(C),p(C)}return!!this._averageElevation.isEasing(x)&&p(this._averageElevation.getValue(x))}_authenticate(){Si(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,x=>{if(x&&(x.message===ft||x.status===401)){const c=this.painter.context.gl;Zt(c,!1),this._logoControl instanceof Og&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),li(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&or(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Ze(this._requestManager._customAccessToken)}_updateTerrain(){const x=this._isDragging();this.painter.updateTerrain(this.style,x)}_calculateSpeedIndex(){const x=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const p=this.painter.context.gl,b=p.createFramebuffer();function A(C){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,C,0);const P=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,P),P}return p.bindFramebuffer(p.FRAMEBUFFER,b),this._canvasPixelComparison(A(x),c.canvasCopies.map(A),c.timeStamps)}_canvasPixelComparison(x,c,p){let b=p[1]-p[0];const A=x.length/4;for(let C=0;C<c.length;C++){const P=c[C];let O=0;for(let B=0;B<P.length;B+=4)P[B]===x[B]&&P[B+1]===x[B+1]&&P[B+2]===x[B+2]&&P[B+3]===x[B+3]&&(O+=1);b+=(p[C+2]-p[C+1])*(1-O/A)}return b}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const x=this.painter.context.gl.getExtension("WEBGL_lose_context");x&&x.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),zt.delete(this.painter.context.gl),We.remove(),Ge.remove(),this._removed=!0,this.fire(new a.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(x){this._renderNextFrame=this._renderNextFrame||x,this.style&&!this._frame&&(this._frame=a.o.frame(c=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(c)}))}_preloadTiles(x){const c=this.style?this.style.getSourceCaches():[];return a.bv(c,(p,b)=>p._preloadTiles(x,b),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(x){this._trackResize&&this.resize({originalEvent:x})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(x){this._showParseStatus!==x&&(this._showParseStatus=x,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(x){this._showTerrainWireframe!==x&&(this._showTerrainWireframe=x,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(x){this._showLayers2DWireframe!==x&&(this._showLayers2DWireframe=x,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(x){this._showLayers3DWireframe!==x&&(this._showLayers3DWireframe=x,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(x){this._speedIndexTiming!==x&&(this._speedIndexTiming=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,this._tp.refreshUI(),x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(x){this._showTileAABBs!==x&&(this._showTileAABBs=x,this._tp.refreshUI(),x&&this._update())}_setCacheLimits(x,c){a.f3(x,c)}get version(){return u}},NavigationControl:class{constructor(x={}){this.options=Object.assign({},F_,x),this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(a.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),E("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),E("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:c}):p.resetNorth({},{originalEvent:c}))}),this._compassIcon=E("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const x=this._map;if(!x)return;const c=x.getZoom(),p=c===x.getMaxZoom(),b=c===x.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())}_rotateCompassArrow(){const x=this._map;if(!x)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(x.transform.pitch*(Math.PI/180)),.5)}) rotateX(${x.transform.pitch}deg) rotateZ(${x.transform.angle*(180/Math.PI)}deg)`:`rotate(${x.transform.angle*(180/Math.PI)}deg)`;x._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),x.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&x.on("pitch",this._rotateCompassArrow),x.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bg(x,this._compass,this.options.visualizePitch)),this._container}onRemove(){const x=this._map;x&&(this._container.remove(),this.options.showZoom&&x.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&x.off("pitch",this._rotateCompassArrow),x.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(x,c){const p=E("button",x,this._container);return p.type="button",p.addEventListener("click",c),p}_setButtonTitle(x,c){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${c}`);x.setAttribute("aria-label",p),x.firstElementChild&&x.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends a.E{constructor(x={}){super();const c=navigator.geolocation;this.options=Object.assign({geolocation:c},Vl,x),a.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=jh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(x){return this._map=x,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(x){const c=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,x(p)};this._supportsGeolocation!==void 0?x(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(p=>c(p.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(x){const c=this._map.getMaxBounds(),p=x.coords;return!!c&&(p.longitude<c.getWest()||p.longitude>c.getEast()||p.latitude<c.getSouth()||p.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(x){if(this._map){if(this._isOutOfMapMaxBounds(x))return this._setErrorState(),this.fire(new a.z("outofmaxbounds",x)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=x,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(x),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(x),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("geolocate",Object.assign({coords:x.coords,timestamp:x.timestamp},x.toJSON?{toJSON:x.toJSON.bind(x)}:{}))),this._finish()}}_updateCamera(x){const c=new a.aS(x.coords.longitude,x.coords.latitude),p=x.coords.accuracy,b=this._map.getBearing(),A=Object.assign({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(p),A,{geolocateSource:!0})}_updateMarker(x){if(x){const c=new a.aS(x.coords.longitude,x.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=x.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const x=this._map.transform,c=a.ce(1,x._center.lat)*x.worldSize,p=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(x){if(this._map){if(this.options.trackUserLocation)if(x.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(x.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("error",x)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(x){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=E("button","mapboxgl-ctrl-geolocate",this._container),E("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",x===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E("div","mapboxgl-user-location"),this._dotElement.appendChild(E("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(E("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=E("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.z("trackuserlocationend")))})}}_onDeviceOrientation(x){this._userLocationDotMarker&&(x.webkitCompassHeading?this._heading=x.webkitCompassHeading:x.absolute===!0&&(this._heading=-1*x.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(x={maximumAge:6e5,timeout:0},this._noTimeout=!0):(x=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,x),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const x=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&x()}).catch(console.error):x()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Af,ScaleControl:class{constructor(x={}){this.options=Object.assign({},mD,x),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const x=this.options.maxWidth||100,c=this._map,p=c._containerHeight/2,b=c._containerWidth/2-x/2,A=c.unproject([b,p]),C=c.unproject([b+x,p]),P=A.distanceTo(C);if(this.options.unit==="imperial"){const O=3.2808*P;O>5280?this._setScale(x,O/5280,"mile"):this._setScale(x,O,"foot")}else this.options.unit==="nautical"?this._setScale(x,P/1852,"nautical-mile"):P>=1e3?this._setScale(x,P/1e3,"kilometer"):this._setScale(x,P,"meter")}_setScale(x,c,p){this._map._requestDomTask(()=>{const b=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let O=C/P;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(O),P*O}(c),A=b/c;this._container.innerHTML=this._isNumberFormatSupported&&p!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:p}).format(b):`${b}&nbsp;${vD[p]}`,this._container.style.width=x*A+"px"})}onAdd(x){return this._map=x,this._language=x.getLanguage(),this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-scale",x.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(x){this._language=x,this._update()}setUnit(x){this.options.unit=x,this._update()}},FullscreenControl:class{constructor(x={}){this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),a.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const x=this._fullscreenButton=E("button","mapboxgl-ctrl-fullscreen",this._controlContainer);E("span","mapboxgl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",x)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:f1,Popup:class extends a.E{constructor(x){super(),this.options=Object.assign(Object.create(_D),x),this._altitude=this.options.altitude,a.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(x&&x.className?x.className.trim().split(/\s+/):[])}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&x.on("preclick",this._onClose),this.options.closeOnMove&&x.on("move",this._onClose),x.on("remove",this.remove),this._update(),x._addPopup(this),this._focusFirstElement(),this._trackPointer?(x.on("mousemove",this._onMouseEvent),x.on("mouseup",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")):x.on("move",this._update),this.fire(new a.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const x=this._map;return x&&(x.off("move",this._update),x.off("move",this._onClose),x.off("preclick",this._onClose),x.off("click",this._onClose),x.off("remove",this.remove),x.off("mousemove",this._onMouseEvent),x.off("mouseup",this._onMouseEvent),x.off("drag",this._onMouseEvent),x._canvasContainer&&x._canvasContainer.classList.remove("mapboxgl-track-pointer"),x._removePopup(this),this._map=void 0),this.fire(new a.z("close")),this}getLngLat(){return this._lngLat}setLngLat(x){this._lngLat=a.aS.convert(x),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(x){return this._altitude=x,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const x=this._map;return x&&(x.off("move",this._update),x.on("mousemove",this._onMouseEvent),x.on("drag",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const c=document.createDocumentFragment(),p=document.createElement("body");let b;for(p.innerHTML=x;b=p.firstChild,b;)c.appendChild(b);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=E("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(x),this.options.closeButton){const p=this._closeButton=E("button","mapboxgl-popup-close-button",c);p.type="button",p.setAttribute("aria-label","Close popup"),p.innerHTML='<span aria-hidden="true">&#215;</span>',p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(x){return this._classList.add(x),this._updateClassList(),this}removeClassName(x){return this._classList.delete(x),this._updateClassList(),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){let c;return this._classList.delete(x)?c=!1:(this._classList.add(x),c=!0),this._updateClassList(),c}_onMouseEvent(x){this._update(x.point)}_getAnchor(x){if(this.options.anchor)return this.options.anchor;const c=this._map,p=this._container,b=this._pos;if(!c||!p||!b)return"bottom";const A=p.offsetWidth,C=p.offsetHeight,P=b.x<A/2,O=b.x>c.transform.width-A/2;if(b.y+x<C)return P?"top-left":O?"top-right":"top";if(b.y>c.transform.height-C){if(P)return"bottom-left";if(O)return"bottom-right"}return P?"left":O?"right":"bottom"}_updateClassList(){const x=this._container;if(!x)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),x.className=c.join(" ")}_update(x){const c=this._map,p=this._content;if(!c||!this._lngLat&&!this._trackPointer||!p)return;let b=this._container;if(b||(b=this._container=E("div","mapboxgl-popup",c.getContainer()),this._tip=E("div","mapboxgl-popup-tip",b),b.appendChild(p)),this.options.maxWidth&&b.style.maxWidth!==this.options.maxWidth&&(b.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qc(this._lngLat,this._pos,c.transform)),!this._trackPointer||x){const A=this._pos=this._trackPointer&&x instanceof a.P?x:c.project(this._lngLat,this._altitude),C=m1(this.options.offset),P=this._anchor=this._getAnchor(C.y),O=m1(this.options.offset,P),B=A.add(O).round();c._requestDomTask(()=>{this._container&&P&&(this._container.style.transform=`${Nl[P]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&c._showingGlobe()){const A=a.f4(c.transform,this._lngLat)?0:1;this._setOpacity(A)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(yD);x&&x.focus()}_onClose(){this.remove()}_setOpacity(x){this._container&&(this._container.style.opacity=`${x}`),this._content&&(this._content.style.pointerEvents=x?"auto":"none")}},Marker:Xc,Style:wl,LngLat:a.aS,LngLatBounds:a.aI,Point:a.P,MercatorCoordinate:a.ae,FreeCameraOptions:cc,Evented:a.E,config:a.e,prewarm:a.f8,clearPrewarmedResources:a.f7,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(x){a.e.ACCESS_TOKEN=x},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(x){a.e.API_URL=x},get workerCount(){return a.fh.workerCount},set workerCount(x){a.fh.workerCount=x},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(x){a.e.MAX_PARALLEL_IMAGE_REQUESTS=x},clearStorage(x){a.fg(x)},get workerUrl(){return a.ff.workerUrl},set workerUrl(x){a.ff.workerUrl=x},get workerClass(){return a.ff.workerClass},set workerClass(x){a.ff.workerClass=x},get workerParams(){return a.ff.workerParams},set workerParams(x){a.ff.workerParams=x},get dracoUrl(){return a.fe()},set dracoUrl(x){a.fd(x)},get meshoptUrl(){return a.fc()},set meshoptUrl(x){a.fb(x)},setNow:a.o.setNow,restoreNow:a.o.restoreNow}});var s=n;return s})})(lX);var Nht=lX.exports;const Uy=Fht(Nht);const Vht={class:"map-legend"},Uht={class:"legend-title"},Ght={class:"legend-note"},Hht={__name:"MapLegend",props:{title:{type:String,default:"PM2.5 Emissions (g/hour)"},note:{type:String,default:"* Based on backend hourly emissions"},levels:{type:Array,default:()=>[{color:"#22c55e",label:"0  200 Very Low"},{color:"#84cc16",label:"200  260 Low"},{color:"#eab308",label:"260  340 Moderate"},{color:"#f97316",label:"340  430 High"},{color:"#ef4444",label:"430  550 Very High"},{color:"#7f1d1d",label:"> 550 Extreme"}]}},setup(i){return(t,e)=>(Wo(),ms("div",Vht,[ve("div",Uht,Ta(i.title),1),(Wo(!0),ms(Xl,null,jB(i.levels,(r,n)=>(Wo(),ms("div",{key:n,class:"legend-row"},[ve("span",{class:"legend-color",style:R0({background:r.color})},null,4),ve("span",null,Ta(r.label),1)]))),128)),ve("div",Ght,Ta(i.note),1)]))}},jht=Np(Hht,[["__scopeId","data-v-d086de57"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function DS(i){return i+.5|0}const rp=(i,t,e)=>Math.max(Math.min(i,e),t);function jb(i){return rp(DS(i*2.55),0,255)}function _p(i){return rp(DS(i*255),0,255)}function ud(i){return rp(DS(i/2.55)/100,0,1)}function LG(i){return rp(DS(i*100),0,100)}const mc={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},eO=[..."0123456789ABCDEF"],Wht=i=>eO[i&15],$ht=i=>eO[(i&240)>>4]+eO[i&15],W2=i=>(i&240)>>4===(i&15),Zht=i=>W2(i.r)&&W2(i.g)&&W2(i.b)&&W2(i.a);function qht(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&mc[i[1]]*17,g:255&mc[i[2]]*17,b:255&mc[i[3]]*17,a:t===5?mc[i[4]]*17:255}:(t===7||t===9)&&(e={r:mc[i[1]]<<4|mc[i[2]],g:mc[i[3]]<<4|mc[i[4]],b:mc[i[5]]<<4|mc[i[6]],a:t===9?mc[i[7]]<<4|mc[i[8]]:255})),e}const Xht=(i,t)=>i<255?t(i):"";function Yht(i){var t=Zht(i)?Wht:$ht;return i?"#"+t(i.r)+t(i.g)+t(i.b)+Xht(i.a,t):void 0}const Kht=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function uX(i,t,e){const r=t*Math.min(e,1-e),n=(o,s=(o+i/30)%12)=>e-r*Math.max(Math.min(s-3,9-s,1),-1);return[n(0),n(8),n(4)]}function Jht(i,t,e){const r=(n,o=(n+i/60)%6)=>e-e*t*Math.max(Math.min(o,4-o,1),0);return[r(5),r(3),r(1)]}function Qht(i,t,e){const r=uX(i,1,.5);let n;for(t+e>1&&(n=1/(t+e),t*=n,e*=n),n=0;n<3;n++)r[n]*=1-t-e,r[n]+=t;return r}function tdt(i,t,e,r,n){return i===n?(t-e)/r+(t<e?6:0):t===n?(e-i)/r+2:(i-t)/r+4}function KB(i){const e=i.r/255,r=i.g/255,n=i.b/255,o=Math.max(e,r,n),s=Math.min(e,r,n),a=(o+s)/2;let u,f,g;return o!==s&&(g=o-s,f=a>.5?g/(2-o-s):g/(o+s),u=tdt(e,r,n,g,o),u=u*60+.5),[u|0,f||0,a]}function JB(i,t,e,r){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,r)).map(_p)}function QB(i,t,e){return JB(uX,i,t,e)}function edt(i,t,e){return JB(Qht,i,t,e)}function idt(i,t,e){return JB(Jht,i,t,e)}function hX(i){return(i%360+360)%360}function rdt(i){const t=Kht.exec(i);let e=255,r;if(!t)return;t[5]!==r&&(e=t[6]?jb(+t[5]):_p(+t[5]));const n=hX(+t[2]),o=+t[3]/100,s=+t[4]/100;return t[1]==="hwb"?r=edt(n,o,s):t[1]==="hsv"?r=idt(n,o,s):r=QB(n,o,s),{r:r[0],g:r[1],b:r[2],a:e}}function ndt(i,t){var e=KB(i);e[0]=hX(e[0]+t),e=QB(e),i.r=e[0],i.g=e[1],i.b=e[2]}function adt(i){if(!i)return;const t=KB(i),e=t[0],r=LG(t[1]),n=LG(t[2]);return i.a<255?`hsla(${e}, ${r}%, ${n}%, ${ud(i.a)})`:`hsl(${e}, ${r}%, ${n}%)`}const RG={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},kG={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function odt(){const i={},t=Object.keys(kG),e=Object.keys(RG);let r,n,o,s,a;for(r=0;r<t.length;r++){for(s=a=t[r],n=0;n<e.length;n++)o=e[n],a=a.replace(o,RG[o]);o=parseInt(kG[s],16),i[a]=[o>>16&255,o>>8&255,o&255]}return i}let $2;function sdt(i){$2||($2=odt(),$2.transparent=[0,0,0,0]);const t=$2[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const ldt=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function cdt(i){const t=ldt.exec(i);let e=255,r,n,o;if(t){if(t[7]!==r){const s=+t[7];e=t[8]?jb(s):rp(s*255,0,255)}return r=+t[1],n=+t[3],o=+t[5],r=255&(t[2]?jb(r):rp(r,0,255)),n=255&(t[4]?jb(n):rp(n,0,255)),o=255&(t[6]?jb(o):rp(o,0,255)),{r,g:n,b:o,a:e}}}function udt(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${ud(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const JP=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,uy=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function hdt(i,t,e){const r=uy(ud(i.r)),n=uy(ud(i.g)),o=uy(ud(i.b));return{r:_p(JP(r+e*(uy(ud(t.r))-r))),g:_p(JP(n+e*(uy(ud(t.g))-n))),b:_p(JP(o+e*(uy(ud(t.b))-o))),a:i.a+e*(t.a-i.a)}}function Z2(i,t,e){if(i){let r=KB(i);r[t]=Math.max(0,Math.min(r[t]+r[t]*e,t===0?360:1)),r=QB(r),i.r=r[0],i.g=r[1],i.b=r[2]}}function dX(i,t){return i&&Object.assign(t||{},i)}function OG(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=_p(i[3]))):(t=dX(i,{r:0,g:0,b:0,a:1}),t.a=_p(t.a)),t}function ddt(i){return i.charAt(0)==="r"?cdt(i):rdt(i)}class Uw{constructor(t){if(t instanceof Uw)return t;const e=typeof t;let r;e==="object"?r=OG(t):e==="string"&&(r=qht(t)||sdt(t)||ddt(t)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var t=dX(this._rgb);return t&&(t.a=ud(t.a)),t}set rgb(t){this._rgb=OG(t)}rgbString(){return this._valid?udt(this._rgb):void 0}hexString(){return this._valid?Yht(this._rgb):void 0}hslString(){return this._valid?adt(this._rgb):void 0}mix(t,e){if(t){const r=this.rgb,n=t.rgb;let o;const s=e===o?.5:e,a=2*s-1,u=r.a-n.a,f=((a*u===-1?a:(a+u)/(1+a*u))+1)/2;o=1-f,r.r=255&f*r.r+o*n.r+.5,r.g=255&f*r.g+o*n.g+.5,r.b=255&f*r.b+o*n.b+.5,r.a=s*r.a+(1-s)*n.a,this.rgb=r}return this}interpolate(t,e){return t&&(this._rgb=hdt(this._rgb,t._rgb,e)),this}clone(){return new Uw(this.rgb)}alpha(t){return this._rgb.a=_p(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=DS(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Z2(this._rgb,2,t),this}darken(t){return Z2(this._rgb,2,-t),this}saturate(t){return Z2(this._rgb,1,t),this}desaturate(t){return Z2(this._rgb,1,-t),this}rotate(t){return ndt(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Qh(){}const fdt=(()=>{let i=0;return()=>i++})();function kn(i){return i==null}function Na(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Fn(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function lo(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function $l(i,t){return lo(i)?i:t}function un(i,t){return typeof i>"u"?t:i}const pdt=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,fX=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function ka(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function va(i,t,e,r){let n,o,s;if(Na(i))if(o=i.length,r)for(n=o-1;n>=0;n--)t.call(e,i[n],n);else for(n=0;n<o;n++)t.call(e,i[n],n);else if(Fn(i))for(s=Object.keys(i),o=s.length,n=0;n<o;n++)t.call(e,i[s[n]],s[n])}function pM(i,t){let e,r,n,o;if(!i||!t||i.length!==t.length)return!1;for(e=0,r=i.length;e<r;++e)if(n=i[e],o=t[e],n.datasetIndex!==o.datasetIndex||n.index!==o.index)return!1;return!0}function gM(i){if(Na(i))return i.map(gM);if(Fn(i)){const t=Object.create(null),e=Object.keys(i),r=e.length;let n=0;for(;n<r;++n)t[e[n]]=gM(i[e[n]]);return t}return i}function pX(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function gdt(i,t,e,r){if(!pX(i))return;const n=t[i],o=e[i];Fn(n)&&Fn(o)?Gw(n,o,r):t[i]=gM(o)}function Gw(i,t,e){const r=Na(t)?t:[t],n=r.length;if(!Fn(i))return i;e=e||{};const o=e.merger||gdt;let s;for(let a=0;a<n;++a){if(s=r[a],!Fn(s))continue;const u=Object.keys(s);for(let f=0,g=u.length;f<g;++f)o(u[f],i,s,e)}return i}function vw(i,t){return Gw(i,t,{merger:mdt})}function mdt(i,t,e){if(!pX(i))return;const r=t[i],n=e[i];Fn(r)&&Fn(n)?vw(r,n):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=gM(n))}const zG={"":i=>i,x:i=>i.x,y:i=>i.y};function vdt(i){const t=i.split("."),e=[];let r="";for(const n of t)r+=n,r.endsWith("\\")?r=r.slice(0,-1)+".":(e.push(r),r="");return e}function _dt(i){const t=vdt(i);return e=>{for(const r of t){if(r==="")break;e=e&&e[r]}return e}}function Cp(i,t){return(zG[t]||(zG[t]=_dt(t)))(i)}function tF(i){return i.charAt(0).toUpperCase()+i.slice(1)}const Hw=i=>typeof i<"u",Ep=i=>typeof i=="function",BG=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function ydt(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const ta=Math.PI,Va=2*ta,xdt=Va+ta,mM=Number.POSITIVE_INFINITY,bdt=ta/180,mo=ta/2,Xg=ta/4,FG=ta*2/3,np=Math.log10,dh=Math.sign;function _w(i,t,e){return Math.abs(i-t)<e}function NG(i){const t=Math.round(i);i=_w(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(np(i))),r=i/e;return(r<=1?1:r<=2?2:r<=5?5:10)*e}function wdt(i){const t=[],e=Math.sqrt(i);let r;for(r=1;r<e;r++)i%r===0&&(t.push(r),t.push(i/r));return e===(e|0)&&t.push(e),t.sort((n,o)=>n-o).pop(),t}function Sdt(i){return typeof i=="symbol"||typeof i=="object"&&i!==null&&!(Symbol.toPrimitive in i||"toString"in i||"valueOf"in i)}function g0(i){return!Sdt(i)&&!isNaN(parseFloat(i))&&isFinite(i)}function Tdt(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function gX(i,t,e){let r,n,o;for(r=0,n=i.length;r<n;r++)o=i[r][e],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function ou(i){return i*(ta/180)}function eF(i){return i*(180/ta)}function VG(i){if(!lo(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function mX(i,t){const e=t.x-i.x,r=t.y-i.y,n=Math.sqrt(e*e+r*r);let o=Math.atan2(r,e);return o<-.5*ta&&(o+=Va),{angle:o,distance:n}}function iO(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function Adt(i,t){return(i-t+xdt)%Va-ta}function Ps(i){return(i%Va+Va)%Va}function jw(i,t,e,r){const n=Ps(i),o=Ps(t),s=Ps(e),a=Ps(o-n),u=Ps(s-n),f=Ps(n-o),g=Ps(n-s);return n===o||n===s||r&&o===s||a>u&&f<g}function rs(i,t,e){return Math.max(t,Math.min(e,i))}function Idt(i){return rs(i,-32768,32767)}function md(i,t,e,r=1e-6){return i>=Math.min(t,e)-r&&i<=Math.max(t,e)+r}function iF(i,t,e){e=e||(s=>i[s]<t);let r=i.length-1,n=0,o;for(;r-n>1;)o=n+r>>1,e(o)?n=o:r=o;return{lo:n,hi:r}}const vd=(i,t,e,r)=>iF(i,e,r?n=>{const o=i[n][t];return o<e||o===e&&i[n+1][t]===e}:n=>i[n][t]<e),Mdt=(i,t,e)=>iF(i,e,r=>i[r][t]>=e);function Cdt(i,t,e){let r=0,n=i.length;for(;r<n&&i[r]<t;)r++;for(;n>r&&i[n-1]>e;)n--;return r>0||n<i.length?i.slice(r,n):i}const vX=["push","pop","shift","splice","unshift"];function Edt(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),vX.forEach(e=>{const r="_onData"+tF(e),n=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...o){const s=n.apply(this,o);return i._chartjs.listeners.forEach(a=>{typeof a[r]=="function"&&a[r](...o)}),s}})})}function UG(i,t){const e=i._chartjs;if(!e)return;const r=e.listeners,n=r.indexOf(t);n!==-1&&r.splice(n,1),!(r.length>0)&&(vX.forEach(o=>{delete i[o]}),delete i._chartjs)}function _X(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const yX=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function xX(i,t){let e=[],r=!1;return function(...n){e=n,r||(r=!0,yX.call(window,()=>{r=!1,i.apply(t,e)}))}}function Ddt(i,t){let e;return function(...r){return t?(clearTimeout(e),e=setTimeout(i,t,r)):i.apply(this,r),t}}const rF=i=>i==="start"?"left":i==="end"?"right":"center",Es=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2,Pdt=(i,t,e,r)=>i===(r?"left":"right")?e:i==="center"?(t+e)/2:t;function bX(i,t,e){const r=t.length;let n=0,o=r;if(i._sorted){const{iScale:s,vScale:a,_parsed:u}=i,f=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null,g=s.axis,{min:v,max:y,minDefined:w,maxDefined:I}=s.getUserBounds();if(w){if(n=Math.min(vd(u,g,v).lo,e?r:vd(t,g,s.getPixelForValue(v)).lo),f){const E=u.slice(0,n+1).reverse().findIndex(D=>!kn(D[a.axis]));n-=Math.max(0,E)}n=rs(n,0,r-1)}if(I){let E=Math.max(vd(u,s.axis,y,!0).hi+1,e?0:vd(t,g,s.getPixelForValue(y),!0).hi+1);if(f){const D=u.slice(E-1).findIndex(R=>!kn(R[a.axis]));E+=Math.max(0,D)}o=rs(E,n,r)-n}else o=r-n}return{start:n,count:o}}function wX(i){const{xScale:t,yScale:e,_scaleRanges:r}=i,n={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!r)return i._scaleRanges=n,!0;const o=r.xmin!==t.min||r.xmax!==t.max||r.ymin!==e.min||r.ymax!==e.max;return Object.assign(r,n),o}const q2=i=>i===0||i===1,GG=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*Va/e)),HG=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*Va/e)+1,yw={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*mo)+1,easeOutSine:i=>Math.sin(i*mo),easeInOutSine:i=>-.5*(Math.cos(ta*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>q2(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>q2(i)?i:GG(i,.075,.3),easeOutElastic:i=>q2(i)?i:HG(i,.075,.3),easeInOutElastic(i){return q2(i)?i:i<.5?.5*GG(i*2,.1125,.45):.5+.5*HG(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-yw.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?yw.easeInBounce(i*2)*.5:yw.easeOutBounce(i*2-1)*.5+.5};function nF(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function jG(i){return nF(i)?i:new Uw(i)}function QP(i){return nF(i)?i:new Uw(i).saturate(.5).darken(.1).hexString()}const Ldt=["x","y","borderWidth","radius","tension"],Rdt=["color","borderColor","backgroundColor"];function kdt(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:Rdt},numbers:{type:"number",properties:Ldt}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Odt(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const WG=new Map;function zdt(i,t){t=t||{};const e=i+JSON.stringify(t);let r=WG.get(e);return r||(r=new Intl.NumberFormat(i,t),WG.set(e,r)),r}function PS(i,t,e){return zdt(t,e).format(i)}const SX={values(i){return Na(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const r=this.chart.options.locale;let n,o=i;if(e.length>1){const f=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(f<1e-4||f>1e15)&&(n="scientific"),o=Bdt(i,e)}const s=np(Math.abs(o)),a=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),u={notation:n,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(u,this.options.ticks.format),PS(i,r,u)},logarithmic(i,t,e){if(i===0)return"0";const r=e[t].significand||i/Math.pow(10,Math.floor(np(i)));return[1,2,3,5,10,15].includes(r)||t>.8*e.length?SX.numeric.call(this,i,t,e):""}};function Bdt(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var GC={formatters:SX};function Fdt(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:GC.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const uv=Object.create(null),rO=Object.create(null);function xw(i,t){if(!t)return i;const e=t.split(".");for(let r=0,n=e.length;r<n;++r){const o=e[r];i=i[o]||(i[o]=Object.create(null))}return i}function tL(i,t,e){return typeof t=="string"?Gw(xw(i,t),e):Gw(xw(i,""),t)}class Ndt{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,n)=>QP(n.backgroundColor),this.hoverBorderColor=(r,n)=>QP(n.borderColor),this.hoverColor=(r,n)=>QP(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return tL(this,t,e)}get(t){return xw(this,t)}describe(t,e){return tL(rO,t,e)}override(t,e){return tL(uv,t,e)}route(t,e,r,n){const o=xw(this,t),s=xw(this,r),a="_"+e;Object.defineProperties(o,{[a]:{value:o[e],writable:!0},[e]:{enumerable:!0,get(){const u=this[a],f=s[n];return Fn(u)?Object.assign({},f,u):un(u,f)},set(u){this[a]=u}}})}apply(t){t.forEach(e=>e(this))}}var $a=new Ndt({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[kdt,Odt,Fdt]);function Vdt(i){return!i||kn(i.size)||kn(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function vM(i,t,e,r,n){let o=t[n];return o||(o=t[n]=i.measureText(n).width,e.push(n)),o>r&&(r=o),r}function Udt(i,t,e,r){r=r||{};let n=r.data=r.data||{},o=r.garbageCollect=r.garbageCollect||[];r.font!==t&&(n=r.data={},o=r.garbageCollect=[],r.font=t),i.save(),i.font=t;let s=0;const a=e.length;let u,f,g,v,y;for(u=0;u<a;u++)if(v=e[u],v!=null&&!Na(v))s=vM(i,n,o,s,v);else if(Na(v))for(f=0,g=v.length;f<g;f++)y=v[f],y!=null&&!Na(y)&&(s=vM(i,n,o,s,y));i.restore();const w=o.length/2;if(w>e.length){for(u=0;u<w;u++)delete n[o[u]];o.splice(0,w)}return s}function Yg(i,t,e){const r=i.currentDevicePixelRatio,n=e!==0?Math.max(e/2,.5):0;return Math.round((t-n)*r)/r+n}function $G(i,t){!t&&!i||(t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore())}function nO(i,t,e,r){TX(i,t,e,r,null)}function TX(i,t,e,r,n){let o,s,a,u,f,g,v,y;const w=t.pointStyle,I=t.rotation,E=t.radius;let D=(I||0)*bdt;if(w&&typeof w=="object"&&(o=w.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){i.save(),i.translate(e,r),i.rotate(D),i.drawImage(w,-w.width/2,-w.height/2,w.width,w.height),i.restore();return}if(!(isNaN(E)||E<=0)){switch(i.beginPath(),w){default:n?i.ellipse(e,r,n/2,E,0,0,Va):i.arc(e,r,E,0,Va),i.closePath();break;case"triangle":g=n?n/2:E,i.moveTo(e+Math.sin(D)*g,r-Math.cos(D)*E),D+=FG,i.lineTo(e+Math.sin(D)*g,r-Math.cos(D)*E),D+=FG,i.lineTo(e+Math.sin(D)*g,r-Math.cos(D)*E),i.closePath();break;case"rectRounded":f=E*.516,u=E-f,s=Math.cos(D+Xg)*u,v=Math.cos(D+Xg)*(n?n/2-f:u),a=Math.sin(D+Xg)*u,y=Math.sin(D+Xg)*(n?n/2-f:u),i.arc(e-v,r-a,f,D-ta,D-mo),i.arc(e+y,r-s,f,D-mo,D),i.arc(e+v,r+a,f,D,D+mo),i.arc(e-y,r+s,f,D+mo,D+ta),i.closePath();break;case"rect":if(!I){u=Math.SQRT1_2*E,g=n?n/2:u,i.rect(e-g,r-u,2*g,2*u);break}D+=Xg;case"rectRot":v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+y,r-s),i.lineTo(e+v,r+a),i.lineTo(e-y,r+s),i.closePath();break;case"crossRot":D+=Xg;case"cross":v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+v,r+a),i.moveTo(e+y,r-s),i.lineTo(e-y,r+s);break;case"star":v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+v,r+a),i.moveTo(e+y,r-s),i.lineTo(e-y,r+s),D+=Xg,v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+v,r+a),i.moveTo(e+y,r-s),i.lineTo(e-y,r+s);break;case"line":s=n?n/2:Math.cos(D)*E,a=Math.sin(D)*E,i.moveTo(e-s,r-a),i.lineTo(e+s,r+a);break;case"dash":i.moveTo(e,r),i.lineTo(e+Math.cos(D)*(n?n/2:E),r+Math.sin(D)*E);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function _d(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function HC(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function jC(i){i.restore()}function Gdt(i,t,e,r,n){if(!t)return i.lineTo(e.x,e.y);if(n==="middle"){const o=(t.x+e.x)/2;i.lineTo(o,t.y),i.lineTo(o,e.y)}else n==="after"!=!!r?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function Hdt(i,t,e,r){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(r?t.cp1x:t.cp2x,r?t.cp1y:t.cp2y,r?e.cp2x:e.cp1x,r?e.cp2y:e.cp1y,e.x,e.y)}function jdt(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),kn(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function Wdt(i,t,e,r,n){if(n.strikethrough||n.underline){const o=i.measureText(r),s=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,u=e-o.actualBoundingBoxAscent,f=e+o.actualBoundingBoxDescent,g=n.strikethrough?(u+f)/2:f;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=n.decorationWidth||2,i.moveTo(s,g),i.lineTo(a,g),i.stroke()}}function $dt(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function hv(i,t,e,r,n,o={}){const s=Na(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let u,f;for(i.save(),i.font=n.string,jdt(i,o),u=0;u<s.length;++u)f=s[u],o.backdrop&&$dt(i,o.backdrop),a&&(o.strokeColor&&(i.strokeStyle=o.strokeColor),kn(o.strokeWidth)||(i.lineWidth=o.strokeWidth),i.strokeText(f,e,r,o.maxWidth)),i.fillText(f,e,r,o.maxWidth),Wdt(i,e,r,f,o),r+=Number(n.lineHeight);i.restore()}function Ww(i,t){const{x:e,y:r,w:n,h:o,radius:s}=t;i.arc(e+s.topLeft,r+s.topLeft,s.topLeft,1.5*ta,ta,!0),i.lineTo(e,r+o-s.bottomLeft),i.arc(e+s.bottomLeft,r+o-s.bottomLeft,s.bottomLeft,ta,mo,!0),i.lineTo(e+n-s.bottomRight,r+o),i.arc(e+n-s.bottomRight,r+o-s.bottomRight,s.bottomRight,mo,0,!0),i.lineTo(e+n,r+s.topRight),i.arc(e+n-s.topRight,r+s.topRight,s.topRight,0,-mo,!0),i.lineTo(e+s.topLeft,r)}const Zdt=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,qdt=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Xdt(i,t){const e=(""+i).match(Zdt);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const Ydt=i=>+i||0;function aF(i,t){const e={},r=Fn(t),n=r?Object.keys(t):t,o=Fn(i)?r?s=>un(i[s],i[t[s]]):s=>i[s]:()=>i;for(const s of n)e[s]=Ydt(o(s));return e}function AX(i){return aF(i,{top:"y",right:"x",bottom:"y",left:"x"})}function Jm(i){return aF(i,["topLeft","topRight","bottomLeft","bottomRight"])}function Fs(i){const t=AX(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function $o(i,t){i=i||{},t=t||$a.font;let e=un(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let r=un(i.style,t.style);r&&!(""+r).match(qdt)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const n={family:un(i.family,t.family),lineHeight:Xdt(un(i.lineHeight,t.lineHeight),e),size:e,style:r,weight:un(i.weight,t.weight),string:""};return n.string=Vdt(n),n}function Wb(i,t,e,r){let n=!0,o,s,a;for(o=0,s=i.length;o<s;++o)if(a=i[o],a!==void 0&&(t!==void 0&&typeof a=="function"&&(a=a(t),n=!1),e!==void 0&&Na(a)&&(a=a[e%a.length],n=!1),a!==void 0))return r&&!n&&(r.cacheable=!1),a}function Kdt(i,t,e){const{min:r,max:n}=i,o=fX(t,(n-r)/2),s=(a,u)=>e&&a===0?0:a+u;return{min:s(r,-Math.abs(o)),max:s(n,o)}}function Vp(i,t){return Object.assign(Object.create(i),t)}function oF(i,t=[""],e,r,n=()=>i[0]){const o=e||i;typeof r>"u"&&(r=EX("_fallback",i));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:o,_fallback:r,_getTarget:n,override:a=>oF([a,...i],t,o,r)};return new Proxy(s,{deleteProperty(a,u){return delete a[u],delete a._keys,delete i[0][u],!0},get(a,u){return MX(a,u,()=>aft(u,t,i,a))},getOwnPropertyDescriptor(a,u){return Reflect.getOwnPropertyDescriptor(a._scopes[0],u)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(a,u){return qG(a).includes(u)},ownKeys(a){return qG(a)},set(a,u,f){const g=a._storage||(a._storage=n());return a[u]=g[u]=f,delete a._keys,!0}})}function m0(i,t,e,r){const n={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:IX(i,r),setContext:o=>m0(i,o,e,r),override:o=>m0(i.override(o),t,e,r)};return new Proxy(n,{deleteProperty(o,s){return delete o[s],delete i[s],!0},get(o,s,a){return MX(o,s,()=>Qdt(o,s,a))},getOwnPropertyDescriptor(o,s){return o._descriptors.allKeys?Reflect.has(i,s)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,s)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(o,s){return Reflect.has(i,s)},ownKeys(){return Reflect.ownKeys(i)},set(o,s,a){return i[s]=a,delete o[s],!0}})}function IX(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:r=t.indexable,_allKeys:n=t.allKeys}=i;return{allKeys:n,scriptable:e,indexable:r,isScriptable:Ep(e)?e:()=>e,isIndexable:Ep(r)?r:()=>r}}const Jdt=(i,t)=>i?i+tF(t):t,sF=(i,t)=>Fn(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function MX(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t)||t==="constructor")return i[t];const r=e();return i[t]=r,r}function Qdt(i,t,e){const{_proxy:r,_context:n,_subProxy:o,_descriptors:s}=i;let a=r[t];return Ep(a)&&s.isScriptable(t)&&(a=tft(t,a,i,e)),Na(a)&&a.length&&(a=eft(t,a,i,s.isIndexable)),sF(t,a)&&(a=m0(a,n,o&&o[t],s)),a}function tft(i,t,e,r){const{_proxy:n,_context:o,_subProxy:s,_stack:a}=e;if(a.has(i))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+i);a.add(i);let u=t(o,s||r);return a.delete(i),sF(i,u)&&(u=lF(n._scopes,n,i,u)),u}function eft(i,t,e,r){const{_proxy:n,_context:o,_subProxy:s,_descriptors:a}=e;if(typeof o.index<"u"&&r(i))return t[o.index%t.length];if(Fn(t[0])){const u=t,f=n._scopes.filter(g=>g!==u);t=[];for(const g of u){const v=lF(f,n,i,g);t.push(m0(v,o,s&&s[i],a))}}return t}function CX(i,t,e){return Ep(i)?i(t,e):i}const ift=(i,t)=>i===!0?t:typeof i=="string"?Cp(t,i):void 0;function rft(i,t,e,r,n){for(const o of t){const s=ift(e,o);if(s){i.add(s);const a=CX(s._fallback,e,n);if(typeof a<"u"&&a!==e&&a!==r)return a}else if(s===!1&&typeof r<"u"&&e!==r)return null}return!1}function lF(i,t,e,r){const n=t._rootScopes,o=CX(t._fallback,e,r),s=[...i,...n],a=new Set;a.add(r);let u=ZG(a,s,e,o||e,r);return u===null||typeof o<"u"&&o!==e&&(u=ZG(a,s,o,u,r),u===null)?!1:oF(Array.from(a),[""],n,o,()=>nft(t,e,r))}function ZG(i,t,e,r,n){for(;e;)e=rft(i,t,e,r,n);return e}function nft(i,t,e){const r=i._getTarget();t in r||(r[t]={});const n=r[t];return Na(n)&&Fn(e)?e:n||{}}function aft(i,t,e,r){let n;for(const o of t)if(n=EX(Jdt(o,i),e),typeof n<"u")return sF(i,n)?lF(e,r,i,n):n}function EX(i,t){for(const e of t){if(!e)continue;const r=e[i];if(typeof r<"u")return r}}function qG(i){let t=i._keys;return t||(t=i._keys=oft(i._scopes)),t}function oft(i){const t=new Set;for(const e of i)for(const r of Object.keys(e).filter(n=>!n.startsWith("_")))t.add(r);return Array.from(t)}function DX(i,t,e,r){const{iScale:n}=i,{key:o="r"}=this._parsing,s=new Array(r);let a,u,f,g;for(a=0,u=r;a<u;++a)f=a+e,g=t[f],s[a]={r:n.parse(Cp(g,o),f)};return s}const sft=Number.EPSILON||1e-14,v0=(i,t)=>t<i.length&&!i[t].skip&&i[t],PX=i=>i==="x"?"y":"x";function lft(i,t,e,r){const n=i.skip?t:i,o=t,s=e.skip?t:e,a=iO(o,n),u=iO(s,o);let f=a/(a+u),g=u/(a+u);f=isNaN(f)?0:f,g=isNaN(g)?0:g;const v=r*f,y=r*g;return{previous:{x:o.x-v*(s.x-n.x),y:o.y-v*(s.y-n.y)},next:{x:o.x+y*(s.x-n.x),y:o.y+y*(s.y-n.y)}}}function cft(i,t,e){const r=i.length;let n,o,s,a,u,f=v0(i,0);for(let g=0;g<r-1;++g)if(u=f,f=v0(i,g+1),!(!u||!f)){if(_w(t[g],0,sft)){e[g]=e[g+1]=0;continue}n=e[g]/t[g],o=e[g+1]/t[g],a=Math.pow(n,2)+Math.pow(o,2),!(a<=9)&&(s=3/Math.sqrt(a),e[g]=n*s*t[g],e[g+1]=o*s*t[g])}}function uft(i,t,e="x"){const r=PX(e),n=i.length;let o,s,a,u=v0(i,0);for(let f=0;f<n;++f){if(s=a,a=u,u=v0(i,f+1),!a)continue;const g=a[e],v=a[r];s&&(o=(g-s[e])/3,a[`cp1${e}`]=g-o,a[`cp1${r}`]=v-o*t[f]),u&&(o=(u[e]-g)/3,a[`cp2${e}`]=g+o,a[`cp2${r}`]=v+o*t[f])}}function hft(i,t="x"){const e=PX(t),r=i.length,n=Array(r).fill(0),o=Array(r);let s,a,u,f=v0(i,0);for(s=0;s<r;++s)if(a=u,u=f,f=v0(i,s+1),!!u){if(f){const g=f[t]-u[t];n[s]=g!==0?(f[e]-u[e])/g:0}o[s]=a?f?dh(n[s-1])!==dh(n[s])?0:(n[s-1]+n[s])/2:n[s-1]:n[s]}cft(i,n,o),uft(i,o,t)}function X2(i,t,e){return Math.max(Math.min(i,e),t)}function dft(i,t){let e,r,n,o,s,a=_d(i[0],t);for(e=0,r=i.length;e<r;++e)s=o,o=a,a=e<r-1&&_d(i[e+1],t),o&&(n=i[e],s&&(n.cp1x=X2(n.cp1x,t.left,t.right),n.cp1y=X2(n.cp1y,t.top,t.bottom)),a&&(n.cp2x=X2(n.cp2x,t.left,t.right),n.cp2y=X2(n.cp2y,t.top,t.bottom)))}function fft(i,t,e,r,n){let o,s,a,u;if(t.spanGaps&&(i=i.filter(f=>!f.skip)),t.cubicInterpolationMode==="monotone")hft(i,n);else{let f=r?i[i.length-1]:i[0];for(o=0,s=i.length;o<s;++o)a=i[o],u=lft(f,a,i[Math.min(o+1,s-(r?0:1))%s],t.tension),a.cp1x=u.previous.x,a.cp1y=u.previous.y,a.cp2x=u.next.x,a.cp2y=u.next.y,f=a}t.capBezierPoints&&dft(i,e)}function cF(){return typeof window<"u"&&typeof document<"u"}function uF(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function _M(i,t,e){let r;return typeof i=="string"?(r=parseInt(i,10),i.indexOf("%")!==-1&&(r=r/100*t.parentNode[e])):r=i,r}const WC=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function pft(i,t){return WC(i).getPropertyValue(t)}const gft=["top","right","bottom","left"];function Qm(i,t,e){const r={};e=e?"-"+e:"";for(let n=0;n<4;n++){const o=gft[n];r[o]=parseFloat(i[t+"-"+o+e])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const mft=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function vft(i,t){const e=i.touches,r=e&&e.length?e[0]:i,{offsetX:n,offsetY:o}=r;let s=!1,a,u;if(mft(n,o,i.target))a=n,u=o;else{const f=t.getBoundingClientRect();a=r.clientX-f.left,u=r.clientY-f.top,s=!0}return{x:a,y:u,box:s}}function Mm(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:r}=t,n=WC(e),o=n.boxSizing==="border-box",s=Qm(n,"padding"),a=Qm(n,"border","width"),{x:u,y:f,box:g}=vft(i,e),v=s.left+(g&&a.left),y=s.top+(g&&a.top);let{width:w,height:I}=t;return o&&(w-=s.width+a.width,I-=s.height+a.height),{x:Math.round((u-v)/w*e.width/r),y:Math.round((f-y)/I*e.height/r)}}function _ft(i,t,e){let r,n;if(t===void 0||e===void 0){const o=i&&uF(i);if(!o)t=i.clientWidth,e=i.clientHeight;else{const s=o.getBoundingClientRect(),a=WC(o),u=Qm(a,"border","width"),f=Qm(a,"padding");t=s.width-f.width-u.width,e=s.height-f.height-u.height,r=_M(a.maxWidth,o,"clientWidth"),n=_M(a.maxHeight,o,"clientHeight")}}return{width:t,height:e,maxWidth:r||mM,maxHeight:n||mM}}const ap=i=>Math.round(i*10)/10;function yft(i,t,e,r){const n=WC(i),o=Qm(n,"margin"),s=_M(n.maxWidth,i,"clientWidth")||mM,a=_M(n.maxHeight,i,"clientHeight")||mM,u=_ft(i,t,e);let{width:f,height:g}=u;if(n.boxSizing==="content-box"){const y=Qm(n,"border","width"),w=Qm(n,"padding");f-=w.width+y.width,g-=w.height+y.height}return f=Math.max(0,f-o.width),g=Math.max(0,r?f/r:g-o.height),f=ap(Math.min(f,s,u.maxWidth)),g=ap(Math.min(g,a,u.maxHeight)),f&&!g&&(g=ap(f/2)),(t!==void 0||e!==void 0)&&r&&u.height&&g>u.height&&(g=u.height,f=ap(Math.floor(g*r))),{width:f,height:g}}function XG(i,t,e){const r=t||1,n=ap(i.height*r),o=ap(i.width*r);i.height=ap(i.height),i.width=ap(i.width);const s=i.canvas;return s.style&&(e||!s.style.height&&!s.style.width)&&(s.style.height=`${i.height}px`,s.style.width=`${i.width}px`),i.currentDevicePixelRatio!==r||s.height!==n||s.width!==o?(i.currentDevicePixelRatio=r,s.height=n,s.width=o,i.ctx.setTransform(r,0,0,r,0,0),!0):!1}const xft=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};cF()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return i}();function YG(i,t){const e=pft(i,t),r=e&&e.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Cm(i,t,e,r){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function bft(i,t,e,r){return{x:i.x+e*(t.x-i.x),y:r==="middle"?e<.5?i.y:t.y:r==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function wft(i,t,e,r){const n={x:i.cp2x,y:i.cp2y},o={x:t.cp1x,y:t.cp1y},s=Cm(i,n,e),a=Cm(n,o,e),u=Cm(o,t,e),f=Cm(s,a,e),g=Cm(a,u,e);return Cm(f,g,e)}const Sft=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,r){return e-r},leftForLtr(e,r){return e-r}}},Tft=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function a0(i,t,e){return i?Sft(t,e):Tft()}function LX(i,t){let e,r;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,r=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=r)}function RX(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function kX(i){return i==="angle"?{between:jw,compare:Adt,normalize:Ps}:{between:md,compare:(t,e)=>t-e,normalize:t=>t}}function KG({start:i,end:t,count:e,loop:r,style:n}){return{start:i%e,end:t%e,loop:r&&(t-i+1)%e===0,style:n}}function Aft(i,t,e){const{property:r,start:n,end:o}=e,{between:s,normalize:a}=kX(r),u=t.length;let{start:f,end:g,loop:v}=i,y,w;if(v){for(f+=u,g+=u,y=0,w=u;y<w&&s(a(t[f%u][r]),n,o);++y)f--,g--;f%=u,g%=u}return g<f&&(g+=u),{start:f,end:g,loop:v,style:i.style}}function OX(i,t,e){if(!e)return[i];const{property:r,start:n,end:o}=e,s=t.length,{compare:a,between:u,normalize:f}=kX(r),{start:g,end:v,loop:y,style:w}=Aft(i,t,e),I=[];let E=!1,D=null,R,z,N;const H=()=>u(n,N,R)&&a(n,N)!==0,$=()=>a(o,R)===0||u(o,N,R),X=()=>E||H(),K=()=>!E||$();for(let et=g,rt=g;et<=v;++et)z=t[et%s],!z.skip&&(R=f(z[r]),R!==N&&(E=u(R,n,o),D===null&&X()&&(D=a(R,n)===0?et:rt),D!==null&&K()&&(I.push(KG({start:D,end:et,loop:y,count:s,style:w})),D=null),rt=et,N=R));return D!==null&&I.push(KG({start:D,end:v,loop:y,count:s,style:w})),I}function zX(i,t){const e=[],r=i.segments;for(let n=0;n<r.length;n++){const o=OX(r[n],i.points,t);o.length&&e.push(...o)}return e}function Ift(i,t,e,r){let n=0,o=t-1;if(e&&!r)for(;n<t&&!i[n].skip;)n++;for(;n<t&&i[n].skip;)n++;for(n%=t,e&&(o+=n);o>n&&i[o%t].skip;)o--;return o%=t,{start:n,end:o}}function Mft(i,t,e,r){const n=i.length,o=[];let s=t,a=i[t],u;for(u=t+1;u<=e;++u){const f=i[u%n];f.skip||f.stop?a.skip||(r=!1,o.push({start:t%n,end:(u-1)%n,loop:r}),t=s=f.stop?u:null):(s=u,a.skip&&(t=u)),a=f}return s!==null&&o.push({start:t%n,end:s%n,loop:r}),o}function Cft(i,t){const e=i.points,r=i.options.spanGaps,n=e.length;if(!n)return[];const o=!!i._loop,{start:s,end:a}=Ift(e,n,o,r);if(r===!0)return JG(i,[{start:s,end:a,loop:o}],e,t);const u=a<s?a+n:a,f=!!i._fullLoop&&s===0&&a===n-1;return JG(i,Mft(e,s,u,f),e,t)}function JG(i,t,e,r){return!r||!r.setContext||!e?t:Eft(i,t,e,r)}function Eft(i,t,e,r){const n=i._chart.getContext(),o=QG(i.options),{_datasetIndex:s,options:{spanGaps:a}}=i,u=e.length,f=[];let g=o,v=t[0].start,y=v;function w(I,E,D,R){const z=a?-1:1;if(I!==E){for(I+=u;e[I%u].skip;)I-=z;for(;e[E%u].skip;)E+=z;I%u!==E%u&&(f.push({start:I%u,end:E%u,loop:D,style:R}),g=R,v=E%u)}}for(const I of t){v=a?v:I.start;let E=e[v%u],D;for(y=v+1;y<=I.end;y++){const R=e[y%u];D=QG(r.setContext(Vp(n,{type:"segment",p0:E,p1:R,p0DataIndex:(y-1)%u,p1DataIndex:y%u,datasetIndex:s}))),Dft(D,g)&&w(v,y-1,I.loop,g),E=R,g=D}v<y-1&&w(v,y-1,I.loop,g)}return f}function QG(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function Dft(i,t){if(!t)return!1;const e=[],r=function(n,o){return nF(o)?(e.includes(o)||e.push(o),e.indexOf(o)):o};return JSON.stringify(i,r)!==JSON.stringify(t,r)}function Y2(i,t,e){return i.options.clip?i[e]:t[e]}function Pft(i,t){const{xScale:e,yScale:r}=i;return e&&r?{left:Y2(e,t,"left"),right:Y2(e,t,"right"),top:Y2(r,t,"top"),bottom:Y2(r,t,"bottom")}:t}function BX(i,t){const e=t._clip;if(e.disabled)return!1;const r=Pft(t,i.chartArea);return{left:e.left===!1?0:r.left-(e.left===!0?0:e.left),right:e.right===!1?i.width:r.right+(e.right===!0?0:e.right),top:e.top===!1?0:r.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?i.height:r.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */let Lft=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,r,n){const o=e.listeners[n],s=e.duration;o.forEach(a=>a({chart:t,initial:e.initial,numSteps:s,currentStep:Math.min(r-e.start,s)}))}_refresh(){this._request||(this._running=!0,this._request=yX.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((r,n)=>{if(!r.running||!r.items.length)return;const o=r.items;let s=o.length-1,a=!1,u;for(;s>=0;--s)u=o[s],u._active?(u._total>r.duration&&(r.duration=u._total),u.tick(t),a=!0):(o[s]=o[o.length-1],o.pop());a&&(n.draw(),this._notify(n,r,t,"progress")),o.length||(r.running=!1,this._notify(n,r,t,"complete"),r.initial=!1),e+=o.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let r=e.get(t);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,r)),r}listen(t,e,r){this._getAnims(t).listeners[e].push(r)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((r,n)=>Math.max(r,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const r=e.items;let n=r.length-1;for(;n>=0;--n)r[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};var ad=new Lft;const t6="transparent",Rft={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const r=jG(i||t6),n=r.valid&&jG(t||t6);return n&&n.valid?n.mix(r,e).hexString():t},number(i,t,e){return i+(t-i)*e}};let kft=class{constructor(t,e,r,n){const o=e[r];n=Wb([t.to,n,o,t.from]);const s=Wb([t.from,o,n]);this._active=!0,this._fn=t.fn||Rft[t.type||typeof s],this._easing=yw[t.easing]||yw.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=r,this._from=s,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,r){if(this._active){this._notify(!1);const n=this._target[this._prop],o=r-this._start,s=this._duration-o;this._start=r,this._duration=Math.floor(Math.max(s,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=Wb([t.to,e,n,t.from]),this._from=Wb([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,r=this._duration,n=this._prop,o=this._from,s=this._loop,a=this._to;let u;if(this._active=o!==a&&(s||e<r),!this._active){this._target[n]=a,this._notify(!0);return}if(e<0){this._target[n]=o;return}u=e/r%2,u=s&&u>1?2-u:u,u=this._easing(Math.min(1,Math.max(0,u))),this._target[n]=this._fn(o,a,u)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,r)=>{t.push({res:e,rej:r})})}_notify(t){const e=t?"res":"rej",r=this._promises||[];for(let n=0;n<r.length;n++)r[n][e]()}};class FX{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!Fn(t))return;const e=Object.keys($a.animation),r=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const o=t[n];if(!Fn(o))return;const s={};for(const a of e)s[a]=o[a];(Na(o.properties)&&o.properties||[n]).forEach(a=>{(a===n||!r.has(a))&&r.set(a,s)})})}_animateOptions(t,e){const r=e.options,n=zft(t,r);if(!n)return[];const o=this._createAnimations(n,r);return r.$shared&&Oft(t.options.$animations,r).then(()=>{t.options=r},()=>{}),o}_createAnimations(t,e){const r=this._properties,n=[],o=t.$animations||(t.$animations={}),s=Object.keys(e),a=Date.now();let u;for(u=s.length-1;u>=0;--u){const f=s[u];if(f.charAt(0)==="$")continue;if(f==="options"){n.push(...this._animateOptions(t,e));continue}const g=e[f];let v=o[f];const y=r.get(f);if(v)if(y&&v.active()){v.update(y,g,a);continue}else v.cancel();if(!y||!y.duration){t[f]=g;continue}o[f]=v=new kft(y,t,f,g),n.push(v)}return n}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const r=this._createAnimations(t,e);if(r.length)return ad.add(this._chart,r),!0}}function Oft(i,t){const e=[],r=Object.keys(t);for(let n=0;n<r.length;n++){const o=i[r[n]];o&&o.active()&&e.push(o.wait())}return Promise.all(e)}function zft(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function e6(i,t){const e=i&&i.options||{},r=e.reverse,n=e.min===void 0?t:0,o=e.max===void 0?t:0;return{start:r?o:n,end:r?n:o}}function Bft(i,t,e){if(e===!1)return!1;const r=e6(i,e),n=e6(t,e);return{top:n.end,right:r.end,bottom:n.start,left:r.start}}function Fft(i){let t,e,r,n;return Fn(i)?(t=i.top,e=i.right,r=i.bottom,n=i.left):t=e=r=n=i,{top:t,right:e,bottom:r,left:n,disabled:i===!1}}function NX(i,t){const e=[],r=i._getSortedDatasetMetas(t);let n,o;for(n=0,o=r.length;n<o;++n)e.push(r[n].index);return e}function i6(i,t,e,r={}){const n=i.keys,o=r.mode==="single";let s,a,u,f;if(t===null)return;let g=!1;for(s=0,a=n.length;s<a;++s){if(u=+n[s],u===e){if(g=!0,r.all)continue;break}f=i.values[u],lo(f)&&(o||t===0||dh(t)===dh(f))&&(t+=f)}return!g&&!r.all?0:t}function Nft(i,t){const{iScale:e,vScale:r}=t,n=e.axis==="x"?"x":"y",o=r.axis==="x"?"x":"y",s=Object.keys(i),a=new Array(s.length);let u,f,g;for(u=0,f=s.length;u<f;++u)g=s[u],a[u]={[n]:g,[o]:i[g]};return a}function eL(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function Vft(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function Uft(i){const{min:t,max:e,minDefined:r,maxDefined:n}=i.getUserBounds();return{min:r?t:Number.NEGATIVE_INFINITY,max:n?e:Number.POSITIVE_INFINITY}}function Gft(i,t,e){const r=i[t]||(i[t]={});return r[e]||(r[e]={})}function r6(i,t,e,r){for(const n of t.getMatchingVisibleMetas(r).reverse()){const o=i[n.index];if(e&&o>0||!e&&o<0)return n.index}return null}function n6(i,t){const{chart:e,_cachedMeta:r}=i,n=e._stacks||(e._stacks={}),{iScale:o,vScale:s,index:a}=r,u=o.axis,f=s.axis,g=Vft(o,s,r),v=t.length;let y;for(let w=0;w<v;++w){const I=t[w],{[u]:E,[f]:D}=I,R=I._stacks||(I._stacks={});y=R[f]=Gft(n,g,E),y[a]=D,y._top=r6(y,s,!0,r.type),y._bottom=r6(y,s,!1,r.type);const z=y._visualValues||(y._visualValues={});z[a]=D}}function iL(i,t){const e=i.scales;return Object.keys(e).filter(r=>e[r].axis===t).shift()}function Hft(i,t){return Vp(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function jft(i,t,e){return Vp(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function ob(i,t){const e=i.controller.index,r=i.vScale&&i.vScale.axis;if(r){t=t||i._parsed;for(const n of t){const o=n._stacks;if(!o||o[r]===void 0||o[r][e]===void 0)return;delete o[r][e],o[r]._visualValues!==void 0&&o[r]._visualValues[e]!==void 0&&delete o[r]._visualValues[e]}}}const rL=i=>i==="reset"||i==="none",a6=(i,t)=>t?i:Object.assign({},i),Wft=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:NX(e,!0),values:null};class uu{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=eL(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&ob(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,r=this.getDataset(),n=(v,y,w,I)=>v==="x"?y:v==="r"?I:w,o=e.xAxisID=un(r.xAxisID,iL(t,"x")),s=e.yAxisID=un(r.yAxisID,iL(t,"y")),a=e.rAxisID=un(r.rAxisID,iL(t,"r")),u=e.indexAxis,f=e.iAxisID=n(u,o,s,a),g=e.vAxisID=n(u,s,o,a);e.xScale=this.getScaleForId(o),e.yScale=this.getScaleForId(s),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(f),e.vScale=this.getScaleForId(g)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&UG(this._data,this),t._stacked&&ob(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),r=this._data;if(Fn(e)){const n=this._cachedMeta;this._data=Nft(e,n)}else if(r!==e){if(r){UG(r,this);const n=this._cachedMeta;ob(n),n._parsed=[]}e&&Object.isExtensible(e)&&Edt(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,r=this.getDataset();let n=!1;this._dataCheck();const o=e._stacked;e._stacked=eL(e.vScale,e),e.stack!==r.stack&&(n=!0,ob(e),e.stack=r.stack),this._resyncElements(t),(n||o!==e._stacked)&&(n6(this,e._parsed),e._stacked=eL(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),r=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:r,_data:n}=this,{iScale:o,_stacked:s}=r,a=o.axis;let u=t===0&&e===n.length?!0:r._sorted,f=t>0&&r._parsed[t-1],g,v,y;if(this._parsing===!1)r._parsed=n,r._sorted=!0,y=n;else{Na(n[t])?y=this.parseArrayData(r,n,t,e):Fn(n[t])?y=this.parseObjectData(r,n,t,e):y=this.parsePrimitiveData(r,n,t,e);const w=()=>v[a]===null||f&&v[a]<f[a];for(g=0;g<e;++g)r._parsed[g+t]=v=y[g],u&&(w()&&(u=!1),f=v);r._sorted=u}s&&n6(this,y)}parsePrimitiveData(t,e,r,n){const{iScale:o,vScale:s}=t,a=o.axis,u=s.axis,f=o.getLabels(),g=o===s,v=new Array(n);let y,w,I;for(y=0,w=n;y<w;++y)I=y+r,v[y]={[a]:g||o.parse(f[I],I),[u]:s.parse(e[I],I)};return v}parseArrayData(t,e,r,n){const{xScale:o,yScale:s}=t,a=new Array(n);let u,f,g,v;for(u=0,f=n;u<f;++u)g=u+r,v=e[g],a[u]={x:o.parse(v[0],g),y:s.parse(v[1],g)};return a}parseObjectData(t,e,r,n){const{xScale:o,yScale:s}=t,{xAxisKey:a="x",yAxisKey:u="y"}=this._parsing,f=new Array(n);let g,v,y,w;for(g=0,v=n;g<v;++g)y=g+r,w=e[y],f[g]={x:o.parse(Cp(w,a),y),y:s.parse(Cp(w,u),y)};return f}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,r){const n=this.chart,o=this._cachedMeta,s=e[t.axis],a={keys:NX(n,!0),values:e._stacks[t.axis]._visualValues};return i6(a,s,o.index,{mode:r})}updateRangeFromParsed(t,e,r,n){const o=r[e.axis];let s=o===null?NaN:o;const a=n&&r._stacks[e.axis];n&&a&&(n.values=a,s=i6(n,o,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,e){const r=this._cachedMeta,n=r._parsed,o=r._sorted&&t===r.iScale,s=n.length,a=this._getOtherScale(t),u=Wft(e,r,this.chart),f={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:g,max:v}=Uft(a);let y,w;function I(){w=n[y];const E=w[a.axis];return!lo(w[t.axis])||g>E||v<E}for(y=0;y<s&&!(!I()&&(this.updateRangeFromParsed(f,t,w,u),o));++y);if(o){for(y=s-1;y>=0;--y)if(!I()){this.updateRangeFromParsed(f,t,w,u);break}}return f}getAllParsedValues(t){const e=this._cachedMeta._parsed,r=[];let n,o,s;for(n=0,o=e.length;n<o;++n)s=e[n][t.axis],lo(s)&&r.push(s);return r}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,r=e.iScale,n=e.vScale,o=this.getParsed(t);return{label:r?""+r.getLabelForValue(o[r.axis]):"",value:n?""+n.getLabelForValue(o[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Fft(un(this.options.clip,Bft(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,r=this._cachedMeta,n=r.data||[],o=e.chartArea,s=[],a=this._drawStart||0,u=this._drawCount||n.length-a,f=this.options.drawActiveElementsOnTop;let g;for(r.dataset&&r.dataset.draw(t,o,a,u),g=a;g<a+u;++g){const v=n[g];v.hidden||(v.active&&f?s.push(v):v.draw(t,o))}for(g=0;g<s.length;++g)s[g].draw(t,o)}getStyle(t,e){const r=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(t||0,r)}getContext(t,e,r){const n=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const s=this._cachedMeta.data[t];o=s.$context||(s.$context=jft(this.getContext(),t,s)),o.parsed=this.getParsed(t),o.raw=n.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=Hft(this.chart.getContext(),this.index)),o.dataset=n,o.index=o.datasetIndex=this.index;return o.active=!!e,o.mode=r,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",r){const n=e==="active",o=this._cachedDataOpts,s=t+"-"+e,a=o[s],u=this.enableOptionSharing&&Hw(r);if(a)return a6(a,u);const f=this.chart.config,g=f.datasetElementScopeKeys(this._type,t),v=n?[`${t}Hover`,"hover",t,""]:[t,""],y=f.getOptionScopes(this.getDataset(),g),w=Object.keys($a.elements[t]),I=()=>this.getContext(r,n,e),E=f.resolveNamedOptions(y,w,I,v);return E.$shared&&(E.$shared=u,o[s]=Object.freeze(a6(E,u))),E}_resolveAnimations(t,e,r){const n=this.chart,o=this._cachedDataOpts,s=`animation-${e}`,a=o[s];if(a)return a;let u;if(n.options.animation!==!1){const g=this.chart.config,v=g.datasetAnimationScopeKeys(this._type,e),y=g.getOptionScopes(this.getDataset(),v);u=g.createResolver(y,this.getContext(t,r,e))}const f=new FX(n,u&&u.animations);return u&&u._cacheable&&(o[s]=Object.freeze(f)),f}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||rL(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const r=this.resolveDataElementOptions(t,e),n=this._sharedOptions,o=this.getSharedOptions(r),s=this.includeOptions(e,o)||o!==n;return this.updateSharedOptions(o,e,r),{sharedOptions:o,includeOptions:s}}updateElement(t,e,r,n){rL(n)?Object.assign(t,r):this._resolveAnimations(e,n).update(t,r)}updateSharedOptions(t,e,r){t&&!rL(e)&&this._resolveAnimations(void 0,e).update(t,r)}_setStyle(t,e,r,n){t.active=n;const o=this.getStyle(e,n);this._resolveAnimations(e,r,n).update(t,{options:!n&&this.getSharedOptions(o)||o})}removeHoverStyle(t,e,r){this._setStyle(t,r,"active",!1)}setHoverStyle(t,e,r){this._setStyle(t,r,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,r=this._cachedMeta.data;for(const[a,u,f]of this._syncList)this[a](u,f);this._syncList=[];const n=r.length,o=e.length,s=Math.min(o,n);s&&this.parse(0,s),o>n?this._insertElements(n,o-n,t):o<n&&this._removeElements(o,n-o)}_insertElements(t,e,r=!0){const n=this._cachedMeta,o=n.data,s=t+e;let a;const u=f=>{for(f.length+=e,a=f.length-1;a>=s;a--)f[a]=f[a-e]};for(u(o),a=t;a<s;++a)o[a]=new this.dataElementType;this._parsing&&u(n._parsed),this.parse(t,e),r&&this.updateElements(o,t,e,"reset")}updateElements(t,e,r,n){}_removeElements(t,e){const r=this._cachedMeta;if(this._parsing){const n=r._parsed.splice(t,e);r._stacked&&ob(r,n)}r.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,r,n]=t;this[e](r,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const r=arguments.length-2;r&&this._sync(["_insertElements",t,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Wi(uu,"defaults",{}),Wi(uu,"datasetElementType",null),Wi(uu,"dataElementType",null);function $ft(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let r=[];for(let n=0,o=e.length;n<o;n++)r=r.concat(e[n].controller.getAllParsedValues(i));i._cache.$bar=_X(r.sort((n,o)=>n-o))}return i._cache.$bar}function Zft(i){const t=i.iScale,e=$ft(t,i.type);let r=t._length,n,o,s,a;const u=()=>{s===32767||s===-32768||(Hw(a)&&(r=Math.min(r,Math.abs(s-a)||r)),a=s)};for(n=0,o=e.length;n<o;++n)s=t.getPixelForValue(e[n]),u();for(a=void 0,n=0,o=t.ticks.length;n<o;++n)s=t.getPixelForTick(n),u();return r}function qft(i,t,e,r){const n=e.barThickness;let o,s;return kn(n)?(o=t.min*e.categoryPercentage,s=e.barPercentage):(o=n*r,s=1),{chunk:o/r,ratio:s,start:t.pixels[i]-o/2}}function Xft(i,t,e,r){const n=t.pixels,o=n[i];let s=i>0?n[i-1]:null,a=i<n.length-1?n[i+1]:null;const u=e.categoryPercentage;s===null&&(s=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-s);const f=o-(o-Math.min(s,a))/2*u;return{chunk:Math.abs(a-s)/2*u/r,ratio:e.barPercentage,start:f}}function Yft(i,t,e,r){const n=e.parse(i[0],r),o=e.parse(i[1],r),s=Math.min(n,o),a=Math.max(n,o);let u=s,f=a;Math.abs(s)>Math.abs(a)&&(u=a,f=s),t[e.axis]=f,t._custom={barStart:u,barEnd:f,start:n,end:o,min:s,max:a}}function VX(i,t,e,r){return Na(i)?Yft(i,t,e,r):t[e.axis]=e.parse(i,r),t}function o6(i,t,e,r){const n=i.iScale,o=i.vScale,s=n.getLabels(),a=n===o,u=[];let f,g,v,y;for(f=e,g=e+r;f<g;++f)y=t[f],v={},v[n.axis]=a||n.parse(s[f],f),u.push(VX(y,v,o,f));return u}function nL(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function Kft(i,t,e){return i!==0?dh(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function Jft(i){let t,e,r,n,o;return i.horizontal?(t=i.base>i.x,e="left",r="right"):(t=i.base<i.y,e="bottom",r="top"),t?(n="end",o="start"):(n="start",o="end"),{start:e,end:r,reverse:t,top:n,bottom:o}}function Qft(i,t,e,r){let n=t.borderSkipped;const o={};if(!n){i.borderSkipped=o;return}if(n===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:s,end:a,reverse:u,top:f,bottom:g}=Jft(i);n==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===r?n=f:(e._bottom||0)===r?n=g:(o[s6(g,s,a,u)]=!0,n=f)),o[s6(n,s,a,u)]=!0,i.borderSkipped=o}function s6(i,t,e,r){return r?(i=tpt(i,t,e),i=l6(i,e,t)):i=l6(i,t,e),i}function tpt(i,t,e){return i===t?e:i===e?t:i}function l6(i,t,e){return i==="start"?t:i==="end"?e:i}function ept(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class MI extends uu{parsePrimitiveData(t,e,r,n){return o6(t,e,r,n)}parseArrayData(t,e,r,n){return o6(t,e,r,n)}parseObjectData(t,e,r,n){const{iScale:o,vScale:s}=t,{xAxisKey:a="x",yAxisKey:u="y"}=this._parsing,f=o.axis==="x"?a:u,g=s.axis==="x"?a:u,v=[];let y,w,I,E;for(y=r,w=r+n;y<w;++y)E=e[y],I={},I[o.axis]=o.parse(Cp(E,f),y),v.push(VX(Cp(E,g),I,s,y));return v}updateRangeFromParsed(t,e,r,n){super.updateRangeFromParsed(t,e,r,n);const o=r._custom;o&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:r,vScale:n}=e,o=this.getParsed(t),s=o._custom,a=nL(s)?"["+s.start+", "+s.end+"]":""+n.getLabelForValue(o[n.axis]);return{label:""+r.getLabelForValue(o[r.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,r,n){const o=n==="reset",{index:s,_cachedMeta:{vScale:a}}=this,u=a.getBasePixel(),f=a.isHorizontal(),g=this._getRuler(),{sharedOptions:v,includeOptions:y}=this._getSharedOptions(e,n);for(let w=e;w<e+r;w++){const I=this.getParsed(w),E=o||kn(I[a.axis])?{base:u,head:u}:this._calculateBarValuePixels(w),D=this._calculateBarIndexPixels(w,g),R=(I._stacks||{})[a.axis],z={horizontal:f,base:E.base,enableBorderRadius:!R||nL(I._custom)||s===R._top||s===R._bottom,x:f?E.head:D.center,y:f?D.center:E.head,height:f?D.size:Math.abs(E.size),width:f?Math.abs(E.size):D.size};y&&(z.options=v||this.resolveDataElementOptions(w,t[w].active?"active":n));const N=z.options||t[w].options;Qft(z,N,R,s),ept(z,N,g.ratio),this.updateElement(t[w],w,z,n)}}_getStacks(t,e){const{iScale:r}=this._cachedMeta,n=r.getMatchingVisibleMetas(this._type).filter(g=>g.controller.options.grouped),o=r.options.stacked,s=[],a=this._cachedMeta.controller.getParsed(e),u=a&&a[r.axis],f=g=>{const v=g._parsed.find(w=>w[r.axis]===u),y=v&&v[g.vScale.axis];if(kn(y)||isNaN(y))return!0};for(const g of n)if(!(e!==void 0&&f(g))&&((o===!1||s.indexOf(g.stack)===-1||o===void 0&&g.stack===void 0)&&s.push(g.stack),g.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(r=>t[r].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const r of this.chart.data.datasets)t[un(this.chart.options.indexAxis==="x"?r.xAxisID:r.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,r){const n=this._getStacks(t,r),o=e!==void 0?n.indexOf(e):-1;return o===-1?n.length-1:o}_getRuler(){const t=this.options,e=this._cachedMeta,r=e.iScale,n=[];let o,s;for(o=0,s=e.data.length;o<s;++o)n.push(r.getPixelForValue(this.getParsed(o)[r.axis],o));const a=t.barThickness;return{min:a||Zft(e),pixels:n,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:r,index:n},options:{base:o,minBarLength:s}}=this,a=o||0,u=this.getParsed(t),f=u._custom,g=nL(f);let v=u[e.axis],y=0,w=r?this.applyStack(e,u,r):v,I,E;w!==v&&(y=w-v,w=v),g&&(v=f.barStart,w=f.barEnd-f.barStart,v!==0&&dh(v)!==dh(f.barEnd)&&(y=0),y+=v);const D=!kn(o)&&!g?o:y;let R=e.getPixelForValue(D);if(this.chart.getDataVisibility(t)?I=e.getPixelForValue(y+w):I=R,E=I-R,Math.abs(E)<s){E=Kft(E,e,a)*s,v===a&&(R-=E/2);const z=e.getPixelForDecimal(0),N=e.getPixelForDecimal(1),H=Math.min(z,N),$=Math.max(z,N);R=Math.max(Math.min(R,$),H),I=R+E,r&&!g&&(u._stacks[e.axis]._visualValues[n]=e.getValueForPixel(I)-e.getValueForPixel(R))}if(R===e.getPixelForValue(a)){const z=dh(E)*e.getLineWidthForValue(a)/2;R+=z,E-=z}return{size:E,base:R,head:I,center:I+E/2}}_calculateBarIndexPixels(t,e){const r=e.scale,n=this.options,o=n.skipNull,s=un(n.maxBarThickness,1/0);let a,u;const f=this._getAxisCount();if(e.grouped){const g=o?this._getStackCount(t):e.stackCount,v=n.barThickness==="flex"?Xft(t,e,n,g*f):qft(t,e,n,g*f),y=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,w=this._getAxis().indexOf(un(y,this.getFirstScaleIdForIndexAxis())),I=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+w;a=v.start+v.chunk*I+v.chunk/2,u=Math.min(s,v.chunk*v.ratio)}else a=r.getPixelForValue(this.getParsed(t)[r.axis],t),u=Math.min(s,e.min*e.ratio);return{base:a-u/2,head:a+u/2,center:a,size:u}}draw(){const t=this._cachedMeta,e=t.vScale,r=t.data,n=r.length;let o=0;for(;o<n;++o)this.getParsed(o)[e.axis]!==null&&!r[o].hidden&&r[o].draw(this._ctx)}}Wi(MI,"id","bar"),Wi(MI,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Wi(MI,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class CI extends uu{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,r,n){const o=super.parsePrimitiveData(t,e,r,n);for(let s=0;s<o.length;s++)o[s]._custom=this.resolveDataElementOptions(s+r).radius;return o}parseArrayData(t,e,r,n){const o=super.parseArrayData(t,e,r,n);for(let s=0;s<o.length;s++){const a=e[r+s];o[s]._custom=un(a[2],this.resolveDataElementOptions(s+r).radius)}return o}parseObjectData(t,e,r,n){const o=super.parseObjectData(t,e,r,n);for(let s=0;s<o.length;s++){const a=e[r+s];o[s]._custom=un(a&&a.r&&+a.r,this.resolveDataElementOptions(s+r).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let r=t.length-1;r>=0;--r)e=Math.max(e,t[r].size(this.resolveDataElementOptions(r))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,r=this.chart.data.labels||[],{xScale:n,yScale:o}=e,s=this.getParsed(t),a=n.getLabelForValue(s.x),u=o.getLabelForValue(s.y),f=s._custom;return{label:r[t]||"",value:"("+a+", "+u+(f?", "+f:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,r,n){const o=n==="reset",{iScale:s,vScale:a}=this._cachedMeta,{sharedOptions:u,includeOptions:f}=this._getSharedOptions(e,n),g=s.axis,v=a.axis;for(let y=e;y<e+r;y++){const w=t[y],I=!o&&this.getParsed(y),E={},D=E[g]=o?s.getPixelForDecimal(.5):s.getPixelForValue(I[g]),R=E[v]=o?a.getBasePixel():a.getPixelForValue(I[v]);E.skip=isNaN(D)||isNaN(R),f&&(E.options=u||this.resolveDataElementOptions(y,w.active?"active":n),o&&(E.options.radius=0)),this.updateElement(w,y,E,n)}}resolveDataElementOptions(t,e){const r=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const o=n.radius;return e!=="active"&&(n.radius=0),n.radius+=un(r&&r._custom,o),n}}Wi(CI,"id","bubble"),Wi(CI,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),Wi(CI,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function ipt(i,t,e){let r=1,n=1,o=0,s=0;if(t<Va){const a=i,u=a+t,f=Math.cos(a),g=Math.sin(a),v=Math.cos(u),y=Math.sin(u),w=(N,H,$)=>jw(N,a,u,!0)?1:Math.max(H,H*e,$,$*e),I=(N,H,$)=>jw(N,a,u,!0)?-1:Math.min(H,H*e,$,$*e),E=w(0,f,v),D=w(mo,g,y),R=I(ta,f,v),z=I(ta+mo,g,y);r=(E-R)/2,n=(D-z)/2,o=-(E+R)/2,s=-(D+z)/2}return{ratioX:r,ratioY:n,offsetX:o,offsetY:s}}class Vm extends uu{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const r=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=r;else{let o=u=>+r[u];if(Fn(r[t])){const{key:u="value"}=this._parsing;o=f=>+Cp(r[f],u)}let s,a;for(s=t,a=t+e;s<a;++s)n._parsed[s]=o(s)}}_getRotation(){return ou(this.options.rotation-90)}_getCircumference(){return ou(this.options.circumference)}_getRotationExtents(){let t=Va,e=-Va;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const n=this.chart.getDatasetMeta(r).controller,o=n._getRotation(),s=n._getCircumference();t=Math.min(t,o),e=Math.max(e,o+s)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:r}=e,n=this._cachedMeta,o=n.data,s=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(r.width,r.height)-s)/2,0),u=Math.min(pdt(this.options.cutout,a),1),f=this._getRingWeight(this.index),{circumference:g,rotation:v}=this._getRotationExtents(),{ratioX:y,ratioY:w,offsetX:I,offsetY:E}=ipt(v,g,u),D=(r.width-s)/y,R=(r.height-s)/w,z=Math.max(Math.min(D,R)/2,0),N=fX(this.options.radius,z),H=Math.max(N*u,0),$=(N-H)/this._getVisibleDatasetWeightTotal();this.offsetX=I*N,this.offsetY=E*N,n.total=this.calculateTotal(),this.outerRadius=N-$*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-$*f,0),this.updateElements(o,0,o.length,t)}_circumference(t,e){const r=this.options,n=this._cachedMeta,o=this._getCircumference();return e&&r.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*o/Va)}updateElements(t,e,r,n){const o=n==="reset",s=this.chart,a=s.chartArea,f=s.options.animation,g=(a.left+a.right)/2,v=(a.top+a.bottom)/2,y=o&&f.animateScale,w=y?0:this.innerRadius,I=y?0:this.outerRadius,{sharedOptions:E,includeOptions:D}=this._getSharedOptions(e,n);let R=this._getRotation(),z;for(z=0;z<e;++z)R+=this._circumference(z,o);for(z=e;z<e+r;++z){const N=this._circumference(z,o),H=t[z],$={x:g+this.offsetX,y:v+this.offsetY,startAngle:R,endAngle:R+N,circumference:N,outerRadius:I,innerRadius:w};D&&($.options=E||this.resolveDataElementOptions(z,H.active?"active":n)),R+=N,this.updateElement(H,z,$,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let r=0,n;for(n=0;n<e.length;n++){const o=t._parsed[n];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(n)&&!e[n].hidden&&(r+=Math.abs(o))}return r}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?Va*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,r=this.chart,n=r.data.labels||[],o=PS(e._parsed[t],r.options.locale);return{label:n[t]||"",value:o}}getMaxBorderWidth(t){let e=0;const r=this.chart;let n,o,s,a,u;if(!t){for(n=0,o=r.data.datasets.length;n<o;++n)if(r.isDatasetVisible(n)){s=r.getDatasetMeta(n),t=s.data,a=s.controller;break}}if(!t)return 0;for(n=0,o=t.length;n<o;++n)u=a.resolveDataElementOptions(n),u.borderAlign!=="inner"&&(e=Math.max(e,u.borderWidth||0,u.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let r=0,n=t.length;r<n;++r){const o=this.resolveDataElementOptions(r);e=Math.max(e,o.offset||0,o.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let r=0;r<t;++r)this.chart.isDatasetVisible(r)&&(e+=this._getRingWeight(r));return e}_getRingWeight(t){return Math.max(un(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Wi(Vm,"id","doughnut"),Wi(Vm,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Wi(Vm,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),Wi(Vm,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:r,textAlign:n,color:o,useBorderRadius:s,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((u,f)=>{const v=t.getDatasetMeta(0).controller.getStyle(f);return{text:u,fillStyle:v.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(f),lineDash:v.borderDash,lineDashOffset:v.borderDashOffset,lineJoin:v.borderJoinStyle,lineWidth:v.borderWidth,strokeStyle:v.borderColor,textAlign:n,pointStyle:r,borderRadius:s&&(a||v.borderRadius),index:f}}):[]}},onClick(t,e,r){r.chart.toggleDataVisibility(e.index),r.chart.update()}}}});class EI extends uu{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:r,data:n=[],_dataset:o}=e,s=this.chart._animationsDisabled;let{start:a,count:u}=bX(e,n,s);this._drawStart=a,this._drawCount=u,wX(e)&&(a=0,u=n.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!o._decimated,r.points=n;const f=this.resolveDatasetElementOptions(t);this.options.showLine||(f.borderWidth=0),f.segment=this.options.segment,this.updateElement(r,void 0,{animated:!s,options:f},t),this.updateElements(n,a,u,t)}updateElements(t,e,r,n){const o=n==="reset",{iScale:s,vScale:a,_stacked:u,_dataset:f}=this._cachedMeta,{sharedOptions:g,includeOptions:v}=this._getSharedOptions(e,n),y=s.axis,w=a.axis,{spanGaps:I,segment:E}=this.options,D=g0(I)?I:Number.POSITIVE_INFINITY,R=this.chart._animationsDisabled||o||n==="none",z=e+r,N=t.length;let H=e>0&&this.getParsed(e-1);for(let $=0;$<N;++$){const X=t[$],K=R?X:{};if($<e||$>=z){K.skip=!0;continue}const et=this.getParsed($),rt=kn(et[w]),lt=K[y]=s.getPixelForValue(et[y],$),ht=K[w]=o||rt?a.getBasePixel():a.getPixelForValue(u?this.applyStack(a,et,u):et[w],$);K.skip=isNaN(lt)||isNaN(ht)||rt,K.stop=$>0&&Math.abs(et[y]-H[y])>D,E&&(K.parsed=et,K.raw=f.data[$]),v&&(K.options=g||this.resolveDataElementOptions($,X.active?"active":n)),R||this.updateElement(X,$,K,n),H=et}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,r=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return r;const o=n[0].size(this.resolveDataElementOptions(0)),s=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(r,o,s)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Wi(EI,"id","line"),Wi(EI,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Wi(EI,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class bw extends uu{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,r=this.chart,n=r.data.labels||[],o=PS(e._parsed[t].r,r.options.locale);return{label:n[t]||"",value:o}}parseObjectData(t,e,r,n){return DX.bind(this)(t,e,r,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((r,n)=>{const o=this.getParsed(n).r;!isNaN(o)&&this.chart.getDataVisibility(n)&&(o<e.min&&(e.min=o),o>e.max&&(e.max=o))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,r=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),o=Math.max(n/2,0),s=Math.max(r.cutoutPercentage?o/100*r.cutoutPercentage:1,0),a=(o-s)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,r,n){const o=n==="reset",s=this.chart,u=s.options.animation,f=this._cachedMeta.rScale,g=f.xCenter,v=f.yCenter,y=f.getIndexAngle(0)-.5*ta;let w=y,I;const E=360/this.countVisibleElements();for(I=0;I<e;++I)w+=this._computeAngle(I,n,E);for(I=e;I<e+r;I++){const D=t[I];let R=w,z=w+this._computeAngle(I,n,E),N=s.getDataVisibility(I)?f.getDistanceFromCenterForValue(this.getParsed(I).r):0;w=z,o&&(u.animateScale&&(N=0),u.animateRotate&&(R=z=y));const H={x:g,y:v,innerRadius:0,outerRadius:N,startAngle:R,endAngle:z,options:this.resolveDataElementOptions(I,D.active?"active":n)};this.updateElement(D,I,H,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((r,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,r){return this.chart.getDataVisibility(t)?ou(this.resolveDataElementOptions(t,e).angle||r):0}}Wi(bw,"id","polarArea"),Wi(bw,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Wi(bw,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:r,color:n}}=t.legend.options;return e.labels.map((o,s)=>{const u=t.getDatasetMeta(0).controller.getStyle(s);return{text:o,fillStyle:u.backgroundColor,strokeStyle:u.borderColor,fontColor:n,lineWidth:u.borderWidth,pointStyle:r,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,e,r){r.chart.toggleDataVisibility(e.index),r.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class aO extends Vm{}Wi(aO,"id","pie"),Wi(aO,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class DI extends uu{getLabelAndValue(t){const e=this._cachedMeta.vScale,r=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(r[e.axis])}}parseObjectData(t,e,r,n){return DX.bind(this)(t,e,r,n)}update(t){const e=this._cachedMeta,r=e.dataset,n=e.data||[],o=e.iScale.getLabels();if(r.points=n,t!=="resize"){const s=this.resolveDatasetElementOptions(t);this.options.showLine||(s.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===n.length,options:s};this.updateElement(r,void 0,a,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,r,n){const o=this._cachedMeta.rScale,s=n==="reset";for(let a=e;a<e+r;a++){const u=t[a],f=this.resolveDataElementOptions(a,u.active?"active":n),g=o.getPointPositionForValue(a,this.getParsed(a).r),v=s?o.xCenter:g.x,y=s?o.yCenter:g.y,w={x:v,y,angle:g.angle,skip:isNaN(v)||isNaN(y),options:f};this.updateElement(u,a,w,n)}}}Wi(DI,"id","radar"),Wi(DI,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),Wi(DI,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class PI extends uu{getLabelAndValue(t){const e=this._cachedMeta,r=this.chart.data.labels||[],{xScale:n,yScale:o}=e,s=this.getParsed(t),a=n.getLabelForValue(s.x),u=o.getLabelForValue(s.y);return{label:r[t]||"",value:"("+a+", "+u+")"}}update(t){const e=this._cachedMeta,{data:r=[]}=e,n=this.chart._animationsDisabled;let{start:o,count:s}=bX(e,r,n);if(this._drawStart=o,this._drawCount=s,wX(e)&&(o=0,s=r.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:u}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!u._decimated,a.points=r;const f=this.resolveDatasetElementOptions(t);f.segment=this.options.segment,this.updateElement(a,void 0,{animated:!n,options:f},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(r,o,s,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,r,n){const o=n==="reset",{iScale:s,vScale:a,_stacked:u,_dataset:f}=this._cachedMeta,g=this.resolveDataElementOptions(e,n),v=this.getSharedOptions(g),y=this.includeOptions(n,v),w=s.axis,I=a.axis,{spanGaps:E,segment:D}=this.options,R=g0(E)?E:Number.POSITIVE_INFINITY,z=this.chart._animationsDisabled||o||n==="none";let N=e>0&&this.getParsed(e-1);for(let H=e;H<e+r;++H){const $=t[H],X=this.getParsed(H),K=z?$:{},et=kn(X[I]),rt=K[w]=s.getPixelForValue(X[w],H),lt=K[I]=o||et?a.getBasePixel():a.getPixelForValue(u?this.applyStack(a,X,u):X[I],H);K.skip=isNaN(rt)||isNaN(lt)||et,K.stop=H>0&&Math.abs(X[w]-N[w])>R,D&&(K.parsed=X,K.raw=f.data[H]),y&&(K.options=v||this.resolveDataElementOptions(H,$.active?"active":n)),z||this.updateElement($,H,K,n),N=X}this.updateSharedOptions(v,n,g)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let u=e.length-1;u>=0;--u)a=Math.max(a,e[u].size(this.resolveDataElementOptions(u))/2);return a>0&&a}const r=t.dataset,n=r.options&&r.options.borderWidth||0;if(!e.length)return n;const o=e[0].size(this.resolveDataElementOptions(0)),s=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,o,s)/2}}Wi(PI,"id","scatter"),Wi(PI,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),Wi(PI,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var rpt=Object.freeze({__proto__:null,BarController:MI,BubbleController:CI,DoughnutController:Vm,LineController:EI,PieController:aO,PolarAreaController:bw,RadarController:DI,ScatterController:PI});function Kg(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class hF{constructor(t){Wi(this,"options");this.options=t||{}}static override(t){Object.assign(hF.prototype,t)}init(){}formats(){return Kg()}parse(){return Kg()}format(){return Kg()}add(){return Kg()}diff(){return Kg()}startOf(){return Kg()}endOf(){return Kg()}}var npt={_date:hF};function apt(i,t,e,r){const{controller:n,data:o,_sorted:s}=i,a=n._cachedMeta.iScale,u=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&s&&o.length){const f=a._reversePixels?Mdt:vd;if(r){if(n._sharedOptions){const g=o[0],v=typeof g.getRange=="function"&&g.getRange(t);if(v){const y=f(o,t,e-v),w=f(o,t,e+v);return{lo:y.lo,hi:w.hi}}}}else{const g=f(o,t,e);if(u){const{vScale:v}=n._cachedMeta,{_parsed:y}=i,w=y.slice(0,g.lo+1).reverse().findIndex(E=>!kn(E[v.axis]));g.lo-=Math.max(0,w);const I=y.slice(g.hi).findIndex(E=>!kn(E[v.axis]));g.hi+=Math.max(0,I)}return g}}return{lo:0,hi:o.length-1}}function LS(i,t,e,r,n){const o=i.getSortedVisibleDatasetMetas(),s=e[t];for(let a=0,u=o.length;a<u;++a){const{index:f,data:g}=o[a],{lo:v,hi:y}=apt(o[a],t,s,n);for(let w=v;w<=y;++w){const I=g[w];I.skip||r(I,f,w)}}}function opt(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(r,n){const o=t?Math.abs(r.x-n.x):0,s=e?Math.abs(r.y-n.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(s,2))}}function aL(i,t,e,r,n){const o=[];return!n&&!i.isPointInArea(t)||LS(i,e,t,function(a,u,f){!n&&!_d(a,i.chartArea,0)||a.inRange(t.x,t.y,r)&&o.push({element:a,datasetIndex:u,index:f})},!0),o}function spt(i,t,e,r){let n=[];function o(s,a,u){const{startAngle:f,endAngle:g}=s.getProps(["startAngle","endAngle"],r),{angle:v}=mX(s,{x:t.x,y:t.y});jw(v,f,g)&&n.push({element:s,datasetIndex:a,index:u})}return LS(i,e,t,o),n}function lpt(i,t,e,r,n,o){let s=[];const a=opt(e);let u=Number.POSITIVE_INFINITY;function f(g,v,y){const w=g.inRange(t.x,t.y,n);if(r&&!w)return;const I=g.getCenterPoint(n);if(!(!!o||i.isPointInArea(I))&&!w)return;const D=a(t,I);D<u?(s=[{element:g,datasetIndex:v,index:y}],u=D):D===u&&s.push({element:g,datasetIndex:v,index:y})}return LS(i,e,t,f),s}function oL(i,t,e,r,n,o){return!o&&!i.isPointInArea(t)?[]:e==="r"&&!r?spt(i,t,e,n):lpt(i,t,e,r,n,o)}function c6(i,t,e,r,n){const o=[],s=e==="x"?"inXRange":"inYRange";let a=!1;return LS(i,e,t,(u,f,g)=>{u[s]&&u[s](t[e],n)&&(o.push({element:u,datasetIndex:f,index:g}),a=a||u.inRange(t.x,t.y,n))}),r&&!a?[]:o}var cpt={evaluateInteractionItems:LS,modes:{index(i,t,e,r){const n=Mm(t,i),o=e.axis||"x",s=e.includeInvisible||!1,a=e.intersect?aL(i,n,o,r,s):oL(i,n,o,!1,r,s),u=[];return a.length?(i.getSortedVisibleDatasetMetas().forEach(f=>{const g=a[0].index,v=f.data[g];v&&!v.skip&&u.push({element:v,datasetIndex:f.index,index:g})}),u):[]},dataset(i,t,e,r){const n=Mm(t,i),o=e.axis||"xy",s=e.includeInvisible||!1;let a=e.intersect?aL(i,n,o,r,s):oL(i,n,o,!1,r,s);if(a.length>0){const u=a[0].datasetIndex,f=i.getDatasetMeta(u).data;a=[];for(let g=0;g<f.length;++g)a.push({element:f[g],datasetIndex:u,index:g})}return a},point(i,t,e,r){const n=Mm(t,i),o=e.axis||"xy",s=e.includeInvisible||!1;return aL(i,n,o,r,s)},nearest(i,t,e,r){const n=Mm(t,i),o=e.axis||"xy",s=e.includeInvisible||!1;return oL(i,n,o,e.intersect,r,s)},x(i,t,e,r){const n=Mm(t,i);return c6(i,n,"x",e.intersect,r)},y(i,t,e,r){const n=Mm(t,i);return c6(i,n,"y",e.intersect,r)}}};const UX=["left","top","right","bottom"];function sb(i,t){return i.filter(e=>e.pos===t)}function u6(i,t){return i.filter(e=>UX.indexOf(e.pos)===-1&&e.box.axis===t)}function lb(i,t){return i.sort((e,r)=>{const n=t?r:e,o=t?e:r;return n.weight===o.weight?n.index-o.index:n.weight-o.weight})}function upt(i){const t=[];let e,r,n,o,s,a;for(e=0,r=(i||[]).length;e<r;++e)n=i[e],{position:o,options:{stack:s,stackWeight:a=1}}=n,t.push({index:e,box:n,pos:o,horizontal:n.isHorizontal(),weight:n.weight,stack:s&&o+s,stackWeight:a});return t}function hpt(i){const t={};for(const e of i){const{stack:r,pos:n,stackWeight:o}=e;if(!r||!UX.includes(n))continue;const s=t[r]||(t[r]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=o}return t}function dpt(i,t){const e=hpt(i),{vBoxMaxWidth:r,hBoxMaxHeight:n}=t;let o,s,a;for(o=0,s=i.length;o<s;++o){a=i[o];const{fullSize:u}=a.box,f=e[a.stack],g=f&&a.stackWeight/f.weight;a.horizontal?(a.width=g?g*r:u&&t.availableWidth,a.height=n):(a.width=r,a.height=g?g*n:u&&t.availableHeight)}return e}function fpt(i){const t=upt(i),e=lb(t.filter(f=>f.box.fullSize),!0),r=lb(sb(t,"left"),!0),n=lb(sb(t,"right")),o=lb(sb(t,"top"),!0),s=lb(sb(t,"bottom")),a=u6(t,"x"),u=u6(t,"y");return{fullSize:e,leftAndTop:r.concat(o),rightAndBottom:n.concat(u).concat(s).concat(a),chartArea:sb(t,"chartArea"),vertical:r.concat(n).concat(u),horizontal:o.concat(s).concat(a)}}function h6(i,t,e,r){return Math.max(i[e],t[e])+Math.max(i[r],t[r])}function GX(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function ppt(i,t,e,r){const{pos:n,box:o}=e,s=i.maxPadding;if(!Fn(n)){e.size&&(i[n]-=e.size);const v=r[e.stack]||{size:0,count:1};v.size=Math.max(v.size,e.horizontal?o.height:o.width),e.size=v.size/v.count,i[n]+=e.size}o.getPadding&&GX(s,o.getPadding());const a=Math.max(0,t.outerWidth-h6(s,i,"left","right")),u=Math.max(0,t.outerHeight-h6(s,i,"top","bottom")),f=a!==i.w,g=u!==i.h;return i.w=a,i.h=u,e.horizontal?{same:f,other:g}:{same:g,other:f}}function gpt(i){const t=i.maxPadding;function e(r){const n=Math.max(t[r]-i[r],0);return i[r]+=n,n}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function mpt(i,t){const e=t.maxPadding;function r(n){const o={left:0,top:0,right:0,bottom:0};return n.forEach(s=>{o[s]=Math.max(t[s],e[s])}),o}return r(i?["left","right"]:["top","bottom"])}function $b(i,t,e,r){const n=[];let o,s,a,u,f,g;for(o=0,s=i.length,f=0;o<s;++o){a=i[o],u=a.box,u.update(a.width||t.w,a.height||t.h,mpt(a.horizontal,t));const{same:v,other:y}=ppt(t,e,a,r);f|=v&&n.length,g=g||y,u.fullSize||n.push(a)}return f&&$b(n,t,e,r)||g}function K2(i,t,e,r,n){i.top=e,i.left=t,i.right=t+r,i.bottom=e+n,i.width=r,i.height=n}function d6(i,t,e,r){const n=e.padding;let{x:o,y:s}=t;for(const a of i){const u=a.box,f=r[a.stack]||{count:1,placed:0,weight:1},g=a.stackWeight/f.weight||1;if(a.horizontal){const v=t.w*g,y=f.size||u.height;Hw(f.start)&&(s=f.start),u.fullSize?K2(u,n.left,s,e.outerWidth-n.right-n.left,y):K2(u,t.left+f.placed,s,v,y),f.start=s,f.placed+=v,s=u.bottom}else{const v=t.h*g,y=f.size||u.width;Hw(f.start)&&(o=f.start),u.fullSize?K2(u,o,n.top,y,e.outerHeight-n.bottom-n.top):K2(u,o,t.top+f.placed,y,v),f.start=o,f.placed+=v,o=u.right}}t.x=o,t.y=s}var Os={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,r){if(!i)return;const n=Fs(i.options.layout.padding),o=Math.max(t-n.width,0),s=Math.max(e-n.height,0),a=fpt(i.boxes),u=a.vertical,f=a.horizontal;va(i.boxes,E=>{typeof E.beforeLayout=="function"&&E.beforeLayout()});const g=u.reduce((E,D)=>D.box.options&&D.box.options.display===!1?E:E+1,0)||1,v=Object.freeze({outerWidth:t,outerHeight:e,padding:n,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/g,hBoxMaxHeight:s/2}),y=Object.assign({},n);GX(y,Fs(r));const w=Object.assign({maxPadding:y,w:o,h:s,x:n.left,y:n.top},n),I=dpt(u.concat(f),v);$b(a.fullSize,w,v,I),$b(u,w,v,I),$b(f,w,v,I)&&$b(u,w,v,I),gpt(w),d6(a.leftAndTop,w,v,I),w.x+=w.w,w.y+=w.h,d6(a.rightAndBottom,w,v,I),i.chartArea={left:w.left,top:w.top,right:w.left+w.w,bottom:w.top+w.h,height:w.h,width:w.w},va(a.chartArea,E=>{const D=E.box;Object.assign(D,i.chartArea),D.update(w.w,w.h,{left:0,top:0,right:0,bottom:0})})}};class HX{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,r){}removeEventListener(t,e,r){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,r,n){return e=Math.max(0,e||t.width),r=r||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):r)}}isAttached(t){return!0}updateConfig(t){}}class vpt extends HX{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const LI="$chartjs",_pt={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},f6=i=>i===null||i==="";function ypt(i,t){const e=i.style,r=i.getAttribute("height"),n=i.getAttribute("width");if(i[LI]={initial:{height:r,width:n,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",f6(n)){const o=YG(i,"width");o!==void 0&&(i.width=o)}if(f6(r))if(i.style.height==="")i.height=i.width/(t||2);else{const o=YG(i,"height");o!==void 0&&(i.height=o)}return i}const jX=xft?{passive:!0}:!1;function xpt(i,t,e){i&&i.addEventListener(t,e,jX)}function bpt(i,t,e){i&&i.canvas&&i.canvas.removeEventListener(t,e,jX)}function wpt(i,t){const e=_pt[i.type]||i.type,{x:r,y:n}=Mm(i,t);return{type:e,chart:t,native:i,x:r!==void 0?r:null,y:n!==void 0?n:null}}function yM(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function Spt(i,t,e){const r=i.canvas,n=new MutationObserver(o=>{let s=!1;for(const a of o)s=s||yM(a.addedNodes,r),s=s&&!yM(a.removedNodes,r);s&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}function Tpt(i,t,e){const r=i.canvas,n=new MutationObserver(o=>{let s=!1;for(const a of o)s=s||yM(a.removedNodes,r),s=s&&!yM(a.addedNodes,r);s&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}const $w=new Map;let p6=0;function WX(){const i=window.devicePixelRatio;i!==p6&&(p6=i,$w.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function Apt(i,t){$w.size||window.addEventListener("resize",WX),$w.set(i,t)}function Ipt(i){$w.delete(i),$w.size||window.removeEventListener("resize",WX)}function Mpt(i,t,e){const r=i.canvas,n=r&&uF(r);if(!n)return;const o=xX((a,u)=>{const f=n.clientWidth;e(a,u),f<n.clientWidth&&e()},window),s=new ResizeObserver(a=>{const u=a[0],f=u.contentRect.width,g=u.contentRect.height;f===0&&g===0||o(f,g)});return s.observe(n),Apt(i,o),s}function sL(i,t,e){e&&e.disconnect(),t==="resize"&&Ipt(i)}function Cpt(i,t,e){const r=i.canvas,n=xX(o=>{i.ctx!==null&&e(wpt(o,i))},i);return xpt(r,t,n),n}class Ept extends HX{acquireContext(t,e){const r=t&&t.getContext&&t.getContext("2d");return r&&r.canvas===t?(ypt(t,e),r):null}releaseContext(t){const e=t.canvas;if(!e[LI])return!1;const r=e[LI].initial;["height","width"].forEach(o=>{const s=r[o];kn(s)?e.removeAttribute(o):e.setAttribute(o,s)});const n=r.style||{};return Object.keys(n).forEach(o=>{e.style[o]=n[o]}),e.width=e.width,delete e[LI],!0}addEventListener(t,e,r){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),s={attach:Spt,detach:Tpt,resize:Mpt}[e]||Cpt;n[e]=s(t,e,r)}removeEventListener(t,e){const r=t.$proxies||(t.$proxies={}),n=r[e];if(!n)return;({attach:sL,detach:sL,resize:sL}[e]||bpt)(t,e,n),r[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,r,n){return yft(t,e,r,n)}isAttached(t){const e=t&&uF(t);return!!(e&&e.isConnected)}}function Dpt(i){return!cF()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?vpt:Ept}var xI;let Vd=(xI=class{constructor(){Wi(this,"x");Wi(this,"y");Wi(this,"active",!1);Wi(this,"options");Wi(this,"$animations")}tooltipPosition(t){const{x:e,y:r}=this.getProps(["x","y"],t);return{x:e,y:r}}hasValue(){return g0(this.x)&&g0(this.y)}getProps(t,e){const r=this.$animations;if(!e||!r)return this;const n={};return t.forEach(o=>{n[o]=r[o]&&r[o].active()?r[o]._to:this[o]}),n}},Wi(xI,"defaults",{}),Wi(xI,"defaultRoutes"),xI);function Ppt(i,t){const e=i.options.ticks,r=Lpt(i),n=Math.min(e.maxTicksLimit||r,r),o=e.major.enabled?kpt(t):[],s=o.length,a=o[0],u=o[s-1],f=[];if(s>n)return Opt(t,f,o,s/n),f;const g=Rpt(o,t,n);if(s>0){let v,y;const w=s>1?Math.round((u-a)/(s-1)):null;for(J2(t,f,g,kn(w)?0:a-w,a),v=0,y=s-1;v<y;v++)J2(t,f,g,o[v],o[v+1]);return J2(t,f,g,u,kn(w)?t.length:u+w),f}return J2(t,f,g),f}function Lpt(i){const t=i.options.offset,e=i._tickSize(),r=i._length/e+(t?0:1),n=i._maxLength/e;return Math.floor(Math.min(r,n))}function Rpt(i,t,e){const r=zpt(i),n=t.length/e;if(!r)return Math.max(n,1);const o=wdt(r);for(let s=0,a=o.length-1;s<a;s++){const u=o[s];if(u>n)return u}return Math.max(n,1)}function kpt(i){const t=[];let e,r;for(e=0,r=i.length;e<r;e++)i[e].major&&t.push(e);return t}function Opt(i,t,e,r){let n=0,o=e[0],s;for(r=Math.ceil(r),s=0;s<i.length;s++)s===o&&(t.push(i[s]),n++,o=e[n*r])}function J2(i,t,e,r,n){const o=un(r,0),s=Math.min(un(n,i.length),i.length);let a=0,u,f,g;for(e=Math.ceil(e),n&&(u=n-r,e=u/Math.floor(u/e)),g=o;g<0;)a++,g=Math.round(o+a*e);for(f=Math.max(o,0);f<s;f++)f===g&&(t.push(i[f]),a++,g=Math.round(o+a*e))}function zpt(i){const t=i.length;let e,r;if(t<2)return!1;for(r=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==r)return!1;return r}const Bpt=i=>i==="left"?"right":i==="right"?"left":i,g6=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,m6=(i,t)=>Math.min(t||i,i);function v6(i,t){const e=[],r=i.length/t,n=i.length;let o=0;for(;o<n;o+=r)e.push(i[Math.floor(o)]);return e}function Fpt(i,t,e){const r=i.ticks.length,n=Math.min(t,r-1),o=i._startPixel,s=i._endPixel,a=1e-6;let u=i.getPixelForTick(n),f;if(!(e&&(r===1?f=Math.max(u-o,s-u):t===0?f=(i.getPixelForTick(1)-u)/2:f=(u-i.getPixelForTick(n-1))/2,u+=n<t?f:-f,u<o-a||u>s+a)))return u}function Npt(i,t){va(i,e=>{const r=e.gc,n=r.length/2;let o;if(n>t){for(o=0;o<n;++o)delete e.data[r[o]];r.splice(0,n)}})}function cb(i){return i.drawTicks?i.tickLength:0}function _6(i,t){if(!i.display)return 0;const e=$o(i.font,t),r=Fs(i.padding);return(Na(i.text)?i.text.length:1)*e.lineHeight+r.height}function Vpt(i,t){return Vp(i,{scale:t,type:"scale"})}function Upt(i,t,e){return Vp(i,{tick:e,index:t,type:"tick"})}function Gpt(i,t,e){let r=rF(i);return(e&&t!=="right"||!e&&t==="right")&&(r=Bpt(r)),r}function Hpt(i,t,e,r){const{top:n,left:o,bottom:s,right:a,chart:u}=i,{chartArea:f,scales:g}=u;let v=0,y,w,I;const E=s-n,D=a-o;if(i.isHorizontal()){if(w=Es(r,o,a),Fn(e)){const R=Object.keys(e)[0],z=e[R];I=g[R].getPixelForValue(z)+E-t}else e==="center"?I=(f.bottom+f.top)/2+E-t:I=g6(i,e,t);y=a-o}else{if(Fn(e)){const R=Object.keys(e)[0],z=e[R];w=g[R].getPixelForValue(z)-D+t}else e==="center"?w=(f.left+f.right)/2-D+t:w=g6(i,e,t);I=Es(r,s,n),v=e==="left"?-mo:mo}return{titleX:w,titleY:I,maxWidth:y,rotation:v}}let RS=class $X extends Vd{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:r,_suggestedMax:n}=this;return t=$l(t,Number.POSITIVE_INFINITY),e=$l(e,Number.NEGATIVE_INFINITY),r=$l(r,Number.POSITIVE_INFINITY),n=$l(n,Number.NEGATIVE_INFINITY),{min:$l(t,r),max:$l(e,n),minDefined:lo(t),maxDefined:lo(e)}}getMinMax(t){let{min:e,max:r,minDefined:n,maxDefined:o}=this.getUserBounds(),s;if(n&&o)return{min:e,max:r};const a=this.getMatchingVisibleMetas();for(let u=0,f=a.length;u<f;++u)s=a[u].controller.getMinMax(this,t),n||(e=Math.min(e,s.min)),o||(r=Math.max(r,s.max));return e=o&&e>r?r:e,r=n&&e>r?e:r,{min:$l(e,$l(r,e)),max:$l(r,$l(e,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ka(this.options.beforeUpdate,[this])}update(t,e,r){const{beginAtZero:n,grace:o,ticks:s}=this.options,a=s.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Kdt(this,o,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const u=a<this.ticks.length;this._convertTicksToLabels(u?v6(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||s.source==="auto")&&(this.ticks=Ppt(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),u&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,r;this.isHorizontal()?(e=this.left,r=this.right):(e=this.top,r=this.bottom,t=!t),this._startPixel=e,this._endPixel=r,this._reversePixels=t,this._length=r-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ka(this.options.afterUpdate,[this])}beforeSetDimensions(){ka(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ka(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),ka(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ka(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let r,n,o;for(r=0,n=t.length;r<n;r++)o=t[r],o.label=ka(e.callback,[o.value,r,t],this)}afterTickToLabelConversion(){ka(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ka(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,r=m6(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,o=e.maxRotation;let s=n,a,u,f;if(!this._isVisible()||!e.display||n>=o||r<=1||!this.isHorizontal()){this.labelRotation=n;return}const g=this._getLabelSizes(),v=g.widest.width,y=g.highest.height,w=rs(this.chart.width-v,0,this.maxWidth);a=t.offset?this.maxWidth/r:w/(r-1),v+6>a&&(a=w/(r-(t.offset?.5:1)),u=this.maxHeight-cb(t.grid)-e.padding-_6(t.title,this.chart.options.font),f=Math.sqrt(v*v+y*y),s=eF(Math.min(Math.asin(rs((g.highest.height+6)/a,-1,1)),Math.asin(rs(u/f,-1,1))-Math.asin(rs(y/f,-1,1)))),s=Math.max(n,Math.min(o,s))),this.labelRotation=s}afterCalculateLabelRotation(){ka(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ka(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:r,title:n,grid:o}}=this,s=this._isVisible(),a=this.isHorizontal();if(s){const u=_6(n,e.options.font);if(a?(t.width=this.maxWidth,t.height=cb(o)+u):(t.height=this.maxHeight,t.width=cb(o)+u),r.display&&this.ticks.length){const{first:f,last:g,widest:v,highest:y}=this._getLabelSizes(),w=r.padding*2,I=ou(this.labelRotation),E=Math.cos(I),D=Math.sin(I);if(a){const R=r.mirror?0:D*v.width+E*y.height;t.height=Math.min(this.maxHeight,t.height+R+w)}else{const R=r.mirror?0:E*v.width+D*y.height;t.width=Math.min(this.maxWidth,t.width+R+w)}this._calculatePadding(f,g,D,E)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,r,n){const{ticks:{align:o,padding:s},position:a}=this.options,u=this.labelRotation!==0,f=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const g=this.getPixelForTick(0)-this.left,v=this.right-this.getPixelForTick(this.ticks.length-1);let y=0,w=0;u?f?(y=n*t.width,w=r*e.height):(y=r*t.height,w=n*e.width):o==="start"?w=e.width:o==="end"?y=t.width:o!=="inner"&&(y=t.width/2,w=e.width/2),this.paddingLeft=Math.max((y-g+s)*this.width/(this.width-g),0),this.paddingRight=Math.max((w-v+s)*this.width/(this.width-v),0)}else{let g=e.height/2,v=t.height/2;o==="start"?(g=0,v=t.height):o==="end"&&(g=e.height,v=0),this.paddingTop=g+s,this.paddingBottom=v+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ka(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,r;for(e=0,r=t.length;e<r;e++)kn(t[e].label)&&(t.splice(e,1),r--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let r=this.ticks;e<r.length&&(r=v6(r,e)),this._labelSizes=t=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,r){const{ctx:n,_longestTextCache:o}=this,s=[],a=[],u=Math.floor(e/m6(e,r));let f=0,g=0,v,y,w,I,E,D,R,z,N,H,$;for(v=0;v<e;v+=u){if(I=t[v].label,E=this._resolveTickFontOptions(v),n.font=D=E.string,R=o[D]=o[D]||{data:{},gc:[]},z=E.lineHeight,N=H=0,!kn(I)&&!Na(I))N=vM(n,R.data,R.gc,N,I),H=z;else if(Na(I))for(y=0,w=I.length;y<w;++y)$=I[y],!kn($)&&!Na($)&&(N=vM(n,R.data,R.gc,N,$),H+=z);s.push(N),a.push(H),f=Math.max(N,f),g=Math.max(H,g)}Npt(o,e);const X=s.indexOf(f),K=a.indexOf(g),et=rt=>({width:s[rt]||0,height:a[rt]||0});return{first:et(0),last:et(e-1),widest:et(X),highest:et(K),widths:s,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Idt(this._alignToPixels?Yg(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const r=e[t];return r.$context||(r.$context=Upt(this.getContext(),t,r))}return this.$context||(this.$context=Vpt(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=ou(this.labelRotation),r=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),o=this._getLabelSizes(),s=t.autoSkipPadding||0,a=o?o.widest.width+s:0,u=o?o.highest.height+s:0;return this.isHorizontal()?u*r>a*n?a/r:u/n:u*n<a*r?u/r:a/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,r=this.chart,n=this.options,{grid:o,position:s,border:a}=n,u=o.offset,f=this.isHorizontal(),v=this.ticks.length+(u?1:0),y=cb(o),w=[],I=a.setContext(this.getContext()),E=I.display?I.width:0,D=E/2,R=function(Ct){return Yg(r,Ct,E)};let z,N,H,$,X,K,et,rt,lt,ht,yt,ft;if(s==="top")z=R(this.bottom),K=this.bottom-y,rt=z-D,ht=R(t.top)+D,ft=t.bottom;else if(s==="bottom")z=R(this.top),ht=t.top,ft=R(t.bottom)-D,K=z+D,rt=this.top+y;else if(s==="left")z=R(this.right),X=this.right-y,et=z-D,lt=R(t.left)+D,yt=t.right;else if(s==="right")z=R(this.left),lt=t.left,yt=R(t.right)-D,X=z+D,et=this.left+y;else if(e==="x"){if(s==="center")z=R((t.top+t.bottom)/2+.5);else if(Fn(s)){const Ct=Object.keys(s)[0],Gt=s[Ct];z=R(this.chart.scales[Ct].getPixelForValue(Gt))}ht=t.top,ft=t.bottom,K=z+D,rt=K+y}else if(e==="y"){if(s==="center")z=R((t.left+t.right)/2);else if(Fn(s)){const Ct=Object.keys(s)[0],Gt=s[Ct];z=R(this.chart.scales[Ct].getPixelForValue(Gt))}X=z-D,et=X-y,lt=t.left,yt=t.right}const kt=un(n.ticks.maxTicksLimit,v),Rt=Math.max(1,Math.ceil(v/kt));for(N=0;N<v;N+=Rt){const Ct=this.getContext(N),Gt=o.setContext(Ct),Vt=a.setContext(Ct),Qt=Gt.lineWidth,fe=Gt.color,Te=Vt.dash||[],be=Vt.dashOffset,Ge=Gt.tickWidth,li=Gt.tickColor,Pi=Gt.tickBorderDash||[],or=Gt.tickBorderDashOffset;H=Fpt(this,N,u),H!==void 0&&($=Yg(r,H,Qt),f?X=et=lt=yt=$:K=rt=ht=ft=$,w.push({tx1:X,ty1:K,tx2:et,ty2:rt,x1:lt,y1:ht,x2:yt,y2:ft,width:Qt,color:fe,borderDash:Te,borderDashOffset:be,tickWidth:Ge,tickColor:li,tickBorderDash:Pi,tickBorderDashOffset:or}))}return this._ticksLength=v,this._borderValue=z,w}_computeLabelItems(t){const e=this.axis,r=this.options,{position:n,ticks:o}=r,s=this.isHorizontal(),a=this.ticks,{align:u,crossAlign:f,padding:g,mirror:v}=o,y=cb(r.grid),w=y+g,I=v?-g:w,E=-ou(this.labelRotation),D=[];let R,z,N,H,$,X,K,et,rt,lt,ht,yt,ft="middle";if(n==="top")X=this.bottom-I,K=this._getXAxisLabelAlignment();else if(n==="bottom")X=this.top+I,K=this._getXAxisLabelAlignment();else if(n==="left"){const Rt=this._getYAxisLabelAlignment(y);K=Rt.textAlign,$=Rt.x}else if(n==="right"){const Rt=this._getYAxisLabelAlignment(y);K=Rt.textAlign,$=Rt.x}else if(e==="x"){if(n==="center")X=(t.top+t.bottom)/2+w;else if(Fn(n)){const Rt=Object.keys(n)[0],Ct=n[Rt];X=this.chart.scales[Rt].getPixelForValue(Ct)+w}K=this._getXAxisLabelAlignment()}else if(e==="y"){if(n==="center")$=(t.left+t.right)/2-w;else if(Fn(n)){const Rt=Object.keys(n)[0],Ct=n[Rt];$=this.chart.scales[Rt].getPixelForValue(Ct)}K=this._getYAxisLabelAlignment(y).textAlign}e==="y"&&(u==="start"?ft="top":u==="end"&&(ft="bottom"));const kt=this._getLabelSizes();for(R=0,z=a.length;R<z;++R){N=a[R],H=N.label;const Rt=o.setContext(this.getContext(R));et=this.getPixelForTick(R)+o.labelOffset,rt=this._resolveTickFontOptions(R),lt=rt.lineHeight,ht=Na(H)?H.length:1;const Ct=ht/2,Gt=Rt.color,Vt=Rt.textStrokeColor,Qt=Rt.textStrokeWidth;let fe=K;s?($=et,K==="inner"&&(R===z-1?fe=this.options.reverse?"left":"right":R===0?fe=this.options.reverse?"right":"left":fe="center"),n==="top"?f==="near"||E!==0?yt=-ht*lt+lt/2:f==="center"?yt=-kt.highest.height/2-Ct*lt+lt:yt=-kt.highest.height+lt/2:f==="near"||E!==0?yt=lt/2:f==="center"?yt=kt.highest.height/2-Ct*lt:yt=kt.highest.height-ht*lt,v&&(yt*=-1),E!==0&&!Rt.showLabelBackdrop&&($+=lt/2*Math.sin(E))):(X=et,yt=(1-ht)*lt/2);let Te;if(Rt.showLabelBackdrop){const be=Fs(Rt.backdropPadding),Ge=kt.heights[R],li=kt.widths[R];let Pi=yt-be.top,or=0-be.left;switch(ft){case"middle":Pi-=Ge/2;break;case"bottom":Pi-=Ge;break}switch(K){case"center":or-=li/2;break;case"right":or-=li;break;case"inner":R===z-1?or-=li:R>0&&(or-=li/2);break}Te={left:or,top:Pi,width:li+be.width,height:Ge+be.height,color:Rt.backdropColor}}D.push({label:H,font:rt,textOffset:yt,options:{rotation:E,color:Gt,strokeColor:Vt,strokeWidth:Qt,textAlign:fe,textBaseline:ft,translation:[$,X],backdrop:Te}})}return D}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-ou(this.labelRotation))return t==="top"?"left":"right";let n="center";return e.align==="start"?n="left":e.align==="end"?n="right":e.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:r,mirror:n,padding:o}}=this.options,s=this._getLabelSizes(),a=t+o,u=s.widest.width;let f,g;return e==="left"?n?(g=this.right+o,r==="near"?f="left":r==="center"?(f="center",g+=u/2):(f="right",g+=u)):(g=this.right-a,r==="near"?f="right":r==="center"?(f="center",g-=u/2):(f="left",g=this.left)):e==="right"?n?(g=this.left+o,r==="near"?f="right":r==="center"?(f="center",g-=u/2):(f="left",g-=u)):(g=this.left+a,r==="near"?f="left":r==="center"?(f="center",g+=u/2):(f="right",g=this.right)):f="right",{textAlign:f,x:g}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:r,top:n,width:o,height:s}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(r,n,o,s),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(o=>o.value===t);return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,r=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,s;const a=(u,f,g)=>{!g.width||!g.color||(r.save(),r.lineWidth=g.width,r.strokeStyle=g.color,r.setLineDash(g.borderDash||[]),r.lineDashOffset=g.borderDashOffset,r.beginPath(),r.moveTo(u.x,u.y),r.lineTo(f.x,f.y),r.stroke(),r.restore())};if(e.display)for(o=0,s=n.length;o<s;++o){const u=n[o];e.drawOnChartArea&&a({x:u.x1,y:u.y1},{x:u.x2,y:u.y2},u),e.drawTicks&&a({x:u.tx1,y:u.ty1},{x:u.tx2,y:u.ty2},{color:u.tickColor,width:u.tickWidth,borderDash:u.tickBorderDash,borderDashOffset:u.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:r,grid:n}}=this,o=r.setContext(this.getContext()),s=r.display?o.width:0;if(!s)return;const a=n.setContext(this.getContext(0)).lineWidth,u=this._borderValue;let f,g,v,y;this.isHorizontal()?(f=Yg(t,this.left,s)-s/2,g=Yg(t,this.right,a)+a/2,v=y=u):(v=Yg(t,this.top,s)-s/2,y=Yg(t,this.bottom,a)+a/2,f=g=u),e.save(),e.lineWidth=o.width,e.strokeStyle=o.color,e.beginPath(),e.moveTo(f,v),e.lineTo(g,y),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const r=this.ctx,n=this._computeLabelArea();n&&HC(r,n);const o=this.getLabelItems(t);for(const s of o){const a=s.options,u=s.font,f=s.label,g=s.textOffset;hv(r,f,0,g,u,a)}n&&jC(r)}drawTitle(){const{ctx:t,options:{position:e,title:r,reverse:n}}=this;if(!r.display)return;const o=$o(r.font),s=Fs(r.padding),a=r.align;let u=o.lineHeight/2;e==="bottom"||e==="center"||Fn(e)?(u+=s.bottom,Na(r.text)&&(u+=o.lineHeight*(r.text.length-1))):u+=s.top;const{titleX:f,titleY:g,maxWidth:v,rotation:y}=Hpt(this,u,e,a);hv(t,r.text,0,0,o,{color:r.color,maxWidth:v,rotation:y,textAlign:Gpt(a,e,n),textBaseline:"middle",translation:[f,g]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,r=un(t.grid&&t.grid.z,-1),n=un(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==$X.prototype.draw?[{z:e,draw:o=>{this.draw(o)}}]:[{z:r,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",n=[];let o,s;for(o=0,s=e.length;o<s;++o){const a=e[o];a[r]===this.id&&(!t||a.type===t)&&n.push(a)}return n}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return $o(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}};class Q2{constructor(t,e,r){this.type=t,this.scope=e,this.override=r,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let r;$pt(e)&&(r=this.register(e));const n=this.items,o=t.id,s=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in n||(n[o]=t,jpt(t,s,r),this.override&&$a.override(t.id,t.overrides)),s}get(t){return this.items[t]}unregister(t){const e=this.items,r=t.id,n=this.scope;r in e&&delete e[r],n&&r in $a[n]&&(delete $a[n][r],this.override&&delete uv[r])}}function jpt(i,t,e){const r=Gw(Object.create(null),[e?$a.get(e):{},$a.get(t),i.defaults]);$a.set(t,r),i.defaultRoutes&&Wpt(t,i.defaultRoutes),i.descriptors&&$a.describe(t,i.descriptors)}function Wpt(i,t){Object.keys(t).forEach(e=>{const r=e.split("."),n=r.pop(),o=[i].concat(r).join("."),s=t[e].split("."),a=s.pop(),u=s.join(".");$a.route(o,n,u,a)})}function $pt(i){return"id"in i&&"defaults"in i}class Zpt{constructor(){this.controllers=new Q2(uu,"datasets",!0),this.elements=new Q2(Vd,"elements"),this.plugins=new Q2(Object,"plugins"),this.scales=new Q2(RS,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,r){[...e].forEach(n=>{const o=r||this._getRegistryForType(n);r||o.isForType(n)||o===this.plugins&&n.id?this._exec(t,o,n):va(n,s=>{const a=r||this._getRegistryForType(s);this._exec(t,a,s)})})}_exec(t,e,r){const n=tF(t);ka(r["before"+n],[],r),e[t](r),ka(r["after"+n],[],r)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const r=this._typedRegistries[e];if(r.isForType(t))return r}return this.plugins}_get(t,e,r){const n=e.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+r+".");return n}}var th=new Zpt;class qpt{constructor(){this._init=void 0}notify(t,e,r,n){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=n?this._descriptors(t).filter(n):this._descriptors(t),s=this._notify(o,t,e,r);return e==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),s}_notify(t,e,r,n){n=n||{};for(const o of t){const s=o.plugin,a=s[r],u=[e,n,o.options];if(ka(a,u,s)===!1&&n.cancelable)return!1}return!0}invalidate(){kn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const r=t&&t.config,n=un(r.options&&r.options.plugins,{}),o=Xpt(r);return n===!1&&!e?[]:Kpt(t,o,n,e)}_notifyStateChanges(t){const e=this._oldCache||[],r=this._cache,n=(o,s)=>o.filter(a=>!s.some(u=>a.plugin.id===u.plugin.id));this._notify(n(e,r),t,"stop"),this._notify(n(r,e),t,"start")}}function Xpt(i){const t={},e=[],r=Object.keys(th.plugins.items);for(let o=0;o<r.length;o++)e.push(th.getPlugin(r[o]));const n=i.plugins||[];for(let o=0;o<n.length;o++){const s=n[o];e.indexOf(s)===-1&&(e.push(s),t[s.id]=!0)}return{plugins:e,localIds:t}}function Ypt(i,t){return!t&&i===!1?null:i===!0?{}:i}function Kpt(i,{plugins:t,localIds:e},r,n){const o=[],s=i.getContext();for(const a of t){const u=a.id,f=Ypt(r[u],n);f!==null&&o.push({plugin:a,options:Jpt(i.config,{plugin:a,local:e[u]},f,s)})}return o}function Jpt(i,{plugin:t,local:e},r,n){const o=i.pluginScopeKeys(t),s=i.getOptionScopes(r,o);return e&&t.defaults&&s.push(t.defaults),i.createResolver(s,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function oO(i,t){const e=$a.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Qpt(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function tgt(i,t){return i===t?"_index_":"_value_"}function y6(i){if(i==="x"||i==="y"||i==="r")return i}function egt(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function sO(i,...t){if(y6(i))return i;for(const e of t){const r=e.axis||egt(e.position)||i.length>1&&y6(i[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function x6(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function igt(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(r=>r.xAxisID===i||r.yAxisID===i);if(e.length)return x6(i,"x",e[0])||x6(i,"y",e[0])}return{}}function rgt(i,t){const e=uv[i.type]||{scales:{}},r=t.scales||{},n=oO(i.type,t),o=Object.create(null);return Object.keys(r).forEach(s=>{const a=r[s];if(!Fn(a))return console.error(`Invalid scale configuration for scale: ${s}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${s}`);const u=sO(s,a,igt(s,i),$a.scales[a.type]),f=tgt(u,n),g=e.scales||{};o[s]=vw(Object.create(null),[{axis:u},a,g[u],g[f]])}),i.data.datasets.forEach(s=>{const a=s.type||i.type,u=s.indexAxis||oO(a,t),g=(uv[a]||{}).scales||{};Object.keys(g).forEach(v=>{const y=Qpt(v,u),w=s[y+"AxisID"]||y;o[w]=o[w]||Object.create(null),vw(o[w],[{axis:y},r[w],g[v]])})}),Object.keys(o).forEach(s=>{const a=o[s];vw(a,[$a.scales[a.type],$a.scale])}),o}function ZX(i){const t=i.options||(i.options={});t.plugins=un(t.plugins,{}),t.scales=rgt(i,t)}function qX(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function ngt(i){return i=i||{},i.data=qX(i.data),ZX(i),i}const b6=new Map,XX=new Set;function tA(i,t){let e=b6.get(i);return e||(e=t(),b6.set(i,e),XX.add(e)),e}const ub=(i,t,e)=>{const r=Cp(t,e);r!==void 0&&i.add(r)};class agt{constructor(t){this._config=ngt(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=qX(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ZX(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return tA(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return tA(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return tA(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,r=this.type;return tA(`${r}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const r=this._scopeCache;let n=r.get(t);return(!n||e)&&(n=new Map,r.set(t,n)),n}getOptionScopes(t,e,r){const{options:n,type:o}=this,s=this._cachedScopes(t,r),a=s.get(e);if(a)return a;const u=new Set;e.forEach(g=>{t&&(u.add(t),g.forEach(v=>ub(u,t,v))),g.forEach(v=>ub(u,n,v)),g.forEach(v=>ub(u,uv[o]||{},v)),g.forEach(v=>ub(u,$a,v)),g.forEach(v=>ub(u,rO,v))});const f=Array.from(u);return f.length===0&&f.push(Object.create(null)),XX.has(e)&&s.set(e,f),f}chartOptionScopes(){const{options:t,type:e}=this;return[t,uv[e]||{},$a.datasets[e]||{},{type:e},$a,rO]}resolveNamedOptions(t,e,r,n=[""]){const o={$shared:!0},{resolver:s,subPrefixes:a}=w6(this._resolverCache,t,n);let u=s;if(sgt(s,e)){o.$shared=!1,r=Ep(r)?r():r;const f=this.createResolver(t,r,a);u=m0(s,r,f)}for(const f of e)o[f]=u[f];return o}createResolver(t,e,r=[""],n){const{resolver:o}=w6(this._resolverCache,t,r);return Fn(e)?m0(o,e,void 0,n):o}}function w6(i,t,e){let r=i.get(t);r||(r=new Map,i.set(t,r));const n=e.join();let o=r.get(n);return o||(o={resolver:oF(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},r.set(n,o)),o}const ogt=i=>Fn(i)&&Object.getOwnPropertyNames(i).some(t=>Ep(i[t]));function sgt(i,t){const{isScriptable:e,isIndexable:r}=IX(i);for(const n of t){const o=e(n),s=r(n),a=(s||o)&&i[n];if(o&&(Ep(a)||ogt(a))||s&&Na(a))return!0}return!1}var lgt="4.5.1";const cgt=["top","bottom","left","right","chartArea"];function S6(i,t){return i==="top"||i==="bottom"||cgt.indexOf(i)===-1&&t==="x"}function T6(i,t){return function(e,r){return e[i]===r[i]?e[t]-r[t]:e[i]-r[i]}}function A6(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),ka(e&&e.onComplete,[i],t)}function ugt(i){const t=i.chart,e=t.options.animation;ka(e&&e.onProgress,[i],t)}function YX(i){return cF()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const RI={},I6=i=>{const t=YX(i);return Object.values(RI).filter(e=>e.canvas===t).pop()};function hgt(i,t,e){const r=Object.keys(i);for(const n of r){const o=+n;if(o>=t){const s=i[n];delete i[n],(e>0||o>t)&&(i[o+e]=s)}}}function dgt(i,t,e,r){return!e||i.type==="mouseout"?null:r?t:i}class hd{static register(...t){th.add(...t),M6()}static unregister(...t){th.remove(...t),M6()}constructor(t,e){const r=this.config=new agt(e),n=YX(t),o=I6(n);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const s=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||Dpt(n)),this.platform.updateConfig(r);const a=this.platform.acquireContext(n,s.aspectRatio),u=a&&a.canvas,f=u&&u.height,g=u&&u.width;if(this.id=fdt(),this.ctx=a,this.canvas=u,this.width=g,this.height=f,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new qpt,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Ddt(v=>this.update(v),s.resizeDelay||0),this._dataChanges=[],RI[this.id]=this,!a||!u){console.error("Failed to create chart: can't acquire context from the given item");return}ad.listen(this,"complete",A6),ad.listen(this,"progress",ugt),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:r,height:n,_aspectRatio:o}=this;return kn(t)?e&&o?o:n?r/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return th}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():XG(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return $G(this.canvas,this.ctx),this}stop(){return ad.stop(this),this}resize(t,e){ad.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const r=this.options,n=this.canvas,o=r.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(n,t,e,o),a=r.devicePixelRatio||this.platform.getDevicePixelRatio(),u=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,XG(this,a,!0)&&(this.notifyPlugins("resize",{size:s}),ka(r.onResize,[this,s],this),this.attached&&this._doResize(u)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};va(e,(r,n)=>{r.id=n})}buildOrUpdateScales(){const t=this.options,e=t.scales,r=this.scales,n=Object.keys(r).reduce((s,a)=>(s[a]=!1,s),{});let o=[];e&&(o=o.concat(Object.keys(e).map(s=>{const a=e[s],u=sO(s,a),f=u==="r",g=u==="x";return{options:a,dposition:f?"chartArea":g?"bottom":"left",dtype:f?"radialLinear":g?"category":"linear"}}))),va(o,s=>{const a=s.options,u=a.id,f=sO(u,a),g=un(a.type,s.dtype);(a.position===void 0||S6(a.position,f)!==S6(s.dposition))&&(a.position=s.dposition),n[u]=!0;let v=null;if(u in r&&r[u].type===g)v=r[u];else{const y=th.getScale(g);v=new y({id:u,type:g,ctx:this.ctx,chart:this}),r[v.id]=v}v.init(a,t)}),va(n,(s,a)=>{s||delete r[a]}),va(r,s=>{Os.configure(this,s,s.options),Os.addBox(this,s)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,r=t.length;if(t.sort((n,o)=>n.index-o.index),r>e){for(let n=e;n<r;++n)this._destroyDatasetMeta(n);t.splice(e,r-e)}this._sortedMetasets=t.slice(0).sort(T6("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((r,n)=>{e.filter(o=>o===r._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let r,n;for(this._removeUnreferencedMetasets(),r=0,n=e.length;r<n;r++){const o=e[r];let s=this.getDatasetMeta(r);const a=o.type||this.config.type;if(s.type&&s.type!==a&&(this._destroyDatasetMeta(r),s=this.getDatasetMeta(r)),s.type=a,s.indexAxis=o.indexAxis||oO(a,this.options),s.order=o.order||0,s.index=r,s.label=""+o.label,s.visible=this.isDatasetVisible(r),s.controller)s.controller.updateIndex(r),s.controller.linkScales();else{const u=th.getController(a),{datasetElementType:f,dataElementType:g}=$a.datasets[a];Object.assign(u,{dataElementType:th.getElement(g),datasetElementType:f&&th.getElement(f)}),s.controller=new u(this,r),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){va(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const r=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let f=0,g=this.data.datasets.length;f<g;f++){const{controller:v}=this.getDatasetMeta(f),y=!n&&o.indexOf(v)===-1;v.buildOrUpdateElements(y),s=Math.max(+v.getMaxOverflow(),s)}s=this._minPadding=r.layout.autoPadding?s:0,this._updateLayout(s),n||va(o,f=>{f.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(T6("z","_idx"));const{_active:a,_lastEvent:u}=this;u?this._eventHandler(u,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){va(this.scales,t=>{Os.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),r=new Set(t.events);(!BG(e,r)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:r,start:n,count:o}of e){const s=r==="_removeElements"?-o:o;hgt(t,n,s)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,r=o=>new Set(t.filter(s=>s[0]===o).map((s,a)=>a+","+s.splice(1).join(","))),n=r(0);for(let o=1;o<e;o++)if(!BG(n,r(o)))return;return Array.from(n).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Os.update(this,this.width,this.height,t);const e=this.chartArea,r=e.width<=0||e.height<=0;this._layers=[],va(this.boxes,n=>{r&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,o)=>{n._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,r=this.data.datasets.length;e<r;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,r=this.data.datasets.length;e<r;++e)this._updateDataset(e,Ep(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const r=this.getDatasetMeta(t),n={meta:r,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(r.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ad.has(this)?this.attached&&!ad.running(this)&&ad.start(this):(this.draw(),A6({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:r,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,r=[];let n,o;for(n=0,o=e.length;n<o;++n){const s=e[n];(!t||s.visible)&&r.push(s)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,r={meta:t,index:t.index,cancelable:!0},n=BX(this,t);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(n&&HC(e,n),t.controller.draw(),n&&jC(e),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(t){return _d(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,r,n){const o=cpt.modes[e];return typeof o=="function"?o(this,t,r,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],r=this._metasets;let n=r.filter(o=>o&&o._dataset===e).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},r.push(n)),n}getContext(){return this.$context||(this.$context=Vp(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const r=this.getDatasetMeta(t);return typeof r.hidden=="boolean"?!r.hidden:!e.hidden}setDatasetVisibility(t,e){const r=this.getDatasetMeta(t);r.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,r){const n=r?"show":"hide",o=this.getDatasetMeta(t),s=o.controller._resolveAnimations(void 0,n);Hw(e)?(o.data[e].hidden=!r,this.update()):(this.setDatasetVisibility(t,r),s.update(o,{visible:r}),this.update(a=>a.datasetIndex===t?n:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),ad.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),$G(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete RI[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,r=(o,s)=>{e.addEventListener(this,o,s),t[o]=s},n=(o,s,a)=>{o.offsetX=s,o.offsetY=a,this._eventHandler(o)};va(this.options.events,o=>r(o,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,r=(u,f)=>{e.addEventListener(this,u,f),t[u]=f},n=(u,f)=>{t[u]&&(e.removeEventListener(this,u,f),delete t[u])},o=(u,f)=>{this.canvas&&this.resize(u,f)};let s;const a=()=>{n("attach",a),this.attached=!0,this.resize(),r("resize",o),r("detach",s)};s=()=>{this.attached=!1,n("resize",o),this._stop(),this._resize(0,0),r("attach",a)},e.isAttached(this.canvas)?a():s()}unbindEvents(){va(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},va(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,r){const n=r?"set":"remove";let o,s,a,u;for(e==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+n+"DatasetHoverStyle"]()),a=0,u=t.length;a<u;++a){s=t[a];const f=s&&this.getDatasetMeta(s.datasetIndex).controller;f&&f[n+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],r=t.map(({datasetIndex:o,index:s})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[s],index:s}});!pM(r,e)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,e))}notifyPlugins(t,e,r){return this._plugins.notify(this,t,e,r)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,r){const n=this.options.hover,o=(u,f)=>u.filter(g=>!f.some(v=>g.datasetIndex===v.datasetIndex&&g.index===v.index)),s=o(e,t),a=r?t:o(t,e);s.length&&this.updateHoverStyle(s,n.mode,!1),a.length&&n.mode&&this.updateHoverStyle(a,n.mode,!0)}_eventHandler(t,e){const r={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=s=>(s.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",r,n)===!1)return;const o=this._handleEvent(t,e,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,n),(o||r.changed)&&this.render(),this}_handleEvent(t,e,r){const{_active:n=[],options:o}=this,s=e,a=this._getActiveElements(t,n,r,s),u=ydt(t),f=dgt(t,this._lastEvent,r,u);r&&(this._lastEvent=null,ka(o.onHover,[t,a,this],this),u&&ka(o.onClick,[t,a,this],this));const g=!pM(a,n);return(g||e)&&(this._active=a,this._updateHoverStyles(a,n,e)),this._lastEvent=f,g}_getActiveElements(t,e,r,n){if(t.type==="mouseout")return[];if(!r)return e;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,n)}}Wi(hd,"defaults",$a),Wi(hd,"instances",RI),Wi(hd,"overrides",uv),Wi(hd,"registry",th),Wi(hd,"version",lgt),Wi(hd,"getChart",I6);function M6(){return va(hd.instances,i=>i._plugins.invalidate())}function fgt(i,t,e){const{startAngle:r,x:n,y:o,outerRadius:s,innerRadius:a,options:u}=t,{borderWidth:f,borderJoinStyle:g}=u,v=Math.min(f/s,Ps(r-e));if(i.beginPath(),i.arc(n,o,s-f/2,r+v/2,e-v/2),a>0){const y=Math.min(f/a,Ps(r-e));i.arc(n,o,a+f/2,e-y/2,r+y/2,!0)}else{const y=Math.min(f/2,s*Ps(r-e));if(g==="round")i.arc(n,o,y,e-ta/2,r+ta/2,!0);else if(g==="bevel"){const w=2*y*y,I=-w*Math.cos(e+ta/2)+n,E=-w*Math.sin(e+ta/2)+o,D=w*Math.cos(r+ta/2)+n,R=w*Math.sin(r+ta/2)+o;i.lineTo(I,E),i.lineTo(D,R)}}i.closePath(),i.moveTo(0,0),i.rect(0,0,i.canvas.width,i.canvas.height),i.clip("evenodd")}function pgt(i,t,e){const{startAngle:r,pixelMargin:n,x:o,y:s,outerRadius:a,innerRadius:u}=t;let f=n/a;i.beginPath(),i.arc(o,s,a,r-f,e+f),u>n?(f=n/u,i.arc(o,s,u,e+f,r-f,!0)):i.arc(o,s,n,e+mo,r-mo),i.closePath(),i.clip()}function ggt(i){return aF(i,["outerStart","outerEnd","innerStart","innerEnd"])}function mgt(i,t,e,r){const n=ggt(i.options.borderRadius),o=(e-t)/2,s=Math.min(o,r*t/2),a=u=>{const f=(e-Math.min(o,u))*r/2;return rs(u,0,Math.min(o,f))};return{outerStart:a(n.outerStart),outerEnd:a(n.outerEnd),innerStart:rs(n.innerStart,0,s),innerEnd:rs(n.innerEnd,0,s)}}function hy(i,t,e,r){return{x:e+i*Math.cos(t),y:r+i*Math.sin(t)}}function xM(i,t,e,r,n,o){const{x:s,y:a,startAngle:u,pixelMargin:f,innerRadius:g}=t,v=Math.max(t.outerRadius+r+e-f,0),y=g>0?g+r+e+f:0;let w=0;const I=n-u;if(r){const Rt=g>0?g-r:0,Ct=v>0?v-r:0,Gt=(Rt+Ct)/2,Vt=Gt!==0?I*Gt/(Gt+r):I;w=(I-Vt)/2}const E=Math.max(.001,I*v-e/ta)/v,D=(I-E)/2,R=u+D+w,z=n-D-w,{outerStart:N,outerEnd:H,innerStart:$,innerEnd:X}=mgt(t,y,v,z-R),K=v-N,et=v-H,rt=R+N/K,lt=z-H/et,ht=y+$,yt=y+X,ft=R+$/ht,kt=z-X/yt;if(i.beginPath(),o){const Rt=(rt+lt)/2;if(i.arc(s,a,v,rt,Rt),i.arc(s,a,v,Rt,lt),H>0){const Qt=hy(et,lt,s,a);i.arc(Qt.x,Qt.y,H,lt,z+mo)}const Ct=hy(yt,z,s,a);if(i.lineTo(Ct.x,Ct.y),X>0){const Qt=hy(yt,kt,s,a);i.arc(Qt.x,Qt.y,X,z+mo,kt+Math.PI)}const Gt=(z-X/y+(R+$/y))/2;if(i.arc(s,a,y,z-X/y,Gt,!0),i.arc(s,a,y,Gt,R+$/y,!0),$>0){const Qt=hy(ht,ft,s,a);i.arc(Qt.x,Qt.y,$,ft+Math.PI,R-mo)}const Vt=hy(K,R,s,a);if(i.lineTo(Vt.x,Vt.y),N>0){const Qt=hy(K,rt,s,a);i.arc(Qt.x,Qt.y,N,R-mo,rt)}}else{i.moveTo(s,a);const Rt=Math.cos(rt)*v+s,Ct=Math.sin(rt)*v+a;i.lineTo(Rt,Ct);const Gt=Math.cos(lt)*v+s,Vt=Math.sin(lt)*v+a;i.lineTo(Gt,Vt)}i.closePath()}function vgt(i,t,e,r,n){const{fullCircles:o,startAngle:s,circumference:a}=t;let u=t.endAngle;if(o){xM(i,t,e,r,u,n);for(let f=0;f<o;++f)i.fill();isNaN(a)||(u=s+(a%Va||Va))}return xM(i,t,e,r,u,n),i.fill(),u}function _gt(i,t,e,r,n){const{fullCircles:o,startAngle:s,circumference:a,options:u}=t,{borderWidth:f,borderJoinStyle:g,borderDash:v,borderDashOffset:y,borderRadius:w}=u,I=u.borderAlign==="inner";if(!f)return;i.setLineDash(v||[]),i.lineDashOffset=y,I?(i.lineWidth=f*2,i.lineJoin=g||"round"):(i.lineWidth=f,i.lineJoin=g||"bevel");let E=t.endAngle;if(o){xM(i,t,e,r,E,n);for(let D=0;D<o;++D)i.stroke();isNaN(a)||(E=s+(a%Va||Va))}I&&pgt(i,t,E),u.selfJoin&&E-s>=ta&&w===0&&g!=="miter"&&fgt(i,t,E),o||(xM(i,t,e,r,E,n),i.stroke())}class Zb extends Vd{constructor(e){super();Wi(this,"circumference");Wi(this,"endAngle");Wi(this,"fullCircles");Wi(this,"innerRadius");Wi(this,"outerRadius");Wi(this,"pixelMargin");Wi(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,r,n){const o=this.getProps(["x","y"],n),{angle:s,distance:a}=mX(o,{x:e,y:r}),{startAngle:u,endAngle:f,innerRadius:g,outerRadius:v,circumference:y}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),w=(this.options.spacing+this.options.borderWidth)/2,I=un(y,f-u),E=jw(s,u,f)&&u!==f,D=I>=Va||E,R=md(a,g+w,v+w);return D&&R}getCenterPoint(e){const{x:r,y:n,startAngle:o,endAngle:s,innerRadius:a,outerRadius:u}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:f,spacing:g}=this.options,v=(o+s)/2,y=(a+u+g+f)/2;return{x:r+Math.cos(v)*y,y:n+Math.sin(v)*y}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:r,circumference:n}=this,o=(r.offset||0)/4,s=(r.spacing||0)/2,a=r.circular;if(this.pixelMargin=r.borderAlign==="inner"?.33:0,this.fullCircles=n>Va?Math.floor(n/Va):0,n===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const u=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(u)*o,Math.sin(u)*o);const f=1-Math.sin(Math.min(ta,n||0)),g=o*f;e.fillStyle=r.backgroundColor,e.strokeStyle=r.borderColor,vgt(e,this,g,s,a),_gt(e,this,g,s,a),e.restore()}}Wi(Zb,"id","arc"),Wi(Zb,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),Wi(Zb,"defaultRoutes",{backgroundColor:"backgroundColor"}),Wi(Zb,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function KX(i,t,e=t){i.lineCap=un(e.borderCapStyle,t.borderCapStyle),i.setLineDash(un(e.borderDash,t.borderDash)),i.lineDashOffset=un(e.borderDashOffset,t.borderDashOffset),i.lineJoin=un(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=un(e.borderWidth,t.borderWidth),i.strokeStyle=un(e.borderColor,t.borderColor)}function ygt(i,t,e){i.lineTo(e.x,e.y)}function xgt(i){return i.stepped?Gdt:i.tension||i.cubicInterpolationMode==="monotone"?Hdt:ygt}function JX(i,t,e={}){const r=i.length,{start:n=0,end:o=r-1}=e,{start:s,end:a}=t,u=Math.max(n,s),f=Math.min(o,a),g=n<s&&o<s||n>a&&o>a;return{count:r,start:u,loop:t.loop,ilen:f<u&&!g?r+f-u:f-u}}function bgt(i,t,e,r){const{points:n,options:o}=t,{count:s,start:a,loop:u,ilen:f}=JX(n,e,r),g=xgt(o);let{move:v=!0,reverse:y}=r||{},w,I,E;for(w=0;w<=f;++w)I=n[(a+(y?f-w:w))%s],!I.skip&&(v?(i.moveTo(I.x,I.y),v=!1):g(i,E,I,y,o.stepped),E=I);return u&&(I=n[(a+(y?f:0))%s],g(i,E,I,y,o.stepped)),!!u}function wgt(i,t,e,r){const n=t.points,{count:o,start:s,ilen:a}=JX(n,e,r),{move:u=!0,reverse:f}=r||{};let g=0,v=0,y,w,I,E,D,R;const z=H=>(s+(f?a-H:H))%o,N=()=>{E!==D&&(i.lineTo(g,D),i.lineTo(g,E),i.lineTo(g,R))};for(u&&(w=n[z(0)],i.moveTo(w.x,w.y)),y=0;y<=a;++y){if(w=n[z(y)],w.skip)continue;const H=w.x,$=w.y,X=H|0;X===I?($<E?E=$:$>D&&(D=$),g=(v*g+H)/++v):(N(),i.lineTo(H,$),I=X,v=0,E=D=$),R=$}N()}function lO(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?wgt:bgt}function Sgt(i){return i.stepped?bft:i.tension||i.cubicInterpolationMode==="monotone"?wft:Cm}function Tgt(i,t,e,r){let n=t._path;n||(n=t._path=new Path2D,t.path(n,e,r)&&n.closePath()),KX(i,t.options),i.stroke(n)}function Agt(i,t,e,r){const{segments:n,options:o}=t,s=lO(t);for(const a of n)KX(i,o,a.style),i.beginPath(),s(i,t,a,{start:e,end:e+r-1})&&i.closePath(),i.stroke()}const Igt=typeof Path2D=="function";function Mgt(i,t,e,r){Igt&&!t.options.segment?Tgt(i,t,e,r):Agt(i,t,e,r)}class op extends Vd{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const n=r.spanGaps?this._loop:this._fullLoop;fft(this._points,r,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Cft(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,r=t.length;return r&&e[t[r-1].end]}interpolate(t,e){const r=this.options,n=t[e],o=this.points,s=zX(this,{property:e,start:n,end:n});if(!s.length)return;const a=[],u=Sgt(r);let f,g;for(f=0,g=s.length;f<g;++f){const{start:v,end:y}=s[f],w=o[v],I=o[y];if(w===I){a.push(w);continue}const E=Math.abs((n-w[e])/(I[e]-w[e])),D=u(w,I,E,r.stepped);D[e]=t[e],a.push(D)}return a.length===1?a[0]:a}pathSegment(t,e,r){return lO(this)(t,this,e,r)}path(t,e,r){const n=this.segments,o=lO(this);let s=this._loop;e=e||0,r=r||this.points.length-e;for(const a of n)s&=o(t,this,a,{start:e,end:e+r-1});return!!s}draw(t,e,r,n){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),Mgt(t,this,r,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Wi(op,"id","line"),Wi(op,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Wi(op,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Wi(op,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function C6(i,t,e,r){const n=i.options,{[e]:o}=i.getProps([e],r);return Math.abs(t-o)<n.radius+n.hitRadius}class kI extends Vd{constructor(e){super();Wi(this,"parsed");Wi(this,"skip");Wi(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,r,n){const o=this.options,{x:s,y:a}=this.getProps(["x","y"],n);return Math.pow(e-s,2)+Math.pow(r-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(e,r){return C6(this,e,"x",r)}inYRange(e,r){return C6(this,e,"y",r)}getCenterPoint(e){const{x:r,y:n}=this.getProps(["x","y"],e);return{x:r,y:n}}size(e){e=e||this.options||{};let r=e.radius||0;r=Math.max(r,r&&e.hoverRadius||0);const n=r&&e.borderWidth||0;return(r+n)*2}draw(e,r){const n=this.options;this.skip||n.radius<.1||!_d(this,r,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,nO(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}Wi(kI,"id","point"),Wi(kI,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Wi(kI,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function QX(i,t){const{x:e,y:r,base:n,width:o,height:s}=i.getProps(["x","y","base","width","height"],t);let a,u,f,g,v;return i.horizontal?(v=s/2,a=Math.min(e,n),u=Math.max(e,n),f=r-v,g=r+v):(v=o/2,a=e-v,u=e+v,f=Math.min(r,n),g=Math.max(r,n)),{left:a,top:f,right:u,bottom:g}}function sp(i,t,e,r){return i?0:rs(t,e,r)}function Cgt(i,t,e){const r=i.options.borderWidth,n=i.borderSkipped,o=AX(r);return{t:sp(n.top,o.top,0,e),r:sp(n.right,o.right,0,t),b:sp(n.bottom,o.bottom,0,e),l:sp(n.left,o.left,0,t)}}function Egt(i,t,e){const{enableBorderRadius:r}=i.getProps(["enableBorderRadius"]),n=i.options.borderRadius,o=Jm(n),s=Math.min(t,e),a=i.borderSkipped,u=r||Fn(n);return{topLeft:sp(!u||a.top||a.left,o.topLeft,0,s),topRight:sp(!u||a.top||a.right,o.topRight,0,s),bottomLeft:sp(!u||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:sp(!u||a.bottom||a.right,o.bottomRight,0,s)}}function Dgt(i){const t=QX(i),e=t.right-t.left,r=t.bottom-t.top,n=Cgt(i,e/2,r/2),o=Egt(i,e/2,r/2);return{outer:{x:t.left,y:t.top,w:e,h:r,radius:o},inner:{x:t.left+n.l,y:t.top+n.t,w:e-n.l-n.r,h:r-n.t-n.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,o.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(n.b,n.r))}}}}function lL(i,t,e,r){const n=t===null,o=e===null,a=i&&!(n&&o)&&QX(i,r);return a&&(n||md(t,a.left,a.right))&&(o||md(e,a.top,a.bottom))}function Pgt(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function Lgt(i,t){i.rect(t.x,t.y,t.w,t.h)}function cL(i,t,e={}){const r=i.x!==e.x?-t:0,n=i.y!==e.y?-t:0,o=(i.x+i.w!==e.x+e.w?t:0)-r,s=(i.y+i.h!==e.y+e.h?t:0)-n;return{x:i.x+r,y:i.y+n,w:i.w+o,h:i.h+s,radius:i.radius}}class OI extends Vd{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:r,backgroundColor:n}}=this,{inner:o,outer:s}=Dgt(this),a=Pgt(s.radius)?Ww:Lgt;t.save(),(s.w!==o.w||s.h!==o.h)&&(t.beginPath(),a(t,cL(s,e,o)),t.clip(),a(t,cL(o,-e,s)),t.fillStyle=r,t.fill("evenodd")),t.beginPath(),a(t,cL(o,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,r){return lL(this,t,e,r)}inXRange(t,e){return lL(this,t,null,e)}inYRange(t,e){return lL(this,null,t,e)}getCenterPoint(t){const{x:e,y:r,base:n,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(e+n)/2:e,y:o?r:(r+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}Wi(OI,"id","bar"),Wi(OI,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Wi(OI,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Rgt=Object.freeze({__proto__:null,ArcElement:Zb,BarElement:OI,LineElement:op,PointElement:kI});const cO=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],E6=cO.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function tY(i){return cO[i%cO.length]}function eY(i){return E6[i%E6.length]}function kgt(i,t){return i.borderColor=tY(t),i.backgroundColor=eY(t),++t}function Ogt(i,t){return i.backgroundColor=i.data.map(()=>tY(t++)),t}function zgt(i,t){return i.backgroundColor=i.data.map(()=>eY(t++)),t}function Bgt(i){let t=0;return(e,r)=>{const n=i.getDatasetMeta(r).controller;n instanceof Vm?t=Ogt(e,t):n instanceof bw?t=zgt(e,t):n&&(t=kgt(e,t))}}function D6(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function Fgt(i){return i&&(i.borderColor||i.backgroundColor)}function Ngt(){return $a.borderColor!=="rgba(0,0,0,0.1)"||$a.backgroundColor!=="rgba(0,0,0,0.1)"}var Vgt={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:r},options:n}=i.config,{elements:o}=n,s=D6(r)||Fgt(n)||o&&D6(o)||Ngt();if(!e.forceOverride&&s)return;const a=Bgt(i);r.forEach(a)}};function Ugt(i,t,e,r,n){const o=n.samples||r;if(o>=e)return i.slice(t,t+e);const s=[],a=(e-2)/(o-2);let u=0;const f=t+e-1;let g=t,v,y,w,I,E;for(s[u++]=i[g],v=0;v<o-2;v++){let D=0,R=0,z;const N=Math.floor((v+1)*a)+1+t,H=Math.min(Math.floor((v+2)*a)+1,e)+t,$=H-N;for(z=N;z<H;z++)D+=i[z].x,R+=i[z].y;D/=$,R/=$;const X=Math.floor(v*a)+1+t,K=Math.min(Math.floor((v+1)*a)+1,e)+t,{x:et,y:rt}=i[g];for(w=I=-1,z=X;z<K;z++)I=.5*Math.abs((et-D)*(i[z].y-rt)-(et-i[z].x)*(R-rt)),I>w&&(w=I,y=i[z],E=z);s[u++]=y,g=E}return s[u++]=i[f],s}function Ggt(i,t,e,r){let n=0,o=0,s,a,u,f,g,v,y,w,I,E;const D=[],R=t+e-1,z=i[t].x,H=i[R].x-z;for(s=t;s<t+e;++s){a=i[s],u=(a.x-z)/H*r,f=a.y;const $=u|0;if($===g)f<I?(I=f,v=s):f>E&&(E=f,y=s),n=(o*n+a.x)/++o;else{const X=s-1;if(!kn(v)&&!kn(y)){const K=Math.min(v,y),et=Math.max(v,y);K!==w&&K!==X&&D.push({...i[K],x:n}),et!==w&&et!==X&&D.push({...i[et],x:n})}s>0&&X!==w&&D.push(i[X]),D.push(a),g=$,o=0,I=E=f,v=y=w=s}}return D}function iY(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function P6(i){i.data.datasets.forEach(t=>{iY(t)})}function Hgt(i,t){const e=t.length;let r=0,n;const{iScale:o}=i,{min:s,max:a,minDefined:u,maxDefined:f}=o.getUserBounds();return u&&(r=rs(vd(t,o.axis,s).lo,0,e-1)),f?n=rs(vd(t,o.axis,a).hi+1,r,e)-r:n=e-r,{start:r,count:n}}var jgt={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){P6(i);return}const r=i.width;i.data.datasets.forEach((n,o)=>{const{_data:s,indexAxis:a}=n,u=i.getDatasetMeta(o),f=s||n.data;if(Wb([a,i.options.indexAxis])==="y"||!u.controller.supportsDecimation)return;const g=i.scales[u.xAxisID];if(g.type!=="linear"&&g.type!=="time"||i.options.parsing)return;let{start:v,count:y}=Hgt(u,f);const w=e.threshold||4*r;if(y<=w){iY(n);return}kn(s)&&(n._data=f,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(E){this._data=E}}));let I;switch(e.algorithm){case"lttb":I=Ugt(f,v,y,r,e);break;case"min-max":I=Ggt(f,v,y,r);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}n._decimated=I})},destroy(i){P6(i)}};function Wgt(i,t,e){const r=i.segments,n=i.points,o=t.points,s=[];for(const a of r){let{start:u,end:f}=a;f=$C(u,f,n);const g=uO(e,n[u],n[f],a.loop);if(!t.segments){s.push({source:a,target:g,start:n[u],end:n[f]});continue}const v=zX(t,g);for(const y of v){const w=uO(e,o[y.start],o[y.end],y.loop),I=OX(a,n,w);for(const E of I)s.push({source:E,target:y,start:{[e]:L6(g,w,"start",Math.max)},end:{[e]:L6(g,w,"end",Math.min)}})}}return s}function uO(i,t,e,r){if(r)return;let n=t[i],o=e[i];return i==="angle"&&(n=Ps(n),o=Ps(o)),{property:i,start:n,end:o}}function $gt(i,t){const{x:e=null,y:r=null}=i||{},n=t.points,o=[];return t.segments.forEach(({start:s,end:a})=>{a=$C(s,a,n);const u=n[s],f=n[a];r!==null?(o.push({x:u.x,y:r}),o.push({x:f.x,y:r})):e!==null&&(o.push({x:e,y:u.y}),o.push({x:e,y:f.y}))}),o}function $C(i,t,e){for(;t>i;t--){const r=e[t];if(!isNaN(r.x)&&!isNaN(r.y))break}return t}function L6(i,t,e,r){return i&&t?r(i[e],t[e]):i?i[e]:t?t[e]:0}function rY(i,t){let e=[],r=!1;return Na(i)?(r=!0,e=i):e=$gt(i,t),e.length?new op({points:e,options:{tension:0},_loop:r,_fullLoop:r}):null}function R6(i){return i&&i.fill!==!1}function Zgt(i,t,e){let n=i[t].fill;const o=[t];let s;if(!e)return n;for(;n!==!1&&o.indexOf(n)===-1;){if(!lo(n))return n;if(s=i[n],!s)return!1;if(s.visible)return n;o.push(n),n=s.fill}return!1}function qgt(i,t,e){const r=Jgt(i);if(Fn(r))return isNaN(r.value)?!1:r;let n=parseFloat(r);return lo(n)&&Math.floor(n)===n?Xgt(r[0],t,n,e):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function Xgt(i,t,e,r){return(i==="-"||i==="+")&&(e=t+e),e===t||e<0||e>=r?!1:e}function Ygt(i,t){let e=null;return i==="start"?e=t.bottom:i==="end"?e=t.top:Fn(i)?e=t.getPixelForValue(i.value):t.getBasePixel&&(e=t.getBasePixel()),e}function Kgt(i,t,e){let r;return i==="start"?r=e:i==="end"?r=t.options.reverse?t.min:t.max:Fn(i)?r=i.value:r=t.getBaseValue(),r}function Jgt(i){const t=i.options,e=t.fill;let r=un(e&&e.target,e);return r===void 0&&(r=!!t.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function Qgt(i){const{scale:t,index:e,line:r}=i,n=[],o=r.segments,s=r.points,a=tmt(t,e);a.push(rY({x:null,y:t.bottom},r));for(let u=0;u<o.length;u++){const f=o[u];for(let g=f.start;g<=f.end;g++)emt(n,s[g],a)}return new op({points:n,options:{}})}function tmt(i,t){const e=[],r=i.getMatchingVisibleMetas("line");for(let n=0;n<r.length;n++){const o=r[n];if(o.index===t)break;o.hidden||e.unshift(o.dataset)}return e}function emt(i,t,e){const r=[];for(let n=0;n<e.length;n++){const o=e[n],{first:s,last:a,point:u}=imt(o,t,"x");if(!(!u||s&&a)){if(s)r.unshift(u);else if(i.push(u),!a)break}}i.push(...r)}function imt(i,t,e){const r=i.interpolate(t,e);if(!r)return{};const n=r[e],o=i.segments,s=i.points;let a=!1,u=!1;for(let f=0;f<o.length;f++){const g=o[f],v=s[g.start][e],y=s[g.end][e];if(md(n,v,y)){a=n===v,u=n===y;break}}return{first:a,last:u,point:r}}class nY{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,r){const{x:n,y:o,radius:s}=this;return e=e||{start:0,end:Va},t.arc(n,o,s,e.end,e.start,!0),!r.bounds}interpolate(t){const{x:e,y:r,radius:n}=this,o=t.angle;return{x:e+Math.cos(o)*n,y:r+Math.sin(o)*n,angle:o}}}function rmt(i){const{chart:t,fill:e,line:r}=i;if(lo(e))return nmt(t,e);if(e==="stack")return Qgt(i);if(e==="shape")return!0;const n=amt(i);return n instanceof nY?n:rY(n,r)}function nmt(i,t){const e=i.getDatasetMeta(t);return e&&i.isDatasetVisible(t)?e.dataset:null}function amt(i){return(i.scale||{}).getPointPositionForValue?smt(i):omt(i)}function omt(i){const{scale:t={},fill:e}=i,r=Ygt(e,t);if(lo(r)){const n=t.isHorizontal();return{x:n?r:null,y:n?null:r}}return null}function smt(i){const{scale:t,fill:e}=i,r=t.options,n=t.getLabels().length,o=r.reverse?t.max:t.min,s=Kgt(e,t,o),a=[];if(r.grid.circular){const u=t.getPointPositionForValue(0,o);return new nY({x:u.x,y:u.y,radius:t.getDistanceFromCenterForValue(s)})}for(let u=0;u<n;++u)a.push(t.getPointPositionForValue(u,s));return a}function uL(i,t,e){const r=rmt(t),{chart:n,index:o,line:s,scale:a,axis:u}=t,f=s.options,g=f.fill,v=f.backgroundColor,{above:y=v,below:w=v}=g||{},I=n.getDatasetMeta(o),E=BX(n,I);r&&s.points.length&&(HC(i,e),lmt(i,{line:s,target:r,above:y,below:w,area:e,scale:a,axis:u,clip:E}),jC(i))}function lmt(i,t){const{line:e,target:r,above:n,below:o,area:s,scale:a,clip:u}=t,f=e._loop?"angle":t.axis;i.save();let g=o;o!==n&&(f==="x"?(k6(i,r,s.top),hL(i,{line:e,target:r,color:n,scale:a,property:f,clip:u}),i.restore(),i.save(),k6(i,r,s.bottom)):f==="y"&&(O6(i,r,s.left),hL(i,{line:e,target:r,color:o,scale:a,property:f,clip:u}),i.restore(),i.save(),O6(i,r,s.right),g=n)),hL(i,{line:e,target:r,color:g,scale:a,property:f,clip:u}),i.restore()}function k6(i,t,e){const{segments:r,points:n}=t;let o=!0,s=!1;i.beginPath();for(const a of r){const{start:u,end:f}=a,g=n[u],v=n[$C(u,f,n)];o?(i.moveTo(g.x,g.y),o=!1):(i.lineTo(g.x,e),i.lineTo(g.x,g.y)),s=!!t.pathSegment(i,a,{move:s}),s?i.closePath():i.lineTo(v.x,e)}i.lineTo(t.first().x,e),i.closePath(),i.clip()}function O6(i,t,e){const{segments:r,points:n}=t;let o=!0,s=!1;i.beginPath();for(const a of r){const{start:u,end:f}=a,g=n[u],v=n[$C(u,f,n)];o?(i.moveTo(g.x,g.y),o=!1):(i.lineTo(e,g.y),i.lineTo(g.x,g.y)),s=!!t.pathSegment(i,a,{move:s}),s?i.closePath():i.lineTo(e,v.y)}i.lineTo(e,t.first().y),i.closePath(),i.clip()}function hL(i,t){const{line:e,target:r,property:n,color:o,scale:s,clip:a}=t,u=Wgt(e,r,n);for(const{source:f,target:g,start:v,end:y}of u){const{style:{backgroundColor:w=o}={}}=f,I=r!==!0;i.save(),i.fillStyle=w,cmt(i,s,a,I&&uO(n,v,y)),i.beginPath();const E=!!e.pathSegment(i,f);let D;if(I){E?i.closePath():z6(i,r,y,n);const R=!!r.pathSegment(i,g,{move:E,reverse:!0});D=E&&R,D||z6(i,r,v,n)}i.closePath(),i.fill(D?"evenodd":"nonzero"),i.restore()}}function cmt(i,t,e,r){const n=t.chart.chartArea,{property:o,start:s,end:a}=r||{};if(o==="x"||o==="y"){let u,f,g,v;o==="x"?(u=s,f=n.top,g=a,v=n.bottom):(u=n.left,f=s,g=n.right,v=a),i.beginPath(),e&&(u=Math.max(u,e.left),g=Math.min(g,e.right),f=Math.max(f,e.top),v=Math.min(v,e.bottom)),i.rect(u,f,g-u,v-f),i.clip()}}function z6(i,t,e,r){const n=t.interpolate(e,r);n&&i.lineTo(n.x,n.y)}var umt={id:"filler",afterDatasetsUpdate(i,t,e){const r=(i.data.datasets||[]).length,n=[];let o,s,a,u;for(s=0;s<r;++s)o=i.getDatasetMeta(s),a=o.dataset,u=null,a&&a.options&&a instanceof op&&(u={visible:i.isDatasetVisible(s),index:s,fill:qgt(a,s,r),chart:i,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=u,n.push(u);for(s=0;s<r;++s)u=n[s],!(!u||u.fill===!1)&&(u.fill=Zgt(n,s,e.propagate))},beforeDraw(i,t,e){const r=e.drawTime==="beforeDraw",n=i.getSortedVisibleDatasetMetas(),o=i.chartArea;for(let s=n.length-1;s>=0;--s){const a=n[s].$filler;a&&(a.line.updateControlPoints(o,a.axis),r&&a.fill&&uL(i.ctx,a,o))}},beforeDatasetsDraw(i,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const r=i.getSortedVisibleDatasetMetas();for(let n=r.length-1;n>=0;--n){const o=r[n].$filler;R6(o)&&uL(i.ctx,o,i.chartArea)}},beforeDatasetDraw(i,t,e){const r=t.meta.$filler;!R6(r)||e.drawTime!=="beforeDatasetDraw"||uL(i.ctx,r,i.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const B6=(i,t)=>{let{boxHeight:e=t,boxWidth:r=t}=i;return i.usePointStyle&&(e=Math.min(e,t),r=i.pointStyleWidth||Math.min(r,t)),{boxWidth:r,boxHeight:e,itemHeight:Math.max(t,e)}},hmt=(i,t)=>i!==null&&t!==null&&i.datasetIndex===t.datasetIndex&&i.index===t.index;class F6 extends Vd{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,r){this.maxWidth=t,this.maxHeight=e,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=ka(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(r=>t.filter(r,this.chart.data))),t.sort&&(e=e.sort((r,n)=>t.sort(r,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const r=t.labels,n=$o(r.font),o=n.size,s=this._computeTitleHeight(),{boxWidth:a,itemHeight:u}=B6(r,o);let f,g;e.font=n.string,this.isHorizontal()?(f=this.maxWidth,g=this._fitRows(s,o,a,u)+10):(g=this.maxHeight,f=this._fitCols(s,n,a,u)+10),this.width=Math.min(f,t.maxWidth||this.maxWidth),this.height=Math.min(g,t.maxHeight||this.maxHeight)}_fitRows(t,e,r,n){const{ctx:o,maxWidth:s,options:{labels:{padding:a}}}=this,u=this.legendHitBoxes=[],f=this.lineWidths=[0],g=n+a;let v=t;o.textAlign="left",o.textBaseline="middle";let y=-1,w=-g;return this.legendItems.forEach((I,E)=>{const D=r+e/2+o.measureText(I.text).width;(E===0||f[f.length-1]+D+2*a>s)&&(v+=g,f[f.length-(E>0?0:1)]=0,w+=g,y++),u[E]={left:0,top:w,row:y,width:D,height:n},f[f.length-1]+=D+a}),v}_fitCols(t,e,r,n){const{ctx:o,maxHeight:s,options:{labels:{padding:a}}}=this,u=this.legendHitBoxes=[],f=this.columnSizes=[],g=s-t;let v=a,y=0,w=0,I=0,E=0;return this.legendItems.forEach((D,R)=>{const{itemWidth:z,itemHeight:N}=dmt(r,e,o,D,n);R>0&&w+N+2*a>g&&(v+=y+a,f.push({width:y,height:w}),I+=y+a,E++,y=w=0),u[R]={left:I,top:w,col:E,width:z,height:N},y=Math.max(y,z),w+=N+a}),v+=y,f.push({width:y,height:w}),v}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:r,labels:{padding:n},rtl:o}}=this,s=a0(o,this.left,this.width);if(this.isHorizontal()){let a=0,u=Es(r,this.left+n,this.right-this.lineWidths[a]);for(const f of e)a!==f.row&&(a=f.row,u=Es(r,this.left+n,this.right-this.lineWidths[a])),f.top+=this.top+t+n,f.left=s.leftForLtr(s.x(u),f.width),u+=f.width+n}else{let a=0,u=Es(r,this.top+t+n,this.bottom-this.columnSizes[a].height);for(const f of e)f.col!==a&&(a=f.col,u=Es(r,this.top+t+n,this.bottom-this.columnSizes[a].height)),f.top=u,f.left+=this.left+n,f.left=s.leftForLtr(s.x(f.left),f.width),u+=f.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;HC(t,this),this._draw(),jC(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:r,ctx:n}=this,{align:o,labels:s}=t,a=$a.color,u=a0(t.rtl,this.left,this.width),f=$o(s.font),{padding:g}=s,v=f.size,y=v/2;let w;this.drawTitle(),n.textAlign=u.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=f.string;const{boxWidth:I,boxHeight:E,itemHeight:D}=B6(s,v),R=function(X,K,et){if(isNaN(I)||I<=0||isNaN(E)||E<0)return;n.save();const rt=un(et.lineWidth,1);if(n.fillStyle=un(et.fillStyle,a),n.lineCap=un(et.lineCap,"butt"),n.lineDashOffset=un(et.lineDashOffset,0),n.lineJoin=un(et.lineJoin,"miter"),n.lineWidth=rt,n.strokeStyle=un(et.strokeStyle,a),n.setLineDash(un(et.lineDash,[])),s.usePointStyle){const lt={radius:E*Math.SQRT2/2,pointStyle:et.pointStyle,rotation:et.rotation,borderWidth:rt},ht=u.xPlus(X,I/2),yt=K+y;TX(n,lt,ht,yt,s.pointStyleWidth&&I)}else{const lt=K+Math.max((v-E)/2,0),ht=u.leftForLtr(X,I),yt=Jm(et.borderRadius);n.beginPath(),Object.values(yt).some(ft=>ft!==0)?Ww(n,{x:ht,y:lt,w:I,h:E,radius:yt}):n.rect(ht,lt,I,E),n.fill(),rt!==0&&n.stroke()}n.restore()},z=function(X,K,et){hv(n,et.text,X,K+D/2,f,{strikethrough:et.hidden,textAlign:u.textAlign(et.textAlign)})},N=this.isHorizontal(),H=this._computeTitleHeight();N?w={x:Es(o,this.left+g,this.right-r[0]),y:this.top+g+H,line:0}:w={x:this.left+g,y:Es(o,this.top+H+g,this.bottom-e[0].height),line:0},LX(this.ctx,t.textDirection);const $=D+g;this.legendItems.forEach((X,K)=>{n.strokeStyle=X.fontColor,n.fillStyle=X.fontColor;const et=n.measureText(X.text).width,rt=u.textAlign(X.textAlign||(X.textAlign=s.textAlign)),lt=I+y+et;let ht=w.x,yt=w.y;u.setWidth(this.width),N?K>0&&ht+lt+g>this.right&&(yt=w.y+=$,w.line++,ht=w.x=Es(o,this.left+g,this.right-r[w.line])):K>0&&yt+$>this.bottom&&(ht=w.x=ht+e[w.line].width+g,w.line++,yt=w.y=Es(o,this.top+H+g,this.bottom-e[w.line].height));const ft=u.x(ht);if(R(ft,yt,X),ht=Pdt(rt,ht+I+y,N?ht+lt:this.right,t.rtl),z(u.x(ht),yt,X),N)w.x+=lt+g;else if(typeof X.text!="string"){const kt=f.lineHeight;w.y+=aY(X,kt)+g}else w.y+=$}),RX(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,r=$o(e.font),n=Fs(e.padding);if(!e.display)return;const o=a0(t.rtl,this.left,this.width),s=this.ctx,a=e.position,u=r.size/2,f=n.top+u;let g,v=this.left,y=this.width;if(this.isHorizontal())y=Math.max(...this.lineWidths),g=this.top+f,v=Es(t.align,v,this.right-y);else{const I=this.columnSizes.reduce((E,D)=>Math.max(E,D.height),0);g=f+Es(t.align,this.top,this.bottom-I-t.labels.padding-this._computeTitleHeight())}const w=Es(a,v,v+y);s.textAlign=o.textAlign(rF(a)),s.textBaseline="middle",s.strokeStyle=e.color,s.fillStyle=e.color,s.font=r.string,hv(s,e.text,w,g,r)}_computeTitleHeight(){const t=this.options.title,e=$o(t.font),r=Fs(t.padding);return t.display?e.lineHeight+r.height:0}_getLegendItemAt(t,e){let r,n,o;if(md(t,this.left,this.right)&&md(e,this.top,this.bottom)){for(o=this.legendHitBoxes,r=0;r<o.length;++r)if(n=o[r],md(t,n.left,n.left+n.width)&&md(e,n.top,n.top+n.height))return this.legendItems[r]}return null}handleEvent(t){const e=this.options;if(!gmt(t.type,e))return;const r=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,o=hmt(n,r);n&&!o&&ka(e.onLeave,[t,n,this],this),this._hoveredItem=r,r&&!o&&ka(e.onHover,[t,r,this],this)}else r&&ka(e.onClick,[t,r,this],this)}}function dmt(i,t,e,r,n){const o=fmt(r,i,t,e),s=pmt(n,r,t.lineHeight);return{itemWidth:o,itemHeight:s}}function fmt(i,t,e,r){let n=i.text;return n&&typeof n!="string"&&(n=n.reduce((o,s)=>o.length>s.length?o:s)),t+e.size/2+r.measureText(n).width}function pmt(i,t,e){let r=i;return typeof t.text!="string"&&(r=aY(t,e)),r}function aY(i,t){const e=i.text?i.text.length:0;return t*e}function gmt(i,t){return!!((i==="mousemove"||i==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(i==="click"||i==="mouseup"))}var mmt={id:"legend",_element:F6,start(i,t,e){const r=i.legend=new F6({ctx:i.ctx,options:e,chart:i});Os.configure(i,r,e),Os.addBox(i,r)},stop(i){Os.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,t,e){const r=i.legend;Os.configure(i,r,e),r.options=e},afterUpdate(i){const t=i.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(i,t){t.replay||i.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,t,e){const r=t.datasetIndex,n=e.chart;n.isDatasetVisible(r)?(n.hide(r),t.hidden=!0):(n.show(r),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const t=i.data.datasets,{labels:{usePointStyle:e,pointStyle:r,textAlign:n,color:o,useBorderRadius:s,borderRadius:a}}=i.legend.options;return i._getSortedDatasetMetas().map(u=>{const f=u.controller.getStyle(e?0:void 0),g=Fs(f.borderWidth);return{text:t[u.index].label,fillStyle:f.backgroundColor,fontColor:o,hidden:!u.visible,lineCap:f.borderCapStyle,lineDash:f.borderDash,lineDashOffset:f.borderDashOffset,lineJoin:f.borderJoinStyle,lineWidth:(g.width+g.height)/4,strokeStyle:f.borderColor,pointStyle:r||f.pointStyle,rotation:f.rotation,textAlign:n||f.textAlign,borderRadius:s&&(a||f.borderRadius),datasetIndex:u.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};class dF extends Vd{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const n=Na(r.text)?r.text.length:1;this._padding=Fs(r.padding);const o=n*$o(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:r,bottom:n,right:o,options:s}=this,a=s.align;let u=0,f,g,v;return this.isHorizontal()?(g=Es(a,r,o),v=e+t,f=o-r):(s.position==="left"?(g=r+t,v=Es(a,n,e),u=ta*-.5):(g=o-t,v=Es(a,e,n),u=ta*.5),f=n-e),{titleX:g,titleY:v,maxWidth:f,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const r=$o(e.font),o=r.lineHeight/2+this._padding.top,{titleX:s,titleY:a,maxWidth:u,rotation:f}=this._drawArgs(o);hv(t,e.text,0,0,r,{color:e.color,maxWidth:u,rotation:f,textAlign:rF(e.align),textBaseline:"middle",translation:[s,a]})}}function vmt(i,t){const e=new dF({ctx:i.ctx,options:t,chart:i});Os.configure(i,e,t),Os.addBox(i,e),i.titleBlock=e}var _mt={id:"title",_element:dF,start(i,t,e){vmt(i,e)},stop(i){const t=i.titleBlock;Os.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const r=i.titleBlock;Os.configure(i,r,e),r.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const eA=new WeakMap;var ymt={id:"subtitle",start(i,t,e){const r=new dF({ctx:i.ctx,options:e,chart:i});Os.configure(i,r,e),Os.addBox(i,r),eA.set(i,r)},stop(i){Os.removeBox(i,eA.get(i)),eA.delete(i)},beforeUpdate(i,t,e){const r=eA.get(i);Os.configure(i,r,e),r.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const qb={average(i){if(!i.length)return!1;let t,e,r=new Set,n=0,o=0;for(t=0,e=i.length;t<e;++t){const a=i[t].element;if(a&&a.hasValue()){const u=a.tooltipPosition();r.add(u.x),n+=u.y,++o}}return o===0||r.size===0?!1:{x:[...r].reduce((a,u)=>a+u)/r.size,y:n/o}},nearest(i,t){if(!i.length)return!1;let e=t.x,r=t.y,n=Number.POSITIVE_INFINITY,o,s,a;for(o=0,s=i.length;o<s;++o){const u=i[o].element;if(u&&u.hasValue()){const f=u.getCenterPoint(),g=iO(t,f);g<n&&(n=g,a=u)}}if(a){const u=a.tooltipPosition();e=u.x,r=u.y}return{x:e,y:r}}};function Xu(i,t){return t&&(Na(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function od(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function xmt(i,t){const{element:e,datasetIndex:r,index:n}=t,o=i.getDatasetMeta(r).controller,{label:s,value:a}=o.getLabelAndValue(n);return{chart:i,label:s,parsed:o.getParsed(n),raw:i.data.datasets[r].data[n],formattedValue:a,dataset:o.getDataset(),dataIndex:n,datasetIndex:r,element:e}}function N6(i,t){const e=i.chart.ctx,{body:r,footer:n,title:o}=i,{boxWidth:s,boxHeight:a}=t,u=$o(t.bodyFont),f=$o(t.titleFont),g=$o(t.footerFont),v=o.length,y=n.length,w=r.length,I=Fs(t.padding);let E=I.height,D=0,R=r.reduce((H,$)=>H+$.before.length+$.lines.length+$.after.length,0);if(R+=i.beforeBody.length+i.afterBody.length,v&&(E+=v*f.lineHeight+(v-1)*t.titleSpacing+t.titleMarginBottom),R){const H=t.displayColors?Math.max(a,u.lineHeight):u.lineHeight;E+=w*H+(R-w)*u.lineHeight+(R-1)*t.bodySpacing}y&&(E+=t.footerMarginTop+y*g.lineHeight+(y-1)*t.footerSpacing);let z=0;const N=function(H){D=Math.max(D,e.measureText(H).width+z)};return e.save(),e.font=f.string,va(i.title,N),e.font=u.string,va(i.beforeBody.concat(i.afterBody),N),z=t.displayColors?s+2+t.boxPadding:0,va(r,H=>{va(H.before,N),va(H.lines,N),va(H.after,N)}),z=0,e.font=g.string,va(i.footer,N),e.restore(),D+=I.width,{width:D,height:E}}function bmt(i,t){const{y:e,height:r}=t;return e<r/2?"top":e>i.height-r/2?"bottom":"center"}function wmt(i,t,e,r){const{x:n,width:o}=r,s=e.caretSize+e.caretPadding;if(i==="left"&&n+o+s>t.width||i==="right"&&n-o-s<0)return!0}function Smt(i,t,e,r){const{x:n,width:o}=e,{width:s,chartArea:{left:a,right:u}}=i;let f="center";return r==="center"?f=n<=(a+u)/2?"left":"right":n<=o/2?f="left":n>=s-o/2&&(f="right"),wmt(f,i,t,e)&&(f="center"),f}function V6(i,t,e){const r=e.yAlign||t.yAlign||bmt(i,e);return{xAlign:e.xAlign||t.xAlign||Smt(i,t,e,r),yAlign:r}}function Tmt(i,t){let{x:e,width:r}=i;return t==="right"?e-=r:t==="center"&&(e-=r/2),e}function Amt(i,t,e){let{y:r,height:n}=i;return t==="top"?r+=e:t==="bottom"?r-=n+e:r-=n/2,r}function U6(i,t,e,r){const{caretSize:n,caretPadding:o,cornerRadius:s}=i,{xAlign:a,yAlign:u}=e,f=n+o,{topLeft:g,topRight:v,bottomLeft:y,bottomRight:w}=Jm(s);let I=Tmt(t,a);const E=Amt(t,u,f);return u==="center"?a==="left"?I+=f:a==="right"&&(I-=f):a==="left"?I-=Math.max(g,y)+n:a==="right"&&(I+=Math.max(v,w)+n),{x:rs(I,0,r.width-t.width),y:rs(E,0,r.height-t.height)}}function iA(i,t,e){const r=Fs(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-r.right:i.x+r.left}function G6(i){return Xu([],od(i))}function Imt(i,t,e){return Vp(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function H6(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const oY={beforeTitle:Qh,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,r=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(r>0&&t.dataIndex<r)return e[t.dataIndex]}return""},afterTitle:Qh,beforeBody:Qh,beforeLabel:Qh,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return kn(e)||(t+=e),t},labelColor(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Qh,afterBody:Qh,beforeFooter:Qh,footer:Qh,afterFooter:Qh};function Cl(i,t,e,r){const n=i[t].call(e,r);return typeof n>"u"?oY[t].call(e,r):n}class hO extends Vd{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,r=this.options.setContext(this.getContext()),n=r.enabled&&e.options.animation&&r.animations,o=new FX(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=Imt(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:r}=e,n=Cl(r,"beforeTitle",this,t),o=Cl(r,"title",this,t),s=Cl(r,"afterTitle",this,t);let a=[];return a=Xu(a,od(n)),a=Xu(a,od(o)),a=Xu(a,od(s)),a}getBeforeBody(t,e){return G6(Cl(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:r}=e,n=[];return va(t,o=>{const s={before:[],lines:[],after:[]},a=H6(r,o);Xu(s.before,od(Cl(a,"beforeLabel",this,o))),Xu(s.lines,Cl(a,"label",this,o)),Xu(s.after,od(Cl(a,"afterLabel",this,o))),n.push(s)}),n}getAfterBody(t,e){return G6(Cl(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:r}=e,n=Cl(r,"beforeFooter",this,t),o=Cl(r,"footer",this,t),s=Cl(r,"afterFooter",this,t);let a=[];return a=Xu(a,od(n)),a=Xu(a,od(o)),a=Xu(a,od(s)),a}_createItems(t){const e=this._active,r=this.chart.data,n=[],o=[],s=[];let a=[],u,f;for(u=0,f=e.length;u<f;++u)a.push(xmt(this.chart,e[u]));return t.filter&&(a=a.filter((g,v,y)=>t.filter(g,v,y,r))),t.itemSort&&(a=a.sort((g,v)=>t.itemSort(g,v,r))),va(a,g=>{const v=H6(t.callbacks,g);n.push(Cl(v,"labelColor",this,g)),o.push(Cl(v,"labelPointStyle",this,g)),s.push(Cl(v,"labelTextColor",this,g))}),this.labelColors=n,this.labelPointStyles=o,this.labelTextColors=s,this.dataPoints=a,a}update(t,e){const r=this.options.setContext(this.getContext()),n=this._active;let o,s=[];if(!n.length)this.opacity!==0&&(o={opacity:0});else{const a=qb[r.position].call(this,n,this._eventPosition);s=this._createItems(r),this.title=this.getTitle(s,r),this.beforeBody=this.getBeforeBody(s,r),this.body=this.getBody(s,r),this.afterBody=this.getAfterBody(s,r),this.footer=this.getFooter(s,r);const u=this._size=N6(this,r),f=Object.assign({},a,u),g=V6(this.chart,r,f),v=U6(r,f,g,this.chart);this.xAlign=g.xAlign,this.yAlign=g.yAlign,o={opacity:1,x:v.x,y:v.y,width:u.width,height:u.height,caretX:a.x,caretY:a.y}}this._tooltipItems=s,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,r,n){const o=this.getCaretPosition(t,r,n);e.lineTo(o.x1,o.y1),e.lineTo(o.x2,o.y2),e.lineTo(o.x3,o.y3)}getCaretPosition(t,e,r){const{xAlign:n,yAlign:o}=this,{caretSize:s,cornerRadius:a}=r,{topLeft:u,topRight:f,bottomLeft:g,bottomRight:v}=Jm(a),{x:y,y:w}=t,{width:I,height:E}=e;let D,R,z,N,H,$;return o==="center"?(H=w+E/2,n==="left"?(D=y,R=D-s,N=H+s,$=H-s):(D=y+I,R=D+s,N=H-s,$=H+s),z=D):(n==="left"?R=y+Math.max(u,g)+s:n==="right"?R=y+I-Math.max(f,v)-s:R=this.caretX,o==="top"?(N=w,H=N-s,D=R-s,z=R+s):(N=w+E,H=N+s,D=R+s,z=R-s),$=N),{x1:D,x2:R,x3:z,y1:N,y2:H,y3:$}}drawTitle(t,e,r){const n=this.title,o=n.length;let s,a,u;if(o){const f=a0(r.rtl,this.x,this.width);for(t.x=iA(this,r.titleAlign,r),e.textAlign=f.textAlign(r.titleAlign),e.textBaseline="middle",s=$o(r.titleFont),a=r.titleSpacing,e.fillStyle=r.titleColor,e.font=s.string,u=0;u<o;++u)e.fillText(n[u],f.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+a,u+1===o&&(t.y+=r.titleMarginBottom-a)}}_drawColorBox(t,e,r,n,o){const s=this.labelColors[r],a=this.labelPointStyles[r],{boxHeight:u,boxWidth:f}=o,g=$o(o.bodyFont),v=iA(this,"left",o),y=n.x(v),w=u<g.lineHeight?(g.lineHeight-u)/2:0,I=e.y+w;if(o.usePointStyle){const E={radius:Math.min(f,u)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},D=n.leftForLtr(y,f)+f/2,R=I+u/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,nO(t,E,D,R),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,nO(t,E,D,R)}else{t.lineWidth=Fn(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;const E=n.leftForLtr(y,f),D=n.leftForLtr(n.xPlus(y,1),f-2),R=Jm(s.borderRadius);Object.values(R).some(z=>z!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,Ww(t,{x:E,y:I,w:f,h:u,radius:R}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),Ww(t,{x:D,y:I+1,w:f-2,h:u-2,radius:R}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(E,I,f,u),t.strokeRect(E,I,f,u),t.fillStyle=s.backgroundColor,t.fillRect(D,I+1,f-2,u-2))}t.fillStyle=this.labelTextColors[r]}drawBody(t,e,r){const{body:n}=this,{bodySpacing:o,bodyAlign:s,displayColors:a,boxHeight:u,boxWidth:f,boxPadding:g}=r,v=$o(r.bodyFont);let y=v.lineHeight,w=0;const I=a0(r.rtl,this.x,this.width),E=function(et){e.fillText(et,I.x(t.x+w),t.y+y/2),t.y+=y+o},D=I.textAlign(s);let R,z,N,H,$,X,K;for(e.textAlign=s,e.textBaseline="middle",e.font=v.string,t.x=iA(this,D,r),e.fillStyle=r.bodyColor,va(this.beforeBody,E),w=a&&D!=="right"?s==="center"?f/2+g:f+2+g:0,H=0,X=n.length;H<X;++H){for(R=n[H],z=this.labelTextColors[H],e.fillStyle=z,va(R.before,E),N=R.lines,a&&N.length&&(this._drawColorBox(e,t,H,I,r),y=Math.max(v.lineHeight,u)),$=0,K=N.length;$<K;++$)E(N[$]),y=v.lineHeight;va(R.after,E)}w=0,y=v.lineHeight,va(this.afterBody,E),t.y-=o}drawFooter(t,e,r){const n=this.footer,o=n.length;let s,a;if(o){const u=a0(r.rtl,this.x,this.width);for(t.x=iA(this,r.footerAlign,r),t.y+=r.footerMarginTop,e.textAlign=u.textAlign(r.footerAlign),e.textBaseline="middle",s=$o(r.footerFont),e.fillStyle=r.footerColor,e.font=s.string,a=0;a<o;++a)e.fillText(n[a],u.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+r.footerSpacing}}drawBackground(t,e,r,n){const{xAlign:o,yAlign:s}=this,{x:a,y:u}=t,{width:f,height:g}=r,{topLeft:v,topRight:y,bottomLeft:w,bottomRight:I}=Jm(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(a+v,u),s==="top"&&this.drawCaret(t,e,r,n),e.lineTo(a+f-y,u),e.quadraticCurveTo(a+f,u,a+f,u+y),s==="center"&&o==="right"&&this.drawCaret(t,e,r,n),e.lineTo(a+f,u+g-I),e.quadraticCurveTo(a+f,u+g,a+f-I,u+g),s==="bottom"&&this.drawCaret(t,e,r,n),e.lineTo(a+w,u+g),e.quadraticCurveTo(a,u+g,a,u+g-w),s==="center"&&o==="left"&&this.drawCaret(t,e,r,n),e.lineTo(a,u+v),e.quadraticCurveTo(a,u,a+v,u),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,r=this.$animations,n=r&&r.x,o=r&&r.y;if(n||o){const s=qb[t.position].call(this,this._active,this._eventPosition);if(!s)return;const a=this._size=N6(this,t),u=Object.assign({},s,this._size),f=V6(e,t,u),g=U6(t,u,f,e);(n._to!==g.x||o._to!==g.y)&&(this.xAlign=f.xAlign,this.yAlign=f.yAlign,this.width=a.width,this.height=a.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,g))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},o={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const s=Fs(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=r,this.drawBackground(o,t,n,e),LX(t,e.textDirection),o.y+=s.top,this.drawTitle(o,t,e),this.drawBody(o,t,e),this.drawFooter(o,t,e),RX(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const r=this._active,n=t.map(({datasetIndex:a,index:u})=>{const f=this.chart.getDatasetMeta(a);if(!f)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:f.data[u],index:u}}),o=!pM(r,n),s=this._positionChanged(n,e);(o||s)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,r=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,o=this._active||[],s=this._getActiveElements(t,o,e,r),a=this._positionChanged(s,t),u=e||!pM(s,o)||a;return u&&(this._active=s,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),u}_getActiveElements(t,e,r,n){const o=this.options;if(t.type==="mouseout")return[];if(!n)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const s=this.chart.getElementsAtEventForMode(t,o.mode,o,r);return o.reverse&&s.reverse(),s}_positionChanged(t,e){const{caretX:r,caretY:n,options:o}=this,s=qb[o.position].call(this,t,e);return s!==!1&&(r!==s.x||n!==s.y)}}Wi(hO,"positioners",qb);var Mmt={id:"tooltip",_element:hO,positioners:qb,afterInit(i,t,e){e&&(i.tooltip=new hO({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:oY},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Cmt=Object.freeze({__proto__:null,Colors:Vgt,Decimation:jgt,Filler:umt,Legend:mmt,SubTitle:ymt,Title:_mt,Tooltip:Mmt});const Emt=(i,t,e,r)=>(typeof t=="string"?(e=i.push(t)-1,r.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function Dmt(i,t,e,r){const n=i.indexOf(t);if(n===-1)return Emt(i,t,e,r);const o=i.lastIndexOf(t);return n!==o?e:n}const Pmt=(i,t)=>i===null?null:rs(Math.round(i),0,t);function j6(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class dO extends RS{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const r=this.getLabels();for(const{index:n,label:o}of e)r[n]===o&&r.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(kn(t))return null;const r=this.getLabels();return e=isFinite(e)&&r[e]===t?e:Dmt(r,t,un(e,t),this._addedLabels),Pmt(e,r.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:r,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(r=0),e||(n=this.getLabels().length-1)),this.min=r,this.max=n}buildTicks(){const t=this.min,e=this.max,r=this.options.offset,n=[];let o=this.getLabels();o=t===0&&e===o.length-1?o:o.slice(t,e+1),this._valueRange=Math.max(o.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let s=t;s<=e;s++)n.push({value:s});return n}getLabelForValue(t){return j6.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}Wi(dO,"id","category"),Wi(dO,"defaults",{ticks:{callback:j6}});function Lmt(i,t){const e=[],{bounds:n,step:o,min:s,max:a,precision:u,count:f,maxTicks:g,maxDigits:v,includeBounds:y}=i,w=o||1,I=g-1,{min:E,max:D}=t,R=!kn(s),z=!kn(a),N=!kn(f),H=(D-E)/(v+1);let $=NG((D-E)/I/w)*w,X,K,et,rt;if($<1e-14&&!R&&!z)return[{value:E},{value:D}];rt=Math.ceil(D/$)-Math.floor(E/$),rt>I&&($=NG(rt*$/I/w)*w),kn(u)||(X=Math.pow(10,u),$=Math.ceil($*X)/X),n==="ticks"?(K=Math.floor(E/$)*$,et=Math.ceil(D/$)*$):(K=E,et=D),R&&z&&o&&Tdt((a-s)/o,$/1e3)?(rt=Math.round(Math.min((a-s)/$,g)),$=(a-s)/rt,K=s,et=a):N?(K=R?s:K,et=z?a:et,rt=f-1,$=(et-K)/rt):(rt=(et-K)/$,_w(rt,Math.round(rt),$/1e3)?rt=Math.round(rt):rt=Math.ceil(rt));const lt=Math.max(VG($),VG(K));X=Math.pow(10,kn(u)?lt:u),K=Math.round(K*X)/X,et=Math.round(et*X)/X;let ht=0;for(R&&(y&&K!==s?(e.push({value:s}),K<s&&ht++,_w(Math.round((K+ht*$)*X)/X,s,W6(s,H,i))&&ht++):K<s&&ht++);ht<rt;++ht){const yt=Math.round((K+ht*$)*X)/X;if(z&&yt>a)break;e.push({value:yt})}return z&&y&&et!==a?e.length&&_w(e[e.length-1].value,a,W6(a,H,i))?e[e.length-1].value=a:e.push({value:a}):(!z||et===a)&&e.push({value:et}),e}function W6(i,t,{horizontal:e,minRotation:r}){const n=ou(r),o=(e?Math.sin(n):Math.cos(n))||.001,s=.75*t*(""+i).length;return Math.min(t/o,s)}class bM extends RS{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return kn(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:r}=this.getUserBounds();let{min:n,max:o}=this;const s=u=>n=e?n:u,a=u=>o=r?o:u;if(t){const u=dh(n),f=dh(o);u<0&&f<0?a(0):u>0&&f>0&&s(0)}if(n===o){let u=o===0?1:Math.abs(o*.05);a(o+u),t||s(n-u)}this.min=n,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:r}=t,n;return r?(n=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),e=e||11),e&&(n=Math.min(e,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let r=this.getTickLimit();r=Math.max(2,r);const n={maxTicks:r,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},o=this._range||this,s=Lmt(n,o);return t.bounds==="ticks"&&gX(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}configure(){const t=this.ticks;let e=this.min,r=this.max;if(super.configure(),this.options.offset&&t.length){const n=(r-e)/Math.max(t.length-1,1)/2;e-=n,r+=n}this._startValue=e,this._endValue=r,this._valueRange=r-e}getLabelForValue(t){return PS(t,this.chart.options.locale,this.options.ticks.format)}}class fO extends bM{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=lo(t)?t:0,this.max=lo(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,r=ou(this.options.ticks.minRotation),n=(t?Math.sin(r):Math.cos(r))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,o.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}Wi(fO,"id","linear"),Wi(fO,"defaults",{ticks:{callback:GC.formatters.numeric}});const Zw=i=>Math.floor(np(i)),Jg=(i,t)=>Math.pow(10,Zw(i)+t);function $6(i){return i/Math.pow(10,Zw(i))===1}function Z6(i,t,e){const r=Math.pow(10,e),n=Math.floor(i/r);return Math.ceil(t/r)-n}function Rmt(i,t){const e=t-i;let r=Zw(e);for(;Z6(i,t,r)>10;)r++;for(;Z6(i,t,r)<10;)r--;return Math.min(r,Zw(i))}function kmt(i,{min:t,max:e}){t=$l(i.min,t);const r=[],n=Zw(t);let o=Rmt(t,e),s=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),u=n>o?Math.pow(10,n):0,f=Math.round((t-u)*s)/s,g=Math.floor((t-u)/a/10)*a*10;let v=Math.floor((f-g)/Math.pow(10,o)),y=$l(i.min,Math.round((u+g+v*Math.pow(10,o))*s)/s);for(;y<e;)r.push({value:y,major:$6(y),significand:v}),v>=10?v=v<15?15:20:v++,v>=20&&(o++,v=2,s=o>=0?1:s),y=Math.round((u+g+v*Math.pow(10,o))*s)/s;const w=$l(i.max,y);return r.push({value:w,major:$6(w),significand:v}),r}class pO extends RS{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const r=bM.prototype.parse.apply(this,[t,e]);if(r===0){this._zero=!0;return}return lo(r)&&r>0?r:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=lo(t)?Math.max(0,t):null,this.max=lo(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!lo(this._userMin)&&(this.min=t===Jg(this.min,0)?Jg(this.min,-1):Jg(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let r=this.min,n=this.max;const o=a=>r=t?r:a,s=a=>n=e?n:a;r===n&&(r<=0?(o(1),s(10)):(o(Jg(r,-1)),s(Jg(n,1)))),r<=0&&o(Jg(n,-1)),n<=0&&s(Jg(r,1)),this.min=r,this.max=n}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},r=kmt(e,this);return t.bounds==="ticks"&&gX(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(t){return t===void 0?"0":PS(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=np(t),this._valueRange=np(this.max)-np(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(np(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}Wi(pO,"id","logarithmic"),Wi(pO,"defaults",{ticks:{callback:GC.formatters.logarithmic,major:{enabled:!0}}});function gO(i){const t=i.ticks;if(t.display&&i.display){const e=Fs(t.backdropPadding);return un(t.font&&t.font.size,$a.font.size)+e.height}return 0}function Omt(i,t,e){return e=Na(e)?e:[e],{w:Udt(i,t.string,e),h:e.length*t.lineHeight}}function q6(i,t,e,r,n){return i===r||i===n?{start:t-e/2,end:t+e/2}:i<r||i>n?{start:t-e,end:t}:{start:t,end:t+e}}function zmt(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),r=[],n=[],o=i._pointLabels.length,s=i.options.pointLabels,a=s.centerPointLabels?ta/o:0;for(let u=0;u<o;u++){const f=s.setContext(i.getPointLabelContext(u));n[u]=f.padding;const g=i.getPointPosition(u,i.drawingArea+n[u],a),v=$o(f.font),y=Omt(i.ctx,v,i._pointLabels[u]);r[u]=y;const w=Ps(i.getIndexAngle(u)+a),I=Math.round(eF(w)),E=q6(I,g.x,y.w,0,180),D=q6(I,g.y,y.h,90,270);Bmt(e,t,w,E,D)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=Vmt(i,r,n)}function Bmt(i,t,e,r,n){const o=Math.abs(Math.sin(e)),s=Math.abs(Math.cos(e));let a=0,u=0;r.start<t.l?(a=(t.l-r.start)/o,i.l=Math.min(i.l,t.l-a)):r.end>t.r&&(a=(r.end-t.r)/o,i.r=Math.max(i.r,t.r+a)),n.start<t.t?(u=(t.t-n.start)/s,i.t=Math.min(i.t,t.t-u)):n.end>t.b&&(u=(n.end-t.b)/s,i.b=Math.max(i.b,t.b+u))}function Fmt(i,t,e){const r=i.drawingArea,{extra:n,additionalAngle:o,padding:s,size:a}=e,u=i.getPointPosition(t,r+n+s,o),f=Math.round(eF(Ps(u.angle+mo))),g=Hmt(u.y,a.h,f),v=Umt(f),y=Gmt(u.x,a.w,v);return{visible:!0,x:u.x,y:g,textAlign:v,left:y,top:g,right:y+a.w,bottom:g+a.h}}function Nmt(i,t){if(!t)return!0;const{left:e,top:r,right:n,bottom:o}=i;return!(_d({x:e,y:r},t)||_d({x:e,y:o},t)||_d({x:n,y:r},t)||_d({x:n,y:o},t))}function Vmt(i,t,e){const r=[],n=i._pointLabels.length,o=i.options,{centerPointLabels:s,display:a}=o.pointLabels,u={extra:gO(o)/2,additionalAngle:s?ta/n:0};let f;for(let g=0;g<n;g++){u.padding=e[g],u.size=t[g];const v=Fmt(i,g,u);r.push(v),a==="auto"&&(v.visible=Nmt(v,f),v.visible&&(f=v))}return r}function Umt(i){return i===0||i===180?"center":i<180?"left":"right"}function Gmt(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function Hmt(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function jmt(i,t,e){const{left:r,top:n,right:o,bottom:s}=e,{backdropColor:a}=t;if(!kn(a)){const u=Jm(t.borderRadius),f=Fs(t.backdropPadding);i.fillStyle=a;const g=r-f.left,v=n-f.top,y=o-r+f.width,w=s-n+f.height;Object.values(u).some(I=>I!==0)?(i.beginPath(),Ww(i,{x:g,y:v,w:y,h:w,radius:u}),i.fill()):i.fillRect(g,v,y,w)}}function Wmt(i,t){const{ctx:e,options:{pointLabels:r}}=i;for(let n=t-1;n>=0;n--){const o=i._pointLabelItems[n];if(!o.visible)continue;const s=r.setContext(i.getPointLabelContext(n));jmt(e,s,o);const a=$o(s.font),{x:u,y:f,textAlign:g}=o;hv(e,i._pointLabels[n],u,f+a.lineHeight/2,a,{color:s.color,textAlign:g,textBaseline:"middle"})}}function sY(i,t,e,r){const{ctx:n}=i;if(e)n.arc(i.xCenter,i.yCenter,t,0,Va);else{let o=i.getPointPosition(0,t);n.moveTo(o.x,o.y);for(let s=1;s<r;s++)o=i.getPointPosition(s,t),n.lineTo(o.x,o.y)}}function $mt(i,t,e,r,n){const o=i.ctx,s=t.circular,{color:a,lineWidth:u}=t;!s&&!r||!a||!u||e<0||(o.save(),o.strokeStyle=a,o.lineWidth=u,o.setLineDash(n.dash||[]),o.lineDashOffset=n.dashOffset,o.beginPath(),sY(i,e,s,r),o.closePath(),o.stroke(),o.restore())}function Zmt(i,t,e){return Vp(i,{label:e,index:t,type:"pointLabel"})}class Xb extends bM{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Fs(gO(this.options)/2),e=this.width=this.maxWidth-t.width,r=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+r/2+t.top),this.drawingArea=Math.floor(Math.min(e,r)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=lo(t)&&!isNaN(t)?t:0,this.max=lo(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/gO(this.options))}generateTickLabels(t){bM.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,r)=>{const n=ka(this.options.pointLabels.callback,[e,r],this);return n||n===0?n:""}).filter((e,r)=>this.chart.getDataVisibility(r))}fit(){const t=this.options;t.display&&t.pointLabels.display?zmt(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,r,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((r-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,r,n))}getIndexAngle(t){const e=Va/(this._pointLabels.length||1),r=this.options.startAngle||0;return Ps(t*e+ou(r))}getDistanceFromCenterForValue(t){if(kn(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(kn(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const r=e[t];return Zmt(this.getContext(),t,r)}}getPointPosition(t,e,r=0){const n=this.getIndexAngle(t)-mo+r;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:r,right:n,bottom:o}=this._pointLabelItems[t];return{left:e,top:r,right:n,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const r=this.ctx;r.save(),r.beginPath(),sY(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),r.closePath(),r.fillStyle=t,r.fill(),r.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:r,grid:n,border:o}=e,s=this._pointLabels.length;let a,u,f;if(e.pointLabels.display&&Wmt(this,s),n.display&&this.ticks.forEach((g,v)=>{if(v!==0||v===0&&this.min<0){u=this.getDistanceFromCenterForValue(g.value);const y=this.getContext(v),w=n.setContext(y),I=o.setContext(y);$mt(this,w,u,s,I)}}),r.display){for(t.save(),a=s-1;a>=0;a--){const g=r.setContext(this.getPointLabelContext(a)),{color:v,lineWidth:y}=g;!y||!v||(t.lineWidth=y,t.strokeStyle=v,t.setLineDash(g.borderDash),t.lineDashOffset=g.borderDashOffset,u=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),f=this.getPointPosition(a,u),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(f.x,f.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,r=e.ticks;if(!r.display)return;const n=this.getIndexAngle(0);let o,s;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,u)=>{if(u===0&&this.min>=0&&!e.reverse)return;const f=r.setContext(this.getContext(u)),g=$o(f.font);if(o=this.getDistanceFromCenterForValue(this.ticks[u].value),f.showLabelBackdrop){t.font=g.string,s=t.measureText(a.label).width,t.fillStyle=f.backdropColor;const v=Fs(f.backdropPadding);t.fillRect(-s/2-v.left,-o-g.size/2-v.top,s+v.width,g.size+v.height)}hv(t,a.label,0,-o,g,{color:f.color,strokeColor:f.textStrokeColor,strokeWidth:f.textStrokeWidth})}),t.restore()}drawTitle(){}}Wi(Xb,"id","radialLinear"),Wi(Xb,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:GC.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),Wi(Xb,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Wi(Xb,"descriptors",{angleLines:{_fallback:"grid"}});const ZC={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Rl=Object.keys(ZC);function X6(i,t){return i-t}function Y6(i,t){if(kn(t))return null;const e=i._adapter,{parser:r,round:n,isoWeekday:o}=i._parseOpts;let s=t;return typeof r=="function"&&(s=r(s)),lo(s)||(s=typeof r=="string"?e.parse(s,r):e.parse(s)),s===null?null:(n&&(s=n==="week"&&(g0(o)||o===!0)?e.startOf(s,"isoWeek",o):e.startOf(s,n)),+s)}function K6(i,t,e,r){const n=Rl.length;for(let o=Rl.indexOf(i);o<n-1;++o){const s=ZC[Rl[o]],a=s.steps?s.steps:Number.MAX_SAFE_INTEGER;if(s.common&&Math.ceil((e-t)/(a*s.size))<=r)return Rl[o]}return Rl[n-1]}function qmt(i,t,e,r,n){for(let o=Rl.length-1;o>=Rl.indexOf(e);o--){const s=Rl[o];if(ZC[s].common&&i._adapter.diff(n,r,s)>=t-1)return s}return Rl[e?Rl.indexOf(e):0]}function Xmt(i){for(let t=Rl.indexOf(i)+1,e=Rl.length;t<e;++t)if(ZC[Rl[t]].common)return Rl[t]}function J6(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:r,hi:n}=iF(e,t),o=e[r]>=t?e[r]:e[n];i[o]=!0}}function Ymt(i,t,e,r){const n=i._adapter,o=+n.startOf(t[0].value,r),s=t[t.length-1].value;let a,u;for(a=o;a<=s;a=+n.add(a,1,r))u=e[a],u>=0&&(t[u].major=!0);return t}function Q6(i,t,e){const r=[],n={},o=t.length;let s,a;for(s=0;s<o;++s)a=t[s],n[a]=s,r.push({value:a,major:!1});return o===0||!e?r:Ymt(i,r,n,e)}var bI;let mO=(bI=class extends RS{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const r=t.time||(t.time={}),n=this._adapter=new npt._date(t.adapters.date);n.init(e),vw(r.displayFormats,n.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Y6(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,r=t.time.unit||"day";let{min:n,max:o,minDefined:s,maxDefined:a}=this.getUserBounds();function u(f){!s&&!isNaN(f.min)&&(n=Math.min(n,f.min)),!a&&!isNaN(f.max)&&(o=Math.max(o,f.max))}(!s||!a)&&(u(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&u(this.getMinMax(!1))),n=lo(n)&&!isNaN(n)?n:+e.startOf(Date.now(),r),o=lo(o)&&!isNaN(o)?o:+e.endOf(Date.now(),r)+1,this.min=Math.min(n,o-1),this.max=Math.max(n+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],r=t[t.length-1]),{min:e,max:r}}buildTicks(){const t=this.options,e=t.time,r=t.ticks,n=r.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const o=this.min,s=this.max,a=Cdt(n,o,s);return this._unit=e.unit||(r.autoSkip?K6(e.minUnit,this.min,this.max,this._getLabelCapacity(o)):qmt(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:Xmt(this._unit),this.initOffsets(n),t.reverse&&a.reverse(),Q6(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,r=0,n,o;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?e=1-n:e=(this.getDecimalForValue(t[1])-n)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?r=o:r=(o-this.getDecimalForValue(t[t.length-2]))/2);const s=t.length<3?.5:.25;e=rs(e,0,s),r=rs(r,0,s),this._offsets={start:e,end:r,factor:1/(e+1+r)}}_generate(){const t=this._adapter,e=this.min,r=this.max,n=this.options,o=n.time,s=o.unit||K6(o.minUnit,e,r,this._getLabelCapacity(e)),a=un(n.ticks.stepSize,1),u=s==="week"?o.isoWeekday:!1,f=g0(u)||u===!0,g={};let v=e,y,w;if(f&&(v=+t.startOf(v,"isoWeek",u)),v=+t.startOf(v,f?"day":s),t.diff(r,e,s)>1e5*a)throw new Error(e+" and "+r+" are too far apart with stepSize of "+a+" "+s);const I=n.ticks.source==="data"&&this.getDataTimestamps();for(y=v,w=0;y<r;y=+t.add(y,a,s),w++)J6(g,y,I);return(y===r||n.bounds==="ticks"||w===1)&&J6(g,y,I),Object.keys(g).sort(X6).map(E=>+E)}getLabelForValue(t){const e=this._adapter,r=this.options.time;return r.tooltipFormat?e.format(t,r.tooltipFormat):e.format(t,r.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,o=this._unit,s=e||n[o];return this._adapter.format(t,s)}_tickFormatFunction(t,e,r,n){const o=this.options,s=o.ticks.callback;if(s)return ka(s,[t,e,r],this);const a=o.time.displayFormats,u=this._unit,f=this._majorUnit,g=u&&a[u],v=f&&a[f],y=r[e],w=f&&v&&y&&y.major;return this._adapter.format(t,n||(w?v:g))}generateTickLabels(t){let e,r,n;for(e=0,r=t.length;e<r;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,r=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+r)*e.factor)}getValueForPixel(t){const e=this._offsets,r=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+r*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,r=this.ctx.measureText(t).width,n=ou(this.isHorizontal()?e.maxRotation:e.minRotation),o=Math.cos(n),s=Math.sin(n),a=this._resolveTickFontOptions(0).size;return{w:r*o+a*s,h:r*s+a*o}}_getLabelCapacity(t){const e=this.options.time,r=e.displayFormats,n=r[e.unit]||r.millisecond,o=this._tickFormatFunction(t,0,Q6(this,[t],this._majorUnit),n),s=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,r;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,r=n.length;e<r;++e)t=t.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,r;if(t.length)return t;const n=this.getLabels();for(e=0,r=n.length;e<r;++e)t.push(Y6(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return _X(t.sort(X6))}},Wi(bI,"id","time"),Wi(bI,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}}),bI);function rA(i,t,e){let r=0,n=i.length-1,o,s,a,u;e?(t>=i[r].pos&&t<=i[n].pos&&({lo:r,hi:n}=vd(i,"pos",t)),{pos:o,time:a}=i[r],{pos:s,time:u}=i[n]):(t>=i[r].time&&t<=i[n].time&&({lo:r,hi:n}=vd(i,"time",t)),{time:o,pos:a}=i[r],{time:s,pos:u}=i[n]);const f=s-o;return f?a+(u-a)*(t-o)/f:a}class vO extends mO{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=rA(e,this.min),this._tableRange=rA(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:r}=this,n=[],o=[];let s,a,u,f,g;for(s=0,a=t.length;s<a;++s)f=t[s],f>=e&&f<=r&&n.push(f);if(n.length<2)return[{time:e,pos:0},{time:r,pos:1}];for(s=0,a=n.length;s<a;++s)g=n[s+1],u=n[s-1],f=n[s],Math.round((g+u)/2)!==f&&o.push({time:f,pos:s/(a-1)});return o}_generate(){const t=this.min,e=this.max;let r=super.getDataTimestamps();return(!r.includes(t)||!r.length)&&r.splice(0,0,t),(!r.includes(e)||r.length===1)&&r.push(e),r.sort((n,o)=>n-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),r=this.getLabelTimestamps();return e.length&&r.length?t=this.normalize(e.concat(r)):t=e.length?e:r,t=this._cache.all=t,t}getDecimalForValue(t){return(rA(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,r=this.getDecimalForPixel(t)/e.factor-e.end;return rA(this._table,r*this._tableRange+this._minPos,!0)}}Wi(vO,"id","timeseries"),Wi(vO,"defaults",mO.defaults);var Kmt=Object.freeze({__proto__:null,CategoryScale:dO,LinearScale:fO,LogarithmicScale:pO,RadialLinearScale:Xb,TimeScale:mO,TimeSeriesScale:vO});const Jmt=[rpt,Rgt,Cmt,Kmt];hd.register(...Jmt);const Qmt={class:"bp-card"},tvt={class:"bp-header"},evt={class:"bp-title"},ivt={class:"bp-subtitle"},rvt={class:"bp-metrics"},nvt={class:"bp-metric highlight"},avt={class:"bp-metric-value"},ovt={class:"bp-metric"},svt={class:"bp-metric-value"},lvt={class:"bp-metric"},cvt={class:"bp-metric-value"},uvt={class:"bp-metric traffic"},hvt={class:"bp-metric-value"},dvt={class:"bp-chart-wrap"},fvt="http://10.129.111.25:3000",pvt={__name:"BoroughPopup",props:{name:{type:String,required:!0},hour:{type:Number,required:!0},pm25:{type:Number,default:null},co:{type:Number,default:null},co2:{type:Number,default:null},vehicles:{type:Number,default:null},hasBusiestStreet:{type:Boolean,default:!1}},emits:["view-street"],setup(i,{emit:t}){const e=i,r=t,n=Po(null);let o=null;const s=Po(Array(24).fill(null)),a=y=>y==null||Number.isNaN(y)?"N/A":Number(y).toFixed(1),u=y=>y==null||Number.isNaN(y)?"N/A":Math.round(Number(y)).toLocaleString(),f=y=>{const w=y.toLowerCase().trim();return w==="city of london"?"city of london":w.replace(/london borough of /g,"").replace(/royal borough of /g,"").replace(/city of /g,"").replace(/&/g,"and").replace(/\./g,"").replace(/\s+/g," ").trim()},g=async()=>{const y=f(e.name);if(!y)return;const w=[];for(let I=0;I<24;I++){const E=`${y}_${I}`,D=`${fvt}/api/hourly?borough=${encodeURIComponent(E)}`;try{const R=await fetch(D);if(!R.ok){w.push(null);continue}const z=await R.json();w.push(z&&z.pm25_g_per_h!==void 0?Number(z.pm25_g_per_h):null)}catch(R){console.error("Failed to fetch hourly pm25 for",E,R),w.push(null)}}s.value=w},v=()=>{const y=n.value;if(!y)return;const w=Array.isArray(s.value)?s.value:[],I=Array.from({length:24},(D,R)=>R),E=I.map(D=>{const R=w[D];return R==null||Number.isNaN(R)?null:Number(R)});if(!E.some(D=>D!==null)){o&&(o.destroy(),o=null);return}o&&o.destroy(),o=new hd(y,{type:"line",data:{labels:I,datasets:[{data:E,fill:!0,tension:.35,pointRadius:0,borderWidth:1.2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"#050816",borderColor:"#a855f7",borderWidth:1,titleFont:{size:9},bodyFont:{size:9},padding:6,displayColors:!1,callbacks:{title:D=>`Hour ${D[0].label}:00`,label:D=>`PM2.5: ${a(D.parsed.y)} g/hour`}}},scales:{x:{display:!0,grid:{display:!1},ticks:{color:"#6b7280",font:{size:7},maxTicksLimit:8}},y:{display:!0,grid:{color:"rgba(148,163,253,0.12)"},ticks:{color:"#6b7280",font:{size:7},maxTicksLimit:4}}}}})};return k0(async()=>{await g(),v()}),n0(()=>e.name,async()=>{await g(),v()}),BC(()=>{o&&(o.destroy(),o=null)}),(y,w)=>(Wo(),ms("div",Qmt,[ve("div",tvt,[w[1]||(w[1]=ve("div",{class:"bp-label"},"AIR QUALITY SNAPSHOT",-1)),ve("div",evt,Ta(i.name),1),ve("div",ivt,"Hour "+Ta(i.hour)+":00  Backend hourly data",1)]),ve("div",rvt,[ve("div",nvt,[w[3]||(w[3]=ve("div",{class:"bp-metric-label"},"PM2.5",-1)),ve("div",avt,[Gn(Ta(a(i.pm25))+" ",1),w[2]||(w[2]=ve("span",{class:"unit"},"g/hour",-1))])]),ve("div",ovt,[w[5]||(w[5]=ve("div",{class:"bp-metric-label"},"CO",-1)),ve("div",svt,[Gn(Ta(a(i.co))+" ",1),w[4]||(w[4]=ve("span",{class:"unit"},"g/hour",-1))])]),ve("div",lvt,[w[7]||(w[7]=ve("div",{class:"bp-metric-label"},"CO",-1)),ve("div",cvt,[Gn(Ta(a(i.co2))+" ",1),w[6]||(w[6]=ve("span",{class:"unit"},"kg/hour",-1))])]),ve("div",uvt,[w[9]||(w[9]=ve("div",{class:"bp-metric-label"},"Traffic Volume",-1)),ve("div",hvt,[Gn(Ta(u(i.vehicles))+" ",1),w[8]||(w[8]=ve("span",{class:"unit"},"vehicles/hour",-1))])])]),w[10]||(w[10]=ve("div",{class:"bp-divider"},null,-1)),i.hasBusiestStreet?(Wo(),ms("button",{key:0,class:"bp-route-btn",onClick:w[0]||(w[0]=I=>r("view-street"))}," View recommended route ")):dM("",!0),w[11]||(w[11]=ve("div",{class:"bp-chart-header"},[ve("span",null,"24h PM2.5 trend (g/hour)"),ve("span",{class:"bp-chart-hint"}," live from backend  lower is better ")],-1)),ve("div",dvt,[ve("canvas",{ref_key:"chartCanvas",ref:n},null,512)])]))}},gvt=Np(pvt,[["__scopeId","data-v-8cd95344"]]);const mvt={class:"time-slider-container"},vvt={class:"time-slider-header"},_vt={class:"time-value"},yvt={class:"tick-row"},xvt=["onClick"],bvt={__name:"TimeSlider",props:{modelValue:{type:Number,default:0}},emits:["update:modelValue"],setup(i,{emit:t}){const e=i,r=t,n=Po(e.modelValue),o=Array.from({length:24},(f,g)=>g);n0(()=>e.modelValue,f=>{f!==n.value&&(n.value=f)});const s=f=>String(f).padStart(2,"0"),a=Yl(()=>{const f=n.value,g=n.value+1;return`${s(f)}.00${s(g)}.00`}),u=f=>{f!==n.value&&(n.value=f,r("update:modelValue",n.value))};return(f,g)=>(Wo(),ms("div",mvt,[ve("div",vvt,[g[0]||(g[0]=ve("span",{class:"time-label"},"TIME SCALE",-1)),ve("span",_vt,Ta(a.value),1)]),g[1]||(g[1]=ve("div",{class:"color-bar"},null,-1)),ve("div",yvt,[(Wo(!0),ms(Xl,null,jB(Ym(o),v=>(Wo(),ms("button",{key:v,class:gd(["tick",{"is-major":v%6===0,"is-active":v===n.value}]),onClick:y=>u(v)},Ta(v),11,xvt))),128))])]))}},wvt=Np(bvt,[["__scopeId","data-v-4ec9d039"]]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _O=function(i,t){return _O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])},_O(i,t)};function we(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");_O(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Svt=function(){function i(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}return i}(),Tvt=function(){function i(){this.browser=new Svt,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow=typeof window<"u"}return i}(),Zf=new Tvt;typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"?(Zf.wxa=!0,Zf.touchEventsSupported=!0):typeof document>"u"&&typeof self<"u"?Zf.worker=!0:!Zf.hasGlobalWindow||"Deno"in window||typeof navigator<"u"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Node.js")>-1?(Zf.node=!0,Zf.svgSupported=!0):Avt(navigator.userAgent,Zf);function Avt(i,t){var e=t.browser,r=i.match(/Firefox\/([\d.]+)/),n=i.match(/MSIE\s([\d.]+)/)||i.match(/Trident\/.+?rv:(([\d.]+))/),o=i.match(/Edge?\/([\d.]+)/),s=/micromessenger/i.test(i);r&&(e.firefox=!0,e.version=r[1]),n&&(e.ie=!0,e.version=n[1]),o&&(e.edge=!0,e.version=o[1],e.newEdge=+o[1].split(".")[0]>18),s&&(e.weChat=!0),t.svgSupported=typeof SVGRect<"u",t.touchEventsSupported="ontouchstart"in window&&!e.ie&&!e.edge,t.pointerEventsSupported="onpointerdown"in window&&(e.edge||e.ie&&+e.version>=11);var a=t.domSupported=typeof document<"u";if(a){var u=document.documentElement.style;t.transform3dSupported=(e.ie&&"transition"in u||e.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in u)&&!("OTransition"in u),t.transformSupported=t.transform3dSupported||e.ie&&+e.version>=9}}const Sn=Zf;var fF=12,lY="sans-serif",Dd=fF+"px "+lY,Ivt=20,Mvt=100,Cvt="007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N";function Evt(i){var t={};if(typeof JSON>"u")return t;for(var e=0;e<i.length;e++){var r=String.fromCharCode(e+32),n=(i.charCodeAt(e)-Ivt)/Mvt;t[r]=n}return t}var Dvt=Evt(Cvt),gu={createCanvas:function(){return typeof document<"u"&&document.createElement("canvas")},measureText:function(){var i,t;return function(e,r){if(!i){var n=gu.createCanvas();i=n&&n.getContext("2d")}if(i)return t!==r&&(t=i.font=r||Dd),i.measureText(e);e=e||"",r=r||Dd;var o=/((?:\d+)?\.?\d*)px/.exec(r),s=o&&+o[1]||fF,a=0;if(r.indexOf("mono")>=0)a=s*e.length;else for(var u=0;u<e.length;u++){var f=Dvt[e[u]];a+=f==null?s:f*s}return{width:a}}}(),loadImage:function(i,t,e){var r=new Image;return r.onload=t,r.onerror=e,r.src=i,r}},cY=yh(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(i,t){return i["[object "+t+"]"]=!0,i},{}),uY=yh(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(i,t){return i["[object "+t+"Array]"]=!0,i},{}),O0=Object.prototype.toString,qC=Array.prototype,Pvt=qC.forEach,Lvt=qC.filter,pF=qC.slice,Rvt=qC.map,tH=(function(){}).constructor,nA=tH?tH.prototype:null,gF="__proto__",kvt=2311;function hY(){return kvt++}function mF(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];typeof console<"u"&&console.error.apply(console,i)}function Yi(i){if(i==null||typeof i!="object")return i;var t=i,e=O0.call(i);if(e==="[object Array]"){if(!ww(i)){t=[];for(var r=0,n=i.length;r<n;r++)t[r]=Yi(i[r])}}else if(uY[e]){if(!ww(i)){var o=i.constructor;if(o.from)t=o.from(i);else{t=new o(i.length);for(var r=0,n=i.length;r<n;r++)t[r]=i[r]}}}else if(!cY[e]&&!ww(i)&&!_0(i)){t={};for(var s in i)i.hasOwnProperty(s)&&s!==gF&&(t[s]=Yi(i[s]))}return t}function Er(i,t,e){if(!nr(t)||!nr(i))return e?Yi(t):i;for(var r in t)if(t.hasOwnProperty(r)&&r!==gF){var n=i[r],o=t[r];nr(o)&&nr(n)&&!Ye(o)&&!Ye(n)&&!_0(o)&&!_0(n)&&!eH(o)&&!eH(n)&&!ww(o)&&!ww(n)?Er(n,o,e):(e||!(r in i))&&(i[r]=Yi(t[r]))}return i}function vF(i,t){for(var e=i[0],r=1,n=i.length;r<n;r++)e=Er(e,i[r],t);return e}function Fe(i,t){if(Object.assign)Object.assign(i,t);else for(var e in t)t.hasOwnProperty(e)&&e!==gF&&(i[e]=t[e]);return i}function rr(i,t,e){for(var r=on(t),n=0,o=r.length;n<o;n++){var s=r[n];(e?t[s]!=null:i[s]==null)&&(i[s]=t[s])}return i}function Ar(i,t){if(i){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e}return-1}function Ovt(i,t){var e=i.prototype;function r(){}r.prototype=t.prototype,i.prototype=new r;for(var n in e)e.hasOwnProperty(n)&&(i.prototype[n]=e[n]);i.prototype.constructor=i,i.superClass=t}function wo(i,t,e){if(i="prototype"in i?i.prototype:i,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames)for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var o=r[n];o!=="constructor"&&(e?t[o]!=null:i[o]==null)&&(i[o]=t[o])}else rr(i,t,e)}function Ns(i){return!i||typeof i=="string"?!1:typeof i.length=="number"}function gt(i,t,e){if(i&&t)if(i.forEach&&i.forEach===Pvt)i.forEach(t,e);else if(i.length===+i.length)for(var r=0,n=i.length;r<n;r++)t.call(e,i[r],r,i);else for(var o in i)i.hasOwnProperty(o)&&t.call(e,i[o],o,i)}function ti(i,t,e){if(!i)return[];if(!t)return _F(i);if(i.map&&i.map===Rvt)return i.map(t,e);for(var r=[],n=0,o=i.length;n<o;n++)r.push(t.call(e,i[n],n,i));return r}function yh(i,t,e,r){if(i&&t){for(var n=0,o=i.length;n<o;n++)e=t.call(r,e,i[n],n,i);return e}}function Rn(i,t,e){if(!i)return[];if(!t)return _F(i);if(i.filter&&i.filter===Lvt)return i.filter(t,e);for(var r=[],n=0,o=i.length;n<o;n++)t.call(e,i[n],n,i)&&r.push(i[n]);return r}function bv(i,t,e){if(i&&t){for(var r=0,n=i.length;r<n;r++)if(t.call(e,i[r],r,i))return i[r]}}function on(i){if(!i)return[];if(Object.keys)return Object.keys(i);var t=[];for(var e in i)i.hasOwnProperty(e)&&t.push(e);return t}function zvt(i,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];return function(){return i.apply(t,e.concat(pF.call(arguments)))}}var wi=nA&&Xi(nA.bind)?nA.call.bind(nA.bind):zvt;function br(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){return i.apply(this,t.concat(pF.call(arguments)))}}function Ye(i){return Array.isArray?Array.isArray(i):O0.call(i)==="[object Array]"}function Xi(i){return typeof i=="function"}function bi(i){return typeof i=="string"}function yO(i){return O0.call(i)==="[object String]"}function fn(i){return typeof i=="number"}function nr(i){var t=typeof i;return t==="function"||!!i&&t==="object"}function eH(i){return!!cY[O0.call(i)]}function zl(i){return!!uY[O0.call(i)]}function _0(i){return typeof i=="object"&&typeof i.nodeType=="number"&&typeof i.ownerDocument=="object"}function XC(i){return i.colorStops!=null}function Bvt(i){return i.image!=null}function Fvt(i){return O0.call(i)==="[object RegExp]"}function Bs(i){return i!==i}function vs(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];for(var e=0,r=i.length;e<r;e++)if(i[e]!=null)return i[e]}function Ui(i,t){return i??t}function ic(i,t,e){return i??t??e}function _F(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return pF.apply(i,t)}function YC(i){if(typeof i=="number")return[i,i,i,i];var t=i.length;return t===2?[i[0],i[1],i[0],i[1]]:t===3?[i[0],i[1],i[2],i[1]]:i}function Vs(i,t){if(!i)throw new Error(t)}function Ec(i){return i==null?null:typeof i.trim=="function"?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var dY="__ec_primitive__";function wM(i){i[dY]=!0}function ww(i){return i[dY]}var Nvt=function(){function i(){this.data={}}return i.prototype.delete=function(t){var e=this.has(t);return e&&delete this.data[t],e},i.prototype.has=function(t){return this.data.hasOwnProperty(t)},i.prototype.get=function(t){return this.data[t]},i.prototype.set=function(t,e){return this.data[t]=e,this},i.prototype.keys=function(){return on(this.data)},i.prototype.forEach=function(t){var e=this.data;for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)},i}(),fY=typeof Map=="function";function Vvt(){return fY?new Map:new Nvt}var Uvt=function(){function i(t){var e=Ye(t);this.data=Vvt();var r=this;t instanceof i?t.each(n):t&&gt(t,n);function n(o,s){e?r.set(o,s):r.set(s,o)}}return i.prototype.hasKey=function(t){return this.data.has(t)},i.prototype.get=function(t){return this.data.get(t)},i.prototype.set=function(t,e){return this.data.set(t,e),e},i.prototype.each=function(t,e){this.data.forEach(function(r,n){t.call(e,r,n)})},i.prototype.keys=function(){var t=this.data.keys();return fY?Array.from(t):t},i.prototype.removeKey=function(t){this.data.delete(t)},i}();function Fi(i){return new Uvt(i)}function qw(i,t){for(var e=new i.constructor(i.length+t.length),r=0;r<i.length;r++)e[r]=i[r];for(var n=i.length,r=0;r<t.length;r++)e[r+n]=t[r];return e}function KC(i,t){var e;if(Object.create)e=Object.create(i);else{var r=function(){};r.prototype=i,e=new r}return t&&Fe(e,t),e}function pY(i){var t=i.style;t.webkitUserSelect="none",t.userSelect="none",t.webkitTapHighlightColor="rgba(0,0,0,0)",t["-webkit-touch-callout"]="none"}function Di(i,t){return i.hasOwnProperty(t)}function uo(){}var zI=180/Math.PI;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xO=function(i,t){return xO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])},xO(i,t)};function xa(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");xO(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function wv(i,t){return i==null&&(i=0),t==null&&(t=0),[i,t]}function ll(i,t){return i[0]=t[0],i[1]=t[1],i}function Sd(i){return[i[0],i[1]]}function yF(i,t,e){return i[0]=t,i[1]=e,i}function iH(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function bO(i,t,e,r){return i[0]=t[0]+e[0]*r,i[1]=t[1]+e[1]*r,i}function Um(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i}function wO(i){return Math.sqrt(Gvt(i))}function Gvt(i){return i[0]*i[0]+i[1]*i[1]}function BI(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i}function z0(i,t){var e=wO(t);return e===0?(i[0]=0,i[1]=0):(i[0]=t[0]/e,i[1]=t[1]/e),i}function SO(i,t){return Math.sqrt((i[0]-t[0])*(i[0]-t[0])+(i[1]-t[1])*(i[1]-t[1]))}var lp=SO;function Hvt(i,t){return(i[0]-t[0])*(i[0]-t[0])+(i[1]-t[1])*(i[1]-t[1])}var tv=Hvt;function FI(i,t,e,r){return i[0]=t[0]+r*(e[0]-t[0]),i[1]=t[1]+r*(e[1]-t[1]),i}function ho(i,t,e){var r=t[0],n=t[1];return i[0]=e[0]*r+e[2]*n+e[4],i[1]=e[1]*r+e[3]*n+e[5],i}function cp(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i}function up(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i}var dy=function(){function i(t,e){this.target=t,this.topTarget=e&&e.topTarget}return i}(),jvt=function(){function i(t){this.handler=t,t.on("mousedown",this._dragStart,this),t.on("mousemove",this._drag,this),t.on("mouseup",this._dragEnd,this)}return i.prototype._dragStart=function(t){for(var e=t.target;e&&!e.draggable;)e=e.parent||e.__hostTarget;e&&(this._draggingTarget=e,e.dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.handler.dispatchToElement(new dy(e,t),"dragstart",t.event))},i.prototype._drag=function(t){var e=this._draggingTarget;if(e){var r=t.offsetX,n=t.offsetY,o=r-this._x,s=n-this._y;this._x=r,this._y=n,e.drift(o,s,t),this.handler.dispatchToElement(new dy(e,t),"drag",t.event);var a=this.handler.findHover(r,n,e).target,u=this._dropTarget;this._dropTarget=a,e!==a&&(u&&a!==u&&this.handler.dispatchToElement(new dy(u,t),"dragleave",t.event),a&&a!==u&&this.handler.dispatchToElement(new dy(a,t),"dragenter",t.event))}},i.prototype._dragEnd=function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new dy(e,t),"dragend",t.event),this._dropTarget&&this.handler.dispatchToElement(new dy(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null},i}();const Wvt=jvt;var $vt=function(){function i(t){t&&(this._$eventProcessor=t)}return i.prototype.on=function(t,e,r,n){this._$handlers||(this._$handlers={});var o=this._$handlers;if(typeof e=="function"&&(n=r,r=e,e=null),!r||!t)return this;var s=this._$eventProcessor;e!=null&&s&&s.normalizeQuery&&(e=s.normalizeQuery(e)),o[t]||(o[t]=[]);for(var a=0;a<o[t].length;a++)if(o[t][a].h===r)return this;var u={h:r,query:e,ctx:n||this,callAtLast:r.zrEventfulCallAtLast},f=o[t].length-1,g=o[t][f];return g&&g.callAtLast?o[t].splice(f,0,u):o[t].push(u),this},i.prototype.isSilent=function(t){var e=this._$handlers;return!e||!e[t]||!e[t].length},i.prototype.off=function(t,e){var r=this._$handlers;if(!r)return this;if(!t)return this._$handlers={},this;if(e){if(r[t]){for(var n=[],o=0,s=r[t].length;o<s;o++)r[t][o].h!==e&&n.push(r[t][o]);r[t]=n}r[t]&&r[t].length===0&&delete r[t]}else delete r[t];return this},i.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!this._$handlers)return this;var n=this._$handlers[t],o=this._$eventProcessor;if(n)for(var s=e.length,a=n.length,u=0;u<a;u++){var f=n[u];if(!(o&&o.filter&&f.query!=null&&!o.filter(t,f.query)))switch(s){case 0:f.h.call(f.ctx);break;case 1:f.h.call(f.ctx,e[0]);break;case 2:f.h.call(f.ctx,e[0],e[1]);break;default:f.h.apply(f.ctx,e);break}}return o&&o.afterTrigger&&o.afterTrigger(t),this},i.prototype.triggerWithContext=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!this._$handlers)return this;var n=this._$handlers[t],o=this._$eventProcessor;if(n)for(var s=e.length,a=e[s-1],u=n.length,f=0;f<u;f++){var g=n[f];if(!(o&&o.filter&&g.query!=null&&!o.filter(t,g.query)))switch(s){case 0:g.h.call(a);break;case 1:g.h.call(a,e[0]);break;case 2:g.h.call(a,e[0],e[1]);break;default:g.h.apply(a,e.slice(1,s-1));break}}return o&&o.afterTrigger&&o.afterTrigger(t),this},i}();const zc=$vt;var Zvt=Math.log(2);function TO(i,t,e,r,n,o){var s=r+"-"+n,a=i.length;if(o.hasOwnProperty(s))return o[s];if(t===1){var u=Math.round(Math.log((1<<a)-1&~n)/Zvt);return i[e][u]}for(var f=r|1<<e,g=e+1;r&1<<g;)g++;for(var v=0,y=0,w=0;y<a;y++){var I=1<<y;I&n||(v+=(w%2?-1:1)*i[e][y]*TO(i,t-1,g,f,n|I,o),w++)}return o[s]=v,v}function rH(i,t){var e=[[i[0],i[1],1,0,0,0,-t[0]*i[0],-t[0]*i[1]],[0,0,0,i[0],i[1],1,-t[1]*i[0],-t[1]*i[1]],[i[2],i[3],1,0,0,0,-t[2]*i[2],-t[2]*i[3]],[0,0,0,i[2],i[3],1,-t[3]*i[2],-t[3]*i[3]],[i[4],i[5],1,0,0,0,-t[4]*i[4],-t[4]*i[5]],[0,0,0,i[4],i[5],1,-t[5]*i[4],-t[5]*i[5]],[i[6],i[7],1,0,0,0,-t[6]*i[6],-t[6]*i[7]],[0,0,0,i[6],i[7],1,-t[7]*i[6],-t[7]*i[7]]],r={},n=TO(e,8,0,0,0,r);if(n!==0){for(var o=[],s=0;s<8;s++)for(var a=0;a<8;a++)o[a]==null&&(o[a]=0),o[a]+=((s+a)%2?-1:1)*TO(e,7,s===0?1:0,1<<s,1<<a,r)/n*t[s];return function(u,f,g){var v=f*o[6]+g*o[7]+1;u[0]=(f*o[0]+g*o[1]+o[2])/v,u[1]=(f*o[3]+g*o[4]+o[5])/v}}}var SM="___zrEVENTSAVED",dL=[];function qvt(i,t,e,r,n){return AO(dL,t,r,n,!0)&&AO(i,e,dL[0],dL[1])}function Xvt(i,t){i&&e(i),t&&e(t);function e(r){var n=r[SM];n&&(n.clearMarkers&&n.clearMarkers(),delete r[SM])}}function AO(i,t,e,r,n){if(t.getBoundingClientRect&&Sn.domSupported&&!gY(t)){var o=t[SM]||(t[SM]={}),s=Yvt(t,o),a=Kvt(s,o,n);if(a)return a(i,e,r),!0}return!1}function Yvt(i,t){var e=t.markers;if(e)return e;e=t.markers=[];for(var r=["left","right"],n=["top","bottom"],o=0;o<4;o++){var s=document.createElement("div"),a=s.style,u=o%2,f=(o>>1)%2;a.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",r[u]+":0",n[f]+":0",r[1-u]+":auto",n[1-f]+":auto",""].join("!important;"),i.appendChild(s),e.push(s)}return t.clearMarkers=function(){gt(e,function(g){g.parentNode&&g.parentNode.removeChild(g)})},e}function Kvt(i,t,e){for(var r=e?"invTrans":"trans",n=t[r],o=t.srcCoords,s=[],a=[],u=!0,f=0;f<4;f++){var g=i[f].getBoundingClientRect(),v=2*f,y=g.left,w=g.top;s.push(y,w),u=u&&o&&y===o[v]&&w===o[v+1],a.push(i[f].offsetLeft,i[f].offsetTop)}return u&&n?n:(t.srcCoords=s,t[r]=e?rH(a,s):rH(s,a))}function gY(i){return i.nodeName.toUpperCase()==="CANVAS"}var Jvt=/([&<>"'])/g,Qvt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Rs(i){return i==null?"":(i+"").replace(Jvt,function(t,e){return Qvt[e]})}var t_t=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,fL=[],e_t=Sn.browser.firefox&&+Sn.browser.version.split(".")[0]<39;function IO(i,t,e,r){return e=e||{},r?nH(i,t,e):e_t&&t.layerX!=null&&t.layerX!==t.offsetX?(e.zrX=t.layerX,e.zrY=t.layerY):t.offsetX!=null?(e.zrX=t.offsetX,e.zrY=t.offsetY):nH(i,t,e),e}function nH(i,t,e){if(Sn.domSupported&&i.getBoundingClientRect){var r=t.clientX,n=t.clientY;if(gY(i)){var o=i.getBoundingClientRect();e.zrX=r-o.left,e.zrY=n-o.top;return}else if(AO(fL,i,r,n)){e.zrX=fL[0],e.zrY=fL[1];return}}e.zrX=e.zrY=0}function xF(i){return i||window.event}function bc(i,t,e){if(t=xF(t),t.zrX!=null)return t;var r=t.type,n=r&&r.indexOf("touch")>=0;if(n){var s=r!=="touchend"?t.targetTouches[0]:t.changedTouches[0];s&&IO(i,s,t,e)}else{IO(i,t,t,e);var o=i_t(t);t.zrDelta=o?o/120:-(t.detail||0)/3}var a=t.button;return t.which==null&&a!==void 0&&t_t.test(t.type)&&(t.which=a&1?1:a&2?3:a&4?2:0),t}function i_t(i){var t=i.wheelDelta;if(t)return t;var e=i.deltaX,r=i.deltaY;if(e==null||r==null)return t;var n=Math.abs(r!==0?r:e),o=r>0?-1:r<0?1:e>0?-1:1;return 3*n*o}function MO(i,t,e,r){i.addEventListener(t,e,r)}function r_t(i,t,e,r){i.removeEventListener(t,e,r)}var Pd=function(i){i.preventDefault(),i.stopPropagation(),i.cancelBubble=!0};function aH(i){return i.which===2||i.which===3}var n_t=function(){function i(){this._track=[]}return i.prototype.recognize=function(t,e,r){return this._doTrack(t,e,r),this._recognize(t)},i.prototype.clear=function(){return this._track.length=0,this},i.prototype._doTrack=function(t,e,r){var n=t.touches;if(n){for(var o={points:[],touches:[],target:e,event:t},s=0,a=n.length;s<a;s++){var u=n[s],f=IO(r,u,{});o.points.push([f.zrX,f.zrY]),o.touches.push(u)}this._track.push(o)}},i.prototype._recognize=function(t){for(var e in pL)if(pL.hasOwnProperty(e)){var r=pL[e](this._track,t);if(r)return r}},i}();function oH(i){var t=i[1][0]-i[0][0],e=i[1][1]-i[0][1];return Math.sqrt(t*t+e*e)}function a_t(i){return[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2]}var pL={pinch:function(i,t){var e=i.length;if(e){var r=(i[e-1]||{}).points,n=(i[e-2]||{}).points||r;if(n&&n.length>1&&r&&r.length>1){var o=oH(r)/oH(n);!isFinite(o)&&(o=1),t.pinchScale=o;var s=a_t(r);return t.pinchX=s[0],t.pinchY=s[1],{type:"pinch",target:i[0].target,event:t}}}}};function ns(){return[1,0,0,1,0,0]}function JC(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i}function QC(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function fh(i,t,e){var r=t[0]*e[0]+t[2]*e[1],n=t[1]*e[0]+t[3]*e[1],o=t[0]*e[2]+t[2]*e[3],s=t[1]*e[2]+t[3]*e[3],a=t[0]*e[4]+t[2]*e[5]+t[4],u=t[1]*e[4]+t[3]*e[5]+t[5];return i[0]=r,i[1]=n,i[2]=o,i[3]=s,i[4]=a,i[5]=u,i}function xh(i,t,e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4]+e[0],i[5]=t[5]+e[1],i}function Up(i,t,e,r){r===void 0&&(r=[0,0]);var n=t[0],o=t[2],s=t[4],a=t[1],u=t[3],f=t[5],g=Math.sin(e),v=Math.cos(e);return i[0]=n*v+a*g,i[1]=-n*g+a*v,i[2]=o*v+u*g,i[3]=-o*g+v*u,i[4]=v*(s-r[0])+g*(f-r[1])+r[0],i[5]=v*(f-r[1])-g*(s-r[0])+r[1],i}function bF(i,t,e){var r=e[0],n=e[1];return i[0]=t[0]*r,i[1]=t[1]*n,i[2]=t[2]*r,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*n,i}function mu(i,t){var e=t[0],r=t[2],n=t[4],o=t[1],s=t[3],a=t[5],u=e*s-o*r;return u?(u=1/u,i[0]=s*u,i[1]=-o*u,i[2]=-r*u,i[3]=e*u,i[4]=(r*a-s*n)*u,i[5]=(o*n-e*a)*u,i):null}function o_t(i){var t=ns();return QC(t,i),t}var s_t=function(){function i(t,e){this.x=t||0,this.y=e||0}return i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.equal=function(t){return t.x===this.x&&t.y===this.y},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.scale=function(t){this.x*=t,this.y*=t},i.prototype.scaleAndAdd=function(t,e){this.x+=t.x*e,this.y+=t.y*e},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.len();return this.x/=t,this.y/=t,this},i.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},i.prototype.distanceSquare=function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.transform=function(t){if(t){var e=this.x,r=this.y;return this.x=t[0]*e+t[2]*r+t[4],this.y=t[1]*e+t[3]*r+t[5],this}},i.prototype.toArray=function(t){return t[0]=this.x,t[1]=this.y,t},i.prototype.fromArray=function(t){this.x=t[0],this.y=t[1]},i.set=function(t,e,r){t.x=e,t.y=r},i.copy=function(t,e){t.x=e.x,t.y=e.y},i.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.lenSquare=function(t){return t.x*t.x+t.y*t.y},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.add=function(t,e,r){t.x=e.x+r.x,t.y=e.y+r.y},i.sub=function(t,e,r){t.x=e.x-r.x,t.y=e.y-r.y},i.scale=function(t,e,r){t.x=e.x*r,t.y=e.y*r},i.scaleAndAdd=function(t,e,r,n){t.x=e.x+r.x*n,t.y=e.y+r.y*n},i.lerp=function(t,e,r,n){var o=1-n;t.x=o*e.x+n*r.x,t.y=o*e.y+n*r.y},i}();const er=s_t;var Gm=Math.min,$y=Math.max,CO=Math.abs,sH=["x","y"],l_t=["width","height"],Qg=new er,tm=new er,em=new er,im=new er,ql=mY(),Yb=ql.minTv,EO=ql.maxTv,Sw=[0,0],wF=function(){function i(t,e,r,n){i.set(this,t,e,r,n)}return i.set=function(t,e,r,n,o){return n<0&&(e=e+n,n=-n),o<0&&(r=r+o,o=-o),t.x=e,t.y=r,t.width=n,t.height=o,t},i.prototype.union=function(t){var e=Gm(t.x,this.x),r=Gm(t.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=$y(t.x+t.width,this.x+this.width)-e:this.width=t.width,isFinite(this.y)&&isFinite(this.height)?this.height=$y(t.y+t.height,this.y+this.height)-r:this.height=t.height,this.x=e,this.y=r},i.prototype.applyTransform=function(t){i.applyTransform(this,this,t)},i.prototype.calculateTransform=function(t){var e=this,r=t.width/e.width,n=t.height/e.height,o=ns();return xh(o,o,[-e.x,-e.y]),bF(o,o,[r,n]),xh(o,o,[t.x,t.y]),o},i.prototype.intersect=function(t,e,r){return i.intersect(this,t,e,r)},i.intersect=function(t,e,r,n){r&&er.set(r,0,0);var o=n&&n.outIntersectRect||null,s=n&&n.clamp;if(o&&(o.x=o.y=o.width=o.height=NaN),!t||!e)return!1;t instanceof i||(t=i.set(c_t,t.x,t.y,t.width,t.height)),e instanceof i||(e=i.set(u_t,e.x,e.y,e.width,e.height));var a=!!r;ql.reset(n,a);var u=ql.touchThreshold,f=t.x+u,g=t.x+t.width-u,v=t.y+u,y=t.y+t.height-u,w=e.x+u,I=e.x+e.width-u,E=e.y+u,D=e.y+e.height-u;if(f>g||v>y||w>I||E>D)return!1;var R=!(g<w||I<f||y<E||D<v);return(a||o)&&(Sw[0]=1/0,Sw[1]=0,lH(f,g,w,I,0,a,o,s),lH(v,y,E,D,1,a,o,s),a&&er.copy(r,R?ql.useDir?ql.dirMinTv:Yb:EO)),R},i.contain=function(t,e,r){return e>=t.x&&e<=t.x+t.width&&r>=t.y&&r<=t.y+t.height},i.prototype.contain=function(t,e){return i.contain(this,t,e)},i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.copy=function(t){i.copy(this,t)},i.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},i.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},i.prototype.isZero=function(){return this.width===0||this.height===0},i.create=function(t){return new i(t.x,t.y,t.width,t.height)},i.copy=function(t,e){return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t},i.applyTransform=function(t,e,r){if(!r){t!==e&&i.copy(t,e);return}if(r[1]<1e-5&&r[1]>-1e-5&&r[2]<1e-5&&r[2]>-1e-5){var n=r[0],o=r[3],s=r[4],a=r[5];t.x=e.x*n+s,t.y=e.y*o+a,t.width=e.width*n,t.height=e.height*o,t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height);return}Qg.x=em.x=e.x,Qg.y=im.y=e.y,tm.x=im.x=e.x+e.width,tm.y=em.y=e.y+e.height,Qg.transform(r),im.transform(r),tm.transform(r),em.transform(r),t.x=Gm(Qg.x,tm.x,em.x,im.x),t.y=Gm(Qg.y,tm.y,em.y,im.y);var u=$y(Qg.x,tm.x,em.x,im.x),f=$y(Qg.y,tm.y,em.y,im.y);t.width=u-t.x,t.height=f-t.y},i}(),c_t=new wF(0,0,0,0),u_t=new wF(0,0,0,0);function lH(i,t,e,r,n,o,s,a){var u=CO(t-e),f=CO(r-i),g=Gm(u,f),v=sH[n],y=sH[1-n],w=l_t[n];t<e||r<i?u<f?(o&&(EO[v]=-u),a&&(s[v]=t,s[w]=0)):(o&&(EO[v]=f),a&&(s[v]=i,s[w]=0)):(s&&(s[v]=$y(i,e),s[w]=Gm(t,r)-s[v]),o&&(g<Sw[0]||ql.useDir)&&(Sw[0]=Gm(g,Sw[0]),(u<f||!ql.bidirectional)&&(Yb[v]=u,Yb[y]=0,ql.useDir&&ql.calcDirMTV()),(u>=f||!ql.bidirectional)&&(Yb[v]=-f,Yb[y]=0,ql.useDir&&ql.calcDirMTV())))}function mY(){var i=0,t=new er,e=new er,r={minTv:new er,maxTv:new er,useDir:!1,dirMinTv:new er,touchThreshold:0,bidirectional:!0,negativeSize:!1,reset:function(o,s){r.touchThreshold=0,o&&o.touchThreshold!=null&&(r.touchThreshold=$y(0,o.touchThreshold)),r.negativeSize=!1,s&&(r.minTv.set(1/0,1/0),r.maxTv.set(0,0),r.useDir=!1,o&&o.direction!=null&&(r.useDir=!0,r.dirMinTv.copy(r.minTv),e.copy(r.minTv),i=o.direction,r.bidirectional=o.bidirectional==null||!!o.bidirectional,r.bidirectional||t.set(Math.cos(i),Math.sin(i))))},calcDirMTV:function(){var o=r.minTv,s=r.dirMinTv,a=o.y*o.y+o.x*o.x,u=Math.sin(i),f=Math.cos(i),g=u*o.y+f*o.x;if(n(g)){n(o.x)&&n(o.y)&&s.set(0,0);return}if(e.x=a*f/g,e.y=a*u/g,n(e.x)&&n(e.y)){s.set(0,0);return}(r.bidirectional||t.dot(e)>0)&&e.len()<s.len()&&s.copy(e)}};function n(o){return CO(o)<1e-10}return r}const sr=wF;var vY="silent";function h_t(i,t,e){return{type:i,event:e,target:t.target,topTarget:t.topTarget,cancelBubble:!1,offsetX:e.zrX,offsetY:e.zrY,gestureEvent:e.gestureEvent,pinchX:e.pinchX,pinchY:e.pinchY,pinchScale:e.pinchScale,wheelDelta:e.zrDelta,zrByTouch:e.zrByTouch,which:e.which,stop:d_t}}function d_t(){Pd(this.event)}var f_t=function(i){xa(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.handler=null,e}return t.prototype.dispose=function(){},t.prototype.setCursor=function(){},t}(zc),hb=function(){function i(t,e){this.x=t,this.y=e}return i}(),p_t=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],gL=new sr(0,0,0,0),_Y=function(i){xa(t,i);function t(e,r,n,o,s){var a=i.call(this)||this;return a._hovered=new hb(0,0),a.storage=e,a.painter=r,a.painterRoot=o,a._pointerSize=s,n=n||new f_t,a.proxy=null,a.setHandlerProxy(n),a._draggingMgr=new Wvt(a),a}return t.prototype.setHandlerProxy=function(e){this.proxy&&this.proxy.dispose(),e&&(gt(p_t,function(r){e.on&&e.on(r,this[r],this)},this),e.handler=this),this.proxy=e},t.prototype.mousemove=function(e){var r=e.zrX,n=e.zrY,o=yY(this,r,n),s=this._hovered,a=s.target;a&&!a.__zr&&(s=this.findHover(s.x,s.y),a=s.target);var u=this._hovered=o?new hb(r,n):this.findHover(r,n),f=u.target,g=this.proxy;g.setCursor&&g.setCursor(f?f.cursor:"default"),a&&f!==a&&this.dispatchToElement(s,"mouseout",e),this.dispatchToElement(u,"mousemove",e),f&&f!==a&&this.dispatchToElement(u,"mouseover",e)},t.prototype.mouseout=function(e){var r=e.zrEventControl;r!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",e),r!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:e})},t.prototype.resize=function(){this._hovered=new hb(0,0)},t.prototype.dispatch=function(e,r){var n=this[e];n&&n.call(this,r)},t.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},t.prototype.setCursorStyle=function(e){var r=this.proxy;r.setCursor&&r.setCursor(e)},t.prototype.dispatchToElement=function(e,r,n){e=e||{};var o=e.target;if(!(o&&o.silent)){for(var s="on"+r,a=h_t(r,e,n);o&&(o[s]&&(a.cancelBubble=!!o[s].call(o,a)),o.trigger(r,a),o=o.__hostTarget?o.__hostTarget:o.parent,!a.cancelBubble););a.cancelBubble||(this.trigger(r,a),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(u){typeof u[s]=="function"&&u[s].call(u,a),u.trigger&&u.trigger(r,a)}))}},t.prototype.findHover=function(e,r,n){var o=this.storage.getDisplayList(),s=new hb(e,r);if(cH(o,s,e,r,n),this._pointerSize&&!s.target){for(var a=[],u=this._pointerSize,f=u/2,g=new sr(e-f,r-f,u,u),v=o.length-1;v>=0;v--){var y=o[v];y!==n&&!y.ignore&&!y.ignoreCoarsePointer&&(!y.parent||!y.parent.ignoreCoarsePointer)&&(gL.copy(y.getBoundingRect()),y.transform&&gL.applyTransform(y.transform),gL.intersect(g)&&a.push(y))}if(a.length)for(var w=4,I=Math.PI/12,E=Math.PI*2,D=0;D<f;D+=w)for(var R=0;R<E;R+=I){var z=e+D*Math.cos(R),N=r+D*Math.sin(R);if(cH(a,s,z,N,n),s.target)return s}}return s},t.prototype.processGesture=function(e,r){this._gestureMgr||(this._gestureMgr=new n_t);var n=this._gestureMgr;r==="start"&&n.clear();var o=n.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);if(r==="end"&&n.clear(),o){var s=o.type;e.gestureEvent=s;var a=new hb;a.target=o.target,this.dispatchToElement(a,s,o.event)}},t}(zc);gt(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(i){_Y.prototype[i]=function(t){var e=t.zrX,r=t.zrY,n=yY(this,e,r),o,s;if((i!=="mouseup"||!n)&&(o=this.findHover(e,r),s=o.target),i==="mousedown")this._downEl=s,this._downPoint=[t.zrX,t.zrY],this._upEl=s;else if(i==="mouseup")this._upEl=s;else if(i==="click"){if(this._downEl!==this._upEl||!this._downPoint||lp(this._downPoint,[t.zrX,t.zrY])>4)return;this._downPoint=null}this.dispatchToElement(o,i,t)}});function g_t(i,t,e){if(i[i.rectHover?"rectContain":"contain"](t,e)){for(var r=i,n=void 0,o=!1;r;){if(r.ignoreClip&&(o=!0),!o){var s=r.getClipPath();if(s&&!s.contain(t,e))return!1}r.silent&&(n=!0);var a=r.__hostTarget;r=a?r.ignoreHostSilent?null:a:r.parent}return n?vY:!0}return!1}function cH(i,t,e,r,n){for(var o=i.length-1;o>=0;o--){var s=i[o],a=void 0;if(s!==n&&!s.ignore&&(a=g_t(s,e,r))&&(!t.topTarget&&(t.topTarget=s),a!==vY)){t.target=s;break}}}function yY(i,t,e){var r=i.painter;return t<0||t>r.getWidth()||e<0||e>r.getHeight()}const m_t=_Y;var xY=32,db=7;function v_t(i){for(var t=0;i>=xY;)t|=i&1,i>>=1;return i+t}function uH(i,t,e,r){var n=t+1;if(n===e)return 1;if(r(i[n++],i[t])<0){for(;n<e&&r(i[n],i[n-1])<0;)n++;__t(i,t,n)}else for(;n<e&&r(i[n],i[n-1])>=0;)n++;return n-t}function __t(i,t,e){for(e--;t<e;){var r=i[t];i[t++]=i[e],i[e--]=r}}function hH(i,t,e,r,n){for(r===t&&r++;r<e;r++){for(var o=i[r],s=t,a=r,u;s<a;)u=s+a>>>1,n(o,i[u])<0?a=u:s=u+1;var f=r-s;switch(f){case 3:i[s+3]=i[s+2];case 2:i[s+2]=i[s+1];case 1:i[s+1]=i[s];break;default:for(;f>0;)i[s+f]=i[s+f-1],f--}i[s]=o}}function mL(i,t,e,r,n,o){var s=0,a=0,u=1;if(o(i,t[e+n])>0){for(a=r-n;u<a&&o(i,t[e+n+u])>0;)s=u,u=(u<<1)+1,u<=0&&(u=a);u>a&&(u=a),s+=n,u+=n}else{for(a=n+1;u<a&&o(i,t[e+n-u])<=0;)s=u,u=(u<<1)+1,u<=0&&(u=a);u>a&&(u=a);var f=s;s=n-u,u=n-f}for(s++;s<u;){var g=s+(u-s>>>1);o(i,t[e+g])>0?s=g+1:u=g}return u}function vL(i,t,e,r,n,o){var s=0,a=0,u=1;if(o(i,t[e+n])<0){for(a=n+1;u<a&&o(i,t[e+n-u])<0;)s=u,u=(u<<1)+1,u<=0&&(u=a);u>a&&(u=a);var f=s;s=n-u,u=n-f}else{for(a=r-n;u<a&&o(i,t[e+n+u])>=0;)s=u,u=(u<<1)+1,u<=0&&(u=a);u>a&&(u=a),s+=n,u+=n}for(s++;s<u;){var g=s+(u-s>>>1);o(i,t[e+g])<0?u=g:s=g+1}return u}function y_t(i,t){var e=db,r,n,o=0,s=[];r=[],n=[];function a(w,I){r[o]=w,n[o]=I,o+=1}function u(){for(;o>1;){var w=o-2;if(w>=1&&n[w-1]<=n[w]+n[w+1]||w>=2&&n[w-2]<=n[w]+n[w-1])n[w-1]<n[w+1]&&w--;else if(n[w]>n[w+1])break;g(w)}}function f(){for(;o>1;){var w=o-2;w>0&&n[w-1]<n[w+1]&&w--,g(w)}}function g(w){var I=r[w],E=n[w],D=r[w+1],R=n[w+1];n[w]=E+R,w===o-3&&(r[w+1]=r[w+2],n[w+1]=n[w+2]),o--;var z=vL(i[D],i,I,E,0,t);I+=z,E-=z,E!==0&&(R=mL(i[I+E-1],i,D,R,R-1,t),R!==0&&(E<=R?v(I,E,D,R):y(I,E,D,R)))}function v(w,I,E,D){var R=0;for(R=0;R<I;R++)s[R]=i[w+R];var z=0,N=E,H=w;if(i[H++]=i[N++],--D===0){for(R=0;R<I;R++)i[H+R]=s[z+R];return}if(I===1){for(R=0;R<D;R++)i[H+R]=i[N+R];i[H+D]=s[z];return}for(var $=e,X,K,et;;){X=0,K=0,et=!1;do if(t(i[N],s[z])<0){if(i[H++]=i[N++],K++,X=0,--D===0){et=!0;break}}else if(i[H++]=s[z++],X++,K=0,--I===1){et=!0;break}while((X|K)<$);if(et)break;do{if(X=vL(i[N],s,z,I,0,t),X!==0){for(R=0;R<X;R++)i[H+R]=s[z+R];if(H+=X,z+=X,I-=X,I<=1){et=!0;break}}if(i[H++]=i[N++],--D===0){et=!0;break}if(K=mL(s[z],i,N,D,0,t),K!==0){for(R=0;R<K;R++)i[H+R]=i[N+R];if(H+=K,N+=K,D-=K,D===0){et=!0;break}}if(i[H++]=s[z++],--I===1){et=!0;break}$--}while(X>=db||K>=db);if(et)break;$<0&&($=0),$+=2}if(e=$,e<1&&(e=1),I===1){for(R=0;R<D;R++)i[H+R]=i[N+R];i[H+D]=s[z]}else{if(I===0)throw new Error;for(R=0;R<I;R++)i[H+R]=s[z+R]}}function y(w,I,E,D){var R=0;for(R=0;R<D;R++)s[R]=i[E+R];var z=w+I-1,N=D-1,H=E+D-1,$=0,X=0;if(i[H--]=i[z--],--I===0){for($=H-(D-1),R=0;R<D;R++)i[$+R]=s[R];return}if(D===1){for(H-=I,z-=I,X=H+1,$=z+1,R=I-1;R>=0;R--)i[X+R]=i[$+R];i[H]=s[N];return}for(var K=e;;){var et=0,rt=0,lt=!1;do if(t(s[N],i[z])<0){if(i[H--]=i[z--],et++,rt=0,--I===0){lt=!0;break}}else if(i[H--]=s[N--],rt++,et=0,--D===1){lt=!0;break}while((et|rt)<K);if(lt)break;do{if(et=I-vL(s[N],i,w,I,I-1,t),et!==0){for(H-=et,z-=et,I-=et,X=H+1,$=z+1,R=et-1;R>=0;R--)i[X+R]=i[$+R];if(I===0){lt=!0;break}}if(i[H--]=s[N--],--D===1){lt=!0;break}if(rt=D-mL(i[z],s,0,D,D-1,t),rt!==0){for(H-=rt,N-=rt,D-=rt,X=H+1,$=N+1,R=0;R<rt;R++)i[X+R]=s[$+R];if(D<=1){lt=!0;break}}if(i[H--]=i[z--],--I===0){lt=!0;break}K--}while(et>=db||rt>=db);if(lt)break;K<0&&(K=0),K+=2}if(e=K,e<1&&(e=1),D===1){for(H-=I,z-=I,X=H+1,$=z+1,R=I-1;R>=0;R--)i[X+R]=i[$+R];i[H]=s[N]}else{if(D===0)throw new Error;for($=H-(D-1),R=0;R<D;R++)i[$+R]=s[R]}}return{mergeRuns:u,forceMergeRuns:f,pushRun:a}}function NI(i,t,e,r){e||(e=0),r||(r=i.length);var n=r-e;if(!(n<2)){var o=0;if(n<xY){o=uH(i,e,r,t),hH(i,e,r,e+o,t);return}var s=y_t(i,t),a=v_t(n);do{if(o=uH(i,e,r,t),o<a){var u=n;u>a&&(u=a),hH(i,e,e+u,e+o,t),o=u}s.pushRun(e,o),s.mergeRuns(),n-=o,e+=o}while(n!==0);s.forceMergeRuns()}}var Kl=1,Kb=2,Gy=4,dH=!1;function _L(){dH||(dH=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function fH(i,t){return i.zlevel===t.zlevel?i.z===t.z?i.z2-t.z2:i.z-t.z:i.zlevel-t.zlevel}var x_t=function(){function i(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=fH}return i.prototype.traverse=function(t,e){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(t,e)},i.prototype.getDisplayList=function(t,e){e=e||!1;var r=this._displayList;return(t||!r.length)&&this.updateDisplayList(e),r},i.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,r=this._displayList,n=0,o=e.length;n<o;n++)this._updateAndAddDisplayable(e[n],null,t);r.length=this._displayListLen,NI(r,fH)},i.prototype._updateAndAddDisplayable=function(t,e,r){if(!(t.ignore&&!r)){t.beforeUpdate(),t.update(),t.afterUpdate();var n=t.getClipPath(),o=e&&e.length,s=0,a=t.__clipPaths;if(!t.ignoreClip&&(o||n)){if(a||(a=t.__clipPaths=[]),o)for(var u=0;u<e.length;u++)a[s++]=e[u];for(var f=n,g=t;f;)f.parent=g,f.updateTransform(),a[s++]=f,g=f,f=f.getClipPath()}if(a&&(a.length=s),t.childrenRef){for(var v=t.childrenRef(),y=0;y<v.length;y++){var w=v[y];t.__dirty&&(w.__dirty|=Kl),this._updateAndAddDisplayable(w,a,r)}t.__dirty=0}else{var I=t;isNaN(I.z)&&(_L(),I.z=0),isNaN(I.z2)&&(_L(),I.z2=0),isNaN(I.zlevel)&&(_L(),I.zlevel=0),this._displayList[this._displayListLen++]=I}var E=t.getDecalElement&&t.getDecalElement();E&&this._updateAndAddDisplayable(E,a,r);var D=t.getTextGuideLine();D&&this._updateAndAddDisplayable(D,a,r);var R=t.getTextContent();R&&this._updateAndAddDisplayable(R,a,r)}},i.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},i.prototype.delRoot=function(t){if(t instanceof Array){for(var e=0,r=t.length;e<r;e++)this.delRoot(t[e]);return}var n=Ar(this._roots,t);n>=0&&this._roots.splice(n,1)},i.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},i.prototype.getRoots=function(){return this._roots},i.prototype.dispose=function(){this._displayList=null,this._roots=null},i}();const b_t=x_t;var bY;bY=Sn.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(i){return setTimeout(i,16)};const DO=bY;var VI={linear:function(i){return i},quadraticIn:function(i){return i*i},quadraticOut:function(i){return i*(2-i)},quadraticInOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)},cubicIn:function(i){return i*i*i},cubicOut:function(i){return--i*i*i+1},cubicInOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)},quarticIn:function(i){return i*i*i*i},quarticOut:function(i){return 1- --i*i*i*i},quarticInOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)},quinticIn:function(i){return i*i*i*i*i},quinticOut:function(i){return--i*i*i*i*i+1},quinticInOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)},sinusoidalIn:function(i){return 1-Math.cos(i*Math.PI/2)},sinusoidalOut:function(i){return Math.sin(i*Math.PI/2)},sinusoidalInOut:function(i){return .5*(1-Math.cos(Math.PI*i))},exponentialIn:function(i){return i===0?0:Math.pow(1024,i-1)},exponentialOut:function(i){return i===1?1:1-Math.pow(2,-10*i)},exponentialInOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)},circularIn:function(i){return 1-Math.sqrt(1-i*i)},circularOut:function(i){return Math.sqrt(1- --i*i)},circularInOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)},elasticIn:function(i){var t,e=.1,r=.4;return i===0?0:i===1?1:(!e||e<1?(e=1,t=r/4):t=r*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(i-=1))*Math.sin((i-t)*(2*Math.PI)/r)))},elasticOut:function(i){var t,e=.1,r=.4;return i===0?0:i===1?1:(!e||e<1?(e=1,t=r/4):t=r*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*i)*Math.sin((i-t)*(2*Math.PI)/r)+1)},elasticInOut:function(i){var t,e=.1,r=.4;return i===0?0:i===1?1:(!e||e<1?(e=1,t=r/4):t=r*Math.asin(1/e)/(2*Math.PI),(i*=2)<1?-.5*(e*Math.pow(2,10*(i-=1))*Math.sin((i-t)*(2*Math.PI)/r)):e*Math.pow(2,-10*(i-=1))*Math.sin((i-t)*(2*Math.PI)/r)*.5+1)},backIn:function(i){var t=1.70158;return i*i*((t+1)*i-t)},backOut:function(i){var t=1.70158;return--i*i*((t+1)*i+t)+1},backInOut:function(i){var t=2.5949095;return(i*=2)<1?.5*(i*i*((t+1)*i-t)):.5*((i-=2)*i*((t+1)*i+t)+2)},bounceIn:function(i){return 1-VI.bounceOut(1-i)},bounceOut:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},bounceInOut:function(i){return i<.5?VI.bounceIn(i*2)*.5:VI.bounceOut(i*2-1)*.5+.5}};const wY=VI;var aA=Math.pow,yp=Math.sqrt,TM=1e-8,SY=1e-4,pH=yp(3),oA=1/3,rh=wv(),Ac=wv(),o0=wv();function hp(i){return i>-TM&&i<TM}function TY(i){return i>TM||i<-TM}function Ho(i,t,e,r,n){var o=1-n;return o*o*(o*i+3*n*t)+n*n*(n*r+3*o*e)}function gH(i,t,e,r,n){var o=1-n;return 3*(((t-i)*o+2*(e-t)*n)*o+(r-e)*n*n)}function AM(i,t,e,r,n,o){var s=r+3*(t-e)-i,a=3*(e-t*2+i),u=3*(t-i),f=i-n,g=a*a-3*s*u,v=a*u-9*s*f,y=u*u-3*a*f,w=0;if(hp(g)&&hp(v))if(hp(a))o[0]=0;else{var I=-u/a;I>=0&&I<=1&&(o[w++]=I)}else{var E=v*v-4*g*y;if(hp(E)){var D=v/g,I=-a/s+D,R=-D/2;I>=0&&I<=1&&(o[w++]=I),R>=0&&R<=1&&(o[w++]=R)}else if(E>0){var z=yp(E),N=g*a+1.5*s*(-v+z),H=g*a+1.5*s*(-v-z);N<0?N=-aA(-N,oA):N=aA(N,oA),H<0?H=-aA(-H,oA):H=aA(H,oA);var I=(-a-(N+H))/(3*s);I>=0&&I<=1&&(o[w++]=I)}else{var $=(2*g*a-3*s*v)/(2*yp(g*g*g)),X=Math.acos($)/3,K=yp(g),et=Math.cos(X),I=(-a-2*K*et)/(3*s),R=(-a+K*(et+pH*Math.sin(X)))/(3*s),rt=(-a+K*(et-pH*Math.sin(X)))/(3*s);I>=0&&I<=1&&(o[w++]=I),R>=0&&R<=1&&(o[w++]=R),rt>=0&&rt<=1&&(o[w++]=rt)}}return w}function AY(i,t,e,r,n){var o=6*e-12*t+6*i,s=9*t+3*r-3*i-9*e,a=3*t-3*i,u=0;if(hp(s)){if(TY(o)){var f=-a/o;f>=0&&f<=1&&(n[u++]=f)}}else{var g=o*o-4*s*a;if(hp(g))n[0]=-o/(2*s);else if(g>0){var v=yp(g),f=(-o+v)/(2*s),y=(-o-v)/(2*s);f>=0&&f<=1&&(n[u++]=f),y>=0&&y<=1&&(n[u++]=y)}}return u}function Dp(i,t,e,r,n,o){var s=(t-i)*n+i,a=(e-t)*n+t,u=(r-e)*n+e,f=(a-s)*n+s,g=(u-a)*n+a,v=(g-f)*n+f;o[0]=i,o[1]=s,o[2]=f,o[3]=v,o[4]=v,o[5]=g,o[6]=u,o[7]=r}function IY(i,t,e,r,n,o,s,a,u,f,g){var v,y=.005,w=1/0,I,E,D,R;rh[0]=u,rh[1]=f;for(var z=0;z<1;z+=.05)Ac[0]=Ho(i,e,n,s,z),Ac[1]=Ho(t,r,o,a,z),D=tv(rh,Ac),D<w&&(v=z,w=D);w=1/0;for(var N=0;N<32&&!(y<SY);N++)I=v-y,E=v+y,Ac[0]=Ho(i,e,n,s,I),Ac[1]=Ho(t,r,o,a,I),D=tv(Ac,rh),I>=0&&D<w?(v=I,w=D):(o0[0]=Ho(i,e,n,s,E),o0[1]=Ho(t,r,o,a,E),R=tv(o0,rh),E<=1&&R<w?(v=E,w=R):y*=.5);return g&&(g[0]=Ho(i,e,n,s,v),g[1]=Ho(t,r,o,a,v)),yp(w)}function w_t(i,t,e,r,n,o,s,a,u){for(var f=i,g=t,v=0,y=1/u,w=1;w<=u;w++){var I=w*y,E=Ho(i,e,n,s,I),D=Ho(t,r,o,a,I),R=E-f,z=D-g;v+=Math.sqrt(R*R+z*z),f=E,g=D}return v}function is(i,t,e,r){var n=1-r;return n*(n*i+2*r*t)+r*r*e}function PO(i,t,e,r){return 2*((1-r)*(t-i)+r*(e-t))}function S_t(i,t,e,r,n){var o=i-2*t+e,s=2*(t-i),a=i-r,u=0;if(hp(o)){if(TY(s)){var f=-a/s;f>=0&&f<=1&&(n[u++]=f)}}else{var g=s*s-4*o*a;if(hp(g)){var f=-s/(2*o);f>=0&&f<=1&&(n[u++]=f)}else if(g>0){var v=yp(g),f=(-s+v)/(2*o),y=(-s-v)/(2*o);f>=0&&f<=1&&(n[u++]=f),y>=0&&y<=1&&(n[u++]=y)}}return u}function MY(i,t,e){var r=i+e-2*t;return r===0?.5:(i-t)/r}function Xw(i,t,e,r,n){var o=(t-i)*r+i,s=(e-t)*r+t,a=(s-o)*r+o;n[0]=i,n[1]=o,n[2]=a,n[3]=a,n[4]=s,n[5]=e}function CY(i,t,e,r,n,o,s,a,u){var f,g=.005,v=1/0;rh[0]=s,rh[1]=a;for(var y=0;y<1;y+=.05){Ac[0]=is(i,e,n,y),Ac[1]=is(t,r,o,y);var w=tv(rh,Ac);w<v&&(f=y,v=w)}v=1/0;for(var I=0;I<32&&!(g<SY);I++){var E=f-g,D=f+g;Ac[0]=is(i,e,n,E),Ac[1]=is(t,r,o,E);var w=tv(Ac,rh);if(E>=0&&w<v)f=E,v=w;else{o0[0]=is(i,e,n,D),o0[1]=is(t,r,o,D);var R=tv(o0,rh);D<=1&&R<v?(f=D,v=R):g*=.5}}return u&&(u[0]=is(i,e,n,f),u[1]=is(t,r,o,f)),yp(v)}function T_t(i,t,e,r,n,o,s){for(var a=i,u=t,f=0,g=1/s,v=1;v<=s;v++){var y=v*g,w=is(i,e,n,y),I=is(t,r,o,y),E=w-a,D=I-u;f+=Math.sqrt(E*E+D*D),a=w,u=I}return f}var A_t=/cubic-bezier\(([0-9,\.e ]+)\)/;function SF(i){var t=i&&A_t.exec(i);if(t){var e=t[1].split(","),r=+Ec(e[0]),n=+Ec(e[1]),o=+Ec(e[2]),s=+Ec(e[3]);if(isNaN(r+n+o+s))return;var a=[];return function(u){return u<=0?0:u>=1?1:AM(0,r,o,1,u,a)&&Ho(0,n,s,1,a[0])}}}var I_t=function(){function i(t){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=t.life||1e3,this._delay=t.delay||0,this.loop=t.loop||!1,this.onframe=t.onframe||uo,this.ondestroy=t.ondestroy||uo,this.onrestart=t.onrestart||uo,t.easing&&this.setEasing(t.easing)}return i.prototype.step=function(t,e){if(this._inited||(this._startTime=t+this._delay,this._inited=!0),this._paused){this._pausedTime+=e;return}var r=this._life,n=t-this._startTime-this._pausedTime,o=n/r;o<0&&(o=0),o=Math.min(o,1);var s=this.easingFunc,a=s?s(o):o;if(this.onframe(a),o===1)if(this.loop){var u=n%r;this._startTime=t-u,this._pausedTime=0,this.onrestart()}else return!0;return!1},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){this._paused=!1},i.prototype.setEasing=function(t){this.easing=t,this.easingFunc=Xi(t)?t:wY[t]||SF(t)},i}();const M_t=I_t;var EY=function(){function i(t){this.value=t}return i}(),C_t=function(){function i(){this._len=0}return i.prototype.insert=function(t){var e=new EY(t);return this.insertEntry(e),e},i.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},i.prototype.remove=function(t){var e=t.prev,r=t.next;e?e.next=r:this.head=r,r?r.prev=e:this.tail=e,t.next=t.prev=null,this._len--},i.prototype.len=function(){return this._len},i.prototype.clear=function(){this.head=this.tail=null,this._len=0},i}(),E_t=function(){function i(t){this._list=new C_t,this._maxSize=10,this._map={},this._maxSize=t}return i.prototype.put=function(t,e){var r=this._list,n=this._map,o=null;if(n[t]==null){var s=r.len(),a=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var u=r.head;r.remove(u),delete n[u.key],o=u.value,this._lastRemovedEntry=u}a?a.value=e:a=new EY(e),a.key=t,r.insertEntry(a),n[t]=a}return o},i.prototype.get=function(t){var e=this._map[t],r=this._list;if(e!=null)return e!==r.tail&&(r.remove(e),r.insertEntry(e)),e.value},i.prototype.clear=function(){this._list.clear(),this._map={}},i.prototype.len=function(){return this._list.len()},i}();const y0=E_t;var mH={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function hu(i){return i=Math.round(i),i<0?0:i>255?255:i}function D_t(i){return i=Math.round(i),i<0?0:i>360?360:i}function Yw(i){return i<0?0:i>1?1:i}function yL(i){var t=i;return t.length&&t.charAt(t.length-1)==="%"?hu(parseFloat(t)/100*255):hu(parseInt(t,10))}function xp(i){var t=i;return t.length&&t.charAt(t.length-1)==="%"?Yw(parseFloat(t)/100):Yw(parseFloat(t))}function xL(i,t,e){return e<0?e+=1:e>1&&(e-=1),e*6<1?i+(t-i)*e*6:e*2<1?t:e*3<2?i+(t-i)*(2/3-e)*6:i}function dp(i,t,e){return i+(t-i)*e}function xc(i,t,e,r,n){return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function LO(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}var DY=new y0(20),sA=null;function fy(i,t){sA&&LO(sA,t),sA=DY.put(i,sA||t.slice())}function Ol(i,t){if(i){t=t||[];var e=DY.get(i);if(e)return LO(t,e);i=i+"";var r=i.replace(/ /g,"").toLowerCase();if(r in mH)return LO(t,mH[r]),fy(i,t),t;var n=r.length;if(r.charAt(0)==="#"){if(n===4||n===5){var o=parseInt(r.slice(1,4),16);if(!(o>=0&&o<=4095)){xc(t,0,0,0,1);return}return xc(t,(o&3840)>>4|(o&3840)>>8,o&240|(o&240)>>4,o&15|(o&15)<<4,n===5?parseInt(r.slice(4),16)/15:1),fy(i,t),t}else if(n===7||n===9){var o=parseInt(r.slice(1,7),16);if(!(o>=0&&o<=16777215)){xc(t,0,0,0,1);return}return xc(t,(o&16711680)>>16,(o&65280)>>8,o&255,n===9?parseInt(r.slice(7),16)/255:1),fy(i,t),t}return}var s=r.indexOf("("),a=r.indexOf(")");if(s!==-1&&a+1===n){var u=r.substr(0,s),f=r.substr(s+1,a-(s+1)).split(","),g=1;switch(u){case"rgba":if(f.length!==4)return f.length===3?xc(t,+f[0],+f[1],+f[2],1):xc(t,0,0,0,1);g=xp(f.pop());case"rgb":if(f.length>=3)return xc(t,yL(f[0]),yL(f[1]),yL(f[2]),f.length===3?g:xp(f[3])),fy(i,t),t;xc(t,0,0,0,1);return;case"hsla":if(f.length!==4){xc(t,0,0,0,1);return}return f[3]=xp(f[3]),RO(f,t),fy(i,t),t;case"hsl":if(f.length!==3){xc(t,0,0,0,1);return}return RO(f,t),fy(i,t),t;default:return}}xc(t,0,0,0,1)}}function RO(i,t){var e=(parseFloat(i[0])%360+360)%360/360,r=xp(i[1]),n=xp(i[2]),o=n<=.5?n*(r+1):n+r-n*r,s=n*2-o;return t=t||[],xc(t,hu(xL(s,o,e+1/3)*255),hu(xL(s,o,e)*255),hu(xL(s,o,e-1/3)*255),1),i.length===4&&(t[3]=i[3]),t}function P_t(i){if(i){var t=i[0]/255,e=i[1]/255,r=i[2]/255,n=Math.min(t,e,r),o=Math.max(t,e,r),s=o-n,a=(o+n)/2,u,f;if(s===0)u=0,f=0;else{a<.5?f=s/(o+n):f=s/(2-o-n);var g=((o-t)/6+s/2)/s,v=((o-e)/6+s/2)/s,y=((o-r)/6+s/2)/s;t===o?u=y-v:e===o?u=1/3+g-y:r===o&&(u=2/3+v-g),u<0&&(u+=1),u>1&&(u-=1)}var w=[u*360,f,a];return i[3]!=null&&w.push(i[3]),w}}function kO(i,t){var e=Ol(i);if(e){for(var r=0;r<3;r++)t<0?e[r]=e[r]*(1-t)|0:e[r]=(255-e[r])*t+e[r]|0,e[r]>255?e[r]=255:e[r]<0&&(e[r]=0);return ph(e,e.length===4?"rgba":"rgb")}}function bL(i,t,e){if(!(!(t&&t.length)||!(i>=0&&i<=1))){e=e||[];var r=i*(t.length-1),n=Math.floor(r),o=Math.ceil(r),s=t[n],a=t[o],u=r-n;return e[0]=hu(dp(s[0],a[0],u)),e[1]=hu(dp(s[1],a[1],u)),e[2]=hu(dp(s[2],a[2],u)),e[3]=Yw(dp(s[3],a[3],u)),e}}function L_t(i,t,e){if(!(!(t&&t.length)||!(i>=0&&i<=1))){var r=i*(t.length-1),n=Math.floor(r),o=Math.ceil(r),s=Ol(t[n]),a=Ol(t[o]),u=r-n,f=ph([hu(dp(s[0],a[0],u)),hu(dp(s[1],a[1],u)),hu(dp(s[2],a[2],u)),Yw(dp(s[3],a[3],u))],"rgba");return e?{color:f,leftIndex:n,rightIndex:o,value:r}:f}}function bp(i,t,e,r){var n=Ol(i);if(i)return n=P_t(n),t!=null&&(n[0]=D_t(Xi(t)?t(n[0]):t)),e!=null&&(n[1]=xp(Xi(e)?e(n[1]):e)),r!=null&&(n[2]=xp(Xi(r)?r(n[2]):r)),ph(RO(n),"rgba")}function IM(i,t){var e=Ol(i);if(e&&t!=null)return e[3]=Yw(t),ph(e,"rgba")}function ph(i,t){if(!(!i||!i.length)){var e=i[0]+","+i[1]+","+i[2];return(t==="rgba"||t==="hsva"||t==="hsla")&&(e+=","+i[3]),t+"("+e+")"}}function MM(i,t){var e=Ol(i);return e?(.299*e[0]+.587*e[1]+.114*e[2])*e[3]/255+(1-e[3])*t:0}var vH=new y0(100);function OO(i){if(bi(i)){var t=vH.get(i);return t||(t=kO(i,-.1),vH.put(i,t)),t}else if(XC(i)){var e=Fe({},i);return e.colorStops=ti(i.colorStops,function(r){return{offset:r.offset,color:kO(r.color,-.1)}}),e}return i}var CM=Math.round;function Kw(i){var t;if(!i||i==="transparent")i="none";else if(typeof i=="string"&&i.indexOf("rgba")>-1){var e=Ol(i);e&&(i="rgb("+e[0]+","+e[1]+","+e[2]+")",t=e[3])}return{color:i,opacity:t??1}}var _H=1e-4;function fp(i){return i<_H&&i>-_H}function lA(i){return CM(i*1e3)/1e3}function zO(i){return CM(i*1e4)/1e4}function R_t(i){return"matrix("+lA(i[0])+","+lA(i[1])+","+lA(i[2])+","+lA(i[3])+","+zO(i[4])+","+zO(i[5])+")"}var k_t={left:"start",right:"end",center:"middle",middle:"middle"};function O_t(i,t,e){return e==="top"?i+=t/2:e==="bottom"&&(i-=t/2),i}function z_t(i){return i&&(i.shadowBlur||i.shadowOffsetX||i.shadowOffsetY)}function B_t(i){var t=i.style,e=i.getGlobalScale();return[t.shadowColor,(t.shadowBlur||0).toFixed(2),(t.shadowOffsetX||0).toFixed(2),(t.shadowOffsetY||0).toFixed(2),e[0],e[1]].join(",")}function PY(i){return i&&!!i.image}function F_t(i){return i&&!!i.svgElement}function TF(i){return PY(i)||F_t(i)}function LY(i){return i.type==="linear"}function RY(i){return i.type==="radial"}function kY(i){return i&&(i.type==="linear"||i.type==="radial")}function tE(i){return"url(#"+i+")"}function OY(i){var t=i.getGlobalScale(),e=Math.max(t[0],t[1]);return Math.max(Math.ceil(Math.log(e)/Math.log(10)),1)}function zY(i){var t=i.x||0,e=i.y||0,r=(i.rotation||0)*zI,n=Ui(i.scaleX,1),o=Ui(i.scaleY,1),s=i.skewX||0,a=i.skewY||0,u=[];return(t||e)&&u.push("translate("+t+"px,"+e+"px)"),r&&u.push("rotate("+r+")"),(n!==1||o!==1)&&u.push("scale("+n+","+o+")"),(s||a)&&u.push("skew("+CM(s*zI)+"deg, "+CM(a*zI)+"deg)"),u.join(" ")}var N_t=function(){return Sn.hasGlobalWindow&&Xi(window.btoa)?function(i){return window.btoa(unescape(encodeURIComponent(i)))}:typeof Buffer<"u"?function(i){return Buffer.from(i).toString("base64")}:function(i){return null}}(),BO=Array.prototype.slice;function ld(i,t,e){return(t-i)*e+i}function wL(i,t,e,r){for(var n=t.length,o=0;o<n;o++)i[o]=ld(t[o],e[o],r);return i}function V_t(i,t,e,r){for(var n=t.length,o=n&&t[0].length,s=0;s<n;s++){i[s]||(i[s]=[]);for(var a=0;a<o;a++)i[s][a]=ld(t[s][a],e[s][a],r)}return i}function cA(i,t,e,r){for(var n=t.length,o=0;o<n;o++)i[o]=t[o]+e[o]*r;return i}function yH(i,t,e,r){for(var n=t.length,o=n&&t[0].length,s=0;s<n;s++){i[s]||(i[s]=[]);for(var a=0;a<o;a++)i[s][a]=t[s][a]+e[s][a]*r}return i}function U_t(i,t){for(var e=i.length,r=t.length,n=e>r?t:i,o=Math.min(e,r),s=n[o-1]||{color:[0,0,0,0],offset:0},a=o;a<Math.max(e,r);a++)n.push({offset:s.offset,color:s.color.slice()})}function G_t(i,t,e){var r=i,n=t;if(!(!r.push||!n.push)){var o=r.length,s=n.length;if(o!==s){var a=o>s;if(a)r.length=s;else for(var u=o;u<s;u++)r.push(e===1?n[u]:BO.call(n[u]))}for(var f=r[0]&&r[0].length,u=0;u<r.length;u++)if(e===1)isNaN(r[u])&&(r[u]=n[u]);else for(var g=0;g<f;g++)isNaN(r[u][g])&&(r[u][g]=n[u][g])}}function Tw(i){if(Ns(i)){var t=i.length;if(Ns(i[0])){for(var e=[],r=0;r<t;r++)e.push(BO.call(i[r]));return e}return BO.call(i)}return i}function UI(i){return i[0]=Math.floor(i[0])||0,i[1]=Math.floor(i[1])||0,i[2]=Math.floor(i[2])||0,i[3]=i[3]==null?1:i[3],"rgba("+i.join(",")+")"}function H_t(i){return Ns(i&&i[0])?2:1}var uA=0,GI=1,BY=2,Jb=3,FO=4,NO=5,xH=6;function bH(i){return i===FO||i===NO}function hA(i){return i===GI||i===BY}var fb=[0,0,0,0],j_t=function(){function i(t){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=t}return i.prototype.isFinished=function(){return this._finished},i.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},i.prototype.needsAnimate=function(){return this.keyframes.length>=1},i.prototype.getAdditiveTrack=function(){return this._additiveTrack},i.prototype.addKeyframe=function(t,e,r){this._needsSort=!0;var n=this.keyframes,o=n.length,s=!1,a=xH,u=e;if(Ns(e)){var f=H_t(e);a=f,(f===1&&!fn(e[0])||f===2&&!fn(e[0][0]))&&(s=!0)}else if(fn(e)&&!Bs(e))a=uA;else if(bi(e))if(!isNaN(+e))a=uA;else{var g=Ol(e);g&&(u=g,a=Jb)}else if(XC(e)){var v=Fe({},u);v.colorStops=ti(e.colorStops,function(w){return{offset:w.offset,color:Ol(w.color)}}),LY(e)?a=FO:RY(e)&&(a=NO),u=v}o===0?this.valType=a:(a!==this.valType||a===xH)&&(s=!0),this.discrete=this.discrete||s;var y={time:t,value:u,rawValue:e,percent:0};return r&&(y.easing=r,y.easingFunc=Xi(r)?r:wY[r]||SF(r)),n.push(y),y},i.prototype.prepare=function(t,e){var r=this.keyframes;this._needsSort&&r.sort(function(E,D){return E.time-D.time});for(var n=this.valType,o=r.length,s=r[o-1],a=this.discrete,u=hA(n),f=bH(n),g=0;g<o;g++){var v=r[g],y=v.value,w=s.value;v.percent=v.time/t,a||(u&&g!==o-1?G_t(y,w,n):f&&U_t(y.colorStops,w.colorStops))}if(!a&&n!==NO&&e&&this.needsAnimate()&&e.needsAnimate()&&n===e.valType&&!e._finished){this._additiveTrack=e;for(var I=r[0].value,g=0;g<o;g++)n===uA?r[g].additiveValue=r[g].value-I:n===Jb?r[g].additiveValue=cA([],r[g].value,I,-1):hA(n)&&(r[g].additiveValue=n===GI?cA([],r[g].value,I,-1):yH([],r[g].value,I,-1))}},i.prototype.step=function(t,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var r=this._additiveTrack!=null,n=r?"additiveValue":"value",o=this.valType,s=this.keyframes,a=s.length,u=this.propName,f=o===Jb,g,v=this._lastFr,y=Math.min,w,I;if(a===1)w=I=s[0];else{if(e<0)g=0;else if(e<this._lastFrP){var E=y(v+1,a-1);for(g=E;g>=0&&!(s[g].percent<=e);g--);g=y(g,a-2)}else{for(g=v;g<a&&!(s[g].percent>e);g++);g=y(g-1,a-2)}I=s[g+1],w=s[g]}if(w&&I){this._lastFr=g,this._lastFrP=e;var D=I.percent-w.percent,R=D===0?1:y((e-w.percent)/D,1);I.easingFunc&&(R=I.easingFunc(R));var z=r?this._additiveValue:f?fb:t[u];if((hA(o)||f)&&!z&&(z=this._additiveValue=[]),this.discrete)t[u]=R<1?w.rawValue:I.rawValue;else if(hA(o))o===GI?wL(z,w[n],I[n],R):V_t(z,w[n],I[n],R);else if(bH(o)){var N=w[n],H=I[n],$=o===FO;t[u]={type:$?"linear":"radial",x:ld(N.x,H.x,R),y:ld(N.y,H.y,R),colorStops:ti(N.colorStops,function(K,et){var rt=H.colorStops[et];return{offset:ld(K.offset,rt.offset,R),color:UI(wL([],K.color,rt.color,R))}}),global:H.global},$?(t[u].x2=ld(N.x2,H.x2,R),t[u].y2=ld(N.y2,H.y2,R)):t[u].r=ld(N.r,H.r,R)}else if(f)wL(z,w[n],I[n],R),r||(t[u]=UI(z));else{var X=ld(w[n],I[n],R);r?this._additiveValue=X:t[u]=X}r&&this._addToTarget(t)}}},i.prototype._addToTarget=function(t){var e=this.valType,r=this.propName,n=this._additiveValue;e===uA?t[r]=t[r]+n:e===Jb?(Ol(t[r],fb),cA(fb,fb,n,1),t[r]=UI(fb)):e===GI?cA(t[r],t[r],n,1):e===BY&&yH(t[r],t[r],n,1)},i}(),AF=function(){function i(t,e,r,n){if(this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=t,this._loop=e,e&&n){mF("Can' use additive animation on looped animation.");return}this._additiveAnimators=n,this._allowDiscrete=r}return i.prototype.getMaxTime=function(){return this._maxTime},i.prototype.getDelay=function(){return this._delay},i.prototype.getLoop=function(){return this._loop},i.prototype.getTarget=function(){return this._target},i.prototype.changeTarget=function(t){this._target=t},i.prototype.when=function(t,e,r){return this.whenWithKeys(t,e,on(e),r)},i.prototype.whenWithKeys=function(t,e,r,n){for(var o=this._tracks,s=0;s<r.length;s++){var a=r[s],u=o[a];if(!u){u=o[a]=new j_t(a);var f=void 0,g=this._getAdditiveTrack(a);if(g){var v=g.keyframes,y=v[v.length-1];f=y&&y.value,g.valType===Jb&&f&&(f=UI(f))}else f=this._target[a];if(f==null)continue;t>0&&u.addKeyframe(0,Tw(f),n),this._trackKeys.push(a)}u.addKeyframe(t,Tw(e[a]),n)}return this._maxTime=Math.max(this._maxTime,t),this},i.prototype.pause=function(){this._clip.pause(),this._paused=!0},i.prototype.resume=function(){this._clip.resume(),this._paused=!1},i.prototype.isPaused=function(){return!!this._paused},i.prototype.duration=function(t){return this._maxTime=t,this._force=!0,this},i.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var t=this._doneCbs;if(t)for(var e=t.length,r=0;r<e;r++)t[r].call(this)},i.prototype._abortedCallback=function(){this._setTracksFinished();var t=this.animation,e=this._abortedCbs;if(t&&t.removeClip(this._clip),this._clip=null,e)for(var r=0;r<e.length;r++)e[r].call(this)},i.prototype._setTracksFinished=function(){for(var t=this._tracks,e=this._trackKeys,r=0;r<e.length;r++)t[e[r]].setFinished()},i.prototype._getAdditiveTrack=function(t){var e,r=this._additiveAnimators;if(r)for(var n=0;n<r.length;n++){var o=r[n].getTrack(t);o&&(e=o)}return e},i.prototype.start=function(t){if(!(this._started>0)){this._started=1;for(var e=this,r=[],n=this._maxTime||0,o=0;o<this._trackKeys.length;o++){var s=this._trackKeys[o],a=this._tracks[s],u=this._getAdditiveTrack(s),f=a.keyframes,g=f.length;if(a.prepare(n,u),a.needsAnimate())if(!this._allowDiscrete&&a.discrete){var v=f[g-1];v&&(e._target[a.propName]=v.rawValue),a.setFinished()}else r.push(a)}if(r.length||this._force){var y=new M_t({life:n,loop:this._loop,delay:this._delay||0,onframe:function(w){e._started=2;var I=e._additiveAnimators;if(I){for(var E=!1,D=0;D<I.length;D++)if(I[D]._clip){E=!0;break}E||(e._additiveAnimators=null)}for(var D=0;D<r.length;D++)r[D].step(e._target,w);var R=e._onframeCbs;if(R)for(var D=0;D<R.length;D++)R[D](e._target,w)},ondestroy:function(){e._doneCallback()}});this._clip=y,this.animation&&this.animation.addClip(y),t&&y.setEasing(t)}else this._doneCallback();return this}},i.prototype.stop=function(t){if(this._clip){var e=this._clip;t&&e.onframe(1),this._abortedCallback()}},i.prototype.delay=function(t){return this._delay=t,this},i.prototype.during=function(t){return t&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(t)),this},i.prototype.done=function(t){return t&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(t)),this},i.prototype.aborted=function(t){return t&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(t)),this},i.prototype.getClip=function(){return this._clip},i.prototype.getTrack=function(t){return this._tracks[t]},i.prototype.getTracks=function(){var t=this;return ti(this._trackKeys,function(e){return t._tracks[e]})},i.prototype.stopTracks=function(t,e){if(!t.length||!this._clip)return!0;for(var r=this._tracks,n=this._trackKeys,o=0;o<t.length;o++){var s=r[t[o]];s&&!s.isFinished()&&(e?s.step(this._target,1):this._started===1&&s.step(this._target,0),s.setFinished())}for(var a=!0,o=0;o<n.length;o++)if(!r[n[o]].isFinished()){a=!1;break}return a&&this._abortedCallback(),a},i.prototype.saveTo=function(t,e,r){if(t){e=e||this._trackKeys;for(var n=0;n<e.length;n++){var o=e[n],s=this._tracks[o];if(!(!s||s.isFinished())){var a=s.keyframes,u=a[r?0:a.length-1];u&&(t[o]=Tw(u.rawValue))}}}},i.prototype.__changeFinalValue=function(t,e){e=e||on(t);for(var r=0;r<e.length;r++){var n=e[r],o=this._tracks[n];if(o){var s=o.keyframes;if(s.length>1){var a=s.pop();o.addKeyframe(a.time,t[n]),o.prepare(this._maxTime,o.getAdditiveTrack())}}}},i}();function Zy(){return new Date().getTime()}var W_t=function(i){xa(t,i);function t(e){var r=i.call(this)||this;return r._running=!1,r._time=0,r._pausedTime=0,r._pauseStart=0,r._paused=!1,e=e||{},r.stage=e.stage||{},r}return t.prototype.addClip=function(e){e.animation&&this.removeClip(e),this._head?(this._tail.next=e,e.prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this},t.prototype.addAnimator=function(e){e.animation=this;var r=e.getClip();r&&this.addClip(r)},t.prototype.removeClip=function(e){if(e.animation){var r=e.prev,n=e.next;r?r.next=n:this._head=n,n?n.prev=r:this._tail=r,e.next=e.prev=e.animation=null}},t.prototype.removeAnimator=function(e){var r=e.getClip();r&&this.removeClip(r),e.animation=null},t.prototype.update=function(e){for(var r=Zy()-this._pausedTime,n=r-this._time,o=this._head;o;){var s=o.next,a=o.step(r,n);a&&(o.ondestroy(),this.removeClip(o)),o=s}this._time=r,e||(this.trigger("frame",n),this.stage.update&&this.stage.update())},t.prototype._startLoop=function(){var e=this;this._running=!0;function r(){e._running&&(DO(r),!e._paused&&e.update())}DO(r)},t.prototype.start=function(){this._running||(this._time=Zy(),this._pausedTime=0,this._startLoop())},t.prototype.stop=function(){this._running=!1},t.prototype.pause=function(){this._paused||(this._pauseStart=Zy(),this._paused=!0)},t.prototype.resume=function(){this._paused&&(this._pausedTime+=Zy()-this._pauseStart,this._paused=!1)},t.prototype.clear=function(){for(var e=this._head;e;){var r=e.next;e.prev=e.next=e.animation=null,e=r}this._head=this._tail=null},t.prototype.isFinished=function(){return this._head==null},t.prototype.animate=function(e,r){r=r||{},this.start();var n=new AF(e,r.loop);return this.addAnimator(n),n},t}(zc);const $_t=W_t;var Z_t=300,SL=Sn.domSupported,TL=function(){var i=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],t=["touchstart","touchend","touchmove"],e={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},r=ti(i,function(n){var o=n.replace("mouse","pointer");return e.hasOwnProperty(o)?o:n});return{mouse:i,touch:t,pointer:r}}(),wH={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},SH=!1;function VO(i){var t=i.pointerType;return t==="pen"||t==="touch"}function q_t(i){i.touching=!0,i.touchTimer!=null&&(clearTimeout(i.touchTimer),i.touchTimer=null),i.touchTimer=setTimeout(function(){i.touching=!1,i.touchTimer=null},700)}function AL(i){i&&(i.zrByTouch=!0)}function X_t(i,t){return bc(i.dom,new Y_t(i,t),!0)}function FY(i,t){for(var e=t,r=!1;e&&e.nodeType!==9&&!(r=e.domBelongToZr||e!==t&&e===i.painterRoot);)e=e.parentNode;return r}var Y_t=function(){function i(t,e){this.stopPropagation=uo,this.stopImmediatePropagation=uo,this.preventDefault=uo,this.type=e.type,this.target=this.currentTarget=t.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY}return i}(),nu={mousedown:function(i){i=bc(this.dom,i),this.__mayPointerCapture=[i.zrX,i.zrY],this.trigger("mousedown",i)},mousemove:function(i){i=bc(this.dom,i);var t=this.__mayPointerCapture;t&&(i.zrX!==t[0]||i.zrY!==t[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",i)},mouseup:function(i){i=bc(this.dom,i),this.__togglePointerCapture(!1),this.trigger("mouseup",i)},mouseout:function(i){i=bc(this.dom,i);var t=i.toElement||i.relatedTarget;FY(this,t)||(this.__pointerCapturing&&(i.zrEventControl="no_globalout"),this.trigger("mouseout",i))},wheel:function(i){SH=!0,i=bc(this.dom,i),this.trigger("mousewheel",i)},mousewheel:function(i){SH||(i=bc(this.dom,i),this.trigger("mousewheel",i))},touchstart:function(i){i=bc(this.dom,i),AL(i),this.__lastTouchMoment=new Date,this.handler.processGesture(i,"start"),nu.mousemove.call(this,i),nu.mousedown.call(this,i)},touchmove:function(i){i=bc(this.dom,i),AL(i),this.handler.processGesture(i,"change"),nu.mousemove.call(this,i)},touchend:function(i){i=bc(this.dom,i),AL(i),this.handler.processGesture(i,"end"),nu.mouseup.call(this,i),+new Date-+this.__lastTouchMoment<Z_t&&nu.click.call(this,i)},pointerdown:function(i){nu.mousedown.call(this,i)},pointermove:function(i){VO(i)||nu.mousemove.call(this,i)},pointerup:function(i){nu.mouseup.call(this,i)},pointerout:function(i){VO(i)||nu.mouseout.call(this,i)}};gt(["click","dblclick","contextmenu"],function(i){nu[i]=function(t){t=bc(this.dom,t),this.trigger(i,t)}});var UO={pointermove:function(i){VO(i)||UO.mousemove.call(this,i)},pointerup:function(i){UO.mouseup.call(this,i)},mousemove:function(i){this.trigger("mousemove",i)},mouseup:function(i){var t=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",i),t&&(i.zrEventControl="only_globalout",this.trigger("mouseout",i))}};function K_t(i,t){var e=t.domHandlers;Sn.pointerEventsSupported?gt(TL.pointer,function(r){HI(t,r,function(n){e[r].call(i,n)})}):(Sn.touchEventsSupported&&gt(TL.touch,function(r){HI(t,r,function(n){e[r].call(i,n),q_t(t)})}),gt(TL.mouse,function(r){HI(t,r,function(n){n=xF(n),t.touching||e[r].call(i,n)})}))}function J_t(i,t){Sn.pointerEventsSupported?gt(wH.pointer,e):Sn.touchEventsSupported||gt(wH.mouse,e);function e(r){function n(o){o=xF(o),FY(i,o.target)||(o=X_t(i,o),t.domHandlers[r].call(i,o))}HI(t,r,n,{capture:!0})}}function HI(i,t,e,r){i.mounted[t]=e,i.listenerOpts[t]=r,MO(i.domTarget,t,e,r)}function IL(i){var t=i.mounted;for(var e in t)t.hasOwnProperty(e)&&r_t(i.domTarget,e,t[e],i.listenerOpts[e]);i.mounted={}}var TH=function(){function i(t,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=t,this.domHandlers=e}return i}(),Q_t=function(i){xa(t,i);function t(e,r){var n=i.call(this)||this;return n.__pointerCapturing=!1,n.dom=e,n.painterRoot=r,n._localHandlerScope=new TH(e,nu),SL&&(n._globalHandlerScope=new TH(document,UO)),K_t(n,n._localHandlerScope),n}return t.prototype.dispose=function(){IL(this._localHandlerScope),SL&&IL(this._globalHandlerScope)},t.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},t.prototype.__togglePointerCapture=function(e){if(this.__mayPointerCapture=null,SL&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var r=this._globalHandlerScope;e?J_t(this,r):IL(r)}},t}(zc);const tyt=Q_t;var NY=1;Sn.hasGlobalWindow&&(NY=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var EM=NY,GO=.4,HO="#333",jO="#ccc",eyt="#eee",AH=JC,IH=5e-5;function rm(i){return i>IH||i<-IH}var nm=[],py=[],ML=ns(),CL=Math.abs,iyt=function(){function i(){}return i.prototype.getLocalTransform=function(t){return i.getLocalTransform(this,t)},i.prototype.setPosition=function(t){this.x=t[0],this.y=t[1]},i.prototype.setScale=function(t){this.scaleX=t[0],this.scaleY=t[1]},i.prototype.setSkew=function(t){this.skewX=t[0],this.skewY=t[1]},i.prototype.setOrigin=function(t){this.originX=t[0],this.originY=t[1]},i.prototype.needLocalTransform=function(){return rm(this.rotation)||rm(this.x)||rm(this.y)||rm(this.scaleX-1)||rm(this.scaleY-1)||rm(this.skewX)||rm(this.skewY)},i.prototype.updateTransform=function(){var t=this.parent&&this.parent.transform,e=this.needLocalTransform(),r=this.transform;if(!(e||t)){r&&(AH(r),this.invTransform=null);return}r=r||ns(),e?this.getLocalTransform(r):AH(r),t&&(e?fh(r,t,r):QC(r,t)),this.transform=r,this._resolveGlobalScaleRatio(r)},i.prototype._resolveGlobalScaleRatio=function(t){var e=this.globalScaleRatio;if(e!=null&&e!==1){this.getGlobalScale(nm);var r=nm[0]<0?-1:1,n=nm[1]<0?-1:1,o=((nm[0]-r)*e+r)/nm[0]||0,s=((nm[1]-n)*e+n)/nm[1]||0;t[0]*=o,t[1]*=o,t[2]*=s,t[3]*=s}this.invTransform=this.invTransform||ns(),mu(this.invTransform,t)},i.prototype.getComputedTransform=function(){for(var t=this,e=[];t;)e.push(t),t=t.parent;for(;t=e.pop();)t.updateTransform();return this.transform},i.prototype.setLocalTransform=function(t){if(t){var e=t[0]*t[0]+t[1]*t[1],r=t[2]*t[2]+t[3]*t[3],n=Math.atan2(t[1],t[0]),o=Math.PI/2+n-Math.atan2(t[3],t[2]);r=Math.sqrt(r)*Math.cos(o),e=Math.sqrt(e),this.skewX=o,this.skewY=0,this.rotation=-n,this.x=+t[4],this.y=+t[5],this.scaleX=e,this.scaleY=r,this.originX=0,this.originY=0}},i.prototype.decomposeTransform=function(){if(this.transform){var t=this.parent,e=this.transform;t&&t.transform&&(t.invTransform=t.invTransform||ns(),fh(py,t.invTransform,e),e=py);var r=this.originX,n=this.originY;(r||n)&&(ML[4]=r,ML[5]=n,fh(py,e,ML),py[4]-=r,py[5]-=n,e=py),this.setLocalTransform(e)}},i.prototype.getGlobalScale=function(t){var e=this.transform;return t=t||[],e?(t[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),t[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(t[0]=-t[0]),e[3]<0&&(t[1]=-t[1]),t):(t[0]=1,t[1]=1,t)},i.prototype.transformCoordToLocal=function(t,e){var r=[t,e],n=this.invTransform;return n&&ho(r,r,n),r},i.prototype.transformCoordToGlobal=function(t,e){var r=[t,e],n=this.transform;return n&&ho(r,r,n),r},i.prototype.getLineScale=function(){var t=this.transform;return t&&CL(t[0]-1)>1e-10&&CL(t[3]-1)>1e-10?Math.sqrt(CL(t[0]*t[3]-t[2]*t[1])):1},i.prototype.copyTransform=function(t){DM(this,t)},i.getLocalTransform=function(t,e){e=e||[];var r=t.originX||0,n=t.originY||0,o=t.scaleX,s=t.scaleY,a=t.anchorX,u=t.anchorY,f=t.rotation||0,g=t.x,v=t.y,y=t.skewX?Math.tan(t.skewX):0,w=t.skewY?Math.tan(-t.skewY):0;if(r||n||a||u){var I=r+a,E=n+u;e[4]=-I*o-y*E*s,e[5]=-E*s-w*I*o}else e[4]=e[5]=0;return e[0]=o,e[3]=s,e[1]=w*o,e[2]=y*s,f&&Up(e,e,f),e[4]+=r+g,e[5]+=n+v,e},i.initDefaultProps=function(){var t=i.prototype;t.scaleX=t.scaleY=t.globalScaleRatio=1,t.x=t.y=t.originX=t.originY=t.skewX=t.skewY=t.rotation=t.anchorX=t.anchorY=0}(),i}(),bh=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function DM(i,t){for(var e=0;e<bh.length;e++){var r=bh[e];i[r]=t[r]}}const yd=iyt;function gh(i){dA||(dA=new y0(100)),i=i||Dd;var t=dA.get(i);return t||(t={font:i,strWidthCache:new y0(500),asciiWidthMap:null,asciiWidthMapTried:!1,stWideCharWidth:gu.measureText("",i).width,asciiCharWidth:gu.measureText("a",i).width},dA.put(i,t)),t}var dA;function ryt(i){if(!(EL>=MH)){i=i||Dd;for(var t=[],e=+new Date,r=0;r<=127;r++)t[r]=gu.measureText(String.fromCharCode(r),i).width;var n=+new Date-e;return n>16?EL=MH:n>2&&EL++,t}}var EL=0,MH=5;function VY(i,t){return i.asciiWidthMapTried||(i.asciiWidthMap=ryt(i.font),i.asciiWidthMapTried=!0),0<=t&&t<=127?i.asciiWidthMap!=null?i.asciiWidthMap[t]:i.asciiCharWidth:i.stWideCharWidth}function mh(i,t){var e=i.strWidthCache,r=e.get(t);return r==null&&(r=gu.measureText(t,i.font).width,e.put(t,r)),r}function CH(i,t,e,r){var n=mh(gh(t),i),o=kS(t),s=x0(0,n,e),a=ev(0,o,r),u=new sr(s,a,n,o);return u}function eE(i,t,e,r){var n=((i||"")+"").split(`
`),o=n.length;if(o===1)return CH(n[0],t,e,r);for(var s=new sr(0,0,0,0),a=0;a<n.length;a++){var u=CH(n[a],t,e,r);a===0?s.copy(u):s.union(u)}return s}function x0(i,t,e,r){return e==="right"?r?i+=t:i-=t:e==="center"&&(r?i+=t/2:i-=t/2),i}function ev(i,t,e,r){return e==="middle"?r?i+=t/2:i-=t/2:e==="bottom"&&(r?i+=t:i-=t),i}function kS(i){return gh(i).stWideCharWidth}function vu(i,t){return typeof i=="string"?i.lastIndexOf("%")>=0?parseFloat(i)/100*t:parseFloat(i):i}function PM(i,t,e){var r=t.position||"inside",n=t.distance!=null?t.distance:5,o=e.height,s=e.width,a=o/2,u=e.x,f=e.y,g="left",v="top";if(r instanceof Array)u+=vu(r[0],e.width),f+=vu(r[1],e.height),g=null,v=null;else switch(r){case"left":u-=n,f+=a,g="right",v="middle";break;case"right":u+=n+s,f+=a,v="middle";break;case"top":u+=s/2,f-=n,g="center",v="bottom";break;case"bottom":u+=s/2,f+=o+n,g="center";break;case"inside":u+=s/2,f+=a,g="center",v="middle";break;case"insideLeft":u+=n,f+=a,v="middle";break;case"insideRight":u+=s-n,f+=a,g="right",v="middle";break;case"insideTop":u+=s/2,f+=n,g="center";break;case"insideBottom":u+=s/2,f+=o-n,g="center",v="bottom";break;case"insideTopLeft":u+=n,f+=n;break;case"insideTopRight":u+=s-n,f+=n,g="right";break;case"insideBottomLeft":u+=n,f+=o-n,v="bottom";break;case"insideBottomRight":u+=s-n,f+=o-n,g="right",v="bottom";break}return i=i||{},i.x=u,i.y=f,i.align=g,i.verticalAlign=v,i}var DL="__zr_normal__",PL=bh.concat(["ignore"]),nyt=yh(bh,function(i,t){return i[t]=!0,i},{ignore:!1}),gy={},ayt=new sr(0,0,0,0),fA=[],IF=function(){function i(t){this.id=hY(),this.animators=[],this.currentStates=[],this.states={},this._init(t)}return i.prototype._init=function(t){this.attr(t)},i.prototype.drift=function(t,e,r){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=t,n[5]+=e,this.decomposeTransform(),this.markRedraw()},i.prototype.beforeUpdate=function(){},i.prototype.afterUpdate=function(){},i.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},i.prototype.updateInnerText=function(t){var e=this._textContent;if(e&&(!e.ignore||t)){this.textConfig||(this.textConfig={});var r=this.textConfig,n=r.local,o=e.innerTransformable,s=void 0,a=void 0,u=!1;o.parent=n?this:null;var f=!1;o.copyTransform(e);var g=r.position!=null,v=r.autoOverflowArea,y=void 0;if((v||g)&&(y=ayt,r.layoutRect?y.copy(r.layoutRect):y.copy(this.getBoundingRect()),n||y.applyTransform(this.transform)),g){this.calculateTextPosition?this.calculateTextPosition(gy,r,y):PM(gy,r,y),o.x=gy.x,o.y=gy.y,s=gy.align,a=gy.verticalAlign;var w=r.origin;if(w&&r.rotation!=null){var I=void 0,E=void 0;w==="center"?(I=y.width*.5,E=y.height*.5):(I=vu(w[0],y.width),E=vu(w[1],y.height)),f=!0,o.originX=-o.x+I+(n?0:y.x),o.originY=-o.y+E+(n?0:y.y)}}r.rotation!=null&&(o.rotation=r.rotation);var D=r.offset;D&&(o.x+=D[0],o.y+=D[1],f||(o.originX=-D[0],o.originY=-D[1]));var R=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={});if(v){var z=R.overflowRect=R.overflowRect||new sr(0,0,0,0);o.getLocalTransform(fA),mu(fA,fA),sr.copy(z,y),z.applyTransform(fA)}else R.overflowRect=null;var N=r.inside==null?typeof r.position=="string"&&r.position.indexOf("inside")>=0:r.inside,H=void 0,$=void 0,X=void 0;N&&this.canBeInsideText()?(H=r.insideFill,$=r.insideStroke,(H==null||H==="auto")&&(H=this.getInsideTextFill()),($==null||$==="auto")&&($=this.getInsideTextStroke(H),X=!0)):(H=r.outsideFill,$=r.outsideStroke,(H==null||H==="auto")&&(H=this.getOutsideFill()),($==null||$==="auto")&&($=this.getOutsideStroke(H),X=!0)),H=H||"#000",(H!==R.fill||$!==R.stroke||X!==R.autoStroke||s!==R.align||a!==R.verticalAlign)&&(u=!0,R.fill=H,R.stroke=$,R.autoStroke=X,R.align=s,R.verticalAlign=a,e.setDefaultTextStyle(R)),e.__dirty|=Kl,u&&e.dirtyStyle(!0)}},i.prototype.canBeInsideText=function(){return!0},i.prototype.getInsideTextFill=function(){return"#fff"},i.prototype.getInsideTextStroke=function(t){return"#000"},i.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?jO:HO},i.prototype.getOutsideStroke=function(t){var e=this.__zr&&this.__zr.getBackgroundColor(),r=typeof e=="string"&&Ol(e);r||(r=[255,255,255,1]);for(var n=r[3],o=this.__zr.isDarkMode(),s=0;s<3;s++)r[s]=r[s]*n+(o?0:255)*(1-n);return r[3]=1,ph(r,"rgba")},i.prototype.traverse=function(t,e){},i.prototype.attrKV=function(t,e){t==="textConfig"?this.setTextConfig(e):t==="textContent"?this.setTextContent(e):t==="clipPath"?this.setClipPath(e):t==="extra"?(this.extra=this.extra||{},Fe(this.extra,e)):this[t]=e},i.prototype.hide=function(){this.ignore=!0,this.markRedraw()},i.prototype.show=function(){this.ignore=!1,this.markRedraw()},i.prototype.attr=function(t,e){if(typeof t=="string")this.attrKV(t,e);else if(nr(t))for(var r=t,n=on(r),o=0;o<n.length;o++){var s=n[o];this.attrKV(s,t[s])}return this.markRedraw(),this},i.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var e=this._normalState,r=0;r<this.animators.length;r++){var n=this.animators[r],o=n.__fromStateTransition;if(!(n.getLoop()||o&&o!==DL)){var s=n.targetName,a=s?e[s]:e;n.saveTo(a)}}},i.prototype._innerSaveToNormal=function(t){var e=this._normalState;e||(e=this._normalState={}),t.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(t,e,PL)},i.prototype._savePrimaryToNormal=function(t,e,r){for(var n=0;n<r.length;n++){var o=r[n];t[o]!=null&&!(o in e)&&(e[o]=this[o])}},i.prototype.hasState=function(){return this.currentStates.length>0},i.prototype.getState=function(t){return this.states[t]},i.prototype.ensureState=function(t){var e=this.states;return e[t]||(e[t]={}),e[t]},i.prototype.clearStates=function(t){this.useState(DL,!1,t)},i.prototype.useState=function(t,e,r,n){var o=t===DL,s=this.hasState();if(!(!s&&o)){var a=this.currentStates,u=this.stateTransition;if(!(Ar(a,t)>=0&&(e||a.length===1))){var f;if(this.stateProxy&&!o&&(f=this.stateProxy(t)),f||(f=this.states&&this.states[t]),!f&&!o){mF("State "+t+" not exists.");return}o||this.saveCurrentToNormalState(f);var g=!!(f&&f.hoverLayer||n);g&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,f,this._normalState,e,!r&&!this.__inHover&&u&&u.duration>0,u);var v=this._textContent,y=this._textGuide;return v&&v.useState(t,e,r,g),y&&y.useState(t,e,r,g),o?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!g&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Kl),f}}},i.prototype.useStates=function(t,e,r){if(!t.length)this.clearStates();else{var n=[],o=this.currentStates,s=t.length,a=s===o.length;if(a){for(var u=0;u<s;u++)if(t[u]!==o[u]){a=!1;break}}if(a)return;for(var u=0;u<s;u++){var f=t[u],g=void 0;this.stateProxy&&(g=this.stateProxy(f,t)),g||(g=this.states[f]),g&&n.push(g)}var v=n[s-1],y=!!(v&&v.hoverLayer||r);y&&this._toggleHoverLayerFlag(!0);var w=this._mergeStates(n),I=this.stateTransition;this.saveCurrentToNormalState(w),this._applyStateObj(t.join(","),w,this._normalState,!1,!e&&!this.__inHover&&I&&I.duration>0,I);var E=this._textContent,D=this._textGuide;E&&E.useStates(t,e,y),D&&D.useStates(t,e,y),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!y&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Kl)}},i.prototype.isSilent=function(){for(var t=this;t;){if(t.silent)return!0;var e=t.__hostTarget;t=e?t.ignoreHostSilent?null:e:t.parent}return!1},i.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var e=this.animators[t];e.targetName&&e.changeTarget(this[e.targetName])}},i.prototype.removeState=function(t){var e=Ar(this.currentStates,t);if(e>=0){var r=this.currentStates.slice();r.splice(e,1),this.useStates(r)}},i.prototype.replaceState=function(t,e,r){var n=this.currentStates.slice(),o=Ar(n,t),s=Ar(n,e)>=0;o>=0?s?n.splice(o,1):n[o]=e:r&&!s&&n.push(e),this.useStates(n)},i.prototype.toggleState=function(t,e){e?this.useState(t,!0):this.removeState(t)},i.prototype._mergeStates=function(t){for(var e={},r,n=0;n<t.length;n++){var o=t[n];Fe(e,o),o.textConfig&&(r=r||{},Fe(r,o.textConfig))}return r&&(e.textConfig=r),e},i.prototype._applyStateObj=function(t,e,r,n,o,s){var a=!(e&&n);e&&e.textConfig?(this.textConfig=Fe({},n?this.textConfig:r.textConfig),Fe(this.textConfig,e.textConfig)):a&&r.textConfig&&(this.textConfig=r.textConfig);for(var u={},f=!1,g=0;g<PL.length;g++){var v=PL[g],y=o&&nyt[v];e&&e[v]!=null?y?(f=!0,u[v]=e[v]):this[v]=e[v]:a&&r[v]!=null&&(y?(f=!0,u[v]=r[v]):this[v]=r[v])}if(!o)for(var g=0;g<this.animators.length;g++){var w=this.animators[g],I=w.targetName;w.getLoop()||w.__changeFinalValue(I?(e||r)[I]:e||r)}f&&this._transitionState(t,u,s)},i.prototype._attachComponent=function(t){if(!(t.__zr&&!t.__hostTarget)&&t!==this){var e=this.__zr;e&&t.addSelfToZr(e),t.__zr=e,t.__hostTarget=this}},i.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},i.prototype.getClipPath=function(){return this._clipPath},i.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},i.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},i.prototype.getTextContent=function(){return this._textContent},i.prototype.setTextContent=function(t){var e=this._textContent;e!==t&&(e&&e!==t&&this.removeTextContent(),t.innerTransformable=new yd,this._attachComponent(t),this._textContent=t,this.markRedraw())},i.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),Fe(this.textConfig,t),this.markRedraw()},i.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},i.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.innerTransformable=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},i.prototype.getTextGuideLine=function(){return this._textGuide},i.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},i.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},i.prototype.markRedraw=function(){this.__dirty|=Kl;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},i.prototype.dirty=function(){this.markRedraw()},i.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var e=this._textContent,r=this._textGuide;e&&(e.__inHover=t),r&&(r.__inHover=t)},i.prototype.addSelfToZr=function(t){if(this.__zr!==t){this.__zr=t;var e=this.animators;if(e)for(var r=0;r<e.length;r++)t.animation.addAnimator(e[r]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)}},i.prototype.removeSelfFromZr=function(t){if(this.__zr){this.__zr=null;var e=this.animators;if(e)for(var r=0;r<e.length;r++)t.animation.removeAnimator(e[r]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)}},i.prototype.animate=function(t,e,r){var n=t?this[t]:this,o=new AF(n,e,r);return t&&(o.targetName=t),this.addAnimator(o,t),o},i.prototype.addAnimator=function(t,e){var r=this.__zr,n=this;t.during(function(){n.updateDuringAnimation(e)}).done(function(){var o=n.animators,s=Ar(o,t);s>=0&&o.splice(s,1)}),this.animators.push(t),r&&r.animation.addAnimator(t),r&&r.wakeUp()},i.prototype.updateDuringAnimation=function(t){this.markRedraw()},i.prototype.stopAnimation=function(t,e){for(var r=this.animators,n=r.length,o=[],s=0;s<n;s++){var a=r[s];!t||t===a.scope?a.stop(e):o.push(a)}return this.animators=o,this},i.prototype.animateTo=function(t,e,r){LL(this,t,e,r)},i.prototype.animateFrom=function(t,e,r){LL(this,t,e,r,!0)},i.prototype._transitionState=function(t,e,r,n){for(var o=LL(this,e,r,n),s=0;s<o.length;s++)o[s].__fromStateTransition=t},i.prototype.getBoundingRect=function(){return null},i.prototype.getPaintRect=function(){return null},i.initDefaultProps=function(){var t=i.prototype;t.type="element",t.name="",t.ignore=t.silent=t.ignoreHostSilent=t.isGroup=t.draggable=t.dragging=t.ignoreClip=t.__inHover=!1,t.__dirty=Kl;function e(r,n,o,s){Object.defineProperty(t,r,{get:function(){if(!this[n]){var u=this[n]=[];a(this,u)}return this[n]},set:function(u){this[o]=u[0],this[s]=u[1],this[n]=u,a(this,u)}});function a(u,f){Object.defineProperty(f,0,{get:function(){return u[o]},set:function(g){u[o]=g}}),Object.defineProperty(f,1,{get:function(){return u[s]},set:function(g){u[s]=g}})}}Object.defineProperty&&(e("position","_legacyPos","x","y"),e("scale","_legacyScale","scaleX","scaleY"),e("origin","_legacyOrigin","originX","originY"))}(),i}();wo(IF,zc);wo(IF,yd);function LL(i,t,e,r,n){e=e||{};var o=[];UY(i,"",i,t,e,r,o,n);var s=o.length,a=!1,u=e.done,f=e.aborted,g=function(){a=!0,s--,s<=0&&(a?u&&u():f&&f())},v=function(){s--,s<=0&&(a?u&&u():f&&f())};s||u&&u(),o.length>0&&e.during&&o[0].during(function(I,E){e.during(E)});for(var y=0;y<o.length;y++){var w=o[y];g&&w.done(g),v&&w.aborted(v),e.force&&w.duration(e.duration),w.start(e.easing)}return o}function RL(i,t,e){for(var r=0;r<e;r++)i[r]=t[r]}function oyt(i){return Ns(i[0])}function syt(i,t,e){if(Ns(t[e]))if(Ns(i[e])||(i[e]=[]),zl(t[e])){var r=t[e].length;i[e].length!==r&&(i[e]=new t[e].constructor(r),RL(i[e],t[e],r))}else{var n=t[e],o=i[e],s=n.length;if(oyt(n))for(var a=n[0].length,u=0;u<s;u++)o[u]?RL(o[u],n[u],a):o[u]=Array.prototype.slice.call(n[u]);else RL(o,n,s);o.length=n.length}else i[e]=t[e]}function lyt(i,t){return i===t||Ns(i)&&Ns(t)&&cyt(i,t)}function cyt(i,t){var e=i.length;if(e!==t.length)return!1;for(var r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function UY(i,t,e,r,n,o,s,a){for(var u=on(r),f=n.duration,g=n.delay,v=n.additive,y=n.setToFinal,w=!nr(o),I=i.animators,E=[],D=0;D<u.length;D++){var R=u[D],z=r[R];if(z!=null&&e[R]!=null&&(w||o[R]))if(nr(z)&&!Ns(z)&&!XC(z)){if(t){a||(e[R]=z,i.updateDuringAnimation(t));continue}UY(i,R,e[R],z,n,o&&o[R],s,a)}else E.push(R);else a||(e[R]=z,i.updateDuringAnimation(t),E.push(R))}var N=E.length;if(!v&&N)for(var H=0;H<I.length;H++){var $=I[H];if($.targetName===t){var X=$.stopTracks(E);if(X){var K=Ar(I,$);I.splice(K,1)}}}if(n.force||(E=Rn(E,function(ht){return!lyt(r[ht],e[ht])}),N=E.length),N>0||n.force&&!s.length){var et=void 0,rt=void 0,lt=void 0;if(a){rt={},y&&(et={});for(var H=0;H<N;H++){var R=E[H];rt[R]=e[R],y?et[R]=r[R]:e[R]=r[R]}}else if(y){lt={};for(var H=0;H<N;H++){var R=E[H];lt[R]=Tw(e[R]),syt(e,r,R)}}var $=new AF(e,!1,!1,v?Rn(I,function(yt){return yt.targetName===t}):null);$.targetName=t,n.scope&&($.scope=n.scope),y&&et&&$.whenWithKeys(0,et,E),lt&&$.whenWithKeys(0,lt,E),$.whenWithKeys(f??500,a?rt:r,E).delay(g||0),i.addAnimator($,t),s.push($)}}const GY=IF;var HY=function(i){xa(t,i);function t(e){var r=i.call(this)||this;return r.isGroup=!0,r._children=[],r.attr(e),r}return t.prototype.childrenRef=function(){return this._children},t.prototype.children=function(){return this._children.slice()},t.prototype.childAt=function(e){return this._children[e]},t.prototype.childOfName=function(e){for(var r=this._children,n=0;n<r.length;n++)if(r[n].name===e)return r[n]},t.prototype.childCount=function(){return this._children.length},t.prototype.add=function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},t.prototype.addBefore=function(e,r){if(e&&e!==this&&e.parent!==this&&r&&r.parent===this){var n=this._children,o=n.indexOf(r);o>=0&&(n.splice(o,0,e),this._doAdd(e))}return this},t.prototype.replace=function(e,r){var n=Ar(this._children,e);return n>=0&&this.replaceAt(r,n),this},t.prototype.replaceAt=function(e,r){var n=this._children,o=n[r];if(e&&e!==this&&e.parent!==this&&e!==o){n[r]=e,o.parent=null;var s=this.__zr;s&&o.removeSelfFromZr(s),this._doAdd(e)}return this},t.prototype._doAdd=function(e){e.parent&&e.parent.remove(e),e.parent=this;var r=this.__zr;r&&r!==e.__zr&&e.addSelfToZr(r),r&&r.refresh()},t.prototype.remove=function(e){var r=this.__zr,n=this._children,o=Ar(n,e);return o<0?this:(n.splice(o,1),e.parent=null,r&&e.removeSelfFromZr(r),r&&r.refresh(),this)},t.prototype.removeAll=function(){for(var e=this._children,r=this.__zr,n=0;n<e.length;n++){var o=e[n];r&&o.removeSelfFromZr(r),o.parent=null}return e.length=0,this},t.prototype.eachChild=function(e,r){for(var n=this._children,o=0;o<n.length;o++){var s=n[o];e.call(r,s,o)}return this},t.prototype.traverse=function(e,r){for(var n=0;n<this._children.length;n++){var o=this._children[n],s=e.call(r,o);o.isGroup&&!s&&o.traverse(e,r)}return this},t.prototype.addSelfToZr=function(e){i.prototype.addSelfToZr.call(this,e);for(var r=0;r<this._children.length;r++){var n=this._children[r];n.addSelfToZr(e)}},t.prototype.removeSelfFromZr=function(e){i.prototype.removeSelfFromZr.call(this,e);for(var r=0;r<this._children.length;r++){var n=this._children[r];n.removeSelfFromZr(e)}},t.prototype.getBoundingRect=function(e){for(var r=new sr(0,0,0,0),n=e||this._children,o=[],s=null,a=0;a<n.length;a++){var u=n[a];if(!(u.ignore||u.invisible)){var f=u.getBoundingRect(),g=u.getLocalTransform(o);g?(sr.applyTransform(r,f,g),s=s||r.clone(),s.union(r)):(s=s||f.clone(),s.union(f))}}return s||r},t}(GY);HY.prototype.type="group";const Ki=HY;/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var jI={},jY={};function uyt(i){delete jY[i]}function hyt(i){if(!i)return!1;if(typeof i=="string")return MM(i,1)<GO;if(i.colorStops){for(var t=i.colorStops,e=0,r=t.length,n=0;n<r;n++)e+=MM(t[n].color,1);return e/=r,e<GO}return!1}var dyt=function(){function i(t,e,r){var n=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,r=r||{},this.dom=e,this.id=t;var o=new b_t,s=r.renderer||"canvas";jI[s]||(s=on(jI)[0]),r.useDirtyRect=r.useDirtyRect==null?!1:r.useDirtyRect;var a=new jI[s](e,o,r,t),u=r.ssr||a.ssrOnly;this.storage=o,this.painter=a;var f=!Sn.node&&!Sn.worker&&!u?new tyt(a.getViewportRoot(),a.root):null,g=r.useCoarsePointer,v=g==null||g==="auto"?Sn.touchEventsSupported:!!g,y=44,w;v&&(w=Ui(r.pointerSize,y)),this.handler=new m_t(o,a,f,a.root,w),this.animation=new $_t({stage:{update:u?null:function(){return n._flush(!0)}}}),u||this.animation.start()}return i.prototype.add=function(t){this._disposed||!t||(this.storage.addRoot(t),t.addSelfToZr(this),this.refresh())},i.prototype.remove=function(t){this._disposed||!t||(this.storage.delRoot(t),t.removeSelfFromZr(this),this.refresh())},i.prototype.configLayer=function(t,e){this._disposed||(this.painter.configLayer&&this.painter.configLayer(t,e),this.refresh())},i.prototype.setBackgroundColor=function(t){this._disposed||(this.painter.setBackgroundColor&&this.painter.setBackgroundColor(t),this.refresh(),this._backgroundColor=t,this._darkMode=hyt(t))},i.prototype.getBackgroundColor=function(){return this._backgroundColor},i.prototype.setDarkMode=function(t){this._darkMode=t},i.prototype.isDarkMode=function(){return this._darkMode},i.prototype.refreshImmediately=function(t){this._disposed||(t||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1)},i.prototype.refresh=function(){this._disposed||(this._needsRefresh=!0,this.animation.start())},i.prototype.flush=function(){this._disposed||this._flush(!1)},i.prototype._flush=function(t){var e,r=Zy();this._needsRefresh&&(e=!0,this.refreshImmediately(t)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately());var n=Zy();e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-r})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},i.prototype.setSleepAfterStill=function(t){this._sleepAfterStill=t},i.prototype.wakeUp=function(){this._disposed||(this.animation.start(),this._stillFrameAccum=0)},i.prototype.refreshHover=function(){this._needsRefreshHover=!0},i.prototype.refreshHoverImmediately=function(){this._disposed||(this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.getType()==="canvas"&&this.painter.refreshHover())},i.prototype.resize=function(t){this._disposed||(t=t||{},this.painter.resize(t.width,t.height),this.handler.resize())},i.prototype.clearAnimation=function(){this._disposed||this.animation.clear()},i.prototype.getWidth=function(){if(!this._disposed)return this.painter.getWidth()},i.prototype.getHeight=function(){if(!this._disposed)return this.painter.getHeight()},i.prototype.setCursorStyle=function(t){this._disposed||this.handler.setCursorStyle(t)},i.prototype.findHover=function(t,e){if(!this._disposed)return this.handler.findHover(t,e)},i.prototype.on=function(t,e,r){return this._disposed||this.handler.on(t,e,r),this},i.prototype.off=function(t,e){this._disposed||this.handler.off(t,e)},i.prototype.trigger=function(t,e){this._disposed||this.handler.trigger(t,e)},i.prototype.clear=function(){if(!this._disposed){for(var t=this.storage.getRoots(),e=0;e<t.length;e++)t[e]instanceof Ki&&t[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}},i.prototype.dispose=function(){this._disposed||(this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,this._disposed=!0,uyt(this.id))},i}();function EH(i,t){var e=new dyt(hY(),i,t);return jY[e.id]=e,e}function fyt(i,t){jI[i]=t}var WO;function pyt(i){if(typeof WO=="function")return WO(i)}function gyt(i){WO=i}var DH=1e-4,WY=20;function myt(i){return i.replace(/^\s+|\s+$/g,"")}var rc=Math.min,co=Math.max,oh=Math.abs;function Ln(i,t,e,r){var n=t[0],o=t[1],s=e[0],a=e[1],u=o-n,f=a-s;if(u===0)return f===0?s:(s+a)/2;if(r)if(u>0){if(i<=n)return s;if(i>=o)return a}else{if(i>=n)return s;if(i<=o)return a}else{if(i===n)return s;if(i===o)return a}return(i-n)/u*f+s}var xi=vyt;function vyt(i,t,e){switch(i){case"center":case"middle":i="50%";break;case"left":case"top":i="0%";break;case"right":case"bottom":i="100%";break}return LM(i,t,e)}function LM(i,t,e){return bi(i)?myt(i).match(/%$/)?parseFloat(i)/100*t+(e||0):parseFloat(i):i==null?NaN:+i}function vo(i,t,e){return t==null&&(t=10),t=Math.min(Math.max(0,t),WY),i=(+i).toFixed(t),e?i:+i}function Dc(i){return i.sort(function(t,e){return t-e}),i}function sh(i){if(i=+i,isNaN(i))return 0;if(i>1e-14){for(var t=1,e=0;e<15;e++,t*=10)if(Math.round(i*t)/t===i)return e}return _yt(i)}function _yt(i){var t=i.toString().toLowerCase(),e=t.indexOf("e"),r=e>0?+t.slice(e+1):0,n=e>0?e:t.length,o=t.indexOf("."),s=o<0?0:n-1-o;return Math.max(0,s-r)}function $Y(i,t){var e=Math.log,r=Math.LN10,n=Math.floor(e(i[1]-i[0])/r),o=Math.round(e(oh(t[1]-t[0]))/r),s=Math.min(Math.max(-n+o,0),20);return isFinite(s)?s:20}function yyt(i,t){var e=yh(i,function(w,I){return w+(isNaN(I)?0:I)},0);if(e===0)return[];for(var r=Math.pow(10,t),n=ti(i,function(w){return(isNaN(w)?0:w)/e*r*100}),o=r*100,s=ti(n,function(w){return Math.floor(w)}),a=yh(s,function(w,I){return w+I},0),u=ti(n,function(w,I){return w-s[I]});a<o;){for(var f=Number.NEGATIVE_INFINITY,g=null,v=0,y=u.length;v<y;++v)u[v]>f&&(f=u[v],g=v);++s[g],u[g]=0,++a}return ti(s,function(w){return w/r})}function xyt(i,t){var e=Math.max(sh(i),sh(t)),r=i+t;return e>WY?r:vo(r,e)}var PH=9007199254740991;function ZY(i){var t=Math.PI*2;return(i%t+t)%t}function Jw(i){return i>-DH&&i<DH}var byt=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function Sv(i){if(i instanceof Date)return i;if(bi(i)){var t=byt.exec(i);if(!t)return new Date(NaN);if(t[8]){var e=+t[4]||0;return t[8].toUpperCase()!=="Z"&&(e-=+t[8].slice(0,3)),new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,e,+(t[5]||0),+t[6]||0,t[7]?+t[7].substring(0,3):0))}else return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,t[7]?+t[7].substring(0,3):0)}else if(i==null)return new Date(NaN);return new Date(Math.round(i))}function wyt(i){return Math.pow(10,MF(i))}function MF(i){if(i===0)return 0;var t=Math.floor(Math.log(i)/Math.LN10);return i/Math.pow(10,t)>=10&&t++,t}function qY(i,t){var e=MF(i),r=Math.pow(10,e),n=i/r,o;return t?n<1.5?o=1:n<2.5?o=2:n<4?o=3:n<7?o=5:o=10:n<1?o=1:n<2?o=2:n<3?o=3:n<5?o=5:o=10,i=o*r,e>=-20?+i.toFixed(e<0?-e:0):i}function kL(i,t){var e=(i.length-1)*t+1,r=Math.floor(e),n=+i[r-1],o=e-r;return o?n+o*(i[r]-n):n}function LH(i){i.sort(function(u,f){return a(u,f,0)?-1:1});for(var t=-1/0,e=1,r=0;r<i.length;){for(var n=i[r].interval,o=i[r].close,s=0;s<2;s++)n[s]<=t&&(n[s]=t,o[s]=s?1:1-e),t=n[s],e=o[s];n[0]===n[1]&&o[0]*o[1]!==1?i.splice(r,1):r++}return i;function a(u,f,g){return u.interval[g]<f.interval[g]||u.interval[g]===f.interval[g]&&(u.close[g]-f.close[g]===(g?-1:1)||!g&&a(u,f,1))}}function Ld(i){var t=parseFloat(i);return t==i&&(t!==0||!bi(i)||i.indexOf("x")<=0)?t:NaN}function XY(i){return!isNaN(Ld(i))}function YY(){return Math.round(Math.random()*9)}function KY(i,t){return t===0?i:KY(t,i%t)}function RH(i,t){return i==null?t:t==null?i:i*t/KY(i,t)}var Syt="[ECharts] ",kH={},Tyt=typeof console<"u"&&console.warn&&console.log;function Ayt(i,t,e){if(Tyt){if(e){if(kH[t])return;kH[t]=!0}console[i](Syt+t)}}function JY(i,t){Ayt("error",i,t)}function Dn(i){throw new Error(i)}function OH(i,t,e){return(t-i)*e+i}var QY="series\0",tK="\0_ec_\0";function na(i){return i instanceof Array?i:i==null?[]:[i]}function dv(i,t,e){if(i){i[t]=i[t]||{},i.emphasis=i.emphasis||{},i.emphasis[t]=i.emphasis[t]||{};for(var r=0,n=e.length;r<n;r++){var o=e[r];!i.emphasis[t].hasOwnProperty(o)&&i[t].hasOwnProperty(o)&&(i.emphasis[t][o]=i[t][o])}}}var zH=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function B0(i){return nr(i)&&!Ye(i)&&!(i instanceof Date)?i.value:i}function Iyt(i){return nr(i)&&!(i instanceof Array)}function eK(i,t,e){var r=e==="normalMerge",n=e==="replaceMerge",o=e==="replaceAll";i=i||[],t=(t||[]).slice();var s=Fi();gt(t,function(u,f){if(!nr(u)){t[f]=null;return}});var a=Myt(i,s,e);return(r||n)&&Cyt(a,i,s,t),r&&Eyt(a,t),r||n?Dyt(a,t,n):o&&Pyt(a,t),Lyt(a),a}function Myt(i,t,e){var r=[];if(e==="replaceAll")return r;for(var n=0;n<i.length;n++){var o=i[n];o&&o.id!=null&&t.set(o.id,n),r.push({existing:e==="replaceMerge"||Qw(o)?null:o,newOption:null,keyInfo:null,brandNew:null})}return r}function Cyt(i,t,e,r){gt(r,function(n,o){if(!(!n||n.id==null)){var s=Aw(n.id),a=e.get(s);if(a!=null){var u=i[a];Vs(!u.newOption,'Duplicated option on id "'+s+'".'),u.newOption=n,u.existing=t[a],r[o]=null}}})}function Eyt(i,t){gt(t,function(e,r){if(!(!e||e.name==null))for(var n=0;n<i.length;n++){var o=i[n].existing;if(!i[n].newOption&&o&&(o.id==null||e.id==null)&&!Qw(e)&&!Qw(o)&&iK("name",o,e)){i[n].newOption=e,t[r]=null;return}}})}function Dyt(i,t,e){gt(t,function(r){if(r){for(var n,o=0;(n=i[o])&&(n.newOption||Qw(n.existing)||n.existing&&r.id!=null&&!iK("id",r,n.existing));)o++;n?(n.newOption=r,n.brandNew=e):i.push({newOption:r,brandNew:e,existing:null,keyInfo:null}),o++}})}function Pyt(i,t){gt(t,function(e){i.push({newOption:e,brandNew:!0,existing:null,keyInfo:null})})}function Lyt(i){var t=Fi();gt(i,function(e){var r=e.existing;r&&t.set(r.id,e)}),gt(i,function(e){var r=e.newOption;Vs(!r||r.id==null||!t.get(r.id)||t.get(r.id)===e,"id duplicates: "+(r&&r.id)),r&&r.id!=null&&t.set(r.id,e),!e.keyInfo&&(e.keyInfo={})}),gt(i,function(e,r){var n=e.existing,o=e.newOption,s=e.keyInfo;if(nr(o)){if(s.name=o.name!=null?Aw(o.name):n?n.name:QY+r,n)s.id=Aw(n.id);else if(o.id!=null)s.id=Aw(o.id);else{var a=0;do s.id="\0"+s.name+"\0"+a++;while(t.get(s.id))}t.set(s.id,e)}})}function iK(i,t,e){var r=Lo(t[i],null),n=Lo(e[i],null);return r!=null&&n!=null&&r===n}function Aw(i){return Lo(i,"")}function Lo(i,t){return i==null?t:bi(i)?i:fn(i)||yO(i)?i+"":t}function CF(i){var t=i.name;return!!(t&&t.indexOf(QY))}function Qw(i){return i&&i.id!=null&&Aw(i.id).indexOf(tK)===0}function Ryt(i){return tK+i}function kyt(i,t,e){gt(i,function(r){var n=r.newOption;nr(n)&&(r.keyInfo.mainType=t,r.keyInfo.subType=Oyt(t,n,r.existing,e))})}function Oyt(i,t,e,r){var n=t.type?t.type:e?e.subType:r.determineSubType(i,t);return n}function zyt(i,t){var e={},r={};return n(i||[],e),n(t||[],r,e),[o(e),o(r)];function n(s,a,u){for(var f=0,g=s.length;f<g;f++){var v=Lo(s[f].seriesId,null);if(v==null)return;for(var y=na(s[f].dataIndex),w=u&&u[v],I=0,E=y.length;I<E;I++){var D=y[I];w&&w[D]?w[D]=null:(a[v]||(a[v]={}))[D]=1}}}function o(s,a){var u=[];for(var f in s)if(s.hasOwnProperty(f)&&s[f]!=null)if(a)u.push(+f);else{var g=o(s[f],!0);g.length&&u.push({seriesId:f,dataIndex:g})}return u}}function fv(i,t){if(t.dataIndexInside!=null)return t.dataIndexInside;if(t.dataIndex!=null)return Ye(t.dataIndex)?ti(t.dataIndex,function(e){return i.indexOfRawIndex(e)}):i.indexOfRawIndex(t.dataIndex);if(t.name!=null)return Ye(t.name)?ti(t.name,function(e){return i.indexOfName(e)}):i.indexOfName(t.name)}function Wr(){var i="__ec_inner_"+Byt++;return function(t){return t[i]||(t[i]={})}}var Byt=YY();function s0(i,t,e){var r=EF(t,e),n=r.mainTypeSpecified,o=r.queryOptionMap,s=r.others,a=s,u=e?e.defaultMainType:null;return!n&&u&&o.set(u,{}),o.each(function(f,g){var v=F0(i,g,f,{useDefault:u===g,enableAll:e&&e.enableAll!=null?e.enableAll:!0,enableNone:e&&e.enableNone!=null?e.enableNone:!0});a[g+"Models"]=v.models,a[g+"Model"]=v.models[0]}),a}function EF(i,t){var e;if(bi(i)){var r={};r[i+"Index"]=0,e=r}else e=i;var n=Fi(),o={},s=!1;return gt(e,function(a,u){if(u==="dataIndex"||u==="dataIndexInside"){o[u]=a;return}var f=u.match(/^(\w+)(Index|Id|Name)$/)||[],g=f[1],v=(f[2]||"").toLowerCase();if(!(!g||!v||t&&t.includeMainTypes&&Ar(t.includeMainTypes,g)<0)){s=s||!!g;var y=n.get(g)||n.set(g,{});y[v]=a}}),{mainTypeSpecified:s,queryOptionMap:n,others:o}}var Wa={useDefault:!0,enableAll:!1,enableNone:!1},Fyt={useDefault:!1,enableAll:!0,enableNone:!0};function F0(i,t,e,r){r=r||Wa;var n=e.index,o=e.id,s=e.name,a={models:null,specified:n!=null||o!=null||s!=null};if(!a.specified){var u=void 0;return a.models=r.useDefault&&(u=i.getComponent(t))?[u]:[],a}if(n==="none"||n===!1){if(r.enableNone)return a.models=[],a;n=-1}return n==="all"&&(r.enableAll?n=o=s=null:n=-1),a.models=i.queryComponents({mainType:t,index:n,id:o,name:s}),a}function Nyt(i,t,e){i.setAttribute?i.setAttribute(t,e):i[t]=e}function Vyt(i){return i==="auto"?Sn.domSupported?"html":"richText":i||"html"}function $O(i,t){var e=Fi(),r=[];return gt(i,function(n){var o=t(n);(e.get(o)||(r.push(o),e.set(o,[]))).push(n)}),{keys:r,buckets:e}}function rK(i,t,e,r,n){var o=t==null||t==="auto";if(r==null)return r;if(fn(r)){var s=OH(e||0,r,n);return vo(s,o?Math.max(sh(e||0),sh(r)):t)}else{if(bi(r))return n<1?e:r;for(var a=[],u=e,f=r,g=Math.max(u?u.length:0,f.length),v=0;v<g;++v){var y=i.getDimensionInfo(v);if(y&&y.type==="ordinal")a[v]=(n<1&&u?u:f)[v];else{var w=u&&u[v]?u[v]:0,I=f[v],s=OH(w,I,n);a[v]=vo(s,o?Math.max(sh(w),sh(I)):t)}}return a}}var wp=function(){function i(){}return i.prototype.reset=function(t,e,r,n){return this._list=t,this._step=n=n||1,this._idx=e,this._end=r??(n>0?t.length:0),this.item=null,this.key=NaN,this},i.prototype.next=function(){return(this._step>0?this._idx<this._end:this._idx>=this._end)?(this.item=this._list[this._idx],this.key=this._idx=this._idx+this._step,!0):!1},i}();function OL(i){i.option=i.parentModel=i.ecModel=null}var Uyt=".",am="___EC__COMPONENT__CONTAINER___",nK="___EC__EXTENDED_CLASS___";function lh(i){var t={main:"",sub:""};if(i){var e=i.split(Uyt);t.main=e[0]||"",t.sub=e[1]||""}return t}function Gyt(i){Vs(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(i),'componentType "'+i+'" illegal')}function Hyt(i){return!!(i&&i[nK])}function DF(i,t){i.$constructor=i,i.extend=function(e){var r=this,n;return jyt(r)?n=function(o){we(s,o);function s(){return o.apply(this,arguments)||this}return s}(r):(n=function(){(e.$constructor||r).apply(this,arguments)},Ovt(n,this)),Fe(n.prototype,e),n[nK]=!0,n.extend=this.extend,n.superCall=Zyt,n.superApply=qyt,n.superClass=r,n}}function jyt(i){return Xi(i)&&/^class\s/.test(Function.prototype.toString.call(i))}function aK(i,t){i.extend=t.extend}var Wyt=Math.round(Math.random()*10);function $yt(i){var t=["__\0is_clz",Wyt++].join("_");i.prototype[t]=!0,i.isInstance=function(e){return!!(e&&e[t])}}function Zyt(i,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];return this.superClass.prototype[t].apply(i,e)}function qyt(i,t,e){return this.superClass.prototype[t].apply(i,e)}function iE(i){var t={};i.registerClass=function(r){var n=r.type||r.prototype.type;if(n){Gyt(n),r.prototype.type=n;var o=lh(n);if(!o.sub)t[o.main]=r;else if(o.sub!==am){var s=e(o);s[o.sub]=r}}return r},i.getClass=function(r,n,o){var s=t[r];if(s&&s[am]&&(s=n?s[n]:null),o&&!s)throw new Error(n?"Component "+r+"."+(n||"")+" is used but not imported.":r+".type should be specified.");return s},i.getClassesByMainType=function(r){var n=lh(r),o=[],s=t[n.main];return s&&s[am]?gt(s,function(a,u){u!==am&&o.push(a)}):o.push(s),o},i.hasClass=function(r){var n=lh(r);return!!t[n.main]},i.getAllClassMainTypes=function(){var r=[];return gt(t,function(n,o){r.push(o)}),r},i.hasSubTypes=function(r){var n=lh(r),o=t[n.main];return o&&o[am]};function e(r){var n=t[r.main];return(!n||!n[am])&&(n=t[r.main]={},n[am]=!0),n}}function pv(i,t){for(var e=0;e<i.length;e++)i[e][1]||(i[e][1]=i[e][0]);return t=t||!1,function(r,n,o){for(var s={},a=0;a<i.length;a++){var u=i[a][1];if(!(n&&Ar(n,u)>=0||o&&Ar(o,u)<0)){var f=r.getShallow(u,t);f!=null&&(s[i[a][0]]=f)}}return s}}var Xyt=[["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]],Yyt=pv(Xyt),Kyt=function(){function i(){}return i.prototype.getAreaStyle=function(t,e){return Yyt(this,t,e)},i}(),ZO=new y0(50);function Jyt(i){if(typeof i=="string"){var t=ZO.get(i);return t&&t.image}else return i}function PF(i,t,e,r,n){if(i)if(typeof i=="string"){if(t&&t.__zrImageSrc===i||!e)return t;var o=ZO.get(i),s={hostEl:e,cb:r,cbPayload:n};return o?(t=o.image,!rE(t)&&o.pending.push(s)):(t=gu.loadImage(i,BH,BH),t.__zrImageSrc=i,ZO.put(i,t.__cachedImgObj={image:t,pending:[s]})),t}else return i;else return t}function BH(){var i=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var t=0;t<i.pending.length;t++){var e=i.pending[t],r=e.cb;r&&r(this,e.cbPayload),e.hostEl.dirty()}i.pending.length=0}function rE(i){return i&&i.width&&i.height}var zL=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Qyt(i,t,e,r,n,o){if(!e){i.text="",i.isTruncated=!1;return}var s=(t+"").split(`
`);o=oK(e,r,n,o);for(var a=!1,u={},f=0,g=s.length;f<g;f++)sK(u,s[f],o),s[f]=u.textLine,a=a||u.isTruncated;i.text=s.join(`
`),i.isTruncated=a}function oK(i,t,e,r){r=r||{};var n=Fe({},r);e=Ui(e,"..."),n.maxIterations=Ui(r.maxIterations,2);var o=n.minChar=Ui(r.minChar,0),s=n.fontMeasureInfo=gh(t),a=s.asciiCharWidth;n.placeholder=Ui(r.placeholder,"");for(var u=i=Math.max(0,i-1),f=0;f<o&&u>=a;f++)u-=a;var g=mh(s,e);return g>u&&(e="",g=0),u=i-g,n.ellipsis=e,n.ellipsisWidth=g,n.contentWidth=u,n.containerWidth=i,n}function sK(i,t,e){var r=e.containerWidth,n=e.contentWidth,o=e.fontMeasureInfo;if(!r){i.textLine="",i.isTruncated=!1;return}var s=mh(o,t);if(s<=r){i.textLine=t,i.isTruncated=!1;return}for(var a=0;;a++){if(s<=n||a>=e.maxIterations){t+=e.ellipsis;break}var u=a===0?t0t(t,n,o):s>0?Math.floor(t.length*n/s):0;t=t.substr(0,u),s=mh(o,t)}t===""&&(t=e.placeholder),i.textLine=t,i.isTruncated=!0}function t0t(i,t,e){for(var r=0,n=0,o=i.length;n<o&&r<t;n++)r+=VY(e,i.charCodeAt(n));return n}function e0t(i,t,e,r){var n=LF(i),o=t.overflow,s=t.padding,a=s?s[1]+s[3]:0,u=s?s[0]+s[2]:0,f=t.font,g=o==="truncate",v=kS(f),y=Ui(t.lineHeight,v),w=t.lineOverflow==="truncate",I=!1,E=t.width;E==null&&e!=null&&(E=e-a);var D=t.height;D==null&&r!=null&&(D=r-u);var R;E!=null&&(o==="break"||o==="breakAll")?R=n?lK(n,t.font,E,o==="breakAll",0).lines:[]:R=n?n.split(`
`):[];var z=R.length*y;if(D==null&&(D=z),z>D&&w){var N=Math.floor(D/y);I=I||R.length>N,R=R.slice(0,N),z=R.length*y}if(n&&g&&E!=null)for(var H=oK(E,f,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder}),$={},X=0;X<R.length;X++)sK($,R[X],H),R[X]=$.textLine,I=I||$.isTruncated;for(var K=D,et=0,rt=gh(f),X=0;X<R.length;X++)et=Math.max(mh(rt,R[X]),et);E==null&&(E=et);var lt=E;return K+=u,lt+=a,{lines:R,height:D,outerWidth:lt,outerHeight:K,lineHeight:y,calculatedLineHeight:v,contentWidth:et,contentHeight:z,width:E,isTruncated:I}}var i0t=function(){function i(){}return i}(),FH=function(){function i(t){this.tokens=[],t&&(this.tokens=t)}return i}(),r0t=function(){function i(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[],this.isTruncated=!1}return i}();function n0t(i,t,e,r,n){var o=new r0t,s=LF(i);if(!s)return o;var a=t.padding,u=a?a[1]+a[3]:0,f=a?a[0]+a[2]:0,g=t.width;g==null&&e!=null&&(g=e-u);var v=t.height;v==null&&r!=null&&(v=r-f);for(var y=t.overflow,w=(y==="break"||y==="breakAll")&&g!=null?{width:g,accumWidth:0,breakAll:y==="breakAll"}:null,I=zL.lastIndex=0,E;(E=zL.exec(s))!=null;){var D=E.index;D>I&&BL(o,s.substring(I,D),t,w),BL(o,E[2],t,w,E[1]),I=zL.lastIndex}I<s.length&&BL(o,s.substring(I,s.length),t,w);var R=[],z=0,N=0,H=y==="truncate",$=t.lineOverflow==="truncate",X={};function K(or,Ve,Ze){or.width=Ve,or.lineHeight=Ze,z+=Ze,N=Math.max(N,Ve)}t:for(var et=0;et<o.lines.length;et++){for(var rt=o.lines[et],lt=0,ht=0,yt=0;yt<rt.tokens.length;yt++){var ft=rt.tokens[yt],kt=ft.styleName&&t.rich[ft.styleName]||{},Rt=ft.textPadding=kt.padding,Ct=Rt?Rt[1]+Rt[3]:0,Gt=ft.font=kt.font||t.font;ft.contentHeight=kS(Gt);var Vt=Ui(kt.height,ft.contentHeight);if(ft.innerHeight=Vt,Rt&&(Vt+=Rt[0]+Rt[2]),ft.height=Vt,ft.lineHeight=ic(kt.lineHeight,t.lineHeight,Vt),ft.align=kt&&kt.align||n,ft.verticalAlign=kt&&kt.verticalAlign||"middle",$&&v!=null&&z+ft.lineHeight>v){var Qt=o.lines.length;yt>0?(rt.tokens=rt.tokens.slice(0,yt),K(rt,ht,lt),o.lines=o.lines.slice(0,et+1)):o.lines=o.lines.slice(0,et),o.isTruncated=o.isTruncated||o.lines.length<Qt;break t}var fe=kt.width,Te=fe==null||fe==="auto";if(typeof fe=="string"&&fe.charAt(fe.length-1)==="%")ft.percentWidth=fe,R.push(ft),ft.contentWidth=mh(gh(Gt),ft.text);else{if(Te){var be=kt.backgroundColor,Ge=be&&be.image;Ge&&(Ge=Jyt(Ge),rE(Ge)&&(ft.width=Math.max(ft.width,Ge.width*Vt/Ge.height)))}var li=H&&g!=null?g-ht:null;li!=null&&li<ft.width?!Te||li<Ct?(ft.text="",ft.width=ft.contentWidth=0):(Qyt(X,ft.text,li-Ct,Gt,t.ellipsis,{minChar:t.truncateMinChar}),ft.text=X.text,o.isTruncated=o.isTruncated||X.isTruncated,ft.width=ft.contentWidth=mh(gh(Gt),ft.text)):ft.contentWidth=mh(gh(Gt),ft.text)}ft.width+=Ct,ht+=ft.width,kt&&(lt=Math.max(lt,ft.lineHeight))}K(rt,ht,lt)}o.outerWidth=o.width=Ui(g,N),o.outerHeight=o.height=Ui(v,z),o.contentHeight=z,o.contentWidth=N,o.outerWidth+=u,o.outerHeight+=f;for(var et=0;et<R.length;et++){var ft=R[et],Pi=ft.percentWidth;ft.width=parseInt(Pi,10)/100*o.width}return o}function BL(i,t,e,r,n){var o=t==="",s=n&&e.rich[n]||{},a=i.lines,u=s.font||e.font,f=!1,g,v;if(r){var y=s.padding,w=y?y[1]+y[3]:0;if(s.width!=null&&s.width!=="auto"){var I=vu(s.width,r.width)+w;a.length>0&&I+r.accumWidth>r.width&&(g=t.split(`
`),f=!0),r.accumWidth=I}else{var E=lK(t,u,r.width,r.breakAll,r.accumWidth);r.accumWidth=E.accumWidth+w,v=E.linesWidths,g=E.lines}}g||(g=t.split(`
`));for(var D=gh(u),R=0;R<g.length;R++){var z=g[R],N=new i0t;if(N.styleName=n,N.text=z,N.isLineHolder=!z&&!o,typeof s.width=="number"?N.width=s.width:N.width=v?v[R]:mh(D,z),!R&&!f){var H=(a[a.length-1]||(a[0]=new FH)).tokens,$=H.length;$===1&&H[0].isLineHolder?H[0]=N:(z||!$||o)&&H.push(N)}else a.push(new FH([N]))}}function a0t(i){var t=i.charCodeAt(0);return t>=32&&t<=591||t>=880&&t<=4351||t>=4608&&t<=5119||t>=7680&&t<=8303}var o0t=yh(",&?/;] ".split(""),function(i,t){return i[t]=!0,i},{});function s0t(i){return a0t(i)?!!o0t[i]:!0}function lK(i,t,e,r,n){for(var o=[],s=[],a="",u="",f=0,g=0,v=gh(t),y=0;y<i.length;y++){var w=i.charAt(y);if(w===`
`){u&&(a+=u,g+=f),o.push(a),s.push(g),a="",u="",f=0,g=0;continue}var I=VY(v,w.charCodeAt(0)),E=r?!1:!s0t(w);if(o.length?g+I>e:n+g+I>e){g?(a||u)&&(E?(a||(a=u,u="",f=0,g=f),o.push(a),s.push(g-f),u+=w,f+=I,a="",g=f):(u&&(a+=u,u="",f=0),o.push(a),s.push(g),a=w,g=I)):E?(o.push(u),s.push(f),u=w,f=I):(o.push(w),s.push(I));continue}g+=I,E?(u+=w,f+=I):(u&&(a+=u,u="",f=0),a+=w)}return u&&(a+=u),a&&(o.push(a),s.push(g)),o.length===1&&(g+=n),{accumWidth:g,lines:o,linesWidths:s}}function NH(i,t,e,r,n,o){if(i.baseX=e,i.baseY=r,i.outerWidth=i.outerHeight=null,!!t){var s=t.width*2,a=t.height*2;sr.set(VH,x0(e,s,n),ev(r,a,o),s,a),sr.intersect(t,VH,null,UH);var u=UH.outIntersectRect;i.outerWidth=u.width,i.outerHeight=u.height,i.baseX=x0(u.x,u.width,n,!0),i.baseY=ev(u.y,u.height,o,!0)}}var VH=new sr(0,0,0,0),UH={outIntersectRect:{},clamp:!0};function LF(i){return i!=null?i+="":i=""}function l0t(i){var t=LF(i.text),e=i.font,r=mh(gh(e),t),n=kS(e);return qO(i,r,n,null)}function qO(i,t,e,r){var n=new sr(x0(i.x||0,t,i.textAlign),ev(i.y||0,e,i.textBaseline),t,e),o=r??(cK(i)?i.lineWidth:0);return o>0&&(n.x-=o/2,n.y-=o/2,n.width+=o,n.height+=o),n}function cK(i){var t=i.stroke;return t!=null&&t!=="none"&&i.lineWidth>0}var XO="__zr_style_"+Math.round(Math.random()*10),iv={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},nE={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};iv[XO]=!0;var GH=["z","z2","invisible"],c0t=["invisible"],u0t=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype._init=function(e){for(var r=on(e),n=0;n<r.length;n++){var o=r[n];o==="style"?this.useStyle(e[o]):i.prototype.attrKV.call(this,o,e[o])}this.style||this.useStyle({})},t.prototype.beforeBrush=function(){},t.prototype.afterBrush=function(){},t.prototype.innerBeforeBrush=function(){},t.prototype.innerAfterBrush=function(){},t.prototype.shouldBePainted=function(e,r,n,o){var s=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&h0t(this,e,r)||s&&!s[0]&&!s[3])return!1;if(n&&this.__clipPaths&&this.__clipPaths.length){for(var a=0;a<this.__clipPaths.length;++a)if(this.__clipPaths[a].isZeroArea())return!1}if(o&&this.parent)for(var u=this.parent;u;){if(u.ignore)return!1;u=u.parent}return!0},t.prototype.contain=function(e,r){return this.rectContain(e,r)},t.prototype.traverse=function(e,r){e.call(r,this)},t.prototype.rectContain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();return o.contain(n[0],n[1])},t.prototype.getPaintRect=function(){var e=this._paintRect;if(!this._paintRect||this.__dirty){var r=this.transform,n=this.getBoundingRect(),o=this.style,s=o.shadowBlur||0,a=o.shadowOffsetX||0,u=o.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new sr(0,0,0,0)),r?sr.applyTransform(e,n,r):e.copy(n),(s||a||u)&&(e.width+=s*2+Math.abs(a),e.height+=s*2+Math.abs(u),e.x=Math.min(e.x,e.x+a-s),e.y=Math.min(e.y,e.y+u-s));var f=this.dirtyRectTolerance;e.isZero()||(e.x=Math.floor(e.x-f),e.y=Math.floor(e.y-f),e.width=Math.ceil(e.width+1+f*2),e.height=Math.ceil(e.height+1+f*2))}return e},t.prototype.setPrevPaintRect=function(e){e?(this._prevPaintRect=this._prevPaintRect||new sr(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null},t.prototype.getPrevPaintRect=function(){return this._prevPaintRect},t.prototype.animateStyle=function(e){return this.animate("style",e)},t.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():this.markRedraw()},t.prototype.attrKV=function(e,r){e!=="style"?i.prototype.attrKV.call(this,e,r):this.style?this.setStyle(r):this.useStyle(r)},t.prototype.setStyle=function(e,r){return typeof e=="string"?this.style[e]=r:Fe(this.style,e),this.dirtyStyle(),this},t.prototype.dirtyStyle=function(e){e||this.markRedraw(),this.__dirty|=Kb,this._rect&&(this._rect=null)},t.prototype.dirty=function(){this.dirtyStyle()},t.prototype.styleChanged=function(){return!!(this.__dirty&Kb)},t.prototype.styleUpdated=function(){this.__dirty&=~Kb},t.prototype.createStyle=function(e){return KC(iv,e)},t.prototype.useStyle=function(e){e[XO]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()},t.prototype.isStyleObject=function(e){return e[XO]},t.prototype._innerSaveToNormal=function(e){i.prototype._innerSaveToNormal.call(this,e);var r=this._normalState;e.style&&!r.style&&(r.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,r,GH)},t.prototype._applyStateObj=function(e,r,n,o,s,a){i.prototype._applyStateObj.call(this,e,r,n,o,s,a);var u=!(r&&o),f;if(r&&r.style?s?o?f=r.style:(f=this._mergeStyle(this.createStyle(),n.style),this._mergeStyle(f,r.style)):(f=this._mergeStyle(this.createStyle(),o?this.style:n.style),this._mergeStyle(f,r.style)):u&&(f=n.style),f)if(s){var g=this.style;if(this.style=this.createStyle(u?{}:g),u)for(var v=on(g),y=0;y<v.length;y++){var w=v[y];w in f&&(f[w]=f[w],this.style[w]=g[w])}for(var I=on(f),y=0;y<I.length;y++){var w=I[y];this.style[w]=this.style[w]}this._transitionState(e,{style:f},a,this.getAnimationStyleProps())}else this.useStyle(f);for(var E=this.__inHover?c0t:GH,y=0;y<E.length;y++){var w=E[y];r&&r[w]!=null?this[w]=r[w]:u&&n[w]!=null&&(this[w]=n[w])}},t.prototype._mergeStates=function(e){for(var r=i.prototype._mergeStates.call(this,e),n,o=0;o<e.length;o++){var s=e[o];s.style&&(n=n||{},this._mergeStyle(n,s.style))}return n&&(r.style=n),r},t.prototype._mergeStyle=function(e,r){return Fe(e,r),e},t.prototype.getAnimationStyleProps=function(){return nE},t.initDefaultProps=function(){var e=t.prototype;e.type="displayable",e.invisible=!1,e.z=0,e.z2=0,e.zlevel=0,e.culling=!1,e.cursor="pointer",e.rectHover=!1,e.incremental=!1,e._rect=null,e.dirtyRectTolerance=0,e.__dirty=Kl|Kb}(),t}(GY),FL=new sr(0,0,0,0),NL=new sr(0,0,0,0);function h0t(i,t,e){return FL.copy(i.getBoundingRect()),i.transform&&FL.applyTransform(i.transform),NL.width=t,NL.height=e,!FL.intersect(NL)}const kc=u0t;var Pl=Math.min,Ll=Math.max,VL=Math.sin,UL=Math.cos,om=Math.PI*2,pA=wv(),gA=wv(),mA=wv();function aE(i,t,e){if(i.length!==0){for(var r=i[0],n=r[0],o=r[0],s=r[1],a=r[1],u=1;u<i.length;u++)r=i[u],n=Pl(n,r[0]),o=Ll(o,r[0]),s=Pl(s,r[1]),a=Ll(a,r[1]);t[0]=n,t[1]=s,e[0]=o,e[1]=a}}function HH(i,t,e,r,n,o){n[0]=Pl(i,e),n[1]=Pl(t,r),o[0]=Ll(i,e),o[1]=Ll(t,r)}var jH=[],WH=[];function d0t(i,t,e,r,n,o,s,a,u,f){var g=AY,v=Ho,y=g(i,e,n,s,jH);u[0]=1/0,u[1]=1/0,f[0]=-1/0,f[1]=-1/0;for(var w=0;w<y;w++){var I=v(i,e,n,s,jH[w]);u[0]=Pl(I,u[0]),f[0]=Ll(I,f[0])}y=g(t,r,o,a,WH);for(var w=0;w<y;w++){var E=v(t,r,o,a,WH[w]);u[1]=Pl(E,u[1]),f[1]=Ll(E,f[1])}u[0]=Pl(i,u[0]),f[0]=Ll(i,f[0]),u[0]=Pl(s,u[0]),f[0]=Ll(s,f[0]),u[1]=Pl(t,u[1]),f[1]=Ll(t,f[1]),u[1]=Pl(a,u[1]),f[1]=Ll(a,f[1])}function f0t(i,t,e,r,n,o,s,a){var u=MY,f=is,g=Ll(Pl(u(i,e,n),1),0),v=Ll(Pl(u(t,r,o),1),0),y=f(i,e,n,g),w=f(t,r,o,v);s[0]=Pl(i,n,y),s[1]=Pl(t,o,w),a[0]=Ll(i,n,y),a[1]=Ll(t,o,w)}function p0t(i,t,e,r,n,o,s,a,u){var f=cp,g=up,v=Math.abs(n-o);if(v%om<1e-4&&v>1e-4){a[0]=i-e,a[1]=t-r,u[0]=i+e,u[1]=t+r;return}if(pA[0]=UL(n)*e+i,pA[1]=VL(n)*r+t,gA[0]=UL(o)*e+i,gA[1]=VL(o)*r+t,f(a,pA,gA),g(u,pA,gA),n=n%om,n<0&&(n=n+om),o=o%om,o<0&&(o=o+om),n>o&&!s?o+=om:n<o&&s&&(n+=om),s){var y=o;o=n,n=y}for(var w=0;w<o;w+=Math.PI/2)w>n&&(mA[0]=UL(w)*e+i,mA[1]=VL(w)*r+t,f(a,mA,a),g(u,mA,u))}var ca={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},sm=[],lm=[],Gu=[],Ff=[],Hu=[],ju=[],GL=Math.min,HL=Math.max,cm=Math.cos,um=Math.sin,td=Math.abs,YO=Math.PI,qf=YO*2,jL=typeof Float32Array<"u",pb=[];function WL(i){var t=Math.round(i/YO*1e8)/1e8;return t%2*YO}function oE(i,t){var e=WL(i[0]);e<0&&(e+=qf);var r=e-i[0],n=i[1];n+=r,!t&&n-e>=qf?n=e+qf:t&&e-n>=qf?n=e-qf:!t&&e>n?n=e+(qf-WL(e-n)):t&&e<n&&(n=e-(qf-WL(n-e))),i[0]=e,i[1]=n}var wh=function(){function i(t){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}return i.prototype.increaseVersion=function(){this._version++},i.prototype.getVersion=function(){return this._version},i.prototype.setScale=function(t,e,r){r=r||0,r>0&&(this._ux=td(r/EM/t)||0,this._uy=td(r/EM/e)||0)},i.prototype.setDPR=function(t){this.dpr=t},i.prototype.setContext=function(t){this._ctx=t},i.prototype.getContext=function(){return this._ctx},i.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},i.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},i.prototype.moveTo=function(t,e){return this._drawPendingPt(),this.addData(ca.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},i.prototype.lineTo=function(t,e){var r=td(t-this._xi),n=td(e-this._yi),o=r>this._ux||n>this._uy;if(this.addData(ca.L,t,e),this._ctx&&o&&this._ctx.lineTo(t,e),o)this._xi=t,this._yi=e,this._pendingPtDist=0;else{var s=r*r+n*n;s>this._pendingPtDist&&(this._pendingPtX=t,this._pendingPtY=e,this._pendingPtDist=s)}return this},i.prototype.bezierCurveTo=function(t,e,r,n,o,s){return this._drawPendingPt(),this.addData(ca.C,t,e,r,n,o,s),this._ctx&&this._ctx.bezierCurveTo(t,e,r,n,o,s),this._xi=o,this._yi=s,this},i.prototype.quadraticCurveTo=function(t,e,r,n){return this._drawPendingPt(),this.addData(ca.Q,t,e,r,n),this._ctx&&this._ctx.quadraticCurveTo(t,e,r,n),this._xi=r,this._yi=n,this},i.prototype.arc=function(t,e,r,n,o,s){this._drawPendingPt(),pb[0]=n,pb[1]=o,oE(pb,s),n=pb[0],o=pb[1];var a=o-n;return this.addData(ca.A,t,e,r,r,n,a,0,s?0:1),this._ctx&&this._ctx.arc(t,e,r,n,o,s),this._xi=cm(o)*r+t,this._yi=um(o)*r+e,this},i.prototype.arcTo=function(t,e,r,n,o){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(t,e,r,n,o),this},i.prototype.rect=function(t,e,r,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(t,e,r,n),this.addData(ca.R,t,e,r,n),this},i.prototype.closePath=function(){this._drawPendingPt(),this.addData(ca.Z);var t=this._ctx,e=this._x0,r=this._y0;return t&&t.closePath(),this._xi=e,this._yi=r,this},i.prototype.fill=function(t){t&&t.fill(),this.toStatic()},i.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},i.prototype.len=function(){return this._len},i.prototype.setData=function(t){if(this._saveData){var e=t.length;!(this.data&&this.data.length===e)&&jL&&(this.data=new Float32Array(e));for(var r=0;r<e;r++)this.data[r]=t[r];this._len=e}},i.prototype.appendPath=function(t){if(this._saveData){t instanceof Array||(t=[t]);for(var e=t.length,r=0,n=this._len,o=0;o<e;o++)r+=t[o].len();var s=this.data;if(jL&&(s instanceof Float32Array||!s)&&(this.data=new Float32Array(n+r),n>0&&s))for(var a=0;a<n;a++)this.data[a]=s[a];for(var o=0;o<e;o++)for(var u=t[o].data,a=0;a<u.length;a++)this.data[n++]=u[a];this._len=n}},i.prototype.addData=function(t,e,r,n,o,s,a,u,f){if(this._saveData){var g=this.data;this._len+arguments.length>g.length&&(this._expandData(),g=this.data);for(var v=0;v<arguments.length;v++)g[this._len++]=arguments[v]}},i.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},i.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},i.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var t=this.data;t instanceof Array&&(t.length=this._len,jL&&this._len>11&&(this.data=new Float32Array(t)))}},i.prototype.getBoundingRect=function(){Gu[0]=Gu[1]=Hu[0]=Hu[1]=Number.MAX_VALUE,Ff[0]=Ff[1]=ju[0]=ju[1]=-Number.MAX_VALUE;var t=this.data,e=0,r=0,n=0,o=0,s;for(s=0;s<this._len;){var a=t[s++],u=s===1;switch(u&&(e=t[s],r=t[s+1],n=e,o=r),a){case ca.M:e=n=t[s++],r=o=t[s++],Hu[0]=n,Hu[1]=o,ju[0]=n,ju[1]=o;break;case ca.L:HH(e,r,t[s],t[s+1],Hu,ju),e=t[s++],r=t[s++];break;case ca.C:d0t(e,r,t[s++],t[s++],t[s++],t[s++],t[s],t[s+1],Hu,ju),e=t[s++],r=t[s++];break;case ca.Q:f0t(e,r,t[s++],t[s++],t[s],t[s+1],Hu,ju),e=t[s++],r=t[s++];break;case ca.A:var f=t[s++],g=t[s++],v=t[s++],y=t[s++],w=t[s++],I=t[s++]+w;s+=1;var E=!t[s++];u&&(n=cm(w)*v+f,o=um(w)*y+g),p0t(f,g,v,y,w,I,E,Hu,ju),e=cm(I)*v+f,r=um(I)*y+g;break;case ca.R:n=e=t[s++],o=r=t[s++];var D=t[s++],R=t[s++];HH(n,o,n+D,o+R,Hu,ju);break;case ca.Z:e=n,r=o;break}cp(Gu,Gu,Hu),up(Ff,Ff,ju)}return s===0&&(Gu[0]=Gu[1]=Ff[0]=Ff[1]=0),new sr(Gu[0],Gu[1],Ff[0]-Gu[0],Ff[1]-Gu[1])},i.prototype._calculateLength=function(){var t=this.data,e=this._len,r=this._ux,n=this._uy,o=0,s=0,a=0,u=0;this._pathSegLen||(this._pathSegLen=[]);for(var f=this._pathSegLen,g=0,v=0,y=0;y<e;){var w=t[y++],I=y===1;I&&(o=t[y],s=t[y+1],a=o,u=s);var E=-1;switch(w){case ca.M:o=a=t[y++],s=u=t[y++];break;case ca.L:{var D=t[y++],R=t[y++],z=D-o,N=R-s;(td(z)>r||td(N)>n||y===e-1)&&(E=Math.sqrt(z*z+N*N),o=D,s=R);break}case ca.C:{var H=t[y++],$=t[y++],D=t[y++],R=t[y++],X=t[y++],K=t[y++];E=w_t(o,s,H,$,D,R,X,K,10),o=X,s=K;break}case ca.Q:{var H=t[y++],$=t[y++],D=t[y++],R=t[y++];E=T_t(o,s,H,$,D,R,10),o=D,s=R;break}case ca.A:var et=t[y++],rt=t[y++],lt=t[y++],ht=t[y++],yt=t[y++],ft=t[y++],kt=ft+yt;y+=1,I&&(a=cm(yt)*lt+et,u=um(yt)*ht+rt),E=HL(lt,ht)*GL(qf,Math.abs(ft)),o=cm(kt)*lt+et,s=um(kt)*ht+rt;break;case ca.R:{a=o=t[y++],u=s=t[y++];var Rt=t[y++],Ct=t[y++];E=Rt*2+Ct*2;break}case ca.Z:{var z=a-o,N=u-s;E=Math.sqrt(z*z+N*N),o=a,s=u;break}}E>=0&&(f[v++]=E,g+=E)}return this._pathLen=g,g},i.prototype.rebuildPath=function(t,e){var r=this.data,n=this._ux,o=this._uy,s=this._len,a,u,f,g,v,y,w=e<1,I,E,D=0,R=0,z,N=0,H,$;if(!(w&&(this._pathSegLen||this._calculateLength(),I=this._pathSegLen,E=this._pathLen,z=e*E,!z)))t:for(var X=0;X<s;){var K=r[X++],et=X===1;switch(et&&(f=r[X],g=r[X+1],a=f,u=g),K!==ca.L&&N>0&&(t.lineTo(H,$),N=0),K){case ca.M:a=f=r[X++],u=g=r[X++],t.moveTo(f,g);break;case ca.L:{v=r[X++],y=r[X++];var rt=td(v-f),lt=td(y-g);if(rt>n||lt>o){if(w){var ht=I[R++];if(D+ht>z){var yt=(z-D)/ht;t.lineTo(f*(1-yt)+v*yt,g*(1-yt)+y*yt);break t}D+=ht}t.lineTo(v,y),f=v,g=y,N=0}else{var ft=rt*rt+lt*lt;ft>N&&(H=v,$=y,N=ft)}break}case ca.C:{var kt=r[X++],Rt=r[X++],Ct=r[X++],Gt=r[X++],Vt=r[X++],Qt=r[X++];if(w){var ht=I[R++];if(D+ht>z){var yt=(z-D)/ht;Dp(f,kt,Ct,Vt,yt,sm),Dp(g,Rt,Gt,Qt,yt,lm),t.bezierCurveTo(sm[1],lm[1],sm[2],lm[2],sm[3],lm[3]);break t}D+=ht}t.bezierCurveTo(kt,Rt,Ct,Gt,Vt,Qt),f=Vt,g=Qt;break}case ca.Q:{var kt=r[X++],Rt=r[X++],Ct=r[X++],Gt=r[X++];if(w){var ht=I[R++];if(D+ht>z){var yt=(z-D)/ht;Xw(f,kt,Ct,yt,sm),Xw(g,Rt,Gt,yt,lm),t.quadraticCurveTo(sm[1],lm[1],sm[2],lm[2]);break t}D+=ht}t.quadraticCurveTo(kt,Rt,Ct,Gt),f=Ct,g=Gt;break}case ca.A:var fe=r[X++],Te=r[X++],be=r[X++],Ge=r[X++],li=r[X++],Pi=r[X++],or=r[X++],Ve=!r[X++],Ze=be>Ge?be:Ge,ye=td(be-Ge)>.001,Ke=li+Pi,We=!1;if(w){var ht=I[R++];D+ht>z&&(Ke=li+Pi*(z-D)/ht,We=!0),D+=ht}if(ye&&t.ellipse?t.ellipse(fe,Te,be,Ge,or,li,Ke,Ve):t.arc(fe,Te,Ze,li,Ke,Ve),We)break t;et&&(a=cm(li)*be+fe,u=um(li)*Ge+Te),f=cm(Ke)*be+fe,g=um(Ke)*Ge+Te;break;case ca.R:a=f=r[X],u=g=r[X+1],v=r[X++],y=r[X++];var Si=r[X++],zt=r[X++];if(w){var ht=I[R++];if(D+ht>z){var Zt=z-D;t.moveTo(v,y),t.lineTo(v+GL(Zt,Si),y),Zt-=Si,Zt>0&&t.lineTo(v+Si,y+GL(Zt,zt)),Zt-=zt,Zt>0&&t.lineTo(v+HL(Si-Zt,0),y+zt),Zt-=Si,Zt>0&&t.lineTo(v,y+HL(zt-Zt,0));break t}D+=ht}t.rect(v,y,Si,zt);break;case ca.Z:if(w){var ht=I[R++];if(D+ht>z){var yt=(z-D)/ht;t.lineTo(f*(1-yt)+a*yt,g*(1-yt)+u*yt);break t}D+=ht}t.closePath(),f=a,g=u}}},i.prototype.clone=function(){var t=new i,e=this.data;return t.data=e.slice?e.slice():Array.prototype.slice.call(e),t._len=this._len,t},i.prototype.canSave=function(){return!!this._saveData},i.CMD=ca,i.initDefaultProps=function(){var t=i.prototype;t._saveData=!0,t._ux=0,t._uy=0,t._pendingPtDist=0,t._version=0}(),i}();function tp(i,t,e,r,n,o,s){if(n===0)return!1;var a=n,u=0,f=i;if(s>t+a&&s>r+a||s<t-a&&s<r-a||o>i+a&&o>e+a||o<i-a&&o<e-a)return!1;if(i!==e)u=(t-r)/(i-e),f=(i*r-e*t)/(i-e);else return Math.abs(o-i)<=a/2;var g=u*o-s+f,v=g*g/(u*u+1);return v<=a/2*a/2}function g0t(i,t,e,r,n,o,s,a,u,f,g){if(u===0)return!1;var v=u;if(g>t+v&&g>r+v&&g>o+v&&g>a+v||g<t-v&&g<r-v&&g<o-v&&g<a-v||f>i+v&&f>e+v&&f>n+v&&f>s+v||f<i-v&&f<e-v&&f<n-v&&f<s-v)return!1;var y=IY(i,t,e,r,n,o,s,a,f,g,null);return y<=v/2}function uK(i,t,e,r,n,o,s,a,u){if(s===0)return!1;var f=s;if(u>t+f&&u>r+f&&u>o+f||u<t-f&&u<r-f&&u<o-f||a>i+f&&a>e+f&&a>n+f||a<i-f&&a<e-f&&a<n-f)return!1;var g=CY(i,t,e,r,n,o,a,u,null);return g<=f/2}var $H=Math.PI*2;function tc(i){return i%=$H,i<0&&(i+=$H),i}var gb=Math.PI*2;function m0t(i,t,e,r,n,o,s,a,u){if(s===0)return!1;var f=s;a-=i,u-=t;var g=Math.sqrt(a*a+u*u);if(g-f>e||g+f<e)return!1;if(Math.abs(r-n)%gb<1e-4)return!0;if(o){var v=r;r=tc(n),n=tc(v)}else r=tc(r),n=tc(n);r>n&&(n+=gb);var y=Math.atan2(u,a);return y<0&&(y+=gb),y>=r&&y<=n||y+gb>=r&&y+gb<=n}function cd(i,t,e,r,n,o){if(o>t&&o>r||o<t&&o<r||r===t)return 0;var s=(o-t)/(r-t),a=r<t?1:-1;(s===1||s===0)&&(a=r<t?.5:-.5);var u=s*(e-i)+i;return u===n?1/0:u>n?a:0}var Nf=wh.CMD,hm=Math.PI*2,v0t=1e-4;function _0t(i,t){return Math.abs(i-t)<v0t}var cl=[-1,-1,-1],Sc=[-1,-1];function y0t(){var i=Sc[0];Sc[0]=Sc[1],Sc[1]=i}function x0t(i,t,e,r,n,o,s,a,u,f){if(f>t&&f>r&&f>o&&f>a||f<t&&f<r&&f<o&&f<a)return 0;var g=AM(t,r,o,a,f,cl);if(g===0)return 0;for(var v=0,y=-1,w=void 0,I=void 0,E=0;E<g;E++){var D=cl[E],R=D===0||D===1?.5:1,z=Ho(i,e,n,s,D);z<u||(y<0&&(y=AY(t,r,o,a,Sc),Sc[1]<Sc[0]&&y>1&&y0t(),w=Ho(t,r,o,a,Sc[0]),y>1&&(I=Ho(t,r,o,a,Sc[1]))),y===2?D<Sc[0]?v+=w<t?R:-R:D<Sc[1]?v+=I<w?R:-R:v+=a<I?R:-R:D<Sc[0]?v+=w<t?R:-R:v+=a<w?R:-R)}return v}function b0t(i,t,e,r,n,o,s,a){if(a>t&&a>r&&a>o||a<t&&a<r&&a<o)return 0;var u=S_t(t,r,o,a,cl);if(u===0)return 0;var f=MY(t,r,o);if(f>=0&&f<=1){for(var g=0,v=is(t,r,o,f),y=0;y<u;y++){var w=cl[y]===0||cl[y]===1?.5:1,I=is(i,e,n,cl[y]);I<s||(cl[y]<f?g+=v<t?w:-w:g+=o<v?w:-w)}return g}else{var w=cl[0]===0||cl[0]===1?.5:1,I=is(i,e,n,cl[0]);return I<s?0:o<t?w:-w}}function w0t(i,t,e,r,n,o,s,a){if(a-=t,a>e||a<-e)return 0;var u=Math.sqrt(e*e-a*a);cl[0]=-u,cl[1]=u;var f=Math.abs(r-n);if(f<1e-4)return 0;if(f>=hm-1e-4){r=0,n=hm;var g=o?1:-1;return s>=cl[0]+i&&s<=cl[1]+i?g:0}if(r>n){var v=r;r=n,n=v}r<0&&(r+=hm,n+=hm);for(var y=0,w=0;w<2;w++){var I=cl[w];if(I+i>s){var E=Math.atan2(a,I),g=o?1:-1;E<0&&(E=hm+E),(E>=r&&E<=n||E+hm>=r&&E+hm<=n)&&(E>Math.PI/2&&E<Math.PI*1.5&&(g=-g),y+=g)}}return y}function hK(i,t,e,r,n){for(var o=i.data,s=i.len(),a=0,u=0,f=0,g=0,v=0,y,w,I=0;I<s;){var E=o[I++],D=I===1;switch(E===Nf.M&&I>1&&(e||(a+=cd(u,f,g,v,r,n))),D&&(u=o[I],f=o[I+1],g=u,v=f),E){case Nf.M:g=o[I++],v=o[I++],u=g,f=v;break;case Nf.L:if(e){if(tp(u,f,o[I],o[I+1],t,r,n))return!0}else a+=cd(u,f,o[I],o[I+1],r,n)||0;u=o[I++],f=o[I++];break;case Nf.C:if(e){if(g0t(u,f,o[I++],o[I++],o[I++],o[I++],o[I],o[I+1],t,r,n))return!0}else a+=x0t(u,f,o[I++],o[I++],o[I++],o[I++],o[I],o[I+1],r,n)||0;u=o[I++],f=o[I++];break;case Nf.Q:if(e){if(uK(u,f,o[I++],o[I++],o[I],o[I+1],t,r,n))return!0}else a+=b0t(u,f,o[I++],o[I++],o[I],o[I+1],r,n)||0;u=o[I++],f=o[I++];break;case Nf.A:var R=o[I++],z=o[I++],N=o[I++],H=o[I++],$=o[I++],X=o[I++];I+=1;var K=!!(1-o[I++]);y=Math.cos($)*N+R,w=Math.sin($)*H+z,D?(g=y,v=w):a+=cd(u,f,y,w,r,n);var et=(r-R)*H/N+R;if(e){if(m0t(R,z,H,$,$+X,K,t,et,n))return!0}else a+=w0t(R,z,H,$,$+X,K,et,n);u=Math.cos($+X)*N+R,f=Math.sin($+X)*H+z;break;case Nf.R:g=u=o[I++],v=f=o[I++];var rt=o[I++],lt=o[I++];if(y=g+rt,w=v+lt,e){if(tp(g,v,y,v,t,r,n)||tp(y,v,y,w,t,r,n)||tp(y,w,g,w,t,r,n)||tp(g,w,g,v,t,r,n))return!0}else a+=cd(y,v,y,w,r,n),a+=cd(g,w,g,v,r,n);break;case Nf.Z:if(e){if(tp(u,f,g,v,t,r,n))return!0}else a+=cd(u,f,g,v,r,n);u=g,f=v;break}}return!e&&!_0t(f,v)&&(a+=cd(u,f,g,v,r,n)||0),a!==0}function S0t(i,t,e){return hK(i,0,!1,t,e)}function T0t(i,t,e,r){return hK(i,t,!0,e,r)}var RM=rr({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},iv),A0t={style:rr({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},nE.style)},$L=bh.concat(["invisible","culling","z","z2","zlevel","parent"]),I0t=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.update=function(){var e=this;i.prototype.update.call(this);var r=this.style;if(r.decal){var n=this._decalEl=this._decalEl||new t;n.buildPath===t.prototype.buildPath&&(n.buildPath=function(u){e.buildPath(u,e.shape)}),n.silent=!0;var o=n.style;for(var s in r)o[s]!==r[s]&&(o[s]=r[s]);o.fill=r.fill?r.decal:null,o.decal=null,o.shadowColor=null,r.strokeFirst&&(o.stroke=null);for(var a=0;a<$L.length;++a)n[$L[a]]=this[$L[a]];n.__dirty|=Kl}else this._decalEl&&(this._decalEl=null)},t.prototype.getDecalElement=function(){return this._decalEl},t.prototype._init=function(e){var r=on(e);this.shape=this.getDefaultShape();var n=this.getDefaultStyle();n&&this.useStyle(n);for(var o=0;o<r.length;o++){var s=r[o],a=e[s];s==="style"?this.style?Fe(this.style,a):this.useStyle(a):s==="shape"?Fe(this.shape,a):i.prototype.attrKV.call(this,s,a)}this.style||this.useStyle({})},t.prototype.getDefaultStyle=function(){return null},t.prototype.getDefaultShape=function(){return{}},t.prototype.canBeInsideText=function(){return this.hasFill()},t.prototype.getInsideTextFill=function(){var e=this.style.fill;if(e!=="none"){if(bi(e)){var r=MM(e,0);return r>.5?HO:r>.2?eyt:jO}else if(e)return jO}return HO},t.prototype.getInsideTextStroke=function(e){var r=this.style.fill;if(bi(r)){var n=this.__zr,o=!!(n&&n.isDarkMode()),s=MM(e,0)<GO;if(o===s)return r}},t.prototype.buildPath=function(e,r,n){},t.prototype.pathUpdated=function(){this.__dirty&=~Gy},t.prototype.getUpdatedPathProxy=function(e){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path},t.prototype.createPathProxy=function(){this.path=new wh(!1)},t.prototype.hasStroke=function(){var e=this.style,r=e.stroke;return!(r==null||r==="none"||!(e.lineWidth>0))},t.prototype.hasFill=function(){var e=this.style,r=e.fill;return r!=null&&r!=="none"},t.prototype.getBoundingRect=function(){var e=this._rect,r=this.style,n=!e;if(n){var o=!1;this.path||(o=!0,this.createPathProxy());var s=this.path;(o||this.__dirty&Gy)&&(s.beginPath(),this.buildPath(s,this.shape,!1),this.pathUpdated()),e=s.getBoundingRect()}if(this._rect=e,this.hasStroke()&&this.path&&this.path.len()>0){var a=this._rectStroke||(this._rectStroke=e.clone());if(this.__dirty||n){a.copy(e);var u=r.strokeNoScale?this.getLineScale():1,f=r.lineWidth;if(!this.hasFill()){var g=this.strokeContainThreshold;f=Math.max(f,g??4)}u>1e-10&&(a.width+=f/u,a.height+=f/u,a.x-=f/u/2,a.y-=f/u/2)}return a}return e},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect(),s=this.style;if(e=n[0],r=n[1],o.contain(e,r)){var a=this.path;if(this.hasStroke()){var u=s.lineWidth,f=s.strokeNoScale?this.getLineScale():1;if(f>1e-10&&(this.hasFill()||(u=Math.max(u,this.strokeContainThreshold)),T0t(a,u/f,e,r)))return!0}if(this.hasFill())return S0t(a,e,r)}return!1},t.prototype.dirtyShape=function(){this.__dirty|=Gy,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},t.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},t.prototype.animateShape=function(e){return this.animate("shape",e)},t.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():e==="shape"?this.dirtyShape():this.markRedraw()},t.prototype.attrKV=function(e,r){e==="shape"?this.setShape(r):i.prototype.attrKV.call(this,e,r)},t.prototype.setShape=function(e,r){var n=this.shape;return n||(n=this.shape={}),typeof e=="string"?n[e]=r:Fe(n,e),this.dirtyShape(),this},t.prototype.shapeChanged=function(){return!!(this.__dirty&Gy)},t.prototype.createStyle=function(e){return KC(RM,e)},t.prototype._innerSaveToNormal=function(e){i.prototype._innerSaveToNormal.call(this,e);var r=this._normalState;e.shape&&!r.shape&&(r.shape=Fe({},this.shape))},t.prototype._applyStateObj=function(e,r,n,o,s,a){i.prototype._applyStateObj.call(this,e,r,n,o,s,a);var u=!(r&&o),f;if(r&&r.shape?s?o?f=r.shape:(f=Fe({},n.shape),Fe(f,r.shape)):(f=Fe({},o?this.shape:n.shape),Fe(f,r.shape)):u&&(f=n.shape),f)if(s){this.shape=Fe({},this.shape);for(var g={},v=on(f),y=0;y<v.length;y++){var w=v[y];typeof f[w]=="object"?this.shape[w]=f[w]:g[w]=f[w]}this._transitionState(e,{shape:g},a)}else this.shape=f,this.dirtyShape()},t.prototype._mergeStates=function(e){for(var r=i.prototype._mergeStates.call(this,e),n,o=0;o<e.length;o++){var s=e[o];s.shape&&(n=n||{},this._mergeStyle(n,s.shape))}return n&&(r.shape=n),r},t.prototype.getAnimationStyleProps=function(){return A0t},t.prototype.isZeroArea=function(){return!1},t.extend=function(e){var r=function(o){xa(s,o);function s(a){var u=o.call(this,a)||this;return e.init&&e.init.call(u,a),u}return s.prototype.getDefaultStyle=function(){return Yi(e.style)},s.prototype.getDefaultShape=function(){return Yi(e.shape)},s}(t);for(var n in e)typeof e[n]=="function"&&(r.prototype[n]=e[n]);return r},t.initDefaultProps=function(){var e=t.prototype;e.type="path",e.strokeContainThreshold=5,e.segmentIgnoreThreshold=0,e.subPixelOptimize=!1,e.autoBatch=!1,e.__dirty=Kl|Kb|Gy}(),t}(kc);const qr=I0t;var M0t=rr({strokeFirst:!0,font:Dd,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},RM),dK=function(i){xa(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.hasStroke=function(){return cK(this.style)},t.prototype.hasFill=function(){var e=this.style,r=e.fill;return r!=null&&r!=="none"},t.prototype.createStyle=function(e){return KC(M0t,e)},t.prototype.setBoundingRect=function(e){this._rect=e},t.prototype.getBoundingRect=function(){return this._rect||(this._rect=l0t(this.style)),this._rect},t.initDefaultProps=function(){var e=t.prototype;e.dirtyRectTolerance=10}(),t}(kc);dK.prototype.type="tspan";const tS=dK;var C0t=rr({x:0,y:0},iv),E0t={style:rr({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},nE.style)};function D0t(i){return!!(i&&typeof i!="string"&&i.width&&i.height)}var fK=function(i){xa(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.createStyle=function(e){return KC(C0t,e)},t.prototype._getSize=function(e){var r=this.style,n=r[e];if(n!=null)return n;var o=D0t(r.image)?r.image:this.__image;if(!o)return 0;var s=e==="width"?"height":"width",a=r[s];return a==null?o[e]:o[e]/o[s]*a},t.prototype.getWidth=function(){return this._getSize("width")},t.prototype.getHeight=function(){return this._getSize("height")},t.prototype.getAnimationStyleProps=function(){return E0t},t.prototype.getBoundingRect=function(){var e=this.style;return this._rect||(this._rect=new sr(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect},t}(kc);fK.prototype.type="image";const ys=fK;function P0t(i,t){var e=t.x,r=t.y,n=t.width,o=t.height,s=t.r,a,u,f,g;n<0&&(e=e+n,n=-n),o<0&&(r=r+o,o=-o),typeof s=="number"?a=u=f=g=s:s instanceof Array?s.length===1?a=u=f=g=s[0]:s.length===2?(a=f=s[0],u=g=s[1]):s.length===3?(a=s[0],u=g=s[1],f=s[2]):(a=s[0],u=s[1],f=s[2],g=s[3]):a=u=f=g=0;var v;a+u>n&&(v=a+u,a*=n/v,u*=n/v),f+g>n&&(v=f+g,f*=n/v,g*=n/v),u+f>o&&(v=u+f,u*=o/v,f*=o/v),a+g>o&&(v=a+g,a*=o/v,g*=o/v),i.moveTo(e+a,r),i.lineTo(e+n-u,r),u!==0&&i.arc(e+n-u,r+u,u,-Math.PI/2,0),i.lineTo(e+n,r+o-f),f!==0&&i.arc(e+n-f,r+o-f,f,0,Math.PI/2),i.lineTo(e+g,r+o),g!==0&&i.arc(e+g,r+o-g,g,Math.PI/2,Math.PI),i.lineTo(e,r+a),a!==0&&i.arc(e+a,r+a,a,Math.PI,Math.PI*1.5)}var qy=Math.round;function sE(i,t,e){if(t){var r=t.x1,n=t.x2,o=t.y1,s=t.y2;i.x1=r,i.x2=n,i.y1=o,i.y2=s;var a=e&&e.lineWidth;return a&&(qy(r*2)===qy(n*2)&&(i.x1=i.x2=ec(r,a,!0)),qy(o*2)===qy(s*2)&&(i.y1=i.y2=ec(o,a,!0))),i}}function pK(i,t,e){if(t){var r=t.x,n=t.y,o=t.width,s=t.height;i.x=r,i.y=n,i.width=o,i.height=s;var a=e&&e.lineWidth;return a&&(i.x=ec(r,a,!0),i.y=ec(n,a,!0),i.width=Math.max(ec(r+o,a,!1)-i.x,o===0?0:1),i.height=Math.max(ec(n+s,a,!1)-i.y,s===0?0:1)),i}}function ec(i,t,e){if(!t)return i;var r=qy(i*2);return(r+qy(t))%2===0?r/2:(r+(e?1:-1))/2}var L0t=function(){function i(){this.x=0,this.y=0,this.width=0,this.height=0}return i}(),R0t={},gK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new L0t},t.prototype.buildPath=function(e,r){var n,o,s,a;if(this.subPixelOptimize){var u=pK(R0t,r,this.style);n=u.x,o=u.y,s=u.width,a=u.height,u.r=r.r,r=u}else n=r.x,o=r.y,s=r.width,a=r.height;r.r?P0t(e,r):e.rect(n,o,s,a)},t.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},t}(qr);gK.prototype.type="rect";const jr=gK;var ZH={fill:"#000"},qH=2,Wu={},k0t={style:rr({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},nE.style)},mK=function(i){xa(t,i);function t(e){var r=i.call(this)||this;return r.type="text",r._children=[],r._defaultStyle=ZH,r.attr(e),r}return t.prototype.childrenRef=function(){return this._children},t.prototype.update=function(){i.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var r=this._children[e];r.zlevel=this.zlevel,r.z=this.z,r.z2=this.z2,r.culling=this.culling,r.cursor=this.cursor,r.invisible=this.invisible}},t.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):i.prototype.updateTransform.call(this)},t.prototype.getLocalTransform=function(e){var r=this.innerTransformable;return r?r.getLocalTransform(e):i.prototype.getLocalTransform.call(this,e)},t.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),i.prototype.getComputedTransform.call(this)},t.prototype._updateSubTexts=function(){this._childCursor=0,B0t(this.style),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},t.prototype.addSelfToZr=function(e){i.prototype.addSelfToZr.call(this,e);for(var r=0;r<this._children.length;r++)this._children[r].__zr=e},t.prototype.removeSelfFromZr=function(e){i.prototype.removeSelfFromZr.call(this,e);for(var r=0;r<this._children.length;r++)this._children[r].__zr=null},t.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var e=new sr(0,0,0,0),r=this._children,n=[],o=null,s=0;s<r.length;s++){var a=r[s],u=a.getBoundingRect(),f=a.getLocalTransform(n);f?(e.copy(u),e.applyTransform(f),o=o||e.clone(),o.union(e)):(o=o||u.clone(),o.union(u))}this._rect=o||e}return this._rect},t.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||ZH},t.prototype.setTextContent=function(e){},t.prototype._mergeStyle=function(e,r){if(!r)return e;var n=r.rich,o=e.rich||n&&{};return Fe(e,r),n&&o?(this._mergeRich(o,n),e.rich=o):o&&(e.rich=o),e},t.prototype._mergeRich=function(e,r){for(var n=on(r),o=0;o<n.length;o++){var s=n[o];e[s]=e[s]||{},Fe(e[s],r[s])}},t.prototype.getAnimationStyleProps=function(){return k0t},t.prototype._getOrCreateChild=function(e){var r=this._children[this._childCursor];return(!r||!(r instanceof e))&&(r=new e),this._children[this._childCursor++]=r,r.__zr=this.__zr,r.parent=this,r},t.prototype._updatePlainTexts=function(){var e=this.style,r=e.font||Dd,n=e.padding,o=this._defaultStyle,s=e.x||0,a=e.y||0,u=e.align||o.align||"left",f=e.verticalAlign||o.verticalAlign||"top";NH(Wu,o.overflowRect,s,a,u,f),s=Wu.baseX,a=Wu.baseY;var g=ej(e),v=e0t(g,e,Wu.outerWidth,Wu.outerHeight),y=ZL(e),w=!!e.backgroundColor,I=v.outerHeight,E=v.outerWidth,D=v.lines,R=v.lineHeight;this.isTruncated=!!v.isTruncated;var z=s,N=ev(a,v.contentHeight,f);if(y||n){var H=x0(s,E,u),$=ev(a,I,f);y&&this._renderBackground(e,e,H,$,E,I)}N+=R/2,n&&(z=tj(s,u,n),f==="top"?N+=n[0]:f==="bottom"&&(N-=n[2]));for(var X=0,K=!1,et=!1,rt=QH("fill"in e?e.fill:(et=!0,o.fill)),lt=JH("stroke"in e?e.stroke:!w&&(!o.autoStroke||et)?(X=qH,K=!0,o.stroke):null),ht=e.textShadowBlur>0,yt=0;yt<D.length;yt++){var ft=this._getOrCreateChild(tS),kt=ft.createStyle();ft.useStyle(kt),kt.text=D[yt],kt.x=z,kt.y=N,u&&(kt.textAlign=u),kt.textBaseline="middle",kt.opacity=e.opacity,kt.strokeFirst=!0,ht&&(kt.shadowBlur=e.textShadowBlur||0,kt.shadowColor=e.textShadowColor||"transparent",kt.shadowOffsetX=e.textShadowOffsetX||0,kt.shadowOffsetY=e.textShadowOffsetY||0),kt.stroke=lt,kt.fill=rt,lt&&(kt.lineWidth=e.lineWidth||X,kt.lineDash=e.lineDash,kt.lineDashOffset=e.lineDashOffset||0),kt.font=r,YH(kt,e),N+=R,ft.setBoundingRect(qO(kt,v.contentWidth,v.calculatedLineHeight,K?0:null))}},t.prototype._updateRichTexts=function(){var e=this.style,r=this._defaultStyle,n=e.align||r.align,o=e.verticalAlign||r.verticalAlign,s=e.x||0,a=e.y||0;NH(Wu,r.overflowRect,s,a,n,o),s=Wu.baseX,a=Wu.baseY;var u=ej(e),f=n0t(u,e,Wu.outerWidth,Wu.outerHeight,n),g=f.width,v=f.outerWidth,y=f.outerHeight,w=e.padding;this.isTruncated=!!f.isTruncated;var I=x0(s,v,n),E=ev(a,y,o),D=I,R=E;w&&(D+=w[3],R+=w[0]);var z=D+g;ZL(e)&&this._renderBackground(e,e,I,E,v,y);for(var N=!!e.backgroundColor,H=0;H<f.lines.length;H++){for(var $=f.lines[H],X=$.tokens,K=X.length,et=$.lineHeight,rt=$.width,lt=0,ht=D,yt=z,ft=K-1,kt=void 0;lt<K&&(kt=X[lt],!kt.align||kt.align==="left");)this._placeToken(kt,e,et,R,ht,"left",N),rt-=kt.width,ht+=kt.width,lt++;for(;ft>=0&&(kt=X[ft],kt.align==="right");)this._placeToken(kt,e,et,R,yt,"right",N),rt-=kt.width,yt-=kt.width,ft--;for(ht+=(g-(ht-D)-(z-yt)-rt)/2;lt<=ft;)kt=X[lt],this._placeToken(kt,e,et,R,ht+kt.width/2,"center",N),ht+=kt.width,lt++;R+=et}},t.prototype._placeToken=function(e,r,n,o,s,a,u){var f=r.rich[e.styleName]||{};f.text=e.text;var g=e.verticalAlign,v=o+n/2;g==="top"?v=o+e.height/2:g==="bottom"&&(v=o+n-e.height/2);var y=!e.isLineHolder&&ZL(f);y&&this._renderBackground(f,r,a==="right"?s-e.width:a==="center"?s-e.width/2:s,v-e.height/2,e.width,e.height);var w=!!f.backgroundColor,I=e.textPadding;I&&(s=tj(s,a,I),v-=e.height/2-I[0]-e.innerHeight/2);var E=this._getOrCreateChild(tS),D=E.createStyle();E.useStyle(D);var R=this._defaultStyle,z=!1,N=0,H=!1,$=QH("fill"in f?f.fill:"fill"in r?r.fill:(z=!0,R.fill)),X=JH("stroke"in f?f.stroke:"stroke"in r?r.stroke:!w&&!u&&(!R.autoStroke||z)?(N=qH,H=!0,R.stroke):null),K=f.textShadowBlur>0||r.textShadowBlur>0;D.text=e.text,D.x=s,D.y=v,K&&(D.shadowBlur=f.textShadowBlur||r.textShadowBlur||0,D.shadowColor=f.textShadowColor||r.textShadowColor||"transparent",D.shadowOffsetX=f.textShadowOffsetX||r.textShadowOffsetX||0,D.shadowOffsetY=f.textShadowOffsetY||r.textShadowOffsetY||0),D.textAlign=a,D.textBaseline="middle",D.font=e.font||Dd,D.opacity=ic(f.opacity,r.opacity,1),YH(D,f),X&&(D.lineWidth=ic(f.lineWidth,r.lineWidth,N),D.lineDash=Ui(f.lineDash,r.lineDash),D.lineDashOffset=r.lineDashOffset||0,D.stroke=X),$&&(D.fill=$),E.setBoundingRect(qO(D,e.contentWidth,e.contentHeight,H?0:null))},t.prototype._renderBackground=function(e,r,n,o,s,a){var u=e.backgroundColor,f=e.borderWidth,g=e.borderColor,v=u&&u.image,y=u&&!v,w=e.borderRadius,I=this,E,D;if(y||e.lineHeight||f&&g){E=this._getOrCreateChild(jr),E.useStyle(E.createStyle()),E.style.fill=null;var R=E.shape;R.x=n,R.y=o,R.width=s,R.height=a,R.r=w,E.dirtyShape()}if(y){var z=E.style;z.fill=u||null,z.fillOpacity=Ui(e.fillOpacity,1)}else if(v){D=this._getOrCreateChild(ys),D.onload=function(){I.dirtyStyle()};var N=D.style;N.image=u.image,N.x=n,N.y=o,N.width=s,N.height=a}if(f&&g){var z=E.style;z.lineWidth=f,z.stroke=g,z.strokeOpacity=Ui(e.strokeOpacity,1),z.lineDash=e.borderDash,z.lineDashOffset=e.borderDashOffset||0,E.strokeContainThreshold=0,E.hasFill()&&E.hasStroke()&&(z.strokeFirst=!0,z.lineWidth*=2)}var H=(E||D).style;H.shadowBlur=e.shadowBlur||0,H.shadowColor=e.shadowColor||"transparent",H.shadowOffsetX=e.shadowOffsetX||0,H.shadowOffsetY=e.shadowOffsetY||0,H.opacity=ic(e.opacity,r.opacity,1)},t.makeFont=function(e){var r="";return _K(e)&&(r=[e.fontStyle,e.fontWeight,vK(e.fontSize),e.fontFamily||"sans-serif"].join(" ")),r&&Ec(r)||e.textFont||e.font},t}(kc),O0t={left:!0,right:1,center:1},z0t={top:1,bottom:1,middle:1},XH=["fontStyle","fontWeight","fontSize","fontFamily"];function vK(i){return typeof i=="string"&&(i.indexOf("px")!==-1||i.indexOf("rem")!==-1||i.indexOf("em")!==-1)?i:isNaN(+i)?fF+"px":i+"px"}function YH(i,t){for(var e=0;e<XH.length;e++){var r=XH[e],n=t[r];n!=null&&(i[r]=n)}}function _K(i){return i.fontSize!=null||i.fontFamily||i.fontWeight}function B0t(i){return KH(i),gt(i.rich,KH),i}function KH(i){if(i){i.font=mK.makeFont(i);var t=i.align;t==="middle"&&(t="center"),i.align=t==null||O0t[t]?t:"left";var e=i.verticalAlign;e==="center"&&(e="middle"),i.verticalAlign=e==null||z0t[e]?e:"top";var r=i.padding;r&&(i.padding=YC(i.padding))}}function JH(i,t){return i==null||t<=0||i==="transparent"||i==="none"?null:i.image||i.colorStops?"#000":i}function QH(i){return i==null||i==="none"?null:i.image||i.colorStops?"#000":i}function tj(i,t,e){return t==="right"?i-e[1]:t==="center"?i+e[3]/2-e[1]/2:i+e[3]}function ej(i){var t=i.text;return t!=null&&(t+=""),t}function ZL(i){return!!(i.backgroundColor||i.lineHeight||i.borderWidth&&i.borderColor)}const _n=mK;var ur=Wr(),KO=function(i,t,e,r){if(r){var n=ur(r);n.dataIndex=e,n.dataType=t,n.seriesIndex=i,n.ssrType="chart",r.type==="group"&&r.traverse(function(o){var s=ur(o);s.seriesIndex=i,s.dataIndex=e,s.dataType=t,s.ssrType="chart"})}},ij=1,rj={},yK=Wr(),RF=Wr(),kF=0,OS=1,lE=2,fl=["emphasis","blur","select"],eS=["normal","emphasis","blur","select"],N0=10,F0t=9,rv="highlight",WI="downplay",kM="select",JO="unselect",OM="toggleSelect",OF="selectchanged";function my(i){return i!=null&&i!=="none"}function cE(i,t,e){i.onHoverStateChange&&(i.hoverState||0)!==e&&i.onHoverStateChange(t),i.hoverState=e}function xK(i){cE(i,"emphasis",lE)}function bK(i){i.hoverState===lE&&cE(i,"normal",kF)}function zF(i){cE(i,"blur",OS)}function wK(i){i.hoverState===OS&&cE(i,"normal",kF)}function N0t(i){i.selected=!0}function V0t(i){i.selected=!1}function nj(i,t,e){t(i,e)}function Ud(i,t,e){nj(i,t,e),i.isGroup&&i.traverse(function(r){nj(r,t,e)})}function zM(i,t){switch(t){case"emphasis":i.hoverState=lE;break;case"normal":i.hoverState=kF;break;case"blur":i.hoverState=OS;break;case"select":i.selected=!0}}function U0t(i,t,e,r){for(var n=i.style,o={},s=0;s<t.length;s++){var a=t[s],u=n[a];o[a]=u??(r&&r[a])}for(var s=0;s<i.animators.length;s++){var f=i.animators[s];f.__fromStateTransition&&f.__fromStateTransition.indexOf(e)<0&&f.targetName==="style"&&f.saveTo(o,t)}return o}function G0t(i,t,e,r){var n=e&&Ar(e,"select")>=0,o=!1;if(i instanceof qr){var s=yK(i),a=n&&s.selectFill||s.normalFill,u=n&&s.selectStroke||s.normalStroke;if(my(a)||my(u)){r=r||{};var f=r.style||{};f.fill==="inherit"?(o=!0,r=Fe({},r),f=Fe({},f),f.fill=a):!my(f.fill)&&my(a)?(o=!0,r=Fe({},r),f=Fe({},f),f.fill=OO(a)):!my(f.stroke)&&my(u)&&(o||(r=Fe({},r),f=Fe({},f)),f.stroke=OO(u)),r.style=f}}if(r&&r.z2==null){o||(r=Fe({},r));var g=i.z2EmphasisLift;r.z2=i.z2+(g??N0)}return r}function H0t(i,t,e){if(e&&e.z2==null){e=Fe({},e);var r=i.z2SelectLift;e.z2=i.z2+(r??F0t)}return e}function j0t(i,t,e){var r=Ar(i.currentStates,t)>=0,n=i.style.opacity,o=r?null:U0t(i,["opacity"],t,{opacity:1});e=e||{};var s=e.style||{};return s.opacity==null&&(e=Fe({},e),s=Fe({opacity:r?n:o.opacity*.1},s),e.style=s),e}function qL(i,t){var e=this.states[i];if(this.style){if(i==="emphasis")return G0t(this,i,t,e);if(i==="blur")return j0t(this,i,e);if(i==="select")return H0t(this,i,e)}return e}function gv(i){i.stateProxy=qL;var t=i.getTextContent(),e=i.getTextGuideLine();t&&(t.stateProxy=qL),e&&(e.stateProxy=qL)}function aj(i,t){!IK(i,t)&&!i.__highByOuter&&Ud(i,xK)}function oj(i,t){!IK(i,t)&&!i.__highByOuter&&Ud(i,bK)}function Rd(i,t){i.__highByOuter|=1<<(t||0),Ud(i,xK)}function kd(i,t){!(i.__highByOuter&=~(1<<(t||0)))&&Ud(i,bK)}function SK(i){Ud(i,zF)}function BF(i){Ud(i,wK)}function TK(i){Ud(i,N0t)}function AK(i){Ud(i,V0t)}function IK(i,t){return i.__highDownSilentOnTouch&&t.zrByTouch}function MK(i){var t=i.getModel(),e=[],r=[];t.eachComponent(function(n,o){var s=RF(o),a=n==="series",u=a?i.getViewOfSeriesModel(o):i.getViewOfComponentModel(o);!a&&r.push(u),s.isBlured&&(u.group.traverse(function(f){wK(f)}),a&&e.push(o)),s.isBlured=!1}),gt(r,function(n){n&&n.toggleBlurSeries&&n.toggleBlurSeries(e,!1,t)})}function QO(i,t,e,r){var n=r.getModel();e=e||"coordinateSystem";function o(f,g){for(var v=0;v<g.length;v++){var y=f.getItemGraphicEl(g[v]);y&&BF(y)}}if(i!=null&&!(!t||t==="none")){var s=n.getSeriesByIndex(i),a=s.coordinateSystem;a&&a.master&&(a=a.master);var u=[];n.eachSeries(function(f){var g=s===f,v=f.coordinateSystem;v&&v.master&&(v=v.master);var y=v&&a?v===a:g;if(!(e==="series"&&!g||e==="coordinateSystem"&&!y||t==="series"&&g)){var w=r.getViewOfSeriesModel(f);if(w.group.traverse(function(D){D.__highByOuter&&g&&t==="self"||zF(D)}),Ns(t))o(f.getData(),t);else if(nr(t))for(var I=on(t),E=0;E<I.length;E++)o(f.getData(I[E]),t[I[E]]);u.push(f),RF(f).isBlured=!0}}),n.eachComponent(function(f,g){if(f!=="series"){var v=r.getViewOfComponentModel(g);v&&v.toggleBlurSeries&&v.toggleBlurSeries(u,!0,n)}})}}function tz(i,t,e){if(!(i==null||t==null)){var r=e.getModel().getComponent(i,t);if(r){RF(r).isBlured=!0;var n=e.getViewOfComponentModel(r);!n||!n.focusBlurEnabled||n.group.traverse(function(o){zF(o)})}}}function W0t(i,t,e){var r=i.seriesIndex,n=i.getData(t.dataType);if(n){var o=fv(n,t);o=(Ye(o)?o[0]:o)||0;var s=n.getItemGraphicEl(o);if(!s)for(var a=n.count(),u=0;!s&&u<a;)s=n.getItemGraphicEl(u++);if(s){var f=ur(s);QO(r,f.focus,f.blurScope,e)}else{var g=i.get(["emphasis","focus"]),v=i.get(["emphasis","blurScope"]);g!=null&&QO(r,g,v,e)}}}function FF(i,t,e,r){var n={focusSelf:!1,dispatchers:null};if(i==null||i==="series"||t==null||e==null)return n;var o=r.getModel().getComponent(i,t);if(!o)return n;var s=r.getViewOfComponentModel(o);if(!s||!s.findHighDownDispatchers)return n;for(var a=s.findHighDownDispatchers(e),u,f=0;f<a.length;f++)if(ur(a[f]).focus==="self"){u=!0;break}return{focusSelf:u,dispatchers:a}}function $0t(i,t,e){var r=ur(i),n=FF(r.componentMainType,r.componentIndex,r.componentHighDownName,e),o=n.dispatchers,s=n.focusSelf;o?(s&&tz(r.componentMainType,r.componentIndex,e),gt(o,function(a){return aj(a,t)})):(QO(r.seriesIndex,r.focus,r.blurScope,e),r.focus==="self"&&tz(r.componentMainType,r.componentIndex,e),aj(i,t))}function Z0t(i,t,e){MK(e);var r=ur(i),n=FF(r.componentMainType,r.componentIndex,r.componentHighDownName,e).dispatchers;n?gt(n,function(o){return oj(o,t)}):oj(i,t)}function q0t(i,t,e){if(iz(t)){var r=t.dataType,n=i.getData(r),o=fv(n,t);Ye(o)||(o=[o]),i[t.type===OM?"toggleSelect":t.type===kM?"select":"unselect"](o,r)}}function sj(i){var t=i.getAllData();gt(t,function(e){var r=e.data,n=e.type;r.eachItemGraphicEl(function(o,s){i.isSelected(s,n)?TK(o):AK(o)})})}function X0t(i){var t=[];return i.eachSeries(function(e){var r=e.getAllData();gt(r,function(n){n.data;var o=n.type,s=e.getSelectedDataIndices();if(s.length>0){var a={dataIndex:s,seriesIndex:e.seriesIndex};o!=null&&(a.dataType=o),t.push(a)}})}),t}function nv(i,t,e){Hm(i,!0),Ud(i,gv),ez(i,t,e)}function Y0t(i){Hm(i,!1)}function Ma(i,t,e,r){r?Y0t(i):nv(i,t,e)}function ez(i,t,e){var r=ur(i);t!=null?(r.focus=t,r.blurScope=e):r.focus&&(r.focus=null)}var lj=["emphasis","blur","select"],K0t={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function Oo(i,t,e,r){e=e||"itemStyle";for(var n=0;n<lj.length;n++){var o=lj[n],s=t.getModel([o,e]),a=i.ensureState(o);a.style=r?r(s):s[K0t[e]]()}}function Hm(i,t){var e=t===!1,r=i;i.highDownSilentOnTouch&&(r.__highDownSilentOnTouch=i.highDownSilentOnTouch),(!e||r.__highDownDispatcher)&&(r.__highByOuter=r.__highByOuter||0,r.__highDownDispatcher=!e)}function iS(i){return!!(i&&i.__highDownDispatcher)}function J0t(i,t,e){var r=ur(i);r.componentMainType=t.mainType,r.componentIndex=t.componentIndex,r.componentHighDownName=e}function Q0t(i){var t=rj[i];return t==null&&ij<=32&&(t=rj[i]=ij++),t}function iz(i){var t=i.type;return t===kM||t===JO||t===OM}function cj(i){var t=i.type;return t===rv||t===WI}function txt(i){var t=yK(i);t.normalFill=i.style.fill,t.normalStroke=i.style.stroke;var e=i.states.select||{};t.selectFill=e.style&&e.style.fill||null,t.selectStroke=e.style&&e.style.stroke||null}var vy=wh.CMD,ext=[[],[],[]],uj=Math.sqrt,ixt=Math.atan2;function CK(i,t){if(t){var e=i.data,r=i.len(),n,o,s,a,u,f,g=vy.M,v=vy.C,y=vy.L,w=vy.R,I=vy.A,E=vy.Q;for(s=0,a=0;s<r;){switch(n=e[s++],a=s,o=0,n){case g:o=1;break;case y:o=1;break;case v:o=3;break;case E:o=2;break;case I:var D=t[4],R=t[5],z=uj(t[0]*t[0]+t[1]*t[1]),N=uj(t[2]*t[2]+t[3]*t[3]),H=ixt(-t[1]/N,t[0]/z);e[s]*=z,e[s++]+=D,e[s]*=N,e[s++]+=R,e[s++]*=z,e[s++]*=N,e[s++]+=H,e[s++]+=H,s+=2,a=s;break;case w:f[0]=e[s++],f[1]=e[s++],ho(f,f,t),e[a++]=f[0],e[a++]=f[1],f[0]+=e[s++],f[1]+=e[s++],ho(f,f,t),e[a++]=f[0],e[a++]=f[1]}for(u=0;u<o;u++){var $=ext[u];$[0]=e[s++],$[1]=e[s++],ho($,$,t),e[a++]=$[0],e[a++]=$[1]}}i.increaseVersion()}}var XL=Math.sqrt,vA=Math.sin,_A=Math.cos,mb=Math.PI;function hj(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function rz(i,t){return(i[0]*t[0]+i[1]*t[1])/(hj(i)*hj(t))}function dj(i,t){return(i[0]*t[1]<i[1]*t[0]?-1:1)*Math.acos(rz(i,t))}function fj(i,t,e,r,n,o,s,a,u,f,g){var v=u*(mb/180),y=_A(v)*(i-e)/2+vA(v)*(t-r)/2,w=-1*vA(v)*(i-e)/2+_A(v)*(t-r)/2,I=y*y/(s*s)+w*w/(a*a);I>1&&(s*=XL(I),a*=XL(I));var E=(n===o?-1:1)*XL((s*s*(a*a)-s*s*(w*w)-a*a*(y*y))/(s*s*(w*w)+a*a*(y*y)))||0,D=E*s*w/a,R=E*-a*y/s,z=(i+e)/2+_A(v)*D-vA(v)*R,N=(t+r)/2+vA(v)*D+_A(v)*R,H=dj([1,0],[(y-D)/s,(w-R)/a]),$=[(y-D)/s,(w-R)/a],X=[(-1*y-D)/s,(-1*w-R)/a],K=dj($,X);if(rz($,X)<=-1&&(K=mb),rz($,X)>=1&&(K=0),K<0){var et=Math.round(K/mb*1e6)/1e6;K=mb*2+et%2*mb}g.addData(f,z,N,s,a,H,K,v,o)}var rxt=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig,nxt=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function axt(i){var t=new wh;if(!i)return t;var e=0,r=0,n=e,o=r,s,a=wh.CMD,u=i.match(rxt);if(!u)return t;for(var f=0;f<u.length;f++){for(var g=u[f],v=g.charAt(0),y=void 0,w=g.match(nxt)||[],I=w.length,E=0;E<I;E++)w[E]=parseFloat(w[E]);for(var D=0;D<I;){var R=void 0,z=void 0,N=void 0,H=void 0,$=void 0,X=void 0,K=void 0,et=e,rt=r,lt=void 0,ht=void 0;switch(v){case"l":e+=w[D++],r+=w[D++],y=a.L,t.addData(y,e,r);break;case"L":e=w[D++],r=w[D++],y=a.L,t.addData(y,e,r);break;case"m":e+=w[D++],r+=w[D++],y=a.M,t.addData(y,e,r),n=e,o=r,v="l";break;case"M":e=w[D++],r=w[D++],y=a.M,t.addData(y,e,r),n=e,o=r,v="L";break;case"h":e+=w[D++],y=a.L,t.addData(y,e,r);break;case"H":e=w[D++],y=a.L,t.addData(y,e,r);break;case"v":r+=w[D++],y=a.L,t.addData(y,e,r);break;case"V":r=w[D++],y=a.L,t.addData(y,e,r);break;case"C":y=a.C,t.addData(y,w[D++],w[D++],w[D++],w[D++],w[D++],w[D++]),e=w[D-2],r=w[D-1];break;case"c":y=a.C,t.addData(y,w[D++]+e,w[D++]+r,w[D++]+e,w[D++]+r,w[D++]+e,w[D++]+r),e+=w[D-2],r+=w[D-1];break;case"S":R=e,z=r,lt=t.len(),ht=t.data,s===a.C&&(R+=e-ht[lt-4],z+=r-ht[lt-3]),y=a.C,et=w[D++],rt=w[D++],e=w[D++],r=w[D++],t.addData(y,R,z,et,rt,e,r);break;case"s":R=e,z=r,lt=t.len(),ht=t.data,s===a.C&&(R+=e-ht[lt-4],z+=r-ht[lt-3]),y=a.C,et=e+w[D++],rt=r+w[D++],e+=w[D++],r+=w[D++],t.addData(y,R,z,et,rt,e,r);break;case"Q":et=w[D++],rt=w[D++],e=w[D++],r=w[D++],y=a.Q,t.addData(y,et,rt,e,r);break;case"q":et=w[D++]+e,rt=w[D++]+r,e+=w[D++],r+=w[D++],y=a.Q,t.addData(y,et,rt,e,r);break;case"T":R=e,z=r,lt=t.len(),ht=t.data,s===a.Q&&(R+=e-ht[lt-4],z+=r-ht[lt-3]),e=w[D++],r=w[D++],y=a.Q,t.addData(y,R,z,e,r);break;case"t":R=e,z=r,lt=t.len(),ht=t.data,s===a.Q&&(R+=e-ht[lt-4],z+=r-ht[lt-3]),e+=w[D++],r+=w[D++],y=a.Q,t.addData(y,R,z,e,r);break;case"A":N=w[D++],H=w[D++],$=w[D++],X=w[D++],K=w[D++],et=e,rt=r,e=w[D++],r=w[D++],y=a.A,fj(et,rt,e,r,X,K,N,H,$,y,t);break;case"a":N=w[D++],H=w[D++],$=w[D++],X=w[D++],K=w[D++],et=e,rt=r,e+=w[D++],r+=w[D++],y=a.A,fj(et,rt,e,r,X,K,N,H,$,y,t);break}}(v==="z"||v==="Z")&&(y=a.Z,t.addData(y),e=n,r=o),s=y}return t.toStatic(),t}var EK=function(i){xa(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.applyTransform=function(e){},t}(qr);function DK(i){return i.setData!=null}function PK(i,t){var e=axt(i),r=Fe({},t);return r.buildPath=function(n){var o=DK(n);if(o&&n.canSave()){n.appendPath(e);var s=n.getContext();s&&n.rebuildPath(s,1)}else{var s=o?n.getContext():n;s&&e.rebuildPath(s,1)}},r.applyTransform=function(n){CK(e,n),this.dirtyShape()},r}function LK(i,t){return new EK(PK(i,t))}function oxt(i,t){var e=PK(i,t),r=function(n){xa(o,n);function o(s){var a=n.call(this,s)||this;return a.applyTransform=e.applyTransform,a.buildPath=e.buildPath,a}return o}(EK);return r}function sxt(i,t){for(var e=[],r=i.length,n=0;n<r;n++){var o=i[n];e.push(o.getUpdatedPathProxy(!0))}var s=new qr(t);return s.createPathProxy(),s.buildPath=function(a){if(DK(a)){a.appendPath(e);var u=a.getContext();u&&a.rebuildPath(u,1)}},s}function NF(i,t){t=t||{};var e=new qr;return i.shape&&e.setShape(i.shape),e.setStyle(i.style),t.bakeTransform?CK(e.path,i.getComputedTransform()):t.toLocal?e.setLocalTransform(i.getComputedTransform()):e.copyTransform(i),e.buildPath=i.buildPath,e.applyTransform=e.applyTransform,e.z=i.z,e.z2=i.z2,e.zlevel=i.zlevel,e}var lxt=function(){function i(){this.cx=0,this.cy=0,this.r=0}return i}(),RK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new lxt},t.prototype.buildPath=function(e,r){e.moveTo(r.cx+r.r,r.cy),e.arc(r.cx,r.cy,r.r,0,Math.PI*2)},t}(qr);RK.prototype.type="circle";const Gp=RK;var cxt=function(){function i(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}return i}(),kK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new cxt},t.prototype.buildPath=function(e,r){var n=.5522848,o=r.cx,s=r.cy,a=r.rx,u=r.ry,f=a*n,g=u*n;e.moveTo(o-a,s),e.bezierCurveTo(o-a,s-g,o-f,s-u,o,s-u),e.bezierCurveTo(o+f,s-u,o+a,s-g,o+a,s),e.bezierCurveTo(o+a,s+g,o+f,s+u,o,s+u),e.bezierCurveTo(o-f,s+u,o-a,s+g,o-a,s),e.closePath()},t}(qr);kK.prototype.type="ellipse";const VF=kK;var OK=Math.PI,YL=OK*2,dm=Math.sin,_y=Math.cos,uxt=Math.acos,Cs=Math.atan2,pj=Math.abs,Iw=Math.sqrt,Qb=Math.max,$u=Math.min,ru=1e-4;function hxt(i,t,e,r,n,o,s,a){var u=e-i,f=r-t,g=s-n,v=a-o,y=v*u-g*f;if(!(y*y<ru))return y=(g*(t-o)-v*(i-n))/y,[i+y*u,t+y*f]}function yA(i,t,e,r,n,o,s){var a=i-e,u=t-r,f=(s?o:-o)/Iw(a*a+u*u),g=f*u,v=-f*a,y=i+g,w=t+v,I=e+g,E=r+v,D=(y+I)/2,R=(w+E)/2,z=I-y,N=E-w,H=z*z+N*N,$=n-o,X=y*E-I*w,K=(N<0?-1:1)*Iw(Qb(0,$*$*H-X*X)),et=(X*N-z*K)/H,rt=(-X*z-N*K)/H,lt=(X*N+z*K)/H,ht=(-X*z+N*K)/H,yt=et-D,ft=rt-R,kt=lt-D,Rt=ht-R;return yt*yt+ft*ft>kt*kt+Rt*Rt&&(et=lt,rt=ht),{cx:et,cy:rt,x0:-g,y0:-v,x1:et*(n/$-1),y1:rt*(n/$-1)}}function dxt(i){var t;if(Ye(i)){var e=i.length;if(!e)return i;e===1?t=[i[0],i[0],0,0]:e===2?t=[i[0],i[0],i[1],i[1]]:e===3?t=i.concat(i[2]):t=i}else t=[i,i,i,i];return t}function fxt(i,t){var e,r=Qb(t.r,0),n=Qb(t.r0||0,0),o=r>0,s=n>0;if(!(!o&&!s)){if(o||(r=n,n=0),n>r){var a=r;r=n,n=a}var u=t.startAngle,f=t.endAngle;if(!(isNaN(u)||isNaN(f))){var g=t.cx,v=t.cy,y=!!t.clockwise,w=pj(f-u),I=w>YL&&w%YL;if(I>ru&&(w=I),!(r>ru))i.moveTo(g,v);else if(w>YL-ru)i.moveTo(g+r*_y(u),v+r*dm(u)),i.arc(g,v,r,u,f,!y),n>ru&&(i.moveTo(g+n*_y(f),v+n*dm(f)),i.arc(g,v,n,f,u,y));else{var E=void 0,D=void 0,R=void 0,z=void 0,N=void 0,H=void 0,$=void 0,X=void 0,K=void 0,et=void 0,rt=void 0,lt=void 0,ht=void 0,yt=void 0,ft=void 0,kt=void 0,Rt=r*_y(u),Ct=r*dm(u),Gt=n*_y(f),Vt=n*dm(f),Qt=w>ru;if(Qt){var fe=t.cornerRadius;fe&&(e=dxt(fe),E=e[0],D=e[1],R=e[2],z=e[3]);var Te=pj(r-n)/2;if(N=$u(Te,R),H=$u(Te,z),$=$u(Te,E),X=$u(Te,D),rt=K=Qb(N,H),lt=et=Qb($,X),(K>ru||et>ru)&&(ht=r*_y(f),yt=r*dm(f),ft=n*_y(u),kt=n*dm(u),w<OK)){var be=hxt(Rt,Ct,ft,kt,ht,yt,Gt,Vt);if(be){var Ge=Rt-be[0],li=Ct-be[1],Pi=ht-be[0],or=yt-be[1],Ve=1/dm(uxt((Ge*Pi+li*or)/(Iw(Ge*Ge+li*li)*Iw(Pi*Pi+or*or)))/2),Ze=Iw(be[0]*be[0]+be[1]*be[1]);rt=$u(K,(r-Ze)/(Ve+1)),lt=$u(et,(n-Ze)/(Ve-1))}}}if(!Qt)i.moveTo(g+Rt,v+Ct);else if(rt>ru){var ye=$u(R,rt),Ke=$u(z,rt),We=yA(ft,kt,Rt,Ct,r,ye,y),Si=yA(ht,yt,Gt,Vt,r,Ke,y);i.moveTo(g+We.cx+We.x0,v+We.cy+We.y0),rt<K&&ye===Ke?i.arc(g+We.cx,v+We.cy,rt,Cs(We.y0,We.x0),Cs(Si.y0,Si.x0),!y):(ye>0&&i.arc(g+We.cx,v+We.cy,ye,Cs(We.y0,We.x0),Cs(We.y1,We.x1),!y),i.arc(g,v,r,Cs(We.cy+We.y1,We.cx+We.x1),Cs(Si.cy+Si.y1,Si.cx+Si.x1),!y),Ke>0&&i.arc(g+Si.cx,v+Si.cy,Ke,Cs(Si.y1,Si.x1),Cs(Si.y0,Si.x0),!y))}else i.moveTo(g+Rt,v+Ct),i.arc(g,v,r,u,f,!y);if(!(n>ru)||!Qt)i.lineTo(g+Gt,v+Vt);else if(lt>ru){var ye=$u(E,lt),Ke=$u(D,lt),We=yA(Gt,Vt,ht,yt,n,-Ke,y),Si=yA(Rt,Ct,ft,kt,n,-ye,y);i.lineTo(g+We.cx+We.x0,v+We.cy+We.y0),lt<et&&ye===Ke?i.arc(g+We.cx,v+We.cy,lt,Cs(We.y0,We.x0),Cs(Si.y0,Si.x0),!y):(Ke>0&&i.arc(g+We.cx,v+We.cy,Ke,Cs(We.y0,We.x0),Cs(We.y1,We.x1),!y),i.arc(g,v,n,Cs(We.cy+We.y1,We.cx+We.x1),Cs(Si.cy+Si.y1,Si.cx+Si.x1),y),ye>0&&i.arc(g+Si.cx,v+Si.cy,ye,Cs(Si.y1,Si.x1),Cs(Si.y0,Si.x0),!y))}else i.lineTo(g+Gt,v+Vt),i.arc(g,v,n,f,u,y)}i.closePath()}}}var pxt=function(){function i(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0,this.cornerRadius=0}return i}(),zK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new pxt},t.prototype.buildPath=function(e,r){fxt(e,r)},t.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},t}(qr);zK.prototype.type="sector";const pl=zK;var gxt=function(){function i(){this.cx=0,this.cy=0,this.r=0,this.r0=0}return i}(),BK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new gxt},t.prototype.buildPath=function(e,r){var n=r.cx,o=r.cy,s=Math.PI*2;e.moveTo(n+r.r,o),e.arc(n,o,r.r,0,s,!1),e.moveTo(n+r.r0,o),e.arc(n,o,r.r0,0,s,!0)},t}(qr);BK.prototype.type="ring";const uE=BK;function mxt(i,t,e,r){var n=[],o=[],s=[],a=[],u,f,g,v;if(r){g=[1/0,1/0],v=[-1/0,-1/0];for(var y=0,w=i.length;y<w;y++)cp(g,g,i[y]),up(v,v,i[y]);cp(g,g,r[0]),up(v,v,r[1])}for(var y=0,w=i.length;y<w;y++){var I=i[y];if(e)u=i[y?y-1:w-1],f=i[(y+1)%w];else if(y===0||y===w-1){n.push(Sd(i[y]));continue}else u=i[y-1],f=i[y+1];Um(o,f,u),BI(o,o,t);var E=SO(I,u),D=SO(I,f),R=E+D;R!==0&&(E/=R,D/=R),BI(s,o,-E),BI(a,o,D);var z=iH([],I,s),N=iH([],I,a);r&&(up(z,z,g),cp(z,z,v),up(N,N,g),cp(N,N,v)),n.push(z),n.push(N)}return e&&n.push(n.shift()),n}function FK(i,t,e){var r=t.smooth,n=t.points;if(n&&n.length>=2){if(r){var o=mxt(n,r,e,t.smoothConstraint);i.moveTo(n[0][0],n[0][1]);for(var s=n.length,a=0;a<(e?s:s-1);a++){var u=o[a*2],f=o[a*2+1],g=n[(a+1)%s];i.bezierCurveTo(u[0],u[1],f[0],f[1],g[0],g[1])}}else{i.moveTo(n[0][0],n[0][1]);for(var a=1,v=n.length;a<v;a++)i.lineTo(n[a][0],n[a][1])}e&&i.closePath()}}var vxt=function(){function i(){this.points=null,this.smooth=0,this.smoothConstraint=null}return i}(),NK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new vxt},t.prototype.buildPath=function(e,r){FK(e,r,!0)},t}(qr);NK.prototype.type="polygon";const gl=NK;var _xt=function(){function i(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}return i}(),VK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new _xt},t.prototype.buildPath=function(e,r){FK(e,r,!1)},t}(qr);VK.prototype.type="polyline";const Us=VK;var yxt={},xxt=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return i}(),UK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new xxt},t.prototype.buildPath=function(e,r){var n,o,s,a;if(this.subPixelOptimize){var u=sE(yxt,r,this.style);n=u.x1,o=u.y1,s=u.x2,a=u.y2}else n=r.x1,o=r.y1,s=r.x2,a=r.y2;var f=r.percent;f!==0&&(e.moveTo(n,o),f<1&&(s=n*(1-f)+s*f,a=o*(1-f)+a*f),e.lineTo(s,a))},t.prototype.pointAt=function(e){var r=this.shape;return[r.x1*(1-e)+r.x2*e,r.y1*(1-e)+r.y2*e]},t}(qr);UK.prototype.type="line";const Ro=UK;var El=[],bxt=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}return i}();function gj(i,t,e){var r=i.cpx2,n=i.cpy2;return r!=null||n!=null?[(e?gH:Ho)(i.x1,i.cpx1,i.cpx2,i.x2,t),(e?gH:Ho)(i.y1,i.cpy1,i.cpy2,i.y2,t)]:[(e?PO:is)(i.x1,i.cpx1,i.x2,t),(e?PO:is)(i.y1,i.cpy1,i.y2,t)]}var GK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new bxt},t.prototype.buildPath=function(e,r){var n=r.x1,o=r.y1,s=r.x2,a=r.y2,u=r.cpx1,f=r.cpy1,g=r.cpx2,v=r.cpy2,y=r.percent;y!==0&&(e.moveTo(n,o),g==null||v==null?(y<1&&(Xw(n,u,s,y,El),u=El[1],s=El[2],Xw(o,f,a,y,El),f=El[1],a=El[2]),e.quadraticCurveTo(u,f,s,a)):(y<1&&(Dp(n,u,g,s,y,El),u=El[1],g=El[2],s=El[3],Dp(o,f,v,a,y,El),f=El[1],v=El[2],a=El[3]),e.bezierCurveTo(u,f,g,v,s,a)))},t.prototype.pointAt=function(e){return gj(this.shape,e,!1)},t.prototype.tangentAt=function(e){var r=gj(this.shape,e,!0);return z0(r,r)},t}(qr);GK.prototype.type="bezier-curve";const hE=GK;var wxt=function(){function i(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return i}(),HK=function(i){xa(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new wxt},t.prototype.buildPath=function(e,r){var n=r.cx,o=r.cy,s=Math.max(r.r,0),a=r.startAngle,u=r.endAngle,f=r.clockwise,g=Math.cos(a),v=Math.sin(a);e.moveTo(g*s+n,v*s+o),e.arc(n,o,s,a,u,!f)},t}(qr);HK.prototype.type="arc";const UF=HK;var Sxt=function(i){xa(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="compound",e}return t.prototype._updatePathDirty=function(){for(var e=this.shape.paths,r=this.shapeChanged(),n=0;n<e.length;n++)r=r||e[n].shapeChanged();r&&this.dirtyShape()},t.prototype.beforeBrush=function(){this._updatePathDirty();for(var e=this.shape.paths||[],r=this.getGlobalScale(),n=0;n<e.length;n++)e[n].path||e[n].createPathProxy(),e[n].path.setScale(r[0],r[1],e[n].segmentIgnoreThreshold)},t.prototype.buildPath=function(e,r){for(var n=r.paths||[],o=0;o<n.length;o++)n[o].buildPath(e,n[o].shape,!0)},t.prototype.afterBrush=function(){for(var e=this.shape.paths||[],r=0;r<e.length;r++)e[r].pathUpdated()},t.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),qr.prototype.getBoundingRect.call(this)},t}(qr);const dE=Sxt;var Txt=function(){function i(t){this.colorStops=t||[]}return i.prototype.addColorStop=function(t,e){this.colorStops.push({offset:t,color:e})},i}();const jK=Txt;var Axt=function(i){xa(t,i);function t(e,r,n,o,s,a){var u=i.call(this,s)||this;return u.x=e??0,u.y=r??0,u.x2=n??1,u.y2=o??0,u.type="linear",u.global=a||!1,u}return t}(jK);const V0=Axt;var Ixt=function(i){xa(t,i);function t(e,r,n,o,s){var a=i.call(this,o)||this;return a.x=e??.5,a.y=r??.5,a.r=n??.5,a.type="radial",a.global=s||!1,a}return t}(jK);const WK=Ixt;var KL=Math.min,Mxt=Math.max,xA=Math.abs,fm=[0,0],pm=[0,0],es=mY(),bA=es.minTv,wA=es.maxTv,Cxt=function(){function i(t,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var r=0;r<4;r++)this._corners[r]=new er;for(var r=0;r<2;r++)this._axes[r]=new er;t&&this.fromBoundingRect(t,e)}return i.prototype.fromBoundingRect=function(t,e){var r=this._corners,n=this._axes,o=t.x,s=t.y,a=o+t.width,u=s+t.height;if(r[0].set(o,s),r[1].set(a,s),r[2].set(a,u),r[3].set(o,u),e)for(var f=0;f<4;f++)r[f].transform(e);er.sub(n[0],r[1],r[0]),er.sub(n[1],r[3],r[0]),n[0].normalize(),n[1].normalize();for(var f=0;f<2;f++)this._origin[f]=n[f].dot(r[0])},i.prototype.intersect=function(t,e,r){var n=!0,o=!e;return e&&er.set(e,0,0),es.reset(r,!o),!this._intersectCheckOneSide(this,t,o,1)&&(n=!1,o)||!this._intersectCheckOneSide(t,this,o,-1)&&(n=!1,o)||!o&&!es.negativeSize&&er.copy(e,n?es.useDir?es.dirMinTv:bA:wA),n},i.prototype._intersectCheckOneSide=function(t,e,r,n){for(var o=!0,s=0;s<2;s++){var a=t._axes[s];if(t._getProjMinMaxOnAxis(s,t._corners,fm),t._getProjMinMaxOnAxis(s,e._corners,pm),es.negativeSize||fm[1]<pm[0]||fm[0]>pm[1]){if(o=!1,es.negativeSize||r)return o;var u=xA(pm[0]-fm[1]),f=xA(fm[0]-pm[1]);KL(u,f)>wA.len()&&(u<f?er.scale(wA,a,-u*n):er.scale(wA,a,f*n))}else if(!r){var u=xA(pm[0]-fm[1]),f=xA(fm[0]-pm[1]);(es.useDir||KL(u,f)<bA.len())&&((u<f||!es.bidirectional)&&(er.scale(bA,a,u*n),es.useDir&&es.calcDirMTV()),(u>=f||!es.bidirectional)&&(er.scale(bA,a,-f*n),es.useDir&&es.calcDirMTV()))}}return o},i.prototype._getProjMinMaxOnAxis=function(t,e,r){for(var n=this._axes[t],o=this._origin,s=e[0].dot(n)+o[t],a=s,u=s,f=1;f<e.length;f++){var g=e[f].dot(n)+o[t];a=KL(g,a),u=Mxt(g,u)}r[0]=a+es.touchThreshold,r[1]=u-es.touchThreshold,es.negativeSize=r[1]<r[0]},i}();const $K=Cxt;var Ext=[],Dxt=function(i){xa(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return t.prototype.traverse=function(e,r){e.call(r,this)},t.prototype.useStyle=function(){this.style={}},t.prototype.getCursor=function(){return this._cursor},t.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},t.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},t.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},t.prototype.addDisplayable=function(e,r){r?this._temporaryDisplayables.push(e):this._displayables.push(e),this.markRedraw()},t.prototype.addDisplayables=function(e,r){r=r||!1;for(var n=0;n<e.length;n++)this.addDisplayable(e[n],r)},t.prototype.getDisplayables=function(){return this._displayables},t.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},t.prototype.eachPendingDisplayable=function(e){for(var r=this._cursor;r<this._displayables.length;r++)e&&e(this._displayables[r]);for(var r=0;r<this._temporaryDisplayables.length;r++)e&&e(this._temporaryDisplayables[r])},t.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var r=this._displayables[e];r.parent=this,r.update(),r.parent=null}for(var e=0;e<this._temporaryDisplayables.length;e++){var r=this._temporaryDisplayables[e];r.parent=this,r.update(),r.parent=null}},t.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new sr(1/0,1/0,-1/0,-1/0),r=0;r<this._displayables.length;r++){var n=this._displayables[r],o=n.getBoundingRect().clone();n.needLocalTransform()&&o.applyTransform(n.getLocalTransform(Ext)),e.union(o)}this._rect=e}return this._rect},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();if(o.contain(n[0],n[1]))for(var s=0;s<this._displayables.length;s++){var a=this._displayables[s];if(a.contain(e,r))return!0}return!1},t}(kc);const Pxt=Dxt;var ZK=Wr();function U0(i,t,e,r,n){var o;if(t&&t.ecModel){var s=t.ecModel.getUpdatePayload();o=s&&s.animation}var a=t&&t.isAnimationEnabled(),u=i==="update";if(a){var f=void 0,g=void 0,v=void 0;r?(f=Ui(r.duration,200),g=Ui(r.easing,"cubicOut"),v=0):(f=t.getShallow(u?"animationDurationUpdate":"animationDuration"),g=t.getShallow(u?"animationEasingUpdate":"animationEasing"),v=t.getShallow(u?"animationDelayUpdate":"animationDelay")),o&&(o.duration!=null&&(f=o.duration),o.easing!=null&&(g=o.easing),o.delay!=null&&(v=o.delay)),Xi(v)&&(v=v(e,n)),Xi(f)&&(f=f(e));var y={duration:f||0,delay:v,easing:g};return y}else return null}function GF(i,t,e,r,n,o,s){var a=!1,u;Xi(n)?(s=o,o=n,n=null):nr(n)&&(o=n.cb,s=n.during,a=n.isFrom,u=n.removeOpt,n=n.dataIndex);var f=i==="leave";f||t.stopAnimation("leave");var g=U0(i,r,n,f?u||{}:null,r&&r.getAnimationDelayParams?r.getAnimationDelayParams(t,n):null);if(g&&g.duration>0){var v=g.duration,y=g.delay,w=g.easing,I={duration:v,delay:y||0,easing:w,done:o,force:!!o||!!s,setToFinal:!f,scope:i,during:s};a?t.animateFrom(e,I):t.animateTo(e,I)}else t.stopAnimation(),!a&&t.attr(e),s&&s(1),o&&o()}function yn(i,t,e,r,n,o){GF("update",i,t,e,r,n,o)}function ya(i,t,e,r,n,o){GF("enter",i,t,e,r,n,o)}function l0(i){if(!i.__zr)return!0;for(var t=0;t<i.animators.length;t++){var e=i.animators[t];if(e.scope==="leave")return!0}return!1}function Pp(i,t,e,r,n,o){l0(i)||GF("leave",i,t,e,r,n,o)}function mj(i,t,e,r){i.removeTextContent(),i.removeTextGuideLine(),Pp(i,{style:{opacity:0}},t,e,r)}function Td(i,t,e){function r(){i.parent&&i.parent.remove(i)}i.isGroup?i.traverse(function(n){n.isGroup||mj(n,t,e,r)}):mj(i,t,e,r)}function Oc(i){ZK(i).oldStyle=i.style}function Lxt(i){return ZK(i).oldStyle}var nz={},vr=["x","y"],yo=["width","height"];function Rxt(i){return qr.extend(i)}var kxt=oxt;function Oxt(i,t){return kxt(i,t)}function yu(i,t){nz[i]=t}function BM(i){if(nz.hasOwnProperty(i))return nz[i]}function rS(i,t,e,r){var n=LK(i,t);return e&&(r==="center"&&(e=XK(e,n.getBoundingRect())),YK(n,e)),n}function qK(i,t,e){var r=new ys({style:{image:i,x:t.x,y:t.y,width:t.width,height:t.height},onload:function(n){if(e==="center"){var o={width:n.width,height:n.height};r.setStyle(XK(t,o))}}});return r}function XK(i,t){var e=t.width/t.height,r=i.height*e,n;r<=i.width?n=i.height:(r=i.width,n=r/e);var o=i.x+i.width/2,s=i.y+i.height/2;return{x:o-r/2,y:s-n/2,width:r,height:n}}var Mc=sxt;function YK(i,t){if(i.applyTransform){var e=i.getBoundingRect(),r=e.calculateTransform(t);i.applyTransform(r)}}function b0(i,t){return sE(i,i,{lineWidth:t}),i}function zxt(i,t){return pK(i,i,t),i}var $I=ec;function av(i,t){for(var e=JC([]);i&&i!==t;)fh(e,i.getLocalTransform(),e),i=i.parent;return e}function du(i,t,e){return t&&!Ns(t)&&(t=yd.getLocalTransform(t)),e&&(t=mu([],t)),ho([],i,t)}function fE(i,t,e){var r=t[4]===0||t[5]===0||t[0]===0?1:oh(2*t[4]/t[0]),n=t[4]===0||t[5]===0||t[2]===0?1:oh(2*t[4]/t[2]),o=[i==="left"?-r:i==="right"?r:0,i==="top"?-n:i==="bottom"?n:0];return o=du(o,t,e),oh(o[0])>oh(o[1])?o[0]>0?"right":"left":o[1]>0?"bottom":"top"}function vj(i){return!i.isGroup}function Bxt(i){return i.shape!=null}function zS(i,t,e){if(!i||!t)return;function r(s){var a={};return s.traverse(function(u){vj(u)&&u.anid&&(a[u.anid]=u)}),a}function n(s){var a={x:s.x,y:s.y,rotation:s.rotation};return Bxt(s)&&(a.shape=Yi(s.shape)),a}var o=r(i);t.traverse(function(s){if(vj(s)&&s.anid){var a=o[s.anid];if(a){var u=n(s);s.attr(n(a)),yn(s,u,e,ur(s).dataIndex)}}})}function KK(i,t){return ti(i,function(e){var r=e[0];r=co(r,t.x),r=rc(r,t.x+t.width);var n=e[1];return n=co(n,t.y),n=rc(n,t.y+t.height),[r,n]})}function Fxt(i,t){var e=co(i.x,t.x),r=rc(i.x+i.width,t.x+t.width),n=co(i.y,t.y),o=rc(i.y+i.height,t.y+t.height);if(r>=e&&o>=n)return{x:e,y:n,width:r-e,height:o-n}}function BS(i,t,e){var r=Fe({rectHover:!0},t),n=r.style={strokeNoScale:!0};if(e=e||{x:-1,y:-1,width:2,height:2},i)return i.indexOf("image://")===0?(n.image=i.slice(8),rr(n,e),new ys(r)):rS(i.replace("path://",""),r,e,"center")}function tw(i,t,e,r,n){for(var o=0,s=n[n.length-1];o<n.length;o++){var a=n[o];if(JK(i,t,e,r,a[0],a[1],s[0],s[1]))return!0;s=a}}function JK(i,t,e,r,n,o,s,a){var u=e-i,f=r-t,g=s-n,v=a-o,y=JL(g,v,u,f);if(Nxt(y))return!1;var w=i-n,I=t-o,E=JL(w,I,u,f)/y;if(E<0||E>1)return!1;var D=JL(w,I,g,v)/y;return!(D<0||D>1)}function JL(i,t,e,r){return i*r-e*t}function Nxt(i){return i<=1e-6&&i>=-1e-6}function mv(i,t,e,r,n){return t==null||(fn(t)?La[0]=La[1]=La[2]=La[3]=t:(La[0]=t[0],La[1]=t[1],La[2]=t[2],La[3]=t[3]),r&&(La[0]=co(0,La[0]),La[1]=co(0,La[1]),La[2]=co(0,La[2]),La[3]=co(0,La[3])),e&&(La[0]=-La[0],La[1]=-La[1],La[2]=-La[2],La[3]=-La[3]),_j(i,La,"x","width",3,1,n&&n[0]||0),_j(i,La,"y","height",0,2,n&&n[1]||0)),i}var La=[0,0,0,0];function _j(i,t,e,r,n,o,s){var a=t[o]+t[n],u=i[r];i[r]+=a,s=co(0,rc(s,u)),i[r]<s?(i[r]=s,i[e]+=t[n]>=0?-t[n]:t[o]>=0?u+t[o]:oh(a)>1e-8?(u-s)*t[n]/a:0):i[e]-=t[n]}function Gd(i){var t=i.itemTooltipOption,e=i.componentModel,r=i.itemName,n=bi(t)?{formatter:t}:t,o=e.mainType,s=e.componentIndex,a={componentType:o,name:r,$vars:["name"]};a[o+"Index"]=s;var u=i.formatterParamsExtra;u&&gt(on(u),function(g){Di(a,g)||(a[g]=u[g],a.$vars.push(g))});var f=ur(i.el);f.componentMainType=o,f.componentIndex=s,f.tooltipConfig={name:r,option:rr({content:r,encodeHTMLContent:!0,formatterParams:a},n)}}function az(i,t){var e;i.isGroup&&(e=t(i)),e||i.traverse(t)}function Hp(i,t){if(i)if(Ye(i))for(var e=0;e<i.length;e++)az(i[e],t);else az(i,t)}function HF(i){return!i||oh(i[1])<SA&&oh(i[2])<SA||oh(i[0])<SA&&oh(i[3])<SA}var SA=1e-5;function nS(i,t){return i?sr.copy(i,t):t.clone()}function jF(i,t){return t?QC(i||ns(),t):void 0}function vv(i){return{z:i.get("z")||0,zlevel:i.get("zlevel")||0}}function QK(i){var t=-1/0,e=1/0;az(i,function(o){r(o),r(o.getTextContent()),r(o.getTextGuideLine())});function r(o){if(!(!o||o.isGroup)){var s=o.currentStates;if(s.length)for(var a=0;a<s.length;a++)n(o.states[s[a]]);n(o)}}function n(o){if(o){var s=o.z2;s>t&&(t=s),s<e&&(e=s)}}return e>t&&(e=t=0),{min:e,max:t}}function pE(i,t,e){tJ(i,t,e,-1/0)}function tJ(i,t,e,r){if(i.ignoreModelZ)return r;var n=i.getTextContent(),o=i.getTextGuideLine(),s=i.isGroup;if(s)for(var a=i.childrenRef(),u=0;u<a.length;u++)r=co(tJ(a[u],t,e,r),r);else i.z=t,i.zlevel=e,r=co(i.z2||0,r);if(n&&(n.z=t,n.zlevel=e,isFinite(r)&&(n.z2=r+2)),o){var f=i.textGuideLineConfig;o.z=t,o.zlevel=e,isFinite(r)&&(o.z2=r+(f&&f.showAbove?1:-1))}return r}yu("circle",Gp);yu("ellipse",VF);yu("sector",pl);yu("ring",uE);yu("polygon",gl);yu("polyline",Us);yu("rect",jr);yu("line",Ro);yu("bezierCurve",hE);yu("arc",UF);const Tv=Object.freeze(Object.defineProperty({__proto__:null,Arc:UF,BezierCurve:hE,BoundingRect:sr,Circle:Gp,CompoundPath:dE,Ellipse:VF,Group:Ki,Image:ys,IncrementalDisplayable:Pxt,Line:Ro,LinearGradient:V0,OrientedBoundingRect:$K,Path:qr,Point:er,Polygon:gl,Polyline:Us,RadialGradient:WK,Rect:jr,Ring:uE,Sector:pl,Text:_n,WH:yo,XY:vr,applyTransform:du,calcZ2Range:QK,clipPointsByRect:KK,clipRectByRect:Fxt,createIcon:BS,ensureCopyRect:nS,ensureCopyTransform:jF,expandOrShrinkRect:mv,extendPath:Oxt,extendShape:Rxt,getShapeClass:BM,getTransform:av,groupTransition:zS,initProps:ya,isBoundingRectAxisAligned:HF,isElementRemoved:l0,lineLineIntersect:JK,linePolygonIntersect:tw,makeImage:qK,makePath:rS,mergePath:Mc,registerShape:yu,removeElement:Pp,removeElementWithFadeOut:Td,resizePath:YK,retrieveZInfo:vv,setTooltipConfig:Gd,subPixelOptimize:$I,subPixelOptimizeLine:b0,subPixelOptimizeRect:zxt,transformDirection:fE,traverseElements:Hp,traverseUpdateZ:pE,updateProps:yn},Symbol.toStringTag,{value:"Module"}));var gE={};function eJ(i,t){for(var e=0;e<fl.length;e++){var r=fl[e],n=t[r],o=i.ensureState(r);o.style=o.style||{},o.style.text=n}var s=i.currentStates.slice();i.clearStates(!0),i.setStyle({text:t.normal}),i.useStates(s,!0)}function oz(i,t,e){var r=i.labelFetcher,n=i.labelDataIndex,o=i.labelDimIndex,s=t.normal,a;r&&(a=r.getFormattedLabel(n,"normal",null,o,s&&s.get("formatter"),e!=null?{interpolatedValue:e}:null)),a==null&&(a=Xi(i.defaultText)?i.defaultText(n,i,e):i.defaultText);for(var u={normal:a},f=0;f<fl.length;f++){var g=fl[f],v=t[g];u[g]=Ui(r?r.getFormattedLabel(n,g,null,o,v&&v.get("formatter")):null,a)}return u}function qo(i,t,e,r){e=e||gE;for(var n=i instanceof _n,o=!1,s=0;s<eS.length;s++){var a=t[eS[s]];if(a&&a.getShallow("show")){o=!0;break}}var u=n?i:i.getTextContent();if(o){n||(u||(u=new _n,i.setTextContent(u)),i.stateProxy&&(u.stateProxy=i.stateProxy));var f=oz(e,t),g=t.normal,v=!!g.getShallow("show"),y=fa(g,r&&r.normal,e,!1,!n);y.text=f.normal,n||i.setTextConfig(FM(g,e,!1));for(var s=0;s<fl.length;s++){var w=fl[s],a=t[w];if(a){var I=u.ensureState(w),E=!!Ui(a.getShallow("show"),v);if(E!==v&&(I.ignore=!E),I.style=fa(a,r&&r[w],e,!0,!n),I.style.text=f[w],!n){var D=i.ensureState(w);D.textConfig=FM(a,e,!0)}}}u.silent=!!g.getShallow("silent"),u.style.x!=null&&(y.x=u.style.x),u.style.y!=null&&(y.y=u.style.y),u.ignore=!v,u.useStyle(y),u.dirty(),e.enableTextSetter&&(G0(u).setLabelText=function(R){var z=oz(e,t,R);eJ(u,z)})}else u&&(u.ignore=!0);i.dirty()}function zo(i,t){t=t||"label";for(var e={normal:i.getModel(t)},r=0;r<fl.length;r++){var n=fl[r];e[n]=i.getModel([n,t])}return e}function fa(i,t,e,r,n){var o={};return Vxt(o,i,e,r,n),t&&Fe(o,t),o}function FM(i,t,e){t=t||{};var r={},n,o=i.getShallow("rotate"),s=Ui(i.getShallow("distance"),e?null:5),a=i.getShallow("offset");return n=i.getShallow("position")||(e?null:"inside"),n==="outside"&&(n=t.defaultOutsidePosition||"top"),n!=null&&(r.position=n),a!=null&&(r.offset=a),o!=null&&(o*=Math.PI/180,r.rotation=o),s!=null&&(r.distance=s),r.outsideFill=i.get("color")==="inherit"?t.inheritColor||null:"auto",t.autoOverflowArea!=null&&(r.autoOverflowArea=t.autoOverflowArea),t.layoutRect!=null&&(r.layoutRect=t.layoutRect),r}function Vxt(i,t,e,r,n){e=e||gE;var o=t.ecModel,s=o&&o.option.textStyle,a=Uxt(t),u;if(a){u={};var f="richInheritPlainLabel",g=Ui(t.get(f),o?o.get(f):void 0);for(var v in a)if(a.hasOwnProperty(v)){var y=t.getModel(["rich",v]);wj(u[v]={},y,s,t,g,e,r,n,!1,!0)}}u&&(i.rich=u);var w=t.get("overflow");w&&(i.overflow=w);var I=t.get("lineOverflow");I&&(i.lineOverflow=I);var E=i,D=t.get("minMargin");if(D!=null)D=fn(D)?D/2:0,E.margin=[D,D,D,D],E.__marginType=Xy.minMargin;else{var R=t.get("textMargin");R!=null&&(E.margin=YC(R),E.__marginType=Xy.textMargin)}wj(i,t,s,null,null,e,r,n,!0,!1)}function Uxt(i){for(var t;i&&i!==i.ecModel;){var e=(i.option||gE).rich;if(e){t=t||{};for(var r=on(e),n=0;n<r.length;n++){var o=r[n];t[o]=1}}i=i.parentModel}return t}var yj=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],xj=["align","lineHeight","width","height","tag","verticalAlign","ellipsis"],bj=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function wj(i,t,e,r,n,o,s,a,u,f){e=!s&&e||gE;var g=o&&o.inheritColor,v=t.getShallow("color"),y=t.getShallow("textBorderColor"),w=Ui(t.getShallow("opacity"),e.opacity);(v==="inherit"||v==="auto")&&(g?v=g:v=null),(y==="inherit"||y==="auto")&&(g?y=g:y=null),a||(v=v||e.color,y=y||e.textBorderColor),v!=null&&(i.fill=v),y!=null&&(i.stroke=y);var I=Ui(t.getShallow("textBorderWidth"),e.textBorderWidth);I!=null&&(i.lineWidth=I);var E=Ui(t.getShallow("textBorderType"),e.textBorderType);E!=null&&(i.lineDash=E);var D=Ui(t.getShallow("textBorderDashOffset"),e.textBorderDashOffset);D!=null&&(i.lineDashOffset=D),!s&&w==null&&!f&&(w=o&&o.defaultOpacity),w!=null&&(i.opacity=w),!s&&!a&&i.fill==null&&o.inheritColor&&(i.fill=o.inheritColor);for(var R=0;R<yj.length;R++){var z=yj[R],N=n!==!1&&r?ic(t.getShallow(z),r.getShallow(z),e[z]):Ui(t.getShallow(z),e[z]);N!=null&&(i[z]=N)}for(var R=0;R<xj.length;R++){var z=xj[R],N=t.getShallow(z);N!=null&&(i[z]=N)}if(i.verticalAlign==null){var H=t.getShallow("baseline");H!=null&&(i.verticalAlign=H)}if(!u||!o.disableBox){for(var R=0;R<bj.length;R++){var z=bj[R],N=t.getShallow(z);N!=null&&(i[z]=N)}var $=t.getShallow("borderType");$!=null&&(i.borderDash=$),(i.backgroundColor==="auto"||i.backgroundColor==="inherit")&&g&&(i.backgroundColor=g),(i.borderColor==="auto"||i.borderColor==="inherit")&&g&&(i.borderColor=g)}}function WF(i,t){var e=t&&t.getModel("textStyle");return Ec([i.fontStyle||e&&e.getShallow("fontStyle")||"",i.fontWeight||e&&e.getShallow("fontWeight")||"",(i.fontSize||e&&e.getShallow("fontSize")||12)+"px",i.fontFamily||e&&e.getShallow("fontFamily")||"sans-serif"].join(" "))}var G0=Wr();function iJ(i,t,e,r){if(i){var n=G0(i);n.prevValue=n.value,n.value=e;var o=t.normal;n.valueAnimation=o.get("valueAnimation"),n.valueAnimation&&(n.precision=o.get("precision"),n.defaultInterpolatedText=r,n.statesModels=t)}}function rJ(i,t,e,r,n){var o=G0(i);if(!o.valueAnimation||o.prevValue===o.value)return;var s=o.defaultInterpolatedText,a=Ui(o.interpolatedValue,o.prevValue),u=o.value;function f(g){var v=rK(e,o.precision,a,u,g);o.interpolatedValue=g===1?null:v;var y=oz({labelDataIndex:t,labelFetcher:n,defaultText:s?s(v):v+""},o.statesModels,v);eJ(i,y)}i.percent=0,(o.prevValue==null?ya:yn)(i,{percent:1},r,t,null,f)}var Xy={minMargin:1,textMargin:2},Gxt=["textStyle","color"],QL=["fontStyle","fontWeight","fontSize","fontFamily","padding","lineHeight","rich","width","height","overflow"],tR=new _n,Hxt=function(){function i(){}return i.prototype.getTextColor=function(t){var e=this.ecModel;return this.getShallow("color")||(!t&&e?e.get(Gxt):null)},i.prototype.getFont=function(){return WF({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},i.prototype.getTextRect=function(t){for(var e={text:t,verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline")},r=0;r<QL.length;r++)e[QL[r]]=this.getShallow(QL[r]);return tR.useStyle(e),tR.update(),tR.getBoundingRect()},i}();const jxt=Hxt;var nJ=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]],Wxt=pv(nJ),$xt=function(){function i(){}return i.prototype.getLineStyle=function(t){return Wxt(this,t)},i}(),aJ=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]],Zxt=pv(aJ),qxt=function(){function i(){}return i.prototype.getItemStyle=function(t,e){return Zxt(this,t,e)},i}(),Av=function(){function i(t,e,r){this.parentModel=e,this.ecModel=r,this.option=t}return i.prototype.init=function(t,e,r){},i.prototype.mergeOption=function(t,e){Er(this.option,t,!0)},i.prototype.get=function(t,e){return t==null?this.option:this._doGet(this.parsePath(t),!e&&this.parentModel)},i.prototype.getShallow=function(t,e){var r=this.option,n=r==null?r:r[t];if(n==null&&!e){var o=this.parentModel;o&&(n=o.getShallow(t))}return n},i.prototype.getModel=function(t,e){var r=t!=null,n=r?this.parsePath(t):null,o=r?this._doGet(n):this.option;return e=e||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(n)),new i(o,e,this.ecModel)},i.prototype.isEmpty=function(){return this.option==null},i.prototype.restoreData=function(){},i.prototype.clone=function(){var t=this.constructor;return new t(Yi(this.option))},i.prototype.parsePath=function(t){return typeof t=="string"?t.split("."):t},i.prototype.resolveParentPath=function(t){return t},i.prototype.isAnimationEnabled=function(){if(!Sn.node&&this.option){if(this.option.animation!=null)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}},i.prototype._doGet=function(t,e){var r=this.option;if(!t)return r;for(var n=0;n<t.length&&!(t[n]&&(r=r&&typeof r=="object"?r[t[n]]:null,r==null));n++);return r==null&&e&&(r=e._doGet(this.resolveParentPath(t),e.parentModel)),r},i}();DF(Av);$yt(Av);wo(Av,$xt);wo(Av,qxt);wo(Av,Kyt);wo(Av,jxt);const bn=Av;var Xxt=Math.round(Math.random()*10);function H0(i){return[i||"",Xxt++].join("_")}function Yxt(i){var t={};i.registerSubTypeDefaulter=function(e,r){var n=lh(e);t[n.main]=r},i.determineSubType=function(e,r){var n=r.type;if(!n){var o=lh(e).main;i.hasSubTypes(e)&&t[o]&&(n=t[o](r))}return n}}function Kxt(i,t){i.topologicalTravel=function(o,s,a,u){if(!o.length)return;var f=e(s),g=f.graph,v=f.noEntryList,y={};for(gt(o,function(z){y[z]=!0});v.length;){var w=v.pop(),I=g[w],E=!!y[w];E&&(a.call(u,w,I.originalDeps.slice()),delete y[w]),gt(I.successor,E?R:D)}gt(y,function(){var z="";throw new Error(z)});function D(z){g[z].entryCount--,g[z].entryCount===0&&v.push(z)}function R(z){y[z]=!0,D(z)}};function e(o){var s={},a=[];return gt(o,function(u){var f=r(s,u),g=f.originalDeps=t(u),v=n(g,o);f.entryCount=v.length,f.entryCount===0&&a.push(u),gt(v,function(y){Ar(f.predecessor,y)<0&&f.predecessor.push(y);var w=r(s,y);Ar(w.successor,y)<0&&w.successor.push(u)})}),{graph:s,noEntryList:a}}function r(o,s){return o[s]||(o[s]={predecessor:[],successor:[]}),o[s]}function n(o,s){var a=[];return gt(o,function(u){Ar(s,u)>=0&&a.push(u)}),a}}function jp(i,t){return Er(Er({},i,!0),t,!0)}const Jxt={time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst",custom:"Custom chart",chart:"Chart"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}},Qxt={time:{month:["","","","","","","","","","","",""],monthAbbr:["1","2","3","4","5","6","7","8","9","10","11","12"],dayOfWeek:["","","","","","",""],dayOfWeekAbbr:["","","","","","",""]},legend:{selector:{all:"",inverse:""}},toolbox:{brush:{title:{rect:"",polygon:"",lineX:"",lineY:"",keep:"",clear:""}},dataView:{title:"",lang:["","",""]},dataZoom:{title:{zoom:"",back:""}},magicType:{title:{line:"",bar:"",stack:"",tiled:""}},restore:{title:""},saveAsImage:{title:"",lang:[""]}},series:{typeNames:{pie:"",bar:"",line:"",scatter:"",effectScatter:"",radar:"",tree:"",treemap:"",boxplot:"",candlestick:"K",k:"K",heatmap:"",map:"",parallel:"",lines:"",graph:"",sankey:"",funnel:"",gauge:"",pictorialBar:"",themeRiver:"",sunburst:"",custom:"",chart:""}},aria:{general:{withTitle:"{title}",withoutTitle:""},series:{single:{prefix:"",withName:"{seriesType}{seriesName}",withoutName:"{seriesType}"},multiple:{prefix:"{seriesCount}",withName:"{seriesId}{seriesName}{seriesType}",withoutName:"{seriesId}{seriesType}",separator:{middle:"",end:""}}},data:{allData:"",partialData:"{displayCnt}",withName:"{name}{value}",withoutName:"{value}",separator:{middle:"",end:""}}}};var NM="ZH",$F="EN",c0=$F,ZI={},ZF={},oJ=Sn.domSupported?function(){var i=(document.documentElement.lang||navigator.language||navigator.browserLanguage||c0).toUpperCase();return i.indexOf(NM)>-1?NM:c0}():c0;function sJ(i,t){i=i.toUpperCase(),ZF[i]=new bn(t),ZI[i]=t}function t1t(i){if(bi(i)){var t=ZI[i.toUpperCase()]||{};return i===NM||i===$F?Yi(t):Er(Yi(t),Yi(ZI[c0]),!1)}else return Er(Yi(i),Yi(ZI[c0]),!1)}function sz(i){return ZF[i]}function e1t(){return ZF[c0]}sJ($F,Jxt);sJ(NM,Qxt);var lz=null;function i1t(i){lz||(lz=i)}function _o(){return lz}var qF=1e3,XF=qF*60,Mw=XF*60,Cc=Mw*24,Sj=Cc*365,r1t={year:/({yyyy}|{yy})/,month:/({MMMM}|{MMM}|{MM}|{M})/,day:/({dd}|{d})/,hour:/({HH}|{H}|{hh}|{h})/,minute:/({mm}|{m})/,second:/({ss}|{s})/,millisecond:/({SSS}|{S})/},qI={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{HH}:{mm}:{ss} {SSS}"},n1t="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss} {SSS}",TA="{yyyy}-{MM}-{dd}",Tj={year:"{yyyy}",month:"{yyyy}-{MM}",day:TA,hour:TA+" "+qI.hour,minute:TA+" "+qI.minute,second:TA+" "+qI.second,millisecond:n1t},Zl=["year","month","day","hour","minute","second","millisecond"],a1t=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function o1t(i){return!bi(i)&&!Xi(i)?s1t(i):i}function s1t(i){i=i||{};var t={},e=!0;return gt(Zl,function(r){e&&(e=i[r]==null)}),gt(Zl,function(r,n){var o=i[r];t[r]={};for(var s=null,a=n;a>=0;a--){var u=Zl[a],f=nr(o)&&!Ye(o)?o[u]:o,g=void 0;Ye(f)?(g=f.slice(),s=g[0]||""):bi(f)?(s=f,g=[s]):(s==null?s=qI[r]:r1t[u].test(s)||(s=t[u][u][0]+" "+s),g=[s],e&&(g[1]="{primary|"+s+"}")),t[r][u]=g}}),t}function Vf(i,t){return i+="","0000".substr(0,t-i.length)+i}function Cw(i){switch(i){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return i}}function l1t(i){return i===Cw(i)}function c1t(i){switch(i){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}function mE(i,t,e,r){var n=Sv(i),o=n[lJ(e)](),s=n[YF(e)]()+1,a=Math.floor((s-1)/3)+1,u=n[KF(e)](),f=n["get"+(e?"UTC":"")+"Day"](),g=n[JF(e)](),v=(g-1)%12+1,y=n[QF(e)](),w=n[t3(e)](),I=n[e3(e)](),E=g>=12?"pm":"am",D=E.toUpperCase(),R=r instanceof bn?r:sz(r||oJ)||e1t(),z=R.getModel("time"),N=z.get("month"),H=z.get("monthAbbr"),$=z.get("dayOfWeek"),X=z.get("dayOfWeekAbbr");return(t||"").replace(/{a}/g,E+"").replace(/{A}/g,D+"").replace(/{yyyy}/g,o+"").replace(/{yy}/g,Vf(o%100+"",2)).replace(/{Q}/g,a+"").replace(/{MMMM}/g,N[s-1]).replace(/{MMM}/g,H[s-1]).replace(/{MM}/g,Vf(s,2)).replace(/{M}/g,s+"").replace(/{dd}/g,Vf(u,2)).replace(/{d}/g,u+"").replace(/{eeee}/g,$[f]).replace(/{ee}/g,X[f]).replace(/{e}/g,f+"").replace(/{HH}/g,Vf(g,2)).replace(/{H}/g,g+"").replace(/{hh}/g,Vf(v+"",2)).replace(/{h}/g,v+"").replace(/{mm}/g,Vf(y,2)).replace(/{m}/g,y+"").replace(/{ss}/g,Vf(w,2)).replace(/{s}/g,w+"").replace(/{SSS}/g,Vf(I,3)).replace(/{S}/g,I+"")}function u1t(i,t,e,r,n){var o=null;if(bi(e))o=e;else if(Xi(e)){var s={time:i.time,level:i.time.level},a=_o();a&&a.makeAxisLabelFormatterParamBreak(s,i.break),o=e(i.value,t,s)}else{var u=i.time;if(u){var f=e[u.lowerTimeUnit][u.upperTimeUnit];o=f[Math.min(u.level,f.length-1)]||""}else{var g=Yy(i.value,n);o=e[g][g][0]}}return mE(new Date(i.value),o,n,r)}function Yy(i,t){var e=Sv(i),r=e[YF(t)]()+1,n=e[KF(t)](),o=e[JF(t)](),s=e[QF(t)](),a=e[t3(t)](),u=e[e3(t)](),f=u===0,g=f&&a===0,v=g&&s===0,y=v&&o===0,w=y&&n===1,I=w&&r===1;return I?"year":w?"month":y?"day":v?"hour":g?"minute":f?"second":"millisecond"}function cz(i,t,e){switch(t){case"year":i[cJ(e)](0);case"month":i[uJ(e)](1);case"day":i[hJ(e)](0);case"hour":i[dJ(e)](0);case"minute":i[fJ(e)](0);case"second":i[pJ(e)](0)}return i}function lJ(i){return i?"getUTCFullYear":"getFullYear"}function YF(i){return i?"getUTCMonth":"getMonth"}function KF(i){return i?"getUTCDate":"getDate"}function JF(i){return i?"getUTCHours":"getHours"}function QF(i){return i?"getUTCMinutes":"getMinutes"}function t3(i){return i?"getUTCSeconds":"getSeconds"}function e3(i){return i?"getUTCMilliseconds":"getMilliseconds"}function h1t(i){return i?"setUTCFullYear":"setFullYear"}function cJ(i){return i?"setUTCMonth":"setMonth"}function uJ(i){return i?"setUTCDate":"setDate"}function hJ(i){return i?"setUTCHours":"setHours"}function dJ(i){return i?"setUTCMinutes":"setMinutes"}function fJ(i){return i?"setUTCSeconds":"setSeconds"}function pJ(i){return i?"setUTCMilliseconds":"setMilliseconds"}function gJ(i){if(!XY(i))return bi(i)?i:"-";var t=(i+"").split(".");return t[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(t.length>1?"."+t[1]:"")}function mJ(i,t){return i=(i||"").toLowerCase().replace(/-(.)/g,function(e,r){return r.toUpperCase()}),t&&i&&(i=i.charAt(0).toUpperCase()+i.slice(1)),i}var FS=YC;function uz(i,t,e){var r="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}";function n(g){return g&&Ec(g)?g:"-"}function o(g){return!!(g!=null&&!isNaN(g)&&isFinite(g))}var s=t==="time",a=i instanceof Date;if(s||a){var u=s?Sv(i):i;if(isNaN(+u)){if(a)return"-"}else return mE(u,r,e)}if(t==="ordinal")return yO(i)?n(i):fn(i)&&o(i)?i+"":"-";var f=Ld(i);return o(f)?gJ(f):yO(i)?n(i):typeof i=="boolean"?i+"":"-"}var Aj=["a","b","c","d","e","f","g"],eR=function(i,t){return"{"+i+(t??"")+"}"};function vJ(i,t,e){Ye(t)||(t=[t]);var r=t.length;if(!r)return"";for(var n=t[0].$vars||[],o=0;o<n.length;o++){var s=Aj[o];i=i.replace(eR(s),eR(s,0))}for(var a=0;a<r;a++)for(var u=0;u<n.length;u++){var f=t[a][n[u]];i=i.replace(eR(Aj[u],a),e?Rs(f):f)}return i}function d1t(i,t,e){return gt(t,function(r,n){i=i.replace("{"+n+"}",e?Rs(r):r)}),i}function f1t(i,t){var e=bi(i)?{color:i,extraCssText:t}:i||{},r=e.color,n=e.type;t=e.extraCssText;var o=e.renderMode||"html";if(!r)return"";if(o==="html")return n==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+Rs(r)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+Rs(r)+";"+(t||"")+'"></span>';var s=e.markerId||"markerX";return{renderMode:o,content:"{"+s+"|}  ",style:n==="subItem"?{width:4,height:4,borderRadius:2,backgroundColor:r}:{width:10,height:10,borderRadius:5,backgroundColor:r}}}function _v(i,t){return t=t||"transparent",bi(i)?i:nr(i)&&i.colorStops&&(i.colorStops[0]||{}).color||t}function VM(i,t){if(t==="_blank"||t==="blank"){var e=window.open();e.opener=null,e.location.href=i}else window.open(i,t)}var XI={},iR={},NS=function(){function i(){this._normalMasterList=[],this._nonSeriesBoxMasterList=[]}return i.prototype.create=function(t,e){this._nonSeriesBoxMasterList=r(XI),this._normalMasterList=r(iR);function r(n,o){var s=[];return gt(n,function(a,u){var f=a.create(t,e);s=s.concat(f||[])}),s}},i.prototype.update=function(t,e){gt(this._normalMasterList,function(r){r.update&&r.update(t,e)})},i.prototype.getCoordinateSystems=function(){return this._normalMasterList.concat(this._nonSeriesBoxMasterList)},i.register=function(t,e){if(t==="matrix"||t==="calendar"){XI[t]=e;return}iR[t]=e},i.get=function(t){return iR[t]||XI[t]},i}();function p1t(i){return!!XI[i]}var hz={coord:1,coord2:2};function g1t(i){_J.set(i.fullType,{getCoord2:void 0}).getCoord2=i.getCoord2}var _J=Fi();function m1t(i){var t=i.getShallow("coord",!0),e=hz.coord;if(t==null){var r=_J.get(i.type);r&&r.getCoord2&&(e=hz.coord2,t=r.getCoord2(i))}return{coord:t,from:e}}var nh={none:0,dataCoordSys:1,boxCoordSys:2};function yJ(i,t){var e=i.getShallow("coordinateSystem"),r=i.getShallow("coordinateSystemUsage",!0),n=nh.none;if(e){var o=i.mainType==="series";r==null&&(r=o?"data":"box"),r==="data"?(n=nh.dataCoordSys,o||(n=nh.none)):r==="box"&&(n=nh.boxCoordSys,!o&&!p1t(e)&&(n=nh.none))}return{coordSysType:e,kind:n}}function VS(i){var t=i.targetModel,e=i.coordSysType,r=i.coordSysProvider,n=i.isDefaultDataCoordSys;i.allowNotFound;var o=yJ(t),s=o.kind,a=o.coordSysType;if(n&&s!==nh.dataCoordSys&&(s=nh.dataCoordSys,a=e),s===nh.none||a!==e)return!1;var u=r(e,t);return u?(s===nh.dataCoordSys?t.coordinateSystem=u:t.boxCoordinateSystem=u,!0):!1}var xJ=function(i,t){var e=t.getReferringComponents(i,Wa).models[0];return e&&e.coordinateSystem},YI=gt,bJ=["left","right","top","bottom","width","height"],jm=[["width","left","right"],["height","top","bottom"]];function i3(i,t,e,r,n){var o=0,s=0;r==null&&(r=1/0),n==null&&(n=1/0);var a=0;t.eachChild(function(u,f){var g=u.getBoundingRect(),v=t.childAt(f+1),y=v&&v.getBoundingRect(),w,I;if(i==="horizontal"){var E=g.width+(y?-y.x+g.x:0);w=o+E,w>r||u.newline?(o=0,w=E,s+=a+e,a=g.height):a=Math.max(a,g.height)}else{var D=g.height+(y?-y.y+g.y:0);I=s+D,I>n||u.newline?(o+=a+e,s=0,I=D,a=g.width):a=Math.max(a,g.width)}u.newline||(u.x=o,u.y=s,u.markRedraw(),i==="horizontal"?o=w+e:s=I+e)})}var ov=i3;br(i3,"vertical");br(i3,"horizontal");function wJ(i,t){return{left:i.getShallow("left",t),top:i.getShallow("top",t),right:i.getShallow("right",t),bottom:i.getShallow("bottom",t),width:i.getShallow("width",t),height:i.getShallow("height",t)}}function v1t(i,t){var e=Bo(i,t,{enableLayoutOnlyByCenter:!0}),r=i.getBoxLayoutParams(),n,o;if(e.type===ew.point)o=e.refPoint,n=Ca(r,{width:t.getWidth(),height:t.getHeight()});else{var s=i.get("center"),a=Ye(s)?s:[s,s];n=Ca(r,e.refContainer),o=e.boxCoordFrom===hz.coord2?e.refPoint:[xi(a[0],n.width)+n.x,xi(a[1],n.height)+n.y]}return{viewRect:n,center:o}}function SJ(i,t){var e=v1t(i,t),r=e.viewRect,n=e.center,o=i.get("radius");Ye(o)||(o=[0,o]);var s=xi(r.width,t.getWidth()),a=xi(r.height,t.getHeight()),u=Math.min(s,a),f=xi(o[0],u/2),g=xi(o[1],u/2);return{cx:n[0],cy:n[1],r0:f,r:g,viewRect:r}}function Ca(i,t,e){e=FS(e||0);var r=t.width,n=t.height,o=xi(i.left,r),s=xi(i.top,n),a=xi(i.right,r),u=xi(i.bottom,n),f=xi(i.width,r),g=xi(i.height,n),v=e[2]+e[0],y=e[1]+e[3],w=i.aspect;switch(isNaN(f)&&(f=r-a-y-o),isNaN(g)&&(g=n-u-v-s),w!=null&&(isNaN(f)&&isNaN(g)&&(w>r/n?f=r*.8:g=n*.8),isNaN(f)&&(f=w*g),isNaN(g)&&(g=f/w)),isNaN(o)&&(o=r-a-f-y),isNaN(s)&&(s=n-u-g-v),i.left||i.right){case"center":o=r/2-f/2-e[3];break;case"right":o=r-f-y;break}switch(i.top||i.bottom){case"middle":case"center":s=n/2-g/2-e[0];break;case"bottom":s=n-g-v;break}o=o||0,s=s||0,isNaN(f)&&(f=r-y-o-(a||0)),isNaN(g)&&(g=n-v-s-(u||0));var I=new sr((t.x||0)+o+e[3],(t.y||0)+s+e[0],f,g);return I.margin=e,I}function TJ(i,t,e){var r=i.getShallow("preserveAspect",!0);if(!r)return t;var n=t.width/t.height;if(Math.abs(Math.atan(e)-Math.atan(n))<1e-9)return t;var o=i.getShallow("preserveAspectAlign",!0),s=i.getShallow("preserveAspectVerticalAlign",!0),a={width:t.width,height:t.height},u=r==="cover";return n>e&&!u||n<e&&u?(a.width=t.height*e,o==="left"?a.left=0:o==="right"?a.right=0:a.left="center"):(a.height=t.width/e,s==="top"?a.top=0:s==="bottom"?a.bottom=0:a.top="middle"),Ca(a,t)}var ew={rect:1,point:2};function Bo(i,t,e){var r,n,o,s=i.boxCoordinateSystem,a;if(s){var u=m1t(i),f=u.coord,g=u.from;if(s.dataToLayout){o=ew.rect,a=g;var v=s.dataToLayout(f);r=v.contentRect||v.rect}else e&&e.enableLayoutOnlyByCenter&&s.dataToPoint&&(o=ew.point,a=g,n=s.dataToPoint(f))}return o==null&&(o=ew.rect),o===ew.rect&&(r||(r={x:0,y:0,width:t.getWidth(),height:t.getHeight()}),n=[r.x+r.width/2,r.y+r.height/2]),{type:o,refContainer:r,refPoint:n,boxCoordFrom:a}}function vE(i,t,e,r,n,o){var s=!n||!n.hv||n.hv[0],a=!n||!n.hv||n.hv[1],u=n&&n.boundingMode||"all";if(o=o||i,o.x=i.x,o.y=i.y,!s&&!a)return!1;var f;if(u==="raw")f=i.type==="group"?new sr(0,0,+t.width||0,+t.height||0):i.getBoundingRect();else if(f=i.getBoundingRect(),i.needLocalTransform()){var g=i.getLocalTransform();f=f.clone(),f.applyTransform(g)}var v=Ca(rr({width:f.width,height:f.height},t),e,r),y=s?v.x-f.x:0,w=a?v.y-f.y:0;return u==="raw"?(o.x=y,o.y=w):(o.x+=y,o.y+=w),o===i&&i.markRedraw(),!0}function _1t(i,t){return i[jm[t][0]]!=null||i[jm[t][1]]!=null&&i[jm[t][2]]!=null}function aS(i){var t=i.layoutMode||i.constructor.layoutMode;return nr(t)?t:t?{type:t}:null}function Sh(i,t,e){var r=e&&e.ignoreSize;!Ye(r)&&(r=[r,r]);var n=s(jm[0],0),o=s(jm[1],1);u(jm[0],i,n),u(jm[1],i,o);function s(f,g){var v={},y=0,w={},I=0,E=2;if(YI(f,function(z){w[z]=i[z]}),YI(f,function(z){Di(t,z)&&(v[z]=w[z]=t[z]),a(v,z)&&y++,a(w,z)&&I++}),r[g])return a(t,f[1])?w[f[2]]=null:a(t,f[2])&&(w[f[1]]=null),w;if(I===E||!y)return w;if(y>=E)return v;for(var D=0;D<f.length;D++){var R=f[D];if(!Di(v,R)&&Di(i,R)){v[R]=i[R];break}}return v}function a(f,g){return f[g]!=null&&f[g]!=="auto"}function u(f,g,v){YI(f,function(y){g[y]=v[y]})}}function Iv(i){return AJ({},i)}function AJ(i,t){return t&&i&&YI(bJ,function(e){Di(t,e)&&(i[e]=t[e])}),i}var y1t=Wr(),j0=function(i){we(t,i);function t(e,r,n){var o=i.call(this,e,r,n)||this;return o.uid=H0("ec_cpt_model"),o}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n)},t.prototype.mergeDefaultAndTheme=function(e,r){var n=aS(this),o=n?Iv(e):{},s=r.getTheme();Er(e,s.get(this.mainType)),Er(e,this.getDefaultOption()),n&&Sh(e,o,n)},t.prototype.mergeOption=function(e,r){Er(this.option,e,!0);var n=aS(this);n&&Sh(this.option,e,n)},t.prototype.optionUpdated=function(e,r){},t.prototype.getDefaultOption=function(){var e=this.constructor;if(!Hyt(e))return e.defaultOption;var r=y1t(this);if(!r.defaultOption){for(var n=[],o=e;o;){var s=o.prototype.defaultOption;s&&n.push(s),o=o.superClass}for(var a={},u=n.length-1;u>=0;u--)a=Er(a,n[u],!0);r.defaultOption=a}return r.defaultOption},t.prototype.getReferringComponents=function(e,r){var n=e+"Index",o=e+"Id";return F0(this.ecModel,e,{index:this.get(n,!0),id:this.get(o,!0)},r)},t.prototype.getBoxLayoutParams=function(){return wJ(this,!1)},t.prototype.getZLevelKey=function(){return""},t.prototype.setZLevel=function(e){this.option.zlevel=e},t.protoInitialize=function(){var e=t.prototype;e.type="component",e.id="",e.name="",e.mainType="",e.subType="",e.componentIndex=0}(),t}(bn);aK(j0,bn);iE(j0);Yxt(j0);Kxt(j0,x1t);function x1t(i){var t=[];return gt(j0.getClassesByMainType(i),function(e){t=t.concat(e.dependencies||e.prototype.dependencies||[])}),t=ti(t,function(e){return lh(e).main}),i!=="dataset"&&Ar(t,"dataset")<=0&&t.unshift("dataset"),t}const gn=j0;var Wm={color:{},darkColor:{},size:{}},ao=Wm.color={theme:["#5070dd","#b6d634","#505372","#ff994d","#0ca8df","#ffd10a","#fb628b","#785db0","#3fbe95"],neutral00:"#fff",neutral05:"#f4f7fd",neutral10:"#e8ebf0",neutral15:"#dbdee4",neutral20:"#cfd2d7",neutral25:"#c3c5cb",neutral30:"#b7b9be",neutral35:"#aaacb2",neutral40:"#9ea0a5",neutral45:"#929399",neutral50:"#86878c",neutral55:"#797b7f",neutral60:"#6d6e73",neutral65:"#616266",neutral70:"#54555a",neutral75:"#48494d",neutral80:"#3c3c41",neutral85:"#303034",neutral90:"#232328",neutral95:"#17171b",neutral99:"#000",accent05:"#eff1f9",accent10:"#e0e4f2",accent15:"#d0d6ec",accent20:"#c0c9e6",accent25:"#b1bbdf",accent30:"#a1aed9",accent35:"#91a0d3",accent40:"#8292cc",accent45:"#7285c6",accent50:"#6578ba",accent55:"#5c6da9",accent60:"#536298",accent65:"#4a5787",accent70:"#404c76",accent75:"#374165",accent80:"#2e3654",accent85:"#252b43",accent90:"#1b2032",accent95:"#121521",transparent:"rgba(0,0,0,0)",highlight:"rgba(255,231,130,0.8)"};Fe(ao,{primary:ao.neutral80,secondary:ao.neutral70,tertiary:ao.neutral60,quaternary:ao.neutral50,disabled:ao.neutral20,border:ao.neutral30,borderTint:ao.neutral20,borderShade:ao.neutral40,background:ao.neutral05,backgroundTint:"rgba(234,237,245,0.5)",backgroundTransparent:"rgba(255,255,255,0)",backgroundShade:ao.neutral10,shadow:"rgba(0,0,0,0.2)",shadowTint:"rgba(129,130,136,0.2)",axisLine:ao.neutral70,axisLineTint:ao.neutral40,axisTick:ao.neutral70,axisTickMinor:ao.neutral60,axisLabel:ao.neutral70,axisSplitLine:ao.neutral15,axisMinorSplitLine:ao.neutral05});for(var gm in ao)if(ao.hasOwnProperty(gm)){var Ij=ao[gm];gm==="theme"?Wm.darkColor.theme=ao.theme.slice():gm==="highlight"?Wm.darkColor.highlight="rgba(255,231,130,0.4)":gm.indexOf("accent")===0?Wm.darkColor[gm]=bp(Ij,null,function(i){return i*.5},function(i){return Math.min(1,1.3-i)}):Wm.darkColor[gm]=bp(Ij,null,function(i){return i*.9},function(i){return 1-Math.pow(i,1.5)})}Wm.size={xxs:2,xs:5,s:10,m:15,l:20,xl:30,xxl:40,xxxl:50};const _e=Wm;var IJ="";typeof navigator<"u"&&(IJ=navigator.platform||"");var yy="rgba(0, 0, 0, 0.2)",MJ=_e.color.theme[0],b1t=bp(MJ,null,null,.9);const w1t={darkMode:"auto",colorBy:"series",color:_e.color.theme,gradientColor:[b1t,MJ],aria:{decal:{decals:[{color:yy,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:yy,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:yy,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:yy,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:yy,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:yy,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:IJ.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};var CJ=Fi(["tooltip","label","itemName","itemId","itemGroupId","itemChildGroupId","seriesName"]),nc="original",os="arrayRows",ac="objectRows",xu="keyedColumns",Sp="typedArray",EJ="unknown",fu="column",Mv="row",fs={Must:1,Might:2,Not:3},DJ=Wr();function S1t(i){DJ(i).datasetMap=Fi()}function PJ(i,t,e){var r={},n=n3(t);if(!n||!i)return r;var o=[],s=[],a=t.ecModel,u=DJ(a).datasetMap,f=n.uid+"_"+e.seriesLayoutBy,g,v;i=i.slice(),gt(i,function(E,D){var R=nr(E)?E:i[D]={name:E};R.type==="ordinal"&&g==null&&(g=D,v=I(R)),r[R.name]=[]});var y=u.get(f)||u.set(f,{categoryWayDim:v,valueWayDim:0});gt(i,function(E,D){var R=E.name,z=I(E);if(g==null){var N=y.valueWayDim;w(r[R],N,z),w(s,N,z),y.valueWayDim+=z}else if(g===D)w(r[R],0,z),w(o,0,z);else{var N=y.categoryWayDim;w(r[R],N,z),w(s,N,z),y.categoryWayDim+=z}});function w(E,D,R){for(var z=0;z<R;z++)E.push(D+z)}function I(E){var D=E.dimsDef;return D?D.length:1}return o.length&&(r.itemName=o),s.length&&(r.seriesName=s),r}function r3(i,t,e){var r={},n=n3(i);if(!n)return r;var o=t.sourceFormat,s=t.dimensionsDefine,a;(o===ac||o===xu)&&gt(s,function(g,v){(nr(g)?g.name:g)==="name"&&(a=v)});var u=function(){for(var g={},v={},y=[],w=0,I=Math.min(5,e);w<I;w++){var E=RJ(t.data,o,t.seriesLayoutBy,s,t.startIndex,w);y.push(E);var D=E===fs.Not;if(D&&g.v==null&&w!==a&&(g.v=w),(g.n==null||g.n===g.v||!D&&y[g.n]===fs.Not)&&(g.n=w),R(g)&&y[g.n]!==fs.Not)return g;D||(E===fs.Might&&v.v==null&&w!==a&&(v.v=w),(v.n==null||v.n===v.v)&&(v.n=w))}function R(z){return z.v!=null&&z.n!=null}return R(g)?g:R(v)?v:null}();if(u){r.value=[u.v];var f=a??u.n;r.itemName=[f],r.seriesName=[f]}return r}function n3(i){var t=i.get("data",!0);if(!t)return F0(i.ecModel,"dataset",{index:i.get("datasetIndex",!0),id:i.get("datasetId",!0)},Wa).models[0]}function T1t(i){return!i.get("transform",!0)&&!i.get("fromTransformResult",!0)?[]:F0(i.ecModel,"dataset",{index:i.get("fromDatasetIndex",!0),id:i.get("fromDatasetId",!0)},Wa).models}function LJ(i,t){return RJ(i.data,i.sourceFormat,i.seriesLayoutBy,i.dimensionsDefine,i.startIndex,t)}function RJ(i,t,e,r,n,o){var s,a=5;if(zl(i))return fs.Not;var u,f;if(r){var g=r[o];nr(g)?(u=g.name,f=g.type):bi(g)&&(u=g)}if(f!=null)return f==="ordinal"?fs.Must:fs.Not;if(t===os){var v=i;if(e===Mv){for(var y=v[o],w=0;w<(y||[]).length&&w<a;w++)if((s=H(y[n+w]))!=null)return s}else for(var w=0;w<v.length&&w<a;w++){var I=v[n+w];if(I&&(s=H(I[o]))!=null)return s}}else if(t===ac){var E=i;if(!u)return fs.Not;for(var w=0;w<E.length&&w<a;w++){var D=E[w];if(D&&(s=H(D[u]))!=null)return s}}else if(t===xu){var R=i;if(!u)return fs.Not;var y=R[u];if(!y||zl(y))return fs.Not;for(var w=0;w<y.length&&w<a;w++)if((s=H(y[w]))!=null)return s}else if(t===nc)for(var z=i,w=0;w<z.length&&w<a;w++){var D=z[w],N=B0(D);if(!Ye(N))return fs.Not;if((s=H(N[o]))!=null)return s}function H($){var X=bi($);if($!=null&&Number.isFinite(Number($))&&$!=="")return X?fs.Might:fs.Not;if(X&&$!=="-")return fs.Must}return fs.Not}var dz=Fi();function A1t(i,t){Vs(dz.get(i)==null&&t),dz.set(i,t)}function I1t(i,t,e){var r=dz.get(t);if(!r)return e;var n=r(i);return n?e.concat(n):e}var Mj=Wr(),M1t=Wr(),a3=function(){function i(){}return i.prototype.getColorFromPalette=function(t,e,r){var n=na(this.get("color",!0)),o=this.get("colorLayer",!0);return kJ(this,Mj,n,o,t,e,r)},i.prototype.clearColorPalette=function(){E1t(this,Mj)},i}();function fz(i,t,e,r){var n=na(i.get(["aria","decal","decals"]));return kJ(i,M1t,n,null,t,e,r)}function C1t(i,t){for(var e=i.length,r=0;r<e;r++)if(i[r].length>t)return i[r];return i[e-1]}function kJ(i,t,e,r,n,o,s){o=o||i;var a=t(o),u=a.paletteIdx||0,f=a.paletteNameMap=a.paletteNameMap||{};if(f.hasOwnProperty(n))return f[n];var g=s==null||!r?e:C1t(r,s);if(g=g||e,!(!g||!g.length)){var v=g[u];return n&&(f[n]=v),a.paletteIdx=(u+1)%g.length,v}}function E1t(i,t){t(i).paletteIdx=0,t(i).paletteNameMap={}}var AA,vb,Cj,Ej="\0_ec_inner",D1t=1,OJ=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.init=function(e,r,n,o,s,a){o=o||{},this.option=null,this._theme=new bn(o),this._locale=new bn(s),this._optionManager=a},t.prototype.setOption=function(e,r,n){var o=Lj(r);this._optionManager.setOption(e,n,o),this._resetOption(null,o)},t.prototype.resetOption=function(e,r){return this._resetOption(e,Lj(r))},t.prototype._resetOption=function(e,r){var n=!1,o=this._optionManager;if(!e||e==="recreate"){var s=o.mountOption(e==="recreate");!this.option||e==="recreate"?Cj(this,s):(this.restoreData(),this._mergeOption(s,r)),n=!0}if((e==="timeline"||e==="media")&&this.restoreData(),!e||e==="recreate"||e==="timeline"){var a=o.getTimelineOption(this);a&&(n=!0,this._mergeOption(a,r))}if(!e||e==="recreate"||e==="media"){var u=o.getMediaOption(this);u.length&&gt(u,function(f){n=!0,this._mergeOption(f,r)},this)}return n},t.prototype.mergeOption=function(e){this._mergeOption(e,null)},t.prototype._mergeOption=function(e,r){var n=this.option,o=this._componentsMap,s=this._componentsCount,a=[],u=Fi(),f=r&&r.replaceMergeMainTypeMap;S1t(this),gt(e,function(v,y){v!=null&&(gn.hasClass(y)?y&&(a.push(y),u.set(y,!0)):n[y]=n[y]==null?Yi(v):Er(n[y],v,!0))}),f&&f.each(function(v,y){gn.hasClass(y)&&!u.get(y)&&(a.push(y),u.set(y,!0))}),gn.topologicalTravel(a,gn.getAllClassMainTypes(),g,this);function g(v){var y=I1t(this,v,na(e[v])),w=o.get(v),I=w?f&&f.get(v)?"replaceMerge":"normalMerge":"replaceAll",E=eK(w,y,I);kyt(E,v,gn),n[v]=null,o.set(v,null),s.set(v,0);var D=[],R=[],z=0,N;gt(E,function(H,$){var X=H.existing,K=H.newOption;if(!K)X&&(X.mergeOption({},this),X.optionUpdated({},!1));else{var et=v==="series",rt=gn.getClass(v,H.keyInfo.subType,!et);if(!rt)return;if(v==="tooltip"){if(N)return;N=!0}if(X&&X.constructor===rt)X.name=H.keyInfo.name,X.mergeOption(K,this),X.optionUpdated(K,!1);else{var lt=Fe({componentIndex:$},H.keyInfo);X=new rt(K,this,this,lt),Fe(X,lt),H.brandNew&&(X.__requireNewView=!0),X.init(K,this,this),X.optionUpdated(null,!0)}}X?(D.push(X.option),R.push(X),z++):(D.push(void 0),R.push(void 0))},this),n[v]=D,o.set(v,R),s.set(v,z),v==="series"&&AA(this)}this._seriesIndices||AA(this)},t.prototype.getOption=function(){var e=Yi(this.option);return gt(e,function(r,n){if(gn.hasClass(n)){for(var o=na(r),s=o.length,a=!1,u=s-1;u>=0;u--)o[u]&&!Qw(o[u])?a=!0:(o[u]=null,!a&&s--);o.length=s,e[n]=o}}),delete e[Ej],e},t.prototype.setTheme=function(e){this._theme=new bn(e),this._resetOption("recreate",null)},t.prototype.getTheme=function(){return this._theme},t.prototype.getLocaleModel=function(){return this._locale},t.prototype.setUpdatePayload=function(e){this._payload=e},t.prototype.getUpdatePayload=function(){return this._payload},t.prototype.getComponent=function(e,r){var n=this._componentsMap.get(e);if(n){var o=n[r||0];if(o)return o;if(r==null){for(var s=0;s<n.length;s++)if(n[s])return n[s]}}},t.prototype.queryComponents=function(e){var r=e.mainType;if(!r)return[];var n=e.index,o=e.id,s=e.name,a=this._componentsMap.get(r);if(!a||!a.length)return[];var u;return n!=null?(u=[],gt(na(n),function(f){a[f]&&u.push(a[f])})):o!=null?u=Dj("id",o,a):s!=null?u=Dj("name",s,a):u=Rn(a,function(f){return!!f}),Pj(u,e)},t.prototype.findComponents=function(e){var r=e.query,n=e.mainType,o=a(r),s=o?this.queryComponents(o):Rn(this._componentsMap.get(n),function(f){return!!f});return u(Pj(s,e));function a(f){var g=n+"Index",v=n+"Id",y=n+"Name";return f&&(f[g]!=null||f[v]!=null||f[y]!=null)?{mainType:n,index:f[g],id:f[v],name:f[y]}:null}function u(f){return e.filter?Rn(f,e.filter):f}},t.prototype.eachComponent=function(e,r,n){var o=this._componentsMap;if(Xi(e)){var s=r,a=e;o.each(function(v,y){for(var w=0;v&&w<v.length;w++){var I=v[w];I&&a.call(s,y,I,I.componentIndex)}})}else for(var u=bi(e)?o.get(e):nr(e)?this.findComponents(e):null,f=0;u&&f<u.length;f++){var g=u[f];g&&r.call(n,g,g.componentIndex)}},t.prototype.getSeriesByName=function(e){var r=Lo(e,null);return Rn(this._componentsMap.get("series"),function(n){return!!n&&r!=null&&n.name===r})},t.prototype.getSeriesByIndex=function(e){return this._componentsMap.get("series")[e]},t.prototype.getSeriesByType=function(e){return Rn(this._componentsMap.get("series"),function(r){return!!r&&r.subType===e})},t.prototype.getSeries=function(){return Rn(this._componentsMap.get("series"),function(e){return!!e})},t.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},t.prototype.eachSeries=function(e,r){vb(this),gt(this._seriesIndices,function(n){var o=this._componentsMap.get("series")[n];e.call(r,o,n)},this)},t.prototype.eachRawSeries=function(e,r){gt(this._componentsMap.get("series"),function(n){n&&e.call(r,n,n.componentIndex)})},t.prototype.eachSeriesByType=function(e,r,n){vb(this),gt(this._seriesIndices,function(o){var s=this._componentsMap.get("series")[o];s.subType===e&&r.call(n,s,o)},this)},t.prototype.eachRawSeriesByType=function(e,r,n){return gt(this.getSeriesByType(e),r,n)},t.prototype.isSeriesFiltered=function(e){return vb(this),this._seriesIndicesMap.get(e.componentIndex)==null},t.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},t.prototype.filterSeries=function(e,r){vb(this);var n=[];gt(this._seriesIndices,function(o){var s=this._componentsMap.get("series")[o];e.call(r,s,o)&&n.push(o)},this),this._seriesIndices=n,this._seriesIndicesMap=Fi(n)},t.prototype.restoreData=function(e){AA(this);var r=this._componentsMap,n=[];r.each(function(o,s){gn.hasClass(s)&&n.push(s)}),gn.topologicalTravel(n,gn.getAllClassMainTypes(),function(o){gt(r.get(o),function(s){s&&(o!=="series"||!P1t(s,e))&&s.restoreData()})})},t.internalField=function(){AA=function(e){var r=e._seriesIndices=[];gt(e._componentsMap.get("series"),function(n){n&&r.push(n.componentIndex)}),e._seriesIndicesMap=Fi(r)},vb=function(e){},Cj=function(e,r){e.option={},e.option[Ej]=D1t,e._componentsMap=Fi({series:[]}),e._componentsCount=Fi();var n=r.aria;nr(n)&&n.enabled==null&&(n.enabled=!0),L1t(r,e._theme.option),Er(r,w1t,!1),e._mergeOption(r,null)}}(),t}(bn);function P1t(i,t){if(t){var e=t.seriesIndex,r=t.seriesId,n=t.seriesName;return e!=null&&i.componentIndex!==e||r!=null&&i.id!==r||n!=null&&i.name!==n}}function L1t(i,t){var e=i.color&&!i.colorLayer;gt(t,function(r,n){n==="colorLayer"&&e||n==="color"&&i.color||gn.hasClass(n)||(typeof r=="object"?i[n]=i[n]?Er(i[n],r,!1):Yi(r):i[n]==null&&(i[n]=r))})}function Dj(i,t,e){if(Ye(t)){var r=Fi();return gt(t,function(o){if(o!=null){var s=Lo(o,null);s!=null&&r.set(o,!0)}}),Rn(e,function(o){return o&&r.get(o[i])})}else{var n=Lo(t,null);return Rn(e,function(o){return o&&n!=null&&o[i]===n})}}function Pj(i,t){return t.hasOwnProperty("subType")?Rn(i,function(e){return e&&e.subType===t.subType}):i}function Lj(i){var t=Fi();return i&&gt(na(i.replaceMerge),function(e){t.set(e,!0)}),{replaceMergeMainTypeMap:t}}wo(OJ,a3);const zJ=OJ;var R1t=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isSSR","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],k1t=function(){function i(t){gt(R1t,function(e){this[e]=wi(t[e],t)},this)}return i}();const BJ=k1t;var O1t=/^(min|max)?(.+)$/,z1t=function(){function i(t){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=t}return i.prototype.setOption=function(t,e,r){t&&(gt(na(t.series),function(s){s&&s.data&&zl(s.data)&&wM(s.data)}),gt(na(t.dataset),function(s){s&&s.source&&zl(s.source)&&wM(s.source)})),t=Yi(t);var n=this._optionBackup,o=B1t(t,e,!n);this._newBaseOption=o.baseOption,n?(o.timelineOptions.length&&(n.timelineOptions=o.timelineOptions),o.mediaList.length&&(n.mediaList=o.mediaList),o.mediaDefault&&(n.mediaDefault=o.mediaDefault)):this._optionBackup=o},i.prototype.mountOption=function(t){var e=this._optionBackup;return this._timelineOptions=e.timelineOptions,this._mediaList=e.mediaList,this._mediaDefault=e.mediaDefault,this._currentMediaIndices=[],Yi(t?e.baseOption:this._newBaseOption)},i.prototype.getTimelineOption=function(t){var e,r=this._timelineOptions;if(r.length){var n=t.getComponent("timeline");n&&(e=Yi(r[n.getCurrentIndex()]))}return e},i.prototype.getMediaOption=function(t){var e=this._api.getWidth(),r=this._api.getHeight(),n=this._mediaList,o=this._mediaDefault,s=[],a=[];if(!n.length&&!o)return a;for(var u=0,f=n.length;u<f;u++)F1t(n[u].query,e,r)&&s.push(u);return!s.length&&o&&(s=[-1]),s.length&&!V1t(s,this._currentMediaIndices)&&(a=ti(s,function(g){return Yi(g===-1?o.option:n[g].option)})),this._currentMediaIndices=s,a},i}();function B1t(i,t,e){var r=[],n,o,s=i.baseOption,a=i.timeline,u=i.options,f=i.media,g=!!i.media,v=!!(u||a||s&&s.timeline);s?(o=s,o.timeline||(o.timeline=a)):((v||g)&&(i.options=i.media=null),o=i),g&&Ye(f)&&gt(f,function(w){w&&w.option&&(w.query?r.push(w):n||(n=w))}),y(o),gt(u,function(w){return y(w)}),gt(r,function(w){return y(w.option)});function y(w){gt(t,function(I){I(w,e)})}return{baseOption:o,timelineOptions:u||[],mediaDefault:n,mediaList:r}}function F1t(i,t,e){var r={width:t,height:e,aspectratio:t/e},n=!0;return gt(i,function(o,s){var a=s.match(O1t);if(!(!a||!a[1]||!a[2])){var u=a[1],f=a[2].toLowerCase();N1t(r[f],o,u)||(n=!1)}}),n}function N1t(i,t,e){return e==="min"?i>=t:e==="max"?i<=t:i===t}function V1t(i,t){return i.join(",")===t.join(",")}const U1t=z1t;var iu=gt,oS=nr,Rj=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function rR(i){var t=i&&i.itemStyle;if(t)for(var e=0,r=Rj.length;e<r;e++){var n=Rj[e],o=t.normal,s=t.emphasis;o&&o[n]&&(i[n]=i[n]||{},i[n].normal?Er(i[n].normal,o[n]):i[n].normal=o[n],o[n]=null),s&&s[n]&&(i[n]=i[n]||{},i[n].emphasis?Er(i[n].emphasis,s[n]):i[n].emphasis=s[n],s[n]=null)}}function Ds(i,t,e){if(i&&i[t]&&(i[t].normal||i[t].emphasis)){var r=i[t].normal,n=i[t].emphasis;r&&(e?(i[t].normal=i[t].emphasis=null,rr(i[t],r)):i[t]=r),n&&(i.emphasis=i.emphasis||{},i.emphasis[t]=n,n.focus&&(i.emphasis.focus=n.focus),n.blurScope&&(i.emphasis.blurScope=n.blurScope))}}function iw(i){Ds(i,"itemStyle"),Ds(i,"lineStyle"),Ds(i,"areaStyle"),Ds(i,"label"),Ds(i,"labelLine"),Ds(i,"upperLabel"),Ds(i,"edgeLabel")}function go(i,t){var e=oS(i)&&i[t],r=oS(e)&&e.textStyle;if(r)for(var n=0,o=zH.length;n<o;n++){var s=zH[n];r.hasOwnProperty(s)&&(e[s]=r[s])}}function wc(i){i&&(iw(i),go(i,"label"),i.emphasis&&go(i.emphasis,"label"))}function G1t(i){if(oS(i)){rR(i),iw(i),go(i,"label"),go(i,"upperLabel"),go(i,"edgeLabel"),i.emphasis&&(go(i.emphasis,"label"),go(i.emphasis,"upperLabel"),go(i.emphasis,"edgeLabel"));var t=i.markPoint;t&&(rR(t),wc(t));var e=i.markLine;e&&(rR(e),wc(e));var r=i.markArea;r&&wc(r);var n=i.data;if(i.type==="graph"){n=n||i.nodes;var o=i.links||i.edges;if(o&&!zl(o))for(var s=0;s<o.length;s++)wc(o[s]);gt(i.categories,function(f){iw(f)})}if(n&&!zl(n))for(var s=0;s<n.length;s++)wc(n[s]);if(t=i.markPoint,t&&t.data)for(var a=t.data,s=0;s<a.length;s++)wc(a[s]);if(e=i.markLine,e&&e.data)for(var u=e.data,s=0;s<u.length;s++)Ye(u[s])?(wc(u[s][0]),wc(u[s][1])):wc(u[s]);i.type==="gauge"?(go(i,"axisLabel"),go(i,"title"),go(i,"detail")):i.type==="treemap"?(Ds(i.breadcrumb,"itemStyle"),gt(i.levels,function(f){iw(f)})):i.type==="tree"&&iw(i.leaves)}}function ed(i){return Ye(i)?i:i?[i]:[]}function kj(i){return(Ye(i)?i[0]:i)||{}}function H1t(i,t){iu(ed(i.series),function(r){oS(r)&&G1t(r)});var e=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];t&&e.push("valueAxis","categoryAxis","logAxis","timeAxis"),iu(e,function(r){iu(ed(i[r]),function(n){n&&(go(n,"axisLabel"),go(n.axisPointer,"label"))})}),iu(ed(i.parallel),function(r){var n=r&&r.parallelAxisDefault;go(n,"axisLabel"),go(n&&n.axisPointer,"label")}),iu(ed(i.calendar),function(r){Ds(r,"itemStyle"),go(r,"dayLabel"),go(r,"monthLabel"),go(r,"yearLabel")}),iu(ed(i.radar),function(r){go(r,"name"),r.name&&r.axisName==null&&(r.axisName=r.name,delete r.name),r.nameGap!=null&&r.axisNameGap==null&&(r.axisNameGap=r.nameGap,delete r.nameGap)}),iu(ed(i.geo),function(r){oS(r)&&(wc(r),iu(ed(r.regions),function(n){wc(n)}))}),iu(ed(i.timeline),function(r){wc(r),Ds(r,"label"),Ds(r,"itemStyle"),Ds(r,"controlStyle",!0);var n=r.data;Ye(n)&&gt(n,function(o){nr(o)&&(Ds(o,"label"),Ds(o,"itemStyle"))})}),iu(ed(i.toolbox),function(r){Ds(r,"iconStyle"),iu(r.feature,function(n){Ds(n,"iconStyle")})}),go(kj(i.axisPointer),"label"),go(kj(i.tooltip).axisPointer,"label")}function j1t(i,t){for(var e=t.split(","),r=i,n=0;n<e.length&&(r=r&&r[e[n]],r!=null);n++);return r}function W1t(i,t,e,r){for(var n=t.split(","),o=i,s,a=0;a<n.length-1;a++)s=n[a],o[s]==null&&(o[s]={}),o=o[s];(r||o[n[a]]==null)&&(o[n[a]]=e)}function Oj(i){i&&gt($1t,function(t){t[0]in i&&!(t[1]in i)&&(i[t[1]]=i[t[0]])})}var $1t=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],Z1t=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],nR=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function _b(i){var t=i&&i.itemStyle;if(t)for(var e=0;e<nR.length;e++){var r=nR[e][1],n=nR[e][0];t[r]!=null&&(t[n]=t[r])}}function zj(i){i&&i.alignTo==="edge"&&i.margin!=null&&i.edgeDistance==null&&(i.edgeDistance=i.margin)}function Bj(i){i&&i.downplay&&!i.blur&&(i.blur=i.downplay)}function q1t(i){i&&i.focusNodeAdjacency!=null&&(i.emphasis=i.emphasis||{},i.emphasis.focus==null&&(i.emphasis.focus="adjacency"))}function FJ(i,t){if(i)for(var e=0;e<i.length;e++)t(i[e]),i[e]&&FJ(i[e].children,t)}function NJ(i,t){H1t(i,t),i.series=na(i.series),gt(i.series,function(e){if(nr(e)){var r=e.type;if(r==="line")e.clipOverflow!=null&&(e.clip=e.clipOverflow);else if(r==="pie"||r==="gauge"){e.clockWise!=null&&(e.clockwise=e.clockWise),zj(e.label);var n=e.data;if(n&&!zl(n))for(var o=0;o<n.length;o++)zj(n[o]);e.hoverOffset!=null&&(e.emphasis=e.emphasis||{},(e.emphasis.scaleSize=null)&&(e.emphasis.scaleSize=e.hoverOffset))}else if(r==="gauge"){var s=j1t(e,"pointer.color");s!=null&&W1t(e,"itemStyle.color",s)}else if(r==="bar"){_b(e),_b(e.backgroundStyle),_b(e.emphasis);var n=e.data;if(n&&!zl(n))for(var o=0;o<n.length;o++)typeof n[o]=="object"&&(_b(n[o]),_b(n[o]&&n[o].emphasis))}else if(r==="sunburst"){var a=e.highlightPolicy;a&&(e.emphasis=e.emphasis||{},e.emphasis.focus||(e.emphasis.focus=a)),Bj(e),FJ(e.data,Bj)}else r==="graph"||r==="sankey"?q1t(e):r==="map"&&(e.mapType&&!e.map&&(e.map=e.mapType),e.mapLocation&&rr(e,e.mapLocation));e.hoverAnimation!=null&&(e.emphasis=e.emphasis||{},e.emphasis&&e.emphasis.scale==null&&(e.emphasis.scale=e.hoverAnimation)),Oj(e)}}),i.dataRange&&(i.visualMap=i.dataRange),gt(Z1t,function(e){var r=i[e];r&&(Ye(r)||(r=[r]),gt(r,function(n){Oj(n)}))})}function X1t(i){var t=Fi();i.eachSeries(function(e){var r=e.get("stack");if(r){var n=t.get(r)||t.set(r,[]),o=e.getData(),s={stackResultDimension:o.getCalculationInfo("stackResultDimension"),stackedOverDimension:o.getCalculationInfo("stackedOverDimension"),stackedDimension:o.getCalculationInfo("stackedDimension"),stackedByDimension:o.getCalculationInfo("stackedByDimension"),isStackedByIndex:o.getCalculationInfo("isStackedByIndex"),data:o,seriesModel:e};if(!s.stackedDimension||!(s.isStackedByIndex||s.stackedByDimension))return;n.push(s)}}),t.each(function(e){if(e.length!==0){var r=e[0].seriesModel,n=r.get("stackOrder")||"seriesAsc";n==="seriesDesc"&&e.reverse(),gt(e,function(o,s){o.data.setCalculationInfo("stackedOnSeries",s>0?e[s-1].seriesModel:null)}),Y1t(e)}})}function Y1t(i){gt(i,function(t,e){var r=[],n=[NaN,NaN],o=[t.stackResultDimension,t.stackedOverDimension],s=t.data,a=t.isStackedByIndex,u=t.seriesModel.get("stackStrategy")||"samesign";s.modify(o,function(f,g,v){var y=s.get(t.stackedDimension,v);if(isNaN(y))return n;var w,I;a?I=s.getRawIndex(v):w=s.get(t.stackedByDimension,v);for(var E=NaN,D=e-1;D>=0;D--){var R=i[D];if(a||(I=R.data.rawIndexOf(R.stackedByDimension,w)),I>=0){var z=R.data.getByRawIndex(R.stackResultDimension,I);if(u==="all"||u==="positive"&&z>0||u==="negative"&&z<0||u==="samesign"&&y>=0&&z>0||u==="samesign"&&y<=0&&z<0){y=xyt(y,z),E=z;break}}}return r[0]=y,r[1]=E,r})})}var _E=function(){function i(t){this.data=t.data||(t.sourceFormat===xu?{}:[]),this.sourceFormat=t.sourceFormat||EJ,this.seriesLayoutBy=t.seriesLayoutBy||fu,this.startIndex=t.startIndex||0,this.dimensionsDetectedCount=t.dimensionsDetectedCount,this.metaRawOption=t.metaRawOption;var e=this.dimensionsDefine=t.dimensionsDefine;if(e)for(var r=0;r<e.length;r++){var n=e[r];n.type==null&&LJ(this,r)===fs.Must&&(n.type="ordinal")}}return i}();function o3(i){return i instanceof _E}function pz(i,t,e){e=e||VJ(i);var r=t.seriesLayoutBy,n=J1t(i,e,r,t.sourceHeader,t.dimensions),o=new _E({data:i,sourceFormat:e,seriesLayoutBy:r,dimensionsDefine:n.dimensionsDefine,startIndex:n.startIndex,dimensionsDetectedCount:n.dimensionsDetectedCount,metaRawOption:Yi(t)});return o}function s3(i){return new _E({data:i,sourceFormat:zl(i)?Sp:nc})}function K1t(i){return new _E({data:i.data,sourceFormat:i.sourceFormat,seriesLayoutBy:i.seriesLayoutBy,dimensionsDefine:Yi(i.dimensionsDefine),startIndex:i.startIndex,dimensionsDetectedCount:i.dimensionsDetectedCount})}function VJ(i){var t=EJ;if(zl(i))t=Sp;else if(Ye(i)){i.length===0&&(t=os);for(var e=0,r=i.length;e<r;e++){var n=i[e];if(n!=null){if(Ye(n)||zl(n)){t=os;break}else if(nr(n)){t=ac;break}}}}else if(nr(i)){for(var o in i)if(Di(i,o)&&Ns(i[o])){t=xu;break}}return t}function J1t(i,t,e,r,n){var o,s;if(!i)return{dimensionsDefine:Fj(n),startIndex:s,dimensionsDetectedCount:o};if(t===os){var a=i;r==="auto"||r==null?Nj(function(f){f!=null&&f!=="-"&&(bi(f)?s==null&&(s=1):s=0)},e,a,10):s=fn(r)?r:r?1:0,!n&&s===1&&(n=[],Nj(function(f,g){n[g]=f!=null?f+"":""},e,a,1/0)),o=n?n.length:e===Mv?a.length:a[0]?a[0].length:null}else if(t===ac)n||(n=Q1t(i));else if(t===xu)n||(n=[],gt(i,function(f,g){n.push(g)}));else if(t===nc){var u=B0(i[0]);o=Ye(u)&&u.length||1}return{startIndex:s,dimensionsDefine:Fj(n),dimensionsDetectedCount:o}}function Q1t(i){for(var t=0,e;t<i.length&&!(e=i[t++]););if(e)return on(e)}function Fj(i){if(i){var t=Fi();return ti(i,function(e,r){e=nr(e)?e:{name:e};var n={name:e.name,displayName:e.displayName,type:e.type};if(n.name==null)return n;n.name+="",n.displayName==null&&(n.displayName=n.name);var o=t.get(n.name);return o?n.name+="-"+o.count++:t.set(n.name,{count:1}),n})}}function Nj(i,t,e,r){if(t===Mv)for(var n=0;n<e.length&&n<r;n++)i(e[n]?e[n][0]:null,n);else for(var o=e[0]||[],n=0;n<o.length&&n<r;n++)i(o[n],n)}function UJ(i){var t=i.sourceFormat;return t===ac||t===xu}var mm,vm,_m,ym,Vj,Uj,GJ=function(){function i(t,e){var r=o3(t)?t:s3(t);this._source=r;var n=this._data=r.data,o=r.sourceFormat;r.seriesLayoutBy,o===Sp&&(this._offset=0,this._dimSize=e,this._data=n),Uj(this,n,r)}return i.prototype.getSource=function(){return this._source},i.prototype.count=function(){return 0},i.prototype.getItem=function(t,e){},i.prototype.appendData=function(t){},i.prototype.clean=function(){},i.protoInitialize=function(){var t=i.prototype;t.pure=!1,t.persistent=!0}(),i.internalField=function(){var t;Uj=function(s,a,u){var f=u.sourceFormat,g=u.seriesLayoutBy,v=u.startIndex,y=u.dimensionsDefine,w=Vj[l3(f,g)];if(Fe(s,w),f===Sp)s.getItem=e,s.count=n,s.fillStorage=r;else{var I=HJ(f,g);s.getItem=wi(I,null,a,v,y);var E=jJ(f,g);s.count=wi(E,null,a,v,y)}};var e=function(s,a){s=s-this._offset,a=a||[];for(var u=this._data,f=this._dimSize,g=f*s,v=0;v<f;v++)a[v]=u[g+v];return a},r=function(s,a,u,f){for(var g=this._data,v=this._dimSize,y=0;y<v;y++){for(var w=f[y],I=w[0]==null?1/0:w[0],E=w[1]==null?-1/0:w[1],D=a-s,R=u[y],z=0;z<D;z++){var N=g[z*v+y];R[s+z]=N,N<I&&(I=N),N>E&&(E=N)}w[0]=I,w[1]=E}},n=function(){return this._data?this._data.length/this._dimSize:0};Vj=(t={},t[os+"_"+fu]={pure:!0,appendData:o},t[os+"_"+Mv]={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},t[ac]={pure:!0,appendData:o},t[xu]={pure:!0,appendData:function(s){var a=this._data;gt(s,function(u,f){for(var g=a[f]||(a[f]=[]),v=0;v<(u||[]).length;v++)g.push(u[v])})}},t[nc]={appendData:o},t[Sp]={persistent:!1,pure:!0,appendData:function(s){this._data=s},clean:function(){this._offset+=this.count(),this._data=null}},t);function o(s){for(var a=0;a<s.length;a++)this._data.push(s[a])}}(),i}(),IA=function(i){Ye(i)||JY("series.data or dataset.source must be an array.")};mm={},mm[os+"_"+fu]=IA,mm[os+"_"+Mv]=IA,mm[ac]=IA,mm[xu]=function(i,t){for(var e=0;e<t.length;e++){var r=t[e].name;r==null&&JY("dimension name must not be null/undefined.")}},mm[nc]=IA;var Gj=function(i,t,e,r){return i[r]},tbt=(vm={},vm[os+"_"+fu]=function(i,t,e,r){return i[r+t]},vm[os+"_"+Mv]=function(i,t,e,r,n){r+=t;for(var o=n||[],s=i,a=0;a<s.length;a++){var u=s[a];o[a]=u?u[r]:null}return o},vm[ac]=Gj,vm[xu]=function(i,t,e,r,n){for(var o=n||[],s=0;s<e.length;s++){var a=e[s].name,u=a!=null?i[a]:null;o[s]=u?u[r]:null}return o},vm[nc]=Gj,vm);function HJ(i,t){var e=tbt[l3(i,t)];return e}var Hj=function(i,t,e){return i.length},ebt=(_m={},_m[os+"_"+fu]=function(i,t,e){return Math.max(0,i.length-t)},_m[os+"_"+Mv]=function(i,t,e){var r=i[0];return r?Math.max(0,r.length-t):0},_m[ac]=Hj,_m[xu]=function(i,t,e){var r=e[0].name,n=r!=null?i[r]:null;return n?n.length:0},_m[nc]=Hj,_m);function jJ(i,t){var e=ebt[l3(i,t)];return e}var aR=function(i,t,e){return i[t]},ibt=(ym={},ym[os]=aR,ym[ac]=function(i,t,e){return i[e]},ym[xu]=aR,ym[nc]=function(i,t,e){var r=B0(i);return r instanceof Array?r[t]:r},ym[Sp]=aR,ym);function WJ(i){var t=ibt[i];return t}function l3(i,t){return i===os?i+"_"+t:i}function w0(i,t,e){if(i){var r=i.getRawDataItem(t);if(r!=null){var n=i.getStore(),o=n.getSource().sourceFormat;if(e!=null){var s=i.getDimensionIndex(e),a=n.getDimensionProperty(s);return WJ(o)(r,s,a)}else{var u=r;return o===nc&&(u=B0(r)),u}}}}var rbt=/\{@(.+?)\}/g,yE=function(){function i(){}return i.prototype.getDataParams=function(t,e){var r=this.getData(e),n=this.getRawValue(t,e),o=r.getRawIndex(t),s=r.getName(t),a=r.getRawDataItem(t),u=r.getItemVisual(t,"style"),f=u&&u[r.getItemVisual(t,"drawType")||"fill"],g=u&&u.stroke,v=this.mainType,y=v==="series",w=r.userOutput&&r.userOutput.get();return{componentType:v,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:y?this.subType:null,seriesIndex:this.seriesIndex,seriesId:y?this.id:null,seriesName:y?this.name:null,name:s,dataIndex:o,data:a,dataType:e,value:n,color:f,borderColor:g,dimensionNames:w?w.fullDimensions:null,encode:w?w.encode:null,$vars:["seriesName","name","value"]}},i.prototype.getFormattedLabel=function(t,e,r,n,o,s){e=e||"normal";var a=this.getData(r),u=this.getDataParams(t,r);if(s&&(u.value=s.interpolatedValue),n!=null&&Ye(u.value)&&(u.value=u.value[n]),!o){var f=a.getItemModel(t);o=f.get(e==="normal"?["label","formatter"]:[e,"label","formatter"])}if(Xi(o))return u.status=e,u.dimensionIndex=n,o(u);if(bi(o)){var g=vJ(o,u);return g.replace(rbt,function(v,y){var w=y.length,I=y;I.charAt(0)==="["&&I.charAt(w-1)==="]"&&(I=+I.slice(1,w-1));var E=w0(a,t,I);if(s&&Ye(s.interpolatedValue)){var D=a.getDimensionIndex(I);D>=0&&(E=s.interpolatedValue[D])}return E!=null?E+"":""})}},i.prototype.getRawValue=function(t,e){return w0(this.getData(e),t)},i.prototype.formatTooltip=function(t,e,r){},i}();function jj(i){var t,e;return nr(i)?i.type&&(e=i):t=i,{text:t,frag:e}}function Ew(i){return new nbt(i)}var nbt=function(){function i(t){t=t||{},this._reset=t.reset,this._plan=t.plan,this._count=t.count,this._onDirty=t.onDirty,this._dirty=!0}return i.prototype.perform=function(t){var e=this._upstream,r=t&&t.skip;if(this._dirty&&e){var n=this.context;n.data=n.outputData=e.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this);var o;this._plan&&!r&&(o=this._plan(this.context));var s=g(this._modBy),a=this._modDataCount||0,u=g(t&&t.modBy),f=t&&t.modDataCount||0;(s!==u||a!==f)&&(o="reset");function g(z){return!(z>=1)&&(z=1),z}var v;(this._dirty||o==="reset")&&(this._dirty=!1,v=this._doReset(r)),this._modBy=u,this._modDataCount=f;var y=t&&t.step;if(e?this._dueEnd=e._outputDueEnd:this._dueEnd=this._count?this._count(this.context):1/0,this._progress){var w=this._dueIndex,I=Math.min(y!=null?this._dueIndex+y:1/0,this._dueEnd);if(!r&&(v||w<I)){var E=this._progress;if(Ye(E))for(var D=0;D<E.length;D++)this._doProgress(E[D],w,I,u,f);else this._doProgress(E,w,I,u,f)}this._dueIndex=I;var R=this._settedOutputEnd!=null?this._settedOutputEnd:I;this._outputDueEnd=R}else this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd;return this.unfinished()},i.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},i.prototype._doProgress=function(t,e,r,n,o){Wj.reset(e,r,n,o),this._callingProgress=t,this._callingProgress({start:e,end:r,count:r-e,next:Wj.next},this.context)},i.prototype._doReset=function(t){this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null;var e,r;!t&&this._reset&&(e=this._reset(this.context),e&&e.progress&&(r=e.forceFirstProgress,e=e.progress),Ye(e)&&!e.length&&(e=null)),this._progress=e,this._modBy=this._modDataCount=null;var n=this._downstream;return n&&n.dirty(),r},i.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},i.prototype.pipe=function(t){(this._downstream!==t||this._dirty)&&(this._downstream=t,t._upstream=this,t.dirty())},i.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},i.prototype.getUpstream=function(){return this._upstream},i.prototype.getDownstream=function(){return this._downstream},i.prototype.setOutputEnd=function(t){this._outputDueEnd=this._settedOutputEnd=t},i}(),Wj=function(){var i,t,e,r,n,o={reset:function(u,f,g,v){t=u,i=f,e=g,r=v,n=Math.ceil(r/e),o.next=e>1&&r>0?a:s}};return o;function s(){return t<i?t++:null}function a(){var u=t%n*e+Math.ceil(t/n),f=t>=i?null:u<r?u:t;return t++,f}}();function Tp(i,t){var e=t&&t.type;return e==="ordinal"?i:(e==="time"&&!fn(i)&&i!=null&&i!=="-"&&(i=+Sv(i)),i==null||i===""?NaN:Number(i))}var abt=Fi({number:function(i){return parseFloat(i)},time:function(i){return+Sv(i)},trim:function(i){return bi(i)?Ec(i):i}});function $J(i){return abt.get(i)}var ZJ={lt:function(i,t){return i<t},lte:function(i,t){return i<=t},gt:function(i,t){return i>t},gte:function(i,t){return i>=t}},obt=function(){function i(t,e){if(!fn(e)){var r="";Dn(r)}this._opFn=ZJ[t],this._rvalFloat=Ld(e)}return i.prototype.evaluate=function(t){return fn(t)?this._opFn(t,this._rvalFloat):this._opFn(Ld(t),this._rvalFloat)},i}(),qJ=function(){function i(t,e){var r=t==="desc";this._resultLT=r?1:-1,e==null&&(e=r?"min":"max"),this._incomparable=e==="min"?-1/0:1/0}return i.prototype.evaluate=function(t,e){var r=fn(t)?t:Ld(t),n=fn(e)?e:Ld(e),o=isNaN(r),s=isNaN(n);if(o&&(r=this._incomparable),s&&(n=this._incomparable),o&&s){var a=bi(t),u=bi(e);a&&(r=u?t:0),u&&(n=a?e:0)}return r<n?this._resultLT:r>n?-this._resultLT:0},i}(),sbt=function(){function i(t,e){this._rval=e,this._isEQ=t,this._rvalTypeof=typeof e,this._rvalFloat=Ld(e)}return i.prototype.evaluate=function(t){var e=t===this._rval;if(!e){var r=typeof t;r!==this._rvalTypeof&&(r==="number"||this._rvalTypeof==="number")&&(e=Ld(t)===this._rvalFloat)}return this._isEQ?e:!e},i}();function lbt(i,t){return i==="eq"||i==="ne"?new sbt(i==="eq",t):Di(ZJ,i)?new obt(i,t):null}var cbt=function(){function i(){}return i.prototype.getRawData=function(){throw new Error("not supported")},i.prototype.getRawDataItem=function(t){throw new Error("not supported")},i.prototype.cloneRawData=function(){},i.prototype.getDimensionInfo=function(t){},i.prototype.cloneAllDimensionInfo=function(){},i.prototype.count=function(){},i.prototype.retrieveValue=function(t,e){},i.prototype.retrieveValueFromItem=function(t,e){},i.prototype.convertValue=function(t,e){return Tp(t,e)},i}();function ubt(i,t){var e=new cbt,r=i.data,n=e.sourceFormat=i.sourceFormat,o=i.startIndex,s="";i.seriesLayoutBy!==fu&&Dn(s);var a=[],u={},f=i.dimensionsDefine;if(f)gt(f,function(E,D){var R=E.name,z={index:D,name:R,displayName:E.displayName};if(a.push(z),R!=null){var N="";Di(u,R)&&Dn(N),u[R]=z}});else for(var g=0;g<i.dimensionsDetectedCount;g++)a.push({index:g});var v=HJ(n,fu);t.__isBuiltIn&&(e.getRawDataItem=function(E){return v(r,o,a,E)},e.getRawData=wi(hbt,null,i)),e.cloneRawData=wi(dbt,null,i);var y=jJ(n,fu);e.count=wi(y,null,r,o,a);var w=WJ(n);e.retrieveValue=function(E,D){var R=v(r,o,a,E);return I(R,D)};var I=e.retrieveValueFromItem=function(E,D){if(E!=null){var R=a[D];if(R)return w(E,D,R.name)}};return e.getDimensionInfo=wi(fbt,null,a,u),e.cloneAllDimensionInfo=wi(pbt,null,a),e}function hbt(i){var t=i.sourceFormat;if(!c3(t)){var e="";Dn(e)}return i.data}function dbt(i){var t=i.sourceFormat,e=i.data;if(!c3(t)){var r="";Dn(r)}if(t===os){for(var n=[],o=0,s=e.length;o<s;o++)n.push(e[o].slice());return n}else if(t===ac){for(var n=[],o=0,s=e.length;o<s;o++)n.push(Fe({},e[o]));return n}}function fbt(i,t,e){if(e!=null){if(fn(e)||!isNaN(e)&&!Di(t,e))return i[e];if(Di(t,e))return t[e]}}function pbt(i){return Yi(i)}var XJ=Fi();function gbt(i){i=Yi(i);var t=i.type,e="";t||Dn(e);var r=t.split(":");r.length!==2&&Dn(e);var n=!1;r[0]==="echarts"&&(t=r[1],n=!0),i.__isBuiltIn=n,XJ.set(t,i)}function mbt(i,t,e){var r=na(i),n=r.length,o="";n||Dn(o);for(var s=0,a=n;s<a;s++){var u=r[s];t=vbt(u,t),s!==a-1&&(t.length=Math.max(t.length,1))}return t}function vbt(i,t,e,r){var n="";t.length||Dn(n),nr(i)||Dn(n);var o=i.type,s=XJ.get(o);s||Dn(n);var a=ti(t,function(f){return ubt(f,s)}),u=na(s.transform({upstream:a[0],upstreamList:a,config:Yi(i.config)}));return ti(u,function(f,g){var v="";nr(f)||Dn(v),f.data||Dn(v);var y=VJ(f.data);c3(y)||Dn(v);var w,I=t[0];if(I&&g===0&&!f.dimensions){var E=I.startIndex;E&&(f.data=I.data.slice(0,E).concat(f.data)),w={seriesLayoutBy:fu,sourceHeader:E,dimensions:I.metaRawOption.dimensions}}else w={seriesLayoutBy:fu,sourceHeader:0,dimensions:f.dimensions};return pz(f.data,w,null)})}function c3(i){return i===os||i===ac}var xE="undefined",_bt=typeof Uint32Array===xE?Array:Uint32Array,ybt=typeof Uint16Array===xE?Array:Uint16Array,YJ=typeof Int32Array===xE?Array:Int32Array,$j=typeof Float64Array===xE?Array:Float64Array,KJ={float:$j,int:YJ,ordinal:Array,number:Array,time:$j},oR;function xy(i){return i>65535?_bt:ybt}function by(){return[1/0,-1/0]}function xbt(i){var t=i.constructor;return t===Array?i.slice():new t(i)}function Zj(i,t,e,r,n){var o=KJ[e||"float"];if(n){var s=i[t],a=s&&s.length;if(a!==r){for(var u=new o(r),f=0;f<a;f++)u[f]=s[f];i[t]=u}}else i[t]=new o(r)}var gz=function(){function i(){this._chunks=[],this._rawExtent=[],this._extent=[],this._count=0,this._rawCount=0,this._calcDimNameToIdx=Fi()}return i.prototype.initData=function(t,e,r){this._provider=t,this._chunks=[],this._indices=null,this.getRawIndex=this._getRawIdxIdentity;var n=t.getSource(),o=this.defaultDimValueGetter=oR[n.sourceFormat];this._dimValueGetter=r||o,this._rawExtent=[],UJ(n),this._dimensions=ti(e,function(s){return{type:s.type,property:s.property}}),this._initDataFromProvider(0,t.count())},i.prototype.getProvider=function(){return this._provider},i.prototype.getSource=function(){return this._provider.getSource()},i.prototype.ensureCalculationDimension=function(t,e){var r=this._calcDimNameToIdx,n=this._dimensions,o=r.get(t);if(o!=null){if(n[o].type===e)return o}else o=n.length;return n[o]={type:e},r.set(t,o),this._chunks[o]=new KJ[e||"float"](this._rawCount),this._rawExtent[o]=by(),o},i.prototype.collectOrdinalMeta=function(t,e){var r=this._chunks[t],n=this._dimensions[t],o=this._rawExtent,s=n.ordinalOffset||0,a=r.length;s===0&&(o[t]=by());for(var u=o[t],f=s;f<a;f++){var g=r[f]=e.parseAndCollect(r[f]);isNaN(g)||(u[0]=Math.min(g,u[0]),u[1]=Math.max(g,u[1]))}n.ordinalMeta=e,n.ordinalOffset=a,n.type="ordinal"},i.prototype.getOrdinalMeta=function(t){var e=this._dimensions[t],r=e.ordinalMeta;return r},i.prototype.getDimensionProperty=function(t){var e=this._dimensions[t];return e&&e.property},i.prototype.appendData=function(t){var e=this._provider,r=this.count();e.appendData(t);var n=e.count();return e.persistent||(n+=r),r<n&&this._initDataFromProvider(r,n,!0),[r,n]},i.prototype.appendValues=function(t,e){for(var r=this._chunks,n=this._dimensions,o=n.length,s=this._rawExtent,a=this.count(),u=a+Math.max(t.length,e||0),f=0;f<o;f++){var g=n[f];Zj(r,f,g.type,u,!0)}for(var v=[],y=a;y<u;y++)for(var w=y-a,I=0;I<o;I++){var g=n[I],E=oR.arrayRows.call(this,t[w]||v,g.property,w,I);r[I][y]=E;var D=s[I];E<D[0]&&(D[0]=E),E>D[1]&&(D[1]=E)}return this._rawCount=this._count=u,{start:a,end:u}},i.prototype._initDataFromProvider=function(t,e,r){for(var n=this._provider,o=this._chunks,s=this._dimensions,a=s.length,u=this._rawExtent,f=ti(s,function(z){return z.property}),g=0;g<a;g++){var v=s[g];u[g]||(u[g]=by()),Zj(o,g,v.type,e,r)}if(n.fillStorage)n.fillStorage(t,e,o,u);else for(var y=[],w=t;w<e;w++){y=n.getItem(w,y);for(var I=0;I<a;I++){var E=o[I],D=this._dimValueGetter(y,f[I],w,I);E[w]=D;var R=u[I];D<R[0]&&(R[0]=D),D>R[1]&&(R[1]=D)}}!n.persistent&&n.clean&&n.clean(),this._rawCount=this._count=e,this._extent=[]},i.prototype.count=function(){return this._count},i.prototype.get=function(t,e){if(!(e>=0&&e<this._count))return NaN;var r=this._chunks[t];return r?r[this.getRawIndex(e)]:NaN},i.prototype.getValues=function(t,e){var r=[],n=[];if(e==null){e=t,t=[];for(var o=0;o<this._dimensions.length;o++)n.push(o)}else n=t;for(var o=0,s=n.length;o<s;o++)r.push(this.get(n[o],e));return r},i.prototype.getByRawIndex=function(t,e){if(!(e>=0&&e<this._rawCount))return NaN;var r=this._chunks[t];return r?r[e]:NaN},i.prototype.getSum=function(t){var e=this._chunks[t],r=0;if(e)for(var n=0,o=this.count();n<o;n++){var s=this.get(t,n);isNaN(s)||(r+=s)}return r},i.prototype.getMedian=function(t){var e=[];this.each([t],function(o){isNaN(o)||e.push(o)});var r=e.sort(function(o,s){return o-s}),n=this.count();return n===0?0:n%2===1?r[(n-1)/2]:(r[n/2]+r[n/2-1])/2},i.prototype.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var e=this._indices,r=e[t];if(r!=null&&r<this._count&&r===t)return t;for(var n=0,o=this._count-1;n<=o;){var s=(n+o)/2|0;if(e[s]<t)n=s+1;else if(e[s]>t)o=s-1;else return s}return-1},i.prototype.getIndices=function(){var t,e=this._indices;if(e){var r=e.constructor,n=this._count;if(r===Array){t=new r(n);for(var o=0;o<n;o++)t[o]=e[o]}else t=new r(e.buffer,0,n)}else{var r=xy(this._rawCount);t=new r(this.count());for(var o=0;o<t.length;o++)t[o]=o}return t},i.prototype.filter=function(t,e){if(!this._count)return this;for(var r=this.clone(),n=r.count(),o=xy(r._rawCount),s=new o(n),a=[],u=t.length,f=0,g=t[0],v=r._chunks,y=0;y<n;y++){var w=void 0,I=r.getRawIndex(y);if(u===0)w=e(y);else if(u===1){var E=v[g][I];w=e(E,y)}else{for(var D=0;D<u;D++)a[D]=v[t[D]][I];a[D]=y,w=e.apply(null,a)}w&&(s[f++]=I)}return f<n&&(r._indices=s),r._count=f,r._extent=[],r._updateGetRawIdx(),r},i.prototype.selectRange=function(t){var e=this.clone(),r=e._count;if(!r)return this;var n=on(t),o=n.length;if(!o)return this;var s=e.count(),a=xy(e._rawCount),u=new a(s),f=0,g=n[0],v=t[g][0],y=t[g][1],w=e._chunks,I=!1;if(!e._indices){var E=0;if(o===1){for(var D=w[n[0]],R=0;R<r;R++){var z=D[R];(z>=v&&z<=y||isNaN(z))&&(u[f++]=E),E++}I=!0}else if(o===2){for(var D=w[n[0]],N=w[n[1]],H=t[n[1]][0],$=t[n[1]][1],R=0;R<r;R++){var z=D[R],X=N[R];(z>=v&&z<=y||isNaN(z))&&(X>=H&&X<=$||isNaN(X))&&(u[f++]=E),E++}I=!0}}if(!I)if(o===1)for(var R=0;R<s;R++){var K=e.getRawIndex(R),z=w[n[0]][K];(z>=v&&z<=y||isNaN(z))&&(u[f++]=K)}else for(var R=0;R<s;R++){for(var et=!0,K=e.getRawIndex(R),rt=0;rt<o;rt++){var lt=n[rt],z=w[lt][K];(z<t[lt][0]||z>t[lt][1])&&(et=!1)}et&&(u[f++]=e.getRawIndex(R))}return f<s&&(e._indices=u),e._count=f,e._extent=[],e._updateGetRawIdx(),e},i.prototype.map=function(t,e){var r=this.clone(t);return this._updateDims(r,t,e),r},i.prototype.modify=function(t,e){this._updateDims(this,t,e)},i.prototype._updateDims=function(t,e,r){for(var n=t._chunks,o=[],s=e.length,a=t.count(),u=[],f=t._rawExtent,g=0;g<e.length;g++)f[e[g]]=by();for(var v=0;v<a;v++){for(var y=t.getRawIndex(v),w=0;w<s;w++)u[w]=n[e[w]][y];u[s]=v;var I=r&&r.apply(null,u);if(I!=null){typeof I!="object"&&(o[0]=I,I=o);for(var g=0;g<I.length;g++){var E=e[g],D=I[g],R=f[E],z=n[E];z&&(z[y]=D),D<R[0]&&(R[0]=D),D>R[1]&&(R[1]=D)}}}},i.prototype.lttbDownSample=function(t,e){var r=this.clone([t],!0),n=r._chunks,o=n[t],s=this.count(),a=0,u=Math.floor(1/e),f=this.getRawIndex(0),g,v,y,w=new(xy(this._rawCount))(Math.min((Math.ceil(s/u)+2)*2,s));w[a++]=f;for(var I=1;I<s-1;I+=u){for(var E=Math.min(I+u,s-1),D=Math.min(I+u*2,s),R=(D+E)/2,z=0,N=E;N<D;N++){var H=this.getRawIndex(N),$=o[H];isNaN($)||(z+=$)}z/=D-E;var X=I,K=Math.min(I+u,s),et=I-1,rt=o[f];g=-1,y=X;for(var lt=-1,ht=0,N=X;N<K;N++){var H=this.getRawIndex(N),$=o[H];if(isNaN($)){ht++,lt<0&&(lt=H);continue}v=Math.abs((et-R)*($-rt)-(et-N)*(z-rt)),v>g&&(g=v,y=H)}ht>0&&ht<K-X&&(w[a++]=Math.min(lt,y),y=Math.max(lt,y)),w[a++]=y,f=y}return w[a++]=this.getRawIndex(s-1),r._count=a,r._indices=w,r.getRawIndex=this._getRawIdx,r},i.prototype.minmaxDownSample=function(t,e){for(var r=this.clone([t],!0),n=r._chunks,o=Math.floor(1/e),s=n[t],a=this.count(),u=new(xy(this._rawCount))(Math.ceil(a/o)*2),f=0,g=0;g<a;g+=o){var v=g,y=s[this.getRawIndex(v)],w=g,I=s[this.getRawIndex(w)],E=o;g+o>a&&(E=a-g);for(var D=0;D<E;D++){var R=this.getRawIndex(g+D),z=s[R];z<y&&(y=z,v=g+D),z>I&&(I=z,w=g+D)}var N=this.getRawIndex(v),H=this.getRawIndex(w);v<w?(u[f++]=N,u[f++]=H):(u[f++]=H,u[f++]=N)}return r._count=f,r._indices=u,r._updateGetRawIdx(),r},i.prototype.downSample=function(t,e,r,n){for(var o=this.clone([t],!0),s=o._chunks,a=[],u=Math.floor(1/e),f=s[t],g=this.count(),v=o._rawExtent[t]=by(),y=new(xy(this._rawCount))(Math.ceil(g/u)),w=0,I=0;I<g;I+=u){u>g-I&&(u=g-I,a.length=u);for(var E=0;E<u;E++){var D=this.getRawIndex(I+E);a[E]=f[D]}var R=r(a),z=this.getRawIndex(Math.min(I+n(a,R)||0,g-1));f[z]=R,R<v[0]&&(v[0]=R),R>v[1]&&(v[1]=R),y[w++]=z}return o._count=w,o._indices=y,o._updateGetRawIdx(),o},i.prototype.each=function(t,e){if(this._count)for(var r=t.length,n=this._chunks,o=0,s=this.count();o<s;o++){var a=this.getRawIndex(o);switch(r){case 0:e(o);break;case 1:e(n[t[0]][a],o);break;case 2:e(n[t[0]][a],n[t[1]][a],o);break;default:for(var u=0,f=[];u<r;u++)f[u]=n[t[u]][a];f[u]=o,e.apply(null,f)}}},i.prototype.getDataExtent=function(t){var e=this._chunks[t],r=by();if(!e)return r;var n=this.count(),o=!this._indices,s;if(o)return this._rawExtent[t].slice();if(s=this._extent[t],s)return s.slice();s=r;for(var a=s[0],u=s[1],f=0;f<n;f++){var g=this.getRawIndex(f),v=e[g];v<a&&(a=v),v>u&&(u=v)}return s=[a,u],this._extent[t]=s,s},i.prototype.getRawDataItem=function(t){var e=this.getRawIndex(t);if(this._provider.persistent)return this._provider.getItem(e);for(var r=[],n=this._chunks,o=0;o<n.length;o++)r.push(n[o][e]);return r},i.prototype.clone=function(t,e){var r=new i,n=this._chunks,o=t&&yh(t,function(a,u){return a[u]=!0,a},{});if(o)for(var s=0;s<n.length;s++)r._chunks[s]=o[s]?xbt(n[s]):n[s];else r._chunks=n;return this._copyCommonProps(r),e||(r._indices=this._cloneIndices()),r._updateGetRawIdx(),r},i.prototype._copyCommonProps=function(t){t._count=this._count,t._rawCount=this._rawCount,t._provider=this._provider,t._dimensions=this._dimensions,t._extent=Yi(this._extent),t._rawExtent=Yi(this._rawExtent)},i.prototype._cloneIndices=function(){if(this._indices){var t=this._indices.constructor,e=void 0;if(t===Array){var r=this._indices.length;e=new t(r);for(var n=0;n<r;n++)e[n]=this._indices[n]}else e=new t(this._indices);return e}return null},i.prototype._getRawIdxIdentity=function(t){return t},i.prototype._getRawIdx=function(t){return t<this._count&&t>=0?this._indices[t]:-1},i.prototype._updateGetRawIdx=function(){this.getRawIndex=this._indices?this._getRawIdx:this._getRawIdxIdentity},i.internalField=function(){function t(e,r,n,o){return Tp(e[o],this._dimensions[o])}oR={arrayRows:t,objectRows:function(e,r,n,o){return Tp(e[r],this._dimensions[o])},keyedColumns:t,original:function(e,r,n,o){var s=e&&(e.value==null?e:e.value);return Tp(s instanceof Array?s[o]:s,this._dimensions[o])},typedArray:function(e,r,n,o){return e[o]}}}(),i}(),JJ=function(){function i(t){this._sourceList=[],this._storeList=[],this._upstreamSignList=[],this._versionSignBase=0,this._dirty=!0,this._sourceHost=t}return i.prototype.dirty=function(){this._setLocalSource([],[]),this._storeList=[],this._dirty=!0},i.prototype._setLocalSource=function(t,e){this._sourceList=t,this._upstreamSignList=e,this._versionSignBase++,this._versionSignBase>9e10&&(this._versionSignBase=0)},i.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},i.prototype.prepareSource=function(){this._isDirty()&&(this._createSource(),this._dirty=!1)},i.prototype._createSource=function(){this._setLocalSource([],[]);var t=this._sourceHost,e=this._getUpstreamSourceManagers(),r=!!e.length,n,o;if(MA(t)){var s=t,a=void 0,u=void 0,f=void 0;if(r){var g=e[0];g.prepareSource(),f=g.getSource(),a=f.data,u=f.sourceFormat,o=[g._getVersionSign()]}else a=s.get("data",!0),u=zl(a)?Sp:nc,o=[];var v=this._getSourceMetaRawOption()||{},y=f&&f.metaRawOption||{},w=Ui(v.seriesLayoutBy,y.seriesLayoutBy)||null,I=Ui(v.sourceHeader,y.sourceHeader),E=Ui(v.dimensions,y.dimensions),D=w!==y.seriesLayoutBy||!!I!=!!y.sourceHeader||E;n=D?[pz(a,{seriesLayoutBy:w,sourceHeader:I,dimensions:E},u)]:[]}else{var R=t;if(r){var z=this._applyTransform(e);n=z.sourceList,o=z.upstreamSignList}else{var N=R.get("source",!0);n=[pz(N,this._getSourceMetaRawOption(),null)],o=[]}}this._setLocalSource(n,o)},i.prototype._applyTransform=function(t){var e=this._sourceHost,r=e.get("transform",!0),n=e.get("fromTransformResult",!0);if(n!=null){var o="";t.length!==1&&Xj(o)}var s,a=[],u=[];return gt(t,function(f){f.prepareSource();var g=f.getSource(n||0),v="";n!=null&&!g&&Xj(v),a.push(g),u.push(f._getVersionSign())}),r?s=mbt(r,a,{datasetIndex:e.componentIndex}):n!=null&&(s=[K1t(a[0])]),{sourceList:s,upstreamSignList:u}},i.prototype._isDirty=function(){if(this._dirty)return!0;for(var t=this._getUpstreamSourceManagers(),e=0;e<t.length;e++){var r=t[e];if(r._isDirty()||this._upstreamSignList[e]!==r._getVersionSign())return!0}},i.prototype.getSource=function(t){t=t||0;var e=this._sourceList[t];if(!e){var r=this._getUpstreamSourceManagers();return r[0]&&r[0].getSource(t)}return e},i.prototype.getSharedDataStore=function(t){var e=t.makeStoreSchema();return this._innerGetDataStore(e.dimensions,t.source,e.hash)},i.prototype._innerGetDataStore=function(t,e,r){var n=0,o=this._storeList,s=o[n];s||(s=o[n]={});var a=s[r];if(!a){var u=this._getUpstreamSourceManagers()[0];MA(this._sourceHost)&&u?a=u._innerGetDataStore(t,e,r):(a=new gz,a.initData(new GJ(e,t.length),t)),s[r]=a}return a},i.prototype._getUpstreamSourceManagers=function(){var t=this._sourceHost;if(MA(t)){var e=n3(t);return e?[e.getSourceManager()]:[]}else return ti(T1t(t),function(r){return r.getSourceManager()})},i.prototype._getSourceMetaRawOption=function(){var t=this._sourceHost,e,r,n;if(MA(t))e=t.get("seriesLayoutBy",!0),r=t.get("sourceHeader",!0),n=t.get("dimensions",!0);else if(!this._getUpstreamSourceManagers().length){var o=t;e=o.get("seriesLayoutBy",!0),r=o.get("sourceHeader",!0),n=o.get("dimensions",!0)}return{seriesLayoutBy:e,sourceHeader:r,dimensions:n}},i}();function qj(i){var t=i.option.transform;t&&wM(i.option.transform)}function MA(i){return i.mainType==="series"}function Xj(i){throw new Error(i)}var bbt="line-height:1";function QJ(i){var t=i.lineHeight;return t==null?bbt:"line-height:"+Rs(t+"")+"px"}function tQ(i,t){var e=i.color||_e.color.tertiary,r=i.fontSize||12,n=i.fontWeight||"400",o=i.color||_e.color.secondary,s=i.fontSize||14,a=i.fontWeight||"900";return t==="html"?{nameStyle:"font-size:"+Rs(r+"")+"px;color:"+Rs(e)+";font-weight:"+Rs(n+""),valueStyle:"font-size:"+Rs(s+"")+"px;color:"+Rs(o)+";font-weight:"+Rs(a+"")}:{nameStyle:{fontSize:r,fill:e,fontWeight:n},valueStyle:{fontSize:s,fill:o,fontWeight:a}}}var wbt=[0,10,20,30],Sbt=["",`
`,`

`,`


`];function xo(i,t){return t.type=i,t}function mz(i){return i.type==="section"}function eQ(i){return mz(i)?Tbt:Abt}function iQ(i){if(mz(i)){var t=0,e=i.blocks.length,r=e>1||e>0&&!i.noHeader;return gt(i.blocks,function(n){var o=iQ(n);o>=t&&(t=o+ +(r&&(!o||mz(n)&&!n.noHeader)))}),t}return 0}function Tbt(i,t,e,r){var n=t.noHeader,o=Ibt(iQ(t)),s=[],a=t.blocks||[];Vs(!a||Ye(a)),a=a||[];var u=i.orderMode;if(t.sortBlocks&&u){a=a.slice();var f={valueAsc:"asc",valueDesc:"desc"};if(Di(f,u)){var g=new qJ(f[u],null);a.sort(function(E,D){return g.evaluate(E.sortParam,D.sortParam)})}else u==="seriesDesc"&&a.reverse()}gt(a,function(E,D){var R=t.valueFormatter,z=eQ(E)(R?Fe(Fe({},i),{valueFormatter:R}):i,E,D>0?o.html:0,r);z!=null&&s.push(z)});var v=i.renderMode==="richText"?s.join(o.richText):vz(r,s.join(""),n?e:o.html);if(n)return v;var y=uz(t.header,"ordinal",i.useUTC),w=tQ(r,i.renderMode).nameStyle,I=QJ(r);return i.renderMode==="richText"?rQ(i,y,w)+o.richText+v:vz(r,'<div style="'+w+";"+I+';">'+Rs(y)+"</div>"+v,e)}function Abt(i,t,e,r){var n=i.renderMode,o=t.noName,s=t.noValue,a=!t.markerType,u=t.name,f=i.useUTC,g=t.valueFormatter||i.valueFormatter||function(H){return H=Ye(H)?H:[H],ti(H,function($,X){return uz($,Ye(w)?w[X]:w,f)})};if(!(o&&s)){var v=a?"":i.markupStyleCreator.makeTooltipMarker(t.markerType,t.markerColor||_e.color.secondary,n),y=o?"":uz(u,"ordinal",f),w=t.valueType,I=s?[]:g(t.value,t.dataIndex),E=!a||!o,D=!a&&o,R=tQ(r,n),z=R.nameStyle,N=R.valueStyle;return n==="richText"?(a?"":v)+(o?"":rQ(i,y,z))+(s?"":Ebt(i,I,E,D,N)):vz(r,(a?"":v)+(o?"":Mbt(y,!a,z))+(s?"":Cbt(I,E,D,N)),e)}}function Yj(i,t,e,r,n,o){if(i){var s=eQ(i),a={useUTC:n,renderMode:e,orderMode:r,markupStyleCreator:t,valueFormatter:i.valueFormatter};return s(a,i,0,o)}}function Ibt(i){return{html:wbt[i],richText:Sbt[i]}}function vz(i,t,e){var r='<div style="clear:both"></div>',n="margin: "+e+"px 0 0",o=QJ(i);return'<div style="'+n+";"+o+';">'+t+r+"</div>"}function Mbt(i,t,e){var r=t?"margin-left:2px":"";return'<span style="'+e+";"+r+'">'+Rs(i)+"</span>"}function Cbt(i,t,e,r){var n=e?"10px":"20px",o=t?"float:right;margin-left:"+n:"";return i=Ye(i)?i:[i],'<span style="'+o+";"+r+'">'+ti(i,function(s){return Rs(s)}).join("&nbsp;&nbsp;")+"</span>"}function rQ(i,t,e){return i.markupStyleCreator.wrapRichTextStyle(t,e)}function Ebt(i,t,e,r,n){var o=[n],s=r?10:20;return e&&o.push({padding:[0,0,0,s],align:"right"}),i.markupStyleCreator.wrapRichTextStyle(Ye(t)?t.join("  "):t,o)}function nQ(i,t){var e=i.getData().getItemVisual(t,"style"),r=e[i.visualDrawType];return _v(r)}function aQ(i,t){var e=i.get("padding");return e??(t==="richText"?[8,10]:10)}var sR=function(){function i(){this.richTextStyles={},this._nextStyleNameId=YY()}return i.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},i.prototype.makeTooltipMarker=function(t,e,r){var n=r==="richText"?this._generateStyleName():null,o=f1t({color:e,type:t,renderMode:r,markerId:n});return bi(o)?o:(this.richTextStyles[n]=o.style,o.content)},i.prototype.wrapRichTextStyle=function(t,e){var r={};Ye(e)?gt(e,function(o){return Fe(r,o)}):Fe(r,e);var n=this._generateStyleName();return this.richTextStyles[n]=r,"{"+n+"|"+t+"}"},i}();function oQ(i){var t=i.series,e=i.dataIndex,r=i.multipleSeries,n=t.getData(),o=n.mapDimensionsAll("defaultedTooltip"),s=o.length,a=t.getRawValue(e),u=Ye(a),f=nQ(t,e),g,v,y,w;if(s>1||u&&!s){var I=Dbt(a,t,e,o,f);g=I.inlineValues,v=I.inlineValueTypes,y=I.blocks,w=I.inlineValues[0]}else if(s){var E=n.getDimensionInfo(o[0]);w=g=w0(n,e,o[0]),v=E.type}else w=g=u?a[0]:a;var D=CF(t),R=D&&t.name||"",z=n.getName(e),N=r?R:z;return xo("section",{header:R,noHeader:r||!D,sortParam:w,blocks:[xo("nameValue",{markerType:"item",markerColor:f,name:N,noName:!Ec(N),value:g,valueType:v,dataIndex:e})].concat(y||[])})}function Dbt(i,t,e,r,n){var o=t.getData(),s=yh(i,function(v,y,w){var I=o.getDimensionInfo(w);return v=v||I&&I.tooltip!==!1&&I.displayName!=null},!1),a=[],u=[],f=[];r.length?gt(r,function(v){g(w0(o,e,v),v)}):gt(i,g);function g(v,y){var w=o.getDimensionInfo(y);!w||w.otherDims.tooltip===!1||(s?f.push(xo("nameValue",{markerType:"subItem",markerColor:n,name:w.displayName,value:v,valueType:w.type})):(a.push(v),u.push(w.type)))}return{inlineValues:a,inlineValueTypes:u,blocks:f}}var Uf=Wr();function CA(i,t){return i.getName(t)||i.getId(t)}var KI="__universalTransitionEnabled",bE=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._selectedDataIndicesMap={},e}return t.prototype.init=function(e,r,n){this.seriesIndex=this.componentIndex,this.dataTask=Ew({count:Lbt,reset:Rbt}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(e,n);var o=Uf(this).sourceManager=new JJ(this);o.prepareSource();var s=this.getInitialData(e,n);Jj(s,this),this.dataTask.context.data=s,Uf(this).dataBeforeProcessed=s,Kj(this),this._initSelectedMapFromData(s)},t.prototype.mergeDefaultAndTheme=function(e,r){var n=aS(this),o=n?Iv(e):{},s=this.subType;gn.hasClass(s)&&(s+="Series"),Er(e,r.getTheme().get(this.subType)),Er(e,this.getDefaultOption()),dv(e,"label",["show"]),this.fillDataTextStyle(e.data),n&&Sh(e,o,n)},t.prototype.mergeOption=function(e,r){e=Er(this.option,e,!0),this.fillDataTextStyle(e.data);var n=aS(this);n&&Sh(this.option,e,n);var o=Uf(this).sourceManager;o.dirty(),o.prepareSource();var s=this.getInitialData(e,r);Jj(s,this),this.dataTask.dirty(),this.dataTask.context.data=s,Uf(this).dataBeforeProcessed=s,Kj(this),this._initSelectedMapFromData(s)},t.prototype.fillDataTextStyle=function(e){if(e&&!zl(e))for(var r=["show"],n=0;n<e.length;n++)e[n]&&e[n].label&&dv(e[n],"label",r)},t.prototype.getInitialData=function(e,r){},t.prototype.appendData=function(e){var r=this.getRawData();r.appendData(e.data)},t.prototype.getData=function(e){var r=_z(this);if(r){var n=r.context.data;return e==null||!n.getLinkedData?n:n.getLinkedData(e)}else return Uf(this).data},t.prototype.getAllData=function(){var e=this.getData();return e&&e.getLinkedDataAll?e.getLinkedDataAll():[{data:e}]},t.prototype.setData=function(e){var r=_z(this);if(r){var n=r.context;n.outputData=e,r!==this.dataTask&&(n.data=e)}Uf(this).data=e},t.prototype.getEncode=function(){var e=this.get("encode",!0);if(e)return Fi(e)},t.prototype.getSourceManager=function(){return Uf(this).sourceManager},t.prototype.getSource=function(){return this.getSourceManager().getSource()},t.prototype.getRawData=function(){return Uf(this).dataBeforeProcessed},t.prototype.getColorBy=function(){var e=this.get("colorBy");return e||"series"},t.prototype.isColorBySeries=function(){return this.getColorBy()==="series"},t.prototype.getBaseAxis=function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()},t.prototype.indicesOfNearest=function(e,r,n,o){var s=this.getData(),a=this.coordinateSystem,u=a&&a.getAxis(e);if(!a||!u)return[];var f=u.dataToCoord(n);o==null&&(o=1/0);var g=[],v=1/0,y=-1,w=0;return s.each(r,function(I,E){var D=u.dataToCoord(I),R=f-D,z=Math.abs(R);z<=o&&((z<v||z===v&&R>=0&&y<0)&&(v=z,y=R,w=0),R===y&&(g[w++]=E))}),g.length=w,g},t.prototype.formatTooltip=function(e,r,n){return oQ({series:this,dataIndex:e,multipleSeries:r})},t.prototype.isAnimationEnabled=function(){var e=this.ecModel;if(Sn.node&&!(e&&e.ssr))return!1;var r=this.getShallow("animation");return r&&this.getData().count()>this.getShallow("animationThreshold")&&(r=!1),!!r},t.prototype.restoreData=function(){this.dataTask.dirty()},t.prototype.getColorFromPalette=function(e,r,n){var o=this.ecModel,s=a3.prototype.getColorFromPalette.call(this,e,r,n);return s||(s=o.getColorFromPalette(e,r,n)),s},t.prototype.coordDimToDataDim=function(e){return this.getRawData().mapDimensionsAll(e)},t.prototype.getProgressive=function(){return this.get("progressive")},t.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},t.prototype.select=function(e,r){this._innerSelect(this.getData(r),e)},t.prototype.unselect=function(e,r){var n=this.option.selectedMap;if(n){var o=this.option.selectedMode,s=this.getData(r);if(o==="series"||n==="all"){this.option.selectedMap={},this._selectedDataIndicesMap={};return}for(var a=0;a<e.length;a++){var u=e[a],f=CA(s,u);n[f]=!1,this._selectedDataIndicesMap[f]=-1}}},t.prototype.toggleSelect=function(e,r){for(var n=[],o=0;o<e.length;o++)n[0]=e[o],this.isSelected(e[o],r)?this.unselect(n,r):this.select(n,r)},t.prototype.getSelectedDataIndices=function(){if(this.option.selectedMap==="all")return[].slice.call(this.getData().getIndices());for(var e=this._selectedDataIndicesMap,r=on(e),n=[],o=0;o<r.length;o++){var s=e[r[o]];s>=0&&n.push(s)}return n},t.prototype.isSelected=function(e,r){var n=this.option.selectedMap;if(!n)return!1;var o=this.getData(r);return(n==="all"||n[CA(o,e)])&&!o.getItemModel(e).get(["select","disabled"])},t.prototype.isUniversalTransitionEnabled=function(){if(this[KI])return!0;var e=this.option.universalTransition;return e?e===!0?!0:e&&e.enabled:!1},t.prototype._innerSelect=function(e,r){var n,o,s=this.option,a=s.selectedMode,u=r.length;if(!(!a||!u)){if(a==="series")s.selectedMap="all";else if(a==="multiple"){nr(s.selectedMap)||(s.selectedMap={});for(var f=s.selectedMap,g=0;g<u;g++){var v=r[g],y=CA(e,v);f[y]=!0,this._selectedDataIndicesMap[y]=e.getRawIndex(v)}}else if(a==="single"||a===!0){var w=r[u-1],y=CA(e,w);s.selectedMap=(n={},n[y]=!0,n),this._selectedDataIndicesMap=(o={},o[y]=e.getRawIndex(w),o)}}},t.prototype._initSelectedMapFromData=function(e){if(!this.option.selectedMap){var r=[];e.hasItemOption&&e.each(function(n){var o=e.getRawDataItem(n);o&&o.selected&&r.push(n)}),r.length>0&&this._innerSelect(e,r)}},t.registerClass=function(e){return gn.registerClass(e)},t.protoInitialize=function(){var e=t.prototype;e.type="series.__base__",e.seriesIndex=0,e.ignoreStyleOnData=!1,e.hasSymbolVisual=!1,e.defaultSymbol="circle",e.visualStyleAccessPath="itemStyle",e.visualDrawType="fill"}(),t}(gn);wo(bE,yE);wo(bE,a3);aK(bE,gn);function Kj(i){var t=i.name;CF(i)||(i.name=Pbt(i)||t)}function Pbt(i){var t=i.getRawData(),e=t.mapDimensionsAll("seriesName"),r=[];return gt(e,function(n){var o=t.getDimensionInfo(n);o.displayName&&r.push(o.displayName)}),r.join(" ")}function Lbt(i){return i.model.getRawData().count()}function Rbt(i){var t=i.model;return t.setData(t.getRawData().cloneShallow()),kbt}function kbt(i,t){t.outputData&&i.end>t.outputData.count()&&t.model.getRawData().cloneShallow(t.outputData)}function Jj(i,t){gt(qw(i.CHANGABLE_METHODS,i.DOWNSAMPLE_METHODS),function(e){i.wrapMethod(e,br(Obt,t))})}function Obt(i,t){var e=_z(i);return e&&e.setOutputEnd((t||this).count()),t}function _z(i){var t=(i.ecModel||{}).scheduler,e=t&&t.getPipeline(i.uid);if(e){var r=e.currentTask;if(r){var n=r.agentStubMap;n&&(r=n.get(i.uid))}return r}}const Ea=bE;var u3=function(){function i(){this.group=new Ki,this.uid=H0("viewComponent")}return i.prototype.init=function(t,e){},i.prototype.render=function(t,e,r,n){},i.prototype.dispose=function(t,e){},i.prototype.updateView=function(t,e,r,n){},i.prototype.updateLayout=function(t,e,r,n){},i.prototype.updateVisual=function(t,e,r,n){},i.prototype.toggleBlurSeries=function(t,e,r){},i.prototype.eachRendered=function(t){var e=this.group;e&&e.traverse(t)},i}();DF(u3);iE(u3);const Oa=u3;function W0(){var i=Wr();return function(t){var e=i(t),r=t.pipelineContext,n=!!e.large,o=!!e.progressiveRender,s=e.large=!!(r&&r.large),a=e.progressiveRender=!!(r&&r.progressiveRender);return(n!==s||o!==a)&&"reset"}}var sQ=Wr(),zbt=W0(),h3=function(){function i(){this.group=new Ki,this.uid=H0("viewChart"),this.renderTask=Ew({plan:Bbt,reset:Fbt}),this.renderTask.context={view:this}}return i.prototype.init=function(t,e){},i.prototype.render=function(t,e,r,n){},i.prototype.highlight=function(t,e,r,n){var o=t.getData(n&&n.dataType);o&&t8(o,n,"emphasis")},i.prototype.downplay=function(t,e,r,n){var o=t.getData(n&&n.dataType);o&&t8(o,n,"normal")},i.prototype.remove=function(t,e){this.group.removeAll()},i.prototype.dispose=function(t,e){},i.prototype.updateView=function(t,e,r,n){this.render(t,e,r,n)},i.prototype.updateLayout=function(t,e,r,n){this.render(t,e,r,n)},i.prototype.updateVisual=function(t,e,r,n){this.render(t,e,r,n)},i.prototype.eachRendered=function(t){Hp(this.group,t)},i.markUpdateMethod=function(t,e){sQ(t).updateMethod=e},i.protoInitialize=function(){var t=i.prototype;t.type="chart"}(),i}();function Qj(i,t,e){i&&iS(i)&&(t==="emphasis"?Rd:kd)(i,e)}function t8(i,t,e){var r=fv(i,t),n=t&&t.highlightKey!=null?Q0t(t.highlightKey):null;r!=null?gt(na(r),function(o){Qj(i.getItemGraphicEl(o),e,n)}):i.eachItemGraphicEl(function(o){Qj(o,e,n)})}DF(h3);iE(h3);function Bbt(i){return zbt(i.model)}function Fbt(i){var t=i.model,e=i.ecModel,r=i.api,n=i.payload,o=t.pipelineContext.progressiveRender,s=i.view,a=n&&sQ(n).updateMethod,u=o?"incrementalPrepareRender":a&&s[a]?a:"render";return u!=="render"&&s[u](t,e,r,n),Nbt[u]}var Nbt={incrementalPrepareRender:{progress:function(i,t){t.view.incrementalRender(i,t.model,t.ecModel,t.api,t.payload)}},render:{forceFirstProgress:!0,progress:function(i,t){t.view.render(t.model,t.ecModel,t.api,t.payload)}}};const pa=h3;var UM="\0__throttleOriginMethod",e8="\0__throttleRate",i8="\0__throttleType";function d3(i,t,e){var r,n=0,o=0,s=null,a,u,f,g;t=t||0;function v(){o=new Date().getTime(),s=null,i.apply(u,f||[])}var y=function(){for(var w=[],I=0;I<arguments.length;I++)w[I]=arguments[I];r=new Date().getTime(),u=this,f=w;var E=g||t,D=g||e;g=null,a=r-(D?n:o)-E,clearTimeout(s),D?s=setTimeout(v,E):a>=0?v():s=setTimeout(v,-a),n=r};return y.clear=function(){s&&(clearTimeout(s),s=null)},y.debounceNextCall=function(w){g=w},y}function $0(i,t,e,r){var n=i[t];if(n){var o=n[UM]||n,s=n[i8],a=n[e8];if(a!==e||s!==r){if(e==null||!r)return i[t]=o;n=i[t]=d3(o,e,r==="debounce"),n[UM]=o,n[i8]=r,n[e8]=e}return n}}function sS(i,t){var e=i[t];e&&e[UM]&&(e.clear&&e.clear(),i[t]=e[UM])}var r8=Wr(),n8={itemStyle:pv(aJ,!0),lineStyle:pv(nJ,!0)},Vbt={lineStyle:"stroke",itemStyle:"fill"};function lQ(i,t){var e=i.visualStyleMapper||n8[t];return e||(console.warn("Unknown style type '"+t+"'."),n8.itemStyle)}function cQ(i,t){var e=i.visualDrawType||Vbt[t];return e||(console.warn("Unknown style type '"+t+"'."),"fill")}var Ubt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){var e=i.getData(),r=i.visualStyleAccessPath||"itemStyle",n=i.getModel(r),o=lQ(i,r),s=o(n),a=n.getShallow("decal");a&&(e.setVisual("decal",a),a.dirty=!0);var u=cQ(i,r),f=s[u],g=Xi(f)?f:null,v=s.fill==="auto"||s.stroke==="auto";if(!s[u]||g||v){var y=i.getColorFromPalette(i.name,null,t.getSeriesCount());s[u]||(s[u]=y,e.setVisual("colorFromPalette",!0)),s.fill=s.fill==="auto"||Xi(s.fill)?y:s.fill,s.stroke=s.stroke==="auto"||Xi(s.stroke)?y:s.stroke}if(e.setVisual("style",s),e.setVisual("drawType",u),!t.isSeriesFiltered(i)&&g)return e.setVisual("colorFromPalette",!1),{dataEach:function(w,I){var E=i.getDataParams(I),D=Fe({},s);D[u]=g(E),w.setItemVisual(I,"style",D)}}}},yb=new bn,Gbt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){if(!(i.ignoreStyleOnData||t.isSeriesFiltered(i))){var e=i.getData(),r=i.visualStyleAccessPath||"itemStyle",n=lQ(i,r),o=e.getVisual("drawType");return{dataEach:e.hasItemOption?function(s,a){var u=s.getRawDataItem(a);if(u&&u[r]){yb.option=u[r];var f=n(yb),g=s.ensureUniqueItemVisual(a,"style");Fe(g,f),yb.option.decal&&(s.setItemVisual(a,"decal",yb.option.decal),yb.option.decal.dirty=!0),o in f&&s.setItemVisual(a,"colorFromPalette",!1)}}:null}}}},Hbt={performRawSeries:!0,overallReset:function(i){var t=Fi();i.eachSeries(function(e){var r=e.getColorBy();if(!e.isColorBySeries()){var n=e.type+"-"+r,o=t.get(n);o||(o={},t.set(n,o)),r8(e).scope=o}}),i.eachSeries(function(e){if(!(e.isColorBySeries()||i.isSeriesFiltered(e))){var r=e.getRawData(),n={},o=e.getData(),s=r8(e).scope,a=e.visualStyleAccessPath||"itemStyle",u=cQ(e,a);o.each(function(f){var g=o.getRawIndex(f);n[g]=f}),r.each(function(f){var g=n[f],v=o.getItemVisual(g,"colorFromPalette");if(v){var y=o.ensureUniqueItemVisual(g,"style"),w=r.getName(f)||f+"",I=r.count();y[u]=e.getColorFromPalette(w,s,I)}})}})}},EA=Math.PI;function jbt(i,t){t=t||{},rr(t,{text:"loading",textColor:_e.color.primary,fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255,255,255,0.8)",showSpinner:!0,color:_e.color.theme[0],spinnerRadius:10,lineWidth:5,zlevel:0});var e=new Ki,r=new jr({style:{fill:t.maskColor},zlevel:t.zlevel,z:1e4});e.add(r);var n=new _n({style:{text:t.text,fill:t.textColor,fontSize:t.fontSize,fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:t.fontFamily},zlevel:t.zlevel,z:10001}),o=new jr({style:{fill:"none"},textContent:n,textConfig:{position:"right",distance:10},zlevel:t.zlevel,z:10001});e.add(o);var s;return t.showSpinner&&(s=new UF({shape:{startAngle:-EA/2,endAngle:-EA/2+.1,r:t.spinnerRadius},style:{stroke:t.color,lineCap:"round",lineWidth:t.lineWidth},zlevel:t.zlevel,z:10001}),s.animateShape(!0).when(1e3,{endAngle:EA*3/2}).start("circularInOut"),s.animateShape(!0).when(1e3,{startAngle:EA*3/2}).delay(300).start("circularInOut"),e.add(s)),e.resize=function(){var a=n.getBoundingRect().width,u=t.showSpinner?t.spinnerRadius:0,f=(i.getWidth()-u*2-(t.showSpinner&&a?10:0)-a)/2-(t.showSpinner&&a?0:5+a/2)+(t.showSpinner?0:a/2)+(a?0:u),g=i.getHeight()/2;t.showSpinner&&s.setShape({cx:f,cy:g}),o.setShape({x:f-u,y:g-u,width:u*2,height:u*2}),r.setShape({x:0,y:0,width:i.getWidth(),height:i.getHeight()})},e.resize(),e}var Wbt=function(){function i(t,e,r,n){this._stageTaskMap=Fi(),this.ecInstance=t,this.api=e,r=this._dataProcessorHandlers=r.slice(),n=this._visualHandlers=n.slice(),this._allHandlers=r.concat(n)}return i.prototype.restoreData=function(t,e){t.restoreData(e),this._stageTaskMap.each(function(r){var n=r.overallTask;n&&n.dirty()})},i.prototype.getPerformArgs=function(t,e){if(t.__pipeline){var r=this._pipelineMap.get(t.__pipeline.id),n=r.context,o=!e&&r.progressiveEnabled&&(!n||n.progressiveRender)&&t.__idxInPipeline>r.blockIndex,s=o?r.step:null,a=n&&n.modDataCount,u=a!=null?Math.ceil(a/s):null;return{step:s,modBy:u,modDataCount:a}}},i.prototype.getPipeline=function(t){return this._pipelineMap.get(t)},i.prototype.updateStreamModes=function(t,e){var r=this._pipelineMap.get(t.uid),n=t.getData(),o=n.count(),s=r.progressiveEnabled&&e.incrementalPrepareRender&&o>=r.threshold,a=t.get("large")&&o>=t.get("largeThreshold"),u=t.get("progressiveChunkMode")==="mod"?o:null;t.pipelineContext=r.context={progressiveRender:s,modDataCount:u,large:a}},i.prototype.restorePipelines=function(t){var e=this,r=e._pipelineMap=Fi();t.eachSeries(function(n){var o=n.getProgressive(),s=n.uid;r.set(s,{id:s,head:null,tail:null,threshold:n.getProgressiveThreshold(),progressiveEnabled:o&&!(n.preventIncremental&&n.preventIncremental()),blockIndex:-1,step:Math.round(o||700),count:0}),e._pipe(n,n.dataTask)})},i.prototype.prepareStageTasks=function(){var t=this._stageTaskMap,e=this.api.getModel(),r=this.api;gt(this._allHandlers,function(n){var o=t.get(n.uid)||t.set(n.uid,{}),s="";Vs(!(n.reset&&n.overallReset),s),n.reset&&this._createSeriesStageTask(n,o,e,r),n.overallReset&&this._createOverallStageTask(n,o,e,r)},this)},i.prototype.prepareView=function(t,e,r,n){var o=t.renderTask,s=o.context;s.model=e,s.ecModel=r,s.api=n,o.__block=!t.incrementalPrepareRender,this._pipe(e,o)},i.prototype.performDataProcessorTasks=function(t,e){this._performStageTasks(this._dataProcessorHandlers,t,e,{block:!0})},i.prototype.performVisualTasks=function(t,e,r){this._performStageTasks(this._visualHandlers,t,e,r)},i.prototype._performStageTasks=function(t,e,r,n){n=n||{};var o=!1,s=this;gt(t,function(u,f){if(!(n.visualType&&n.visualType!==u.visualType)){var g=s._stageTaskMap.get(u.uid),v=g.seriesTaskMap,y=g.overallTask;if(y){var w,I=y.agentStubMap;I.each(function(D){a(n,D)&&(D.dirty(),w=!0)}),w&&y.dirty(),s.updatePayload(y,r);var E=s.getPerformArgs(y,n.block);I.each(function(D){D.perform(E)}),y.perform(E)&&(o=!0)}else v&&v.each(function(D,R){a(n,D)&&D.dirty();var z=s.getPerformArgs(D,n.block);z.skip=!u.performRawSeries&&e.isSeriesFiltered(D.context.model),s.updatePayload(D,r),D.perform(z)&&(o=!0)})}});function a(u,f){return u.setDirty&&(!u.dirtyMap||u.dirtyMap.get(f.__pipeline.id))}this.unfinished=o||this.unfinished},i.prototype.performSeriesTasks=function(t){var e;t.eachSeries(function(r){e=r.dataTask.perform()||e}),this.unfinished=e||this.unfinished},i.prototype.plan=function(){this._pipelineMap.each(function(t){var e=t.tail;do{if(e.__block){t.blockIndex=e.__idxInPipeline;break}e=e.getUpstream()}while(e)})},i.prototype.updatePayload=function(t,e){e!=="remain"&&(t.context.payload=e)},i.prototype._createSeriesStageTask=function(t,e,r,n){var o=this,s=e.seriesTaskMap,a=e.seriesTaskMap=Fi(),u=t.seriesType,f=t.getTargetSeries;t.createOnAllSeries?r.eachRawSeries(g):u?r.eachRawSeriesByType(u,g):f&&f(r,n).each(g);function g(v){var y=v.uid,w=a.set(y,s&&s.get(y)||Ew({plan:Ybt,reset:Kbt,count:Qbt}));w.context={model:v,ecModel:r,api:n,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:o},o._pipe(v,w)}},i.prototype._createOverallStageTask=function(t,e,r,n){var o=this,s=e.overallTask=e.overallTask||Ew({reset:$bt});s.context={ecModel:r,api:n,overallReset:t.overallReset,scheduler:o};var a=s.agentStubMap,u=s.agentStubMap=Fi(),f=t.seriesType,g=t.getTargetSeries,v=!0,y=!1,w="";Vs(!t.createOnAllSeries,w),f?r.eachRawSeriesByType(f,I):g?g(r,n).each(I):(v=!1,gt(r.getSeries(),I));function I(E){var D=E.uid,R=u.set(D,a&&a.get(D)||(y=!0,Ew({reset:Zbt,onDirty:Xbt})));R.context={model:E,overallProgress:v},R.agent=s,R.__block=v,o._pipe(E,R)}y&&s.dirty()},i.prototype._pipe=function(t,e){var r=t.uid,n=this._pipelineMap.get(r);!n.head&&(n.head=e),n.tail&&n.tail.pipe(e),n.tail=e,e.__idxInPipeline=n.count++,e.__pipeline=n},i.wrapStageHandler=function(t,e){return Xi(t)&&(t={overallReset:t,seriesType:twt(t)}),t.uid=H0("stageHandler"),e&&(t.visualType=e),t},i}();function $bt(i){i.overallReset(i.ecModel,i.api,i.payload)}function Zbt(i){return i.overallProgress&&qbt}function qbt(){this.agent.dirty(),this.getDownstream().dirty()}function Xbt(){this.agent&&this.agent.dirty()}function Ybt(i){return i.plan?i.plan(i.model,i.ecModel,i.api,i.payload):null}function Kbt(i){i.useClearVisual&&i.data.clearAllVisual();var t=i.resetDefines=na(i.reset(i.model,i.ecModel,i.api,i.payload));return t.length>1?ti(t,function(e,r){return uQ(r)}):Jbt}var Jbt=uQ(0);function uQ(i){return function(t,e){var r=e.data,n=e.resetDefines[i];if(n&&n.dataEach)for(var o=t.start;o<t.end;o++)n.dataEach(r,o);else n&&n.progress&&n.progress(t,r)}}function Qbt(i){return i.data.count()}function twt(i){GM=null;try{i(lS,hQ)}catch{}return GM}var lS={},hQ={},GM;dQ(lS,zJ);dQ(hQ,BJ);lS.eachSeriesByType=lS.eachRawSeriesByType=function(i){GM=i};lS.eachComponent=function(i){i.mainType==="series"&&i.subType&&(GM=i.subType)};function dQ(i,t){for(var e in t.prototype)i[e]=uo}const fQ=Wbt;var tr=_e.darkColor,ewt=tr.background,xb=function(){return{axisLine:{lineStyle:{color:tr.axisLine}},splitLine:{lineStyle:{color:tr.axisSplitLine}},splitArea:{areaStyle:{color:[tr.backgroundTint,tr.backgroundTransparent]}},minorSplitLine:{lineStyle:{color:tr.axisMinorSplitLine}},axisLabel:{color:tr.axisLabel},axisName:{}}},a8={label:{color:tr.secondary},itemStyle:{borderColor:tr.borderTint},dividerLineStyle:{color:tr.border}},pQ={darkMode:!0,color:tr.theme,backgroundColor:ewt,axisPointer:{lineStyle:{color:tr.border},crossStyle:{color:tr.borderShade},label:{color:tr.tertiary}},legend:{textStyle:{color:tr.secondary},pageTextStyle:{color:tr.tertiary}},textStyle:{color:tr.secondary},title:{textStyle:{color:tr.primary},subtextStyle:{color:tr.quaternary}},toolbox:{iconStyle:{borderColor:tr.accent50}},tooltip:{backgroundColor:tr.neutral20,defaultBorderColor:tr.border,textStyle:{color:tr.tertiary}},dataZoom:{borderColor:tr.accent10,textStyle:{color:tr.tertiary},brushStyle:{color:tr.backgroundTint},handleStyle:{color:tr.neutral00,borderColor:tr.accent20},moveHandleStyle:{color:tr.accent40},emphasis:{handleStyle:{borderColor:tr.accent50}},dataBackground:{lineStyle:{color:tr.accent30},areaStyle:{color:tr.accent20}},selectedDataBackground:{lineStyle:{color:tr.accent50},areaStyle:{color:tr.accent30}}},visualMap:{textStyle:{color:tr.secondary},handleStyle:{borderColor:tr.neutral30}},timeline:{lineStyle:{color:tr.accent10},label:{color:tr.tertiary},controlStyle:{color:tr.accent30,borderColor:tr.accent30}},calendar:{itemStyle:{color:tr.neutral00,borderColor:tr.neutral20},dayLabel:{color:tr.tertiary},monthLabel:{color:tr.secondary},yearLabel:{color:tr.secondary}},matrix:{x:a8,y:a8,backgroundColor:{borderColor:tr.axisLine},body:{itemStyle:{borderColor:tr.borderTint}}},timeAxis:xb(),logAxis:xb(),valueAxis:xb(),categoryAxis:xb(),line:{symbol:"circle"},graph:{color:tr.theme},gauge:{title:{color:tr.secondary},axisLine:{lineStyle:{color:[[1,tr.neutral05]]}},axisLabel:{color:tr.axisLabel},detail:{color:tr.primary}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}},funnel:{itemStyle:{borderColor:tr.background}},radar:function(){var i=xb();return i.axisName={color:tr.axisLabel},i.axisLine.lineStyle.color=tr.neutral20,i}(),treemap:{breadcrumb:{itemStyle:{color:tr.neutral20,textStyle:{color:tr.secondary}},emphasis:{itemStyle:{color:tr.neutral30}}}},sunburst:{itemStyle:{borderColor:tr.background}},map:{itemStyle:{borderColor:tr.border,areaColor:tr.neutral10},label:{color:tr.tertiary},emphasis:{label:{color:tr.primary},itemStyle:{areaColor:tr.highlight}},select:{label:{color:tr.primary},itemStyle:{areaColor:tr.highlight}}},geo:{itemStyle:{borderColor:tr.border,areaColor:tr.neutral10},emphasis:{label:{color:tr.primary},itemStyle:{areaColor:tr.highlight}},select:{label:{color:tr.primary},itemStyle:{color:tr.highlight}}}};pQ.categoryAxis.splitLine.show=!1;const iwt=pQ;var rwt=function(){function i(){}return i.prototype.normalizeQuery=function(t){var e={},r={},n={};if(bi(t)){var o=lh(t);e.mainType=o.main||null,e.subType=o.sub||null}else{var s=["Index","Name","Id"],a={name:1,dataIndex:1,dataType:1};gt(t,function(u,f){for(var g=!1,v=0;v<s.length;v++){var y=s[v],w=f.lastIndexOf(y);if(w>0&&w===f.length-y.length){var I=f.slice(0,w);I!=="data"&&(e.mainType=I,e[y.toLowerCase()]=u,g=!0)}}a.hasOwnProperty(f)&&(r[f]=u,g=!0),g||(n[f]=u)})}return{cptQuery:e,dataQuery:r,otherQuery:n}},i.prototype.filter=function(t,e){var r=this.eventInfo;if(!r)return!0;var n=r.targetEl,o=r.packedEvent,s=r.model,a=r.view;if(!s||!a)return!0;var u=e.cptQuery,f=e.dataQuery;return g(u,s,"mainType")&&g(u,s,"subType")&&g(u,s,"index","componentIndex")&&g(u,s,"name")&&g(u,s,"id")&&g(f,o,"name")&&g(f,o,"dataIndex")&&g(f,o,"dataType")&&(!a.filterForExposedEvent||a.filterForExposedEvent(t,e.otherQuery,n,o));function g(v,y,w,I){return v[w]==null||y[I||w]===v[w]}},i.prototype.afterTrigger=function(){this.eventInfo=null},i}(),yz=["symbol","symbolSize","symbolRotate","symbolOffset"],o8=yz.concat(["symbolKeepAspect"]),nwt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){var e=i.getData();if(i.legendIcon&&e.setVisual("legendIcon",i.legendIcon),!i.hasSymbolVisual)return;for(var r={},n={},o=!1,s=0;s<yz.length;s++){var a=yz[s],u=i.get(a);Xi(u)?(o=!0,n[a]=u):r[a]=u}if(r.symbol=r.symbol||i.defaultSymbol,e.setVisual(Fe({legendIcon:i.legendIcon||r.symbol,symbolKeepAspect:i.get("symbolKeepAspect")},r)),t.isSeriesFiltered(i))return;var f=on(n);function g(v,y){for(var w=i.getRawValue(y),I=i.getDataParams(y),E=0;E<f.length;E++){var D=f[E];v.setItemVisual(y,D,n[D](w,I))}}return{dataEach:o?g:null}}},awt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){if(!i.hasSymbolVisual||t.isSeriesFiltered(i))return;var e=i.getData();function r(n,o){for(var s=n.getItemModel(o),a=0;a<o8.length;a++){var u=o8[a],f=s.getShallow(u,!0);f!=null&&n.setItemVisual(o,u,f)}}return{dataEach:e.hasItemOption?r:null}}};function f3(i,t,e){switch(e){case"color":var r=i.getItemVisual(t,"style");return r[i.getVisual("drawType")];case"opacity":return i.getItemVisual(t,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return i.getItemVisual(t,e)}}function US(i,t){switch(t){case"color":var e=i.getVisual("style");return e[i.getVisual("drawType")];case"opacity":return i.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return i.getVisual(t)}}function gQ(i,t,e,r){switch(e){case"color":var n=i.ensureUniqueItemVisual(t,"style");n[i.getVisual("drawType")]=r,i.setItemVisual(t,"colorFromPalette",!1);break;case"opacity":i.ensureUniqueItemVisual(t,"style").opacity=r;break;case"symbol":case"symbolSize":case"liftZ":i.setItemVisual(t,e,r);break}}function mQ(i,t){function e(r,n){var o=[];return r.eachComponent({mainType:"series",subType:i,query:n},function(s){o.push(s.seriesIndex)}),o}gt([[i+"ToggleSelect","toggleSelect"],[i+"Select","select"],[i+"UnSelect","unselect"]],function(r){t(r[0],function(n,o,s){n=Fe({},n),s.dispatchAction(Fe(n,{type:r[1],seriesIndex:e(o,n)}))})})}function wy(i,t,e,r,n){var o=i+t;e.isSilent(o)||r.eachComponent({mainType:"series",subType:"pie"},function(s){for(var a=s.seriesIndex,u=s.option.selectedMap,f=n.selected,g=0;g<f.length;g++)if(f[g].seriesIndex===a){var v=s.getData(),y=fv(v,n.fromActionPayload);e.trigger(o,{type:o,seriesId:s.id,name:Ye(y)?v.getName(y[0]):v.getName(y),selected:bi(u)?u:Fe({},u)})}})}function owt(i,t,e){i.on("selectchanged",function(r){var n=e.getModel();r.isFromClick?(wy("map","selectchanged",t,n,r),wy("pie","selectchanged",t,n,r)):r.fromAction==="select"?(wy("map","selected",t,n,r),wy("pie","selected",t,n,r)):r.fromAction==="unselect"&&(wy("map","unselected",t,n,r),wy("pie","unselected",t,n,r))})}function $m(i,t,e){for(var r;i&&!(t(i)&&(r=i,e));)i=i.__hostTarget||i.parent;return r}var swt=Math.round(Math.random()*9),lwt=typeof Object.defineProperty=="function",cwt=function(){function i(){this._id="__ec_inner_"+swt++}return i.prototype.get=function(t){return this._guard(t)[this._id]},i.prototype.set=function(t,e){var r=this._guard(t);return lwt?Object.defineProperty(r,this._id,{value:e,enumerable:!1,configurable:!0}):r[this._id]=e,this},i.prototype.delete=function(t){return this.has(t)?(delete this._guard(t)[this._id],!0):!1},i.prototype.has=function(t){return!!this._guard(t)[this._id]},i.prototype._guard=function(t){if(t!==Object(t))throw TypeError("Value of WeakMap is not a non-null object.");return t},i}();const uwt=cwt;var hwt=qr.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(i,t){var e=t.cx,r=t.cy,n=t.width/2,o=t.height/2;i.moveTo(e,r-o),i.lineTo(e+n,r+o),i.lineTo(e-n,r+o),i.closePath()}}),dwt=qr.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(i,t){var e=t.cx,r=t.cy,n=t.width/2,o=t.height/2;i.moveTo(e,r-o),i.lineTo(e+n,r),i.lineTo(e,r+o),i.lineTo(e-n,r),i.closePath()}}),fwt=qr.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(i,t){var e=t.x,r=t.y,n=t.width/5*3,o=Math.max(n,t.height),s=n/2,a=s*s/(o-s),u=r-o+s+a,f=Math.asin(a/s),g=Math.cos(f)*s,v=Math.sin(f),y=Math.cos(f),w=s*.6,I=s*.7;i.moveTo(e-g,u+a),i.arc(e,u,s,Math.PI-f,Math.PI*2+f),i.bezierCurveTo(e+g-v*w,u+a+y*w,e,r-I,e,r),i.bezierCurveTo(e,r-I,e-g+v*w,u+a+y*w,e-g,u+a),i.closePath()}}),pwt=qr.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(i,t){var e=t.height,r=t.width,n=t.x,o=t.y,s=r/3*2;i.moveTo(n,o),i.lineTo(n+s,o+e),i.lineTo(n,o+e/4*3),i.lineTo(n-s,o+e),i.lineTo(n,o),i.closePath()}}),gwt={line:Ro,rect:jr,roundRect:jr,square:jr,circle:Gp,diamond:dwt,pin:fwt,arrow:pwt,triangle:hwt},mwt={line:function(i,t,e,r,n){n.x1=i,n.y1=t+r/2,n.x2=i+e,n.y2=t+r/2},rect:function(i,t,e,r,n){n.x=i,n.y=t,n.width=e,n.height=r},roundRect:function(i,t,e,r,n){n.x=i,n.y=t,n.width=e,n.height=r,n.r=Math.min(e,r)/4},square:function(i,t,e,r,n){var o=Math.min(e,r);n.x=i,n.y=t,n.width=o,n.height=o},circle:function(i,t,e,r,n){n.cx=i+e/2,n.cy=t+r/2,n.r=Math.min(e,r)/2},diamond:function(i,t,e,r,n){n.cx=i+e/2,n.cy=t+r/2,n.width=e,n.height=r},pin:function(i,t,e,r,n){n.x=i+e/2,n.y=t+r/2,n.width=e,n.height=r},arrow:function(i,t,e,r,n){n.x=i+e/2,n.y=t+r/2,n.width=e,n.height=r},triangle:function(i,t,e,r,n){n.cx=i+e/2,n.cy=t+r/2,n.width=e,n.height=r}},HM={};gt(gwt,function(i,t){HM[t]=new i});var vwt=qr.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(i,t,e){var r=PM(i,t,e),n=this.shape;return n&&n.symbolType==="pin"&&t.position==="inside"&&(r.y=e.y+e.height*.4),r},buildPath:function(i,t,e){var r=t.symbolType;if(r!=="none"){var n=HM[r];n||(r="rect",n=HM[r]),mwt[r](t.x,t.y,t.width,t.height,n.shape),n.buildPath(i,n.shape,e)}}});function _wt(i,t){if(this.type!=="image"){var e=this.style;this.__isEmptyBrush?(e.stroke=i,e.fill=t||_e.color.neutral00,e.lineWidth=2):this.shape.symbolType==="line"?e.stroke=i:e.fill=i,this.markRedraw()}}function bo(i,t,e,r,n,o,s){var a=i.indexOf("empty")===0;a&&(i=i.substr(5,1).toLowerCase()+i.substr(6));var u;return i.indexOf("image://")===0?u=qK(i.slice(8),new sr(t,e,r,n),s?"center":"cover"):i.indexOf("path://")===0?u=rS(i.slice(7),{},new sr(t,e,r,n),s?"center":"cover"):u=new vwt({shape:{symbolType:i,x:t,y:e,width:r,height:n}}),u.__isEmptyBrush=a,u.setColor=_wt,o&&u.setColor(o),u}function Z0(i){return Ye(i)||(i=[+i,+i]),[i[0]||0,i[1]||0]}function Cv(i,t){if(i!=null)return Ye(i)||(i=[i,i]),[xi(i[0],t[0])||0,xi(Ui(i[1],i[0]),t[1])||0]}function Zm(i){return isFinite(i)}function ywt(i,t,e){var r=t.x==null?0:t.x,n=t.x2==null?1:t.x2,o=t.y==null?0:t.y,s=t.y2==null?0:t.y2;t.global||(r=r*e.width+e.x,n=n*e.width+e.x,o=o*e.height+e.y,s=s*e.height+e.y),r=Zm(r)?r:0,n=Zm(n)?n:1,o=Zm(o)?o:0,s=Zm(s)?s:0;var a=i.createLinearGradient(r,o,n,s);return a}function xwt(i,t,e){var r=e.width,n=e.height,o=Math.min(r,n),s=t.x==null?.5:t.x,a=t.y==null?.5:t.y,u=t.r==null?.5:t.r;t.global||(s=s*r+e.x,a=a*n+e.y,u=u*o),s=Zm(s)?s:.5,a=Zm(a)?a:.5,u=u>=0&&Zm(u)?u:.5;var f=i.createRadialGradient(s,a,0,s,a,u);return f}function xz(i,t,e){for(var r=t.type==="radial"?xwt(i,t,e):ywt(i,t,e),n=t.colorStops,o=0;o<n.length;o++)r.addColorStop(n[o].offset,n[o].color);return r}function bwt(i,t){if(i===t||!i&&!t)return!1;if(!i||!t||i.length!==t.length)return!0;for(var e=0;e<i.length;e++)if(i[e]!==t[e])return!0;return!1}function DA(i){return parseInt(i,10)}function Ky(i,t,e){var r=["width","height"][t],n=["clientWidth","clientHeight"][t],o=["paddingLeft","paddingTop"][t],s=["paddingRight","paddingBottom"][t];if(e[r]!=null&&e[r]!=="auto")return parseFloat(e[r]);var a=document.defaultView.getComputedStyle(i);return(i[n]||DA(a[r])||DA(i.style[r]))-(DA(a[o])||0)-(DA(a[s])||0)|0}function wwt(i,t){return!i||i==="solid"||!(t>0)?null:i==="dashed"?[4*t,2*t]:i==="dotted"?[t]:fn(i)?[i]:Ye(i)?i:null}function p3(i){var t=i.style,e=t.lineDash&&t.lineWidth>0&&wwt(t.lineDash,t.lineWidth),r=t.lineDashOffset;if(e){var n=t.strokeNoScale&&i.getLineScale?i.getLineScale():1;n&&n!==1&&(e=ti(e,function(o){return o/n}),r/=n)}return[e,r]}var Swt=new wh(!0);function jM(i){var t=i.stroke;return!(t==null||t==="none"||!(i.lineWidth>0))}function s8(i){return typeof i=="string"&&i!=="none"}function WM(i){var t=i.fill;return t!=null&&t!=="none"}function l8(i,t){if(t.fillOpacity!=null&&t.fillOpacity!==1){var e=i.globalAlpha;i.globalAlpha=t.fillOpacity*t.opacity,i.fill(),i.globalAlpha=e}else i.fill()}function c8(i,t){if(t.strokeOpacity!=null&&t.strokeOpacity!==1){var e=i.globalAlpha;i.globalAlpha=t.strokeOpacity*t.opacity,i.stroke(),i.globalAlpha=e}else i.stroke()}function bz(i,t,e){var r=PF(t.image,t.__image,e);if(rE(r)){var n=i.createPattern(r,t.repeat||"repeat");if(typeof DOMMatrix=="function"&&n&&n.setTransform){var o=new DOMMatrix;o.translateSelf(t.x||0,t.y||0),o.rotateSelf(0,0,(t.rotation||0)*zI),o.scaleSelf(t.scaleX||1,t.scaleY||1),n.setTransform(o)}return n}}function Twt(i,t,e,r){var n,o=jM(e),s=WM(e),a=e.strokePercent,u=a<1,f=!t.path;(!t.silent||u)&&f&&t.createPathProxy();var g=t.path||Swt,v=t.__dirty;if(!r){var y=e.fill,w=e.stroke,I=s&&!!y.colorStops,E=o&&!!w.colorStops,D=s&&!!y.image,R=o&&!!w.image,z=void 0,N=void 0,H=void 0,$=void 0,X=void 0;(I||E)&&(X=t.getBoundingRect()),I&&(z=v?xz(i,y,X):t.__canvasFillGradient,t.__canvasFillGradient=z),E&&(N=v?xz(i,w,X):t.__canvasStrokeGradient,t.__canvasStrokeGradient=N),D&&(H=v||!t.__canvasFillPattern?bz(i,y,t):t.__canvasFillPattern,t.__canvasFillPattern=H),R&&($=v||!t.__canvasStrokePattern?bz(i,w,t):t.__canvasStrokePattern,t.__canvasStrokePattern=$),I?i.fillStyle=z:D&&(H?i.fillStyle=H:s=!1),E?i.strokeStyle=N:R&&($?i.strokeStyle=$:o=!1)}var K=t.getGlobalScale();g.setScale(K[0],K[1],t.segmentIgnoreThreshold);var et,rt;i.setLineDash&&e.lineDash&&(n=p3(t),et=n[0],rt=n[1]);var lt=!0;(f||v&Gy)&&(g.setDPR(i.dpr),u?g.setContext(null):(g.setContext(i),lt=!1),g.reset(),t.buildPath(g,t.shape,r),g.toStatic(),t.pathUpdated()),lt&&g.rebuildPath(i,u?a:1),et&&(i.setLineDash(et),i.lineDashOffset=rt),r||(e.strokeFirst?(o&&c8(i,e),s&&l8(i,e)):(s&&l8(i,e),o&&c8(i,e))),et&&i.setLineDash([])}function Awt(i,t,e){var r=t.__image=PF(e.image,t.__image,t,t.onload);if(!(!r||!rE(r))){var n=e.x||0,o=e.y||0,s=t.getWidth(),a=t.getHeight(),u=r.width/r.height;if(s==null&&a!=null?s=a*u:a==null&&s!=null?a=s/u:s==null&&a==null&&(s=r.width,a=r.height),e.sWidth&&e.sHeight){var f=e.sx||0,g=e.sy||0;i.drawImage(r,f,g,e.sWidth,e.sHeight,n,o,s,a)}else if(e.sx&&e.sy){var f=e.sx,g=e.sy,v=s-f,y=a-g;i.drawImage(r,f,g,v,y,n,o,s,a)}else i.drawImage(r,n,o,s,a)}}function Iwt(i,t,e){var r,n=e.text;if(n!=null&&(n+=""),n){i.font=e.font||Dd,i.textAlign=e.textAlign,i.textBaseline=e.textBaseline;var o=void 0,s=void 0;i.setLineDash&&e.lineDash&&(r=p3(t),o=r[0],s=r[1]),o&&(i.setLineDash(o),i.lineDashOffset=s),e.strokeFirst?(jM(e)&&i.strokeText(n,e.x,e.y),WM(e)&&i.fillText(n,e.x,e.y)):(WM(e)&&i.fillText(n,e.x,e.y),jM(e)&&i.strokeText(n,e.x,e.y)),o&&i.setLineDash([])}}var u8=["shadowBlur","shadowOffsetX","shadowOffsetY"],h8=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function vQ(i,t,e,r,n){var o=!1;if(!r&&(e=e||{},t===e))return!1;if(r||t.opacity!==e.opacity){kl(i,n),o=!0;var s=Math.max(Math.min(t.opacity,1),0);i.globalAlpha=isNaN(s)?iv.opacity:s}(r||t.blend!==e.blend)&&(o||(kl(i,n),o=!0),i.globalCompositeOperation=t.blend||iv.blend);for(var a=0;a<u8.length;a++){var u=u8[a];(r||t[u]!==e[u])&&(o||(kl(i,n),o=!0),i[u]=i.dpr*(t[u]||0))}return(r||t.shadowColor!==e.shadowColor)&&(o||(kl(i,n),o=!0),i.shadowColor=t.shadowColor||iv.shadowColor),o}function d8(i,t,e,r,n){var o=cS(t,n.inHover),s=r?null:e&&cS(e,n.inHover)||{};if(o===s)return!1;var a=vQ(i,o,s,r,n);if((r||o.fill!==s.fill)&&(a||(kl(i,n),a=!0),s8(o.fill)&&(i.fillStyle=o.fill)),(r||o.stroke!==s.stroke)&&(a||(kl(i,n),a=!0),s8(o.stroke)&&(i.strokeStyle=o.stroke)),(r||o.opacity!==s.opacity)&&(a||(kl(i,n),a=!0),i.globalAlpha=o.opacity==null?1:o.opacity),t.hasStroke()){var u=o.lineWidth,f=u/(o.strokeNoScale&&t.getLineScale?t.getLineScale():1);i.lineWidth!==f&&(a||(kl(i,n),a=!0),i.lineWidth=f)}for(var g=0;g<h8.length;g++){var v=h8[g],y=v[0];(r||o[y]!==s[y])&&(a||(kl(i,n),a=!0),i[y]=o[y]||v[1])}return a}function Mwt(i,t,e,r,n){return vQ(i,cS(t,n.inHover),e&&cS(e,n.inHover),r,n)}function _Q(i,t){var e=t.transform,r=i.dpr||1;e?i.setTransform(r*e[0],r*e[1],r*e[2],r*e[3],r*e[4],r*e[5]):i.setTransform(r,0,0,r,0,0)}function Cwt(i,t,e){for(var r=!1,n=0;n<i.length;n++){var o=i[n];r=r||o.isZeroArea(),_Q(t,o),t.beginPath(),o.buildPath(t,o.shape),t.clip()}e.allClipped=r}function Ewt(i,t){return i&&t?i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]||i[4]!==t[4]||i[5]!==t[5]:!(!i&&!t)}var f8=1,p8=2,g8=3,m8=4;function Dwt(i){var t=WM(i),e=jM(i);return!(i.lineDash||!(+t^+e)||t&&typeof i.fill!="string"||e&&typeof i.stroke!="string"||i.strokePercent<1||i.strokeOpacity<1||i.fillOpacity<1)}function kl(i,t){t.batchFill&&i.fill(),t.batchStroke&&i.stroke(),t.batchFill="",t.batchStroke=""}function cS(i,t){return t&&i.__hoverStyle||i.style}function yQ(i,t){qm(i,t,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function qm(i,t,e,r){var n=t.transform;if(!t.shouldBePainted(e.viewWidth,e.viewHeight,!1,!1)){t.__dirty&=~Kl,t.__isRendered=!1;return}var o=t.__clipPaths,s=e.prevElClipPaths,a=!1,u=!1;if((!s||bwt(o,s))&&(s&&s.length&&(kl(i,e),i.restore(),u=a=!0,e.prevElClipPaths=null,e.allClipped=!1,e.prevEl=null),o&&o.length&&(kl(i,e),i.save(),Cwt(o,i,e),a=!0),e.prevElClipPaths=o),e.allClipped){t.__isRendered=!1;return}t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush();var f=e.prevEl;f||(u=a=!0);var g=t instanceof qr&&t.autoBatch&&Dwt(t.style);a||Ewt(n,f.transform)?(kl(i,e),_Q(i,t)):g||kl(i,e);var v=cS(t,e.inHover);t instanceof qr?(e.lastDrawType!==f8&&(u=!0,e.lastDrawType=f8),d8(i,t,f,u,e),(!g||!e.batchFill&&!e.batchStroke)&&i.beginPath(),Twt(i,t,v,g),g&&(e.batchFill=v.fill||"",e.batchStroke=v.stroke||"")):t instanceof tS?(e.lastDrawType!==g8&&(u=!0,e.lastDrawType=g8),d8(i,t,f,u,e),Iwt(i,t,v)):t instanceof ys?(e.lastDrawType!==p8&&(u=!0,e.lastDrawType=p8),Mwt(i,t,f,u,e),Awt(i,t,v)):t.getTemporalDisplayables&&(e.lastDrawType!==m8&&(u=!0,e.lastDrawType=m8),Pwt(i,t,e)),g&&r&&kl(i,e),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),e.prevEl=t,t.__dirty=0,t.__isRendered=!0}function Pwt(i,t,e){var r=t.getDisplayables(),n=t.getTemporalDisplayables();i.save();var o={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:e.viewWidth,viewHeight:e.viewHeight,inHover:e.inHover},s,a;for(s=t.getCursor(),a=r.length;s<a;s++){var u=r[s];u.beforeBrush&&u.beforeBrush(),u.innerBeforeBrush(),qm(i,u,o,s===a-1),u.innerAfterBrush(),u.afterBrush&&u.afterBrush(),o.prevEl=u}for(var f=0,g=n.length;f<g;f++){var u=n[f];u.beforeBrush&&u.beforeBrush(),u.innerBeforeBrush(),qm(i,u,o,f===g-1),u.innerAfterBrush(),u.afterBrush&&u.afterBrush(),o.prevEl=u}t.clearTemporalDisplayables(),t.notClear=!0,i.restore()}var lR=new uwt,v8=new y0(100),_8=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function S0(i,t){if(i==="none")return null;var e=t.getDevicePixelRatio(),r=t.getZr(),n=r.painter.type==="svg";i.dirty&&lR.delete(i);var o=lR.get(i);if(o)return o;var s=rr(i,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});s.backgroundColor==="none"&&(s.backgroundColor=null);var a={repeat:"repeat"};return u(a),a.rotation=s.rotation,a.scaleX=a.scaleY=n?1:1/e,lR.set(i,a),i.dirty=!1,a;function u(f){for(var g=[e],v=!0,y=0;y<_8.length;++y){var w=s[_8[y]];if(w!=null&&!Ye(w)&&!bi(w)&&!fn(w)&&typeof w!="boolean"){v=!1;break}g.push(w)}var I;if(v){I=g.join(",")+(n?"-svg":"");var E=v8.get(I);E&&(n?f.svgElement=E:f.image=E)}var D=bQ(s.dashArrayX),R=Lwt(s.dashArrayY),z=xQ(s.symbol),N=Rwt(D),H=wQ(R),$=!n&&gu.createCanvas(),X=n&&{tag:"g",attrs:{},key:"dcl",children:[]},K=rt(),et;$&&($.width=K.width*e,$.height=K.height*e,et=$.getContext("2d")),lt(),v&&v8.put(I,$||X),f.image=$,f.svgElement=X,f.svgWidth=K.width,f.svgHeight=K.height;function rt(){for(var ht=1,yt=0,ft=N.length;yt<ft;++yt)ht=RH(ht,N[yt]);for(var kt=1,yt=0,ft=z.length;yt<ft;++yt)kt=RH(kt,z[yt].length);ht*=kt;var Rt=H*N.length*z.length;return{width:Math.max(1,Math.min(ht,s.maxTileWidth)),height:Math.max(1,Math.min(Rt,s.maxTileHeight))}}function lt(){et&&(et.clearRect(0,0,$.width,$.height),s.backgroundColor&&(et.fillStyle=s.backgroundColor,et.fillRect(0,0,$.width,$.height)));for(var ht=0,yt=0;yt<R.length;++yt)ht+=R[yt];if(ht<=0)return;for(var ft=-H,kt=0,Rt=0,Ct=0;ft<K.height;){if(kt%2===0){for(var Gt=Rt/2%z.length,Vt=0,Qt=0,fe=0;Vt<K.width*2;){for(var Te=0,yt=0;yt<D[Ct].length;++yt)Te+=D[Ct][yt];if(Te<=0)break;if(Qt%2===0){var be=(1-s.symbolSize)*.5,Ge=Vt+D[Ct][Qt]*be,li=ft+R[kt]*be,Pi=D[Ct][Qt]*s.symbolSize,or=R[kt]*s.symbolSize,Ve=fe/2%z[Gt].length;Ze(Ge,li,Pi,or,z[Gt][Ve])}Vt+=D[Ct][Qt],++fe,++Qt,Qt===D[Ct].length&&(Qt=0)}++Ct,Ct===D.length&&(Ct=0)}ft+=R[kt],++Rt,++kt,kt===R.length&&(kt=0)}function Ze(ye,Ke,We,Si,zt){var Zt=n?1:e,pe=bo(zt,ye*Zt,Ke*Zt,We*Zt,Si*Zt,s.color,s.symbolKeepAspect);if(n){var $e=r.painter.renderOneToVNode(pe);$e&&X.children.push($e)}else yQ(et,pe)}}}}function xQ(i){if(!i||i.length===0)return[["rect"]];if(bi(i))return[[i]];for(var t=!0,e=0;e<i.length;++e)if(!bi(i[e])){t=!1;break}if(t)return xQ([i]);for(var r=[],e=0;e<i.length;++e)bi(i[e])?r.push([i[e]]):r.push(i[e]);return r}function bQ(i){if(!i||i.length===0)return[[0,0]];if(fn(i)){var t=Math.ceil(i);return[[t,t]]}for(var e=!0,r=0;r<i.length;++r)if(!fn(i[r])){e=!1;break}if(e)return bQ([i]);for(var n=[],r=0;r<i.length;++r)if(fn(i[r])){var t=Math.ceil(i[r]);n.push([t,t])}else{var t=ti(i[r],function(a){return Math.ceil(a)});t.length%2===1?n.push(t.concat(t)):n.push(t)}return n}function Lwt(i){if(!i||typeof i=="object"&&i.length===0)return[0,0];if(fn(i)){var t=Math.ceil(i);return[t,t]}var e=ti(i,function(r){return Math.ceil(r)});return i.length%2?e.concat(e):e}function Rwt(i){return ti(i,function(t){return wQ(t)})}function wQ(i){for(var t=0,e=0;e<i.length;++e)t+=i[e];return i.length%2===1?t*2:t}function kwt(i,t){i.eachRawSeries(function(e){if(!i.isSeriesFiltered(e)){var r=e.getData();r.hasItemVisual()&&r.each(function(s){var a=r.getItemVisual(s,"decal");if(a){var u=r.ensureUniqueItemVisual(s,"style");u.decal=S0(a,t)}});var n=r.getVisual("decal");if(n){var o=r.getVisual("style");o.decal=S0(n,t)}}})}var Owt=new zc;const Yu=Owt;var SQ={};function zwt(i,t){SQ[i]=t}function Bwt(i){return SQ[i]}var TQ={};function Fwt(i,t){TQ[i]=t}function Nwt(i){return TQ[i]}var Vwt=1,Uwt=800,Gwt=900,Hwt=1e3,jwt=2e3,Wwt=5e3,AQ=1e3,$wt=1100,g3=2e3,IQ=3e3,Zwt=4e3,wE=4500,qwt=4600,Xwt=5e3,Ywt=6e3,MQ=7e3,Kwt={PROCESSOR:{FILTER:Hwt,SERIES_FILTER:Uwt,STATISTIC:Wwt},VISUAL:{LAYOUT:AQ,PROGRESSIVE_LAYOUT:$wt,GLOBAL:g3,CHART:IQ,POST_CHART_LAYOUT:qwt,COMPONENT:Zwt,BRUSH:Xwt,CHART_ITEM:wE,ARIA:Ywt,DECAL:MQ}},Do="__flagInMainProcess",PA="__mainProcessVersion",ts="__pendingUpdate",cR="__needsUpdateStatus",y8=/^[a-zA-Z0-9_]+$/;function CQ(i){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.isDisposed()){this.id;return}return DQ(this,i,t)}}function EQ(i){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return DQ(this,i,t)}}function DQ(i,t,e){return e[0]=e[0]&&e[0].toLowerCase(),zc.prototype[t].apply(i,e)}var PQ=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(zc),LQ=PQ.prototype;LQ.on=EQ("on");LQ.off=EQ("off");var xm,uR,LA,id,RA,hR,dR,Sy,Ty,x8,b8,fR,w8,kA,S8,vc,T8,Ay,Jwt=function(i){we(t,i);function t(e,r,n){var o=i.call(this,new rwt)||this;o._chartsViews=[],o._chartsMap={},o._componentsViews=[],o._componentsMap={},o._pendingActions=[],n=n||{},o._dom=e;var s="canvas",a="auto",u=!1;o[PA]=1,n.ssr&&gyt(function(y){var w=ur(y),I=w.dataIndex;if(I!=null){var E=Fi();return E.set("series_index",w.seriesIndex),E.set("data_index",I),w.ssrType&&E.set("ssr_type",w.ssrType),E}});var f=o._zr=EH(e,{renderer:n.renderer||s,devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height,ssr:n.ssr,useDirtyRect:Ui(n.useDirtyRect,u),useCoarsePointer:Ui(n.useCoarsePointer,a),pointerSize:n.pointerSize});o._ssr=n.ssr,o._throttledZrFlush=d3(wi(f.flush,f),17),o._updateTheme(r),o._locale=t1t(n.locale||oJ),o._coordSysMgr=new NS;var g=o._api=S8(o);function v(y,w){return y.__prio-w.__prio}return NI(ZM,v),NI(Sz,v),o._scheduler=new fQ(o,g,Sz,ZM),o._messageCenter=new PQ,o._initEvents(),o.resize=wi(o.resize,o),f.animation.on("frame",o._onframe,o),x8(f,o),b8(f,o),wM(o),o}return t.prototype._onframe=function(){if(!this._disposed){T8(this);var e=this._scheduler;if(this[ts]){var r=this[ts].silent;this[Do]=!0,Ay(this);try{xm(this),id.update.call(this,null,this[ts].updateParams)}catch(u){throw this[Do]=!1,this[ts]=null,u}this._zr.flush(),this[Do]=!1,this[ts]=null,Sy.call(this,r),Ty.call(this,r)}else if(e.unfinished){var n=Vwt,o=this._model,s=this._api;e.unfinished=!1;do{var a=+new Date;e.performSeriesTasks(o),e.performDataProcessorTasks(o),hR(this,o),e.performVisualTasks(o),kA(this,this._model,s,"remain",{}),n-=+new Date-a}while(n>0&&e.unfinished);e.unfinished||this._zr.flush()}}},t.prototype.getDom=function(){return this._dom},t.prototype.getId=function(){return this.id},t.prototype.getZr=function(){return this._zr},t.prototype.isSSR=function(){return this._ssr},t.prototype.setOption=function(e,r,n){if(!this[Do]){if(this._disposed){this.id;return}var o,s,a;if(nr(r)&&(n=r.lazyUpdate,o=r.silent,s=r.replaceMerge,a=r.transition,r=r.notMerge),this[Do]=!0,Ay(this),!this._model||r){var u=new U1t(this._api),f=this._theme,g=this._model=new zJ;g.scheduler=this._scheduler,g.ssr=this._ssr,g.init(null,null,null,f,this._locale,u)}this._model.setOption(e,{replaceMerge:s},Tz);var v={seriesTransition:a,optionChanged:!0};if(n)this[ts]={silent:o,updateParams:v},this[Do]=!1,this.getZr().wakeUp();else{try{xm(this),id.update.call(this,null,v)}catch(y){throw this[ts]=null,this[Do]=!1,y}this._ssr||this._zr.flush(),this[ts]=null,this[Do]=!1,Sy.call(this,o),Ty.call(this,o)}}},t.prototype.setTheme=function(e,r){if(!this[Do]){if(this._disposed){this.id;return}var n=this._model;if(n){var o=r&&r.silent,s=null;this[ts]&&(o==null&&(o=this[ts].silent),s=this[ts].updateParams,this[ts]=null),this[Do]=!0,Ay(this);try{this._updateTheme(e),n.setTheme(this._theme),xm(this),id.update.call(this,{type:"setTheme"},s)}catch(a){throw this[Do]=!1,a}this[Do]=!1,Sy.call(this,o),Ty.call(this,o)}}},t.prototype._updateTheme=function(e){bi(e)&&(e=kQ[e]),e&&(e=Yi(e),e&&NJ(e,!0),this._theme=e)},t.prototype.getModel=function(){return this._model},t.prototype.getOption=function(){return this._model&&this._model.getOption()},t.prototype.getWidth=function(){return this._zr.getWidth()},t.prototype.getHeight=function(){return this._zr.getHeight()},t.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||Sn.hasGlobalWindow&&window.devicePixelRatio||1},t.prototype.getRenderedCanvas=function(e){return this.renderToCanvas(e)},t.prototype.renderToCanvas=function(e){e=e||{};var r=this._zr.painter;return r.getRenderedCanvas({backgroundColor:e.backgroundColor||this._model.get("backgroundColor"),pixelRatio:e.pixelRatio||this.getDevicePixelRatio()})},t.prototype.renderToSVGString=function(e){e=e||{};var r=this._zr.painter;return r.renderToString({useViewBox:e.useViewBox})},t.prototype.getSvgDataURL=function(){var e=this._zr,r=e.storage.getDisplayList();return gt(r,function(n){n.stopAnimation(null,!0)}),e.painter.toDataURL()},t.prototype.getDataURL=function(e){if(this._disposed){this.id;return}e=e||{};var r=e.excludeComponents,n=this._model,o=[],s=this;gt(r,function(u){n.eachComponent({mainType:u},function(f){var g=s._componentsMap[f.__viewId];g.group.ignore||(o.push(g),g.group.ignore=!0)})});var a=this._zr.painter.getType()==="svg"?this.getSvgDataURL():this.renderToCanvas(e).toDataURL("image/"+(e&&e.type||"png"));return gt(o,function(u){u.group.ignore=!1}),a},t.prototype.getConnectedDataURL=function(e){if(this._disposed){this.id;return}var r=e.type==="svg",n=this.group,o=Math.min,s=Math.max,a=1/0;if(tSt[n]){var u=a,f=a,g=-a,v=-a,y=[],w=e&&e.pixelRatio||this.getDevicePixelRatio();gt(A8,function(N,H){if(N.group===n){var $=r?N.getZr().painter.getSvgDom().innerHTML:N.renderToCanvas(Yi(e)),X=N.getDom().getBoundingClientRect();u=o(X.left,u),f=o(X.top,f),g=s(X.right,g),v=s(X.bottom,v),y.push({dom:$,left:X.left,top:X.top})}}),u*=w,f*=w,g*=w,v*=w;var I=g-u,E=v-f,D=gu.createCanvas(),R=EH(D,{renderer:r?"svg":"canvas"});if(R.resize({width:I,height:E}),r){var z="";return gt(y,function(N){var H=N.left-u,$=N.top-f;z+='<g transform="translate('+H+","+$+')">'+N.dom+"</g>"}),R.painter.getSvgRoot().innerHTML=z,e.connectedBackgroundColor&&R.painter.setBackgroundColor(e.connectedBackgroundColor),R.refreshImmediately(),R.painter.toDataURL()}else return e.connectedBackgroundColor&&R.add(new jr({shape:{x:0,y:0,width:I,height:E},style:{fill:e.connectedBackgroundColor}})),gt(y,function(N){var H=new ys({style:{x:N.left*w-u,y:N.top*w-f,image:N.dom}});R.add(H)}),R.refreshImmediately(),D.toDataURL("image/"+(e&&e.type||"png"))}else return this.getDataURL(e)},t.prototype.convertToPixel=function(e,r,n){return RA(this,"convertToPixel",e,r,n)},t.prototype.convertToLayout=function(e,r,n){return RA(this,"convertToLayout",e,r,n)},t.prototype.convertFromPixel=function(e,r,n){return RA(this,"convertFromPixel",e,r,n)},t.prototype.containPixel=function(e,r){if(this._disposed){this.id;return}var n=this._model,o,s=s0(n,e);return gt(s,function(a,u){u.indexOf("Models")>=0&&gt(a,function(f){var g=f.coordinateSystem;if(g&&g.containPoint)o=o||!!g.containPoint(r);else if(u==="seriesModels"){var v=this._chartsMap[f.__viewId];v&&v.containPoint&&(o=o||v.containPoint(r,f))}},this)},this),!!o},t.prototype.getVisual=function(e,r){var n=this._model,o=s0(n,e,{defaultMainType:"series"}),s=o.seriesModel,a=s.getData(),u=o.hasOwnProperty("dataIndexInside")?o.dataIndexInside:o.hasOwnProperty("dataIndex")?a.indexOfRawIndex(o.dataIndex):null;return u!=null?f3(a,u,r):US(a,r)},t.prototype.getViewOfComponentModel=function(e){return this._componentsMap[e.__viewId]},t.prototype.getViewOfSeriesModel=function(e){return this._chartsMap[e.__viewId]},t.prototype._initEvents=function(){var e=this;gt(Qwt,function(n){var o=function(s){var a=e.getModel(),u=s.target,f,g=n==="globalout";if(g?f={}:u&&$m(u,function(E){var D=ur(E);if(D&&D.dataIndex!=null){var R=D.dataModel||a.getSeriesByIndex(D.seriesIndex);return f=R&&R.getDataParams(D.dataIndex,D.dataType,u)||{},!0}else if(D.eventData)return f=Fe({},D.eventData),!0},!0),f){var v=f.componentType,y=f.componentIndex;(v==="markLine"||v==="markPoint"||v==="markArea")&&(v="series",y=f.seriesIndex);var w=v&&y!=null&&a.getComponent(v,y),I=w&&e[w.mainType==="series"?"_chartsMap":"_componentsMap"][w.__viewId];f.event=s,f.type=n,e._$eventProcessor.eventInfo={targetEl:u,packedEvent:f,model:w,view:I},e.trigger(n,f)}};o.zrEventfulCallAtLast=!0,e._zr.on(n,o,e)});var r=this._messageCenter;gt(wz,function(n,o){r.on(o,function(s){e.trigger(o,s)})}),owt(r,this,this._api)},t.prototype.isDisposed=function(){return this._disposed},t.prototype.clear=function(){if(this._disposed){this.id;return}this.setOption({series:[]},!0)},t.prototype.dispose=function(){if(this._disposed){this.id;return}this._disposed=!0;var e=this.getDom();e&&Nyt(this.getDom(),eSt,"");var r=this,n=r._api,o=r._model;gt(r._componentsViews,function(s){s.dispose(o,n)}),gt(r._chartsViews,function(s){s.dispose(o,n)}),r._zr.dispose(),r._dom=r._model=r._chartsMap=r._componentsMap=r._chartsViews=r._componentsViews=r._scheduler=r._api=r._zr=r._throttledZrFlush=r._theme=r._coordSysMgr=r._messageCenter=null,delete A8[r.id]},t.prototype.resize=function(e){if(!this[Do]){if(this._disposed){this.id;return}this._zr.resize(e);var r=this._model;if(this._loadingFX&&this._loadingFX.resize(),!!r){var n=r.resetOption("media"),o=e&&e.silent;this[ts]&&(o==null&&(o=this[ts].silent),n=!0,this[ts]=null),this[Do]=!0,Ay(this);try{n&&xm(this),id.update.call(this,{type:"resize",animation:Fe({duration:0},e&&e.animation)})}catch(s){throw this[Do]=!1,s}this[Do]=!1,Sy.call(this,o),Ty.call(this,o)}}},t.prototype.showLoading=function(e,r){if(this._disposed){this.id;return}if(nr(e)&&(r=e,e=""),e=e||"default",this.hideLoading(),!!Az[e]){var n=Az[e](this._api,r),o=this._zr;this._loadingFX=n,o.add(n)}},t.prototype.hideLoading=function(){if(this._disposed){this.id;return}this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},t.prototype.makeActionFromEvent=function(e){var r=Fe({},e);return r.type=RQ[e.type],r},t.prototype.dispatchAction=function(e,r){if(this._disposed){this.id;return}if(nr(r)||(r={silent:!!r}),!!$M[e.type]&&this._model){if(this[Do]){this._pendingActions.push(e);return}var n=r.silent;dR.call(this,e,n);var o=r.flush;o?this._zr.flush():o!==!1&&Sn.browser.weChat&&this._throttledZrFlush(),Sy.call(this,n),Ty.call(this,n)}},t.prototype.updateLabelLayout=function(){Yu.trigger("series:layoutlabels",this._model,this._api,{updatedSeries:[]})},t.prototype.appendData=function(e){if(this._disposed){this.id;return}var r=e.seriesIndex,n=this.getModel(),o=n.getSeriesByIndex(r);o.appendData(e),this._scheduler.unfinished=!0,this.getZr().wakeUp()},t.internalField=function(){xm=function(v){var y=v._scheduler;y.restorePipelines(v._model),y.prepareStageTasks(),uR(v,!0),uR(v,!1),y.plan()},uR=function(v,y){for(var w=v._model,I=v._scheduler,E=y?v._componentsViews:v._chartsViews,D=y?v._componentsMap:v._chartsMap,R=v._zr,z=v._api,N=0;N<E.length;N++)E[N].__alive=!1;y?w.eachComponent(function(X,K){X!=="series"&&H(K)}):w.eachSeries(H);function H(X){var K=X.__requireNewView;X.__requireNewView=!1;var et="_ec_"+X.id+"_"+X.type,rt=!K&&D[et];if(!rt){var lt=lh(X.type),ht=y?Oa.getClass(lt.main,lt.sub):pa.getClass(lt.sub);rt=new ht,rt.init(w,z),D[et]=rt,E.push(rt),R.add(rt.group)}X.__viewId=rt.__id=et,rt.__alive=!0,rt.__model=X,rt.group.__ecComponentInfo={mainType:X.mainType,index:X.componentIndex},!y&&I.prepareView(rt,X,w,z)}for(var N=0;N<E.length;){var $=E[N];$.__alive?N++:(!y&&$.renderTask.dispose(),R.remove($.group),$.dispose(w,z),E.splice(N,1),D[$.__id]===$&&delete D[$.__id],$.__id=$.group.__ecComponentInfo=null)}},LA=function(v,y,w,I,E){var D=v._model;if(D.setUpdatePayload(w),!I){gt([].concat(v._componentsViews).concat(v._chartsViews),$);return}var R={};R[I+"Id"]=w[I+"Id"],R[I+"Index"]=w[I+"Index"],R[I+"Name"]=w[I+"Name"];var z={mainType:I,query:R};E&&(z.subType=E);var N=w.excludeSeriesId,H;N!=null&&(H=Fi(),gt(na(N),function(X){var K=Lo(X,null);K!=null&&H.set(K,!0)})),D&&D.eachComponent(z,function(X){var K=H&&H.get(X.id)!=null;if(!K)if(cj(w))if(X instanceof Ea)w.type===rv&&!w.notBlur&&!X.get(["emphasis","disabled"])&&W0t(X,w,v._api);else{var et=FF(X.mainType,X.componentIndex,w.name,v._api),rt=et.focusSelf,lt=et.dispatchers;w.type===rv&&rt&&!w.notBlur&&tz(X.mainType,X.componentIndex,v._api),lt&&gt(lt,function(ht){w.type===rv?Rd(ht):kd(ht)})}else iz(w)&&X instanceof Ea&&(q0t(X,w,v._api),sj(X),vc(v))},v),D&&D.eachComponent(z,function(X){var K=H&&H.get(X.id)!=null;K||$(v[I==="series"?"_chartsMap":"_componentsMap"][X.__viewId])},v);function $(X){X&&X.__alive&&X[y]&&X[y](X.__model,D,v._api,w)}},id={prepareAndUpdate:function(v){xm(this),id.update.call(this,v,v&&{optionChanged:v.newOption!=null})},update:function(v,y){var w=this._model,I=this._api,E=this._zr,D=this._coordSysMgr,R=this._scheduler;if(w){w.setUpdatePayload(v),R.restoreData(w,v),R.performSeriesTasks(w),D.create(w,I),R.performDataProcessorTasks(w,v),hR(this,w),D.update(w,I),r(w),R.performVisualTasks(w,v);var z=w.get("backgroundColor")||"transparent";E.setBackgroundColor(z);var N=w.get("darkMode");N!=null&&N!=="auto"&&E.setDarkMode(N),fR(this,w,I,v,y),Yu.trigger("afterupdate",w,I)}},updateTransform:function(v){var y=this,w=this._model,I=this._api;if(w){w.setUpdatePayload(v);var E=[];w.eachComponent(function(R,z){if(R!=="series"){var N=y.getViewOfComponentModel(z);if(N&&N.__alive)if(N.updateTransform){var H=N.updateTransform(z,w,I,v);H&&H.update&&E.push(N)}else E.push(N)}});var D=Fi();w.eachSeries(function(R){var z=y._chartsMap[R.__viewId];if(z.updateTransform){var N=z.updateTransform(R,w,I,v);N&&N.update&&D.set(R.uid,1)}else D.set(R.uid,1)}),r(w),this._scheduler.performVisualTasks(w,v,{setDirty:!0,dirtyMap:D}),kA(this,w,I,v,{},D),Yu.trigger("afterupdate",w,I)}},updateView:function(v){var y=this._model;y&&(y.setUpdatePayload(v),pa.markUpdateMethod(v,"updateView"),r(y),this._scheduler.performVisualTasks(y,v,{setDirty:!0}),fR(this,y,this._api,v,{}),Yu.trigger("afterupdate",y,this._api))},updateVisual:function(v){var y=this,w=this._model;w&&(w.setUpdatePayload(v),w.eachSeries(function(I){I.getData().clearAllVisual()}),pa.markUpdateMethod(v,"updateVisual"),r(w),this._scheduler.performVisualTasks(w,v,{visualType:"visual",setDirty:!0}),w.eachComponent(function(I,E){if(I!=="series"){var D=y.getViewOfComponentModel(E);D&&D.__alive&&D.updateVisual(E,w,y._api,v)}}),w.eachSeries(function(I){var E=y._chartsMap[I.__viewId];E.updateVisual(I,w,y._api,v)}),Yu.trigger("afterupdate",w,this._api))},updateLayout:function(v){id.update.call(this,v)}};function e(v,y,w,I,E){if(v._disposed){v.id;return}for(var D=v._model,R=v._coordSysMgr.getCoordinateSystems(),z,N=s0(D,w),H=0;H<R.length;H++){var $=R[H];if($[y]&&(z=$[y](D,N,I,E))!=null)return z}}RA=e,hR=function(v,y){var w=v._chartsMap,I=v._scheduler;y.eachSeries(function(E){I.updateStreamModes(E,w[E.__viewId])})},dR=function(v,y){var w=this,I=this.getModel(),E=v.type,D=v.escapeConnect,R=$M[E],z=(R.update||"update").split(":"),N=z.pop(),H=z[0]!=null&&lh(z[0]);this[Do]=!0,Ay(this);var $=[v],X=!1;v.batch&&(X=!0,$=ti(v.batch,function(Ct){return Ct=rr(Fe({},Ct),v),Ct.batch=null,Ct}));var K=[],et,rt=[],lt=R.nonRefinedEventType,ht=iz(v),yt=cj(v);if(yt&&MK(this._api),gt($,function(Ct){var Gt=R.action(Ct,I,w._api);if(R.refineEvent?rt.push(Gt):et=Gt,et=et||Fe({},Ct),et.type=lt,K.push(et),yt){var Vt=EF(v),Qt=Vt.queryOptionMap,fe=Vt.mainTypeSpecified,Te=fe?Qt.keys()[0]:"series";LA(w,N,Ct,Te),vc(w)}else ht?(LA(w,N,Ct,"series"),vc(w)):H&&LA(w,N,Ct,H.main,H.sub)}),N!=="none"&&!yt&&!ht&&!H)try{this[ts]?(xm(this),id.update.call(this,v),this[ts]=null):id[N].call(this,v)}catch(Ct){throw this[Do]=!1,Ct}if(X?et={type:lt,escapeConnect:D,batch:K}:et=K[0],this[Do]=!1,!y){var ft=void 0;if(R.refineEvent){var kt=R.refineEvent(rt,v,I,this._api).eventContent;Vs(nr(kt)),ft=rr({type:R.refinedEventType},kt),ft.fromAction=v.type,ft.fromActionPayload=v,ft.escapeConnect=!0}var Rt=this._messageCenter;Rt.trigger(et.type,et),ft&&Rt.trigger(ft.type,ft)}},Sy=function(v){for(var y=this._pendingActions;y.length;){var w=y.shift();dR.call(this,w,v)}},Ty=function(v){!v&&this.trigger("updated")},x8=function(v,y){v.on("rendered",function(w){y.trigger("rendered",w),v.animation.isFinished()&&!y[ts]&&!y._scheduler.unfinished&&!y._pendingActions.length&&y.trigger("finished")})},b8=function(v,y){v.on("mouseover",function(w){var I=w.target,E=$m(I,iS);E&&($0t(E,w,y._api),vc(y))}).on("mouseout",function(w){var I=w.target,E=$m(I,iS);E&&(Z0t(E,w,y._api),vc(y))}).on("click",function(w){var I=w.target,E=$m(I,function(z){return ur(z).dataIndex!=null},!0);if(E){var D=E.selected?"unselect":"select",R=ur(E);y._api.dispatchAction({type:D,dataType:R.dataType,dataIndexInside:R.dataIndex,seriesIndex:R.seriesIndex,isFromClick:!0})}})};function r(v){v.clearColorPalette(),v.eachSeries(function(y){y.clearColorPalette()})}function n(v){var y=[],w=[],I=!1;if(v.eachComponent(function(z,N){var H=N.get("zlevel")||0,$=N.get("z")||0,X=N.getZLevelKey();I=I||!!X,(z==="series"?w:y).push({zlevel:H,z:$,idx:N.componentIndex,type:z,key:X})}),I){var E=y.concat(w),D,R;NI(E,function(z,N){return z.zlevel===N.zlevel?z.z-N.z:z.zlevel-N.zlevel}),gt(E,function(z){var N=v.getComponent(z.type,z.idx),H=z.zlevel,$=z.key;D!=null&&(H=Math.max(D,H)),$?(H===D&&$!==R&&H++,R=$):R&&(H===D&&H++,R=""),D=H,N.setZLevel(H)})}}fR=function(v,y,w,I,E){n(y),w8(v,y,w,I,E),gt(v._chartsViews,function(D){D.__alive=!1}),kA(v,y,w,I,E),gt(v._chartsViews,function(D){D.__alive||D.remove(y,w)})},w8=function(v,y,w,I,E,D){gt(D||v._componentsViews,function(R){var z=R.__model;f(z,R),R.render(z,y,w,I),u(z,R),g(z,R)})},kA=function(v,y,w,I,E,D){var R=v._scheduler;E=Fe(E||{},{updatedSeries:y.getSeries()}),Yu.trigger("series:beforeupdate",y,w,E);var z=!1;y.eachSeries(function(N){var H=v._chartsMap[N.__viewId];H.__alive=!0;var $=H.renderTask;R.updatePayload($,I),f(N,H),D&&D.get(N.uid)&&$.dirty(),$.perform(R.getPerformArgs($))&&(z=!0),H.group.silent=!!N.get("silent"),a(N,H),sj(N)}),R.unfinished=z||R.unfinished,Yu.trigger("series:layoutlabels",y,w,E),Yu.trigger("series:transition",y,w,E),y.eachSeries(function(N){var H=v._chartsMap[N.__viewId];u(N,H),g(N,H)}),s(v,y),Yu.trigger("series:afterupdate",y,w,E)},vc=function(v){v[cR]=!0,v.getZr().wakeUp()},Ay=function(v){v[PA]=(v[PA]+1)%1e3},T8=function(v){v[cR]&&(v.getZr().storage.traverse(function(y){l0(y)||o(y)}),v[cR]=!1)};function o(v){for(var y=[],w=v.currentStates,I=0;I<w.length;I++){var E=w[I];E==="emphasis"||E==="blur"||E==="select"||y.push(E)}v.selected&&v.states.select&&y.push("select"),v.hoverState===lE&&v.states.emphasis?y.push("emphasis"):v.hoverState===OS&&v.states.blur&&y.push("blur"),v.useStates(y)}function s(v,y){var w=v._zr,I=w.storage,E=0;I.traverse(function(D){D.isGroup||E++}),E>y.get("hoverLayerThreshold")&&!Sn.node&&!Sn.worker&&y.eachSeries(function(D){if(!D.preventUsingHoverLayer){var R=v._chartsMap[D.__viewId];R.__alive&&R.eachRendered(function(z){z.states.emphasis&&(z.states.emphasis.hoverLayer=!0)})}})}function a(v,y){var w=v.get("blendMode")||null;y.eachRendered(function(I){I.isGroup||(I.style.blend=w)})}function u(v,y){if(!v.preventAutoZ){var w=vv(v);y.eachRendered(function(I){return pE(I,w.z,w.zlevel),!0})}}function f(v,y){y.eachRendered(function(w){if(!l0(w)){var I=w.getTextContent(),E=w.getTextGuideLine();w.stateTransition&&(w.stateTransition=null),I&&I.stateTransition&&(I.stateTransition=null),E&&E.stateTransition&&(E.stateTransition=null),w.hasState()?(w.prevStates=w.currentStates,w.clearStates()):w.prevStates&&(w.prevStates=null)}})}function g(v,y){var w=v.getModel("stateAnimation"),I=v.isAnimationEnabled(),E=w.get("duration"),D=E>0?{duration:E,delay:w.get("delay"),easing:w.get("easing")}:null;y.eachRendered(function(R){if(R.states&&R.states.emphasis){if(l0(R))return;if(R instanceof qr&&txt(R),R.__dirty){var z=R.prevStates;z&&R.useStates(z)}if(I){R.stateTransition=D;var N=R.getTextContent(),H=R.getTextGuideLine();N&&(N.stateTransition=D),H&&(H.stateTransition=D)}R.__dirty&&o(R)}})}S8=function(v){return new(function(y){we(w,y);function w(){return y!==null&&y.apply(this,arguments)||this}return w.prototype.getCoordinateSystems=function(){return v._coordSysMgr.getCoordinateSystems()},w.prototype.getComponentByElement=function(I){for(;I;){var E=I.__ecComponentInfo;if(E!=null)return v._model.getComponent(E.mainType,E.index);I=I.parent}},w.prototype.enterEmphasis=function(I,E){Rd(I,E),vc(v)},w.prototype.leaveEmphasis=function(I,E){kd(I,E),vc(v)},w.prototype.enterBlur=function(I){SK(I),vc(v)},w.prototype.leaveBlur=function(I){BF(I),vc(v)},w.prototype.enterSelect=function(I){TK(I),vc(v)},w.prototype.leaveSelect=function(I){AK(I),vc(v)},w.prototype.getModel=function(){return v.getModel()},w.prototype.getViewOfComponentModel=function(I){return v.getViewOfComponentModel(I)},w.prototype.getViewOfSeriesModel=function(I){return v.getViewOfSeriesModel(I)},w.prototype.getMainProcessVersion=function(){return v[PA]},w}(BJ))(v)}}(),t}(zc),m3=Jwt.prototype;m3.on=CQ("on");m3.off=CQ("off");m3.one=function(i,t,e){var r=this;function n(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];t&&t.apply&&t.apply(this,o),r.off(i,n)}this.on.call(this,i,n,e)};var Qwt=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];var $M={},RQ={},wz={},Sz=[],Tz=[],ZM=[],kQ={},Az={},A8={},tSt={},eSt="_echarts_instance_";function OQ(i,t){kQ[i]=t}function zQ(i){Ar(Tz,i)<0&&Tz.push(i)}function BQ(i,t){_3(Sz,i,t,jwt)}function iSt(i){v3("afterinit",i)}function rSt(i){v3("afterupdate",i)}function v3(i,t){Yu.on(i,t)}function Ah(i,t,e){var r,n,o,s,a;Xi(t)&&(e=t,t=""),nr(i)?(r=i.type,n=i.event,s=i.update,a=i.publishNonRefinedEvent,e||(e=i.action),o=i.refineEvent):(r=i,n=t);function u(g){return g.toLowerCase()}n=u(n||r);var f=o?u(r):n;$M[r]||(Vs(y8.test(r)&&y8.test(n)),o&&Vs(n!==r),$M[r]={actionType:r,refinedEventType:n,nonRefinedEventType:f,update:s,action:e,refineEvent:o},wz[n]=1,o&&a&&(wz[f]=1),RQ[f]=r)}function nSt(i,t){NS.register(i,t)}function aSt(i,t){_3(ZM,i,t,AQ,"layout")}function Ev(i,t){_3(ZM,i,t,IQ,"visual")}var I8=[];function _3(i,t,e,r,n){if((Xi(t)||nr(t))&&(e=t,t=r),!(Ar(I8,e)>=0)){I8.push(e);var o=fQ.wrapStageHandler(e,n);o.__prio=t,o.__raw=e,i.push(o)}}function FQ(i,t){Az[i]=t}function oSt(i,t,e){var r=Bwt("registerMap");r&&r(i,t,e)}var sSt=gbt;Ev(g3,Ubt);Ev(wE,Gbt);Ev(wE,Hbt);Ev(g3,nwt);Ev(wE,awt);Ev(MQ,kwt);zQ(NJ);BQ(Gwt,X1t);FQ("default",jbt);Ah({type:rv,event:rv,update:rv},uo);Ah({type:WI,event:WI,update:WI},uo);Ah({type:kM,event:OF,update:kM,action:uo,refineEvent:y3,publishNonRefinedEvent:!0});Ah({type:JO,event:OF,update:JO,action:uo,refineEvent:y3,publishNonRefinedEvent:!0});Ah({type:OM,event:OF,update:OM,action:uo,refineEvent:y3,publishNonRefinedEvent:!0});function y3(i,t,e,r){return{eventContent:{selected:X0t(e),isFromClick:t.isFromClick||!1}}}OQ("default",{});OQ("dark",iwt);var M8=[],lSt={registerPreprocessor:zQ,registerProcessor:BQ,registerPostInit:iSt,registerPostUpdate:rSt,registerUpdateLifecycle:v3,registerAction:Ah,registerCoordinateSystem:nSt,registerLayout:aSt,registerVisual:Ev,registerTransform:sSt,registerLoading:FQ,registerMap:oSt,registerImpl:zwt,PRIORITY:Kwt,ComponentModel:gn,ComponentView:Oa,SeriesModel:Ea,ChartView:pa,registerComponentModel:function(i){gn.registerClass(i)},registerComponentView:function(i){Oa.registerClass(i)},registerSeriesModel:function(i){Ea.registerClass(i)},registerChartView:function(i){pa.registerClass(i)},registerCustomSeries:function(i,t){Fwt(i,t)},registerSubTypeDefaulter:function(i,t){gn.registerSubTypeDefaulter(i,t)},registerPainter:function(i,t){fyt(i,t)}};function Rr(i){if(Ye(i)){gt(i,function(t){Rr(t)});return}Ar(M8,i)>=0||(M8.push(i),Xi(i)&&(i={install:i}),i.install(lSt))}function bb(i){return i==null?0:i.length||1}function C8(i){return i}var cSt=function(){function i(t,e,r,n,o,s){this._old=t,this._new=e,this._oldKeyGetter=r||C8,this._newKeyGetter=n||C8,this.context=o,this._diffModeMultiple=s==="multiple"}return i.prototype.add=function(t){return this._add=t,this},i.prototype.update=function(t){return this._update=t,this},i.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},i.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},i.prototype.updateManyToMany=function(t){return this._updateManyToMany=t,this},i.prototype.remove=function(t){return this._remove=t,this},i.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},i.prototype._executeOneToOne=function(){var t=this._old,e=this._new,r={},n=new Array(t.length),o=new Array(e.length);this._initIndexMap(t,null,n,"_oldKeyGetter"),this._initIndexMap(e,r,o,"_newKeyGetter");for(var s=0;s<t.length;s++){var a=n[s],u=r[a],f=bb(u);if(f>1){var g=u.shift();u.length===1&&(r[a]=u[0]),this._update&&this._update(g,s)}else f===1?(r[a]=null,this._update&&this._update(u,s)):this._remove&&this._remove(s)}this._performRestAdd(o,r)},i.prototype._executeMultiple=function(){var t=this._old,e=this._new,r={},n={},o=[],s=[];this._initIndexMap(t,r,o,"_oldKeyGetter"),this._initIndexMap(e,n,s,"_newKeyGetter");for(var a=0;a<o.length;a++){var u=o[a],f=r[u],g=n[u],v=bb(f),y=bb(g);if(v>1&&y===1)this._updateManyToOne&&this._updateManyToOne(g,f),n[u]=null;else if(v===1&&y>1)this._updateOneToMany&&this._updateOneToMany(g,f),n[u]=null;else if(v===1&&y===1)this._update&&this._update(g,f),n[u]=null;else if(v>1&&y>1)this._updateManyToMany&&this._updateManyToMany(g,f),n[u]=null;else if(v>1)for(var w=0;w<v;w++)this._remove&&this._remove(f[w]);else this._remove&&this._remove(f)}this._performRestAdd(s,n)},i.prototype._performRestAdd=function(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=e[n],s=bb(o);if(s>1)for(var a=0;a<s;a++)this._add&&this._add(o[a]);else s===1&&this._add&&this._add(o);e[n]=null}},i.prototype._initIndexMap=function(t,e,r,n){for(var o=this._diffModeMultiple,s=0;s<t.length;s++){var a="_ec_"+this[n](t[s],s);if(o||(r[s]=a),!!e){var u=e[a],f=bb(u);f===0?(e[a]=s,o&&r.push(a)):f===1?e[a]=[u,s]:u.push(s)}}},i}();const Od=cSt;var uSt=function(){function i(t,e){this._encode=t,this._schema=e}return i.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},i.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},i}();function hSt(i,t){var e={},r=e.encode={},n=Fi(),o=[],s=[],a={};gt(i.dimensions,function(y){var w=i.getDimensionInfo(y),I=w.coordDim;if(I){var E=w.coordDimIndex;pR(r,I)[E]=y,w.isExtraCoord||(n.set(I,1),dSt(w.type)&&(o[0]=y),pR(a,I)[E]=i.getDimensionIndex(w.name)),w.defaultTooltip&&s.push(y)}CJ.each(function(D,R){var z=pR(r,R),N=w.otherDims[R];N!=null&&N!==!1&&(z[N]=w.name)})});var u=[],f={};n.each(function(y,w){var I=r[w];f[w]=I[0],u=u.concat(I)}),e.dataDimsOnCoord=u,e.dataDimIndicesOnCoord=ti(u,function(y){return i.getDimensionInfo(y).storeDimIndex}),e.encodeFirstDimNotExtra=f;var g=r.label;g&&g.length&&(o=g.slice());var v=r.tooltip;return v&&v.length?s=v.slice():s.length||(s=o.slice()),r.defaultedLabel=o,r.defaultedTooltip=s,e.userOutput=new uSt(a,t),e}function pR(i,t){return i.hasOwnProperty(t)||(i[t]=[]),i[t]}function qM(i){return i==="category"?"ordinal":i==="time"?"time":"float"}function dSt(i){return!(i==="ordinal"||i==="time")}var fSt=function(){function i(t){this.otherDims={},t!=null&&Fe(this,t)}return i}();const JI=fSt;var pSt=Wr(),gSt={float:"f",int:"i",ordinal:"o",number:"n",time:"t"},NQ=function(){function i(t){this.dimensions=t.dimensions,this._dimOmitted=t.dimensionOmitted,this.source=t.source,this._fullDimCount=t.fullDimensionCount,this._updateDimOmitted(t.dimensionOmitted)}return i.prototype.isDimensionOmitted=function(){return this._dimOmitted},i.prototype._updateDimOmitted=function(t){this._dimOmitted=t,t&&(this._dimNameMap||(this._dimNameMap=GQ(this.source)))},i.prototype.getSourceDimensionIndex=function(t){return Ui(this._dimNameMap.get(t),-1)},i.prototype.getSourceDimension=function(t){var e=this.source.dimensionsDefine;if(e)return e[t]},i.prototype.makeStoreSchema=function(){for(var t=this._fullDimCount,e=UJ(this.source),r=!HQ(t),n="",o=[],s=0,a=0;s<t;s++){var u=void 0,f=void 0,g=void 0,v=this.dimensions[a];if(v&&v.storeDimIndex===s)u=e?v.name:null,f=v.type,g=v.ordinalMeta,a++;else{var y=this.getSourceDimension(s);y&&(u=e?y.name:null,f=y.type)}o.push({property:u,type:f,ordinalMeta:g}),e&&u!=null&&(!v||!v.isCalculationCoord)&&(n+=r?u.replace(/\`/g,"`1").replace(/\$/g,"`2"):u),n+="$",n+=gSt[f]||"f",g&&(n+=g.uid),n+="$"}var w=this.source,I=[w.seriesLayoutBy,w.startIndex,n].join("$$");return{dimensions:o,hash:I}},i.prototype.makeOutputDimensionNames=function(){for(var t=[],e=0,r=0;e<this._fullDimCount;e++){var n=void 0,o=this.dimensions[r];if(o&&o.storeDimIndex===e)o.isCalculationCoord||(n=o.name),r++;else{var s=this.getSourceDimension(e);s&&(n=s.name)}t.push(n)}return t},i.prototype.appendCalculationDimension=function(t){this.dimensions.push(t),t.isCalculationCoord=!0,this._fullDimCount++,this._updateDimOmitted(!0)},i}();function VQ(i){return i instanceof NQ}function UQ(i){for(var t=Fi(),e=0;e<(i||[]).length;e++){var r=i[e],n=nr(r)?r.name:r;n!=null&&t.get(n)==null&&t.set(n,e)}return t}function GQ(i){var t=pSt(i);return t.dimNameMap||(t.dimNameMap=UQ(i.dimensionsDefine))}function HQ(i){return i>30}var wb=nr,Gf=ti,mSt=typeof Int32Array>"u"?Array:Int32Array,vSt="e\0\0",E8=-1,_St=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],ySt=["_approximateExtent"],D8,OA,Sb,Tb,gR,Ab,mR,xSt=function(){function i(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","minmaxDownSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","minmaxDownSample","lttbDownSample"];var r,n=!1;VQ(t)?(r=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(n=!0,r=t),r=r||["x","y"];for(var o={},s=[],a={},u=!1,f={},g=0;g<r.length;g++){var v=r[g],y=bi(v)?new JI({name:v}):v instanceof JI?v:new JI(v),w=y.name;y.type=y.type||"float",y.coordDim||(y.coordDim=w,y.coordDimIndex=0);var I=y.otherDims=y.otherDims||{};s.push(w),o[w]=y,f[w]!=null&&(u=!0),y.createInvertedIndices&&(a[w]=[]);var E=g;fn(y.storeDimIndex)&&(E=y.storeDimIndex),I.itemName===0&&(this._nameDimIdx=E),I.itemId===0&&(this._idDimIdx=E),n&&(y.storeDimIndex=g)}if(this.dimensions=s,this._dimInfos=o,this._initGetDimensionInfo(u),this.hostModel=e,this._invertedIndicesMap=a,this._dimOmitted){var D=this._dimIdxToName=Fi();gt(s,function(R){D.set(o[R].storeDimIndex,R)})}}return i.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var r=this._dimIdxToName.get(e);if(r!=null)return r;var n=this._schema.getSourceDimension(e);if(n)return n.name},i.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var r=this._getDimInfo(t);return r?r.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},i.prototype._recognizeDimIndex=function(t){if(fn(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},i.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);return e},i.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},i.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(r){return e.hasOwnProperty(r)?e[r]:void 0}:function(r){return e[r]}},i.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},i.prototype.mapDimension=function(t,e){var r=this._dimSummary;if(e==null)return r.encodeFirstDimNotExtra[t];var n=r.encode[t];return n?n[e]:null},i.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,r=e.encode[t];return(r||[]).slice()},i.prototype.getStore=function(){return this._store},i.prototype.initData=function(t,e,r){var n=this,o;if(t instanceof gz&&(o=t),!o){var s=this.dimensions,a=o3(t)||Ns(t)?new GJ(t,s.length):t;o=new gz;var u=Gf(s,function(f){return{type:n._dimInfos[f].type,property:f}});o.initData(a,u,r)}this._store=o,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,o.count()),this._dimSummary=hSt(this,this._schema),this.userOutput=this._dimSummary.userOutput},i.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},i.prototype.appendValues=function(t,e){var r=this._store.appendValues(t,e&&e.length),n=r.start,o=r.end,s=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var a=n;a<o;a++){var u=a-n;this._nameList[a]=e[u],s&&mR(this,a)}},i.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,r=0;r<e.length;r++){var n=this._dimInfos[e[r]];n.ordinalMeta&&t.collectOrdinalMeta(n.storeDimIndex,n.ordinalMeta)}},i.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==Sp&&!t.fillStorage},i.prototype._doInit=function(t,e){if(!(t>=e)){var r=this._store,n=r.getProvider();this._updateOrdinalMeta();var o=this._nameList,s=this._idList,a=n.getSource().sourceFormat,u=a===nc;if(u&&!n.pure)for(var f=[],g=t;g<e;g++){var v=n.getItem(g,f);if(!this.hasItemOption&&Iyt(v)&&(this.hasItemOption=!0),v){var y=v.name;o[g]==null&&y!=null&&(o[g]=Lo(y,null));var w=v.id;s[g]==null&&w!=null&&(s[g]=Lo(w,null))}}if(this._shouldMakeIdFromName())for(var g=t;g<e;g++)mR(this,g);D8(this)}},i.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},i.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},i.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},i.prototype.setCalculationInfo=function(t,e){wb(t)?Fe(this._calculationInfo,t):this._calculationInfo[t]=e},i.prototype.getName=function(t){var e=this.getRawIndex(t),r=this._nameList[e];return r==null&&this._nameDimIdx!=null&&(r=Sb(this,this._nameDimIdx,e)),r==null&&(r=""),r},i.prototype._getCategory=function(t,e){var r=this._store.get(t,e),n=this._store.getOrdinalMeta(t);return n?n.categories[r]:r},i.prototype.getId=function(t){return OA(this,this.getRawIndex(t))},i.prototype.count=function(){return this._store.count()},i.prototype.get=function(t,e){var r=this._store,n=this._dimInfos[t];if(n)return r.get(n.storeDimIndex,e)},i.prototype.getByRawIndex=function(t,e){var r=this._store,n=this._dimInfos[t];if(n)return r.getByRawIndex(n.storeDimIndex,e)},i.prototype.getIndices=function(){return this._store.getIndices()},i.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},i.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},i.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},i.prototype.getValues=function(t,e){var r=this,n=this._store;return Ye(t)?n.getValues(Gf(t,function(o){return r._getStoreDimIndex(o)}),e):n.getValues(t)},i.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,r=0,n=e.length;r<n;r++)if(isNaN(this._store.get(e[r],t)))return!1;return!0},i.prototype.indexOfName=function(t){for(var e=0,r=this._store.count();e<r;e++)if(this.getName(e)===t)return e;return-1},i.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},i.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},i.prototype.rawIndexOf=function(t,e){var r=t&&this._invertedIndicesMap[t],n=r&&r[e];return n==null||isNaN(n)?E8:n},i.prototype.each=function(t,e,r){Xi(t)&&(r=e,e=t,t=[]);var n=r||this,o=Gf(Tb(t),this._getStoreDimIndex,this);this._store.each(o,n?wi(e,n):e)},i.prototype.filterSelf=function(t,e,r){Xi(t)&&(r=e,e=t,t=[]);var n=r||this,o=Gf(Tb(t),this._getStoreDimIndex,this);return this._store=this._store.filter(o,n?wi(e,n):e),this},i.prototype.selectRange=function(t){var e=this,r={},n=on(t);return gt(n,function(o){var s=e._getStoreDimIndex(o);r[s]=t[o]}),this._store=this._store.selectRange(r),this},i.prototype.mapArray=function(t,e,r){Xi(t)&&(r=e,e=t,t=[]),r=r||this;var n=[];return this.each(t,function(){n.push(e&&e.apply(this,arguments))},r),n},i.prototype.map=function(t,e,r,n){var o=r||n||this,s=Gf(Tb(t),this._getStoreDimIndex,this),a=Ab(this);return a._store=this._store.map(s,o?wi(e,o):e),a},i.prototype.modify=function(t,e,r,n){var o=r||n||this,s=Gf(Tb(t),this._getStoreDimIndex,this);this._store.modify(s,o?wi(e,o):e)},i.prototype.downSample=function(t,e,r,n){var o=Ab(this);return o._store=this._store.downSample(this._getStoreDimIndex(t),e,r,n),o},i.prototype.minmaxDownSample=function(t,e){var r=Ab(this);return r._store=this._store.minmaxDownSample(this._getStoreDimIndex(t),e),r},i.prototype.lttbDownSample=function(t,e){var r=Ab(this);return r._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),r},i.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},i.prototype.getItemModel=function(t){var e=this.hostModel,r=this.getRawDataItem(t);return new bn(r,e,e&&e.ecModel)},i.prototype.diff=function(t){var e=this;return new Od(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(r){return OA(t,r)},function(r){return OA(e,r)})},i.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},i.prototype.setVisual=function(t,e){this._visual=this._visual||{},wb(t)?Fe(this._visual,t):this._visual[t]=e},i.prototype.getItemVisual=function(t,e){var r=this._itemVisuals[t],n=r&&r[e];return n??this.getVisual(e)},i.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},i.prototype.ensureUniqueItemVisual=function(t,e){var r=this._itemVisuals,n=r[t];n||(n=r[t]={});var o=n[e];return o==null&&(o=this.getVisual(e),Ye(o)?o=o.slice():wb(o)&&(o=Fe({},o)),n[e]=o),o},i.prototype.setItemVisual=function(t,e,r){var n=this._itemVisuals[t]||{};this._itemVisuals[t]=n,wb(e)?Fe(n,e):n[e]=r},i.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},i.prototype.setLayout=function(t,e){wb(t)?Fe(this._layout,t):this._layout[t]=e},i.prototype.getLayout=function(t){return this._layout[t]},i.prototype.getItemLayout=function(t){return this._itemLayouts[t]},i.prototype.setItemLayout=function(t,e,r){this._itemLayouts[t]=r?Fe(this._itemLayouts[t]||{},e):e},i.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},i.prototype.setItemGraphicEl=function(t,e){var r=this.hostModel&&this.hostModel.seriesIndex;KO(r,this.dataType,t,e),this._graphicEls[t]=e},i.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},i.prototype.eachItemGraphicEl=function(t,e){gt(this._graphicEls,function(r,n){r&&t&&t.call(e,r,n)})},i.prototype.cloneShallow=function(t){return t||(t=new i(this._schema?this._schema:Gf(this.dimensions,this._getDimInfo,this),this.hostModel)),gR(t,this),t._store=this._store,t},i.prototype.wrapMethod=function(t,e){var r=this[t];Xi(r)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var n=r.apply(this,arguments);return e.apply(this,[n].concat(_F(arguments)))})},i.internalField=function(){D8=function(t){var e=t._invertedIndicesMap;gt(e,function(r,n){var o=t._dimInfos[n],s=o.ordinalMeta,a=t._store;if(s){r=e[n]=new mSt(s.categories.length);for(var u=0;u<r.length;u++)r[u]=E8;for(var u=0;u<a.count();u++)r[a.get(o.storeDimIndex,u)]=u}})},Sb=function(t,e,r){return Lo(t._getCategory(e,r),null)},OA=function(t,e){var r=t._idList[e];return r==null&&t._idDimIdx!=null&&(r=Sb(t,t._idDimIdx,e)),r==null&&(r=vSt+e),r},Tb=function(t){return Ye(t)||(t=t!=null?[t]:[]),t},Ab=function(t){var e=new i(t._schema?t._schema:Gf(t.dimensions,t._getDimInfo,t),t.hostModel);return gR(e,t),e},gR=function(t,e){gt(_St.concat(e.__wrappedMethods||[]),function(r){e.hasOwnProperty(r)&&(t[r]=e[r])}),t.__wrappedMethods=e.__wrappedMethods,gt(ySt,function(r){t[r]=Yi(e[r])}),t._calculationInfo=Fe({},e._calculationInfo)},mR=function(t,e){var r=t._nameList,n=t._idList,o=t._nameDimIdx,s=t._idDimIdx,a=r[e],u=n[e];if(a==null&&o!=null&&(r[e]=a=Sb(t,o,e)),u==null&&s!=null&&(n[e]=u=Sb(t,s,e)),u==null&&a!=null){var f=t._nameRepeatCount,g=f[a]=(f[a]||0)+1;u=a,g>1&&(u+="__ec__"+g),n[e]=u}}}(),i}();const dl=xSt;function GS(i,t){o3(i)||(i=s3(i)),t=t||{};var e=t.coordDimensions||[],r=t.dimensionsDefine||i.dimensionsDefine||[],n=Fi(),o=[],s=wSt(i,e,r,t.dimensionsCount),a=t.canOmitUnusedDimensions&&HQ(s),u=r===i.dimensionsDefine,f=u?GQ(i):UQ(r),g=t.encodeDefine;!g&&t.encodeDefaulter&&(g=t.encodeDefaulter(i,s));for(var v=Fi(g),y=new YJ(s),w=0;w<y.length;w++)y[w]=-1;function I(rt){var lt=y[rt];if(lt<0){var ht=r[rt],yt=nr(ht)?ht:{name:ht},ft=new JI,kt=yt.name;kt!=null&&f.get(kt)!=null&&(ft.name=ft.displayName=kt),yt.type!=null&&(ft.type=yt.type),yt.displayName!=null&&(ft.displayName=yt.displayName);var Rt=o.length;return y[rt]=Rt,ft.storeDimIndex=rt,o.push(ft),ft}return o[lt]}if(!a)for(var w=0;w<s;w++)I(w);v.each(function(rt,lt){var ht=na(rt).slice();if(ht.length===1&&!bi(ht[0])&&ht[0]<0){v.set(lt,!1);return}var yt=v.set(lt,[]);gt(ht,function(ft,kt){var Rt=bi(ft)?f.get(ft):ft;Rt!=null&&Rt<s&&(yt[kt]=Rt,D(I(Rt),lt,kt))})});var E=0;gt(e,function(rt){var lt,ht,yt,ft;if(bi(rt))lt=rt,ft={};else{ft=rt,lt=ft.name;var kt=ft.ordinalMeta;ft.ordinalMeta=null,ft=Fe({},ft),ft.ordinalMeta=kt,ht=ft.dimsDef,yt=ft.otherDims,ft.name=ft.coordDim=ft.coordDimIndex=ft.dimsDef=ft.otherDims=null}var Rt=v.get(lt);if(Rt!==!1){if(Rt=na(Rt),!Rt.length)for(var Ct=0;Ct<(ht&&ht.length||1);Ct++){for(;E<s&&I(E).coordDim!=null;)E++;E<s&&Rt.push(E++)}gt(Rt,function(Gt,Vt){var Qt=I(Gt);if(u&&ft.type!=null&&(Qt.type=ft.type),D(rr(Qt,ft),lt,Vt),Qt.name==null&&ht){var fe=ht[Vt];!nr(fe)&&(fe={name:fe}),Qt.name=Qt.displayName=fe.name,Qt.defaultTooltip=fe.defaultTooltip}yt&&rr(Qt.otherDims,yt)})}});function D(rt,lt,ht){CJ.get(lt)!=null?rt.otherDims[lt]=ht:(rt.coordDim=lt,rt.coordDimIndex=ht,n.set(lt,!0))}var R=t.generateCoord,z=t.generateCoordCount,N=z!=null;z=R?z||1:0;var H=R||"value";function $(rt){rt.name==null&&(rt.name=rt.coordDim)}if(a)gt(o,function(rt){$(rt)}),o.sort(function(rt,lt){return rt.storeDimIndex-lt.storeDimIndex});else for(var X=0;X<s;X++){var K=I(X),et=K.coordDim;et==null&&(K.coordDim=SSt(H,n,N),K.coordDimIndex=0,(!R||z<=0)&&(K.isExtraCoord=!0),z--),$(K),K.type==null&&(LJ(i,X)===fs.Must||K.isExtraCoord&&(K.otherDims.itemName!=null||K.otherDims.seriesName!=null))&&(K.type="ordinal")}return bSt(o),new NQ({source:i,dimensions:o,fullDimensionCount:s,dimensionOmitted:a})}function bSt(i){for(var t=Fi(),e=0;e<i.length;e++){var r=i[e],n=r.name,o=t.get(n)||0;o>0&&(r.name=n+(o-1)),o++,t.set(n,o)}}function wSt(i,t,e,r){var n=Math.max(i.dimensionsDetectedCount||1,t.length,e.length,r||0);return gt(t,function(o){var s;nr(o)&&(s=o.dimsDef)&&(n=Math.max(n,s.length))}),n}function SSt(i,t,e){if(e||t.hasKey(i)){for(var r=0;t.hasKey(i+r);)r++;i+=r}return t.set(i,!0),i}var TSt=function(){function i(t){this.coordSysDims=[],this.axisMap=Fi(),this.categoryAxisMap=Fi(),this.coordSysName=t}return i}();function ASt(i){var t=i.get("coordinateSystem"),e=new TSt(t),r=ISt[t];if(r)return r(i,e,e.axisMap,e.categoryAxisMap),e}var ISt={cartesian2d:function(i,t,e,r){var n=i.getReferringComponents("xAxis",Wa).models[0],o=i.getReferringComponents("yAxis",Wa).models[0];t.coordSysDims=["x","y"],e.set("x",n),e.set("y",o),Iy(n)&&(r.set("x",n),t.firstCategoryDimIndex=0),Iy(o)&&(r.set("y",o),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1))},singleAxis:function(i,t,e,r){var n=i.getReferringComponents("singleAxis",Wa).models[0];t.coordSysDims=["single"],e.set("single",n),Iy(n)&&(r.set("single",n),t.firstCategoryDimIndex=0)},polar:function(i,t,e,r){var n=i.getReferringComponents("polar",Wa).models[0],o=n.findAxisModel("radiusAxis"),s=n.findAxisModel("angleAxis");t.coordSysDims=["radius","angle"],e.set("radius",o),e.set("angle",s),Iy(o)&&(r.set("radius",o),t.firstCategoryDimIndex=0),Iy(s)&&(r.set("angle",s),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1))},geo:function(i,t,e,r){t.coordSysDims=["lng","lat"]},parallel:function(i,t,e,r){var n=i.ecModel,o=n.getComponent("parallel",i.get("parallelIndex")),s=t.coordSysDims=o.dimensions.slice();gt(o.parallelAxisIndex,function(a,u){var f=n.getComponent("parallelAxis",a),g=s[u];e.set(g,f),Iy(f)&&(r.set(g,f),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=u))})},matrix:function(i,t,e,r){var n=i.getReferringComponents("matrix",Wa).models[0];t.coordSysDims=["x","y"];var o=n.getDimensionModel("x"),s=n.getDimensionModel("y");e.set("x",o),e.set("y",s),r.set("x",o),r.set("y",s)}};function Iy(i){return i.get("type")==="category"}function MSt(i,t,e){e=e||{};var r=e.byIndex,n=e.stackedCoordDimension,o,s,a;CSt(t)?o=t:(s=t.schema,o=s.dimensions,a=t.store);var u=!!(i&&i.get("stack")),f,g,v,y;if(gt(o,function(z,N){bi(z)&&(o[N]=z={name:z}),u&&!z.isExtraCoord&&(!r&&!f&&z.ordinalMeta&&(f=z),!g&&z.type!=="ordinal"&&z.type!=="time"&&(!n||n===z.coordDim)&&(g=z))}),g&&!r&&!f&&(r=!0),g){v="__\0ecstackresult_"+i.id,y="__\0ecstackedover_"+i.id,f&&(f.createInvertedIndices=!0);var w=g.coordDim,I=g.type,E=0;gt(o,function(z){z.coordDim===w&&E++});var D={name:v,coordDim:w,coordDimIndex:E,type:I,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:o.length},R={name:y,coordDim:y,coordDimIndex:E+1,type:I,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:o.length+1};s?(a&&(D.storeDimIndex=a.ensureCalculationDimension(y,I),R.storeDimIndex=a.ensureCalculationDimension(v,I)),s.appendCalculationDimension(D),s.appendCalculationDimension(R)):(o.push(D),o.push(R))}return{stackedDimension:g&&g.name,stackedByDimension:f&&f.name,isStackedByIndex:r,stackedOverDimension:y,stackResultDimension:v}}function CSt(i){return!VQ(i.schema)}function Lp(i,t){return!!t&&t===i.getCalculationInfo("stackedDimension")}function jQ(i,t){return Lp(i,t)?i.getCalculationInfo("stackResultDimension"):t}function ESt(i,t){var e=i.get("coordinateSystem"),r=NS.get(e),n;return t&&t.coordSysDims&&(n=ti(t.coordSysDims,function(o){var s={name:o},a=t.axisMap.get(o);if(a){var u=a.get("type");s.type=qM(u)}return s})),n||(n=r&&(r.getDimensionsInfo?r.getDimensionsInfo():r.dimensions.slice())||["x","y"]),n}function DSt(i,t,e){var r,n;return e&&gt(i,function(o,s){var a=o.coordDim,u=e.categoryAxisMap.get(a);u&&(r==null&&(r=s),o.ordinalMeta=u.getOrdinalMeta(),t&&(o.createInvertedIndices=!0)),o.otherDims.itemName!=null&&(n=!0)}),!n&&r!=null&&(i[r].otherDims.itemName=0),r}function Hd(i,t,e){e=e||{};var r=t.getSourceManager(),n,o=!1;i?(o=!0,n=s3(i)):(n=r.getSource(),o=n.sourceFormat===nc);var s=ASt(t),a=ESt(t,s),u=e.useEncodeDefaulter,f=Xi(u)?u:u?br(PJ,a,t):null,g={coordDimensions:a,generateCoord:e.generateCoord,encodeDefine:t.getEncode(),encodeDefaulter:f,canOmitUnusedDimensions:!o},v=GS(n,g),y=DSt(v.dimensions,e.createInvertedIndices,s),w=o?null:r.getSharedDataStore(v),I=MSt(t,{schema:v,store:w}),E=new dl(v,t);E.setCalculationInfo(I);var D=y!=null&&PSt(n)?function(R,z,N,H){return H===y?N:this.defaultDimValueGetter(R,z,N,H)}:null;return E.hasItemOption=!1,E.initData(o?n:w,null,D),E}function PSt(i){if(i.sourceFormat===nc){var t=LSt(i.data||[]);return!Ye(B0(t))}}function LSt(i){for(var t=0;t<i.length&&i[t]==null;)t++;return i[t]}function Iz(i){return i.type==="interval"||i.type==="log"}function RSt(i,t,e,r,n){var o={},s=o.interval=qY(t/e,!0);r!=null&&s<r&&(s=o.interval=r),n!=null&&s>n&&(s=o.interval=n);var a=o.intervalPrecision=uS(s),u=o.niceTickExtent=[vo(Math.ceil(i[0]/s)*s,a),vo(Math.floor(i[1]/s)*s,a)];return kSt(u,i),o}function vR(i){var t=Math.pow(10,MF(i)),e=i/t;return e?e===2?e=3:e===3?e=5:e*=2:e=1,vo(e*t)}function uS(i){return sh(i)+2}function P8(i,t,e){i[t]=Math.max(Math.min(i[t],e[1]),e[0])}function kSt(i,t){!isFinite(i[0])&&(i[0]=t[0]),!isFinite(i[1])&&(i[1]=t[1]),P8(i,0,t),P8(i,1,t),i[0]>i[1]&&(i[0]=i[1])}function x3(i,t){return i>=t[0]&&i<=t[1]}var OSt=function(){function i(){this.normalize=L8,this.scale=R8}return i.prototype.updateMethods=function(t){t.hasBreaks()?(this.normalize=wi(t.normalize,t),this.scale=wi(t.scale,t)):(this.normalize=L8,this.scale=R8)},i}();function L8(i,t){return t[1]===t[0]?.5:(i-t[0])/(t[1]-t[0])}function R8(i,t){return i*(t[1]-t[0])+t[0]}function Mz(i,t,e){var r=Math.log(i);return[Math.log(e?t[0]:Math.max(0,t[0]))/r,Math.log(e?t[1]:Math.max(0,t[1]))/r]}var WQ=function(){function i(t){this._calculator=new OSt,this._setting=t||{},this._extent=[1/0,-1/0];var e=_o();e&&(this._brkCtx=e.createScaleBreakContext(),this._brkCtx.update(this._extent))}return i.prototype.getSetting=function(t){return this._setting[t]},i.prototype._innerUnionExtent=function(t){var e=this._extent;this._innerSetExtent(t[0]<e[0]?t[0]:e[0],t[1]>e[1]?t[1]:e[1])},i.prototype.unionExtentFromData=function(t,e){this._innerUnionExtent(t.getApproximateExtent(e))},i.prototype.getExtent=function(){return this._extent.slice()},i.prototype.setExtent=function(t,e){this._innerSetExtent(t,e)},i.prototype._innerSetExtent=function(t,e){var r=this._extent;isNaN(t)||(r[0]=t),isNaN(e)||(r[1]=e),this._brkCtx&&this._brkCtx.update(r)},i.prototype.setBreaksFromOption=function(t){var e=_o();e&&this._innerSetBreak(e.parseAxisBreakOption(t,wi(this.parse,this)))},i.prototype._innerSetBreak=function(t){this._brkCtx&&(this._brkCtx.setBreaks(t),this._calculator.updateMethods(this._brkCtx),this._brkCtx.update(this._extent))},i.prototype._innerGetBreaks=function(){return this._brkCtx?this._brkCtx.breaks:[]},i.prototype.hasBreaks=function(){return this._brkCtx?this._brkCtx.hasBreaks():!1},i.prototype._getExtentSpanWithBreaks=function(){return this._brkCtx&&this._brkCtx.hasBreaks()?this._brkCtx.getExtentSpan():this._extent[1]-this._extent[0]},i.prototype.isInExtentRange=function(t){return this._extent[0]<=t&&this._extent[1]>=t},i.prototype.isBlank=function(){return this._isBlank},i.prototype.setBlank=function(t){this._isBlank=t},i}();iE(WQ);const Dv=WQ;var zSt=0,BSt=function(){function i(t){this.categories=t.categories||[],this._needCollect=t.needCollect,this._deduplication=t.deduplication,this.uid=++zSt,this._onCollect=t.onCollect}return i.createByAxisModel=function(t){var e=t.option,r=e.data,n=r&&ti(r,FSt);return new i({categories:n,needCollect:!n,deduplication:e.dedplication!==!1})},i.prototype.getOrdinal=function(t){return this._getOrCreateMap().get(t)},i.prototype.parseAndCollect=function(t){var e,r=this._needCollect;if(!bi(t)&&!r)return t;if(r&&!this._deduplication)return e=this.categories.length,this.categories[e]=t,this._onCollect&&this._onCollect(t,e),e;var n=this._getOrCreateMap();return e=n.get(t),e==null&&(r?(e=this.categories.length,this.categories[e]=t,n.set(t,e),this._onCollect&&this._onCollect(t,e)):e=NaN),e},i.prototype._getOrCreateMap=function(){return this._map||(this._map=Fi(this.categories))},i}();function FSt(i){return nr(i)&&i.value!=null?i.value:i+""}const hS=BSt;var $Q=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;r.type="ordinal";var n=r.getSetting("ordinalMeta");return n||(n=new hS({})),Ye(n)&&(n=new hS({categories:ti(n,function(o){return nr(o)?o.value:o})})),r._ordinalMeta=n,r._extent=r.getSetting("extent")||[0,n.categories.length-1],r}return t.prototype.parse=function(e){return e==null?NaN:bi(e)?this._ordinalMeta.getOrdinal(e):Math.round(e)},t.prototype.contain=function(e){return x3(e,this._extent)&&e>=0&&e<this._ordinalMeta.categories.length},t.prototype.normalize=function(e){return e=this._getTickNumber(e),this._calculator.normalize(e,this._extent)},t.prototype.scale=function(e){return e=Math.round(this._calculator.scale(e,this._extent)),this.getRawOrdinalNumber(e)},t.prototype.getTicks=function(){for(var e=[],r=this._extent,n=r[0];n<=r[1];)e.push({value:n}),n++;return e},t.prototype.getMinorTicks=function(e){},t.prototype.setSortInfo=function(e){if(e==null){this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null;return}for(var r=e.ordinalNumbers,n=this._ordinalNumbersByTick=[],o=this._ticksByOrdinalNumber=[],s=0,a=this._ordinalMeta.categories.length,u=Math.min(a,r.length);s<u;++s){var f=r[s];n[s]=f,o[f]=s}for(var g=0;s<a;++s){for(;o[g]!=null;)g++;n.push(g),o[g]=s}},t.prototype._getTickNumber=function(e){var r=this._ticksByOrdinalNumber;return r&&e>=0&&e<r.length?r[e]:e},t.prototype.getRawOrdinalNumber=function(e){var r=this._ordinalNumbersByTick;return r&&e>=0&&e<r.length?r[e]:e},t.prototype.getLabel=function(e){if(!this.isBlank()){var r=this.getRawOrdinalNumber(e.value),n=this._ordinalMeta.categories[r];return n==null?"":n+""}},t.prototype.count=function(){return this._extent[1]-this._extent[0]+1},t.prototype.isInExtentRange=function(e){return e=this._getTickNumber(e),this._extent[0]<=e&&this._extent[1]>=e},t.prototype.getOrdinalMeta=function(){return this._ordinalMeta},t.prototype.calcNiceTicks=function(){},t.prototype.calcNiceExtent=function(){},t.type="ordinal",t}(Dv);Dv.registerClass($Q);const dS=$Q;var Hf=vo,ZQ=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="interval",e._interval=0,e._intervalPrecision=2,e}return t.prototype.parse=function(e){return e==null||e===""?NaN:Number(e)},t.prototype.contain=function(e){return x3(e,this._extent)},t.prototype.normalize=function(e){return this._calculator.normalize(e,this._extent)},t.prototype.scale=function(e){return this._calculator.scale(e,this._extent)},t.prototype.getInterval=function(){return this._interval},t.prototype.setInterval=function(e){this._interval=e,this._niceExtent=this._extent.slice(),this._intervalPrecision=uS(e)},t.prototype.getTicks=function(e){e=e||{};var r=this._interval,n=this._extent,o=this._niceExtent,s=this._intervalPrecision,a=_o(),u=[];if(!r)return u;if(e.breakTicks==="only_break"&&a)return a.addBreaksToTicks(u,this._brkCtx.breaks,this._extent),u;var f=1e4;n[0]<o[0]&&(e.expandToNicedExtent?u.push({value:Hf(o[0]-r,s)}):u.push({value:n[0]}));for(var g=function(I,E){return Math.round((E-I)/r)},v=o[0];v<=o[1];){if(u.push({value:v}),v=Hf(v+r,s),this._brkCtx){var y=this._brkCtx.calcNiceTickMultiple(v,g);y>=0&&(v=Hf(v+y*r,s))}if(u.length>0&&v===u[u.length-1].value)break;if(u.length>f)return[]}var w=u.length?u[u.length-1].value:o[1];return n[1]>w&&(e.expandToNicedExtent?u.push({value:Hf(w+r,s)}):u.push({value:n[1]})),a&&a.pruneTicksByBreak(e.pruneByBreak,u,this._brkCtx.breaks,function(I){return I.value},this._interval,this._extent),e.breakTicks!=="none"&&a&&a.addBreaksToTicks(u,this._brkCtx.breaks,this._extent),u},t.prototype.getMinorTicks=function(e){for(var r=this.getTicks({expandToNicedExtent:!0}),n=[],o=this.getExtent(),s=1;s<r.length;s++){var a=r[s],u=r[s-1];if(!(u.break||a.break)){for(var f=0,g=[],v=a.value-u.value,y=v/e,w=uS(y);f<e-1;){var I=Hf(u.value+(f+1)*y,w);I>o[0]&&I<o[1]&&g.push(I),f++}var E=_o();E&&E.pruneTicksByBreak("auto",g,this._getNonTransBreaks(),function(D){return D},this._interval,o),n.push(g)}}return n},t.prototype._getNonTransBreaks=function(){return this._brkCtx?this._brkCtx.breaks:[]},t.prototype.getLabel=function(e,r){if(e==null)return"";var n=r&&r.precision;n==null?n=sh(e.value)||0:n==="auto"&&(n=this._intervalPrecision);var o=Hf(e.value,n,!0);return gJ(o)},t.prototype.calcNiceTicks=function(e,r,n){e=e||5;var o=this._extent.slice(),s=this._getExtentSpanWithBreaks();if(isFinite(s)){s<0&&(s=-s,o.reverse(),this._innerSetExtent(o[0],o[1]),o=this._extent.slice());var a=RSt(o,s,e,r,n);this._intervalPrecision=a.intervalPrecision,this._interval=a.interval,this._niceExtent=a.niceTickExtent}},t.prototype.calcNiceExtent=function(e){var r=this._extent.slice();if(r[0]===r[1])if(r[0]!==0){var n=Math.abs(r[0]);e.fixMax||(r[1]+=n/2),r[0]-=n/2}else r[1]=1;var o=r[1]-r[0];isFinite(o)||(r[0]=0,r[1]=1),this._innerSetExtent(r[0],r[1]),r=this._extent.slice(),this.calcNiceTicks(e.splitNumber,e.minInterval,e.maxInterval);var s=this._interval,a=this._intervalPrecision;e.fixMin||(r[0]=Hf(Math.floor(r[0]/s)*s,a)),e.fixMax||(r[1]=Hf(Math.ceil(r[1]/s)*s,a)),this._innerSetExtent(r[0],r[1])},t.prototype.setNiceExtent=function(e,r){this._niceExtent=[e,r]},t.type="interval",t}(Dv);Dv.registerClass(ZQ);const Rp=ZQ;var qQ=typeof Float32Array<"u",NSt=qQ?Float32Array:Array;function ch(i){return Ye(i)?qQ?new Float32Array(i):i:new NSt(i)}var Cz="__ec_stack_";function b3(i){return i.get("stack")||Cz+i.seriesIndex}function w3(i){return i.dim+i.index}function VSt(i){var t=[],e=i.axis,r="axis0";if(e.type==="category"){for(var n=e.getBandWidth(),o=0;o<i.count;o++)t.push(rr({bandWidth:n,axisKey:r,stackId:Cz+o},i));for(var s=KQ(t),a=[],o=0;o<i.count;o++){var u=s[r][Cz+o];u.offsetCenter=u.offset+u.width/2,a.push(u)}return a}}function XQ(i,t){var e=[];return t.eachSeriesByType(i,function(r){ttt(r)&&e.push(r)}),e}function USt(i){var t={};gt(i,function(u){var f=u.coordinateSystem,g=f.getBaseAxis();if(!(g.type!=="time"&&g.type!=="value"))for(var v=u.getData(),y=g.dim+"_"+g.index,w=v.getDimensionIndex(v.mapDimension(g.dim)),I=v.getStore(),E=0,D=I.count();E<D;++E){var R=I.get(w,E);t[y]?t[y].push(R):t[y]=[R]}});var e={};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];if(n){n.sort(function(u,f){return u-f});for(var o=null,s=1;s<n.length;++s){var a=n[s]-n[s-1];a>0&&(o=o===null?a:Math.min(o,a))}e[r]=o}}return e}function YQ(i){var t=USt(i),e=[];return gt(i,function(r){var n=r.coordinateSystem,o=n.getBaseAxis(),s=o.getExtent(),a;if(o.type==="category")a=o.getBandWidth();else if(o.type==="value"||o.type==="time"){var u=o.dim+"_"+o.index,f=t[u],g=Math.abs(s[1]-s[0]),v=o.scale.getExtent(),y=Math.abs(v[1]-v[0]);a=f?g/y*f:g}else{var w=r.getData();a=Math.abs(s[1]-s[0])/w.count()}var I=xi(r.get("barWidth"),a),E=xi(r.get("barMaxWidth"),a),D=xi(r.get("barMinWidth")||(ett(r)?.5:1),a),R=r.get("barGap"),z=r.get("barCategoryGap"),N=r.get("defaultBarGap");e.push({bandWidth:a,barWidth:I,barMaxWidth:E,barMinWidth:D,barGap:R,barCategoryGap:z,defaultBarGap:N,axisKey:w3(o),stackId:b3(r)})}),KQ(e)}function KQ(i){var t={};gt(i,function(r,n){var o=r.axisKey,s=r.bandWidth,a=t[o]||{bandWidth:s,remainedWidth:s,autoWidthCount:0,categoryGap:null,gap:r.defaultBarGap||0,stacks:{}},u=a.stacks;t[o]=a;var f=r.stackId;u[f]||a.autoWidthCount++,u[f]=u[f]||{width:0,maxWidth:0};var g=r.barWidth;g&&!u[f].width&&(u[f].width=g,g=Math.min(a.remainedWidth,g),a.remainedWidth-=g);var v=r.barMaxWidth;v&&(u[f].maxWidth=v);var y=r.barMinWidth;y&&(u[f].minWidth=y);var w=r.barGap;w!=null&&(a.gap=w);var I=r.barCategoryGap;I!=null&&(a.categoryGap=I)});var e={};return gt(t,function(r,n){e[n]={};var o=r.stacks,s=r.bandWidth,a=r.categoryGap;if(a==null){var u=on(o).length;a=Math.max(35-u*4,15)+"%"}var f=xi(a,s),g=xi(r.gap,1),v=r.remainedWidth,y=r.autoWidthCount,w=(v-f)/(y+(y-1)*g);w=Math.max(w,0),gt(o,function(R){var z=R.maxWidth,N=R.minWidth;if(R.width){var H=R.width;z&&(H=Math.min(H,z)),N&&(H=Math.max(H,N)),R.width=H,v-=H+g*H,y--}else{var H=w;z&&z<H&&(H=Math.min(z,v)),N&&N>H&&(H=N),H!==w&&(R.width=H,v-=H+g*H,y--)}}),w=(v-f)/(y+(y-1)*g),w=Math.max(w,0);var I=0,E;gt(o,function(R,z){R.width||(R.width=w),E=R,I+=R.width*(1+g)}),E&&(I-=E.width*g);var D=-I/2;gt(o,function(R,z){e[n][z]=e[n][z]||{bandWidth:s,offset:D,width:R.width},D+=R.width*(1+g)})}),e}function GSt(i,t,e){if(i&&t){var r=i[w3(t)];return r!=null&&e!=null?r[b3(e)]:r}}function JQ(i,t){var e=XQ(i,t),r=YQ(e);gt(e,function(n){var o=n.getData(),s=n.coordinateSystem,a=s.getBaseAxis(),u=b3(n),f=r[w3(a)][u],g=f.offset,v=f.width;o.setLayout({bandWidth:f.bandWidth,offset:g,size:v})})}function QQ(i){return{seriesType:i,plan:W0(),reset:function(t){if(ttt(t)){var e=t.getData(),r=t.coordinateSystem,n=r.getBaseAxis(),o=r.getOtherAxis(n),s=e.getDimensionIndex(e.mapDimension(o.dim)),a=e.getDimensionIndex(e.mapDimension(n.dim)),u=t.get("showBackground",!0),f=e.mapDimension(o.dim),g=e.getCalculationInfo("stackResultDimension"),v=Lp(e,f)&&!!e.getCalculationInfo("stackedOnSeries"),y=o.isHorizontal(),w=HSt(n,o),I=ett(t),E=t.get("barMinHeight")||0,D=g&&e.getDimensionIndex(g),R=e.getLayout("size"),z=e.getLayout("offset");return{progress:function(N,H){for(var $=N.count,X=I&&ch($*3),K=I&&u&&ch($*3),et=I&&ch($),rt=r.master.getRect(),lt=y?rt.width:rt.height,ht,yt=H.getStore(),ft=0;(ht=N.next())!=null;){var kt=yt.get(v?D:s,ht),Rt=yt.get(a,ht),Ct=w,Gt=void 0;v&&(Gt=+kt-yt.get(s,ht));var Vt=void 0,Qt=void 0,fe=void 0,Te=void 0;if(y){var be=r.dataToPoint([kt,Rt]);if(v){var Ge=r.dataToPoint([Gt,Rt]);Ct=Ge[0]}Vt=Ct,Qt=be[1]+z,fe=be[0]-Ct,Te=R,Math.abs(fe)<E&&(fe=(fe<0?-1:1)*E)}else{var be=r.dataToPoint([Rt,kt]);if(v){var Ge=r.dataToPoint([Rt,Gt]);Ct=Ge[1]}Vt=be[0]+z,Qt=Ct,fe=R,Te=be[1]-Ct,Math.abs(Te)<E&&(Te=(Te<=0?-1:1)*E)}I?(X[ft]=Vt,X[ft+1]=Qt,X[ft+2]=y?fe:Te,K&&(K[ft]=y?rt.x:Vt,K[ft+1]=y?Qt:rt.y,K[ft+2]=lt),et[ht]=ht):H.setItemLayout(ht,{x:Vt,y:Qt,width:fe,height:Te}),ft+=3}I&&H.setLayout({largePoints:X,largeDataIndices:et,largeBackgroundPoints:K,valueAxisHorizontal:y})}}}}}}function ttt(i){return i.coordinateSystem&&i.coordinateSystem.type==="cartesian2d"}function ett(i){return i.pipelineContext&&i.pipelineContext.large}function HSt(i,t){var e=t.model.get("startValue");return e||(e=0),t.toGlobalCoord(t.dataToCoord(t.type==="log"?e>0?e:1:e))}var jSt=function(i,t,e,r){for(;e<r;){var n=e+r>>>1;i[n][1]<t?e=n+1:r=n}return e},itt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="time",r}return t.prototype.getLabel=function(e){var r=this.getSetting("useUTC");return mE(e.value,Tj[c1t(Cw(this._minLevelUnit))]||Tj.second,r,this.getSetting("locale"))},t.prototype.getFormattedLabel=function(e,r,n){var o=this.getSetting("useUTC"),s=this.getSetting("locale");return u1t(e,r,n,s,o)},t.prototype.getTicks=function(e){e=e||{};var r=this._interval,n=this._extent,o=_o(),s=[];if(!r)return s;var a=this.getSetting("useUTC");if(o&&e.breakTicks==="only_break")return _o().addBreaksToTicks(s,this._brkCtx.breaks,this._extent),s;var u=Yy(n[1],a);s.push({value:n[0],time:{level:0,upperTimeUnit:u,lowerTimeUnit:u}});var f=KSt(this._minLevelUnit,this._approxInterval,a,n,this._getExtentSpanWithBreaks(),this._brkCtx);s=s.concat(f);var g=Yy(n[1],a);s.push({value:n[1],time:{level:0,upperTimeUnit:g,lowerTimeUnit:g}});var v=this.getSetting("useUTC"),y=Zl.length-1,w=0;return gt(s,function(I){y=Math.min(y,Ar(Zl,I.time.upperTimeUnit)),w=Math.max(w,I.time.level)}),o&&_o().pruneTicksByBreak(e.pruneByBreak,s,this._brkCtx.breaks,function(I){return I.value},this._approxInterval,this._extent),o&&e.breakTicks!=="none"&&_o().addBreaksToTicks(s,this._brkCtx.breaks,this._extent,function(I){for(var E=Math.max(Ar(Zl,Yy(I.vmin,v)),Ar(Zl,Yy(I.vmax,v))),D=0,R=0;R<Zl.length;R++)if(!rtt(Zl[R],I.vmin,I.vmax,v)){D=R;break}var z=Math.min(D,y),N=Math.max(z,E);return{level:w,lowerTimeUnit:Zl[N],upperTimeUnit:Zl[z]}}),s},t.prototype.calcNiceExtent=function(e){var r=this.getExtent();if(r[0]===r[1]&&(r[0]-=Cc,r[1]+=Cc),r[1]===-1/0&&r[0]===1/0){var n=new Date;r[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),r[0]=r[1]-Cc}this._innerSetExtent(r[0],r[1]),this.calcNiceTicks(e.splitNumber,e.minInterval,e.maxInterval)},t.prototype.calcNiceTicks=function(e,r,n){e=e||10;var o=this._getExtentSpanWithBreaks();this._approxInterval=o/e,r!=null&&this._approxInterval<r&&(this._approxInterval=r),n!=null&&this._approxInterval>n&&(this._approxInterval=n);var s=zA.length,a=Math.min(jSt(zA,this._approxInterval,0,s),s-1);this._interval=zA[a][1],this._intervalPrecision=uS(this._interval),this._minLevelUnit=zA[Math.max(a-1,0)][0]},t.prototype.parse=function(e){return fn(e)?e:+Sv(e)},t.prototype.contain=function(e){return x3(e,this._extent)},t.prototype.normalize=function(e){return this._calculator.normalize(e,this._extent)},t.prototype.scale=function(e){return this._calculator.scale(e,this._extent)},t.type="time",t}(Rp),zA=[["second",qF],["minute",XF],["hour",Mw],["quarter-day",Mw*6],["half-day",Mw*12],["day",Cc*1.2],["half-week",Cc*3.5],["week",Cc*7],["month",Cc*31],["quarter",Cc*95],["half-year",Sj/2],["year",Sj]];function rtt(i,t,e,r){return cz(new Date(t),i,r).getTime()===cz(new Date(e),i,r).getTime()}function WSt(i,t){return i/=Cc,i>16?16:i>7.5?7:i>3.5?4:i>1.5?2:1}function $St(i){var t=30*Cc;return i/=t,i>6?6:i>3?3:i>2?2:1}function ZSt(i){return i/=Mw,i>12?12:i>6?6:i>3.5?4:i>2?2:1}function k8(i,t){return i/=t?XF:qF,i>30?30:i>20?20:i>15?15:i>10?10:i>5?5:i>2?2:1}function qSt(i){return qY(i,!0)}function XSt(i,t,e){var r=Math.max(0,Ar(Zl,t)-1);return cz(new Date(i),Zl[r],e).getTime()}function YSt(i,t){var e=new Date(0);e[i](1);var r=e.getTime();e[i](1+t);var n=e.getTime()-r;return function(o,s){return Math.max(0,Math.round((s-o)/n))}}function KSt(i,t,e,r,n,o){var s=1e4,a=a1t,u=0;function f(ft,kt,Rt,Ct,Gt,Vt,Qt){for(var fe=YSt(Gt,ft),Te=kt,be=new Date(Te);Te<Rt&&Te<=r[1]&&(Qt.push({value:Te}),!(u++>s));)if(be[Gt](be[Ct]()+ft),Te=be.getTime(),o){var Ge=o.calcNiceTickMultiple(Te,fe);Ge>0&&(be[Gt](be[Ct]()+Ge*ft),Te=be.getTime())}Qt.push({value:Te,notAdd:!0})}function g(ft,kt,Rt){var Ct=[],Gt=!kt.length;if(!rtt(Cw(ft),r[0],r[1],e)){Gt&&(kt=[{value:XSt(r[0],ft,e)},{value:r[1]}]);for(var Vt=0;Vt<kt.length-1;Vt++){var Qt=kt[Vt].value,fe=kt[Vt+1].value;if(Qt!==fe){var Te=void 0,be=void 0,Ge=void 0,li=!1;switch(ft){case"year":Te=Math.max(1,Math.round(t/Cc/365)),be=lJ(e),Ge=h1t(e);break;case"half-year":case"quarter":case"month":Te=$St(t),be=YF(e),Ge=cJ(e);break;case"week":case"half-week":case"day":Te=WSt(t),be=KF(e),Ge=uJ(e),li=!0;break;case"half-day":case"quarter-day":case"hour":Te=ZSt(t),be=JF(e),Ge=hJ(e);break;case"minute":Te=k8(t,!0),be=QF(e),Ge=dJ(e);break;case"second":Te=k8(t,!1),be=t3(e),Ge=fJ(e);break;case"millisecond":Te=qSt(t),be=e3(e),Ge=pJ(e);break}fe>=r[0]&&Qt<=r[1]&&f(Te,Qt,fe,be,Ge,li,Ct),ft==="year"&&Rt.length>1&&Vt===0&&Rt.unshift({value:Rt[0].value-Te})}}for(var Vt=0;Vt<Ct.length;Vt++)Rt.push(Ct[Vt])}}for(var v=[],y=[],w=0,I=0,E=0;E<a.length;++E){var D=Cw(a[E]);if(l1t(a[E])){g(a[E],v[v.length-1]||[],y);var R=a[E+1]?Cw(a[E+1]):null;if(D!==R){if(y.length){I=w,y.sort(function(ft,kt){return ft.value-kt.value});for(var z=[],N=0;N<y.length;++N){var H=y[N].value;(N===0||y[N-1].value!==H)&&(z.push(y[N]),H>=r[0]&&H<=r[1]&&w++)}var $=n/t;if(w>$*1.5&&I>$/1.5||(v.push(z),w>$||i===a[E]))break}y=[]}}}for(var X=Rn(ti(v,function(ft){return Rn(ft,function(kt){return kt.value>=r[0]&&kt.value<=r[1]&&!kt.notAdd})}),function(ft){return ft.length>0}),K=[],et=X.length-1,E=0;E<X.length;++E)for(var rt=X[E],lt=0;lt<rt.length;++lt){var ht=Yy(rt[lt].value,e);K.push({value:rt[lt].value,time:{level:et-E,upperTimeUnit:ht,lowerTimeUnit:ht}})}K.sort(function(ft,kt){return ft.value-kt.value});for(var yt=[],E=0;E<K.length;++E)(E===0||K[E].value!==K[E-1].value)&&yt.push(K[E]);return yt}Dv.registerClass(itt);const ntt=itt;var Ez=vo,JSt=Math.floor,QSt=Math.ceil,BA=Math.pow,FA=Math.log,att=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="log",e.base=10,e._originalScale=new Rp,e}return t.prototype.getTicks=function(e){e=e||{};var r=this._extent.slice(),n=this._originalScale.getExtent(),o=i.prototype.getTicks.call(this,e),s=this.base,a=this._originalScale._innerGetBreaks(),u=_o();return ti(o,function(f){var g=f.value,v=null,y=BA(s,g);g===r[0]&&this._fixMin?v=n[0]:g===r[1]&&this._fixMax&&(v=n[1]);var w;if(u){var I=u.getTicksLogTransformBreak(f,s,a,NA);w=I.vBreak,v==null&&(v=I.brkRoundingCriterion)}return v!=null&&(y=NA(y,v)),{value:y,break:w}},this)},t.prototype._getNonTransBreaks=function(){return this._originalScale._innerGetBreaks()},t.prototype.setExtent=function(e,r){this._originalScale.setExtent(e,r);var n=Mz(this.base,[e,r]);i.prototype.setExtent.call(this,n[0],n[1])},t.prototype.getExtent=function(){var e=this.base,r=i.prototype.getExtent.call(this);r[0]=BA(e,r[0]),r[1]=BA(e,r[1]);var n=this._originalScale.getExtent();return this._fixMin&&(r[0]=NA(r[0],n[0])),this._fixMax&&(r[1]=NA(r[1],n[1])),r},t.prototype.unionExtentFromData=function(e,r){this._originalScale.unionExtentFromData(e,r);var n=Mz(this.base,e.getApproximateExtent(r),!0);this._innerUnionExtent(n)},t.prototype.calcNiceTicks=function(e){e=e||10;var r=this._extent.slice(),n=this._getExtentSpanWithBreaks();if(!(!isFinite(n)||n<=0)){var o=wyt(n),s=e/n*o;for(s<=.5&&(o*=10);!isNaN(o)&&Math.abs(o)<1&&Math.abs(o)>0;)o*=10;var a=[Ez(QSt(r[0]/o)*o),Ez(JSt(r[1]/o)*o)];this._interval=o,this._intervalPrecision=uS(o),this._niceExtent=a}},t.prototype.calcNiceExtent=function(e){i.prototype.calcNiceExtent.call(this,e),this._fixMin=e.fixMin,this._fixMax=e.fixMax},t.prototype.contain=function(e){return e=FA(e)/FA(this.base),i.prototype.contain.call(this,e)},t.prototype.normalize=function(e){return e=FA(e)/FA(this.base),i.prototype.normalize.call(this,e)},t.prototype.scale=function(e){return e=i.prototype.scale.call(this,e),BA(this.base,e)},t.prototype.setBreaksFromOption=function(e){var r=_o();if(r){var n=r.logarithmicParseBreaksFromOption(e,this.base,wi(this.parse,this)),o=n.parsedOriginal,s=n.parsedLogged;this._originalScale._innerSetBreak(o),this._innerSetBreak(s)}},t.type="log",t}(Rp);function NA(i,t){return Ez(i,sh(t))}Dv.registerClass(att);const tTt=att;var eTt=function(){function i(t,e,r){this._prepareParams(t,e,r)}return i.prototype._prepareParams=function(t,e,r){r[1]<r[0]&&(r=[NaN,NaN]),this._dataMin=r[0],this._dataMax=r[1];var n=this._isOrdinal=t.type==="ordinal";this._needCrossZero=t.type==="interval"&&e.getNeedCrossZero&&e.getNeedCrossZero();var o=e.get("min",!0);o==null&&(o=e.get("startValue",!0));var s=this._modelMinRaw=o;Xi(s)?this._modelMinNum=VA(t,s({min:r[0],max:r[1]})):s!=="dataMin"&&(this._modelMinNum=VA(t,s));var a=this._modelMaxRaw=e.get("max",!0);if(Xi(a)?this._modelMaxNum=VA(t,a({min:r[0],max:r[1]})):a!=="dataMax"&&(this._modelMaxNum=VA(t,a)),n)this._axisDataLen=e.getCategories().length;else{var u=e.get("boundaryGap"),f=Ye(u)?u:[u||0,u||0];typeof f[0]=="boolean"||typeof f[1]=="boolean"?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[vu(f[0],1),vu(f[1],1)]}},i.prototype.calculate=function(){var t=this._isOrdinal,e=this._dataMin,r=this._dataMax,n=this._axisDataLen,o=this._boundaryGapInner,s=t?null:r-e||Math.abs(e),a=this._modelMinRaw==="dataMin"?e:this._modelMinNum,u=this._modelMaxRaw==="dataMax"?r:this._modelMaxNum,f=a!=null,g=u!=null;a==null&&(a=t?n?0:NaN:e-o[0]*s),u==null&&(u=t?n?n-1:NaN:r+o[1]*s),(a==null||!isFinite(a))&&(a=NaN),(u==null||!isFinite(u))&&(u=NaN);var v=Bs(a)||Bs(u)||t&&!n;this._needCrossZero&&(a>0&&u>0&&!f&&(a=0),a<0&&u<0&&!g&&(u=0));var y=this._determinedMin,w=this._determinedMax;return y!=null&&(a=y,f=!0),w!=null&&(u=w,g=!0),{min:a,max:u,minFixed:f,maxFixed:g,isBlank:v}},i.prototype.modifyDataMinMax=function(t,e){this[rTt[t]]=e},i.prototype.setDeterminedMinMax=function(t,e){var r=iTt[t];this[r]=e},i.prototype.freeze=function(){this.frozen=!0},i}(),iTt={min:"_determinedMin",max:"_determinedMax"},rTt={min:"_dataMin",max:"_dataMax"};function ott(i,t,e){var r=i.rawExtentInfo;return r||(r=new eTt(i,t,e),i.rawExtentInfo=r,r)}function VA(i,t){return t==null?null:Bs(t)?NaN:i.parse(t)}function stt(i,t){var e=i.type,r=ott(i,t,i.getExtent()).calculate();i.setBlank(r.isBlank);var n=r.min,o=r.max,s=t.ecModel;if(s&&e==="time"){var a=XQ("bar",s),u=!1;if(gt(a,function(v){u=u||v.getBaseAxis()===t.axis}),u){var f=YQ(a),g=nTt(n,o,t,f);n=g.min,o=g.max}}return{extent:[n,o],fixMin:r.minFixed,fixMax:r.maxFixed}}function nTt(i,t,e,r){var n=e.axis.getExtent(),o=Math.abs(n[1]-n[0]),s=GSt(r,e.axis);if(s===void 0)return{min:i,max:t};var a=1/0;gt(s,function(w){a=Math.min(w.offset,a)});var u=-1/0;gt(s,function(w){u=Math.max(w.offset+w.width,u)}),a=Math.abs(a),u=Math.abs(u);var f=a+u,g=t-i,v=1-(a+u)/o,y=g/v-g;return t+=y*(u/f),i-=y*(a/f),{min:i,max:t}}function T0(i,t){var e=t,r=stt(i,e),n=r.extent,o=e.get("splitNumber");i instanceof tTt&&(i.base=e.get("logBase"));var s=i.type,a=e.get("interval"),u=s==="interval"||s==="time";i.setBreaksFromOption(ctt(e)),i.setExtent(n[0],n[1]),i.calcNiceExtent({splitNumber:o,fixMin:r.fixMin,fixMax:r.fixMax,minInterval:u?e.get("minInterval"):null,maxInterval:u?e.get("maxInterval"):null}),a!=null&&i.setInterval&&i.setInterval(a)}function SE(i,t){if(t=t||i.get("type"),t)switch(t){case"category":return new dS({ordinalMeta:i.getOrdinalMeta?i.getOrdinalMeta():i.getCategories(),extent:[1/0,-1/0]});case"time":return new ntt({locale:i.ecModel.getLocaleModel(),useUTC:i.ecModel.get("useUTC")});default:return new(Dv.getClass(t)||Rp)}}function aTt(i){var t=i.scale.getExtent(),e=t[0],r=t[1];return!(e>0&&r>0||e<0&&r<0)}function q0(i){var t=i.getLabelModel().get("formatter");if(i.type==="time"){var e=o1t(t);return function(n,o){return i.scale.getFormattedLabel(n,o,e)}}else{if(bi(t))return function(n){var o=i.scale.getLabel(n),s=t.replace("{value}",o??"");return s};if(Xi(t)){if(i.type==="category")return function(n,o){return t(XM(i,n),n.value-i.scale.getExtent()[0],null)};var r=_o();return function(n,o){var s=null;return r&&(s=r.makeAxisLabelFormatterParamBreak(s,n.break)),t(XM(i,n),o,s)}}else return function(n){return i.scale.getLabel(n)}}}function XM(i,t){return i.type==="category"?i.scale.getLabel(t):t.value}function S3(i){var t=i.get("interval");return t??"auto"}function ltt(i){return i.type==="category"&&S3(i.getLabelModel())===0}function YM(i,t){var e={};return gt(i.mapDimensionsAll(t),function(r){e[jQ(i,r)]=!0}),on(e)}function oTt(i,t,e){t&&gt(YM(t,e),function(r){var n=t.getApproximateExtent(r);n[0]<i[0]&&(i[0]=n[0]),n[1]>i[1]&&(i[1]=n[1])})}function A0(i){return i==="middle"||i==="center"}function fS(i){return i.getShallow("show")}function ctt(i){var t=i.get("breaks",!0);if(t!=null)return!_o()||!sTt(i.axis)?void 0:t}function sTt(i){return(i.dim==="x"||i.dim==="y"||i.dim==="z"||i.dim==="single")&&i.type!=="category"}var HS=function(){function i(){}return i.prototype.getNeedCrossZero=function(){var t=this.option;return!t.scale},i.prototype.getCoordSysModel=function(){},i}(),lTt=1e-8;function O8(i,t){return Math.abs(i-t)<lTt}function Om(i,t,e){var r=0,n=i[0];if(!n)return!1;for(var o=1;o<i.length;o++){var s=i[o];r+=cd(n[0],n[1],s[0],s[1],t,e),n=s}var a=i[0];return(!O8(n[0],a[0])||!O8(n[1],a[1]))&&(r+=cd(n[0],n[1],a[0],a[1],t,e)),r!==0}var cTt=[];function _R(i,t){for(var e=0;e<i.length;e++)ho(i[e],i[e],t)}function z8(i,t,e,r){for(var n=0;n<i.length;n++){var o=i[n];r&&(o=r.project(o)),o&&isFinite(o[0])&&isFinite(o[1])&&(cp(t,t,o),up(e,e,o))}}function uTt(i){for(var t=0,e=0,r=0,n=i.length,o=i[n-1][0],s=i[n-1][1],a=0;a<n;a++){var u=i[a][0],f=i[a][1],g=o*f-u*s;t+=g,e+=(o+u)*g,r+=(s+f)*g,o=u,s=f}return t?[e/t/3,r/t/3,t]:[i[0][0]||0,i[0][1]||0]}var utt=function(){function i(t){this.name=t}return i.prototype.setCenter=function(t){this._center=t},i.prototype.getCenter=function(){var t=this._center;return t||(t=this._center=this.calcCenter()),t},i}(),B8=function(){function i(t,e){this.type="polygon",this.exterior=t,this.interiors=e}return i}(),F8=function(){function i(t){this.type="linestring",this.points=t}return i}(),htt=function(i){we(t,i);function t(e,r,n){var o=i.call(this,e)||this;return o.type="geoJSON",o.geometries=r,o._center=n&&[n[0],n[1]],o}return t.prototype.calcCenter=function(){for(var e=this.geometries,r,n=0,o=0;o<e.length;o++){var s=e[o],a=s.exterior,u=a&&a.length;u>n&&(r=s,n=u)}if(r)return uTt(r.exterior);var f=this.getBoundingRect();return[f.x+f.width/2,f.y+f.height/2]},t.prototype.getBoundingRect=function(e){var r=this._rect;if(r&&!e)return r;var n=[1/0,1/0],o=[-1/0,-1/0],s=this.geometries;return gt(s,function(a){a.type==="polygon"?z8(a.exterior,n,o,e):gt(a.points,function(u){z8(u,n,o,e)})}),isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])||(n[0]=n[1]=o[0]=o[1]=0),r=new sr(n[0],n[1],o[0]-n[0],o[1]-n[1]),e||(this._rect=r),r},t.prototype.contain=function(e){var r=this.getBoundingRect(),n=this.geometries;if(!r.contain(e[0],e[1]))return!1;t:for(var o=0,s=n.length;o<s;o++){var a=n[o];if(a.type==="polygon"){var u=a.exterior,f=a.interiors;if(Om(u,e[0],e[1])){for(var g=0;g<(f?f.length:0);g++)if(Om(f[g],e[0],e[1]))continue t;return!0}}}return!1},t.prototype.transformTo=function(e,r,n,o){var s=this.getBoundingRect(),a=s.width/s.height;n?o||(o=n/a):n=a*o;for(var u=new sr(e,r,n,o),f=s.calculateTransform(u),g=this.geometries,v=0;v<g.length;v++){var y=g[v];y.type==="polygon"?(_R(y.exterior,f),gt(y.interiors,function(w){_R(w,f)})):gt(y.points,function(w){_R(w,f)})}s=this._rect,s.copy(u),this._center=[s.x+s.width/2,s.y+s.height/2]},t.prototype.cloneShallow=function(e){e==null&&(e=this.name);var r=new t(e,this.geometries,this._center);return r._rect=this._rect,r.transformTo=null,r},t}(utt),hTt=function(i){we(t,i);function t(e,r){var n=i.call(this,e)||this;return n.type="geoSVG",n._elOnlyForCalculate=r,n}return t.prototype.calcCenter=function(){for(var e=this._elOnlyForCalculate,r=e.getBoundingRect(),n=[r.x+r.width/2,r.y+r.height/2],o=JC(cTt),s=e;s&&!s.isGeoSVGGraphicRoot;)fh(o,s.getLocalTransform(),o),s=s.parent;return mu(o,o),ho(n,n,o),n},t}(utt);function dTt(i){if(!i.UTF8Encoding)return i;var t=i,e=t.UTF8Scale;e==null&&(e=1024);var r=t.features;return gt(r,function(n){var o=n.geometry,s=o.encodeOffsets,a=o.coordinates;if(s)switch(o.type){case"LineString":o.coordinates=dtt(a,s,e);break;case"Polygon":yR(a,s,e);break;case"MultiLineString":yR(a,s,e);break;case"MultiPolygon":gt(a,function(u,f){return yR(u,s[f],e)})}}),t.UTF8Encoding=!1,t}function yR(i,t,e){for(var r=0;r<i.length;r++)i[r]=dtt(i[r],t[r],e)}function dtt(i,t,e){for(var r=[],n=t[0],o=t[1],s=0;s<i.length;s+=2){var a=i.charCodeAt(s)-64,u=i.charCodeAt(s+1)-64;a=a>>1^-(a&1),u=u>>1^-(u&1),a+=n,u+=o,n=a,o=u,r.push([a/e,u/e])}return r}function fTt(i,t){return i=dTt(i),ti(Rn(i.features,function(e){return e.geometry&&e.properties&&e.geometry.coordinates.length>0}),function(e){var r=e.properties,n=e.geometry,o=[];switch(n.type){case"Polygon":var s=n.coordinates;o.push(new B8(s[0],s.slice(1)));break;case"MultiPolygon":gt(n.coordinates,function(u){u[0]&&o.push(new B8(u[0],u.slice(1)))});break;case"LineString":o.push(new F8([n.coordinates]));break;case"MultiLineString":o.push(new F8(n.coordinates))}var a=new htt(r[t||"name"],o,r.cp);return a.properties=r,a})}var pTt=Wr(),Dw=Wr(),_u={estimate:1,determine:2};function KM(i){return{out:{noPxChangeTryDetermine:[]},kind:i}}function ftt(i,t){var e=ti(t,function(r){return i.scale.parse(r)});return i.type==="time"&&e.length>0&&(e.sort(),e.unshift(e[0]),e.push(e[e.length-1])),e}function gTt(i,t){var e=i.getLabelModel().get("customValues");if(e){var r=q0(i),n=i.scale.getExtent(),o=ftt(i,e),s=Rn(o,function(a){return a>=n[0]&&a<=n[1]});return{labels:ti(s,function(a){var u={value:a};return{formattedLabel:r(u),rawLabel:i.scale.getLabel(u),tickValue:a,time:void 0,break:void 0}})}}return i.type==="category"?vTt(i,t):yTt(i)}function mTt(i,t,e){var r=i.getTickModel().get("customValues");if(r){var n=i.scale.getExtent(),o=ftt(i,r);return{ticks:Rn(o,function(s){return s>=n[0]&&s<=n[1]})}}return i.type==="category"?_Tt(i,t):{ticks:ti(i.scale.getTicks(e),function(s){return s.value})}}function vTt(i,t){var e=i.getLabelModel(),r=ptt(i,e,t);return!e.get("show")||i.scale.isBlank()?{labels:[]}:r}function ptt(i,t,e){var r=bTt(i),n=S3(t),o=e.kind===_u.estimate;if(!o){var s=mtt(r,n);if(s)return s}var a,u;Xi(n)?a=ytt(i,n):(u=n==="auto"?wTt(i,e):n,a=_tt(i,u));var f={labels:a,labelCategoryInterval:u};return o?e.out.noPxChangeTryDetermine.push(function(){return Dz(r,n,f),!0}):Dz(r,n,f),f}function _Tt(i,t){var e=xTt(i),r=S3(t),n=mtt(e,r);if(n)return n;var o,s;if((!t.get("show")||i.scale.isBlank())&&(o=[]),Xi(r))o=ytt(i,r,!0);else if(r==="auto"){var a=ptt(i,i.getLabelModel(),KM(_u.determine));s=a.labelCategoryInterval,o=ti(a.labels,function(u){return u.tickValue})}else s=r,o=_tt(i,s,!0);return Dz(e,r,{ticks:o,tickCategoryInterval:s})}function yTt(i){var t=i.scale.getTicks(),e=q0(i);return{labels:ti(t,function(r,n){return{formattedLabel:e(r,n),rawLabel:i.scale.getLabel(r),tickValue:r.value,time:r.time,break:r.break}})}}var xTt=gtt("axisTick"),bTt=gtt("axisLabel");function gtt(i){return function(e){return Dw(e)[i]||(Dw(e)[i]={list:[]})}}function mtt(i,t){for(var e=0;e<i.list.length;e++)if(i.list[e].key===t)return i.list[e].value}function Dz(i,t,e){return i.list.push({key:t,value:e}),e}function wTt(i,t){if(t.kind===_u.estimate){var e=i.calculateCategoryInterval(t);return t.out.noPxChangeTryDetermine.push(function(){return Dw(i).autoInterval=e,!0}),e}var r=Dw(i).autoInterval;return r??(Dw(i).autoInterval=i.calculateCategoryInterval(t))}function STt(i,t){var e=t.kind,r=ATt(i),n=q0(i),o=(r.axisRotate-r.labelRotate)/180*Math.PI,s=i.scale,a=s.getExtent(),u=s.count();if(a[1]-a[0]<1)return 0;var f=1,g=40;u>g&&(f=Math.max(1,Math.floor(u/g)));for(var v=a[0],y=i.dataToCoord(v+1)-i.dataToCoord(v),w=Math.abs(y*Math.cos(o)),I=Math.abs(y*Math.sin(o)),E=0,D=0;v<=a[1];v+=f){var R=0,z=0,N=eE(n({value:v}),r.font,"center","top");R=N.width*1.3,z=N.height*1.3,E=Math.max(E,R,7),D=Math.max(D,z,7)}var H=E/w,$=D/I;isNaN(H)&&(H=1/0),isNaN($)&&($=1/0);var X=Math.max(0,Math.floor(Math.min(H,$)));if(e===_u.estimate)return t.out.noPxChangeTryDetermine.push(wi(TTt,null,i,X,u)),X;var K=vtt(i,X,u);return K??X}function TTt(i,t,e){return vtt(i,t,e)==null}function vtt(i,t,e){var r=pTt(i.model),n=i.getExtent(),o=r.lastAutoInterval,s=r.lastTickCount;if(o!=null&&s!=null&&Math.abs(o-t)<=1&&Math.abs(s-e)<=1&&o>t&&r.axisExtent0===n[0]&&r.axisExtent1===n[1])return o;r.lastTickCount=e,r.lastAutoInterval=t,r.axisExtent0=n[0],r.axisExtent1=n[1]}function ATt(i){var t=i.getLabelModel();return{axisRotate:i.getRotate?i.getRotate():i.isHorizontal&&!i.isHorizontal()?90:0,labelRotate:t.get("rotate")||0,font:t.getFont()}}function _tt(i,t,e){var r=q0(i),n=i.scale,o=n.getExtent(),s=i.getLabelModel(),a=[],u=Math.max((t||0)+1,1),f=o[0],g=n.count();f!==0&&u>1&&g/u>2&&(f=Math.round(Math.ceil(f/u)*u));var v=ltt(i),y=s.get("showMinLabel")||v,w=s.get("showMaxLabel")||v;y&&f!==o[0]&&E(o[0]);for(var I=f;I<=o[1];I+=u)E(I);w&&I-u!==o[1]&&E(o[1]);function E(D){var R={value:D};a.push(e?D:{formattedLabel:r(R),rawLabel:n.getLabel(R),tickValue:D,time:void 0,break:void 0})}return a}function ytt(i,t,e){var r=i.scale,n=q0(i),o=[];return gt(r.getTicks(),function(s){var a=r.getLabel(s),u=s.value;t(s.value,a)&&o.push(e?u:{formattedLabel:n(s),rawLabel:a,tickValue:u,time:void 0,break:void 0})}),o}var N8=[0,1],ITt=function(){function i(t,e,r){this.onBand=!1,this.inverse=!1,this.dim=t,this.scale=e,this._extent=r||[0,0]}return i.prototype.contain=function(t){var e=this._extent,r=Math.min(e[0],e[1]),n=Math.max(e[0],e[1]);return t>=r&&t<=n},i.prototype.containData=function(t){return this.scale.contain(this.scale.parse(t))},i.prototype.getExtent=function(){return this._extent.slice()},i.prototype.getPixelPrecision=function(t){return $Y(t||this.scale.getExtent(),this._extent)},i.prototype.setExtent=function(t,e){var r=this._extent;r[0]=t,r[1]=e},i.prototype.dataToCoord=function(t,e){var r=this._extent,n=this.scale;return t=n.normalize(n.parse(t)),this.onBand&&n.type==="ordinal"&&(r=r.slice(),V8(r,n.count())),Ln(t,N8,r,e)},i.prototype.coordToData=function(t,e){var r=this._extent,n=this.scale;this.onBand&&n.type==="ordinal"&&(r=r.slice(),V8(r,n.count()));var o=Ln(t,r,N8,e);return this.scale.scale(o)},i.prototype.pointToData=function(t,e){},i.prototype.getTicksCoords=function(t){t=t||{};var e=t.tickModel||this.getTickModel(),r=mTt(this,e,{breakTicks:t.breakTicks,pruneByBreak:t.pruneByBreak}),n=r.ticks,o=ti(n,function(a){return{coord:this.dataToCoord(this.scale.type==="ordinal"?this.scale.getRawOrdinalNumber(a):a),tickValue:a}},this),s=e.get("alignWithLabel");return MTt(this,o,s,t.clamp),o},i.prototype.getMinorTicksCoords=function(){if(this.scale.type==="ordinal")return[];var t=this.model.getModel("minorTick"),e=t.get("splitNumber");e>0&&e<100||(e=5);var r=this.scale.getMinorTicks(e),n=ti(r,function(o){return ti(o,function(s){return{coord:this.dataToCoord(s),tickValue:s}},this)},this);return n},i.prototype.getViewLabels=function(t){return t=t||KM(_u.determine),gTt(this,t).labels},i.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},i.prototype.getTickModel=function(){return this.model.getModel("axisTick")},i.prototype.getBandWidth=function(){var t=this._extent,e=this.scale.getExtent(),r=e[1]-e[0]+(this.onBand?1:0);r===0&&(r=1);var n=Math.abs(t[1]-t[0]);return Math.abs(n)/r},i.prototype.calculateCategoryInterval=function(t){return t=t||KM(_u.determine),STt(this,t)},i}();function V8(i,t){var e=i[1]-i[0],r=t,n=e/r/2;i[0]+=n,i[1]-=n}function MTt(i,t,e,r){var n=t.length;if(!i.onBand||e||!n)return;var o=i.getExtent(),s,a;if(n===1)t[0].coord=o[0],t[0].onBand=!0,s=t[1]={coord:o[1],tickValue:t[0].tickValue,onBand:!0};else{var u=t[n-1].tickValue-t[0].tickValue,f=(t[n-1].coord-t[0].coord)/u;gt(t,function(w){w.coord-=f/2,w.onBand=!0});var g=i.scale.getExtent();a=1+g[1]-t[n-1].tickValue,s={coord:t[n-1].coord+f*a,tickValue:g[1]+1,onBand:!0},t.push(s)}var v=o[0]>o[1];y(t[0].coord,o[0])&&(r?t[0].coord=o[0]:t.shift()),r&&y(o[0],t[0].coord)&&t.unshift({coord:o[0],onBand:!0}),y(o[1],s.coord)&&(r?s.coord=o[1]:t.pop()),r&&y(s.coord,o[1])&&t.push({coord:o[1],onBand:!0});function y(w,I){return w=vo(w),I=vo(I),v?w>I:w<I}}const bu=ITt;var Ib=Math.PI*2,bm=wh.CMD,CTt=["top","right","bottom","left"];function ETt(i,t,e,r,n){var o=e.width,s=e.height;switch(i){case"top":r.set(e.x+o/2,e.y-t),n.set(0,-1);break;case"bottom":r.set(e.x+o/2,e.y+s+t),n.set(0,1);break;case"left":r.set(e.x-t,e.y+s/2),n.set(-1,0);break;case"right":r.set(e.x+o+t,e.y+s/2),n.set(1,0);break}}function DTt(i,t,e,r,n,o,s,a,u){s-=i,a-=t;var f=Math.sqrt(s*s+a*a);s/=f,a/=f;var g=s*e+i,v=a*e+t;if(Math.abs(r-n)%Ib<1e-4)return u[0]=g,u[1]=v,f-e;if(o){var y=r;r=tc(n),n=tc(y)}else r=tc(r),n=tc(n);r>n&&(n+=Ib);var w=Math.atan2(a,s);if(w<0&&(w+=Ib),w>=r&&w<=n||w+Ib>=r&&w+Ib<=n)return u[0]=g,u[1]=v,f-e;var I=e*Math.cos(r)+i,E=e*Math.sin(r)+t,D=e*Math.cos(n)+i,R=e*Math.sin(n)+t,z=(I-s)*(I-s)+(E-a)*(E-a),N=(D-s)*(D-s)+(R-a)*(R-a);return z<N?(u[0]=I,u[1]=E,Math.sqrt(z)):(u[0]=D,u[1]=R,Math.sqrt(N))}function JM(i,t,e,r,n,o,s,a){var u=n-i,f=o-t,g=e-i,v=r-t,y=Math.sqrt(g*g+v*v);g/=y,v/=y;var w=u*g+f*v,I=w/y;a&&(I=Math.min(Math.max(I,0),1)),I*=y;var E=s[0]=i+I*g,D=s[1]=t+I*v;return Math.sqrt((E-n)*(E-n)+(D-o)*(D-o))}function xtt(i,t,e,r,n,o,s){e<0&&(i=i+e,e=-e),r<0&&(t=t+r,r=-r);var a=i+e,u=t+r,f=s[0]=Math.min(Math.max(n,i),a),g=s[1]=Math.min(Math.max(o,t),u);return Math.sqrt((f-n)*(f-n)+(g-o)*(g-o))}var au=[];function PTt(i,t,e){var r=xtt(t.x,t.y,t.width,t.height,i.x,i.y,au);return e.set(au[0],au[1]),r}function LTt(i,t,e){for(var r=0,n=0,o=0,s=0,a,u,f=1/0,g=t.data,v=i.x,y=i.y,w=0;w<g.length;){var I=g[w++];w===1&&(r=g[w],n=g[w+1],o=r,s=n);var E=f;switch(I){case bm.M:o=g[w++],s=g[w++],r=o,n=s;break;case bm.L:E=JM(r,n,g[w],g[w+1],v,y,au,!0),r=g[w++],n=g[w++];break;case bm.C:E=IY(r,n,g[w++],g[w++],g[w++],g[w++],g[w],g[w+1],v,y,au),r=g[w++],n=g[w++];break;case bm.Q:E=CY(r,n,g[w++],g[w++],g[w],g[w+1],v,y,au),r=g[w++],n=g[w++];break;case bm.A:var D=g[w++],R=g[w++],z=g[w++],N=g[w++],H=g[w++],$=g[w++];w+=1;var X=!!(1-g[w++]);a=Math.cos(H)*z+D,u=Math.sin(H)*N+R,w<=1&&(o=a,s=u);var K=(v-D)*N/z+D;E=DTt(D,R,N,H,H+$,X,K,y,au),r=Math.cos(H+$)*z+D,n=Math.sin(H+$)*N+R;break;case bm.R:o=r=g[w++],s=n=g[w++];var et=g[w++],rt=g[w++];E=xtt(o,s,et,rt,v,y,au);break;case bm.Z:E=JM(r,n,o,s,v,y,au,!0),r=o,n=s;break}E<f&&(f=E,e.set(au[0],au[1]))}return f}var su=new er,_a=new er,so=new er,uh=new er,ah=new er;function U8(i,t){if(i){var e=i.getTextGuideLine(),r=i.getTextContent();if(r&&e){var n=i.textGuideLineConfig||{},o=[[0,0],[0,0],[0,0]],s=n.candidates||CTt,a=r.getBoundingRect().clone();a.applyTransform(r.getComputedTransform());var u=1/0,f=n.anchor,g=i.getComputedTransform(),v=g&&mu([],g),y=t.get("length2")||0;f&&so.copy(f);for(var w=0;w<s.length;w++){var I=s[w];ETt(I,0,a,su,uh),er.scaleAndAdd(_a,su,uh,y),_a.transform(v);var E=i.getBoundingRect(),D=f?f.distance(_a):i instanceof qr?LTt(_a,i.path,so):PTt(_a,E,so);D<u&&(u=D,_a.transform(g),so.transform(g),so.toArray(o[0]),_a.toArray(o[1]),su.toArray(o[2]))}btt(o,t.get("minTurnAngle")),e.setShape({points:o})}}}var QM=[],ul=new er;function btt(i,t){if(t<=180&&t>0){t=t/180*Math.PI,su.fromArray(i[0]),_a.fromArray(i[1]),so.fromArray(i[2]),er.sub(uh,su,_a),er.sub(ah,so,_a);var e=uh.len(),r=ah.len();if(!(e<.001||r<.001)){uh.scale(1/e),ah.scale(1/r);var n=uh.dot(ah),o=Math.cos(t);if(o<n){var s=JM(_a.x,_a.y,so.x,so.y,su.x,su.y,QM,!1);ul.fromArray(QM),ul.scaleAndAdd(ah,s/Math.tan(Math.PI-t));var a=so.x!==_a.x?(ul.x-_a.x)/(so.x-_a.x):(ul.y-_a.y)/(so.y-_a.y);if(isNaN(a))return;a<0?er.copy(ul,_a):a>1&&er.copy(ul,so),ul.toArray(i[1])}}}}function RTt(i,t,e){if(e<=180&&e>0){e=e/180*Math.PI,su.fromArray(i[0]),_a.fromArray(i[1]),so.fromArray(i[2]),er.sub(uh,_a,su),er.sub(ah,so,_a);var r=uh.len(),n=ah.len();if(!(r<.001||n<.001)){uh.scale(1/r),ah.scale(1/n);var o=uh.dot(t),s=Math.cos(e);if(o<s){var a=JM(_a.x,_a.y,so.x,so.y,su.x,su.y,QM,!1);ul.fromArray(QM);var u=Math.PI/2,f=Math.acos(ah.dot(t)),g=u+f-e;if(g>=u)er.copy(ul,so);else{ul.scaleAndAdd(ah,a/Math.tan(Math.PI/2-g));var v=so.x!==_a.x?(ul.x-_a.x)/(so.x-_a.x):(ul.y-_a.y)/(so.y-_a.y);if(isNaN(v))return;v<0?er.copy(ul,_a):v>1&&er.copy(ul,so)}ul.toArray(i[1])}}}}function xR(i,t,e,r){var n=e==="normal",o=n?i:i.ensureState(e);o.ignore=t;var s=r.get("smooth");s&&s===!0&&(s=.3),o.shape=o.shape||{},s>0&&(o.shape.smooth=s);var a=r.getModel("lineStyle").getLineStyle();n?i.useStyle(a):o.style=a}function kTt(i,t){var e=t.smooth,r=t.points;if(r)if(i.moveTo(r[0][0],r[0][1]),e>0&&r.length>=3){var n=lp(r[0],r[1]),o=lp(r[1],r[2]);if(!n||!o){i.lineTo(r[1][0],r[1][1]),i.lineTo(r[2][0],r[2][1]);return}var s=Math.min(n,o)*e,a=FI([],r[1],r[0],s/n),u=FI([],r[1],r[2],s/o),f=FI([],a,u,.5);i.bezierCurveTo(a[0],a[1],a[0],a[1],f[0],f[1]),i.bezierCurveTo(u[0],u[1],u[0],u[1],r[2][0],r[2][1])}else for(var g=1;g<r.length;g++)i.lineTo(r[g][0],r[g][1])}function T3(i,t,e){var r=i.getTextGuideLine(),n=i.getTextContent();if(!n){r&&i.removeTextGuideLine();return}for(var o=t.normal,s=o.get("show"),a=n.ignore,u=0;u<eS.length;u++){var f=eS[u],g=t[f],v=f==="normal";if(g){var y=g.get("show"),w=v?a:Ui(n.states[f]&&n.states[f].ignore,a);if(w||!Ui(y,s)){var I=v?r:r&&r.states[f];I&&(I.ignore=!0),r&&xR(r,!0,f,g);continue}r||(r=new Us,i.setTextGuideLine(r),!v&&(a||!s)&&xR(r,!0,"normal",t.normal),i.stateProxy&&(r.stateProxy=i.stateProxy)),xR(r,!1,f,g)}}if(r){rr(r.style,e),r.style.fill=null;var E=o.get("showAbove"),D=i.textGuideLineConfig=i.textGuideLineConfig||{};D.showAbove=E||!1,r.buildPath=kTt}}function A3(i,t){t=t||"labelLine";for(var e={normal:i.getModel(t)},r=0;r<fl.length;r++){var n=fl[r];e[n]=i.getModel([n,t])}return e}var G8=["label","labelLine","layoutOption","priority","defaultAttr","marginForce","minMarginForce","marginDefault","suggestIgnore"],OTt=1,tC=2,wtt=OTt|tC;function eC(i,t,e){e=e||wtt,t?i.dirty|=e:i.dirty&=~e}function Stt(i,t){return t=t||wtt,i.dirty==null||!!(i.dirty&t)}function Th(i){if(i)return Stt(i)&&Ttt(i,i.label,i),i}function Ttt(i,t,e){var r=t.getComputedTransform();i.transform=jF(i.transform,r);var n=i.localRect=nS(i.localRect,t.getBoundingRect()),o=t.style,s=o.margin,a=e&&e.marginForce,u=e&&e.minMarginForce,f=e&&e.marginDefault,g=o.__marginType;g==null&&f&&(s=f,g=Xy.textMargin);for(var v=0;v<4;v++)bR[v]=g===Xy.minMargin&&u&&u[v]!=null?u[v]:a&&a[v]!=null?a[v]:s?s[v]:0;g===Xy.textMargin&&mv(n,bR,!1,!1);var y=i.rect=nS(i.rect,n);return r&&y.applyTransform(r),g===Xy.minMargin&&mv(y,bR,!1,!1),i.axisAligned=HF(r),(i.label=i.label||{}).ignore=t.ignore,eC(i,!1),eC(i,!0,tC),i}var bR=[0,0,0,0];function zTt(i,t,e){return i.transform=jF(i.transform,e),i.localRect=nS(i.localRect,t),i.rect=nS(i.rect,t),e&&i.rect.applyTransform(e),i.axisAligned=HF(e),i.obb=void 0,(i.label=i.label||{}).ignore=!1,i}function Pz(i,t){if(i){i.label.x+=t.x,i.label.y+=t.y,i.label.markRedraw();var e=i.transform;e&&(e[4]+=t.x,e[5]+=t.y);var r=i.rect;r&&(r.x+=t.x,r.y+=t.y);var n=i.obb;n&&n.fromBoundingRect(i.localRect,e)}}function Lz(i,t){for(var e=0;e<G8.length;e++){var r=G8[e];i[r]==null&&(i[r]=t[r])}return Th(i)}function H8(i){var t=i.obb;return(!t||Stt(i,tC))&&(i.obb=t=t||new $K,t.fromBoundingRect(i.localRect,i.transform),eC(i,!1,tC)),t}function Rz(i,t,e,r,n){var o=i.length,s=vr[t],a=yo[t];if(o<2)return!1;i.sort(function(rt,lt){return rt.rect[s]-lt.rect[s]});for(var u=0,f,g=!1,v=0,y=0;y<o;y++){var w=i[y],I=w.rect;f=I[s]-u,f<0&&(I[s]-=f,w.label[s]-=f,g=!0);var E=Math.max(-f,0);v+=E,u=I[s]+I[a]}v>0&&n&&X(-v/o,0,o);var D=i[0],R=i[o-1],z,N;H(),z<0&&K(-z,.8),N<0&&K(N,.8),H(),$(z,N,1),$(N,z,-1),H(),z<0&&et(-z),N<0&&et(N);function H(){z=D.rect[s]-e,N=r-R.rect[s]-R.rect[a]}function $(rt,lt,ht){if(rt<0){var yt=Math.min(lt,-rt);if(yt>0){X(yt*ht,0,o);var ft=yt+rt;ft<0&&K(-ft*ht,1)}else K(-rt*ht,1)}}function X(rt,lt,ht){rt!==0&&(g=!0);for(var yt=lt;yt<ht;yt++){var ft=i[yt],kt=ft.rect;kt[s]+=rt,ft.label[s]+=rt}}function K(rt,lt){for(var ht=[],yt=0,ft=1;ft<o;ft++){var kt=i[ft-1].rect,Rt=Math.max(i[ft].rect[s]-kt[s]-kt[a],0);ht.push(Rt),yt+=Rt}if(yt){var Ct=Math.min(Math.abs(rt)/yt,lt);if(rt>0)for(var ft=0;ft<o-1;ft++){var Gt=ht[ft]*Ct;X(Gt,0,ft+1)}else for(var ft=o-1;ft>0;ft--){var Gt=ht[ft-1]*Ct;X(-Gt,ft,o)}}}function et(rt){var lt=rt<0?-1:1;rt=Math.abs(rt);for(var ht=Math.ceil(rt/(o-1)),yt=0;yt<o-1;yt++)if(lt>0?X(ht,0,yt+1):X(-ht,o-yt-1,o),rt-=ht,rt<=0)return}return g}function BTt(i){for(var t=0;t<i.length;t++){var e=i[t],r=e.defaultAttr,n=e.labelLine;e.label.attr("ignore",r.ignore),n&&n.attr("ignore",r.labelGuideIgnore)}}function Att(i){var t=[];i.sort(function(f,g){return(g.suggestIgnore?1:0)-(f.suggestIgnore?1:0)||g.priority-f.priority});function e(f){if(!f.ignore){var g=f.ensureState("emphasis");g.ignore==null&&(g.ignore=!1)}f.ignore=!0}for(var r=0;r<i.length;r++){var n=Th(i[r]);if(!n.label.ignore){for(var o=n.label,s=n.labelLine,a=!1,u=0;u<t.length;u++)if(TE(n,t[u],null,{touchThreshold:.05})){a=!0;break}a?(e(o),s&&e(s)):t.push(n)}}}function TE(i,t,e,r){return!i||!t||i.label&&i.label.ignore||t.label&&t.label.ignore||!i.rect.intersect(t.rect,e,r)?!1:i.axisAligned&&t.axisAligned?!0:H8(i).intersect(H8(t),e,r)}function FTt(i){if(i){for(var t=[],e=0;e<i.length;e++)t.push(i[e].slice());return t}}function NTt(i,t){var e=i.label,r=t&&t.getTextGuideLine();return{dataIndex:i.dataIndex,dataType:i.dataType,seriesIndex:i.seriesModel.seriesIndex,text:i.label.style.text,rect:i.hostRect,labelRect:i.rect,align:e.style.align,verticalAlign:e.style.verticalAlign,labelLinePoints:FTt(r&&r.shape.points)}}var j8=["align","verticalAlign","width","height","fontSize"],al=new yd,wR=Wr(),VTt=Wr();function UA(i,t,e){for(var r=0;r<e.length;r++){var n=e[r];t[n]!=null&&(i[n]=t[n])}}var GA=["x","y","rotation"],UTt=function(){function i(){this._labelList=[],this._chartViewList=[]}return i.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},i.prototype._addLabel=function(t,e,r,n,o){var s=n.style,a=n.__hostTarget,u=a.textConfig||{},f=n.getComputedTransform(),g=n.getBoundingRect().plain();sr.applyTransform(g,g,f),f?al.setLocalTransform(f):(al.x=al.y=al.rotation=al.originX=al.originY=0,al.scaleX=al.scaleY=1),al.rotation=tc(al.rotation);var v=n.__hostTarget,y;if(v){y=v.getBoundingRect().plain();var w=v.getComputedTransform();sr.applyTransform(y,y,w)}var I=y&&v.getTextGuideLine();this._labelList.push({label:n,labelLine:I,seriesModel:r,dataIndex:t,dataType:e,layoutOptionOrCb:o,layoutOption:null,rect:g,hostRect:y,priority:y?y.width*y.height:0,defaultAttr:{ignore:n.ignore,labelGuideIgnore:I&&I.ignore,x:al.x,y:al.y,scaleX:al.scaleX,scaleY:al.scaleY,rotation:al.rotation,style:{x:s.x,y:s.y,align:s.align,verticalAlign:s.verticalAlign,width:s.width,height:s.height,fontSize:s.fontSize},cursor:n.cursor,attachedPos:u.position,attachedRot:u.rotation}})},i.prototype.addLabelsOfSeries=function(t){var e=this;this._chartViewList.push(t);var r=t.__model,n=r.get("labelLayout");(Xi(n)||on(n).length)&&t.group.traverse(function(o){if(o.ignore)return!0;var s=o.getTextContent(),a=ur(o);s&&!s.disableLabelLayout&&e._addLabel(a.dataIndex,a.dataType,r,s,n)})},i.prototype.updateLayoutConfig=function(t){var e=t.getWidth(),r=t.getHeight();function n(N,H){return function(){U8(N,H)}}for(var o=0;o<this._labelList.length;o++){var s=this._labelList[o],a=s.label,u=a.__hostTarget,f=s.defaultAttr,g=void 0;Xi(s.layoutOptionOrCb)?g=s.layoutOptionOrCb(NTt(s,u)):g=s.layoutOptionOrCb,g=g||{},s.layoutOption=g;var v=Math.PI/180;u&&u.setTextConfig({local:!1,position:g.x!=null||g.y!=null?null:f.attachedPos,rotation:g.rotate!=null?g.rotate*v:f.attachedRot,offset:[g.dx||0,g.dy||0]});var y=!1;if(g.x!=null?(a.x=xi(g.x,e),a.setStyle("x",0),y=!0):(a.x=f.x,a.setStyle("x",f.style.x)),g.y!=null?(a.y=xi(g.y,r),a.setStyle("y",0),y=!0):(a.y=f.y,a.setStyle("y",f.style.y)),g.labelLinePoints){var w=u.getTextGuideLine();w&&(w.setShape({points:g.labelLinePoints}),y=!1)}var I=wR(a);I.needsUpdateLabelLine=y,a.rotation=g.rotate!=null?g.rotate*v:f.rotation,a.scaleX=f.scaleX,a.scaleY=f.scaleY;for(var E=0;E<j8.length;E++){var D=j8[E];a.setStyle(D,g[D]!=null?g[D]:f.style[D])}if(g.draggable){if(a.draggable=!0,a.cursor="move",u){var R=s.seriesModel;if(s.dataIndex!=null){var z=s.seriesModel.getData(s.dataType);R=z.getItemModel(s.dataIndex)}a.on("drag",n(u,R.getModel("labelLine")))}}else a.off("drag"),a.cursor=f.cursor}},i.prototype.layout=function(t){var e=t.getWidth(),r=t.getHeight(),n=[];gt(this._labelList,function(u){u.defaultAttr.ignore||n.push(Lz({},u))});var o=Rn(n,function(u){return u.layoutOption.moveOverlap==="shiftX"}),s=Rn(n,function(u){return u.layoutOption.moveOverlap==="shiftY"});Rz(o,0,0,e),Rz(s,1,0,r);var a=Rn(n,function(u){return u.layoutOption.hideOverlap});BTt(a),Att(a)},i.prototype.processLabelsOverall=function(){var t=this;gt(this._chartViewList,function(e){var r=e.__model,n=e.ignoreLabelLineUpdate,o=r.isAnimationEnabled();e.group.traverse(function(s){if(s.ignore&&!s.forceLabelAnimation)return!0;var a=!n,u=s.getTextContent();!a&&u&&(a=wR(u).needsUpdateLabelLine),a&&t._updateLabelLine(s,r),o&&t._animateLabels(s,r)})})},i.prototype._updateLabelLine=function(t,e){var r=t.getTextContent(),n=ur(t),o=n.dataIndex;if(r&&o!=null){var s=e.getData(n.dataType),a=s.getItemModel(o),u={},f=s.getItemVisual(o,"style");if(f){var g=s.getVisual("drawType");u.stroke=f[g]}var v=a.getModel("labelLine");T3(t,A3(a),u),U8(t,v)}},i.prototype._animateLabels=function(t,e){var r=t.getTextContent(),n=t.getTextGuideLine();if(r&&(t.forceLabelAnimation||!r.ignore&&!r.invisible&&!t.disableLabelAnimation&&!l0(t))){var o=wR(r),s=o.oldLayout,a=ur(t),u=a.dataIndex,f={x:r.x,y:r.y,rotation:r.rotation},g=e.getData(a.dataType);if(s){r.attr(s);var y=t.prevStates;y&&(Ar(y,"select")>=0&&r.attr(o.oldLayoutSelect),Ar(y,"emphasis")>=0&&r.attr(o.oldLayoutEmphasis)),yn(r,f,e,u)}else if(r.attr(f),!G0(r).valueAnimation){var v=Ui(r.style.opacity,1);r.style.opacity=0,ya(r,{style:{opacity:v}},e,u)}if(o.oldLayout=f,r.states.select){var w=o.oldLayoutSelect={};UA(w,f,GA),UA(w,r.states.select,GA)}if(r.states.emphasis){var I=o.oldLayoutEmphasis={};UA(I,f,GA),UA(I,r.states.emphasis,GA)}rJ(r,u,g,e,e)}if(n&&!n.ignore&&!n.invisible){var o=VTt(n),s=o.oldLayout,E={points:n.shape.points};s?(n.attr({shape:s}),yn(n,{shape:E},e)):(n.setShape(E),n.style.strokePercent=0,ya(n,{style:{strokePercent:1}},e)),o.oldLayout=E}},i}();const GTt=UTt;var SR=Wr();function HTt(i){i.registerUpdateLifecycle("series:beforeupdate",function(t,e,r){var n=SR(e).labelManager;n||(n=SR(e).labelManager=new GTt),n.clearLabels()}),i.registerUpdateLifecycle("series:layoutlabels",function(t,e,r){var n=SR(e).labelManager;r.updatedSeries.forEach(function(o){n.addLabelsOfSeries(e.getViewOfSeriesModel(o))}),n.updateLayoutConfig(e),n.layout(e),n.processLabelsOverall()})}var TR=Math.sin,AR=Math.cos,Itt=Math.PI,wm=Math.PI*2,jTt=180/Itt,WTt=function(){function i(){}return i.prototype.reset=function(t){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,t||4)},i.prototype.moveTo=function(t,e){this._add("M",t,e)},i.prototype.lineTo=function(t,e){this._add("L",t,e)},i.prototype.bezierCurveTo=function(t,e,r,n,o,s){this._add("C",t,e,r,n,o,s)},i.prototype.quadraticCurveTo=function(t,e,r,n){this._add("Q",t,e,r,n)},i.prototype.arc=function(t,e,r,n,o,s){this.ellipse(t,e,r,r,0,n,o,s)},i.prototype.ellipse=function(t,e,r,n,o,s,a,u){var f=a-s,g=!u,v=Math.abs(f),y=fp(v-wm)||(g?f>=wm:-f>=wm),w=f>0?f%wm:f%wm+wm,I=!1;y?I=!0:fp(v)?I=!1:I=w>=Itt==!!g;var E=t+r*AR(s),D=e+n*TR(s);this._start&&this._add("M",E,D);var R=Math.round(o*jTt);if(y){var z=1/this._p,N=(g?1:-1)*(wm-z);this._add("A",r,n,R,1,+g,t+r*AR(s+N),e+n*TR(s+N)),z>.01&&this._add("A",r,n,R,0,+g,E,D)}else{var H=t+r*AR(a),$=e+n*TR(a);this._add("A",r,n,R,+I,+g,H,$)}},i.prototype.rect=function(t,e,r,n){this._add("M",t,e),this._add("l",r,0),this._add("l",0,n),this._add("l",-r,0),this._add("Z")},i.prototype.closePath=function(){this._d.length>0&&this._add("Z")},i.prototype._add=function(t,e,r,n,o,s,a,u,f){for(var g=[],v=this._p,y=1;y<arguments.length;y++){var w=arguments[y];if(isNaN(w)){this._invalid=!0;return}g.push(Math.round(w*v)/v)}this._d.push(t+g.join(" ")),this._start=t==="Z"},i.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},i.prototype.getStr=function(){return this._str},i}();const Mtt=WTt;var Pw="none",$Tt=Math.round;function ZTt(i){var t=i.fill;return t!=null&&t!==Pw}function qTt(i){var t=i.stroke;return t!=null&&t!==Pw}var kz=["lineCap","miterLimit","lineJoin"],XTt=ti(kz,function(i){return"stroke-"+i.toLowerCase()});function YTt(i,t,e,r){var n=t.opacity==null?1:t.opacity;if(e instanceof ys){i("opacity",n);return}if(ZTt(t)){var o=Kw(t.fill);i("fill",o.color);var s=t.fillOpacity!=null?t.fillOpacity*o.opacity*n:o.opacity*n;(r||s<1)&&i("fill-opacity",s)}else i("fill",Pw);if(qTt(t)){var a=Kw(t.stroke);i("stroke",a.color);var u=t.strokeNoScale?e.getLineScale():1,f=u?(t.lineWidth||0)/u:0,g=t.strokeOpacity!=null?t.strokeOpacity*a.opacity*n:a.opacity*n,v=t.strokeFirst;if((r||f!==1)&&i("stroke-width",f),(r||v)&&i("paint-order",v?"stroke":"fill"),(r||g<1)&&i("stroke-opacity",g),t.lineDash){var y=p3(e),w=y[0],I=y[1];w&&(I=$Tt(I||0),i("stroke-dasharray",w.join(",")),(I||r)&&i("stroke-dashoffset",I))}else r&&i("stroke-dasharray",Pw);for(var E=0;E<kz.length;E++){var D=kz[E];if(r||t[D]!==RM[D]){var R=t[D]||RM[D];R&&i(XTt[E],R)}}}else r&&i("stroke",Pw)}var Ctt="http://www.w3.org/2000/svg",Ett="http://www.w3.org/1999/xlink",KTt="http://www.w3.org/2000/xmlns/",JTt="http://www.w3.org/XML/1998/namespace",W8="ecmeta_";function Dtt(i){return document.createElementNS(Ctt,i)}function Zo(i,t,e,r,n){return{tag:i,attrs:e||{},children:r,text:n,key:t}}function QTt(i,t){var e=[];if(t)for(var r in t){var n=t[r],o=r;n!==!1&&(n!==!0&&n!=null&&(o+='="'+n+'"'),e.push(o))}return"<"+i+" "+e.join(" ")+">"}function t2t(i){return"</"+i+">"}function I3(i,t){t=t||{};var e=t.newline?`
`:"";function r(n){var o=n.children,s=n.tag,a=n.attrs,u=n.text;return QTt(s,a)+(s!=="style"?Rs(u):u||"")+(o?""+e+ti(o,function(f){return r(f)}).join(e)+e:"")+t2t(s)}return r(i)}function e2t(i,t,e){e=e||{};var r=e.newline?`
`:"",n=" {"+r,o=r+"}",s=ti(on(i),function(u){return u+n+ti(on(i[u]),function(f){return f+":"+i[u][f]+";"}).join(r)+o}).join(r),a=ti(on(t),function(u){return"@keyframes "+u+n+ti(on(t[u]),function(f){return f+n+ti(on(t[u][f]),function(g){var v=t[u][f][g];return g==="d"&&(v='path("'+v+'")'),g+":"+v+";"}).join(r)+o}).join(r)+o}).join(r);return!s&&!a?"":["<![CDATA[",s,a,"]]>"].join(r)}function Oz(i){return{zrId:i,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssStyleCache:{},cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function $8(i,t,e,r){return Zo("svg","root",{width:i,height:t,xmlns:Ctt,"xmlns:xlink":Ett,version:"1.1",baseProfile:"full",viewBox:r?"0 0 "+i+" "+t:!1},e)}var i2t=0;function Ptt(){return i2t++}var Z8={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Em="transform-origin";function r2t(i,t,e){var r=Fe({},i.shape);Fe(r,t),i.buildPath(e,r);var n=new Mtt;return n.reset(OY(i)),e.rebuildPath(n,1),n.generateStr(),n.getStr()}function n2t(i,t){var e=t.originX,r=t.originY;(e||r)&&(i[Em]=e+"px "+r+"px")}var a2t={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function Ltt(i,t){var e=t.zrId+"-ani-"+t.cssAnimIdx++;return t.cssAnims[e]=i,e}function o2t(i,t,e){var r=i.shape.paths,n={},o,s;if(gt(r,function(u){var f=Oz(e.zrId);f.animation=!0,AE(u,{},f,!0);var g=f.cssAnims,v=f.cssNodes,y=on(g),w=y.length;if(w){s=y[w-1];var I=g[s];for(var E in I){var D=I[E];n[E]=n[E]||{d:""},n[E].d+=D.d||""}for(var R in v){var z=v[R].animation;z.indexOf(s)>=0&&(o=z)}}}),!!o){t.d=!1;var a=Ltt(n,e);return o.replace(s,a)}}function q8(i){return bi(i)?Z8[i]?"cubic-bezier("+Z8[i]+")":SF(i)?i:"":""}function AE(i,t,e,r){var n=i.animators,o=n.length,s=[];if(i instanceof dE){var a=o2t(i,t,e);if(a)s.push(a);else if(!o)return}else if(!o)return;for(var u={},f=0;f<o;f++){var g=n[f],v=[g.getMaxTime()/1e3+"s"],y=q8(g.getClip().easing),w=g.getDelay();y?v.push(y):v.push("linear"),w&&v.push(w/1e3+"s"),g.getLoop()&&v.push("infinite");var I=v.join(" ");u[I]=u[I]||[I,[]],u[I][1].push(g)}function E(z){var N=z[1],H=N.length,$={},X={},K={},et="animation-timing-function";function rt(Ze,ye,Ke){for(var We=Ze.getTracks(),Si=Ze.getMaxTime(),zt=0;zt<We.length;zt++){var Zt=We[zt];if(Zt.needsAnimate()){var pe=Zt.keyframes,$e=Zt.propName;if(Ke&&($e=Ke($e)),$e)for(var He=0;He<pe.length;He++){var qe=pe[He],Ti=Math.round(qe.time/Si*100)+"%",Ai=q8(qe.easing),_i=qe.rawValue;(bi(_i)||fn(_i))&&(ye[Ti]=ye[Ti]||{},ye[Ti][$e]=qe.rawValue,Ai&&(ye[Ti][et]=Ai))}}}}for(var lt=0;lt<H;lt++){var ht=N[lt],yt=ht.targetName;yt?yt==="shape"&&rt(ht,X):!r&&rt(ht,$)}for(var ft in $){var kt={};DM(kt,i),Fe(kt,$[ft]);var Rt=zY(kt),Ct=$[ft][et];K[ft]=Rt?{transform:Rt}:{},n2t(K[ft],kt),Ct&&(K[ft][et]=Ct)}var Gt,Vt=!0;for(var ft in X){K[ft]=K[ft]||{};var Qt=!Gt,Ct=X[ft][et];Qt&&(Gt=new wh);var fe=Gt.len();Gt.reset(),K[ft].d=r2t(i,X[ft],Gt);var Te=Gt.len();if(!Qt&&fe!==Te){Vt=!1;break}Ct&&(K[ft][et]=Ct)}if(!Vt)for(var ft in K)delete K[ft].d;if(!r)for(var lt=0;lt<H;lt++){var ht=N[lt],yt=ht.targetName;yt==="style"&&rt(ht,K,function(We){return a2t[We]})}for(var be=on(K),Ge=!0,li,lt=1;lt<be.length;lt++){var Pi=be[lt-1],or=be[lt];if(K[Pi][Em]!==K[or][Em]){Ge=!1;break}li=K[Pi][Em]}if(Ge&&li){for(var ft in K)K[ft][Em]&&delete K[ft][Em];t[Em]=li}if(Rn(be,function(Ze){return on(K[Ze]).length>0}).length){var Ve=Ltt(K,e);return Ve+" "+z[0]+" both"}}for(var D in u){var a=E(u[D]);a&&s.push(a)}if(s.length){var R=e.zrId+"-cls-"+Ptt();e.cssNodes["."+R]={animation:s.join(",")},t.class=R}}function s2t(i,t,e){if(!i.ignore)if(i.isSilent()){var r={"pointer-events":"none"};X8(r,t,e,!0)}else{var n=i.states.emphasis&&i.states.emphasis.style?i.states.emphasis.style:{},o=n.fill;if(!o){var s=i.style&&i.style.fill,a=i.states.select&&i.states.select.style&&i.states.select.style.fill,u=i.currentStates.indexOf("select")>=0&&a||s;u&&(o=OO(u))}var f=n.lineWidth;if(f){var g=!n.strokeNoScale&&i.transform?i.transform[0]:1;f=f/g}var r={cursor:"pointer"};o&&(r.fill=o),n.stroke&&(r.stroke=n.stroke),f&&(r["stroke-width"]=f),X8(r,t,e,!0)}}function X8(i,t,e,r){var n=JSON.stringify(i),o=e.cssStyleCache[n];o||(o=e.zrId+"-cls-"+Ptt(),e.cssStyleCache[n]=o,e.cssNodes["."+o+(r?":hover":"")]=i),t.class=t.class?t.class+" "+o:o}var pS=Math.round;function Rtt(i){return i&&bi(i.src)}function ktt(i){return i&&Xi(i.toDataURL)}function M3(i,t,e,r){YTt(function(n,o){var s=n==="fill"||n==="stroke";s&&kY(o)?ztt(t,i,n,r):s&&TF(o)?Btt(e,i,n,r):i[n]=o,s&&r.ssr&&o==="none"&&(i["pointer-events"]="visible")},t,e,!1),p2t(e,i,r)}function C3(i,t){var e=pyt(t);e&&(e.each(function(r,n){r!=null&&(i[(W8+n).toLowerCase()]=r+"")}),t.isSilent()&&(i[W8+"silent"]="true"))}function Y8(i){return fp(i[0]-1)&&fp(i[1])&&fp(i[2])&&fp(i[3]-1)}function l2t(i){return fp(i[4])&&fp(i[5])}function E3(i,t,e){if(t&&!(l2t(t)&&Y8(t))){var r=e?10:1e4;i.transform=Y8(t)?"translate("+pS(t[4]*r)/r+" "+pS(t[5]*r)/r+")":R_t(t)}}function K8(i,t,e){for(var r=i.points,n=[],o=0;o<r.length;o++)n.push(pS(r[o][0]*e)/e),n.push(pS(r[o][1]*e)/e);t.points=n.join(" ")}function J8(i){return!i.smooth}function c2t(i){var t=ti(i,function(e){return typeof e=="string"?[e,e]:e});return function(e,r,n){for(var o=0;o<t.length;o++){var s=t[o],a=e[s[0]];a!=null&&(r[s[1]]=pS(a*n)/n)}}}var u2t={circle:[c2t(["cx","cy","r"])],polyline:[K8,J8],polygon:[K8,J8]};function h2t(i){for(var t=i.animators,e=0;e<t.length;e++)if(t[e].targetName==="shape")return!0;return!1}function Ott(i,t){var e=i.style,r=i.shape,n=u2t[i.type],o={},s=t.animation,a="path",u=i.style.strokePercent,f=t.compress&&OY(i)||4;if(n&&!t.willUpdate&&!(n[1]&&!n[1](r))&&!(s&&h2t(i))&&!(u<1)){a=i.type;var g=Math.pow(10,f);n[0](r,o,g)}else{var v=!i.path||i.shapeChanged();i.path||i.createPathProxy();var y=i.path;v&&(y.beginPath(),i.buildPath(y,i.shape),i.pathUpdated());var w=y.getVersion(),I=i,E=I.__svgPathBuilder;(I.__svgPathVersion!==w||!E||u!==I.__svgPathStrokePercent)&&(E||(E=I.__svgPathBuilder=new Mtt),E.reset(f),y.rebuildPath(E,u),E.generateStr(),I.__svgPathVersion=w,I.__svgPathStrokePercent=u),o.d=E.getStr()}return E3(o,i.transform),M3(o,e,i,t),C3(o,i),t.animation&&AE(i,o,t),t.emphasis&&s2t(i,o,t),Zo(a,i.id+"",o)}function d2t(i,t){var e=i.style,r=e.image;if(r&&!bi(r)&&(Rtt(r)?r=r.src:ktt(r)&&(r=r.toDataURL())),!!r){var n=e.x||0,o=e.y||0,s=e.width,a=e.height,u={href:r,width:s,height:a};return n&&(u.x=n),o&&(u.y=o),E3(u,i.transform),M3(u,e,i,t),C3(u,i),t.animation&&AE(i,u,t),Zo("image",i.id+"",u)}}function f2t(i,t){var e=i.style,r=e.text;if(r!=null&&(r+=""),!(!r||isNaN(e.x)||isNaN(e.y))){var n=e.font||Dd,o=e.x||0,s=O_t(e.y||0,kS(n),e.textBaseline),a=k_t[e.textAlign]||e.textAlign,u={"dominant-baseline":"central","text-anchor":a};if(_K(e)){var f="",g=e.fontStyle,v=vK(e.fontSize);if(!parseFloat(v))return;var y=e.fontFamily||lY,w=e.fontWeight;f+="font-size:"+v+";font-family:"+y+";",g&&g!=="normal"&&(f+="font-style:"+g+";"),w&&w!=="normal"&&(f+="font-weight:"+w+";"),u.style=f}else u.style="font: "+n;return r.match(/\s/)&&(u["xml:space"]="preserve"),o&&(u.x=o),s&&(u.y=s),E3(u,i.transform),M3(u,e,i,t),C3(u,i),t.animation&&AE(i,u,t),Zo("text",i.id+"",u,void 0,r)}}function Q8(i,t){if(i instanceof qr)return Ott(i,t);if(i instanceof ys)return d2t(i,t);if(i instanceof tS)return f2t(i,t)}function p2t(i,t,e){var r=i.style;if(z_t(r)){var n=B_t(i),o=e.shadowCache,s=o[n];if(!s){var a=i.getGlobalScale(),u=a[0],f=a[1];if(!u||!f)return;var g=r.shadowOffsetX||0,v=r.shadowOffsetY||0,y=r.shadowBlur,w=Kw(r.shadowColor),I=w.opacity,E=w.color,D=y/2/u,R=y/2/f,z=D+" "+R;s=e.zrId+"-s"+e.shadowIdx++,e.defs[s]=Zo("filter",s,{id:s,x:"-100%",y:"-100%",width:"300%",height:"300%"},[Zo("feDropShadow","",{dx:g/u,dy:v/f,stdDeviation:z,"flood-color":E,"flood-opacity":I})]),o[n]=s}t.filter=tE(s)}}function ztt(i,t,e,r){var n=i[e],o,s={gradientUnits:n.global?"userSpaceOnUse":"objectBoundingBox"};if(LY(n))o="linearGradient",s.x1=n.x,s.y1=n.y,s.x2=n.x2,s.y2=n.y2;else if(RY(n))o="radialGradient",s.cx=Ui(n.x,.5),s.cy=Ui(n.y,.5),s.r=Ui(n.r,.5);else return;for(var a=n.colorStops,u=[],f=0,g=a.length;f<g;++f){var v=zO(a[f].offset)*100+"%",y=a[f].color,w=Kw(y),I=w.color,E=w.opacity,D={offset:v};D["stop-color"]=I,E<1&&(D["stop-opacity"]=E),u.push(Zo("stop",f+"",D))}var R=Zo(o,"",s,u),z=I3(R),N=r.gradientCache,H=N[z];H||(H=r.zrId+"-g"+r.gradientIdx++,N[z]=H,s.id=H,r.defs[H]=Zo(o,H,s,u)),t[e]=tE(H)}function Btt(i,t,e,r){var n=i.style[e],o=i.getBoundingRect(),s={},a=n.repeat,u=a==="no-repeat",f=a==="repeat-x",g=a==="repeat-y",v;if(PY(n)){var y=n.imageWidth,w=n.imageHeight,I=void 0,E=n.image;if(bi(E)?I=E:Rtt(E)?I=E.src:ktt(E)&&(I=E.toDataURL()),typeof Image>"u"){var D="Image width/height must been given explictly in svg-ssr renderer.";Vs(y,D),Vs(w,D)}else if(y==null||w==null){var R=function(lt,ht){if(lt){var yt=lt.elm,ft=y||ht.width,kt=w||ht.height;lt.tag==="pattern"&&(f?(kt=1,ft/=o.width):g&&(ft=1,kt/=o.height)),lt.attrs.width=ft,lt.attrs.height=kt,yt&&(yt.setAttribute("width",ft),yt.setAttribute("height",kt))}},z=PF(I,null,i,function(lt){u||R(X,lt),R(v,lt)});z&&z.width&&z.height&&(y=y||z.width,w=w||z.height)}v=Zo("image","img",{href:I,width:y,height:w}),s.width=y,s.height=w}else n.svgElement&&(v=Yi(n.svgElement),s.width=n.svgWidth,s.height=n.svgHeight);if(v){var N,H;u?N=H=1:f?(H=1,N=s.width/o.width):g?(N=1,H=s.height/o.height):s.patternUnits="userSpaceOnUse",N!=null&&!isNaN(N)&&(s.width=N),H!=null&&!isNaN(H)&&(s.height=H);var $=zY(n);$&&(s.patternTransform=$);var X=Zo("pattern","",s,[v]),K=I3(X),et=r.patternCache,rt=et[K];rt||(rt=r.zrId+"-p"+r.patternIdx++,et[K]=rt,s.id=rt,X=r.defs[rt]=Zo("pattern",rt,s,[v])),t[e]=tE(rt)}}function g2t(i,t,e){var r=e.clipPathCache,n=e.defs,o=r[i.id];if(!o){o=e.zrId+"-c"+e.clipPathIdx++;var s={id:o};r[i.id]=o,n[o]=Zo("clipPath",o,s,[Ott(i,e)])}t["clip-path"]=tE(o)}function tW(i){return document.createTextNode(i)}function zm(i,t,e){i.insertBefore(t,e)}function eW(i,t){i.removeChild(t)}function iW(i,t){i.appendChild(t)}function Ftt(i){return i.parentNode}function Ntt(i){return i.nextSibling}function IR(i,t){i.textContent=t}var rW=58,m2t=120,v2t=Zo("","");function zz(i){return i===void 0}function eh(i){return i!==void 0}function _2t(i,t,e){for(var r={},n=t;n<=e;++n){var o=i[n].key;o!==void 0&&(r[o]=n)}return r}function rw(i,t){var e=i.key===t.key,r=i.tag===t.tag;return r&&e}function gS(i){var t,e=i.children,r=i.tag;if(eh(r)){var n=i.elm=Dtt(r);if(D3(v2t,i),Ye(e))for(t=0;t<e.length;++t){var o=e[t];o!=null&&iW(n,gS(o))}else eh(i.text)&&!nr(i.text)&&iW(n,tW(i.text))}else i.elm=tW(i.text);return i.elm}function Vtt(i,t,e,r,n){for(;r<=n;++r){var o=e[r];o!=null&&zm(i,gS(o),t)}}function iC(i,t,e,r){for(;e<=r;++e){var n=t[e];if(n!=null)if(eh(n.tag)){var o=Ftt(n.elm);eW(o,n.elm)}else eW(i,n.elm)}}function D3(i,t){var e,r=t.elm,n=i&&i.attrs||{},o=t.attrs||{};if(n!==o){for(e in o){var s=o[e],a=n[e];a!==s&&(s===!0?r.setAttribute(e,""):s===!1?r.removeAttribute(e):e==="style"?r.style.cssText=s:e.charCodeAt(0)!==m2t?r.setAttribute(e,s):e==="xmlns:xlink"||e==="xmlns"?r.setAttributeNS(KTt,e,s):e.charCodeAt(3)===rW?r.setAttributeNS(JTt,e,s):e.charCodeAt(5)===rW?r.setAttributeNS(Ett,e,s):r.setAttribute(e,s))}for(e in n)e in o||r.removeAttribute(e)}}function y2t(i,t,e){for(var r=0,n=0,o=t.length-1,s=t[0],a=t[o],u=e.length-1,f=e[0],g=e[u],v,y,w,I;r<=o&&n<=u;)s==null?s=t[++r]:a==null?a=t[--o]:f==null?f=e[++n]:g==null?g=e[--u]:rw(s,f)?(Hy(s,f),s=t[++r],f=e[++n]):rw(a,g)?(Hy(a,g),a=t[--o],g=e[--u]):rw(s,g)?(Hy(s,g),zm(i,s.elm,Ntt(a.elm)),s=t[++r],g=e[--u]):rw(a,f)?(Hy(a,f),zm(i,a.elm,s.elm),a=t[--o],f=e[++n]):(zz(v)&&(v=_2t(t,r,o)),y=v[f.key],zz(y)?zm(i,gS(f),s.elm):(w=t[y],w.tag!==f.tag?zm(i,gS(f),s.elm):(Hy(w,f),t[y]=void 0,zm(i,w.elm,s.elm))),f=e[++n]);(r<=o||n<=u)&&(r>o?(I=e[u+1]==null?null:e[u+1].elm,Vtt(i,I,e,n,u)):iC(i,t,r,o))}function Hy(i,t){var e=t.elm=i.elm,r=i.children,n=t.children;i!==t&&(D3(i,t),zz(t.text)?eh(r)&&eh(n)?r!==n&&y2t(e,r,n):eh(n)?(eh(i.text)&&IR(e,""),Vtt(e,null,n,0,n.length-1)):eh(r)?iC(e,r,0,r.length-1):eh(i.text)&&IR(e,""):i.text!==t.text&&(eh(r)&&iC(e,r,0,r.length-1),IR(e,t.text)))}function x2t(i,t){if(rw(i,t))Hy(i,t);else{var e=i.elm,r=Ftt(e);gS(t),r!==null&&(zm(r,t.elm,Ntt(e)),iC(r,[i],0,0))}return t}var b2t=0,w2t=function(){function i(t,e,r){if(this.type="svg",this.refreshHover=nW(),this.configLayer=nW(),this.storage=e,this._opts=r=Fe({},r),this.root=t,this._id="zr"+b2t++,this._oldVNode=$8(r.width,r.height),t&&!r.ssr){var n=this._viewport=document.createElement("div");n.style.cssText="position:relative;overflow:hidden";var o=this._svgDom=this._oldVNode.elm=Dtt("svg");D3(null,this._oldVNode),n.appendChild(o),t.appendChild(n)}this.resize(r.width,r.height)}return i.prototype.getType=function(){return this.type},i.prototype.getViewportRoot=function(){return this._viewport},i.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},i.prototype.getSvgDom=function(){return this._svgDom},i.prototype.refresh=function(){if(this.root){var t=this.renderToVNode({willUpdate:!0});t.attrs.style="position:absolute;left:0;top:0;user-select:none",x2t(this._oldVNode,t),this._oldVNode=t}},i.prototype.renderOneToVNode=function(t){return Q8(t,Oz(this._id))},i.prototype.renderToVNode=function(t){t=t||{};var e=this.storage.getDisplayList(!0),r=this._width,n=this._height,o=Oz(this._id);o.animation=t.animation,o.willUpdate=t.willUpdate,o.compress=t.compress,o.emphasis=t.emphasis,o.ssr=this._opts.ssr;var s=[],a=this._bgVNode=S2t(r,n,this._backgroundColor,o);a&&s.push(a);var u=t.compress?null:this._mainVNode=Zo("g","main",{},[]);this._paintList(e,o,u?u.children:s),u&&s.push(u);var f=ti(on(o.defs),function(y){return o.defs[y]});if(f.length&&s.push(Zo("defs","defs",{},f)),t.animation){var g=e2t(o.cssNodes,o.cssAnims,{newline:!0});if(g){var v=Zo("style","stl",{},[],g);s.push(v)}}return $8(r,n,s,t.useViewBox)},i.prototype.renderToString=function(t){return t=t||{},I3(this.renderToVNode({animation:Ui(t.cssAnimation,!0),emphasis:Ui(t.cssEmphasis,!0),willUpdate:!1,compress:!0,useViewBox:Ui(t.useViewBox,!0)}),{newline:!0})},i.prototype.setBackgroundColor=function(t){this._backgroundColor=t},i.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},i.prototype._paintList=function(t,e,r){for(var n=t.length,o=[],s=0,a,u,f=0,g=0;g<n;g++){var v=t[g];if(!v.invisible){var y=v.__clipPaths,w=y&&y.length||0,I=u&&u.length||0,E=void 0;for(E=Math.max(w-1,I-1);E>=0&&!(y&&u&&y[E]===u[E]);E--);for(var D=I-1;D>E;D--)s--,a=o[s-1];for(var R=E+1;R<w;R++){var z={};g2t(y[R],z,e);var N=Zo("g","clip-g-"+f++,z,[]);(a?a.children:r).push(N),o[s++]=N,a=N}u=y;var H=Q8(v,e);H&&(a?a.children:r).push(H)}}},i.prototype.resize=function(t,e){var r=this._opts,n=this.root,o=this._viewport;if(t!=null&&(r.width=t),e!=null&&(r.height=e),n&&o&&(o.style.display="none",t=Ky(n,0,r),e=Ky(n,1,r),o.style.display=""),this._width!==t||this._height!==e){if(this._width=t,this._height=e,o){var s=o.style;s.width=t+"px",s.height=e+"px"}if(TF(this._backgroundColor))this.refresh();else{var a=this._svgDom;a&&(a.setAttribute("width",t),a.setAttribute("height",e));var u=this._bgVNode&&this._bgVNode.elm;u&&(u.setAttribute("width",t),u.setAttribute("height",e))}}},i.prototype.getWidth=function(){return this._width},i.prototype.getHeight=function(){return this._height},i.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},i.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},i.prototype.toDataURL=function(t){var e=this.renderToString(),r="data:image/svg+xml;";return t?(e=N_t(e),e&&r+"base64,"+e):r+"charset=UTF-8,"+encodeURIComponent(e)},i}();function nW(i){return function(){}}function S2t(i,t,e,r){var n;if(e&&e!=="none")if(n=Zo("rect","bg",{width:i,height:t,x:"0",y:"0"}),kY(e))ztt({fill:e},n.attrs,"fill",r);else if(TF(e))Btt({style:{fill:e},dirty:uo,getBoundingRect:function(){return{width:i,height:t}}},n.attrs,"fill",r);else{var o=Kw(e),s=o.color,a=o.opacity;n.attrs.fill=s,a<1&&(n.attrs["fill-opacity"]=a)}return n}const T2t=w2t;function A2t(i){i.registerPainter("svg",T2t)}function aW(i,t,e){var r=gu.createCanvas(),n=t.getWidth(),o=t.getHeight(),s=r.style;return s&&(s.position="absolute",s.left="0",s.top="0",s.width=n+"px",s.height=o+"px",r.setAttribute("data-zr-dom-id",i)),r.width=n*e,r.height=o*e,r}var I2t=function(i){xa(t,i);function t(e,r,n){var o=i.call(this)||this;o.motionBlur=!1,o.lastFrameAlpha=.7,o.dpr=1,o.virtual=!1,o.config={},o.incremental=!1,o.zlevel=0,o.maxRepaintRectCount=5,o.__dirty=!0,o.__firstTimePaint=!0,o.__used=!1,o.__drawIndex=0,o.__startIndex=0,o.__endIndex=0,o.__prevStartIndex=null,o.__prevEndIndex=null;var s;n=n||EM,typeof e=="string"?s=aW(e,r,n):nr(e)&&(s=e,e=s.id),o.id=e,o.dom=s;var a=s.style;return a&&(pY(s),s.onselectstart=function(){return!1},a.padding="0",a.margin="0",a.borderWidth="0"),o.painter=r,o.dpr=n,o}return t.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},t.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},t.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},t.prototype.setUnpainted=function(){this.__firstTimePaint=!0},t.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=aW("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),e!==1&&this.ctxBack.scale(e,e)},t.prototype.createRepaintRects=function(e,r,n,o){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var s=[],a=this.maxRepaintRectCount,u=!1,f=new sr(0,0,0,0);function g(z){if(!(!z.isFinite()||z.isZero()))if(s.length===0){var N=new sr(0,0,0,0);N.copy(z),s.push(N)}else{for(var H=!1,$=1/0,X=0,K=0;K<s.length;++K){var et=s[K];if(et.intersect(z)){var rt=new sr(0,0,0,0);rt.copy(et),rt.union(z),s[K]=rt,H=!0;break}else if(u){f.copy(z),f.union(et);var lt=z.width*z.height,ht=et.width*et.height,yt=f.width*f.height,ft=yt-lt-ht;ft<$&&($=ft,X=K)}}if(u&&(s[X].union(z),H=!0),!H){var N=new sr(0,0,0,0);N.copy(z),s.push(N)}u||(u=s.length>=a)}}for(var v=this.__startIndex;v<this.__endIndex;++v){var y=e[v];if(y){var w=y.shouldBePainted(n,o,!0,!0),I=y.__isRendered&&(y.__dirty&Kl||!w)?y.getPrevPaintRect():null;I&&g(I);var E=w&&(y.__dirty&Kl||!y.__isRendered)?y.getPaintRect():null;E&&g(E)}}for(var v=this.__prevStartIndex;v<this.__prevEndIndex;++v){var y=r[v],w=y&&y.shouldBePainted(n,o,!0,!0);if(y&&(!w||!y.__zr)&&y.__isRendered){var I=y.getPrevPaintRect();I&&g(I)}}var D;do{D=!1;for(var v=0;v<s.length;){if(s[v].isZero()){s.splice(v,1);continue}for(var R=v+1;R<s.length;)s[v].intersect(s[R])?(D=!0,s[v].union(s[R]),s.splice(R,1)):R++;v++}}while(D);return this._paintRects=s,s},t.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},t.prototype.resize=function(e,r){var n=this.dpr,o=this.dom,s=o.style,a=this.domBack;s&&(s.width=e+"px",s.height=r+"px"),o.width=e*n,o.height=r*n,a&&(a.width=e*n,a.height=r*n,n!==1&&this.ctxBack.scale(n,n))},t.prototype.clear=function(e,r,n){var o=this.dom,s=this.ctx,a=o.width,u=o.height;r=r||this.clearColor;var f=this.motionBlur&&!e,g=this.lastFrameAlpha,v=this.dpr,y=this;f&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(o,0,0,a/v,u/v));var w=this.domBack;function I(E,D,R,z){if(s.clearRect(E,D,R,z),r&&r!=="transparent"){var N=void 0;if(XC(r)){var H=r.global||r.__width===R&&r.__height===z;N=H&&r.__canvasGradient||xz(s,r,{x:0,y:0,width:R,height:z}),r.__canvasGradient=N,r.__width=R,r.__height=z}else Bvt(r)&&(r.scaleX=r.scaleX||v,r.scaleY=r.scaleY||v,N=bz(s,r,{dirty:function(){y.setUnpainted(),y.painter.refresh()}}));s.save(),s.fillStyle=N||r,s.fillRect(E,D,R,z),s.restore()}f&&(s.save(),s.globalAlpha=g,s.drawImage(w,E,D,R,z),s.restore())}!n||f?I(0,0,a,u):n.length&&gt(n,function(E){I(E.x*v,E.y*v,E.width*v,E.height*v)})},t}(zc);const MR=I2t;var oW=1e5,Sm=314159,HA=.01,M2t=.001;function C2t(i){return i?i.__builtin__?!0:!(typeof i.resize!="function"||typeof i.refresh!="function"):!1}function E2t(i,t){var e=document.createElement("div");return e.style.cssText=["position:relative","width:"+i+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";",e}var D2t=function(){function i(t,e,r,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var o=!t.nodeName||t.nodeName.toUpperCase()==="CANVAS";this._opts=r=Fe({},r||{}),this.dpr=r.devicePixelRatio||EM,this._singleCanvas=o,this.root=t;var s=t.style;s&&(pY(t),t.innerHTML=""),this.storage=e;var a=this._zlevelList;this._prevDisplayList=[];var u=this._layers;if(o){var g=t,v=g.width,y=g.height;r.width!=null&&(v=r.width),r.height!=null&&(y=r.height),this.dpr=r.devicePixelRatio||1,g.width=v*this.dpr,g.height=y*this.dpr,this._width=v,this._height=y;var w=new MR(g,this,this.dpr);w.__builtin__=!0,w.initContext(),u[Sm]=w,w.zlevel=Sm,a.push(Sm),this._domRoot=t}else{this._width=Ky(t,0,r),this._height=Ky(t,1,r);var f=this._domRoot=E2t(this._width,this._height);t.appendChild(f)}}return i.prototype.getType=function(){return"canvas"},i.prototype.isSingleCanvas=function(){return this._singleCanvas},i.prototype.getViewportRoot=function(){return this._domRoot},i.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},i.prototype.refresh=function(t){var e=this.storage.getDisplayList(!0),r=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,r,t,this._redrawId);for(var o=0;o<n.length;o++){var s=n[o],a=this._layers[s];if(!a.__builtin__&&a.refresh){var u=o===0?this._backgroundColor:null;a.refresh(u)}}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},i.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},i.prototype._paintHoverList=function(t){var e=t.length,r=this._hoverlayer;if(r&&r.clear(),!!e){for(var n={inHover:!0,viewWidth:this._width,viewHeight:this._height},o,s=0;s<e;s++){var a=t[s];a.__inHover&&(r||(r=this._hoverlayer=this.getLayer(oW)),o||(o=r.ctx,o.save()),qm(o,a,n,s===e-1))}o&&o.restore()}},i.prototype.getHoverLayer=function(){return this.getLayer(oW)},i.prototype.paintOne=function(t,e){yQ(t,e)},i.prototype._paintList=function(t,e,r,n){if(this._redrawId===n){r=r||!1,this._updateLayerStatus(t);var o=this._doPaintList(t,e,r),s=o.finished,a=o.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),a&&this._paintHoverList(t),s)this.eachLayer(function(f){f.afterBrush&&f.afterBrush()});else{var u=this;DO(function(){u._paintList(t,e,r,n)})}}},i.prototype._compositeManually=function(){var t=this.getLayer(Sm).ctx,e=this._domRoot.width,r=this._domRoot.height;t.clearRect(0,0,e,r),this.eachBuiltinLayer(function(n){n.virtual&&t.drawImage(n.dom,0,0,e,r)})},i.prototype._doPaintList=function(t,e,r){for(var n=this,o=[],s=this._opts.useDirtyRect,a=0;a<this._zlevelList.length;a++){var u=this._zlevelList[a],f=this._layers[u];f.__builtin__&&f!==this._hoverlayer&&(f.__dirty||r)&&o.push(f)}for(var g=!0,v=!1,y=function(E){var D=o[E],R=D.ctx,z=s&&D.createRepaintRects(t,e,w._width,w._height),N=r?D.__startIndex:D.__drawIndex,H=!r&&D.incremental&&Date.now,$=H&&Date.now(),X=D.zlevel===w._zlevelList[0]?w._backgroundColor:null;if(D.__startIndex===D.__endIndex)D.clear(!1,X,z);else if(N===D.__startIndex){var K=t[N];(!K.incremental||!K.notClear||r)&&D.clear(!1,X,z)}N===-1&&(console.error("For some unknown reason. drawIndex is -1"),N=D.__startIndex);var et,rt=function(ft){var kt={inHover:!1,allClipped:!1,prevEl:null,viewWidth:n._width,viewHeight:n._height};for(et=N;et<D.__endIndex;et++){var Rt=t[et];if(Rt.__inHover&&(v=!0),n._doPaintEl(Rt,D,s,ft,kt,et===D.__endIndex-1),H){var Ct=Date.now()-$;if(Ct>15)break}}kt.prevElClipPaths&&R.restore()};if(z)if(z.length===0)et=D.__endIndex;else for(var lt=w.dpr,ht=0;ht<z.length;++ht){var yt=z[ht];R.save(),R.beginPath(),R.rect(yt.x*lt,yt.y*lt,yt.width*lt,yt.height*lt),R.clip(),rt(yt),R.restore()}else R.save(),rt(),R.restore();D.__drawIndex=et,D.__drawIndex<D.__endIndex&&(g=!1)},w=this,I=0;I<o.length;I++)y(I);return Sn.wxa&&gt(this._layers,function(E){E&&E.ctx&&E.ctx.draw&&E.ctx.draw()}),{finished:g,needsRefreshHover:v}},i.prototype._doPaintEl=function(t,e,r,n,o,s){var a=e.ctx;if(r){var u=t.getPaintRect();(!n||u&&u.intersect(n))&&(qm(a,t,o,s),t.setPrevPaintRect(u))}else qm(a,t,o,s)},i.prototype.getLayer=function(t,e){this._singleCanvas&&!this._needsManuallyCompositing&&(t=Sm);var r=this._layers[t];return r||(r=new MR("zr_"+t,this,this.dpr),r.zlevel=t,r.__builtin__=!0,this._layerConfig[t]?Er(r,this._layerConfig[t],!0):this._layerConfig[t-HA]&&Er(r,this._layerConfig[t-HA],!0),e&&(r.virtual=e),this.insertLayer(t,r),r.initContext()),r},i.prototype.insertLayer=function(t,e){var r=this._layers,n=this._zlevelList,o=n.length,s=this._domRoot,a=null,u=-1;if(!r[t]&&C2t(e)){if(o>0&&t>n[0]){for(u=0;u<o-1&&!(n[u]<t&&n[u+1]>t);u++);a=r[n[u]]}if(n.splice(u+1,0,t),r[t]=e,!e.virtual)if(a){var f=a.dom;f.nextSibling?s.insertBefore(e.dom,f.nextSibling):s.appendChild(e.dom)}else s.firstChild?s.insertBefore(e.dom,s.firstChild):s.appendChild(e.dom);e.painter||(e.painter=this)}},i.prototype.eachLayer=function(t,e){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n];t.call(e,this._layers[o],o)}},i.prototype.eachBuiltinLayer=function(t,e){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],s=this._layers[o];s.__builtin__&&t.call(e,s,o)}},i.prototype.eachOtherLayer=function(t,e){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],s=this._layers[o];s.__builtin__||t.call(e,s,o)}},i.prototype.getLayers=function(){return this._layers},i.prototype._updateLayerStatus=function(t){this.eachBuiltinLayer(function(v,y){v.__dirty=v.__used=!1});function e(v){o&&(o.__endIndex!==v&&(o.__dirty=!0),o.__endIndex=v)}if(this._singleCanvas)for(var r=1;r<t.length;r++){var n=t[r];if(n.zlevel!==t[r-1].zlevel||n.incremental){this._needsManuallyCompositing=!0;break}}var o=null,s=0,a,u;for(u=0;u<t.length;u++){var n=t[u],f=n.zlevel,g=void 0;a!==f&&(a=f,s=0),n.incremental?(g=this.getLayer(f+M2t,this._needsManuallyCompositing),g.incremental=!0,s=1):g=this.getLayer(f+(s>0?HA:0),this._needsManuallyCompositing),g.__builtin__||mF("ZLevel "+f+" has been used by unkown layer "+g.id),g!==o&&(g.__used=!0,g.__startIndex!==u&&(g.__dirty=!0),g.__startIndex=u,g.incremental?g.__drawIndex=-1:g.__drawIndex=u,e(u),o=g),n.__dirty&Kl&&!n.__inHover&&(g.__dirty=!0,g.incremental&&g.__drawIndex<0&&(g.__drawIndex=u))}e(u),this.eachBuiltinLayer(function(v,y){!v.__used&&v.getElementCount()>0&&(v.__dirty=!0,v.__startIndex=v.__endIndex=v.__drawIndex=0),v.__dirty&&v.__drawIndex<0&&(v.__drawIndex=v.__startIndex)})},i.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},i.prototype._clearLayer=function(t){t.clear()},i.prototype.setBackgroundColor=function(t){this._backgroundColor=t,gt(this._layers,function(e){e.setUnpainted()})},i.prototype.configLayer=function(t,e){if(e){var r=this._layerConfig;r[t]?Er(r[t],e,!0):r[t]=e;for(var n=0;n<this._zlevelList.length;n++){var o=this._zlevelList[n];if(o===t||o===t+HA){var s=this._layers[o];Er(s,r[t],!0)}}}},i.prototype.delLayer=function(t){var e=this._layers,r=this._zlevelList,n=e[t];n&&(n.dom.parentNode.removeChild(n.dom),delete e[t],r.splice(Ar(r,t),1))},i.prototype.resize=function(t,e){if(this._domRoot.style){var r=this._domRoot;r.style.display="none";var n=this._opts,o=this.root;if(t!=null&&(n.width=t),e!=null&&(n.height=e),t=Ky(o,0,n),e=Ky(o,1,n),r.style.display="",this._width!==t||e!==this._height){r.style.width=t+"px",r.style.height=e+"px";for(var s in this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].resize(t,e);this.refresh(!0)}this._width=t,this._height=e}else{if(t==null||e==null)return;this._width=t,this._height=e,this.getLayer(Sm).resize(t,e)}return this},i.prototype.clearLayer=function(t){var e=this._layers[t];e&&e.clear()},i.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},i.prototype.getRenderedCanvas=function(t){if(t=t||{},this._singleCanvas&&!this._compositeManually)return this._layers[Sm].dom;var e=new MR("image",this,t.pixelRatio||this.dpr);e.initContext(),e.clear(!1,t.backgroundColor||this._backgroundColor);var r=e.ctx;if(t.pixelRatio<=this.dpr){this.refresh();var n=e.dom.width,o=e.dom.height;this.eachLayer(function(v){v.__builtin__?r.drawImage(v.dom,0,0,n,o):v.renderToCanvas&&(r.save(),v.renderToCanvas(r),r.restore())})}else for(var s={inHover:!1,viewWidth:this._width,viewHeight:this._height},a=this.storage.getDisplayList(!0),u=0,f=a.length;u<f;u++){var g=a[u];qm(r,g,s,u===f-1)}return e.dom},i.prototype.getWidth=function(){return this._width},i.prototype.getHeight=function(){return this._height},i}();const P2t=D2t;function L2t(i){i.registerPainter("canvas",P2t)}var R2t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e){return Hd(null,this,{useEncodeDefaulter:!0})},t.prototype.getLegendIcon=function(e){var r=new Ki,n=bo("line",0,e.itemHeight/2,e.itemWidth,0,e.lineStyle.stroke,!1);r.add(n),n.setStyle(e.lineStyle);var o=this.getData().getVisual("symbol"),s=this.getData().getVisual("symbolRotate"),a=o==="none"?"circle":o,u=e.itemHeight*.8,f=bo(a,(e.itemWidth-u)/2,(e.itemHeight-u)/2,u,u,e.itemStyle.fill);r.add(f),f.setStyle(e.itemStyle);var g=e.iconRotate==="inherit"?s:e.iconRotate||0;return f.rotation=g*Math.PI/180,f.setOrigin([e.itemWidth/2,e.itemHeight/2]),a.indexOf("empty")>-1&&(f.style.stroke=f.style.fill,f.style.fill=_e.color.neutral00,f.style.lineWidth=2),r},t.type="series.line",t.dependencies=["grid","polar"],t.defaultOption={z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:6,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0,universalTransition:{divideShape:"clone"},triggerLineEvent:!1},t}(Ea);const k2t=R2t;function I0(i,t){var e=i.mapDimensionsAll("defaultedLabel"),r=e.length;if(r===1){var n=w0(i,t,e[0]);return n!=null?n+"":null}else if(r){for(var o=[],s=0;s<e.length;s++)o.push(w0(i,t,e[s]));return o.join(" ")}}function Utt(i,t){var e=i.mapDimensionsAll("defaultedLabel");if(!Ye(t))return t+"";for(var r=[],n=0;n<e.length;n++){var o=i.getDimensionIndex(e[n]);o>=0&&r.push(t[o])}return r.join(" ")}var O2t=function(i){we(t,i);function t(e,r,n,o){var s=i.call(this)||this;return s.updateData(e,r,n,o),s}return t.prototype._createSymbol=function(e,r,n,o,s,a){this.removeAll();var u=bo(e,-1,-1,2,2,null,a);u.attr({z2:Ui(s,100),culling:!0,scaleX:o[0]/2,scaleY:o[1]/2}),u.drift=z2t,this._symbolType=e,this.add(u)},t.prototype.stopSymbolAnimation=function(e){this.childAt(0).stopAnimation(null,e)},t.prototype.getSymbolType=function(){return this._symbolType},t.prototype.getSymbolPath=function(){return this.childAt(0)},t.prototype.highlight=function(){Rd(this.childAt(0))},t.prototype.downplay=function(){kd(this.childAt(0))},t.prototype.setZ=function(e,r){var n=this.childAt(0);n.zlevel=e,n.z=r},t.prototype.setDraggable=function(e,r){var n=this.childAt(0);n.draggable=e,n.cursor=!r&&e?"move":n.cursor},t.prototype.updateData=function(e,r,n,o){this.silent=!1;var s=e.getItemVisual(r,"symbol")||"circle",a=e.hostModel,u=t.getSymbolSize(e,r),f=t.getSymbolZ2(e,r),g=s!==this._symbolType,v=o&&o.disableAnimation;if(g){var y=e.getItemVisual(r,"symbolKeepAspect");this._createSymbol(s,e,r,u,f,y)}else{var w=this.childAt(0);w.silent=!1;var I={scaleX:u[0]/2,scaleY:u[1]/2};v?w.attr(I):yn(w,I,a,r),Oc(w)}if(this._updateCommon(e,r,u,n,o),g){var w=this.childAt(0);if(!v){var I={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:w.style.opacity}};w.scaleX=w.scaleY=0,w.style.opacity=0,ya(w,I,a,r)}}v&&this.childAt(0).stopAnimation("leave")},t.prototype._updateCommon=function(e,r,n,o,s){var a=this.childAt(0),u=e.hostModel,f,g,v,y,w,I,E,D,R;if(o&&(f=o.emphasisItemStyle,g=o.blurItemStyle,v=o.selectItemStyle,y=o.focus,w=o.blurScope,E=o.labelStatesModels,D=o.hoverScale,R=o.cursorStyle,I=o.emphasisDisabled),!o||e.hasItemOption){var z=o&&o.itemModel?o.itemModel:e.getItemModel(r),N=z.getModel("emphasis");f=N.getModel("itemStyle").getItemStyle(),v=z.getModel(["select","itemStyle"]).getItemStyle(),g=z.getModel(["blur","itemStyle"]).getItemStyle(),y=N.get("focus"),w=N.get("blurScope"),I=N.get("disabled"),E=zo(z),D=N.getShallow("scale"),R=z.getShallow("cursor")}var H=e.getItemVisual(r,"symbolRotate");a.attr("rotation",(H||0)*Math.PI/180||0);var $=Cv(e.getItemVisual(r,"symbolOffset"),n);$&&(a.x=$[0],a.y=$[1]),R&&a.attr("cursor",R);var X=e.getItemVisual(r,"style"),K=X.fill;if(a instanceof ys){var et=a.style;a.useStyle(Fe({image:et.image,x:et.x,y:et.y,width:et.width,height:et.height},X))}else a.__isEmptyBrush?a.useStyle(Fe({},X)):a.useStyle(X),a.style.decal=null,a.setColor(K,s&&s.symbolInnerColor),a.style.strokeNoScale=!0;var rt=e.getItemVisual(r,"liftZ"),lt=this._z2;rt!=null?lt==null&&(this._z2=a.z2,a.z2+=rt):lt!=null&&(a.z2=lt,this._z2=null);var ht=s&&s.useNameLabel;qo(a,E,{labelFetcher:u,labelDataIndex:r,defaultText:yt,inheritColor:K,defaultOpacity:X.opacity});function yt(Rt){return ht?e.getName(Rt):I0(e,Rt)}this._sizeX=n[0]/2,this._sizeY=n[1]/2;var ft=a.ensureState("emphasis");ft.style=f,a.ensureState("select").style=v,a.ensureState("blur").style=g;var kt=D==null||D===!0?Math.max(1.1,3/this._sizeY):isFinite(D)&&D>0?+D:1;ft.scaleX=this._sizeX*kt,ft.scaleY=this._sizeY*kt,this.setSymbolScale(1),Ma(this,y,w,I)},t.prototype.setSymbolScale=function(e){this.scaleX=this.scaleY=e},t.prototype.fadeOut=function(e,r,n){var o=this.childAt(0),s=ur(this).dataIndex,a=n&&n.animation;if(this.silent=o.silent=!0,n&&n.fadeLabel){var u=o.getTextContent();u&&Pp(u,{style:{opacity:0}},r,{dataIndex:s,removeOpt:a,cb:function(){o.removeTextContent()}})}else o.removeTextContent();Pp(o,{style:{opacity:0},scaleX:0,scaleY:0},r,{dataIndex:s,cb:e,removeOpt:a})},t.getSymbolSize=function(e,r){return Z0(e.getItemVisual(r,"symbolSize"))},t.getSymbolZ2=function(e,r){return e.getItemVisual(r,"z2")},t}(Ki);function z2t(i,t){this.parent.drift(i,t)}const jS=O2t;function CR(i,t,e,r){return t&&!isNaN(t[0])&&!isNaN(t[1])&&!(r.isIgnore&&r.isIgnore(e))&&!(r.clipShape&&!r.clipShape.contain(t[0],t[1]))&&i.getItemVisual(e,"symbol")!=="none"}function sW(i){return i!=null&&!nr(i)&&(i={isIgnore:i}),i||{}}function lW(i){var t=i.hostModel,e=t.getModel("emphasis");return{emphasisItemStyle:e.getModel("itemStyle").getItemStyle(),blurItemStyle:t.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:t.getModel(["select","itemStyle"]).getItemStyle(),focus:e.get("focus"),blurScope:e.get("blurScope"),emphasisDisabled:e.get("disabled"),hoverScale:e.get("scale"),labelStatesModels:zo(t),cursorStyle:t.get("cursor")}}var B2t=function(){function i(t){this.group=new Ki,this._SymbolCtor=t||jS}return i.prototype.updateData=function(t,e){this._progressiveEls=null,e=sW(e);var r=this.group,n=t.hostModel,o=this._data,s=this._SymbolCtor,a=e.disableAnimation,u=lW(t),f={disableAnimation:a},g=e.getSymbolPoint||function(v){return t.getItemLayout(v)};o||r.removeAll(),t.diff(o).add(function(v){var y=g(v);if(CR(t,y,v,e)){var w=new s(t,v,u,f);w.setPosition(y),t.setItemGraphicEl(v,w),r.add(w)}}).update(function(v,y){var w=o.getItemGraphicEl(y),I=g(v);if(!CR(t,I,v,e)){r.remove(w);return}var E=t.getItemVisual(v,"symbol")||"circle",D=w&&w.getSymbolType&&w.getSymbolType();if(!w||D&&D!==E)r.remove(w),w=new s(t,v,u,f),w.setPosition(I);else{w.updateData(t,v,u,f);var R={x:I[0],y:I[1]};a?w.attr(R):yn(w,R,n)}r.add(w),t.setItemGraphicEl(v,w)}).remove(function(v){var y=o.getItemGraphicEl(v);y&&y.fadeOut(function(){r.remove(y)},n)}).execute(),this._getSymbolPoint=g,this._data=t},i.prototype.updateLayout=function(){var t=this,e=this._data;e&&e.eachItemGraphicEl(function(r,n){var o=t._getSymbolPoint(n);r.setPosition(o),r.markRedraw()})},i.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=lW(t),this._data=null,this.group.removeAll()},i.prototype.incrementalUpdate=function(t,e,r){this._progressiveEls=[],r=sW(r);function n(u){u.isGroup||(u.incremental=!0,u.ensureState("emphasis").hoverLayer=!0)}for(var o=t.start;o<t.end;o++){var s=e.getItemLayout(o);if(CR(e,s,o,r)){var a=new this._SymbolCtor(e,o,this._seriesScope);a.traverse(n),a.setPosition(s),this.group.add(a),e.setItemGraphicEl(o,a),this._progressiveEls.push(a)}}},i.prototype.eachRendered=function(t){Hp(this._progressiveEls||this.group,t)},i.prototype.remove=function(t){var e=this.group,r=this._data;r&&t?r.eachItemGraphicEl(function(n){n.fadeOut(function(){e.remove(n)},r.hostModel)}):e.removeAll()},i}();const WS=B2t;function Gtt(i,t,e){var r=i.getBaseAxis(),n=i.getOtherAxis(r),o=F2t(n,e),s=r.dim,a=n.dim,u=t.mapDimension(a),f=t.mapDimension(s),g=a==="x"||a==="radius"?1:0,v=ti(i.dimensions,function(I){return t.mapDimension(I)}),y=!1,w=t.getCalculationInfo("stackResultDimension");return Lp(t,v[0])&&(y=!0,v[0]=w),Lp(t,v[1])&&(y=!0,v[1]=w),{dataDimsForPoint:v,valueStart:o,valueAxisDim:a,baseAxisDim:s,stacked:!!y,valueDim:u,baseDim:f,baseDataOffset:g,stackedOverDimension:t.getCalculationInfo("stackedOverDimension")}}function F2t(i,t){var e=0,r=i.scale.getExtent();return t==="start"?e=r[0]:t==="end"?e=r[1]:fn(t)&&!isNaN(t)?e=t:r[0]>0?e=r[0]:r[1]<0&&(e=r[1]),e}function Htt(i,t,e,r){var n=NaN;i.stacked&&(n=e.get(e.getCalculationInfo("stackedOverDimension"),r)),isNaN(n)&&(n=i.valueStart);var o=i.baseDataOffset,s=[];return s[o]=e.get(i.baseDim,r),s[1-o]=n,t.dataToPoint(s)}function N2t(i,t){var e=[];return t.diff(i).add(function(r){e.push({cmd:"+",idx:r})}).update(function(r,n){e.push({cmd:"=",idx:n,idx1:r})}).remove(function(r){e.push({cmd:"-",idx:r})}).execute(),e}function V2t(i,t,e,r,n,o,s,a){for(var u=N2t(i,t),f=[],g=[],v=[],y=[],w=[],I=[],E=[],D=Gtt(n,t,s),R=i.getLayout("points")||[],z=t.getLayout("points")||[],N=0;N<u.length;N++){var H=u[N],$=!0,X=void 0,K=void 0;switch(H.cmd){case"=":X=H.idx*2,K=H.idx1*2;var et=R[X],rt=R[X+1],lt=z[K],ht=z[K+1];(isNaN(et)||isNaN(rt))&&(et=lt,rt=ht),f.push(et,rt),g.push(lt,ht),v.push(e[X],e[X+1]),y.push(r[K],r[K+1]),E.push(t.getRawIndex(H.idx1));break;case"+":var yt=H.idx,ft=D.dataDimsForPoint,kt=n.dataToPoint([t.get(ft[0],yt),t.get(ft[1],yt)]);K=yt*2,f.push(kt[0],kt[1]),g.push(z[K],z[K+1]);var Rt=Htt(D,n,t,yt);v.push(Rt[0],Rt[1]),y.push(r[K],r[K+1]),E.push(t.getRawIndex(yt));break;case"-":$=!1}$&&(w.push(H),I.push(I.length))}I.sort(function(Pi,or){return E[Pi]-E[or]});for(var Ct=f.length,Gt=ch(Ct),Vt=ch(Ct),Qt=ch(Ct),fe=ch(Ct),Te=[],N=0;N<I.length;N++){var be=I[N],Ge=N*2,li=be*2;Gt[Ge]=f[li],Gt[Ge+1]=f[li+1],Vt[Ge]=g[li],Vt[Ge+1]=g[li+1],Qt[Ge]=v[li],Qt[Ge+1]=v[li+1],fe[Ge]=y[li],fe[Ge+1]=y[li+1],Te[N]=w[be]}return{current:Gt,next:Vt,stackedOnCurrent:Qt,stackedOnNext:fe,status:Te}}var jf=Math.min,Wf=Math.max;function sv(i,t){return isNaN(i)||isNaN(t)}function Bz(i,t,e,r,n,o,s,a,u){for(var f,g,v,y,w,I,E=e,D=0;D<r;D++){var R=t[E*2],z=t[E*2+1];if(E>=n||E<0)break;if(sv(R,z)){if(u){E+=o;continue}break}if(E===e)i[o>0?"moveTo":"lineTo"](R,z),v=R,y=z;else{var N=R-f,H=z-g;if(N*N+H*H<.5){E+=o;continue}if(s>0){for(var $=E+o,X=t[$*2],K=t[$*2+1];X===R&&K===z&&D<r;)D++,$+=o,E+=o,X=t[$*2],K=t[$*2+1],R=t[E*2],z=t[E*2+1],N=R-f,H=z-g;var et=D+1;if(u)for(;sv(X,K)&&et<r;)et++,$+=o,X=t[$*2],K=t[$*2+1];var rt=.5,lt=0,ht=0,yt=void 0,ft=void 0;if(et>=r||sv(X,K))w=R,I=z;else{lt=X-f,ht=K-g;var kt=R-f,Rt=X-R,Ct=z-g,Gt=K-z,Vt=void 0,Qt=void 0;if(a==="x"){Vt=Math.abs(kt),Qt=Math.abs(Rt);var fe=lt>0?1:-1;w=R-fe*Vt*s,I=z,yt=R+fe*Qt*s,ft=z}else if(a==="y"){Vt=Math.abs(Ct),Qt=Math.abs(Gt);var Te=ht>0?1:-1;w=R,I=z-Te*Vt*s,yt=R,ft=z+Te*Qt*s}else Vt=Math.sqrt(kt*kt+Ct*Ct),Qt=Math.sqrt(Rt*Rt+Gt*Gt),rt=Qt/(Qt+Vt),w=R-lt*s*(1-rt),I=z-ht*s*(1-rt),yt=R+lt*s*rt,ft=z+ht*s*rt,yt=jf(yt,Wf(X,R)),ft=jf(ft,Wf(K,z)),yt=Wf(yt,jf(X,R)),ft=Wf(ft,jf(K,z)),lt=yt-R,ht=ft-z,w=R-lt*Vt/Qt,I=z-ht*Vt/Qt,w=jf(w,Wf(f,R)),I=jf(I,Wf(g,z)),w=Wf(w,jf(f,R)),I=Wf(I,jf(g,z)),lt=R-w,ht=z-I,yt=R+lt*Qt/Vt,ft=z+ht*Qt/Vt}i.bezierCurveTo(v,y,w,I,R,z),v=yt,y=ft}else i.lineTo(R,z)}f=R,g=z,E+=o}return D}var jtt=function(){function i(){this.smooth=0,this.smoothConstraint=!0}return i}(),U2t=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="ec-polyline",r}return t.prototype.getDefaultStyle=function(){return{stroke:_e.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new jtt},t.prototype.buildPath=function(e,r){var n=r.points,o=0,s=n.length/2;if(r.connectNulls){for(;s>0&&sv(n[s*2-2],n[s*2-1]);s--);for(;o<s&&sv(n[o*2],n[o*2+1]);o++);}for(;o<s;)o+=Bz(e,n,o,s,s,1,r.smooth,r.smoothMonotone,r.connectNulls)+1},t.prototype.getPointOn=function(e,r){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var n=this.path,o=n.data,s=wh.CMD,a,u,f=r==="x",g=[],v=0;v<o.length;){var y=o[v++],w=void 0,I=void 0,E=void 0,D=void 0,R=void 0,z=void 0,N=void 0;switch(y){case s.M:a=o[v++],u=o[v++];break;case s.L:if(w=o[v++],I=o[v++],N=f?(e-a)/(w-a):(e-u)/(I-u),N<=1&&N>=0){var H=f?(I-u)*N+u:(w-a)*N+a;return f?[e,H]:[H,e]}a=w,u=I;break;case s.C:w=o[v++],I=o[v++],E=o[v++],D=o[v++],R=o[v++],z=o[v++];var $=f?AM(a,w,E,R,e,g):AM(u,I,D,z,e,g);if($>0)for(var X=0;X<$;X++){var K=g[X];if(K<=1&&K>=0){var H=f?Ho(u,I,D,z,K):Ho(a,w,E,R,K);return f?[e,H]:[H,e]}}a=R,u=z;break}}},t}(qr),G2t=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(jtt),Wtt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="ec-polygon",r}return t.prototype.getDefaultShape=function(){return new G2t},t.prototype.buildPath=function(e,r){var n=r.points,o=r.stackedOnPoints,s=0,a=n.length/2,u=r.smoothMonotone;if(r.connectNulls){for(;a>0&&sv(n[a*2-2],n[a*2-1]);a--);for(;s<a&&sv(n[s*2],n[s*2+1]);s++);}for(;s<a;){var f=Bz(e,n,s,a,a,1,r.smooth,u,r.connectNulls);Bz(e,o,s+f-1,f,a,-1,r.stackedOnSmooth,u,r.connectNulls),s+=f+1,e.closePath()}},t}(qr);function $tt(i,t,e,r,n){var o=i.getArea(),s=o.x,a=o.y,u=o.width,f=o.height,g=e.get(["lineStyle","width"])||0;s-=g/2,a-=g/2,u+=g,f+=g,u=Math.ceil(u),s!==Math.floor(s)&&(s=Math.floor(s),u++);var v=new jr({shape:{x:s,y:a,width:u,height:f}});if(t){var y=i.getBaseAxis(),w=y.isHorizontal(),I=y.inverse;w?(I&&(v.shape.x+=u),v.shape.width=0):(I||(v.shape.y+=f),v.shape.height=0);var E=Xi(n)?function(D){n(D,v)}:null;ya(v,{shape:{width:u,height:f,x:s,y:a}},e,null,r,E)}return v}function Ztt(i,t,e){var r=i.getArea(),n=vo(r.r0,1),o=vo(r.r,1),s=new pl({shape:{cx:vo(i.cx,1),cy:vo(i.cy,1),r0:n,r:o,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}});if(t){var a=i.getBaseAxis().dim==="angle";a?s.shape.endAngle=r.startAngle:s.shape.r=n,ya(s,{shape:{endAngle:r.endAngle,r:o}},e)}return s}function $S(i,t,e,r,n){if(i){if(i.type==="polar")return Ztt(i,t,e);if(i.type==="cartesian2d")return $tt(i,t,e,r,n)}else return null;return null}function kp(i,t){return i.type===t}function cW(i,t){if(i.length===t.length){for(var e=0;e<i.length;e++)if(i[e]!==t[e])return;return!0}}function uW(i){for(var t=1/0,e=1/0,r=-1/0,n=-1/0,o=0;o<i.length;){var s=i[o++],a=i[o++];isNaN(s)||(t=Math.min(s,t),r=Math.max(s,r)),isNaN(a)||(e=Math.min(a,e),n=Math.max(a,n))}return[[t,e],[r,n]]}function hW(i,t){var e=uW(i),r=e[0],n=e[1],o=uW(t),s=o[0],a=o[1];return Math.max(Math.abs(r[0]-s[0]),Math.abs(r[1]-s[1]),Math.abs(n[0]-a[0]),Math.abs(n[1]-a[1]))}function dW(i){return fn(i)?i:i?.5:0}function H2t(i,t,e){if(!e.valueDim)return[];for(var r=t.count(),n=ch(r*2),o=0;o<r;o++){var s=Htt(e,i,t,o);n[o*2]=s[0],n[o*2+1]=s[1]}return n}function $f(i,t,e,r,n){var o=e.getBaseAxis(),s=o.dim==="x"||o.dim==="radius"?0:1,a=[],u=0,f=[],g=[],v=[],y=[];if(n){for(u=0;u<i.length;u+=2){var w=t||i;!isNaN(w[u])&&!isNaN(w[u+1])&&y.push(i[u],i[u+1])}i=y}for(u=0;u<i.length-2;u+=2)switch(v[0]=i[u+2],v[1]=i[u+3],g[0]=i[u],g[1]=i[u+1],a.push(g[0],g[1]),r){case"end":f[s]=v[s],f[1-s]=g[1-s],a.push(f[0],f[1]);break;case"middle":var I=(g[s]+v[s])/2,E=[];f[s]=E[s]=I,f[1-s]=g[1-s],E[1-s]=v[1-s],a.push(f[0],f[1]),a.push(E[0],E[1]);break;default:f[s]=g[s],f[1-s]=v[1-s],a.push(f[0],f[1])}return a.push(i[u++],i[u++]),a}function j2t(i,t){var e=[],r=i.length,n,o;function s(g,v,y){var w=g.coord,I=(y-w)/(v.coord-w),E=L_t(I,[g.color,v.color]);return{coord:y,color:E}}for(var a=0;a<r;a++){var u=i[a],f=u.coord;if(f<0)n=u;else if(f>t){o?e.push(s(o,u,t)):n&&e.push(s(n,u,0),s(n,u,t));break}else n&&(e.push(s(n,u,0)),n=null),e.push(u),o=u}return e}function W2t(i,t,e){var r=i.getVisual("visualMeta");if(!(!r||!r.length||!i.count())&&t.type==="cartesian2d"){for(var n,o,s=r.length-1;s>=0;s--){var a=i.getDimensionInfo(r[s].dimension);if(n=a&&a.coordDim,n==="x"||n==="y"){o=r[s];break}}if(o){var u=t.getAxis(n),f=ti(o.stops,function(N){return{coord:u.toGlobalCoord(u.dataToCoord(N.value)),color:N.color}}),g=f.length,v=o.outerColors.slice();g&&f[0].coord>f[g-1].coord&&(f.reverse(),v.reverse());var y=j2t(f,n==="x"?e.getWidth():e.getHeight()),w=y.length;if(!w&&g)return f[0].coord<0?v[1]?v[1]:f[g-1].color:v[0]?v[0]:f[0].color;var I=10,E=y[0].coord-I,D=y[w-1].coord+I,R=D-E;if(R<.001)return"transparent";gt(y,function(N){N.offset=(N.coord-E)/R}),y.push({offset:w?y[w-1].offset:.5,color:v[1]||"transparent"}),y.unshift({offset:w?y[0].offset:.5,color:v[0]||"transparent"});var z=new V0(0,0,0,0,y,!0);return z[n]=E,z[n+"2"]=D,z}}}function $2t(i,t,e){var r=i.get("showAllSymbol"),n=r==="auto";if(!(r&&!n)){var o=e.getAxesByScale("ordinal")[0];if(o&&!(n&&Z2t(o,t))){var s=t.mapDimension(o.dim),a={};return gt(o.getViewLabels(),function(u){var f=o.scale.getRawOrdinalNumber(u.tickValue);a[f]=1}),function(u){return!a.hasOwnProperty(t.get(s,u))}}}}function Z2t(i,t){var e=i.getExtent(),r=Math.abs(e[1]-e[0])/i.scale.count();isNaN(r)&&(r=0);for(var n=t.count(),o=Math.max(1,Math.round(n/5)),s=0;s<n;s+=o)if(jS.getSymbolSize(t,s)[i.isHorizontal()?1:0]*1.5>r)return!1;return!0}function q2t(i,t){return isNaN(i)||isNaN(t)}function X2t(i){for(var t=i.length/2;t>0&&q2t(i[t*2-2],i[t*2-1]);t--);return t-1}function fW(i,t){return[i[t*2],i[t*2+1]]}function Y2t(i,t,e){for(var r=i.length/2,n=e==="x"?0:1,o,s,a=0,u=-1,f=0;f<r;f++)if(s=i[f*2+n],!(isNaN(s)||isNaN(i[f*2+1-n]))){if(f===0){o=s;continue}if(o<=t&&s>=t||o>=t&&s<=t){u=f;break}a=f,o=s}return{range:[a,u],t:(t-o)/(s-o)}}function qtt(i){if(i.get(["endLabel","show"]))return!0;for(var t=0;t<fl.length;t++)if(i.get([fl[t],"endLabel","show"]))return!0;return!1}function ER(i,t,e,r){if(kp(t,"cartesian2d")){var n=r.getModel("endLabel"),o=n.get("valueAnimation"),s=r.getData(),a={lastFrameIndex:0},u=qtt(r)?function(w,I){i._endLabelOnDuring(w,I,s,a,o,n,t)}:null,f=t.getBaseAxis().isHorizontal(),g=$tt(t,e,r,function(){var w=i._endLabel;w&&e&&a.originalX!=null&&w.attr({x:a.originalX,y:a.originalY})},u);if(!r.get("clip",!0)){var v=g.shape,y=Math.max(v.width,v.height);f?(v.y-=y,v.height+=y*2):(v.x-=y,v.width+=y*2)}return u&&u(1,g),g}else return Ztt(t,e,r)}function K2t(i,t){var e=t.getBaseAxis(),r=e.isHorizontal(),n=e.inverse,o=r?n?"right":"left":"center",s=r?"middle":n?"top":"bottom";return{normal:{align:i.get("align")||o,verticalAlign:i.get("verticalAlign")||s}}}var J2t=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.init=function(){var e=new Ki,r=new WS;this.group.add(r.group),this._symbolDraw=r,this._lineGroup=e,this._changePolyState=wi(this._changePolyState,this)},t.prototype.render=function(e,r,n){var o=e.coordinateSystem,s=this.group,a=e.getData(),u=e.getModel("lineStyle"),f=e.getModel("areaStyle"),g=a.getLayout("points")||[],v=o.type==="polar",y=this._coordSys,w=this._symbolDraw,I=this._polyline,E=this._polygon,D=this._lineGroup,R=!r.ssr&&e.get("animation"),z=!f.isEmpty(),N=f.get("origin"),H=Gtt(o,a,N),$=z&&H2t(o,a,H),X=e.get("showSymbol"),K=e.get("connectNulls"),et=X&&!v&&$2t(e,a,o),rt=this._data;rt&&rt.eachItemGraphicEl(function(Pi,or){Pi.__temp&&(s.remove(Pi),rt.setItemGraphicEl(or,null))}),X||w.remove(),s.add(D);var lt=v?!1:e.get("step"),ht;o&&o.getArea&&e.get("clip",!0)&&(ht=o.getArea(),ht.width!=null?(ht.x-=.1,ht.y-=.1,ht.width+=.2,ht.height+=.2):ht.r0&&(ht.r0-=.5,ht.r+=.5)),this._clipShapeForSymbol=ht;var yt=W2t(a,o,n)||a.getVisual("style")[a.getVisual("drawType")];if(!(I&&y.type===o.type&&lt===this._step))X&&w.updateData(a,{isIgnore:et,clipShape:ht,disableAnimation:!0,getSymbolPoint:function(Pi){return[g[Pi*2],g[Pi*2+1]]}}),R&&this._initSymbolLabelAnimation(a,o,ht),lt&&($&&($=$f($,g,o,lt,K)),g=$f(g,null,o,lt,K)),I=this._newPolyline(g),z?E=this._newPolygon(g,$):E&&(D.remove(E),E=this._polygon=null),v||this._initOrUpdateEndLabel(e,o,_v(yt)),D.setClipPath(ER(this,o,!0,e));else{z&&!E?E=this._newPolygon(g,$):E&&!z&&(D.remove(E),E=this._polygon=null),v||this._initOrUpdateEndLabel(e,o,_v(yt));var ft=D.getClipPath();if(ft){var kt=ER(this,o,!1,e);ya(ft,{shape:kt.shape},e)}else D.setClipPath(ER(this,o,!0,e));X&&w.updateData(a,{isIgnore:et,clipShape:ht,disableAnimation:!0,getSymbolPoint:function(Pi){return[g[Pi*2],g[Pi*2+1]]}}),(!cW(this._stackedOnPoints,$)||!cW(this._points,g))&&(R?this._doUpdateAnimation(a,$,o,n,lt,N,K):(lt&&($&&($=$f($,g,o,lt,K)),g=$f(g,null,o,lt,K)),I.setShape({points:g}),E&&E.setShape({points:g,stackedOnPoints:$})))}var Rt=e.getModel("emphasis"),Ct=Rt.get("focus"),Gt=Rt.get("blurScope"),Vt=Rt.get("disabled");if(I.useStyle(rr(u.getLineStyle(),{fill:"none",stroke:yt,lineJoin:"bevel"})),Oo(I,e,"lineStyle"),I.style.lineWidth>0&&e.get(["emphasis","lineStyle","width"])==="bolder"){var Qt=I.getState("emphasis").style;Qt.lineWidth=+I.style.lineWidth+1}ur(I).seriesIndex=e.seriesIndex,Ma(I,Ct,Gt,Vt);var fe=dW(e.get("smooth")),Te=e.get("smoothMonotone");if(I.setShape({smooth:fe,smoothMonotone:Te,connectNulls:K}),E){var be=a.getCalculationInfo("stackedOnSeries"),Ge=0;E.useStyle(rr(f.getAreaStyle(),{fill:yt,opacity:.7,lineJoin:"bevel",decal:a.getVisual("style").decal})),be&&(Ge=dW(be.get("smooth"))),E.setShape({smooth:fe,stackedOnSmooth:Ge,smoothMonotone:Te,connectNulls:K}),Oo(E,e,"areaStyle"),ur(E).seriesIndex=e.seriesIndex,Ma(E,Ct,Gt,Vt)}var li=this._changePolyState;a.eachItemGraphicEl(function(Pi){Pi&&(Pi.onHoverStateChange=li)}),this._polyline.onHoverStateChange=li,this._data=a,this._coordSys=o,this._stackedOnPoints=$,this._points=g,this._step=lt,this._valueOrigin=N,e.get("triggerLineEvent")&&(this.packEventData(e,I),E&&this.packEventData(e,E))},t.prototype.packEventData=function(e,r){ur(r).eventData={componentType:"series",componentSubType:"line",componentIndex:e.componentIndex,seriesIndex:e.seriesIndex,seriesName:e.name,seriesType:"line"}},t.prototype.highlight=function(e,r,n,o){var s=e.getData(),a=fv(s,o);if(this._changePolyState("emphasis"),!(a instanceof Array)&&a!=null&&a>=0){var u=s.getLayout("points"),f=s.getItemGraphicEl(a);if(!f){var g=u[a*2],v=u[a*2+1];if(isNaN(g)||isNaN(v)||this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(g,v))return;var y=e.get("zlevel")||0,w=e.get("z")||0;f=new jS(s,a),f.x=g,f.y=v,f.setZ(y,w);var I=f.getSymbolPath().getTextContent();I&&(I.zlevel=y,I.z=w,I.z2=this._polyline.z2+1),f.__temp=!0,s.setItemGraphicEl(a,f),f.stopSymbolAnimation(!0),this.group.add(f)}f.highlight()}else pa.prototype.highlight.call(this,e,r,n,o)},t.prototype.downplay=function(e,r,n,o){var s=e.getData(),a=fv(s,o);if(this._changePolyState("normal"),a!=null&&a>=0){var u=s.getItemGraphicEl(a);u&&(u.__temp?(s.setItemGraphicEl(a,null),this.group.remove(u)):u.downplay())}else pa.prototype.downplay.call(this,e,r,n,o)},t.prototype._changePolyState=function(e){var r=this._polygon;zM(this._polyline,e),r&&zM(r,e)},t.prototype._newPolyline=function(e){var r=this._polyline;return r&&this._lineGroup.remove(r),r=new U2t({shape:{points:e},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(r),this._polyline=r,r},t.prototype._newPolygon=function(e,r){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new Wtt({shape:{points:e,stackedOnPoints:r},segmentIgnoreThreshold:2}),this._lineGroup.add(n),this._polygon=n,n},t.prototype._initSymbolLabelAnimation=function(e,r,n){var o,s,a=r.getBaseAxis(),u=a.inverse;r.type==="cartesian2d"?(o=a.isHorizontal(),s=!1):r.type==="polar"&&(o=a.dim==="angle",s=!0);var f=e.hostModel,g=f.get("animationDuration");Xi(g)&&(g=g(null));var v=f.get("animationDelay")||0,y=Xi(v)?v(null):v;e.eachItemGraphicEl(function(w,I){var E=w;if(E){var D=[w.x,w.y],R=void 0,z=void 0,N=void 0;if(n)if(s){var H=n,$=r.pointToCoord(D);o?(R=H.startAngle,z=H.endAngle,N=-$[1]/180*Math.PI):(R=H.r0,z=H.r,N=$[0])}else{var X=n;o?(R=X.x,z=X.x+X.width,N=w.x):(R=X.y+X.height,z=X.y,N=w.y)}var K=z===R?0:(N-R)/(z-R);u&&(K=1-K);var et=Xi(v)?v(I):g*K+y,rt=E.getSymbolPath(),lt=rt.getTextContent();E.attr({scaleX:0,scaleY:0}),E.animateTo({scaleX:1,scaleY:1},{duration:200,setToFinal:!0,delay:et}),lt&&lt.animateFrom({style:{opacity:0}},{duration:300,delay:et}),rt.disableLabelAnimation=!0}})},t.prototype._initOrUpdateEndLabel=function(e,r,n){var o=e.getModel("endLabel");if(qtt(e)){var s=e.getData(),a=this._polyline,u=s.getLayout("points");if(!u){a.removeTextContent(),this._endLabel=null;return}var f=this._endLabel;f||(f=this._endLabel=new _n({z2:200}),f.ignoreClip=!0,a.setTextContent(this._endLabel),a.disableLabelAnimation=!0);var g=X2t(u);g>=0&&(qo(a,zo(e,"endLabel"),{inheritColor:n,labelFetcher:e,labelDataIndex:g,defaultText:function(v,y,w){return w!=null?Utt(s,w):I0(s,v)},enableTextSetter:!0},K2t(o,r)),a.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},t.prototype._endLabelOnDuring=function(e,r,n,o,s,a,u){var f=this._endLabel,g=this._polyline;if(f){e<1&&o.originalX==null&&(o.originalX=f.x,o.originalY=f.y);var v=n.getLayout("points"),y=n.hostModel,w=y.get("connectNulls"),I=a.get("precision"),E=a.get("distance")||0,D=u.getBaseAxis(),R=D.isHorizontal(),z=D.inverse,N=r.shape,H=z?R?N.x:N.y+N.height:R?N.x+N.width:N.y,$=(R?E:0)*(z?-1:1),X=(R?0:-E)*(z?-1:1),K=R?"x":"y",et=Y2t(v,H,K),rt=et.range,lt=rt[1]-rt[0],ht=void 0;if(lt>=1){if(lt>1&&!w){var yt=fW(v,rt[0]);f.attr({x:yt[0]+$,y:yt[1]+X}),s&&(ht=y.getRawValue(rt[0]))}else{var yt=g.getPointOn(H,K);yt&&f.attr({x:yt[0]+$,y:yt[1]+X});var ft=y.getRawValue(rt[0]),kt=y.getRawValue(rt[1]);s&&(ht=rK(n,I,ft,kt,et.t))}o.lastFrameIndex=rt[0]}else{var Rt=e===1||o.lastFrameIndex>0?rt[0]:0,yt=fW(v,Rt);s&&(ht=y.getRawValue(Rt)),f.attr({x:yt[0]+$,y:yt[1]+X})}if(s){var Ct=G0(f);typeof Ct.setLabelText=="function"&&Ct.setLabelText(ht)}}},t.prototype._doUpdateAnimation=function(e,r,n,o,s,a,u){var f=this._polyline,g=this._polygon,v=e.hostModel,y=V2t(this._data,e,this._stackedOnPoints,r,this._coordSys,n,this._valueOrigin),w=y.current,I=y.stackedOnCurrent,E=y.next,D=y.stackedOnNext;if(s&&(I=$f(y.stackedOnCurrent,y.current,n,s,u),w=$f(y.current,null,n,s,u),D=$f(y.stackedOnNext,y.next,n,s,u),E=$f(y.next,null,n,s,u)),hW(w,E)>3e3||g&&hW(I,D)>3e3){f.stopAnimation(),f.setShape({points:E}),g&&(g.stopAnimation(),g.setShape({points:E,stackedOnPoints:D}));return}f.shape.__points=y.current,f.shape.points=w;var R={shape:{points:E}};y.current!==w&&(R.shape.__points=y.next),f.stopAnimation(),yn(f,R,v),g&&(g.setShape({points:w,stackedOnPoints:I}),g.stopAnimation(),yn(g,{shape:{stackedOnPoints:D}},v),f.shape.points!==g.shape.points&&(g.shape.points=f.shape.points));for(var z=[],N=y.status,H=0;H<N.length;H++){var $=N[H].cmd;if($==="="){var X=e.getItemGraphicEl(N[H].idx1);X&&z.push({el:X,ptIdx:H})}}f.animators&&f.animators.length&&f.animators[0].during(function(){g&&g.dirtyShape();for(var K=f.shape.__points,et=0;et<z.length;et++){var rt=z[et].el,lt=z[et].ptIdx*2;rt.x=K[lt],rt.y=K[lt+1],rt.markRedraw()}})},t.prototype.remove=function(e){var r=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(o,s){o.__temp&&(r.remove(o),n.setItemGraphicEl(s,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},t.type="line",t}(pa);const Q2t=J2t;function ZS(i,t){return{seriesType:i,plan:W0(),reset:function(e){var r=e.getData(),n=e.coordinateSystem,o=e.pipelineContext,s=t||o.large;if(n){var a=ti(n.dimensions,function(w){return r.mapDimension(w)}).slice(0,2),u=a.length,f=r.getCalculationInfo("stackResultDimension");Lp(r,a[0])&&(a[0]=f),Lp(r,a[1])&&(a[1]=f);var g=r.getStore(),v=r.getDimensionIndex(a[0]),y=r.getDimensionIndex(a[1]);return u&&{progress:function(w,I){for(var E=w.end-w.start,D=s&&ch(E*u),R=[],z=[],N=w.start,H=0;N<w.end;N++){var $=void 0;if(u===1){var X=g.get(v,N);$=n.dataToPoint(X,null,z)}else R[0]=g.get(v,N),R[1]=g.get(y,N),$=n.dataToPoint(R,null,z);s?(D[H++]=$[0],D[H++]=$[1]):I.setItemLayout(N,$.slice())}s&&I.setLayout("points",D)}}}}}}var tAt={average:function(i){for(var t=0,e=0,r=0;r<i.length;r++)isNaN(i[r])||(t+=i[r],e++);return e===0?NaN:t/e},sum:function(i){for(var t=0,e=0;e<i.length;e++)t+=i[e]||0;return t},max:function(i){for(var t=-1/0,e=0;e<i.length;e++)i[e]>t&&(t=i[e]);return isFinite(t)?t:NaN},min:function(i){for(var t=1/0,e=0;e<i.length;e++)i[e]<t&&(t=i[e]);return isFinite(t)?t:NaN},nearest:function(i){return i[0]}},eAt=function(i){return Math.round(i.length/2)};function Xtt(i){return{seriesType:i,reset:function(t,e,r){var n=t.getData(),o=t.get("sampling"),s=t.coordinateSystem,a=n.count();if(a>10&&s.type==="cartesian2d"&&o){var u=s.getBaseAxis(),f=s.getOtherAxis(u),g=u.getExtent(),v=r.getDevicePixelRatio(),y=Math.abs(g[1]-g[0])*(v||1),w=Math.round(a/y);if(isFinite(w)&&w>1){o==="lttb"?t.setData(n.lttbDownSample(n.mapDimension(f.dim),1/w)):o==="minmax"&&t.setData(n.minmaxDownSample(n.mapDimension(f.dim),1/w));var I=void 0;bi(o)?I=tAt[o]:Xi(o)&&(I=o),I&&t.setData(n.downSample(n.mapDimension(f.dim),1/w,I,eAt))}}}}}function iAt(i){i.registerChartView(Q2t),i.registerSeriesModel(k2t),i.registerLayout(ZS("line",!0)),i.registerVisual({seriesType:"line",reset:function(t){var e=t.getData(),r=t.getModel("lineStyle").getLineStyle();r&&!r.stroke&&(r.stroke=e.getVisual("style").fill),e.setVisual("legendLineStyle",r)}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,Xtt("line"))}var Ytt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,r){return Hd(null,this,{useEncodeDefaulter:!0})},t.prototype.getMarkerPosition=function(e,r,n){var o=this.coordinateSystem;if(o&&o.clampData){var s=o.clampData(e),a=o.dataToPoint(s);if(n)gt(o.getAxes(),function(y,w){if(y.type==="category"&&r!=null){var I=y.getTicksCoords(),E=y.getTickModel().get("alignWithLabel"),D=s[w],R=r[w]==="x1"||r[w]==="y1";if(R&&!E&&(D+=1),I.length<2)return;if(I.length===2){a[w]=y.toGlobalCoord(y.getExtent()[R?1:0]);return}for(var z=void 0,N=void 0,H=1,$=0;$<I.length;$++){var X=I[$].coord,K=$===I.length-1?I[$-1].tickValue+H:I[$].tickValue;if(K===D){N=X;break}else if(K<D)z=X;else if(z!=null&&K>D){N=(X+z)/2;break}$===1&&(H=K-I[0].tickValue)}N==null&&(z?z&&(N=I[I.length-1].coord):N=I[0].coord),a[w]=y.toGlobalCoord(N)}});else{var u=this.getData(),f=u.getLayout("offset"),g=u.getLayout("size"),v=o.getBaseAxis().isHorizontal()?0:1;a[v]+=f+g/2}return a}return[NaN,NaN]},t.type="series.__base_bar__",t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod",defaultBarGap:"10%"},t}(Ea);Ea.registerClass(Ytt);const rC=Ytt;var rAt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(){return Hd(null,this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},t.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):!1},t.prototype.getProgressiveThreshold=function(){var e=this.get("progressiveThreshold"),r=this.get("largeThreshold");return r>e&&(e=r),e},t.prototype.brushSelector=function(e,r,n){return n.rect(r.getItemLayout(e))},t.type="series.bar",t.dependencies=["grid","polar"],t.defaultOption=jp(rC.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:_e.color.primary,borderWidth:2}},realtimeSort:!1}),t}(rC);const nAt=rAt;var aAt=function(){function i(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return i}(),oAt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="sausage",r}return t.prototype.getDefaultShape=function(){return new aAt},t.prototype.buildPath=function(e,r){var n=r.cx,o=r.cy,s=Math.max(r.r0||0,0),a=Math.max(r.r,0),u=(a-s)*.5,f=s+u,g=r.startAngle,v=r.endAngle,y=r.clockwise,w=Math.PI*2,I=y?v-g<w:g-v<w;I||(g=v-(y?w:-w));var E=Math.cos(g),D=Math.sin(g),R=Math.cos(v),z=Math.sin(v);I?(e.moveTo(E*s+n,D*s+o),e.arc(E*f+n,D*f+o,u,-Math.PI+g,g,!y)):e.moveTo(E*a+n,D*a+o),e.arc(n,o,a,g,v,!y),e.arc(R*f+n,z*f+o,u,v-Math.PI*2,v-Math.PI,!y),s!==0&&e.arc(n,o,s,v,g,y)},t}(qr);const nC=oAt;function sAt(i,t){t=t||{};var e=t.isRoundCap;return function(r,n,o){var s=n.position;if(!s||s instanceof Array)return PM(r,n,o);var a=i(s),u=n.distance!=null?n.distance:5,f=this.shape,g=f.cx,v=f.cy,y=f.r,w=f.r0,I=(y+w)/2,E=f.startAngle,D=f.endAngle,R=(E+D)/2,z=e?Math.abs(y-w)/2:0,N=Math.cos,H=Math.sin,$=g+y*N(E),X=v+y*H(E),K="left",et="top";switch(a){case"startArc":$=g+(w-u)*N(R),X=v+(w-u)*H(R),K="center",et="top";break;case"insideStartArc":$=g+(w+u)*N(R),X=v+(w+u)*H(R),K="center",et="bottom";break;case"startAngle":$=g+I*N(E)+jA(E,u+z,!1),X=v+I*H(E)+WA(E,u+z,!1),K="right",et="middle";break;case"insideStartAngle":$=g+I*N(E)+jA(E,-u+z,!1),X=v+I*H(E)+WA(E,-u+z,!1),K="left",et="middle";break;case"middle":$=g+I*N(R),X=v+I*H(R),K="center",et="middle";break;case"endArc":$=g+(y+u)*N(R),X=v+(y+u)*H(R),K="center",et="bottom";break;case"insideEndArc":$=g+(y-u)*N(R),X=v+(y-u)*H(R),K="center",et="top";break;case"endAngle":$=g+I*N(D)+jA(D,u+z,!0),X=v+I*H(D)+WA(D,u+z,!0),K="left",et="middle";break;case"insideEndAngle":$=g+I*N(D)+jA(D,-u+z,!0),X=v+I*H(D)+WA(D,-u+z,!0),K="right",et="middle";break;default:return PM(r,n,o)}return r=r||{},r.x=$,r.y=X,r.align=K,r.verticalAlign=et,r}}function lAt(i,t,e,r){if(fn(r)){i.setTextConfig({rotation:r});return}else if(Ye(t)){i.setTextConfig({rotation:0});return}var n=i.shape,o=n.clockwise?n.startAngle:n.endAngle,s=n.clockwise?n.endAngle:n.startAngle,a=(o+s)/2,u,f=e(t);switch(f){case"startArc":case"insideStartArc":case"middle":case"insideEndArc":case"endArc":u=a;break;case"startAngle":case"insideStartAngle":u=o;break;case"endAngle":case"insideEndAngle":u=s;break;default:i.setTextConfig({rotation:0});return}var g=Math.PI*1.5-u;f==="middle"&&g>Math.PI/2&&g<Math.PI*1.5&&(g-=Math.PI),i.setTextConfig({rotation:g})}function jA(i,t,e){return t*Math.sin(i)*(e?-1:1)}function WA(i,t,e){return t*Math.cos(i)*(e?1:-1)}function hh(i,t,e){var r=i.get("borderRadius");if(r==null)return e?{cornerRadius:0}:null;Ye(r)||(r=[r,r,r,r]);var n=Math.abs(t.r||0-t.r0||0);return{cornerRadius:ti(r,function(o){return vu(o,n)})}}var DR=Math.max,PR=Math.min;function cAt(i,t){var e=i.getArea&&i.getArea();if(kp(i,"cartesian2d")){var r=i.getBaseAxis();if(r.type!=="category"||!r.onBand){var n=t.getLayout("bandWidth");r.isHorizontal()?(e.x-=n,e.width+=n*2):(e.y-=n,e.height+=n*2)}}return e}var uAt=function(i){we(t,i);function t(){var e=i.call(this)||this;return e.type=t.type,e._isFirstFrame=!0,e}return t.prototype.render=function(e,r,n,o){this._model=e,this._removeOnRenderedListener(n),this._updateDrawMode(e);var s=e.get("coordinateSystem");(s==="cartesian2d"||s==="polar")&&(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(e,r,n):this._renderNormal(e,r,n,o))},t.prototype.incrementalPrepareRender=function(e){this._clear(),this._updateDrawMode(e),this._updateLargeClip(e)},t.prototype.incrementalRender=function(e,r){this._progressiveEls=[],this._incrementalRenderLarge(e,r)},t.prototype.eachRendered=function(e){Hp(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var r=e.pipelineContext.large;(this._isLargeDraw==null||r!==this._isLargeDraw)&&(this._isLargeDraw=r,this._clear())},t.prototype._renderNormal=function(e,r,n,o){var s=this.group,a=e.getData(),u=this._data,f=e.coordinateSystem,g=f.getBaseAxis(),v;f.type==="cartesian2d"?v=g.isHorizontal():f.type==="polar"&&(v=g.dim==="angle");var y=e.isAnimationEnabled()?e:null,w=hAt(e,f);w&&this._enableRealtimeSort(w,a,n);var I=e.get("clip",!0)||w,E=cAt(f,a);s.removeClipPath();var D=e.get("roundCap",!0),R=e.get("showBackground",!0),z=e.getModel("backgroundStyle"),N=z.get("borderRadius")||0,H=[],$=this._backgroundEls,X=o&&o.isInitSort,K=o&&o.type==="changeAxisOrder";function et(ht){var yt=$A[f.type](a,ht);if(!yt)return null;var ft=_At(f,v,yt);return ft.useStyle(z.getItemStyle()),f.type==="cartesian2d"?ft.setShape("r",N):ft.setShape("cornerRadius",N),H[ht]=ft,ft}a.diff(u).add(function(ht){var yt=a.getItemModel(ht),ft=$A[f.type](a,ht,yt);if(ft&&(R&&et(ht),!(!a.hasValue(ht)||!_W[f.type](ft)))){var kt=!1;I&&(kt=pW[f.type](E,ft));var Rt=gW[f.type](e,a,ht,ft,v,y,g.model,!1,D);w&&(Rt.forceLabelAnimation=!0),yW(Rt,a,ht,yt,ft,e,v,f.type==="polar"),X?Rt.attr({shape:ft}):w?mW(w,y,Rt,ft,ht,v,!1,!1):ya(Rt,{shape:ft},e,ht),a.setItemGraphicEl(ht,Rt),s.add(Rt),Rt.ignore=kt}}).update(function(ht,yt){var ft=a.getItemModel(ht),kt=$A[f.type](a,ht,ft);if(kt){if(R){var Rt=void 0;$.length===0?Rt=et(yt):(Rt=$[yt],Rt.useStyle(z.getItemStyle()),f.type==="cartesian2d"?Rt.setShape("r",N):Rt.setShape("cornerRadius",N),H[ht]=Rt);var Ct=$A[f.type](a,ht),Gt=Jtt(v,Ct,f);yn(Rt,{shape:Gt},y,ht)}var Vt=u.getItemGraphicEl(yt);if(!a.hasValue(ht)||!_W[f.type](kt)){s.remove(Vt);return}var Qt=!1;I&&(Qt=pW[f.type](E,kt),Qt&&s.remove(Vt));var fe=Vt&&(Vt.type==="sector"&&D||Vt.type==="sausage"&&!D);if(fe&&(Vt&&Td(Vt,e,yt),Vt=null),Vt?Oc(Vt):Vt=gW[f.type](e,a,ht,kt,v,y,g.model,!0,D),w&&(Vt.forceLabelAnimation=!0),K){var Te=Vt.getTextContent();if(Te){var be=G0(Te);be.prevValue!=null&&(be.prevValue=be.value)}}else yW(Vt,a,ht,ft,kt,e,v,f.type==="polar");X?Vt.attr({shape:kt}):w?mW(w,y,Vt,kt,ht,v,!0,K):yn(Vt,{shape:kt},e,ht,null),a.setItemGraphicEl(ht,Vt),Vt.ignore=Qt,s.add(Vt)}}).remove(function(ht){var yt=u.getItemGraphicEl(ht);yt&&Td(yt,e,ht)}).execute();var rt=this._backgroundGroup||(this._backgroundGroup=new Ki);rt.removeAll();for(var lt=0;lt<H.length;++lt)rt.add(H[lt]);s.add(rt),this._backgroundEls=H,this._data=a},t.prototype._renderLarge=function(e,r,n){this._clear(),bW(e,this.group),this._updateLargeClip(e)},t.prototype._incrementalRenderLarge=function(e,r){this._removeBackground(),bW(r,this.group,this._progressiveEls,!0)},t.prototype._updateLargeClip=function(e){var r=e.get("clip",!0)&&$S(e.coordinateSystem,!1,e),n=this.group;r?n.setClipPath(r):n.removeClipPath()},t.prototype._enableRealtimeSort=function(e,r,n){var o=this;if(r.count()){var s=e.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(r,e,n),this._isFirstFrame=!1;else{var a=function(u){var f=r.getItemGraphicEl(u),g=f&&f.shape;return g&&Math.abs(s.isHorizontal()?g.height:g.width)||0};this._onRendered=function(){o._updateSortWithinSameData(r,a,s,n)},n.getZr().on("rendered",this._onRendered)}}},t.prototype._dataSort=function(e,r,n){var o=[];return e.each(e.mapDimension(r.dim),function(s,a){var u=n(a);u=u??NaN,o.push({dataIndex:a,mappedValue:u,ordinalNumber:s})}),o.sort(function(s,a){return a.mappedValue-s.mappedValue}),{ordinalNumbers:ti(o,function(s){return s.ordinalNumber})}},t.prototype._isOrderChangedWithinSameData=function(e,r,n){for(var o=n.scale,s=e.mapDimension(n.dim),a=Number.MAX_VALUE,u=0,f=o.getOrdinalMeta().categories.length;u<f;++u){var g=e.rawIndexOf(s,o.getRawOrdinalNumber(u)),v=g<0?Number.MIN_VALUE:r(e.indexOfRawIndex(g));if(v>a)return!0;a=v}return!1},t.prototype._isOrderDifferentInView=function(e,r){for(var n=r.scale,o=n.getExtent(),s=Math.max(0,o[0]),a=Math.min(o[1],n.getOrdinalMeta().categories.length-1);s<=a;++s)if(e.ordinalNumbers[s]!==n.getRawOrdinalNumber(s))return!0},t.prototype._updateSortWithinSameData=function(e,r,n,o){if(this._isOrderChangedWithinSameData(e,r,n)){var s=this._dataSort(e,n,r);this._isOrderDifferentInView(s,n)&&(this._removeOnRenderedListener(o),o.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:s}))}},t.prototype._dispatchInitSort=function(e,r,n){var o=r.baseAxis,s=this._dataSort(e,o,function(a){return e.get(e.mapDimension(r.otherAxis.dim),a)});n.dispatchAction({type:"changeAxisOrder",componentType:o.dim+"Axis",isInitSort:!0,axisId:o.index,sortInfo:s})},t.prototype.remove=function(e,r){this._clear(this._model),this._removeOnRenderedListener(r)},t.prototype.dispose=function(e,r){this._removeOnRenderedListener(r)},t.prototype._removeOnRenderedListener=function(e){this._onRendered&&(e.getZr().off("rendered",this._onRendered),this._onRendered=null)},t.prototype._clear=function(e){var r=this.group,n=this._data;e&&e.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl(function(o){Td(o,e,ur(o).dataIndex)})):r.removeAll(),this._data=null,this._isFirstFrame=!0},t.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},t.type="bar",t}(pa),pW={cartesian2d:function(i,t){var e=t.width<0?-1:1,r=t.height<0?-1:1;e<0&&(t.x+=t.width,t.width=-t.width),r<0&&(t.y+=t.height,t.height=-t.height);var n=i.x+i.width,o=i.y+i.height,s=DR(t.x,i.x),a=PR(t.x+t.width,n),u=DR(t.y,i.y),f=PR(t.y+t.height,o),g=a<s,v=f<u;return t.x=g&&s>n?a:s,t.y=v&&u>o?f:u,t.width=g?0:a-s,t.height=v?0:f-u,e<0&&(t.x+=t.width,t.width=-t.width),r<0&&(t.y+=t.height,t.height=-t.height),g||v},polar:function(i,t){var e=t.r0<=t.r?1:-1;if(e<0){var r=t.r;t.r=t.r0,t.r0=r}var n=PR(t.r,i.r),o=DR(t.r0,i.r0);t.r=n,t.r0=o;var s=n-o<0;if(e<0){var r=t.r;t.r=t.r0,t.r0=r}return s}},gW={cartesian2d:function(i,t,e,r,n,o,s,a,u){var f=new jr({shape:Fe({},r),z2:1});if(f.__dataIndex=e,f.name="item",o){var g=f.shape,v=n?"height":"width";g[v]=0}return f},polar:function(i,t,e,r,n,o,s,a,u){var f=!n&&u?nC:pl,g=new f({shape:r,z2:1});g.name="item";var v=Ktt(n);if(g.calculateTextPosition=sAt(v,{isRoundCap:f===nC}),o){var y=g.shape,w=n?"r":"endAngle",I={};y[w]=n?r.r0:r.startAngle,I[w]=r[w],(a?yn:ya)(g,{shape:I},o)}return g}};function hAt(i,t){var e=i.get("realtimeSort",!0),r=t.getBaseAxis();if(e&&r.type==="category"&&t.type==="cartesian2d")return{baseAxis:r,otherAxis:t.getOtherAxis(r)}}function mW(i,t,e,r,n,o,s,a){var u,f;o?(f={x:r.x,width:r.width},u={y:r.y,height:r.height}):(f={y:r.y,height:r.height},u={x:r.x,width:r.width}),a||(s?yn:ya)(e,{shape:u},t,n,null);var g=t?i.baseAxis.model:null;(s?yn:ya)(e,{shape:f},g,n)}function vW(i,t){for(var e=0;e<t.length;e++)if(!isFinite(i[t[e]]))return!0;return!1}var dAt=["x","y","width","height"],fAt=["cx","cy","r","startAngle","endAngle"],_W={cartesian2d:function(i){return!vW(i,dAt)},polar:function(i){return!vW(i,fAt)}},$A={cartesian2d:function(i,t,e){var r=i.getItemLayout(t);if(!r)return null;var n=e?gAt(e,r):0,o=r.width>0?1:-1,s=r.height>0?1:-1;return{x:r.x+o*n/2,y:r.y+s*n/2,width:r.width-o*n,height:r.height-s*n}},polar:function(i,t,e){var r=i.getItemLayout(t);return{cx:r.cx,cy:r.cy,r0:r.r0,r:r.r,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}}};function pAt(i){return i.startAngle!=null&&i.endAngle!=null&&i.startAngle===i.endAngle}function Ktt(i){return function(t){var e=t?"Arc":"Angle";return function(r){switch(r){case"start":case"insideStart":case"end":case"insideEnd":return r+e;default:return r}}}(i)}function yW(i,t,e,r,n,o,s,a){var u=t.getItemVisual(e,"style");if(a){if(!o.get("roundCap")){var g=i.shape,v=hh(r.getModel("itemStyle"),g,!0);Fe(g,v),i.setShape(g)}}else{var f=r.get(["itemStyle","borderRadius"])||0;i.setShape("r",f)}i.useStyle(u);var y=r.getShallow("cursor");y&&i.attr("cursor",y);var w=a?s?n.r>=n.r0?"endArc":"startArc":n.endAngle>=n.startAngle?"endAngle":"startAngle":s?n.height>=0?"bottom":"top":n.width>=0?"right":"left",I=zo(r);qo(i,I,{labelFetcher:o,labelDataIndex:e,defaultText:I0(o.getData(),e),inheritColor:u.fill,defaultOpacity:u.opacity,defaultOutsidePosition:w});var E=i.getTextContent();if(a&&E){var D=r.get(["label","position"]);i.textConfig.inside=D==="middle"?!0:null,lAt(i,D==="outside"?w:D,Ktt(s),r.get(["label","rotate"]))}iJ(E,I,o.getRawValue(e),function(z){return Utt(t,z)});var R=r.getModel(["emphasis"]);Ma(i,R.get("focus"),R.get("blurScope"),R.get("disabled")),Oo(i,r),pAt(n)&&(i.style.fill="none",i.style.stroke="none",gt(i.states,function(z){z.style&&(z.style.fill=z.style.stroke="none")}))}function gAt(i,t){var e=i.get(["itemStyle","borderColor"]);if(!e||e==="none")return 0;var r=i.get(["itemStyle","borderWidth"])||0,n=isNaN(t.width)?Number.MAX_VALUE:Math.abs(t.width),o=isNaN(t.height)?Number.MAX_VALUE:Math.abs(t.height);return Math.min(r,n,o)}var mAt=function(){function i(){}return i}(),xW=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="largeBar",r}return t.prototype.getDefaultShape=function(){return new mAt},t.prototype.buildPath=function(e,r){for(var n=r.points,o=this.baseDimIdx,s=1-this.baseDimIdx,a=[],u=[],f=this.barWidth,g=0;g<n.length;g+=3)u[o]=f,u[s]=n[g+2],a[o]=n[g+o],a[s]=n[g+s],e.rect(a[0],a[1],u[0],u[1])},t}(qr);function bW(i,t,e,r){var n=i.getData(),o=n.getLayout("valueAxisHorizontal")?1:0,s=n.getLayout("largeDataIndices"),a=n.getLayout("size"),u=i.getModel("backgroundStyle"),f=n.getLayout("largeBackgroundPoints");if(f){var g=new xW({shape:{points:f},incremental:!!r,silent:!0,z2:0});g.baseDimIdx=o,g.largeDataIndices=s,g.barWidth=a,g.useStyle(u.getItemStyle()),t.add(g),e&&e.push(g)}var v=new xW({shape:{points:n.getLayout("largePoints")},incremental:!!r,ignoreCoarsePointer:!0,z2:1});v.baseDimIdx=o,v.largeDataIndices=s,v.barWidth=a,t.add(v),v.useStyle(n.getVisual("style")),v.style.stroke=null,ur(v).seriesIndex=i.seriesIndex,i.get("silent")||(v.on("mousedown",wW),v.on("mousemove",wW)),e&&e.push(v)}var wW=d3(function(i){var t=this,e=vAt(t,i.offsetX,i.offsetY);ur(t).dataIndex=e>=0?e:null},30,!1);function vAt(i,t,e){for(var r=i.baseDimIdx,n=1-r,o=i.shape.points,s=i.largeDataIndices,a=[],u=[],f=i.barWidth,g=0,v=o.length/3;g<v;g++){var y=g*3;if(u[r]=f,u[n]=o[y+2],a[r]=o[y+r],a[n]=o[y+n],u[n]<0&&(a[n]+=u[n],u[n]=-u[n]),t>=a[0]&&t<=a[0]+u[0]&&e>=a[1]&&e<=a[1]+u[1])return s[g]}return-1}function Jtt(i,t,e){if(kp(e,"cartesian2d")){var r=t,n=e.getArea();return{x:i?r.x:n.x,y:i?n.y:r.y,width:i?r.width:n.width,height:i?n.height:r.height}}else{var n=e.getArea(),o=t;return{cx:n.cx,cy:n.cy,r0:i?n.r0:o.r0,r:i?n.r:o.r,startAngle:i?o.startAngle:0,endAngle:i?o.endAngle:Math.PI*2}}}function _At(i,t,e){var r=i.type==="polar"?pl:jr;return new r({shape:Jtt(t,e,i),silent:!0,z2:0})}const yAt=uAt;function xAt(i){i.registerChartView(yAt),i.registerSeriesModel(nAt),i.registerLayout(i.PRIORITY.VISUAL.LAYOUT,br(JQ,"bar")),i.registerLayout(i.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,QQ("bar")),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,Xtt("bar")),i.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(t,e){var r=t.componentType||"series";e.eachComponent({mainType:r,query:t},function(n){t.sortInfo&&n.axis.setCategorySortInfo(t.sortInfo)})})}var SW=Math.PI*2,ZA=Math.PI/180;function bAt(i,t,e){t.eachSeriesByType(i,function(r){var n=r.getData(),o=n.mapDimension("value"),s=SJ(r,e),a=s.cx,u=s.cy,f=s.r,g=s.r0,v=s.viewRect,y=-r.get("startAngle")*ZA,w=r.get("endAngle"),I=r.get("padAngle")*ZA;w=w==="auto"?y-SW:-w*ZA;var E=r.get("minAngle")*ZA,D=E+I,R=0;n.each(o,function(Gt){!isNaN(Gt)&&R++});var z=n.getSum(o),N=Math.PI/(z||R)*2,H=r.get("clockwise"),$=r.get("roseType"),X=r.get("stillShowZeroSum"),K=n.getDataExtent(o);K[0]=0;var et=H?1:-1,rt=[y,w],lt=et*I/2;oE(rt,!H),y=rt[0],w=rt[1];var ht=Qtt(r);ht.startAngle=y,ht.endAngle=w,ht.clockwise=H,ht.cx=a,ht.cy=u,ht.r=f,ht.r0=g;var yt=Math.abs(w-y),ft=yt,kt=0,Rt=y;if(n.setLayout({viewRect:v,r:f}),n.each(o,function(Gt,Vt){var Qt;if(isNaN(Gt)){n.setItemLayout(Vt,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:H,cx:a,cy:u,r0:g,r:$?NaN:f});return}$!=="area"?Qt=z===0&&X?N:Gt*N:Qt=yt/R,Qt<D?(Qt=D,ft-=D):kt+=Gt;var fe=Rt+et*Qt,Te=0,be=0;I>Qt?(Te=Rt+et*Qt/2,be=Te):(Te=Rt+lt,be=fe-lt),n.setItemLayout(Vt,{angle:Qt,startAngle:Te,endAngle:be,clockwise:H,cx:a,cy:u,r0:g,r:$?Ln(Gt,K,[g,f]):f}),Rt=fe}),ft<SW&&R)if(ft<=.001){var Ct=yt/R;n.each(o,function(Gt,Vt){if(!isNaN(Gt)){var Qt=n.getItemLayout(Vt);Qt.angle=Ct;var fe=0,Te=0;Ct<I?(fe=y+et*(Vt+1/2)*Ct,Te=fe):(fe=y+et*Vt*Ct+lt,Te=y+et*(Vt+1)*Ct-lt),Qt.startAngle=fe,Qt.endAngle=Te}})}else N=ft/kt,Rt=y,n.each(o,function(Gt,Vt){if(!isNaN(Gt)){var Qt=n.getItemLayout(Vt),fe=Qt.angle===D?D:Gt*N,Te=0,be=0;fe<I?(Te=Rt+et*fe/2,be=Te):(Te=Rt+lt,be=Rt+et*fe-lt),Qt.startAngle=Te,Qt.endAngle=be,Rt+=et*fe}})})}var Qtt=Wr();function X0(i){return{seriesType:i,reset:function(t,e){var r=e.findComponents({mainType:"legend"});if(!(!r||!r.length)){var n=t.getData();n.filterSelf(function(o){for(var s=n.getName(o),a=0;a<r.length;a++)if(!r[a].isSelected(s))return!1;return!0})}}}}var wAt=Math.PI/180;function TW(i,t,e,r,n,o,s,a,u,f){if(i.length<2)return;function g(E){for(var D=E.rB,R=D*D,z=0;z<E.list.length;z++){var N=E.list[z],H=Math.abs(N.label.y-e),$=r+N.len,X=$*$,K=Math.sqrt(Math.abs((1-H*H/R)*X)),et=t+(K+N.len2)*n,rt=et-N.label.x,lt=N.targetTextWidth-rt*n;tet(N,lt,!0),N.label.x=et}}function v(E){for(var D={list:[],maxY:0},R={list:[],maxY:0},z=0;z<E.length;z++)if(E[z].labelAlignTo==="none"){var N=E[z],H=N.label.y>e?R:D,$=Math.abs(N.label.y-e);if($>=H.maxY){var X=N.label.x-t-N.len2*n,K=r+N.len,et=Math.abs(X)<K?Math.sqrt($*$/(1-X*X/K/K)):K;H.rB=et,H.maxY=$}H.list.push(N)}g(D),g(R)}for(var y=i.length,w=0;w<y;w++)if(i[w].position==="outer"&&i[w].labelAlignTo==="labelLine"){var I=i[w].label.x-f;i[w].linePoints[1][0]+=I,i[w].label.x=f}Rz(i,1,u,u+s)&&v(i)}function SAt(i,t,e,r,n,o,s,a){for(var u=[],f=[],g=Number.MAX_VALUE,v=-Number.MAX_VALUE,y=0;y<i.length;y++){var w=i[y].label;LR(i[y])||(w.x<t?(g=Math.min(g,w.x),u.push(i[y])):(v=Math.max(v,w.x),f.push(i[y])))}for(var y=0;y<i.length;y++){var I=i[y];if(!LR(I)&&I.linePoints){if(I.labelStyleWidth!=null)continue;var w=I.label,E=I.linePoints,D=void 0;I.labelAlignTo==="edge"?w.x<t?D=E[2][0]-I.labelDistance-s-I.edgeDistance:D=s+n-I.edgeDistance-E[2][0]-I.labelDistance:I.labelAlignTo==="labelLine"?w.x<t?D=g-s-I.bleedMargin:D=s+n-v-I.bleedMargin:w.x<t?D=w.x-s-I.bleedMargin:D=s+n-w.x-I.bleedMargin,I.targetTextWidth=D,tet(I,D,!1)}}TW(f,t,e,r,1,n,o,s,a,v),TW(u,t,e,r,-1,n,o,s,a,g);for(var y=0;y<i.length;y++){var I=i[y];if(!LR(I)&&I.linePoints){var w=I.label,E=I.linePoints,R=I.labelAlignTo==="edge",z=w.style.padding,N=z?z[1]+z[3]:0,H=w.style.backgroundColor?0:N,$=I.rect.width+H,X=E[1][0]-E[2][0];R?w.x<t?E[2][0]=s+I.edgeDistance+$+I.labelDistance:E[2][0]=s+n-I.edgeDistance-$-I.labelDistance:(w.x<t?E[2][0]=w.x+I.labelDistance:E[2][0]=w.x-I.labelDistance,E[1][0]=E[2][0]+X),E[1][1]=E[2][1]=w.y}}}function tet(i,t,e){if(i.labelStyleWidth==null){var r=i.label,n=r.style,o=i.rect,s=n.backgroundColor,a=n.padding,u=a?a[1]+a[3]:0,f=n.overflow,g=o.width+(s?0:u);if(t<g||e){if(f&&f.match("break")){r.setStyle("backgroundColor",null),r.setStyle("width",t-u);var v=r.getBoundingRect();r.setStyle("width",Math.ceil(v.width)),r.setStyle("backgroundColor",s)}else{var y=t-u,w=t<g?y:e?y>i.unconstrainedWidth?null:y:null;r.setStyle("width",w)}eet(o,r)}}}function eet(i,t){AW.rect=i,Ttt(AW,t,TAt)}var TAt={minMarginForce:[null,0,null,0],marginDefault:[1,0,1,0]},AW={};function LR(i){return i.position==="center"}function AAt(i){var t=i.getData(),e=[],r,n,o=!1,s=(i.get("minShowLabelAngle")||0)*wAt,a=t.getLayout("viewRect"),u=t.getLayout("r"),f=a.width,g=a.x,v=a.y,y=a.height;function w(X){X.ignore=!0}function I(X){if(!X.ignore)return!0;for(var K in X.states)if(X.states[K].ignore===!1)return!0;return!1}t.each(function(X){var K=t.getItemGraphicEl(X),et=K.shape,rt=K.getTextContent(),lt=K.getTextGuideLine(),ht=t.getItemModel(X),yt=ht.getModel("label"),ft=yt.get("position")||ht.get(["emphasis","label","position"]),kt=yt.get("distanceToLabelLine"),Rt=yt.get("alignTo"),Ct=xi(yt.get("edgeDistance"),f),Gt=yt.get("bleedMargin");Gt==null&&(Gt=Math.min(f,y)>200?10:2);var Vt=ht.getModel("labelLine"),Qt=Vt.get("length");Qt=xi(Qt,f);var fe=Vt.get("length2");if(fe=xi(fe,f),Math.abs(et.endAngle-et.startAngle)<s){gt(rt.states,w),rt.ignore=!0,lt&&(gt(lt.states,w),lt.ignore=!0);return}if(I(rt)){var Te=(et.startAngle+et.endAngle)/2,be=Math.cos(Te),Ge=Math.sin(Te),li,Pi,or,Ve;r=et.cx,n=et.cy;var Ze=ft==="inside"||ft==="inner";if(ft==="center")li=et.cx,Pi=et.cy,Ve="center";else{var ye=(Ze?(et.r+et.r0)/2*be:et.r*be)+r,Ke=(Ze?(et.r+et.r0)/2*Ge:et.r*Ge)+n;if(li=ye+be*3,Pi=Ke+Ge*3,!Ze){var We=ye+be*(Qt+u-et.r),Si=Ke+Ge*(Qt+u-et.r),zt=We+(be<0?-1:1)*fe,Zt=Si;Rt==="edge"?li=be<0?g+Ct:g+f-Ct:li=zt+(be<0?-kt:kt),Pi=Zt,or=[[ye,Ke],[We,Si],[zt,Zt]]}Ve=Ze?"center":Rt==="edge"?be>0?"right":"left":be>0?"left":"right"}var pe=Math.PI,$e=0,He=yt.get("rotate");if(fn(He))$e=He*(pe/180);else if(ft==="center")$e=0;else if(He==="radial"||He===!0){var qe=be<0?-Te+pe:-Te;$e=qe}else if(He==="tangential"&&ft!=="outside"&&ft!=="outer"){var Ti=Math.atan2(be,Ge);Ti<0&&(Ti=pe*2+Ti);var Ai=Ge>0;Ai&&(Ti=pe+Ti),$e=Ti-pe}if(o=!!$e,rt.x=li,rt.y=Pi,rt.rotation=$e,rt.setStyle({verticalAlign:"middle"}),Ze){rt.setStyle({align:Ve});var pi=rt.states.select;pi&&(pi.x+=rt.x,pi.y+=rt.y)}else{var _i=new sr(0,0,0,0);eet(_i,rt),e.push({label:rt,labelLine:lt,position:ft,len:Qt,len2:fe,minTurnAngle:Vt.get("minTurnAngle"),maxSurfaceAngle:Vt.get("maxSurfaceAngle"),surfaceNormal:new er(be,Ge),linePoints:or,textAlign:Ve,labelDistance:kt,labelAlignTo:Rt,edgeDistance:Ct,bleedMargin:Gt,rect:_i,unconstrainedWidth:_i.width,labelStyleWidth:rt.style.width})}K.setTextConfig({inside:Ze})}}),!o&&i.get("avoidLabelOverlap")&&SAt(e,r,n,u,f,y,g,v);for(var E=0;E<e.length;E++){var D=e[E],R=D.label,z=D.labelLine,N=isNaN(R.x)||isNaN(R.y);if(R){R.setStyle({align:D.textAlign}),N&&(gt(R.states,w),R.ignore=!0);var H=R.states.select;H&&(H.x+=R.x,H.y+=R.y)}if(z){var $=D.linePoints;N||!$?(gt(z.states,w),z.ignore=!0):(btt($,D.minTurnAngle),RTt($,D.surfaceNormal,D.maxSurfaceAngle),z.setShape({points:$}),R.__hostTarget.textGuideLineConfig={anchor:new er($[0][0],$[0][1])})}}}var IAt=function(i){we(t,i);function t(e,r,n){var o=i.call(this)||this;o.z2=2;var s=new _n;return o.setTextContent(s),o.updateData(e,r,n,!0),o}return t.prototype.updateData=function(e,r,n,o){var s=this,a=e.hostModel,u=e.getItemModel(r),f=u.getModel("emphasis"),g=e.getItemLayout(r),v=Fe(hh(u.getModel("itemStyle"),g,!0),g);if(isNaN(v.startAngle)){s.setShape(v);return}if(o){s.setShape(v);var y=a.getShallow("animationType");a.ecModel.ssr?(ya(s,{scaleX:0,scaleY:0},a,{dataIndex:r,isFrom:!0}),s.originX=v.cx,s.originY=v.cy):y==="scale"?(s.shape.r=g.r0,ya(s,{shape:{r:g.r}},a,r)):n!=null?(s.setShape({startAngle:n,endAngle:n}),ya(s,{shape:{startAngle:g.startAngle,endAngle:g.endAngle}},a,r)):(s.shape.endAngle=g.startAngle,yn(s,{shape:{endAngle:g.endAngle}},a,r))}else Oc(s),yn(s,{shape:v},a,r);s.useStyle(e.getItemVisual(r,"style")),Oo(s,u);var w=(g.startAngle+g.endAngle)/2,I=a.get("selectedOffset"),E=Math.cos(w)*I,D=Math.sin(w)*I,R=u.getShallow("cursor");R&&s.attr("cursor",R),this._updateLabel(a,e,r),s.ensureState("emphasis").shape=Fe({r:g.r+(f.get("scale")&&f.get("scaleSize")||0)},hh(f.getModel("itemStyle"),g)),Fe(s.ensureState("select"),{x:E,y:D,shape:hh(u.getModel(["select","itemStyle"]),g)}),Fe(s.ensureState("blur"),{shape:hh(u.getModel(["blur","itemStyle"]),g)});var z=s.getTextGuideLine(),N=s.getTextContent();z&&Fe(z.ensureState("select"),{x:E,y:D}),Fe(N.ensureState("select"),{x:E,y:D}),Ma(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},t.prototype._updateLabel=function(e,r,n){var o=this,s=r.getItemModel(n),a=s.getModel("labelLine"),u=r.getItemVisual(n,"style"),f=u&&u.fill,g=u&&u.opacity;qo(o,zo(s),{labelFetcher:r.hostModel,labelDataIndex:n,inheritColor:f,defaultOpacity:g,defaultText:e.getFormattedLabel(n,"normal")||r.getName(n)});var v=o.getTextContent();o.setTextConfig({position:null,rotation:null}),v.attr({z2:10});var y=s.get(["label","position"]);if(y!=="outside"&&y!=="outer")o.removeTextGuideLine();else{var w=this.getTextGuideLine();w||(w=new Us,this.setTextGuideLine(w)),T3(this,A3(s),{stroke:f,opacity:ic(a.get(["lineStyle","opacity"]),g,1)})}},t}(pl),MAt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.ignoreLabelLineUpdate=!0,e}return t.prototype.render=function(e,r,n,o){var s=e.getData(),a=this._data,u=this.group,f;if(!a&&s.count()>0){for(var g=s.getItemLayout(0),v=1;isNaN(g&&g.startAngle)&&v<s.count();++v)g=s.getItemLayout(v);g&&(f=g.startAngle)}if(this._emptyCircleSector&&u.remove(this._emptyCircleSector),s.count()===0&&e.get("showEmptyCircle")){var y=Qtt(e),w=new pl({shape:Yi(y)});w.useStyle(e.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=w,u.add(w)}s.diff(a).add(function(I){var E=new IAt(s,I,f);s.setItemGraphicEl(I,E),u.add(E)}).update(function(I,E){var D=a.getItemGraphicEl(E);D.updateData(s,I,f),D.off("click"),u.add(D),s.setItemGraphicEl(I,D)}).remove(function(I){var E=a.getItemGraphicEl(I);Td(E,e,I)}).execute(),AAt(e),e.get("animationTypeUpdate")!=="expansion"&&(this._data=s)},t.prototype.dispose=function(){},t.prototype.containPoint=function(e,r){var n=r.getData(),o=n.getItemLayout(0);if(o){var s=e[0]-o.cx,a=e[1]-o.cy,u=Math.sqrt(s*s+a*a);return u<=o.r&&u>=o.r0}},t.type="pie",t}(pa);const CAt=MAt;function Y0(i,t,e){t=Ye(t)&&{coordDimensions:t}||Fe({encodeDefine:i.getEncode()},t);var r=i.getSource(),n=GS(r,t).dimensions,o=new dl(n,i);return o.initData(r,e),o}var EAt=function(){function i(t,e){this._getDataWithEncodedVisual=t,this._getRawData=e}return i.prototype.getAllNames=function(){var t=this._getRawData();return t.mapArray(t.getName)},i.prototype.containName=function(t){var e=this._getRawData();return e.indexOfName(t)>=0},i.prototype.indexOfName=function(t){var e=this._getDataWithEncodedVisual();return e.indexOfName(t)},i.prototype.getItemVisual=function(t,e){var r=this._getDataWithEncodedVisual();return r.getItemVisual(t,e)},i}();const K0=EAt;var DAt=Wr(),iet=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new K0(wi(this.getData,this),wi(this.getRawData,this)),this._defaultLabelLine(e)},t.prototype.mergeOption=function(){i.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return Y0(this,{coordDimensions:["value"],encodeDefaulter:br(r3,this)})},t.prototype.getDataParams=function(e){var r=this.getData(),n=DAt(r),o=n.seats;if(!o){var s=[];r.each(r.mapDimension("value"),function(u){s.push(u)}),o=n.seats=yyt(s,r.hostModel.get("percentPrecision"))}var a=i.prototype.getDataParams.call(this,e);return a.percent=o[e]||0,a.$vars.push("percent"),a},t.prototype._defaultLabelLine=function(e){dv(e,"labelLine",["show"]);var r=e.labelLine,n=e.emphasis.labelLine;r.show=r.show&&e.label.show,n.show=n.show&&e.emphasis.label.show},t.type="series.pie",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"50%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,coordinateSystemUsage:"box",left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:30,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(Ea);g1t({fullType:iet.type,getCoord2:function(i){return i.getShallow("center")}});const PAt=iet;function LAt(i){return{seriesType:i,reset:function(t,e){var r=t.getData();r.filterSelf(function(n){var o=r.mapDimension("value"),s=r.get(o,n);return!(fn(s)&&!isNaN(s)&&s<0)})}}}function RAt(i){i.registerChartView(CAt),i.registerSeriesModel(PAt),mQ("pie",i.registerAction),i.registerLayout(br(bAt,"pie")),i.registerProcessor(X0("pie")),i.registerProcessor(LAt("pie"))}var kAt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e,r){return Hd(null,this,{useEncodeDefaulter:!0})},t.prototype.getProgressive=function(){var e=this.option.progressive;return e??(this.option.large?5e3:this.get("progressive"))},t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;return e??(this.option.large?1e4:this.get("progressiveThreshold"))},t.prototype.brushSelector=function(e,r,n){return n.point(r.getItemLayout(e))},t.prototype.getZLevelKey=function(){return this.getData().count()>this.getProgressiveThreshold()?this.id:""},t.type="series.scatter",t.dependencies=["grid","polar","geo","singleAxis","calendar","matrix"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:_e.color.primary}},universalTransition:{divideShape:"clone"}},t}(Ea);const OAt=kAt;var ret=4,zAt=function(){function i(){}return i}(),BAt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r._off=0,r.hoverDataIdx=-1,r}return t.prototype.getDefaultShape=function(){return new zAt},t.prototype.reset=function(){this.notClear=!1,this._off=0},t.prototype.buildPath=function(e,r){var n=r.points,o=r.size,s=this.symbolProxy,a=s.shape,u=e.getContext?e.getContext():e,f=u&&o[0]<ret,g=this.softClipShape,v;if(f){this._ctx=u;return}for(this._ctx=null,v=this._off;v<n.length;){var y=n[v++],w=n[v++];isNaN(y)||isNaN(w)||g&&!g.contain(y,w)||(a.x=y-o[0]/2,a.y=w-o[1]/2,a.width=o[0],a.height=o[1],s.buildPath(e,a,!0))}this.incremental&&(this._off=v,this.notClear=!0)},t.prototype.afterBrush=function(){var e=this.shape,r=e.points,n=e.size,o=this._ctx,s=this.softClipShape,a;if(o){for(a=this._off;a<r.length;){var u=r[a++],f=r[a++];isNaN(u)||isNaN(f)||s&&!s.contain(u,f)||o.fillRect(u-n[0]/2,f-n[1]/2,n[0],n[1])}this.incremental&&(this._off=a,this.notClear=!0)}},t.prototype.findDataIndex=function(e,r){for(var n=this.shape,o=n.points,s=n.size,a=Math.max(s[0],4),u=Math.max(s[1],4),f=o.length/2-1;f>=0;f--){var g=f*2,v=o[g]-a/2,y=o[g+1]-u/2;if(e>=v&&r>=y&&e<=v+a&&r<=y+u)return f}return-1},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();if(e=n[0],r=n[1],o.contain(e,r)){var s=this.hoverDataIdx=this.findDataIndex(e,r);return s>=0}return this.hoverDataIdx=-1,!1},t.prototype.getBoundingRect=function(){var e=this._rect;if(!e){for(var r=this.shape,n=r.points,o=r.size,s=o[0],a=o[1],u=1/0,f=1/0,g=-1/0,v=-1/0,y=0;y<n.length;){var w=n[y++],I=n[y++];u=Math.min(w,u),g=Math.max(w,g),f=Math.min(I,f),v=Math.max(I,v)}e=this._rect=new sr(u-s/2,f-a/2,g-u+s,v-f+a)}return e},t}(qr),FAt=function(){function i(){this.group=new Ki}return i.prototype.updateData=function(t,e){this._clear();var r=this._create();r.setShape({points:t.getLayout("points")}),this._setCommon(r,t,e)},i.prototype.updateLayout=function(t){var e=t.getLayout("points");this.group.eachChild(function(r){if(r.startIndex!=null){var n=(r.endIndex-r.startIndex)*2,o=r.startIndex*4*2;e=new Float32Array(e.buffer,o,n)}r.setShape("points",e),r.reset()})},i.prototype.incrementalPrepareUpdate=function(t){this._clear()},i.prototype.incrementalUpdate=function(t,e,r){var n=this._newAdded[0],o=e.getLayout("points"),s=n&&n.shape.points;if(s&&s.length<2e4){var a=s.length,u=new Float32Array(a+o.length);u.set(s),u.set(o,a),n.endIndex=t.end,n.setShape({points:u})}else{this._newAdded=[];var f=this._create();f.startIndex=t.start,f.endIndex=t.end,f.incremental=!0,f.setShape({points:o}),this._setCommon(f,e,r)}},i.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},i.prototype._create=function(){var t=new BAt({cursor:"default"});return t.ignoreCoarsePointer=!0,this.group.add(t),this._newAdded.push(t),t},i.prototype._setCommon=function(t,e,r){var n=e.hostModel;r=r||{};var o=e.getVisual("symbolSize");t.setShape("size",o instanceof Array?o:[o,o]),t.softClipShape=r.clipShape||null,t.symbolProxy=bo(e.getVisual("symbol"),0,0,0,0),t.setColor=t.symbolProxy.setColor;var s=t.shape.size[0]<ret;t.useStyle(n.getModel("itemStyle").getItemStyle(s?["color","shadowBlur","shadowColor"]:["color"]));var a=e.getVisual("style"),u=a&&a.fill;u&&t.setColor(u);var f=ur(t);f.seriesIndex=n.seriesIndex,t.on("mousemove",function(g){f.dataIndex=null;var v=t.hoverDataIdx;v>=0&&(f.dataIndex=v+(t.startIndex||0))})},i.prototype.remove=function(){this._clear()},i.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},i}();const NAt=FAt;var VAt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this._updateSymbolDraw(o,e);s.updateData(o,{clipShape:this._getClipShape(e)}),this._finished=!0},t.prototype.incrementalPrepareRender=function(e,r,n){var o=e.getData(),s=this._updateSymbolDraw(o,e);s.incrementalPrepareUpdate(o),this._finished=!1},t.prototype.incrementalRender=function(e,r,n){this._symbolDraw.incrementalUpdate(e,r.getData(),{clipShape:this._getClipShape(r)}),this._finished=e.end===r.getData().count()},t.prototype.updateTransform=function(e,r,n){var o=e.getData();if(this.group.dirty(),!this._finished||o.count()>1e4)return{update:!0};var s=ZS("").reset(e,r,n);s.progress&&s.progress({start:0,end:o.count(),count:o.count()},o),this._symbolDraw.updateLayout(o)},t.prototype.eachRendered=function(e){this._symbolDraw&&this._symbolDraw.eachRendered(e)},t.prototype._getClipShape=function(e){if(e.get("clip",!0)){var r=e.coordinateSystem;return r&&r.getArea&&r.getArea(.1)}},t.prototype._updateSymbolDraw=function(e,r){var n=this._symbolDraw,o=r.pipelineContext,s=o.large;return(!n||s!==this._isLargeDraw)&&(n&&n.remove(),n=this._symbolDraw=s?new NAt:new WS,this._isLargeDraw=s,this.group.removeAll()),this.group.add(n.group),n},t.prototype.remove=function(e,r){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},t.prototype.dispose=function(){},t.type="scatter",t}(pa);const UAt=VAt;var net={left:0,right:0,top:0,bottom:0},aC=["25%","25%"],GAt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.mergeDefaultAndTheme=function(e,r){var n=Iv(e.outerBounds);i.prototype.mergeDefaultAndTheme.apply(this,arguments),n&&e.outerBounds&&Sh(e.outerBounds,n)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.apply(this,arguments),this.option.outerBounds&&e.outerBounds&&Sh(this.option.outerBounds,e.outerBounds)},t.type="grid",t.dependencies=["xAxis","yAxis"],t.layoutMode="box",t.defaultOption={show:!1,z:0,left:"15%",top:65,right:"10%",bottom:80,containLabel:!1,outerBoundsMode:"auto",outerBounds:net,outerBoundsContain:"all",outerBoundsClampWidth:aC[0],outerBoundsClampHeight:aC[1],backgroundColor:_e.color.transparent,borderWidth:1,borderColor:_e.color.neutral30},t}(gn);const HAt=GAt;var Fz=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",Wa).models[0]},t.type="cartesian2dAxis",t}(gn);wo(Fz,HS);var aet={show:!0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:_e.color.axisLine,width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15],breakLine:!0},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12,color:_e.color.axisLabel,textMargin:[0,3]},splitLine:{show:!0,showMinLine:!0,showMaxLine:!0,lineStyle:{color:_e.color.axisSplitLine,width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:[_e.color.backgroundTint,_e.color.backgroundTransparent]}},breakArea:{show:!0,itemStyle:{color:_e.color.neutral00,borderColor:_e.color.border,borderWidth:1,borderType:[3,3],opacity:.6},zigzagAmplitude:4,zigzagMinSpan:4,zigzagMaxSpan:20,zigzagZ:100,expandOnClick:!0},breakLabelLayout:{moveOverlap:"auto"}},jAt=Er({boundaryGap:!0,deduplication:null,jitter:0,jitterOverlap:!0,jitterMargin:2,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto",show:"auto"},axisLabel:{interval:"auto"}},aet),P3=Er({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:_e.color.axisMinorSplitLine,width:1}}},aet),WAt=Er({splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},P3),$At=rr({logBase:10},P3);const oet={category:jAt,value:P3,time:WAt,log:$At};var ZAt={value:1,category:1,time:1,log:1},Nz=null;function qAt(i){Nz||(Nz=i)}function qS(){return Nz}function M0(i,t,e,r){gt(ZAt,function(n,o){var s=Er(Er({},oet[o],!0),r,!0),a=function(u){we(f,u);function f(){var g=u!==null&&u.apply(this,arguments)||this;return g.type=t+"Axis."+o,g}return f.prototype.mergeDefaultAndTheme=function(g,v){var y=aS(this),w=y?Iv(g):{},I=v.getTheme();Er(g,I.get(o+"Axis")),Er(g,this.getDefaultOption()),g.type=IW(g),y&&Sh(g,w,y)},f.prototype.optionUpdated=function(){var g=this.option;g.type==="category"&&(this.__ordinalMeta=hS.createByAxisModel(this))},f.prototype.getCategories=function(g){var v=this.option;if(v.type==="category")return g?v.data:this.__ordinalMeta.categories},f.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},f.prototype.updateAxisBreaks=function(g){var v=qS();return v?v.updateModelAxisBreak(this,g):{breaks:[]}},f.type=t+"Axis."+o,f.defaultOption=s,f}(e);i.registerComponentModel(a)}),i.registerSubTypeDefaulter(t+"Axis",IW)}function IW(i){return i.type||(i.data?"category":"value")}var XAt=function(){function i(t){this.type="cartesian",this._dimList=[],this._axes={},this.name=t||""}return i.prototype.getAxis=function(t){return this._axes[t]},i.prototype.getAxes=function(){return ti(this._dimList,function(t){return this._axes[t]},this)},i.prototype.getAxesByScale=function(t){return t=t.toLowerCase(),Rn(this.getAxes(),function(e){return e.scale.type===t})},i.prototype.addAxis=function(t){var e=t.dim;this._axes[e]=t,this._dimList.push(e)},i}();const YAt=XAt;var Vz=["x","y"];function MW(i){return(i.type==="interval"||i.type==="time")&&!i.hasBreaks()}var KAt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="cartesian2d",e.dimensions=Vz,e}return t.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var e=this.getAxis("x").scale,r=this.getAxis("y").scale;if(!(!MW(e)||!MW(r))){var n=e.getExtent(),o=r.getExtent(),s=this.dataToPoint([n[0],o[0]]),a=this.dataToPoint([n[1],o[1]]),u=n[1]-n[0],f=o[1]-o[0];if(!(!u||!f)){var g=(a[0]-s[0])/u,v=(a[1]-s[1])/f,y=s[0]-n[0]*g,w=s[1]-o[0]*v,I=this._transform=[g,0,0,v,y,w];this._invTransform=mu([],I)}}},t.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},t.prototype.containPoint=function(e){var r=this.getAxis("x"),n=this.getAxis("y");return r.contain(r.toLocalCoord(e[0]))&&n.contain(n.toLocalCoord(e[1]))},t.prototype.containData=function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])},t.prototype.containZone=function(e,r){var n=this.dataToPoint(e),o=this.dataToPoint(r),s=this.getArea(),a=new sr(n[0],n[1],o[0]-n[0],o[1]-n[1]);return s.intersect(a)},t.prototype.dataToPoint=function(e,r,n){n=n||[];var o=e[0],s=e[1];if(this._transform&&o!=null&&isFinite(o)&&s!=null&&isFinite(s))return ho(n,e,this._transform);var a=this.getAxis("x"),u=this.getAxis("y");return n[0]=a.toGlobalCoord(a.dataToCoord(o,r)),n[1]=u.toGlobalCoord(u.dataToCoord(s,r)),n},t.prototype.clampData=function(e,r){var n=this.getAxis("x").scale,o=this.getAxis("y").scale,s=n.getExtent(),a=o.getExtent(),u=n.parse(e[0]),f=o.parse(e[1]);return r=r||[],r[0]=Math.min(Math.max(Math.min(s[0],s[1]),u),Math.max(s[0],s[1])),r[1]=Math.min(Math.max(Math.min(a[0],a[1]),f),Math.max(a[0],a[1])),r},t.prototype.pointToData=function(e,r,n){if(n=n||[],this._invTransform)return ho(n,e,this._invTransform);var o=this.getAxis("x"),s=this.getAxis("y");return n[0]=o.coordToData(o.toLocalCoord(e[0]),r),n[1]=s.coordToData(s.toLocalCoord(e[1]),r),n},t.prototype.getOtherAxis=function(e){return this.getAxis(e.dim==="x"?"y":"x")},t.prototype.getArea=function(e){e=e||0;var r=this.getAxis("x").getGlobalExtent(),n=this.getAxis("y").getGlobalExtent(),o=Math.min(r[0],r[1])-e,s=Math.min(n[0],n[1])-e,a=Math.max(r[0],r[1])-o+e,u=Math.max(n[0],n[1])-s+e;return new sr(o,s,a,u)},t}(YAt),JAt=function(i){we(t,i);function t(e,r,n,o,s){var a=i.call(this,e,r,n)||this;return a.index=0,a.type=o||"value",a.position=s||"bottom",a}return t.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"},t.prototype.getGlobalExtent=function(e){var r=this.getExtent();return r[0]=this.toGlobalCoord(r[0]),r[1]=this.toGlobalCoord(r[1]),e&&r[0]>r[1]&&r.reverse(),r},t.prototype.pointToData=function(e,r){return this.coordToData(this.toLocalCoord(e[this.dim==="x"?0:1]),r)},t.prototype.setCategorySortInfo=function(e){if(this.type!=="category")return!1;this.model.option.categorySortInfo=e,this.scale.setSortInfo(e)},t}(bu);const set=JAt;var IE="expandAxisBreak",cet="collapseAxisBreak",uet="toggleAxisBreak",L3="axisbreakchanged",QAt={type:IE,event:L3,update:"update",refineEvent:R3},tIt={type:cet,event:L3,update:"update",refineEvent:R3},eIt={type:uet,event:L3,update:"update",refineEvent:R3};function R3(i,t,e,r){var n=[];return gt(i,function(o){n=n.concat(o.eventBreaks)}),{eventContent:{breaks:n}}}function iIt(i){i.registerAction(QAt,t),i.registerAction(tIt,t),i.registerAction(eIt,t);function t(e,r){var n=[],o=s0(r,e);function s(a,u){gt(o[a],function(f){var g=f.updateAxisBreaks(e);gt(g.breaks,function(v){var y;n.push(rr((y={},y[u]=f.componentIndex,y),v))})})}return s("xAxisModels","xAxisIndex"),s("yAxisModels","yAxisIndex"),s("singleAxisModels","singleAxisIndex"),{eventBreaks:n}}}var pp=Math.PI,rIt=[[1,2,1,2],[5,3,5,3],[8,3,8,3]],nIt=[[0,1,0,1],[0,3,0,3],[0,3,0,3]],C0=Wr(),het=Wr(),det=function(){function i(t){this.recordMap={},this.resolveAxisNameOverlap=t}return i.prototype.ensureRecord=function(t){var e=t.axis.dim,r=t.componentIndex,n=this.recordMap,o=n[e]||(n[e]=[]);return o[r]||(o[r]={ready:{}})},i}();function aIt(i,t,e,r){var n=e.axis,o=t.ensureRecord(e),s=[],a,u=k3(i.axisName)&&A0(i.nameLocation);gt(r,function(I){var E=Th(I);if(!(!E||E.label.ignore)){s.push(E);var D=o.transGroup;u&&(D.transform?mu(Mb,D.transform):JC(Mb),E.transform&&fh(Mb,Mb,E.transform),sr.copy(qA,E.localRect),qA.applyTransform(Mb),a?a.union(qA):sr.copy(a=new sr(0,0,0,0),qA))}});var f=Math.abs(o.dirVec.x)>.1?"x":"y",g=o.transGroup[f];if(s.sort(function(I,E){return Math.abs(I.label[f]-g)-Math.abs(E.label[f]-g)}),u&&a){var v=n.getExtent(),y=Math.min(v[0],v[1]),w=Math.max(v[0],v[1])-y;a.union(new sr(y,0,w,1))}o.stOccupiedRect=a,o.labelInfoList=s}var Mb=ns(),qA=new sr(0,0,0,0),fet=function(i,t,e,r,n,o){if(A0(i.nameLocation)){var s=o.stOccupiedRect;s&&pet(zTt({},s,o.transGroup.transform),r,n)}else get(o.labelInfoList,o.dirVec,r,n)};function pet(i,t,e){var r=new er;TE(i,t,r,{direction:Math.atan2(e.y,e.x),bidirectional:!1,touchThreshold:.05})&&Pz(t,r)}function get(i,t,e,r){for(var n=er.dot(r,t)>=0,o=0,s=i.length;o<s;o++){var a=i[n?o:s-1-o];a.label.ignore||pet(a,e,r)}}var lv=function(){function i(t,e,r,n){this.group=new Ki,this._axisModel=t,this._api=e,this._local={},this._shared=n||new det(fet),this._resetCfgDetermined(r)}return i.prototype.updateCfg=function(t){var e=this._cfg.raw;e.position=t.position,e.labelOffset=t.labelOffset,this._resetCfgDetermined(e)},i.prototype.__getRawCfg=function(){return this._cfg.raw},i.prototype._resetCfgDetermined=function(t){var e=this._axisModel,r=e.getDefaultOption?e.getDefaultOption():{},n=Ui(t.axisName,e.get("name")),o=e.get("nameMoveOverlap");(o==null||o==="auto")&&(o=Ui(t.defaultNameMoveOverlap,!0));var s={raw:t,position:t.position,rotation:t.rotation,nameDirection:Ui(t.nameDirection,1),tickDirection:Ui(t.tickDirection,1),labelDirection:Ui(t.labelDirection,1),labelOffset:Ui(t.labelOffset,0),silent:Ui(t.silent,!0),axisName:n,nameLocation:ic(e.get("nameLocation"),r.nameLocation,"end"),shouldNameMoveOverlap:k3(n)&&o,optionHideOverlap:e.get(["axisLabel","hideOverlap"]),showMinorTicks:e.get(["minorTick","show"])};this._cfg=s;var a=new Ki({x:s.position[0],y:s.position[1],rotation:s.rotation});a.updateTransform(),this._transformGroup=a;var u=this._shared.ensureRecord(e);u.transGroup=this._transformGroup,u.dirVec=new er(Math.cos(-s.rotation),Math.sin(-s.rotation))},i.prototype.build=function(t,e){var r=this;return t||(t={axisLine:!0,axisTickLabelEstimate:!1,axisTickLabelDetermine:!0,axisName:!0}),gt(oIt,function(n){t[n]&&sIt[n](r._cfg,r._local,r._shared,r._axisModel,r.group,r._transformGroup,r._api,e||{})}),this},i.innerTextLayout=function(t,e,r){var n=ZY(e-t),o,s;return Jw(n)?(s=r>0?"top":"bottom",o="center"):Jw(n-pp)?(s=r>0?"bottom":"top",o="center"):(s="middle",n>0&&n<pp?o=r>0?"right":"left":o=r>0?"left":"right"),{rotation:n,textAlign:o,textVerticalAlign:s}},i.makeAxisEventDataBase=function(t){var e={componentType:t.mainType,componentIndex:t.componentIndex};return e[t.mainType+"Index"]=t.componentIndex,e},i.isLabelSilent=function(t){var e=t.get("tooltip");return t.get("silent")||!(t.get("triggerEvent")||e&&e.show)},i}(),oIt=["axisLine","axisTickLabelEstimate","axisTickLabelDetermine","axisName"],sIt={axisLine:function(i,t,e,r,n,o,s){var a=r.get(["axisLine","show"]);if(a==="auto"&&(a=!0,i.raw.axisLineAutoShow!=null&&(a=!!i.raw.axisLineAutoShow)),!!a){var u=r.axis.getExtent(),f=o.transform,g=[u[0],0],v=[u[1],0],y=g[0]>v[0];f&&(ho(g,g,f),ho(v,v,f));var w=Fe({lineCap:"round"},r.getModel(["axisLine","lineStyle"]).getLineStyle()),I={strokeContainThreshold:i.raw.strokeContainThreshold||5,silent:!0,z2:1,style:w};if(r.get(["axisLine","breakLine"])&&r.axis.scale.hasBreaks())qS().buildAxisBreakLine(r,n,o,I);else{var E=new Ro(Fe({shape:{x1:g[0],y1:g[1],x2:v[0],y2:v[1]}},I));b0(E.shape,E.style.lineWidth),E.anid="line",n.add(E)}var D=r.get(["axisLine","symbol"]);if(D!=null){var R=r.get(["axisLine","symbolSize"]);bi(D)&&(D=[D,D]),(bi(R)||fn(R))&&(R=[R,R]);var z=Cv(r.get(["axisLine","symbolOffset"])||0,R),N=R[0],H=R[1];gt([{rotate:i.rotation+Math.PI/2,offset:z[0],r:0},{rotate:i.rotation-Math.PI/2,offset:z[1],r:Math.sqrt((g[0]-v[0])*(g[0]-v[0])+(g[1]-v[1])*(g[1]-v[1]))}],function($,X){if(D[X]!=="none"&&D[X]!=null){var K=bo(D[X],-N/2,-H/2,N,H,w.stroke,!0),et=$.r+$.offset,rt=y?v:g;K.attr({rotation:$.rotate,x:rt[0]+et*Math.cos(i.rotation),y:rt[1]-et*Math.sin(i.rotation),silent:!0,z2:11}),n.add(K)}})}}},axisTickLabelEstimate:function(i,t,e,r,n,o,s,a){var u=EW(t,n,a);u&&CW(i,t,e,r,n,o,s,_u.estimate)},axisTickLabelDetermine:function(i,t,e,r,n,o,s,a){var u=EW(t,n,a);u&&CW(i,t,e,r,n,o,s,_u.determine);var f=hIt(i,n,o,r);uIt(i,t.labelLayoutList,f),dIt(i,n,o,r,i.tickDirection)},axisName:function(i,t,e,r,n,o,s,a){var u=e.ensureRecord(r);t.nameEl&&(n.remove(t.nameEl),t.nameEl=u.nameLayout=u.nameLocation=null);var f=i.axisName;if(k3(f)){var g=i.nameLocation,v=i.nameDirection,y=r.getModel("nameTextStyle"),w=r.get("nameGap")||0,I=r.axis.getExtent(),E=r.axis.inverse?-1:1,D=new er(0,0),R=new er(0,0);g==="start"?(D.x=I[0]-E*w,R.x=-E):g==="end"?(D.x=I[1]+E*w,R.x=E):(D.x=(I[0]+I[1])/2,D.y=i.labelOffset+v*w,R.y=v);var z=ns();R.transform(Up(z,z,i.rotation));var N=r.get("nameRotate");N!=null&&(N=N*pp/180);var H,$;A0(g)?H=lv.innerTextLayout(i.rotation,N??i.rotation,v):(H=lIt(i.rotation,g,N||0,I),$=i.raw.axisNameAvailableWidth,$!=null&&($=Math.abs($/Math.sin(H.rotation)),!isFinite($)&&($=null)));var X=y.getFont(),K=r.get("nameTruncate",!0)||{},et=K.ellipsis,rt=vs(i.raw.nameTruncateMaxWidth,K.maxWidth,$),lt=a.nameMarginLevel||0,ht=new _n({x:D.x,y:D.y,rotation:H.rotation,silent:lv.isLabelSilent(r),style:fa(y,{text:f,font:X,overflow:"truncate",width:rt,ellipsis:et,fill:y.getTextColor()||r.get(["axisLine","lineStyle","color"]),align:y.get("align")||H.textAlign,verticalAlign:y.get("verticalAlign")||H.textVerticalAlign}),z2:1});if(Gd({el:ht,componentModel:r,itemName:f}),ht.__fullText=f,ht.anid="name",r.get("triggerEvent")){var yt=lv.makeAxisEventDataBase(r);yt.targetType="axisName",yt.name=f,ur(ht).eventData=yt}o.add(ht),ht.updateTransform(),t.nameEl=ht;var ft=u.nameLayout=Th({label:ht,priority:ht.z2,defaultAttr:{ignore:ht.ignore},marginDefault:A0(g)?rIt[lt]:nIt[lt]});if(u.nameLocation=g,n.add(ht),ht.decomposeTransform(),i.shouldNameMoveOverlap&&ft){var kt=e.ensureRecord(r);e.resolveAxisNameOverlap(i,e,r,ft,R,kt)}}}};function CW(i,t,e,r,n,o,s,a){vet(t)||fIt(i,t,n,a,r,s);var u=t.labelLayoutList;pIt(i,r,u,o),vIt(r,i.rotation,u);var f=i.optionHideOverlap;cIt(r,u,f),f&&Att(Rn(u,function(g){return g&&!g.label.ignore})),aIt(i,e,r,u)}function lIt(i,t,e,r){var n=ZY(e-i),o,s,a=r[0]>r[1],u=t==="start"&&!a||t!=="start"&&a;return Jw(n-pp/2)?(s=u?"bottom":"top",o="center"):Jw(n-pp*1.5)?(s=u?"top":"bottom",o="center"):(s="middle",n<pp*1.5&&n>pp/2?o=u?"left":"right":o=u?"right":"left"),{rotation:n,textAlign:o,textVerticalAlign:s}}function cIt(i,t,e){if(ltt(i.axis))return;function r(a,u,f){var g=Th(t[u]),v=Th(t[f]);if(!(!g||!v)){if(a===!1||g.suggestIgnore){nw(g.label);return}if(v.suggestIgnore){nw(v.label);return}var y=.1;if(!e){var w=[0,0,0,0];g=Lz({marginForce:w},g),v=Lz({marginForce:w},v)}TE(g,v,null,{touchThreshold:y})&&nw(a?v.label:g.label)}}var n=i.get(["axisLabel","showMinLabel"]),o=i.get(["axisLabel","showMaxLabel"]),s=t.length;r(n,0,1),r(o,s-1,s-2)}function uIt(i,t,e){i.showMinorTicks||gt(t,function(r){if(r&&r.label.ignore)for(var n=0;n<e.length;n++){var o=e[n],s=het(o),a=C0(r.label);if(s.tickValue!=null&&!s.onBand&&s.tickValue===a.tickValue){nw(o);return}}})}function nw(i){i&&(i.ignore=!0)}function met(i,t,e,r,n){for(var o=[],s=[],a=[],u=0;u<i.length;u++){var f=i[u].coord;s[0]=f,s[1]=0,a[0]=f,a[1]=e,t&&(ho(s,s,t),ho(a,a,t));var g=new Ro({shape:{x1:s[0],y1:s[1],x2:a[0],y2:a[1]},style:r,z2:2,autoBatch:!0,silent:!0});b0(g.shape,g.style.lineWidth),g.anid=n+"_"+i[u].tickValue,o.push(g);var v=het(g);v.onBand=!!i[u].onBand,v.tickValue=i[u].tickValue}return o}function hIt(i,t,e,r){var n=r.axis,o=r.getModel("axisTick"),s=o.get("show");if(s==="auto"&&(s=!0,i.raw.axisTickAutoShow!=null&&(s=!!i.raw.axisTickAutoShow)),!s||n.scale.isBlank())return[];for(var a=o.getModel("lineStyle"),u=i.tickDirection*o.get("length"),f=n.getTicksCoords(),g=met(f,e.transform,u,rr(a.getLineStyle(),{stroke:r.get(["axisLine","lineStyle","color"])}),"ticks"),v=0;v<g.length;v++)t.add(g[v]);return g}function dIt(i,t,e,r,n){var o=r.axis,s=r.getModel("minorTick");if(!(!i.showMinorTicks||o.scale.isBlank())){var a=o.getMinorTicksCoords();if(a.length)for(var u=s.getModel("lineStyle"),f=n*s.get("length"),g=rr(u.getLineStyle(),rr(r.getModel("axisTick").getLineStyle(),{stroke:r.get(["axisLine","lineStyle","color"])})),v=0;v<a.length;v++)for(var y=met(a[v],e.transform,f,g,"minorticks_"+v),w=0;w<y.length;w++)t.add(y[w])}}function EW(i,t,e){if(vet(i)){var r=i.axisLabelsCreationContext,n=r.out.noPxChangeTryDetermine;if(e.noPxChange){for(var o=!0,s=0;s<n.length;s++)o=o&&n[s]();if(o)return!1}n.length&&(t.remove(i.labelGroup),Uz(i,null,null,null))}return!0}function fIt(i,t,e,r,n,o){var s=n.axis,a=vs(i.raw.axisLabelShow,n.get(["axisLabel","show"])),u=new Ki;e.add(u);var f=KM(r);if(!a||s.scale.isBlank()){Uz(t,[],u,f);return}var g=n.getModel("axisLabel"),v=s.getViewLabels(f),y=(vs(i.raw.labelRotate,g.get("rotate"))||0)*pp/180,w=lv.innerTextLayout(i.rotation,y,i.labelDirection),I=n.getCategories&&n.getCategories(!0),E=[],D=n.get("triggerEvent"),R=1/0,z=-1/0;gt(v,function(H,$){var X,K=s.scale.type==="ordinal"?s.scale.getRawOrdinalNumber(H.tickValue):H.tickValue,et=H.formattedLabel,rt=H.rawLabel,lt=g;if(I&&I[K]){var ht=I[K];nr(ht)&&ht.textStyle&&(lt=new bn(ht.textStyle,g,n.ecModel))}var yt=lt.getTextColor()||n.get(["axisLine","lineStyle","color"]),ft=lt.getShallow("align",!0)||w.textAlign,kt=Ui(lt.getShallow("alignMinLabel",!0),ft),Rt=Ui(lt.getShallow("alignMaxLabel",!0),ft),Ct=lt.getShallow("verticalAlign",!0)||lt.getShallow("baseline",!0)||w.textVerticalAlign,Gt=Ui(lt.getShallow("verticalAlignMinLabel",!0),Ct),Vt=Ui(lt.getShallow("verticalAlignMaxLabel",!0),Ct),Qt=10+(((X=H.time)===null||X===void 0?void 0:X.level)||0);R=Math.min(R,Qt),z=Math.max(z,Qt);var fe=new _n({x:0,y:0,rotation:0,silent:lv.isLabelSilent(n),z2:Qt,style:fa(lt,{text:et,align:$===0?kt:$===v.length-1?Rt:ft,verticalAlign:$===0?Gt:$===v.length-1?Vt:Ct,fill:Xi(yt)?yt(s.type==="category"?rt:s.type==="value"?K+"":K,$):yt})});fe.anid="label_"+K;var Te=C0(fe);if(Te.break=H.break,Te.tickValue=K,Te.layoutRotation=w.rotation,Gd({el:fe,componentModel:n,itemName:et,formatterParamsExtra:{isTruncated:function(){return fe.isTruncated},value:rt,tickIndex:$}}),D){var be=lv.makeAxisEventDataBase(n);be.targetType="axisLabel",be.value=rt,be.tickIndex=$,H.break&&(be.break={start:H.break.parsedBreak.vmin,end:H.break.parsedBreak.vmax}),s.type==="category"&&(be.dataIndex=K),ur(fe).eventData=be,H.break&&mIt(n,o,fe,H.break)}E.push(fe),u.add(fe)});var N=ti(E,function(H){return{label:H,priority:C0(H).break?H.z2+(z-R+1):H.z2,defaultAttr:{ignore:H.ignore}}});Uz(t,N,u,f)}function vet(i){return!!i.labelLayoutList}function Uz(i,t,e,r){i.labelLayoutList=t,i.labelGroup=e,i.axisLabelsCreationContext=r}function pIt(i,t,e,r){var n=t.get(["axisLabel","margin"]);gt(e,function(o,s){var a=Th(o);if(a){var u=a.label,f=C0(u);a.suggestIgnore=u.ignore,u.ignore=!1,DM(rd,gIt),rd.x=t.axis.dataToCoord(f.tickValue),rd.y=i.labelOffset+i.labelDirection*n,rd.rotation=f.layoutRotation,r.add(rd),rd.updateTransform(),r.remove(rd),rd.decomposeTransform(),DM(u,rd),u.markRedraw(),eC(a,!0),Th(a)}})}var rd=new jr,gIt=new jr;function k3(i){return!!i}function mIt(i,t,e,r){e.on("click",function(n){var o={type:IE,breaks:[{start:r.parsedBreak.breakOption.start,end:r.parsedBreak.breakOption.end}]};o[i.axis.dim+"AxisIndex"]=i.componentIndex,t.dispatchAction(o)})}function vIt(i,t,e){var r=_o();if(r){var n=r.retrieveAxisBreakPairs(e,function(s){return s&&C0(s.label).break},!0),o=i.get(["breakLabelLayout","moveOverlap"],!0);(o===!0||o==="auto")&&gt(n,function(s){qS().adjustBreakLabelPair(i.axis.inverse,t,[Th(e[s[0]]),Th(e[s[1]])])})}}const zd=lv;function oC(i,t,e){e=e||{};var r=t.axis,n={},o=r.getAxesOnZeroOf()[0],s=r.position,a=o?"onZero":s,u=r.dim,f=[i.x,i.x+i.width,i.y,i.y+i.height],g={left:0,right:1,top:0,bottom:1,onZero:2},v=t.get("offset")||0,y=u==="x"?[f[2]-v,f[3]+v]:[f[0]-v,f[1]+v];if(o){var w=o.toGlobalCoord(o.dataToCoord(0));y[g.onZero]=Math.max(Math.min(w,y[1]),y[0])}n.position=[u==="y"?y[g[a]]:f[0],u==="x"?y[g[a]]:f[3]],n.rotation=Math.PI/2*(u==="x"?0:1);var I={top:-1,bottom:1,left:-1,right:1};n.labelDirection=n.tickDirection=n.nameDirection=I[s],n.labelOffset=o?y[g[s]]-y[g.onZero]:0,t.get(["axisTick","inside"])&&(n.tickDirection=-n.tickDirection),vs(e.labelInside,t.get(["axisLabel","inside"]))&&(n.labelDirection=-n.labelDirection);var E=t.get(["axisLabel","rotate"]);return n.labelRotate=a==="top"?-E:E,n.z2=1,n}function _It(i){return i.coordinateSystem&&i.coordinateSystem.type==="cartesian2d"}function DW(i){var t={xAxisModel:null,yAxisModel:null};return gt(t,function(e,r){var n=r.replace(/Model$/,""),o=i.getReferringComponents(n,Wa).models[0];t[r]=o}),t}function yIt(i,t,e,r,n,o){for(var s=oC(i,e),a=!1,u=!1,f=0;f<t.length;f++)Iz(t[f].getOtherAxis(e.axis).scale)&&(a=u=!0,e.axis.type==="category"&&e.axis.onBand&&(u=!1));return s.axisLineAutoShow=a,s.axisTickAutoShow=u,s.defaultNameMoveOverlap=o,new zd(e,r,s,n)}function xIt(i,t,e){var r=oC(t,e);i.updateCfg(r)}function _et(i,t,e){var r=Rp.prototype,n=r.getTicks.call(e),o=r.getTicks.call(e,{expandToNicedExtent:!0}),s=n.length-1,a=r.getInterval.call(e),u=stt(i,t),f=u.extent,g=u.fixMin,v=u.fixMax;i.type==="log"&&(f=Mz(i.base,f,!0)),i.setBreaksFromOption(ctt(t)),i.setExtent(f[0],f[1]),i.calcNiceExtent({splitNumber:s,fixMin:g,fixMax:v});var y=r.getExtent.call(i);g&&(f[0]=y[0]),v&&(f[1]=y[1]);var w=r.getInterval.call(i),I=f[0],E=f[1];if(g&&v)w=(E-I)/s;else if(g)for(E=f[0]+w*s;E<f[1]&&isFinite(E)&&isFinite(f[1]);)w=vR(w),E=f[0]+w*s;else if(v)for(I=f[1]-w*s;I>f[0]&&isFinite(I)&&isFinite(f[0]);)w=vR(w),I=f[1]-w*s;else{var D=i.getTicks().length-1;D>s&&(w=vR(w));var R=w*s;E=Math.ceil(f[1]/w)*w,I=vo(E-R),I<0&&f[0]>=0?(I=0,E=vo(R)):E>0&&f[1]<=0&&(E=0,I=-vo(R))}var z=(n[0].value-o[0].value)/a,N=(n[s].value-o[s].value)/a;r.setExtent.call(i,I+w*z,E+w*N),r.setInterval.call(i,w),(z||N)&&r.setNiceExtent.call(i,I+w,E-w)}var PW=[[3,1],[0,2]],bIt=function(){function i(t,e,r){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=Vz,this._initCartesian(t,e,r),this.model=t}return i.prototype.getRect=function(){return this._rect},i.prototype.update=function(t,e){var r=this._axesMap;this._updateScale(t,this.model);function n(s){var a,u=on(s),f=u.length;if(f){for(var g=[],v=f-1;v>=0;v--){var y=+u[v],w=s[y],I=w.model,E=w.scale;Iz(E)&&I.get("alignTicks")&&I.get("interval")==null?g.push(w):(T0(E,I),Iz(E)&&(a=w))}g.length&&(a||(a=g.pop(),T0(a.scale,a.model)),gt(g,function(D){_et(D.scale,D.model,a.scale)}))}}n(r.x),n(r.y);var o={};gt(r.x,function(s){LW(r,"y",s,o)}),gt(r.y,function(s){LW(r,"x",s,o)}),this.resize(this.model,e)},i.prototype.resize=function(t,e,r){var n=Bo(t,e),o=this._rect=Ca(t.getBoxLayoutParams(),n.refContainer),s=this._axesMap,a=this._coordsList,u=t.get("containLabel");if(Gz(s,o),!r){var f=TIt(o,a,s,u,e),g=void 0;if(u)Hz?(Hz(this._axesList,o),Gz(s,o)):g=OW(o.clone(),"axisLabel",null,o,s,f,n);else{var v=AIt(t,o,n),y=v.outerBoundsRect,w=v.parsedOuterBoundsContain,I=v.outerBoundsClamp;y&&(g=OW(y,w,I,o,s,f,n))}yet(o,s,_u.determine,null,g,n)}gt(this._coordsList,function(E){E.calcAffineTransform()})},i.prototype.getAxis=function(t,e){var r=this._axesMap[t];if(r!=null)return r[e||0]},i.prototype.getAxes=function(){return this._axesList.slice()},i.prototype.getCartesian=function(t,e){if(t!=null&&e!=null){var r="x"+t+"y"+e;return this._coordsMap[r]}nr(t)&&(e=t.yAxisIndex,t=t.xAxisIndex);for(var n=0,o=this._coordsList;n<o.length;n++)if(o[n].getAxis("x").index===t||o[n].getAxis("y").index===e)return o[n]},i.prototype.getCartesians=function(){return this._coordsList.slice()},i.prototype.convertToPixel=function(t,e,r){var n=this._findConvertTarget(e);return n.cartesian?n.cartesian.dataToPoint(r):n.axis?n.axis.toGlobalCoord(n.axis.dataToCoord(r)):null},i.prototype.convertFromPixel=function(t,e,r){var n=this._findConvertTarget(e);return n.cartesian?n.cartesian.pointToData(r):n.axis?n.axis.coordToData(n.axis.toLocalCoord(r)):null},i.prototype._findConvertTarget=function(t){var e=t.seriesModel,r=t.xAxisModel||e&&e.getReferringComponents("xAxis",Wa).models[0],n=t.yAxisModel||e&&e.getReferringComponents("yAxis",Wa).models[0],o=t.gridModel,s=this._coordsList,a,u;if(e)a=e.coordinateSystem,Ar(s,a)<0&&(a=null);else if(r&&n)a=this.getCartesian(r.componentIndex,n.componentIndex);else if(r)u=this.getAxis("x",r.componentIndex);else if(n)u=this.getAxis("y",n.componentIndex);else if(o){var f=o.coordinateSystem;f===this&&(a=this._coordsList[0])}return{cartesian:a,axis:u}},i.prototype.containPoint=function(t){var e=this._coordsList[0];if(e)return e.containPoint(t)},i.prototype._initCartesian=function(t,e,r){var n=this,o=this,s={left:!1,right:!1,top:!1,bottom:!1},a={x:{},y:{}},u={x:0,y:0};if(e.eachComponent("xAxis",f("x"),this),e.eachComponent("yAxis",f("y"),this),!u.x||!u.y){this._axesMap={},this._axesList=[];return}this._axesMap=a,gt(a.x,function(g,v){gt(a.y,function(y,w){var I="x"+v+"y"+w,E=new KAt(I);E.master=n,E.model=t,n._coordsMap[I]=E,n._coordsList.push(E),E.addAxis(g),E.addAxis(y)})});function f(g){return function(v,y){if(RR(v,t)){var w=v.get("position");g==="x"?w!=="top"&&w!=="bottom"&&(w=s.bottom?"top":"bottom"):w!=="left"&&w!=="right"&&(w=s.left?"right":"left"),s[w]=!0;var I=new set(g,SE(v),[0,0],v.get("type"),w),E=I.type==="category";I.onBand=E&&v.get("boundaryGap"),I.inverse=v.get("inverse"),v.axis=I,I.model=v,I.grid=o,I.index=y,o._axesList.push(I),a[g][y]=I,u[g]++}}}},i.prototype._updateScale=function(t,e){gt(this._axesList,function(n){if(n.scale.setExtent(1/0,-1/0),n.type==="category"){var o=n.model.get("categorySortInfo");n.scale.setSortInfo(o)}}),t.eachSeries(function(n){if(_It(n)){var o=DW(n),s=o.xAxisModel,a=o.yAxisModel;if(!RR(s,e)||!RR(a,e))return;var u=this.getCartesian(s.componentIndex,a.componentIndex),f=n.getData(),g=u.getAxis("x"),v=u.getAxis("y");r(f,g),r(f,v)}},this);function r(n,o){gt(YM(n,o.dim),function(s){o.scale.unionExtentFromData(n,s)})}},i.prototype.getTooltipAxes=function(t){var e=[],r=[];return gt(this.getCartesians(),function(n){var o=t!=null&&t!=="auto"?n.getAxis(t):n.getBaseAxis(),s=n.getOtherAxis(o);Ar(e,o)<0&&e.push(o),Ar(r,s)<0&&r.push(s)}),{baseAxes:e,otherAxes:r}},i.create=function(t,e){var r=[];return t.eachComponent("grid",function(n,o){var s=new i(n,t,e);s.name="grid_"+o,s.resize(n,e,!0),n.coordinateSystem=s,r.push(s)}),t.eachSeries(function(n){VS({targetModel:n,coordSysType:"cartesian2d",coordSysProvider:o});function o(){var s=DW(n),a=s.xAxisModel,u=s.yAxisModel,f=a.getCoordSysModel(),g=f.coordinateSystem;return g.getCartesian(a.componentIndex,u.componentIndex)}}),r},i.dimensions=Vz,i}();function RR(i,t){return i.getCoordSysModel()===t}function LW(i,t,e,r){e.getAxesOnZeroOf=function(){return o?[o]:[]};var n=i[t],o,s=e.model,a=s.get(["axisLine","onZero"]),u=s.get(["axisLine","onZeroAxisIndex"]);if(!a)return;if(u!=null)RW(n[u])&&(o=n[u]);else for(var f in n)if(n.hasOwnProperty(f)&&RW(n[f])&&!r[g(n[f])]){o=n[f];break}o&&(r[g(o)]=!0);function g(v){return v.dim+"_"+v.index}}function RW(i){return i&&i.type!=="category"&&i.type!=="time"&&aTt(i)}function wIt(i,t){var e=i.getExtent(),r=e[0]+e[1];i.toGlobalCoord=i.dim==="x"?function(n){return n+t}:function(n){return r-n+t},i.toLocalCoord=i.dim==="x"?function(n){return n-t}:function(n){return r-n+t}}function Gz(i,t){gt(i.x,function(e){return kW(e,t.x,t.width)}),gt(i.y,function(e){return kW(e,t.y,t.height)})}function kW(i,t,e){var r=[0,e],n=i.inverse?1:0;i.setExtent(r[n],r[1-n]),wIt(i,t)}var Hz;function SIt(i){Hz=i}function OW(i,t,e,r,n,o,s){yet(r,n,_u.estimate,t,!1,s);var a=[0,0,0,0];f(0),f(1),g(r,0,NaN),g(r,1,NaN);var u=bv(a,function(y){return y>0})==null;return mv(r,a,!0,!0,e),Gz(n,r),u;function f(y){gt(n[vr[y]],function(w){if(fS(w.model)){var I=o.ensureRecord(w.model),E=I.labelInfoList;if(E)for(var D=0;D<E.length;D++){var R=E[D],z=w.scale.normalize(C0(R.label).tickValue);z=y===1?1-z:z,g(R.rect,y,z),g(R.rect,1-y,NaN)}var N=I.nameLayout;if(N){var z=A0(I.nameLocation)?.5:NaN;g(N.rect,y,z),g(N.rect,1-y,NaN)}}})}function g(y,w,I){var E=i[vr[w]]-y[vr[w]],D=y[yo[w]]+y[vr[w]]-(i[yo[w]]+i[vr[w]]);E=v(E,1-I),D=v(D,I);var R=PW[w][0],z=PW[w][1];a[R]=co(a[R],E),a[z]=co(a[z],D)}function v(y,w){return y>0&&!Bs(w)&&w>1e-4&&(y/=w),y}}function TIt(i,t,e,r,n){var o=new det(IIt);return gt(e,function(s){return gt(s,function(a){if(fS(a.model)){var u=!r;a.axisBuilder=yIt(i,t,a.model,n,o,u)}})}),o}function yet(i,t,e,r,n,o){var s=e===_u.determine;gt(t,function(f){return gt(f,function(g){fS(g.model)&&(xIt(g.axisBuilder,i,g.model),g.axisBuilder.build(s?{axisTickLabelDetermine:!0}:{axisTickLabelEstimate:!0},{noPxChange:n}))})});var a={x:0,y:0};u(0),u(1);function u(f){a[vr[1-f]]=i[yo[f]]<=o.refContainer[yo[f]]*.5?0:1-f===1?2:1}gt(t,function(f,g){return gt(f,function(v){fS(v.model)&&((r==="all"||s)&&v.axisBuilder.build({axisName:!0},{nameMarginLevel:a[g]}),s&&v.axisBuilder.build({axisLine:!0}))})})}function AIt(i,t,e){var r,n=i.get("outerBoundsMode",!0);n==="same"?r=t.clone():(n==null||n==="auto")&&(r=Ca(i.get("outerBounds",!0)||net,e.refContainer));var o=i.get("outerBoundsContain",!0),s;o==null||o==="auto"||Ar(["all","axisLabel"],o)<0?s="all":s=o;var a=[LM(Ui(i.get("outerBoundsClampWidth",!0),aC[0]),t.width),LM(Ui(i.get("outerBoundsClampHeight",!0),aC[1]),t.height)];return{outerBoundsRect:r,parsedOuterBoundsContain:s,outerBoundsClamp:a}}var IIt=function(i,t,e,r,n,o){var s=e.axis.dim==="x"?"y":"x";fet(i,t,e,r,n,o),A0(i.nameLocation)||gt(t.recordMap[s],function(a){a&&a.labelInfoList&&a.dirVec&&get(a.labelInfoList,a.dirVec,r,n)})};const MIt=bIt;function CIt(i,t){var e={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return EIt(e,i,t),e.seriesInvolved&&PIt(e,i),e}function EIt(i,t,e){var r=t.getComponent("tooltip"),n=t.getComponent("axisPointer"),o=n.get("link",!0)||[],s=[];gt(e.getCoordinateSystems(),function(a){if(!a.axisPointerEnabled)return;var u=mS(a.model),f=i.coordSysAxesInfo[u]={};i.coordSysMap[u]=a;var g=a.model,v=g.getModel("tooltip",r);if(gt(a.getAxes(),br(E,!1,null)),a.getTooltipAxes&&r&&v.get("show")){var y=v.get("trigger")==="axis",w=v.get(["axisPointer","type"])==="cross",I=a.getTooltipAxes(v.get(["axisPointer","axis"]));(y||w)&&gt(I.baseAxes,br(E,w?"cross":!0,y)),w&&gt(I.otherAxes,br(E,"cross",!1))}function E(D,R,z){var N=z.model.getModel("axisPointer",n),H=N.get("show");if(!(!H||H==="auto"&&!D&&!jz(N))){R==null&&(R=N.get("triggerTooltip")),N=D?DIt(z,v,n,t,D,R):N;var $=N.get("snap"),X=N.get("triggerEmphasis"),K=mS(z.model),et=R||$||z.type==="category",rt=i.axesInfo[K]={key:K,axis:z,coordSys:a,axisPointerModel:N,triggerTooltip:R,triggerEmphasis:X,involveSeries:et,snap:$,useHandle:jz(N),seriesModels:[],linkGroup:null};f[K]=rt,i.seriesInvolved=i.seriesInvolved||et;var lt=LIt(o,z);if(lt!=null){var ht=s[lt]||(s[lt]={axesInfo:{}});ht.axesInfo[K]=rt,ht.mapper=o[lt].mapper,rt.linkGroup=ht}}}})}function DIt(i,t,e,r,n,o){var s=t.getModel("axisPointer"),a=["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],u={};gt(a,function(y){u[y]=Yi(s.get(y))}),u.snap=i.type!=="category"&&!!o,s.get("type")==="cross"&&(u.type="line");var f=u.label||(u.label={});if(f.show==null&&(f.show=!1),n==="cross"){var g=s.get(["label","show"]);if(f.show=g??!0,!o){var v=u.lineStyle=s.get("crossStyle");v&&rr(f,v.textStyle)}}return i.model.getModel("axisPointer",new bn(u,e,r))}function PIt(i,t){t.eachSeries(function(e){var r=e.coordinateSystem,n=e.get(["tooltip","trigger"],!0),o=e.get(["tooltip","show"],!0);!r||!r.model||n==="none"||n===!1||n==="item"||o===!1||e.get(["axisPointer","show"],!0)===!1||gt(i.coordSysAxesInfo[mS(r.model)],function(s){var a=s.axis;r.getAxis(a.dim)===a&&(s.seriesModels.push(e),s.seriesDataCount==null&&(s.seriesDataCount=0),s.seriesDataCount+=e.getData().count())})})}function LIt(i,t){for(var e=t.model,r=t.dim,n=0;n<i.length;n++){var o=i[n]||{};if(kR(o[r+"AxisId"],e.id)||kR(o[r+"AxisIndex"],e.componentIndex)||kR(o[r+"AxisName"],e.name))return n}}function kR(i,t){return i==="all"||Ye(i)&&Ar(i,t)>=0||i===t}function RIt(i){var t=O3(i);if(t){var e=t.axisPointerModel,r=t.axis.scale,n=e.option,o=e.get("status"),s=e.get("value");s!=null&&(s=r.parse(s));var a=jz(e);o==null&&(n.status=a?"show":"hide");var u=r.getExtent().slice();u[0]>u[1]&&u.reverse(),(s==null||s>u[1])&&(s=u[1]),s<u[0]&&(s=u[0]),n.value=s,a&&(n.status=t.axis.scale.isBlank()?"hide":"show")}}function O3(i){var t=(i.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return t&&t.axesInfo[mS(i)]}function kIt(i){var t=O3(i);return t&&t.axisPointerModel}function jz(i){return!!i.get(["handle","show"])}function mS(i){return i.type+"||"+i.id}var zW={},OIt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){this.axisPointerClass&&RIt(e),i.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(e,n,!0)},t.prototype.updateAxisPointer=function(e,r,n,o){this._doUpdateAxisPointerClass(e,n,!1)},t.prototype.remove=function(e,r){var n=this._axisPointer;n&&n.remove(r)},t.prototype.dispose=function(e,r){this._disposeAxisPointer(r),i.prototype.dispose.apply(this,arguments)},t.prototype._doUpdateAxisPointerClass=function(e,r,n){var o=t.getAxisPointerClass(this.axisPointerClass);if(o){var s=kIt(e);s?(this._axisPointer||(this._axisPointer=new o)).render(e,s,r,n):this._disposeAxisPointer(r)}},t.prototype._disposeAxisPointer=function(e){this._axisPointer&&this._axisPointer.dispose(e),this._axisPointer=null},t.registerAxisPointerClass=function(e,r){zW[e]=r},t.getAxisPointerClass=function(e){return e&&zW[e]},t.type="axis",t}(Oa);const Pv=OIt;var Wz=Wr();function xet(i,t,e,r){var n=e.axis;if(!n.scale.isBlank()){var o=e.getModel("splitArea"),s=o.getModel("areaStyle"),a=s.get("color"),u=r.coordinateSystem.getRect(),f=n.getTicksCoords({tickModel:o,clamp:!0,breakTicks:"none",pruneByBreak:"preserve_extent_bound"});if(f.length){var g=a.length,v=Wz(i).splitAreaColors,y=Fi(),w=0;if(v)for(var I=0;I<f.length;I++){var E=v.get(f[I].tickValue);if(E!=null){w=(E+(g-1)*I)%g;break}}var D=n.toGlobalCoord(f[0].coord),R=s.getAreaStyle();a=Ye(a)?a:[a];for(var I=1;I<f.length;I++){var z=n.toGlobalCoord(f[I].coord),N=void 0,H=void 0,$=void 0,X=void 0;n.isHorizontal()?(N=D,H=u.y,$=z-N,X=u.height,D=N+$):(N=u.x,H=D,$=u.width,X=z-H,D=H+X);var K=f[I-1].tickValue;K!=null&&y.set(K,w),t.add(new jr({anid:K!=null?"area_"+K:null,shape:{x:N,y:H,width:$,height:X},style:rr({fill:a[w]},R),autoBatch:!0,silent:!0})),w=(w+1)%g}Wz(i).splitAreaColors=y}}}function bet(i){Wz(i).splitAreaColors=null}var zIt=["splitArea","splitLine","minorSplitLine","breakArea"],wet=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="CartesianAxisPointer",e}return t.prototype.render=function(e,r,n,o){this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new Ki,this.group.add(this._axisGroup),!!fS(e)){this._axisGroup.add(e.axis.axisBuilder.group),gt(zIt,function(u){e.get([u,"show"])&&BIt[u](this,this._axisGroup,e,e.getCoordSysModel(),n)},this);var a=o&&o.type==="changeAxisOrder"&&o.isInitSort;a||zS(s,this._axisGroup,e),i.prototype.render.call(this,e,r,n,o)}},t.prototype.remove=function(){bet(this)},t.type="cartesianAxis",t}(Pv),BIt={splitLine:function(i,t,e,r,n){var o=e.axis;if(!o.scale.isBlank()){var s=e.getModel("splitLine"),a=s.getModel("lineStyle"),u=a.get("color"),f=s.get("showMinLine")!==!1,g=s.get("showMaxLine")!==!1;u=Ye(u)?u:[u];for(var v=r.coordinateSystem.getRect(),y=o.isHorizontal(),w=0,I=o.getTicksCoords({tickModel:s,breakTicks:"none",pruneByBreak:"preserve_extent_bound"}),E=[],D=[],R=a.getLineStyle(),z=0;z<I.length;z++){var N=o.toGlobalCoord(I[z].coord);if(!(z===0&&!f||z===I.length-1&&!g)){var H=I[z].tickValue;y?(E[0]=N,E[1]=v.y,D[0]=N,D[1]=v.y+v.height):(E[0]=v.x,E[1]=N,D[0]=v.x+v.width,D[1]=N);var $=w++%u.length,X=new Ro({anid:H!=null?"line_"+H:null,autoBatch:!0,shape:{x1:E[0],y1:E[1],x2:D[0],y2:D[1]},style:rr({stroke:u[$]},R),silent:!0});b0(X.shape,R.lineWidth),t.add(X)}}}},minorSplitLine:function(i,t,e,r,n){var o=e.axis,s=e.getModel("minorSplitLine"),a=s.getModel("lineStyle"),u=r.coordinateSystem.getRect(),f=o.isHorizontal(),g=o.getMinorTicksCoords();if(g.length)for(var v=[],y=[],w=a.getLineStyle(),I=0;I<g.length;I++)for(var E=0;E<g[I].length;E++){var D=o.toGlobalCoord(g[I][E].coord);f?(v[0]=D,v[1]=u.y,y[0]=D,y[1]=u.y+u.height):(v[0]=u.x,v[1]=D,y[0]=u.x+u.width,y[1]=D);var R=new Ro({anid:"minor_line_"+g[I][E].tickValue,autoBatch:!0,shape:{x1:v[0],y1:v[1],x2:y[0],y2:y[1]},style:w,silent:!0});b0(R.shape,w.lineWidth),t.add(R)}},splitArea:function(i,t,e,r,n){xet(i,t,e,r)},breakArea:function(i,t,e,r,n){var o=qS(),s=e.axis.scale;o&&s.type!=="ordinal"&&o.rectCoordBuildBreakAxis(t,i,e,r.coordinateSystem.getRect(),n)}},Tet=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="xAxis",t}(wet),FIt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=Tet.type,e}return t.type="yAxis",t}(wet),NIt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="grid",e}return t.prototype.render=function(e,r){this.group.removeAll(),e.get("show")&&this.group.add(new jr({shape:e.coordinateSystem.getRect(),style:rr({fill:e.get("backgroundColor")},e.getItemStyle()),silent:!0,z2:-1}))},t.type="grid",t}(Oa),BW={offset:0};function Aet(i){i.registerComponentView(NIt),i.registerComponentModel(HAt),i.registerCoordinateSystem("cartesian2d",MIt),M0(i,"x",Fz,BW),M0(i,"y",Fz,BW),i.registerComponentView(Tet),i.registerComponentView(FIt),i.registerPreprocessor(function(t){t.xAxis&&t.yAxis&&!t.grid&&(t.grid={})})}function VIt(i,t){var e=i.coordinateSystem,r=e&&e.type,n=e&&e.getBaseAxis&&e.getBaseAxis(),o=n&&n.scale&&n.scale.type,s=r==="cartesian2d"&&o==="ordinal"||r==="single",a=t.model.get("jitter")>0;return s&&a}var UIt=Wr();function FW(i,t,e,r){if(i instanceof set){var n=i.scale.type;if(n!=="category"&&n!=="ordinal")return e}var o=i.model,s=o.get("jitter"),a=o.get("jitterOverlap"),u=o.get("jitterMargin")||0,f=i.scale.type==="ordinal"?i.getBandWidth():null;return s>0?a?Iet(e,s,f,r):GIt(i,t,e,r,s,u):e}function Iet(i,t,e,r){if(e===null)return i+(Math.random()-.5)*t;var n=e-r*2,o=Math.min(Math.max(0,t),n);return i+(Math.random()-.5)*o}function GIt(i,t,e,r,n,o){var s=UIt(i);s.items||(s.items=[]);var a=s.items,u=NW(a,t,e,r,n,o,1),f=NW(a,t,e,r,n,o,-1),g=Math.abs(u-e)<Math.abs(f-e)?u:f,v=i.scale.type==="ordinal"?i.getBandWidth():null,y=Math.abs(g-e);return y>n/2||v&&y>v/2-r?Iet(e,n,v,r):(a.push({fixedCoord:t,floatCoord:g,r}),g)}function NW(i,t,e,r,n,o,s){for(var a=e,u=0;u<i.length;u++){var f=i[u],g=t-f.fixedCoord,v=a-f.floatCoord,y=g*g+v*v,w=r+f.r+o;if(y<w*w){var I=f.floatCoord+Math.sqrt(w*w-g*g)*s;if(Math.abs(I-e)>n/2)return Number.MAX_VALUE;if(s===1&&I>a||s===-1&&I<a){a=I,u=-1;continue}}}return a}function HIt(i){i.eachSeriesByType("scatter",function(t){var e=t.coordinateSystem;if(e&&(e.type==="cartesian2d"||e.type==="single")){var r=e.getBaseAxis?e.getBaseAxis():null,n=r&&VIt(t,r);if(n){var o=t.getData();o.each(function(s){var a=r.dim,u=r.orient,f=u==="horizontal"&&r.type!=="category"||u==="vertical"&&r.type==="category",g=o.getItemLayout(s),v=o.getItemVisual(s,"symbolSize"),y=v instanceof Array?(v[1]+v[0])/2:v;if(a==="y"||a==="single"&&f){var w=FW(r,g[0],g[1],y/2);o.setItemLayout(s,[g[0],w])}else if(a==="x"||a==="single"&&!f){var w=FW(r,g[1],g[0],y/2);o.setItemLayout(s,[w,g[1]])}})}}})}function jIt(i){Rr(Aet),i.registerSeriesModel(OAt),i.registerChartView(UAt),i.registerLayout(ZS("scatter"))}function WIt(i){i.registerLayout(i.PRIORITY.VISUAL.POST_CHART_LAYOUT,HIt)}function $It(i){i.eachSeriesByType("radar",function(t){var e=t.getData(),r=[],n=t.coordinateSystem;if(n){var o=n.getIndicatorAxes();gt(o,function(s,a){e.each(e.mapDimension(o[a].dim),function(u,f){r[f]=r[f]||[];var g=n.dataToPoint(u,a);r[f][a]=VW(g)?g:UW(n)})}),e.each(function(s){var a=bv(r[s],function(u){return VW(u)})||UW(n);r[s].push(a.slice()),e.setItemLayout(s,r[s])})}})}function VW(i){return!isNaN(i[0])&&!isNaN(i[1])}function UW(i){return[i.cx,i.cy]}function ZIt(i){var t=i.polar;if(t){Ye(t)||(t=[t]);var e=[];gt(t,function(r,n){r.indicator?(r.type&&!r.shape&&(r.shape=r.type),i.radar=i.radar||[],Ye(i.radar)||(i.radar=[i.radar]),i.radar.push(r)):e.push(r)}),i.polar=e}gt(i.series,function(r){r&&r.type==="radar"&&r.polarIndex&&(r.radarIndex=r.polarIndex)})}var qIt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.coordinateSystem,s=this.group,a=e.getData(),u=this._data;function f(y,w){var I=y.getItemVisual(w,"symbol")||"circle";if(I!=="none"){var E=Z0(y.getItemVisual(w,"symbolSize")),D=bo(I,-1,-1,2,2),R=y.getItemVisual(w,"symbolRotate")||0;return D.attr({style:{strokeNoScale:!0},z2:100,scaleX:E[0]/2,scaleY:E[1]/2,rotation:R*Math.PI/180||0}),D}}function g(y,w,I,E,D,R){I.removeAll();for(var z=0;z<w.length-1;z++){var N=f(E,D);N&&(N.__dimIdx=z,y[z]?(N.setPosition(y[z]),Tv[R?"initProps":"updateProps"](N,{x:w[z][0],y:w[z][1]},e,D)):N.setPosition(w[z]),I.add(N))}}function v(y){return ti(y,function(w){return[o.cx,o.cy]})}a.diff(u).add(function(y){var w=a.getItemLayout(y);if(w){var I=new gl,E=new Us,D={shape:{points:w}};I.shape.points=v(w),E.shape.points=v(w),ya(I,D,e,y),ya(E,D,e,y);var R=new Ki,z=new Ki;R.add(E),R.add(I),R.add(z),g(E.shape.points,w,z,a,y,!0),a.setItemGraphicEl(y,R)}}).update(function(y,w){var I=u.getItemGraphicEl(w),E=I.childAt(0),D=I.childAt(1),R=I.childAt(2),z={shape:{points:a.getItemLayout(y)}};z.shape.points&&(g(E.shape.points,z.shape.points,R,a,y,!1),Oc(D),Oc(E),yn(E,z,e),yn(D,z,e),a.setItemGraphicEl(y,I))}).remove(function(y){s.remove(u.getItemGraphicEl(y))}).execute(),a.eachItemGraphicEl(function(y,w){var I=a.getItemModel(w),E=y.childAt(0),D=y.childAt(1),R=y.childAt(2),z=a.getItemVisual(w,"style"),N=z.fill;s.add(y),E.useStyle(rr(I.getModel("lineStyle").getLineStyle(),{fill:"none",stroke:N})),Oo(E,I,"lineStyle"),Oo(D,I,"areaStyle");var H=I.getModel("areaStyle"),$=H.isEmpty()&&H.parentModel.isEmpty();D.ignore=$,gt(["emphasis","select","blur"],function(K){var et=I.getModel([K,"areaStyle"]),rt=et.isEmpty()&&et.parentModel.isEmpty();D.ensureState(K).ignore=rt&&$;var lt=I.getModel([K,"lineStyle"]).getLineStyle();E.ensureState(K).style=lt;var ht=et.getAreaStyle();D.ensureState(K).style=ht;var yt=I.getModel([K,"itemStyle"]).getItemStyle();R.eachChild(function(ft){ft.ensureState(K).style=Yi(yt)})}),D.useStyle(rr(I.getModel("areaStyle").getAreaStyle(),{fill:N,opacity:.7,decal:z.decal}));var X=I.getModel("emphasis");R.eachChild(function(K){if(K instanceof ys){var et=K.style;K.useStyle(Fe({image:et.image,x:et.x,y:et.y,width:et.width,height:et.height},z))}else K.useStyle(z),K.setColor(N),K.style.strokeNoScale=!0;var rt=a.getStore().get(a.getDimensionIndex(K.__dimIdx),w);(rt==null||isNaN(rt))&&(rt=""),qo(K,zo(I),{labelFetcher:a.hostModel,labelDataIndex:w,labelDimIndex:K.__dimIdx,defaultText:rt,inheritColor:N,defaultOpacity:z.opacity})}),Ma(y,X.get("focus"),X.get("blurScope"),X.get("disabled"))}),this._data=a},t.prototype.remove=function(){this.group.removeAll(),this._data=null},t.type="radar",t}(pa);const XIt=qIt;var YIt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new K0(wi(this.getData,this),wi(this.getRawData,this))},t.prototype.getInitialData=function(e,r){return Y0(this,{generateCoord:"indicator_",generateCoordCount:1/0})},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=this.coordinateSystem,a=s.getIndicatorAxes(),u=this.getData().getName(e),f=u===""?this.name:u,g=nQ(this,e);return xo("section",{header:f,sortBlocks:!0,blocks:ti(a,function(v){var y=o.get(o.mapDimension(v.dim),e);return xo("nameValue",{markerType:"subItem",markerColor:g,name:v.name,value:y,sortParam:y})})})},t.prototype.getTooltipPosition=function(e){if(e!=null){for(var r=this.getData(),n=this.coordinateSystem,o=r.getValues(ti(n.dimensions,function(f){return r.mapDimension(f)}),e),s=0,a=o.length;s<a;s++)if(!isNaN(o[s])){var u=n.getIndicatorAxes();return n.coordToPoint(u[s].dataToCoord(o[s]),s)}}},t.type="series.radar",t.dependencies=["radar"],t.defaultOption={z:2,colorBy:"data",coordinateSystem:"radar",legendHoverLink:!0,radarIndex:0,lineStyle:{width:2,type:"solid",join:"round"},label:{position:"top"},symbolSize:8},t}(Ea);const KIt=YIt;var Cb=oet.value;function XA(i,t){return rr({show:t},i)}var JIt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){var e=this.get("boundaryGap"),r=this.get("splitNumber"),n=this.get("scale"),o=this.get("axisLine"),s=this.get("axisTick"),a=this.get("axisLabel"),u=this.get("axisName"),f=this.get(["axisName","show"]),g=this.get(["axisName","formatter"]),v=this.get("axisNameGap"),y=this.get("triggerEvent"),w=ti(this.get("indicator")||[],function(I){I.max!=null&&I.max>0&&!I.min?I.min=0:I.min!=null&&I.min<0&&!I.max&&(I.max=0);var E=u;I.color!=null&&(E=rr({color:I.color},u));var D=Er(Yi(I),{boundaryGap:e,splitNumber:r,scale:n,axisLine:o,axisTick:s,axisLabel:a,name:I.text,showName:f,nameLocation:"end",nameGap:v,nameTextStyle:E,triggerEvent:y},!1);if(bi(g)){var R=D.name;D.name=g.replace("{value}",R??"")}else Xi(g)&&(D.name=g(D.name,D));var z=new bn(D,null,this.ecModel);return wo(z,HS.prototype),z.mainType="radar",z.componentIndex=this.componentIndex,z},this);this._indicatorModels=w},t.prototype.getIndicatorModels=function(){return this._indicatorModels},t.type="radar",t.defaultOption={z:0,center:["50%","50%"],radius:"50%",startAngle:90,axisName:{show:!0,color:_e.color.axisLabel},boundaryGap:[0,0],splitNumber:5,axisNameGap:15,scale:!1,shape:"polygon",axisLine:Er({lineStyle:{color:_e.color.neutral20}},Cb.axisLine),axisLabel:XA(Cb.axisLabel,!1),axisTick:XA(Cb.axisTick,!1),splitLine:XA(Cb.splitLine,!0),splitArea:XA(Cb.splitArea,!0),indicator:[]},t}(gn);const QIt=JIt;var tMt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=this.group;o.removeAll(),this._buildAxes(e,n),this._buildSplitLineAndArea(e)},t.prototype._buildAxes=function(e,r){var n=e.coordinateSystem,o=n.getIndicatorAxes(),s=ti(o,function(a){var u=a.model.get("showName")?a.name:"",f=new zd(a.model,r,{axisName:u,position:[n.cx,n.cy],rotation:a.angle,labelDirection:-1,tickDirection:-1,nameDirection:1});return f});gt(s,function(a){a.build(),this.group.add(a.group)},this)},t.prototype._buildSplitLineAndArea=function(e){var r=e.coordinateSystem,n=r.getIndicatorAxes();if(!n.length)return;var o=e.get("shape"),s=e.getModel("splitLine"),a=e.getModel("splitArea"),u=s.getModel("lineStyle"),f=a.getModel("areaStyle"),g=s.get("show"),v=a.get("show"),y=u.get("color"),w=f.get("color"),I=Ye(y)?y:[y],E=Ye(w)?w:[w],D=[],R=[];function z(Rt,Ct,Gt){var Vt=Gt%Ct.length;return Rt[Vt]=Rt[Vt]||[],Vt}if(o==="circle")for(var N=n[0].getTicksCoords(),H=r.cx,$=r.cy,X=0;X<N.length;X++){if(g){var K=z(D,I,X);D[K].push(new Gp({shape:{cx:H,cy:$,r:N[X].coord}}))}if(v&&X<N.length-1){var K=z(R,E,X);R[K].push(new uE({shape:{cx:H,cy:$,r0:N[X].coord,r:N[X+1].coord}}))}}else for(var et,rt=ti(n,function(Rt,Ct){var Gt=Rt.getTicksCoords();return et=et==null?Gt.length-1:Math.min(Gt.length-1,et),ti(Gt,function(Vt){return r.coordToPoint(Vt.coord,Ct)})}),lt=[],X=0;X<=et;X++){for(var ht=[],yt=0;yt<n.length;yt++)ht.push(rt[yt][X]);if(ht[0]&&ht.push(ht[0].slice()),g){var K=z(D,I,X);D[K].push(new Us({shape:{points:ht}}))}if(v&&lt){var K=z(R,E,X-1);R[K].push(new gl({shape:{points:ht.concat(lt)}}))}lt=ht.slice().reverse()}var ft=u.getLineStyle(),kt=f.getAreaStyle();gt(R,function(Rt,Ct){this.group.add(Mc(Rt,{style:rr({stroke:"none",fill:E[Ct%E.length]},kt),silent:!0}))},this),gt(D,function(Rt,Ct){this.group.add(Mc(Rt,{style:rr({fill:"none",stroke:I[Ct%I.length]},ft),silent:!0}))},this)},t.type="radar",t}(Oa);const eMt=tMt;var iMt=function(i){we(t,i);function t(e,r,n){var o=i.call(this,e,r,n)||this;return o.type="value",o.angle=0,o.name="",o}return t}(bu);const rMt=iMt;var nMt=function(){function i(t,e,r){this.dimensions=[],this._model=t,this._indicatorAxes=ti(t.getIndicatorModels(),function(n,o){var s="indicator_"+o,a=new rMt(s,new Rp);return a.name=n.get("name"),a.model=n,n.axis=a,this.dimensions.push(s),a},this),this.resize(t,r)}return i.prototype.getIndicatorAxes=function(){return this._indicatorAxes},i.prototype.dataToPoint=function(t,e){var r=this._indicatorAxes[e];return this.coordToPoint(r.dataToCoord(t),e)},i.prototype.coordToPoint=function(t,e){var r=this._indicatorAxes[e],n=r.angle,o=this.cx+t*Math.cos(n),s=this.cy-t*Math.sin(n);return[o,s]},i.prototype.pointToData=function(t){var e=t[0]-this.cx,r=t[1]-this.cy,n=Math.sqrt(e*e+r*r);e/=n,r/=n;for(var o=Math.atan2(-r,e),s=1/0,a,u=-1,f=0;f<this._indicatorAxes.length;f++){var g=this._indicatorAxes[f],v=Math.abs(o-g.angle);v<s&&(a=g,u=f,s=v)}return[u,+(a&&a.coordToData(n))]},i.prototype.resize=function(t,e){var r=Bo(t,e).refContainer,n=t.get("center"),o=Math.min(r.width,r.height)/2;this.cx=xi(n[0],r.width)+r.x,this.cy=xi(n[1],r.height)+r.y,this.startAngle=t.get("startAngle")*Math.PI/180;var s=t.get("radius");(bi(s)||fn(s))&&(s=[0,s]),this.r0=xi(s[0],o),this.r=xi(s[1],o),gt(this._indicatorAxes,function(a,u){a.setExtent(this.r0,this.r);var f=this.startAngle+u*Math.PI*2/this._indicatorAxes.length;f=Math.atan2(Math.sin(f),Math.cos(f)),a.angle=f},this)},i.prototype.update=function(t,e){var r=this._indicatorAxes,n=this._model;gt(r,function(a){a.scale.setExtent(1/0,-1/0)}),t.eachSeriesByType("radar",function(a,u){if(!(a.get("coordinateSystem")!=="radar"||t.getComponent("radar",a.get("radarIndex"))!==n)){var f=a.getData();gt(r,function(g){g.scale.unionExtentFromData(f,f.mapDimension(g.dim))})}},this);var o=n.get("splitNumber"),s=new Rp;s.setExtent(0,o),s.setInterval(1),gt(r,function(a,u){_et(a.scale,a.model,s)})},i.prototype.convertToPixel=function(t,e,r){return console.warn("Not implemented."),null},i.prototype.convertFromPixel=function(t,e,r){return console.warn("Not implemented."),null},i.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},i.create=function(t,e){var r=[];return t.eachComponent("radar",function(n){var o=new i(n,t,e);r.push(o),n.coordinateSystem=o}),t.eachSeriesByType("radar",function(n){n.get("coordinateSystem")==="radar"&&(n.coordinateSystem=r[n.get("radarIndex")||0])}),r},i.dimensions=[],i}();const aMt=nMt;function oMt(i){i.registerCoordinateSystem("radar",aMt),i.registerComponentModel(QIt),i.registerComponentView(eMt),i.registerVisual({seriesType:"radar",reset:function(t){var e=t.getData();e.each(function(r){e.setItemVisual(r,"legendIcon","roundRect")}),e.setVisual("legendIcon","roundRect")}})}function sMt(i){Rr(oMt),i.registerChartView(XIt),i.registerSeriesModel(KIt),i.registerLayout($It),i.registerProcessor(X0("radar")),i.registerPreprocessor(ZIt)}var z3=Wr();function lMt(i,t,e){z3(i)[t]=e}function cMt(i,t,e){var r=z3(i),n=r[t];n===e&&(r[t]=null)}function GW(i,t){return!!z3(i)[t]}Ah({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},uo);var uMt={axisPointer:1,tooltip:1,brush:1};function Met(i,t,e){var r=t.getComponentByElement(i.topTarget);if(!r||r===e||uMt.hasOwnProperty(r.mainType))return!1;var n=r.coordinateSystem;if(!n||n.model===e)return!1;var o=vv(r),s=vv(e);return!((o.zlevel-s.zlevel||o.z-s.z)<=0)}var hMt=function(i){we(t,i);function t(e){var r=i.call(this)||this;r._zr=e;var n=wi(r._mousedownHandler,r),o=wi(r._mousemoveHandler,r),s=wi(r._mouseupHandler,r),a=wi(r._mousewheelHandler,r),u=wi(r._pinchHandler,r);return r.enable=function(f,g){var v=g.zInfo,y=vv(v.component),w=y.z,I=y.zlevel,E={component:v.component,z:w,zlevel:I,z2:Ui(v.z2,-1/0)},D=Fe({},g.triggerInfo);this._opt=rr(Fe({},g),{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0,zInfoParsed:E,triggerInfo:D}),f==null&&(f=!0),(!this._enabled||this._controlType!==f)&&(this._enabled=!0,this.disable(),(f===!0||f==="move"||f==="pan")&&(Db(e,"mousedown",n,E),Db(e,"mousemove",o,E),Db(e,"mouseup",s,E)),(f===!0||f==="scale"||f==="zoom")&&(Db(e,"mousewheel",a,E),Db(e,"pinch",u,E)))},r.disable=function(){this._enabled=!1,Pb(e,"mousedown",n),Pb(e,"mousemove",o),Pb(e,"mouseup",s),Pb(e,"mousewheel",a),Pb(e,"pinch",u)},r}return t.prototype.isDragging=function(){return this._dragging},t.prototype.isPinching=function(){return this._pinching},t.prototype._checkPointer=function(e,r,n){var o=this._opt,s=o.zInfoParsed;if(Met(e,o.api,s.component))return!1;var a=o.triggerInfo,u=a.roamTrigger,f=!1;return u==="global"&&(f=!0),f||(f=a.isInSelf(e,r,n)),f&&a.isInClip&&!a.isInClip(e,r,n)&&(f=!1),f},t.prototype._decideCursorStyle=function(e,r,n,o){var s=e.target;if(!s&&this._checkPointer(e,r,n))return"grab";if(o)return s&&s.cursor||"default"},t.prototype.dispose=function(){this.disable()},t.prototype._mousedownHandler=function(e){if(!(aH(e)||Eb(e))){for(var r=e.target;r;){if(r.draggable)return;r=r.__hostTarget||r.parent}var n=e.offsetX,o=e.offsetY;this._checkPointer(e,n,o)&&(this._x=n,this._y=o,this._dragging=!0)}},t.prototype._mousemoveHandler=function(e){var r=this._zr;if(!(e.gestureEvent==="pinch"||GW(r,"globalPan")||Eb(e))){var n=e.offsetX,o=e.offsetY;if(!this._dragging||!QI("moveOnMouseMove",e,this._opt)){var s=this._decideCursorStyle(e,n,o,!1);s&&r.setCursorStyle(s);return}r.setCursorStyle("grabbing");var a=this._x,u=this._y,f=n-a,g=o-u;this._x=n,this._y=o,this._opt.preventDefaultMouseMove&&Pd(e.event),e.__ecRoamConsumed=!0,HW(this,"pan","moveOnMouseMove",e,{dx:f,dy:g,oldX:a,oldY:u,newX:n,newY:o,isAvailableBehavior:null})}},t.prototype._mouseupHandler=function(e){if(!Eb(e)){var r=this._zr;if(!aH(e)){this._dragging=!1;var n=this._decideCursorStyle(e,e.offsetX,e.offsetY,!0);n&&r.setCursorStyle(n)}}},t.prototype._mousewheelHandler=function(e){if(!Eb(e)){var r=QI("zoomOnMouseWheel",e,this._opt),n=QI("moveOnMouseWheel",e,this._opt),o=e.wheelDelta,s=Math.abs(o),a=e.offsetX,u=e.offsetY;if(!(o===0||!r&&!n)){if(r){var f=s>3?1.4:s>1?1.2:1.1,g=o>0?f:1/f;this._checkTriggerMoveZoom(this,"zoom","zoomOnMouseWheel",e,{scale:g,originX:a,originY:u,isAvailableBehavior:null})}if(n){var v=Math.abs(o),y=(o>0?1:-1)*(v>3?.4:v>1?.15:.05);this._checkTriggerMoveZoom(this,"scrollMove","moveOnMouseWheel",e,{scrollDelta:y,originX:a,originY:u,isAvailableBehavior:null})}}}},t.prototype._pinchHandler=function(e){if(!(GW(this._zr,"globalPan")||Eb(e))){var r=e.pinchScale>1?1.1:1/1.1;this._checkTriggerMoveZoom(this,"zoom",null,e,{scale:r,originX:e.pinchX,originY:e.pinchY,isAvailableBehavior:null})}},t.prototype._checkTriggerMoveZoom=function(e,r,n,o,s){e._checkPointer(o,s.originX,s.originY)&&(Pd(o.event),o.__ecRoamConsumed=!0,HW(e,r,n,o,s))},t}(zc);function Eb(i){return i.__ecRoamConsumed}var dMt=Wr();function ME(i){var t=dMt(i);return t.roam=t.roam||{},t.uniform=t.uniform||{},t}function Db(i,t,e,r){for(var n=ME(i),o=n.roam,s=o[t]=o[t]||[],a=0;a<s.length;a++){var u=s[a].zInfoParsed;if((u.zlevel-r.zlevel||u.z-r.z||u.z2-r.z2)<=0)break}s.splice(a,0,{listener:e,zInfoParsed:r}),fMt(i,t)}function Pb(i,t,e){for(var r=ME(i),n=r.roam[t]||[],o=0;o<n.length;o++)if(n[o].listener===e){n.splice(o,1),n.length||pMt(i,t);return}}function fMt(i,t){var e=ME(i);e.uniform[t]||i.on(t,e.uniform[t]=function(r){var n=e.roam[t];if(n)for(var o=0;o<n.length;o++)n[o].listener(r)})}function pMt(i,t){var e=ME(i),r=e.uniform;r[t]&&(i.off(t,r[t]),r[t]=null)}function HW(i,t,e,r,n){n.isAvailableBehavior=wi(QI,null,e,r),i.trigger(t,n)}function QI(i,t,e){var r=e[i];return!i||r&&(!bi(r)||t.event[r+"Key"])}const Lv=hMt;function B3(i,t,e){var r=i.target;r.x+=t,r.y+=e,r.dirty()}function F3(i,t,e,r){var n=i.target,o=i.zoomLimit,s=i.zoom=i.zoom||1;s*=t,s=N3(s,o);var a=s/i.zoom;i.zoom=s,Eet(n,e,r,a),n.dirty()}function Cet(i,t,e,r,n,o){var s=new sr(0,0,0,0);r.enable(i.get("roam"),{api:t,zInfo:{component:i},triggerInfo:{roamTrigger:i.get("roamTrigger"),isInSelf:function(f,g,v){return s.copy(e.getBoundingRect()),s.applyTransform(e.getComputedTransform()),s.contain(g,v)},isInClip:function(f,g,v){return!o||o.contain(g,v)}}}),n.zoomLimit=i.get("scaleLimit");var a=i.coordinateSystem;n.zoom=a?a.getZoom():1;var u=i.subType+"Roam";r.off("pan").off("zoom").on("pan",function(f){B3(n,f.dx,f.dy),t.dispatchAction({seriesId:i.id,type:u,dx:f.dx,dy:f.dy})}).on("zoom",function(f){F3(n,f.scale,f.originX,f.originY),t.dispatchAction({seriesId:i.id,type:u,zoom:f.scale,originX:f.originX,originY:f.originY}),t.updateLabelLayout()})}function jW(i,t){return i.pointToProjected?i.pointToProjected(t):i.pointToData(t)}function CE(i,t,e){var r=i.getZoom(),n=i.getCenter(),o=t.zoom,s=i.projectedToPoint?i.projectedToPoint(n):i.dataToPoint(n);return t.dx!=null&&t.dy!=null&&(s[0]-=t.dx,s[1]-=t.dy,i.setCenter(jW(i,s))),o!=null&&(o=N3(r*o,e)/r,Eet(i,t.originX,t.originY,o),i.updateTransform(),i.setCenter(jW(i,s)),i.setZoom(o*r)),{center:i.getCenter(),zoom:i.getZoom()}}function Eet(i,t,e,r){i.x-=(t-i.x)*(r-1),i.y-=(e-i.y)*(r-1),i.scaleX*=r,i.scaleY*=r}function N3(i,t){if(t){var e=t.min||0,r=t.max||1/0;i=Math.max(Math.min(r,i),e)}return i}function Det(i){if(bi(i)){var t=new DOMParser;i=t.parseFromString(i,"text/xml")}var e=i;for(e.nodeType===9&&(e=e.firstChild);e.nodeName.toLowerCase()!=="svg"||e.nodeType!==1;)e=e.nextSibling;return e}var OR,sC={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},WW=on(sC),lC={"alignment-baseline":"textBaseline","stop-color":"stopColor"},$W=on(lC),gMt=function(){function i(){this._defs={},this._root=null}return i.prototype.parse=function(t,e){e=e||{};var r=Det(t);this._defsUsePending=[];var n=new Ki;this._root=n;var o=[],s=r.getAttribute("viewBox")||"",a=parseFloat(r.getAttribute("width")||e.width),u=parseFloat(r.getAttribute("height")||e.height);isNaN(a)&&(a=null),isNaN(u)&&(u=null),jl(r,n,null,!0,!1);for(var f=r.firstChild;f;)this._parseNode(f,n,o,null,!1,!1),f=f.nextSibling;_Mt(this._defs,this._defsUsePending),this._defsUsePending=[];var g,v;if(s){var y=EE(s);y.length>=4&&(g={x:parseFloat(y[0]||0),y:parseFloat(y[1]||0),width:parseFloat(y[2]),height:parseFloat(y[3])})}if(g&&a!=null&&u!=null&&(v=Let(g,{x:0,y:0,width:a,height:u}),!e.ignoreViewBox)){var w=n;n=new Ki,n.add(w),w.scaleX=w.scaleY=v.scale,w.x=v.x,w.y=v.y}return!e.ignoreRootClip&&a!=null&&u!=null&&n.setClipPath(new jr({shape:{x:0,y:0,width:a,height:u}})),{root:n,width:a,height:u,viewBoxRect:g,viewBoxTransform:v,named:o}},i.prototype._parseNode=function(t,e,r,n,o,s){var a=t.nodeName.toLowerCase(),u,f=n;if(a==="defs"&&(o=!0),a==="text"&&(s=!0),a==="defs"||a==="switch")u=e;else{if(!o){var g=OR[a];if(g&&Di(OR,a)){u=g.call(this,t,e);var v=t.getAttribute("name");if(v){var y={name:v,namedFrom:null,svgNodeTagLower:a,el:u};r.push(y),a==="g"&&(f=y)}else n&&r.push({name:n.name,namedFrom:n,svgNodeTagLower:a,el:u});e.add(u)}}var w=ZW[a];if(w&&Di(ZW,a)){var I=w.call(this,t),E=t.getAttribute("id");E&&(this._defs[E]=I)}}if(u&&u.isGroup)for(var D=t.firstChild;D;)D.nodeType===1?this._parseNode(D,u,r,f,o,s):D.nodeType===3&&s&&this._parseText(D,u),D=D.nextSibling},i.prototype._parseText=function(t,e){var r=new tS({style:{text:t.textContent},silent:!0,x:this._textX||0,y:this._textY||0});_c(e,r),jl(t,r,this._defsUsePending,!1,!1),mMt(r,e);var n=r.style,o=n.fontSize;o&&o<9&&(n.fontSize=9,r.scaleX*=o/9,r.scaleY*=o/9);var s=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=s;var a=r.getBoundingRect();return this._textX+=a.width,e.add(r),r},i.internalField=function(){OR={g:function(t,e){var r=new Ki;return _c(e,r),jl(t,r,this._defsUsePending,!1,!1),r},rect:function(t,e){var r=new jr;return _c(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({x:parseFloat(t.getAttribute("x")||"0"),y:parseFloat(t.getAttribute("y")||"0"),width:parseFloat(t.getAttribute("width")||"0"),height:parseFloat(t.getAttribute("height")||"0")}),r.silent=!0,r},circle:function(t,e){var r=new Gp;return _c(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),r:parseFloat(t.getAttribute("r")||"0")}),r.silent=!0,r},line:function(t,e){var r=new Ro;return _c(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({x1:parseFloat(t.getAttribute("x1")||"0"),y1:parseFloat(t.getAttribute("y1")||"0"),x2:parseFloat(t.getAttribute("x2")||"0"),y2:parseFloat(t.getAttribute("y2")||"0")}),r.silent=!0,r},ellipse:function(t,e){var r=new VF;return _c(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),rx:parseFloat(t.getAttribute("rx")||"0"),ry:parseFloat(t.getAttribute("ry")||"0")}),r.silent=!0,r},polygon:function(t,e){var r=t.getAttribute("points"),n;r&&(n=YW(r));var o=new gl({shape:{points:n||[]},silent:!0});return _c(e,o),jl(t,o,this._defsUsePending,!1,!1),o},polyline:function(t,e){var r=t.getAttribute("points"),n;r&&(n=YW(r));var o=new Us({shape:{points:n||[]},silent:!0});return _c(e,o),jl(t,o,this._defsUsePending,!1,!1),o},image:function(t,e){var r=new ys;return _c(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setStyle({image:t.getAttribute("xlink:href")||t.getAttribute("href"),x:+t.getAttribute("x"),y:+t.getAttribute("y"),width:+t.getAttribute("width"),height:+t.getAttribute("height")}),r.silent=!0,r},text:function(t,e){var r=t.getAttribute("x")||"0",n=t.getAttribute("y")||"0",o=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0";this._textX=parseFloat(r)+parseFloat(o),this._textY=parseFloat(n)+parseFloat(s);var a=new Ki;return _c(e,a),jl(t,a,this._defsUsePending,!1,!0),a},tspan:function(t,e){var r=t.getAttribute("x"),n=t.getAttribute("y");r!=null&&(this._textX=parseFloat(r)),n!=null&&(this._textY=parseFloat(n));var o=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0",a=new Ki;return _c(e,a),jl(t,a,this._defsUsePending,!1,!0),this._textX+=parseFloat(o),this._textY+=parseFloat(s),a},path:function(t,e){var r=t.getAttribute("d")||"",n=LK(r);return _c(e,n),jl(t,n,this._defsUsePending,!1,!1),n.silent=!0,n}}}(),i}(),ZW={lineargradient:function(i){var t=parseInt(i.getAttribute("x1")||"0",10),e=parseInt(i.getAttribute("y1")||"0",10),r=parseInt(i.getAttribute("x2")||"10",10),n=parseInt(i.getAttribute("y2")||"0",10),o=new V0(t,e,r,n);return qW(i,o),XW(i,o),o},radialgradient:function(i){var t=parseInt(i.getAttribute("cx")||"0",10),e=parseInt(i.getAttribute("cy")||"0",10),r=parseInt(i.getAttribute("r")||"0",10),n=new WK(t,e,r);return qW(i,n),XW(i,n),n}};function qW(i,t){var e=i.getAttribute("gradientUnits");e==="userSpaceOnUse"&&(t.global=!0)}function XW(i,t){for(var e=i.firstChild;e;){if(e.nodeType===1&&e.nodeName.toLocaleLowerCase()==="stop"){var r=e.getAttribute("offset"),n=void 0;r&&r.indexOf("%")>0?n=parseInt(r,10)/100:r?n=parseFloat(r):n=0;var o={};Pet(e,o,o);var s=o.stopColor||e.getAttribute("stop-color")||"#000000",a=o.stopOpacity||e.getAttribute("stop-opacity");if(a){var u=Ol(s),f=u&&u[3];f&&(u[3]*=xp(a),s=ph(u,"rgba"))}t.colorStops.push({offset:n,color:s})}e=e.nextSibling}}function _c(i,t){i&&i.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),rr(t.__inheritedStyle,i.__inheritedStyle))}function YW(i){for(var t=EE(i),e=[],r=0;r<t.length;r+=2){var n=parseFloat(t[r]),o=parseFloat(t[r+1]);e.push([n,o])}return e}function jl(i,t,e,r,n){var o=t,s=o.__inheritedStyle=o.__inheritedStyle||{},a={};i.nodeType===1&&(bMt(i,t),Pet(i,s,a),r||wMt(i,s,a)),o.style=o.style||{},s.fill!=null&&(o.style.fill=KW(o,"fill",s.fill,e)),s.stroke!=null&&(o.style.stroke=KW(o,"stroke",s.stroke,e)),gt(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(u){s[u]!=null&&(o.style[u]=parseFloat(s[u]))}),gt(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(u){s[u]!=null&&(o.style[u]=s[u])}),n&&(o.__selfStyle=a),s.lineDash&&(o.style.lineDash=ti(EE(s.lineDash),function(u){return parseFloat(u)})),(s.visibility==="hidden"||s.visibility==="collapse")&&(o.invisible=!0),s.display==="none"&&(o.ignore=!0)}function mMt(i,t){var e=t.__selfStyle;if(e){var r=e.textBaseline,n=r;!r||r==="auto"||r==="baseline"?n="alphabetic":r==="before-edge"||r==="text-before-edge"?n="top":r==="after-edge"||r==="text-after-edge"?n="bottom":(r==="central"||r==="mathematical")&&(n="middle"),i.style.textBaseline=n}var o=t.__inheritedStyle;if(o){var s=o.textAlign,a=s;s&&(s==="middle"&&(a="center"),i.style.textAlign=a)}}var vMt=/^url\(\s*#(.*?)\)/;function KW(i,t,e,r){var n=e&&e.match(vMt);if(n){var o=Ec(n[1]);r.push([i,t,o]);return}return e==="none"&&(e=null),e}function _Mt(i,t){for(var e=0;e<t.length;e++){var r=t[e];r[0].style[r[1]]=i[r[2]]}}var yMt=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function EE(i){return i.match(yMt)||[]}var xMt=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,zR=Math.PI/180;function bMt(i,t){var e=i.getAttribute("transform");if(e){e=e.replace(/,/g," ");var r=[],n=null;e.replace(xMt,function(v,y,w){return r.push(y,w),""});for(var o=r.length-1;o>0;o-=2){var s=r[o],a=r[o-1],u=EE(s);switch(n=n||ns(),a){case"translate":xh(n,n,[parseFloat(u[0]),parseFloat(u[1]||"0")]);break;case"scale":bF(n,n,[parseFloat(u[0]),parseFloat(u[1]||u[0])]);break;case"rotate":Up(n,n,-parseFloat(u[0])*zR,[parseFloat(u[1]||"0"),parseFloat(u[2]||"0")]);break;case"skewX":var f=Math.tan(parseFloat(u[0])*zR);fh(n,[1,0,f,1,0,0],n);break;case"skewY":var g=Math.tan(parseFloat(u[0])*zR);fh(n,[1,g,0,1,0,0],n);break;case"matrix":n[0]=parseFloat(u[0]),n[1]=parseFloat(u[1]),n[2]=parseFloat(u[2]),n[3]=parseFloat(u[3]),n[4]=parseFloat(u[4]),n[5]=parseFloat(u[5]);break}}t.setLocalTransform(n)}}var JW=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Pet(i,t,e){var r=i.getAttribute("style");if(r){JW.lastIndex=0;for(var n;(n=JW.exec(r))!=null;){var o=n[1],s=Di(sC,o)?sC[o]:null;s&&(t[s]=n[2]);var a=Di(lC,o)?lC[o]:null;a&&(e[a]=n[2])}}}function wMt(i,t,e){for(var r=0;r<WW.length;r++){var n=WW[r],o=i.getAttribute(n);o!=null&&(t[sC[n]]=o)}for(var r=0;r<$W.length;r++){var n=$W[r],o=i.getAttribute(n);o!=null&&(e[lC[n]]=o)}}function Let(i,t){var e=t.width/i.width,r=t.height/i.height,n=Math.min(e,r);return{scale:n,x:-(i.x+i.width/2)*n+(t.x+t.width/2),y:-(i.y+i.height/2)*n+(t.y+t.height/2)}}function SMt(i,t){var e=new gMt;return e.parse(i,t)}var TMt=Fi(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),AMt=function(){function i(t,e){this.type="geoSVG",this._usedGraphicMap=Fi(),this._freedGraphics=[],this._mapName=t,this._parsedXML=Det(e)}return i.prototype.load=function(){var t=this._firstGraphic;if(!t){t=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(t),this._boundingRect=this._firstGraphic.boundingRect.clone();var e=MMt(t.named),r=e.regions,n=e.regionsMap;this._regions=r,this._regionsMap=n}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},i.prototype._buildGraphic=function(t){var e,r;try{e=t&&SMt(t,{ignoreViewBox:!0,ignoreRootClip:!0})||{},r=e.root,Vs(r!=null)}catch(D){throw new Error(`Invalid svg format
`+D.message)}var n=new Ki;n.add(r),n.isGeoSVGGraphicRoot=!0;var o=e.width,s=e.height,a=e.viewBoxRect,u=this._boundingRect;if(!u){var f=void 0,g=void 0,v=void 0,y=void 0;if(o!=null?(f=0,v=o):a&&(f=a.x,v=a.width),s!=null?(g=0,y=s):a&&(g=a.y,y=a.height),f==null||g==null){var w=r.getBoundingRect();f==null&&(f=w.x,v=w.width),g==null&&(g=w.y,y=w.height)}u=this._boundingRect=new sr(f,g,v,y)}if(a){var I=Let(a,u);r.scaleX=r.scaleY=I.scale,r.x=I.x,r.y=I.y}n.setClipPath(new jr({shape:u.plain()}));var E=[];return gt(e.named,function(D){TMt.get(D.svgNodeTagLower)!=null&&(E.push(D),IMt(D.el))}),{root:n,boundingRect:u,named:E}},i.prototype.useGraphic=function(t){var e=this._usedGraphicMap,r=e.get(t);return r||(r=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),e.set(t,r),r)},i.prototype.freeGraphic=function(t){var e=this._usedGraphicMap,r=e.get(t);r&&(e.removeKey(t),this._freedGraphics.push(r))},i}();function IMt(i){i.silent=!1,i.isGroup&&i.traverse(function(t){t.silent=!1})}function MMt(i){var t=[],e=Fi();return gt(i,function(r){if(r.namedFrom==null){var n=new hTt(r.name,r.el);t.push(n),e.set(r.name,n)}}),{regions:t,regionsMap:e}}var $z=[126,25],QW="",Dm=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]];for(var Tm=0;Tm<Dm.length;Tm++)for(var My=0;My<Dm[Tm].length;My++)Dm[Tm][My][0]/=10.5,Dm[Tm][My][1]/=-10.5/.75,Dm[Tm][My][0]+=$z[0],Dm[Tm][My][1]+=$z[1];function CMt(i,t){if(i==="china"){for(var e=0;e<t.length;e++)if(t[e].name===QW)return;t.push(new htt(QW,ti(Dm,function(r){return{type:"polygon",exterior:r}}),$z))}}var EMt={:[32,80],:[0,-10],:[10,5],:[-10,10],:[5,5]};function DMt(i,t){if(i==="china"){var e=EMt[t.name];if(e){var r=t.getCenter();r[0]+=e[0]/10.5,r[1]+=-e[1]/(10.5/.75),t.setCenter(r)}}}var PMt=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];function LMt(i,t){i==="china"&&t.name===""&&t.geometries.push({type:"polygon",exterior:PMt[0]})}var RMt="name",kMt=function(){function i(t,e,r){this.type="geoJSON",this._parsedMap=Fi(),this._mapName=t,this._specialAreas=r,this._geoJSON=zMt(e)}return i.prototype.load=function(t,e){e=e||RMt;var r=this._parsedMap.get(e);if(!r){var n=this._parseToRegions(e);r=this._parsedMap.set(e,{regions:n,boundingRect:OMt(n)})}var o=Fi(),s=[];return gt(r.regions,function(a){var u=a.name;t&&Di(t,u)&&(a=a.cloneShallow(u=t[u])),s.push(a),o.set(u,a)}),{regions:s,boundingRect:r.boundingRect||new sr(0,0,0,0),regionsMap:o}},i.prototype._parseToRegions=function(t){var e=this._mapName,r=this._geoJSON,n;try{n=r?fTt(r,t):[]}catch(o){throw new Error(`Invalid geoJson format
`+o.message)}return CMt(e,n),gt(n,function(o){var s=o.name;DMt(e,o),LMt(e,o);var a=this._specialAreas&&this._specialAreas[s];a&&o.transformTo(a.left,a.top,a.width,a.height)},this),n},i.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},i}();function OMt(i){for(var t,e=0;e<i.length;e++){var r=i[e].getBoundingRect();t=t||r.clone(),t.union(r)}return t}function zMt(i){return bi(i)?typeof JSON<"u"&&JSON.parse?JSON.parse(i):new Function("return ("+i+");")():i}var Lb=Fi();const Bd={registerMap:function(i,t,e){if(t.svg){var r=new AMt(i,t.svg);Lb.set(i,r)}else{var n=t.geoJson||t.geoJSON;n&&!t.features?e=t.specialAreas:n=t;var r=new kMt(i,n,e);Lb.set(i,r)}},getGeoResource:function(i){return Lb.get(i)},getMapForUser:function(i){var t=Lb.get(i);return t&&t.type==="geoJSON"&&t.getMapForUser()},load:function(i,t,e){var r=Lb.get(i);if(r)return r.load(t,e)}};var V3=["rect","circle","line","ellipse","polygon","polyline","path"],BMt=Fi(V3),FMt=Fi(V3.concat(["g"])),NMt=Fi(V3.concat(["g"])),Ret=Wr();function YA(i){var t=i.getItemStyle(),e=i.get("areaColor");return e!=null&&(t.fill=e),t}function t$(i){var t=i.style;t&&(t.stroke=t.stroke||t.fill,t.fill=null)}var VMt=function(){function i(t){var e=this.group=new Ki,r=this._transformGroup=new Ki;e.add(r),this.uid=H0("ec_map_draw"),this._controller=new Lv(t.getZr()),this._controllerHost={target:r},r.add(this._regionsGroup=new Ki),r.add(this._svgGroup=new Ki)}return i.prototype.draw=function(t,e,r,n,o){var s=t.mainType==="geo",a=t.getData&&t.getData();s&&e.eachComponent({mainType:"series",subType:"map"},function(N){!a&&N.getHostGeoModel()===t&&(a=N.getData())});var u=t.coordinateSystem,f=this._regionsGroup,g=this._transformGroup,v=u.getTransformInfo(),y=v.raw,w=v.roam,I=!f.childAt(0)||o,E=t.getShallow("clip",!0),D;E?(D=u.getViewRect().clone(),this.group.setClipPath(new jr({shape:D.clone()}))):this.group.removeClipPath(),I?(g.x=w.x,g.y=w.y,g.scaleX=w.scaleX,g.scaleY=w.scaleY,g.dirty()):yn(g,w,t);var R=a&&a.getVisual("visualMeta")&&a.getVisual("visualMeta").length>0,z={api:r,geo:u,mapOrGeoModel:t,data:a,isVisualEncodedByVisualMap:R,isGeo:s,transformInfoRaw:y};u.resourceType==="geoJSON"?this._buildGeoJSON(z):u.resourceType==="geoSVG"&&this._buildSVG(z),this._updateController(t,D,e,r),this._updateMapSelectHandler(t,f,r,n)},i.prototype._buildGeoJSON=function(t){var e=this._regionsGroupByName=Fi(),r=Fi(),n=this._regionsGroup,o=t.transformInfoRaw,s=t.mapOrGeoModel,a=t.data,u=t.geo.projection,f=u&&u.stream;function g(w,I){return I&&(w=I(w)),w&&[w[0]*o.scaleX+o.x,w[1]*o.scaleY+o.y]}function v(w){for(var I=[],E=!f&&u&&u.project,D=0;D<w.length;++D){var R=g(w[D],E);R&&I.push(R)}return I}function y(w){return{shape:{points:v(w)}}}n.removeAll(),gt(t.geo.regions,function(w){var I=w.name,E=e.get(I),D=r.get(I)||{},R=D.dataIdx,z=D.regionModel;if(!E){E=e.set(I,new Ki),n.add(E),R=a?a.indexOfName(I):null,z=t.isGeo?s.getRegionModel(I):a?a.getItemModel(R):null;var N=z.get("silent",!0);N!=null&&(E.silent=N),r.set(I,{dataIdx:R,regionModel:z})}var H=[],$=[];gt(w.geometries,function(et){if(et.type==="polygon"){var rt=[et.exterior].concat(et.interiors||[]);f&&(rt=o$(rt,f)),gt(rt,function(ht){H.push(new gl(y(ht)))})}else{var lt=et.points;f&&(lt=o$(lt,f,!0)),gt(lt,function(ht){$.push(new Us(y(ht)))})}});var X=g(w.getCenter(),u&&u.project);function K(et,rt){if(et.length){var lt=new dE({culling:!0,segmentIgnoreThreshold:1,shape:{paths:et}});E.add(lt),e$(t,lt,R,z),i$(t,lt,I,z,s,R,X),rt&&(t$(lt),gt(lt.states,t$))}}K(H),K($,!0)}),e.each(function(w,I){var E=r.get(I),D=E.dataIdx,R=E.regionModel;r$(t,w,I,R,s,D),n$(t,w,I,R,s),a$(t,w,I,R,s)},this)},i.prototype._buildSVG=function(t){var e=t.geo.map,r=t.transformInfoRaw;this._svgGroup.x=r.x,this._svgGroup.y=r.y,this._svgGroup.scaleX=r.scaleX,this._svgGroup.scaleY=r.scaleY,this._svgResourceChanged(e)&&(this._freeSVG(),this._useSVG(e));var n=this._svgDispatcherMap=Fi(),o=!1;gt(this._svgGraphicRecord.named,function(s){var a=s.name,u=t.mapOrGeoModel,f=t.data,g=s.svgNodeTagLower,v=s.el,y=f?f.indexOfName(a):null,w=u.getRegionModel(a);BMt.get(g)!=null&&v instanceof kc&&e$(t,v,y,w),v instanceof kc&&(v.culling=!0);var I=w.get("silent",!0);if(I!=null&&(v.silent=I),v.z2EmphasisLift=0,!s.namedFrom&&(NMt.get(g)!=null&&i$(t,v,a,w,u,y,null),r$(t,v,a,w,u,y),n$(t,v,a,w,u),FMt.get(g)!=null)){var E=a$(t,v,a,w,u);E==="self"&&(o=!0);var D=n.get(a)||n.set(a,[]);D.push(v)}},this),this._enableBlurEntireSVG(o,t)},i.prototype._enableBlurEntireSVG=function(t,e){if(t&&e.isGeo){var r=e.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle(),n=r.opacity;this._svgGraphicRecord.root.traverse(function(o){if(!o.isGroup){gv(o);var s=o.ensureState("blur").style||{};s.opacity==null&&n!=null&&(s.opacity=n),o.ensureState("emphasis")}})}},i.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},i.prototype.findHighDownDispatchers=function(t,e){if(t==null)return[];var r=e.coordinateSystem;if(r.resourceType==="geoJSON"){var n=this._regionsGroupByName;if(n){var o=n.get(t);return o?[o]:[]}}else if(r.resourceType==="geoSVG")return this._svgDispatcherMap&&this._svgDispatcherMap.get(t)||[]},i.prototype._svgResourceChanged=function(t){return this._svgMapName!==t},i.prototype._useSVG=function(t){var e=Bd.getGeoResource(t);if(e&&e.type==="geoSVG"){var r=e.useGraphic(this.uid);this._svgGroup.add(r.root),this._svgGraphicRecord=r,this._svgMapName=t}},i.prototype._freeSVG=function(){var t=this._svgMapName;if(t!=null){var e=Bd.getGeoResource(t);e&&e.type==="geoSVG"&&e.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},i.prototype._updateController=function(t,e,r,n){var o=t.coordinateSystem,s=this._controller,a=this._controllerHost;a.zoomLimit=t.get("scaleLimit"),a.zoom=o.getZoom(),s.enable(t.get("roam")||!1,{api:n,zInfo:{component:t},triggerInfo:{roamTrigger:t.get("roamTrigger"),isInSelf:function(g,v,y){return o.containPoint([v,y])},isInClip:function(g,v,y){return!e||e.contain(v,y)}}});var u=t.mainType;function f(){var g={type:"geoRoam",componentType:u};return g[u+"Id"]=t.id,g}s.off("pan").on("pan",function(g){this._mouseDownFlag=!1,B3(a,g.dx,g.dy),n.dispatchAction(Fe(f(),{dx:g.dx,dy:g.dy,animation:{duration:0}}))},this),s.off("zoom").on("zoom",function(g){this._mouseDownFlag=!1,F3(a,g.scale,g.originX,g.originY),n.dispatchAction(Fe(f(),{totalZoom:a.zoom,zoom:g.scale,originX:g.originX,originY:g.originY,animation:{duration:0}}))},this)},i.prototype.resetForLabelLayout=function(){this.group.traverse(function(t){var e=t.getTextContent();e&&(e.ignore=Ret(e).ignore)})},i.prototype._updateMapSelectHandler=function(t,e,r,n){var o=this;e.off("mousedown"),e.off("click"),t.get("selectedMode")&&(e.on("mousedown",function(){o._mouseDownFlag=!0}),e.on("click",function(s){o._mouseDownFlag&&(o._mouseDownFlag=!1)}))},i}();function e$(i,t,e,r){var n=r.getModel("itemStyle"),o=r.getModel(["emphasis","itemStyle"]),s=r.getModel(["blur","itemStyle"]),a=r.getModel(["select","itemStyle"]),u=YA(n),f=YA(o),g=YA(a),v=YA(s),y=i.data;if(y){var w=y.getItemVisual(e,"style"),I=y.getItemVisual(e,"decal");i.isVisualEncodedByVisualMap&&w.fill&&(u.fill=w.fill),I&&(u.decal=S0(I,i.api))}t.setStyle(u),t.style.strokeNoScale=!0,t.ensureState("emphasis").style=f,t.ensureState("select").style=g,t.ensureState("blur").style=v,gv(t)}function i$(i,t,e,r,n,o,s){var a=i.data,u=i.isGeo,f=a&&isNaN(a.get(a.mapDimension("value"),o)),g=a&&a.getItemLayout(o);if(u||f||g&&g.showLabel){var v=u?e:o,y=void 0;(!a||o>=0)&&(y=n);var w=s?{normal:{align:"center",verticalAlign:"middle"}}:null;qo(t,zo(r),{labelFetcher:y,labelDataIndex:v,defaultText:e},w);var I=t.getTextContent();if(I&&(Ret(I).ignore=I.ignore,t.textConfig&&s)){var E=t.getBoundingRect().clone();t.textConfig.layoutRect=E,t.textConfig.position=[(s[0]-E.x)/E.width*100+"%",(s[1]-E.y)/E.height*100+"%"]}t.disableLabelAnimation=!0}else t.removeTextContent(),t.removeTextConfig(),t.disableLabelAnimation=null}function r$(i,t,e,r,n,o){i.data?i.data.setItemGraphicEl(o,t):ur(t).eventData={componentType:"geo",componentIndex:n.componentIndex,geoIndex:n.componentIndex,name:e,region:r&&r.option||{}}}function n$(i,t,e,r,n){i.data||Gd({el:t,componentModel:n,itemName:e,itemTooltipOption:r.get("tooltip")})}function a$(i,t,e,r,n){t.highDownSilentOnTouch=!!n.get("selectedMode");var o=r.getModel("emphasis"),s=o.get("focus");return Ma(t,s,o.get("blurScope"),o.get("disabled")),i.isGeo&&J0t(t,n,e),s}function o$(i,t,e){var r=[],n;function o(){n=[]}function s(){n.length&&(r.push(n),n=[])}var a=t({polygonStart:o,polygonEnd:s,lineStart:o,lineEnd:s,point:function(u,f){isFinite(u)&&isFinite(f)&&n.push([u,f])},sphere:function(){}});return!e&&a.polygonStart(),gt(i,function(u){a.lineStart();for(var f=0;f<u.length;f++)a.point(u[f][0],u[f][1]);a.lineEnd()}),!e&&a.polygonEnd(),r}const ket=VMt;var UMt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){if(!(o&&o.type==="mapToggleSelect"&&o.from===this.uid)){var s=this.group;if(s.removeAll(),!e.getHostGeoModel()){if(this._mapDraw&&o&&o.type==="geoRoam"&&this._mapDraw.resetForLabelLayout(),o&&o.type==="geoRoam"&&o.componentType==="series"&&o.seriesId===e.id){var a=this._mapDraw;a&&s.add(a.group)}else if(e.needsDrawMap){var a=this._mapDraw||new ket(n);s.add(a.group),a.draw(e,r,n,this,o),this._mapDraw=a}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;e.get("showLegendSymbol")&&r.getComponent("legend")&&this._renderSymbols(e,r,n)}}},t.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},t.prototype._renderSymbols=function(e,r,n){var o=e.originalData,s=this.group;o.each(o.mapDimension("value"),function(a,u){if(!isNaN(a)){var f=o.getItemLayout(u);if(!(!f||!f.point)){var g=f.point,v=f.offset,y=new Gp({style:{fill:e.getData().getVisual("style").fill},shape:{cx:g[0]+v*9,cy:g[1],r:3},silent:!0,z2:8+(v?0:N0+1)});if(!v){var w=e.mainSeries.getData(),I=o.getName(u),E=w.indexOfName(I),D=o.getItemModel(u),R=D.getModel("label"),z=w.getItemGraphicEl(E);qo(y,zo(D),{labelFetcher:{getFormattedLabel:function(N,H){return e.getFormattedLabel(E,H)}},defaultText:I}),y.disableLabelAnimation=!0,R.get("position")||y.setTextConfig({position:"bottom"}),z.onHoverStateChange=function(N){zM(y,N)}}s.add(y)}}})},t.type="map",t}(pa);const GMt=UMt;var HMt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.needsDrawMap=!1,e.seriesGroup=[],e.getTooltipPosition=function(r){if(r!=null){var n=this.getData().getName(r),o=this.coordinateSystem,s=o.getRegion(n);return s&&o.dataToPoint(s.getCenter())}},e}return t.prototype.getInitialData=function(e){for(var r=Y0(this,{coordDimensions:["value"],encodeDefaulter:br(r3,this)}),n=Fi(),o=[],s=0,a=r.count();s<a;s++){var u=r.getName(s);n.set(u,s)}var f=Bd.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);return gt(f.regions,function(g){var v=g.name,y=n.get(v),w=g.properties&&g.properties.echartsStyle,I;y==null?(I={name:v},o.push(I)):I=r.getRawDataItem(y),w&&Er(I,w)}),r.appendData(o),r},t.prototype.getHostGeoModel=function(){if(yJ(this).kind!==nh.boxCoordSys)return this.getReferringComponents("geo",{useDefault:!1,enableAll:!1,enableNone:!1}).models[0]},t.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},t.prototype.getRawValue=function(e){var r=this.getData();return r.get(r.mapDimension("value"),e)},t.prototype.getRegionModel=function(e){var r=this.getData();return r.getItemModel(r.indexOfName(e))},t.prototype.formatTooltip=function(e,r,n){for(var o=this.getData(),s=this.getRawValue(e),a=o.getName(e),u=this.seriesGroup,f=[],g=0;g<u.length;g++){var v=u[g].originalData.indexOfName(a),y=o.mapDimension("value");isNaN(u[g].originalData.get(y,v))||f.push(u[g].name)}return xo("section",{header:f.join(", "),noHeader:!f.length,blocks:[xo("nameValue",{name:a,value:s})]})},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.getLegendIcon=function(e){var r=e.icon||"roundRect",n=bo(r,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);return n.setStyle(e.itemStyle),n.style.stroke="none",r.indexOf("empty")>-1&&(n.style.stroke=n.style.fill,n.style.fill=_e.color.neutral00,n.style.lineWidth=2),n},t.type="series.map",t.dependencies=["geo"],t.layoutMode="box",t.defaultOption={z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:_e.color.tertiary},itemStyle:{borderWidth:.5,borderColor:_e.color.border,areaColor:_e.color.background},emphasis:{label:{show:!0,color:_e.color.primary},itemStyle:{areaColor:_e.color.highlight}},select:{label:{show:!0,color:_e.color.primary},itemStyle:{color:_e.color.highlight}},nameProperty:"name"},t}(Ea);const jMt=HMt;function WMt(i,t){var e={};return gt(i,function(r){r.each(r.mapDimension("value"),function(n,o){var s="ec-"+r.getName(o);e[s]=e[s]||[],isNaN(n)||e[s].push(n)})}),i[0].map(i[0].mapDimension("value"),function(r,n){for(var o="ec-"+i[0].getName(n),s=0,a=1/0,u=-1/0,f=e[o].length,g=0;g<f;g++)a=Math.min(a,e[o][g]),u=Math.max(u,e[o][g]),s+=e[o][g];var v;return t==="min"?v=a:t==="max"?v=u:t==="average"?v=s/f:v=s,f===0?NaN:v})}function $Mt(i){var t={};i.eachSeriesByType("map",function(e){var r=e.getHostGeoModel(),n=r?"o"+r.id:"i"+e.getMapType();(t[n]=t[n]||[]).push(e)}),gt(t,function(e,r){for(var n=WMt(ti(e,function(s){return s.getData()}),e[0].get("mapValueCalculation")),o=0;o<e.length;o++)e[o].originalData=e[o].getData();for(var o=0;o<e.length;o++)e[o].seriesGroup=e,e[o].needsDrawMap=o===0&&!e[o].getHostGeoModel(),e[o].setData(n.cloneShallow()),e[o].mainSeries=e[0]})}function ZMt(i){var t={};i.eachSeriesByType("map",function(e){var r=e.getMapType();if(!(e.getHostGeoModel()||t[r])){var n={};gt(e.seriesGroup,function(s){var a=s.coordinateSystem,u=s.originalData;s.get("showLegendSymbol")&&i.getComponent("legend")&&u.each(u.mapDimension("value"),function(f,g){var v=u.getName(g),y=a.getRegion(v);if(!(!y||isNaN(f))){var w=n[v]||0,I=a.dataToPoint(y.getCenter());n[v]=w+1,u.setItemLayout(g,{point:I,offset:w})}})});var o=e.getData();o.each(function(s){var a=o.getName(s),u=o.getItemLayout(s)||{};u.showLabel=!n[a],o.setItemLayout(s,u)}),t[r]=!0}})}var s$=ho,qMt=function(i){we(t,i);function t(e,r){var n=i.call(this)||this;return n.type="view",n.dimensions=["x","y"],n._roamTransformable=new yd,n._rawTransformable=new yd,n.name=e,n._opt=r,n}return t.prototype.setBoundingRect=function(e,r,n,o){return this._rect=new sr(e,r,n,o),this._updateCenterAndZoom(),this._rect},t.prototype.getBoundingRect=function(){return this._rect},t.prototype.setViewRect=function(e,r,n,o){this._transformTo(e,r,n,o),this._viewRect=new sr(e,r,n,o)},t.prototype._transformTo=function(e,r,n,o){var s=this.getBoundingRect(),a=this._rawTransformable;a.transform=s.calculateTransform(new sr(e,r,n,o));var u=a.parent;a.parent=null,a.decomposeTransform(),a.parent=u,this._updateTransform()},t.prototype.setCenter=function(e){var r=this._opt;r&&r.api&&r.ecModel&&r.ecModel.getShallow("legacyViewCoordSysCenterBase")&&e&&(e=[xi(e[0],r.api.getWidth()),xi(e[1],r.api.getWidth())]),this._centerOption=Yi(e),this._updateCenterAndZoom()},t.prototype.setZoom=function(e){this._zoom=N3(e||1,this.zoomLimit),this._updateCenterAndZoom()},t.prototype.getDefaultCenter=function(){var e=this.getBoundingRect(),r=e.x+e.width/2,n=e.y+e.height/2;return[r,n]},t.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},t.prototype.getZoom=function(){return this._zoom||1},t.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},t.prototype._updateCenterAndZoom=function(){var e=this._centerOption,r=this._rect;e&&r&&(this._center=[xi(e[0],r.width,r.x),xi(e[1],r.height,r.y)]);var n=this._rawTransformable.getLocalTransform(),o=this._roamTransformable,s=this.getDefaultCenter(),a=this.getCenter(),u=this.getZoom();a=ho([],a,n),s=ho([],s,n),o.originX=a[0],o.originY=a[1],o.x=s[0]-a[0],o.y=s[1]-a[1],o.scaleX=o.scaleY=u,this._updateTransform()},t.prototype._updateTransform=function(){var e=this._roamTransformable,r=this._rawTransformable;r.parent=e,e.updateTransform(),r.updateTransform(),QC(this.transform||(this.transform=[]),r.transform||ns()),this._rawTransform=r.getLocalTransform(),this.invTransform=this.invTransform||[],mu(this.invTransform,this.transform),this.decomposeTransform()},t.prototype.getTransformInfo=function(){var e=this._rawTransformable,r=this._roamTransformable,n=new yd;return n.transform=r.transform,n.decomposeTransform(),{roam:{x:n.x,y:n.y,scaleX:n.scaleX,scaleY:n.scaleY},raw:{x:e.x,y:e.y,scaleX:e.scaleX,scaleY:e.scaleY}}},t.prototype.getViewRect=function(){return this._viewRect},t.prototype.getViewRectAfterRoam=function(){var e=this.getBoundingRect().clone();return e.applyTransform(this.transform),e},t.prototype.dataToPoint=function(e,r,n){var o=r?this._rawTransform:this.transform;return n=n||[],o?s$(n,e,o):ll(n,e)},t.prototype.pointToData=function(e,r,n){n=n||[];var o=this.invTransform;return o?s$(n,e,o):(n[0]=e[0],n[1]=e[1],n)},t.prototype.convertToPixel=function(e,r,n){var o=l$(r);return o===this?o.dataToPoint(n):null},t.prototype.convertFromPixel=function(e,r,n){var o=l$(r);return o===this?o.pointToData(n):null},t.prototype.containPoint=function(e){return this.getViewRectAfterRoam().contain(e[0],e[1])},t.dimensions=["x","y"],t}(yd);function l$(i){var t=i.seriesModel;return t?t.coordinateSystem:null}const Rv=qMt;var XMt={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},Oet=["lng","lat"],zet=function(i){we(t,i);function t(e,r,n){var o=i.call(this,e,{api:n.api,ecModel:n.ecModel})||this;o.dimensions=Oet,o.type="geo",o._nameCoordMap=Fi(),o.map=r;var s=n.projection,a=Bd.load(r,n.nameMap,n.nameProperty),u=Bd.getGeoResource(r);o.resourceType=u?u.type:null;var f=o.regions=a.regions,g=XMt[u.type];o._regionsMap=a.regionsMap,o.regions=a.regions,o.projection=s;var v;if(s)for(var y=0;y<f.length;y++){var w=f[y].getBoundingRect(s);v=v||w.clone(),v.union(w)}else v=a.boundingRect;return o.setBoundingRect(v.x,v.y,v.width,v.height),o.aspectScale=s?1:Ui(n.aspectScale,g.aspectScale),o._invertLongitute=s?!1:g.invertLongitute,o}return t.prototype._transformTo=function(e,r,n,o){var s=this.getBoundingRect(),a=this._invertLongitute;s=s.clone(),a&&(s.y=-s.y-s.height);var u=this._rawTransformable;u.transform=s.calculateTransform(new sr(e,r,n,o));var f=u.parent;u.parent=null,u.decomposeTransform(),u.parent=f,a&&(u.scaleY=-u.scaleY),this._updateTransform()},t.prototype.getRegion=function(e){return this._regionsMap.get(e)},t.prototype.getRegionByCoord=function(e){for(var r=this.regions,n=0;n<r.length;n++){var o=r[n];if(o.type==="geoJSON"&&o.contain(e))return r[n]}},t.prototype.addGeoCoord=function(e,r){this._nameCoordMap.set(e,r)},t.prototype.getGeoCoord=function(e){var r=this._regionsMap.get(e);return this._nameCoordMap.get(e)||r&&r.getCenter()},t.prototype.dataToPoint=function(e,r,n){if(bi(e)&&(e=this.getGeoCoord(e)),e){var o=this.projection;return o&&(e=o.project(e)),e&&this.projectedToPoint(e,r,n)}},t.prototype.pointToData=function(e,r,n){var o=this.projection;return o&&(e=o.unproject(e)),e&&this.pointToProjected(e,n)},t.prototype.pointToProjected=function(e,r){return i.prototype.pointToData.call(this,e,0,r)},t.prototype.projectedToPoint=function(e,r,n){return i.prototype.dataToPoint.call(this,e,r,n)},t.prototype.convertToPixel=function(e,r,n){var o=c$(r);return o===this?o.dataToPoint(n):null},t.prototype.convertFromPixel=function(e,r,n){var o=c$(r);return o===this?o.pointToData(n):null},t}(Rv);wo(zet,Rv);function c$(i){var t=i.geoModel,e=i.seriesModel;return t?t.coordinateSystem:e?e.coordinateSystem||(e.getReferringComponents("geo",Wa).models[0]||{}).coordinateSystem:null}const u$=zet;function h$(i,t){var e=i.get("boundingCoords");if(e!=null){var r=e[0],n=e[1];if(isFinite(r[0])&&isFinite(r[1])&&isFinite(n[0])&&isFinite(n[1])){var o=this.projection;if(o){var s=r[0],a=r[1],u=n[0],f=n[1];r=[1/0,1/0],n=[-1/0,-1/0];var g=function($,X,K,et){for(var rt=K-$,lt=et-X,ht=0;ht<=100;ht++){var yt=ht/100,ft=o.project([$+rt*yt,X+lt*yt]);cp(r,r,ft),up(n,n,ft)}};g(s,a,u,a),g(u,a,u,f),g(u,f,s,f),g(s,f,u,a)}this.setBoundingRect(r[0],r[1],n[0]-r[0],n[1]-r[1])}}var v=this.getBoundingRect(),y=i.get("layoutCenter"),w=i.get("layoutSize"),I=Bo(i,t).refContainer,E=v.width/v.height*this.aspectScale,D=!1,R,z;y&&w&&(R=[xi(y[0],I.width)+I.x,xi(y[1],I.height)+I.y],z=xi(w,Math.min(I.width,I.height)),!isNaN(R[0])&&!isNaN(R[1])&&!isNaN(z)&&(D=!0));var N;if(D)N={},E>1?(N.width=z,N.height=z/E):(N.height=z,N.width=z*E),N.y=R[1]-N.height/2,N.x=R[0]-N.width/2;else{var H=i.getBoxLayoutParams();H.aspect=E,N=Ca(H,I),N=TJ(i,N,E)}this.setViewRect(N.x,N.y,N.width,N.height),this.setCenter(i.get("center")),this.setZoom(i.get("zoom"))}function YMt(i,t){gt(t.get("geoCoord"),function(e,r){i.addGeoCoord(r,e)})}var KMt=function(){function i(){this.dimensions=Oet}return i.prototype.create=function(t,e){var r=[];function n(s){return{nameProperty:s.get("nameProperty"),aspectScale:s.get("aspectScale"),projection:s.get("projection")}}t.eachComponent("geo",function(s,a){var u=s.get("map"),f=new u$(u+a,u,Fe({nameMap:s.get("nameMap"),api:e,ecModel:t},n(s)));f.zoomLimit=s.get("scaleLimit"),r.push(f),s.coordinateSystem=f,f.model=s,f.resize=h$,f.resize(s,e)}),t.eachSeries(function(s){VS({targetModel:s,coordSysType:"geo",coordSysProvider:function(){var a=s.subType==="map"?s.getHostGeoModel():s.getReferringComponents("geo",Wa).models[0];return a&&a.coordinateSystem},allowNotFound:!0})});var o={};return t.eachSeriesByType("map",function(s){if(!s.getHostGeoModel()){var a=s.getMapType();o[a]=o[a]||[],o[a].push(s)}}),gt(o,function(s,a){var u=ti(s,function(g){return g.get("nameMap")}),f=new u$(a,a,Fe({nameMap:vF(u),api:e,ecModel:t},n(s[0])));f.zoomLimit=vs.apply(null,ti(s,function(g){return g.get("scaleLimit")})),r.push(f),f.resize=h$,f.resize(s[0],e),gt(s,function(g){g.coordinateSystem=f,YMt(f,g)})}),r},i.prototype.getFilledRegions=function(t,e,r,n){for(var o=(t||[]).slice(),s=Fi(),a=0;a<o.length;a++)s.set(o[a].name,o[a]);var u=Bd.load(e,r,n);return gt(u.regions,function(f){var g=f.name,v=s.get(g),y=f.properties&&f.properties.echartsStyle;v||(v={name:g},o.push(v)),y&&Er(v,y)}),o},i}(),JMt=new KMt;const Bet=JMt;var QMt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n);var o=Bd.getGeoResource(e.map);if(o&&o.type==="geoJSON"){var s=e.itemStyle=e.itemStyle||{};"color"in s||(s.color=e.defaultItemStyleColor||_e.color.backgroundTint)}dv(e,"label",["show"])},t.prototype.optionUpdated=function(){var e=this,r=this.option;r.regions=Bet.getFilledRegions(r.regions,r.map,r.nameMap,r.nameProperty);var n={};this._optionModelMap=yh(r.regions||[],function(o,s){var a=s.name;return a&&(o.set(a,new bn(s,e,e.ecModel)),s.selected&&(n[a]=!0)),o},Fi()),r.selectedMap||(r.selectedMap=n)},t.prototype.getRegionModel=function(e){return this._optionModelMap.get(e)||new bn(null,this,this.ecModel)},t.prototype.getFormattedLabel=function(e,r){var n=this.getRegionModel(e),o=r==="normal"?n.get(["label","formatter"]):n.get(["emphasis","label","formatter"]),s={name:e};if(Xi(o))return s.status=r,o(s);if(bi(o))return o.replace("{a}",e??"")},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.select=function(e){var r=this.option,n=r.selectedMode;if(n){n!=="multiple"&&(r.selectedMap=null);var o=r.selectedMap||(r.selectedMap={});o[e]=!0}},t.prototype.unSelect=function(e){var r=this.option.selectedMap;r&&(r[e]=!1)},t.prototype.toggleSelected=function(e){this[this.isSelected(e)?"unSelect":"select"](e)},t.prototype.isSelected=function(e){var r=this.option.selectedMap;return!!(r&&r[e])},t.type="geo",t.layoutMode="box",t.defaultOption={z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:_e.color.tertiary},itemStyle:{borderWidth:.5,borderColor:_e.color.border},emphasis:{label:{show:!0,color:_e.color.primary},itemStyle:{color:_e.color.highlight}},select:{label:{show:!0,color:_e.color.primary},itemStyle:{color:_e.color.highlight}},regions:[]},t}(gn);const tCt=QMt;var eCt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.focusBlurEnabled=!0,e}return t.prototype.init=function(e,r){this._api=r},t.prototype.render=function(e,r,n,o){if(this._model=e,!e.get("show")){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;return}this._mapDraw||(this._mapDraw=new ket(n));var s=this._mapDraw;s.draw(e,r,n,this,o),s.group.on("click",this._handleRegionClick,this),s.group.silent=e.get("silent"),this.group.add(s.group),this.updateSelectStatus(e,r,n)},t.prototype._handleRegionClick=function(e){var r;$m(e.target,function(n){return(r=ur(n).eventData)!=null},!0),r&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:r.name})},t.prototype.updateSelectStatus=function(e,r,n){var o=this;this._mapDraw.group.traverse(function(s){var a=ur(s).eventData;if(a)return o._model.isSelected(a.name)?n.enterSelect(s):n.leaveSelect(s),!0})},t.prototype.findHighDownDispatchers=function(e){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(e,this._model)},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},t.type="geo",t}(Oa);const iCt=eCt;function rCt(i,t,e){Bd.registerMap(i,t,e)}function Fet(i){i.registerCoordinateSystem("geo",Bet),i.registerComponentModel(tCt),i.registerComponentView(iCt),i.registerImpl("registerMap",rCt),i.registerImpl("getMap",function(e){return Bd.getMapForUser(e)});function t(e,r){r.update="geo:updateSelectStatus",i.registerAction(r,function(n,o){var s={},a=[];return o.eachComponent({mainType:"geo",query:n},function(u){u[e](n.name);var f=u.coordinateSystem;gt(f.regions,function(v){s[v.name]=u.isSelected(v.name)||!1});var g=[];gt(s,function(v,y){s[y]&&g.push(y)}),a.push({geoIndex:u.componentIndex,name:g})}),{selected:s,allSelected:a,name:n.name}})}t("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),t("select",{type:"geoSelect",event:"geoselected"}),t("unSelect",{type:"geoUnSelect",event:"geounselected"}),i.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},function(e,r,n){var o=e.componentType;o||(e.geoId!=null?o="geo":e.seriesId!=null&&(o="series")),o||(o="series"),r.eachComponent({mainType:o,query:e},function(s){var a=s.coordinateSystem;if(a.type==="geo"){var u=CE(a,e,s.get("scaleLimit"));s.setCenter&&s.setCenter(u.center),s.setZoom&&s.setZoom(u.zoom),o==="series"&&gt(s.seriesGroup,function(f){f.setCenter(u.center),f.setZoom(u.zoom)})}})})}function nCt(i){Rr(Fet),i.registerChartView(GMt),i.registerSeriesModel(jMt),i.registerLayout(ZMt),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,$Mt),mQ("map",i.registerAction)}function aCt(i){var t=i;t.hierNode={defaultAncestor:null,ancestor:t,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var e=[t],r,n;r=e.pop();)if(n=r.children,r.isExpand&&n.length)for(var o=n.length,s=o-1;s>=0;s--){var a=n[s];a.hierNode={defaultAncestor:null,ancestor:a,prelim:0,modifier:0,change:0,shift:0,i:s,thread:null},e.push(a)}}function oCt(i,t){var e=i.isExpand?i.children:[],r=i.parentNode.children,n=i.hierNode.i?r[i.hierNode.i-1]:null;if(e.length){lCt(i);var o=(e[0].hierNode.prelim+e[e.length-1].hierNode.prelim)/2;n?(i.hierNode.prelim=n.hierNode.prelim+t(i,n),i.hierNode.modifier=i.hierNode.prelim-o):i.hierNode.prelim=o}else n&&(i.hierNode.prelim=n.hierNode.prelim+t(i,n));i.parentNode.hierNode.defaultAncestor=cCt(i,n,i.parentNode.hierNode.defaultAncestor||r[0],t)}function sCt(i){var t=i.hierNode.prelim+i.parentNode.hierNode.modifier;i.setLayout({x:t},!0),i.hierNode.modifier+=i.parentNode.hierNode.modifier}function d$(i){return arguments.length?i:dCt}function aw(i,t){return i-=Math.PI/2,{x:t*Math.cos(i),y:t*Math.sin(i)}}function lCt(i){for(var t=i.children,e=t.length,r=0,n=0;--e>=0;){var o=t[e];o.hierNode.prelim+=r,o.hierNode.modifier+=r,n+=o.hierNode.change,r+=o.hierNode.shift+n}}function cCt(i,t,e,r){if(t){for(var n=i,o=i,s=o.parentNode.children[0],a=t,u=n.hierNode.modifier,f=o.hierNode.modifier,g=s.hierNode.modifier,v=a.hierNode.modifier;a=BR(a),o=FR(o),a&&o;){n=BR(n),s=FR(s),n.hierNode.ancestor=i;var y=a.hierNode.prelim+v-o.hierNode.prelim-f+r(a,o);y>0&&(hCt(uCt(a,i,e),i,y),f+=y,u+=y),v+=a.hierNode.modifier,f+=o.hierNode.modifier,u+=n.hierNode.modifier,g+=s.hierNode.modifier}a&&!BR(n)&&(n.hierNode.thread=a,n.hierNode.modifier+=v-u),o&&!FR(s)&&(s.hierNode.thread=o,s.hierNode.modifier+=f-g,e=i)}return e}function BR(i){var t=i.children;return t.length&&i.isExpand?t[t.length-1]:i.hierNode.thread}function FR(i){var t=i.children;return t.length&&i.isExpand?t[0]:i.hierNode.thread}function uCt(i,t,e){return i.hierNode.ancestor.parentNode===t.parentNode?i.hierNode.ancestor:e}function hCt(i,t,e){var r=e/(t.hierNode.i-i.hierNode.i);t.hierNode.change-=r,t.hierNode.shift+=e,t.hierNode.modifier+=e,t.hierNode.prelim+=e,i.hierNode.change+=r}function dCt(i,t){return i.parentNode===t.parentNode?1:2}var fCt=function(){function i(){this.parentPoint=[],this.childPoints=[]}return i}(),pCt=function(i){we(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:_e.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new fCt},t.prototype.buildPath=function(e,r){var n=r.childPoints,o=n.length,s=r.parentPoint,a=n[0],u=n[o-1];if(o===1){e.moveTo(s[0],s[1]),e.lineTo(a[0],a[1]);return}var f=r.orient,g=f==="TB"||f==="BT"?0:1,v=1-g,y=xi(r.forkPosition,1),w=[];w[g]=s[g],w[v]=s[v]+(u[v]-s[v])*y,e.moveTo(s[0],s[1]),e.lineTo(w[0],w[1]),e.moveTo(a[0],a[1]),w[g]=a[g],e.lineTo(w[0],w[1]),w[g]=u[g],e.lineTo(w[0],w[1]),e.lineTo(u[0],u[1]);for(var I=1;I<o-1;I++){var E=n[I];e.moveTo(E[0],E[1]),w[g]=E[g],e.lineTo(w[0],w[1])}},t}(qr),gCt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._mainGroup=new Ki,e}return t.prototype.init=function(e,r){this._controller=new Lv(r.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},t.prototype.render=function(e,r,n){var o=e.getData(),s=e.layoutInfo,a=this._mainGroup,u=e.get("layout");u==="radial"?(a.x=s.x+s.width/2,a.y=s.y+s.height/2):(a.x=s.x,a.y=s.y),this._updateViewCoordSys(e,n),this._updateController(e,null,r,n);var f=this._data;o.diff(f).add(function(g){f$(o,g)&&p$(o,g,null,a,e)}).update(function(g,v){var y=f.getItemGraphicEl(v);if(!f$(o,g)){y&&m$(f,v,y,a,e);return}p$(o,g,y,a,e)}).remove(function(g){var v=f.getItemGraphicEl(g);v&&m$(f,g,v,a,e)}).execute(),this._nodeScaleRatio=e.get("nodeScaleRatio"),this._updateNodeAndLinkScale(e),e.get("expandAndCollapse")===!0&&o.eachItemGraphicEl(function(g,v){g.off("click").on("click",function(){n.dispatchAction({type:"treeExpandAndCollapse",seriesId:e.id,dataIndex:v})})}),this._data=o},t.prototype._updateViewCoordSys=function(e,r){var n=e.getData(),o=[];n.each(function(v){var y=n.getItemLayout(v);y&&!isNaN(y.x)&&!isNaN(y.y)&&o.push([+y.x,+y.y])});var s=[],a=[];aE(o,s,a);var u=this._min,f=this._max;a[0]-s[0]===0&&(s[0]=u?u[0]:s[0]-1,a[0]=f?f[0]:a[0]+1),a[1]-s[1]===0&&(s[1]=u?u[1]:s[1]-1,a[1]=f?f[1]:a[1]+1);var g=e.coordinateSystem=new Rv(null,{api:r,ecModel:e.ecModel});g.zoomLimit=e.get("scaleLimit"),g.setBoundingRect(s[0],s[1],a[0]-s[0],a[1]-s[1]),g.setCenter(e.get("center")),g.setZoom(e.get("zoom")),this.group.attr({x:g.x,y:g.y,scaleX:g.scaleX,scaleY:g.scaleY}),this._min=s,this._max=a},t.prototype._updateController=function(e,r,n,o){var s=this;Cet(e,o,this.group,this._controller,this._controllerHost,r),this._controller.on("zoom",function(a){s._updateNodeAndLinkScale(e)})},t.prototype._updateNodeAndLinkScale=function(e){var r=e.getData(),n=this._getNodeGlobalScale(e);r.eachItemGraphicEl(function(o,s){o.setSymbolScale(n)})},t.prototype._getNodeGlobalScale=function(e){var r=e.coordinateSystem;if(r.type!=="view")return 1;var n=this._nodeScaleRatio,o=r.scaleX||1,s=r.getZoom(),a=(s-1)*n+1;return a/o},t.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype.remove=function(){this._mainGroup.removeAll(),this._data=null},t.type="tree",t}(pa);function f$(i,t){var e=i.getItemLayout(t);return e&&!isNaN(e.x)&&!isNaN(e.y)}function p$(i,t,e,r,n){var o=!e,s=i.tree.getNodeByDataIndex(t),a=s.getModel(),u=s.getVisual("style").fill,f=s.isExpand===!1&&s.children.length!==0?u:_e.color.neutral00,g=i.tree.root,v=s.parentNode===g?s:s.parentNode||s,y=i.getItemGraphicEl(v.dataIndex),w=v.getLayout(),I=y?{x:y.__oldX,y:y.__oldY,rawX:y.__radialOldRawX,rawY:y.__radialOldRawY}:w,E=s.getLayout();o?(e=new jS(i,t,null,{symbolInnerColor:f,useNameLabel:!0}),e.x=I.x,e.y=I.y):e.updateData(i,t,null,{symbolInnerColor:f,useNameLabel:!0}),e.__radialOldRawX=e.__radialRawX,e.__radialOldRawY=e.__radialRawY,e.__radialRawX=E.rawX,e.__radialRawY=E.rawY,r.add(e),i.setItemGraphicEl(t,e),e.__oldX=e.x,e.__oldY=e.y,yn(e,{x:E.x,y:E.y},n);var D=e.getSymbolPath();if(n.get("layout")==="radial"){var R=g.children[0],z=R.getLayout(),N=R.children.length,H=void 0,$=void 0;if(E.x===z.x&&s.isExpand===!0&&R.children.length){var X={x:(R.children[0].getLayout().x+R.children[N-1].getLayout().x)/2,y:(R.children[0].getLayout().y+R.children[N-1].getLayout().y)/2};H=Math.atan2(X.y-z.y,X.x-z.x),H<0&&(H=Math.PI*2+H),$=X.x<z.x,$&&(H=H-Math.PI)}else H=Math.atan2(E.y-z.y,E.x-z.x),H<0&&(H=Math.PI*2+H),s.children.length===0||s.children.length!==0&&s.isExpand===!1?($=E.x<z.x,$&&(H=H-Math.PI)):($=E.x>z.x,$||(H=H-Math.PI));var K=$?"left":"right",et=a.getModel("label"),rt=et.get("rotate"),lt=rt*(Math.PI/180),ht=D.getTextContent();ht&&(D.setTextConfig({position:et.get("position")||K,rotation:rt==null?-H:lt,origin:"center"}),ht.setStyle("verticalAlign","middle"))}var yt=a.get(["emphasis","focus"]),ft=yt==="relative"?qw(s.getAncestorsIndices(),s.getDescendantIndices()):yt==="ancestor"?s.getAncestorsIndices():yt==="descendant"?s.getDescendantIndices():null;ft&&(ur(e).focus=ft),mCt(n,s,g,e,I,w,E,r),e.__edge&&(e.onHoverStateChange=function(kt){if(kt!=="blur"){var Rt=s.parentNode&&i.getItemGraphicEl(s.parentNode.dataIndex);Rt&&Rt.hoverState===OS||zM(e.__edge,kt)}})}function mCt(i,t,e,r,n,o,s,a){var u=t.getModel(),f=i.get("edgeShape"),g=i.get("layout"),v=i.getOrient(),y=i.get(["lineStyle","curveness"]),w=i.get("edgeForkPosition"),I=u.getModel("lineStyle").getLineStyle(),E=r.__edge;if(f==="curve")t.parentNode&&t.parentNode!==e&&(E||(E=r.__edge=new hE({shape:Zz(g,v,y,n,n)})),yn(E,{shape:Zz(g,v,y,o,s)},i));else if(f==="polyline"&&g==="orthogonal"&&t!==e&&t.children&&t.children.length!==0&&t.isExpand===!0){for(var D=t.children,R=[],z=0;z<D.length;z++){var N=D[z].getLayout();R.push([N.x,N.y])}E||(E=r.__edge=new pCt({shape:{parentPoint:[s.x,s.y],childPoints:[[s.x,s.y]],orient:v,forkPosition:w}})),yn(E,{shape:{parentPoint:[s.x,s.y],childPoints:R}},i)}E&&!(f==="polyline"&&!t.isExpand)&&(E.useStyle(rr({strokeNoScale:!0,fill:null},I)),Oo(E,u,"lineStyle"),gv(E),a.add(E))}function g$(i,t,e,r,n){var o=t.tree.root,s=Net(o,i),a=s.source,u=s.sourceLayout,f=t.getItemGraphicEl(i.dataIndex);if(f){var g=t.getItemGraphicEl(a.dataIndex),v=g.__edge,y=f.__edge||(a.isExpand===!1||a.children.length===1?v:void 0),w=r.get("edgeShape"),I=r.get("layout"),E=r.get("orient"),D=r.get(["lineStyle","curveness"]);y&&(w==="curve"?Pp(y,{shape:Zz(I,E,D,u,u),style:{opacity:0}},r,{cb:function(){e.remove(y)},removeOpt:n}):w==="polyline"&&r.get("layout")==="orthogonal"&&Pp(y,{shape:{parentPoint:[u.x,u.y],childPoints:[[u.x,u.y]]},style:{opacity:0}},r,{cb:function(){e.remove(y)},removeOpt:n}))}}function Net(i,t){for(var e=t.parentNode===i?t:t.parentNode||t,r;r=e.getLayout(),r==null;)e=e.parentNode===i?e:e.parentNode||e;return{source:e,sourceLayout:r}}function m$(i,t,e,r,n){var o=i.tree.getNodeByDataIndex(t),s=i.tree.root,a=Net(s,o).sourceLayout,u={duration:n.get("animationDurationUpdate"),easing:n.get("animationEasingUpdate")};Pp(e,{x:a.x+1,y:a.y+1},n,{cb:function(){r.remove(e),i.setItemGraphicEl(t,null)},removeOpt:u}),e.fadeOut(null,i.hostModel,{fadeLabel:!0,animation:u}),o.children.forEach(function(f){g$(f,i,r,n,u)}),g$(o,i,r,n,u)}function Zz(i,t,e,r,n){var o,s,a,u,f,g,v,y;if(i==="radial"){f=r.rawX,v=r.rawY,g=n.rawX,y=n.rawY;var w=aw(f,v),I=aw(f,v+(y-v)*e),E=aw(g,y+(v-y)*e),D=aw(g,y);return{x1:w.x||0,y1:w.y||0,x2:D.x||0,y2:D.y||0,cpx1:I.x||0,cpy1:I.y||0,cpx2:E.x||0,cpy2:E.y||0}}else f=r.x,v=r.y,g=n.x,y=n.y,(t==="LR"||t==="RL")&&(o=f+(g-f)*e,s=v,a=g+(f-g)*e,u=y),(t==="TB"||t==="BT")&&(o=f,s=v+(y-v)*e,a=g,u=y+(v-y)*e);return{x1:f,y1:v,x2:g,y2:y,cpx1:o,cpy1:s,cpx2:a,cpy2:u}}const vCt=gCt;var Lc=Wr();function Vet(i){var t=i.mainData,e=i.datas;e||(e={main:t},i.datasAttr={main:"data"}),i.datas=i.mainData=null,Uet(t,e,i),gt(e,function(r){gt(t.TRANSFERABLE_METHODS,function(n){r.wrapMethod(n,br(_Ct,i))})}),t.wrapMethod("cloneShallow",br(xCt,i)),gt(t.CHANGABLE_METHODS,function(r){t.wrapMethod(r,br(yCt,i))}),Vs(e[t.dataType]===t)}function _Ct(i,t){if(SCt(this)){var e=Fe({},Lc(this).datas);e[this.dataType]=t,Uet(t,e,i)}else U3(t,this.dataType,Lc(this).mainData,i);return t}function yCt(i,t){return i.struct&&i.struct.update(),t}function xCt(i,t){return gt(Lc(t).datas,function(e,r){e!==t&&U3(e.cloneShallow(),r,t,i)}),t}function bCt(i){var t=Lc(this).mainData;return i==null||t==null?t:Lc(t).datas[i]}function wCt(){var i=Lc(this).mainData;return i==null?[{data:i}]:ti(on(Lc(i).datas),function(t){return{type:t,data:Lc(i).datas[t]}})}function SCt(i){return Lc(i).mainData===i}function Uet(i,t,e){Lc(i).datas={},gt(t,function(r,n){U3(r,n,i,e)})}function U3(i,t,e,r){Lc(e).datas[t]=i,Lc(i).mainData=e,i.dataType=t,r.struct&&(i[r.structAttr]=r.struct,r.struct[r.datasAttr[t]]=i),i.getLinkedData=bCt,i.getLinkedDataAll=wCt}var TCt=function(){function i(t,e){this.depth=0,this.height=0,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.isExpand=!1,this.name=t||"",this.hostTree=e}return i.prototype.isRemoved=function(){return this.dataIndex<0},i.prototype.eachNode=function(t,e,r){Xi(t)&&(r=e,e=t,t=null),t=t||{},bi(t)&&(t={order:t});var n=t.order||"preorder",o=this[t.attr||"children"],s;n==="preorder"&&(s=e.call(r,this));for(var a=0;!s&&a<o.length;a++)o[a].eachNode(t,e,r);n==="postorder"&&e.call(r,this)},i.prototype.updateDepthAndHeight=function(t){var e=0;this.depth=t;for(var r=0;r<this.children.length;r++){var n=this.children[r];n.updateDepthAndHeight(t+1),n.height>e&&(e=n.height)}this.height=e+1},i.prototype.getNodeById=function(t){if(this.getId()===t)return this;for(var e=0,r=this.children,n=r.length;e<n;e++){var o=r[e].getNodeById(t);if(o)return o}},i.prototype.contains=function(t){if(t===this)return!0;for(var e=0,r=this.children,n=r.length;e<n;e++){var o=r[e].contains(t);if(o)return o}},i.prototype.getAncestors=function(t){for(var e=[],r=t?this:this.parentNode;r;)e.push(r),r=r.parentNode;return e.reverse(),e},i.prototype.getAncestorsIndices=function(){for(var t=[],e=this;e;)t.push(e.dataIndex),e=e.parentNode;return t.reverse(),t},i.prototype.getDescendantIndices=function(){var t=[];return this.eachNode(function(e){t.push(e.dataIndex)}),t},i.prototype.getValue=function(t){var e=this.hostTree.data;return e.getStore().get(e.getDimensionIndex(t||"value"),this.dataIndex)},i.prototype.setLayout=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,t,e)},i.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)},i.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostTree,r=e.data.getItemModel(this.dataIndex);return r.getModel(t)}},i.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]},i.prototype.setVisual=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,t,e)},i.prototype.getVisual=function(t){return this.hostTree.data.getItemVisual(this.dataIndex,t)},i.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)},i.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)},i.prototype.getChildIndex=function(){if(this.parentNode){for(var t=this.parentNode.children,e=0;e<t.length;++e)if(t[e]===this)return e;return-1}return-1},i.prototype.isAncestorOf=function(t){for(var e=t.parentNode;e;){if(e===this)return!0;e=e.parentNode}return!1},i.prototype.isDescendantOf=function(t){return t!==this&&t.isAncestorOf(this)},i}(),ACt=function(){function i(t){this.type="tree",this._nodes=[],this.hostModel=t}return i.prototype.eachNode=function(t,e,r){this.root.eachNode(t,e,r)},i.prototype.getNodeByDataIndex=function(t){var e=this.data.getRawIndex(t);return this._nodes[e]},i.prototype.getNodeById=function(t){return this.root.getNodeById(t)},i.prototype.update=function(){for(var t=this.data,e=this._nodes,r=0,n=e.length;r<n;r++)e[r].dataIndex=-1;for(var r=0,n=t.count();r<n;r++)e[t.getRawIndex(r)].dataIndex=r},i.prototype.clearLayouts=function(){this.data.clearItemLayouts()},i.createTree=function(t,e,r){var n=new i(e),o=[],s=1;a(t);function a(g,v){var y=g.value;s=Math.max(s,Ye(y)?y.length:1),o.push(g);var w=new TCt(Lo(g.name,""),n);v?ICt(w,v):n.root=w,n._nodes.push(w);var I=g.children;if(I)for(var E=0;E<I.length;E++)a(I[E],w)}n.root.updateDepthAndHeight(0);var u=GS(o,{coordDimensions:["value"],dimensionsCount:s}).dimensions,f=new dl(u,e);return f.initData(o),r&&r(f),Vet({mainData:f,struct:n,structAttr:"tree"}),n.update(),n},i}();function ICt(i,t){var e=t.children;i.parentNode!==t&&(e.push(i),i.parentNode=t)}const G3=ACt;function vS(i,t,e){if(i&&Ar(t,i.type)>=0){var r=e.getData().tree.root,n=i.targetNode;if(bi(n)&&(n=r.getNodeById(n)),n&&r.contains(n))return{node:n};var o=i.targetNodeId;if(o!=null&&(n=r.getNodeById(o)))return{node:n}}}function Get(i){for(var t=[];i;)i=i.parentNode,i&&t.push(i);return t.reverse()}function H3(i,t){var e=Get(i);return Ar(e,t)>=0}function DE(i,t){for(var e=[];i;){var r=i.dataIndex;e.push({name:i.name,dataIndex:r,value:t.getRawValue(r)}),i=i.parentNode}return e.reverse(),e}var MCt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.hasSymbolVisual=!0,e.ignoreStyleOnData=!0,e}return t.prototype.getInitialData=function(e){var r={name:e.name,children:e.data},n=e.leaves||{},o=new bn(n,this,this.ecModel),s=G3.createTree(r,this,a);function a(v){v.wrapMethod("getItemModel",function(y,w){var I=s.getNodeByDataIndex(w);return I&&I.children.length&&I.isExpand||(y.parentModel=o),y})}var u=0;s.eachNode("preorder",function(v){v.depth>u&&(u=v.depth)});var f=e.expandAndCollapse,g=f&&e.initialTreeDepth>=0?e.initialTreeDepth:u;return s.root.eachNode("preorder",function(v){var y=v.hostTree.data.getRawDataItem(v.dataIndex);v.isExpand=y&&y.collapsed!=null?!y.collapsed:v.depth<=g}),s.data},t.prototype.getOrient=function(){var e=this.get("orient");return e==="horizontal"?e="LR":e==="vertical"&&(e="TB"),e},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.formatTooltip=function(e,r,n){for(var o=this.getData().tree,s=o.root.children[0],a=o.getNodeByDataIndex(e),u=a.getValue(),f=a.name;a&&a!==s;)f=a.parentNode.name+"."+f,a=a.parentNode;return xo("nameValue",{name:f,value:u,noValue:isNaN(u)||u==null})},t.prototype.getDataParams=function(e){var r=i.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return r.treeAncestors=DE(n,this),r.collapsed=!n.isExpand,r},t.type="series.tree",t.layoutMode="box",t.defaultOption={z:2,coordinateSystemUsage:"box",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:!1,roamTrigger:"global",nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{color:_e.color.borderTint,width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:!0},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500},t}(Ea);const CCt=MCt;function ECt(i,t,e){for(var r=[i],n=[],o;o=r.pop();)if(n.push(o),o.isExpand){var s=o.children;if(s.length)for(var a=0;a<s.length;a++)r.push(s[a])}for(;o=n.pop();)t(o,e)}function Rb(i,t){for(var e=[i],r;r=e.pop();)if(t(r),r.isExpand){var n=r.children;if(n.length)for(var o=n.length-1;o>=0;o--)e.push(n[o])}}function DCt(i,t){i.eachSeriesByType("tree",function(e){PCt(e,t)})}function PCt(i,t){var e=Bo(i,t).refContainer,r=Ca(i.getBoxLayoutParams(),e);i.layoutInfo=r;var n=i.get("layout"),o=0,s=0,a=null;n==="radial"?(o=2*Math.PI,s=Math.min(r.height,r.width)/2,a=d$(function(H,$){return(H.parentNode===$.parentNode?1:2)/H.depth})):(o=r.width,s=r.height,a=d$());var u=i.getData().tree.root,f=u.children[0];if(f){aCt(u),ECt(f,oCt,a),u.hierNode.modifier=-f.hierNode.prelim,Rb(f,sCt);var g=f,v=f,y=f;Rb(f,function(H){var $=H.getLayout().x;$<g.getLayout().x&&(g=H),$>v.getLayout().x&&(v=H),H.depth>y.depth&&(y=H)});var w=g===v?1:a(g,v)/2,I=w-g.getLayout().x,E=0,D=0,R=0,z=0;if(n==="radial")E=o/(v.getLayout().x+w+I),D=s/(y.depth-1||1),Rb(f,function(H){R=(H.getLayout().x+I)*E,z=(H.depth-1)*D;var $=aw(R,z);H.setLayout({x:$.x,y:$.y,rawX:R,rawY:z},!0)});else{var N=i.getOrient();N==="RL"||N==="LR"?(D=s/(v.getLayout().x+w+I),E=o/(y.depth-1||1),Rb(f,function(H){z=(H.getLayout().x+I)*D,R=N==="LR"?(H.depth-1)*E:o-(H.depth-1)*E,H.setLayout({x:R,y:z},!0)})):(N==="TB"||N==="BT")&&(E=o/(v.getLayout().x+w+I),D=s/(y.depth-1||1),Rb(f,function(H){R=(H.getLayout().x+I)*E,z=N==="TB"?(H.depth-1)*D:s-(H.depth-1)*D,H.setLayout({x:R,y:z},!0)}))}}}function LCt(i){i.eachSeriesByType("tree",function(t){var e=t.getData(),r=e.tree;r.eachNode(function(n){var o=n.getModel(),s=o.getModel("itemStyle").getItemStyle(),a=e.ensureUniqueItemVisual(n.dataIndex,"style");Fe(a,s)})})}function RCt(i){i.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"tree",query:t},function(r){var n=t.dataIndex,o=r.getData().tree,s=o.getNodeByDataIndex(n);s.isExpand=!s.isExpand})}),i.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},function(t,e,r){e.eachComponent({mainType:"series",subType:"tree",query:t},function(n){var o=n.coordinateSystem,s=CE(o,t,n.get("scaleLimit"));n.setCenter(s.center),n.setZoom(s.zoom)})})}function kCt(i){i.registerChartView(vCt),i.registerSeriesModel(CCt),i.registerLayout(DCt),i.registerVisual(LCt),RCt(i)}var v$=["treemapZoomToNode","treemapRender","treemapMove"];function OCt(i){for(var t=0;t<v$.length;t++)i.registerAction({type:v$[t],update:"updateView"},uo);i.registerAction({type:"treemapRootToNode",update:"updateView"},function(e,r){r.eachComponent({mainType:"series",subType:"treemap",query:e},n);function n(o,s){var a=["treemapZoomToNode","treemapRootToNode"],u=vS(e,a,o);if(u){var f=o.getViewRoot();f&&(e.direction=H3(f,u.node)?"rollUp":"drillDown"),o.resetViewRoot(u.node)}}})}function Het(i){var t=i.getData(),e=t.tree,r={};e.eachNode(function(n){for(var o=n;o&&o.depth>1;)o=o.parentNode;var s=fz(i.ecModel,o.name||o.dataIndex+"",r);n.setVisual("decal",s)})}var zCt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventUsingHoverLayer=!0,e}return t.prototype.getInitialData=function(e,r){var n={name:e.name,children:e.data};jet(n);var o=e.levels||[],s=this.designatedVisualItemStyle={},a=new bn({itemStyle:s},this,r);o=e.levels=BCt(o,r);var u=ti(o||[],function(v){return new bn(v,a,r)},this),f=G3.createTree(n,this,g);function g(v){v.wrapMethod("getItemModel",function(y,w){var I=f.getNodeByDataIndex(w),E=I?u[I.depth]:null;return y.parentModel=E||a,y})}return f.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=this.getRawValue(e),a=o.getName(e);return xo("nameValue",{name:a,value:s})},t.prototype.getDataParams=function(e){var r=i.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return r.treeAncestors=DE(n,this),r.treePathInfo=r.treeAncestors,r},t.prototype.setLayoutInfo=function(e){this.layoutInfo=this.layoutInfo||{},Fe(this.layoutInfo,e)},t.prototype.mapIdToIndex=function(e){var r=this._idIndexMap;r||(r=this._idIndexMap=Fi(),this._idIndexMapCount=0);var n=r.get(e);return n==null&&r.set(e,n=this._idIndexMapCount++),n},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var r=this.getRawData().tree.root;(!e||e!==r&&!r.contains(e))&&(this._viewRoot=r)},t.prototype.enableAriaDecal=function(){Het(this)},t.type="series.treemap",t.layoutMode="box",t.defaultOption={progressive:0,coordinateSystemUsage:"box",left:_e.size.l,top:_e.size.xxxl,right:_e.size.l,bottom:_e.size.xxxl,sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"",zoomToNodeRatio:.32*.32,scaleLimit:{max:5,min:.2},roam:!0,roamTrigger:"global",nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",bottom:_e.size.m,emptyItemWidth:25,itemStyle:{color:_e.color.backgroundShade,textStyle:{color:_e.color.secondary}},emphasis:{itemStyle:{color:_e.color.background}}},label:{show:!0,distance:0,padding:5,position:"inside",color:_e.color.neutral00,overflow:"truncate"},upperLabel:{show:!1,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:_e.color.neutral00,borderColorSaturation:null},emphasis:{upperLabel:{show:!0,position:[0,"50%"],overflow:"truncate",verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},t}(Ea);function jet(i){var t=0;gt(i.children,function(r){jet(r);var n=r.value;Ye(n)&&(n=n[0]),t+=n});var e=i.value;Ye(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),Ye(i.value)?i.value[0]=e:i.value=e}function BCt(i,t){var e=na(t.get("color")),r=na(t.get(["aria","decal","decals"]));if(e){i=i||[];var n,o;gt(i,function(a){var u=new bn(a),f=u.get("color"),g=u.get("decal");(u.get(["itemStyle","color"])||f&&f!=="none")&&(n=!0),(u.get(["itemStyle","decal"])||g&&g!=="none")&&(o=!0)});var s=i[0]||(i[0]={});return n||(s.color=e.slice()),!o&&r&&(s.decal=r.slice()),i}}const FCt=zCt;var NCt=8,_$=8,NR=5,VCt=function(){function i(t){this.group=new Ki,t.add(this.group)}return i.prototype.render=function(t,e,r,n){var o=t.getModel("breadcrumb"),s=this.group;if(s.removeAll(),!(!o.get("show")||!r)){var a=o.getModel("itemStyle"),u=o.getModel("emphasis"),f=a.getModel("textStyle"),g=u.getModel(["itemStyle","textStyle"]),v=Bo(t,e).refContainer,y={left:o.get("left"),right:o.get("right"),top:o.get("top"),bottom:o.get("bottom")},w={emptyItemWidth:o.get("emptyItemWidth"),totalWidth:0,renderList:[]},I=Ca(y,v);this._prepare(r,w,f),this._renderContent(t,w,I,a,u,f,g,n),vE(s,y,v)}},i.prototype._prepare=function(t,e,r){for(var n=t;n;n=n.parentNode){var o=Lo(n.getModel().get("name"),""),s=r.getTextRect(o),a=Math.max(s.width+NCt*2,e.emptyItemWidth);e.totalWidth+=a+_$,e.renderList.push({node:n,text:o,width:a})}},i.prototype._renderContent=function(t,e,r,n,o,s,a,u){for(var f=0,g=e.emptyItemWidth,v=t.get(["breadcrumb","height"]),y=e.totalWidth,w=e.renderList,I=o.getModel("itemStyle").getItemStyle(),E=w.length-1;E>=0;E--){var D=w[E],R=D.node,z=D.width,N=D.text;y>r.width&&(y-=z-g,z=g,N=null);var H=new gl({shape:{points:UCt(f,0,z,v,E===w.length-1,E===0)},style:rr(n.getItemStyle(),{lineJoin:"bevel"}),textContent:new _n({style:fa(s,{text:N})}),textConfig:{position:"inside"},z2:N0*1e4,onclick:br(u,R)});H.disableLabelAnimation=!0,H.getTextContent().ensureState("emphasis").style=fa(a,{text:N}),H.ensureState("emphasis").style=I,Ma(H,o.get("focus"),o.get("blurScope"),o.get("disabled")),this.group.add(H),GCt(H,t,R),f+=z+_$}},i.prototype.remove=function(){this.group.removeAll()},i}();function UCt(i,t,e,r,n,o){var s=[[n?i:i-NR,t],[i+e,t],[i+e,t+r],[n?i:i-NR,t+r]];return!o&&s.splice(2,0,[i+e+NR,t+r/2]),!n&&s.push([i,t+r/2]),s}function GCt(i,t,e){ur(i).eventData={componentType:"series",componentSubType:"treemap",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:e&&e.dataIndex,name:e&&e.name},treePathInfo:e&&DE(e,t)}}const HCt=VCt;var jCt=function(){function i(){this._storage=[],this._elExistsMap={}}return i.prototype.add=function(t,e,r,n,o){return this._elExistsMap[t.id]?!1:(this._elExistsMap[t.id]=!0,this._storage.push({el:t,target:e,duration:r,delay:n,easing:o}),!0)},i.prototype.finished=function(t){return this._finishedCallback=t,this},i.prototype.start=function(){for(var t=this,e=this._storage.length,r=function(){e--,e<=0&&(t._storage.length=0,t._elExistsMap={},t._finishedCallback&&t._finishedCallback())},n=0,o=this._storage.length;n<o;n++){var s=this._storage[n];s.el.animateTo(s.target,{duration:s.duration,delay:s.delay,easing:s.easing,setToFinal:!0,done:r,aborted:r})}return this},i}();function WCt(){return new jCt}var qz=Ki,y$=jr,x$=3,b$="label",w$="upperLabel",$Ct=N0*10,ZCt=N0*2,qCt=N0*3,Pm=pv([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),S$=function(i){var t=Pm(i);return t.stroke=t.fill=t.lineWidth=null,t},cC=Wr(),XCt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._state="ready",e._storage=kb(),e}return t.prototype.render=function(e,r,n,o){var s=r.findComponents({mainType:"series",subType:"treemap",query:o});if(!(Ar(s,e)<0)){this.seriesModel=e,this.api=n,this.ecModel=r;var a=["treemapZoomToNode","treemapRootToNode"],u=vS(o,a,e),f=o&&o.type,g=e.layoutInfo,v=!this._oldTree,y=this._storage,w=f==="treemapRootToNode"&&u&&y?{rootNodeGroup:y.nodeGroup[u.node.getRawIndex()],direction:o.direction}:null,I=this._giveContainerGroup(g),E=e.get("animation"),D=this._doRender(I,e,w);E&&!v&&(!f||f==="treemapZoomToNode"||f==="treemapRootToNode")?this._doAnimation(I,D,e,w):D.renderFinally(),this._resetController(n),this._renderBreadcrumb(e,n,u)}},t.prototype._giveContainerGroup=function(e){var r=this._containerGroup;return r||(r=this._containerGroup=new qz,this._initEvents(r),this.group.add(r)),r.x=e.x,r.y=e.y,r},t.prototype._doRender=function(e,r,n){var o=r.getData().tree,s=this._oldTree,a=kb(),u=kb(),f=this._storage,g=[];function v(z,N,H,$){return YCt(r,u,f,n,a,g,z,N,H,$)}E(o.root?[o.root]:[],s&&s.root?[s.root]:[],e,o===s||!s,0);var y=D(f);if(this._oldTree=o,this._storage=u,this._controllerHost){var w=this.seriesModel.layoutInfo,I=o.root.getLayout();I.width===w.width&&I.height===w.height&&(this._controllerHost.zoom=1)}return{lastsForAnimation:a,willDeleteEls:y,renderFinally:R};function E(z,N,H,$,X){$?(N=z,gt(z,function(rt,lt){!rt.isRemoved()&&et(lt,lt)})):new Od(N,z,K,K).add(et).update(et).remove(br(et,null)).execute();function K(rt){return rt.getId()}function et(rt,lt){var ht=rt!=null?z[rt]:null,yt=lt!=null?N[lt]:null,ft=v(ht,yt,H,X);ft&&E(ht&&ht.viewChildren||[],yt&&yt.viewChildren||[],ft,$,X+1)}}function D(z){var N=kb();return z&&gt(z,function(H,$){var X=N[$];gt(H,function(K){K&&(X.push(K),cC(K).willDelete=!0)})}),N}function R(){gt(y,function(z){gt(z,function(N){N.parent&&N.parent.remove(N)})}),gt(g,function(z){z.invisible=!0,z.dirty()})}},t.prototype._doAnimation=function(e,r,n,o){var s=n.get("animationDurationUpdate"),a=n.get("animationEasing"),u=(Xi(s)?0:s)||0,f=(Xi(a)?null:a)||"cubicOut",g=WCt();gt(r.willDeleteEls,function(v,y){gt(v,function(w,I){if(!w.invisible){var E=w.parent,D,R=cC(E);if(o&&o.direction==="drillDown")D=E===o.rootNodeGroup?{shape:{x:0,y:0,width:R.nodeWidth,height:R.nodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var z=0,N=0;R.willDelete||(z=R.nodeWidth/2,N=R.nodeHeight/2),D=y==="nodeGroup"?{x:z,y:N,style:{opacity:0}}:{shape:{x:z,y:N,width:0,height:0},style:{opacity:0}}}D&&g.add(w,D,u,0,f)}})}),gt(this._storage,function(v,y){gt(v,function(w,I){var E=r.lastsForAnimation[y][I],D={};E&&(w instanceof Ki?E.oldX!=null&&(D.x=w.x,D.y=w.y,w.x=E.oldX,w.y=E.oldY):(E.oldShape&&(D.shape=Fe({},w.shape),w.setShape(E.oldShape)),E.fadein?(w.setStyle("opacity",0),D.style={opacity:1}):w.style.opacity!==1&&(D.style={opacity:1})),g.add(w,D,u,0,f))})},this),this._state="animating",g.finished(wi(function(){this._state="ready",r.renderFinally()},this)).start()},t.prototype._resetController=function(e){var r=this,n=this._controller,o=this._controllerHost;o||(this._controllerHost={target:this.group},o=this._controllerHost);var s=this.seriesModel;n||(n=this._controller=new Lv(e.getZr()),n.on("pan",wi(this._onPan,this)),n.on("zoom",wi(this._onZoom,this))),n.enable(s.get("roam"),{api:e,zInfo:{component:s},triggerInfo:{roamTrigger:s.get("roamTrigger"),isInSelf:function(a,u,f){var g=r._containerGroup;return g?g.getBoundingRect().contain(u-g.x,f-g.y):!1}}}),o.zoomLimit=s.get("scaleLimit"),o.zoom=s.get("zoom")},t.prototype._clearController=function(){var e=this._controller;this._controllerHost=null,e&&(e.dispose(),e=null)},t.prototype._onPan=function(e){if(this._state!=="animating"&&(Math.abs(e.dx)>x$||Math.abs(e.dy)>x$)){var r=this.seriesModel.getData().tree.root;if(!r)return;var n=r.getLayout();if(!n)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:n.x+e.dx,y:n.y+e.dy,width:n.width,height:n.height}})}},t.prototype._onZoom=function(e){var r=e.originX,n=e.originY,o=e.scale;if(this._state!=="animating"){var s=this.seriesModel.getData().tree.root;if(!s)return;var a=s.getLayout();if(!a)return;var u=new sr(a.x,a.y,a.width,a.height),f=null,g=this._controllerHost;f=g.zoomLimit;var v=g.zoom=g.zoom||1;if(v*=o,f){var y=f.min||0,w=f.max||1/0;v=Math.max(Math.min(w,v),y)}var I=v/g.zoom;g.zoom=v;var E=this.seriesModel.layoutInfo;r-=E.x,n-=E.y;var D=ns();xh(D,D,[-r,-n]),bF(D,D,[I,I]),xh(D,D,[r,n]),u.applyTransform(D),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:u.x,y:u.y,width:u.width,height:u.height}})}},t.prototype._initEvents=function(e){var r=this;e.on("click",function(n){if(r._state==="ready"){var o=r.seriesModel.get("nodeClick",!0);if(o){var s=r.findTarget(n.offsetX,n.offsetY);if(s){var a=s.node;if(a.getLayout().isLeafRoot)r._rootToNode(s);else if(o==="zoomToNode")r._zoomToNode(s);else if(o==="link"){var u=a.hostTree.data.getItemModel(a.dataIndex),f=u.get("link",!0),g=u.get("target",!0)||"blank";f&&VM(f,g)}}}}},this)},t.prototype._renderBreadcrumb=function(e,r,n){var o=this;n||(n=e.get("leafDepth",!0)!=null?{node:e.getViewRoot()}:this.findTarget(r.getWidth()/2,r.getHeight()/2),n||(n={node:e.getData().tree.root})),(this._breadcrumb||(this._breadcrumb=new HCt(this.group))).render(e,r,n.node,function(s){o._state!=="animating"&&(H3(e.getViewRoot(),s)?o._rootToNode({node:s}):o._zoomToNode({node:s}))})},t.prototype.remove=function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage=kb(),this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},t.prototype.dispose=function(){this._clearController()},t.prototype._zoomToNode=function(e){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype._rootToNode=function(e){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype.findTarget=function(e,r){var n,o=this.seriesModel.getViewRoot();return o.eachNode({attr:"viewChildren",order:"preorder"},function(s){var a=this._storage.background[s.getRawIndex()];if(a){var u=a.transformCoordToLocal(e,r),f=a.shape;if(f.x<=u[0]&&u[0]<=f.x+f.width&&f.y<=u[1]&&u[1]<=f.y+f.height)n={node:s,offsetX:u[0],offsetY:u[1]};else return!1}},this),n},t.type="treemap",t}(pa);function kb(){return{nodeGroup:[],background:[],content:[]}}function YCt(i,t,e,r,n,o,s,a,u,f){if(!s)return;var g=s.getLayout(),v=i.getData(),y=s.getModel();if(v.setItemGraphicEl(s.dataIndex,null),!g||!g.isInView)return;var w=g.width,I=g.height,E=g.borderWidth,D=g.invisible,R=s.getRawIndex(),z=a&&a.getRawIndex(),N=s.viewChildren,H=g.upperHeight,$=N&&N.length,X=y.getModel("itemStyle"),K=y.getModel(["emphasis","itemStyle"]),et=y.getModel(["blur","itemStyle"]),rt=y.getModel(["select","itemStyle"]),lt=X.get("borderRadius")||0,ht=Pi("nodeGroup",qz);if(!ht)return;if(u.add(ht),ht.x=g.x||0,ht.y=g.y||0,ht.markRedraw(),cC(ht).nodeWidth=w,cC(ht).nodeHeight=I,g.isAboveViewRoot)return ht;var yt=Pi("background",y$,f,ZCt);yt&&fe(ht,yt,$&&g.upperLabelHeight);var ft=y.getModel("emphasis"),kt=ft.get("focus"),Rt=ft.get("blurScope"),Ct=ft.get("disabled"),Gt=kt==="ancestor"?s.getAncestorsIndices():kt==="descendant"?s.getDescendantIndices():kt;if($)iS(ht)&&Hm(ht,!1),yt&&(Hm(yt,!Ct),v.setItemGraphicEl(s.dataIndex,yt),ez(yt,Gt,Rt));else{var Vt=Pi("content",y$,f,qCt);Vt&&Te(ht,Vt),yt.disableMorphing=!0,yt&&iS(yt)&&Hm(yt,!1),Hm(ht,!Ct),v.setItemGraphicEl(s.dataIndex,ht);var Qt=y.getShallow("cursor");Qt&&Vt.attr("cursor",Qt),ez(ht,Gt,Rt)}return ht;function fe(Ze,ye,Ke){var We=ur(ye);if(We.dataIndex=s.dataIndex,We.seriesIndex=i.seriesIndex,ye.setShape({x:0,y:0,width:w,height:I,r:lt}),D)be(ye);else{ye.invisible=!1;var Si=s.getVisual("style"),zt=Si.stroke,Zt=S$(X);Zt.fill=zt;var pe=Pm(K);pe.fill=K.get("borderColor");var $e=Pm(et);$e.fill=et.get("borderColor");var He=Pm(rt);if(He.fill=rt.get("borderColor"),Ke){var qe=w-2*E;Ge(ye,zt,Si.opacity,{x:E,y:0,width:qe,height:H})}else ye.removeTextContent();ye.setStyle(Zt),ye.ensureState("emphasis").style=pe,ye.ensureState("blur").style=$e,ye.ensureState("select").style=He,gv(ye)}Ze.add(ye)}function Te(Ze,ye){var Ke=ur(ye);Ke.dataIndex=s.dataIndex,Ke.seriesIndex=i.seriesIndex;var We=Math.max(w-2*E,0),Si=Math.max(I-2*E,0);if(ye.culling=!0,ye.setShape({x:E,y:E,width:We,height:Si,r:lt}),D)be(ye);else{ye.invisible=!1;var zt=s.getVisual("style"),Zt=zt.fill,pe=S$(X);pe.fill=Zt,pe.decal=zt.decal;var $e=Pm(K),He=Pm(et),qe=Pm(rt);Ge(ye,Zt,zt.opacity,null),ye.setStyle(pe),ye.ensureState("emphasis").style=$e,ye.ensureState("blur").style=He,ye.ensureState("select").style=qe,gv(ye)}Ze.add(ye)}function be(Ze){!Ze.invisible&&o.push(Ze)}function Ge(Ze,ye,Ke,We){var Si=y.getModel(We?w$:b$),zt=Lo(y.get("name"),null),Zt=Si.getShallow("show");qo(Ze,zo(y,We?w$:b$),{defaultText:Zt?zt:null,inheritColor:ye,defaultOpacity:Ke,labelFetcher:i,labelDataIndex:s.dataIndex});var pe=Ze.getTextContent();if(pe){var $e=pe.style,He=YC($e.padding||0);We&&(Ze.setTextConfig({layoutRect:We}),pe.disableLabelLayout=!0),pe.beforeUpdate=function(){var Ti=Math.max((We?We.width:Ze.shape.width)-He[1]-He[3],0),Ai=Math.max((We?We.height:Ze.shape.height)-He[0]-He[2],0);($e.width!==Ti||$e.height!==Ai)&&pe.setStyle({width:Ti,height:Ai})},$e.truncateMinChar=2,$e.lineOverflow="truncate",li($e,We,g);var qe=pe.getState("emphasis");li(qe?qe.style:null,We,g)}}function li(Ze,ye,Ke){var We=Ze?Ze.text:null;if(!ye&&Ke.isLeafRoot&&We!=null){var Si=i.get("drillDownIcon",!0);Ze.text=Si?Si+" "+We:We}}function Pi(Ze,ye,Ke,We){var Si=z!=null&&e[Ze][z],zt=n[Ze];return Si?(e[Ze][z]=null,or(zt,Si)):D||(Si=new ye,Si instanceof kc&&(Si.z2=KCt(Ke,We)),Ve(zt,Si)),t[Ze][R]=Si}function or(Ze,ye){var Ke=Ze[R]={};ye instanceof qz?(Ke.oldX=ye.x,Ke.oldY=ye.y):Ke.oldShape=Fe({},ye.shape)}function Ve(Ze,ye){var Ke=Ze[R]={},We=s.parentNode,Si=ye instanceof Ki;if(We&&(!r||r.direction==="drillDown")){var zt=0,Zt=0,pe=n.background[We.getRawIndex()];!r&&pe&&pe.oldShape&&(zt=pe.oldShape.width,Zt=pe.oldShape.height),Si?(Ke.oldX=0,Ke.oldY=Zt):Ke.oldShape={x:zt,y:Zt,width:0,height:0}}Ke.fadein=!Si}}function KCt(i,t){return i*$Ct+t}const JCt=XCt;var _S=gt,QCt=nr,uC=-1,j3=function(){function i(t){var e=t.mappingMethod,r=t.type,n=this.option=Yi(t);this.type=r,this.mappingMethod=e,this._normalizeData=iEt[e];var o=i.visualHandlers[r];this.applyVisual=o.applyVisual,this.getColorMapper=o.getColorMapper,this._normalizedToVisual=o._normalizedToVisual[e],e==="piecewise"?(VR(n),tEt(n)):e==="category"?n.categories?eEt(n):VR(n,!0):(Vs(e!=="linear"||n.dataExtent),VR(n))}return i.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},i.prototype.getNormalizer=function(){return wi(this._normalizeData,this)},i.listVisualTypes=function(){return on(i.visualHandlers)},i.isValidType=function(t){return i.visualHandlers.hasOwnProperty(t)},i.eachVisual=function(t,e,r){nr(t)?gt(t,e,r):e.call(r,t)},i.mapVisual=function(t,e,r){var n,o=Ye(t)?[]:nr(t)?{}:(n=!0,null);return i.eachVisual(t,function(s,a){var u=e.call(r,s,a);n?o=u:o[a]=u}),o},i.retrieveVisuals=function(t){var e={},r;return t&&_S(i.visualHandlers,function(n,o){t.hasOwnProperty(o)&&(e[o]=t[o],r=!0)}),r?e:null},i.prepareVisualTypes=function(t){if(Ye(t))t=t.slice();else if(QCt(t)){var e=[];_S(t,function(r,n){e.push(n)}),t=e}else return[];return t.sort(function(r,n){return n==="color"&&r!=="color"&&r.indexOf("color")===0?1:-1}),t},i.dependsOn=function(t,e){return e==="color"?!!(t&&t.indexOf(e)===0):t===e},i.findPieceIndex=function(t,e,r){for(var n,o=1/0,s=0,a=e.length;s<a;s++){var u=e[s].value;if(u!=null){if(u===t||bi(u)&&u===t+"")return s;r&&y(u,s)}}for(var s=0,a=e.length;s<a;s++){var f=e[s],g=f.interval,v=f.close;if(g){if(g[0]===-1/0){if(JA(v[1],t,g[1]))return s}else if(g[1]===1/0){if(JA(v[0],g[0],t))return s}else if(JA(v[0],g[0],t)&&JA(v[1],t,g[1]))return s;r&&y(g[0],s),r&&y(g[1],s)}}if(r)return t===1/0?e.length-1:t===-1/0?0:n;function y(w,I){var E=Math.abs(w-t);E<o&&(o=E,n=I)}},i.visualHandlers={color:{applyVisual:Ob("color"),getColorMapper:function(){var t=this.option;return wi(t.mappingMethod==="category"?function(e,r){return!r&&(e=this._normalizeData(e)),ow.call(this,e)}:function(e,r,n){var o=!!n;return!r&&(e=this._normalizeData(e)),n=bL(e,t.parsedVisual,n),o?n:ph(n,"rgba")},this)},_normalizedToVisual:{linear:function(t){return ph(bL(t,this.option.parsedVisual),"rgba")},category:ow,piecewise:function(t,e){var r=Yz.call(this,e);return r==null&&(r=ph(bL(t,this.option.parsedVisual),"rgba")),r},fixed:Lm}},colorHue:KA(function(t,e){return bp(t,e)}),colorSaturation:KA(function(t,e){return bp(t,null,e)}),colorLightness:KA(function(t,e){return bp(t,null,null,e)}),colorAlpha:KA(function(t,e){return IM(t,e)}),decal:{applyVisual:Ob("decal"),_normalizedToVisual:{linear:null,category:ow,piecewise:null,fixed:null}},opacity:{applyVisual:Ob("opacity"),_normalizedToVisual:Xz([0,1])},liftZ:{applyVisual:Ob("liftZ"),_normalizedToVisual:{linear:Lm,category:Lm,piecewise:Lm,fixed:Lm}},symbol:{applyVisual:function(t,e,r){var n=this.mapValueToVisual(t);r("symbol",n)},_normalizedToVisual:{linear:T$,category:ow,piecewise:function(t,e){var r=Yz.call(this,e);return r==null&&(r=T$.call(this,t)),r},fixed:Lm}},symbolSize:{applyVisual:Ob("symbolSize"),_normalizedToVisual:Xz([0,1])}},i}();function tEt(i){var t=i.pieceList;i.hasSpecialVisual=!1,gt(t,function(e,r){e.originIndex=r,e.visual!=null&&(i.hasSpecialVisual=!0)})}function eEt(i){var t=i.categories,e=i.categoryMap={},r=i.visual;if(_S(t,function(s,a){e[s]=a}),!Ye(r)){var n=[];nr(r)?_S(r,function(s,a){var u=e[a];n[u??uC]=s}):n[uC]=r,r=Wet(i,n)}for(var o=t.length-1;o>=0;o--)r[o]==null&&(delete e[t[o]],t.pop())}function VR(i,t){var e=i.visual,r=[];nr(e)?_S(e,function(o){r.push(o)}):e!=null&&r.push(e);var n={color:1,symbol:1};!t&&r.length===1&&!n.hasOwnProperty(i.type)&&(r[1]=r[0]),Wet(i,r)}function KA(i){return{applyVisual:function(t,e,r){var n=this.mapValueToVisual(t);r("color",i(e("color"),n))},_normalizedToVisual:Xz([0,1])}}function T$(i){var t=this.option.visual;return t[Math.round(Ln(i,[0,1],[0,t.length-1],!0))]||{}}function Ob(i){return function(t,e,r){r(i,this.mapValueToVisual(t))}}function ow(i){var t=this.option.visual;return t[this.option.loop&&i!==uC?i%t.length:i]}function Lm(){return this.option.visual[0]}function Xz(i){return{linear:function(t){return Ln(t,i,this.option.visual,!0)},category:ow,piecewise:function(t,e){var r=Yz.call(this,e);return r==null&&(r=Ln(t,i,this.option.visual,!0)),r},fixed:Lm}}function Yz(i){var t=this.option,e=t.pieceList;if(t.hasSpecialVisual){var r=j3.findPieceIndex(i,e),n=e[r];if(n&&n.visual)return n.visual[this.type]}}function Wet(i,t){return i.visual=t,i.type==="color"&&(i.parsedVisual=ti(t,function(e){var r=Ol(e);return r||[0,0,0,1]})),t}var iEt={linear:function(i){return Ln(i,this.option.dataExtent,[0,1],!0)},piecewise:function(i){var t=this.option.pieceList,e=j3.findPieceIndex(i,t,!0);if(e!=null)return Ln(e,[0,t.length-1],[0,1],!0)},category:function(i){var t=this.option.categories?this.option.categoryMap[i]:i;return t??uC},fixed:uo};function JA(i,t,e){return i?t<=e:t<e}const _s=j3;var rEt="itemStyle",$et=Wr();const nEt={seriesType:"treemap",reset:function(i){var t=i.getData().tree,e=t.root;e.isRemoved()||Zet(e,{},i.getViewRoot().getAncestors(),i)}};function Zet(i,t,e,r){var n=i.getModel(),o=i.getLayout(),s=i.hostTree.data;if(!(!o||o.invisible||!o.isInView)){var a=n.getModel(rEt),u=aEt(a,t,r),f=s.ensureUniqueItemVisual(i.dataIndex,"style"),g=a.get("borderColor"),v=a.get("borderColorSaturation"),y;v!=null&&(y=A$(u),g=oEt(v,y)),f.stroke=g;var w=i.viewChildren;if(!w||!w.length)y=A$(u),f.fill=y;else{var I=sEt(i,n,o,a,u,w);gt(w,function(E,D){if(E.depth>=e.length||E===e[E.depth]){var R=lEt(n,u,E,D,I,r);Zet(E,R,e,r)}})}}}function aEt(i,t,e){var r=Fe({},t),n=e.designatedVisualItemStyle;return gt(["color","colorAlpha","colorSaturation"],function(o){n[o]=t[o];var s=i.get(o);n[o]=null,s!=null&&(r[o]=s)}),r}function A$(i){var t=UR(i,"color");if(t){var e=UR(i,"colorAlpha"),r=UR(i,"colorSaturation");return r&&(t=bp(t,null,null,r)),e&&(t=IM(t,e)),t}}function oEt(i,t){return t!=null?bp(t,null,null,i):null}function UR(i,t){var e=i[t];if(e!=null&&e!=="none")return e}function sEt(i,t,e,r,n,o){if(!(!o||!o.length)){var s=GR(t,"color")||n.color!=null&&n.color!=="none"&&(GR(t,"colorAlpha")||GR(t,"colorSaturation"));if(s){var a=t.get("visualMin"),u=t.get("visualMax"),f=e.dataExtent.slice();a!=null&&a<f[0]&&(f[0]=a),u!=null&&u>f[1]&&(f[1]=u);var g=t.get("colorMappingBy"),v={type:s.name,dataExtent:f,visual:s.range};v.type==="color"&&(g==="index"||g==="id")?(v.mappingMethod="category",v.loop=!0):v.mappingMethod="linear";var y=new _s(v);return $et(y).drColorMappingBy=g,y}}}function GR(i,t){var e=i.get(t);return Ye(e)&&e.length?{name:t,range:e}:null}function lEt(i,t,e,r,n,o){var s=Fe({},t);if(n){var a=n.type,u=a==="color"&&$et(n).drColorMappingBy,f=u==="index"?r:u==="id"?o.mapIdToIndex(e.getId()):e.getValue(i.get("visualDimension"));s[a]=n.mapValueToVisual(f)}return s}var yS=Math.max,hC=Math.min,I$=vs,W3=gt,qet=["itemStyle","borderWidth"],cEt=["itemStyle","gapWidth"],uEt=["upperLabel","show"],hEt=["upperLabel","height"];const dEt={seriesType:"treemap",reset:function(i,t,e,r){var n=i.option,o=Bo(i,e).refContainer,s=Ca(i.getBoxLayoutParams(),o),a=n.size||[],u=xi(I$(s.width,a[0]),o.width),f=xi(I$(s.height,a[1]),o.height),g=r&&r.type,v=["treemapZoomToNode","treemapRootToNode"],y=vS(r,v,i),w=g==="treemapRender"||g==="treemapMove"?r.rootRect:null,I=i.getViewRoot(),E=Get(I);if(g!=="treemapMove"){var D=g==="treemapZoomToNode"?_Et(i,y,I,u,f):w?[w.width,w.height]:[u,f],R=n.sort;R&&R!=="asc"&&R!=="desc"&&(R="desc");var z={squareRatio:n.squareRatio,sort:R,leafDepth:n.leafDepth};I.hostTree.clearLayouts();var N={x:0,y:0,width:D[0],height:D[1],area:D[0]*D[1]};I.setLayout(N),Xet(I,z,!1,0),N=I.getLayout(),W3(E,function($,X){var K=(E[X+1]||I).getValue();$.setLayout(Fe({dataExtent:[K,K],borderWidth:0,upperHeight:0},N))})}var H=i.getData().tree.root;H.setLayout(yEt(s,w,y),!0),i.setLayoutInfo(s),Yet(H,new sr(-s.x,-s.y,e.getWidth(),e.getHeight()),E,I,0)}};function Xet(i,t,e,r){var n,o;if(!i.isRemoved()){var s=i.getLayout();n=s.width,o=s.height;var a=i.getModel(),u=a.get(qet),f=a.get(cEt)/2,g=Ket(a),v=Math.max(u,g),y=u-f,w=v-f;i.setLayout({borderWidth:u,upperHeight:v,upperLabelHeight:g},!0),n=yS(n-2*y,0),o=yS(o-y-w,0);var I=n*o,E=fEt(i,a,I,t,e,r);if(E.length){var D={x:y,y:w,width:n,height:o},R=hC(n,o),z=1/0,N=[];N.area=0;for(var H=0,$=E.length;H<$;){var X=E[H];N.push(X),N.area+=X.getLayout().area;var K=vEt(N,R,t.squareRatio);K<=z?(H++,z=K):(N.area-=N.pop().getLayout().area,M$(N,R,D,f,!1),R=hC(D.width,D.height),N.length=N.area=0,z=1/0)}if(N.length&&M$(N,R,D,f,!0),!e){var et=a.get("childrenVisibleMin");et!=null&&I<et&&(e=!0)}for(var H=0,$=E.length;H<$;H++)Xet(E[H],t,e,r+1)}}}function fEt(i,t,e,r,n,o){var s=i.children||[],a=r.sort;a!=="asc"&&a!=="desc"&&(a=null);var u=r.leafDepth!=null&&r.leafDepth<=o;if(n&&!u)return i.viewChildren=[];s=Rn(s,function(w){return!w.isRemoved()}),gEt(s,a);var f=mEt(t,s,a);if(f.sum===0)return i.viewChildren=[];if(f.sum=pEt(t,e,f.sum,a,s),f.sum===0)return i.viewChildren=[];for(var g=0,v=s.length;g<v;g++){var y=s[g].getValue()/f.sum*e;s[g].setLayout({area:y})}return u&&(s.length&&i.setLayout({isLeafRoot:!0},!0),s.length=0),i.viewChildren=s,i.setLayout({dataExtent:f.dataExtent},!0),s}function pEt(i,t,e,r,n){if(!r)return e;for(var o=i.get("visibleMin"),s=n.length,a=s,u=s-1;u>=0;u--){var f=n[r==="asc"?s-u-1:u].getValue();f/e*t<o&&(a=u,e-=f)}return r==="asc"?n.splice(0,s-a):n.splice(a,s-a),e}function gEt(i,t){return t&&i.sort(function(e,r){var n=t==="asc"?e.getValue()-r.getValue():r.getValue()-e.getValue();return n===0?t==="asc"?e.dataIndex-r.dataIndex:r.dataIndex-e.dataIndex:n}),i}function mEt(i,t,e){for(var r=0,n=0,o=t.length;n<o;n++)r+=t[n].getValue();var s=i.get("visualDimension"),a;return!t||!t.length?a=[NaN,NaN]:s==="value"&&e?(a=[t[t.length-1].getValue(),t[0].getValue()],e==="asc"&&a.reverse()):(a=[1/0,-1/0],W3(t,function(u){var f=u.getValue(s);f<a[0]&&(a[0]=f),f>a[1]&&(a[1]=f)})),{sum:r,dataExtent:a}}function vEt(i,t,e){for(var r=0,n=1/0,o=0,s=void 0,a=i.length;o<a;o++)s=i[o].getLayout().area,s&&(s<n&&(n=s),s>r&&(r=s));var u=i.area*i.area,f=t*t*e;return u?yS(f*r/u,u/(f*n)):1/0}function M$(i,t,e,r,n){var o=t===e.width?0:1,s=1-o,a=["x","y"],u=["width","height"],f=e[a[o]],g=t?i.area/t:0;(n||g>e[u[s]])&&(g=e[u[s]]);for(var v=0,y=i.length;v<y;v++){var w=i[v],I={},E=g?w.getLayout().area/g:0,D=I[u[s]]=yS(g-2*r,0),R=e[a[o]]+e[u[o]]-f,z=v===y-1||R<E?R:E,N=I[u[o]]=yS(z-2*r,0);I[a[s]]=e[a[s]]+hC(r,D/2),I[a[o]]=f+hC(r,N/2),f+=z,w.setLayout(I,!0)}e[a[s]]+=g,e[u[s]]-=g}function _Et(i,t,e,r,n){var o=(t||{}).node,s=[r,n];if(!o||o===e)return s;for(var a,u=r*n,f=u*i.option.zoomToNodeRatio;a=o.parentNode;){for(var g=0,v=a.children,y=0,w=v.length;y<w;y++)g+=v[y].getValue();var I=o.getValue();if(I===0)return s;f*=g/I;var E=a.getModel(),D=E.get(qet),R=Math.max(D,Ket(E));f+=4*D*D+(3*D+R)*Math.pow(f,.5),f>PH&&(f=PH),o=a}f<u&&(f=u);var z=Math.pow(f/u,.5);return[r*z,n*z]}function yEt(i,t,e){if(t)return{x:t.x,y:t.y};var r={x:0,y:0};if(!e)return r;var n=e.node,o=n.getLayout();if(!o)return r;for(var s=[o.width/2,o.height/2],a=n;a;){var u=a.getLayout();s[0]+=u.x,s[1]+=u.y,a=a.parentNode}return{x:i.width/2-s[0],y:i.height/2-s[1]}}function Yet(i,t,e,r,n){var o=i.getLayout(),s=e[n],a=s&&s===i;if(!(s&&!a||n===e.length&&i!==r)){i.setLayout({isInView:!0,invisible:!a&&!t.intersect(o),isAboveViewRoot:a},!0);var u=new sr(t.x-o.x,t.y-o.y,t.width,t.height);W3(i.viewChildren||[],function(f){Yet(f,u,e,r,n+1)})}}function Ket(i){return i.get(uEt)?i.get(hEt):0}function xEt(i){i.registerSeriesModel(FCt),i.registerChartView(JCt),i.registerVisual(nEt),i.registerLayout(dEt),OCt(i)}function bEt(i){var t=i.findComponents({mainType:"legend"});!t||!t.length||i.eachSeriesByType("graph",function(e){var r=e.getCategoriesData(),n=e.getGraph(),o=n.data,s=r.mapArray(r.getName);o.filterSelf(function(a){var u=o.getItemModel(a),f=u.getShallow("category");if(f!=null){fn(f)&&(f=s[f]);for(var g=0;g<t.length;g++)if(!t[g].isSelected(f))return!1}return!0})})}function wEt(i){var t={};i.eachSeriesByType("graph",function(e){var r=e.getCategoriesData(),n=e.getData(),o={};r.each(function(s){var a=r.getName(s);o["ec-"+a]=s;var u=r.getItemModel(s),f=u.getModel("itemStyle").getItemStyle();f.fill||(f.fill=e.getColorFromPalette(a,t)),r.setItemVisual(s,"style",f);for(var g=["symbol","symbolSize","symbolKeepAspect"],v=0;v<g.length;v++){var y=u.getShallow(g[v],!0);y!=null&&r.setItemVisual(s,g[v],y)}}),r.count()&&n.each(function(s){var a=n.getItemModel(s),u=a.getShallow("category");if(u!=null){bi(u)&&(u=o["ec-"+u]);var f=r.getItemVisual(u,"style"),g=n.ensureUniqueItemVisual(s,"style");Fe(g,f);for(var v=["symbol","symbolSize","symbolKeepAspect"],y=0;y<v.length;y++)n.setItemVisual(s,v[y],r.getItemVisual(u,v[y]))}})})}function QA(i){return i instanceof Array||(i=[i,i]),i}function SEt(i){i.eachSeriesByType("graph",function(t){var e=t.getGraph(),r=t.getEdgeData(),n=QA(t.get("edgeSymbol")),o=QA(t.get("edgeSymbolSize"));r.setVisual("fromSymbol",n&&n[0]),r.setVisual("toSymbol",n&&n[1]),r.setVisual("fromSymbolSize",o&&o[0]),r.setVisual("toSymbolSize",o&&o[1]),r.setVisual("style",t.getModel("lineStyle").getLineStyle()),r.each(function(s){var a=r.getItemModel(s),u=e.getEdgeByIndex(s),f=QA(a.getShallow("symbol",!0)),g=QA(a.getShallow("symbolSize",!0)),v=a.getModel("lineStyle").getLineStyle(),y=r.ensureUniqueItemVisual(s,"style");switch(Fe(y,v),y.stroke){case"source":{var w=u.node1.getVisual("style");y.stroke=w&&w.fill;break}case"target":{var w=u.node2.getVisual("style");y.stroke=w&&w.fill;break}}f[0]&&u.setVisual("fromSymbol",f[0]),f[1]&&u.setVisual("toSymbol",f[1]),g[0]&&u.setVisual("fromSymbolSize",g[0]),g[1]&&u.setVisual("toSymbolSize",g[1])})})}var Kz="-->",PE=function(i){return i.get("autoCurveness")||null},Jet=function(i,t){var e=PE(i),r=20,n=[];if(fn(e))r=e;else if(Ye(e)){i.__curvenessList=e;return}t>r&&(r=t);var o=r%2?r+2:r+3;n=[];for(var s=0;s<o;s++)n.push((s%2?s+1:s)/10*(s%2?-1:1));i.__curvenessList=n},xS=function(i,t,e){var r=[i.id,i.dataIndex].join("."),n=[t.id,t.dataIndex].join(".");return[e.uid,r,n].join(Kz)},Qet=function(i){var t=i.split(Kz);return[t[0],t[2],t[1]].join(Kz)},TEt=function(i,t){var e=xS(i.node1,i.node2,t);return t.__edgeMap[e]},AEt=function(i,t){var e=Jz(xS(i.node1,i.node2,t),t),r=Jz(xS(i.node2,i.node1,t),t);return e+r},Jz=function(i,t){var e=t.__edgeMap;return e[i]?e[i].length:0};function IEt(i){PE(i)&&(i.__curvenessList=[],i.__edgeMap={},Jet(i))}function MEt(i,t,e,r){if(PE(e)){var n=xS(i,t,e),o=e.__edgeMap,s=o[Qet(n)];o[n]&&!s?o[n].isForward=!0:s&&o[n]&&(s.isForward=!0,o[n].isForward=!1),o[n]=o[n]||[],o[n].push(r)}}function $3(i,t,e,r){var n=PE(t),o=Ye(n);if(!n)return null;var s=TEt(i,t);if(!s)return null;for(var a=-1,u=0;u<s.length;u++)if(s[u]===e){a=u;break}var f=AEt(i,t);Jet(t,f),i.lineStyle=i.lineStyle||{};var g=xS(i.node1,i.node2,t),v=t.__curvenessList,y=o||f%2?0:1;if(s.isForward)return v[y+a];var w=Qet(g),I=Jz(w,t),E=v[a+I+y];return r?o?n&&n[0]===0?(I+y)%2?E:-E:((I%2?0:1)+y)%2?E:-E:(I+y)%2?E:-E:v[a+I+y]}function tit(i){var t=i.coordinateSystem;if(!(t&&t.type!=="view")){var e=i.getGraph();e.eachNode(function(r){var n=r.getModel();r.setLayout([+n.get("x"),+n.get("y")])}),Z3(e,i)}}function Z3(i,t){i.eachEdge(function(e,r){var n=ic(e.getModel().get(["lineStyle","curveness"]),-$3(e,t,r,!0),0),o=Sd(e.node1.getLayout()),s=Sd(e.node2.getLayout()),a=[o,s];+n&&a.push([(o[0]+s[0])/2-(o[1]-s[1])*n,(o[1]+s[1])/2-(s[0]-o[0])*n]),e.setLayout(a)})}function CEt(i,t){i.eachSeriesByType("graph",function(e){var r=e.get("layout"),n=e.coordinateSystem;if(n&&n.type!=="view"){var o=e.getData(),s=[];gt(n.dimensions,function(y){s=s.concat(o.mapDimensionsAll(y))});for(var a=0;a<o.count();a++){for(var u=[],f=!1,g=0;g<s.length;g++){var v=o.get(s[g],a);isNaN(v)||(f=!0),u.push(v)}f?o.setItemLayout(a,n.dataToPoint(u)):o.setItemLayout(a,[NaN,NaN])}Z3(o.graph,e)}else(!r||r==="none")&&tit(e)})}function sw(i){var t=i.coordinateSystem;if(t.type!=="view")return 1;var e=i.option.nodeScaleRatio,r=t.scaleX,n=t.getZoom(),o=(n-1)*e+1;return o/r}function lw(i){var t=i.getVisual("symbolSize");return t instanceof Array&&(t=(t[0]+t[1])/2),+t}var C$=Math.PI,HR=[];function q3(i,t,e,r){var n=i.coordinateSystem;if(!(n&&n.type!=="view")){var o=n.getBoundingRect(),s=i.getData(),a=s.graph,u=o.width/2+o.x,f=o.height/2+o.y,g=Math.min(o.width,o.height)/2,v=s.count();if(s.setLayout({cx:u,cy:f}),!!v){if(e){var y=n.pointToData(r),w=y[0],I=y[1],E=[w-u,I-f];z0(E,E),BI(E,E,g),e.setLayout([u+E[0],f+E[1]],!0);var D=i.get(["circular","rotateLabel"]);eit(e,D,u,f)}EEt[t](i,a,s,g,u,f,v),a.eachEdge(function(R,z){var N=ic(R.getModel().get(["lineStyle","curveness"]),$3(R,i,z),0),H=Sd(R.node1.getLayout()),$=Sd(R.node2.getLayout()),X,K=(H[0]+$[0])/2,et=(H[1]+$[1])/2;+N&&(N*=3,X=[u*N+K*(1-N),f*N+et*(1-N)]),R.setLayout([H,$,X])})}}}var EEt={value:function(i,t,e,r,n,o,s){var a=0,u=e.getSum("value"),f=Math.PI*2/(u||s);t.eachNode(function(g){var v=g.getValue("value"),y=f*(u?v:1)/2;a+=y,g.setLayout([r*Math.cos(a)+n,r*Math.sin(a)+o]),a+=y})},symbolSize:function(i,t,e,r,n,o,s){var a=0;HR.length=s;var u=sw(i);t.eachNode(function(v){var y=lw(v);isNaN(y)&&(y=2),y<0&&(y=0),y*=u;var w=Math.asin(y/2/r);isNaN(w)&&(w=C$/2),HR[v.dataIndex]=w,a+=w*2});var f=(2*C$-a)/s/2,g=0;t.eachNode(function(v){var y=f+HR[v.dataIndex];g+=y,(!v.getLayout()||!v.getLayout().fixed)&&v.setLayout([r*Math.cos(g)+n,r*Math.sin(g)+o]),g+=y})}};function eit(i,t,e,r){var n=i.getGraphicEl();if(n){var o=i.getModel(),s=o.get(["label","rotate"])||0,a=n.getSymbolPath();if(t){var u=i.getLayout(),f=Math.atan2(u[1]-r,u[0]-e);f<0&&(f=Math.PI*2+f);var g=u[0]<e;g&&(f=f-Math.PI);var v=g?"left":"right";a.setTextConfig({rotation:-f,position:v,origin:"center"});var y=a.ensureState("emphasis");Fe(y.textConfig||(y.textConfig={}),{position:v})}else a.setTextConfig({rotation:s*=Math.PI/180})}}function DEt(i){i.eachSeriesByType("graph",function(t){t.get("layout")==="circular"&&q3(t,"symbolSize")})}var Cy=bO;function PEt(i,t,e){for(var r=i,n=t,o=e.rect,s=o.width,a=o.height,u=[o.x+s/2,o.y+a/2],f=e.gravity==null?.1:e.gravity,g=0;g<r.length;g++){var v=r[g];v.p||(v.p=wv(s*(Math.random()-.5)+u[0],a*(Math.random()-.5)+u[1])),v.pp=Sd(v.p),v.edges=null}var y=e.friction==null?.6:e.friction,w=y,I,E;return{warmUp:function(){w=y*.8},setFixed:function(D){r[D].fixed=!0},setUnfixed:function(D){r[D].fixed=!1},beforeStep:function(D){I=D},afterStep:function(D){E=D},step:function(D){I&&I(r,n);for(var R=[],z=r.length,N=0;N<n.length;N++){var H=n[N];if(!H.ignoreForceLayout){var $=H.n1,X=H.n2;Um(R,X.p,$.p);var K=wO(R)-H.d,et=X.w/($.w+X.w);isNaN(et)&&(et=0),z0(R,R),!$.fixed&&Cy($.p,$.p,R,et*K*w),!X.fixed&&Cy(X.p,X.p,R,-(1-et)*K*w)}}for(var N=0;N<z;N++){var rt=r[N];rt.fixed||(Um(R,u,rt.p),Cy(rt.p,rt.p,R,f*w))}for(var N=0;N<z;N++)for(var $=r[N],lt=N+1;lt<z;lt++){var X=r[lt];Um(R,X.p,$.p);var K=wO(R);K===0&&(yF(R,Math.random()-.5,Math.random()-.5),K=1);var ht=($.rep+X.rep)/K/K;!$.fixed&&Cy($.pp,$.pp,R,ht),!X.fixed&&Cy(X.pp,X.pp,R,-ht)}for(var yt=[],N=0;N<z;N++){var rt=r[N];rt.fixed||(Um(yt,rt.p,rt.pp),Cy(rt.p,rt.p,yt,w),ll(rt.pp,rt.p))}w=w*.992;var ft=w<.01;E&&E(r,n,ft),D&&D(ft)}}}function LEt(i){i.eachSeriesByType("graph",function(t){var e=t.coordinateSystem;if(!(e&&e.type!=="view"))if(t.get("layout")==="force"){var r=t.preservedPoints||{},n=t.getGraph(),o=n.data,s=n.edgeData,a=t.getModel("force"),u=a.get("initLayout");t.preservedPoints?o.each(function(N){var H=o.getId(N);o.setItemLayout(N,r[H]||[NaN,NaN])}):!u||u==="none"?tit(t):u==="circular"&&q3(t,"value");var f=o.getDataExtent("value"),g=s.getDataExtent("value"),v=a.get("repulsion"),y=a.get("edgeLength"),w=Ye(v)?v:[v,v],I=Ye(y)?y:[y,y];I=[I[1],I[0]];var E=o.mapArray("value",function(N,H){var $=o.getItemLayout(H),X=Ln(N,f,w);return isNaN(X)&&(X=(w[0]+w[1])/2),{w:X,rep:X,fixed:o.getItemModel(H).get("fixed"),p:!$||isNaN($[0])||isNaN($[1])?null:$}}),D=s.mapArray("value",function(N,H){var $=n.getEdgeByIndex(H),X=Ln(N,g,I);isNaN(X)&&(X=(I[0]+I[1])/2);var K=$.getModel(),et=ic($.getModel().get(["lineStyle","curveness"]),-$3($,t,H,!0),0);return{n1:E[$.node1.dataIndex],n2:E[$.node2.dataIndex],d:X,curveness:et,ignoreForceLayout:K.get("ignoreForceLayout")}}),R=e.getBoundingRect(),z=PEt(E,D,{rect:R,gravity:a.get("gravity"),friction:a.get("friction")});z.beforeStep(function(N,H){for(var $=0,X=N.length;$<X;$++)N[$].fixed&&ll(N[$].p,n.getNodeByIndex($).getLayout())}),z.afterStep(function(N,H,$){for(var X=0,K=N.length;X<K;X++)N[X].fixed||n.getNodeByIndex(X).setLayout(N[X].p),r[o.getId(X)]=N[X].p;for(var X=0,K=H.length;X<K;X++){var et=H[X],rt=n.getEdgeByIndex(X),lt=et.n1.p,ht=et.n2.p,yt=rt.getLayout();yt=yt?yt.slice():[],yt[0]=yt[0]||[],yt[1]=yt[1]||[],ll(yt[0],lt),ll(yt[1],ht),+et.curveness&&(yt[2]=[(lt[0]+ht[0])/2-(lt[1]-ht[1])*et.curveness,(lt[1]+ht[1])/2-(ht[0]-lt[0])*et.curveness]),rt.setLayout(yt)}}),t.forceLayout=z,t.preservedPoints=r,z.step()}else t.forceLayout=null})}function REt(i,t,e){var r=Bo(i,t),n=Fe(i.getBoxLayoutParams(),{aspect:e}),o=Ca(n,r.refContainer);return TJ(i,o,e)}function kEt(i,t){var e=[];return i.eachSeriesByType("graph",function(r){VS({targetModel:r,coordSysType:"view",coordSysProvider:n,isDefaultDataCoordSys:!0});function n(){var o=r.getData(),s=o.mapArray(function(I){var E=o.getItemModel(I);return[+E.get("x"),+E.get("y")]}),a=[],u=[];aE(s,a,u),u[0]-a[0]===0&&(u[0]+=1,a[0]-=1),u[1]-a[1]===0&&(u[1]+=1,a[1]-=1);var f=(u[0]-a[0])/(u[1]-a[1]),g=REt(r,t,f);isNaN(f)&&(a=[g.x,g.y],u=[g.x+g.width,g.y+g.height]);var v=u[0]-a[0],y=u[1]-a[1],w=new Rv(null,{api:t,ecModel:i});return w.zoomLimit=r.get("scaleLimit"),w.setBoundingRect(a[0],a[1],v,y),w.setViewRect(g.x,g.y,g.width,g.height),w.setCenter(r.get("center")),w.setZoom(r.get("zoom")),e.push(w),w}}),e}var E$=Ro.prototype,jR=hE.prototype,iit=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return i}();(function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t})(iit);function WR(i){return isNaN(+i.cpx1)||isNaN(+i.cpy1)}var OEt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="ec-line",r}return t.prototype.getDefaultStyle=function(){return{stroke:_e.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new iit},t.prototype.buildPath=function(e,r){WR(r)?E$.buildPath.call(this,e,r):jR.buildPath.call(this,e,r)},t.prototype.pointAt=function(e){return WR(this.shape)?E$.pointAt.call(this,e):jR.pointAt.call(this,e)},t.prototype.tangentAt=function(e){var r=this.shape,n=WR(r)?[r.x2-r.x1,r.y2-r.y1]:jR.tangentAt.call(this,e);return z0(n,n)},t}(qr);const rit=OEt;var $R=["fromSymbol","toSymbol"];function D$(i){return"_"+i+"Type"}function P$(i,t,e){var r=t.getItemVisual(e,i);if(!r||r==="none")return r;var n=t.getItemVisual(e,i+"Size"),o=t.getItemVisual(e,i+"Rotate"),s=t.getItemVisual(e,i+"Offset"),a=t.getItemVisual(e,i+"KeepAspect"),u=Z0(n),f=Cv(s||0,u);return r+u+f+(o||"")+(a||"")}function L$(i,t,e){var r=t.getItemVisual(e,i);if(!(!r||r==="none")){var n=t.getItemVisual(e,i+"Size"),o=t.getItemVisual(e,i+"Rotate"),s=t.getItemVisual(e,i+"Offset"),a=t.getItemVisual(e,i+"KeepAspect"),u=Z0(n),f=Cv(s||0,u),g=bo(r,-u[0]/2+f[0],-u[1]/2+f[1],u[0],u[1],null,a);return g.__specifiedRotation=o==null||isNaN(o)?void 0:+o*Math.PI/180||0,g.name=i,g}}function zEt(i){var t=new rit({name:"line",subPixelOptimize:!0});return Qz(t.shape,i),t}function Qz(i,t){i.x1=t[0][0],i.y1=t[0][1],i.x2=t[1][0],i.y2=t[1][1],i.percent=1;var e=t[2];e?(i.cpx1=e[0],i.cpy1=e[1]):(i.cpx1=NaN,i.cpy1=NaN)}var BEt=function(i){we(t,i);function t(e,r,n){var o=i.call(this)||this;return o._createLine(e,r,n),o}return t.prototype._createLine=function(e,r,n){var o=e.hostModel,s=e.getItemLayout(r),a=e.getItemVisual(r,"z2"),u=zEt(s);u.shape.percent=0,ya(u,{z2:Ui(a,0),shape:{percent:1}},o,r),this.add(u),gt($R,function(f){var g=L$(f,e,r);this.add(g),this[D$(f)]=P$(f,e,r)},this),this._updateCommonStl(e,r,n)},t.prototype.updateData=function(e,r,n){var o=e.hostModel,s=this.childOfName("line"),a=e.getItemLayout(r),u={shape:{}};Qz(u.shape,a),yn(s,u,o,r),gt($R,function(f){var g=P$(f,e,r),v=D$(f);if(this[v]!==g){this.remove(this.childOfName(f));var y=L$(f,e,r);this.add(y)}this[v]=g},this),this._updateCommonStl(e,r,n)},t.prototype.getLinePath=function(){return this.childAt(0)},t.prototype._updateCommonStl=function(e,r,n){var o=e.hostModel,s=this.childOfName("line"),a=n&&n.emphasisLineStyle,u=n&&n.blurLineStyle,f=n&&n.selectLineStyle,g=n&&n.labelStatesModels,v=n&&n.emphasisDisabled,y=n&&n.focus,w=n&&n.blurScope;if(!n||e.hasItemOption){var I=e.getItemModel(r),E=I.getModel("emphasis");a=E.getModel("lineStyle").getLineStyle(),u=I.getModel(["blur","lineStyle"]).getLineStyle(),f=I.getModel(["select","lineStyle"]).getLineStyle(),v=E.get("disabled"),y=E.get("focus"),w=E.get("blurScope"),g=zo(I)}var D=e.getItemVisual(r,"style"),R=D.stroke;s.useStyle(D),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=a,s.ensureState("blur").style=u,s.ensureState("select").style=f,gt($R,function(X){var K=this.childOfName(X);if(K){K.setColor(R),K.style.opacity=D.opacity;for(var et=0;et<fl.length;et++){var rt=fl[et],lt=s.getState(rt);if(lt){var ht=lt.style||{},yt=K.ensureState(rt),ft=yt.style||(yt.style={});ht.stroke!=null&&(ft[K.__isEmptyBrush?"stroke":"fill"]=ht.stroke),ht.opacity!=null&&(ft.opacity=ht.opacity)}}K.markRedraw()}},this);var z=o.getRawValue(r);qo(this,g,{labelDataIndex:r,labelFetcher:{getFormattedLabel:function(X,K){return o.getFormattedLabel(X,K,e.dataType)}},inheritColor:R||_e.color.neutral99,defaultOpacity:D.opacity,defaultText:(z==null?e.getName(r):isFinite(z)?vo(z):z)+""});var N=this.getTextContent();if(N){var H=g.normal;N.__align=N.style.align,N.__verticalAlign=N.style.verticalAlign,N.__position=H.get("position")||"middle";var $=H.get("distance");Ye($)||($=[$,$]),N.__labelDistance=$}this.setTextConfig({position:null,local:!0,inside:!1}),Ma(this,y,w,v)},t.prototype.highlight=function(){Rd(this)},t.prototype.downplay=function(){kd(this)},t.prototype.updateLayout=function(e,r){this.setLinePoints(e.getItemLayout(r))},t.prototype.setLinePoints=function(e){var r=this.childOfName("line");Qz(r.shape,e),r.dirty()},t.prototype.beforeUpdate=function(){var e=this,r=e.childOfName("fromSymbol"),n=e.childOfName("toSymbol"),o=e.getTextContent();if(!r&&!n&&(!o||o.ignore))return;for(var s=1,a=this.parent;a;)a.scaleX&&(s/=a.scaleX),a=a.parent;var u=e.childOfName("line");if(!this.__dirty&&!u.__dirty)return;var f=u.shape.percent,g=u.pointAt(0),v=u.pointAt(f),y=Um([],v,g);z0(y,y);function w(lt,ht){var yt=lt.__specifiedRotation;if(yt==null){var ft=u.tangentAt(ht);lt.attr("rotation",(ht===1?-1:1)*Math.PI/2-Math.atan2(ft[1],ft[0]))}else lt.attr("rotation",yt)}if(r&&(r.setPosition(g),w(r,0),r.scaleX=r.scaleY=s*f,r.markRedraw()),n&&(n.setPosition(v),w(n,1),n.scaleX=n.scaleY=s*f,n.markRedraw()),o&&!o.ignore){o.x=o.y=0,o.originX=o.originY=0;var I=void 0,E=void 0,D=o.__labelDistance,R=D[0]*s,z=D[1]*s,N=f/2,H=u.tangentAt(N),$=[H[1],-H[0]],X=u.pointAt(N);$[1]>0&&($[0]=-$[0],$[1]=-$[1]);var K=H[0]<0?-1:1;if(o.__position!=="start"&&o.__position!=="end"){var et=-Math.atan2(H[1],H[0]);v[0]<g[0]&&(et=Math.PI+et),o.rotation=et}var rt=void 0;switch(o.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":rt=-z,E="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":rt=z,E="top";break;default:rt=0,E="middle"}switch(o.__position){case"end":o.x=y[0]*R+v[0],o.y=y[1]*z+v[1],I=y[0]>.8?"left":y[0]<-.8?"right":"center",E=y[1]>.8?"top":y[1]<-.8?"bottom":"middle";break;case"start":o.x=-y[0]*R+g[0],o.y=-y[1]*z+g[1],I=y[0]>.8?"right":y[0]<-.8?"left":"center",E=y[1]>.8?"bottom":y[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":o.x=R*K+g[0],o.y=g[1]+rt,I=H[0]<0?"right":"left",o.originX=-R*K,o.originY=-rt;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":o.x=X[0],o.y=X[1]+rt,I="center",o.originY=-rt;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":o.x=-R*K+v[0],o.y=v[1]+rt,I=H[0]>=0?"right":"left",o.originX=R*K,o.originY=-rt;break}o.scaleX=o.scaleY=s,o.setStyle({verticalAlign:o.__verticalAlign||E,align:o.__align||I})}},t}(Ki);const X3=BEt;var FEt=function(){function i(t){this.group=new Ki,this._LineCtor=t||X3}return i.prototype.updateData=function(t){var e=this;this._progressiveEls=null;var r=this,n=r.group,o=r._lineData;r._lineData=t,o||n.removeAll();var s=R$(t);t.diff(o).add(function(a){e._doAdd(t,a,s)}).update(function(a,u){e._doUpdate(o,t,u,a,s)}).remove(function(a){n.remove(o.getItemGraphicEl(a))}).execute()},i.prototype.updateLayout=function(){var t=this._lineData;t&&t.eachItemGraphicEl(function(e,r){e.updateLayout(t,r)},this)},i.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=R$(t),this._lineData=null,this.group.removeAll()},i.prototype.incrementalUpdate=function(t,e){this._progressiveEls=[];function r(a){!a.isGroup&&!NEt(a)&&(a.incremental=!0,a.ensureState("emphasis").hoverLayer=!0)}for(var n=t.start;n<t.end;n++){var o=e.getItemLayout(n);if(ZR(o)){var s=new this._LineCtor(e,n,this._seriesScope);s.traverse(r),this.group.add(s),e.setItemGraphicEl(n,s),this._progressiveEls.push(s)}}},i.prototype.remove=function(){this.group.removeAll()},i.prototype.eachRendered=function(t){Hp(this._progressiveEls||this.group,t)},i.prototype._doAdd=function(t,e,r){var n=t.getItemLayout(e);if(ZR(n)){var o=new this._LineCtor(t,e,r);t.setItemGraphicEl(e,o),this.group.add(o)}},i.prototype._doUpdate=function(t,e,r,n,o){var s=t.getItemGraphicEl(r);if(!ZR(e.getItemLayout(n))){this.group.remove(s);return}s?s.updateData(e,n,o):s=new this._LineCtor(e,n,o),e.setItemGraphicEl(n,s),this.group.add(s)},i}();function NEt(i){return i.animators&&i.animators.length>0}function R$(i){var t=i.hostModel,e=t.getModel("emphasis");return{lineStyle:t.getModel("lineStyle").getLineStyle(),emphasisLineStyle:e.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:t.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:t.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:e.get("disabled"),blurScope:e.get("blurScope"),focus:e.get("focus"),labelStatesModels:zo(t)}}function k$(i){return isNaN(i[0])||isNaN(i[1])}function ZR(i){return i&&!k$(i[0])&&!k$(i[1])}const Y3=FEt;var qR=[],XR=[],YR=[],Ey=is,KR=tv,O$=Math.abs;function z$(i,t,e){for(var r=i[0],n=i[1],o=i[2],s=1/0,a,u=e*e,f=.1,g=.1;g<=.9;g+=.1){qR[0]=Ey(r[0],n[0],o[0],g),qR[1]=Ey(r[1],n[1],o[1],g);var v=O$(KR(qR,t)-u);v<s&&(s=v,a=g)}for(var y=0;y<32;y++){var w=a+f;XR[0]=Ey(r[0],n[0],o[0],a),XR[1]=Ey(r[1],n[1],o[1],a),YR[0]=Ey(r[0],n[0],o[0],w),YR[1]=Ey(r[1],n[1],o[1],w);var v=KR(XR,t)-u;if(O$(v)<.01)break;var I=KR(YR,t)-u;f/=2,v<0?I>=0?a=a+f:a=a-f:I>=0?a=a-f:a=a+f}return a}function JR(i,t){var e=[],r=Xw,n=[[],[],[]],o=[[],[]],s=[];t/=2,i.eachEdge(function(a,u){var f=a.getLayout(),g=a.getVisual("fromSymbol"),v=a.getVisual("toSymbol");f.__original||(f.__original=[Sd(f[0]),Sd(f[1])],f[2]&&f.__original.push(Sd(f[2])));var y=f.__original;if(f[2]!=null){if(ll(n[0],y[0]),ll(n[1],y[2]),ll(n[2],y[1]),g&&g!=="none"){var w=lw(a.node1),I=z$(n,y[0],w*t);r(n[0][0],n[1][0],n[2][0],I,e),n[0][0]=e[3],n[1][0]=e[4],r(n[0][1],n[1][1],n[2][1],I,e),n[0][1]=e[3],n[1][1]=e[4]}if(v&&v!=="none"){var w=lw(a.node2),I=z$(n,y[1],w*t);r(n[0][0],n[1][0],n[2][0],I,e),n[1][0]=e[1],n[2][0]=e[2],r(n[0][1],n[1][1],n[2][1],I,e),n[1][1]=e[1],n[2][1]=e[2]}ll(f[0],n[0]),ll(f[1],n[2]),ll(f[2],n[1])}else{if(ll(o[0],y[0]),ll(o[1],y[1]),Um(s,o[1],o[0]),z0(s,s),g&&g!=="none"){var w=lw(a.node1);bO(o[0],o[0],s,w*t)}if(v&&v!=="none"){var w=lw(a.node2);bO(o[1],o[1],s,-w*t)}ll(f[0],o[0]),ll(f[1],o[1])}})}var nit=Wr();function VEt(i){if(i)return nit(i).bridge}function B$(i,t){i&&(nit(i).bridge=t)}function F$(i){return i.type==="view"}var UEt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){var n=new WS,o=new Y3,s=this.group,a=new Ki;this._controller=new Lv(r.getZr()),this._controllerHost={target:a},a.add(n.group),a.add(o.group),s.add(a),this._symbolDraw=n,this._lineDraw=o,this._mainGroup=a,this._firstRender=!0},t.prototype.render=function(e,r,n){var o=this,s=e.coordinateSystem,a=!1;this._model=e,this._api=n,this._active=!0;var u=this._getThumbnailInfo();u&&u.bridge.reset(n);var f=this._symbolDraw,g=this._lineDraw;if(F$(s)){var v={x:s.x,y:s.y,scaleX:s.scaleX,scaleY:s.scaleY};this._firstRender?this._mainGroup.attr(v):yn(this._mainGroup,v,e)}JR(e.getGraph(),sw(e));var y=e.getData();f.updateData(y);var w=e.getEdgeData();g.updateData(w),this._updateNodeAndLinkScale(),this._updateController(null,e,n),clearTimeout(this._layoutTimeout);var I=e.forceLayout,E=e.get(["force","layoutAnimation"]);I&&(a=!0,this._startForceLayoutIteration(I,n,E));var D=e.get("layout");y.graph.eachNode(function(H){var $=H.dataIndex,X=H.getGraphicEl(),K=H.getModel();if(X){X.off("drag").off("dragend");var et=K.get("draggable");et&&X.on("drag",function(lt){switch(D){case"force":I.warmUp(),!o._layouting&&o._startForceLayoutIteration(I,n,E),I.setFixed($),y.setItemLayout($,[X.x,X.y]);break;case"circular":y.setItemLayout($,[X.x,X.y]),H.setLayout({fixed:!0},!0),q3(e,"symbolSize",H,[lt.offsetX,lt.offsetY]),o.updateLayout(e);break;case"none":default:y.setItemLayout($,[X.x,X.y]),Z3(e.getGraph(),e),o.updateLayout(e);break}}).on("dragend",function(){I&&I.setUnfixed($)}),X.setDraggable(et,!!K.get("cursor"));var rt=K.get(["emphasis","focus"]);rt==="adjacency"&&(ur(X).focus=H.getAdjacentDataIndices())}}),y.graph.eachEdge(function(H){var $=H.getGraphicEl(),X=H.getModel().get(["emphasis","focus"]);$&&X==="adjacency"&&(ur($).focus={edge:[H.dataIndex],node:[H.node1.dataIndex,H.node2.dataIndex]})});var R=e.get("layout")==="circular"&&e.get(["circular","rotateLabel"]),z=y.getLayout("cx"),N=y.getLayout("cy");y.graph.eachNode(function(H){eit(H,R,z,N)}),this._firstRender=!1,a||this._renderThumbnail(e,n,this._symbolDraw,this._lineDraw)},t.prototype.dispose=function(){this.remove(),this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype._startForceLayoutIteration=function(e,r,n){var o=this,s=!1;(function a(){e.step(function(u){o.updateLayout(o._model),(u||!s)&&(s=!0,o._renderThumbnail(o._model,r,o._symbolDraw,o._lineDraw)),(o._layouting=!u)&&(n?o._layoutTimeout=setTimeout(a,16):a())})})()},t.prototype._updateController=function(e,r,n){var o=this._controller,s=this._controllerHost,a=r.coordinateSystem;if(!F$(a)){o.disable();return}o.enable(r.get("roam"),{api:n,zInfo:{component:r},triggerInfo:{roamTrigger:r.get("roamTrigger"),isInSelf:function(u,f,g){return a.containPoint([f,g])},isInClip:function(u,f,g){return!e||e.contain(f,g)}}}),s.zoomLimit=r.get("scaleLimit"),s.zoom=a.getZoom(),o.off("pan").off("zoom").on("pan",function(u){n.dispatchAction({seriesId:r.id,type:"graphRoam",dx:u.dx,dy:u.dy})}).on("zoom",function(u){n.dispatchAction({seriesId:r.id,type:"graphRoam",zoom:u.scale,originX:u.originX,originY:u.originY})})},t.prototype.updateViewOnPan=function(e,r,n){this._active&&(B3(this._controllerHost,n.dx,n.dy),this._updateThumbnailWindow())},t.prototype.updateViewOnZoom=function(e,r,n){this._active&&(F3(this._controllerHost,n.zoom,n.originX,n.originY),this._updateNodeAndLinkScale(),JR(e.getGraph(),sw(e)),this._lineDraw.updateLayout(),r.updateLabelLayout(),this._updateThumbnailWindow())},t.prototype._updateNodeAndLinkScale=function(){var e=this._model,r=e.getData(),n=sw(e);r.eachItemGraphicEl(function(o,s){o&&o.setSymbolScale(n)})},t.prototype.updateLayout=function(e){this._active&&(JR(e.getGraph(),sw(e)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout())},t.prototype.remove=function(){this._active=!1,clearTimeout(this._layoutTimeout),this._layouting=!1,this._layoutTimeout=null,this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove(),this._controller&&this._controller.disable()},t.prototype._getThumbnailInfo=function(){var e=this._model,r=e.coordinateSystem;if(r.type==="view"){var n=VEt(e);if(n)return{bridge:n,coordSys:r}}},t.prototype._updateThumbnailWindow=function(){var e=this._getThumbnailInfo();e&&e.bridge.updateWindow(e.coordSys.transform,this._api)},t.prototype._renderThumbnail=function(e,r,n,o){var s=this._getThumbnailInfo();if(s){var a=new Ki,u=n.group.children(),f=o.group.children(),g=new Ki,v=new Ki;a.add(v),a.add(g);for(var y=0;y<u.length;y++){var w=u[y],I=w.children()[0],E=w.x,D=w.y,R=Yi(I.shape),z=Fe(R,{width:I.scaleX,height:I.scaleY,x:E-I.scaleX/2,y:D-I.scaleY/2}),N=Yi(I.style),H=new I.constructor({shape:z,style:N,z2:151});v.add(H)}for(var y=0;y<f.length;y++){var w=f[y],$=w.children()[0],N=Yi($.style),z=Yi($.shape),X=new rit({style:N,shape:z,z2:151});g.add(X)}s.bridge.renderContent({api:r,roamType:e.get("roam"),viewportRect:null,group:a,targetTrans:s.coordSys.transform})}},t.type="graph",t}(pa);const GEt=UEt;function Dy(i){return"_EC_"+i}var HEt=function(){function i(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return i.prototype.isDirected=function(){return this._directed},i.prototype.addNode=function(t,e){t=t==null?""+e:""+t;var r=this._nodesMap;if(!r[Dy(t)]){var n=new Rm(t,e);return n.hostGraph=this,this.nodes.push(n),r[Dy(t)]=n,n}},i.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},i.prototype.getNodeById=function(t){return this._nodesMap[Dy(t)]},i.prototype.addEdge=function(t,e,r){var n=this._nodesMap,o=this._edgesMap;if(fn(t)&&(t=this.nodes[t]),fn(e)&&(e=this.nodes[e]),t instanceof Rm||(t=n[Dy(t)]),e instanceof Rm||(e=n[Dy(e)]),!(!t||!e)){var s=t.id+"-"+e.id,a=new ait(t,e,r);return a.hostGraph=this,this._directed&&(t.outEdges.push(a),e.inEdges.push(a)),t.edges.push(a),t!==e&&e.edges.push(a),this.edges.push(a),o[s]=a,a}},i.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},i.prototype.getEdge=function(t,e){t instanceof Rm&&(t=t.id),e instanceof Rm&&(e=e.id);var r=this._edgesMap;return this._directed?r[t+"-"+e]:r[t+"-"+e]||r[e+"-"+t]},i.prototype.eachNode=function(t,e){for(var r=this.nodes,n=r.length,o=0;o<n;o++)r[o].dataIndex>=0&&t.call(e,r[o],o)},i.prototype.eachEdge=function(t,e){for(var r=this.edges,n=r.length,o=0;o<n;o++)r[o].dataIndex>=0&&r[o].node1.dataIndex>=0&&r[o].node2.dataIndex>=0&&t.call(e,r[o],o)},i.prototype.breadthFirstTraverse=function(t,e,r,n){if(e instanceof Rm||(e=this._nodesMap[Dy(e)]),!!e){for(var o=r==="out"?"outEdges":r==="in"?"inEdges":"edges",s=0;s<this.nodes.length;s++)this.nodes[s].__visited=!1;if(!t.call(n,e,null))for(var a=[e];a.length;)for(var u=a.shift(),f=u[o],s=0;s<f.length;s++){var g=f[s],v=g.node1===u?g.node2:g.node1;if(!v.__visited){if(t.call(n,v,u))return;a.push(v),v.__visited=!0}}}},i.prototype.update=function(){for(var t=this.data,e=this.edgeData,r=this.nodes,n=this.edges,o=0,s=r.length;o<s;o++)r[o].dataIndex=-1;for(var o=0,s=t.count();o<s;o++)r[t.getRawIndex(o)].dataIndex=o;e.filterSelf(function(a){var u=n[e.getRawIndex(a)];return u.node1.dataIndex>=0&&u.node2.dataIndex>=0});for(var o=0,s=n.length;o<s;o++)n[o].dataIndex=-1;for(var o=0,s=e.count();o<s;o++)n[e.getRawIndex(o)].dataIndex=o},i.prototype.clone=function(){for(var t=new i(this._directed),e=this.nodes,r=this.edges,n=0;n<e.length;n++)t.addNode(e[n].id,e[n].dataIndex);for(var n=0;n<r.length;n++){var o=r[n];t.addEdge(o.node1.id,o.node2.id,o.dataIndex)}return t},i}(),Rm=function(){function i(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=t??"",this.dataIndex=e??-1}return i.prototype.degree=function(){return this.edges.length},i.prototype.inDegree=function(){return this.inEdges.length},i.prototype.outDegree=function(){return this.outEdges.length},i.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,r=e.data.getItemModel(this.dataIndex);return r.getModel(t)}},i.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var r=this.edges[e];r.dataIndex<0||(t.edge.push(r.dataIndex),t.node.push(r.node1.dataIndex,r.node2.dataIndex))}return t},i.prototype.getTrajectoryDataIndices=function(){for(var t=Fi(),e=Fi(),r=0,n=this.edges.length;r<n;r++){var o=this.edges[r];if(!(o.dataIndex<0)){t.set(o.dataIndex,!0);for(var s=[o.node1],a=[o.node2],u=0;u<s.length;){var f=s[u];u++,e.set(f.dataIndex,!0);for(var g=f.inEdges,v=0,y=g.length,w=void 0,I=void 0;v<y;v++)w=g[v],I=w.dataIndex,I>=0&&!t.hasKey(I)&&(t.set(I,!0),s.push(w.node1))}for(u=0;u<a.length;){var E=a[u];u++,e.set(E.dataIndex,!0);for(var D=E.outEdges,v=0,R=D.length,z=void 0,N=void 0;v<R;v++)z=D[v],N=z.dataIndex,N>=0&&!t.hasKey(N)&&(t.set(N,!0),a.push(z.node2))}}}return{edge:t.keys(),node:e.keys()}},i}(),ait=function(){function i(t,e,r){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=r??-1}return i.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,r=e.edgeData.getItemModel(this.dataIndex);return r.getModel(t)}},i.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},i.prototype.getTrajectoryDataIndices=function(){var t=Fi(),e=Fi();t.set(this.dataIndex,!0);for(var r=[this.node1],n=[this.node2],o=0;o<r.length;){var s=r[o];o++,e.set(s.dataIndex,!0);for(var a=s.inEdges,u=0,f=a.length,g=void 0,v=void 0;u<f;u++)g=s.inEdges[u],v=g.dataIndex,v>=0&&!t.hasKey(v)&&(t.set(v,!0),r.push(g.node1))}for(o=0;o<n.length;){var y=n[o];o++,e.set(y.dataIndex,!0);for(var w=y.outEdges,u=0,f=w.length,I=void 0,E=void 0;u<f;u++)I=y.outEdges[u],E=I.dataIndex,E>=0&&!t.hasKey(E)&&(t.set(E,!0),n.push(I.node2))}return{edge:t.keys(),node:e.keys()}},i}();function oit(i,t){return{getValue:function(e){var r=this[i][t];return r.getStore().get(r.getDimensionIndex(e||"value"),this.dataIndex)},setVisual:function(e,r){this.dataIndex>=0&&this[i][t].setItemVisual(this.dataIndex,e,r)},getVisual:function(e){return this[i][t].getItemVisual(this.dataIndex,e)},setLayout:function(e,r){this.dataIndex>=0&&this[i][t].setItemLayout(this.dataIndex,e,r)},getLayout:function(){return this[i][t].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[i][t].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[i][t].getRawIndex(this.dataIndex)}}}wo(Rm,oit("hostGraph","data"));wo(ait,oit("hostGraph","edgeData"));const jEt=HEt;function K3(i,t,e,r,n){for(var o=new jEt(r),s=0;s<i.length;s++)o.addNode(vs(i[s].id,i[s].name,s),s);for(var a=[],u=[],f=0,s=0;s<t.length;s++){var g=t[s],v=g.source,y=g.target;o.addEdge(v,y,f)&&(u.push(g),a.push(vs(Lo(g.id,null),v+" > "+y)),f++)}var w=e.get("coordinateSystem"),I;if(w==="cartesian2d"||w==="polar"||w==="matrix")I=Hd(i,e);else{var E=NS.get(w),D=E?E.dimensions||[]:[];Ar(D,"value")<0&&D.concat(["value"]);var R=GS(i,{coordDimensions:D,encodeDefine:e.getEncode()}).dimensions;I=new dl(R,e),I.initData(i)}var z=new dl(["value"],e);return z.initData(u,a),n&&n(I,z),Vet({mainData:I,struct:o,structAttr:"graph",datas:{node:I,edge:z},datasAttr:{node:"data",edge:"edgeData"}}),o.update(),o}var WEt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments);var r=this;function n(){return r._categoriesData}this.legendVisualProvider=new K0(n,n),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},t.prototype.mergeDefaultAndTheme=function(e){i.prototype.mergeDefaultAndTheme.apply(this,arguments),dv(e,"edgeLabel",["show"])},t.prototype.getInitialData=function(e,r){var n=e.edges||e.links||[],o=e.data||e.nodes||[],s=this;if(o&&n){IEt(this);var a=K3(o,n,this,!0,u);return gt(a.edges,function(f){MEt(f.node1,f.node2,this,f.dataIndex)},this),a.data}function u(f,g){f.wrapMethod("getItemModel",function(I){var E=s._categoriesModels,D=I.getShallow("category"),R=E[D];return R&&(R.parentModel=I.parentModel,I.parentModel=R),I});var v=bn.prototype.getModel;function y(I,E){var D=v.call(this,I,E);return D.resolveParentPath=w,D}g.wrapMethod("getItemModel",function(I){return I.resolveParentPath=w,I.getModel=y,I});function w(I){if(I&&(I[0]==="label"||I[1]==="label")){var E=I.slice();return I[0]==="label"?E[0]="edgeLabel":I[1]==="label"&&(E[1]="edgeLabel"),E}return I}}},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.getCategoriesData=function(){return this._categoriesData},t.prototype.formatTooltip=function(e,r,n){if(n==="edge"){var o=this.getData(),s=this.getDataParams(e,n),a=o.graph.getEdgeByIndex(e),u=o.getName(a.node1.dataIndex),f=o.getName(a.node2.dataIndex),g=[];return u!=null&&g.push(u),f!=null&&g.push(f),xo("nameValue",{name:g.join(" > "),value:s.value,noValue:s.value==null})}var v=oQ({series:this,dataIndex:e,multipleSeries:r});return v},t.prototype._updateCategoriesData=function(){var e=ti(this.option.categories||[],function(n){return n.value!=null?n:Fe({value:0},n)}),r=new dl(["value"],this);r.initData(e),this._categoriesData=r,this._categoriesModels=r.mapArray(function(n){return r.getItemModel(n)})},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.isAnimationEnabled=function(){return i.prototype.isAnimationEnabled.call(this)&&!(this.get("layout")==="force"&&this.get(["force","layoutAnimation"]))},t.type="series.graph",t.dependencies=["grid","polar","geo","singleAxis","calendar"],t.defaultOption={z:2,coordinateSystem:"view",legendHoverLink:!0,layout:null,circular:{rotateLabel:!1},force:{initLayout:null,repulsion:[0,50],gravity:.1,friction:.6,edgeLength:30,layoutAnimation:!0},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{position:"middle",distance:5},draggable:!1,roam:!1,center:null,zoom:1,nodeScaleRatio:.6,label:{show:!1,formatter:"{b}"},itemStyle:{},lineStyle:{color:_e.color.neutral50,width:1,opacity:.5},emphasis:{scale:!0,label:{show:!0}},select:{itemStyle:{borderColor:_e.color.primary}}},t}(Ea);const $Et=WEt;function ZEt(i){i.registerChartView(GEt),i.registerSeriesModel($Et),i.registerProcessor(bEt),i.registerVisual(wEt),i.registerVisual(SEt),i.registerLayout(CEt),i.registerLayout(i.PRIORITY.VISUAL.POST_CHART_LAYOUT,DEt),i.registerLayout(LEt),i.registerCoordinateSystem("graphView",{dimensions:Rv.dimensions,create:kEt}),i.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series:focusNodeAdjacency"},uo),i.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series:unfocusNodeAdjacency"},uo),i.registerAction({type:"graphRoam",event:"graphRoam",update:"none"},function(t,e,r){e.eachComponent({mainType:"series",query:t},function(n){var o=r.getViewOfSeriesModel(n);o&&(t.dx!=null&&t.dy!=null&&o.updateViewOnPan(n,r,t),t.zoom!=null&&t.originX!=null&&t.originY!=null&&o.updateViewOnZoom(n,r,t));var s=n.coordinateSystem,a=CE(s,t,n.get("scaleLimit"));n.setCenter&&n.setCenter(a.center),n.setZoom&&n.setZoom(a.zoom)})})}var qEt=function(i){we(t,i);function t(e,r,n){var o=i.call(this)||this;ur(o).dataType="node",o.z2=2;var s=new _n;return o.setTextContent(s),o.updateData(e,r,n,!0),o}return t.prototype.updateData=function(e,r,n,o){var s=this,a=e.graph.getNodeByIndex(r),u=e.hostModel,f=a.getModel(),g=f.getModel("emphasis"),v=e.getItemLayout(r),y=Fe(hh(f.getModel("itemStyle"),v,!0),v),w=this;if(isNaN(y.startAngle)){w.setShape(y);return}o?w.setShape(y):yn(w,{shape:y},u,r);var I=Fe(hh(f.getModel("itemStyle"),v,!0),v);s.setShape(I),s.useStyle(e.getItemVisual(r,"style")),Oo(s,f),this._updateLabel(u,f,a),e.setItemGraphicEl(r,w),Oo(w,f,"itemStyle");var E=g.get("focus");Ma(this,E==="adjacency"?a.getAdjacentDataIndices():E,g.get("blurScope"),g.get("disabled"))},t.prototype._updateLabel=function(e,r,n){var o=this.getTextContent(),s=n.getLayout(),a=(s.startAngle+s.endAngle)/2,u=Math.cos(a),f=Math.sin(a),g=r.getModel("label");o.ignore=!g.get("show");var v=zo(r),y=n.getVisual("style");qo(o,v,{labelFetcher:{getFormattedLabel:function(z,N,H,$,X,K){return e.getFormattedLabel(z,N,"node",$,ic(X,v.normal&&v.normal.get("formatter"),r.get("name")),K)}},labelDataIndex:n.dataIndex,defaultText:n.dataIndex+"",inheritColor:y.fill,defaultOpacity:y.opacity,defaultOutsidePosition:"startArc"});var w=g.get("position")||"outside",I=g.get("distance")||0,E;w==="outside"?E=s.r+I:E=(s.r+s.r0)/2,this.textConfig={inside:w!=="outside"};var D=w!=="outside"?g.get("align")||"center":u>0?"left":"right",R=w!=="outside"?g.get("verticalAlign")||"middle":f>0?"top":"bottom";o.attr({x:u*E+s.cx,y:f*E+s.cy,rotation:0,style:{align:D,verticalAlign:R}})},t}(pl);const N$=qEt;var XEt=function(i){we(t,i);function t(e,r,n,o){var s=i.call(this)||this;return ur(s).dataType="edge",s.updateData(e,r,n,o,!0),s}return t.prototype.buildPath=function(e,r){e.moveTo(r.s1[0],r.s1[1]);var n=.7,o=r.clockwise;e.arc(r.cx,r.cy,r.r,r.sStartAngle,r.sEndAngle,!o),e.bezierCurveTo((r.cx-r.s2[0])*n+r.s2[0],(r.cy-r.s2[1])*n+r.s2[1],(r.cx-r.t1[0])*n+r.t1[0],(r.cy-r.t1[1])*n+r.t1[1],r.t1[0],r.t1[1]),e.arc(r.cx,r.cy,r.r,r.tStartAngle,r.tEndAngle,!o),e.bezierCurveTo((r.cx-r.t2[0])*n+r.t2[0],(r.cy-r.t2[1])*n+r.t2[1],(r.cx-r.s1[0])*n+r.s1[0],(r.cy-r.s1[1])*n+r.s1[1],r.s1[0],r.s1[1]),e.closePath()},t.prototype.updateData=function(e,r,n,o,s){var a=e.hostModel,u=r.graph.getEdgeByIndex(n),f=u.getLayout(),g=u.node1.getModel(),v=r.getItemModel(u.dataIndex),y=v.getModel("lineStyle"),w=v.getModel("emphasis"),I=w.get("focus"),E=Fe(hh(g.getModel("itemStyle"),f,!0),f),D=this;if(isNaN(E.sStartAngle)||isNaN(E.tStartAngle)){D.setShape(E);return}s?(D.setShape(E),V$(D,u,e,y)):(Oc(D),V$(D,u,e,y),yn(D,{shape:E},a,n)),Ma(this,I==="adjacency"?u.getAdjacentDataIndices():I,w.get("blurScope"),w.get("disabled")),Oo(D,v,"lineStyle"),r.setItemGraphicEl(u.dataIndex,D)},t}(qr);function V$(i,t,e,r){var n=t.node1,o=t.node2,s=i.style;i.setStyle(r.getLineStyle());var a=r.get("color");switch(a){case"source":s.fill=e.getItemVisual(n.dataIndex,"style").fill,s.decal=n.getVisual("style").decal;break;case"target":s.fill=e.getItemVisual(o.dataIndex,"style").fill,s.decal=o.getVisual("style").decal;break;case"gradient":var u=e.getItemVisual(n.dataIndex,"style").fill,f=e.getItemVisual(o.dataIndex,"style").fill;if(bi(u)&&bi(f)){var g=i.shape,v=(g.s1[0]+g.s2[0])/2,y=(g.s1[1]+g.s2[1])/2,w=(g.t1[0]+g.t2[0])/2,I=(g.t1[1]+g.t2[1])/2;s.fill=new V0(v,y,w,I,[{offset:0,color:u},{offset:1,color:f}],!0)}break}}var YEt=Math.PI/180,KEt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){},t.prototype.render=function(e,r,n){var o=e.getData(),s=this._data,a=this.group,u=-e.get("startAngle")*YEt;if(o.diff(s).add(function(g){var v=o.getItemLayout(g);if(v){var y=new N$(o,g,u);ur(y).dataIndex=g,a.add(y)}}).update(function(g,v){var y=s.getItemGraphicEl(v),w=o.getItemLayout(g);if(!w){y&&Td(y,e,v);return}y?y.updateData(o,g,u):y=new N$(o,g,u),a.add(y)}).remove(function(g){var v=s.getItemGraphicEl(g);v&&Td(v,e,g)}).execute(),!s){var f=e.get("center");this.group.scaleX=.01,this.group.scaleY=.01,this.group.originX=xi(f[0],n.getWidth()),this.group.originY=xi(f[1],n.getHeight()),ya(this.group,{scaleX:1,scaleY:1},e)}this._data=o,this.renderEdges(e,u)},t.prototype.renderEdges=function(e,r){var n=e.getData(),o=e.getEdgeData(),s=this._edgeData,a=this.group;o.diff(s).add(function(u){var f=new XEt(n,o,u,r);ur(f).dataIndex=u,a.add(f)}).update(function(u,f){var g=s.getItemGraphicEl(f);g.updateData(n,o,u,r),a.add(g)}).remove(function(u){var f=s.getItemGraphicEl(u);f&&Td(f,e,u)}).execute(),this._edgeData=o},t.prototype.dispose=function(){},t.type="chord",t}(pa);const JEt=KEt;var QEt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links),this.legendVisualProvider=new K0(wi(this.getData,this),wi(this.getRawData,this))},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links)},t.prototype.getInitialData=function(e,r){var n=e.edges||e.links||[],o=e.data||e.nodes||[];if(o&&n){var s=K3(o,n,this,!0,a);return s.data}function a(u,f){var g=bn.prototype.getModel;function v(w,I){var E=g.call(this,w,I);return E.resolveParentPath=y,E}f.wrapMethod("getItemModel",function(w){return w.resolveParentPath=y,w.getModel=v,w});function y(w){if(w&&(w[0]==="label"||w[1]==="label")){var I=w.slice();return w[0]==="label"?I[0]="edgeLabel":w[1]==="label"&&(I[1]="edgeLabel"),I}return w}}},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,r,n){var o=this.getDataParams(e,n);if(n==="edge"){var s=this.getData(),a=s.graph.getEdgeByIndex(e),u=s.getName(a.node1.dataIndex),f=s.getName(a.node2.dataIndex),g=[];return u!=null&&g.push(u),f!=null&&g.push(f),xo("nameValue",{name:g.join(" > "),value:o.value,noValue:o.value==null})}return xo("nameValue",{name:o.name,value:o.value,noValue:o.value==null})},t.prototype.getDataParams=function(e,r){var n=i.prototype.getDataParams.call(this,e,r);if(r==="node"){var o=this.getData(),s=this.getGraph().getNodeByIndex(e);if(n.name==null&&(n.name=o.getName(e)),n.value==null){var a=s.getLayout().value;n.value=a}}return n},t.type="series.chord",t.defaultOption={z:2,coordinateSystem:"none",legendHoverLink:!0,colorBy:"data",left:0,top:0,right:0,bottom:0,width:null,height:null,center:["50%","50%"],radius:["70%","80%"],clockwise:!0,startAngle:90,endAngle:"auto",minAngle:0,padAngle:3,itemStyle:{borderRadius:[0,0,5,5]},lineStyle:{width:0,color:"source",opacity:.2},label:{show:!0,position:"outside",distance:5},emphasis:{focus:"adjacency",lineStyle:{opacity:.5}}},t}(Ea);const tDt=QEt;var QR=Math.PI/180;function eDt(i,t){i.eachSeriesByType("chord",function(e){iDt(e,t)})}function iDt(i,t){var e=i.getData(),r=e.graph,n=i.getEdgeData(),o=n.count();if(o){var s=SJ(i,t),a=s.cx,u=s.cy,f=s.r,g=s.r0,v=Math.max((i.get("padAngle")||0)*QR,0),y=Math.max((i.get("minAngle")||0)*QR,0),w=-i.get("startAngle")*QR,I=w+Math.PI*2,E=i.get("clockwise"),D=E?1:-1,R=[w,I];oE(R,!E);var z=R[0],N=R[1],H=N-z,$=e.getSum("value")===0&&n.getSum("value")===0,X=[],K=0;r.eachEdge(function(Vt){var Qt=$?1:Vt.getValue("value");$&&(Qt>0||y)&&(K+=2);var fe=Vt.node1.dataIndex,Te=Vt.node2.dataIndex;X[fe]=(X[fe]||0)+Qt,X[Te]=(X[Te]||0)+Qt});var et=0;if(r.eachNode(function(Vt){var Qt=Vt.getValue("value");isNaN(Qt)||(X[Vt.dataIndex]=Math.max(Qt,X[Vt.dataIndex]||0)),!$&&(X[Vt.dataIndex]>0||y)&&K++,et+=X[Vt.dataIndex]||0}),!(K===0||et===0)){v*K>=Math.abs(H)&&(v=Math.max(0,(Math.abs(H)-y*K)/K)),(v+y)*K>=Math.abs(H)&&(y=(Math.abs(H)-v*K)/K);var rt=(H-v*K*D)/et,lt=0,ht=0,yt=0;r.eachNode(function(Vt){var Qt=X[Vt.dataIndex]||0,fe=rt*(et?Qt:1)*D;Math.abs(fe)<y?lt+=y-Math.abs(fe):(ht+=Math.abs(fe)-y,yt+=Math.abs(fe)),Vt.setLayout({angle:fe,value:Qt})});var ft=!1;if(lt>ht){var kt=lt/ht;r.eachNode(function(Vt){var Qt=Vt.getLayout().angle;Math.abs(Qt)>=y?Vt.setLayout({angle:Qt*kt,ratio:kt},!0):Vt.setLayout({angle:y,ratio:y===0?1:Qt/y},!0)})}else r.eachNode(function(Vt){if(!ft){var Qt=Vt.getLayout().angle,fe=Math.min(Qt/yt,1),Te=fe*lt;Qt-Te<y&&(ft=!0)}});var Rt=lt;r.eachNode(function(Vt){if(!(Rt<=0)){var Qt=Vt.getLayout().angle;if(Qt>y&&y>0){var fe=ft?1:Math.min(Qt/yt,1),Te=Qt-y,be=Math.min(Te,Math.min(Rt,lt*fe));Rt-=be,Vt.setLayout({angle:Qt-be,ratio:(Qt-be)/Qt},!0)}else y>0&&Vt.setLayout({angle:y,ratio:Qt===0?1:y/Qt},!0)}});var Ct=z,Gt=[];r.eachNode(function(Vt){var Qt=Math.max(Vt.getLayout().angle,y);Vt.setLayout({cx:a,cy:u,r0:g,r:f,startAngle:Ct,endAngle:Ct+Qt*D,clockwise:E},!0),Gt[Vt.dataIndex]=Ct,Ct+=(Qt+v)*D}),r.eachEdge(function(Vt){var Qt=$?1:Vt.getValue("value"),fe=rt*(et?Qt:1)*D,Te=Vt.node1.dataIndex,be=Gt[Te]||0,Ge=Math.abs((Vt.node1.getLayout().ratio||1)*fe),li=be+Ge*D,Pi=[a+g*Math.cos(be),u+g*Math.sin(be)],or=[a+g*Math.cos(li),u+g*Math.sin(li)],Ve=Vt.node2.dataIndex,Ze=Gt[Ve]||0,ye=Math.abs((Vt.node2.getLayout().ratio||1)*fe),Ke=Ze+ye*D,We=[a+g*Math.cos(Ze),u+g*Math.sin(Ze)],Si=[a+g*Math.cos(Ke),u+g*Math.sin(Ke)];Vt.setLayout({s1:Pi,s2:or,sStartAngle:be,sEndAngle:li,t1:We,t2:Si,tStartAngle:Ze,tEndAngle:Ke,cx:a,cy:u,r:g,value:Qt,clockwise:E}),Gt[Te]=li,Gt[Ve]=Ke})}}}function rDt(i){i.registerChartView(JEt),i.registerSeriesModel(tDt),i.registerLayout(i.PRIORITY.VISUAL.POST_CHART_LAYOUT,eDt),i.registerProcessor(X0("chord"))}var nDt=function(){function i(){this.angle=0,this.width=10,this.r=10,this.x=0,this.y=0}return i}(),aDt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="pointer",r}return t.prototype.getDefaultShape=function(){return new nDt},t.prototype.buildPath=function(e,r){var n=Math.cos,o=Math.sin,s=r.r,a=r.width,u=r.angle,f=r.x-n(u)*a*(a>=s/3?1:2),g=r.y-o(u)*a*(a>=s/3?1:2);u=r.angle-Math.PI/2,e.moveTo(f,g),e.lineTo(r.x+n(u)*a,r.y+o(u)*a),e.lineTo(r.x+n(r.angle)*s,r.y+o(r.angle)*s),e.lineTo(r.x-n(u)*a,r.y-o(u)*a),e.lineTo(f,g)},t}(qr);const oDt=aDt;function sDt(i,t){var e=i.get("center"),r=t.getWidth(),n=t.getHeight(),o=Math.min(r,n),s=xi(e[0],t.getWidth()),a=xi(e[1],t.getHeight()),u=xi(i.get("radius"),o/2);return{cx:s,cy:a,r:u}}function tI(i,t){var e=i==null?"":i+"";return t&&(bi(t)?e=t.replace("{value}",e):Xi(t)&&(e=t(i))),e}var lDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){this.group.removeAll();var o=e.get(["axisLine","lineStyle","color"]),s=sDt(e,n);this._renderMain(e,r,n,o,s),this._data=e.getData()},t.prototype.dispose=function(){},t.prototype._renderMain=function(e,r,n,o,s){var a=this.group,u=e.get("clockwise"),f=-e.get("startAngle")/180*Math.PI,g=-e.get("endAngle")/180*Math.PI,v=e.getModel("axisLine"),y=v.get("roundCap"),w=y?nC:pl,I=v.get("show"),E=v.getModel("lineStyle"),D=E.get("width"),R=[f,g];oE(R,!u),f=R[0],g=R[1];for(var z=g-f,N=f,H=[],$=0;I&&$<o.length;$++){var X=Math.min(Math.max(o[$][0],0),1);g=f+z*X;var K=new w({shape:{startAngle:N,endAngle:g,cx:s.cx,cy:s.cy,clockwise:u,r0:s.r-D,r:s.r},silent:!0});K.setStyle({fill:o[$][1]}),K.setStyle(E.getLineStyle(["color","width"])),H.push(K),N=g}H.reverse(),gt(H,function(rt){return a.add(rt)});var et=function(rt){if(rt<=0)return o[0][1];var lt;for(lt=0;lt<o.length;lt++)if(o[lt][0]>=rt&&(lt===0?0:o[lt-1][0])<rt)return o[lt][1];return o[lt-1][1]};this._renderTicks(e,r,n,et,s,f,g,u,D),this._renderTitleAndDetail(e,r,n,et,s),this._renderAnchor(e,s),this._renderPointer(e,r,n,et,s,f,g,u,D)},t.prototype._renderTicks=function(e,r,n,o,s,a,u,f,g){for(var v=this.group,y=s.cx,w=s.cy,I=s.r,E=+e.get("min"),D=+e.get("max"),R=e.getModel("splitLine"),z=e.getModel("axisTick"),N=e.getModel("axisLabel"),H=e.get("splitNumber"),$=z.get("splitNumber"),X=xi(R.get("length"),I),K=xi(z.get("length"),I),et=a,rt=(u-a)/H,lt=rt/$,ht=R.getModel("lineStyle").getLineStyle(),yt=z.getModel("lineStyle").getLineStyle(),ft=R.get("distance"),kt,Rt,Ct=0;Ct<=H;Ct++){if(kt=Math.cos(et),Rt=Math.sin(et),R.get("show")){var Gt=ft?ft+g:g,Vt=new Ro({shape:{x1:kt*(I-Gt)+y,y1:Rt*(I-Gt)+w,x2:kt*(I-X-Gt)+y,y2:Rt*(I-X-Gt)+w},style:ht,silent:!0});ht.stroke==="auto"&&Vt.setStyle({stroke:o(Ct/H)}),v.add(Vt)}if(N.get("show")){var Gt=N.get("distance")+ft,Qt=tI(vo(Ct/H*(D-E)+E),N.get("formatter")),fe=o(Ct/H),Te=kt*(I-X-Gt)+y,be=Rt*(I-X-Gt)+w,Ge=N.get("rotate"),li=0;Ge==="radial"?(li=-et+2*Math.PI,li>Math.PI/2&&(li+=Math.PI)):Ge==="tangential"?li=-et-Math.PI/2:fn(Ge)&&(li=Ge*Math.PI/180),li===0?v.add(new _n({style:fa(N,{text:Qt,x:Te,y:be,verticalAlign:Rt<-.8?"top":Rt>.8?"bottom":"middle",align:kt<-.4?"left":kt>.4?"right":"center"},{inheritColor:fe}),silent:!0})):v.add(new _n({style:fa(N,{text:Qt,x:Te,y:be,verticalAlign:"middle",align:"center"},{inheritColor:fe}),silent:!0,originX:Te,originY:be,rotation:li}))}if(z.get("show")&&Ct!==H){var Gt=z.get("distance");Gt=Gt?Gt+g:g;for(var Pi=0;Pi<=$;Pi++){kt=Math.cos(et),Rt=Math.sin(et);var or=new Ro({shape:{x1:kt*(I-Gt)+y,y1:Rt*(I-Gt)+w,x2:kt*(I-K-Gt)+y,y2:Rt*(I-K-Gt)+w},silent:!0,style:yt});yt.stroke==="auto"&&or.setStyle({stroke:o((Ct+Pi/$)/H)}),v.add(or),et+=lt}et-=lt}else et+=rt}},t.prototype._renderPointer=function(e,r,n,o,s,a,u,f,g){var v=this.group,y=this._data,w=this._progressEls,I=[],E=e.get(["pointer","show"]),D=e.getModel("progress"),R=D.get("show"),z=e.getData(),N=z.mapDimension("value"),H=+e.get("min"),$=+e.get("max"),X=[H,$],K=[a,u];function et(lt,ht){var yt=z.getItemModel(lt),ft=yt.getModel("pointer"),kt=xi(ft.get("width"),s.r),Rt=xi(ft.get("length"),s.r),Ct=e.get(["pointer","icon"]),Gt=ft.get("offsetCenter"),Vt=xi(Gt[0],s.r),Qt=xi(Gt[1],s.r),fe=ft.get("keepAspect"),Te;return Ct?Te=bo(Ct,Vt-kt/2,Qt-Rt,kt,Rt,null,fe):Te=new oDt({shape:{angle:-Math.PI/2,width:kt,r:Rt,x:Vt,y:Qt}}),Te.rotation=-(ht+Math.PI/2),Te.x=s.cx,Te.y=s.cy,Te}function rt(lt,ht){var yt=D.get("roundCap"),ft=yt?nC:pl,kt=D.get("overlap"),Rt=kt?D.get("width"):g/z.count(),Ct=kt?s.r-Rt:s.r-(lt+1)*Rt,Gt=kt?s.r:s.r-lt*Rt,Vt=new ft({shape:{startAngle:a,endAngle:ht,cx:s.cx,cy:s.cy,clockwise:f,r0:Ct,r:Gt}});return kt&&(Vt.z2=Ln(z.get(N,lt),[H,$],[100,0],!0)),Vt}(R||E)&&(z.diff(y).add(function(lt){var ht=z.get(N,lt);if(E){var yt=et(lt,a);ya(yt,{rotation:-((isNaN(+ht)?K[0]:Ln(ht,X,K,!0))+Math.PI/2)},e),v.add(yt),z.setItemGraphicEl(lt,yt)}if(R){var ft=rt(lt,a),kt=D.get("clip");ya(ft,{shape:{endAngle:Ln(ht,X,K,kt)}},e),v.add(ft),KO(e.seriesIndex,z.dataType,lt,ft),I[lt]=ft}}).update(function(lt,ht){var yt=z.get(N,lt);if(E){var ft=y.getItemGraphicEl(ht),kt=ft?ft.rotation:a,Rt=et(lt,kt);Rt.rotation=kt,yn(Rt,{rotation:-((isNaN(+yt)?K[0]:Ln(yt,X,K,!0))+Math.PI/2)},e),v.add(Rt),z.setItemGraphicEl(lt,Rt)}if(R){var Ct=w[ht],Gt=Ct?Ct.shape.endAngle:a,Vt=rt(lt,Gt),Qt=D.get("clip");yn(Vt,{shape:{endAngle:Ln(yt,X,K,Qt)}},e),v.add(Vt),KO(e.seriesIndex,z.dataType,lt,Vt),I[lt]=Vt}}).execute(),z.each(function(lt){var ht=z.getItemModel(lt),yt=ht.getModel("emphasis"),ft=yt.get("focus"),kt=yt.get("blurScope"),Rt=yt.get("disabled");if(E){var Ct=z.getItemGraphicEl(lt),Gt=z.getItemVisual(lt,"style"),Vt=Gt.fill;if(Ct instanceof ys){var Qt=Ct.style;Ct.useStyle(Fe({image:Qt.image,x:Qt.x,y:Qt.y,width:Qt.width,height:Qt.height},Gt))}else Ct.useStyle(Gt),Ct.type!=="pointer"&&Ct.setColor(Vt);Ct.setStyle(ht.getModel(["pointer","itemStyle"]).getItemStyle()),Ct.style.fill==="auto"&&Ct.setStyle("fill",o(Ln(z.get(N,lt),X,[0,1],!0))),Ct.z2EmphasisLift=0,Oo(Ct,ht),Ma(Ct,ft,kt,Rt)}if(R){var fe=I[lt];fe.useStyle(z.getItemVisual(lt,"style")),fe.setStyle(ht.getModel(["progress","itemStyle"]).getItemStyle()),fe.z2EmphasisLift=0,Oo(fe,ht),Ma(fe,ft,kt,Rt)}}),this._progressEls=I)},t.prototype._renderAnchor=function(e,r){var n=e.getModel("anchor"),o=n.get("show");if(o){var s=n.get("size"),a=n.get("icon"),u=n.get("offsetCenter"),f=n.get("keepAspect"),g=bo(a,r.cx-s/2+xi(u[0],r.r),r.cy-s/2+xi(u[1],r.r),s,s,null,f);g.z2=n.get("showAbove")?1:0,g.setStyle(n.getModel("itemStyle").getItemStyle()),this.group.add(g)}},t.prototype._renderTitleAndDetail=function(e,r,n,o,s){var a=this,u=e.getData(),f=u.mapDimension("value"),g=+e.get("min"),v=+e.get("max"),y=new Ki,w=[],I=[],E=e.isAnimationEnabled(),D=e.get(["pointer","showAbove"]);u.diff(this._data).add(function(R){w[R]=new _n({silent:!0}),I[R]=new _n({silent:!0})}).update(function(R,z){w[R]=a._titleEls[z],I[R]=a._detailEls[z]}).execute(),u.each(function(R){var z=u.getItemModel(R),N=u.get(f,R),H=new Ki,$=o(Ln(N,[g,v],[0,1],!0)),X=z.getModel("title");if(X.get("show")){var K=X.get("offsetCenter"),et=s.cx+xi(K[0],s.r),rt=s.cy+xi(K[1],s.r),lt=w[R];lt.attr({z2:D?0:2,style:fa(X,{x:et,y:rt,text:u.getName(R),align:"center",verticalAlign:"middle"},{inheritColor:$})}),H.add(lt)}var ht=z.getModel("detail");if(ht.get("show")){var yt=ht.get("offsetCenter"),ft=s.cx+xi(yt[0],s.r),kt=s.cy+xi(yt[1],s.r),Rt=xi(ht.get("width"),s.r),Ct=xi(ht.get("height"),s.r),Gt=e.get(["progress","show"])?u.getItemVisual(R,"style").fill:$,lt=I[R],Vt=ht.get("formatter");lt.attr({z2:D?0:2,style:fa(ht,{x:ft,y:kt,text:tI(N,Vt),width:isNaN(Rt)?null:Rt,height:isNaN(Ct)?null:Ct,align:"center",verticalAlign:"middle"},{inheritColor:Gt})}),iJ(lt,{normal:ht},N,function(fe){return tI(fe,Vt)}),E&&rJ(lt,R,u,e,{getFormattedLabel:function(fe,Te,be,Ge,li,Pi){return tI(Pi?Pi.interpolatedValue:N,Vt)}}),H.add(lt)}y.add(H)}),this.group.add(y),this._titleEls=w,this._detailEls=I},t.type="gauge",t}(pa);const cDt=lDt;var uDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="itemStyle",e}return t.prototype.getInitialData=function(e,r){return Y0(this,["value"])},t.type="series.gauge",t.defaultOption={z:2,colorBy:"data",center:["50%","50%"],legendHoverLink:!0,radius:"75%",startAngle:225,endAngle:-45,clockwise:!0,min:0,max:100,splitNumber:10,axisLine:{show:!0,roundCap:!1,lineStyle:{color:[[1,_e.color.neutral10]],width:10}},progress:{show:!1,overlap:!0,width:10,roundCap:!1,clip:!0},splitLine:{show:!0,length:10,distance:10,lineStyle:{color:_e.color.axisTick,width:3,type:"solid"}},axisTick:{show:!0,splitNumber:5,length:6,distance:10,lineStyle:{color:_e.color.axisTickMinor,width:1,type:"solid"}},axisLabel:{show:!0,distance:15,color:_e.color.axisLabel,fontSize:12,rotate:0},pointer:{icon:null,offsetCenter:[0,0],show:!0,showAbove:!0,length:"60%",width:6,keepAspect:!1},anchor:{show:!1,showAbove:!1,size:6,icon:"circle",offsetCenter:[0,0],keepAspect:!1,itemStyle:{color:_e.color.neutral00,borderWidth:0,borderColor:_e.color.theme[0]}},title:{show:!0,offsetCenter:[0,"20%"],color:_e.color.secondary,fontSize:16,valueAnimation:!1},detail:{show:!0,backgroundColor:_e.color.transparent,borderWidth:0,borderColor:_e.color.neutral40,width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:_e.color.primary,fontSize:30,fontWeight:"bold",lineHeight:30,valueAnimation:!1}},t}(Ea);const hDt=uDt;function dDt(i){i.registerChartView(cDt),i.registerSeriesModel(hDt)}var fDt=["itemStyle","opacity"],pDt=function(i){we(t,i);function t(e,r){var n=i.call(this)||this,o=n,s=new Us,a=new _n;return o.setTextContent(a),n.setTextGuideLine(s),n.updateData(e,r,!0),n}return t.prototype.updateData=function(e,r,n){var o=this,s=e.hostModel,a=e.getItemModel(r),u=e.getItemLayout(r),f=a.getModel("emphasis"),g=a.get(fDt);g=g??1,n||Oc(o),o.useStyle(e.getItemVisual(r,"style")),o.style.lineJoin="round",n?(o.setShape({points:u.points}),o.style.opacity=0,ya(o,{style:{opacity:g}},s,r)):yn(o,{style:{opacity:g},shape:{points:u.points}},s,r),Oo(o,a),this._updateLabel(e,r),Ma(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},t.prototype._updateLabel=function(e,r){var n=this,o=this.getTextGuideLine(),s=n.getTextContent(),a=e.hostModel,u=e.getItemModel(r),f=e.getItemLayout(r),g=f.label,v=e.getItemVisual(r,"style"),y=v.fill;qo(s,zo(u),{labelFetcher:e.hostModel,labelDataIndex:r,defaultOpacity:v.opacity,defaultText:e.getName(r)},{normal:{align:g.textAlign,verticalAlign:g.verticalAlign}});var w=u.getModel("label"),I=w.get("color"),E=I==="inherit"?y:null;n.setTextConfig({local:!0,inside:!!g.inside,insideStroke:E,outsideFill:E});var D=g.linePoints;o.setShape({points:D}),n.textGuideLineConfig={anchor:D?new er(D[0][0],D[0][1]):null},yn(s,{style:{x:g.x,y:g.y}},a,r),s.attr({rotation:g.rotation,originX:g.x,originY:g.y,z2:10}),T3(n,A3(u),{stroke:y})},t}(gl),gDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.ignoreLabelLineUpdate=!0,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this._data,a=this.group;o.diff(s).add(function(u){var f=new pDt(o,u);o.setItemGraphicEl(u,f),a.add(f)}).update(function(u,f){var g=s.getItemGraphicEl(f);g.updateData(o,u),a.add(g),o.setItemGraphicEl(u,g)}).remove(function(u){var f=s.getItemGraphicEl(u);Td(f,e,u)}).execute(),this._data=o},t.prototype.remove=function(){this.group.removeAll(),this._data=null},t.prototype.dispose=function(){},t.type="funnel",t}(pa);const mDt=gDt;var vDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new K0(wi(this.getData,this),wi(this.getRawData,this)),this._defaultLabelLine(e)},t.prototype.getInitialData=function(e,r){return Y0(this,{coordDimensions:["value"],encodeDefaulter:br(r3,this)})},t.prototype._defaultLabelLine=function(e){dv(e,"labelLine",["show"]);var r=e.labelLine,n=e.emphasis.labelLine;r.show=r.show&&e.label.show,n.show=n.show&&e.emphasis.label.show},t.prototype.getDataParams=function(e){var r=this.getData(),n=i.prototype.getDataParams.call(this,e),o=r.mapDimension("value"),s=r.getSum(o);return n.percent=s?+(r.get(o,e)/s*100).toFixed(2):0,n.$vars.push("percent"),n},t.type="series.funnel",t.defaultOption={coordinateSystemUsage:"box",z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:65,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:_e.color.neutral00,borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:_e.color.primary}}},t}(Ea);const _Dt=vDt;function yDt(i,t){for(var e=i.mapDimension("value"),r=i.mapArray(e,function(u){return u}),n=[],o=t==="ascending",s=0,a=i.count();s<a;s++)n[s]=s;return Xi(t)?n.sort(t):t!=="none"&&n.sort(function(u,f){return o?r[u]-r[f]:r[f]-r[u]}),n}function xDt(i){var t=i.hostModel,e=t.get("orient");i.each(function(r){var n=i.getItemModel(r),o=n.getModel("label"),s=o.get("position"),a=n.getModel("labelLine"),u=i.getItemLayout(r),f=u.points,g=s==="inner"||s==="inside"||s==="center"||s==="insideLeft"||s==="insideRight",v,y,w,I;if(g)s==="insideLeft"?(y=(f[0][0]+f[3][0])/2+5,w=(f[0][1]+f[3][1])/2,v="left"):s==="insideRight"?(y=(f[1][0]+f[2][0])/2-5,w=(f[1][1]+f[2][1])/2,v="right"):(y=(f[0][0]+f[1][0]+f[2][0]+f[3][0])/4,w=(f[0][1]+f[1][1]+f[2][1]+f[3][1])/4,v="center"),I=[[y,w],[y,w]];else{var E=void 0,D=void 0,R=void 0,z=void 0,N=a.get("length");s==="left"?(E=(f[3][0]+f[0][0])/2,D=(f[3][1]+f[0][1])/2,R=E-N,y=R-5,v="right"):s==="right"?(E=(f[1][0]+f[2][0])/2,D=(f[1][1]+f[2][1])/2,R=E+N,y=R+5,v="left"):s==="top"?(E=(f[3][0]+f[0][0])/2,D=(f[3][1]+f[0][1])/2,z=D-N,w=z-5,v="center"):s==="bottom"?(E=(f[1][0]+f[2][0])/2,D=(f[1][1]+f[2][1])/2,z=D+N,w=z+5,v="center"):s==="rightTop"?(E=e==="horizontal"?f[3][0]:f[1][0],D=e==="horizontal"?f[3][1]:f[1][1],e==="horizontal"?(z=D-N,w=z-5,v="center"):(R=E+N,y=R+5,v="top")):s==="rightBottom"?(E=f[2][0],D=f[2][1],e==="horizontal"?(z=D+N,w=z+5,v="center"):(R=E+N,y=R+5,v="bottom")):s==="leftTop"?(E=f[0][0],D=e==="horizontal"?f[0][1]:f[1][1],e==="horizontal"?(z=D-N,w=z-5,v="center"):(R=E-N,y=R-5,v="right")):s==="leftBottom"?(E=e==="horizontal"?f[1][0]:f[3][0],D=e==="horizontal"?f[1][1]:f[2][1],e==="horizontal"?(z=D+N,w=z+5,v="center"):(R=E-N,y=R-5,v="right")):(E=(f[1][0]+f[2][0])/2,D=(f[1][1]+f[2][1])/2,e==="horizontal"?(z=D+N,w=z+5,v="center"):(R=E+N,y=R+5,v="left")),e==="horizontal"?(R=E,y=R):(z=D,w=z),I=[[E,D],[R,z]]}u.label={linePoints:I,x:y,y:w,verticalAlign:"middle",textAlign:v,inside:g}})}function bDt(i,t){i.eachSeriesByType("funnel",function(e){var r=e.getData(),n=r.mapDimension("value"),o=e.get("sort"),s=Bo(e,t),a=Ca(e.getBoxLayoutParams(),s.refContainer),u=e.get("orient"),f=a.width,g=a.height,v=yDt(r,o),y=a.x,w=a.y,I=u==="horizontal"?[xi(e.get("minSize"),g),xi(e.get("maxSize"),g)]:[xi(e.get("minSize"),f),xi(e.get("maxSize"),f)],E=r.getDataExtent(n),D=e.get("min"),R=e.get("max");D==null&&(D=Math.min(E[0],0)),R==null&&(R=E[1]);var z=e.get("funnelAlign"),N=e.get("gap"),H=u==="horizontal"?f:g,$=(H-N*(r.count()-1))/r.count(),X=function(Rt,Ct){if(u==="horizontal"){var Gt=r.get(n,Rt)||0,Vt=Ln(Gt,[D,R],I,!0),Qt=void 0;switch(z){case"top":Qt=w;break;case"center":Qt=w+(g-Vt)/2;break;case"bottom":Qt=w+(g-Vt);break}return[[Ct,Qt],[Ct,Qt+Vt]]}var fe=r.get(n,Rt)||0,Te=Ln(fe,[D,R],I,!0),be;switch(z){case"left":be=y;break;case"center":be=y+(f-Te)/2;break;case"right":be=y+f-Te;break}return[[be,Ct],[be+Te,Ct]]};o==="ascending"&&($=-$,N=-N,u==="horizontal"?y+=f:w+=g,v=v.reverse());for(var K=0;K<v.length;K++){var et=v[K],rt=v[K+1],lt=r.getItemModel(et);if(u==="horizontal"){var ht=lt.get(["itemStyle","width"]);ht==null?ht=$:(ht=xi(ht,f),o==="ascending"&&(ht=-ht));var yt=X(et,y),ft=X(rt,y+ht);y+=ht+N,r.setItemLayout(et,{points:yt.concat(ft.slice().reverse())})}else{var kt=lt.get(["itemStyle","height"]);kt==null?kt=$:(kt=xi(kt,g),o==="ascending"&&(kt=-kt));var yt=X(et,w),ft=X(rt,w+kt);w+=kt+N,r.setItemLayout(et,{points:yt.concat(ft.slice().reverse())})}}xDt(r)})}function wDt(i){i.registerChartView(mDt),i.registerSeriesModel(_Dt),i.registerLayout(bDt),i.registerProcessor(X0("funnel"))}var SDt=.3,TDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._dataGroup=new Ki,e._initialized=!1,e}return t.prototype.init=function(){this.group.add(this._dataGroup)},t.prototype.render=function(e,r,n,o){this._progressiveEls=null;var s=this._dataGroup,a=e.getData(),u=this._data,f=e.coordinateSystem,g=f.dimensions,v=G$(e);a.diff(u).add(y).update(w).remove(I).execute();function y(D){var R=U$(a,s,D,g,f);tk(R,a,D,v)}function w(D,R){var z=u.getItemGraphicEl(R),N=sit(a,D,g,f);a.setItemGraphicEl(D,z),yn(z,{shape:{points:N}},e,D),Oc(z),tk(z,a,D,v)}function I(D){var R=u.getItemGraphicEl(D);s.remove(R)}if(!this._initialized){this._initialized=!0;var E=ADt(f,e,function(){setTimeout(function(){s.removeClipPath()})});s.setClipPath(E)}this._data=a},t.prototype.incrementalPrepareRender=function(e,r,n){this._initialized=!0,this._data=null,this._dataGroup.removeAll()},t.prototype.incrementalRender=function(e,r,n){for(var o=r.getData(),s=r.coordinateSystem,a=s.dimensions,u=G$(r),f=this._progressiveEls=[],g=e.start;g<e.end;g++){var v=U$(o,this._dataGroup,g,a,s);v.incremental=!0,tk(v,o,g,u),f.push(v)}},t.prototype.remove=function(){this._dataGroup&&this._dataGroup.removeAll(),this._data=null},t.type="parallel",t}(pa);function ADt(i,t,e){var r=i.model,n=i.getRect(),o=new jr({shape:{x:n.x,y:n.y,width:n.width,height:n.height}}),s=r.get("layout")==="horizontal"?"width":"height";return o.setShape(s,0),ya(o,{shape:{width:n.width,height:n.height}},t,e),o}function sit(i,t,e,r){for(var n=[],o=0;o<e.length;o++){var s=e[o],a=i.get(i.mapDimension(s),t);IDt(a,r.getAxis(s).type)||n.push(r.dataToPoint(a,s))}return n}function U$(i,t,e,r,n){var o=sit(i,e,r,n),s=new Us({shape:{points:o},z2:10});return t.add(s),i.setItemGraphicEl(e,s),s}function G$(i){var t=i.get("smooth",!0);return t===!0&&(t=SDt),t=Ld(t),Bs(t)&&(t=0),{smooth:t}}function tk(i,t,e,r){i.useStyle(t.getItemVisual(e,"style")),i.style.fill=null,i.setShape("smooth",r.smooth);var n=t.getItemModel(e),o=n.getModel("emphasis");Oo(i,n,"lineStyle"),Ma(i,o.get("focus"),o.get("blurScope"),o.get("disabled"))}function IDt(i,t){return t==="category"?i==null:i==null||isNaN(i)}const MDt=TDt;var CDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="lineStyle",e.visualDrawType="stroke",e}return t.prototype.getInitialData=function(e,r){return Hd(null,this,{useEncodeDefaulter:wi(EDt,null,this)})},t.prototype.getRawIndicesByActiveState=function(e){var r=this.coordinateSystem,n=this.getData(),o=[];return r.eachActiveState(n,function(s,a){e===s&&o.push(n.getRawIndex(a))}),o},t.type="series.parallel",t.dependencies=["parallel"],t.defaultOption={z:2,coordinateSystem:"parallel",parallelIndex:0,label:{show:!1},inactiveOpacity:.05,activeOpacity:1,lineStyle:{width:1,opacity:.45,type:"solid"},emphasis:{label:{show:!1}},progressive:500,smooth:!1,animationEasing:"linear"},t}(Ea);function EDt(i){var t=i.ecModel.getComponent("parallel",i.get("parallelIndex"));if(t){var e={};return gt(t.dimensions,function(r){var n=DDt(r);e[r]=n}),e}}function DDt(i){return+i.replace("dim","")}const PDt=CDt;var LDt=["lineStyle","opacity"],RDt={seriesType:"parallel",reset:function(i,t){var e=i.coordinateSystem,r={normal:i.get(["lineStyle","opacity"]),active:i.get("activeOpacity"),inactive:i.get("inactiveOpacity")};return{progress:function(n,o){e.eachActiveState(o,function(s,a){var u=r[s];if(s==="normal"&&o.hasItemOption){var f=o.getItemModel(a).get(LDt,!0);f!=null&&(u=f)}var g=o.ensureUniqueItemVisual(a,"style");g.opacity=u},n.start,n.end)}}}};const kDt=RDt;function ODt(i){zDt(i),BDt(i)}function zDt(i){if(!i.parallel){var t=!1;gt(i.series,function(e){e&&e.type==="parallel"&&(t=!0)}),t&&(i.parallel=[{}])}}function BDt(i){var t=na(i.parallelAxis);gt(t,function(e){if(nr(e)){var r=e.parallelIndex||0,n=na(i.parallel)[r];n&&n.parallelAxisDefault&&Er(e,n.parallelAxisDefault,!1)}})}var FDt=5,NDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){this._model=e,this._api=n,this._handlers||(this._handlers={},gt(VDt,function(o,s){n.getZr().on(s,this._handlers[s]=wi(o,this))},this)),$0(this,"_throttledDispatchExpand",e.get("axisExpandRate"),"fixRate")},t.prototype.dispose=function(e,r){sS(this,"_throttledDispatchExpand"),gt(this._handlers,function(n,o){r.getZr().off(o,n)}),this._handlers=null},t.prototype._throttledDispatchExpand=function(e){this._dispatchExpand(e)},t.prototype._dispatchExpand=function(e){e&&this._api.dispatchAction(Fe({type:"parallelAxisExpand"},e))},t.type="parallel",t}(Oa),VDt={mousedown:function(i){ek(this,"click")&&(this._mouseDownPoint=[i.offsetX,i.offsetY])},mouseup:function(i){var t=this._mouseDownPoint;if(ek(this,"click")&&t){var e=[i.offsetX,i.offsetY],r=Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2);if(r>FDt)return;var n=this._model.coordinateSystem.getSlidedAxisExpandWindow([i.offsetX,i.offsetY]);n.behavior!=="none"&&this._dispatchExpand({axisExpandWindow:n.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(i){if(!(this._mouseDownPoint||!ek(this,"mousemove"))){var t=this._model,e=t.coordinateSystem.getSlidedAxisExpandWindow([i.offsetX,i.offsetY]),r=e.behavior;r==="jump"&&this._throttledDispatchExpand.debounceNextCall(t.get("axisExpandDebounce")),this._throttledDispatchExpand(r==="none"?null:{axisExpandWindow:e.axisExpandWindow,animation:r==="jump"?null:{duration:0}})}}};function ek(i,t){var e=i._model;return e.get("axisExpandable")&&e.get("axisExpandTriggerOn")===t}const UDt=NDt;var GDt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){i.prototype.init.apply(this,arguments),this.mergeOption({})},t.prototype.mergeOption=function(e){var r=this.option;e&&Er(r,e,!0),this._initDimensions()},t.prototype.contains=function(e,r){var n=e.get("parallelIndex");return n!=null&&r.getComponent("parallel",n)===this},t.prototype.setAxisExpand=function(e){gt(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(r){e.hasOwnProperty(r)&&(this.option[r]=e[r])},this)},t.prototype._initDimensions=function(){var e=this.dimensions=[],r=this.parallelAxisIndex=[],n=Rn(this.ecModel.queryComponents({mainType:"parallelAxis"}),function(o){return(o.get("parallelIndex")||0)===this.componentIndex},this);gt(n,function(o){e.push("dim"+o.get("dim")),r.push(o.componentIndex)})},t.type="parallel",t.dependencies=["parallelAxis"],t.layoutMode="box",t.defaultOption={z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},t}(gn);const HDt=GDt;var jDt=function(i){we(t,i);function t(e,r,n,o,s){var a=i.call(this,e,r,n)||this;return a.type=o||"value",a.axisIndex=s,a}return t.prototype.isHorizontal=function(){return this.coordinateSystem.getModel().get("layout")!=="horizontal"},t}(bu);const WDt=jDt;function Op(i,t,e,r,n,o){i=i||0;var s=e[1]-e[0];if(n!=null&&(n=Py(n,[0,s])),o!=null&&(o=Math.max(o,n??0)),r==="all"){var a=Math.abs(t[1]-t[0]);a=Py(a,[0,s]),n=o=Py(a,[n,o]),r=0}t[0]=Py(t[0],e),t[1]=Py(t[1],e);var u=ik(t,r);t[r]+=i;var f=n||0,g=e.slice();u.sign<0?g[0]+=f:g[1]-=f,t[r]=Py(t[r],g);var v;return v=ik(t,r),n!=null&&(v.sign!==u.sign||v.span<n)&&(t[1-r]=t[r]+u.sign*n),v=ik(t,r),o!=null&&v.span>o&&(t[1-r]=t[r]+v.sign*o),t}function ik(i,t){var e=i[t]-i[1-t];return{span:Math.abs(e),sign:e>0?-1:e<0?1:t?-1:1}}function Py(i,t){return Math.min(t[1]!=null?t[1]:1/0,Math.max(t[0]!=null?t[0]:-1/0,i))}var rk=gt,lit=Math.min,cit=Math.max,H$=Math.floor,$Dt=Math.ceil,j$=vo,ZDt=Math.PI,qDt=function(){function i(t,e,r){this.type="parallel",this._axesMap=Fi(),this._axesLayout={},this.dimensions=t.dimensions,this._model=t,this._init(t,e,r)}return i.prototype._init=function(t,e,r){var n=t.dimensions,o=t.parallelAxisIndex;rk(n,function(s,a){var u=o[a],f=e.getComponent("parallelAxis",u),g=this._axesMap.set(s,new WDt(s,SE(f),[0,0],f.get("type"),u)),v=g.type==="category";g.onBand=v&&f.get("boundaryGap"),g.inverse=f.get("inverse"),f.axis=g,g.model=f,g.coordinateSystem=f.coordinateSystem=this},this)},i.prototype.update=function(t,e){this._updateAxesFromSeries(this._model,t)},i.prototype.containPoint=function(t){var e=this._makeLayoutInfo(),r=e.axisBase,n=e.layoutBase,o=e.pixelDimIndex,s=t[1-o],a=t[o];return s>=r&&s<=r+e.axisLength&&a>=n&&a<=n+e.layoutLength},i.prototype.getModel=function(){return this._model},i.prototype._updateAxesFromSeries=function(t,e){e.eachSeries(function(r){if(t.contains(r,e)){var n=r.getData();rk(this.dimensions,function(o){var s=this._axesMap.get(o);s.scale.unionExtentFromData(n,n.mapDimension(o)),T0(s.scale,s.model)},this)}},this)},i.prototype.resize=function(t,e){var r=Bo(t,e).refContainer;this._rect=Ca(t.getBoxLayoutParams(),r),this._layoutAxes()},i.prototype.getRect=function(){return this._rect},i.prototype._makeLayoutInfo=function(){var t=this._model,e=this._rect,r=["x","y"],n=["width","height"],o=t.get("layout"),s=o==="horizontal"?0:1,a=e[n[s]],u=[0,a],f=this.dimensions.length,g=eI(t.get("axisExpandWidth"),u),v=eI(t.get("axisExpandCount")||0,[0,f]),y=t.get("axisExpandable")&&f>3&&f>v&&v>1&&g>0&&a>0,w=t.get("axisExpandWindow"),I;if(w)I=eI(w[1]-w[0],u),w[1]=w[0]+I;else{I=eI(g*(v-1),u);var E=t.get("axisExpandCenter")||H$(f/2);w=[g*E-I/2],w[1]=w[0]+I}var D=(a-I)/(f-v);D<3&&(D=0);var R=[H$(j$(w[0]/g,1))+1,$Dt(j$(w[1]/g,1))-1],z=D/g*w[0];return{layout:o,pixelDimIndex:s,layoutBase:e[r[s]],layoutLength:a,axisBase:e[r[1-s]],axisLength:e[n[1-s]],axisExpandable:y,axisExpandWidth:g,axisCollapseWidth:D,axisExpandWindow:w,axisCount:f,winInnerIndices:R,axisExpandWindow0Pos:z}},i.prototype._layoutAxes=function(){var t=this._rect,e=this._axesMap,r=this.dimensions,n=this._makeLayoutInfo(),o=n.layout;e.each(function(s){var a=[0,n.axisLength],u=s.inverse?1:0;s.setExtent(a[u],a[1-u])}),rk(r,function(s,a){var u=(n.axisExpandable?YDt:XDt)(a,n),f={horizontal:{x:u.position,y:n.axisLength},vertical:{x:0,y:u.position}},g={horizontal:ZDt/2,vertical:0},v=[f[o].x+t.x,f[o].y+t.y],y=g[o],w=ns();Up(w,w,y),xh(w,w,v),this._axesLayout[s]={position:v,rotation:y,transform:w,axisNameAvailableWidth:u.axisNameAvailableWidth,axisLabelShow:u.axisLabelShow,nameTruncateMaxWidth:u.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}},this)},i.prototype.getAxis=function(t){return this._axesMap.get(t)},i.prototype.dataToPoint=function(t,e){return this.axisCoordToPoint(this._axesMap.get(e).dataToCoord(t),e)},i.prototype.eachActiveState=function(t,e,r,n){r==null&&(r=0),n==null&&(n=t.count());var o=this._axesMap,s=this.dimensions,a=[],u=[];gt(s,function(D){a.push(t.mapDimension(D)),u.push(o.get(D).model)});for(var f=this.hasAxisBrushed(),g=r;g<n;g++){var v=void 0;if(!f)v="normal";else{v="active";for(var y=t.getValues(a,g),w=0,I=s.length;w<I;w++){var E=u[w].getActiveState(y[w]);if(E==="inactive"){v="inactive";break}}}e(v,g)}},i.prototype.hasAxisBrushed=function(){for(var t=this.dimensions,e=this._axesMap,r=!1,n=0,o=t.length;n<o;n++)e.get(t[n]).model.getActiveState()!=="normal"&&(r=!0);return r},i.prototype.axisCoordToPoint=function(t,e){var r=this._axesLayout[e];return du([t,0],r.transform)},i.prototype.getAxisLayout=function(t){return Yi(this._axesLayout[t])},i.prototype.getSlidedAxisExpandWindow=function(t){var e=this._makeLayoutInfo(),r=e.pixelDimIndex,n=e.axisExpandWindow.slice(),o=n[1]-n[0],s=[0,e.axisExpandWidth*(e.axisCount-1)];if(!this.containPoint(t))return{behavior:"none",axisExpandWindow:n};var a=t[r]-e.layoutBase-e.axisExpandWindow0Pos,u,f="slide",g=e.axisCollapseWidth,v=this._model.get("axisExpandSlideTriggerArea"),y=v[0]!=null;if(g)y&&g&&a<o*v[0]?(f="jump",u=a-o*v[2]):y&&g&&a>o*(1-v[0])?(f="jump",u=a-o*(1-v[2])):(u=a-o*v[1])>=0&&(u=a-o*(1-v[1]))<=0&&(u=0),u*=e.axisExpandWidth/g,u?Op(u,n,s,"all"):f="none";else{var w=n[1]-n[0],I=s[1]*a/w;n=[cit(0,I-w/2)],n[1]=lit(s[1],n[0]+w),n[0]=n[1]-w}return{axisExpandWindow:n,behavior:f}},i}();function eI(i,t){return lit(cit(i,t[0]),t[1])}function XDt(i,t){var e=t.layoutLength/(t.axisCount-1);return{position:e*i,axisNameAvailableWidth:e,axisLabelShow:!0}}function YDt(i,t){var e=t.layoutLength,r=t.axisExpandWidth,n=t.axisCount,o=t.axisCollapseWidth,s=t.winInnerIndices,a,u=o,f=!1,g;return i<s[0]?(a=i*o,g=o):i<=s[1]?(a=t.axisExpandWindow0Pos+i*r-t.axisExpandWindow[0],u=r,f=!0):(a=e-(n-1-i)*o,g=o),{position:a,axisNameAvailableWidth:u,axisLabelShow:f,nameTruncateMaxWidth:g}}const KDt=qDt;function JDt(i,t){var e=[];return i.eachComponent("parallel",function(r,n){var o=new KDt(r,i,t);o.name="parallel_"+n,o.resize(r,t),r.coordinateSystem=o,o.model=r,e.push(o)}),i.eachSeries(function(r){if(r.get("coordinateSystem")==="parallel"){var n=r.getReferringComponents("parallel",Wa).models[0];r.coordinateSystem=n.coordinateSystem}}),e}var QDt={create:JDt};const tPt=QDt;var uit=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.activeIntervals=[],e}return t.prototype.getAreaSelectStyle=function(){return pv([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},t.prototype.setActiveIntervals=function(e){var r=this.activeIntervals=Yi(e);if(r)for(var n=r.length-1;n>=0;n--)Dc(r[n])},t.prototype.getActiveState=function(e){var r=this.activeIntervals;if(!r.length)return"normal";if(e==null||isNaN(+e))return"inactive";if(r.length===1){var n=r[0];if(n[0]<=e&&e<=n[1])return"active"}else for(var o=0,s=r.length;o<s;o++)if(r[o][0]<=e&&e<=r[o][1])return"active";return"inactive"},t}(gn);wo(uit,HS);const W$=uit;var yv=!0,bS=Math.min,E0=Math.max,ePt=Math.pow,iPt=1e4,rPt=6,nPt=6,$$="globalPan",aPt={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},oPt={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},Z$={brushStyle:{lineWidth:2,stroke:_e.color.backgroundTint,fill:_e.color.borderTint},transformable:!0,brushMode:"single",removeOnClick:!1},sPt=0,lPt=function(i){we(t,i);function t(e){var r=i.call(this)||this;return r._track=[],r._covers=[],r._handlers={},r._zr=e,r.group=new Ki,r._uid="brushController_"+sPt++,gt(gPt,function(n,o){this._handlers[o]=wi(n,this)},r),r}return t.prototype.enableBrush=function(e){return this._brushType&&this._doDisableBrush(),e.brushType&&this._doEnableBrush(e),this},t.prototype._doEnableBrush=function(e){var r=this._zr;this._enableGlobalPan||lMt(r,$$,this._uid),gt(this._handlers,function(n,o){r.on(o,n)}),this._brushType=e.brushType,this._brushOption=Er(Yi(Z$),e,!0)},t.prototype._doDisableBrush=function(){var e=this._zr;cMt(e,$$,this._uid),gt(this._handlers,function(r,n){e.off(n,r)}),this._brushType=this._brushOption=null},t.prototype.setPanels=function(e){if(e&&e.length){var r=this._panels={};gt(e,function(n){r[n.panelId]=Yi(n)})}else this._panels=null;return this},t.prototype.mount=function(e){e=e||{},this._enableGlobalPan=e.enableGlobalPan;var r=this.group;return this._zr.add(r),r.attr({x:e.x||0,y:e.y||0,rotation:e.rotation||0,scaleX:e.scaleX||1,scaleY:e.scaleY||1}),this._transform=r.getLocalTransform(),this},t.prototype.updateCovers=function(e){e=ti(e,function(y){return Er(Yi(Z$),y,!0)});var r="\0-brush-index-",n=this._covers,o=this._covers=[],s=this,a=this._creatingCover;return new Od(n,e,f,u).add(g).update(g).remove(v).execute(),this;function u(y,w){return(y.id!=null?y.id:r+w)+"-"+y.brushType}function f(y,w){return u(y.__brushOption,w)}function g(y,w){var I=e[y];if(w!=null&&n[w]===a)o[y]=n[w];else{var E=o[y]=w!=null?(n[w].__brushOption=I,n[w]):dit(s,hit(s,I));J3(s,E)}}function v(y){n[y]!==a&&s.group.remove(n[y])}},t.prototype.unmount=function(){return this.enableBrush(!1),tB(this),this._zr.remove(this.group),this},t.prototype.dispose=function(){this.unmount(),this.off()},t}(zc);function hit(i,t){var e=LE[t.brushType].createCover(i,t);return e.__brushOption=t,pit(e,t),i.group.add(e),e}function dit(i,t){var e=Q3(t);return e.endCreating&&(e.endCreating(i,t),pit(t,t.__brushOption)),t}function fit(i,t){var e=t.__brushOption;Q3(t).updateCoverShape(i,t,e.range,e)}function pit(i,t){var e=t.z;e==null&&(e=iPt),i.traverse(function(r){r.z=e,r.z2=e})}function J3(i,t){Q3(t).updateCommon(i,t),fit(i,t)}function Q3(i){return LE[i.__brushOption.brushType]}function tN(i,t,e){var r=i._panels;if(!r)return yv;var n,o=i._transform;return gt(r,function(s){s.isTargetByCursor(t,e,o)&&(n=s)}),n}function git(i,t){var e=i._panels;if(!e)return yv;var r=t.__brushOption.panelId;return r!=null?e[r]:yv}function tB(i){var t=i._covers,e=t.length;return gt(t,function(r){i.group.remove(r)},i),t.length=0,!!e}function xv(i,t){var e=ti(i._covers,function(r){var n=r.__brushOption,o=Yi(n.range);return{brushType:n.brushType,panelId:n.panelId,range:o}});i.trigger("brush",{areas:e,isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function cPt(i){var t=i._track;if(!t.length)return!1;var e=t[t.length-1],r=t[0],n=e[0]-r[0],o=e[1]-r[1],s=ePt(n*n+o*o,.5);return s>rPt}function mit(i){var t=i.length-1;return t<0&&(t=0),[i[0],i[t]]}function vit(i,t,e,r){var n=new Ki;return n.add(new jr({name:"main",style:eN(e),silent:!0,draggable:!0,cursor:"move",drift:br(q$,i,t,n,["n","s","w","e"]),ondragend:br(xv,t,{isEnd:!0})})),gt(r,function(o){n.add(new jr({name:o.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:br(q$,i,t,n,o),ondragend:br(xv,t,{isEnd:!0})}))}),n}function _it(i,t,e,r){var n=r.brushStyle.lineWidth||0,o=E0(n,nPt),s=e[0][0],a=e[1][0],u=s-n/2,f=a-n/2,g=e[0][1],v=e[1][1],y=g-o+n/2,w=v-o+n/2,I=g-s,E=v-a,D=I+n,R=E+n;nd(i,t,"main",s,a,I,E),r.transformable&&(nd(i,t,"w",u,f,o,R),nd(i,t,"e",y,f,o,R),nd(i,t,"n",u,f,D,o),nd(i,t,"s",u,w,D,o),nd(i,t,"nw",u,f,o,o),nd(i,t,"ne",y,f,o,o),nd(i,t,"sw",u,w,o,o),nd(i,t,"se",y,w,o,o))}function eB(i,t){var e=t.__brushOption,r=e.transformable,n=t.childAt(0);n.useStyle(eN(e)),n.attr({silent:!r,cursor:r?"move":"default"}),gt([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(o){var s=t.childOfName(o.join("")),a=o.length===1?iB(i,o[0]):hPt(i,o);s&&s.attr({silent:!r,invisible:!r,cursor:r?oPt[a]+"-resize":null})})}function nd(i,t,e,r,n,o,s){var a=t.childOfName(e);a&&a.setShape(fPt(iN(i,t,[[r,n],[r+o,n+s]])))}function eN(i){return rr({strokeNoScale:!0},i.brushStyle)}function yit(i,t,e,r){var n=[bS(i,e),bS(t,r)],o=[E0(i,e),E0(t,r)];return[[n[0],o[0]],[n[1],o[1]]]}function uPt(i){return av(i.group)}function iB(i,t){var e={w:"left",e:"right",n:"top",s:"bottom"},r={left:"w",right:"e",top:"n",bottom:"s"},n=fE(e[t],uPt(i));return r[n]}function hPt(i,t){var e=[iB(i,t[0]),iB(i,t[1])];return(e[0]==="e"||e[0]==="w")&&e.reverse(),e.join("")}function q$(i,t,e,r,n,o){var s=e.__brushOption,a=i.toRectRange(s.range),u=xit(t,n,o);gt(r,function(f){var g=aPt[f];a[g[0]][g[1]]+=u[g[0]]}),s.range=i.fromRectRange(yit(a[0][0],a[1][0],a[0][1],a[1][1])),J3(t,e),xv(t,{isEnd:!1})}function dPt(i,t,e,r){var n=t.__brushOption.range,o=xit(i,e,r);gt(n,function(s){s[0]+=o[0],s[1]+=o[1]}),J3(i,t),xv(i,{isEnd:!1})}function xit(i,t,e){var r=i.group,n=r.transformCoordToLocal(t,e),o=r.transformCoordToLocal(0,0);return[n[0]-o[0],n[1]-o[1]]}function iN(i,t,e){var r=git(i,t);return r&&r!==yv?r.clipPath(e,i._transform):Yi(e)}function fPt(i){var t=bS(i[0][0],i[1][0]),e=bS(i[0][1],i[1][1]),r=E0(i[0][0],i[1][0]),n=E0(i[0][1],i[1][1]);return{x:t,y:e,width:r-t,height:n-e}}function pPt(i,t,e){if(!(!i._brushType||mPt(i,t.offsetX,t.offsetY))){var r=i._zr,n=i._covers,o=tN(i,t,e);if(!i._dragging)for(var s=0;s<n.length;s++){var a=n[s].__brushOption;if(o&&(o===yv||a.panelId===o.panelId)&&LE[a.brushType].contain(n[s],e[0],e[1]))return}o&&r.setCursorStyle("crosshair")}}function rB(i){var t=i.event;t.preventDefault&&t.preventDefault()}function nB(i,t,e){return i.childOfName("main").contain(t,e)}function bit(i,t,e,r){var n=i._creatingCover,o=i._creatingPanel,s=i._brushOption,a;if(i._track.push(e.slice()),cPt(i)||n){if(o&&!n){s.brushMode==="single"&&tB(i);var u=Yi(s);u.brushType=X$(u.brushType,o),u.panelId=o===yv?null:o.panelId,n=i._creatingCover=hit(i,u),i._covers.push(n)}if(n){var f=LE[X$(i._brushType,o)],g=n.__brushOption;g.range=f.getCreatingRange(iN(i,n,i._track)),r&&(dit(i,n),f.updateCommon(i,n)),fit(i,n),a={isEnd:r}}}else r&&s.brushMode==="single"&&s.removeOnClick&&tN(i,t,e)&&tB(i)&&(a={isEnd:r,removeOnClick:!0});return a}function X$(i,t){return i==="auto"?t.defaultBrushType:i}var gPt={mousedown:function(i){if(this._dragging)Y$(this,i);else if(!i.target||!i.target.draggable){rB(i);var t=this.group.transformCoordToLocal(i.offsetX,i.offsetY);this._creatingCover=null;var e=this._creatingPanel=tN(this,i,t);e&&(this._dragging=!0,this._track=[t.slice()])}},mousemove:function(i){var t=i.offsetX,e=i.offsetY,r=this.group.transformCoordToLocal(t,e);if(pPt(this,i,r),this._dragging){rB(i);var n=bit(this,i,r,!1);n&&xv(this,n)}},mouseup:function(i){Y$(this,i)}};function Y$(i,t){if(i._dragging){rB(t);var e=t.offsetX,r=t.offsetY,n=i.group.transformCoordToLocal(e,r),o=bit(i,t,n,!0);i._dragging=!1,i._track=[],i._creatingCover=null,o&&xv(i,o)}}function mPt(i,t,e){var r=i._zr;return t<0||t>r.getWidth()||e<0||e>r.getHeight()}var LE={lineX:K$(0),lineY:K$(1),rect:{createCover:function(i,t){function e(r){return r}return vit({toRectRange:e,fromRectRange:e},i,t,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(i){var t=mit(i);return yit(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(i,t,e,r){_it(i,t,e,r)},updateCommon:eB,contain:nB},polygon:{createCover:function(i,t){var e=new Ki;return e.add(new Us({name:"main",style:eN(t),silent:!0})),e},getCreatingRange:function(i){return i},endCreating:function(i,t){t.remove(t.childAt(0)),t.add(new gl({name:"main",draggable:!0,drift:br(dPt,i,t),ondragend:br(xv,i,{isEnd:!0})}))},updateCoverShape:function(i,t,e,r){t.childAt(0).setShape({points:iN(i,t,e)})},updateCommon:eB,contain:nB}};function K$(i){return{createCover:function(t,e){return vit({toRectRange:function(r){var n=[r,[0,100]];return i&&n.reverse(),n},fromRectRange:function(r){return r[i]}},t,e,[[["w"],["e"]],[["n"],["s"]]][i])},getCreatingRange:function(t){var e=mit(t),r=bS(e[0][i],e[1][i]),n=E0(e[0][i],e[1][i]);return[r,n]},updateCoverShape:function(t,e,r,n){var o,s=git(t,e);if(s!==yv&&s.getLinearBrushOtherExtent)o=s.getLinearBrushOtherExtent(i);else{var a=t._zr;o=[0,[a.getWidth(),a.getHeight()][1-i]]}var u=[r,o];i&&u.reverse(),_it(t,e,u,n)},updateCommon:eB,contain:nB}}const rN=lPt;function wit(i){return i=nN(i),function(t){return KK(t,i)}}function Sit(i,t){return i=nN(i),function(e){var r=t??e,n=r?i.width:i.height,o=r?i.x:i.y;return[o,o+(n||0)]}}function Tit(i,t,e){var r=nN(i);return function(n,o){return r.contain(o[0],o[1])&&!Met(n,t,e)}}function nN(i){return sr.create(i)}var vPt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){i.prototype.init.apply(this,arguments),(this._brushController=new rN(r.getZr())).on("brush",wi(this._onBrush,this))},t.prototype.render=function(e,r,n,o){if(!_Pt(e,r,o)){this.axisModel=e,this.api=n,this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new Ki,this.group.add(this._axisGroup),!!e.get("show")){var a=xPt(e,r),u=a.coordinateSystem,f=e.getAreaSelectStyle(),g=f.width,v=e.axis.dim,y=u.getAxisLayout(v),w=Fe({strokeContainThreshold:g},y),I=new zd(e,n,w);I.build(),this._axisGroup.add(I.group),this._refreshBrushController(w,f,e,a,g,n),zS(s,this._axisGroup,e)}}},t.prototype._refreshBrushController=function(e,r,n,o,s,a){var u=n.axis.getExtent(),f=u[1]-u[0],g=Math.min(30,Math.abs(f)*.1),v=sr.create({x:u[0],y:-s/2,width:f,height:s});v.x-=g,v.width+=2*g,this._brushController.mount({enableGlobalPan:!0,rotation:e.rotation,x:e.position[0],y:e.position[1]}).setPanels([{panelId:"pl",clipPath:wit(v),isTargetByCursor:Tit(v,a,o),getLinearBrushOtherExtent:Sit(v,0)}]).enableBrush({brushType:"lineX",brushStyle:r,removeOnClick:!0}).updateCovers(yPt(n))},t.prototype._onBrush=function(e){var r=e.areas,n=this.axisModel,o=n.axis,s=ti(r,function(a){return[o.coordToData(a.range[0],!0),o.coordToData(a.range[1],!0)]});(!n.option.realtime===e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:n.id,intervals:s})},t.prototype.dispose=function(){this._brushController.dispose()},t.type="parallelAxis",t}(Oa);function _Pt(i,t,e){return e&&e.type==="axisAreaSelect"&&t.findComponents({mainType:"parallelAxis",query:e})[0]===i}function yPt(i){var t=i.axis;return ti(i.activeIntervals,function(e){return{brushType:"lineX",panelId:"pl",range:[t.dataToCoord(e[0],!0),t.dataToCoord(e[1],!0)]}})}function xPt(i,t){return t.getComponent("parallel",i.get("parallelIndex"))}const bPt=vPt;var wPt={type:"axisAreaSelect",event:"axisAreaSelected"};function SPt(i){i.registerAction(wPt,function(t,e){e.eachComponent({mainType:"parallelAxis",query:t},function(r){r.axis.model.setActiveIntervals(t.intervals)})}),i.registerAction("parallelAxisExpand",function(t,e){e.eachComponent({mainType:"parallel",query:t},function(r){r.setAxisExpand(t)})})}var TPt={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10};function Ait(i){i.registerComponentView(UDt),i.registerComponentModel(HDt),i.registerCoordinateSystem("parallel",tPt),i.registerPreprocessor(ODt),i.registerComponentModel(W$),i.registerComponentView(bPt),M0(i,"parallel",W$,TPt),SPt(i)}function APt(i){Rr(Ait),i.registerChartView(MDt),i.registerSeriesModel(PDt),i.registerVisual(i.PRIORITY.VISUAL.BRUSH,kDt)}var IPt=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0}return i}(),MPt=function(i){we(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new IPt},t.prototype.buildPath=function(e,r){var n=r.extent;e.moveTo(r.x1,r.y1),e.bezierCurveTo(r.cpx1,r.cpy1,r.cpx2,r.cpy2,r.x2,r.y2),r.orient==="vertical"?(e.lineTo(r.x2+n,r.y2),e.bezierCurveTo(r.cpx2+n,r.cpy2,r.cpx1+n,r.cpy1,r.x1+n,r.y1)):(e.lineTo(r.x2,r.y2+n),e.bezierCurveTo(r.cpx2,r.cpy2+n,r.cpx1,r.cpy1+n,r.x1,r.y1+n)),e.closePath()},t.prototype.highlight=function(){Rd(this)},t.prototype.downplay=function(){kd(this)},t}(qr),CPt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._mainGroup=new Ki,e._focusAdjacencyDisabled=!1,e}return t.prototype.init=function(e,r){this._controller=new Lv(r.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},t.prototype.render=function(e,r,n){var o=this,s=e.getGraph(),a=this._mainGroup,u=e.layoutInfo,f=u.width,g=u.height,v=e.getData(),y=e.getData("edge"),w=e.get("orient");this._model=e,a.removeAll(),a.x=u.x,a.y=u.y,this._updateViewCoordSys(e,n),Cet(e,n,a,this._controller,this._controllerHost,null),s.eachEdge(function(I){var E=new MPt,D=ur(E);D.dataIndex=I.dataIndex,D.seriesIndex=e.seriesIndex,D.dataType="edge";var R=I.getModel(),z=R.getModel("lineStyle"),N=z.get("curveness"),H=I.node1.getLayout(),$=I.node1.getModel(),X=$.get("localX"),K=$.get("localY"),et=I.node2.getLayout(),rt=I.node2.getModel(),lt=rt.get("localX"),ht=rt.get("localY"),yt=I.getLayout(),ft,kt,Rt,Ct,Gt,Vt,Qt,fe;E.shape.extent=Math.max(1,yt.dy),E.shape.orient=w,w==="vertical"?(ft=(X!=null?X*f:H.x)+yt.sy,kt=(K!=null?K*g:H.y)+H.dy,Rt=(lt!=null?lt*f:et.x)+yt.ty,Ct=ht!=null?ht*g:et.y,Gt=ft,Vt=kt*(1-N)+Ct*N,Qt=Rt,fe=kt*N+Ct*(1-N)):(ft=(X!=null?X*f:H.x)+H.dx,kt=(K!=null?K*g:H.y)+yt.sy,Rt=lt!=null?lt*f:et.x,Ct=(ht!=null?ht*g:et.y)+yt.ty,Gt=ft*(1-N)+Rt*N,Vt=kt,Qt=ft*N+Rt*(1-N),fe=Ct),E.setShape({x1:ft,y1:kt,x2:Rt,y2:Ct,cpx1:Gt,cpy1:Vt,cpx2:Qt,cpy2:fe}),E.useStyle(z.getItemStyle()),J$(E.style,w,I);var Te=""+R.get("value"),be=zo(R,"edgeLabel");qo(E,be,{labelFetcher:{getFormattedLabel:function(Pi,or,Ve,Ze,ye,Ke){return e.getFormattedLabel(Pi,or,"edge",Ze,ic(ye,be.normal&&be.normal.get("formatter"),Te),Ke)}},labelDataIndex:I.dataIndex,defaultText:Te}),E.setTextConfig({position:"inside"});var Ge=R.getModel("emphasis");Oo(E,R,"lineStyle",function(Pi){var or=Pi.getItemStyle();return J$(or,w,I),or}),a.add(E),y.setItemGraphicEl(I.dataIndex,E);var li=Ge.get("focus");Ma(E,li==="adjacency"?I.getAdjacentDataIndices():li==="trajectory"?I.getTrajectoryDataIndices():li,Ge.get("blurScope"),Ge.get("disabled"))}),s.eachNode(function(I){var E=I.getLayout(),D=I.getModel(),R=D.get("localX"),z=D.get("localY"),N=D.getModel("emphasis"),H=D.get(["itemStyle","borderRadius"])||0,$=new jr({shape:{x:R!=null?R*f:E.x,y:z!=null?z*g:E.y,width:E.dx,height:E.dy,r:H},style:D.getModel("itemStyle").getItemStyle(),z2:10});qo($,zo(D),{labelFetcher:{getFormattedLabel:function(K,et){return e.getFormattedLabel(K,et,"node")}},labelDataIndex:I.dataIndex,defaultText:I.id}),$.disableLabelAnimation=!0,$.setStyle("fill",I.getVisual("color")),$.setStyle("decal",I.getVisual("style").decal),Oo($,D),a.add($),v.setItemGraphicEl(I.dataIndex,$),ur($).dataType="node";var X=N.get("focus");Ma($,X==="adjacency"?I.getAdjacentDataIndices():X==="trajectory"?I.getTrajectoryDataIndices():X,N.get("blurScope"),N.get("disabled"))}),v.eachItemGraphicEl(function(I,E){var D=v.getItemModel(E);D.get("draggable")&&(I.drift=function(R,z){o._focusAdjacencyDisabled=!0,this.shape.x+=R,this.shape.y+=z,this.dirty(),n.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:v.getRawIndex(E),localX:this.shape.x/f,localY:this.shape.y/g})},I.ondragend=function(){o._focusAdjacencyDisabled=!1},I.draggable=!0,I.cursor="move")}),!this._data&&e.isAnimationEnabled()&&a.setClipPath(EPt(a.getBoundingRect(),e,function(){a.removeClipPath()})),this._data=e.getData()},t.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype._updateViewCoordSys=function(e,r){var n=e.layoutInfo,o=n.width,s=n.height,a=e.coordinateSystem=new Rv(null,{api:r,ecModel:e.ecModel});a.zoomLimit=e.get("scaleLimit"),a.setBoundingRect(0,0,o,s),a.setCenter(e.get("center")),a.setZoom(e.get("zoom")),this._controllerHost.target.attr({x:a.x,y:a.y,scaleX:a.scaleX,scaleY:a.scaleY})},t.type="sankey",t}(pa);function J$(i,t,e){switch(i.fill){case"source":i.fill=e.node1.getVisual("color"),i.decal=e.node1.getVisual("style").decal;break;case"target":i.fill=e.node2.getVisual("color"),i.decal=e.node2.getVisual("style").decal;break;case"gradient":var r=e.node1.getVisual("color"),n=e.node2.getVisual("color");bi(r)&&bi(n)&&(i.fill=new V0(0,0,+(t==="horizontal"),+(t==="vertical"),[{color:r,offset:0},{color:n,offset:1}]))}}function EPt(i,t,e){var r=new jr({shape:{x:i.x-10,y:i.y-10,width:0,height:i.height+20}});return ya(r,{shape:{width:i.width+20}},t,e),r}const DPt=CPt;var PPt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,r){var n=e.edges||e.links||[],o=e.data||e.nodes||[],s=e.levels||[];this.levelModels=[];for(var a=this.levelModels,u=0;u<s.length;u++)s[u].depth!=null&&s[u].depth>=0&&(a[s[u].depth]=new bn(s[u],this,r));var f=K3(o,n,this,!0,g);return f.data;function g(v,y){v.wrapMethod("getItemModel",function(w,I){var E=w.parentModel,D=E.getData().getItemLayout(I);if(D){var R=D.depth,z=E.levelModels[R];z&&(w.parentModel=z)}return w}),y.wrapMethod("getItemModel",function(w,I){var E=w.parentModel,D=E.getGraph().getEdgeByIndex(I),R=D.node1.getLayout();if(R){var z=R.depth,N=E.levelModels[z];N&&(w.parentModel=N)}return w})}},t.prototype.setNodePosition=function(e,r){var n=this.option.data||this.option.nodes,o=n[e];o.localX=r[0],o.localY=r[1]},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,r,n){function o(w){return isNaN(w)||w==null}if(n==="edge"){var s=this.getDataParams(e,n),a=s.data,u=s.value,f=a.source+" -- "+a.target;return xo("nameValue",{name:f,value:u,noValue:o(u)})}else{var g=this.getGraph().getNodeByIndex(e),v=g.getLayout().value,y=this.getDataParams(e,n).data.name;return xo("nameValue",{name:y!=null?y+"":null,value:v,noValue:o(v)})}},t.prototype.optionUpdated=function(){},t.prototype.getDataParams=function(e,r){var n=i.prototype.getDataParams.call(this,e,r);if(n.value==null&&r==="node"){var o=this.getGraph().getNodeByIndex(e),s=o.getLayout().value;n.value=s}return n},t.type="series.sankey",t.layoutMode="box",t.defaultOption={z:2,coordinateSystemUsage:"box",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,roam:!1,roamTrigger:"global",center:null,zoom:1,label:{show:!0,position:"right",fontSize:12},edgeLabel:{show:!1,fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:_e.color.neutral50,opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:_e.color.primary}},animationEasing:"linear",animationDuration:1e3},t}(Ea);const LPt=PPt;function RPt(i,t){i.eachSeriesByType("sankey",function(e){var r=e.get("nodeWidth"),n=e.get("nodeGap"),o=Bo(e,t).refContainer,s=Ca(e.getBoxLayoutParams(),o);e.layoutInfo=s;var a=s.width,u=s.height,f=e.getGraph(),g=f.nodes,v=f.edges;OPt(g);var y=Rn(g,function(D){return D.getLayout().value===0}),w=y.length!==0?0:e.get("layoutIterations"),I=e.get("orient"),E=e.get("nodeAlign");kPt(g,v,r,n,a,u,w,I,E)})}function kPt(i,t,e,r,n,o,s,a,u){zPt(i,t,e,n,o,a,u),VPt(i,t,o,n,r,s,a),XPt(i,a)}function OPt(i){gt(i,function(t){var e=Ap(t.outEdges,dC),r=Ap(t.inEdges,dC),n=t.getValue()||0,o=Math.max(e,r,n);t.setLayout({value:o},!0)})}function zPt(i,t,e,r,n,o,s){for(var a=[],u=[],f=[],g=[],v=0,y=0;y<t.length;y++)a[y]=1;for(var y=0;y<i.length;y++)u[y]=i[y].inEdges.length,u[y]===0&&f.push(i[y]);for(var w=-1;f.length;){for(var I=0;I<f.length;I++){var E=f[I],D=E.hostGraph.data.getRawDataItem(E.dataIndex),R=D.depth!=null&&D.depth>=0;R&&D.depth>w&&(w=D.depth),E.setLayout({depth:R?D.depth:v},!0),o==="vertical"?E.setLayout({dy:e},!0):E.setLayout({dx:e},!0);for(var z=0;z<E.outEdges.length;z++){var N=E.outEdges[z],H=t.indexOf(N);a[H]=0;var $=N.node2,X=i.indexOf($);--u[X]===0&&g.indexOf($)<0&&g.push($)}}++v,f=g,g=[]}for(var y=0;y<a.length;y++)if(a[y]===1)throw new Error("Sankey is a DAG, the original data has cycle!");var K=w>v-1?w:v-1;s&&s!=="left"&&BPt(i,s,o,K);var et=o==="vertical"?(n-e)/K:(r-e)/K;NPt(i,et,o)}function Iit(i){var t=i.hostGraph.data.getRawDataItem(i.dataIndex);return t.depth!=null&&t.depth>=0}function BPt(i,t,e,r){if(t==="right"){for(var n=[],o=i,s=0;o.length;){for(var a=0;a<o.length;a++){var u=o[a];u.setLayout({skNodeHeight:s},!0);for(var f=0;f<u.inEdges.length;f++){var g=u.inEdges[f];n.indexOf(g.node1)<0&&n.push(g.node1)}}o=n,n=[],++s}gt(i,function(v){Iit(v)||v.setLayout({depth:Math.max(0,r-v.getLayout().skNodeHeight)},!0)})}else t==="justify"&&FPt(i,r)}function FPt(i,t){gt(i,function(e){!Iit(e)&&!e.outEdges.length&&e.setLayout({depth:t},!0)})}function NPt(i,t,e){gt(i,function(r){var n=r.getLayout().depth*t;e==="vertical"?r.setLayout({y:n},!0):r.setLayout({x:n},!0)})}function VPt(i,t,e,r,n,o,s){var a=UPt(i,s);GPt(a,t,e,r,n,s),nk(a,n,e,r,s);for(var u=1;o>0;o--)u*=.99,HPt(a,u,s),nk(a,n,e,r,s),qPt(a,u,s),nk(a,n,e,r,s)}function UPt(i,t){var e=[],r=t==="vertical"?"y":"x",n=$O(i,function(o){return o.getLayout()[r]});return n.keys.sort(function(o,s){return o-s}),gt(n.keys,function(o){e.push(n.buckets.get(o))}),e}function GPt(i,t,e,r,n,o){var s=1/0;gt(i,function(a){var u=a.length,f=0;gt(a,function(v){f+=v.getLayout().value});var g=o==="vertical"?(r-(u-1)*n)/f:(e-(u-1)*n)/f;g<s&&(s=g)}),gt(i,function(a){gt(a,function(u,f){var g=u.getLayout().value*s;o==="vertical"?(u.setLayout({x:f},!0),u.setLayout({dx:g},!0)):(u.setLayout({y:f},!0),u.setLayout({dy:g},!0))})}),gt(t,function(a){var u=+a.getValue()*s;a.setLayout({dy:u},!0)})}function nk(i,t,e,r,n){var o=n==="vertical"?"x":"y";gt(i,function(s){s.sort(function(E,D){return E.getLayout()[o]-D.getLayout()[o]});for(var a,u,f,g=0,v=s.length,y=n==="vertical"?"dx":"dy",w=0;w<v;w++)u=s[w],f=g-u.getLayout()[o],f>0&&(a=u.getLayout()[o]+f,n==="vertical"?u.setLayout({x:a},!0):u.setLayout({y:a},!0)),g=u.getLayout()[o]+u.getLayout()[y]+t;var I=n==="vertical"?r:e;if(f=g-t-I,f>0){a=u.getLayout()[o]-f,n==="vertical"?u.setLayout({x:a},!0):u.setLayout({y:a},!0),g=a;for(var w=v-2;w>=0;--w)u=s[w],f=u.getLayout()[o]+u.getLayout()[y]+t-g,f>0&&(a=u.getLayout()[o]-f,n==="vertical"?u.setLayout({x:a},!0):u.setLayout({y:a},!0)),g=u.getLayout()[o]}})}function HPt(i,t,e){gt(i.slice().reverse(),function(r){gt(r,function(n){if(n.outEdges.length){var o=Ap(n.outEdges,jPt,e)/Ap(n.outEdges,dC);if(isNaN(o)){var s=n.outEdges.length;o=s?Ap(n.outEdges,WPt,e)/s:0}if(e==="vertical"){var a=n.getLayout().x+(o-zp(n,e))*t;n.setLayout({x:a},!0)}else{var u=n.getLayout().y+(o-zp(n,e))*t;n.setLayout({y:u},!0)}}})})}function jPt(i,t){return zp(i.node2,t)*i.getValue()}function WPt(i,t){return zp(i.node2,t)}function $Pt(i,t){return zp(i.node1,t)*i.getValue()}function ZPt(i,t){return zp(i.node1,t)}function zp(i,t){return t==="vertical"?i.getLayout().x+i.getLayout().dx/2:i.getLayout().y+i.getLayout().dy/2}function dC(i){return i.getValue()}function Ap(i,t,e){for(var r=0,n=i.length,o=-1;++o<n;){var s=+t(i[o],e);isNaN(s)||(r+=s)}return r}function qPt(i,t,e){gt(i,function(r){gt(r,function(n){if(n.inEdges.length){var o=Ap(n.inEdges,$Pt,e)/Ap(n.inEdges,dC);if(isNaN(o)){var s=n.inEdges.length;o=s?Ap(n.inEdges,ZPt,e)/s:0}if(e==="vertical"){var a=n.getLayout().x+(o-zp(n,e))*t;n.setLayout({x:a},!0)}else{var u=n.getLayout().y+(o-zp(n,e))*t;n.setLayout({y:u},!0)}}})})}function XPt(i,t){var e=t==="vertical"?"x":"y";gt(i,function(r){r.outEdges.sort(function(n,o){return n.node2.getLayout()[e]-o.node2.getLayout()[e]}),r.inEdges.sort(function(n,o){return n.node1.getLayout()[e]-o.node1.getLayout()[e]})}),gt(i,function(r){var n=0,o=0;gt(r.outEdges,function(s){s.setLayout({sy:n},!0),n+=s.getLayout().dy}),gt(r.inEdges,function(s){s.setLayout({ty:o},!0),o+=s.getLayout().dy})})}function YPt(i){i.eachSeriesByType("sankey",function(t){var e=t.getGraph(),r=e.nodes,n=e.edges;if(r.length){var o=1/0,s=-1/0;gt(r,function(a){var u=a.getLayout().value;u<o&&(o=u),u>s&&(s=u)}),gt(r,function(a){var u=new _s({type:"color",mappingMethod:"linear",dataExtent:[o,s],visual:t.get("color")}),f=u.mapValueToVisual(a.getLayout().value),g=a.getModel().get(["itemStyle","color"]);g!=null?(a.setVisual("color",g),a.setVisual("style",{fill:g})):(a.setVisual("color",f),a.setVisual("style",{fill:f}))})}n.length&&gt(n,function(a){var u=a.getModel().get("lineStyle");a.setVisual("style",u)})})}function KPt(i){i.registerChartView(DPt),i.registerSeriesModel(LPt),i.registerLayout(RPt),i.registerVisual(YPt),i.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(r){r.setNodePosition(t.dataIndex,[t.localX,t.localY])})}),i.registerAction({type:"sankeyRoam",event:"sankeyRoam",update:"none"},function(t,e,r){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(n){var o=n.coordinateSystem,s=CE(o,t,n.get("scaleLimit"));n.setCenter(s.center),n.setZoom(s.zoom)})})}var Mit=function(){function i(){}return i.prototype._hasEncodeRule=function(t){var e=this.getEncode();return e&&e.get(t)!=null},i.prototype.getInitialData=function(t,e){var r,n=e.getComponent("xAxis",this.get("xAxisIndex")),o=e.getComponent("yAxis",this.get("yAxisIndex")),s=n.get("type"),a=o.get("type"),u;s==="category"?(t.layout="horizontal",r=n.getOrdinalMeta(),u=!this._hasEncodeRule("x")):a==="category"?(t.layout="vertical",r=o.getOrdinalMeta(),u=!this._hasEncodeRule("y")):t.layout=t.layout||"horizontal";var f=["x","y"],g=t.layout==="horizontal"?0:1,v=this._baseAxisDim=f[g],y=f[1-g],w=[n,o],I=w[g].get("type"),E=w[1-g].get("type"),D=t.data;if(D&&u){var R=[];gt(D,function(H,$){var X;Ye(H)?(X=H.slice(),H.unshift($)):Ye(H.value)?(X=Fe({},H),X.value=X.value.slice(),H.value.unshift($)):X=H,R.push(X)}),t.data=R}var z=this.defaultValueDimensions,N=[{name:v,type:qM(I),ordinalMeta:r,otherDims:{tooltip:!1,itemName:0},dimsDef:["base"]},{name:y,type:qM(E),dimsDef:z.slice()}];return Y0(this,{coordDimensions:N,dimensionsCount:z.length+1,encodeDefaulter:br(PJ,N,this)})},i.prototype.getBaseAxis=function(){var t=this._baseAxisDim;return this.ecModel.getComponent(t+"Axis",this.get(t+"AxisIndex")).axis},i}(),Cit=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"min",defaultTooltip:!0},{name:"Q1",defaultTooltip:!0},{name:"median",defaultTooltip:!0},{name:"Q3",defaultTooltip:!0},{name:"max",defaultTooltip:!0}],e.visualDrawType="stroke",e}return t.type="series.boxplot",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,boxWidth:[7,50],itemStyle:{color:_e.color.neutral00,borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2,shadowBlur:5,shadowOffsetX:1,shadowOffsetY:1,shadowColor:_e.color.shadow}},animationDuration:800},t}(Ea);wo(Cit,Mit,!0);const JPt=Cit;var QPt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this.group,a=this._data;this._data||s.removeAll();var u=e.get("layout")==="horizontal"?1:0;o.diff(a).add(function(f){if(o.hasValue(f)){var g=o.getItemLayout(f),v=Q$(g,o,f,u,!0);o.setItemGraphicEl(f,v),s.add(v)}}).update(function(f,g){var v=a.getItemGraphicEl(g);if(!o.hasValue(f)){s.remove(v);return}var y=o.getItemLayout(f);v?(Oc(v),Eit(y,v,o,f)):v=Q$(y,o,f,u),s.add(v),o.setItemGraphicEl(f,v)}).remove(function(f){var g=a.getItemGraphicEl(f);g&&s.remove(g)}).execute(),this._data=o},t.prototype.remove=function(e){var r=this.group,n=this._data;this._data=null,n&&n.eachItemGraphicEl(function(o){o&&r.remove(o)})},t.type="boxplot",t}(pa),tLt=function(){function i(){}return i}(),eLt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="boxplotBoxPath",r}return t.prototype.getDefaultShape=function(){return new tLt},t.prototype.buildPath=function(e,r){var n=r.points,o=0;for(e.moveTo(n[o][0],n[o][1]),o++;o<4;o++)e.lineTo(n[o][0],n[o][1]);for(e.closePath();o<n.length;o++)e.moveTo(n[o][0],n[o][1]),o++,e.lineTo(n[o][0],n[o][1])},t}(qr);function Q$(i,t,e,r,n){var o=i.ends,s=new eLt({shape:{points:n?iLt(o,r,i):o}});return Eit(i,s,t,e,n),s}function Eit(i,t,e,r,n){var o=e.hostModel,s=Tv[n?"initProps":"updateProps"];s(t,{shape:{points:i.ends}},o,r),t.useStyle(e.getItemVisual(r,"style")),t.style.strokeNoScale=!0,t.z2=100;var a=e.getItemModel(r),u=a.getModel("emphasis");Oo(t,a),Ma(t,u.get("focus"),u.get("blurScope"),u.get("disabled"))}function iLt(i,t,e){return ti(i,function(r){return r=r.slice(),r[t]=e.initBaseline,r})}const rLt=QPt;var Lw=gt;function nLt(i){var t=aLt(i);Lw(t,function(e){var r=e.seriesModels;r.length&&(oLt(e),Lw(r,function(n,o){sLt(n,e.boxOffsetList[o],e.boxWidthList[o])}))})}function aLt(i){var t=[],e=[];return i.eachSeriesByType("boxplot",function(r){var n=r.getBaseAxis(),o=Ar(e,n);o<0&&(o=e.length,e[o]=n,t[o]={axis:n,seriesModels:[]}),t[o].seriesModels.push(r)}),t}function oLt(i){var t=i.axis,e=i.seriesModels,r=e.length,n=i.boxWidthList=[],o=i.boxOffsetList=[],s=[],a;if(t.type==="category")a=t.getBandWidth();else{var u=0;Lw(e,function(I){u=Math.max(u,I.getData().count())});var f=t.getExtent();a=Math.abs(f[1]-f[0])/u}Lw(e,function(I){var E=I.get("boxWidth");Ye(E)||(E=[E,E]),s.push([xi(E[0],a)||0,xi(E[1],a)||0])});var g=a*.8-2,v=g/r*.3,y=(g-v*(r-1))/r,w=y/2-g/2;Lw(e,function(I,E){o.push(w),w+=v+y,n.push(Math.min(Math.max(y,s[E][0]),s[E][1]))})}function sLt(i,t,e){var r=i.coordinateSystem,n=i.getData(),o=e/2,s=i.get("layout")==="horizontal"?0:1,a=1-s,u=["x","y"],f=n.mapDimension(u[s]),g=n.mapDimensionsAll(u[a]);if(f==null||g.length<5)return;for(var v=0;v<n.count();v++){var y=n.get(f,v),w=N(y,g[2],v),I=N(y,g[0],v),E=N(y,g[1],v),D=N(y,g[3],v),R=N(y,g[4],v),z=[];H(z,E,!1),H(z,D,!0),z.push(I,E,R,D),$(z,I),$(z,R),$(z,w),n.setItemLayout(v,{initBaseline:w[a],ends:z})}function N(X,K,et){var rt=n.get(K,et),lt=[];lt[s]=X,lt[a]=rt;var ht;return isNaN(X)||isNaN(rt)?ht=[NaN,NaN]:(ht=r.dataToPoint(lt),ht[s]+=t),ht}function H(X,K,et){var rt=K.slice(),lt=K.slice();rt[s]+=o,lt[s]-=o,et?X.push(rt,lt):X.push(lt,rt)}function $(X,K){var et=K.slice(),rt=K.slice();et[s]-=o,rt[s]+=o,X.push(et,rt)}}function lLt(i,t){t=t||{};for(var e=[],r=[],n=t.boundIQR,o=n==="none"||n===0,s=0;s<i.length;s++){var a=Dc(i[s].slice()),u=kL(a,.25),f=kL(a,.5),g=kL(a,.75),v=a[0],y=a[a.length-1],w=(n??1.5)*(g-u),I=o?v:Math.max(v,u-w),E=o?y:Math.min(y,g+w),D=t.itemNameFormatter,R=Xi(D)?D({value:s}):bi(D)?D.replace("{value}",s+""):s+"";e.push([R,I,u,f,g,E]);for(var z=0;z<a.length;z++){var N=a[z];if(N<I||N>E){var H=[R,N];r.push(H)}}}return{boxData:e,outliers:r}}var cLt={type:"echarts:boxplot",transform:function(t){var e=t.upstream;if(e.sourceFormat!==os){var r="";Dn(r)}var n=lLt(e.getRawData(),t.config);return[{dimensions:["ItemName","Low","Q1","Q2","Q3","High"],data:n.boxData},{data:n.outliers}]}};function uLt(i){i.registerSeriesModel(JPt),i.registerChartView(rLt),i.registerLayout(nLt),i.registerTransform(cLt)}var hLt=["itemStyle","borderColor"],dLt=["itemStyle","borderColor0"],fLt=["itemStyle","borderColorDoji"],pLt=["itemStyle","color"],gLt=["itemStyle","color0"];function aN(i,t){return t.get(i>0?pLt:gLt)}function oN(i,t){return t.get(i===0?fLt:i>0?hLt:dLt)}var mLt={seriesType:"candlestick",plan:W0(),performRawSeries:!0,reset:function(i,t){if(!t.isSeriesFiltered(i)){var e=i.pipelineContext.large;return!e&&{progress:function(r,n){for(var o;(o=r.next())!=null;){var s=n.getItemModel(o),a=n.getItemLayout(o).sign,u=s.getItemStyle();u.fill=aN(a,s),u.stroke=oN(a,s)||u.fill;var f=n.ensureUniqueItemVisual(o,"style");Fe(f,u)}}}}}};const vLt=mLt;var _Lt=["color","borderColor"],yLt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){this.group.removeClipPath(),this._progressiveEls=null,this._updateDrawMode(e),this._isLargeDraw?this._renderLarge(e):this._renderNormal(e)},t.prototype.incrementalPrepareRender=function(e,r,n){this._clear(),this._updateDrawMode(e)},t.prototype.incrementalRender=function(e,r,n,o){this._progressiveEls=[],this._isLargeDraw?this._incrementalRenderLarge(e,r):this._incrementalRenderNormal(e,r)},t.prototype.eachRendered=function(e){Hp(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var r=e.pipelineContext.large;(this._isLargeDraw==null||r!==this._isLargeDraw)&&(this._isLargeDraw=r,this._clear())},t.prototype._renderNormal=function(e){var r=e.getData(),n=this._data,o=this.group,s=r.getLayout("isSimpleBox"),a=e.get("clip",!0),u=e.coordinateSystem,f=u.getArea&&u.getArea();this._data||o.removeAll(),r.diff(n).add(function(g){if(r.hasValue(g)){var v=r.getItemLayout(g);if(a&&tZ(f,v))return;var y=ak(v,g,!0);ya(y,{shape:{points:v.ends}},e,g),ok(y,r,g,s),o.add(y),r.setItemGraphicEl(g,y)}}).update(function(g,v){var y=n.getItemGraphicEl(v);if(!r.hasValue(g)){o.remove(y);return}var w=r.getItemLayout(g);if(a&&tZ(f,w)){o.remove(y);return}y?(yn(y,{shape:{points:w.ends}},e,g),Oc(y)):y=ak(w),ok(y,r,g,s),o.add(y),r.setItemGraphicEl(g,y)}).remove(function(g){var v=n.getItemGraphicEl(g);v&&o.remove(v)}).execute(),this._data=r},t.prototype._renderLarge=function(e){this._clear(),eZ(e,this.group);var r=e.get("clip",!0)?$S(e.coordinateSystem,!1,e):null;r?this.group.setClipPath(r):this.group.removeClipPath()},t.prototype._incrementalRenderNormal=function(e,r){for(var n=r.getData(),o=n.getLayout("isSimpleBox"),s;(s=e.next())!=null;){var a=n.getItemLayout(s),u=ak(a);ok(u,n,s,o),u.incremental=!0,this.group.add(u),this._progressiveEls.push(u)}},t.prototype._incrementalRenderLarge=function(e,r){eZ(r,this.group,this._progressiveEls,!0)},t.prototype.remove=function(e){this._clear()},t.prototype._clear=function(){this.group.removeAll(),this._data=null},t.type="candlestick",t}(pa),xLt=function(){function i(){}return i}(),bLt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="normalCandlestickBox",r}return t.prototype.getDefaultShape=function(){return new xLt},t.prototype.buildPath=function(e,r){var n=r.points;this.__simpleBox?(e.moveTo(n[4][0],n[4][1]),e.lineTo(n[6][0],n[6][1])):(e.moveTo(n[0][0],n[0][1]),e.lineTo(n[1][0],n[1][1]),e.lineTo(n[2][0],n[2][1]),e.lineTo(n[3][0],n[3][1]),e.closePath(),e.moveTo(n[4][0],n[4][1]),e.lineTo(n[5][0],n[5][1]),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[7][0],n[7][1]))},t}(qr);function ak(i,t,e){var r=i.ends;return new bLt({shape:{points:e?wLt(r,i):r},z2:100})}function tZ(i,t){for(var e=!0,r=0;r<t.ends.length;r++)if(i.contain(t.ends[r][0],t.ends[r][1])){e=!1;break}return e}function ok(i,t,e,r){var n=t.getItemModel(e);i.useStyle(t.getItemVisual(e,"style")),i.style.strokeNoScale=!0,i.__simpleBox=r,Oo(i,n);var o=t.getItemLayout(e).sign;gt(i.states,function(a,u){var f=n.getModel(u),g=aN(o,f),v=oN(o,f)||g,y=a.style||(a.style={});g&&(y.fill=g),v&&(y.stroke=v)});var s=n.getModel("emphasis");Ma(i,s.get("focus"),s.get("blurScope"),s.get("disabled"))}function wLt(i,t){return ti(i,function(e){return e=e.slice(),e[1]=t.initBaseline,e})}var SLt=function(){function i(){}return i}(),sk=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r.type="largeCandlestickBox",r}return t.prototype.getDefaultShape=function(){return new SLt},t.prototype.buildPath=function(e,r){for(var n=r.points,o=0;o<n.length;)if(this.__sign===n[o++]){var s=n[o++];e.moveTo(s,n[o++]),e.lineTo(s,n[o++])}else o+=3},t}(qr);function eZ(i,t,e,r){var n=i.getData(),o=n.getLayout("largePoints"),s=new sk({shape:{points:o},__sign:1,ignoreCoarsePointer:!0});t.add(s);var a=new sk({shape:{points:o},__sign:-1,ignoreCoarsePointer:!0});t.add(a);var u=new sk({shape:{points:o},__sign:0,ignoreCoarsePointer:!0});t.add(u),lk(1,s,i),lk(-1,a,i),lk(0,u,i),r&&(s.incremental=!0,a.incremental=!0),e&&e.push(s,a)}function lk(i,t,e,r){var n=oN(i,e)||aN(i,e),o=e.getModel("itemStyle").getItemStyle(_Lt);t.useStyle(o),t.style.fill=null,t.style.stroke=n}const TLt=yLt;var Dit=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],e}return t.prototype.getShadowDim=function(){return"open"},t.prototype.brushSelector=function(e,r,n){var o=r.getItemLayout(e);return o&&n.rect(o.brushRect)},t.type="series.candlestick",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderColorDoji:null,borderWidth:1},emphasis:{itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},t}(Ea);wo(Dit,Mit,!0);const ALt=Dit;function ILt(i){!i||!Ye(i.series)||gt(i.series,function(t){nr(t)&&t.type==="k"&&(t.type="candlestick")})}var MLt={seriesType:"candlestick",plan:W0(),reset:function(i){var t=i.coordinateSystem,e=i.getData(),r=CLt(i,e),n=0,o=1,s=["x","y"],a=e.getDimensionIndex(e.mapDimension(s[n])),u=ti(e.mapDimensionsAll(s[o]),e.getDimensionIndex,e),f=u[0],g=u[1],v=u[2],y=u[3];if(e.setLayout({candleWidth:r,isSimpleBox:r<=1.3}),a<0||u.length<4)return;return{progress:i.pipelineContext.large?I:w};function w(E,D){for(var R,z=D.getStore();(R=E.next())!=null;){var N=z.get(a,R),H=z.get(f,R),$=z.get(g,R),X=z.get(v,R),K=z.get(y,R),et=Math.min(H,$),rt=Math.max(H,$),lt=Gt(et,N),ht=Gt(rt,N),yt=Gt(X,N),ft=Gt(K,N),kt=[];Vt(kt,ht,0),Vt(kt,lt,1),kt.push(fe(ft),fe(ht),fe(yt),fe(lt));var Rt=D.getItemModel(R),Ct=!!Rt.get(["itemStyle","borderColorDoji"]);D.setItemLayout(R,{sign:iZ(z,R,H,$,g,Ct),initBaseline:H>$?ht[o]:lt[o],ends:kt,brushRect:Qt(X,K,N)})}function Gt(Te,be){var Ge=[];return Ge[n]=be,Ge[o]=Te,isNaN(be)||isNaN(Te)?[NaN,NaN]:t.dataToPoint(Ge)}function Vt(Te,be,Ge){var li=be.slice(),Pi=be.slice();li[n]=$I(li[n]+r/2,1,!1),Pi[n]=$I(Pi[n]-r/2,1,!0),Ge?Te.push(li,Pi):Te.push(Pi,li)}function Qt(Te,be,Ge){var li=Gt(Te,Ge),Pi=Gt(be,Ge);return li[n]-=r/2,Pi[n]-=r/2,{x:li[0],y:li[1],width:r,height:Pi[1]-li[1]}}function fe(Te){return Te[n]=$I(Te[n],1),Te}}function I(E,D){for(var R=ch(E.count*4),z=0,N,H=[],$=[],X,K=D.getStore(),et=!!i.get(["itemStyle","borderColorDoji"]);(X=E.next())!=null;){var rt=K.get(a,X),lt=K.get(f,X),ht=K.get(g,X),yt=K.get(v,X),ft=K.get(y,X);if(isNaN(rt)||isNaN(yt)||isNaN(ft)){R[z++]=NaN,z+=3;continue}R[z++]=iZ(K,X,lt,ht,g,et),H[n]=rt,H[o]=yt,N=t.dataToPoint(H,null,$),R[z++]=N?N[0]:NaN,R[z++]=N?N[1]:NaN,H[o]=ft,N=t.dataToPoint(H,null,$),R[z++]=N?N[1]:NaN}D.setLayout("largePoints",R)}}};function iZ(i,t,e,r,n,o){var s;return e>r?s=-1:e<r?s=1:s=o?0:t>0?i.get(n,t-1)<=r?1:-1:1,s}function CLt(i,t){var e=i.getBaseAxis(),r,n=e.type==="category"?e.getBandWidth():(r=e.getExtent(),Math.abs(r[1]-r[0])/t.count()),o=xi(Ui(i.get("barMaxWidth"),n),n),s=xi(Ui(i.get("barMinWidth"),1),n),a=i.get("barWidth");return a!=null?xi(a,n):Math.max(Math.min(n/2,o),s)}const ELt=MLt;function DLt(i){i.registerChartView(TLt),i.registerSeriesModel(ALt),i.registerPreprocessor(ILt),i.registerVisual(vLt),i.registerLayout(ELt)}function rZ(i,t){var e=t.rippleEffectColor||t.color;i.eachChild(function(r){r.attr({z:t.z,zlevel:t.zlevel,style:{stroke:t.brushType==="stroke"?e:null,fill:t.brushType==="fill"?e:null}})})}var PLt=function(i){we(t,i);function t(e,r){var n=i.call(this)||this,o=new jS(e,r),s=new Ki;return n.add(o),n.add(s),n.updateData(e,r),n}return t.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},t.prototype.startEffectAnimation=function(e){for(var r=e.symbolType,n=e.color,o=e.rippleNumber,s=this.childAt(1),a=0;a<o;a++){var u=bo(r,-1,-1,2,2,n);u.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var f=-a/o*e.period+e.effectOffset;u.animate("",!0).when(e.period,{scaleX:e.rippleScale/2,scaleY:e.rippleScale/2}).delay(f).start(),u.animateStyle(!0).when(e.period,{opacity:0}).delay(f).start(),s.add(u)}rZ(s,e)},t.prototype.updateEffectAnimation=function(e){for(var r=this._effectCfg,n=this.childAt(1),o=["symbolType","period","rippleScale","rippleNumber"],s=0;s<o.length;s++){var a=o[s];if(r[a]!==e[a]){this.stopEffectAnimation(),this.startEffectAnimation(e);return}}rZ(n,e)},t.prototype.highlight=function(){Rd(this)},t.prototype.downplay=function(){kd(this)},t.prototype.getSymbolType=function(){var e=this.childAt(0);return e&&e.getSymbolType()},t.prototype.updateData=function(e,r){var n=this,o=e.hostModel;this.childAt(0).updateData(e,r);var s=this.childAt(1),a=e.getItemModel(r),u=e.getItemVisual(r,"symbol"),f=Z0(e.getItemVisual(r,"symbolSize")),g=e.getItemVisual(r,"style"),v=g&&g.fill,y=a.getModel("emphasis");s.setScale(f),s.traverse(function(D){D.setStyle("fill",v)});var w=Cv(e.getItemVisual(r,"symbolOffset"),f);w&&(s.x=w[0],s.y=w[1]);var I=e.getItemVisual(r,"symbolRotate");s.rotation=(I||0)*Math.PI/180||0;var E={};E.showEffectOn=o.get("showEffectOn"),E.rippleScale=a.get(["rippleEffect","scale"]),E.brushType=a.get(["rippleEffect","brushType"]),E.period=a.get(["rippleEffect","period"])*1e3,E.effectOffset=r/e.count(),E.z=o.getShallow("z")||0,E.zlevel=o.getShallow("zlevel")||0,E.symbolType=u,E.color=v,E.rippleEffectColor=a.get(["rippleEffect","color"]),E.rippleNumber=a.get(["rippleEffect","number"]),E.showEffectOn==="render"?(this._effectCfg?this.updateEffectAnimation(E):this.startEffectAnimation(E),this._effectCfg=E):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(D){D==="emphasis"?E.showEffectOn!=="render"&&n.startEffectAnimation(E):D==="normal"&&E.showEffectOn!=="render"&&n.stopEffectAnimation()}),this._effectCfg=E,Ma(this,y.get("focus"),y.get("blurScope"),y.get("disabled"))},t.prototype.fadeOut=function(e){e&&e()},t}(Ki);const LLt=PLt;var RLt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this._symbolDraw=new WS(LLt)},t.prototype.render=function(e,r,n){var o=e.getData(),s=this._symbolDraw;s.updateData(o,{clipShape:this._getClipShape(e)}),this.group.add(s.group)},t.prototype._getClipShape=function(e){var r=e.coordinateSystem,n=r&&r.getArea&&r.getArea();return e.get("clip",!0)?n:null},t.prototype.updateTransform=function(e,r,n){var o=e.getData();this.group.dirty();var s=ZS("").reset(e,r,n);s.progress&&s.progress({start:0,end:o.count(),count:o.count()},o),this._symbolDraw.updateLayout()},t.prototype._updateGroupTransform=function(e){var r=e.coordinateSystem;r&&r.getRoamTransform&&(this.group.transform=o_t(r.getRoamTransform()),this.group.decomposeTransform())},t.prototype.remove=function(e,r){this._symbolDraw&&this._symbolDraw.remove(!0)},t.type="effectScatter",t}(pa);const kLt=RLt;var OLt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e,r){return Hd(null,this,{useEncodeDefaulter:!0})},t.prototype.brushSelector=function(e,r,n){return n.point(r.getItemLayout(e))},t.type="series.effectScatter",t.dependencies=["grid","polar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill",number:3},universalTransition:{divideShape:"clone"},symbolSize:10},t}(Ea);const zLt=OLt;function BLt(i){i.registerChartView(kLt),i.registerSeriesModel(zLt),i.registerLayout(ZS("effectScatter"))}var FLt=function(i){we(t,i);function t(e,r,n){var o=i.call(this)||this;return o.add(o.createLine(e,r,n)),o._updateEffectSymbol(e,r),o}return t.prototype.createLine=function(e,r,n){return new X3(e,r,n)},t.prototype._updateEffectSymbol=function(e,r){var n=e.getItemModel(r),o=n.getModel("effect"),s=o.get("symbolSize"),a=o.get("symbol");Ye(s)||(s=[s,s]);var u=e.getItemVisual(r,"style"),f=o.get("color")||u&&u.stroke,g=this.childAt(1);this._symbolType!==a&&(this.remove(g),g=bo(a,-.5,-.5,1,1,f),g.z2=100,g.culling=!0,this.add(g)),g&&(g.setStyle("shadowColor",f),g.setStyle(o.getItemStyle(["color"])),g.scaleX=s[0],g.scaleY=s[1],g.setColor(f),this._symbolType=a,this._symbolScale=s,this._updateEffectAnimation(e,o,r))},t.prototype._updateEffectAnimation=function(e,r,n){var o=this.childAt(1);if(o){var s=e.getItemLayout(n),a=r.get("period")*1e3,u=r.get("loop"),f=r.get("roundTrip"),g=r.get("constantSpeed"),v=vs(r.get("delay"),function(w){return w/e.count()*a/3});if(o.ignore=!0,this._updateAnimationPoints(o,s),g>0&&(a=this._getLineLength(o)/g*1e3),a!==this._period||u!==this._loop||f!==this._roundTrip){o.stopAnimation();var y=void 0;Xi(v)?y=v(n):y=v,o.__t>0&&(y=-a*o.__t),this._animateSymbol(o,a,y,u,f)}this._period=a,this._loop=u,this._roundTrip=f}},t.prototype._animateSymbol=function(e,r,n,o,s){if(r>0){e.__t=0;var a=this,u=e.animate("",o).when(s?r*2:r,{__t:s?2:1}).delay(n).during(function(){a._updateSymbolPosition(e)});o||u.done(function(){a.remove(e)}),u.start()}},t.prototype._getLineLength=function(e){return lp(e.__p1,e.__cp1)+lp(e.__cp1,e.__p2)},t.prototype._updateAnimationPoints=function(e,r){e.__p1=r[0],e.__p2=r[1],e.__cp1=r[2]||[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2]},t.prototype.updateData=function(e,r,n){this.childAt(0).updateData(e,r,n),this._updateEffectSymbol(e,r)},t.prototype._updateSymbolPosition=function(e){var r=e.__p1,n=e.__p2,o=e.__cp1,s=e.__t<1?e.__t:2-e.__t,a=[e.x,e.y],u=a.slice(),f=is,g=PO;a[0]=f(r[0],o[0],n[0],s),a[1]=f(r[1],o[1],n[1],s);var v=e.__t<1?g(r[0],o[0],n[0],s):g(n[0],o[0],r[0],1-s),y=e.__t<1?g(r[1],o[1],n[1],s):g(n[1],o[1],r[1],1-s);e.rotation=-Math.atan2(y,v)-Math.PI/2,(this._symbolType==="line"||this._symbolType==="rect"||this._symbolType==="roundRect")&&(e.__lastT!==void 0&&e.__lastT<e.__t?(e.scaleY=lp(u,a)*1.05,s===1&&(a[0]=u[0]+(a[0]-u[0])/2,a[1]=u[1]+(a[1]-u[1])/2)):e.__lastT===1?e.scaleY=2*lp(r,a):e.scaleY=this._symbolScale[1]),e.__lastT=e.__t,e.ignore=!1,e.x=a[0],e.y=a[1]},t.prototype.updateLayout=function(e,r){this.childAt(0).updateLayout(e,r);var n=e.getItemModel(r).getModel("effect");this._updateEffectAnimation(e,n,r)},t}(Ki);const Pit=FLt;var NLt=function(i){we(t,i);function t(e,r,n){var o=i.call(this)||this;return o._createPolyline(e,r,n),o}return t.prototype._createPolyline=function(e,r,n){var o=e.getItemLayout(r),s=new Us({shape:{points:o}});this.add(s),this._updateCommonStl(e,r,n)},t.prototype.updateData=function(e,r,n){var o=e.hostModel,s=this.childAt(0),a={shape:{points:e.getItemLayout(r)}};yn(s,a,o,r),this._updateCommonStl(e,r,n)},t.prototype._updateCommonStl=function(e,r,n){var o=this.childAt(0),s=e.getItemModel(r),a=n&&n.emphasisLineStyle,u=n&&n.focus,f=n&&n.blurScope,g=n&&n.emphasisDisabled;if(!n||e.hasItemOption){var v=s.getModel("emphasis");a=v.getModel("lineStyle").getLineStyle(),g=v.get("disabled"),u=v.get("focus"),f=v.get("blurScope")}o.useStyle(e.getItemVisual(r,"style")),o.style.fill=null,o.style.strokeNoScale=!0;var y=o.ensureState("emphasis");y.style=a,Ma(this,u,f,g)},t.prototype.updateLayout=function(e,r){var n=this.childAt(0);n.setShape("points",e.getItemLayout(r))},t}(Ki);const Lit=NLt;var VLt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._lastFrame=0,e._lastFramePercent=0,e}return t.prototype.createLine=function(e,r,n){return new Lit(e,r,n)},t.prototype._updateAnimationPoints=function(e,r){this._points=r;for(var n=[0],o=0,s=1;s<r.length;s++){var a=r[s-1],u=r[s];o+=lp(a,u),n.push(o)}if(o===0){this._length=0;return}for(var s=0;s<n.length;s++)n[s]/=o;this._offsets=n,this._length=o},t.prototype._getLineLength=function(){return this._length},t.prototype._updateSymbolPosition=function(e){var r=e.__t<1?e.__t:2-e.__t,n=this._points,o=this._offsets,s=n.length;if(o){var a=this._lastFrame,u;if(r<this._lastFramePercent){var f=Math.min(a+1,s-1);for(u=f;u>=0&&!(o[u]<=r);u--);u=Math.min(u,s-2)}else{for(u=a;u<s&&!(o[u]>r);u++);u=Math.min(u-1,s-2)}var g=(r-o[u])/(o[u+1]-o[u]),v=n[u],y=n[u+1];e.x=v[0]*(1-g)+g*y[0],e.y=v[1]*(1-g)+g*y[1];var w=e.__t<1?y[0]-v[0]:v[0]-y[0],I=e.__t<1?y[1]-v[1]:v[1]-y[1];e.rotation=-Math.atan2(I,w)-Math.PI/2,this._lastFrame=u,this._lastFramePercent=r,e.ignore=!1}},t}(Pit);const ULt=VLt;var GLt=function(){function i(){this.polyline=!1,this.curveness=0,this.segs=[]}return i}(),HLt=function(i){we(t,i);function t(e){var r=i.call(this,e)||this;return r._off=0,r.hoverDataIdx=-1,r}return t.prototype.reset=function(){this.notClear=!1,this._off=0},t.prototype.getDefaultStyle=function(){return{stroke:_e.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new GLt},t.prototype.buildPath=function(e,r){var n=r.segs,o=r.curveness,s;if(r.polyline)for(s=this._off;s<n.length;){var a=n[s++];if(a>0){e.moveTo(n[s++],n[s++]);for(var u=1;u<a;u++)e.lineTo(n[s++],n[s++])}}else for(s=this._off;s<n.length;){var f=n[s++],g=n[s++],v=n[s++],y=n[s++];if(e.moveTo(f,g),o>0){var w=(f+v)/2-(g-y)*o,I=(g+y)/2-(v-f)*o;e.quadraticCurveTo(w,I,v,y)}else e.lineTo(v,y)}this.incremental&&(this._off=s,this.notClear=!0)},t.prototype.findDataIndex=function(e,r){var n=this.shape,o=n.segs,s=n.curveness,a=this.style.lineWidth;if(n.polyline)for(var u=0,f=0;f<o.length;){var g=o[f++];if(g>0)for(var v=o[f++],y=o[f++],w=1;w<g;w++){var I=o[f++],E=o[f++];if(tp(v,y,I,E,a,e,r))return u}u++}else for(var u=0,f=0;f<o.length;){var v=o[f++],y=o[f++],I=o[f++],E=o[f++];if(s>0){var D=(v+I)/2-(y-E)*s,R=(y+E)/2-(I-v)*s;if(uK(v,y,D,R,I,E,a,e,r))return u}else if(tp(v,y,I,E,a,e,r))return u;u++}return-1},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();if(e=n[0],r=n[1],o.contain(e,r)){var s=this.hoverDataIdx=this.findDataIndex(e,r);return s>=0}return this.hoverDataIdx=-1,!1},t.prototype.getBoundingRect=function(){var e=this._rect;if(!e){for(var r=this.shape,n=r.segs,o=1/0,s=1/0,a=-1/0,u=-1/0,f=0;f<n.length;){var g=n[f++],v=n[f++];o=Math.min(g,o),a=Math.max(g,a),s=Math.min(v,s),u=Math.max(v,u)}e=this._rect=new sr(o,s,a,u)}return e},t}(qr),jLt=function(){function i(){this.group=new Ki}return i.prototype.updateData=function(t){this._clear();var e=this._create();e.setShape({segs:t.getLayout("linesPoints")}),this._setCommon(e,t)},i.prototype.incrementalPrepareUpdate=function(t){this.group.removeAll(),this._clear()},i.prototype.incrementalUpdate=function(t,e){var r=this._newAdded[0],n=e.getLayout("linesPoints"),o=r&&r.shape.segs;if(o&&o.length<2e4){var s=o.length,a=new Float32Array(s+n.length);a.set(o),a.set(n,s),r.setShape({segs:a})}else{this._newAdded=[];var u=this._create();u.incremental=!0,u.setShape({segs:n}),this._setCommon(u,e),u.__startIndex=t.start}},i.prototype.remove=function(){this._clear()},i.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},i.prototype._create=function(){var t=new HLt({cursor:"default",ignoreCoarsePointer:!0});return this._newAdded.push(t),this.group.add(t),t},i.prototype._setCommon=function(t,e,r){var n=e.hostModel;t.setShape({polyline:n.get("polyline"),curveness:n.get(["lineStyle","curveness"])}),t.useStyle(n.getModel("lineStyle").getLineStyle()),t.style.strokeNoScale=!0;var o=e.getVisual("style");o&&o.stroke&&t.setStyle("stroke",o.stroke),t.setStyle("fill",null);var s=ur(t);s.seriesIndex=n.seriesIndex,t.on("mousemove",function(a){s.dataIndex=null;var u=t.hoverDataIdx;u>0&&(s.dataIndex=u+t.__startIndex)})},i.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},i}();const WLt=jLt;var $Lt={seriesType:"lines",plan:W0(),reset:function(i){var t=i.coordinateSystem;if(t){var e=i.get("polyline"),r=i.pipelineContext.large;return{progress:function(n,o){var s=[];if(r){var a=void 0,u=n.end-n.start;if(e){for(var f=0,g=n.start;g<n.end;g++)f+=i.getLineCoordsCount(g);a=new Float32Array(u+f*2)}else a=new Float32Array(u*4);for(var v=0,y=[],g=n.start;g<n.end;g++){var w=i.getLineCoords(g,s);e&&(a[v++]=w);for(var I=0;I<w;I++)y=t.dataToPoint(s[I],!1,y),a[v++]=y[0],a[v++]=y[1]}o.setLayout("linesPoints",a)}else for(var g=n.start;g<n.end;g++){var E=o.getItemModel(g),w=i.getLineCoords(g,s),D=[];if(e)for(var R=0;R<w;R++)D.push(t.dataToPoint(s[R]));else{D[0]=t.dataToPoint(s[0]),D[1]=t.dataToPoint(s[1]);var z=E.get(["lineStyle","curveness"]);+z&&(D[2]=[(D[0][0]+D[1][0])/2-(D[0][1]-D[1][1])*z,(D[0][1]+D[1][1])/2-(D[1][0]-D[0][0])*z])}o.setItemLayout(g,D)}}}}}};const Rit=$Lt;var ZLt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this._updateLineDraw(o,e),a=e.get("zlevel"),u=e.get(["effect","trailLength"]),f=n.getZr(),g=f.painter.getType()==="svg";g||f.painter.getLayer(a).clear(!0),this._lastZlevel!=null&&!g&&f.configLayer(this._lastZlevel,{motionBlur:!1}),this._showEffect(e)&&u>0&&(g||f.configLayer(a,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(u/10+.9,1),0)})),s.updateData(o);var v=e.get("clip",!0)&&$S(e.coordinateSystem,!1,e);v?this.group.setClipPath(v):this.group.removeClipPath(),this._lastZlevel=a,this._finished=!0},t.prototype.incrementalPrepareRender=function(e,r,n){var o=e.getData(),s=this._updateLineDraw(o,e);s.incrementalPrepareUpdate(o),this._clearLayer(n),this._finished=!1},t.prototype.incrementalRender=function(e,r,n){this._lineDraw.incrementalUpdate(e,r.getData()),this._finished=e.end===r.getData().count()},t.prototype.eachRendered=function(e){this._lineDraw&&this._lineDraw.eachRendered(e)},t.prototype.updateTransform=function(e,r,n){var o=e.getData(),s=e.pipelineContext;if(!this._finished||s.large||s.progressiveRender)return{update:!0};var a=Rit.reset(e,r,n);a.progress&&a.progress({start:0,end:o.count(),count:o.count()},o),this._lineDraw.updateLayout(),this._clearLayer(n)},t.prototype._updateLineDraw=function(e,r){var n=this._lineDraw,o=this._showEffect(r),s=!!r.get("polyline"),a=r.pipelineContext,u=a.large;return(!n||o!==this._hasEffet||s!==this._isPolyline||u!==this._isLargeDraw)&&(n&&n.remove(),n=this._lineDraw=u?new WLt:new Y3(s?o?ULt:Lit:o?Pit:X3),this._hasEffet=o,this._isPolyline=s,this._isLargeDraw=u),this.group.add(n.group),n},t.prototype._showEffect=function(e){return!!e.get(["effect","show"])},t.prototype._clearLayer=function(e){var r=e.getZr(),n=r.painter.getType()==="svg";!n&&this._lastZlevel!=null&&r.painter.getLayer(this._lastZlevel).clear(!0)},t.prototype.remove=function(e,r){this._lineDraw&&this._lineDraw.remove(),this._lineDraw=null,this._clearLayer(r)},t.prototype.dispose=function(e,r){this.remove(e,r)},t.type="lines",t}(pa);const qLt=ZLt;var XLt=typeof Uint32Array>"u"?Array:Uint32Array,YLt=typeof Float64Array>"u"?Array:Float64Array;function nZ(i){var t=i.data;t&&t[0]&&t[0][0]&&t[0][0].coord&&(i.data=ti(t,function(e){var r=[e[0].coord,e[1].coord],n={coords:r};return e[0].name&&(n.fromName=e[0].name),e[1].name&&(n.toName=e[1].name),vF([n,e[0],e[1]])}))}var KLt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="lineStyle",e.visualDrawType="stroke",e}return t.prototype.init=function(e){e.data=e.data||[],nZ(e);var r=this._processFlatCoordsArray(e.data);this._flatCoords=r.flatCoords,this._flatCoordsOffset=r.flatCoordsOffset,r.flatCoords&&(e.data=new Float32Array(r.count)),i.prototype.init.apply(this,arguments)},t.prototype.mergeOption=function(e){if(nZ(e),e.data){var r=this._processFlatCoordsArray(e.data);this._flatCoords=r.flatCoords,this._flatCoordsOffset=r.flatCoordsOffset,r.flatCoords&&(e.data=new Float32Array(r.count))}i.prototype.mergeOption.apply(this,arguments)},t.prototype.appendData=function(e){var r=this._processFlatCoordsArray(e.data);r.flatCoords&&(this._flatCoords?(this._flatCoords=qw(this._flatCoords,r.flatCoords),this._flatCoordsOffset=qw(this._flatCoordsOffset,r.flatCoordsOffset)):(this._flatCoords=r.flatCoords,this._flatCoordsOffset=r.flatCoordsOffset),e.data=new Float32Array(r.count)),this.getRawData().appendData(e.data)},t.prototype._getCoordsFromItemModel=function(e){var r=this.getData().getItemModel(e),n=r.option instanceof Array?r.option:r.getShallow("coords");return n},t.prototype.getLineCoordsCount=function(e){return this._flatCoordsOffset?this._flatCoordsOffset[e*2+1]:this._getCoordsFromItemModel(e).length},t.prototype.getLineCoords=function(e,r){if(this._flatCoordsOffset){for(var n=this._flatCoordsOffset[e*2],o=this._flatCoordsOffset[e*2+1],s=0;s<o;s++)r[s]=r[s]||[],r[s][0]=this._flatCoords[n+s*2],r[s][1]=this._flatCoords[n+s*2+1];return o}else{for(var a=this._getCoordsFromItemModel(e),s=0;s<a.length;s++)r[s]=r[s]||[],r[s][0]=a[s][0],r[s][1]=a[s][1];return a.length}},t.prototype._processFlatCoordsArray=function(e){var r=0;if(this._flatCoords&&(r=this._flatCoords.length),fn(e[0])){for(var n=e.length,o=new XLt(n),s=new YLt(n),a=0,u=0,f=0,g=0;g<n;){f++;var v=e[g++];o[u++]=a+r,o[u++]=v;for(var y=0;y<v;y++){var w=e[g++],I=e[g++];s[a++]=w,s[a++]=I}}return{flatCoordsOffset:new Uint32Array(o.buffer,0,u),flatCoords:s,count:f}}return{flatCoordsOffset:null,flatCoords:null,count:e.length}},t.prototype.getInitialData=function(e,r){var n=new dl(["value"],this);return n.hasItemOption=!1,n.initData(e.data,[],function(o,s,a,u){if(o instanceof Array)return NaN;n.hasItemOption=!0;var f=o.value;if(f!=null)return f instanceof Array?f[u]:f}),n},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=o.getItemModel(e),a=s.get("name");if(a)return a;var u=s.get("fromName"),f=s.get("toName"),g=[];return u!=null&&g.push(u),f!=null&&g.push(f),xo("nameValue",{name:g.join(" > ")})},t.prototype.preventIncremental=function(){return!!this.get(["effect","show"])},t.prototype.getProgressive=function(){var e=this.option.progressive;return e??(this.option.large?1e4:this.get("progressive"))},t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;return e??(this.option.large?2e4:this.get("progressiveThreshold"))},t.prototype.getZLevelKey=function(){var e=this.getModel("effect"),r=e.get("trailLength");return this.getData().count()>this.getProgressiveThreshold()?this.id:e.get("show")&&r>0?r+"":""},t.type="series.lines",t.dependencies=["grid","polar","geo","calendar"],t.defaultOption={coordinateSystem:"geo",z:2,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,clip:!0,label:{show:!1,position:"end"},lineStyle:{opacity:.5}},t}(Ea);const JLt=KLt;function iI(i){return i instanceof Array||(i=[i,i]),i}var QLt={seriesType:"lines",reset:function(i){var t=iI(i.get("symbol")),e=iI(i.get("symbolSize")),r=i.getData();r.setVisual("fromSymbol",t&&t[0]),r.setVisual("toSymbol",t&&t[1]),r.setVisual("fromSymbolSize",e&&e[0]),r.setVisual("toSymbolSize",e&&e[1]);function n(o,s){var a=o.getItemModel(s),u=iI(a.getShallow("symbol",!0)),f=iI(a.getShallow("symbolSize",!0));u[0]&&o.setItemVisual(s,"fromSymbol",u[0]),u[1]&&o.setItemVisual(s,"toSymbol",u[1]),f[0]&&o.setItemVisual(s,"fromSymbolSize",f[0]),f[1]&&o.setItemVisual(s,"toSymbolSize",f[1])}return{dataEach:r.hasItemOption?n:null}}};const tRt=QLt;function eRt(i){i.registerChartView(qLt),i.registerSeriesModel(JLt),i.registerLayout(Rit),i.registerVisual(tRt)}var iRt=256,rRt=function(){function i(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var t=gu.createCanvas();this.canvas=t}return i.prototype.update=function(t,e,r,n,o,s){var a=this._getBrush(),u=this._getGradient(o,"inRange"),f=this._getGradient(o,"outOfRange"),g=this.pointSize+this.blurSize,v=this.canvas,y=v.getContext("2d"),w=t.length;v.width=e,v.height=r;for(var I=0;I<w;++I){var E=t[I],D=E[0],R=E[1],z=E[2],N=n(z);y.globalAlpha=N,y.drawImage(a,D-g,R-g)}if(!v.width||!v.height)return v;for(var H=y.getImageData(0,0,v.width,v.height),$=H.data,X=0,K=$.length,et=this.minOpacity,rt=this.maxOpacity,lt=rt-et;X<K;){var N=$[X+3]/256,ht=Math.floor(N*(iRt-1))*4;if(N>0){var yt=s(N)?u:f;N>0&&(N=N*lt+et),$[X++]=yt[ht],$[X++]=yt[ht+1],$[X++]=yt[ht+2],$[X++]=yt[ht+3]*N*256}else X+=4}return y.putImageData(H,0,0),v},i.prototype._getBrush=function(){var t=this._brushCanvas||(this._brushCanvas=gu.createCanvas()),e=this.pointSize+this.blurSize,r=e*2;t.width=r,t.height=r;var n=t.getContext("2d");return n.clearRect(0,0,r,r),n.shadowOffsetX=r,n.shadowBlur=this.blurSize,n.shadowColor=_e.color.neutral99,n.beginPath(),n.arc(-e,e,this.pointSize,0,Math.PI*2,!0),n.closePath(),n.fill(),t},i.prototype._getGradient=function(t,e){for(var r=this._gradientPixels,n=r[e]||(r[e]=new Uint8ClampedArray(256*4)),o=[0,0,0,0],s=0,a=0;a<256;a++)t[e](a/255,!0,o),n[s++]=o[0],n[s++]=o[1],n[s++]=o[2],n[s++]=o[3];return n},i}();const nRt=rRt;function aRt(i,t,e){var r=i[1]-i[0];t=ti(t,function(s){return{interval:[(s.interval[0]-i[0])/r,(s.interval[1]-i[0])/r]}});var n=t.length,o=0;return function(s){var a;for(a=o;a<n;a++){var u=t[a].interval;if(u[0]<=s&&s<=u[1]){o=a;break}}if(a===n)for(a=o-1;a>=0;a--){var u=t[a].interval;if(u[0]<=s&&s<=u[1]){o=a;break}}return a>=0&&a<n&&e[a]}}function oRt(i,t){var e=i[1]-i[0];return t=[(t[0]-i[0])/e,(t[1]-i[0])/e],function(r){return r>=t[0]&&r<=t[1]}}function aZ(i){var t=i.dimensions;return t[0]==="lng"&&t[1]==="lat"}var sRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o;r.eachComponent("visualMap",function(a){a.eachTargetSeries(function(u){u===e&&(o=a)})}),this._progressiveEls=null,this.group.removeAll();var s=e.coordinateSystem;s.type==="cartesian2d"||s.type==="calendar"||s.type==="matrix"?this._renderOnGridLike(e,n,0,e.getData().count()):aZ(s)&&this._renderOnGeo(s,e,o,n)},t.prototype.incrementalPrepareRender=function(e,r,n){this.group.removeAll()},t.prototype.incrementalRender=function(e,r,n,o){var s=r.coordinateSystem;s&&(aZ(s)?this.render(r,n,o):(this._progressiveEls=[],this._renderOnGridLike(r,o,e.start,e.end,!0)))},t.prototype.eachRendered=function(e){Hp(this._progressiveEls||this.group,e)},t.prototype._renderOnGridLike=function(e,r,n,o,s){var a=e.coordinateSystem,u=kp(a,"cartesian2d"),f=kp(a,"matrix"),g,v,y,w;if(u){var I=a.getAxis("x"),E=a.getAxis("y");g=I.getBandWidth()+.5,v=E.getBandWidth()+.5,y=I.scale.getExtent(),w=E.scale.getExtent()}for(var D=this.group,R=e.getData(),z=e.getModel(["emphasis","itemStyle"]).getItemStyle(),N=e.getModel(["blur","itemStyle"]).getItemStyle(),H=e.getModel(["select","itemStyle"]).getItemStyle(),$=e.get(["itemStyle","borderRadius"]),X=zo(e),K=e.getModel("emphasis"),et=K.get("focus"),rt=K.get("blurScope"),lt=K.get("disabled"),ht=u||f?[R.mapDimension("x"),R.mapDimension("y"),R.mapDimension("value")]:[R.mapDimension("time"),R.mapDimension("value")],yt=n;yt<o;yt++){var ft=void 0,kt=R.getItemVisual(yt,"style");if(u){var Rt=R.get(ht[0],yt),Ct=R.get(ht[1],yt);if(isNaN(R.get(ht[2],yt))||isNaN(Rt)||isNaN(Ct)||Rt<y[0]||Rt>y[1]||Ct<w[0]||Ct>w[1])continue;var Gt=a.dataToPoint([Rt,Ct]);ft=new jr({shape:{x:Gt[0]-g/2,y:Gt[1]-v/2,width:g,height:v},style:kt})}else if(f){var Vt=a.dataToLayout([R.get(ht[0],yt),R.get(ht[1],yt)]).rect;if(Bs(Vt.x))continue;ft=new jr({z2:1,shape:Vt,style:kt})}else{if(isNaN(R.get(ht[1],yt)))continue;var Qt=a.dataToLayout([R.get(ht[0],yt)]),Vt=Qt.contentRect||Qt.rect;if(Bs(Vt.x)||Bs(Vt.y))continue;ft=new jr({z2:1,shape:Vt,style:kt})}if(R.hasItemOption){var fe=R.getItemModel(yt),Te=fe.getModel("emphasis");z=Te.getModel("itemStyle").getItemStyle(),N=fe.getModel(["blur","itemStyle"]).getItemStyle(),H=fe.getModel(["select","itemStyle"]).getItemStyle(),$=fe.get(["itemStyle","borderRadius"]),et=Te.get("focus"),rt=Te.get("blurScope"),lt=Te.get("disabled"),X=zo(fe)}ft.shape.r=$;var be=e.getRawValue(yt),Ge="-";be&&be[2]!=null&&(Ge=be[2]+""),qo(ft,X,{labelFetcher:e,labelDataIndex:yt,defaultOpacity:kt.opacity,defaultText:Ge}),ft.ensureState("emphasis").style=z,ft.ensureState("blur").style=N,ft.ensureState("select").style=H,Ma(ft,et,rt,lt),ft.incremental=s,s&&(ft.states.emphasis.hoverLayer=!0),D.add(ft),R.setItemGraphicEl(yt,ft),this._progressiveEls&&this._progressiveEls.push(ft)}},t.prototype._renderOnGeo=function(e,r,n,o){var s=n.targetVisuals.inRange,a=n.targetVisuals.outOfRange,u=r.getData(),f=this._hmLayer||this._hmLayer||new nRt;f.blurSize=r.get("blurSize"),f.pointSize=r.get("pointSize"),f.minOpacity=r.get("minOpacity"),f.maxOpacity=r.get("maxOpacity");var g=e.getViewRect().clone(),v=e.getRoamTransform();g.applyTransform(v);var y=Math.max(g.x,0),w=Math.max(g.y,0),I=Math.min(g.width+g.x,o.getWidth()),E=Math.min(g.height+g.y,o.getHeight()),D=I-y,R=E-w,z=[u.mapDimension("lng"),u.mapDimension("lat"),u.mapDimension("value")],N=u.mapArray(z,function(K,et,rt){var lt=e.dataToPoint([K,et]);return lt[0]-=y,lt[1]-=w,lt.push(rt),lt}),H=n.getExtent(),$=n.type==="visualMap.continuous"?oRt(H,n.option.range):aRt(H,n.getPieceList(),n.option.selected);f.update(N,D,R,s.color.getNormalizer(),{inRange:s.color.getColorMapper(),outOfRange:a.color.getColorMapper()},$);var X=new ys({style:{width:D,height:R,x:y,y:w,image:f.canvas},silent:!0});this.group.add(X)},t.type="heatmap",t}(pa);const lRt=sRt;var cRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,r){return Hd(null,this,{generateCoord:"value"})},t.prototype.preventIncremental=function(){var e=NS.get(this.get("coordinateSystem"));if(e&&e.dimensions)return e.dimensions[0]==="lng"&&e.dimensions[1]==="lat"},t.type="series.heatmap",t.dependencies=["grid","geo","calendar","matrix"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:_e.color.primary}}},t}(Ea);const uRt=cRt;function hRt(i){i.registerChartView(lRt),i.registerSeriesModel(uRt)}var dRt=["itemStyle","borderWidth"],oZ=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],ck=new Gp,fRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=this.group,s=e.getData(),a=this._data,u=e.coordinateSystem,f=u.getBaseAxis(),g=f.isHorizontal(),v=u.master.getRect(),y={ecSize:{width:n.getWidth(),height:n.getHeight()},seriesModel:e,coordSys:u,coordSysExtent:[[v.x,v.x+v.width],[v.y,v.y+v.height]],isHorizontal:g,valueDim:oZ[+g],categoryDim:oZ[1-+g]};s.diff(a).add(function(I){if(s.hasValue(I)){var E=lZ(s,I),D=sZ(s,I,E,y),R=cZ(s,y,D);s.setItemGraphicEl(I,R),o.add(R),hZ(R,y,D)}}).update(function(I,E){var D=a.getItemGraphicEl(E);if(!s.hasValue(I)){o.remove(D);return}var R=lZ(s,I),z=sZ(s,I,R,y),N=Nit(s,z);D&&N!==D.__pictorialShapeStr&&(o.remove(D),s.setItemGraphicEl(I,null),D=null),D?xRt(D,y,z):D=cZ(s,y,z,!0),s.setItemGraphicEl(I,D),D.__pictorialSymbolMeta=z,o.add(D),hZ(D,y,z)}).remove(function(I){var E=a.getItemGraphicEl(I);E&&uZ(a,I,E.__pictorialSymbolMeta.animationModel,E)}).execute();var w=e.get("clip",!0)?$S(e.coordinateSystem,!1,e):null;return w?o.setClipPath(w):o.removeClipPath(),this._data=s,this.group},t.prototype.remove=function(e,r){var n=this.group,o=this._data;e.get("animation")?o&&o.eachItemGraphicEl(function(s){uZ(o,ur(s).dataIndex,e,s)}):n.removeAll()},t.type="pictorialBar",t}(pa);function sZ(i,t,e,r){var n=i.getItemLayout(t),o=e.get("symbolRepeat"),s=e.get("symbolClip"),a=e.get("symbolPosition")||"start",u=e.get("symbolRotate"),f=(u||0)*Math.PI/180||0,g=e.get("symbolPatternSize")||2,v=e.isAnimationEnabled(),y={dataIndex:t,layout:n,itemModel:e,symbolType:i.getItemVisual(t,"symbol")||"circle",style:i.getItemVisual(t,"style"),symbolClip:s,symbolRepeat:o,symbolRepeatDirection:e.get("symbolRepeatDirection"),symbolPatternSize:g,rotation:f,animationModel:v?e:null,hoverScale:v&&e.get(["emphasis","scale"]),z2:e.getShallow("z",!0)||0};pRt(e,o,n,r,y),gRt(i,t,n,o,s,y.boundingLength,y.pxSign,g,r,y),mRt(e,y.symbolScale,f,r,y);var w=y.symbolSize,I=Cv(e.get("symbolOffset"),w);return vRt(e,w,n,o,s,I,a,y.valueLineWidth,y.boundingLength,y.repeatCutLength,r,y),y}function pRt(i,t,e,r,n){var o=r.valueDim,s=i.get("symbolBoundingData"),a=r.coordSys.getOtherAxis(r.coordSys.getBaseAxis()),u=a.toGlobalCoord(a.dataToCoord(0)),f=1-+(e[o.wh]<=0),g;if(Ye(s)){var v=[uk(a,s[0])-u,uk(a,s[1])-u];v[1]<v[0]&&v.reverse(),g=v[f]}else s!=null?g=uk(a,s)-u:t?g=r.coordSysExtent[o.index][f]-u:g=e[o.wh];n.boundingLength=g,t&&(n.repeatCutLength=e[o.wh]);var y=o.xy==="x",w=a.inverse;n.pxSign=y&&!w||!y&&w?g>=0?1:-1:g>0?1:-1}function uk(i,t){return i.toGlobalCoord(i.dataToCoord(i.scale.parse(t)))}function gRt(i,t,e,r,n,o,s,a,u,f){var g=u.valueDim,v=u.categoryDim,y=Math.abs(e[v.wh]),w=i.getItemVisual(t,"symbolSize"),I;Ye(w)?I=w.slice():w==null?I=["100%","100%"]:I=[w,w],I[v.index]=xi(I[v.index],y),I[g.index]=xi(I[g.index],r?y:Math.abs(o)),f.symbolSize=I;var E=f.symbolScale=[I[0]/a,I[1]/a];E[g.index]*=(u.isHorizontal?-1:1)*s}function mRt(i,t,e,r,n){var o=i.get(dRt)||0;o&&(ck.attr({scaleX:t[0],scaleY:t[1],rotation:e}),ck.updateTransform(),o/=ck.getLineScale(),o*=t[r.valueDim.index]),n.valueLineWidth=o||0}function vRt(i,t,e,r,n,o,s,a,u,f,g,v){var y=g.categoryDim,w=g.valueDim,I=v.pxSign,E=Math.max(t[w.index]+a,0),D=E;if(r){var R=Math.abs(u),z=vs(i.get("symbolMargin"),"15%")+"",N=!1;z.lastIndexOf("!")===z.length-1&&(N=!0,z=z.slice(0,z.length-1));var H=xi(z,t[w.index]),$=Math.max(E+H*2,0),X=N?0:H*2,K=XY(r),et=K?r:dZ((R+X)/$),rt=R-et*E;H=rt/2/(N?et:Math.max(et-1,1)),$=E+H*2,X=N?0:H*2,!K&&r!=="fixed"&&(et=f?dZ((Math.abs(f)+X)/$):0),D=et*$-X,v.repeatTimes=et,v.symbolMargin=H}var lt=I*(D/2),ht=v.pathPosition=[];ht[y.index]=e[y.wh]/2,ht[w.index]=s==="start"?lt:s==="end"?u-lt:u/2,o&&(ht[0]+=o[0],ht[1]+=o[1]);var yt=v.bundlePosition=[];yt[y.index]=e[y.xy],yt[w.index]=e[w.xy];var ft=v.barRectShape=Fe({},e);ft[w.wh]=I*Math.max(Math.abs(e[w.wh]),Math.abs(ht[w.index]+lt)),ft[y.wh]=e[y.wh];var kt=v.clipShape={};kt[y.xy]=-e[y.xy],kt[y.wh]=g.ecSize[y.wh],kt[w.xy]=0,kt[w.wh]=e[w.wh]}function kit(i){var t=i.symbolPatternSize,e=bo(i.symbolType,-t/2,-t/2,t,t);return e.attr({culling:!0}),e.type!=="image"&&e.setStyle({strokeNoScale:!0}),e}function Oit(i,t,e,r){var n=i.__pictorialBundle,o=e.symbolSize,s=e.valueLineWidth,a=e.pathPosition,u=t.valueDim,f=e.repeatTimes||0,g=0,v=o[t.valueDim.index]+s+e.symbolMargin*2;for(sN(i,function(E){E.__pictorialAnimationIndex=g,E.__pictorialRepeatTimes=f,g<f?u0(E,null,I(g),e,r):u0(E,null,{scaleX:0,scaleY:0},e,r,function(){n.remove(E)}),g++});g<f;g++){var y=kit(e);y.__pictorialAnimationIndex=g,y.__pictorialRepeatTimes=f,n.add(y);var w=I(g);u0(y,{x:w.x,y:w.y,scaleX:0,scaleY:0},{scaleX:w.scaleX,scaleY:w.scaleY,rotation:w.rotation},e,r)}function I(E){var D=a.slice(),R=e.pxSign,z=E;return(e.symbolRepeatDirection==="start"?R>0:R<0)&&(z=f-1-E),D[u.index]=v*(z-f/2+.5)+a[u.index],{x:D[0],y:D[1],scaleX:e.symbolScale[0],scaleY:e.symbolScale[1],rotation:e.rotation}}}function zit(i,t,e,r){var n=i.__pictorialBundle,o=i.__pictorialMainPath;o?u0(o,null,{x:e.pathPosition[0],y:e.pathPosition[1],scaleX:e.symbolScale[0],scaleY:e.symbolScale[1],rotation:e.rotation},e,r):(o=i.__pictorialMainPath=kit(e),n.add(o),u0(o,{x:e.pathPosition[0],y:e.pathPosition[1],scaleX:0,scaleY:0,rotation:e.rotation},{scaleX:e.symbolScale[0],scaleY:e.symbolScale[1]},e,r))}function Bit(i,t,e){var r=Fe({},t.barRectShape),n=i.__pictorialBarRect;n?u0(n,null,{shape:r},t,e):(n=i.__pictorialBarRect=new jr({z2:2,shape:r,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),n.disableMorphing=!0,i.add(n))}function Fit(i,t,e,r){if(e.symbolClip){var n=i.__pictorialClipPath,o=Fe({},e.clipShape),s=t.valueDim,a=e.animationModel,u=e.dataIndex;if(n)yn(n,{shape:o},a,u);else{o[s.wh]=0,n=new jr({shape:o}),i.__pictorialBundle.setClipPath(n),i.__pictorialClipPath=n;var f={};f[s.wh]=e.clipShape[s.wh],Tv[r?"updateProps":"initProps"](n,{shape:f},a,u)}}}function lZ(i,t){var e=i.getItemModel(t);return e.getAnimationDelayParams=_Rt,e.isAnimationEnabled=yRt,e}function _Rt(i){return{index:i.__pictorialAnimationIndex,count:i.__pictorialRepeatTimes}}function yRt(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function cZ(i,t,e,r){var n=new Ki,o=new Ki;return n.add(o),n.__pictorialBundle=o,o.x=e.bundlePosition[0],o.y=e.bundlePosition[1],e.symbolRepeat?Oit(n,t,e):zit(n,t,e),Bit(n,e,r),Fit(n,t,e,r),n.__pictorialShapeStr=Nit(i,e),n.__pictorialSymbolMeta=e,n}function xRt(i,t,e){var r=e.animationModel,n=e.dataIndex,o=i.__pictorialBundle;yn(o,{x:e.bundlePosition[0],y:e.bundlePosition[1]},r,n),e.symbolRepeat?Oit(i,t,e,!0):zit(i,t,e,!0),Bit(i,e,!0),Fit(i,t,e,!0)}function uZ(i,t,e,r){var n=r.__pictorialBarRect;n&&n.removeTextContent();var o=[];sN(r,function(s){o.push(s)}),r.__pictorialMainPath&&o.push(r.__pictorialMainPath),r.__pictorialClipPath&&(e=null),gt(o,function(s){Pp(s,{scaleX:0,scaleY:0},e,t,function(){r.parent&&r.parent.remove(r)})}),i.setItemGraphicEl(t,null)}function Nit(i,t){return[i.getItemVisual(t.dataIndex,"symbol")||"none",!!t.symbolRepeat,!!t.symbolClip].join(":")}function sN(i,t,e){gt(i.__pictorialBundle.children(),function(r){r!==i.__pictorialBarRect&&t.call(e,r)})}function u0(i,t,e,r,n,o){t&&i.attr(t),r.symbolClip&&!n?e&&i.attr(e):e&&Tv[n?"updateProps":"initProps"](i,e,r.animationModel,r.dataIndex,o)}function hZ(i,t,e){var r=e.dataIndex,n=e.itemModel,o=n.getModel("emphasis"),s=o.getModel("itemStyle").getItemStyle(),a=n.getModel(["blur","itemStyle"]).getItemStyle(),u=n.getModel(["select","itemStyle"]).getItemStyle(),f=n.getShallow("cursor"),g=o.get("focus"),v=o.get("blurScope"),y=o.get("scale");sN(i,function(E){if(E instanceof ys){var D=E.style;E.useStyle(Fe({image:D.image,x:D.x,y:D.y,width:D.width,height:D.height},e.style))}else E.useStyle(e.style);var R=E.ensureState("emphasis");R.style=s,y&&(R.scaleX=E.scaleX*1.1,R.scaleY=E.scaleY*1.1),E.ensureState("blur").style=a,E.ensureState("select").style=u,f&&(E.cursor=f),E.z2=e.z2});var w=t.valueDim.posDesc[+(e.boundingLength>0)],I=i.__pictorialBarRect;I.ignoreClip=!0,qo(I,zo(n),{labelFetcher:t.seriesModel,labelDataIndex:r,defaultText:I0(t.seriesModel.getData(),r),inheritColor:e.style.fill,defaultOpacity:e.style.opacity,defaultOutsidePosition:w}),Ma(i,g,v,o.get("disabled"))}function dZ(i){var t=Math.round(i);return Math.abs(i-t)<1e-4?t:Math.ceil(i)}const bRt=fRt;var wRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e.defaultSymbol="roundRect",e}return t.prototype.getInitialData=function(e){return e.stack=null,i.prototype.getInitialData.apply(this,arguments)},t.type="series.pictorialBar",t.dependencies=["grid"],t.defaultOption=jp(rC.defaultOption,{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:!1,symbolRepeatDirection:"end",symbolClip:!1,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",clip:!1,progressive:0,emphasis:{scale:!1},select:{itemStyle:{borderColor:_e.color.primary}}}),t}(rC);const SRt=wRt;function TRt(i){i.registerChartView(bRt),i.registerSeriesModel(SRt),i.registerLayout(i.PRIORITY.VISUAL.LAYOUT,br(JQ,"pictorialBar")),i.registerLayout(i.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,QQ("pictorialBar"))}var ARt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._layers=[],e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this,a=this.group,u=e.getLayerSeries(),f=o.getLayout("layoutInfo"),g=f.rect,v=f.boundaryGap;a.x=0,a.y=g.y+v[0];function y(D){return D.name}var w=new Od(this._layersSeries||[],u,y,y),I=[];w.add(wi(E,this,"add")).update(wi(E,this,"update")).remove(wi(E,this,"remove")).execute();function E(D,R,z){var N=s._layers;if(D==="remove"){a.remove(N[R]);return}for(var H=[],$=[],X,K=u[R].indices,et=0;et<K.length;et++){var rt=o.getItemLayout(K[et]),lt=rt.x,ht=rt.y0,yt=rt.y;H.push(lt,ht),$.push(lt,ht+yt),X=o.getItemVisual(K[et],"style")}var ft,kt=o.getItemLayout(K[0]),Rt=e.getModel("label"),Ct=Rt.get("margin"),Gt=e.getModel("emphasis");if(D==="add"){var Vt=I[R]=new Ki;ft=new Wtt({shape:{points:H,stackedOnPoints:$,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),Vt.add(ft),a.add(Vt),e.isAnimationEnabled()&&ft.setClipPath(IRt(ft.getBoundingRect(),e,function(){ft.removeClipPath()}))}else{var Vt=N[z];ft=Vt.childAt(0),a.add(Vt),I[R]=Vt,yn(ft,{shape:{points:H,stackedOnPoints:$}},e),Oc(ft)}qo(ft,zo(e),{labelDataIndex:K[et-1],defaultText:o.getName(K[et-1]),inheritColor:X.fill},{normal:{verticalAlign:"middle"}}),ft.setTextConfig({position:null,local:!0});var Qt=ft.getTextContent();Qt&&(Qt.x=kt.x-Ct,Qt.y=kt.y0+kt.y/2),ft.useStyle(X),o.setItemGraphicEl(R,ft),Oo(ft,e),Ma(ft,Gt.get("focus"),Gt.get("blurScope"),Gt.get("disabled"))}this._layersSeries=u,this._layers=I},t.type="themeRiver",t}(pa);function IRt(i,t,e){var r=new jr({shape:{x:i.x-10,y:i.y-10,width:0,height:i.height+20}});return ya(r,{shape:{x:i.x-50,width:i.width+100,height:i.height+20}},t,e),r}const MRt=ARt;var hk=2,CRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new K0(wi(this.getData,this),wi(this.getRawData,this))},t.prototype.fixData=function(e){var r=e.length,n={},o=$O(e,function(y){return n.hasOwnProperty(y[0]+"")||(n[y[0]+""]=-1),y[2]}),s=[];o.buckets.each(function(y,w){s.push({name:w,dataList:y})});for(var a=s.length,u=0;u<a;++u){for(var f=s[u].name,g=0;g<s[u].dataList.length;++g){var v=s[u].dataList[g][0]+"";n[v]=u}for(var v in n)n.hasOwnProperty(v)&&n[v]!==u&&(n[v]=u,e[r]=[v,0,f],r++)}return e},t.prototype.getInitialData=function(e,r){for(var n=this.getReferringComponents("singleAxis",Wa).models[0],o=n.get("type"),s=Rn(e.data,function(I){return I[2]!==void 0}),a=this.fixData(s||[]),u=[],f=this.nameMap=Fi(),g=0,v=0;v<a.length;++v)u.push(a[v][hk]),f.get(a[v][hk])||(f.set(a[v][hk],g),g++);var y=GS(a,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:qM(o)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,w=new dl(y,this);return w.initData(a),w},t.prototype.getLayerSeries=function(){for(var e=this.getData(),r=e.count(),n=[],o=0;o<r;++o)n[o]=o;var s=e.mapDimension("single"),a=$O(n,function(f){return e.get("name",f)}),u=[];return a.buckets.each(function(f,g){f.sort(function(v,y){return e.get(s,v)-e.get(s,y)}),u.push({name:g,indices:f})}),u},t.prototype.getAxisTooltipData=function(e,r,n){Ye(e)||(e=e?[e]:[]);for(var o=this.getData(),s=this.getLayerSeries(),a=[],u=s.length,f,g=0;g<u;++g){for(var v=Number.MAX_VALUE,y=-1,w=s[g].indices.length,I=0;I<w;++I){var E=o.get(e[0],s[g].indices[I]),D=Math.abs(E-r);D<=v&&(f=E,v=D,y=s[g].indices[I])}a.push(y)}return{dataIndices:a,nestestValue:f}},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=o.getName(e),a=o.get(o.mapDimension("value"),e);return xo("nameValue",{name:s,value:a})},t.type="series.themeRiver",t.dependencies=["singleAxis"],t.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},t}(Ea);const ERt=CRt;function DRt(i,t){i.eachSeriesByType("themeRiver",function(e){var r=e.getData(),n=e.coordinateSystem,o={},s=n.getRect();o.rect=s;var a=e.get("boundaryGap"),u=n.getAxis();if(o.boundaryGap=a,u.orient==="horizontal"){a[0]=xi(a[0],s.height),a[1]=xi(a[1],s.height);var f=s.height-a[0]-a[1];fZ(r,e,f)}else{a[0]=xi(a[0],s.width),a[1]=xi(a[1],s.width);var g=s.width-a[0]-a[1];fZ(r,e,g)}r.setLayout("layoutInfo",o)})}function fZ(i,t,e){if(i.count())for(var r=t.coordinateSystem,n=t.getLayerSeries(),o=i.mapDimension("single"),s=i.mapDimension("value"),a=ti(n,function(D){return ti(D.indices,function(R){var z=r.dataToPoint(i.get(o,R));return z[1]=i.get(s,R),z})}),u=PRt(a),f=u.y0,g=e/u.max,v=n.length,y=n[0].indices.length,w,I=0;I<y;++I){w=f[I]*g,i.setItemLayout(n[0].indices[I],{layerIndex:0,x:a[0][I][0],y0:w,y:a[0][I][1]*g});for(var E=1;E<v;++E)w+=a[E-1][I][1]*g,i.setItemLayout(n[E].indices[I],{layerIndex:E,x:a[E][I][0],y0:w,y:a[E][I][1]*g})}}function PRt(i){for(var t=i.length,e=i[0].length,r=[],n=[],o=0,s=0;s<e;++s){for(var a=0,u=0;u<t;++u)a+=i[u][s][1];a>o&&(o=a),r.push(a)}for(var f=0;f<e;++f)n[f]=(o-r[f])/2;o=0;for(var g=0;g<e;++g){var v=r[g]+n[g];v>o&&(o=v)}return{y0:n,max:o}}function LRt(i){i.registerChartView(MRt),i.registerSeriesModel(ERt),i.registerLayout(DRt),i.registerProcessor(X0("themeRiver"))}var RRt=2,kRt=4,ORt=function(i){we(t,i);function t(e,r,n,o){var s=i.call(this)||this;s.z2=RRt,s.textConfig={inside:!0},ur(s).seriesIndex=r.seriesIndex;var a=new _n({z2:kRt,silent:e.getModel().get(["label","silent"])});return s.setTextContent(a),s.updateData(!0,e,r,n,o),s}return t.prototype.updateData=function(e,r,n,o,s){this.node=r,r.piece=this,n=n||this._seriesModel,o=o||this._ecModel;var a=this;ur(a).dataIndex=r.dataIndex;var u=r.getModel(),f=u.getModel("emphasis"),g=r.getLayout(),v=Fe({},g);v.label=null;var y=r.getVisual("style");y.lineJoin="bevel";var w=r.getVisual("decal");w&&(y.decal=S0(w,s));var I=hh(u.getModel("itemStyle"),v,!0);Fe(v,I),gt(fl,function(z){var N=a.ensureState(z),H=u.getModel([z,"itemStyle"]);N.style=H.getItemStyle();var $=hh(H,v);$&&(N.shape=$)}),e?(a.setShape(v),a.shape.r=g.r0,ya(a,{shape:{r:g.r}},n,r.dataIndex)):(yn(a,{shape:v},n),Oc(a)),a.useStyle(y),this._updateLabel(n);var E=u.getShallow("cursor");E&&a.attr("cursor",E),this._seriesModel=n||this._seriesModel,this._ecModel=o||this._ecModel;var D=f.get("focus"),R=D==="relative"?qw(r.getAncestorsIndices(),r.getDescendantIndices()):D==="ancestor"?r.getAncestorsIndices():D==="descendant"?r.getDescendantIndices():D;Ma(this,R,f.get("blurScope"),f.get("disabled"))},t.prototype._updateLabel=function(e){var r=this,n=this.node.getModel(),o=n.getModel("label"),s=this.node.getLayout(),a=s.endAngle-s.startAngle,u=(s.startAngle+s.endAngle)/2,f=Math.cos(u),g=Math.sin(u),v=this,y=v.getTextContent(),w=this.node.dataIndex,I=o.get("minAngle")/180*Math.PI,E=o.get("show")&&!(I!=null&&Math.abs(a)<I);y.ignore=!E,gt(eS,function(R){var z=R==="normal"?n.getModel("label"):n.getModel([R,"label"]),N=R==="normal",H=N?y:y.ensureState(R),$=e.getFormattedLabel(w,R);N&&($=$||r.node.name),H.style=fa(z,{},null,R!=="normal",!0),$&&(H.style.text=$);var X=z.get("show");X!=null&&!N&&(H.ignore=!X);var K=D(z,"position"),et=N?v:v.states[R],rt=et.style.fill;et.textConfig={outsideFill:z.get("color")==="inherit"?rt:null,inside:K!=="outside"};var lt,ht=D(z,"distance")||0,yt=D(z,"align"),ft=D(z,"rotate"),kt=Math.PI*.5,Rt=Math.PI*1.5,Ct=tc(ft==="tangential"?Math.PI/2-u:u),Gt=Ct>kt&&!Jw(Ct-kt)&&Ct<Rt;K==="outside"?(lt=s.r+ht,yt=Gt?"right":"left"):!yt||yt==="center"?(a===2*Math.PI&&s.r0===0?lt=0:lt=(s.r+s.r0)/2,yt="center"):yt==="left"?(lt=s.r0+ht,yt=Gt?"right":"left"):yt==="right"&&(lt=s.r-ht,yt=Gt?"left":"right"),H.style.align=yt,H.style.verticalAlign=D(z,"verticalAlign")||"middle",H.x=lt*f+s.cx,H.y=lt*g+s.cy;var Vt=0;ft==="radial"?Vt=tc(-u)+(Gt?Math.PI:0):ft==="tangential"?Vt=tc(Math.PI/2-u)+(Gt?Math.PI:0):fn(ft)&&(Vt=ft*Math.PI/180),H.rotation=tc(Vt)});function D(R,z){var N=R.get(z);return N??o.get(z)}y.dirtyStyle()},t}(pl);const pZ=ORt;var aB="sunburstRootToNode",gZ="sunburstHighlight",zRt="sunburstUnhighlight";function BRt(i){i.registerAction({type:aB,update:"updateView"},function(t,e){e.eachComponent({mainType:"series",subType:"sunburst",query:t},r);function r(n,o){var s=vS(t,[aB],n);if(s){var a=n.getViewRoot();a&&(t.direction=H3(a,s.node)?"rollUp":"drillDown"),n.resetViewRoot(s.node)}}}),i.registerAction({type:gZ,update:"none"},function(t,e,r){t=Fe({},t),e.eachComponent({mainType:"series",subType:"sunburst",query:t},n);function n(o){var s=vS(t,[gZ],o);s&&(t.dataIndex=s.node.dataIndex)}r.dispatchAction(Fe(t,{type:"highlight"}))}),i.registerAction({type:zRt,update:"updateView"},function(t,e,r){t=Fe({},t),r.dispatchAction(Fe(t,{type:"downplay"}))})}var FRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){var s=this;this.seriesModel=e,this.api=n,this.ecModel=r;var a=e.getData(),u=a.tree.root,f=e.getViewRoot(),g=this.group,v=e.get("renderLabelForZeroData"),y=[];f.eachNode(function(z){y.push(z)});var w=this._oldChildren||[];I(y,w),R(u,f),this._initEvents(),this._oldChildren=y;function I(z,N){if(z.length===0&&N.length===0)return;new Od(N,z,H,H).add($).update($).remove(br($,null)).execute();function H(X){return X.getId()}function $(X,K){var et=X==null?null:z[X],rt=K==null?null:N[K];E(et,rt)}}function E(z,N){if(!v&&z&&!z.getValue()&&(z=null),z!==u&&N!==u){if(N&&N.piece)z?(N.piece.updateData(!1,z,e,r,n),a.setItemGraphicEl(z.dataIndex,N.piece)):D(N);else if(z){var H=new pZ(z,e,r,n);g.add(H),a.setItemGraphicEl(z.dataIndex,H)}}}function D(z){z&&z.piece&&(g.remove(z.piece),z.piece=null)}function R(z,N){N.depth>0?(s.virtualPiece?s.virtualPiece.updateData(!1,z,e,r,n):(s.virtualPiece=new pZ(z,e,r,n),g.add(s.virtualPiece)),N.piece.off("click"),s.virtualPiece.on("click",function(H){s._rootToNode(N.parentNode)})):s.virtualPiece&&(g.remove(s.virtualPiece),s.virtualPiece=null)}},t.prototype._initEvents=function(){var e=this;this.group.off("click"),this.group.on("click",function(r){var n=!1,o=e.seriesModel.getViewRoot();o.eachNode(function(s){if(!n&&s.piece&&s.piece===r.target){var a=s.getModel().get("nodeClick");if(a==="rootToNode")e._rootToNode(s);else if(a==="link"){var u=s.getModel(),f=u.get("link");if(f){var g=u.get("target",!0)||"_blank";VM(f,g)}}n=!0}})})},t.prototype._rootToNode=function(e){e!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:aB,from:this.uid,seriesId:this.seriesModel.id,targetNode:e})},t.prototype.containPoint=function(e,r){var n=r.getData(),o=n.getItemLayout(0);if(o){var s=e[0]-o.cx,a=e[1]-o.cy,u=Math.sqrt(s*s+a*a);return u<=o.r&&u>=o.r0}},t.type="sunburst",t}(pa);const NRt=FRt;var VRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.ignoreStyleOnData=!0,e}return t.prototype.getInitialData=function(e,r){var n={name:e.name,children:e.data};Vit(n);var o=this._levelModels=ti(e.levels||[],function(u){return new bn(u,this,r)},this),s=G3.createTree(n,this,a);function a(u){u.wrapMethod("getItemModel",function(f,g){var v=s.getNodeByDataIndex(g),y=o[v.depth];return y&&(f.parentModel=y),f})}return s.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.getDataParams=function(e){var r=i.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return r.treePathInfo=DE(n,this),r},t.prototype.getLevelModel=function(e){return this._levelModels&&this._levelModels[e.depth]},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var r=this.getRawData().tree.root;(!e||e!==r&&!r.contains(e))&&(this._viewRoot=r)},t.prototype.enableAriaDecal=function(){Het(this)},t.type="series.sunburst",t.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},t}(Ea);function Vit(i){var t=0;gt(i.children,function(r){Vit(r);var n=r.value;Ye(n)&&(n=n[0]),t+=n});var e=i.value;Ye(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),Ye(i.value)?i.value[0]=e:i.value=e}const URt=VRt;var mZ=Math.PI/180;function GRt(i,t,e){t.eachSeriesByType(i,function(r){var n=r.get("center"),o=r.get("radius");Ye(o)||(o=[0,o]),Ye(n)||(n=[n,n]);var s=e.getWidth(),a=e.getHeight(),u=Math.min(s,a),f=xi(n[0],s),g=xi(n[1],a),v=xi(o[0],u/2),y=xi(o[1],u/2),w=-r.get("startAngle")*mZ,I=r.get("minAngle")*mZ,E=r.getData().tree.root,D=r.getViewRoot(),R=D.depth,z=r.get("sort");z!=null&&Uit(D,z);var N=0;gt(D.children,function(Ct){!isNaN(Ct.getValue())&&N++});var H=D.getValue(),$=Math.PI/(H||N)*2,X=D.depth>0,K=D.height-(X?-1:1),et=(y-v)/(K||1),rt=r.get("clockwise"),lt=r.get("stillShowZeroSum"),ht=rt?1:-1,yt=function(Ct,Gt){if(Ct){var Vt=Gt;if(Ct!==E){var Qt=Ct.getValue(),fe=H===0&&lt?$:Qt*$;fe<I&&(fe=I),Vt=Gt+ht*fe;var Te=Ct.depth-R-(X?-1:1),be=v+et*Te,Ge=v+et*(Te+1),li=r.getLevelModel(Ct);if(li){var Pi=li.get("r0",!0),or=li.get("r",!0),Ve=li.get("radius",!0);Ve!=null&&(Pi=Ve[0],or=Ve[1]),Pi!=null&&(be=xi(Pi,u/2)),or!=null&&(Ge=xi(or,u/2))}Ct.setLayout({angle:fe,startAngle:Gt,endAngle:Vt,clockwise:rt,cx:f,cy:g,r0:be,r:Ge})}if(Ct.children&&Ct.children.length){var Ze=0;gt(Ct.children,function(ye){Ze+=yt(ye,Gt+Ze)})}return Vt-Gt}};if(X){var ft=v,kt=v+et,Rt=Math.PI*2;E.setLayout({angle:Rt,startAngle:w,endAngle:w+Rt,clockwise:rt,cx:f,cy:g,r0:ft,r:kt})}yt(D,w)})}function Uit(i,t){var e=i.children||[];i.children=HRt(e,t),e.length&&gt(i.children,function(r){Uit(r,t)})}function HRt(i,t){if(Xi(t)){var e=ti(i,function(n,o){var s=n.getValue();return{params:{depth:n.depth,height:n.height,dataIndex:n.dataIndex,getValue:function(){return s}},index:o}});return e.sort(function(n,o){return t(n.params,o.params)}),ti(e,function(n){return i[n.index]})}else{var r=t==="asc";return i.sort(function(n,o){var s=(n.getValue()-o.getValue())*(r?1:-1);return s===0?(n.dataIndex-o.dataIndex)*(r?-1:1):s})}}function jRt(i){var t={};function e(r,n,o){if(r.depth===0)return _e.color.neutral50;for(var s=r;s&&s.depth>1;)s=s.parentNode;var a=n.getColorFromPalette(s.name||s.dataIndex+"",t);return r.depth>1&&bi(a)&&(a=kO(a,(r.depth-1)/(o-1)*.5)),a}i.eachSeriesByType("sunburst",function(r){var n=r.getData(),o=n.tree;o.eachNode(function(s){var a=s.getModel(),u=a.getModel("itemStyle").getItemStyle();u.fill||(u.fill=e(s,r,o.root.height));var f=n.ensureUniqueItemVisual(s.dataIndex,"style");Fe(f,u)})})}function WRt(i){i.registerChartView(NRt),i.registerSeriesModel(URt),i.registerLayout(br(GRt,"sunburst")),i.registerProcessor(br(X0,"sunburst")),i.registerVisual(jRt),BRt(i)}var vZ={color:"fill",borderColor:"stroke"},$Rt={symbol:1,symbolSize:1,symbolKeepAspect:1,legendIcon:1,visualMeta:1,liftZ:1,decal:1},Ad=Wr(),ZRt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){this.currentZLevel=this.get("zlevel",!0),this.currentZ=this.get("z",!0)},t.prototype.getInitialData=function(e,r){return Hd(null,this)},t.prototype.getDataParams=function(e,r,n){var o=i.prototype.getDataParams.call(this,e,r);return n&&(o.info=Ad(n).info),o},t.type="series.custom",t.dependencies=["grid","polar","geo","singleAxis","calendar","matrix"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,clip:!1},t}(Ea);const qRt=ZRt;function XRt(i,t){return t=t||[0,0],ti(["x","y"],function(e,r){var n=this.getAxis(e),o=t[r],s=i[r]/2;return n.type==="category"?n.getBandWidth():Math.abs(n.dataToCoord(o-s)-n.dataToCoord(o+s))},this)}function YRt(i){var t=i.master.getRect();return{coordSys:{type:"cartesian2d",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e){return i.dataToPoint(e)},size:wi(XRt,i)}}}function KRt(i,t){return t=t||[0,0],ti([0,1],function(e){var r=t[e],n=i[e]/2,o=[],s=[];return o[e]=r-n,s[e]=r+n,o[1-e]=s[1-e]=t[1-e],Math.abs(this.dataToPoint(o)[e]-this.dataToPoint(s)[e])},this)}function JRt(i){var t=i.getBoundingRect();return{coordSys:{type:"geo",x:t.x,y:t.y,width:t.width,height:t.height,zoom:i.getZoom()},api:{coord:function(e){return i.dataToPoint(e)},size:wi(KRt,i)}}}function QRt(i,t){var e=this.getAxis(),r=t instanceof Array?t[0]:t,n=(i instanceof Array?i[0]:i)/2;return e.type==="category"?e.getBandWidth():Math.abs(e.dataToCoord(r-n)-e.dataToCoord(r+n))}function tkt(i){var t=i.getRect();return{coordSys:{type:"singleAxis",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e){return i.dataToPoint(e)},size:wi(QRt,i)}}}function ekt(i,t){return t=t||[0,0],ti(["Radius","Angle"],function(e,r){var n="get"+e+"Axis",o=this[n](),s=t[r],a=i[r]/2,u=o.type==="category"?o.getBandWidth():Math.abs(o.dataToCoord(s-a)-o.dataToCoord(s+a));return e==="Angle"&&(u=u*Math.PI/180),u},this)}function ikt(i){var t=i.getRadiusAxis(),e=i.getAngleAxis(),r=t.getExtent();return r[0]>r[1]&&r.reverse(),{coordSys:{type:"polar",cx:i.cx,cy:i.cy,r:r[1],r0:r[0]},api:{coord:function(n){var o=t.dataToRadius(n[0]),s=e.dataToAngle(n[1]),a=i.coordToPoint([o,s]);return a.push(o,s*Math.PI/180),a},size:wi(ekt,i)}}}function rkt(i){var t=i.getRect(),e=i.getRangeInfo();return{coordSys:{type:"calendar",x:t.x,y:t.y,width:t.width,height:t.height,cellWidth:i.getCellWidth(),cellHeight:i.getCellHeight(),rangeInfo:{start:e.start,end:e.end,weeks:e.weeks,dayCount:e.allDay}},api:{coord:function(r,n){return i.dataToPoint(r,n)},layout:function(r,n){return i.dataToLayout(r,n)}}}}function nkt(i){var t=i.getRect();return{coordSys:{type:"matrix",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e,r){return i.dataToPoint(e,r)},layout:function(e,r){return i.dataToLayout(e,r)}}}}function Git(i,t,e,r){return i&&(i.legacy||i.legacy!==!1&&!e&&!r&&t!=="tspan"&&(t==="text"||Di(i,"text")))}function Hit(i,t,e){var r=i,n,o,s;if(t==="text")s=r;else{s={},Di(r,"text")&&(s.text=r.text),Di(r,"rich")&&(s.rich=r.rich),Di(r,"textFill")&&(s.fill=r.textFill),Di(r,"textStroke")&&(s.stroke=r.textStroke),Di(r,"fontFamily")&&(s.fontFamily=r.fontFamily),Di(r,"fontSize")&&(s.fontSize=r.fontSize),Di(r,"fontStyle")&&(s.fontStyle=r.fontStyle),Di(r,"fontWeight")&&(s.fontWeight=r.fontWeight),o={type:"text",style:s,silent:!0},n={};var a=Di(r,"textPosition");e?n.position=a?r.textPosition:"inside":a&&(n.position=r.textPosition),Di(r,"textPosition")&&(n.position=r.textPosition),Di(r,"textOffset")&&(n.offset=r.textOffset),Di(r,"textRotation")&&(n.rotation=r.textRotation),Di(r,"textDistance")&&(n.distance=r.textDistance)}return _Z(s,i),gt(s.rich,function(u){_Z(u,u)}),{textConfig:n,textContent:o}}function _Z(i,t){t&&(t.font=t.textFont||t.font,Di(t,"textStrokeWidth")&&(i.lineWidth=t.textStrokeWidth),Di(t,"textAlign")&&(i.align=t.textAlign),Di(t,"textVerticalAlign")&&(i.verticalAlign=t.textVerticalAlign),Di(t,"textLineHeight")&&(i.lineHeight=t.textLineHeight),Di(t,"textWidth")&&(i.width=t.textWidth),Di(t,"textHeight")&&(i.height=t.textHeight),Di(t,"textBackgroundColor")&&(i.backgroundColor=t.textBackgroundColor),Di(t,"textPadding")&&(i.padding=t.textPadding),Di(t,"textBorderColor")&&(i.borderColor=t.textBorderColor),Di(t,"textBorderWidth")&&(i.borderWidth=t.textBorderWidth),Di(t,"textBorderRadius")&&(i.borderRadius=t.textBorderRadius),Di(t,"textBoxShadowColor")&&(i.shadowColor=t.textBoxShadowColor),Di(t,"textBoxShadowBlur")&&(i.shadowBlur=t.textBoxShadowBlur),Di(t,"textBoxShadowOffsetX")&&(i.shadowOffsetX=t.textBoxShadowOffsetX),Di(t,"textBoxShadowOffsetY")&&(i.shadowOffsetY=t.textBoxShadowOffsetY))}function yZ(i,t,e){var r=i;r.textPosition=r.textPosition||e.position||"inside",e.offset!=null&&(r.textOffset=e.offset),e.rotation!=null&&(r.textRotation=e.rotation),e.distance!=null&&(r.textDistance=e.distance);var n=r.textPosition.indexOf("inside")>=0,o=i.fill||_e.color.neutral99;xZ(r,t);var s=r.textFill==null;return n?s&&(r.textFill=e.insideFill||_e.color.neutral00,!r.textStroke&&e.insideStroke&&(r.textStroke=e.insideStroke),!r.textStroke&&(r.textStroke=o),r.textStrokeWidth==null&&(r.textStrokeWidth=2)):(s&&(r.textFill=i.fill||e.outsideFill||_e.color.neutral00),!r.textStroke&&e.outsideStroke&&(r.textStroke=e.outsideStroke)),r.text=t.text,r.rich=t.rich,gt(t.rich,function(a){xZ(a,a)}),r}function xZ(i,t){t&&(Di(t,"fill")&&(i.textFill=t.fill),Di(t,"stroke")&&(i.textStroke=t.fill),Di(t,"lineWidth")&&(i.textStrokeWidth=t.lineWidth),Di(t,"font")&&(i.font=t.font),Di(t,"fontStyle")&&(i.fontStyle=t.fontStyle),Di(t,"fontWeight")&&(i.fontWeight=t.fontWeight),Di(t,"fontSize")&&(i.fontSize=t.fontSize),Di(t,"fontFamily")&&(i.fontFamily=t.fontFamily),Di(t,"align")&&(i.textAlign=t.align),Di(t,"verticalAlign")&&(i.textVerticalAlign=t.verticalAlign),Di(t,"lineHeight")&&(i.textLineHeight=t.lineHeight),Di(t,"width")&&(i.textWidth=t.width),Di(t,"height")&&(i.textHeight=t.height),Di(t,"backgroundColor")&&(i.textBackgroundColor=t.backgroundColor),Di(t,"padding")&&(i.textPadding=t.padding),Di(t,"borderColor")&&(i.textBorderColor=t.borderColor),Di(t,"borderWidth")&&(i.textBorderWidth=t.borderWidth),Di(t,"borderRadius")&&(i.textBorderRadius=t.borderRadius),Di(t,"shadowColor")&&(i.textBoxShadowColor=t.shadowColor),Di(t,"shadowBlur")&&(i.textBoxShadowBlur=t.shadowBlur),Di(t,"shadowOffsetX")&&(i.textBoxShadowOffsetX=t.shadowOffsetX),Di(t,"shadowOffsetY")&&(i.textBoxShadowOffsetY=t.shadowOffsetY),Di(t,"textShadowColor")&&(i.textShadowColor=t.textShadowColor),Di(t,"textShadowBlur")&&(i.textShadowBlur=t.textShadowBlur),Di(t,"textShadowOffsetX")&&(i.textShadowOffsetX=t.textShadowOffsetX),Di(t,"textShadowOffsetY")&&(i.textShadowOffsetY=t.textShadowOffsetY))}var jit={position:["x","y"],scale:["scaleX","scaleY"],origin:["originX","originY"]},bZ=on(jit);yh(bh,function(i,t){return i[t]=1,i},{});bh.join(", ");var fC=["","style","shape","extra"],D0=Wr();function lN(i,t,e,r,n){var o=i+"Animation",s=U0(i,r,n)||{},a=D0(t).userDuring;return s.duration>0&&(s.during=a?wi(ckt,{el:t,userDuring:a}):null,s.setToFinal=!0,s.scope=i),Fe(s,e[o]),s}function tM(i,t,e,r){r=r||{};var n=r.dataIndex,o=r.isInit,s=r.clearStyle,a=e.isAnimationEnabled(),u=D0(i),f=t.style;u.userDuring=t.during;var g={},v={};if(hkt(i,t,v),i.type==="compound")for(var y=i.shape.paths,w=t.shape.paths,I=0;I<w.length;I++){var E=w[I];dk("shape",E,y[I])}else dk("shape",t,v),dk("extra",t,v);if(!o&&a&&(ukt(i,t,g),wZ("shape",i,t,g),wZ("extra",i,t,g),dkt(i,t,f,g)),v.style=f,akt(i,v,s),skt(i,t),a)if(o){var D={};gt(fC,function(z){var N=z?t[z]:t;N&&N.enterFrom&&(z&&(D[z]=D[z]||{}),Fe(z?D[z]:D,N.enterFrom))});var R=lN("enter",i,t,e,n);R.duration>0&&i.animateFrom(D,R)}else okt(i,t,n||0,e,g);Wit(i,t),f?i.dirty():i.markRedraw()}function Wit(i,t){for(var e=D0(i).leaveToProps,r=0;r<fC.length;r++){var n=fC[r],o=n?t[n]:t;o&&o.leaveTo&&(e||(e=D0(i).leaveToProps={}),n&&(e[n]=e[n]||{}),Fe(n?e[n]:e,o.leaveTo))}}function RE(i,t,e,r){if(i){var n=i.parent,o=D0(i).leaveToProps;if(o){var s=lN("update",i,t,e,0);s.done=function(){n&&n.remove(i),r&&r()},i.animateTo(o,s)}else n&&n.remove(i),r&&r()}}function cv(i){return i==="all"}function akt(i,t,e){var r=t.style;if(!i.isGroup&&r){if(e){i.useStyle({});for(var n=i.animators,o=0;o<n.length;o++){var s=n[o];s.targetName==="style"&&s.changeTarget(i.style)}}i.setStyle(r)}t&&(t.style=null,t&&i.attr(t),t.style=r)}function okt(i,t,e,r,n){if(n){var o=lN("update",i,t,r,e);o.duration>0&&i.animateFrom(n,o)}}function skt(i,t){Di(t,"silent")&&(i.silent=t.silent),Di(t,"ignore")&&(i.ignore=t.ignore),i instanceof kc&&Di(t,"invisible")&&(i.invisible=t.invisible),i instanceof qr&&Di(t,"autoBatch")&&(i.autoBatch=t.autoBatch)}var Ku={},lkt={setTransform:function(i,t){return Ku.el[i]=t,this},getTransform:function(i){return Ku.el[i]},setShape:function(i,t){var e=Ku.el,r=e.shape||(e.shape={});return r[i]=t,e.dirtyShape&&e.dirtyShape(),this},getShape:function(i){var t=Ku.el.shape;if(t)return t[i]},setStyle:function(i,t){var e=Ku.el,r=e.style;return r&&(r[i]=t,e.dirtyStyle&&e.dirtyStyle()),this},getStyle:function(i){var t=Ku.el.style;if(t)return t[i]},setExtra:function(i,t){var e=Ku.el.extra||(Ku.el.extra={});return e[i]=t,this},getExtra:function(i){var t=Ku.el.extra;if(t)return t[i]}};function ckt(){var i=this,t=i.el;if(t){var e=D0(t).userDuring,r=i.userDuring;if(e!==r){i.el=i.userDuring=null;return}Ku.el=t,r(lkt)}}function wZ(i,t,e,r){var n=e[i];if(n){var o=t[i],s;if(o){var a=e.transition,u=n.transition;if(u)if(!s&&(s=r[i]={}),cv(u))Fe(s,o);else for(var f=na(u),g=0;g<f.length;g++){var v=f[g],y=o[v];s[v]=y}else if(cv(a)||Ar(a,i)>=0){!s&&(s=r[i]={});for(var w=on(o),g=0;g<w.length;g++){var v=w[g],y=o[v];fkt(n[v],y)&&(s[v]=y)}}}}}function dk(i,t,e){var r=t[i];if(r)for(var n=e[i]={},o=on(r),s=0;s<o.length;s++){var a=o[s];n[a]=Tw(r[a])}}function ukt(i,t,e){for(var r=t.transition,n=cv(r)?bh:na(r||[]),o=0;o<n.length;o++){var s=n[o];if(!(s==="style"||s==="shape"||s==="extra")){var a=i[s];e[s]=a}}}function hkt(i,t,e){for(var r=0;r<bZ.length;r++){var n=bZ[r],o=jit[n],s=t[n];s&&(e[o[0]]=s[0],e[o[1]]=s[1])}for(var r=0;r<bh.length;r++){var a=bh[r];t[a]!=null&&(e[a]=t[a])}}function dkt(i,t,e,r){if(e){var n=i.style,o;if(n){var s=e.transition,a=t.transition;if(s&&!cv(s)){var u=na(s);!o&&(o=r.style={});for(var f=0;f<u.length;f++){var g=u[f],v=n[g];o[g]=v}}else if(i.getAnimationStyleProps&&(cv(a)||cv(s)||Ar(a,"style")>=0)){var y=i.getAnimationStyleProps(),w=y?y.style:null;if(w){!o&&(o=r.style={});for(var I=on(e),f=0;f<I.length;f++){var g=I[f];if(w[g]){var v=n[g];o[g]=v}}}}}}}function fkt(i,t){return Ns(i)?i!==t:i!=null&&isFinite(i)}var $it=Wr(),pkt=["percent","easing","shape","style","extra"];function Zit(i){i.stopAnimation("keyframe"),i.attr($it(i))}function pC(i,t,e){if(!(!e.isAnimationEnabled()||!t)){if(Ye(t)){gt(t,function(a){pC(i,a,e)});return}var r=t.keyframes,n=t.duration;if(e&&n==null){var o=U0("enter",e,0);n=o&&o.duration}if(!(!r||!n)){var s=$it(i);gt(fC,function(a){if(!(a&&!i[a])){var u;r.sort(function(f,g){return f.percent-g.percent}),gt(r,function(f){var g=i.animators,v=a?f[a]:f;if(v){var y=on(v);if(a||(y=Rn(y,function(E){return Ar(pkt,E)<0})),!!y.length){u||(u=i.animate(a,t.loop,!0),u.scope="keyframe");for(var w=0;w<g.length;w++)g[w]!==u&&g[w].targetName===u.targetName&&g[w].stopTracks(y);a&&(s[a]=s[a]||{});var I=a?s[a]:s;gt(y,function(E){I[E]=((a?i[a]:i)||{})[E]}),u.whenWithKeys(n*f.percent,v,y,f.easing)}}}),u&&u.delay(t.delay||0).duration(n).start(t.easing)}})}}}var Id="emphasis",gp="normal",cN="blur",uN="select",Bp=[gp,Id,cN,uN],fk={normal:["itemStyle"],emphasis:[Id,"itemStyle"],blur:[cN,"itemStyle"],select:[uN,"itemStyle"]},pk={normal:["label"],emphasis:[Id,"label"],blur:[cN,"label"],select:[uN,"label"]},gkt=["x","y"],mkt="e\0\0",yc={normal:{},emphasis:{},blur:{},select:{}},vkt={cartesian2d:YRt,geo:JRt,single:tkt,polar:ikt,calendar:rkt,matrix:nkt};function oB(i){return i instanceof qr}function sB(i){return i instanceof kc}function _kt(i,t){t.copyTransform(i),sB(t)&&sB(i)&&(t.setStyle(i.style),t.z=i.z,t.z2=i.z2,t.zlevel=i.zlevel,t.invisible=i.invisible,t.ignore=i.ignore,oB(t)&&oB(i)&&t.setShape(i.shape))}var ykt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){this._progressiveEls=null;var s=this._data,a=e.getData(),u=this.group,f=SZ(e,a,r,n);s||u.removeAll(),a.diff(s).add(function(v){gk(n,null,v,f(v,o),e,u,a)}).remove(function(v){var y=s.getItemGraphicEl(v);y&&RE(y,Ad(y).option,e)}).update(function(v,y){var w=s.getItemGraphicEl(y);gk(n,w,v,f(v,o),e,u,a)}).execute();var g=e.get("clip",!0)?$S(e.coordinateSystem,!1,e):null;g?u.setClipPath(g):u.removeClipPath(),this._data=a},t.prototype.incrementalPrepareRender=function(e,r,n){this.group.removeAll(),this._data=null},t.prototype.incrementalRender=function(e,r,n,o,s){var a=r.getData(),u=SZ(r,a,n,o),f=this._progressiveEls=[];function g(w){w.isGroup||(w.incremental=!0,w.ensureState("emphasis").hoverLayer=!0)}for(var v=e.start;v<e.end;v++){var y=gk(null,null,v,u(v,s),r,this.group,a);y&&(y.traverse(g),f.push(y))}},t.prototype.eachRendered=function(e){Hp(this._progressiveEls||this.group,e)},t.prototype.filterForExposedEvent=function(e,r,n,o){var s=r.element;if(s==null||n.name===s)return!0;for(;(n=n.__hostTarget||n.parent)&&n!==this.group;)if(n.name===s)return!0;return!1},t.type="custom",t}(pa);const xkt=ykt;function hN(i){var t=i.type,e;if(t==="path"){var r=i.shape,n=r.width!=null&&r.height!=null?{x:r.x||0,y:r.y||0,width:r.width,height:r.height}:null,o=Yit(r);e=rS(o,null,n,r.layout||"center"),Ad(e).customPathData=o}else if(t==="image")e=new ys({}),Ad(e).customImagePath=i.style.image;else if(t==="text")e=new _n({});else if(t==="group")e=new Ki;else if(t==="compoundPath"){var r=i.shape;if(!r||!r.paths){var s="";Dn(s)}var a=ti(r.paths,function(g){if(g.type==="path")return rS(g.shape.pathData,g,null);var v=BM(g.type);if(!v){var y="";Dn(y)}return new v});e=new dE({shape:{paths:a}})}else{var u=BM(t);if(!u){var s="";Dn(s)}e=new u}return Ad(e).customGraphicType=t,e.name=i.name,e.z2EmphasisLift=1,e.z2SelectLift=1,e}function dN(i,t,e,r,n,o,s){Zit(t);var a=n&&n.normal.cfg;a&&t.setTextConfig(a),r&&r.transition==null&&(r.transition=gkt);var u=r&&r.style;if(u){if(t.type==="text"){var f=u;Di(f,"textFill")&&(f.fill=f.textFill),Di(f,"textStroke")&&(f.stroke=f.textStroke)}var g=void 0,v=oB(t)?u.decal:null;i&&v&&(v.dirty=!0,g=S0(v,i)),u.__decalPattern=g}if(sB(t)&&u){var g=u.__decalPattern;g&&(u.decal=g)}tM(t,r,o,{dataIndex:e,isInit:s,clearStyle:!0}),pC(t,r.keyframeAnimation,o)}function qit(i,t,e,r,n){var o=t.isGroup?null:t,s=n&&n[i].cfg;if(o){var a=o.ensureState(i);if(r===!1){var u=o.getState(i);u&&(u.style=null)}else a.style=r||null;s&&(a.textConfig=s),gv(o)}}function bkt(i,t,e){if(!i.isGroup){var r=i,n=e.currentZ,o=e.currentZLevel;r.z=n,r.zlevel=o;var s=t.z2;s!=null&&(r.z2=s||0);for(var a=0;a<Bp.length;a++)wkt(r,t,Bp[a])}}function wkt(i,t,e){var r=e===gp,n=r?t:gC(t,e),o=n?n.z2:null,s;o!=null&&(s=r?i:i.ensureState(e),s.z2=o||0)}function SZ(i,t,e,r){var n=i.get("renderItem");if(typeof n=="string"){var o=Nwt(n);o&&(n=o)}var s=i.coordinateSystem,a={};s&&(a=s.prepareCustoms?s.prepareCustoms(s):vkt[s.type](s));for(var u=rr({getWidth:r.getWidth,getHeight:r.getHeight,getZr:r.getZr,getDevicePixelRatio:r.getDevicePixelRatio,value:$,style:K,ordinalRawValue:X,styleEmphasis:et,visual:ht,barLayout:yt,currentSeriesIndices:ft,font:kt},a.api||{}),f={context:{},seriesId:i.id,seriesName:i.name,seriesIndex:i.seriesIndex,coordSys:a.coordSys,dataInsideLength:t.count(),encode:Skt(i.getData()),itemPayload:i.get("itemPayload")||{}},g,v,y={},w={},I={},E={},D=0;D<Bp.length;D++){var R=Bp[D];I[R]=i.getModel(fk[R]),E[R]=i.getModel(pk[R])}function z(Rt){return Rt===g?v||(v=t.getItemModel(Rt)):t.getItemModel(Rt)}function N(Rt,Ct){return t.hasItemOption?Rt===g?y[Ct]||(y[Ct]=z(Rt).getModel(fk[Ct])):z(Rt).getModel(fk[Ct]):I[Ct]}function H(Rt,Ct){return t.hasItemOption?Rt===g?w[Ct]||(w[Ct]=z(Rt).getModel(pk[Ct])):z(Rt).getModel(pk[Ct]):E[Ct]}return function(Rt,Ct){return g=Rt,v=null,y={},w={},n&&n(rr({dataIndexInside:Rt,dataIndex:t.getRawIndex(Rt),actionType:Ct?Ct.type:null},f),u)};function $(Rt,Ct){return Ct==null&&(Ct=g),t.getStore().get(t.getDimensionIndex(Rt||0),Ct)}function X(Rt,Ct){Ct==null&&(Ct=g),Rt=Rt||0;var Gt=t.getDimensionInfo(Rt);if(!Gt){var Vt=t.getDimensionIndex(Rt);return Vt>=0?t.getStore().get(Vt,Ct):void 0}var Qt=t.get(Gt.name,Ct),fe=Gt&&Gt.ordinalMeta;return fe?fe.categories[Qt]:Qt}function K(Rt,Ct){Ct==null&&(Ct=g);var Gt=t.getItemVisual(Ct,"style"),Vt=Gt&&Gt.fill,Qt=Gt&&Gt.opacity,fe=N(Ct,gp).getItemStyle();Vt!=null&&(fe.fill=Vt),Qt!=null&&(fe.opacity=Qt);var Te={inheritColor:bi(Vt)?Vt:_e.color.neutral99},be=H(Ct,gp),Ge=fa(be,null,Te,!1,!0);Ge.text=be.getShallow("show")?Ui(i.getFormattedLabel(Ct,gp),I0(t,Ct)):null;var li=FM(be,Te,!1);return lt(Rt,fe),fe=yZ(fe,Ge,li),Rt&&rt(fe,Rt),fe.legacy=!0,fe}function et(Rt,Ct){Ct==null&&(Ct=g);var Gt=N(Ct,Id).getItemStyle(),Vt=H(Ct,Id),Qt=fa(Vt,null,null,!0,!0);Qt.text=Vt.getShallow("show")?ic(i.getFormattedLabel(Ct,Id),i.getFormattedLabel(Ct,gp),I0(t,Ct)):null;var fe=FM(Vt,null,!0);return lt(Rt,Gt),Gt=yZ(Gt,Qt,fe),Rt&&rt(Gt,Rt),Gt.legacy=!0,Gt}function rt(Rt,Ct){for(var Gt in Ct)Di(Ct,Gt)&&(Rt[Gt]=Ct[Gt])}function lt(Rt,Ct){Rt&&(Rt.textFill&&(Ct.textFill=Rt.textFill),Rt.textPosition&&(Ct.textPosition=Rt.textPosition))}function ht(Rt,Ct){if(Ct==null&&(Ct=g),Di(vZ,Rt)){var Gt=t.getItemVisual(Ct,"style");return Gt?Gt[vZ[Rt]]:null}if(Di($Rt,Rt))return t.getItemVisual(Ct,Rt)}function yt(Rt){if(s.type==="cartesian2d"){var Ct=s.getBaseAxis();return VSt(rr({axis:Ct},Rt))}}function ft(){return e.getCurrentSeriesIndices()}function kt(Rt){return WF(Rt,e)}}function Skt(i){var t={};return gt(i.dimensions,function(e){var r=i.getDimensionInfo(e);if(!r.isExtraCoord){var n=r.coordDim,o=t[n]=t[n]||[];o[r.coordDimIndex]=i.getDimensionIndex(e)}}),t}function gk(i,t,e,r,n,o,s){if(!r){o.remove(t);return}var a=fN(i,t,e,r,n,o);return a&&s.setItemGraphicEl(e,a),a&&Ma(a,r.focus,r.blurScope,r.emphasisDisabled),a}function fN(i,t,e,r,n,o){var s=-1,a=t;t&&Xit(t,r,n)&&(s=Ar(o.childrenRef(),t),t=null);var u=!t,f=t;f?f.clearStates():(f=hN(r),a&&_kt(a,f)),r.morph===!1?f.disableMorphing=!0:f.disableMorphing&&(f.disableMorphing=!1),r.tooltipDisabled&&(f.tooltipDisabled=!0),yc.normal.cfg=yc.normal.conOpt=yc.emphasis.cfg=yc.emphasis.conOpt=yc.blur.cfg=yc.blur.conOpt=yc.select.cfg=yc.select.conOpt=null,yc.isLegacy=!1,Akt(f,e,r,n,u,yc),Tkt(f,e,r,n,u),dN(i,f,e,r,yc,n,u),Di(r,"info")&&(Ad(f).info=r.info);for(var g=0;g<Bp.length;g++){var v=Bp[g];if(v!==gp){var y=gC(r,v),w=pN(r,y,v);qit(v,f,y,w,yc)}}return bkt(f,r,n),r.type==="group"&&Ikt(i,f,e,r,n),s>=0?o.replaceAt(f,s):o.add(f),f}function Xit(i,t,e){var r=Ad(i),n=t.type,o=t.shape,s=t.style;return e.isUniversalTransitionEnabled()||n!=null&&n!==r.customGraphicType||n==="path"&&Dkt(o)&&Yit(o)!==r.customPathData||n==="image"&&Di(s,"image")&&s.image!==r.customImagePath}function Tkt(i,t,e,r,n){var o=e.clipPath;if(o===!1)i&&i.getClipPath()&&i.removeClipPath();else if(o){var s=i.getClipPath();s&&Xit(s,o,r)&&(s=null),s||(s=hN(o),i.setClipPath(s)),dN(null,s,t,o,null,r,n)}}function Akt(i,t,e,r,n,o){if(!(i.isGroup||i.type==="compoundPath")){TZ(e,null,o),TZ(e,Id,o);var s=o.normal.conOpt,a=o.emphasis.conOpt,u=o.blur.conOpt,f=o.select.conOpt;if(s!=null||a!=null||f!=null||u!=null){var g=i.getTextContent();if(s===!1)g&&i.removeTextContent();else{s=o.normal.conOpt=s||{type:"text"},g?g.clearStates():(g=hN(s),i.setTextContent(g)),dN(null,g,t,s,null,r,n);for(var v=s&&s.style,y=0;y<Bp.length;y++){var w=Bp[y];if(w!==gp){var I=o[w].conOpt;qit(w,g,I,pN(s,I,w),null)}}v?g.dirty():g.markRedraw()}}}}function TZ(i,t,e){var r=t?gC(i,t):i,n=t?pN(i,r,Id):i.style,o=i.type,s=r?r.textConfig:null,a=i.textContent,u=a?t?gC(a,t):a:null;if(n&&(e.isLegacy||Git(n,o,!!s,!!u))){e.isLegacy=!0;var f=Hit(n,o,!t);!s&&f.textConfig&&(s=f.textConfig),!u&&f.textContent&&(u=f.textContent)}if(!t&&u){var g=u;!g.type&&(g.type="text")}var v=t?e[t]:e.normal;v.cfg=s,v.conOpt=u}function gC(i,t){return t?i?i[t]:null:i}function pN(i,t,e){var r=t&&t.style;return r==null&&e===Id&&i&&(r=i.styleEmphasis),r}function Ikt(i,t,e,r,n){var o=r.children,s=o?o.length:0,a=r.$mergeChildren,u=a==="byName"||r.diffChildrenByName,f=a===!1;if(!(!s&&!u&&!f)){if(u){Ckt({api:i,oldChildren:t.children()||[],newChildren:o||[],dataIndex:e,seriesModel:n,group:t});return}f&&t.removeAll();for(var g=0;g<s;g++){var v=o[g],y=t.childAt(g);v?(v.ignore==null&&(v.ignore=!1),fN(i,y,e,v,n,t)):y.ignore=!0}for(var w=t.childCount()-1;w>=g;w--){var I=t.childAt(w);Mkt(t,I,n)}}}function Mkt(i,t,e){t&&RE(t,Ad(i).option,e)}function Ckt(i){new Od(i.oldChildren,i.newChildren,AZ,AZ,i).add(IZ).update(IZ).remove(Ekt).execute()}function AZ(i,t){var e=i&&i.name;return e??mkt+t}function IZ(i,t){var e=this.context,r=i!=null?e.newChildren[i]:null,n=t!=null?e.oldChildren[t]:null;fN(e.api,n,e.dataIndex,r,e.seriesModel,e.group)}function Ekt(i){var t=this.context,e=t.oldChildren[i];e&&RE(e,Ad(e).option,t.seriesModel)}function Yit(i){return i&&(i.pathData||i.d)}function Dkt(i){return i&&(Di(i,"pathData")||Di(i,"d"))}function Pkt(i){i.registerChartView(xkt),i.registerSeriesModel(qRt)}var Bm=Wr(),MZ=Yi,mk=wi,Lkt=function(){function i(){this._dragging=!1,this.animationThreshold=15}return i.prototype.render=function(t,e,r,n){var o=e.get("value"),s=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=r,!(!n&&this._lastValue===o&&this._lastStatus===s)){this._lastValue=o,this._lastStatus=s;var a=this._group,u=this._handle;if(!s||s==="hide"){a&&a.hide(),u&&u.hide();return}a&&a.show(),u&&u.show();var f={};this.makeElOption(f,o,t,e,r);var g=f.graphicKey;g!==this._lastGraphicKey&&this.clear(r),this._lastGraphicKey=g;var v=this._moveAnimation=this.determineAnimation(t,e);if(!a)a=this._group=new Ki,this.createPointerEl(a,f,t,e),this.createLabelEl(a,f,t,e),r.getZr().add(a);else{var y=br(CZ,e,v);this.updatePointerEl(a,f,y),this.updateLabelEl(a,f,y,e)}DZ(a,e,!0),this._renderHandle(o)}},i.prototype.remove=function(t){this.clear(t)},i.prototype.dispose=function(t){this.clear(t)},i.prototype.determineAnimation=function(t,e){var r=e.get("animation"),n=t.axis,o=n.type==="category",s=e.get("snap");if(!s&&!o)return!1;if(r==="auto"||r==null){var a=this.animationThreshold;if(o&&n.getBandWidth()>a)return!0;if(s){var u=O3(t).seriesDataCount,f=n.getExtent();return Math.abs(f[0]-f[1])/u>a}return!1}return r===!0},i.prototype.makeElOption=function(t,e,r,n,o){},i.prototype.createPointerEl=function(t,e,r,n){var o=e.pointer;if(o){var s=Bm(t).pointerEl=new Tv[o.type](MZ(e.pointer));t.add(s)}},i.prototype.createLabelEl=function(t,e,r,n){if(e.label){var o=Bm(t).labelEl=new _n(MZ(e.label));t.add(o),EZ(o,n)}},i.prototype.updatePointerEl=function(t,e,r){var n=Bm(t).pointerEl;n&&e.pointer&&(n.setStyle(e.pointer.style),r(n,{shape:e.pointer.shape}))},i.prototype.updateLabelEl=function(t,e,r,n){var o=Bm(t).labelEl;o&&(o.setStyle(e.label.style),r(o,{x:e.label.x,y:e.label.y}),EZ(o,n))},i.prototype._renderHandle=function(t){if(!(this._dragging||!this.updateHandleTransform)){var e=this._axisPointerModel,r=this._api.getZr(),n=this._handle,o=e.getModel("handle"),s=e.get("status");if(!o.get("show")||!s||s==="hide"){n&&r.remove(n),this._handle=null;return}var a;this._handle||(a=!0,n=this._handle=BS(o.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(f){Pd(f.event)},onmousedown:mk(this._onHandleDragMove,this,0,0),drift:mk(this._onHandleDragMove,this),ondragend:mk(this._onHandleDragEnd,this)}),r.add(n)),DZ(n,e,!1),n.setStyle(o.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var u=o.get("size");Ye(u)||(u=[u,u]),n.scaleX=u[0]/2,n.scaleY=u[1]/2,$0(this,"_doDispatchAxisPointer",o.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,a)}},i.prototype._moveHandleToValue=function(t,e){CZ(this._axisPointerModel,!e&&this._moveAnimation,this._handle,vk(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},i.prototype._onHandleDragMove=function(t,e){var r=this._handle;if(r){this._dragging=!0;var n=this.updateHandleTransform(vk(r),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=n,r.stopAnimation(),r.attr(vk(n)),Bm(r).lastProp=null,this._doDispatchAxisPointer()}},i.prototype._doDispatchAxisPointer=function(){var t=this._handle;if(t){var e=this._payloadInfo,r=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:e.cursorPoint[0],y:e.cursorPoint[1],tooltipOption:e.tooltipOption,axesInfo:[{axisDim:r.axis.dim,axisIndex:r.componentIndex}]})}},i.prototype._onHandleDragEnd=function(){this._dragging=!1;var t=this._handle;if(t){var e=this._axisPointerModel.get("value");this._moveHandleToValue(e),this._api.dispatchAction({type:"hideTip"})}},i.prototype.clear=function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),r=this._group,n=this._handle;e&&r&&(this._lastGraphicKey=null,r&&e.remove(r),n&&e.remove(n),this._group=null,this._handle=null,this._payloadInfo=null),sS(this,"_doDispatchAxisPointer")},i.prototype.doClear=function(){},i.prototype.buildLabel=function(t,e,r){return r=r||0,{x:t[r],y:t[1-r],width:e[r],height:e[1-r]}},i}();function CZ(i,t,e,r){Kit(Bm(e).lastProp,r)||(Bm(e).lastProp=r,t?yn(e,r,i):(e.stopAnimation(),e.attr(r)))}function Kit(i,t){if(nr(i)&&nr(t)){var e=!0;return gt(t,function(r,n){e=e&&Kit(i[n],r)}),!!e}else return i===t}function EZ(i,t){i[t.get(["label","show"])?"show":"hide"]()}function vk(i){return{x:i.x||0,y:i.y||0,rotation:i.rotation||0}}function DZ(i,t,e){var r=t.get("z"),n=t.get("zlevel");i&&i.traverse(function(o){o.type!=="group"&&(r!=null&&(o.z=r),n!=null&&(o.zlevel=n),o.silent=e)})}const gN=Lkt;function mN(i){var t=i.get("type"),e=i.getModel(t+"Style"),r;return t==="line"?(r=e.getLineStyle(),r.fill=null):t==="shadow"&&(r=e.getAreaStyle(),r.stroke=null),r}function Jit(i,t,e,r,n){var o=e.get("value"),s=Qit(o,t.axis,t.ecModel,e.get("seriesDataIndices"),{precision:e.get(["label","precision"]),formatter:e.get(["label","formatter"])}),a=e.getModel("label"),u=FS(a.get("padding")||0),f=a.getFont(),g=eE(s,f),v=n.position,y=g.width+u[1]+u[3],w=g.height+u[0]+u[2],I=n.align;I==="right"&&(v[0]-=y),I==="center"&&(v[0]-=y/2);var E=n.verticalAlign;E==="bottom"&&(v[1]-=w),E==="middle"&&(v[1]-=w/2),Rkt(v,y,w,r);var D=a.get("backgroundColor");(!D||D==="auto")&&(D=t.get(["axisLine","lineStyle","color"])),i.label={x:v[0],y:v[1],style:fa(a,{text:s,font:f,fill:a.getTextColor(),padding:u,backgroundColor:D}),z2:10}}function Rkt(i,t,e,r){var n=r.getWidth(),o=r.getHeight();i[0]=Math.min(i[0]+t,n)-t,i[1]=Math.min(i[1]+e,o)-e,i[0]=Math.max(i[0],0),i[1]=Math.max(i[1],0)}function Qit(i,t,e,r,n){i=t.scale.parse(i);var o=t.scale.getLabel({value:i},{precision:n.precision}),s=n.formatter;if(s){var a={value:XM(t,{value:i}),axisDimension:t.dim,axisIndex:t.index,seriesData:[]};gt(r,function(u){var f=e.getSeriesByIndex(u.seriesIndex),g=u.dataIndexInside,v=f&&f.getDataParams(g);v&&a.seriesData.push(v)}),bi(s)?o=s.replace("{value}",o):Xi(s)&&(o=s(a))}return o}function vN(i,t,e){var r=ns();return Up(r,r,e.rotation),xh(r,r,e.position),du([i.dataToCoord(t),(e.labelOffset||0)+(e.labelDirection||1)*(e.labelMargin||0)],r)}function trt(i,t,e,r,n,o){var s=zd.innerTextLayout(e.rotation,0,e.labelDirection);e.labelMargin=n.get(["label","margin"]),Jit(t,r,n,o,{position:vN(r.axis,i,e),align:s.textAlign,verticalAlign:s.textVerticalAlign})}function _N(i,t,e){return e=e||0,{x1:i[e],y1:i[1-e],x2:t[e],y2:t[1-e]}}function ert(i,t,e){return e=e||0,{x:i[e],y:i[1-e],width:t[e],height:t[1-e]}}function PZ(i,t,e,r,n,o){return{cx:i,cy:t,r0:e,r,startAngle:n,endAngle:o,clockwise:!0}}var kkt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,r,n,o,s){var a=n.axis,u=a.grid,f=o.get("type"),g=LZ(u,a).getOtherAxis(a).getGlobalExtent(),v=a.toGlobalCoord(a.dataToCoord(r,!0));if(f&&f!=="none"){var y=mN(o),w=Okt[f](a,v,g);w.style=y,e.graphicKey=w.type,e.pointer=w}var I=oC(u.getRect(),n);trt(r,e,I,n,o,s)},t.prototype.getHandleTransform=function(e,r,n){var o=oC(r.axis.grid.getRect(),r,{labelInside:!1});o.labelMargin=n.get(["handle","margin"]);var s=vN(r.axis,e,o);return{x:s[0],y:s[1],rotation:o.rotation+(o.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,r,n,o){var s=n.axis,a=s.grid,u=s.getGlobalExtent(!0),f=LZ(a,s).getOtherAxis(s).getGlobalExtent(),g=s.dim==="x"?0:1,v=[e.x,e.y];v[g]+=r[g],v[g]=Math.min(u[1],v[g]),v[g]=Math.max(u[0],v[g]);var y=(f[1]+f[0])/2,w=[y,y];w[g]=v[g];var I=[{verticalAlign:"middle"},{align:"center"}];return{x:v[0],y:v[1],rotation:e.rotation,cursorPoint:w,tooltipOption:I[g]}},t}(gN);function LZ(i,t){var e={};return e[t.dim+"AxisIndex"]=t.index,i.getCartesian(e)}var Okt={line:function(i,t,e){var r=_N([t,e[0]],[t,e[1]],RZ(i));return{type:"Line",subPixelOptimize:!0,shape:r}},shadow:function(i,t,e){var r=Math.max(1,i.getBandWidth()),n=e[1]-e[0];return{type:"Rect",shape:ert([t-r/2,e[0]],[r,n],RZ(i))}}};function RZ(i){return i.dim==="x"?0:1}const zkt=kkt;var Bkt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="axisPointer",t.defaultOption={show:"auto",z:50,type:"line",snap:!1,triggerTooltip:!0,triggerEmphasis:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:_e.color.border,width:1,type:"dashed"},shadowStyle:{color:_e.color.shadowTint},label:{show:!0,formatter:null,precision:"auto",margin:3,color:_e.color.neutral00,padding:[5,7,5,7],backgroundColor:_e.color.accent60,borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:_e.color.accent40,throttle:40}},t}(gn);const Fkt=Bkt;var xd=Wr(),Nkt=gt;function irt(i,t,e){if(!Sn.node){var r=t.getZr();xd(r).records||(xd(r).records={}),Vkt(r,t);var n=xd(r).records[i]||(xd(r).records[i]={});n.handler=e}}function Vkt(i,t){if(xd(i).initialized)return;xd(i).initialized=!0,e("click",br(kZ,"click")),e("mousemove",br(kZ,"mousemove")),e("globalout",Gkt);function e(r,n){i.on(r,function(o){var s=Hkt(t);Nkt(xd(i).records,function(a){a&&n(a,o,s.dispatchAction)}),Ukt(s.pendings,t)})}}function Ukt(i,t){var e=i.showTip.length,r=i.hideTip.length,n;e?n=i.showTip[e-1]:r&&(n=i.hideTip[r-1]),n&&(n.dispatchAction=null,t.dispatchAction(n))}function Gkt(i,t,e){i.handler("leave",null,e)}function kZ(i,t,e,r){t.handler(i,e,r)}function Hkt(i){var t={showTip:[],hideTip:[]},e=function(r){var n=t[r.type];n?n.push(r):(r.dispatchAction=e,i.dispatchAction(r))};return{dispatchAction:e,pendings:t}}function lB(i,t){if(!Sn.node){var e=t.getZr(),r=(xd(e).records||{})[i];r&&(xd(e).records[i]=null)}}var jkt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=r.getComponent("tooltip"),s=e.get("triggerOn")||o&&o.get("triggerOn")||"mousemove|click";irt("axisPointer",n,function(a,u,f){s!=="none"&&(a==="leave"||s.indexOf(a)>=0)&&f({type:"updateAxisPointer",currTrigger:a,x:u&&u.offsetX,y:u&&u.offsetY})})},t.prototype.remove=function(e,r){lB("axisPointer",r)},t.prototype.dispose=function(e,r){lB("axisPointer",r)},t.type="axisPointer",t}(Oa);const Wkt=jkt;function rrt(i,t){var e=[],r=i.seriesIndex,n;if(r==null||!(n=t.getSeriesByIndex(r)))return{point:[]};var o=n.getData(),s=fv(o,i);if(s==null||s<0||Ye(s))return{point:[]};var a=o.getItemGraphicEl(s),u=n.coordinateSystem;if(n.getTooltipPosition)e=n.getTooltipPosition(s)||[];else if(u&&u.dataToPoint)if(i.isStacked){var f=u.getBaseAxis(),g=u.getOtherAxis(f),v=g.dim,y=f.dim,w=v==="x"||v==="radius"?1:0,I=o.mapDimension(y),E=[];E[w]=o.get(I,s),E[1-w]=o.get(o.getCalculationInfo("stackResultDimension"),s),e=u.dataToPoint(E)||[]}else e=u.dataToPoint(o.getValues(ti(u.dimensions,function(R){return o.mapDimension(R)}),s))||[];else if(a){var D=a.getBoundingRect().clone();D.applyTransform(a.transform),e=[D.x+D.width/2,D.y+D.height/2]}return{point:e,el:a}}var OZ=Wr();function $kt(i,t,e){var r=i.currTrigger,n=[i.x,i.y],o=i,s=i.dispatchAction||wi(e.dispatchAction,e),a=t.getComponent("axisPointer").coordSysAxesInfo;if(a){eM(n)&&(n=rrt({seriesIndex:o.seriesIndex,dataIndex:o.dataIndex},t).point);var u=eM(n),f=o.axesInfo,g=a.axesInfo,v=r==="leave"||eM(n),y={},w={},I={list:[],map:{}},E={showPointer:br(qkt,w),showTooltip:br(Xkt,I)};gt(a.coordSysMap,function(R,z){var N=u||R.containPoint(n);gt(a.coordSysAxesInfo[z],function(H,$){var X=H.axis,K=Qkt(f,H);if(!v&&N&&(!f||K)){var et=K&&K.value;et==null&&!u&&(et=X.pointToData(n)),et!=null&&zZ(H,et,E,!1,y)}})});var D={};return gt(g,function(R,z){var N=R.linkGroup;N&&!w[z]&&gt(N.axesInfo,function(H,$){var X=w[$];if(H!==R&&X){var K=X.value;N.mapper&&(K=R.axis.scale.parse(N.mapper(K,BZ(H),BZ(R)))),D[R.key]=K}})}),gt(D,function(R,z){zZ(g[z],R,E,!0,y)}),Ykt(w,g,y),Kkt(I,n,i,s),Jkt(g,s,e),y}}function zZ(i,t,e,r,n){var o=i.axis;if(!(o.scale.isBlank()||!o.containData(t))){if(!i.involveSeries){e.showPointer(i,t);return}var s=Zkt(t,i),a=s.payloadBatch,u=s.snapToValue;a[0]&&n.seriesIndex==null&&Fe(n,a[0]),!r&&i.snap&&o.containData(u)&&u!=null&&(t=u),e.showPointer(i,t,a),e.showTooltip(i,s,u)}}function Zkt(i,t){var e=t.axis,r=e.dim,n=i,o=[],s=Number.MAX_VALUE,a=-1;return gt(t.seriesModels,function(u,f){var g=u.getData().mapDimensionsAll(r),v,y;if(u.getAxisTooltipData){var w=u.getAxisTooltipData(g,i,e);y=w.dataIndices,v=w.nestestValue}else{if(y=u.indicesOfNearest(r,g[0],i,e.type==="category"?.5:null),!y.length)return;v=u.getData().get(g[0],y[0])}if(!(v==null||!isFinite(v))){var I=i-v,E=Math.abs(I);E<=s&&((E<s||I>=0&&a<0)&&(s=E,a=I,n=v,o.length=0),gt(y,function(D){o.push({seriesIndex:u.seriesIndex,dataIndexInside:D,dataIndex:u.getData().getRawIndex(D)})}))}}),{payloadBatch:o,snapToValue:n}}function qkt(i,t,e,r){i[t.key]={value:e,payloadBatch:r}}function Xkt(i,t,e,r){var n=e.payloadBatch,o=t.axis,s=o.model,a=t.axisPointerModel;if(!(!t.triggerTooltip||!n.length)){var u=t.coordSys.model,f=mS(u),g=i.map[f];g||(g=i.map[f]={coordSysId:u.id,coordSysIndex:u.componentIndex,coordSysType:u.type,coordSysMainType:u.mainType,dataByAxis:[]},i.list.push(g)),g.dataByAxis.push({axisDim:o.dim,axisIndex:s.componentIndex,axisType:s.type,axisId:s.id,value:r,valueLabelOpt:{precision:a.get(["label","precision"]),formatter:a.get(["label","formatter"])},seriesDataIndices:n.slice()})}}function Ykt(i,t,e){var r=e.axesInfo=[];gt(t,function(n,o){var s=n.axisPointerModel.option,a=i[o];a?(!n.useHandle&&(s.status="show"),s.value=a.value,s.seriesDataIndices=(a.payloadBatch||[]).slice()):!n.useHandle&&(s.status="hide"),s.status==="show"&&r.push({axisDim:n.axis.dim,axisIndex:n.axis.model.componentIndex,value:s.value})})}function Kkt(i,t,e,r){if(eM(t)||!i.list.length){r({type:"hideTip"});return}var n=((i.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};r({type:"showTip",escapeConnect:!0,x:t[0],y:t[1],tooltipOption:e.tooltipOption,position:e.position,dataIndexInside:n.dataIndexInside,dataIndex:n.dataIndex,seriesIndex:n.seriesIndex,dataByCoordSys:i.list})}function Jkt(i,t,e){var r=e.getZr(),n="axisPointerLastHighlights",o=OZ(r)[n]||{},s=OZ(r)[n]={};gt(i,function(f,g){var v=f.axisPointerModel.option;v.status==="show"&&f.triggerEmphasis&&gt(v.seriesDataIndices,function(y){var w=y.seriesIndex+" | "+y.dataIndex;s[w]=y})});var a=[],u=[];gt(o,function(f,g){!s[g]&&u.push(f)}),gt(s,function(f,g){!o[g]&&a.push(f)}),u.length&&e.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:u}),a.length&&e.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:a})}function Qkt(i,t){for(var e=0;e<(i||[]).length;e++){var r=i[e];if(t.axis.dim===r.axisDim&&t.axis.model.componentIndex===r.axisIndex)return r}}function BZ(i){var t=i.axis.model,e={},r=e.axisDim=i.axis.dim;return e.axisIndex=e[r+"AxisIndex"]=t.componentIndex,e.axisName=e[r+"AxisName"]=t.name,e.axisId=e[r+"AxisId"]=t.id,e}function eM(i){return!i||i[0]==null||isNaN(i[0])||i[1]==null||isNaN(i[1])}function XS(i){Pv.registerAxisPointerClass("CartesianAxisPointer",zkt),i.registerComponentModel(Fkt),i.registerComponentView(Wkt),i.registerPreprocessor(function(t){if(t){(!t.axisPointer||t.axisPointer.length===0)&&(t.axisPointer={});var e=t.axisPointer.link;e&&!Ye(e)&&(t.axisPointer.link=[e])}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=CIt(t,e)}),i.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},$kt)}function tOt(i){Rr(Aet),Rr(XS)}var eOt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,r,n,o,s){var a=n.axis;a.dim==="angle"&&(this.animationThreshold=Math.PI/18);var u=a.polar,f=u.getOtherAxis(a),g=f.getExtent(),v=a.dataToCoord(r),y=o.get("type");if(y&&y!=="none"){var w=mN(o),I=rOt[y](a,u,v,g);I.style=w,e.graphicKey=I.type,e.pointer=I}var E=o.get(["label","margin"]),D=iOt(r,n,o,u,E);Jit(e,n,o,s,D)},t}(gN);function iOt(i,t,e,r,n){var o=t.axis,s=o.dataToCoord(i),a=r.getAngleAxis().getExtent()[0];a=a/180*Math.PI;var u=r.getRadiusAxis().getExtent(),f,g,v;if(o.dim==="radius"){var y=ns();Up(y,y,a),xh(y,y,[r.cx,r.cy]),f=du([s,-n],y);var w=t.getModel("axisLabel").get("rotate")||0,I=zd.innerTextLayout(a,w*Math.PI/180,-1);g=I.textAlign,v=I.textVerticalAlign}else{var E=u[1];f=r.coordToPoint([E+n,s]);var D=r.cx,R=r.cy;g=Math.abs(f[0]-D)/E<.3?"center":f[0]>D?"left":"right",v=Math.abs(f[1]-R)/E<.3?"middle":f[1]>R?"top":"bottom"}return{position:f,align:g,verticalAlign:v}}var rOt={line:function(i,t,e,r){return i.dim==="angle"?{type:"Line",shape:_N(t.coordToPoint([r[0],e]),t.coordToPoint([r[1],e]))}:{type:"Circle",shape:{cx:t.cx,cy:t.cy,r:e}}},shadow:function(i,t,e,r){var n=Math.max(1,i.getBandWidth()),o=Math.PI/180;return i.dim==="angle"?{type:"Sector",shape:PZ(t.cx,t.cy,r[0],r[1],(-e-n/2)*o,(-e+n/2)*o)}:{type:"Sector",shape:PZ(t.cx,t.cy,e-n/2,e+n/2,0,Math.PI*2)}}};const nOt=eOt;var aOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.findAxisModel=function(e){var r,n=this.ecModel;return n.eachComponent(e,function(o){o.getCoordSysModel()===this&&(r=o)},this),r},t.type="polar",t.dependencies=["radiusAxis","angleAxis"],t.defaultOption={z:0,center:["50%","50%"],radius:"80%"},t}(gn);const oOt=aOt;var yN=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",Wa).models[0]},t.type="polarAxis",t}(gn);wo(yN,HS);var sOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="angleAxis",t}(yN),lOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="radiusAxis",t}(yN),xN=function(i){we(t,i);function t(e,r){return i.call(this,"radius",e,r)||this}return t.prototype.pointToData=function(e,r){return this.polar.pointToData(e,r)[this.dim==="radius"?0:1]},t}(bu);xN.prototype.dataToRadius=bu.prototype.dataToCoord;xN.prototype.radiusToData=bu.prototype.coordToData;const cOt=xN;var uOt=Wr(),bN=function(i){we(t,i);function t(e,r){return i.call(this,"angle",e,r||[0,360])||this}return t.prototype.pointToData=function(e,r){return this.polar.pointToData(e,r)[this.dim==="radius"?0:1]},t.prototype.calculateCategoryInterval=function(){var e=this,r=e.getLabelModel(),n=e.scale,o=n.getExtent(),s=n.count();if(o[1]-o[0]<1)return 0;var a=o[0],u=e.dataToCoord(a+1)-e.dataToCoord(a),f=Math.abs(u),g=eE(a==null?"":a+"",r.getFont(),"center","top"),v=Math.max(g.height,7),y=v/f;isNaN(y)&&(y=1/0);var w=Math.max(0,Math.floor(y)),I=uOt(e.model),E=I.lastAutoInterval,D=I.lastTickCount;return E!=null&&D!=null&&Math.abs(E-w)<=1&&Math.abs(D-s)<=1&&E>w?w=E:(I.lastTickCount=s,I.lastAutoInterval=w),w},t}(bu);bN.prototype.dataToAngle=bu.prototype.dataToCoord;bN.prototype.angleToData=bu.prototype.coordToData;const hOt=bN;var nrt=["radius","angle"],dOt=function(){function i(t){this.dimensions=nrt,this.type="polar",this.cx=0,this.cy=0,this._radiusAxis=new cOt,this._angleAxis=new hOt,this.axisPointerEnabled=!0,this.name=t||"",this._radiusAxis.polar=this._angleAxis.polar=this}return i.prototype.containPoint=function(t){var e=this.pointToCoord(t);return this._radiusAxis.contain(e[0])&&this._angleAxis.contain(e[1])},i.prototype.containData=function(t){return this._radiusAxis.containData(t[0])&&this._angleAxis.containData(t[1])},i.prototype.getAxis=function(t){var e="_"+t+"Axis";return this[e]},i.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]},i.prototype.getAxesByScale=function(t){var e=[],r=this._angleAxis,n=this._radiusAxis;return r.scale.type===t&&e.push(r),n.scale.type===t&&e.push(n),e},i.prototype.getAngleAxis=function(){return this._angleAxis},i.prototype.getRadiusAxis=function(){return this._radiusAxis},i.prototype.getOtherAxis=function(t){var e=this._angleAxis;return t===e?this._radiusAxis:e},i.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},i.prototype.getTooltipAxes=function(t){var e=t!=null&&t!=="auto"?this.getAxis(t):this.getBaseAxis();return{baseAxes:[e],otherAxes:[this.getOtherAxis(e)]}},i.prototype.dataToPoint=function(t,e,r){return this.coordToPoint([this._radiusAxis.dataToRadius(t[0],e),this._angleAxis.dataToAngle(t[1],e)],r)},i.prototype.pointToData=function(t,e,r){r=r||[];var n=this.pointToCoord(t);return r[0]=this._radiusAxis.radiusToData(n[0],e),r[1]=this._angleAxis.angleToData(n[1],e),r},i.prototype.pointToCoord=function(t){var e=t[0]-this.cx,r=t[1]-this.cy,n=this.getAngleAxis(),o=n.getExtent(),s=Math.min(o[0],o[1]),a=Math.max(o[0],o[1]);n.inverse?s=a-360:a=s+360;var u=Math.sqrt(e*e+r*r);e/=u,r/=u;for(var f=Math.atan2(-r,e)/Math.PI*180,g=f<s?1:-1;f<s||f>a;)f+=g*360;return[u,f]},i.prototype.coordToPoint=function(t,e){e=e||[];var r=t[0],n=t[1]/180*Math.PI;return e[0]=Math.cos(n)*r+this.cx,e[1]=-Math.sin(n)*r+this.cy,e},i.prototype.getArea=function(){var t=this.getAngleAxis(),e=this.getRadiusAxis(),r=e.getExtent().slice();r[0]>r[1]&&r.reverse();var n=t.getExtent(),o=Math.PI/180,s=1e-4;return{cx:this.cx,cy:this.cy,r0:r[0],r:r[1],startAngle:-n[0]*o,endAngle:-n[1]*o,clockwise:t.inverse,contain:function(a,u){var f=a-this.cx,g=u-this.cy,v=f*f+g*g,y=this.r,w=this.r0;return y!==w&&v-s<=y*y&&v+s>=w*w},x:this.cx-r[1],y:this.cy-r[1],width:r[1]*2,height:r[1]*2}},i.prototype.convertToPixel=function(t,e,r){var n=FZ(e);return n===this?this.dataToPoint(r):null},i.prototype.convertFromPixel=function(t,e,r){var n=FZ(e);return n===this?this.pointToData(r):null},i}();function FZ(i){var t=i.seriesModel,e=i.polarModel;return e&&e.coordinateSystem||t&&t.coordinateSystem}const fOt=dOt;function pOt(i,t,e){var r=t.get("center"),n=Bo(t,e).refContainer;i.cx=xi(r[0],n.width)+n.x,i.cy=xi(r[1],n.height)+n.y;var o=i.getRadiusAxis(),s=Math.min(n.width,n.height)/2,a=t.get("radius");a==null?a=[0,"100%"]:Ye(a)||(a=[0,a]);var u=[xi(a[0],s),xi(a[1],s)];o.inverse?o.setExtent(u[1],u[0]):o.setExtent(u[0],u[1])}function gOt(i,t){var e=this,r=e.getAngleAxis(),n=e.getRadiusAxis();if(r.scale.setExtent(1/0,-1/0),n.scale.setExtent(1/0,-1/0),i.eachSeries(function(a){if(a.coordinateSystem===e){var u=a.getData();gt(YM(u,"radius"),function(f){n.scale.unionExtentFromData(u,f)}),gt(YM(u,"angle"),function(f){r.scale.unionExtentFromData(u,f)})}}),T0(r.scale,r.model),T0(n.scale,n.model),r.type==="category"&&!r.onBand){var o=r.getExtent(),s=360/r.scale.count();r.inverse?o[1]+=s:o[1]-=s,r.setExtent(o[0],o[1])}}function mOt(i){return i.mainType==="angleAxis"}function NZ(i,t){var e;if(i.type=t.get("type"),i.scale=SE(t),i.onBand=t.get("boundaryGap")&&i.type==="category",i.inverse=t.get("inverse"),mOt(t)){i.inverse=i.inverse!==t.get("clockwise");var r=t.get("startAngle"),n=(e=t.get("endAngle"))!==null&&e!==void 0?e:r+(i.inverse?-360:360);i.setExtent(r,n)}t.axis=i,i.model=t}var vOt={dimensions:nrt,create:function(i,t){var e=[];return i.eachComponent("polar",function(r,n){var o=new fOt(n+"");o.update=gOt;var s=o.getRadiusAxis(),a=o.getAngleAxis(),u=r.findAxisModel("radiusAxis"),f=r.findAxisModel("angleAxis");NZ(s,u),NZ(a,f),pOt(o,r,t),e.push(o),r.coordinateSystem=o,o.model=r}),i.eachSeries(function(r){if(r.get("coordinateSystem")==="polar"){var n=r.getReferringComponents("polar",Wa).models[0];r.coordinateSystem=n.coordinateSystem}}),e}};const _Ot=vOt;var yOt=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function rI(i,t,e){t[1]>t[0]&&(t=t.slice().reverse());var r=i.coordToPoint([t[0],e]),n=i.coordToPoint([t[1],e]);return{x1:r[0],y1:r[1],x2:n[0],y2:n[1]}}function nI(i){var t=i.getRadiusAxis();return t.inverse?0:1}function VZ(i){var t=i[0],e=i[i.length-1];t&&e&&Math.abs(Math.abs(t.coord-e.coord)-360)<1e-4&&i.pop()}var xOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="PolarAxisPointer",e}return t.prototype.render=function(e,r){if(this.group.removeAll(),!!e.get("show")){var n=e.axis,o=n.polar,s=o.getRadiusAxis().getExtent(),a=n.getTicksCoords({breakTicks:"none"}),u=n.getMinorTicksCoords(),f=ti(n.getViewLabels(),function(g){g=Yi(g);var v=n.scale,y=v.type==="ordinal"?v.getRawOrdinalNumber(g.tickValue):g.tickValue;return g.coord=n.dataToCoord(y),g});VZ(f),VZ(a),gt(yOt,function(g){e.get([g,"show"])&&(!n.scale.isBlank()||g==="axisLine")&&bOt[g](this.group,e,o,a,u,s,f)},this)}},t.type="angleAxis",t}(Pv),bOt={axisLine:function(i,t,e,r,n,o){var s=t.getModel(["axisLine","lineStyle"]),a=e.getAngleAxis(),u=Math.PI/180,f=a.getExtent(),g=nI(e),v=g?0:1,y,w=Math.abs(f[1]-f[0])===360?"Circle":"Arc";o[v]===0?y=new Tv[w]({shape:{cx:e.cx,cy:e.cy,r:o[g],startAngle:-f[0]*u,endAngle:-f[1]*u,clockwise:a.inverse},style:s.getLineStyle(),z2:1,silent:!0}):y=new uE({shape:{cx:e.cx,cy:e.cy,r:o[g],r0:o[v]},style:s.getLineStyle(),z2:1,silent:!0}),y.style.fill=null,i.add(y)},axisTick:function(i,t,e,r,n,o){var s=t.getModel("axisTick"),a=(s.get("inside")?-1:1)*s.get("length"),u=o[nI(e)],f=ti(r,function(g){return new Ro({shape:rI(e,[u,u+a],g.coord)})});i.add(Mc(f,{style:rr(s.getModel("lineStyle").getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])})}))},minorTick:function(i,t,e,r,n,o){if(n.length){for(var s=t.getModel("axisTick"),a=t.getModel("minorTick"),u=(s.get("inside")?-1:1)*a.get("length"),f=o[nI(e)],g=[],v=0;v<n.length;v++)for(var y=0;y<n[v].length;y++)g.push(new Ro({shape:rI(e,[f,f+u],n[v][y].coord)}));i.add(Mc(g,{style:rr(a.getModel("lineStyle").getLineStyle(),rr(s.getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])}))}))}},axisLabel:function(i,t,e,r,n,o,s){var a=t.getCategories(!0),u=t.getModel("axisLabel"),f=u.get("margin"),g=t.get("triggerEvent");gt(s,function(v,y){var w=u,I=v.tickValue,E=o[nI(e)],D=e.coordToPoint([E+f,v.coord]),R=e.cx,z=e.cy,N=Math.abs(D[0]-R)/E<.3?"center":D[0]>R?"left":"right",H=Math.abs(D[1]-z)/E<.3?"middle":D[1]>z?"top":"bottom";if(a&&a[I]){var $=a[I];nr($)&&$.textStyle&&(w=new bn($.textStyle,u,u.ecModel))}var X=new _n({silent:zd.isLabelSilent(t),style:fa(w,{x:D[0],y:D[1],fill:w.getTextColor()||t.get(["axisLine","lineStyle","color"]),text:v.formattedLabel,align:N,verticalAlign:H})});if(i.add(X),Gd({el:X,componentModel:t,itemName:v.formattedLabel,formatterParamsExtra:{isTruncated:function(){return X.isTruncated},value:v.rawLabel,tickIndex:y}}),g){var K=zd.makeAxisEventDataBase(t);K.targetType="axisLabel",K.value=v.rawLabel,ur(X).eventData=K}},this)},splitLine:function(i,t,e,r,n,o){var s=t.getModel("splitLine"),a=s.getModel("lineStyle"),u=a.get("color"),f=0;u=u instanceof Array?u:[u];for(var g=[],v=0;v<r.length;v++){var y=f++%u.length;g[y]=g[y]||[],g[y].push(new Ro({shape:rI(e,o,r[v].coord)}))}for(var v=0;v<g.length;v++)i.add(Mc(g[v],{style:rr({stroke:u[v%u.length]},a.getLineStyle()),silent:!0,z:t.get("z")}))},minorSplitLine:function(i,t,e,r,n,o){if(n.length){for(var s=t.getModel("minorSplitLine"),a=s.getModel("lineStyle"),u=[],f=0;f<n.length;f++)for(var g=0;g<n[f].length;g++)u.push(new Ro({shape:rI(e,o,n[f][g].coord)}));i.add(Mc(u,{style:a.getLineStyle(),silent:!0,z:t.get("z")}))}},splitArea:function(i,t,e,r,n,o){if(r.length){var s=t.getModel("splitArea"),a=s.getModel("areaStyle"),u=a.get("color"),f=0;u=u instanceof Array?u:[u];for(var g=[],v=Math.PI/180,y=-r[0].coord*v,w=Math.min(o[0],o[1]),I=Math.max(o[0],o[1]),E=t.get("clockwise"),D=1,R=r.length;D<=R;D++){var z=D===R?r[0].coord:r[D].coord,N=f++%u.length;g[N]=g[N]||[],g[N].push(new pl({shape:{cx:e.cx,cy:e.cy,r0:w,r:I,startAngle:y,endAngle:-z*v,clockwise:E},silent:!0})),y=-z*v}for(var D=0;D<g.length;D++)i.add(Mc(g[D],{style:rr({fill:u[D%u.length]},a.getAreaStyle()),silent:!0}))}}};const wOt=xOt;var SOt=["splitLine","splitArea","minorSplitLine"],TOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="PolarAxisPointer",e}return t.prototype.render=function(e,r,n){if(this.group.removeAll(),!!e.get("show")){var o=this._axisGroup,s=this._axisGroup=new Ki;this.group.add(s);var a=e.axis,u=a.polar,f=u.getAngleAxis(),g=a.getTicksCoords(),v=a.getMinorTicksCoords(),y=f.getExtent()[0],w=a.getExtent(),I=IOt(u,e,y),E=new zd(e,n,I);E.build(),s.add(E.group),zS(o,s,e),gt(SOt,function(D){e.get([D,"show"])&&!a.scale.isBlank()&&AOt[D](this.group,e,u,y,w,g,v)},this)}},t.type="radiusAxis",t}(Pv),AOt={splitLine:function(i,t,e,r,n,o){var s=t.getModel("splitLine"),a=s.getModel("lineStyle"),u=a.get("color"),f=0,g=e.getAngleAxis(),v=Math.PI/180,y=g.getExtent(),w=Math.abs(y[1]-y[0])===360?"Circle":"Arc";u=u instanceof Array?u:[u];for(var I=[],E=0;E<o.length;E++){var D=f++%u.length;I[D]=I[D]||[],I[D].push(new Tv[w]({shape:{cx:e.cx,cy:e.cy,r:Math.max(o[E].coord,0),startAngle:-y[0]*v,endAngle:-y[1]*v,clockwise:g.inverse}}))}for(var E=0;E<I.length;E++)i.add(Mc(I[E],{style:rr({stroke:u[E%u.length],fill:null},a.getLineStyle()),silent:!0}))},minorSplitLine:function(i,t,e,r,n,o,s){if(s.length){for(var a=t.getModel("minorSplitLine"),u=a.getModel("lineStyle"),f=[],g=0;g<s.length;g++)for(var v=0;v<s[g].length;v++)f.push(new Gp({shape:{cx:e.cx,cy:e.cy,r:s[g][v].coord}}));i.add(Mc(f,{style:rr({fill:null},u.getLineStyle()),silent:!0}))}},splitArea:function(i,t,e,r,n,o){if(o.length){var s=t.getModel("splitArea"),a=s.getModel("areaStyle"),u=a.get("color"),f=0;u=u instanceof Array?u:[u];for(var g=[],v=o[0].coord,y=1;y<o.length;y++){var w=f++%u.length;g[w]=g[w]||[],g[w].push(new pl({shape:{cx:e.cx,cy:e.cy,r0:v,r:o[y].coord,startAngle:0,endAngle:Math.PI*2},silent:!0})),v=o[y].coord}for(var y=0;y<g.length;y++)i.add(Mc(g[y],{style:rr({fill:u[y%u.length]},a.getAreaStyle()),silent:!0}))}}};function IOt(i,t,e){return{position:[i.cx,i.cy],rotation:e/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:t.getModel("axisLabel").get("rotate"),z2:1}}const MOt=TOt;function art(i){return i.get("stack")||"__ec_stack_"+i.seriesIndex}function ort(i,t){return t.dim+i.model.componentIndex}function COt(i,t,e){var r={},n=EOt(Rn(t.getSeriesByType(i),function(o){return!t.isSeriesFiltered(o)&&o.coordinateSystem&&o.coordinateSystem.type==="polar"}));t.eachSeriesByType(i,function(o){if(o.coordinateSystem.type==="polar"){var s=o.getData(),a=o.coordinateSystem,u=a.getBaseAxis(),f=ort(a,u),g=art(o),v=n[f][g],y=v.offset,w=v.width,I=a.getOtherAxis(u),E=o.coordinateSystem.cx,D=o.coordinateSystem.cy,R=o.get("barMinHeight")||0,z=o.get("barMinAngle")||0;r[g]=r[g]||[];for(var N=s.mapDimension(I.dim),H=s.mapDimension(u.dim),$=Lp(s,N),X=u.dim!=="radius"||!o.get("roundCap",!0),K=I.model,et=K.get("startValue"),rt=I.dataToCoord(et||0),lt=0,ht=s.count();lt<ht;lt++){var yt=s.get(N,lt),ft=s.get(H,lt),kt=yt>=0?"p":"n",Rt=rt;$&&(r[g][ft]||(r[g][ft]={p:rt,n:rt}),Rt=r[g][ft][kt]);var Ct=void 0,Gt=void 0,Vt=void 0,Qt=void 0;if(I.dim==="radius"){var fe=I.dataToCoord(yt)-rt,Te=u.dataToCoord(ft);Math.abs(fe)<R&&(fe=(fe<0?-1:1)*R),Ct=Rt,Gt=Rt+fe,Vt=Te-y,Qt=Vt-w,$&&(r[g][ft][kt]=Gt)}else{var be=I.dataToCoord(yt,X)-rt,Ge=u.dataToCoord(ft);Math.abs(be)<z&&(be=(be<0?-1:1)*z),Ct=Ge+y,Gt=Ct+w,Vt=Rt,Qt=Rt+be,$&&(r[g][ft][kt]=Qt)}s.setItemLayout(lt,{cx:E,cy:D,r0:Ct,r:Gt,startAngle:-Vt*Math.PI/180,endAngle:-Qt*Math.PI/180,clockwise:Vt>=Qt})}}})}function EOt(i){var t={};gt(i,function(r,n){var o=r.getData(),s=r.coordinateSystem,a=s.getBaseAxis(),u=ort(s,a),f=a.getExtent(),g=a.type==="category"?a.getBandWidth():Math.abs(f[1]-f[0])/o.count(),v=t[u]||{bandWidth:g,remainedWidth:g,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},y=v.stacks;t[u]=v;var w=art(r);y[w]||v.autoWidthCount++,y[w]=y[w]||{width:0,maxWidth:0};var I=xi(r.get("barWidth"),g),E=xi(r.get("barMaxWidth"),g),D=r.get("barGap"),R=r.get("barCategoryGap");I&&!y[w].width&&(I=Math.min(v.remainedWidth,I),y[w].width=I,v.remainedWidth-=I),E&&(y[w].maxWidth=E),D!=null&&(v.gap=D),R!=null&&(v.categoryGap=R)});var e={};return gt(t,function(r,n){e[n]={};var o=r.stacks,s=r.bandWidth,a=xi(r.categoryGap,s),u=xi(r.gap,1),f=r.remainedWidth,g=r.autoWidthCount,v=(f-a)/(g+(g-1)*u);v=Math.max(v,0),gt(o,function(E,D){var R=E.maxWidth;R&&R<v&&(R=Math.min(R,f),E.width&&(R=Math.min(R,E.width)),f-=R,E.width=R,g--)}),v=(f-a)/(g+(g-1)*u),v=Math.max(v,0);var y=0,w;gt(o,function(E,D){E.width||(E.width=v),w=E,y+=E.width*(1+u)}),w&&(y-=w.width*u);var I=-y/2;gt(o,function(E,D){e[n][D]=e[n][D]||{offset:I,width:E.width},I+=E.width*(1+u)})}),e}var DOt={startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:0}},POt={splitNumber:5},LOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="polar",t}(Oa);function ROt(i){Rr(XS),Pv.registerAxisPointerClass("PolarAxisPointer",nOt),i.registerCoordinateSystem("polar",_Ot),i.registerComponentModel(oOt),i.registerComponentView(LOt),M0(i,"angle",sOt,DOt),M0(i,"radius",lOt,POt),i.registerComponentView(wOt),i.registerComponentView(MOt),i.registerLayout(br(COt,"bar"))}function cB(i,t){t=t||{};var e=i.coordinateSystem,r=i.axis,n={},o=r.position,s=r.orient,a=e.getRect(),u=[a.x,a.x+a.width,a.y,a.y+a.height],f={horizontal:{top:u[2],bottom:u[3]},vertical:{left:u[0],right:u[1]}};n.position=[s==="vertical"?f.vertical[o]:u[0],s==="horizontal"?f.horizontal[o]:u[3]];var g={horizontal:0,vertical:1};n.rotation=Math.PI/2*g[s];var v={top:-1,bottom:1,right:1,left:-1};n.labelDirection=n.tickDirection=n.nameDirection=v[o],i.get(["axisTick","inside"])&&(n.tickDirection=-n.tickDirection),vs(t.labelInside,i.get(["axisLabel","inside"]))&&(n.labelDirection=-n.labelDirection);var y=i.get(["axisLabel","rotate"]);return n.labelRotate=o==="top"?-y:y,n.z2=1,n}var kOt=["splitArea","splitLine","breakArea"],OOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="SingleAxisPointer",e}return t.prototype.render=function(e,r,n,o){var s=this.group;s.removeAll();var a=this._axisGroup;this._axisGroup=new Ki;var u=cB(e),f=new zd(e,n,u);f.build(),s.add(this._axisGroup),s.add(f.group),gt(kOt,function(g){e.get([g,"show"])&&zOt[g](this,this.group,this._axisGroup,e,n)},this),zS(a,this._axisGroup,e),i.prototype.render.call(this,e,r,n,o)},t.prototype.remove=function(){bet(this)},t.type="singleAxis",t}(Pv),zOt={splitLine:function(i,t,e,r,n){var o=r.axis;if(!o.scale.isBlank()){var s=r.getModel("splitLine"),a=s.getModel("lineStyle"),u=a.get("color");u=u instanceof Array?u:[u];for(var f=a.get("width"),g=r.coordinateSystem.getRect(),v=o.isHorizontal(),y=[],w=0,I=o.getTicksCoords({tickModel:s,breakTicks:"none",pruneByBreak:"preserve_extent_bound"}),E=[],D=[],R=0;R<I.length;++R){var z=o.toGlobalCoord(I[R].coord);v?(E[0]=z,E[1]=g.y,D[0]=z,D[1]=g.y+g.height):(E[0]=g.x,E[1]=z,D[0]=g.x+g.width,D[1]=z);var N=new Ro({shape:{x1:E[0],y1:E[1],x2:D[0],y2:D[1]},silent:!0});b0(N.shape,f);var H=w++%u.length;y[H]=y[H]||[],y[H].push(N)}for(var $=a.getLineStyle(["color"]),R=0;R<y.length;++R)t.add(Mc(y[R],{style:rr({stroke:u[R%u.length]},$),silent:!0}))}},splitArea:function(i,t,e,r,n){xet(i,e,r,r)},breakArea:function(i,t,e,r,n){var o=qS(),s=r.axis.scale;o&&s.type!=="ordinal"&&o.rectCoordBuildBreakAxis(t,i,r,r.coordinateSystem.getRect(),n)}};const BOt=OOt;var srt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getCoordSysModel=function(){return this},t.type="singleAxis",t.layoutMode="box",t.defaultOption={left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:!0,lineStyle:{width:1,type:"solid"}},tooltip:{show:!0},axisTick:{show:!0,length:6,lineStyle:{width:1}},axisLabel:{show:!0,interval:"auto"},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}},jitter:0,jitterOverlap:!0,jitterMargin:2},t}(gn);wo(srt,HS.prototype);const _k=srt;var FOt=function(i){we(t,i);function t(e,r,n,o,s){var a=i.call(this,e,r,n)||this;return a.type=o||"value",a.position=s||"bottom",a}return t.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"},t.prototype.pointToData=function(e,r){return this.coordinateSystem.pointToData(e)[0]},t}(bu);const NOt=FOt;var lrt=["single"],VOt=function(){function i(t,e,r){this.type="single",this.dimension="single",this.dimensions=lrt,this.axisPointerEnabled=!0,this.model=t,this._init(t,e,r)}return i.prototype._init=function(t,e,r){var n=this.dimension,o=new NOt(n,SE(t),[0,0],t.get("type"),t.get("position")),s=o.type==="category";o.onBand=s&&t.get("boundaryGap"),o.inverse=t.get("inverse"),o.orient=t.get("orient"),t.axis=o,o.model=t,o.coordinateSystem=this,this._axis=o},i.prototype.update=function(t,e){t.eachSeries(function(r){if(r.coordinateSystem===this){var n=r.getData();gt(n.mapDimensionsAll(this.dimension),function(o){this._axis.scale.unionExtentFromData(n,o)},this),T0(this._axis.scale,this._axis.model)}},this)},i.prototype.resize=function(t,e){var r=Bo(t,e).refContainer;this._rect=Ca(t.getBoxLayoutParams(),r),this._adjustAxis()},i.prototype.getRect=function(){return this._rect},i.prototype._adjustAxis=function(){var t=this._rect,e=this._axis,r=e.isHorizontal(),n=r?[0,t.width]:[0,t.height],o=e.inverse?1:0;e.setExtent(n[o],n[1-o]),this._updateAxisTransform(e,r?t.x:t.y)},i.prototype._updateAxisTransform=function(t,e){var r=t.getExtent(),n=r[0]+r[1],o=t.isHorizontal();t.toGlobalCoord=o?function(s){return s+e}:function(s){return n-s+e},t.toLocalCoord=o?function(s){return s-e}:function(s){return n-s+e}},i.prototype.getAxis=function(){return this._axis},i.prototype.getBaseAxis=function(){return this._axis},i.prototype.getAxes=function(){return[this._axis]},i.prototype.getTooltipAxes=function(){return{baseAxes:[this.getAxis()],otherAxes:[]}},i.prototype.containPoint=function(t){var e=this.getRect(),r=this.getAxis(),n=r.orient;return n==="horizontal"?r.contain(r.toLocalCoord(t[0]))&&t[1]>=e.y&&t[1]<=e.y+e.height:r.contain(r.toLocalCoord(t[1]))&&t[0]>=e.y&&t[0]<=e.y+e.height},i.prototype.pointToData=function(t,e,r){r=r||[];var n=this.getAxis();return r[0]=n.coordToData(n.toLocalCoord(t[n.orient==="horizontal"?0:1])),r},i.prototype.dataToPoint=function(t,e,r){var n=this.getAxis(),o=this.getRect();r=r||[];var s=n.orient==="horizontal"?0:1;return t instanceof Array&&(t=t[0]),r[s]=n.toGlobalCoord(n.dataToCoord(+t)),r[1-s]=s===0?o.y+o.height/2:o.x+o.width/2,r},i.prototype.convertToPixel=function(t,e,r){var n=UZ(e);return n===this?this.dataToPoint(r):null},i.prototype.convertFromPixel=function(t,e,r){var n=UZ(e);return n===this?this.pointToData(r):null},i}();function UZ(i){var t=i.seriesModel,e=i.singleAxisModel;return e&&e.coordinateSystem||t&&t.coordinateSystem}function UOt(i,t){var e=[];return i.eachComponent("singleAxis",function(r,n){var o=new VOt(r,i,t);o.name="single_"+n,o.resize(r,t),r.coordinateSystem=o,e.push(o)}),i.eachSeries(function(r){if(r.get("coordinateSystem")==="singleAxis"){var n=r.getReferringComponents("singleAxis",Wa).models[0];r.coordinateSystem=n&&n.coordinateSystem}}),e}var GOt={create:UOt,dimensions:lrt};const HOt=GOt;var GZ=["x","y"],jOt=["width","height"],WOt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,r,n,o,s){var a=n.axis,u=a.coordinateSystem,f=yk(u,1-mC(a)),g=u.dataToPoint(r)[0],v=o.get("type");if(v&&v!=="none"){var y=mN(o),w=$Ot[v](a,g,f);w.style=y,e.graphicKey=w.type,e.pointer=w}var I=cB(n);trt(r,e,I,n,o,s)},t.prototype.getHandleTransform=function(e,r,n){var o=cB(r,{labelInside:!1});o.labelMargin=n.get(["handle","margin"]);var s=vN(r.axis,e,o);return{x:s[0],y:s[1],rotation:o.rotation+(o.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,r,n,o){var s=n.axis,a=s.coordinateSystem,u=mC(s),f=yk(a,u),g=[e.x,e.y];g[u]+=r[u],g[u]=Math.min(f[1],g[u]),g[u]=Math.max(f[0],g[u]);var v=yk(a,1-u),y=(v[1]+v[0])/2,w=[y,y];return w[u]=g[u],{x:g[0],y:g[1],rotation:e.rotation,cursorPoint:w,tooltipOption:{verticalAlign:"middle"}}},t}(gN),$Ot={line:function(i,t,e){var r=_N([t,e[0]],[t,e[1]],mC(i));return{type:"Line",subPixelOptimize:!0,shape:r}},shadow:function(i,t,e){var r=i.getBandWidth(),n=e[1]-e[0];return{type:"Rect",shape:ert([t-r/2,e[0]],[r,n],mC(i))}}};function mC(i){return i.isHorizontal()?0:1}function yk(i,t){var e=i.getRect();return[e[GZ[t]],e[GZ[t]]+e[jOt[t]]]}const ZOt=WOt;var qOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="single",t}(Oa);function XOt(i){Rr(XS),Pv.registerAxisPointerClass("SingleAxisPointer",ZOt),i.registerComponentView(qOt),i.registerComponentView(BOt),i.registerComponentModel(_k),M0(i,"single",_k,_k.defaultOption),i.registerCoordinateSystem("single",HOt)}var YOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r,n){var o=Iv(e);i.prototype.init.apply(this,arguments),HZ(e,o)},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),HZ(this.option,e)},t.prototype.getCellSize=function(){return this.option.cellSize},t.type="calendar",t.layoutMode="box",t.defaultOption={z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:_e.color.axisLine,width:1,type:"solid"}},itemStyle:{color:_e.color.neutral00,borderWidth:1,borderColor:_e.color.neutral10},dayLabel:{show:!0,firstDay:0,position:"start",margin:_e.size.s,color:_e.color.secondary},monthLabel:{show:!0,position:"start",margin:_e.size.s,align:"center",formatter:null,color:_e.color.secondary},yearLabel:{show:!0,position:null,margin:_e.size.xl,formatter:null,color:_e.color.quaternary,fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},t}(gn);function HZ(i,t){var e=i.cellSize,r;Ye(e)?r=e:r=i.cellSize=[e,e],r.length===1&&(r[1]=r[0]);var n=ti([0,1],function(o){return _1t(t,o)&&(r[o]="auto"),r[o]!=null&&r[o]!=="auto"});Sh(i,t,{type:"box",ignoreSize:n})}const KOt=YOt;var JOt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=this.group;o.removeAll();var s=e.coordinateSystem,a=s.getRangeInfo(),u=s.getOrient(),f=r.getLocaleModel();this._renderDayRect(e,a,o),this._renderLines(e,a,u,o),this._renderYearText(e,a,u,o),this._renderMonthText(e,f,u,o),this._renderWeekText(e,f,a,u,o)},t.prototype._renderDayRect=function(e,r,n){for(var o=e.coordinateSystem,s=e.getModel("itemStyle").getItemStyle(),a=o.getCellWidth(),u=o.getCellHeight(),f=r.start.time;f<=r.end.time;f=o.getNextNDay(f,1).time){var g=o.dataToCalendarLayout([f],!1).tl,v=new jr({shape:{x:g[0],y:g[1],width:a,height:u},cursor:"default",style:s});n.add(v)}},t.prototype._renderLines=function(e,r,n,o){var s=this,a=e.coordinateSystem,u=e.getModel(["splitLine","lineStyle"]).getLineStyle(),f=e.get(["splitLine","show"]),g=u.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var v=r.start,y=0;v.time<=r.end.time;y++){I(v.formatedDate),y===0&&(v=a.getDateInfo(r.start.y+"-"+r.start.m));var w=v.date;w.setMonth(w.getMonth()+1),v=a.getDateInfo(w)}I(a.getNextNDay(r.end.time,1).formatedDate);function I(E){s._firstDayOfMonth.push(a.getDateInfo(E)),s._firstDayPoints.push(a.dataToCalendarLayout([E],!1).tl);var D=s._getLinePointsOfOneWeek(e,E,n);s._tlpoints.push(D[0]),s._blpoints.push(D[D.length-1]),f&&s._drawSplitline(D,u,o)}f&&this._drawSplitline(s._getEdgesPoints(s._tlpoints,g,n),u,o),f&&this._drawSplitline(s._getEdgesPoints(s._blpoints,g,n),u,o)},t.prototype._getEdgesPoints=function(e,r,n){var o=[e[0].slice(),e[e.length-1].slice()],s=n==="horizontal"?0:1;return o[0][s]=o[0][s]-r/2,o[1][s]=o[1][s]+r/2,o},t.prototype._drawSplitline=function(e,r,n){var o=new Us({z2:20,shape:{points:e},style:r});n.add(o)},t.prototype._getLinePointsOfOneWeek=function(e,r,n){for(var o=e.coordinateSystem,s=o.getDateInfo(r),a=[],u=0;u<7;u++){var f=o.getNextNDay(s.time,u),g=o.dataToCalendarLayout([f.time],!1);a[2*f.day]=g.tl,a[2*f.day+1]=g[n==="horizontal"?"bl":"tr"]}return a},t.prototype._formatterLabel=function(e,r){return bi(e)&&e?d1t(e,r):Xi(e)?e(r):r.nameMap},t.prototype._yearTextPositionControl=function(e,r,n,o,s){var a=r[0],u=r[1],f=["center","bottom"];o==="bottom"?(u+=s,f=["center","top"]):o==="left"?a-=s:o==="right"?(a+=s,f=["center","top"]):u-=s;var g=0;return(o==="left"||o==="right")&&(g=Math.PI/2),{rotation:g,x:a,y:u,style:{align:f[0],verticalAlign:f[1]}}},t.prototype._renderYearText=function(e,r,n,o){var s=e.getModel("yearLabel");if(s.get("show")){var a=s.get("margin"),u=s.get("position");u||(u=n!=="horizontal"?"top":"left");var f=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],g=(f[0][0]+f[1][0])/2,v=(f[0][1]+f[1][1])/2,y=n==="horizontal"?0:1,w={top:[g,f[y][1]],bottom:[g,f[1-y][1]],left:[f[1-y][0],v],right:[f[y][0],v]},I=r.start.y;+r.end.y>+r.start.y&&(I=I+"-"+r.end.y);var E=s.get("formatter"),D={start:r.start.y,end:r.end.y,nameMap:I},R=this._formatterLabel(E,D),z=new _n({z2:30,style:fa(s,{text:R}),silent:s.get("silent")});z.attr(this._yearTextPositionControl(z,w[u],n,u,a)),o.add(z)}},t.prototype._monthTextPositionControl=function(e,r,n,o,s){var a="left",u="top",f=e[0],g=e[1];return n==="horizontal"?(g=g+s,r&&(a="center"),o==="start"&&(u="bottom")):(f=f+s,r&&(u="middle"),o==="start"&&(a="right")),{x:f,y:g,align:a,verticalAlign:u}},t.prototype._renderMonthText=function(e,r,n,o){var s=e.getModel("monthLabel");if(s.get("show")){var a=s.get("nameMap"),u=s.get("margin"),f=s.get("position"),g=s.get("align"),v=[this._tlpoints,this._blpoints];(!a||bi(a))&&(a&&(r=sz(a)||r),a=r.get(["time","monthAbbr"])||[]);var y=f==="start"?0:1,w=n==="horizontal"?0:1;u=f==="start"?-u:u;for(var I=g==="center",E=s.get("silent"),D=0;D<v[y].length-1;D++){var R=v[y][D].slice(),z=this._firstDayOfMonth[D];if(I){var N=this._firstDayPoints[D];R[w]=(N[w]+v[0][D+1][w])/2}var H=s.get("formatter"),$=a[+z.m-1],X={yyyy:z.y,yy:(z.y+"").slice(2),MM:z.m,M:+z.m,nameMap:$},K=this._formatterLabel(H,X),et=new _n({z2:30,style:Fe(fa(s,{text:K}),this._monthTextPositionControl(R,I,n,f,u)),silent:E});o.add(et)}}},t.prototype._weekTextPositionControl=function(e,r,n,o,s){var a="center",u="middle",f=e[0],g=e[1],v=n==="start";return r==="horizontal"?(f=f+o+(v?1:-1)*s[0]/2,a=v?"right":"left"):(g=g+o+(v?1:-1)*s[1]/2,u=v?"bottom":"top"),{x:f,y:g,align:a,verticalAlign:u}},t.prototype._renderWeekText=function(e,r,n,o,s){var a=e.getModel("dayLabel");if(a.get("show")){var u=e.coordinateSystem,f=a.get("position"),g=a.get("nameMap"),v=a.get("margin"),y=u.getFirstDayOfWeek();if(!g||bi(g)){g&&(r=sz(g)||r);var w=r.get(["time","dayOfWeekShort"]);g=w||ti(r.get(["time","dayOfWeekAbbr"]),function(X){return X[0]})}var I=u.getNextNDay(n.end.time,7-n.lweek).time,E=[u.getCellWidth(),u.getCellHeight()];v=xi(v,Math.min(E[1],E[0])),f==="start"&&(I=u.getNextNDay(n.start.time,-(7+n.fweek)).time,v=-v);for(var D=a.get("silent"),R=0;R<7;R++){var z=u.getNextNDay(I,R),N=u.dataToCalendarLayout([z.time],!1).center,H=R;H=Math.abs((R+y)%7);var $=new _n({z2:30,style:Fe(fa(a,{text:g[H]}),this._weekTextPositionControl(N,o,f,v,E)),silent:D});s.add($)}}},t.type="calendar",t}(Oa);const QOt=JOt;var xk=864e5,tzt=function(){function i(t,e,r){this.type="calendar",this.dimensions=i.dimensions,this.getDimensionsInfo=i.getDimensionsInfo,this._model=t,this._update(e,r)}return i.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]},i.prototype.getRangeInfo=function(){return this._rangeInfo},i.prototype.getModel=function(){return this._model},i.prototype.getRect=function(){return this._rect},i.prototype.getCellWidth=function(){return this._sw},i.prototype.getCellHeight=function(){return this._sh},i.prototype.getOrient=function(){return this._orient},i.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek},i.prototype.getDateInfo=function(t){t=Sv(t);var e=t.getFullYear(),r=t.getMonth()+1,n=r<10?"0"+r:""+r,o=t.getDate(),s=o<10?"0"+o:""+o,a=t.getDay();return a=Math.abs((a+7-this.getFirstDayOfWeek())%7),{y:e+"",m:n,d:s,day:a,time:t.getTime(),formatedDate:e+"-"+n+"-"+s,date:t}},i.prototype.getNextNDay=function(t,e){return e=e||0,e===0?this.getDateInfo(t):(t=new Date(this.getDateInfo(t).time),t.setDate(t.getDate()+e),this.getDateInfo(t))},i.prototype._update=function(t,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var r=this._rangeInfo.weeks||1,n=["width","height"],o=this._model.getCellSize().slice(),s=this._model.getBoxLayoutParams(),a=this._orient==="horizontal"?[r,7]:[7,r];gt([0,1],function(v){g(o,v)&&(s[n[v]]=o[v]*a[v])});var u={width:e.getWidth(),height:e.getHeight()},f=this._rect=Ca(s,u);gt([0,1],function(v){g(o,v)||(o[v]=f[n[v]]/a[v])});function g(v,y){return v[y]!=null&&v[y]!=="auto"}this._sw=o[0],this._sh=o[1]},i.prototype.dataToPoint=function(t,e,r){r=r||[],Ye(t)&&(t=t[0]),e==null&&(e=!0);var n=this.getDateInfo(t),o=this._rangeInfo,s=n.formatedDate;if(e&&!(n.time>=o.start.time&&n.time<o.end.time+xk))return r[0]=r[1]=NaN,r;var a=n.day,u=this._getRangeInfo([o.start.time,s]).nthWeek;return this._orient==="vertical"?(r[0]=this._rect.x+a*this._sw+this._sw/2,r[1]=this._rect.y+u*this._sh+this._sh/2):(r[0]=this._rect.x+u*this._sw+this._sw/2,r[1]=this._rect.y+a*this._sh+this._sh/2),r},i.prototype.pointToData=function(t){var e=this.pointToDate(t);return e&&e.time},i.prototype.dataToLayout=function(t,e,r){r=r||{};var n=r.rect=r.rect||{},o=r.contentRect=r.contentRect||{},s=this.dataToPoint(t,e);return n.x=s[0]-this._sw/2,n.y=s[1]-this._sh/2,n.width=this._sw,n.height=this._sh,sr.copy(o,n),mv(o,this._lineWidth/2,!0,!0),r},i.prototype.dataToCalendarLayout=function(t,e){var r=this.dataToPoint(t,e);return{center:r,tl:[r[0]-this._sw/2,r[1]-this._sh/2],tr:[r[0]+this._sw/2,r[1]-this._sh/2],br:[r[0]+this._sw/2,r[1]+this._sh/2],bl:[r[0]-this._sw/2,r[1]+this._sh/2]}},i.prototype.pointToDate=function(t){var e=Math.floor((t[0]-this._rect.x)/this._sw)+1,r=Math.floor((t[1]-this._rect.y)/this._sh)+1,n=this._rangeInfo.range;return this._orient==="vertical"?this._getDateByWeeksAndDay(r,e-1,n):this._getDateByWeeksAndDay(e,r-1,n)},i.prototype.convertToPixel=function(t,e,r){var n=bk(e);return n===this?n.dataToPoint(r):null},i.prototype.convertToLayout=function(t,e,r){var n=bk(e);return n===this?n.dataToLayout(r):null},i.prototype.convertFromPixel=function(t,e,r){var n=bk(e);return n===this?n.pointToData(r):null},i.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},i.prototype._initRangeOption=function(){var t=this._model.get("range"),e;if(Ye(t)&&t.length===1&&(t=t[0]),Ye(t))e=t;else{var r=t.toString();if(/^\d{4}$/.test(r)&&(e=[r+"-01-01",r+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(r)){var n=this.getDateInfo(r),o=n.date;o.setMonth(o.getMonth()+1);var s=this.getNextNDay(o,-1);e=[n.formatedDate,s.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(r)&&(e=[r,r])}if(!e)return t;var a=this._getRangeInfo(e);return a.start.time>a.end.time&&e.reverse(),e},i.prototype._getRangeInfo=function(t){var e=[this.getDateInfo(t[0]),this.getDateInfo(t[1])],r;e[0].time>e[1].time&&(r=!0,e.reverse());var n=Math.floor(e[1].time/xk)-Math.floor(e[0].time/xk)+1,o=new Date(e[0].time),s=o.getDate(),a=e[1].date.getDate();o.setDate(s+n-1);var u=o.getDate();if(u!==a)for(var f=o.getTime()-e[1].time>0?1:-1;(u=o.getDate())!==a&&(o.getTime()-e[1].time)*f>0;)n-=f,o.setDate(u-f);var g=Math.floor((n+e[0].day+6)/7),v=r?-g+1:g-1;return r&&e.reverse(),{range:[e[0].formatedDate,e[1].formatedDate],start:e[0],end:e[1],allDay:n,weeks:g,nthWeek:v,fweek:e[0].day,lweek:e[1].day}},i.prototype._getDateByWeeksAndDay=function(t,e,r){var n=this._getRangeInfo(r);if(t>n.weeks||t===0&&e<n.fweek||t===n.weeks&&e>n.lweek)return null;var o=(t-1)*7-n.fweek+e,s=new Date(n.start.time);return s.setDate(+n.start.d+o),this.getDateInfo(s)},i.create=function(t,e){var r=[];return t.eachComponent("calendar",function(n){var o=new i(n,t,e);r.push(o),n.coordinateSystem=o}),t.eachComponent(function(n,o){VS({targetModel:o,coordSysType:"calendar",coordSysProvider:xJ})}),r},i.dimensions=["time","value"],i}();function bk(i){var t=i.calendarModel,e=i.seriesModel,r=t?t.coordinateSystem:e?e.coordinateSystem:null;return r}const ezt=tzt;function izt(i){i.registerComponentModel(KOt),i.registerComponentView(QOt),i.registerCoordinateSystem("calendar",ezt)}var pd={level:1,leaf:2,nonLeaf:3},Md={none:0,all:1,body:2,corner:3};function uB(i,t,e){var r=t[vr[e]].getCell(i);return!r&&fn(i)&&i<0&&(r=t[vr[1-e]].getUnitLayoutInfo(e,Math.round(i))),r}function crt(i){var t=i||[];return t[0]=t[0]||[],t[1]=t[1]||[],t[0][0]=t[0][1]=t[1][0]=t[1][1]=NaN,t}function urt(i,t,e,r,n){jZ(i[0],t,n,e,r,0),jZ(i[1],t,n,e,r,1)}function jZ(i,t,e,r,n,o){i[0]=1/0,i[1]=-1/0;var s=r[o],a=Ye(s)?s:[s],u=a.length,f=!!e;if(u>=1?(WZ(i,t,a,f,n,o,0),u>1&&WZ(i,t,a,f,n,o,u-1)):i[0]=i[1]=NaN,f){var g=-n[vr[1-o]].getLocatorCount(o),v=n[vr[o]].getLocatorCount(o)-1;e===Md.body?g=co(0,g):e===Md.corner&&(v=rc(-1,v)),v<g&&(g=v=NaN),Bs(i[0])&&(i[0]=g),Bs(i[1])&&(i[1]=v),i[0]=co(rc(i[0],v),g),i[1]=co(rc(i[1],v),g)}}function WZ(i,t,e,r,n,o,s){var a=uB(e[s],n,o);if(!a){i[0]=i[1]=NaN;return}var u=a.id[vr[o]],f=u,g=ozt(a);g&&(f+=g.span[vr[o]]-1),i[0]=rc(i[0],u,f),i[1]=co(i[1],u,f)}function aI(i,t){return Bs(i[t][0])||Bs(i[t][1])}function $Z(i,t,e,r){t=t||rzt;for(var n=0;n<r;n++)t[n]=!1;for(;;){for(var o=!1,n=0;n<r;n++){var s=e[n];!t[n]&&s.cellMergeOwner&&nzt(i,s.locatorRange)&&(t[n]=!0,o=!0)}if(!o)break}}var rzt=[];function nzt(i,t){return!ZZ(i[0],t[0])||!ZZ(i[1],t[1])?!1:(i[0][0]=rc(i[0][0],t[0][0]),i[0][1]=co(i[0][1],t[0][1]),i[1][0]=rc(i[1][0],t[1][0]),i[1][1]=co(i[1][1],t[1][1]),!0)}function ZZ(i,t){return i[1]>=t[0]&&i[0]<=t[1]}function qZ(i,t){i.id.set(t[0][0],t[1][0]),i.span.set(t[0][1]-i.id.x+1,t[1][1]-i.id.y+1)}function azt(i,t){i[0][0]=t[0][0],i[0][1]=t[0][1],i[1][0]=t[1][0],i[1][1]=t[1][1]}function XZ(i,t,e,r){var n=uB(t[r][0],e,r),o=uB(t[r][1],e,r);i[vr[r]]=i[yo[r]]=NaN,n&&o&&(i[vr[r]]=n.xy,i[yo[r]]=o.xy+o.wh-n.xy)}function zb(i,t,e,r){return i[vr[t]]=e,i[vr[1-t]]=r,i}function ozt(i){return i&&(i.type===pd.leaf||i.type===pd.nonLeaf)?i:null}function vC(){return{x:NaN,y:NaN,width:NaN,height:NaN}}var YZ=function(){function i(t,e){this._cells=[],this._levels=[],this.dim=t,this.dimIdx=t==="x"?0:1,this._model=e,this._uniqueValueGen=szt(t);var r=e.get("data",!0);r!=null&&!Ye(r)&&(r=[]),r?this._initByDimModelData(r):this._initBySeriesData()}return i.prototype._initByDimModelData=function(t){var e=this,r=e._cells,n=e._levels,o=[],s=0;e._leavesCount=a(t,0,0),u();return;function a(f,g,v){var y=0;return f&&gt(f,function(w,I){var E;bi(w)?E={value:w}:nr(w)?(E=w,w.value!=null&&!bi(w.value)&&(E={value:null})):E={value:null};var D={type:pd.nonLeaf,ordinal:NaN,level:v,firstLeafLocator:g,id:new er,span:zb(new er,e.dimIdx,1,1),option:E,xy:NaN,wh:NaN,dim:e,rect:vC()};s++,(o[g]||(o[g]=[])).push(D),n[v]||(n[v]={type:pd.level,xy:NaN,wh:NaN,option:null,id:new er,dim:e});var R=a(E.children,g,v+1),z=Math.max(1,R);D.span[vr[e.dimIdx]]=z,y+=z,g+=z}),y}function u(){for(var f=[];r.length<s;)for(var g=0;g<o.length;g++){var v=o[g].pop();if(v){v.ordinal=f.length;var y=v.option.value;f.push(y),r.push(v),e._uniqueValueGen.calcDupBase(y)}}e._uniqueValueGen.ensureValueUnique(f,r);var w=e._ordinalMeta=new hS({categories:f,needCollect:!1,deduplication:!1});e._scale=new dS({ordinalMeta:w});for(var I=0;I<e._leavesCount;I++){var E=e._cells[I];E.type=pd.leaf,E.span[vr[1-e.dimIdx]]=e._levels.length-E.level}e._initCellsId(),e._initLevelIdOptions()}},i.prototype._initBySeriesData=function(){var t=this;t._leavesCount=0,t._levels=[{type:pd.level,xy:NaN,wh:NaN,option:null,id:new er,dim:t}],t._initLevelIdOptions();var e=t._ordinalMeta=new hS({needCollect:!0,deduplication:!0,onCollect:function(r,n){var o=t._cells[n]={type:pd.leaf,ordinal:n,level:0,firstLeafLocator:n,id:new er,span:zb(new er,t.dimIdx,1,1),option:{value:r+""},xy:NaN,wh:NaN,dim:t,rect:vC()};t._leavesCount++,t._setCellId(o)}});t._scale=new dS({ordinalMeta:e})},i.prototype._setCellId=function(t){var e=this._levels.length,r=this.dimIdx;zb(t.id,r,t.firstLeafLocator,t.level-e)},i.prototype._initCellsId=function(){var t=this._levels.length,e=this.dimIdx;gt(this._cells,function(r){zb(r.id,e,r.firstLeafLocator,r.level-t)})},i.prototype._initLevelIdOptions=function(){var t=this._levels.length,e=this.dimIdx,r=this._model.get("levels",!0);r=Ye(r)?r:[],gt(this._levels,function(n,o){zb(n.id,e,0,o-t),n.option=r[o]})},i.prototype.shouldShow=function(){return!!this._model.getShallow("show",!0)},i.prototype.resetLayoutIterator=function(t,e,r,n){if(t=t||new wp,e===this.dimIdx){var o=this._leavesCount,s=r!=null?Math.max(0,r):0;n=n!=null?Math.min(n,o):o,t.reset(this._cells,s,s+n)}else{var o=this._levels.length,s=r!=null?Math.max(0,r+o):0;n=n!=null?Math.min(n,o):o,t.reset(this._levels,s,s+n)}return t},i.prototype.resetCellIterator=function(t){return(t||new wp).reset(this._cells,0)},i.prototype.resetLevelIterator=function(t){return(t||new wp).reset(this._levels,0)},i.prototype.getLayout=function(t,e,r){var n=this.getUnitLayoutInfo(e,r);t[vr[e]]=n?n.xy:NaN,t[yo[e]]=n?n.wh:NaN},i.prototype.getUnitLayoutInfo=function(t,e){return t===this.dimIdx?e<this._leavesCount?this._cells[e]:void 0:this._levels[e+this._levels.length]},i.prototype.getCell=function(t){var e=this._scale.parse(t);return Bs(e)?void 0:this._cells[e]},i.prototype.getLocatorCount=function(t){return t===this.dimIdx?this._leavesCount:this._levels.length},i.prototype.getOrdinalMeta=function(){return this._ordinalMeta},i}();function szt(i){var t=i.toUpperCase(),e=new RegExp("^"+t+"([0-9]+)$"),r=0;function n(a){var u;a!=null&&(u=a.match(e))&&(r=co(r,+u[1]+1))}function o(){return""+t+r++}function s(a,u){for(var f=Fi(),g=0;g<a.length;g++){var v=a[g];(v==null||f.get(v)!=null)&&(a[g]=v=o(),u[g].option=rr({value:v},u[g].option)),f.set(v,!0)}}return{calcDupBase:n,ensureValueUnique:s}}var KZ=function(){function i(t,e,r){this._model=e,this._dims=r,this._kind=t,this._cellMergeOwnerList=[]}return i.prototype._ensureCellMap=function(){var t=this,e=t._cellMap;return e||(e=t._cellMap=Fi(),r()),e;function r(){var o=[],s=t._model.getShallow("data");s&&!Ye(s)&&(s=null),gt(s,function(I,E){if(!(!nr(I)||!Ye(I.coord))){var D=crt([]),R=null;if(urt(D,R,I.coord,t._dims,I.coordClamp?Md[t._kind]:Md.none),!(aI(D,0)||aI(D,1))){var z=I&&I.mergeCells,N={id:new er,span:new er,locatorRange:D,option:I,cellMergeOwner:z};qZ(N,D),o.push(N)}}});for(var a=[],u=0;u<o.length;u++){var f=o[u];if(f.cellMergeOwner){var g=f.locatorRange;$Z(g,a,o,u);for(var v=0;v<u;v++)a[v]&&(o[v].cellMergeOwner=!1);if(g[0][0]!==f.id.x||g[1][0]!==f.id.y){f.cellMergeOwner=!1;var y=Fe({},f.option);y.coord=null;var w={id:new er,span:new er,locatorRange:g,option:y,cellMergeOwner:!0};qZ(w,g),o.push(w)}}}gt(o,function(I){var E=n(I.id.x,I.id.y);if(I.cellMergeOwner&&(E.cellMergeOwner=!0,E.span=I.span,E.locatorRange=I.locatorRange,E.spanRect=vC(),t._cellMergeOwnerList.push(E)),!(!I.cellMergeOwner&&!I.option))for(var D=0;D<I.span.y;D++)for(var R=0;R<I.span.x;R++){var z=n(I.id.x+R,I.id.y+D);z.option=I.option,I.cellMergeOwner&&(z.inSpanOf=E)}})}function n(o,s){var a=JZ(o,s),u=e.get(a);return u||(u=e.set(a,{id:new er(o,s),option:null,inSpanOf:null,span:null,spanRect:null,locatorRange:null,cellMergeOwner:!1})),u}},i.prototype.getCell=function(t){return this._ensureCellMap().get(JZ(t[0],t[1]))},i.prototype.travelExistingCells=function(t){this._ensureCellMap().each(t)},i.prototype.expandRangeByCellMerge=function(t){if(!aI(t,0)&&!aI(t,1)&&t[0][0]===t[0][1]&&t[1][0]===t[1][1]){wk[0]=t[0][0],wk[1]=t[1][0];var e=this.getCell(wk),r=e&&e.inSpanOf;if(r){azt(t,r.locatorRange);return}}var n=this._cellMergeOwnerList;$Z(t,null,n,n.length)},i}(),wk=[];function JZ(i,t){return i+"|"+t}var wN={show:!0,color:_e.color.secondary,overflow:"break",lineOverflow:"truncate",padding:[2,3,2,3],distance:0};function SN(i){return{color:"none",borderWidth:1,borderColor:i?"none":_e.color.borderTint}}var QZ={show:!0,label:wN,itemStyle:SN(!1),silent:void 0,dividerLineStyle:{width:1,color:_e.color.border}},lzt={label:wN,itemStyle:SN(!1),silent:void 0},czt={label:wN,itemStyle:SN(!0),silent:void 0},uzt={z:-50,left:"10%",top:"10%",right:"10%",bottom:"10%",x:QZ,y:QZ,body:lzt,corner:czt,backgroundStyle:{color:"none",borderColor:_e.color.axisLine,borderWidth:1}},hzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){var e=this._dimModels={x:new tq(this.get("x",!0)||{}),y:new tq(this.get("y",!0)||{})};e.x.option.type=e.y.option.type="category";var r=e.x.dim=new YZ("x",e.x),n=e.y.dim=new YZ("y",e.y),o={x:r,y:n};this._body=new KZ("body",new bn(this.getShallow("body")),o),this._corner=new KZ("corner",new bn(this.getShallow("corner")),o)},t.prototype.getDimensionModel=function(e){return this._dimModels[e]},t.prototype.getBody=function(){return this._body},t.prototype.getCorner=function(){return this._corner},t.type="matrix",t.layoutMode="box",t.defaultOption=uzt,t}(gn),tq=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getOrdinalMeta=function(){return this.dim.getOrdinalMeta()},t}(bn);const dzt=hzt;var oI=Math.round,fzt=0,pzt=99,gzt={normal:25,special:100},mzt={normal:50,special:125},vzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r){this.group.removeAll();var n=this.group,o=e.coordinateSystem,s=o.getRect(),a=e.getDimensionModel("x"),u=e.getDimensionModel("y"),f=a.dim,g=u.dim;_zt(n,e,r),yzt(n,e,f,g,r);var v=e.getShallow("borderZ2",!0),y=Ui(v,pzt),w=y-1,I=e.getModel("backgroundStyle").getItemStyle(["borderWidth"]);I.lineWidth=0;var E=e.getModel("backgroundStyle").getItemStyle(["color","decal","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]);E.fill="none";var D=hB(s.clone(),I,fzt),R=hB(s.clone(),E,y);D.silent=!0,R.silent=!0,n.add(D),n.add(R);var z=f.getUnitLayoutInfo(0,0),N=g.getUnitLayoutInfo(1,0);z&&N&&(f.shouldShow()&&n.add(eq({x1:s.x,y1:N.xy,x2:s.x+s.width,y2:N.xy},a.getModel("dividerLineStyle").getLineStyle(),w)),g.shouldShow()&&n.add(eq({x1:z.xy,y1:s.y,x2:z.xy,y2:s.y+s.height},u.getModel("dividerLineStyle").getLineStyle(),w)))},t.type="matrix",t}(Oa);function _zt(i,t,e){r(0),r(1);function r(n){var o=t.getDimensionModel(vr[n]),s=o.dim;if(s.shouldShow())for(var a=o.getModel("itemStyle"),u=o.getModel("label"),f=t.getShallow("tooltip",!0),g=[],v=s.resetCellIterator();v.next();){var y=v.item,w={};sr.copy(w,y.rect),yF(g,y.id.x,y.id.y),hrt(g,t,i,e,y.option,a,u,o,w,y.option.value,mzt,f)}}}function yzt(i,t,e,r,n){o("body",t.getBody(),e,r),e.shouldShow()&&r.shouldShow()&&o("corner",t.getCorner(),r,e);function o(s,a,u,f){var g=new bn(t.getShallow(s,!0)),v=g.getModel("itemStyle"),y=g.getModel("label"),w=new wp,I=new wp,E=[],D=t.getShallow("tooltip",!0);for(f.resetLayoutIterator(I,1);I.next();)for(u.resetLayoutIterator(w,0);w.next();){var R=w.item,z=I.item;yF(E,R.id.x,z.id.y);var N=a.getCell(E);if(!(N&&N.inSpanOf&&N.inSpanOf!==N)){var H={};N&&N.span?sr.copy(H,N.spanRect):(R.dim.getLayout(H,0,E[0]),z.dim.getLayout(H,1,E[1]));var $=N?N.option:null;hrt(E,t,i,n,$,v,y,g,H,$?$.value:null,gzt,D)}}}}function hrt(i,t,e,r,n,o,s,a,u,f,g,v){var y;sI.option=n?n.itemStyle:null,sI.parentModel=o,Ly.option=n,Ly.parentModel=a;var w=Ui(Ly.getShallow("z2"),n&&n.itemStyle?g.special:g.normal),I=v&&v.show,E=hB(u,sI.getItemStyle(),w);e.add(E);var D=Ly.get("cursor");D!=null&&E.attr("cursor",D);var R;if(f!=null){var z=f+"";if(Ry.option=n?n.label:null,Ry.parentModel=s,Ry.ecModel=r,qo(E,{normal:Ry},{defaultText:z,autoOverflowArea:!0,layoutRect:Yi(E.shape)}),R=E.getTextContent(),R){R.z2=w+1;var N=R.style;if(N&&N.overflow&&N.overflow!=="none"&&N.lineOverflow){var H={};sr.copy(H,u),mv(H,(((y=E.style)===null||y===void 0?void 0:y.lineWidth)||0)/2,!0,!0),E.updateInnerText(),R.getLocalTransform(lI),mu(lI,lI),sr.applyTransform(H,H,lI),R.setClipPath(new jr({shape:H}))}}Gd({el:E,componentModel:t,itemName:z,itemTooltipOption:v,formatterParamsExtra:{xyLocator:i.slice()}})}if(R){var $=Ry.get("silent");$==null&&($=!I),R.silent=$,R.ignoreHostSilent=!0}var X=Ly.get("silent");X==null&&(X=!E.style||E.style.fill==="none"||!E.style.fill),E.silent=X,OL(Ly),OL(sI),OL(Ry)}var Ly=new bn,sI=new bn,Ry=new bn,lI=[];function hB(i,t,e){var r=t.lineWidth;if(r){var n=i.x+i.width,o=i.y+i.height;i.x=ec(i.x,r,!0),i.y=ec(i.y,r,!0),i.width=ec(n,r,!0)-i.x,i.height=ec(o,r,!0)-i.y}return new jr({shape:i,style:t,z2:e})}function eq(i,t,e){var r=t.lineWidth;return r&&(oI(i.x1*2)===oI(i.x2*2)&&(i.x1=i.x2=ec(i.x1,r,!0)),oI(i.y1*2)===oI(i.y2*2)&&(i.y1=i.y2=ec(i.y1,r,!0))),new Ro({shape:i,style:t,silent:!0,z2:e})}const xzt=vzt;var bzt=function(){function i(t,e,r){this.dimensions=i.dimensions,this.type="matrix",this._model=t;var n=this._dimModels={x:t.getDimensionModel("x"),y:t.getDimensionModel("y")};this._dims={x:n.x.dim,y:n.y.dim},this._resize(t,r)}return i.getDimensionsInfo=function(){return[{name:"x",type:"ordinal"},{name:"y",type:"ordinal"},{name:"value"}]},i.create=function(t,e){var r=[];return t.eachComponent("matrix",function(n){var o=new i(n,t,e);r.push(o),n.coordinateSystem=o}),t.eachComponent(function(n,o){VS({targetModel:o,coordSysType:"matrix",coordSysProvider:xJ})}),r},i.prototype.getRect=function(){return this._rect},i.prototype._resize=function(t,e){var r=this._dims,n=this._dimModels,o=this._rect=Ca(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()});iq(n,r,o,0),iq(n,r,o,1),rq(0,r),rq(1,r),nq(this._model.getBody(),r),nq(this._model.getCorner(),r)},i.prototype.dataToPoint=function(t,e,r){return r=r||[],this.dataToLayout(t,e,Bb),r[0]=Bb.rect.x+Bb.rect.width/2,r[1]=Bb.rect.y+Bb.rect.height/2,r},i.prototype.dataToLayout=function(t,e,r){var n=this._dims;r=r||{};var o=r.rect=r.rect||{};o.x=o.y=o.width=o.height=NaN;var s=r.matrixXYLocatorRange=crt(r.matrixXYLocatorRange);return Ye(t)&&(urt(s,null,t,n,Ui(e&&e.clamp,Md.none)),(!e||!e.ignoreMergeCells)&&((!e||e.clamp!==Md.corner)&&this._model.getBody().expandRangeByCellMerge(s),(!e||e.clamp!==Md.body)&&this._model.getCorner().expandRangeByCellMerge(s)),XZ(o,s,n,0),XZ(o,s,n,1)),r},i.prototype.pointToData=function(t,e,r){var n=this._dims;return aq(Zu,0,n,t,e&&e.clamp),aq(Zu,1,n,t,e&&e.clamp),r=r||[],r[0]=r[1]=NaN,Zu.y===ps.inCorner&&Zu.x===ps.inBody?oq(Zu,r,0,n):Zu.x===ps.inCorner&&Zu.y===ps.inBody?oq(Zu,r,1,n):(sq(Zu,r,0,n),sq(Zu,r,1,n)),r},i.prototype.convertToPixel=function(t,e,r,n){var o=Tk(e);return o===this?o.dataToPoint(r,n):void 0},i.prototype.convertToLayout=function(t,e,r,n){var o=Tk(e);return o===this?o.dataToLayout(r,n):void 0},i.prototype.convertFromPixel=function(t,e,r,n){var o=Tk(e);return o===this?o.pointToData(r,n):void 0},i.prototype.containPoint=function(t){return this._rect.contain(t[0],t[1])},i.dimensions=["x","y","value"],i}(),Bb={rect:vC()},cI=new wp,Sk=new wp;function iq(i,t,e,r){for(var n=1-r,o=t[vr[r]],s=t[vr[n]],a=s.shouldShow(),u=o.resetCellIterator();u.next();)u.item.wh=u.item.xy=NaN;for(var f=s.resetLayoutIterator(null,r);f.next();)f.item.wh=f.item.xy=NaN;for(var g=e[yo[r]],v=o.getLocatorCount(r)+s.getLocatorCount(r),y=new bn,w=s.resetLevelIterator();w.next();)y.option=w.item.option,y.parentModel=i[vr[n]],D(w.item,a?y.get("levelSize"):0);for(var I=new bn,E=o.resetCellIterator();E.next();)E.item.type===pd.leaf&&(I.option=E.item.option,I.parentModel=void 0,D(E.item,I.get("size")));function D(K,et){var rt=wzt(et,r,e);Bs(rt)||(K.wh=dB(rt,g),g=dB(g-K.wh),v--)}var R=v?g/v:0,z=!v&&g>=1,N=e[vr[r]],H=o.getLocatorCount(r)-1,$=new wp;for(s.resetLayoutIterator($,r);$.next();)X($.item);for(o.resetLayoutIterator($,r);$.next();)X($.item);function X(K){Bs(K.wh)&&(K.wh=R),K.xy=N,K.id[vr[r]]===H&&!z&&(K.wh=e[vr[r]]+e[yo[r]]-K.xy),N+=K.wh}}function rq(i,t){for(var e=t[vr[i]].resetCellIterator();e.next();){var r=e.item;_C(r.rect,i,r.id,r.span,t),_C(r.rect,1-i,r.id,r.span,t),r.type===pd.nonLeaf&&(r.xy=r.rect[vr[i]],r.wh=r.rect[yo[i]])}}function nq(i,t){i.travelExistingCells(function(e){var r=e.span;if(r){var n=e.spanRect,o=e.id;_C(n,0,o,r,t),_C(n,1,o,r,t)}})}function _C(i,t,e,r,n){i[yo[t]]=0;var o=e[vr[t]],s=o<0?n[vr[1-t]]:n[vr[t]],a=s.getUnitLayoutInfo(t,e[vr[t]]);if(i[vr[t]]=a.xy,i[yo[t]]=a.wh,r[vr[t]]>1){var u=s.getUnitLayoutInfo(t,e[vr[t]]+r[vr[t]]-1);i[yo[t]]=u.xy+u.wh-a.xy}}function wzt(i,t,e){var r=LM(i,e[yo[t]]);return dB(r,e[yo[t]])}function dB(i,t){return Math.max(Math.min(i,Ui(t,1/0)),0)}function Tk(i){var t=i.matrixModel,e=i.seriesModel,r=t?t.coordinateSystem:e?e.coordinateSystem:null;return r}var ps={inBody:1,inCorner:2,outside:3},Zu={x:null,y:null,point:[]};function aq(i,t,e,r,n){var o=e[vr[t]],s=e[vr[1-t]],a=o.getUnitLayoutInfo(t,o.getLocatorCount(t)-1),u=o.getUnitLayoutInfo(t,0),f=s.getUnitLayoutInfo(t,-s.getLocatorCount(t)),g=s.shouldShow()?s.getUnitLayoutInfo(t,-1):null,v=i.point[t]=r[t];if(!u&&!g){i[vr[t]]=ps.outside;return}if(n===Md.body){u?(i[vr[t]]=ps.inBody,v=rc(a.xy+a.wh,co(u.xy,v)),i.point[t]=v):i[vr[t]]=ps.outside;return}else if(n===Md.corner){g?(i[vr[t]]=ps.inCorner,v=rc(g.xy+g.wh,co(f.xy,v)),i.point[t]=v):i[vr[t]]=ps.outside;return}var y=u?u.xy:g?g.xy+g.wh:NaN,w=f?f.xy:y,I=a?a.xy+a.wh:y;if(v<w){if(!n){i[vr[t]]=ps.outside;return}v=w}else if(v>I){if(!n){i[vr[t]]=ps.outside;return}v=I}i.point[t]=v,i[vr[t]]=y<=v&&v<=I?ps.inBody:w<=v&&v<=y?ps.inCorner:ps.outside}function oq(i,t,e,r){var n=1-e;if(i[vr[e]]!==ps.outside)for(r[vr[e]].resetCellIterator(Sk);Sk.next();){var o=Sk.item;if(lq(i.point[e],o.rect,e)&&lq(i.point[n],o.rect,n)){t[e]=o.ordinal,t[n]=o.id[vr[n]];return}}}function sq(i,t,e,r){if(i[vr[e]]!==ps.outside){var n=i[vr[e]]===ps.inCorner?r[vr[1-e]]:r[vr[e]];for(n.resetLayoutIterator(cI,e);cI.next();)if(Szt(i.point[e],cI.item)){t[e]=cI.item.id[vr[e]];return}}}function Szt(i,t){return t.xy<=i&&i<=t.xy+t.wh}function lq(i,t,e){return t[vr[e]]<=i&&i<=t[vr[e]]+t[yo[e]]}const Tzt=bzt;function Azt(i){i.registerComponentModel(dzt),i.registerComponentView(xzt),i.registerCoordinateSystem("matrix",Tzt)}function Izt(i,t){var e=i.existing;if(t.id=i.keyInfo.id,!t.type&&e&&(t.type=e.type),t.parentId==null){var r=t.parentOption;r?t.parentId=r.id:e&&(t.parentId=e.parentId)}t.parentOption=null}function cq(i,t){var e;return gt(t,function(r){i[r]!=null&&i[r]!=="auto"&&(e=!0)}),e}function Mzt(i,t,e){var r=Fe({},e),n=i[t],o=e.$action||"merge";o==="merge"?n?(Er(n,r,!0),Sh(n,r,{ignoreSize:!0}),AJ(e,n),uI(e,n),uI(e,n,"shape"),uI(e,n,"style"),uI(e,n,"extra"),e.clipPath=n.clipPath):i[t]=r:o==="replace"?i[t]=r:o==="remove"&&n&&(i[t]=null)}var drt=["transition","enterFrom","leaveTo"],Czt=drt.concat(["enterAnimation","updateAnimation","leaveAnimation"]);function uI(i,t,e){if(e&&(!i[e]&&t[e]&&(i[e]={}),i=i[e],t=t[e]),!(!i||!t))for(var r=e?drt:Czt,n=0;n<r.length;n++){var o=r[n];i[o]==null&&t[o]!=null&&(i[o]=t[o])}}function Ezt(i,t){if(i&&(i.hv=t.hv=[cq(t,["left","right"]),cq(t,["top","bottom"])],i.type==="group")){var e=i,r=t;e.width==null&&(e.width=r.width=0),e.height==null&&(e.height=r.height=0)}}var Dzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventAutoZ=!0,e}return t.prototype.mergeOption=function(e,r){var n=this.option.elements;this.option.elements=null,i.prototype.mergeOption.call(this,e,r),this.option.elements=n},t.prototype.optionUpdated=function(e,r){var n=this.option,o=(r?n:e).elements,s=n.elements=r?[]:n.elements,a=[];this._flatten(o,a,null);var u=eK(s,a,"normalMerge"),f=this._elOptionsToUpdate=[];gt(u,function(g,v){var y=g.newOption;y&&(f.push(y),Izt(g,y),Mzt(s,v,y),Ezt(s[v],y))},this),n.elements=Rn(s,function(g){return g&&delete g.$action,g!=null})},t.prototype._flatten=function(e,r,n){gt(e,function(o){if(o){n&&(o.parentOption=n),r.push(o);var s=o.children;s&&s.length&&this._flatten(s,r,o),delete o.children}},this)},t.prototype.useElOptionsToUpdate=function(){var e=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,e},t.type="graphic",t.defaultOption={elements:[]},t}(gn),uq={path:null,compoundPath:null,group:Ki,image:ys,text:_n},Tc=Wr(),Pzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this._elMap=Fi()},t.prototype.render=function(e,r,n){e!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=e,this._updateElements(e),this._relocate(e,n)},t.prototype._updateElements=function(e){var r=e.useElOptionsToUpdate();if(r){var n=this._elMap,o=this.group,s=e.get("z"),a=e.get("zlevel");gt(r,function(u){var f=Lo(u.id,null),g=f!=null?n.get(f):null,v=Lo(u.parentId,null),y=v!=null?n.get(v):o,w=u.type,I=u.style;w==="text"&&I&&u.hv&&u.hv[1]&&(I.textVerticalAlign=I.textBaseline=I.verticalAlign=I.align=null);var E=u.textContent,D=u.textConfig;if(I&&Git(I,w,!!D,!!E)){var R=Hit(I,w,!0);!D&&R.textConfig&&(D=u.textConfig=R.textConfig),!E&&R.textContent&&(E=R.textContent)}var z=Lzt(u),N=u.$action||"merge",H=N==="merge",$=N==="replace";if(H){var X=!g,K=g;X?K=hq(f,y,u.type,n):(K&&(Tc(K).isNew=!1),Zit(K)),K&&(tM(K,z,e,{isInit:X}),dq(K,u,s,a))}else if($){iM(g,u,n,e);var et=hq(f,y,u.type,n);et&&(tM(et,z,e,{isInit:!0}),dq(et,u,s,a))}else N==="remove"&&(Wit(g,u),iM(g,u,n,e));var rt=n.get(f);if(rt&&E)if(H){var lt=rt.getTextContent();lt?lt.attr(E):rt.setTextContent(new _n(E))}else $&&rt.setTextContent(new _n(E));if(rt){var ht=u.clipPath;if(ht){var yt=ht.type,ft=void 0,X=!1;if(H){var kt=rt.getClipPath();X=!kt||Tc(kt).type!==yt,ft=X?fB(yt):kt}else $&&(X=!0,ft=fB(yt));rt.setClipPath(ft),tM(ft,ht,e,{isInit:X}),pC(ft,ht.keyframeAnimation,e)}var Rt=Tc(rt);rt.setTextConfig(D),Rt.option=u,Rzt(rt,e,u),Gd({el:rt,componentModel:e,itemName:rt.name,itemTooltipOption:u.tooltip}),pC(rt,u.keyframeAnimation,e)}})}},t.prototype._relocate=function(e,r){for(var n=e.option.elements,o=this.group,s=this._elMap,a=r.getWidth(),u=r.getHeight(),f=["x","y"],g=0;g<n.length;g++){var v=n[g],y=Lo(v.id,null),w=y!=null?s.get(y):null;if(!(!w||!w.isGroup)){var I=w.parent,E=I===o,D=Tc(w),R=Tc(I);D.width=xi(D.option.width,E?a:R.width)||0,D.height=xi(D.option.height,E?u:R.height)||0}}for(var g=n.length-1;g>=0;g--){var v=n[g],y=Lo(v.id,null),w=y!=null?s.get(y):null;if(w){var I=w.parent,R=Tc(I),z=I===o?{width:a,height:u}:{width:R.width,height:R.height},N={},H=vE(w,v,z,null,{hv:v.hv,boundingMode:v.bounding},N);if(!Tc(w).isNew&&H){for(var $=v.transition,X={},K=0;K<f.length;K++){var et=f[K],rt=N[et];$&&(cv($)||Ar($,et)>=0)?X[et]=rt:w[et]=rt}yn(w,X,e,0)}else w.attr(N)}}},t.prototype._clear=function(){var e=this,r=this._elMap;r.each(function(n){iM(n,Tc(n).option,r,e._lastGraphicModel)}),this._elMap=Fi()},t.prototype.dispose=function(){this._clear()},t.type="graphic",t}(Oa);function fB(i){var t=Di(uq,i)?uq[i]:BM(i),e=new t({});return Tc(e).type=i,e}function hq(i,t,e,r){var n=fB(e);return t.add(n),r.set(i,n),Tc(n).id=i,Tc(n).isNew=!0,n}function iM(i,t,e,r){var n=i&&i.parent;n&&(i.type==="group"&&i.traverse(function(o){iM(o,t,e,r)}),RE(i,t,r),e.removeKey(Tc(i).id))}function dq(i,t,e,r){i.isGroup||gt([["cursor",kc.prototype.cursor],["zlevel",r||0],["z",e||0],["z2",0]],function(n){var o=n[0];Di(t,o)?i[o]=Ui(t[o],n[1]):i[o]==null&&(i[o]=n[1])}),gt(on(t),function(n){if(n.indexOf("on")===0){var o=t[n];i[n]=Xi(o)?o:null}}),Di(t,"draggable")&&(i.draggable=t.draggable),t.name!=null&&(i.name=t.name),t.id!=null&&(i.id=t.id)}function Lzt(i){return i=Fe({},i),gt(["id","parentId","$action","hv","bounding","textContent","clipPath"].concat(bJ),function(t){delete i[t]}),i}function Rzt(i,t,e){var r=ur(i).eventData;!i.silent&&!i.ignore&&!r&&(r=ur(i).eventData={componentType:"graphic",componentIndex:t.componentIndex,name:i.name}),r&&(r.info=e.info)}function kzt(i){i.registerComponentModel(Dzt),i.registerComponentView(Pzt),i.registerPreprocessor(function(t){var e=t.graphic;Ye(e)?!e[0]||!e[0].elements?t.graphic=[{elements:e}]:t.graphic=[t.graphic[0]]:e&&!e.elements&&(t.graphic=[{elements:[e]}])})}var fq=["x","y","radius","angle","single"],Ozt=["cartesian2d","polar","singleAxis"];function zzt(i){var t=i.get("coordinateSystem");return Ar(Ozt,t)>=0}function mp(i){return i+"Axis"}function Bzt(i,t){var e=Fi(),r=[],n=Fi();i.eachComponent({mainType:"dataZoom",query:t},function(g){n.get(g.uid)||a(g)});var o;do o=!1,i.eachComponent("dataZoom",s);while(o);function s(g){!n.get(g.uid)&&u(g)&&(a(g),o=!0)}function a(g){n.set(g.uid,!0),r.push(g),f(g)}function u(g){var v=!1;return g.eachTargetAxis(function(y,w){var I=e.get(y);I&&I[w]&&(v=!0)}),v}function f(g){g.eachTargetAxis(function(v,y){(e.get(v)||e.set(v,[]))[y]=!0})}return r}function frt(i){var t=i.ecModel,e={infoList:[],infoMap:Fi()};return i.eachTargetAxis(function(r,n){var o=t.getComponent(mp(r),n);if(o){var s=o.getCoordSysModel();if(s){var a=s.uid,u=e.infoMap.get(a);u||(u={model:s,axisModels:[]},e.infoList.push(u),e.infoMap.set(a,u)),u.axisModels.push(o)}}}),e}var Ak=function(){function i(){this.indexList=[],this.indexMap=[]}return i.prototype.add=function(t){this.indexMap[t]||(this.indexList.push(t),this.indexMap[t]=!0)},i}(),Fzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._autoThrottle=!0,e._noTarget=!0,e._rangePropMode=["percent","percent"],e}return t.prototype.init=function(e,r,n){var o=pq(e);this.settledOption=o,this.mergeDefaultAndTheme(e,n),this._doInit(o)},t.prototype.mergeOption=function(e){var r=pq(e);Er(this.option,e,!0),Er(this.settledOption,r,!0),this._doInit(r)},t.prototype._doInit=function(e){var r=this.option;this._setDefaultThrottle(e),this._updateRangeUse(e);var n=this.settledOption;gt([["start","startValue"],["end","endValue"]],function(o,s){this._rangePropMode[s]==="value"&&(r[o[0]]=n[o[0]]=null)},this),this._resetTarget()},t.prototype._resetTarget=function(){var e=this.get("orient",!0),r=this._targetAxisInfoMap=Fi(),n=this._fillSpecifiedTargetAxis(r);n?this._orient=e||this._makeAutoOrientByTargetAxis():(this._orient=e||"horizontal",this._fillAutoTargetAxisByOrient(r,this._orient)),this._noTarget=!0,r.each(function(o){o.indexList.length&&(this._noTarget=!1)},this)},t.prototype._fillSpecifiedTargetAxis=function(e){var r=!1;return gt(fq,function(n){var o=this.getReferringComponents(mp(n),Fyt);if(o.specified){r=!0;var s=new Ak;gt(o.models,function(a){s.add(a.componentIndex)}),e.set(n,s)}},this),r},t.prototype._fillAutoTargetAxisByOrient=function(e,r){var n=this.ecModel,o=!0;if(o){var s=r==="vertical"?"y":"x",a=n.findComponents({mainType:s+"Axis"});u(a,s)}if(o){var a=n.findComponents({mainType:"singleAxis",filter:function(g){return g.get("orient",!0)===r}});u(a,"single")}function u(f,g){var v=f[0];if(v){var y=new Ak;if(y.add(v.componentIndex),e.set(g,y),o=!1,g==="x"||g==="y"){var w=v.getReferringComponents("grid",Wa).models[0];w&&gt(f,function(I){v.componentIndex!==I.componentIndex&&w===I.getReferringComponents("grid",Wa).models[0]&&y.add(I.componentIndex)})}}}o&&gt(fq,function(f){if(o){var g=n.findComponents({mainType:mp(f),filter:function(y){return y.get("type",!0)==="category"}});if(g[0]){var v=new Ak;v.add(g[0].componentIndex),e.set(f,v),o=!1}}},this)},t.prototype._makeAutoOrientByTargetAxis=function(){var e;return this.eachTargetAxis(function(r){!e&&(e=r)},this),e==="y"?"vertical":"horizontal"},t.prototype._setDefaultThrottle=function(e){if(e.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var r=this.ecModel.option;this.option.throttle=r.animation&&r.animationDurationUpdate>0?100:20}},t.prototype._updateRangeUse=function(e){var r=this._rangePropMode,n=this.get("rangeMode");gt([["start","startValue"],["end","endValue"]],function(o,s){var a=e[o[0]]!=null,u=e[o[1]]!=null;a&&!u?r[s]="percent":!a&&u?r[s]="value":n?r[s]=n[s]:a&&(r[s]="percent")})},t.prototype.noTarget=function(){return this._noTarget},t.prototype.getFirstTargetAxisModel=function(){var e;return this.eachTargetAxis(function(r,n){e==null&&(e=this.ecModel.getComponent(mp(r),n))},this),e},t.prototype.eachTargetAxis=function(e,r){this._targetAxisInfoMap.each(function(n,o){gt(n.indexList,function(s){e.call(r,o,s)})})},t.prototype.getAxisProxy=function(e,r){var n=this.getAxisModel(e,r);if(n)return n.__dzAxisProxy},t.prototype.getAxisModel=function(e,r){var n=this._targetAxisInfoMap.get(e);if(n&&n.indexMap[r])return this.ecModel.getComponent(mp(e),r)},t.prototype.setRawRange=function(e){var r=this.option,n=this.settledOption;gt([["start","startValue"],["end","endValue"]],function(o){(e[o[0]]!=null||e[o[1]]!=null)&&(r[o[0]]=n[o[0]]=e[o[0]],r[o[1]]=n[o[1]]=e[o[1]])},this),this._updateRangeUse(e)},t.prototype.setCalculatedRange=function(e){var r=this.option;gt(["start","startValue","end","endValue"],function(n){r[n]=e[n]})},t.prototype.getPercentRange=function(){var e=this.findRepresentativeAxisProxy();if(e)return e.getDataPercentWindow()},t.prototype.getValueRange=function(e,r){if(e==null&&r==null){var n=this.findRepresentativeAxisProxy();if(n)return n.getDataValueWindow()}else return this.getAxisProxy(e,r).getDataValueWindow()},t.prototype.findRepresentativeAxisProxy=function(e){if(e)return e.__dzAxisProxy;for(var r,n=this._targetAxisInfoMap.keys(),o=0;o<n.length;o++)for(var s=n[o],a=this._targetAxisInfoMap.get(s),u=0;u<a.indexList.length;u++){var f=this.getAxisProxy(s,a.indexList[u]);if(f.hostedBy(this))return f;r||(r=f)}return r},t.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},t.prototype.getOrient=function(){return this._orient},t.type="dataZoom",t.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],t.defaultOption={z:4,filterMode:"filter",start:0,end:100},t}(gn);function pq(i){var t={};return gt(["start","end","startValue","endValue","throttle"],function(e){i.hasOwnProperty(e)&&(t[e]=i[e])}),t}const wS=Fzt;var Nzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.select",t}(wS);const Vzt=Nzt;var Uzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){this.dataZoomModel=e,this.ecModel=r,this.api=n},t.type="dataZoom",t}(Oa);const TN=Uzt;var Gzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.select",t}(TN);const Hzt=Gzt;var jy=gt,gq=Dc,jzt=function(){function i(t,e,r,n){this._dimName=t,this._axisIndex=e,this.ecModel=n,this._dataZoomModel=r}return i.prototype.hostedBy=function(t){return this._dataZoomModel===t},i.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},i.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},i.prototype.getTargetSeriesModels=function(){var t=[];return this.ecModel.eachSeries(function(e){if(zzt(e)){var r=mp(this._dimName),n=e.getReferringComponents(r,Wa).models[0];n&&this._axisIndex===n.componentIndex&&t.push(e)}},this),t},i.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},i.prototype.getMinMaxSpan=function(){return Yi(this._minMaxSpan)},i.prototype.calculateDataWindow=function(t){var e=this._dataExtent,r=this.getAxisModel(),n=r.axis.scale,o=this._dataZoomModel.getRangePropMode(),s=[0,100],a=[],u=[],f;jy(["start","end"],function(y,w){var I=t[y],E=t[y+"Value"];o[w]==="percent"?(I==null&&(I=s[w]),E=n.parse(Ln(I,s,e))):(f=!0,E=E==null?e[w]:n.parse(E),I=Ln(E,e,s)),u[w]=E==null||isNaN(E)?e[w]:E,a[w]=I==null||isNaN(I)?s[w]:I}),gq(u),gq(a);var g=this._minMaxSpan;f?v(u,a,e,s,!1):v(a,u,s,e,!0);function v(y,w,I,E,D){var R=D?"Span":"ValueSpan";Op(0,y,I,"all",g["min"+R],g["max"+R]);for(var z=0;z<2;z++)w[z]=Ln(y[z],I,E,!0),D&&(w[z]=n.parse(w[z]))}return{valueWindow:u,percentWindow:a}},i.prototype.reset=function(t){if(t===this._dataZoomModel){var e=this.getTargetSeriesModels();this._dataExtent=Wzt(this,this._dimName,e),this._updateMinMaxSpan();var r=this.calculateDataWindow(t.settledOption);this._valueWindow=r.valueWindow,this._percentWindow=r.percentWindow,this._setAxisModel()}},i.prototype.filterData=function(t,e){if(t!==this._dataZoomModel)return;var r=this._dimName,n=this.getTargetSeriesModels(),o=t.get("filterMode"),s=this._valueWindow;if(o==="none")return;jy(n,function(u){var f=u.getData(),g=f.mapDimensionsAll(r);if(g.length){if(o==="weakFilter"){var v=f.getStore(),y=ti(g,function(w){return f.getDimensionIndex(w)},f);f.filterSelf(function(w){for(var I,E,D,R=0;R<g.length;R++){var z=v.get(y[R],w),N=!isNaN(z),H=z<s[0],$=z>s[1];if(N&&!H&&!$)return!0;N&&(D=!0),H&&(I=!0),$&&(E=!0)}return D&&I&&E})}else jy(g,function(w){if(o==="empty")u.setData(f=f.map(w,function(E){return a(E)?E:NaN}));else{var I={};I[w]=s,f.selectRange(I)}});jy(g,function(w){f.setApproximateExtent(s,w)})}});function a(u){return u>=s[0]&&u<=s[1]}},i.prototype._updateMinMaxSpan=function(){var t=this._minMaxSpan={},e=this._dataZoomModel,r=this._dataExtent;jy(["min","max"],function(n){var o=e.get(n+"Span"),s=e.get(n+"ValueSpan");s!=null&&(s=this.getAxisModel().axis.scale.parse(s)),s!=null?o=Ln(r[0]+s,r,[0,100],!0):o!=null&&(s=Ln(o,[0,100],r,!0)-r[0]),t[n+"Span"]=o,t[n+"ValueSpan"]=s},this)},i.prototype._setAxisModel=function(){var t=this.getAxisModel(),e=this._percentWindow,r=this._valueWindow;if(e){var n=$Y(r,[0,500]);n=Math.min(n,20);var o=t.axis.scale.rawExtentInfo;e[0]!==0&&o.setDeterminedMinMax("min",+r[0].toFixed(n)),e[1]!==100&&o.setDeterminedMinMax("max",+r[1].toFixed(n)),o.freeze()}},i}();function Wzt(i,t,e){var r=[1/0,-1/0];jy(e,function(s){oTt(r,s.getData(),t)});var n=i.getAxisModel(),o=ott(n.axis.scale,n,r).calculate();return[o.min,o.max]}const $zt=jzt;var Zzt={getTargetSeries:function(i){function t(n){i.eachComponent("dataZoom",function(o){o.eachTargetAxis(function(s,a){var u=i.getComponent(mp(s),a);n(s,a,u,o)})})}t(function(n,o,s,a){s.__dzAxisProxy=null});var e=[];t(function(n,o,s,a){s.__dzAxisProxy||(s.__dzAxisProxy=new $zt(n,o,a,i),e.push(s.__dzAxisProxy))});var r=Fi();return gt(e,function(n){gt(n.getTargetSeriesModels(),function(o){r.set(o.uid,o)})}),r},overallReset:function(i,t){i.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(r,n){e.getAxisProxy(r,n).reset(e)}),e.eachTargetAxis(function(r,n){e.getAxisProxy(r,n).filterData(e,t)})}),i.eachComponent("dataZoom",function(e){var r=e.findRepresentativeAxisProxy();if(r){var n=r.getDataPercentWindow(),o=r.getDataValueWindow();e.setCalculatedRange({start:n[0],end:n[1],startValue:o[0],endValue:o[1]})}})}};const qzt=Zzt;function Xzt(i){i.registerAction("dataZoom",function(t,e){var r=Bzt(e,t);gt(r,function(n){n.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})})})}var mq=!1;function AN(i){mq||(mq=!0,i.registerProcessor(i.PRIORITY.PROCESSOR.FILTER,qzt),Xzt(i),i.registerSubTypeDefaulter("dataZoom",function(){return"slider"}))}function Yzt(i){i.registerComponentModel(Vzt),i.registerComponentView(Hzt),AN(i)}var Ic=function(){function i(){}return i}(),prt={};function Wy(i,t){prt[i]=t}function grt(i){return prt[i]}var Kzt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){i.prototype.optionUpdated.apply(this,arguments);var e=this.ecModel;gt(this.option.feature,function(r,n){var o=grt(n);o&&(o.getDefaultOption&&(o.defaultOption=o.getDefaultOption(e)),Er(r,o.defaultOption))})},t.type="toolbox",t.layoutMode={type:"box",ignoreSize:!0},t.defaultOption={show:!0,z:6,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:_e.color.border,borderRadius:0,borderWidth:0,padding:_e.size.m,itemSize:15,itemGap:_e.size.s,showTitle:!0,iconStyle:{borderColor:_e.color.accent50,color:"none"},emphasis:{iconStyle:{borderColor:_e.color.accent50}},tooltip:{show:!1,position:"bottom"}},t}(gn);const Jzt=Kzt;function mrt(i,t){var e=FS(t.get("padding")),r=t.getItemStyle(["color","opacity"]);r.fill=t.get("backgroundColor");var n=new jr({shape:{x:i.x-e[3],y:i.y-e[0],width:i.width+e[1]+e[3],height:i.height+e[0]+e[2],r:t.get("borderRadius")},style:r,silent:!0,z2:-1});return n}var Qzt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.render=function(e,r,n,o){var s=this.group;if(s.removeAll(),!e.get("show"))return;var a=+e.get("itemSize"),u=e.get("orient")==="vertical",f=e.get("feature")||{},g=this._features||(this._features={}),v=[];gt(f,function(z,N){v.push(N)}),new Od(this._featureNames||[],v).add(y).update(y).remove(br(y,null)).execute(),this._featureNames=v;function y(z,N){var H=v[z],$=v[N],X=f[H],K=new bn(X,e,e.ecModel),et;if(o&&o.newTitle!=null&&o.featureName===H&&(X.title=o.newTitle),H&&!$){if(tBt(H))et={onclick:K.option.onclick,featureName:H};else{var rt=grt(H);if(!rt)return;et=new rt}g[H]=et}else if(et=g[$],!et)return;et.uid=H0("toolbox-feature"),et.model=K,et.ecModel=r,et.api=n;var lt=et instanceof Ic;if(!H&&$){lt&&et.dispose&&et.dispose(r,n);return}if(!K.get("show")||lt&&et.unusable){lt&&et.remove&&et.remove(r,n);return}w(K,et,H),K.setIconStatus=function(ht,yt){var ft=this.option,kt=this.iconPaths;ft.iconStatus=ft.iconStatus||{},ft.iconStatus[ht]=yt,kt[ht]&&(yt==="emphasis"?Rd:kd)(kt[ht])},et instanceof Ic&&et.render&&et.render(K,r,n,o)}function w(z,N,H){var $=z.getModel("iconStyle"),X=z.getModel(["emphasis","iconStyle"]),K=N instanceof Ic&&N.getIcons?N.getIcons():z.get("icon"),et=z.get("title")||{},rt,lt;bi(K)?(rt={},rt[H]=K):rt=K,bi(et)?(lt={},lt[H]=et):lt=et;var ht=z.iconPaths={};gt(rt,function(yt,ft){var kt=BS(yt,{},{x:-a/2,y:-a/2,width:a,height:a});kt.setStyle($.getItemStyle());var Rt=kt.ensureState("emphasis");Rt.style=X.getItemStyle();var Ct=new _n({style:{text:lt[ft],align:X.get("textAlign"),borderRadius:X.get("textBorderRadius"),padding:X.get("textPadding"),fill:null,font:WF({fontStyle:X.get("textFontStyle"),fontFamily:X.get("textFontFamily"),fontSize:X.get("textFontSize"),fontWeight:X.get("textFontWeight")},r)},ignore:!0});kt.setTextContent(Ct),Gd({el:kt,componentModel:e,itemName:ft,formatterParamsExtra:{title:lt[ft]}}),kt.__title=lt[ft],kt.on("mouseover",function(){var Gt=X.getItemStyle(),Vt=u?e.get("right")==null&&e.get("left")!=="right"?"right":"left":e.get("bottom")==null&&e.get("top")!=="bottom"?"bottom":"top";Ct.setStyle({fill:X.get("textFill")||Gt.fill||Gt.stroke||_e.color.neutral99,backgroundColor:X.get("textBackgroundColor")}),kt.setTextConfig({position:X.get("textPosition")||Vt}),Ct.ignore=!e.get("showTitle"),n.enterEmphasis(this)}).on("mouseout",function(){z.get(["iconStatus",ft])!=="emphasis"&&n.leaveEmphasis(this),Ct.hide()}),(z.get(["iconStatus",ft])==="emphasis"?Rd:kd)(kt),s.add(kt),kt.on("click",wi(N.onclick,N,r,n,ft)),ht[ft]=kt})}var I=Bo(e,n).refContainer,E=e.getBoxLayoutParams(),D=e.get("padding"),R=Ca(E,I,D);ov(e.get("orient"),s,e.get("itemGap"),R.width,R.height),vE(s,E,I,D),s.add(mrt(s.getBoundingRect(),e)),u||s.eachChild(function(z){var N=z.__title,H=z.ensureState("emphasis"),$=H.textConfig||(H.textConfig={}),X=z.getTextContent(),K=X&&X.ensureState("emphasis");if(K&&!Xi(K)&&N){var et=K.style||(K.style={}),rt=eE(N,_n.makeFont(et)),lt=z.x+s.x,ht=z.y+s.y+a,yt=!1;ht+rt.height>n.getHeight()&&($.position="top",yt=!0);var ft=yt?-5-rt.height:a+10;lt+rt.width/2>n.getWidth()?($.position=["100%",ft],et.align="right"):lt-rt.width/2<0&&($.position=[0,ft],et.align="left")}})},t.prototype.updateView=function(e,r,n,o){gt(this._features,function(s){s instanceof Ic&&s.updateView&&s.updateView(s.model,r,n,o)})},t.prototype.remove=function(e,r){gt(this._features,function(n){n instanceof Ic&&n.remove&&n.remove(e,r)}),this.group.removeAll()},t.prototype.dispose=function(e,r){gt(this._features,function(n){n instanceof Ic&&n.dispose&&n.dispose(e,r)})},t.type="toolbox",t}(Oa);function tBt(i){return i.indexOf("my")===0}const eBt=Qzt;var iBt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.onclick=function(e,r){var n=this.model,o=n.get("name")||e.get("title.0.text")||"echarts",s=r.getZr().painter.getType()==="svg",a=s?"svg":n.get("type",!0)||"png",u=r.getConnectedDataURL({type:a,backgroundColor:n.get("backgroundColor",!0)||e.get("backgroundColor")||_e.color.neutral00,connectedBackgroundColor:n.get("connectedBackgroundColor"),excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")}),f=Sn.browser;if(typeof MouseEvent=="function"&&(f.newEdge||!f.ie&&!f.edge)){var g=document.createElement("a");g.download=o+"."+a,g.target="_blank",g.href=u;var v=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1});g.dispatchEvent(v)}else if(window.navigator.msSaveOrOpenBlob||s){var y=u.split(","),w=y[0].indexOf("base64")>-1,I=s?decodeURIComponent(y[1]):y[1];w&&(I=window.atob(I));var E=o+"."+a;if(window.navigator.msSaveOrOpenBlob){for(var D=I.length,R=new Uint8Array(D);D--;)R[D]=I.charCodeAt(D);var z=new Blob([R]);window.navigator.msSaveOrOpenBlob(z,E)}else{var N=document.createElement("iframe");document.body.appendChild(N);var H=N.contentWindow,$=H.document;$.open("image/svg+xml","replace"),$.write(I),$.close(),H.focus(),$.execCommand("SaveAs",!0,E),document.body.removeChild(N)}}else{var X=n.get("lang"),K='<body style="margin:0;"><img src="'+u+'" style="max-width:100%;" title="'+(X&&X[0]||"")+'" /></body>',et=window.open();et.document.write(K),et.document.title=o}},t.getDefaultOption=function(e){var r={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:e.getLocaleModel().get(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:_e.color.neutral00,name:"",excludeComponents:["toolbox"],lang:e.getLocaleModel().get(["toolbox","saveAsImage","lang"])};return r},t}(Ic);const rBt=iBt;var vq="__ec_magicType_stack__",nBt=[["line","bar"],["stack"]],aBt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getIcons=function(){var e=this.model,r=e.get("icon"),n={};return gt(e.get("type"),function(o){r[o]&&(n[o]=r[o])}),n},t.getDefaultOption=function(e){var r={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:e.getLocaleModel().get(["toolbox","magicType","title"]),option:{},seriesIndex:{}};return r},t.prototype.onclick=function(e,r,n){var o=this.model,s=o.get(["seriesIndex",n]);if(_q[n]){var a={series:[]},u=function(v){var y=v.subType,w=v.id,I=_q[n](y,w,v,o);I&&(rr(I,v.option),a.series.push(I));var E=v.coordinateSystem;if(E&&E.type==="cartesian2d"&&(n==="line"||n==="bar")){var D=E.getAxesByScale("ordinal")[0];if(D){var R=D.dim,z=R+"Axis",N=v.getReferringComponents(z,Wa).models[0],H=N.componentIndex;a[z]=a[z]||[];for(var $=0;$<=H;$++)a[z][H]=a[z][H]||{};a[z][H].boundaryGap=n==="bar"}}};gt(nBt,function(v){Ar(v,n)>=0&&gt(v,function(y){o.setIconStatus(y,"normal")})}),o.setIconStatus(n,"emphasis"),e.eachComponent({mainType:"series",query:s==null?null:{seriesIndex:s}},u);var f,g=n;n==="stack"&&(f=Er({stack:o.option.title.tiled,tiled:o.option.title.stack},o.option.title),o.get(["iconStatus",n])!=="emphasis"&&(g="tiled")),r.dispatchAction({type:"changeMagicType",currentType:g,newOption:a,newTitle:f,featureName:"magicType"})}},t}(Ic),_q={line:function(i,t,e,r){if(i==="bar")return Er({id:t,type:"line",data:e.get("data"),stack:e.get("stack"),markPoint:e.get("markPoint"),markLine:e.get("markLine")},r.get(["option","line"])||{},!0)},bar:function(i,t,e,r){if(i==="line")return Er({id:t,type:"bar",data:e.get("data"),stack:e.get("stack"),markPoint:e.get("markPoint"),markLine:e.get("markLine")},r.get(["option","bar"])||{},!0)},stack:function(i,t,e,r){var n=e.get("stack")===vq;if(i==="line"||i==="bar")return r.setIconStatus("stack",n?"normal":"emphasis"),Er({id:t,stack:n?"":vq},r.get(["option","stack"])||{},!0)}};Ah({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(i,t){t.mergeOption(i.newOption)});const oBt=aBt;var kE=new Array(60).join("-"),P0="	";function sBt(i){var t={},e=[],r=[];return i.eachRawSeries(function(n){var o=n.coordinateSystem;if(o&&(o.type==="cartesian2d"||o.type==="polar")){var s=o.getBaseAxis();if(s.type==="category"){var a=s.dim+"_"+s.index;t[a]||(t[a]={categoryAxis:s,valueAxis:o.getOtherAxis(s),series:[]},r.push({axisDim:s.dim,axisIndex:s.index})),t[a].series.push(n)}else e.push(n)}else e.push(n)}),{seriesGroupByCategoryAxis:t,other:e,meta:r}}function lBt(i){var t=[];return gt(i,function(e,r){var n=e.categoryAxis,o=e.valueAxis,s=o.dim,a=[" "].concat(ti(e.series,function(w){return w.name})),u=[n.model.getCategories()];gt(e.series,function(w){var I=w.getRawData();u.push(w.getRawData().mapArray(I.mapDimension(s),function(E){return E}))});for(var f=[a.join(P0)],g=0;g<u[0].length;g++){for(var v=[],y=0;y<u.length;y++)v.push(u[y][g]);f.push(v.join(P0))}t.push(f.join(`
`))}),t.join(`

`+kE+`

`)}function cBt(i){return ti(i,function(t){var e=t.getRawData(),r=[t.name],n=[];return e.each(e.dimensions,function(){for(var o=arguments.length,s=arguments[o-1],a=e.getName(s),u=0;u<o-1;u++)n[u]=arguments[u];r.push((a?a+P0:"")+n.join(P0))}),r.join(`
`)}).join(`

`+kE+`

`)}function uBt(i){var t=sBt(i);return{value:Rn([lBt(t.seriesGroupByCategoryAxis),cBt(t.other)],function(e){return!!e.replace(/[\n\t\s]/g,"")}).join(`

`+kE+`

`),meta:t.meta}}function yC(i){return i.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function hBt(i){var t=i.slice(0,i.indexOf(`
`));if(t.indexOf(P0)>=0)return!0}var pB=new RegExp("["+P0+"]+","g");function dBt(i){for(var t=i.split(/\n+/g),e=yC(t.shift()).split(pB),r=[],n=ti(e,function(u){return{name:u,data:[]}}),o=0;o<t.length;o++){var s=yC(t[o]).split(pB);r.push(s.shift());for(var a=0;a<s.length;a++)n[a]&&(n[a].data[o]=s[a])}return{series:n,categories:r}}function fBt(i){for(var t=i.split(/\n+/g),e=yC(t.shift()),r=[],n=0;n<t.length;n++){var o=yC(t[n]);if(o){var s=o.split(pB),a="",u=void 0,f=!1;isNaN(s[0])?(f=!0,a=s[0],s=s.slice(1),r[n]={name:a,value:[]},u=r[n].value):u=r[n]=[];for(var g=0;g<s.length;g++)u.push(+s[g]);u.length===1&&(f?r[n].value=u[0]:r[n]=u[0])}}return{name:e,data:r}}function pBt(i,t){var e=i.split(new RegExp(`
*`+kE+`
*`,"g")),r={series:[]};return gt(e,function(n,o){if(hBt(n)){var s=dBt(n),a=t[o],u=a.axisDim+"Axis";a&&(r[u]=r[u]||[],r[u][a.axisIndex]={data:s.categories},r.series=r.series.concat(s.series))}else{var s=fBt(n);r.series.push(s)}}),r}var gBt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.onclick=function(e,r){setTimeout(function(){r.dispatchAction({type:"hideTip"})});var n=r.getDom(),o=this.model;this._dom&&n.removeChild(this._dom);var s=document.createElement("div");s.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;padding:5px",s.style.backgroundColor=o.get("backgroundColor")||_e.color.neutral00;var a=document.createElement("h4"),u=o.get("lang")||[];a.innerHTML=u[0]||o.get("title"),a.style.cssText="margin:10px 20px",a.style.color=o.get("textColor");var f=document.createElement("div"),g=document.createElement("textarea");f.style.cssText="overflow:auto";var v=o.get("optionToContent"),y=o.get("contentToOption"),w=uBt(e);if(Xi(v)){var I=v(r.getOption());bi(I)?f.innerHTML=I:_0(I)&&f.appendChild(I)}else{g.readOnly=o.get("readOnly");var E=g.style;E.cssText="display:block;width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;resize:none;box-sizing:border-box;outline:none",E.color=o.get("textColor"),E.borderColor=o.get("textareaBorderColor"),E.backgroundColor=o.get("textareaColor"),g.value=w.value,f.appendChild(g)}var D=w.meta,R=document.createElement("div");R.style.cssText="position:absolute;bottom:5px;left:0;right:0";var z="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",N=document.createElement("div"),H=document.createElement("div");z+=";background-color:"+o.get("buttonColor"),z+=";color:"+o.get("buttonTextColor");var $=this;function X(){n.removeChild(s),$._dom=null}MO(N,"click",X),MO(H,"click",function(){if(y==null&&v!=null||y!=null&&v==null){X();return}var K;try{Xi(y)?K=y(f,r.getOption()):K=pBt(g.value,D)}catch(et){throw X(),new Error("Data view format error "+et)}K&&r.dispatchAction({type:"changeDataView",newOption:K}),X()}),N.innerHTML=u[1],H.innerHTML=u[2],H.style.cssText=N.style.cssText=z,!o.get("readOnly")&&R.appendChild(H),R.appendChild(N),s.appendChild(a),s.appendChild(f),s.appendChild(R),f.style.height=n.clientHeight-80+"px",n.appendChild(s),this._dom=s},t.prototype.remove=function(e,r){this._dom&&r.getDom().removeChild(this._dom)},t.prototype.dispose=function(e,r){this.remove(e,r)},t.getDefaultOption=function(e){var r={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:e.getLocaleModel().get(["toolbox","dataView","title"]),lang:e.getLocaleModel().get(["toolbox","dataView","lang"]),backgroundColor:_e.color.background,textColor:_e.color.primary,textareaColor:_e.color.background,textareaBorderColor:_e.color.border,buttonColor:_e.color.accent50,buttonTextColor:_e.color.neutral00};return r},t}(Ic);function mBt(i,t){return ti(i,function(e,r){var n=t&&t[r];if(nr(n)&&!Ye(n)){var o=nr(e)&&!Ye(e);o||(e={value:e});var s=n.name!=null&&e.name==null;return e=rr(e,n),s&&delete e.name,e}else return e})}Ah({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(i,t){var e=[];gt(i.newOption.series,function(r){var n=t.getSeriesByName(r.name)[0];if(!n)e.push(Fe({type:"scatter"},r));else{var o=n.get("data");e.push({name:r.name,data:mBt(r.data,o)})}}),t.mergeOption(rr({series:e},i.newOption))});const vBt=gBt;var vrt=gt,_rt=Wr();function _Bt(i,t){var e=IN(i);vrt(t,function(r,n){for(var o=e.length-1;o>=0;o--){var s=e[o];if(s[n])break}if(o<0){var a=i.queryComponents({mainType:"dataZoom",subType:"select",id:n})[0];if(a){var u=a.getPercentRange();e[0][n]={dataZoomId:n,start:u[0],end:u[1]}}}}),e.push(t)}function yBt(i){var t=IN(i),e=t[t.length-1];t.length>1&&t.pop();var r={};return vrt(e,function(n,o){for(var s=t.length-1;s>=0;s--)if(n=t[s][o],n){r[o]=n;break}}),r}function xBt(i){_rt(i).snapshots=null}function bBt(i){return IN(i).length}function IN(i){var t=_rt(i);return t.snapshots||(t.snapshots=[{}]),t.snapshots}var wBt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.onclick=function(e,r){xBt(e),r.dispatchAction({type:"restore",from:this.uid})},t.getDefaultOption=function(e){var r={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:e.getLocaleModel().get(["toolbox","restore","title"])};return r},t}(Ic);Ah({type:"restore",event:"restore",update:"prepareAndUpdate"},function(i,t){t.resetOption("recreate")});const SBt=wBt;var TBt=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"],ABt=function(){function i(t,e,r){var n=this;this._targetInfoList=[];var o=yq(e,t);gt(IBt,function(s,a){(!r||!r.include||Ar(r.include,a)>=0)&&s(o,n._targetInfoList)})}return i.prototype.setOutputRanges=function(t,e){return this.matchOutputRanges(t,e,function(r,n,o){if((r.coordRanges||(r.coordRanges=[])).push(n),!r.coordRange){r.coordRange=n;var s=Ik[r.brushType](0,o,n);r.__rangeOffset={offset:Sq[r.brushType](s.values,r.range,[1,1]),xyMinMax:s.xyMinMax}}}),t},i.prototype.matchOutputRanges=function(t,e,r){gt(t,function(n){var o=this.findTargetInfo(n,e);o&&o!==!0&&gt(o.coordSyses,function(s){var a=Ik[n.brushType](1,s,n.range,!0);r(n,a.values,s,e)})},this)},i.prototype.setInputRanges=function(t,e){gt(t,function(r){var n=this.findTargetInfo(r,e);if(r.range=r.range||[],n&&n!==!0){r.panelId=n.panelId;var o=Ik[r.brushType](0,n.coordSys,r.coordRange),s=r.__rangeOffset;r.range=s?Sq[r.brushType](o.values,s.offset,MBt(o.xyMinMax,s.xyMinMax)):o.values}},this)},i.prototype.makePanelOpts=function(t,e){return ti(this._targetInfoList,function(r){var n=r.getPanelRect();return{panelId:r.panelId,defaultBrushType:e?e(r):null,clipPath:wit(n),isTargetByCursor:Tit(n,t,r.coordSysModel),getLinearBrushOtherExtent:Sit(n)}})},i.prototype.controlSeries=function(t,e,r){var n=this.findTargetInfo(t,r);return n===!0||n&&Ar(n.coordSyses,e.coordinateSystem)>=0},i.prototype.findTargetInfo=function(t,e){for(var r=this._targetInfoList,n=yq(e,t),o=0;o<r.length;o++){var s=r[o],a=t.panelId;if(a){if(s.panelId===a)return s}else for(var u=0;u<xq.length;u++)if(xq[u](n,s))return s}return!0},i}();function gB(i){return i[0]>i[1]&&i.reverse(),i}function yq(i,t){return s0(i,t,{includeMainTypes:TBt})}var IBt={grid:function(i,t){var e=i.xAxisModels,r=i.yAxisModels,n=i.gridModels,o=Fi(),s={},a={};!e&&!r&&!n||(gt(e,function(u){var f=u.axis.grid.model;o.set(f.id,f),s[f.id]=!0}),gt(r,function(u){var f=u.axis.grid.model;o.set(f.id,f),a[f.id]=!0}),gt(n,function(u){o.set(u.id,u),s[u.id]=!0,a[u.id]=!0}),o.each(function(u){var f=u.coordinateSystem,g=[];gt(f.getCartesians(),function(v,y){(Ar(e,v.getAxis("x").model)>=0||Ar(r,v.getAxis("y").model)>=0)&&g.push(v)}),t.push({panelId:"grid--"+u.id,gridModel:u,coordSysModel:u,coordSys:g[0],coordSyses:g,getPanelRect:bq.grid,xAxisDeclared:s[u.id],yAxisDeclared:a[u.id]})}))},geo:function(i,t){gt(i.geoModels,function(e){var r=e.coordinateSystem;t.push({panelId:"geo--"+e.id,geoModel:e,coordSysModel:e,coordSys:r,coordSyses:[r],getPanelRect:bq.geo})})}},xq=[function(i,t){var e=i.xAxisModel,r=i.yAxisModel,n=i.gridModel;return!n&&e&&(n=e.axis.grid.model),!n&&r&&(n=r.axis.grid.model),n&&n===t.gridModel},function(i,t){var e=i.geoModel;return e&&e===t.geoModel}],bq={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var i=this.coordSys,t=i.getBoundingRect().clone();return t.applyTransform(av(i)),t}},Ik={lineX:br(wq,0),lineY:br(wq,1),rect:function(i,t,e,r){var n=i?t.pointToData([e[0][0],e[1][0]],r):t.dataToPoint([e[0][0],e[1][0]],r),o=i?t.pointToData([e[0][1],e[1][1]],r):t.dataToPoint([e[0][1],e[1][1]],r),s=[gB([n[0],o[0]]),gB([n[1],o[1]])];return{values:s,xyMinMax:s}},polygon:function(i,t,e,r){var n=[[1/0,-1/0],[1/0,-1/0]],o=ti(e,function(s){var a=i?t.pointToData(s,r):t.dataToPoint(s,r);return n[0][0]=Math.min(n[0][0],a[0]),n[1][0]=Math.min(n[1][0],a[1]),n[0][1]=Math.max(n[0][1],a[0]),n[1][1]=Math.max(n[1][1],a[1]),a});return{values:o,xyMinMax:n}}};function wq(i,t,e,r){var n=e.getAxis(["x","y"][i]),o=gB(ti([0,1],function(a){return t?n.coordToData(n.toLocalCoord(r[a]),!0):n.toGlobalCoord(n.dataToCoord(r[a]))})),s=[];return s[i]=o,s[1-i]=[NaN,NaN],{values:o,xyMinMax:s}}var Sq={lineX:br(Tq,0),lineY:br(Tq,1),rect:function(i,t,e){return[[i[0][0]-e[0]*t[0][0],i[0][1]-e[0]*t[0][1]],[i[1][0]-e[1]*t[1][0],i[1][1]-e[1]*t[1][1]]]},polygon:function(i,t,e){return ti(i,function(r,n){return[r[0]-e[0]*t[n][0],r[1]-e[1]*t[n][1]]})}};function Tq(i,t,e,r){return[t[0]-r[i]*e[0],t[1]-r[i]*e[1]]}function MBt(i,t){var e=Aq(i),r=Aq(t),n=[e[0]/r[0],e[1]/r[1]];return isNaN(n[0])&&(n[0]=1),isNaN(n[1])&&(n[1]=1),n}function Aq(i){return i?[i[0][1]-i[0][0],i[1][1]-i[1][0]]:[NaN,NaN]}const MN=ABt;var mB=gt,CBt=Ryt("toolbox-dataZoom_"),EBt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.render=function(e,r,n,o){this._brushController||(this._brushController=new rN(n.getZr()),this._brushController.on("brush",wi(this._onBrush,this)).mount()),LBt(e,r,this,o,n),PBt(e,r)},t.prototype.onclick=function(e,r,n){DBt[n].call(this)},t.prototype.remove=function(e,r){this._brushController&&this._brushController.unmount()},t.prototype.dispose=function(e,r){this._brushController&&this._brushController.dispose()},t.prototype._onBrush=function(e){var r=e.areas;if(!e.isEnd||!r.length)return;var n={},o=this.ecModel;this._brushController.updateCovers([]);var s=new MN(CN(this.model),o,{include:["grid"]});s.matchOutputRanges(r,o,function(f,g,v){if(v.type==="cartesian2d"){var y=f.brushType;y==="rect"?(a("x",v,g[0]),a("y",v,g[1])):a({lineX:"x",lineY:"y"}[y],v,g)}}),_Bt(o,n),this._dispatchZoomAction(n);function a(f,g,v){var y=g.getAxis(f),w=y.model,I=u(f,w,o),E=I.findRepresentativeAxisProxy(w).getMinMaxSpan();(E.minValueSpan!=null||E.maxValueSpan!=null)&&(v=Op(0,v.slice(),y.scale.getExtent(),0,E.minValueSpan,E.maxValueSpan)),I&&(n[I.id]={dataZoomId:I.id,startValue:v[0],endValue:v[1]})}function u(f,g,v){var y;return v.eachComponent({mainType:"dataZoom",subType:"select"},function(w){var I=w.getAxisModel(f,g.componentIndex);I&&(y=w)}),y}},t.prototype._dispatchZoomAction=function(e){var r=[];mB(e,function(n,o){r.push(Yi(n))}),r.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:r})},t.getDefaultOption=function(e){var r={show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:e.getLocaleModel().get(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:_e.color.backgroundTint}};return r},t}(Ic),DBt={zoom:function(){var i=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:i})},back:function(){this._dispatchZoomAction(yBt(this.ecModel))}};function CN(i){var t={xAxisIndex:i.get("xAxisIndex",!0),yAxisIndex:i.get("yAxisIndex",!0),xAxisId:i.get("xAxisId",!0),yAxisId:i.get("yAxisId",!0)};return t.xAxisIndex==null&&t.xAxisId==null&&(t.xAxisIndex="all"),t.yAxisIndex==null&&t.yAxisId==null&&(t.yAxisIndex="all"),t}function PBt(i,t){i.setIconStatus("back",bBt(t)>1?"emphasis":"normal")}function LBt(i,t,e,r,n){var o=e._isZoomActive;r&&r.type==="takeGlobalCursor"&&(o=r.key==="dataZoomSelect"?r.dataZoomSelectActive:!1),e._isZoomActive=o,i.setIconStatus("zoom",o?"emphasis":"normal");var s=new MN(CN(i),t,{include:["grid"]}),a=s.makePanelOpts(n,function(u){return u.xAxisDeclared&&!u.yAxisDeclared?"lineX":!u.xAxisDeclared&&u.yAxisDeclared?"lineY":"rect"});e._brushController.setPanels(a).enableBrush(o&&a.length?{brushType:"auto",brushStyle:i.getModel("brushStyle").getItemStyle()}:!1)}A1t("dataZoom",function(i){var t=i.getComponent("toolbox",0),e=["feature","dataZoom"];if(!t||t.get(e)==null)return;var r=t.getModel(e),n=[],o=CN(r),s=s0(i,o);mB(s.xAxisModels,function(u){return a(u,"xAxis","xAxisIndex")}),mB(s.yAxisModels,function(u){return a(u,"yAxis","yAxisIndex")});function a(u,f,g){var v=u.componentIndex,y={type:"select",$fromToolbox:!0,filterMode:r.get("filterMode",!0)||"filter",id:CBt+f+v};y[g]=v,n.push(y)}return n});const RBt=EBt;function kBt(i){i.registerComponentModel(Jzt),i.registerComponentView(eBt),Wy("saveAsImage",rBt),Wy("magicType",oBt),Wy("dataView",vBt),Wy("dataZoom",RBt),Wy("restore",SBt),Rr(Yzt)}var OBt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="tooltip",t.dependencies=["axisPointer"],t.defaultOption={z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,displayTransition:!0,enterable:!1,backgroundColor:_e.color.neutral00,shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,defaultBorderColor:_e.color.border,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:_e.color.borderShade,width:1,type:"dashed",textStyle:{}}},textStyle:{color:_e.color.tertiary,fontSize:14}},t}(gn);const zBt=OBt;function yrt(i){var t=i.get("confine");return t!=null?!!t:i.get("renderMode")==="richText"}function xrt(i){if(Sn.domSupported){for(var t=document.documentElement.style,e=0,r=i.length;e<r;e++)if(i[e]in t)return i[e]}}var brt=xrt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),BBt=xrt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);function wrt(i,t){if(!i)return t;t=mJ(t,!0);var e=i.indexOf(t);return i=e===-1?t:"-"+i.slice(0,e)+"-"+t,i.toLowerCase()}function FBt(i,t){var e=i.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(i);return e?t?e[t]:e:null}var NBt=wrt(BBt,"transition"),EN=wrt(brt,"transform"),VBt="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(Sn.transform3dSupported?"will-change:transform;":"");function UBt(i){return i=i==="left"?"right":i==="right"?"left":i==="top"?"bottom":"top",i}function GBt(i,t,e){if(!bi(e)||e==="inside")return"";var r=i.get("backgroundColor"),n=i.get("borderWidth");t=_v(t);var o=UBt(e),s=Math.max(Math.round(n)*1.5,6),a="",u=EN+":",f;Ar(["left","right"],o)>-1?(a+="top:50%",u+="translateY(-50%) rotate("+(f=o==="left"?-225:-45)+"deg)"):(a+="left:50%",u+="translateX(-50%) rotate("+(f=o==="top"?225:45)+"deg)");var g=f*Math.PI/180,v=s+n,y=v*Math.abs(Math.cos(g))+v*Math.abs(Math.sin(g)),w=Math.round(((y-Math.SQRT2*n)/2+Math.SQRT2*n-(y-v)/2)*100)/100;a+=";"+o+":-"+w+"px";var I=t+" solid "+n+"px;",E=["position:absolute;width:"+s+"px;height:"+s+"px;z-index:-1;",a+";"+u+";","border-bottom:"+I,"border-right:"+I,"background-color:"+r+";"];return'<div style="'+E.join("")+'"></div>'}function HBt(i,t,e){var r="cubic-bezier(0.23,1,0.32,1)",n="",o="";return e&&(n=" "+i/2+"s "+r,o="opacity"+n+",visibility"+n),t||(n=" "+i+"s "+r,o+=(o.length?",":"")+(Sn.transformSupported?""+EN+n:",left"+n+",top"+n)),NBt+":"+o}function Iq(i,t,e){var r=i.toFixed(0)+"px",n=t.toFixed(0)+"px";if(!Sn.transformSupported)return e?"top:"+n+";left:"+r+";":[["top",n],["left",r]];var o=Sn.transform3dSupported,s="translate"+(o?"3d":"")+"("+r+","+n+(o?",0":"")+")";return e?"top:0;left:0;"+EN+":"+s+";":[["top",0],["left",0],[brt,s]]}function jBt(i){var t=[],e=i.get("fontSize"),r=i.getTextColor();r&&t.push("color:"+r),t.push("font:"+i.getFont());var n=Ui(i.get("lineHeight"),Math.round(e*3/2));e&&t.push("line-height:"+n+"px");var o=i.get("textShadowColor"),s=i.get("textShadowBlur")||0,a=i.get("textShadowOffsetX")||0,u=i.get("textShadowOffsetY")||0;return o&&s&&t.push("text-shadow:"+a+"px "+u+"px "+s+"px "+o),gt(["decoration","align"],function(f){var g=i.get(f);g&&t.push("text-"+f+":"+g)}),t.join(";")}function WBt(i,t,e,r){var n=[],o=i.get("transitionDuration"),s=i.get("backgroundColor"),a=i.get("shadowBlur"),u=i.get("shadowColor"),f=i.get("shadowOffsetX"),g=i.get("shadowOffsetY"),v=i.getModel("textStyle"),y=aQ(i,"html"),w=f+"px "+g+"px "+a+"px "+u;return n.push("box-shadow:"+w),t&&o>0&&n.push(HBt(o,e,r)),s&&n.push("background-color:"+s),gt(["width","color","radius"],function(I){var E="border-"+I,D=mJ(E),R=i.get(D);R!=null&&n.push(E+":"+R+(I==="color"?"":"px"))}),n.push(jBt(v)),y!=null&&n.push("padding:"+FS(y).join("px ")+"px"),n.join(";")+";"}function Mq(i,t,e,r,n){var o=t&&t.painter;if(e){var s=o&&o.getViewportRoot();s&&qvt(i,s,e,r,n)}else{i[0]=r,i[1]=n;var a=o&&o.getViewportRootOffset();a&&(i[0]+=a.offsetLeft,i[1]+=a.offsetTop)}i[2]=i[0]/t.getWidth(),i[3]=i[1]/t.getHeight()}var $Bt=function(){function i(t,e){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._alwaysShowContent=!1,this._firstShow=!0,this._longHide=!0,Sn.wxa)return null;var r=document.createElement("div");r.domBelongToZr=!0,this.el=r;var n=this._zr=t.getZr(),o=e.appendTo,s=o&&(bi(o)?document.querySelector(o):_0(o)?o:Xi(o)&&o(t.getDom()));Mq(this._styleCoord,n,s,t.getWidth()/2,t.getHeight()/2),(s||t.getDom()).appendChild(r),this._api=t,this._container=s;var a=this;r.onmouseenter=function(){a._enterable&&(clearTimeout(a._hideTimeout),a._show=!0),a._inContent=!0},r.onmousemove=function(u){if(u=u||window.event,!a._enterable){var f=n.handler,g=n.painter.getViewportRoot();bc(g,u,!0),f.dispatch("mousemove",u)}},r.onmouseleave=function(){a._inContent=!1,a._enterable&&a._show&&a.hideLater(a._hideDelay)}}return i.prototype.update=function(t){if(!this._container){var e=this._api.getDom(),r=FBt(e,"position"),n=e.style;n.position!=="absolute"&&r!=="absolute"&&(n.position="relative")}var o=t.get("alwaysShowContent");o&&this._moveIfResized(),this._alwaysShowContent=o,this._enableDisplayTransition=t.get("displayTransition")&&t.get("transitionDuration")>0,this.el.className=t.get("className")||""},i.prototype.show=function(t,e){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var r=this.el,n=r.style,o=this._styleCoord;r.innerHTML?n.cssText=VBt+WBt(t,!this._firstShow,this._longHide,this._enableDisplayTransition)+Iq(o[0],o[1],!0)+("border-color:"+_v(e)+";")+(t.get("extraCssText")||"")+(";pointer-events:"+(this._enterable?"auto":"none")):n.display="none",this._show=!0,this._firstShow=!1,this._longHide=!1},i.prototype.setContent=function(t,e,r,n,o){var s=this.el;if(t==null){s.innerHTML="";return}var a="";if(bi(o)&&r.get("trigger")==="item"&&!yrt(r)&&(a=GBt(r,n,o)),bi(t))s.innerHTML=t+a;else if(t){s.innerHTML="",Ye(t)||(t=[t]);for(var u=0;u<t.length;u++)_0(t[u])&&t[u].parentNode!==s&&s.appendChild(t[u]);if(a&&s.childNodes.length){var f=document.createElement("div");f.innerHTML=a,s.appendChild(f)}}},i.prototype.setEnterable=function(t){this._enterable=t},i.prototype.getSize=function(){var t=this.el;return t?[t.offsetWidth,t.offsetHeight]:[0,0]},i.prototype.moveTo=function(t,e){if(this.el){var r=this._styleCoord;if(Mq(r,this._zr,this._container,t,e),r[0]!=null&&r[1]!=null){var n=this.el.style,o=Iq(r[0],r[1]);gt(o,function(s){n[s[0]]=s[1]})}}},i.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},i.prototype.hide=function(){var t=this,e=this.el.style;this._enableDisplayTransition?(e.visibility="hidden",e.opacity="0"):e.display="none",Sn.transform3dSupported&&(e.willChange=""),this._show=!1,this._longHideTimeout=setTimeout(function(){return t._longHide=!0},500)},i.prototype.hideLater=function(t){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(wi(this.hide,this),t)):this.hide())},i.prototype.isShow=function(){return this._show},i.prototype.dispose=function(){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var t=this._zr;Xvt(t&&t.painter&&t.painter.getViewportRoot(),this._container);var e=this.el;if(e){e.onmouseenter=e.onmousemove=e.onmouseleave=null;var r=e.parentNode;r&&r.removeChild(e)}this.el=this._container=null},i}();const ZBt=$Bt;var qBt=function(){function i(t){this._show=!1,this._styleCoord=[0,0,0,0],this._alwaysShowContent=!1,this._enterable=!0,this._zr=t.getZr(),Eq(this._styleCoord,this._zr,t.getWidth()/2,t.getHeight()/2)}return i.prototype.update=function(t){var e=t.get("alwaysShowContent");e&&this._moveIfResized(),this._alwaysShowContent=e},i.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},i.prototype.setContent=function(t,e,r,n,o){var s=this;nr(t)&&Dn(""),this.el&&this._zr.remove(this.el);var a=r.getModel("textStyle");this.el=new _n({style:{rich:e.richTextStyles,text:t,lineHeight:22,borderWidth:1,borderColor:n,textShadowColor:a.get("textShadowColor"),fill:r.get(["textStyle","color"]),padding:aQ(r,"richText"),verticalAlign:"top",align:"left"},z:r.get("z")}),gt(["backgroundColor","borderRadius","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"],function(f){s.el.style[f]=r.get(f)}),gt(["textShadowBlur","textShadowOffsetX","textShadowOffsetY"],function(f){s.el.style[f]=a.get(f)||0}),this._zr.add(this.el);var u=this;this.el.on("mouseover",function(){u._enterable&&(clearTimeout(u._hideTimeout),u._show=!0),u._inContent=!0}),this.el.on("mouseout",function(){u._enterable&&u._show&&u.hideLater(u._hideDelay),u._inContent=!1})},i.prototype.setEnterable=function(t){this._enterable=t},i.prototype.getSize=function(){var t=this.el,e=this.el.getBoundingRect(),r=Cq(t.style);return[e.width+r.left+r.right,e.height+r.top+r.bottom]},i.prototype.moveTo=function(t,e){var r=this.el;if(r){var n=this._styleCoord;Eq(n,this._zr,t,e),t=n[0],e=n[1];var o=r.style,s=Xf(o.borderWidth||0),a=Cq(o);r.x=t+s+a.left,r.y=e+s+a.top,r.markRedraw()}},i.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},i.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},i.prototype.hideLater=function(t){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(wi(this.hide,this),t)):this.hide())},i.prototype.isShow=function(){return this._show},i.prototype.dispose=function(){this._zr.remove(this.el)},i}();function Xf(i){return Math.max(0,i)}function Cq(i){var t=Xf(i.shadowBlur||0),e=Xf(i.shadowOffsetX||0),r=Xf(i.shadowOffsetY||0);return{left:Xf(t-e),right:Xf(t+e),top:Xf(t-r),bottom:Xf(t+r)}}function Eq(i,t,e,r){i[0]=e,i[1]=r,i[2]=i[0]/t.getWidth(),i[3]=i[1]/t.getHeight()}const XBt=qBt;var YBt=new jr({shape:{x:-1,y:-1,width:2,height:2}}),KBt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){if(!(Sn.node||!r.getDom())){var n=e.getComponent("tooltip"),o=this._renderMode=Vyt(n.get("renderMode"));this._tooltipContent=o==="richText"?new XBt(r):new ZBt(r,{appendTo:n.get("appendToBody",!0)?"body":n.get("appendTo",!0)})}},t.prototype.render=function(e,r,n){if(!(Sn.node||!n.getDom())){this.group.removeAll(),this._tooltipModel=e,this._ecModel=r,this._api=n;var o=this._tooltipContent;o.update(e),o.setEnterable(e.get("enterable")),this._initGlobalListener(),this._keepShow(),this._renderMode!=="richText"&&e.get("transitionDuration")?$0(this,"_updatePosition",50,"fixRate"):sS(this,"_updatePosition")}},t.prototype._initGlobalListener=function(){var e=this._tooltipModel,r=e.get("triggerOn");irt("itemTooltip",this._api,wi(function(n,o,s){r!=="none"&&(r.indexOf(n)>=0?this._tryShow(o,s):n==="leave"&&this._hide(s))},this))},t.prototype._keepShow=function(){var e=this._tooltipModel,r=this._ecModel,n=this._api,o=e.get("triggerOn");if(this._lastX!=null&&this._lastY!=null&&o!=="none"&&o!=="click"){var s=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){!n.isDisposed()&&s.manuallyShowTip(e,r,n,{x:s._lastX,y:s._lastY,dataByCoordSys:s._lastDataByCoordSys})})}},t.prototype.manuallyShowTip=function(e,r,n,o){if(!(o.from===this.uid||Sn.node||!n.getDom())){var s=Dq(o,n);this._ticket="";var a=o.dataByCoordSys,u=eFt(o,r,n);if(u){var f=u.el.getBoundingRect().clone();f.applyTransform(u.el.transform),this._tryShow({offsetX:f.x+f.width/2,offsetY:f.y+f.height/2,target:u.el,position:o.position,positionDefault:"bottom"},s)}else if(o.tooltip&&o.x!=null&&o.y!=null){var g=YBt;g.x=o.x,g.y=o.y,g.update(),ur(g).tooltipConfig={name:null,option:o.tooltip},this._tryShow({offsetX:o.x,offsetY:o.y,target:g},s)}else if(a)this._tryShow({offsetX:o.x,offsetY:o.y,position:o.position,dataByCoordSys:a,tooltipOption:o.tooltipOption},s);else if(o.seriesIndex!=null){if(this._manuallyAxisShowTip(e,r,n,o))return;var v=rrt(o,r),y=v.point[0],w=v.point[1];y!=null&&w!=null&&this._tryShow({offsetX:y,offsetY:w,target:v.el,position:o.position,positionDefault:"bottom"},s)}else o.x!=null&&o.y!=null&&(n.dispatchAction({type:"updateAxisPointer",x:o.x,y:o.y}),this._tryShow({offsetX:o.x,offsetY:o.y,position:o.position,target:n.getZr().findHover(o.x,o.y).target},s))}},t.prototype.manuallyHideTip=function(e,r,n,o){var s=this._tooltipContent;this._tooltipModel&&s.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,o.from!==this.uid&&this._hide(Dq(o,n))},t.prototype._manuallyAxisShowTip=function(e,r,n,o){var s=o.seriesIndex,a=o.dataIndex,u=r.getComponent("axisPointer").coordSysAxesInfo;if(!(s==null||a==null||u==null)){var f=r.getSeriesByIndex(s);if(f){var g=f.getData(),v=Fb([g.getItemModel(a),f,(f.coordinateSystem||{}).model],this._tooltipModel);if(v.get("trigger")==="axis")return n.dispatchAction({type:"updateAxisPointer",seriesIndex:s,dataIndex:a,position:o.position}),!0}}},t.prototype._tryShow=function(e,r){var n=e.target,o=this._tooltipModel;if(o){this._lastX=e.offsetX,this._lastY=e.offsetY;var s=e.dataByCoordSys;if(s&&s.length)this._showAxisTooltip(s,e);else if(n){var a=ur(n);if(a.ssrType==="legend")return;this._lastDataByCoordSys=null;var u,f;$m(n,function(g){if(g.tooltipDisabled)return u=f=null,!0;u||f||(ur(g).dataIndex!=null?u=g:ur(g).tooltipConfig!=null&&(f=g))},!0),u?this._showSeriesItemTooltip(e,u,r):f?this._showComponentItemTooltip(e,f,r):this._hide(r)}else this._lastDataByCoordSys=null,this._hide(r)}},t.prototype._showOrMove=function(e,r){var n=e.get("showDelay");r=wi(r,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(r,n):r()},t.prototype._showAxisTooltip=function(e,r){var n=this._ecModel,o=this._tooltipModel,s=[r.offsetX,r.offsetY],a=Fb([r.tooltipOption],o),u=this._renderMode,f=[],g=xo("section",{blocks:[],noHeader:!0}),v=[],y=new sR;gt(e,function(z){gt(z.dataByAxis,function(N){var H=n.getComponent(N.axisDim+"Axis",N.axisIndex),$=N.value;if(!(!H||$==null)){var X=Qit($,H.axis,n,N.seriesDataIndices,N.valueLabelOpt),K=xo("section",{header:X,noHeader:!Ec(X),sortBlocks:!0,blocks:[]});g.blocks.push(K),gt(N.seriesDataIndices,function(et){var rt=n.getSeriesByIndex(et.seriesIndex),lt=et.dataIndexInside,ht=rt.getDataParams(lt);if(!(ht.dataIndex<0)){ht.axisDim=N.axisDim,ht.axisIndex=N.axisIndex,ht.axisType=N.axisType,ht.axisId=N.axisId,ht.axisValue=XM(H.axis,{value:$}),ht.axisValueLabel=X,ht.marker=y.makeTooltipMarker("item",_v(ht.color),u);var yt=jj(rt.formatTooltip(lt,!0,null)),ft=yt.frag;if(ft){var kt=Fb([rt],o).get("valueFormatter");K.blocks.push(kt?Fe({valueFormatter:kt},ft):ft)}yt.text&&v.push(yt.text),f.push(ht)}})}})}),g.blocks.reverse(),v.reverse();var w=r.position,I=a.get("order"),E=Yj(g,y,u,I,n.get("useUTC"),a.get("textStyle"));E&&v.unshift(E);var D=u==="richText"?`

`:"<br/>",R=v.join(D);this._showOrMove(a,function(){this._updateContentNotChangedOnAxis(e,f)?this._updatePosition(a,w,s[0],s[1],this._tooltipContent,f):this._showTooltipContent(a,R,f,Math.random()+"",s[0],s[1],w,null,y)})},t.prototype._showSeriesItemTooltip=function(e,r,n){var o=this._ecModel,s=ur(r),a=s.seriesIndex,u=o.getSeriesByIndex(a),f=s.dataModel||u,g=s.dataIndex,v=s.dataType,y=f.getData(v),w=this._renderMode,I=e.positionDefault,E=Fb([y.getItemModel(g),f,u&&(u.coordinateSystem||{}).model],this._tooltipModel,I?{position:I}:null),D=E.get("trigger");if(!(D!=null&&D!=="item")){var R=f.getDataParams(g,v),z=new sR;R.marker=z.makeTooltipMarker("item",_v(R.color),w);var N=jj(f.formatTooltip(g,!1,v)),H=E.get("order"),$=E.get("valueFormatter"),X=N.frag,K=X?Yj($?Fe({valueFormatter:$},X):X,z,w,H,o.get("useUTC"),E.get("textStyle")):N.text,et="item_"+f.name+"_"+g;this._showOrMove(E,function(){this._showTooltipContent(E,K,R,et,e.offsetX,e.offsetY,e.position,e.target,z)}),n({type:"showTip",dataIndexInside:g,dataIndex:y.getRawIndex(g),seriesIndex:a,from:this.uid})}},t.prototype._showComponentItemTooltip=function(e,r,n){var o=this._renderMode==="html",s=ur(r),a=s.tooltipConfig,u=a.option||{},f=u.encodeHTMLContent;if(bi(u)){var g=u;u={content:g,formatter:g},f=!0}f&&o&&u.content&&(u=Yi(u),u.content=Rs(u.content));var v=[u],y=this._ecModel.getComponent(s.componentMainType,s.componentIndex);y&&v.push(y),v.push({formatter:u.content});var w=e.positionDefault,I=Fb(v,this._tooltipModel,w?{position:w}:null),E=I.get("content"),D=Math.random()+"",R=new sR;this._showOrMove(I,function(){var z=Yi(I.get("formatterParams")||{});this._showTooltipContent(I,E,z,D,e.offsetX,e.offsetY,e.position,r,R)}),n({type:"showTip",from:this.uid})},t.prototype._showTooltipContent=function(e,r,n,o,s,a,u,f,g){if(this._ticket="",!(!e.get("showContent")||!e.get("show"))){var v=this._tooltipContent;v.setEnterable(e.get("enterable"));var y=e.get("formatter");u=u||e.get("position");var w=r,I=this._getNearestPoint([s,a],n,e.get("trigger"),e.get("borderColor"),e.get("defaultBorderColor",!0)),E=I.color;if(y)if(bi(y)){var D=e.ecModel.get("useUTC"),R=Ye(n)?n[0]:n,z=R&&R.axisType&&R.axisType.indexOf("time")>=0;w=y,z&&(w=mE(R.axisValue,w,D)),w=vJ(w,n,!0)}else if(Xi(y)){var N=wi(function(H,$){H===this._ticket&&(v.setContent($,g,e,E,u),this._updatePosition(e,u,s,a,v,n,f))},this);this._ticket=o,w=y(n,o,N)}else w=y;v.setContent(w,g,e,E,u),v.show(e,E),this._updatePosition(e,u,s,a,v,n,f)}},t.prototype._getNearestPoint=function(e,r,n,o,s){if(n==="axis"||Ye(r))return{color:o||s};if(!Ye(r))return{color:o||r.color||r.borderColor}},t.prototype._updatePosition=function(e,r,n,o,s,a,u){var f=this._api.getWidth(),g=this._api.getHeight();r=r||e.get("position");var v=s.getSize(),y=e.get("align"),w=e.get("verticalAlign"),I=u&&u.getBoundingRect().clone();if(u&&I.applyTransform(u.transform),Xi(r)&&(r=r([n,o],a,s.el,I,{viewSize:[f,g],contentSize:v.slice()})),Ye(r))n=xi(r[0],f),o=xi(r[1],g);else if(nr(r)){var E=r;E.width=v[0],E.height=v[1];var D=Ca(E,{width:f,height:g});n=D.x,o=D.y,y=null,w=null}else if(bi(r)&&u){var R=tFt(r,I,v,e.get("borderWidth"));n=R[0],o=R[1]}else{var R=JBt(n,o,s,f,g,y?null:20,w?null:20);n=R[0],o=R[1]}if(y&&(n-=Pq(y)?v[0]/2:y==="right"?v[0]:0),w&&(o-=Pq(w)?v[1]/2:w==="bottom"?v[1]:0),yrt(e)){var R=QBt(n,o,s,f,g);n=R[0],o=R[1]}s.moveTo(n,o)},t.prototype._updateContentNotChangedOnAxis=function(e,r){var n=this._lastDataByCoordSys,o=this._cbParamsList,s=!!n&&n.length===e.length;return s&&gt(n,function(a,u){var f=a.dataByAxis||[],g=e[u]||{},v=g.dataByAxis||[];s=s&&f.length===v.length,s&&gt(f,function(y,w){var I=v[w]||{},E=y.seriesDataIndices||[],D=I.seriesDataIndices||[];s=s&&y.value===I.value&&y.axisType===I.axisType&&y.axisId===I.axisId&&E.length===D.length,s&&gt(E,function(R,z){var N=D[z];s=s&&R.seriesIndex===N.seriesIndex&&R.dataIndex===N.dataIndex}),o&&gt(y.seriesDataIndices,function(R){var z=R.seriesIndex,N=r[z],H=o[z];N&&H&&H.data!==N.data&&(s=!1)})})}),this._lastDataByCoordSys=e,this._cbParamsList=r,!!s},t.prototype._hide=function(e){this._lastDataByCoordSys=null,e({type:"hideTip",from:this.uid})},t.prototype.dispose=function(e,r){Sn.node||!r.getDom()||(sS(this,"_updatePosition"),this._tooltipContent.dispose(),lB("itemTooltip",r))},t.type="tooltip",t}(Oa);function Fb(i,t,e){var r=t.ecModel,n;e?(n=new bn(e,r,r),n=new bn(t.option,n,r)):n=t;for(var o=i.length-1;o>=0;o--){var s=i[o];s&&(s instanceof bn&&(s=s.get("tooltip",!0)),bi(s)&&(s={formatter:s}),s&&(n=new bn(s,n,r)))}return n}function Dq(i,t){return i.dispatchAction||wi(t.dispatchAction,t)}function JBt(i,t,e,r,n,o,s){var a=e.getSize(),u=a[0],f=a[1];return o!=null&&(i+u+o+2>r?i-=u+o:i+=o),s!=null&&(t+f+s>n?t-=f+s:t+=s),[i,t]}function QBt(i,t,e,r,n){var o=e.getSize(),s=o[0],a=o[1];return i=Math.min(i+s,r)-s,t=Math.min(t+a,n)-a,i=Math.max(i,0),t=Math.max(t,0),[i,t]}function tFt(i,t,e,r){var n=e[0],o=e[1],s=Math.ceil(Math.SQRT2*r)+8,a=0,u=0,f=t.width,g=t.height;switch(i){case"inside":a=t.x+f/2-n/2,u=t.y+g/2-o/2;break;case"top":a=t.x+f/2-n/2,u=t.y-o-s;break;case"bottom":a=t.x+f/2-n/2,u=t.y+g+s;break;case"left":a=t.x-n-s,u=t.y+g/2-o/2;break;case"right":a=t.x+f+s,u=t.y+g/2-o/2}return[a,u]}function Pq(i){return i==="center"||i==="middle"}function eFt(i,t,e){var r=EF(i).queryOptionMap,n=r.keys()[0];if(!(!n||n==="series")){var o=F0(t,n,r.get(n),{useDefault:!1,enableAll:!1,enableNone:!1}),s=o.models[0];if(s){var a=e.getViewOfComponentModel(s),u;if(a.group.traverse(function(f){var g=ur(f).tooltipConfig;if(g&&g.name===i.name)return u=f,!0}),u)return{componentMainType:n,componentIndex:s.componentIndex,el:u}}}}const iFt=KBt;function rFt(i){Rr(XS),i.registerComponentModel(zBt),i.registerComponentView(iFt),i.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},uo),i.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},uo)}var nFt=["rect","polygon","keep","clear"];function aFt(i,t){var e=na(i?i.brush:[]);if(e.length){var r=[];gt(e,function(u){var f=u.hasOwnProperty("toolbox")?u.toolbox:[];f instanceof Array&&(r=r.concat(f))});var n=i&&i.toolbox;Ye(n)&&(n=n[0]),n||(n={feature:{}},i.toolbox=[n]);var o=n.feature||(n.feature={}),s=o.brush||(o.brush={}),a=s.type||(s.type=[]);a.push.apply(a,r),oFt(a),t&&!a.length&&a.push.apply(a,nFt)}}function oFt(i){var t={};gt(i,function(e){t[e]=1}),i.length=0,gt(t,function(e,r){i.push(r)})}var Lq=gt;function Rq(i){if(i){for(var t in i)if(i.hasOwnProperty(t))return!0}}function vB(i,t,e){var r={};return Lq(t,function(o){var s=r[o]=n();Lq(i[o],function(a,u){if(_s.isValidType(u)){var f={type:u,visual:a};e&&e(f,o),s[u]=new _s(f),u==="opacity"&&(f=Yi(f),f.type="colorAlpha",s.__hidden.__alphaForOpacity=new _s(f))}})}),r;function n(){var o=function(){};o.prototype.__hidden=o.prototype;var s=new o;return s}}function Srt(i,t,e){var r;gt(e,function(n){t.hasOwnProperty(n)&&Rq(t[n])&&(r=!0)}),r&&gt(e,function(n){t.hasOwnProperty(n)&&Rq(t[n])?i[n]=Yi(t[n]):delete i[n]})}function sFt(i,t,e,r,n,o){var s={};gt(i,function(v){var y=_s.prepareVisualTypes(t[v]);s[v]=y});var a;function u(v){return f3(e,a,v)}function f(v,y){gQ(e,a,v,y)}o==null?e.each(g):e.each([o],g);function g(v,y){a=o==null?v:y;var w=e.getRawDataItem(a);if(!(w&&w.visualMap===!1))for(var I=r.call(n,v),E=t[I],D=s[I],R=0,z=D.length;R<z;R++){var N=D[R];E[N]&&E[N].applyVisual(v,u,f)}}}function lFt(i,t,e,r){var n={};return gt(i,function(o){var s=_s.prepareVisualTypes(t[o]);n[o]=s}),{progress:function(s,a){var u;r!=null&&(u=a.getDimensionIndex(r));function f($){return f3(a,v,$)}function g($,X){gQ(a,v,$,X)}for(var v,y=a.getStore();(v=s.next())!=null;){var w=a.getRawDataItem(v);if(!(w&&w.visualMap===!1))for(var I=r!=null?y.get(u,v):v,E=e(I),D=t[E],R=n[E],z=0,N=R.length;z<N;z++){var H=R[z];D[H]&&D[H].applyVisual(I,f,g)}}}}}function cFt(i){var t=i.brushType,e={point:function(r){return kq[t].point(r,e,i)},rect:function(r){return kq[t].rect(r,e,i)}};return e}var kq={lineX:Oq(0),lineY:Oq(1),rect:{point:function(i,t,e){return i&&e.boundingRect.contain(i[0],i[1])},rect:function(i,t,e){return i&&e.boundingRect.intersect(i)}},polygon:{point:function(i,t,e){return i&&e.boundingRect.contain(i[0],i[1])&&Om(e.range,i[0],i[1])},rect:function(i,t,e){var r=e.range;if(!i||r.length<=1)return!1;var n=i.x,o=i.y,s=i.width,a=i.height,u=r[0];if(Om(r,n,o)||Om(r,n+s,o)||Om(r,n,o+a)||Om(r,n+s,o+a)||sr.create(i).contain(u[0],u[1])||tw(n,o,n+s,o,r)||tw(n,o,n,o+a,r)||tw(n+s,o,n+s,o+a,r)||tw(n,o+a,n+s,o+a,r))return!0}}};function Oq(i){var t=["x","y"],e=["width","height"];return{point:function(r,n,o){if(r){var s=o.range,a=r[i];return Nb(a,s)}},rect:function(r,n,o){if(r){var s=o.range,a=[r[t[i]],r[t[i]]+r[e[i]]];return a[1]<a[0]&&a.reverse(),Nb(a[0],s)||Nb(a[1],s)||Nb(s[0],a)||Nb(s[1],a)}}}}function Nb(i,t){return t[0]<=i&&i<=t[1]}var zq=["inBrush","outOfBrush"],Mk="__ecBrushSelect",_B="__ecInBrushSelectEvent";function Trt(i){i.eachComponent({mainType:"brush"},function(t){var e=t.brushTargetManager=new MN(t.option,i);e.setInputRanges(t.areas,i)})}function uFt(i,t,e){var r=[],n,o;i.eachComponent({mainType:"brush"},function(s){e&&e.type==="takeGlobalCursor"&&s.setBrushOption(e.key==="brush"?e.brushOption:{brushType:!1})}),Trt(i),i.eachComponent({mainType:"brush"},function(s,a){var u={brushId:s.id,brushIndex:a,brushName:s.name,areas:Yi(s.areas),selected:[]};r.push(u);var f=s.option,g=f.brushLink,v=[],y=[],w=[],I=!1;a||(n=f.throttleType,o=f.throttleDelay);var E=ti(s.areas,function($){var X=pFt[$.brushType],K=rr({boundingRect:X?X($):void 0},$);return K.selectors=cFt(K),K}),D=vB(s.option,zq,function($){$.mappingMethod="fixed"});Ye(g)&&gt(g,function($){v[$]=1});function R($){return g==="all"||!!v[$]}function z($){return!!$.length}i.eachSeries(function($,X){var K=w[X]=[];$.subType==="parallel"?N($,X):H($,X,K)});function N($,X){var K=$.coordinateSystem;I=I||K.hasAxisBrushed(),R(X)&&K.eachActiveState($.getData(),function(et,rt){et==="active"&&(y[rt]=1)})}function H($,X,K){if(!(!$.brushSelector||fFt(s,X))&&(gt(E,function(rt){s.brushTargetManager.controlSeries(rt,$,i)&&K.push(rt),I=I||z(K)}),R(X)&&z(K))){var et=$.getData();et.each(function(rt){Bq($,K,et,rt)&&(y[rt]=1)})}}i.eachSeries(function($,X){var K={seriesId:$.id,seriesIndex:X,seriesName:$.name,dataIndex:[]};u.selected.push(K);var et=w[X],rt=$.getData(),lt=R(X)?function(ht){return y[ht]?(K.dataIndex.push(rt.getRawIndex(ht)),"inBrush"):"outOfBrush"}:function(ht){return Bq($,et,rt,ht)?(K.dataIndex.push(rt.getRawIndex(ht)),"inBrush"):"outOfBrush"};(R(X)?I:z(et))&&sFt(zq,D,rt,lt)})}),hFt(t,n,o,r,e)}function hFt(i,t,e,r,n){if(n){var o=i.getZr();if(!o[_B]){o[Mk]||(o[Mk]=dFt);var s=$0(o,Mk,e,t);s(i,r)}}}function dFt(i,t){if(!i.isDisposed()){var e=i.getZr();e[_B]=!0,i.dispatchAction({type:"brushSelect",batch:t}),e[_B]=!1}}function Bq(i,t,e,r){for(var n=0,o=t.length;n<o;n++){var s=t[n];if(i.brushSelector(r,e,s.selectors,s))return!0}}function fFt(i,t){var e=i.option.seriesIndex;return e!=null&&e!=="all"&&(Ye(e)?Ar(e,t)<0:t!==e)}var pFt={rect:function(i){return Fq(i.range)},polygon:function(i){for(var t,e=i.range,r=0,n=e.length;r<n;r++){t=t||[[1/0,-1/0],[1/0,-1/0]];var o=e[r];o[0]<t[0][0]&&(t[0][0]=o[0]),o[0]>t[0][1]&&(t[0][1]=o[0]),o[1]<t[1][0]&&(t[1][0]=o[1]),o[1]>t[1][1]&&(t[1][1]=o[1])}return t&&Fq(t)}};function Fq(i){return new sr(i[0][0],i[1][0],i[0][1]-i[0][0],i[1][1]-i[1][0])}var gFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){this.ecModel=e,this.api=r,this.model,(this._brushController=new rN(r.getZr())).on("brush",wi(this._onBrush,this)).mount()},t.prototype.render=function(e,r,n,o){this.model=e,this._updateController(e,r,n,o)},t.prototype.updateTransform=function(e,r,n,o){Trt(r),this._updateController(e,r,n,o)},t.prototype.updateVisual=function(e,r,n,o){this.updateTransform(e,r,n,o)},t.prototype.updateView=function(e,r,n,o){this._updateController(e,r,n,o)},t.prototype._updateController=function(e,r,n,o){(!o||o.$from!==e.id)&&this._brushController.setPanels(e.brushTargetManager.makePanelOpts(n)).enableBrush(e.brushOption).updateCovers(e.areas.slice())},t.prototype.dispose=function(){this._brushController.dispose()},t.prototype._onBrush=function(e){var r=this.model.id,n=this.model.brushTargetManager.setOutputRanges(e.areas,this.ecModel);(!e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:r,areas:Yi(n),$from:r}),e.isEnd&&this.api.dispatchAction({type:"brushEnd",brushId:r,areas:Yi(n),$from:r})},t.type="brush",t}(Oa);const mFt=gFt;var vFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.areas=[],e.brushOption={},e}return t.prototype.optionUpdated=function(e,r){var n=this.option;!r&&Srt(n,e,["inBrush","outOfBrush"]);var o=n.inBrush=n.inBrush||{};n.outOfBrush=n.outOfBrush||{color:this.option.defaultOutOfBrushColor},o.hasOwnProperty("liftZ")||(o.liftZ=5)},t.prototype.setAreas=function(e){e&&(this.areas=ti(e,function(r){return Nq(this.option,r)},this))},t.prototype.setBrushOption=function(e){this.brushOption=Nq(this.option,e),this.brushType=this.brushOption.brushType},t.type="brush",t.dependencies=["geo","grid","xAxis","yAxis","parallel","series"],t.defaultOption={seriesIndex:"all",brushType:"rect",brushMode:"single",transformable:!0,brushStyle:{borderWidth:1,color:_e.color.backgroundTint,borderColor:_e.color.borderTint},throttleType:"fixRate",throttleDelay:0,removeOnClick:!0,z:1e4,defaultOutOfBrushColor:_e.color.disabled},t}(gn);function Nq(i,t){return Er({brushType:i.brushType,brushMode:i.brushMode,transformable:i.transformable,brushStyle:new bn(i.brushStyle).getItemStyle(),removeOnClick:i.removeOnClick,z:i.z},t,!0)}const _Ft=vFt;var yFt=["rect","polygon","lineX","lineY","keep","clear"],xFt=function(i){we(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.render=function(e,r,n){var o,s,a;r.eachComponent({mainType:"brush"},function(u){o=u.brushType,s=u.brushOption.brushMode||"single",a=a||!!u.areas.length}),this._brushType=o,this._brushMode=s,gt(e.get("type",!0),function(u){e.setIconStatus(u,(u==="keep"?s==="multiple":u==="clear"?a:u===o)?"emphasis":"normal")})},t.prototype.updateView=function(e,r,n){this.render(e,r,n)},t.prototype.getIcons=function(){var e=this.model,r=e.get("icon",!0),n={};return gt(e.get("type",!0),function(o){r[o]&&(n[o]=r[o])}),n},t.prototype.onclick=function(e,r,n){var o=this._brushType,s=this._brushMode;n==="clear"?(r.dispatchAction({type:"axisAreaSelect",intervals:[]}),r.dispatchAction({type:"brush",command:"clear",areas:[]})):r.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:n==="keep"?o:o===n?!1:n,brushMode:n==="keep"?s==="multiple"?"single":"multiple":s}})},t.getDefaultOption=function(e){var r={show:!0,type:yFt.slice(),icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:e.getLocaleModel().get(["toolbox","brush","title"])};return r},t}(Ic);const bFt=xFt;function wFt(i){i.registerComponentView(mFt),i.registerComponentModel(_Ft),i.registerPreprocessor(aFt),i.registerVisual(i.PRIORITY.VISUAL.BRUSH,uFt),i.registerAction({type:"brush",event:"brush",update:"updateVisual"},function(t,e){e.eachComponent({mainType:"brush",query:t},function(r){r.setAreas(t.areas)})}),i.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},uo),i.registerAction({type:"brushEnd",event:"brushEnd",update:"none"},uo),Wy("brush",bFt)}var SFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.layoutMode={type:"box",ignoreSize:!0},e}return t.type="title",t.defaultOption={z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:"center",top:_e.size.m,backgroundColor:_e.color.transparent,borderColor:_e.color.primary,borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:_e.color.primary},subtextStyle:{fontSize:12,color:_e.color.quaternary}},t}(gn),TFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){if(this.group.removeAll(),!!e.get("show")){var o=this.group,s=e.getModel("textStyle"),a=e.getModel("subtextStyle"),u=e.get("textAlign"),f=Ui(e.get("textBaseline"),e.get("textVerticalAlign")),g=new _n({style:fa(s,{text:e.get("text"),fill:s.getTextColor()},{disableBox:!0}),z2:10}),v=g.getBoundingRect(),y=e.get("subtext"),w=new _n({style:fa(a,{text:y,fill:a.getTextColor(),y:v.height+e.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),I=e.get("link"),E=e.get("sublink"),D=e.get("triggerEvent",!0);g.silent=!I&&!D,w.silent=!E&&!D,I&&g.on("click",function(){VM(I,"_"+e.get("target"))}),E&&w.on("click",function(){VM(E,"_"+e.get("subtarget"))}),ur(g).eventData=ur(w).eventData=D?{componentType:"title",componentIndex:e.componentIndex}:null,o.add(g),y&&o.add(w);var R=o.getBoundingRect(),z=e.getBoxLayoutParams();z.width=R.width,z.height=R.height;var N=Bo(e,n),H=Ca(z,N.refContainer,e.get("padding"));u||(u=e.get("left")||e.get("right"),u==="middle"&&(u="center"),u==="right"?H.x+=H.width:u==="center"&&(H.x+=H.width/2)),f||(f=e.get("top")||e.get("bottom"),f==="center"&&(f="middle"),f==="bottom"?H.y+=H.height:f==="middle"&&(H.y+=H.height/2),f=f||"top"),o.x=H.x,o.y=H.y,o.markRedraw();var $={align:u,verticalAlign:f};g.setStyle($),w.setStyle($),R=o.getBoundingRect();var X=H.margin,K=e.getItemStyle(["color","opacity"]);K.fill=e.get("backgroundColor");var et=new jr({shape:{x:R.x-X[3],y:R.y-X[0],width:R.width+X[1]+X[3],height:R.height+X[0]+X[2],r:e.get("borderRadius")},style:K,subPixelOptimize:!0,silent:!0});o.add(et)}},t.type="title",t}(Oa);function AFt(i){i.registerComponentModel(SFt),i.registerComponentView(TFt)}var IFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.layoutMode="box",e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n),this._initData()},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),this._initData()},t.prototype.setCurrentIndex=function(e){e==null&&(e=this.option.currentIndex);var r=this._data.count();this.option.loop?e=(e%r+r)%r:(e>=r&&(e=r-1),e<0&&(e=0)),this.option.currentIndex=e},t.prototype.getCurrentIndex=function(){return this.option.currentIndex},t.prototype.isIndexMax=function(){return this.getCurrentIndex()>=this._data.count()-1},t.prototype.setPlayState=function(e){this.option.autoPlay=!!e},t.prototype.getPlayState=function(){return!!this.option.autoPlay},t.prototype._initData=function(){var e=this.option,r=e.data||[],n=e.axisType,o=this._names=[],s;n==="category"?(s=[],gt(r,function(f,g){var v=Lo(B0(f),""),y;nr(f)?(y=Yi(f),y.value=g):y=g,s.push(y),o.push(v)})):s=r;var a={category:"ordinal",time:"time",value:"number"}[n]||"number",u=this._data=new dl([{name:"value",type:a}],this);u.initData(s,o)},t.prototype.getData=function(){return this._data},t.prototype.getCategories=function(){if(this.get("axisType")==="category")return this._names.slice()},t.type="timeline",t.defaultOption={z:4,show:!0,axisType:"time",realtime:!0,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:_e.size.m,controlPosition:"left",autoPlay:!1,rewind:!1,loop:!0,playInterval:2e3,currentIndex:0,itemStyle:{},label:{color:_e.color.secondary},data:[]},t}(gn);const Vq=IFt;var Art=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="timeline.slider",t.defaultOption=jp(Vq.defaultOption,{backgroundColor:"rgba(0,0,0,0)",borderColor:_e.color.border,borderWidth:0,orient:"horizontal",inverse:!1,tooltip:{trigger:"item"},symbol:"circle",symbolSize:12,lineStyle:{show:!0,width:2,color:_e.color.accent10},label:{position:"auto",show:!0,interval:"auto",rotate:0,color:_e.color.tertiary},itemStyle:{color:_e.color.accent20,borderWidth:0},checkpointStyle:{symbol:"circle",symbolSize:15,color:_e.color.accent50,borderColor:_e.color.accent50,borderWidth:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0)",animation:!0,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:!0,showPlayBtn:!0,showPrevBtn:!0,showNextBtn:!0,itemSize:24,itemGap:12,position:"left",playIcon:"path://M15 0C23.2843 0 30 6.71573 30 15C30 23.2843 23.2843 30 15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0ZM15 3C8.37258 3 3 8.37258 3 15C3 21.6274 8.37258 27 15 27C21.6274 27 27 21.6274 27 15C27 8.37258 21.6274 3 15 3ZM11.5 10.6699C11.5 9.90014 12.3333 9.41887 13 9.80371L20.5 14.1338C21.1667 14.5187 21.1667 15.4813 20.5 15.8662L13 20.1963C12.3333 20.5811 11.5 20.0999 11.5 19.3301V10.6699Z",stopIcon:"path://M15 0C23.2843 0 30 6.71573 30 15C30 23.2843 23.2843 30 15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0ZM15 3C8.37258 3 3 8.37258 3 15C3 21.6274 8.37258 27 15 27C21.6274 27 27 21.6274 27 15C27 8.37258 21.6274 3 15 3ZM11.5 10C12.3284 10 13 10.6716 13 11.5V18.5C13 19.3284 12.3284 20 11.5 20C10.6716 20 10 19.3284 10 18.5V11.5C10 10.6716 10.6716 10 11.5 10ZM18.5 10C19.3284 10 20 10.6716 20 11.5V18.5C20 19.3284 19.3284 20 18.5 20C17.6716 20 17 19.3284 17 18.5V11.5C17 10.6716 17.6716 10 18.5 10Z",nextIcon:"path://M0.838834 18.7383C0.253048 18.1525 0.253048 17.2028 0.838834 16.617L7.55635 9.89949L0.838834 3.18198C0.253048 2.59619 0.253048 1.64645 0.838834 1.06066C1.42462 0.474874 2.37437 0.474874 2.96015 1.06066L10.7383 8.83883L10.8412 8.95277C11.2897 9.50267 11.2897 10.2963 10.8412 10.8462L10.7383 10.9602L2.96015 18.7383C2.37437 19.3241 1.42462 19.3241 0.838834 18.7383Z",prevIcon:"path://M10.9602 1.06066C11.5459 1.64645 11.5459 2.59619 10.9602 3.18198L4.24264 9.89949L10.9602 16.617C11.5459 17.2028 11.5459 18.1525 10.9602 18.7383C10.3744 19.3241 9.42462 19.3241 8.83883 18.7383L1.06066 10.9602L0.957771 10.8462C0.509245 10.2963 0.509245 9.50267 0.957771 8.95277L1.06066 8.83883L8.83883 1.06066C9.42462 0.474874 10.3744 0.474874 10.9602 1.06066Z",prevBtnSize:18,nextBtnSize:18,color:_e.color.accent50,borderColor:_e.color.accent50,borderWidth:0},emphasis:{label:{show:!0,color:_e.color.accent60},itemStyle:{color:_e.color.accent60,borderColor:_e.color.accent60},controlStyle:{color:_e.color.accent70,borderColor:_e.color.accent70}},progress:{lineStyle:{color:_e.color.accent30},itemStyle:{color:_e.color.accent40}},data:[]}),t}(Vq);wo(Art,yE.prototype);const MFt=Art;var CFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="timeline",t}(Oa);const EFt=CFt;var DFt=function(i){we(t,i);function t(e,r,n,o){var s=i.call(this,e,r,n)||this;return s.type=o||"value",s}return t.prototype.getLabelModel=function(){return this.model.getModel("label")},t.prototype.isHorizontal=function(){return this.model.get("orient")==="horizontal"},t}(bu);const PFt=DFt;var Ck=Math.PI,Uq=Wr(),LFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){this.api=r},t.prototype.render=function(e,r,n){if(this.model=e,this.api=n,this.ecModel=r,this.group.removeAll(),e.get("show",!0)){var o=this._layout(e,n),s=this._createGroup("_mainGroup"),a=this._createGroup("_labelGroup"),u=this._axis=this._createAxis(o,e);e.formatTooltip=function(f){var g=u.scale.getLabel({value:f});return xo("nameValue",{noName:!0,value:g})},gt(["AxisLine","AxisTick","Control","CurrentPointer"],function(f){this["_render"+f](o,s,u,e)},this),this._renderAxisLabel(o,a,u,e),this._position(o,e)}this._doPlayStop(),this._updateTicksStatus()},t.prototype.remove=function(){this._clearTimer(),this.group.removeAll()},t.prototype.dispose=function(){this._clearTimer()},t.prototype._layout=function(e,r){var n=e.get(["label","position"]),o=e.get("orient"),s=kFt(e,r),a;n==null||n==="auto"?a=o==="horizontal"?s.y+s.height/2<r.getHeight()/2?"-":"+":s.x+s.width/2<r.getWidth()/2?"+":"-":bi(n)?a={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[o][n]:a=n;var u={horizontal:"center",vertical:a>=0||a==="+"?"left":"right"},f={horizontal:a>=0||a==="+"?"top":"bottom",vertical:"middle"},g={horizontal:0,vertical:Ck/2},v=o==="vertical"?s.height:s.width,y=e.getModel("controlStyle"),w=y.get("show",!0),I=w?y.get("itemSize"):0,E=w?y.get("itemGap"):0,D=I+E,R=e.get(["label","rotate"])||0;R=R*Ck/180;var z,N,H,$=y.get("position",!0),X=w&&y.get("showPlayBtn",!0),K=w&&y.get("showPrevBtn",!0),et=w&&y.get("showNextBtn",!0),rt=0,lt=v;$==="left"||$==="bottom"?(X&&(z=[0,0],rt+=D),K&&(N=[rt,0],rt+=D),et&&(H=[lt-I,0],lt-=D)):(X&&(z=[lt-I,0],lt-=D),K&&(N=[0,0],rt+=D),et&&(H=[lt-I,0],lt-=D));var ht=[rt,lt];return e.get("inverse")&&ht.reverse(),{viewRect:s,mainLength:v,orient:o,rotation:g[o],labelRotation:R,labelPosOpt:a,labelAlign:e.get(["label","align"])||u[o],labelBaseline:e.get(["label","verticalAlign"])||e.get(["label","baseline"])||f[o],playPosition:z,prevBtnPosition:N,nextBtnPosition:H,axisExtent:ht,controlSize:I,controlGap:E}},t.prototype._position=function(e,r){var n=this._mainGroup,o=this._labelGroup,s=e.viewRect;if(e.orient==="vertical"){var a=ns(),u=s.x,f=s.y+s.height;xh(a,a,[-u,-f]),Up(a,a,-Ck/2),xh(a,a,[u,f]),s=s.clone(),s.applyTransform(a)}var g=z(s),v=z(n.getBoundingRect()),y=z(o.getBoundingRect()),w=[n.x,n.y],I=[o.x,o.y];I[0]=w[0]=g[0][0];var E=e.labelPosOpt;if(E==null||bi(E)){var D=E==="+"?0:1;N(w,v,g,1,D),N(I,y,g,1,1-D)}else{var D=E>=0?0:1;N(w,v,g,1,D),I[1]=w[1]+E}n.setPosition(w),o.setPosition(I),n.rotation=o.rotation=e.rotation,R(n),R(o);function R(H){H.originX=g[0][0]-H.x,H.originY=g[1][0]-H.y}function z(H){return[[H.x,H.x+H.width],[H.y,H.y+H.height]]}function N(H,$,X,K,et){H[K]+=X[K][et]-$[K][et]}},t.prototype._createAxis=function(e,r){var n=r.getData(),o=r.get("axisType"),s=RFt(r,o);s.getTicks=function(){return n.mapArray(["value"],function(f){return{value:f}})};var a=n.getDataExtent("value");s.setExtent(a[0],a[1]),s.calcNiceTicks();var u=new PFt("value",s,e.axisExtent,o);return u.model=r,u},t.prototype._createGroup=function(e){var r=this[e]=new Ki;return this.group.add(r),r},t.prototype._renderAxisLine=function(e,r,n,o){var s=n.getExtent();if(o.get(["lineStyle","show"])){var a=new Ro({shape:{x1:s[0],y1:0,x2:s[1],y2:0},style:Fe({lineCap:"round"},o.getModel("lineStyle").getLineStyle()),silent:!0,z2:1});r.add(a);var u=this._progressLine=new Ro({shape:{x1:s[0],x2:this._currentPointer?this._currentPointer.x:s[0],y1:0,y2:0},style:rr({lineCap:"round",lineWidth:a.style.lineWidth},o.getModel(["progress","lineStyle"]).getLineStyle()),silent:!0,z2:1});r.add(u)}},t.prototype._renderAxisTick=function(e,r,n,o){var s=this,a=o.getData(),u=n.scale.getTicks();this._tickSymbols=[],gt(u,function(f){var g=n.dataToCoord(f.value),v=a.getItemModel(f.value),y=v.getModel("itemStyle"),w=v.getModel(["emphasis","itemStyle"]),I=v.getModel(["progress","itemStyle"]),E={x:g,y:0,onclick:wi(s._changeTimeline,s,f.value)},D=Gq(v,y,r,E);D.ensureState("emphasis").style=w.getItemStyle(),D.ensureState("progress").style=I.getItemStyle(),nv(D);var R=ur(D);v.get("tooltip")?(R.dataIndex=f.value,R.dataModel=o):R.dataIndex=R.dataModel=null,s._tickSymbols.push(D)})},t.prototype._renderAxisLabel=function(e,r,n,o){var s=this,a=n.getLabelModel();if(a.get("show")){var u=o.getData(),f=n.getViewLabels();this._tickLabels=[],gt(f,function(g){var v=g.tickValue,y=u.getItemModel(v),w=y.getModel("label"),I=y.getModel(["emphasis","label"]),E=y.getModel(["progress","label"]),D=n.dataToCoord(g.tickValue),R=new _n({x:D,y:0,rotation:e.labelRotation-e.rotation,onclick:wi(s._changeTimeline,s,v),silent:!1,style:fa(w,{text:g.formattedLabel,align:e.labelAlign,verticalAlign:e.labelBaseline})});R.ensureState("emphasis").style=fa(I),R.ensureState("progress").style=fa(E),r.add(R),nv(R),Uq(R).dataIndex=v,s._tickLabels.push(R)})}},t.prototype._renderControl=function(e,r,n,o){var s=e.controlSize,a=e.rotation,u=o.getModel("controlStyle").getItemStyle(),f=o.getModel(["emphasis","controlStyle"]).getItemStyle(),g=o.getPlayState(),v=o.get("inverse",!0);y(e.nextBtnPosition,"next",wi(this._changeTimeline,this,v?"-":"+")),y(e.prevBtnPosition,"prev",wi(this._changeTimeline,this,v?"+":"-")),y(e.playPosition,g?"stop":"play",wi(this._handlePlayClick,this,!g),!0);function y(w,I,E,D){if(w){var R=vu(Ui(o.get(["controlStyle",I+"BtnSize"]),s),s),z=[0,-R/2,R,R],N=OFt(o,I+"Icon",z,{x:w[0],y:w[1],originX:s/2,originY:0,rotation:D?-a:0,rectHover:!0,style:u,onclick:E});N.ensureState("emphasis").style=f,r.add(N),nv(N)}}},t.prototype._renderCurrentPointer=function(e,r,n,o){var s=o.getData(),a=o.getCurrentIndex(),u=s.getItemModel(a).getModel("checkpointStyle"),f=this,g={onCreate:function(v){v.draggable=!0,v.drift=wi(f._handlePointerDrag,f),v.ondragend=wi(f._handlePointerDragend,f),Hq(v,f._progressLine,a,n,o,!0)},onUpdate:function(v){Hq(v,f._progressLine,a,n,o)}};this._currentPointer=Gq(u,u,this._mainGroup,{},this._currentPointer,g)},t.prototype._handlePlayClick=function(e){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:e,from:this.uid})},t.prototype._handlePointerDrag=function(e,r,n){this._clearTimer(),this._pointerChangeTimeline([n.offsetX,n.offsetY])},t.prototype._handlePointerDragend=function(e){this._pointerChangeTimeline([e.offsetX,e.offsetY],!0)},t.prototype._pointerChangeTimeline=function(e,r){var n=this._toAxisCoord(e)[0],o=this._axis,s=Dc(o.getExtent().slice());n>s[1]&&(n=s[1]),n<s[0]&&(n=s[0]),this._currentPointer.x=n,this._currentPointer.markRedraw();var a=this._progressLine;a&&(a.shape.x2=n,a.dirty());var u=this._findNearestTick(n),f=this.model;(r||u!==f.getCurrentIndex()&&f.get("realtime"))&&this._changeTimeline(u)},t.prototype._doPlayStop=function(){var e=this;this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(function(){var r=e.model;e._changeTimeline(r.getCurrentIndex()+(r.get("rewind",!0)?-1:1))},this.model.get("playInterval")))},t.prototype._toAxisCoord=function(e){var r=this._mainGroup.getLocalTransform();return du(e,r,!0)},t.prototype._findNearestTick=function(e){var r=this.model.getData(),n=1/0,o,s=this._axis;return r.each(["value"],function(a,u){var f=s.dataToCoord(a),g=Math.abs(f-e);g<n&&(n=g,o=u)}),o},t.prototype._clearTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._changeTimeline=function(e){var r=this.model.getCurrentIndex();e==="+"?e=r+1:e==="-"&&(e=r-1),this.api.dispatchAction({type:"timelineChange",currentIndex:e,from:this.uid})},t.prototype._updateTicksStatus=function(){var e=this.model.getCurrentIndex(),r=this._tickSymbols,n=this._tickLabels;if(r)for(var o=0;o<r.length;o++)r&&r[o]&&r[o].toggleState("progress",o<e);if(n)for(var o=0;o<n.length;o++)n&&n[o]&&n[o].toggleState("progress",Uq(n[o]).dataIndex<=e)},t.type="timeline.slider",t}(EFt);function RFt(i,t){if(t=t||i.get("type"),t)switch(t){case"category":return new dS({ordinalMeta:i.getCategories(),extent:[1/0,-1/0]});case"time":return new ntt({locale:i.ecModel.getLocaleModel(),useUTC:i.ecModel.get("useUTC")});default:return new Rp}}function kFt(i,t){return Ca(i.getBoxLayoutParams(),Bo(i,t).refContainer,i.get("padding"))}function OFt(i,t,e,r){var n=r.style,o=BS(i.get(["controlStyle",t]),r||{},new sr(e[0],e[1],e[2],e[3]));return n&&o.setStyle(n),o}function Gq(i,t,e,r,n,o){var s=t.get("color");if(n)n.setColor(s),e.add(n),o&&o.onUpdate(n);else{var a=i.get("symbol");n=bo(a,-1,-1,2,2,s),n.setStyle("strokeNoScale",!0),e.add(n),o&&o.onCreate(n)}var u=t.getItemStyle(["color"]);n.setStyle(u),r=Er({rectHover:!0,z2:100},r,!0);var f=Z0(i.get("symbolSize"));r.scaleX=f[0]/2,r.scaleY=f[1]/2;var g=Cv(i.get("symbolOffset"),f);g&&(r.x=(r.x||0)+g[0],r.y=(r.y||0)+g[1]);var v=i.get("symbolRotate");return r.rotation=(v||0)*Math.PI/180||0,n.attr(r),n.updateTransform(),n}function Hq(i,t,e,r,n,o){if(!i.dragging){var s=n.getModel("checkpointStyle"),a=r.dataToCoord(n.getData().get("value",e));if(o||!s.get("animation",!0))i.attr({x:a,y:0}),t&&t.attr({shape:{x2:a}});else{var u={duration:s.get("animationDuration",!0),easing:s.get("animationEasing",!0)};i.stopAnimation(null,!0),i.animateTo({x:a,y:0},u),t&&t.animateTo({shape:{x2:a}},u)}}}const zFt=LFt;function BFt(i){i.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},function(t,e,r){var n=e.getComponent("timeline");return n&&t.currentIndex!=null&&(n.setCurrentIndex(t.currentIndex),!n.get("loop",!0)&&n.isIndexMax()&&n.getPlayState()&&(n.setPlayState(!1),r.dispatchAction({type:"timelinePlayChange",playState:!1,from:t.from}))),e.resetOption("timeline",{replaceMerge:n.get("replaceMerge",!0)}),rr({currentIndex:n.option.currentIndex},t)}),i.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},function(t,e){var r=e.getComponent("timeline");r&&t.playState!=null&&r.setPlayState(t.playState)})}function FFt(i){var t=i&&i.timeline;Ye(t)||(t=t?[t]:[]),gt(t,function(e){e&&NFt(e)})}function NFt(i){var t=i.type,e={number:"value",time:"time"};if(e[t]&&(i.axisType=e[t],delete i.type),jq(i),Fm(i,"controlPosition")){var r=i.controlStyle||(i.controlStyle={});Fm(r,"position")||(r.position=i.controlPosition),r.position==="none"&&!Fm(r,"show")&&(r.show=!1,delete r.position),delete i.controlPosition}gt(i.data||[],function(n){nr(n)&&!Ye(n)&&(!Fm(n,"value")&&Fm(n,"name")&&(n.value=n.name),jq(n))})}function jq(i){var t=i.itemStyle||(i.itemStyle={}),e=t.emphasis||(t.emphasis={}),r=i.label||i.label||{},n=r.normal||(r.normal={}),o={normal:1,emphasis:1};gt(r,function(s,a){!o[a]&&!Fm(n,a)&&(n[a]=s)}),e.label&&!Fm(r,"emphasis")&&(r.emphasis=e.label,delete e.label)}function Fm(i,t){return i.hasOwnProperty(t)}function VFt(i){i.registerComponentModel(MFt),i.registerComponentView(zFt),i.registerSubTypeDefaulter("timeline",function(){return"slider"}),BFt(i),i.registerPreprocessor(FFt)}function DN(i,t){if(!i)return!1;for(var e=Ye(i)?i:[i],r=0;r<e.length;r++)if(e[r]&&e[r][t])return!0;return!1}function hI(i){dv(i,"label",["show"])}var dI=Wr(),Irt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.createdBySelf=!1,e.preventAutoZ=!0,e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n),this._mergeOption(e,n,!1,!0)},t.prototype.isAnimationEnabled=function(){if(Sn.node)return!1;var e=this.__hostSeries;return this.getShallow("animation")&&e&&e.isAnimationEnabled()},t.prototype.mergeOption=function(e,r){this._mergeOption(e,r,!1,!1)},t.prototype._mergeOption=function(e,r,n,o){var s=this.mainType;n||r.eachSeries(function(a){var u=a.get(this.mainType,!0),f=dI(a)[s];if(!u||!u.data){dI(a)[s]=null;return}f?f._mergeOption(u,r,!0):(o&&hI(u),gt(u.data,function(g){g instanceof Array?(hI(g[0]),hI(g[1])):hI(g)}),f=this.createMarkerModelFromSeries(u,this,r),Fe(f,{mainType:this.mainType,seriesIndex:a.seriesIndex,name:a.name,createdBySelf:!0}),f.__hostSeries=a),dI(a)[s]=f},this)},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=this.getRawValue(e),a=o.getName(e);return xo("section",{header:this.name,blocks:[xo("nameValue",{name:a,value:s,noName:!a,noValue:s==null})]})},t.prototype.getData=function(){return this._data},t.prototype.setData=function(e){this._data=e},t.prototype.getDataParams=function(e,r){var n=yE.prototype.getDataParams.call(this,e,r),o=this.__hostSeries;return o&&(n.seriesId=o.id,n.seriesName=o.name,n.seriesType=o.subType),n},t.getMarkerModelFromSeries=function(e,r){return dI(e)[r]},t.type="marker",t.dependencies=["series","grid","polar","geo"],t}(gn);wo(Irt,yE.prototype);const Fd=Irt;var UFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,r,n){return new t(e,r,n)},t.type="markPoint",t.defaultOption={z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:!0,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:!0}}},t}(Fd);const GFt=UFt;function yB(i){return!(isNaN(parseFloat(i.x))&&isNaN(parseFloat(i.y)))}function HFt(i){return!isNaN(parseFloat(i.x))&&!isNaN(parseFloat(i.y))}function fI(i,t,e,r,n,o,s){var a=[],u=Lp(t,n),f=u?t.getCalculationInfo("stackResultDimension"):n,g=xC(t,f,i),v=t.hostModel,y=v.indicesOfNearest(e,f,g)[0];a[o]=t.get(r,y),a[s]=t.get(f,y);var w=t.get(n,y),I=sh(t.get(n,y));return I=Math.min(I,20),I>=0&&(a[s]=+a[s].toFixed(I)),[a,w]}var pI={min:br(fI,"min"),max:br(fI,"max"),average:br(fI,"average"),median:br(fI,"median")};function SS(i,t){if(t){var e=i.getData(),r=i.coordinateSystem,n=r&&r.dimensions;if(!HFt(t)&&!Ye(t.coord)&&Ye(n)){var o=Mrt(t,e,r,i);if(t=Yi(t),t.type&&pI[t.type]&&o.baseAxis&&o.valueAxis){var s=Ar(n,o.baseAxis.dim),a=Ar(n,o.valueAxis.dim),u=pI[t.type](e,o.valueAxis.dim,o.baseDataDim,o.valueDataDim,s,a);t.coord=u[0],t.value=u[1]}else t.coord=[t.xAxis!=null?t.xAxis:t.radiusAxis,t.yAxis!=null?t.yAxis:t.angleAxis]}if(t.coord==null||!Ye(n)){t.coord=[];var f=i.getBaseAxis();if(f&&t.type&&pI[t.type]){var g=r.getOtherAxis(f);g&&(t.value=xC(e,e.mapDimension(g.dim),t.type))}}else for(var v=t.coord,y=0;y<2;y++)pI[v[y]]&&(v[y]=xC(e,e.mapDimension(n[y]),v[y]));return t}}function Mrt(i,t,e,r){var n={};return i.valueIndex!=null||i.valueDim!=null?(n.valueDataDim=i.valueIndex!=null?t.getDimension(i.valueIndex):i.valueDim,n.valueAxis=e.getAxis(jFt(r,n.valueDataDim)),n.baseAxis=e.getOtherAxis(n.valueAxis),n.baseDataDim=t.mapDimension(n.baseAxis.dim)):(n.baseAxis=r.getBaseAxis(),n.valueAxis=e.getOtherAxis(n.baseAxis),n.baseDataDim=t.mapDimension(n.baseAxis.dim),n.valueDataDim=t.mapDimension(n.valueAxis.dim)),n}function jFt(i,t){var e=i.getData().getDimensionInfo(t);return e&&e.coordDim}function TS(i,t){return i&&i.containData&&t.coord&&!yB(t)?i.containData(t.coord):!0}function WFt(i,t,e){return i&&i.containZone&&t.coord&&e.coord&&!yB(t)&&!yB(e)?i.containZone(t.coord,e.coord):!0}function Crt(i,t){return i?function(e,r,n,o){var s=o<2?e.coord&&e.coord[o]:e.value;return Tp(s,t[o])}:function(e,r,n,o){return Tp(e.value,t[o])}}function xC(i,t,e){if(e==="average"){var r=0,n=0;return i.each(t,function(o,s){isNaN(o)||(r+=o,n++)}),r/n}else return e==="median"?i.getMedian(t):i.getDataExtent(t)[e==="max"?1:0]}var Ek=Wr(),$Ft=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this.markerGroupMap=Fi()},t.prototype.render=function(e,r,n){var o=this,s=this.markerGroupMap;s.each(function(a){Ek(a).keep=!1}),r.eachSeries(function(a){var u=Fd.getMarkerModelFromSeries(a,o.type);u&&o.renderSeries(a,u,r,n)}),s.each(function(a){!Ek(a).keep&&o.group.remove(a.group)}),ZFt(r,s,this.type)},t.prototype.markKeep=function(e){Ek(e).keep=!0},t.prototype.toggleBlurSeries=function(e,r){var n=this;gt(e,function(o){var s=Fd.getMarkerModelFromSeries(o,n.type);if(s){var a=s.getData();a.eachItemGraphicEl(function(u){u&&(r?SK(u):BF(u))})}})},t.type="marker",t}(Oa);function ZFt(i,t,e){i.eachSeries(function(r){var n=Fd.getMarkerModelFromSeries(r,e),o=t.get(r.id);if(n&&o&&o.group){var s=vv(n),a=s.z,u=s.zlevel;pE(o.group,a,u)}})}const PN=$Ft;function Wq(i,t,e){var r=t.coordinateSystem,n=e.getWidth(),o=e.getHeight(),s=r&&r.getArea&&r.getArea();i.each(function(a){var u=i.getItemModel(a),f=u.get("relativeTo")==="coordinate",g=f?s?s.width:0:n,v=f?s?s.height:0:o,y=f&&s?s.x:0,w=f&&s?s.y:0,I,E=xi(u.get("x"),g)+y,D=xi(u.get("y"),v)+w;if(!isNaN(E)&&!isNaN(D))I=[E,D];else if(t.getMarkerPosition)I=t.getMarkerPosition(i.getValues(i.dimensions,a));else if(r){var R=i.get(r.dimensions[0],a),z=i.get(r.dimensions[1],a);I=r.dataToPoint([R,z])}isNaN(E)||(I[0]=E),isNaN(D)||(I[1]=D),i.setItemLayout(a,I)})}var qFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,r,n){r.eachSeries(function(o){var s=Fd.getMarkerModelFromSeries(o,"markPoint");s&&(Wq(s.getData(),o,n),this.markerGroupMap.get(o.id).updateLayout())},this)},t.prototype.renderSeries=function(e,r,n,o){var s=e.coordinateSystem,a=e.id,u=e.getData(),f=this.markerGroupMap,g=f.get(a)||f.set(a,new WS),v=XFt(s,e,r);r.setData(v),Wq(r.getData(),e,o),v.each(function(y){var w=v.getItemModel(y),I=w.getShallow("symbol"),E=w.getShallow("symbolSize"),D=w.getShallow("symbolRotate"),R=w.getShallow("symbolOffset"),z=w.getShallow("symbolKeepAspect");if(Xi(I)||Xi(E)||Xi(D)||Xi(R)){var N=r.getRawValue(y),H=r.getDataParams(y);Xi(I)&&(I=I(N,H)),Xi(E)&&(E=E(N,H)),Xi(D)&&(D=D(N,H)),Xi(R)&&(R=R(N,H))}var $=w.getModel("itemStyle").getItemStyle(),X=w.get("z2"),K=US(u,"color");$.fill||($.fill=K),v.setItemVisual(y,{z2:Ui(X,0),symbol:I,symbolSize:E,symbolRotate:D,symbolOffset:R,symbolKeepAspect:z,style:$})}),g.updateData(v),this.group.add(g.group),v.eachItemGraphicEl(function(y){y.traverse(function(w){ur(w).dataModel=r})}),this.markKeep(g),g.group.silent=r.get("silent")||e.get("silent")},t.type="markPoint",t}(PN);function XFt(i,t,e){var r;i?r=ti(i&&i.dimensions,function(a){var u=t.getData().getDimensionInfo(t.getData().mapDimension(a))||{};return Fe(Fe({},u),{name:a,ordinalMeta:null})}):r=[{name:"value",type:"float"}];var n=new dl(r,e),o=ti(e.get("data"),br(SS,t));i&&(o=Rn(o,br(TS,i)));var s=Crt(!!i,r);return n.initData(o,null,s),n}const YFt=qFt;function KFt(i){i.registerComponentModel(GFt),i.registerComponentView(YFt),i.registerPreprocessor(function(t){DN(t.series,"markPoint")&&(t.markPoint=t.markPoint||{})})}var JFt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,r,n){return new t(e,r,n)},t.type="markLine",t.defaultOption={z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},t}(Fd);const QFt=JFt;var gI=Wr(),t3t=function(i,t,e,r){var n=i.getData(),o;if(Ye(r))o=r;else{var s=r.type;if(s==="min"||s==="max"||s==="average"||s==="median"||r.xAxis!=null||r.yAxis!=null){var a=void 0,u=void 0;if(r.yAxis!=null||r.xAxis!=null)a=t.getAxis(r.yAxis!=null?"y":"x"),u=vs(r.yAxis,r.xAxis);else{var f=Mrt(r,n,t,i);a=f.valueAxis;var g=jQ(n,f.valueDataDim);u=xC(n,g,s)}var v=a.dim==="x"?0:1,y=1-v,w=Yi(r),I={coord:[]};w.type=null,w.coord=[],w.coord[y]=-1/0,I.coord[y]=1/0;var E=e.get("precision");E>=0&&fn(u)&&(u=+u.toFixed(Math.min(E,20))),w.coord[v]=I.coord[v]=u,o=[w,I,{type:s,valueIndex:r.valueIndex,value:u}]}else o=[]}var D=[SS(i,o[0]),SS(i,o[1]),Fe({},o[2])];return D[2].type=D[2].type||null,Er(D[2],D[0]),Er(D[2],D[1]),D};function bC(i){return!isNaN(i)&&!isFinite(i)}function $q(i,t,e,r){var n=1-i,o=r.dimensions[i];return bC(t[n])&&bC(e[n])&&t[i]===e[i]&&r.getAxis(o).containData(t[i])}function e3t(i,t){if(i.type==="cartesian2d"){var e=t[0].coord,r=t[1].coord;if(e&&r&&($q(1,e,r,i)||$q(0,e,r,i)))return!0}return TS(i,t[0])&&TS(i,t[1])}function Dk(i,t,e,r,n){var o=r.coordinateSystem,s=i.getItemModel(t),a,u=xi(s.get("x"),n.getWidth()),f=xi(s.get("y"),n.getHeight());if(!isNaN(u)&&!isNaN(f))a=[u,f];else{if(r.getMarkerPosition)a=r.getMarkerPosition(i.getValues(i.dimensions,t));else{var g=o.dimensions,v=i.get(g[0],t),y=i.get(g[1],t);a=o.dataToPoint([v,y])}if(kp(o,"cartesian2d")){var w=o.getAxis("x"),I=o.getAxis("y"),g=o.dimensions;bC(i.get(g[0],t))?a[0]=w.toGlobalCoord(w.getExtent()[e?0:1]):bC(i.get(g[1],t))&&(a[1]=I.toGlobalCoord(I.getExtent()[e?0:1]))}isNaN(u)||(a[0]=u),isNaN(f)||(a[1]=f)}i.setItemLayout(t,a)}var i3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,r,n){r.eachSeries(function(o){var s=Fd.getMarkerModelFromSeries(o,"markLine");if(s){var a=s.getData(),u=gI(s).from,f=gI(s).to;u.each(function(g){Dk(u,g,!0,o,n),Dk(f,g,!1,o,n)}),a.each(function(g){a.setItemLayout(g,[u.getItemLayout(g),f.getItemLayout(g)])}),this.markerGroupMap.get(o.id).updateLayout()}},this)},t.prototype.renderSeries=function(e,r,n,o){var s=e.coordinateSystem,a=e.id,u=e.getData(),f=this.markerGroupMap,g=f.get(a)||f.set(a,new Y3);this.group.add(g.group);var v=r3t(s,e,r),y=v.from,w=v.to,I=v.line;gI(r).from=y,gI(r).to=w,r.setData(I);var E=r.get("symbol"),D=r.get("symbolSize"),R=r.get("symbolRotate"),z=r.get("symbolOffset");Ye(E)||(E=[E,E]),Ye(D)||(D=[D,D]),Ye(R)||(R=[R,R]),Ye(z)||(z=[z,z]),v.from.each(function(H){N(y,H,!0),N(w,H,!1)}),I.each(function(H){var $=I.getItemModel(H),X=$.getModel("lineStyle").getLineStyle();I.setItemLayout(H,[y.getItemLayout(H),w.getItemLayout(H)]);var K=$.get("z2");X.stroke==null&&(X.stroke=y.getItemVisual(H,"style").fill),I.setItemVisual(H,{z2:Ui(K,0),fromSymbolKeepAspect:y.getItemVisual(H,"symbolKeepAspect"),fromSymbolOffset:y.getItemVisual(H,"symbolOffset"),fromSymbolRotate:y.getItemVisual(H,"symbolRotate"),fromSymbolSize:y.getItemVisual(H,"symbolSize"),fromSymbol:y.getItemVisual(H,"symbol"),toSymbolKeepAspect:w.getItemVisual(H,"symbolKeepAspect"),toSymbolOffset:w.getItemVisual(H,"symbolOffset"),toSymbolRotate:w.getItemVisual(H,"symbolRotate"),toSymbolSize:w.getItemVisual(H,"symbolSize"),toSymbol:w.getItemVisual(H,"symbol"),style:X})}),g.updateData(I),v.line.eachItemGraphicEl(function(H){ur(H).dataModel=r,H.traverse(function($){ur($).dataModel=r})});function N(H,$,X){var K=H.getItemModel($);Dk(H,$,X,e,o);var et=K.getModel("itemStyle").getItemStyle();et.fill==null&&(et.fill=US(u,"color")),H.setItemVisual($,{symbolKeepAspect:K.get("symbolKeepAspect"),symbolOffset:Ui(K.get("symbolOffset",!0),z[X?0:1]),symbolRotate:Ui(K.get("symbolRotate",!0),R[X?0:1]),symbolSize:Ui(K.get("symbolSize"),D[X?0:1]),symbol:Ui(K.get("symbol",!0),E[X?0:1]),style:et})}this.markKeep(g),g.group.silent=r.get("silent")||e.get("silent")},t.type="markLine",t}(PN);function r3t(i,t,e){var r;i?r=ti(i&&i.dimensions,function(f){var g=t.getData().getDimensionInfo(t.getData().mapDimension(f))||{};return Fe(Fe({},g),{name:f,ordinalMeta:null})}):r=[{name:"value",type:"float"}];var n=new dl(r,e),o=new dl(r,e),s=new dl([],e),a=ti(e.get("data"),br(t3t,t,i,e));i&&(a=Rn(a,br(e3t,i)));var u=Crt(!!i,r);return n.initData(ti(a,function(f){return f[0]}),null,u),o.initData(ti(a,function(f){return f[1]}),null,u),s.initData(ti(a,function(f){return f[2]})),s.hasItemOption=!0,{from:n,to:o,line:s}}const n3t=i3t;function a3t(i){i.registerComponentModel(QFt),i.registerComponentView(n3t),i.registerPreprocessor(function(t){DN(t.series,"markLine")&&(t.markLine=t.markLine||{})})}var o3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,r,n){return new t(e,r,n)},t.type="markArea",t.defaultOption={z:1,tooltip:{trigger:"item"},animation:!1,label:{show:!0,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:!0,position:"top"}}},t}(Fd);const s3t=o3t;var mI=Wr(),l3t=function(i,t,e,r){var n=r[0],o=r[1];if(!(!n||!o)){var s=SS(i,n),a=SS(i,o),u=s.coord,f=a.coord;u[0]=vs(u[0],-1/0),u[1]=vs(u[1],-1/0),f[0]=vs(f[0],1/0),f[1]=vs(f[1],1/0);var g=vF([{},s,a]);return g.coord=[s.coord,a.coord],g.x0=s.x,g.y0=s.y,g.x1=a.x,g.y1=a.y,g}};function wC(i){return!isNaN(i)&&!isFinite(i)}function Zq(i,t,e,r){var n=1-i;return wC(t[n])&&wC(e[n])}function c3t(i,t){var e=t.coord[0],r=t.coord[1],n={coord:e,x:t.x0,y:t.y0},o={coord:r,x:t.x1,y:t.y1};return kp(i,"cartesian2d")?e&&r&&(Zq(1,e,r)||Zq(0,e,r))?!0:WFt(i,n,o):TS(i,n)||TS(i,o)}function qq(i,t,e,r,n){var o=r.coordinateSystem,s=i.getItemModel(t),a,u=xi(s.get(e[0]),n.getWidth()),f=xi(s.get(e[1]),n.getHeight());if(!isNaN(u)&&!isNaN(f))a=[u,f];else{if(r.getMarkerPosition){var g=i.getValues(["x0","y0"],t),v=i.getValues(["x1","y1"],t),y=o.clampData(g),w=o.clampData(v),I=[];e[0]==="x0"?I[0]=y[0]>w[0]?v[0]:g[0]:I[0]=y[0]>w[0]?g[0]:v[0],e[1]==="y0"?I[1]=y[1]>w[1]?v[1]:g[1]:I[1]=y[1]>w[1]?g[1]:v[1],a=r.getMarkerPosition(I,e,!0)}else{var E=i.get(e[0],t),D=i.get(e[1],t),R=[E,D];o.clampData&&o.clampData(R,R),a=o.dataToPoint(R,!0)}if(kp(o,"cartesian2d")){var z=o.getAxis("x"),N=o.getAxis("y"),E=i.get(e[0],t),D=i.get(e[1],t);wC(E)?a[0]=z.toGlobalCoord(z.getExtent()[e[0]==="x0"?0:1]):wC(D)&&(a[1]=N.toGlobalCoord(N.getExtent()[e[1]==="y0"?0:1]))}isNaN(u)||(a[0]=u),isNaN(f)||(a[1]=f)}return a}var Xq=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]],u3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,r,n){r.eachSeries(function(o){var s=Fd.getMarkerModelFromSeries(o,"markArea");if(s){var a=s.getData();a.each(function(u){var f=ti(Xq,function(v){return qq(a,u,v,o,n)});a.setItemLayout(u,f);var g=a.getItemGraphicEl(u);g.setShape("points",f)})}},this)},t.prototype.renderSeries=function(e,r,n,o){var s=e.coordinateSystem,a=e.id,u=e.getData(),f=this.markerGroupMap,g=f.get(a)||f.set(a,{group:new Ki});this.group.add(g.group),this.markKeep(g);var v=h3t(s,e,r);r.setData(v),v.each(function(y){var w=ti(Xq,function(lt){return qq(v,y,lt,e,o)}),I=s.getAxis("x").scale,E=s.getAxis("y").scale,D=I.getExtent(),R=E.getExtent(),z=[I.parse(v.get("x0",y)),I.parse(v.get("x1",y))],N=[E.parse(v.get("y0",y)),E.parse(v.get("y1",y))];Dc(z),Dc(N);var H=!(D[0]>z[1]||D[1]<z[0]||R[0]>N[1]||R[1]<N[0]),$=!H;v.setItemLayout(y,{points:w,allClipped:$});var X=v.getItemModel(y),K=X.getModel("itemStyle").getItemStyle(),et=X.get("z2"),rt=US(u,"color");K.fill||(K.fill=rt,bi(K.fill)&&(K.fill=IM(K.fill,.4))),K.stroke||(K.stroke=rt),v.setItemVisual(y,"style",K),v.setItemVisual(y,"z2",Ui(et,0))}),v.diff(mI(g).data).add(function(y){var w=v.getItemLayout(y),I=v.getItemVisual(y,"z2");if(!w.allClipped){var E=new gl({z2:Ui(I,0),shape:{points:w.points}});v.setItemGraphicEl(y,E),g.group.add(E)}}).update(function(y,w){var I=mI(g).data.getItemGraphicEl(w),E=v.getItemLayout(y),D=v.getItemVisual(y,"z2");E.allClipped?I&&g.group.remove(I):(I?yn(I,{z2:Ui(D,0),shape:{points:E.points}},r,y):I=new gl({shape:{points:E.points}}),v.setItemGraphicEl(y,I),g.group.add(I))}).remove(function(y){var w=mI(g).data.getItemGraphicEl(y);g.group.remove(w)}).execute(),v.eachItemGraphicEl(function(y,w){var I=v.getItemModel(w),E=v.getItemVisual(w,"style");y.useStyle(v.getItemVisual(w,"style")),qo(y,zo(I),{labelFetcher:r,labelDataIndex:w,defaultText:v.getName(w)||"",inheritColor:bi(E.fill)?IM(E.fill,1):_e.color.neutral99}),Oo(y,I),Ma(y,null,null,I.get(["emphasis","disabled"])),ur(y).dataModel=r}),mI(g).data=v,g.group.silent=r.get("silent")||e.get("silent")},t.type="markArea",t}(PN);function h3t(i,t,e){var r,n,o=["x0","y0","x1","y1"];if(i){var s=ti(i&&i.dimensions,function(f){var g=t.getData(),v=g.getDimensionInfo(g.mapDimension(f))||{};return Fe(Fe({},v),{name:f,ordinalMeta:null})});n=ti(o,function(f,g){return{name:f,type:s[g%2].type}}),r=new dl(n,e)}else n=[{name:"value",type:"float"}],r=new dl(n,e);var a=ti(e.get("data"),br(l3t,t,i,e));i&&(a=Rn(a,br(c3t,i)));var u=i?function(f,g,v,y){var w=f.coord[Math.floor(y/2)][y%2];return Tp(w,n[y])}:function(f,g,v,y){return Tp(f.value,n[y])};return r.initData(a,null,u),r.hasItemOption=!0,r}const d3t=u3t;function f3t(i){i.registerComponentModel(s3t),i.registerComponentView(d3t),i.registerPreprocessor(function(t){DN(t.series,"markArea")&&(t.markArea=t.markArea||{})})}var p3t=function(i,t){if(t==="all")return{type:"all",title:i.getLocaleModel().get(["legend","selector","all"])};if(t==="inverse")return{type:"inverse",title:i.getLocaleModel().get(["legend","selector","inverse"])}},g3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.layoutMode={type:"box",ignoreSize:!0},e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n),e.selected=e.selected||{},this._updateSelector(e)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.call(this,e,r),this._updateSelector(e)},t.prototype._updateSelector=function(e){var r=e.selector,n=this.ecModel;r===!0&&(r=e.selector=["all","inverse"]),Ye(r)&&gt(r,function(o,s){bi(o)&&(o={type:o}),r[s]=Er(o,p3t(n,o.type))})},t.prototype.optionUpdated=function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&this.get("selectedMode")==="single"){for(var r=!1,n=0;n<e.length;n++){var o=e[n].get("name");if(this.isSelected(o)){this.select(o),r=!0;break}}!r&&this.select(e[0].get("name"))}},t.prototype._updateData=function(e){var r=[],n=[];e.eachRawSeries(function(u){var f=u.name;n.push(f);var g;if(u.legendVisualProvider){var v=u.legendVisualProvider,y=v.getAllNames();e.isSeriesFiltered(u)||(n=n.concat(y)),y.length?r=r.concat(y):g=!0}else g=!0;g&&CF(u)&&r.push(u.name)}),this._availableNames=n;var o=this.get("data")||r,s=Fi(),a=ti(o,function(u){return(bi(u)||fn(u))&&(u={name:u}),s.get(u.name)?null:(s.set(u.name,!0),new bn(u,this,this.ecModel))},this);this._data=Rn(a,function(u){return!!u})},t.prototype.getData=function(){return this._data},t.prototype.select=function(e){var r=this.option.selected,n=this.get("selectedMode");if(n==="single"){var o=this._data;gt(o,function(s){r[s.get("name")]=!1})}r[e]=!0},t.prototype.unSelect=function(e){this.get("selectedMode")!=="single"&&(this.option.selected[e]=!1)},t.prototype.toggleSelected=function(e){var r=this.option.selected;r.hasOwnProperty(e)||(r[e]=!0),this[r[e]?"unSelect":"select"](e)},t.prototype.allSelect=function(){var e=this._data,r=this.option.selected;gt(e,function(n){r[n.get("name",!0)]=!0})},t.prototype.inverseSelect=function(){var e=this._data,r=this.option.selected;gt(e,function(n){var o=n.get("name",!0);r.hasOwnProperty(o)||(r[o]=!0),r[o]=!r[o]})},t.prototype.isSelected=function(e){var r=this.option.selected;return!(r.hasOwnProperty(e)&&!r[e])&&Ar(this._availableNames,e)>=0},t.prototype.getOrient=function(){return this.get("orient")==="vertical"?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},t.type="legend.plain",t.dependencies=["series"],t.defaultOption={z:4,show:!0,orient:"horizontal",left:"center",bottom:_e.size.m,align:"auto",backgroundColor:_e.color.transparent,borderColor:_e.color.border,borderRadius:0,borderWidth:0,padding:5,itemGap:8,itemWidth:25,itemHeight:14,symbolRotate:"inherit",symbolKeepAspect:!0,inactiveColor:_e.color.disabled,inactiveBorderColor:_e.color.disabled,inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:_e.color.disabled,inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit"},textStyle:{color:_e.color.secondary},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:"sans-serif",color:_e.color.tertiary,borderWidth:1,borderColor:_e.color.border},emphasis:{selectorLabel:{show:!0,color:_e.color.quaternary}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1},triggerEvent:!1},t}(gn);const xB=g3t;var ky=br,bB=gt,vI=Ki,m3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.newlineDisabled=!1,e}return t.prototype.init=function(){this.group.add(this._contentGroup=new vI),this.group.add(this._selectorGroup=new vI),this._isFirstRender=!0},t.prototype.getContentGroup=function(){return this._contentGroup},t.prototype.getSelectorGroup=function(){return this._selectorGroup},t.prototype.render=function(e,r,n){var o=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),!!e.get("show",!0)){var s=e.get("align"),a=e.get("orient");(!s||s==="auto")&&(s=e.get("left")==="right"&&a==="vertical"?"right":"left");var u=e.get("selector",!0),f=e.get("selectorPosition",!0);u&&(!f||f==="auto")&&(f=a==="horizontal"?"end":"start"),this.renderInner(s,e,r,n,u,a,f);var g=Bo(e,n).refContainer,v=e.getBoxLayoutParams(),y=e.get("padding"),w=Ca(v,g,y),I=this.layoutInner(e,s,w,o,u,f),E=Ca(rr({width:I.width,height:I.height},v),g,y);this.group.x=E.x-I.x,this.group.y=E.y-I.y,this.group.markRedraw(),this.group.add(this._backgroundEl=mrt(I,e))}},t.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},t.prototype.renderInner=function(e,r,n,o,s,a,u){var f=this.getContentGroup(),g=Fi(),v=r.get("selectedMode"),y=r.get("triggerEvent"),w=[];n.eachRawSeries(function(I){!I.get("legendHoverLink")&&w.push(I.id)}),bB(r.getData(),function(I,E){var D=this,R=I.get("name");if(!this.newlineDisabled&&(R===""||R===`
`)){var z=new vI;z.newline=!0,f.add(z);return}var N=n.getSeriesByName(R)[0];if(!g.get(R))if(N){var H=N.getData(),$=H.getVisual("legendLineStyle")||{},X=H.getVisual("legendIcon"),K=H.getVisual("style"),et=this._createItem(N,R,E,I,r,e,$,K,X,v,o);et.on("click",ky(Yq,R,null,o,w)).on("mouseover",ky(wB,N.name,null,o,w)).on("mouseout",ky(SB,N.name,null,o,w)),n.ssr&&et.eachChild(function(rt){var lt=ur(rt);lt.seriesIndex=N.seriesIndex,lt.dataIndex=E,lt.ssrType="legend"}),y&&et.eachChild(function(rt){D.packEventData(rt,r,N,E,R)}),g.set(R,!0)}else n.eachRawSeries(function(rt){var lt=this;if(!g.get(R)&&rt.legendVisualProvider){var ht=rt.legendVisualProvider;if(!ht.containName(R))return;var yt=ht.indexOfName(R),ft=ht.getItemVisual(yt,"style"),kt=ht.getItemVisual(yt,"legendIcon"),Rt=Ol(ft.fill);Rt&&Rt[3]===0&&(Rt[3]=.2,ft=Fe(Fe({},ft),{fill:ph(Rt,"rgba")}));var Ct=this._createItem(rt,R,E,I,r,e,{},ft,kt,v,o);Ct.on("click",ky(Yq,null,R,o,w)).on("mouseover",ky(wB,null,R,o,w)).on("mouseout",ky(SB,null,R,o,w)),n.ssr&&Ct.eachChild(function(Gt){var Vt=ur(Gt);Vt.seriesIndex=rt.seriesIndex,Vt.dataIndex=E,Vt.ssrType="legend"}),y&&Ct.eachChild(function(Gt){lt.packEventData(Gt,r,rt,E,R)}),g.set(R,!0)}},this)},this),s&&this._createSelector(s,r,o,a,u)},t.prototype.packEventData=function(e,r,n,o,s){var a={componentType:"legend",componentIndex:r.componentIndex,dataIndex:o,value:s,seriesIndex:n.seriesIndex};ur(e).eventData=a},t.prototype._createSelector=function(e,r,n,o,s){var a=this.getSelectorGroup();bB(e,function(f){var g=f.type,v=new _n({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){n.dispatchAction({type:g==="all"?"legendAllSelect":"legendInverseSelect",legendId:r.id})}});a.add(v);var y=r.getModel("selectorLabel"),w=r.getModel(["emphasis","selectorLabel"]);qo(v,{normal:y,emphasis:w},{defaultText:f.title}),nv(v)})},t.prototype._createItem=function(e,r,n,o,s,a,u,f,g,v,y){var w=e.visualDrawType,I=s.get("itemWidth"),E=s.get("itemHeight"),D=s.isSelected(r),R=o.get("symbolRotate"),z=o.get("symbolKeepAspect"),N=o.get("icon");g=N||g||"roundRect";var H=v3t(g,o,u,f,w,D,y),$=new vI,X=o.getModel("textStyle");if(Xi(e.getLegendIcon)&&(!N||N==="inherit"))$.add(e.getLegendIcon({itemWidth:I,itemHeight:E,icon:g,iconRotate:R,itemStyle:H.itemStyle,lineStyle:H.lineStyle,symbolKeepAspect:z}));else{var K=N==="inherit"&&e.getData().getVisual("symbol")?R==="inherit"?e.getData().getVisual("symbolRotate"):R:0;$.add(_3t({itemWidth:I,itemHeight:E,icon:g,iconRotate:K,itemStyle:H.itemStyle,lineStyle:H.lineStyle,symbolKeepAspect:z}))}var et=a==="left"?I+5:-5,rt=a,lt=s.get("formatter"),ht=r;bi(lt)&&lt?ht=lt.replace("{name}",r??""):Xi(lt)&&(ht=lt(r));var yt=D?X.getTextColor():o.get("inactiveColor");$.add(new _n({style:fa(X,{text:ht,x:et,y:E/2,fill:yt,align:rt,verticalAlign:"middle"},{inheritColor:yt})}));var ft=new jr({shape:$.getBoundingRect(),style:{fill:"transparent"}}),kt=o.getModel("tooltip");return kt.get("show")&&Gd({el:ft,componentModel:s,itemName:r,itemTooltipOption:kt.option}),$.add(ft),$.eachChild(function(Rt){Rt.silent=!0}),ft.silent=!v,this.getContentGroup().add($),nv($),$.__legendDataIndex=n,$},t.prototype.layoutInner=function(e,r,n,o,s,a){var u=this.getContentGroup(),f=this.getSelectorGroup();ov(e.get("orient"),u,e.get("itemGap"),n.width,n.height);var g=u.getBoundingRect(),v=[-g.x,-g.y];if(f.markRedraw(),u.markRedraw(),s){ov("horizontal",f,e.get("selectorItemGap",!0));var y=f.getBoundingRect(),w=[-y.x,-y.y],I=e.get("selectorButtonGap",!0),E=e.getOrient().index,D=E===0?"width":"height",R=E===0?"height":"width",z=E===0?"y":"x";a==="end"?w[E]+=g[D]+I:v[E]+=y[D]+I,w[1-E]+=g[R]/2-y[R]/2,f.x=w[0],f.y=w[1],u.x=v[0],u.y=v[1];var N={x:0,y:0};return N[D]=g[D]+I+y[D],N[R]=Math.max(g[R],y[R]),N[z]=Math.min(0,y[z]+w[1-E]),N}else return u.x=v[0],u.y=v[1],this.group.getBoundingRect()},t.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},t.type="legend.plain",t}(Oa);function v3t(i,t,e,r,n,o,s){function a(D,R){D.lineWidth==="auto"&&(D.lineWidth=R.lineWidth>0?2:0),bB(D,function(z,N){D[N]==="inherit"&&(D[N]=R[N])})}var u=t.getModel("itemStyle"),f=u.getItemStyle(),g=i.lastIndexOf("empty",0)===0?"fill":"stroke",v=u.getShallow("decal");f.decal=!v||v==="inherit"?r.decal:S0(v,s),f.fill==="inherit"&&(f.fill=r[n]),f.stroke==="inherit"&&(f.stroke=r[g]),f.opacity==="inherit"&&(f.opacity=(n==="fill"?r:e).opacity),a(f,r);var y=t.getModel("lineStyle"),w=y.getLineStyle();if(a(w,e),f.fill==="auto"&&(f.fill=r.fill),f.stroke==="auto"&&(f.stroke=r.fill),w.stroke==="auto"&&(w.stroke=r.fill),!o){var I=t.get("inactiveBorderWidth"),E=f[g];f.lineWidth=I==="auto"?r.lineWidth>0&&E?2:0:f.lineWidth,f.fill=t.get("inactiveColor"),f.stroke=t.get("inactiveBorderColor"),w.stroke=y.get("inactiveColor"),w.lineWidth=y.get("inactiveWidth")}return{itemStyle:f,lineStyle:w}}function _3t(i){var t=i.icon||"roundRect",e=bo(t,0,0,i.itemWidth,i.itemHeight,i.itemStyle.fill,i.symbolKeepAspect);return e.setStyle(i.itemStyle),e.rotation=(i.iconRotate||0)*Math.PI/180,e.setOrigin([i.itemWidth/2,i.itemHeight/2]),t.indexOf("empty")>-1&&(e.style.stroke=e.style.fill,e.style.fill=_e.color.neutral00,e.style.lineWidth=2),e}function Yq(i,t,e,r){SB(i,t,e,r),e.dispatchAction({type:"legendToggleSelect",name:i??t}),wB(i,t,e,r)}function Ert(i){for(var t=i.getZr().storage.getDisplayList(),e,r=0,n=t.length;r<n&&!(e=t[r].states.emphasis);)r++;return e&&e.hoverLayer}function wB(i,t,e,r){Ert(e)||e.dispatchAction({type:"highlight",seriesName:i,name:t,excludeSeriesId:r})}function SB(i,t,e,r){Ert(e)||e.dispatchAction({type:"downplay",seriesName:i,name:t,excludeSeriesId:r})}const Drt=m3t;function y3t(i){var t=i.findComponents({mainType:"legend"});t&&t.length&&i.filterSeries(function(e){for(var r=0;r<t.length;r++)if(!t[r].isSelected(e.name))return!1;return!0})}function Vb(i,t,e){var r=i==="allSelect"||i==="inverseSelect",n={},o=[];e.eachComponent({mainType:"legend",query:t},function(a){r?a[i]():a[i](t.name),Kq(a,n),o.push(a.componentIndex)});var s={};return e.eachComponent("legend",function(a){gt(n,function(u,f){a[u?"select":"unSelect"](f)}),Kq(a,s)}),r?{selected:s,legendIndex:o}:{name:t.name,selected:s}}function Kq(i,t){var e=t||{};return gt(i.getData(),function(r){var n=r.get("name");if(!(n===`
`||n==="")){var o=i.isSelected(n);Di(e,n)?e[n]=e[n]&&o:e[n]=o}}),e}function x3t(i){i.registerAction("legendToggleSelect","legendselectchanged",br(Vb,"toggleSelected")),i.registerAction("legendAllSelect","legendselectall",br(Vb,"allSelect")),i.registerAction("legendInverseSelect","legendinverseselect",br(Vb,"inverseSelect")),i.registerAction("legendSelect","legendselected",br(Vb,"select")),i.registerAction("legendUnSelect","legendunselected",br(Vb,"unSelect"))}function Prt(i){i.registerComponentModel(xB),i.registerComponentView(Drt),i.registerProcessor(i.PRIORITY.PROCESSOR.SERIES_FILTER,y3t),i.registerSubTypeDefaulter("legend",function(){return"plain"}),x3t(i)}var b3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.setScrollDataIndex=function(e){this.option.scrollDataIndex=e},t.prototype.init=function(e,r,n){var o=Iv(e);i.prototype.init.call(this,e,r,n),Jq(this,e,o)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.call(this,e,r),Jq(this,this.option,e)},t.type="legend.scroll",t.defaultOption=jp(xB.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:_e.color.accent50,pageIconInactiveColor:_e.color.accent10,pageIconSize:15,pageTextStyle:{color:_e.color.tertiary},animationDurationUpdate:800}),t}(xB);function Jq(i,t,e){var r=i.getOrient(),n=[1,1];n[r.index]=0,Sh(t,e,{type:"box",ignoreSize:!!n})}const w3t=b3t;var Qq=Ki,Pk=["width","height"],Lk=["x","y"],S3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.newlineDisabled=!0,e._currentIndex=0,e}return t.prototype.init=function(){i.prototype.init.call(this),this.group.add(this._containerGroup=new Qq),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new Qq)},t.prototype.resetInner=function(){i.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},t.prototype.renderInner=function(e,r,n,o,s,a,u){var f=this;i.prototype.renderInner.call(this,e,r,n,o,s,a,u);var g=this._controllerGroup,v=r.get("pageIconSize",!0),y=Ye(v)?v:[v,v];I("pagePrev",0);var w=r.getModel("pageTextStyle");g.add(new _n({name:"pageText",style:{text:"xx/xx",fill:w.getTextColor(),font:w.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),I("pageNext",1);function I(E,D){var R=E+"DataIndex",z=BS(r.get("pageIcons",!0)[r.getOrient().name][D],{onclick:wi(f._pageGo,f,R,r,o)},{x:-y[0]/2,y:-y[1]/2,width:y[0],height:y[1]});z.name=E,g.add(z)}},t.prototype.layoutInner=function(e,r,n,o,s,a){var u=this.getSelectorGroup(),f=e.getOrient().index,g=Pk[f],v=Lk[f],y=Pk[1-f],w=Lk[1-f];s&&ov("horizontal",u,e.get("selectorItemGap",!0));var I=e.get("selectorButtonGap",!0),E=u.getBoundingRect(),D=[-E.x,-E.y],R=Yi(n);s&&(R[g]=n[g]-E[g]-I);var z=this._layoutContentAndController(e,o,R,f,g,y,w,v);if(s){if(a==="end")D[f]+=z[g]+I;else{var N=E[g]+I;D[f]-=N,z[v]-=N}z[g]+=E[g]+I,D[1-f]+=z[w]+z[y]/2-E[y]/2,z[y]=Math.max(z[y],E[y]),z[w]=Math.min(z[w],E[w]+D[1-f]),u.x=D[0],u.y=D[1],u.markRedraw()}return z},t.prototype._layoutContentAndController=function(e,r,n,o,s,a,u,f){var g=this.getContentGroup(),v=this._containerGroup,y=this._controllerGroup;ov(e.get("orient"),g,e.get("itemGap"),o?n.width:null,o?null:n.height),ov("horizontal",y,e.get("pageButtonItemGap",!0));var w=g.getBoundingRect(),I=y.getBoundingRect(),E=this._showController=w[s]>n[s],D=[-w.x,-w.y];r||(D[o]=g[f]);var R=[0,0],z=[-I.x,-I.y],N=Ui(e.get("pageButtonGap",!0),e.get("itemGap",!0));if(E){var H=e.get("pageButtonPosition",!0);H==="end"?z[o]+=n[s]-I[s]:R[o]+=I[s]+N}z[1-o]+=w[a]/2-I[a]/2,g.setPosition(D),v.setPosition(R),y.setPosition(z);var $={x:0,y:0};if($[s]=E?n[s]:w[s],$[a]=Math.max(w[a],I[a]),$[u]=Math.min(0,I[u]+z[1-o]),v.__rectSize=n[s],E){var X={x:0,y:0};X[s]=Math.max(n[s]-I[s]-N,0),X[a]=$[a],v.setClipPath(new jr({shape:X})),v.__rectSize=X[s]}else y.eachChild(function(et){et.attr({invisible:!0,silent:!0})});var K=this._getPageInfo(e);return K.pageIndex!=null&&yn(g,{x:K.contentPosition[0],y:K.contentPosition[1]},E?e:null),this._updatePageInfoView(e,K),$},t.prototype._pageGo=function(e,r,n){var o=this._getPageInfo(r)[e];o!=null&&n.dispatchAction({type:"legendScroll",scrollDataIndex:o,legendId:r.id})},t.prototype._updatePageInfoView=function(e,r){var n=this._controllerGroup;gt(["pagePrev","pageNext"],function(g){var v=g+"DataIndex",y=r[v]!=null,w=n.childOfName(g);w&&(w.setStyle("fill",y?e.get("pageIconColor",!0):e.get("pageIconInactiveColor",!0)),w.cursor=y?"pointer":"default")});var o=n.childOfName("pageText"),s=e.get("pageFormatter"),a=r.pageIndex,u=a!=null?a+1:0,f=r.pageCount;o&&s&&o.setStyle("text",bi(s)?s.replace("{current}",u==null?"":u+"").replace("{total}",f==null?"":f+""):s({current:u,total:f}))},t.prototype._getPageInfo=function(e){var r=e.get("scrollDataIndex",!0),n=this.getContentGroup(),o=this._containerGroup.__rectSize,s=e.getOrient().index,a=Pk[s],u=Lk[s],f=this._findTargetItemIndex(r),g=n.children(),v=g[f],y=g.length,w=y?1:0,I={contentPosition:[n.x,n.y],pageCount:w,pageIndex:w-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!v)return I;var E=H(v);I.contentPosition[s]=-E.s;for(var D=f+1,R=E,z=E,N=null;D<=y;++D)N=H(g[D]),(!N&&z.e>R.s+o||N&&!$(N,R.s))&&(z.i>R.i?R=z:R=N,R&&(I.pageNextDataIndex==null&&(I.pageNextDataIndex=R.i),++I.pageCount)),z=N;for(var D=f-1,R=E,z=E,N=null;D>=-1;--D)N=H(g[D]),(!N||!$(z,N.s))&&R.i<z.i&&(z=R,I.pagePrevDataIndex==null&&(I.pagePrevDataIndex=R.i),++I.pageCount,++I.pageIndex),R=N;return I;function H(X){if(X){var K=X.getBoundingRect(),et=K[u]+X[u];return{s:et,e:et+K[a],i:X.__legendDataIndex}}}function $(X,K){return X.e>=K&&X.s<=K+o}},t.prototype._findTargetItemIndex=function(e){if(!this._showController)return 0;var r,n=this.getContentGroup(),o;return n.eachChild(function(s,a){var u=s.__legendDataIndex;o==null&&u!=null&&(o=a),u===e&&(r=a)}),r??o},t.type="legend.scroll",t}(Drt);const T3t=S3t;function A3t(i){i.registerAction("legendScroll","legendscroll",function(t,e){var r=t.scrollDataIndex;r!=null&&e.eachComponent({mainType:"legend",subType:"scroll",query:t},function(n){n.setScrollDataIndex(r)})})}function I3t(i){Rr(Prt),i.registerComponentModel(w3t),i.registerComponentView(T3t),A3t(i)}function M3t(i){Rr(Prt),Rr(I3t)}var C3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.inside",t.defaultOption=jp(wS.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),t}(wS);const E3t=C3t;var LN=Wr();function D3t(i,t,e){LN(i).coordSysRecordMap.each(function(r){var n=r.dataZoomInfoMap.get(t.uid);n&&(n.getRange=e)})}function P3t(i,t){for(var e=LN(i).coordSysRecordMap,r=e.keys(),n=0;n<r.length;n++){var o=r[n],s=e.get(o),a=s.dataZoomInfoMap;if(a){var u=t.uid,f=a.get(u);f&&(a.removeKey(u),a.keys().length||Lrt(e,s))}}}function Lrt(i,t){if(t){i.removeKey(t.model.uid);var e=t.controller;e&&e.dispose()}}function L3t(i,t){var e={model:t,containsPoint:br(k3t,t),dispatchAction:br(R3t,i),dataZoomInfoMap:null,controller:null},r=e.controller=new Lv(i.getZr());return gt(["pan","zoom","scrollMove"],function(n){r.on(n,function(o){var s=[];e.dataZoomInfoMap.each(function(a){if(o.isAvailableBehavior(a.model.option)){var u=(a.getRange||{})[n],f=u&&u(a.dzReferCoordSysInfo,e.model.mainType,e.controller,o);!a.model.get("disabled",!0)&&f&&s.push({dataZoomId:a.model.id,start:f[0],end:f[1]})}}),s.length&&e.dispatchAction(s)})}),e}function R3t(i,t){i.isDisposed()||i.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:t})}function k3t(i,t,e,r){return i.coordinateSystem.containPoint([e,r])}function O3t(i,t,e){var r,n="type_",o={type_true:2,type_move:1,type_false:0,type_undefined:-1},s=!0;return i.each(function(a){var u=a.model,f=u.get("disabled",!0)?!1:u.get("zoomLock",!0)?"move":!0;o[n+f]>o[n+r]&&(r=f),s=s&&u.get("preventDefaultMouseMove",!0)}),{controlType:r,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!s,api:e,zInfo:{component:t.model},triggerInfo:{roamTrigger:null,isInSelf:t.containsPoint}}}}function z3t(i){i.registerProcessor(i.PRIORITY.PROCESSOR.FILTER,function(t,e){var r=LN(e),n=r.coordSysRecordMap||(r.coordSysRecordMap=Fi());n.each(function(o){o.dataZoomInfoMap=null}),t.eachComponent({mainType:"dataZoom",subType:"inside"},function(o){var s=frt(o);gt(s.infoList,function(a){var u=a.model.uid,f=n.get(u)||n.set(u,L3t(e,a.model)),g=f.dataZoomInfoMap||(f.dataZoomInfoMap=Fi());g.set(o.uid,{dzReferCoordSysInfo:a,model:o,getRange:null})})}),n.each(function(o){var s=o.controller,a,u=o.dataZoomInfoMap;if(u){var f=u.keys()[0];f!=null&&(a=u.get(f))}if(!a){Lrt(n,o);return}var g=O3t(u,o,e);s.enable(g.controlType,g.opt),$0(o,"dispatchAction",a.model.get("throttle",!0),"fixRate")})})}var B3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="dataZoom.inside",e}return t.prototype.render=function(e,r,n){if(i.prototype.render.apply(this,arguments),e.noTarget()){this._clear();return}this.range=e.getPercentRange(),D3t(n,e,{pan:wi(Rk.pan,this),zoom:wi(Rk.zoom,this),scrollMove:wi(Rk.scrollMove,this)})},t.prototype.dispose=function(){this._clear(),i.prototype.dispose.apply(this,arguments)},t.prototype._clear=function(){P3t(this.api,this.dataZoomModel),this.range=null},t.type="dataZoom.inside",t}(TN),Rk={zoom:function(i,t,e,r){var n=this.range,o=n.slice(),s=i.axisModels[0];if(s){var a=kk[t](null,[r.originX,r.originY],s,e,i),u=(a.signal>0?a.pixelStart+a.pixelLength-a.pixel:a.pixel-a.pixelStart)/a.pixelLength*(o[1]-o[0])+o[0],f=Math.max(1/r.scale,0);o[0]=(o[0]-u)*f+u,o[1]=(o[1]-u)*f+u;var g=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();if(Op(0,o,[0,100],0,g.minSpan,g.maxSpan),this.range=o,n[0]!==o[0]||n[1]!==o[1])return o}},pan:t7(function(i,t,e,r,n,o){var s=kk[r]([o.oldX,o.oldY],[o.newX,o.newY],t,n,e);return s.signal*(i[1]-i[0])*s.pixel/s.pixelLength}),scrollMove:t7(function(i,t,e,r,n,o){var s=kk[r]([0,0],[o.scrollDelta,o.scrollDelta],t,n,e);return s.signal*(i[1]-i[0])*o.scrollDelta})};function t7(i){return function(t,e,r,n){var o=this.range,s=o.slice(),a=t.axisModels[0];if(a){var u=i(s,a,t,e,r,n);if(Op(u,s,[0,100],"all"),this.range=s,o[0]!==s[0]||o[1]!==s[1])return s}}}var kk={grid:function(i,t,e,r,n){var o=e.axis,s={},a=n.model.coordinateSystem.getRect();return i=i||[0,0],o.dim==="x"?(s.pixel=t[0]-i[0],s.pixelLength=a.width,s.pixelStart=a.x,s.signal=o.inverse?1:-1):(s.pixel=t[1]-i[1],s.pixelLength=a.height,s.pixelStart=a.y,s.signal=o.inverse?-1:1),s},polar:function(i,t,e,r,n){var o=e.axis,s={},a=n.model.coordinateSystem,u=a.getRadiusAxis().getExtent(),f=a.getAngleAxis().getExtent();return i=i?a.pointToCoord(i):[0,0],t=a.pointToCoord(t),e.mainType==="radiusAxis"?(s.pixel=t[0]-i[0],s.pixelLength=u[1]-u[0],s.pixelStart=u[0],s.signal=o.inverse?1:-1):(s.pixel=t[1]-i[1],s.pixelLength=f[1]-f[0],s.pixelStart=f[0],s.signal=o.inverse?-1:1),s},singleAxis:function(i,t,e,r,n){var o=e.axis,s=n.model.coordinateSystem.getRect(),a={};return i=i||[0,0],o.orient==="horizontal"?(a.pixel=t[0]-i[0],a.pixelLength=s.width,a.pixelStart=s.x,a.signal=o.inverse?1:-1):(a.pixel=t[1]-i[1],a.pixelLength=s.height,a.pixelStart=s.y,a.signal=o.inverse?-1:1),a}};const F3t=B3t;function Rrt(i){AN(i),i.registerComponentModel(E3t),i.registerComponentView(F3t),z3t(i)}var N3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.slider",t.layoutMode="box",t.defaultOption=jp(wS.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:_e.color.accent10,borderRadius:0,backgroundColor:_e.color.transparent,dataBackground:{lineStyle:{color:_e.color.accent30,width:.5},areaStyle:{color:_e.color.accent20,opacity:.2}},selectedDataBackground:{lineStyle:{color:_e.color.accent40,width:.5},areaStyle:{color:_e.color.accent20,opacity:.3}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:_e.color.neutral00,borderColor:_e.color.accent20},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:_e.color.accent40,opacity:.5},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:_e.color.tertiary},brushSelect:!0,brushStyle:{color:_e.color.accent30,opacity:.3},emphasis:{handleLabel:{show:!0},handleStyle:{borderColor:_e.color.accent40},moveHandleStyle:{opacity:.8}},defaultLocationEdgeGap:15}),t}(wS);const V3t=N3t;var Ub=jr,U3t=1,Ok=30,G3t=7,Gb="horizontal",e7="vertical",H3t=5,j3t=["line","bar","candlestick","scatter"],W3t={easing:"cubicOut",duration:100,delay:0},$3t=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._displayables={},e}return t.prototype.init=function(e,r){this.api=r,this._onBrush=wi(this._onBrush,this),this._onBrushEnd=wi(this._onBrushEnd,this)},t.prototype.render=function(e,r,n,o){if(i.prototype.render.apply(this,arguments),$0(this,"_dispatchZoomAction",e.get("throttle"),"fixRate"),this._orient=e.getOrient(),e.get("show")===!1){this.group.removeAll();return}if(e.noTarget()){this._clear(),this.group.removeAll();return}(!o||o.type!=="dataZoom"||o.from!==this.uid)&&this._buildView(),this._updateView()},t.prototype.dispose=function(){this._clear(),i.prototype.dispose.apply(this,arguments)},t.prototype._clear=function(){sS(this,"_dispatchZoomAction");var e=this.api.getZr();e.off("mousemove",this._onBrush),e.off("mouseup",this._onBrushEnd)},t.prototype._buildView=function(){var e=this.group;e.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var r=this._displayables.sliderGroup=new Ki;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),e.add(r),this._positionGroup()},t.prototype._resetLocation=function(){var e=this.dataZoomModel,r=this.api,n=e.get("brushSelect"),o=n?G3t:0,s=Bo(e,r).refContainer,a=this._findCoordRect(),u=e.get("defaultLocationEdgeGap",!0)||0,f=this._orient===Gb?{right:s.width-a.x-a.width,top:s.height-Ok-u-o,width:a.width,height:Ok}:{right:u,top:a.y,width:Ok,height:a.height},g=Iv(e.option);gt(["right","top","width","height"],function(y){g[y]==="ph"&&(g[y]=f[y])});var v=Ca(g,s);this._location={x:v.x,y:v.y},this._size=[v.width,v.height],this._orient===e7&&this._size.reverse()},t.prototype._positionGroup=function(){var e=this.group,r=this._location,n=this._orient,o=this.dataZoomModel.getFirstTargetAxisModel(),s=o&&o.get("inverse"),a=this._displayables.sliderGroup,u=(this._dataShadowInfo||{}).otherAxisInverse;a.attr(n===Gb&&!s?{scaleY:u?1:-1,scaleX:1}:n===Gb&&s?{scaleY:u?1:-1,scaleX:-1}:n===e7&&!s?{scaleY:u?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:u?-1:1,scaleX:-1,rotation:Math.PI/2});var f=e.getBoundingRect([a]);e.x=r.x-f.x,e.y=r.y-f.y,e.markRedraw()},t.prototype._getViewExtent=function(){return[0,this._size[0]]},t.prototype._renderBackground=function(){var e=this.dataZoomModel,r=this._size,n=this._displayables.sliderGroup,o=e.get("brushSelect");n.add(new Ub({silent:!0,shape:{x:0,y:0,width:r[0],height:r[1]},style:{fill:e.get("backgroundColor")},z2:-40}));var s=new Ub({shape:{x:0,y:0,width:r[0],height:r[1]},style:{fill:"transparent"},z2:0,onclick:wi(this._onClickPanel,this)}),a=this.api.getZr();o?(s.on("mousedown",this._onBrushStart,this),s.cursor="crosshair",a.on("mousemove",this._onBrush),a.on("mouseup",this._onBrushEnd)):(a.off("mousemove",this._onBrush),a.off("mouseup",this._onBrushEnd)),n.add(s)},t.prototype._renderDataShadow=function(){var e=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],!e)return;var r=this._size,n=this._shadowSize||[],o=e.series,s=o.getRawData(),a=o.getShadowDim&&o.getShadowDim(),u=a&&s.getDimensionInfo(a)?o.getShadowDim():e.otherDim;if(u==null)return;var f=this._shadowPolygonPts,g=this._shadowPolylinePts;if(s!==this._shadowData||u!==this._shadowDim||r[0]!==n[0]||r[1]!==n[1]){var v=s.getDataExtent(e.thisDim),y=s.getDataExtent(u),w=(y[1]-y[0])*.3;y=[y[0]-w,y[1]+w];var I=[0,r[1]],E=[0,r[0]],D=[[r[0],0],[0,0]],R=[],z=E[1]/Math.max(1,s.count()-1),N=r[0]/(v[1]-v[0]),H=e.thisAxis.type==="time",$=-z,X=Math.round(s.count()/r[0]),K;s.each([e.thisDim,u],function(yt,ft,kt){if(X>0&&kt%X){H||($+=z);return}$=H?(+yt-v[0])*N:$+z;var Rt=ft==null||isNaN(ft)||ft==="",Ct=Rt?0:Ln(ft,y,I,!0);Rt&&!K&&kt?(D.push([D[D.length-1][0],0]),R.push([R[R.length-1][0],0])):!Rt&&K&&(D.push([$,0]),R.push([$,0])),Rt||(D.push([$,Ct]),R.push([$,Ct])),K=Rt}),f=this._shadowPolygonPts=D,g=this._shadowPolylinePts=R}this._shadowData=s,this._shadowDim=u,this._shadowSize=[r[0],r[1]];var et=this.dataZoomModel;function rt(yt){var ft=et.getModel(yt?"selectedDataBackground":"dataBackground"),kt=new Ki,Rt=new gl({shape:{points:f},segmentIgnoreThreshold:1,style:ft.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),Ct=new Us({shape:{points:g},segmentIgnoreThreshold:1,style:ft.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19});return kt.add(Rt),kt.add(Ct),kt}for(var lt=0;lt<3;lt++){var ht=rt(lt===1);this._displayables.sliderGroup.add(ht),this._displayables.dataShadowSegs.push(ht)}},t.prototype._prepareDataShadowInfo=function(){var e=this.dataZoomModel,r=e.get("showDataShadow");if(r!==!1){var n,o=this.ecModel;return e.eachTargetAxis(function(s,a){var u=e.getAxisProxy(s,a).getTargetSeriesModels();gt(u,function(f){if(!n&&!(r!==!0&&Ar(j3t,f.get("type"))<0)){var g=o.getComponent(mp(s),a).axis,v=Z3t(s),y,w=f.coordinateSystem;v!=null&&w.getOtherAxis&&(y=w.getOtherAxis(g).inverse),v=f.getData().mapDimension(v);var I=f.getData().mapDimension(s);n={thisAxis:g,series:f,thisDim:I,otherDim:v,otherAxisInverse:y}}},this)},this),n}},t.prototype._renderHandle=function(){var e=this.group,r=this._displayables,n=r.handles=[null,null],o=r.handleLabels=[null,null],s=this._displayables.sliderGroup,a=this._size,u=this.dataZoomModel,f=this.api,g=u.get("borderRadius")||0,v=u.get("brushSelect"),y=r.filler=new Ub({silent:v,style:{fill:u.get("fillerColor")},textConfig:{position:"inside"}});s.add(y),s.add(new Ub({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:a[0],height:a[1],r:g},style:{stroke:u.get("dataBackgroundColor")||u.get("borderColor"),lineWidth:U3t,fill:_e.color.transparent}})),gt([0,1],function(N){var H=u.get("handleIcon");!HM[H]&&H.indexOf("path://")<0&&H.indexOf("image://")<0&&(H="path://"+H);var $=bo(H,-1,0,2,2,null,!0);$.attr({cursor:q3t(this._orient),draggable:!0,drift:wi(this._onDragMove,this,N),ondragend:wi(this._onDragEnd,this),onmouseover:wi(this._showDataInfo,this,!0),onmouseout:wi(this._showDataInfo,this,!1),z2:5});var X=$.getBoundingRect(),K=u.get("handleSize");this._handleHeight=xi(K,this._size[1]),this._handleWidth=X.width/X.height*this._handleHeight,$.setStyle(u.getModel("handleStyle").getItemStyle()),$.style.strokeNoScale=!0,$.rectHover=!0,$.ensureState("emphasis").style=u.getModel(["emphasis","handleStyle"]).getItemStyle(),nv($);var et=u.get("handleColor");et!=null&&($.style.fill=et),s.add(n[N]=$);var rt=u.getModel("textStyle"),lt=u.get("handleLabel")||{},ht=lt.show||!1;e.add(o[N]=new _n({silent:!0,invisible:!ht,style:fa(rt,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:rt.getTextColor(),font:rt.getFont()}),z2:10}))},this);var w=y;if(v){var I=xi(u.get("moveHandleSize"),a[1]),E=r.moveHandle=new jr({style:u.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:a[1]-.5,height:I}}),D=I*.8,R=r.moveHandleIcon=bo(u.get("moveHandleIcon"),-D/2,-D/2,D,D,_e.color.neutral00,!0);R.silent=!0,R.y=a[1]+I/2-.5,E.ensureState("emphasis").style=u.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var z=Math.min(a[1]/2,Math.max(I,10));w=r.moveZone=new jr({invisible:!0,shape:{y:a[1]-z,height:I+z}}),w.on("mouseover",function(){f.enterEmphasis(E)}).on("mouseout",function(){f.leaveEmphasis(E)}),s.add(E),s.add(R),s.add(w)}w.attr({draggable:!0,cursor:"default",drift:wi(this._onDragMove,this,"all"),ondragstart:wi(this._showDataInfo,this,!0),ondragend:wi(this._onDragEnd,this),onmouseover:wi(this._showDataInfo,this,!0),onmouseout:wi(this._showDataInfo,this,!1)})},t.prototype._resetInterval=function(){var e=this._range=this.dataZoomModel.getPercentRange(),r=this._getViewExtent();this._handleEnds=[Ln(e[0],[0,100],r,!0),Ln(e[1],[0,100],r,!0)]},t.prototype._updateInterval=function(e,r){var n=this.dataZoomModel,o=this._handleEnds,s=this._getViewExtent(),a=n.findRepresentativeAxisProxy().getMinMaxSpan(),u=[0,100];Op(r,o,s,n.get("zoomLock")?"all":e,a.minSpan!=null?Ln(a.minSpan,u,s,!0):null,a.maxSpan!=null?Ln(a.maxSpan,u,s,!0):null);var f=this._range,g=this._range=Dc([Ln(o[0],s,u,!0),Ln(o[1],s,u,!0)]);return!f||f[0]!==g[0]||f[1]!==g[1]},t.prototype._updateView=function(e){var r=this._displayables,n=this._handleEnds,o=Dc(n.slice()),s=this._size;gt([0,1],function(w){var I=r.handles[w],E=this._handleHeight;I.attr({scaleX:E/2,scaleY:E/2,x:n[w]+(w?-1:1),y:s[1]/2-E/2})},this),r.filler.setShape({x:o[0],y:0,width:o[1]-o[0],height:s[1]});var a={x:o[0],width:o[1]-o[0]};r.moveHandle&&(r.moveHandle.setShape(a),r.moveZone.setShape(a),r.moveZone.getBoundingRect(),r.moveHandleIcon&&r.moveHandleIcon.attr("x",a.x+a.width/2));for(var u=r.dataShadowSegs,f=[0,o[0],o[1],s[0]],g=0;g<u.length;g++){var v=u[g],y=v.getClipPath();y||(y=new jr,v.setClipPath(y)),y.setShape({x:f[g],y:0,width:f[g+1]-f[g],height:s[1]})}this._updateDataInfo(e)},t.prototype._updateDataInfo=function(e){var r=this.dataZoomModel,n=this._displayables,o=n.handleLabels,s=this._orient,a=["",""];if(r.get("showDetail")){var u=r.findRepresentativeAxisProxy();if(u){var f=u.getAxisModel().axis,g=this._range,v=e?u.calculateDataWindow({start:g[0],end:g[1]}).valueWindow:u.getDataValueWindow();a=[this._formatLabel(v[0],f),this._formatLabel(v[1],f)]}}var y=Dc(this._handleEnds.slice());w.call(this,0),w.call(this,1);function w(I){var E=av(n.handles[I].parent,this.group),D=fE(I===0?"right":"left",E),R=this._handleWidth/2+H3t,z=du([y[I]+(I===0?-R:R),this._size[1]/2],E);o[I].setStyle({x:z[0],y:z[1],verticalAlign:s===Gb?"middle":D,align:s===Gb?D:"center",text:a[I]})}},t.prototype._formatLabel=function(e,r){var n=this.dataZoomModel,o=n.get("labelFormatter"),s=n.get("labelPrecision");(s==null||s==="auto")&&(s=r.getPixelPrecision());var a=e==null||isNaN(e)?"":r.type==="category"||r.type==="time"?r.scale.getLabel({value:Math.round(e)}):e.toFixed(Math.min(s,20));return Xi(o)?o(e,a):bi(o)?o.replace("{value}",a):a},t.prototype._showDataInfo=function(e){var r=this.dataZoomModel.get("handleLabel")||{},n=r.show||!1,o=this.dataZoomModel.getModel(["emphasis","handleLabel"]),s=o.get("show")||!1,a=e||this._dragging?s:n,u=this._displayables,f=u.handleLabels;f[0].attr("invisible",!a),f[1].attr("invisible",!a),u.moveHandle&&this.api[a?"enterEmphasis":"leaveEmphasis"](u.moveHandle,1)},t.prototype._onDragMove=function(e,r,n,o){this._dragging=!0,Pd(o.event);var s=this._displayables.sliderGroup.getLocalTransform(),a=du([r,n],s,!0),u=this._updateInterval(e,a[0]),f=this.dataZoomModel.get("realtime");this._updateView(!f),u&&f&&this._dispatchZoomAction(!0)},t.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1);var e=this.dataZoomModel.get("realtime");!e&&this._dispatchZoomAction(!1)},t.prototype._onClickPanel=function(e){var r=this._size,n=this._displayables.sliderGroup.transformCoordToLocal(e.offsetX,e.offsetY);if(!(n[0]<0||n[0]>r[0]||n[1]<0||n[1]>r[1])){var o=this._handleEnds,s=(o[0]+o[1])/2,a=this._updateInterval("all",n[0]-s);this._updateView(),a&&this._dispatchZoomAction(!1)}},t.prototype._onBrushStart=function(e){var r=e.offsetX,n=e.offsetY;this._brushStart=new er(r,n),this._brushing=!0,this._brushStartTime=+new Date},t.prototype._onBrushEnd=function(e){if(this._brushing){var r=this._displayables.brushRect;if(this._brushing=!1,!!r){r.attr("ignore",!0);var n=r.shape,o=+new Date;if(!(o-this._brushStartTime<200&&Math.abs(n.width)<5)){var s=this._getViewExtent(),a=[0,100],u=this._handleEnds=[n.x,n.x+n.width],f=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();Op(0,u,s,0,f.minSpan!=null?Ln(f.minSpan,a,s,!0):null,f.maxSpan!=null?Ln(f.maxSpan,a,s,!0):null),this._range=Dc([Ln(u[0],s,a,!0),Ln(u[1],s,a,!0)]),this._updateView(),this._dispatchZoomAction(!1)}}}},t.prototype._onBrush=function(e){this._brushing&&(Pd(e.event),this._updateBrushRect(e.offsetX,e.offsetY))},t.prototype._updateBrushRect=function(e,r){var n=this._displayables,o=this.dataZoomModel,s=n.brushRect;s||(s=n.brushRect=new Ub({silent:!0,style:o.getModel("brushStyle").getItemStyle()}),n.sliderGroup.add(s)),s.attr("ignore",!1);var a=this._brushStart,u=this._displayables.sliderGroup,f=u.transformCoordToLocal(e,r),g=u.transformCoordToLocal(a.x,a.y),v=this._size;f[0]=Math.max(Math.min(v[0],f[0]),0),s.setShape({x:g[0],y:0,width:f[0]-g[0],height:v[1]})},t.prototype._dispatchZoomAction=function(e){var r=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:e?W3t:null,start:r[0],end:r[1]})},t.prototype._findCoordRect=function(){var e,r=frt(this.dataZoomModel).infoList;if(!e&&r.length){var n=r[0].model.coordinateSystem;e=n.getRect&&n.getRect()}if(!e){var o=this.api.getWidth(),s=this.api.getHeight();e={x:o*.2,y:s*.2,width:o*.6,height:s*.6}}return e},t.type="dataZoom.slider",t}(TN);function Z3t(i){var t={x:"y",y:"x",radius:"angle",angle:"radius"};return t[i]}function q3t(i){return i==="vertical"?"ns-resize":"ew-resize"}const X3t=$3t;function krt(i){i.registerComponentModel(V3t),i.registerComponentView(X3t),AN(i)}function Y3t(i){Rr(Rrt),Rr(krt)}var K3t={get:function(i,t,e){var r=Yi((J3t[i]||{})[t]);return e&&Ye(r)?r[r.length-1]:r}},J3t={color:{active:["#006edd","#e0ffff"],inactive:[_e.color.transparent]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}};const Ort=K3t;var i7=_s.mapVisual,Q3t=_s.eachVisual,tNt=Ye,r7=gt,eNt=Dc,iNt=Ln,rNt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.stateList=["inRange","outOfRange"],e.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],e.layoutMode={type:"box",ignoreSize:!0},e.dataBound=[-1/0,1/0],e.targetVisuals={},e.controllerVisuals={},e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n)},t.prototype.optionUpdated=function(e,r){var n=this.option;!r&&Srt(n,e,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},t.prototype.resetVisual=function(e){var r=this.stateList;e=wi(e,this),this.controllerVisuals=vB(this.option.controller,r,e),this.targetVisuals=vB(this.option.target,r,e)},t.prototype.getItemSymbol=function(){return null},t.prototype.getTargetSeriesIndices=function(){var e=this.option.seriesId,r=this.option.seriesIndex;r==null&&e==null&&(r="all");var n=F0(this.ecModel,"series",{index:r,id:e},{useDefault:!1,enableAll:!0,enableNone:!1}).models;return ti(n,function(o){return o.componentIndex})},t.prototype.eachTargetSeries=function(e,r){gt(this.getTargetSeriesIndices(),function(n){var o=this.ecModel.getSeriesByIndex(n);o&&e.call(r,o)},this)},t.prototype.isTargetSeries=function(e){var r=!1;return this.eachTargetSeries(function(n){n===e&&(r=!0)}),r},t.prototype.formatValueText=function(e,r,n){var o=this.option,s=o.precision,a=this.dataBound,u=o.formatter,f;n=n||["<",">"],Ye(e)&&(e=e.slice(),f=!0);var g=r?e:f?[v(e[0]),v(e[1])]:v(e);if(bi(u))return u.replace("{value}",f?g[0]:g).replace("{value2}",f?g[1]:g);if(Xi(u))return f?u(e[0],e[1]):u(e);if(f)return e[0]===a[0]?n[0]+" "+g[1]:e[1]===a[1]?n[1]+" "+g[0]:g[0]+" - "+g[1];return g;function v(y){return y===a[0]?"min":y===a[1]?"max":(+y).toFixed(Math.min(s,20))}},t.prototype.resetExtent=function(){var e=this.option,r=eNt([e.min,e.max]);this._dataExtent=r},t.prototype.getDataDimensionIndex=function(e){var r=this.option.dimension;if(r!=null)return e.getDimensionIndex(r);for(var n=e.dimensions,o=n.length-1;o>=0;o--){var s=n[o],a=e.getDimensionInfo(s);if(!a.isCalculationCoord)return a.storeDimIndex}},t.prototype.getExtent=function(){return this._dataExtent.slice()},t.prototype.completeVisualOption=function(){var e=this.ecModel,r=this.option,n={inRange:r.inRange,outOfRange:r.outOfRange},o=r.target||(r.target={}),s=r.controller||(r.controller={});Er(o,n),Er(s,n);var a=this.isCategory();u.call(this,o),u.call(this,s),f.call(this,o,"inRange","outOfRange"),g.call(this,s);function u(v){tNt(r.color)&&!v.inRange&&(v.inRange={color:r.color.slice().reverse()}),v.inRange=v.inRange||{color:e.get("gradientColor")}}function f(v,y,w){var I=v[y],E=v[w];I&&!E&&(E=v[w]={},r7(I,function(D,R){if(_s.isValidType(R)){var z=Ort.get(R,"inactive",a);z!=null&&(E[R]=z,R==="color"&&!E.hasOwnProperty("opacity")&&!E.hasOwnProperty("colorAlpha")&&(E.opacity=[0,0]))}}))}function g(v){var y=(v.inRange||{}).symbol||(v.outOfRange||{}).symbol,w=(v.inRange||{}).symbolSize||(v.outOfRange||{}).symbolSize,I=this.get("inactiveColor"),E=this.getItemSymbol(),D=E||"roundRect";r7(this.stateList,function(R){var z=this.itemSize,N=v[R];N||(N=v[R]={color:a?I:[I]}),N.symbol==null&&(N.symbol=y&&Yi(y)||(a?D:[D])),N.symbolSize==null&&(N.symbolSize=w&&Yi(w)||(a?z[0]:[z[0],z[0]])),N.symbol=i7(N.symbol,function(X){return X==="none"?D:X});var H=N.symbolSize;if(H!=null){var $=-1/0;Q3t(H,function(X){X>$&&($=X)}),N.symbolSize=i7(H,function(X){return iNt(X,[0,$],[0,z[0]],!0)})}},this)}},t.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},t.prototype.isCategory=function(){return!!this.option.categories},t.prototype.setSelected=function(e){},t.prototype.getSelected=function(){return null},t.prototype.getValueState=function(e){return null},t.prototype.getVisualMeta=function(e){return null},t.type="visualMap",t.dependencies=["series"],t.defaultOption={show:!0,z:4,min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:_e.color.transparent,borderColor:_e.color.borderTint,contentColor:_e.color.theme[0],inactiveColor:_e.color.disabled,borderWidth:0,padding:_e.size.m,textGap:10,precision:0,textStyle:{color:_e.color.secondary}},t}(gn);const SC=rNt;var n7=[20,140],nNt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(e,r){i.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual(function(n){n.mappingMethod="linear",n.dataExtent=this.getExtent()}),this._resetRange()},t.prototype.resetItemSize=function(){i.prototype.resetItemSize.apply(this,arguments);var e=this.itemSize;(e[0]==null||isNaN(e[0]))&&(e[0]=n7[0]),(e[1]==null||isNaN(e[1]))&&(e[1]=n7[1])},t.prototype._resetRange=function(){var e=this.getExtent(),r=this.option.range;!r||r.auto?(e.auto=1,this.option.range=e):Ye(r)&&(r[0]>r[1]&&r.reverse(),r[0]=Math.max(r[0],e[0]),r[1]=Math.min(r[1],e[1]))},t.prototype.completeVisualOption=function(){i.prototype.completeVisualOption.apply(this,arguments),gt(this.stateList,function(e){var r=this.option.controller[e].symbolSize;r&&r[0]!==r[1]&&(r[0]=r[1]/3)},this)},t.prototype.setSelected=function(e){this.option.range=e.slice(),this._resetRange()},t.prototype.getSelected=function(){var e=this.getExtent(),r=Dc((this.get("range")||[]).slice());return r[0]>e[1]&&(r[0]=e[1]),r[1]>e[1]&&(r[1]=e[1]),r[0]<e[0]&&(r[0]=e[0]),r[1]<e[0]&&(r[1]=e[0]),r},t.prototype.getValueState=function(e){var r=this.option.range,n=this.getExtent(),o=Ui(this.option.unboundedRange,!0);return(o&&r[0]<=n[0]||r[0]<=e)&&(o&&r[1]>=n[1]||e<=r[1])?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var r=[];return this.eachTargetSeries(function(n){var o=[],s=n.getData();s.each(this.getDataDimensionIndex(s),function(a,u){e[0]<=a&&a<=e[1]&&o.push(u)},this),r.push({seriesId:n.id,dataIndex:o})},this),r},t.prototype.getVisualMeta=function(e){var r=a7(this,"outOfRange",this.getExtent()),n=a7(this,"inRange",this.option.range.slice()),o=[];function s(w,I){o.push({value:w,color:e(w,I)})}for(var a=0,u=0,f=n.length,g=r.length;u<g&&(!n.length||r[u]<=n[0]);u++)r[u]<n[a]&&s(r[u],"outOfRange");for(var v=1;a<f;a++,v=0)v&&o.length&&s(n[a],"outOfRange"),s(n[a],"inRange");for(var v=1;u<g;u++)(!n.length||n[n.length-1]<r[u])&&(v&&(o.length&&s(o[o.length-1].value,"outOfRange"),v=0),s(r[u],"outOfRange"));var y=o.length;return{stops:o,outerColors:[y?o[0].color:"transparent",y?o[y-1].color:"transparent"]}},t.type="visualMap.continuous",t.defaultOption=jp(SC.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:_e.color.neutral00,borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:_e.color.neutral00,borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:_e.color.shadow}}),t}(SC);function a7(i,t,e){if(e[0]===e[1])return e.slice();for(var r=200,n=(e[1]-e[0])/r,o=e[0],s=[],a=0;a<=r&&o<e[1];a++)s.push(o),o+=n;return s.push(e[1]),s}const aNt=nNt;var oNt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.autoPositionValues={left:1,right:1,top:1,bottom:1},e}return t.prototype.init=function(e,r){this.ecModel=e,this.api=r},t.prototype.render=function(e,r,n,o){if(this.visualMapModel=e,e.get("show")===!1){this.group.removeAll();return}this.doRender(e,r,n,o)},t.prototype.renderBackground=function(e){var r=this.visualMapModel,n=FS(r.get("padding")||0),o=e.getBoundingRect();e.add(new jr({z2:-1,silent:!0,shape:{x:o.x-n[3],y:o.y-n[0],width:o.width+n[3]+n[1],height:o.height+n[0]+n[2]},style:{fill:r.get("backgroundColor"),stroke:r.get("borderColor"),lineWidth:r.get("borderWidth")}}))},t.prototype.getControllerVisual=function(e,r,n){n=n||{};var o=n.forceState,s=this.visualMapModel,a={};if(r==="color"){var u=s.get("contentColor");a.color=u}function f(w){return a[w]}function g(w,I){a[w]=I}var v=s.controllerVisuals[o||s.getValueState(e)],y=_s.prepareVisualTypes(v);return gt(y,function(w){var I=v[w];n.convertOpacityToAlpha&&w==="opacity"&&(w="colorAlpha",I=v.__alphaForOpacity),_s.dependsOn(w,r)&&I&&I.applyVisual(e,f,g)}),a[r]},t.prototype.positionGroup=function(e){var r=this.visualMapModel,n=this.api,o=Bo(r,n).refContainer;vE(e,r.getBoxLayoutParams(),o)},t.prototype.doRender=function(e,r,n,o){},t.type="visualMap",t}(Oa);const zrt=oNt;var o7=[["left","right","width"],["top","bottom","height"]];function Brt(i,t,e){var r=i.option,n=r.align;if(n!=null&&n!=="auto")return n;for(var o={width:t.getWidth(),height:t.getHeight()},s=r.orient==="horizontal"?1:0,a=o7[s],u=[0,null,10],f={},g=0;g<3;g++)f[o7[1-s][g]]=u[g],f[a[g]]=g===2?e[0]:r[a[g]];var v=[["x","width",3],["y","height",0]][s],y=Ca(f,o,r.padding);return a[(y.margin[v[2]]||0)+y[v[0]]+y[v[1]]*.5<o[v[1]]*.5?0:1]}function rM(i,t){return gt(i||[],function(e){e.dataIndex!=null&&(e.dataIndexInside=e.dataIndex,e.dataIndex=null),e.highlightKey="visualMap"+(t?t.componentIndex:"")}),i}var Ju=Ln,sNt=gt,s7=Math.min,zk=Math.max,lNt=12,cNt=6,uNt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._shapes={},e._dataInterval=[],e._handleEnds=[],e._hoverLinkDataIndices=[],e}return t.prototype.init=function(e,r){i.prototype.init.call(this,e,r),this._hoverLinkFromSeriesMouseOver=wi(this._hoverLinkFromSeriesMouseOver,this),this._hideIndicator=wi(this._hideIndicator,this)},t.prototype.doRender=function(e,r,n,o){(!o||o.type!=="selectDataRange"||o.from!==this.uid)&&this._buildView()},t.prototype._buildView=function(){this.group.removeAll();var e=this.visualMapModel,r=this.group;this._orient=e.get("orient"),this._useHandle=e.get("calculable"),this._resetInterval(),this._renderBar(r);var n=e.get("text");this._renderEndsText(r,n,0),this._renderEndsText(r,n,1),this._updateView(!0),this.renderBackground(r),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(r)},t.prototype._renderEndsText=function(e,r,n){if(r){var o=r[1-n];o=o!=null?o+"":"";var s=this.visualMapModel,a=s.get("textGap"),u=s.itemSize,f=this._shapes.mainGroup,g=this._applyTransform([u[0]/2,n===0?-a:u[1]+a],f),v=this._applyTransform(n===0?"bottom":"top",f),y=this._orient,w=this.visualMapModel.textStyleModel;this.group.add(new _n({style:fa(w,{x:g[0],y:g[1],verticalAlign:w.get("verticalAlign")||(y==="horizontal"?"middle":v),align:w.get("align")||(y==="horizontal"?v:"center"),text:o})}))}},t.prototype._renderBar=function(e){var r=this.visualMapModel,n=this._shapes,o=r.itemSize,s=this._orient,a=this._useHandle,u=Brt(r,this.api,o),f=n.mainGroup=this._createBarGroup(u),g=new Ki;f.add(g),g.add(n.outOfRange=l7()),g.add(n.inRange=l7(null,a?u7(this._orient):null,wi(this._dragHandle,this,"all",!1),wi(this._dragHandle,this,"all",!0))),g.setClipPath(new jr({shape:{x:0,y:0,width:o[0],height:o[1],r:3}}));var v=r.textStyleModel.getTextRect(""),y=zk(v.width,v.height);a&&(n.handleThumbs=[],n.handleLabels=[],n.handleLabelPoints=[],this._createHandle(r,f,0,o,y,s),this._createHandle(r,f,1,o,y,s)),this._createIndicator(r,f,o,y,s),e.add(f)},t.prototype._createHandle=function(e,r,n,o,s,a){var u=wi(this._dragHandle,this,n,!1),f=wi(this._dragHandle,this,n,!0),g=vu(e.get("handleSize"),o[0]),v=bo(e.get("handleIcon"),-g/2,-g/2,g,g,null,!0),y=u7(this._orient);v.attr({cursor:y,draggable:!0,drift:u,ondragend:f,onmousemove:function(R){Pd(R.event)}}),v.x=o[0]/2,v.useStyle(e.getModel("handleStyle").getItemStyle()),v.setStyle({strokeNoScale:!0,strokeFirst:!0}),v.style.lineWidth*=2,v.ensureState("emphasis").style=e.getModel(["emphasis","handleStyle"]).getItemStyle(),Hm(v,!0),r.add(v);var w=this.visualMapModel.textStyleModel,I=new _n({cursor:y,draggable:!0,drift:u,onmousemove:function(R){Pd(R.event)},ondragend:f,style:fa(w,{x:0,y:0,text:""})});I.ensureState("blur").style={opacity:.1},I.stateTransition={duration:200},this.group.add(I);var E=[g,0],D=this._shapes;D.handleThumbs[n]=v,D.handleLabelPoints[n]=E,D.handleLabels[n]=I},t.prototype._createIndicator=function(e,r,n,o,s){var a=vu(e.get("indicatorSize"),n[0]),u=bo(e.get("indicatorIcon"),-a/2,-a/2,a,a,null,!0);u.attr({cursor:"move",invisible:!0,silent:!0,x:n[0]/2});var f=e.getModel("indicatorStyle").getItemStyle();if(u instanceof ys){var g=u.style;u.useStyle(Fe({image:g.image,x:g.x,y:g.y,width:g.width,height:g.height},f))}else u.useStyle(f);r.add(u);var v=this.visualMapModel.textStyleModel,y=new _n({silent:!0,invisible:!0,style:fa(v,{x:0,y:0,text:""})});this.group.add(y);var w=[(s==="horizontal"?o/2:cNt)+n[0]/2,0],I=this._shapes;I.indicator=u,I.indicatorLabel=y,I.indicatorLabelPoint=w,this._firstShowIndicator=!0},t.prototype._dragHandle=function(e,r,n,o){if(this._useHandle){if(this._dragging=!r,!r){var s=this._applyTransform([n,o],this._shapes.mainGroup,!0);this._updateInterval(e,s[1]),this._hideIndicator(),this._updateView()}r===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),r?!this._hovering&&this._clearHoverLinkToSeries():c7(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[e],!1)}},t.prototype._resetInterval=function(){var e=this.visualMapModel,r=this._dataInterval=e.getSelected(),n=e.getExtent(),o=[0,e.itemSize[1]];this._handleEnds=[Ju(r[0],n,o,!0),Ju(r[1],n,o,!0)]},t.prototype._updateInterval=function(e,r){r=r||0;var n=this.visualMapModel,o=this._handleEnds,s=[0,n.itemSize[1]];Op(r,o,s,e,0);var a=n.getExtent();this._dataInterval=[Ju(o[0],s,a,!0),Ju(o[1],s,a,!0)]},t.prototype._updateView=function(e){var r=this.visualMapModel,n=r.getExtent(),o=this._shapes,s=[0,r.itemSize[1]],a=e?s:this._handleEnds,u=this._createBarVisual(this._dataInterval,n,a,"inRange"),f=this._createBarVisual(n,n,s,"outOfRange");o.inRange.setStyle({fill:u.barColor}).setShape("points",u.barPoints),o.outOfRange.setStyle({fill:f.barColor}).setShape("points",f.barPoints),this._updateHandle(a,u)},t.prototype._createBarVisual=function(e,r,n,o){var s={forceState:o,convertOpacityToAlpha:!0},a=this._makeColorGradient(e,s),u=[this.getControllerVisual(e[0],"symbolSize",s),this.getControllerVisual(e[1],"symbolSize",s)],f=this._createBarPoints(n,u);return{barColor:new V0(0,0,0,1,a),barPoints:f,handlesColor:[a[0].color,a[a.length-1].color]}},t.prototype._makeColorGradient=function(e,r){var n=100,o=[],s=(e[1]-e[0])/n;o.push({color:this.getControllerVisual(e[0],"color",r),offset:0});for(var a=1;a<n;a++){var u=e[0]+s*a;if(u>e[1])break;o.push({color:this.getControllerVisual(u,"color",r),offset:a/n})}return o.push({color:this.getControllerVisual(e[1],"color",r),offset:1}),o},t.prototype._createBarPoints=function(e,r){var n=this.visualMapModel.itemSize;return[[n[0]-r[0],e[0]],[n[0],e[0]],[n[0],e[1]],[n[0]-r[1],e[1]]]},t.prototype._createBarGroup=function(e){var r=this._orient,n=this.visualMapModel.get("inverse");return new Ki(r==="horizontal"&&!n?{scaleX:e==="bottom"?1:-1,rotation:Math.PI/2}:r==="horizontal"&&n?{scaleX:e==="bottom"?-1:1,rotation:-Math.PI/2}:r==="vertical"&&!n?{scaleX:e==="left"?1:-1,scaleY:-1}:{scaleX:e==="left"?1:-1})},t.prototype._updateHandle=function(e,r){if(this._useHandle){var n=this._shapes,o=this.visualMapModel,s=n.handleThumbs,a=n.handleLabels,u=o.itemSize,f=o.getExtent(),g=this._applyTransform("left",n.mainGroup);sNt([0,1],function(v){var y=s[v];y.setStyle("fill",r.handlesColor[v]),y.y=e[v];var w=Ju(e[v],[0,u[1]],f,!0),I=this.getControllerVisual(w,"symbolSize");y.scaleX=y.scaleY=I/u[0],y.x=u[0]-I/2;var E=du(n.handleLabelPoints[v],av(y,this.group));if(this._orient==="horizontal"){var D=g==="left"||g==="top"?(u[0]-I)/2:(u[0]-I)/-2;E[1]+=D}a[v].setStyle({x:E[0],y:E[1],text:o.formatValueText(this._dataInterval[v]),verticalAlign:"middle",align:this._orient==="vertical"?this._applyTransform("left",n.mainGroup):"center"})},this)}},t.prototype._showIndicator=function(e,r,n,o){var s=this.visualMapModel,a=s.getExtent(),u=s.itemSize,f=[0,u[1]],g=this._shapes,v=g.indicator;if(v){v.attr("invisible",!1);var y={convertOpacityToAlpha:!0},w=this.getControllerVisual(e,"color",y),I=this.getControllerVisual(e,"symbolSize"),E=Ju(e,a,f,!0),D=u[0]-I/2,R={x:v.x,y:v.y};v.y=E,v.x=D;var z=du(g.indicatorLabelPoint,av(v,this.group)),N=g.indicatorLabel;N.attr("invisible",!1);var H=this._applyTransform("left",g.mainGroup),$=this._orient,X=$==="horizontal";N.setStyle({text:(n||"")+s.formatValueText(r),verticalAlign:X?H:"middle",align:X?"center":H});var K={x:D,y:E,style:{fill:w}},et={style:{x:z[0],y:z[1]}};if(s.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var rt={duration:100,easing:"cubicInOut",additive:!0};v.x=R.x,v.y=R.y,v.animateTo(K,rt),N.animateTo(et,rt)}else v.attr(K),N.attr(et);this._firstShowIndicator=!1;var lt=this._shapes.handleLabels;if(lt)for(var ht=0;ht<lt.length;ht++)this.api.enterBlur(lt[ht])}},t.prototype._enableHoverLinkToSeries=function(){var e=this;this._shapes.mainGroup.on("mousemove",function(r){if(e._hovering=!0,!e._dragging){var n=e.visualMapModel.itemSize,o=e._applyTransform([r.offsetX,r.offsetY],e._shapes.mainGroup,!0,!0);o[1]=s7(zk(0,o[1]),n[1]),e._doHoverLinkToSeries(o[1],0<=o[0]&&o[0]<=n[0])}}).on("mouseout",function(){e._hovering=!1,!e._dragging&&e._clearHoverLinkToSeries()})},t.prototype._enableHoverLinkFromSeries=function(){var e=this.api.getZr();this.visualMapModel.option.hoverLink?(e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),e.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},t.prototype._doHoverLinkToSeries=function(e,r){var n=this.visualMapModel,o=n.itemSize;if(n.option.hoverLink){var s=[0,o[1]],a=n.getExtent();e=s7(zk(s[0],e),s[1]);var u=hNt(n,a,s),f=[e-u,e+u],g=Ju(e,s,a,!0),v=[Ju(f[0],s,a,!0),Ju(f[1],s,a,!0)];f[0]<s[0]&&(v[0]=-1/0),f[1]>s[1]&&(v[1]=1/0),r&&(v[0]===-1/0?this._showIndicator(g,v[1],"< ",u):v[1]===1/0?this._showIndicator(g,v[0],"> ",u):this._showIndicator(g,g," ",u));var y=this._hoverLinkDataIndices,w=[];(r||c7(n))&&(w=this._hoverLinkDataIndices=n.findTargetDataIndices(v));var I=zyt(y,w);this._dispatchHighDown("downplay",rM(I[0],n)),this._dispatchHighDown("highlight",rM(I[1],n))}},t.prototype._hoverLinkFromSeriesMouseOver=function(e){var r;if($m(e.target,function(u){var f=ur(u);if(f.dataIndex!=null)return r=f,!0},!0),!!r){var n=this.ecModel.getSeriesByIndex(r.seriesIndex),o=this.visualMapModel;if(o.isTargetSeries(n)){var s=n.getData(r.dataType),a=s.getStore().get(o.getDataDimensionIndex(s),r.dataIndex);isNaN(a)||this._showIndicator(a,a)}}},t.prototype._hideIndicator=function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",!0),e.indicatorLabel&&e.indicatorLabel.attr("invisible",!0);var r=this._shapes.handleLabels;if(r)for(var n=0;n<r.length;n++)this.api.leaveBlur(r[n])},t.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",rM(e,this.visualMapModel)),e.length=0},t.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver),e.off("mouseout",this._hideIndicator)},t.prototype._applyTransform=function(e,r,n,o){var s=av(r,o?null:this.group);return Ye(e)?du(e,s,n):fE(e,s,n)},t.prototype._dispatchHighDown=function(e,r){r&&r.length&&this.api.dispatchAction({type:e,batch:r})},t.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},t.type="visualMap.continuous",t}(zrt);function l7(i,t,e,r){return new gl({shape:{points:i},draggable:!!e,cursor:t,drift:e,onmousemove:function(n){Pd(n.event)},ondragend:r})}function hNt(i,t,e){var r=lNt/2,n=i.get("hoverLinkDataSize");return n&&(r=Ju(n,t,e,!0)/2),r}function c7(i){var t=i.get("hoverLinkOnHandle");return!!(t??i.get("realtime"))}function u7(i){return i==="vertical"?"ns-resize":"ew-resize"}const dNt=uNt;var fNt={type:"selectDataRange",event:"dataRangeSelected",update:"update"},pNt=function(i,t){t.eachComponent({mainType:"visualMap",query:i},function(e){e.setSelected(i.selected)})},gNt=[{createOnAllSeries:!0,reset:function(i,t){var e=[];return t.eachComponent("visualMap",function(r){var n=i.pipelineContext;!r.isTargetSeries(i)||n&&n.large||e.push(lFt(r.stateList,r.targetVisuals,wi(r.getValueState,r),r.getDataDimensionIndex(i.getData())))}),e}},{createOnAllSeries:!0,reset:function(i,t){var e=i.getData(),r=[];t.eachComponent("visualMap",function(n){if(n.isTargetSeries(i)){var o=n.getVisualMeta(wi(mNt,null,i,n))||{stops:[],outerColors:[]},s=n.getDataDimensionIndex(e);s>=0&&(o.dimension=s,r.push(o))}}),i.getData().setVisual("visualMeta",r)}}];function mNt(i,t,e,r){for(var n=t.targetVisuals[r],o=_s.prepareVisualTypes(n),s={color:US(i.getData(),"color")},a=0,u=o.length;a<u;a++){var f=o[a],g=n[f==="opacity"?"__alphaForOpacity":f];g&&g.applyVisual(e,v,y)}return s.color;function v(w){return s[w]}function y(w,I){s[w]=I}}var h7=gt;function vNt(i){var t=i&&i.visualMap;Ye(t)||(t=t?[t]:[]),h7(t,function(e){if(e){Oy(e,"splitList")&&!Oy(e,"pieces")&&(e.pieces=e.splitList,delete e.splitList);var r=e.pieces;r&&Ye(r)&&h7(r,function(n){nr(n)&&(Oy(n,"start")&&!Oy(n,"min")&&(n.min=n.start),Oy(n,"end")&&!Oy(n,"max")&&(n.max=n.end))})}})}function Oy(i,t){return i&&i.hasOwnProperty&&i.hasOwnProperty(t)}var d7=!1;function Frt(i){d7||(d7=!0,i.registerSubTypeDefaulter("visualMap",function(t){return!t.categories&&(!(t.pieces?t.pieces.length>0:t.splitNumber>0)||t.calculable)?"continuous":"piecewise"}),i.registerAction(fNt,pNt),gt(gNt,function(t){i.registerVisual(i.PRIORITY.VISUAL.COMPONENT,t)}),i.registerPreprocessor(vNt))}function Nrt(i){i.registerComponentModel(aNt),i.registerComponentView(dNt),Frt(i)}var _Nt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._pieceList=[],e}return t.prototype.optionUpdated=function(e,r){i.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var n=this._mode=this._determineMode();this._pieceList=[],yNt[this._mode].call(this,this._pieceList),this._resetSelected(e,r);var o=this.option.categories;this.resetVisual(function(s,a){n==="categories"?(s.mappingMethod="category",s.categories=Yi(o)):(s.dataExtent=this.getExtent(),s.mappingMethod="piecewise",s.pieceList=ti(this._pieceList,function(u){return u=Yi(u),a!=="inRange"&&(u.visual=null),u}))})},t.prototype.completeVisualOption=function(){var e=this.option,r={},n=_s.listVisualTypes(),o=this.isCategory();gt(e.pieces,function(a){gt(n,function(u){a.hasOwnProperty(u)&&(r[u]=1)})}),gt(r,function(a,u){var f=!1;gt(this.stateList,function(g){f=f||s(e,g,u)||s(e.target,g,u)},this),!f&&gt(this.stateList,function(g){(e[g]||(e[g]={}))[u]=Ort.get(u,g==="inRange"?"active":"inactive",o)})},this);function s(a,u,f){return a&&a[u]&&a[u].hasOwnProperty(f)}i.prototype.completeVisualOption.apply(this,arguments)},t.prototype._resetSelected=function(e,r){var n=this.option,o=this._pieceList,s=(r?n:e).selected||{};if(n.selected=s,gt(o,function(u,f){var g=this.getSelectedMapKey(u);s.hasOwnProperty(g)||(s[g]=!0)},this),n.selectedMode==="single"){var a=!1;gt(o,function(u,f){var g=this.getSelectedMapKey(u);s[g]&&(a?s[g]=!1:a=!0)},this)}},t.prototype.getItemSymbol=function(){return this.get("itemSymbol")},t.prototype.getSelectedMapKey=function(e){return this._mode==="categories"?e.value+"":e.index+""},t.prototype.getPieceList=function(){return this._pieceList},t.prototype._determineMode=function(){var e=this.option;return e.pieces&&e.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},t.prototype.setSelected=function(e){this.option.selected=Yi(e)},t.prototype.getValueState=function(e){var r=_s.findPieceIndex(e,this._pieceList);return r!=null&&this.option.selected[this.getSelectedMapKey(this._pieceList[r])]?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var r=[],n=this._pieceList;return this.eachTargetSeries(function(o){var s=[],a=o.getData();a.each(this.getDataDimensionIndex(a),function(u,f){var g=_s.findPieceIndex(u,n);g===e&&s.push(f)},this),r.push({seriesId:o.id,dataIndex:s})},this),r},t.prototype.getRepresentValue=function(e){var r;if(this.isCategory())r=e.value;else if(e.value!=null)r=e.value;else{var n=e.interval||[];r=n[0]===-1/0&&n[1]===1/0?0:(n[0]+n[1])/2}return r},t.prototype.getVisualMeta=function(e){if(this.isCategory())return;var r=[],n=["",""],o=this;function s(g,v){var y=o.getRepresentValue({interval:g});v||(v=o.getValueState(y));var w=e(y,v);g[0]===-1/0?n[0]=w:g[1]===1/0?n[1]=w:r.push({value:g[0],color:w},{value:g[1],color:w})}var a=this._pieceList.slice();if(!a.length)a.push({interval:[-1/0,1/0]});else{var u=a[0].interval[0];u!==-1/0&&a.unshift({interval:[-1/0,u]}),u=a[a.length-1].interval[1],u!==1/0&&a.push({interval:[u,1/0]})}var f=-1/0;return gt(a,function(g){var v=g.interval;v&&(v[0]>f&&s([f,v[0]],"outOfRange"),s(v.slice()),f=v[1])},this),{stops:r,outerColors:n}},t.type="visualMap.piecewise",t.defaultOption=jp(SC.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),t}(SC),yNt={splitNumber:function(i){var t=this.option,e=Math.min(t.precision,20),r=this.getExtent(),n=t.splitNumber;n=Math.max(parseInt(n,10),1),t.splitNumber=n;for(var o=(r[1]-r[0])/n;+o.toFixed(e)!==o&&e<5;)e++;t.precision=e,o=+o.toFixed(e),t.minOpen&&i.push({interval:[-1/0,r[0]],close:[0,0]});for(var s=0,a=r[0];s<n;a+=o,s++){var u=s===n-1?r[1]:a+o;i.push({interval:[a,u],close:[1,1]})}t.maxOpen&&i.push({interval:[r[1],1/0],close:[0,0]}),LH(i),gt(i,function(f,g){f.index=g,f.text=this.formatValueText(f.interval)},this)},categories:function(i){var t=this.option;gt(t.categories,function(e){i.push({text:this.formatValueText(e,!0),value:e})},this),f7(t,i)},pieces:function(i){var t=this.option;gt(t.pieces,function(e,r){nr(e)||(e={value:e});var n={text:"",index:r};if(e.label!=null&&(n.text=e.label),e.hasOwnProperty("value")){var o=n.value=e.value;n.interval=[o,o],n.close=[1,1]}else{for(var s=n.interval=[],a=n.close=[0,0],u=[1,0,1],f=[-1/0,1/0],g=[],v=0;v<2;v++){for(var y=[["gte","gt","min"],["lte","lt","max"]][v],w=0;w<3&&s[v]==null;w++)s[v]=e[y[w]],a[v]=u[w],g[v]=w===2;s[v]==null&&(s[v]=f[v])}g[0]&&s[1]===1/0&&(a[0]=0),g[1]&&s[0]===-1/0&&(a[1]=0),s[0]===s[1]&&a[0]&&a[1]&&(n.value=s[0])}n.visual=_s.retrieveVisuals(e),i.push(n)},this),f7(t,i),LH(i),gt(i,function(e){var r=e.close,n=[["<",""][r[1]],[">",""][r[0]]];e.text=e.text||this.formatValueText(e.value!=null?e.value:e.interval,!1,n)},this)}};function f7(i,t){var e=i.inverse;(i.orient==="vertical"?!e:e)&&t.reverse()}const xNt=_Nt;var bNt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.doRender=function(){var e=this.group;e.removeAll();var r=this.visualMapModel,n=r.get("textGap"),o=r.textStyleModel,s=this._getItemAlign(),a=r.itemSize,u=this._getViewData(),f=u.endsText,g=vs(r.get("showLabel",!0),!f),v=!r.get("selectedMode");f&&this._renderEndsText(e,f[0],a,g,s),gt(u.viewPieceList,function(y){var w=y.piece,I=new Ki;I.onclick=wi(this._onItemClick,this,w),this._enableHoverLink(I,y.indexInModelPieceList);var E=r.getRepresentValue(w);if(this._createItemSymbol(I,E,[0,0,a[0],a[1]],v),g){var D=this.visualMapModel.getValueState(E),R=o.get("align")||s;I.add(new _n({style:fa(o,{x:R==="right"?-n:a[0]+n,y:a[1]/2,text:w.text,verticalAlign:o.get("verticalAlign")||"middle",align:R,opacity:Ui(o.get("opacity"),D==="outOfRange"?.5:1)}),silent:v}))}e.add(I)},this),f&&this._renderEndsText(e,f[1],a,g,s),ov(r.get("orient"),e,r.get("itemGap")),this.renderBackground(e),this.positionGroup(e)},t.prototype._enableHoverLink=function(e,r){var n=this;e.on("mouseover",function(){return o("highlight")}).on("mouseout",function(){return o("downplay")});var o=function(s){var a=n.visualMapModel;a.option.hoverLink&&n.api.dispatchAction({type:s,batch:rM(a.findTargetDataIndices(r),a)})}},t.prototype._getItemAlign=function(){var e=this.visualMapModel,r=e.option;if(r.orient==="vertical")return Brt(e,this.api,e.itemSize);var n=r.align;return(!n||n==="auto")&&(n="left"),n},t.prototype._renderEndsText=function(e,r,n,o,s){if(r){var a=new Ki,u=this.visualMapModel.textStyleModel;a.add(new _n({style:fa(u,{x:o?s==="right"?n[0]:0:n[0]/2,y:n[1]/2,verticalAlign:"middle",align:o?s:"center",text:r})})),e.add(a)}},t.prototype._getViewData=function(){var e=this.visualMapModel,r=ti(e.getPieceList(),function(a,u){return{piece:a,indexInModelPieceList:u}}),n=e.get("text"),o=e.get("orient"),s=e.get("inverse");return(o==="horizontal"?s:!s)?r.reverse():n&&(n=n.slice().reverse()),{viewPieceList:r,endsText:n}},t.prototype._createItemSymbol=function(e,r,n,o){var s=bo(this.getControllerVisual(r,"symbol"),n[0],n[1],n[2],n[3],this.getControllerVisual(r,"color"));s.silent=o,e.add(s)},t.prototype._onItemClick=function(e){var r=this.visualMapModel,n=r.option,o=n.selectedMode;if(o){var s=Yi(n.selected),a=r.getSelectedMapKey(e);o==="single"||o===!0?(s[a]=!0,gt(s,function(u,f){s[f]=f===a})):s[a]=!s[a],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:s})}},t.type="visualMap.piecewise",t}(zrt);const wNt=bNt;function Vrt(i){i.registerComponentModel(xNt),i.registerComponentView(wNt),Frt(i)}function SNt(i){Rr(Nrt),Rr(Vrt)}var TNt=function(){function i(t){this._thumbnailModel=t}return i.prototype.reset=function(t){this._renderVersion=t.getMainProcessVersion()},i.prototype.renderContent=function(t){var e=t.api.getViewOfComponentModel(this._thumbnailModel);e&&(t.group.silent=!0,e.renderContent({group:t.group,targetTrans:t.targetTrans,z2Range:QK(t.group),roamType:t.roamType,viewportRect:t.viewportRect,renderVersion:this._renderVersion}))},i.prototype.updateWindow=function(t,e){var r=e.getViewOfComponentModel(this._thumbnailModel);r&&r.updateWindow({targetTrans:t,renderVersion:this._renderVersion})},i}(),ANt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventAutoZ=!0,e}return t.prototype.optionUpdated=function(e,r){this._updateBridge()},t.prototype._updateBridge=function(){var e=this._birdge=this._birdge||new TNt(this);if(this._target=null,this.ecModel.eachSeries(function(n){B$(n,null)}),this.shouldShow()){var r=this.getTarget();B$(r.baseMapProvider,e)}},t.prototype.shouldShow=function(){return this.getShallow("show",!0)},t.prototype.getBridge=function(){return this._birdge},t.prototype.getTarget=function(){if(this._target)return this._target;var e=this.getReferringComponents("series",{useDefault:!1,enableAll:!1,enableNone:!1}).models[0];return e?e.subType!=="graph"&&(e=null):e=this.ecModel.queryComponents({mainType:"series",subType:"graph"})[0],this._target={baseMapProvider:e},this._target},t.type="thumbnail",t.layoutMode="box",t.dependencies=["series","geo"],t.defaultOption={show:!0,right:1,bottom:1,height:"25%",width:"25%",itemStyle:{borderColor:_e.color.border,borderWidth:2},windowStyle:{borderWidth:1,color:_e.color.neutral30,borderColor:_e.color.neutral40,opacity:.3},z:10},t}(gn),INt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){if(this._api=n,this._model=e,this._coordSys||(this._coordSys=new Rv),!this._isEnabled()){this._clear();return}this._renderVersion=n.getMainProcessVersion();var o=this.group;o.removeAll();var s=e.getModel("itemStyle"),a=s.getItemStyle();a.fill==null&&(a.fill=r.get("backgroundColor")||_e.color.neutral00);var u=Bo(e,n).refContainer,f=Ca(wJ(e,!0),u),g=a.lineWidth||0,v=this._contentRect=mv(f.clone(),g/2,!0,!0),y=new Ki;o.add(y),y.setClipPath(new jr({shape:v.plain()}));var w=this._targetGroup=new Ki;y.add(w);var I=f.plain();I.r=s.getShallow("borderRadius",!0),o.add(this._bgRect=new jr({style:a,shape:I,silent:!1,cursor:"grab"}));var E=e.getModel("windowStyle"),D=E.getShallow("borderRadius",!0);y.add(this._windowRect=new jr({shape:{x:0,y:0,width:0,height:0,r:D},style:E.getItemStyle(),silent:!1,cursor:"grab"})),this._dealRenderContent(),this._dealUpdateWindow(),g7(e,this)},t.prototype.renderContent=function(e){this._bridgeRendered=e,this._isEnabled()&&(this._dealRenderContent(),this._dealUpdateWindow(),g7(this._model,this))},t.prototype._dealRenderContent=function(){var e=this._bridgeRendered;if(!(!e||e.renderVersion!==this._renderVersion)){var r=this._targetGroup,n=this._coordSys,o=this._contentRect;if(r.removeAll(),!!e){var s=e.group,a=s.getBoundingRect();r.add(s),this._bgRect.z2=e.z2Range.min-10,n.setBoundingRect(a.x,a.y,a.width,a.height);var u=Ca({left:"center",top:"center",aspect:a.width/a.height},o);n.setViewRect(u.x,u.y,u.width,u.height),s.attr(n.getTransformInfo().raw),this._windowRect.z2=e.z2Range.max+10,this._resetRoamController(e.roamType)}}},t.prototype.updateWindow=function(e){var r=this._bridgeRendered;r&&r.renderVersion===e.renderVersion&&(r.targetTrans=e.targetTrans),this._isEnabled()&&this._dealUpdateWindow()},t.prototype._dealUpdateWindow=function(){var e=this._bridgeRendered;if(!(!e||e.renderVersion!==this._renderVersion)){var r=mu([],e.targetTrans),n=fh([],this._coordSys.transform,r);this._transThisToTarget=mu([],n);var o=e.viewportRect;o?o=o.clone():o=new sr(0,0,this._api.getWidth(),this._api.getHeight()),o.applyTransform(n);var s=this._windowRect,a=s.shape.r;s.setShape(rr({r:a},o))}},t.prototype._resetRoamController=function(e){var r=this,n=this._api,o=this._roamController;if(o||(o=this._roamController=new Lv(n.getZr())),!e||!this._isEnabled()){o.disable();return}o.enable(e,{api:n,zInfo:{component:this._model},triggerInfo:{roamTrigger:null,isInSelf:function(s,a,u){return r._contentRect.contain(a,u)}}}),o.off("pan").off("zoom").on("pan",wi(this._onPan,this)).on("zoom",wi(this._onZoom,this))},t.prototype._onPan=function(e){var r=this._transThisToTarget;if(!(!this._isEnabled()||!r)){var n=ho([],[e.oldX,e.oldY],r),o=ho([],[e.oldX-e.dx,e.oldY-e.dy],r);this._api.dispatchAction(p7(this._model.getTarget().baseMapProvider,{dx:o[0]-n[0],dy:o[1]-n[1]}))}},t.prototype._onZoom=function(e){var r=this._transThisToTarget;if(!(!this._isEnabled()||!r)){var n=ho([],[e.originX,e.originY],r);this._api.dispatchAction(p7(this._model.getTarget().baseMapProvider,{zoom:1/e.scale,originX:n[0],originY:n[1]}))}},t.prototype._isEnabled=function(){var e=this._model;if(!e||!e.shouldShow())return!1;var r=e.getTarget().baseMapProvider;return!!r},t.prototype._clear=function(){this.group.removeAll(),this._bridgeRendered=null,this._roamController&&this._roamController.disable()},t.prototype.remove=function(){this._clear()},t.prototype.dispose=function(){this._clear()},t.type="thumbnail",t}(Oa);function p7(i,t){var e=i.mainType==="series"?i.subType+"Roam":i.mainType+"Roam",r={type:e};return r[i.mainType+"Id"]=i.id,Fe(r,t),r}function g7(i,t){var e=vv(i);pE(t.group,e.z,e.zlevel)}function MNt(i){i.registerComponentModel(ANt),i.registerComponentView(INt)}var CNt={label:{enabled:!0},decal:{show:!1}},m7=Wr(),ENt={};function DNt(i,t){var e=i.getModel("aria");if(!e.get("enabled"))return;var r=Yi(CNt);Er(r.label,i.getLocaleModel().get("aria"),!1),Er(e.option,r,!1),n(),o();function n(){var f=e.getModel("decal"),g=f.get("show");if(g){var v=Fi();i.eachSeries(function(y){if(!y.isColorBySeries()){var w=v.get(y.type);w||(w={},v.set(y.type,w)),m7(y).scope=w}}),i.eachRawSeries(function(y){if(i.isSeriesFiltered(y))return;if(Xi(y.enableAriaDecal)){y.enableAriaDecal();return}var w=y.getData();if(y.isColorBySeries()){var z=fz(y.ecModel,y.name,ENt,i.getSeriesCount()),N=w.getVisual("decal");w.setVisual("decal",H(N,z))}else{var I=y.getRawData(),E={},D=m7(y).scope;w.each(function($){var X=w.getRawIndex($);E[X]=$});var R=I.count();I.each(function($){var X=E[$],K=I.getName($)||$+"",et=fz(y.ecModel,K,D,R),rt=w.getItemVisual(X,"decal");w.setItemVisual(X,"decal",H(rt,et))})}function H($,X){var K=$?Fe(Fe({},X),$):X;return K.dirty=!0,K}})}}function o(){var f=t.getZr().dom;if(f){var g=i.getLocaleModel().get("aria"),v=e.getModel("label");if(v.option=rr(v.option,g),!!v.get("enabled")){if(f.setAttribute("role","img"),v.get("description")){f.setAttribute("aria-label",v.get("description"));return}var y=i.getSeriesCount(),w=v.get(["data","maxCount"])||10,I=v.get(["series","maxCount"])||10,E=Math.min(y,I),D;if(!(y<1)){var R=a();if(R){var z=v.get(["general","withTitle"]);D=s(z,{title:R})}else D=v.get(["general","withoutTitle"]);var N=[],H=y>1?v.get(["series","multiple","prefix"]):v.get(["series","single","prefix"]);D+=s(H,{seriesCount:y}),i.eachSeries(function(et,rt){if(rt<E){var lt=void 0,ht=et.get("name"),yt=ht?"withName":"withoutName";lt=y>1?v.get(["series","multiple",yt]):v.get(["series","single",yt]),lt=s(lt,{seriesId:et.seriesIndex,seriesName:et.get("name"),seriesType:u(et.subType)});var ft=et.getData();if(ft.count()>w){var kt=v.get(["data","partialData"]);lt+=s(kt,{displayCnt:w})}else lt+=v.get(["data","allData"]);for(var Rt=v.get(["data","separator","middle"]),Ct=v.get(["data","separator","end"]),Gt=v.get(["data","excludeDimensionId"]),Vt=[],Qt=0;Qt<ft.count();Qt++)if(Qt<w){var fe=ft.getName(Qt),Te=Gt?Rn(ft.getValues(Qt),function(Ge,li){return Ar(Gt,li)===-1}):ft.getValues(Qt),be=v.get(["data",fe?"withName":"withoutName"]);Vt.push(s(be,{name:fe,value:Te.join(Rt)}))}lt+=Vt.join(Rt)+Ct,N.push(lt)}});var $=v.getModel(["series","multiple","separator"]),X=$.get("middle"),K=$.get("end");D+=N.join(X)+K,f.setAttribute("aria-label",D)}}}}function s(f,g){if(!bi(f))return f;var v=f;return gt(g,function(y,w){v=v.replace(new RegExp("\\{\\s*"+w+"\\s*\\}","g"),y)}),v}function a(){var f=i.get("title");return f&&f.length&&(f=f[0]),f&&f.text}function u(f){var g=i.getLocaleModel().get(["series","typeNames"]);return g[f]||g.chart}}function PNt(i){if(!(!i||!i.aria)){var t=i.aria;t.show!=null&&(t.enabled=t.show),t.label=t.label||{},gt(["description","general","series","data"],function(e){t[e]!=null&&(t.label[e]=t[e])})}}function LNt(i){i.registerPreprocessor(PNt),i.registerVisual(i.PRIORITY.VISUAL.ARIA,DNt)}var v7={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},RNt=function(){function i(t){var e=this._condVal=bi(t)?new RegExp(t):Fvt(t)?t:null;if(e==null){var r="";Dn(r)}}return i.prototype.evaluate=function(t){var e=typeof t;return bi(e)?this._condVal.test(t):fn(e)?this._condVal.test(t+""):!1},i}(),kNt=function(){function i(){}return i.prototype.evaluate=function(){return this.value},i}(),ONt=function(){function i(){}return i.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(!t[e].evaluate())return!1;return!0},i}(),zNt=function(){function i(){}return i.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(t[e].evaluate())return!0;return!1},i}(),BNt=function(){function i(){}return i.prototype.evaluate=function(){return!this.child.evaluate()},i}(),FNt=function(){function i(){}return i.prototype.evaluate=function(){for(var t=!!this.valueParser,e=this.getValue,r=e(this.valueGetterParam),n=t?this.valueParser(r):null,o=0;o<this.subCondList.length;o++)if(!this.subCondList[o].evaluate(t?n:r))return!1;return!0},i}();function RN(i,t){if(i===!0||i===!1){var e=new kNt;return e.value=i,e}var r="";return Urt(i)||Dn(r),i.and?_7("and",i,t):i.or?_7("or",i,t):i.not?NNt(i,t):VNt(i,t)}function _7(i,t,e){var r=t[i],n="";Ye(r)||Dn(n),r.length||Dn(n);var o=i==="and"?new ONt:new zNt;return o.children=ti(r,function(s){return RN(s,e)}),o.children.length||Dn(n),o}function NNt(i,t){var e=i.not,r="";Urt(e)||Dn(r);var n=new BNt;return n.child=RN(e,t),n.child||Dn(r),n}function VNt(i,t){for(var e="",r=t.prepareGetValue(i),n=[],o=on(i),s=i.parser,a=s?$J(s):null,u=0;u<o.length;u++){var f=o[u];if(!(f==="parser"||t.valueGetterAttrMap.get(f))){var g=Di(v7,f)?v7[f]:f,v=i[f],y=a?a(v):v,w=lbt(g,y)||g==="reg"&&new RNt(y);w||Dn(e),n.push(w)}}n.length||Dn(e);var I=new FNt;return I.valueGetterParam=r,I.valueParser=a,I.getValue=t.getValue,I.subCondList=n,I}function Urt(i){return nr(i)&&!Ns(i)}var UNt=function(){function i(t,e){this._cond=RN(t,e)}return i.prototype.evaluate=function(){return this._cond.evaluate()},i}();function GNt(i,t){return new UNt(i,t)}var HNt={type:"echarts:filter",transform:function(i){for(var t=i.upstream,e,r=GNt(i.config,{valueGetterAttrMap:Fi({dimension:!0}),prepareGetValue:function(a){var u="",f=a.dimension;Di(a,"dimension")||Dn(u);var g=t.getDimensionInfo(f);return g||Dn(u),{dimIdx:g.index}},getValue:function(a){return t.retrieveValueFromItem(e,a.dimIdx)}}),n=[],o=0,s=t.count();o<s;o++)e=t.getRawDataItem(o),r.evaluate()&&n.push(e);return{data:n}}},jNt={type:"echarts:sort",transform:function(i){var t=i.upstream,e=i.config,r="",n=na(e);n.length||Dn(r);var o=[];gt(n,function(g){var v=g.dimension,y=g.order,w=g.parser,I=g.incomparable;if(v==null&&Dn(r),y!=="asc"&&y!=="desc"&&Dn(r),I&&I!=="min"&&I!=="max"){var E="";Dn(E)}if(y!=="asc"&&y!=="desc"){var D="";Dn(D)}var R=t.getDimensionInfo(v);R||Dn(r);var z=w?$J(w):null;w&&!z&&Dn(r),o.push({dimIdx:R.index,parser:z,comparator:new qJ(y,I)})});var s=t.sourceFormat;s!==os&&s!==ac&&Dn(r);for(var a=[],u=0,f=t.count();u<f;u++)a.push(t.getRawDataItem(u));return a.sort(function(g,v){for(var y=0;y<o.length;y++){var w=o[y],I=t.retrieveValueFromItem(g,w.dimIdx),E=t.retrieveValueFromItem(v,w.dimIdx);w.parser&&(I=w.parser(I),E=w.parser(E));var D=w.comparator.evaluate(I,E);if(D!==0)return D}return 0}),{data:a}}};function WNt(i){i.registerTransform(HNt),i.registerTransform(jNt)}var $Nt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="dataset",e}return t.prototype.init=function(e,r,n){i.prototype.init.call(this,e,r,n),this._sourceManager=new JJ(this),qj(this)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.call(this,e,r),qj(this)},t.prototype.optionUpdated=function(){this._sourceManager.dirty()},t.prototype.getSourceManager=function(){return this._sourceManager},t.type="dataset",t.defaultOption={seriesLayoutBy:fu},t}(gn),ZNt=function(i){we(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="dataset",e}return t.type="dataset",t}(Oa);function qNt(i){i.registerComponentModel($Nt),i.registerComponentView(ZNt)}var qu=wh.CMD;function Jy(i,t){return Math.abs(i-t)<1e-5}function TB(i){var t=i.data,e=i.len(),r=[],n,o=0,s=0,a=0,u=0;function f(ft,kt){n&&n.length>2&&r.push(n),n=[ft,kt]}function g(ft,kt,Rt,Ct){Jy(ft,Rt)&&Jy(kt,Ct)||n.push(ft,kt,Rt,Ct,Rt,Ct)}function v(ft,kt,Rt,Ct,Gt,Vt){var Qt=Math.abs(kt-ft),fe=Math.tan(Qt/4)*4/3,Te=kt<ft?-1:1,be=Math.cos(ft),Ge=Math.sin(ft),li=Math.cos(kt),Pi=Math.sin(kt),or=be*Gt+Rt,Ve=Ge*Vt+Ct,Ze=li*Gt+Rt,ye=Pi*Vt+Ct,Ke=Gt*fe*Te,We=Vt*fe*Te;n.push(or-Ke*Ge,Ve+We*be,Ze+Ke*Pi,ye-We*li,Ze,ye)}for(var y,w,I,E,D=0;D<e;){var R=t[D++],z=D===1;switch(z&&(o=t[D],s=t[D+1],a=o,u=s,(R===qu.L||R===qu.C||R===qu.Q)&&(n=[a,u])),R){case qu.M:o=a=t[D++],s=u=t[D++],f(a,u);break;case qu.L:y=t[D++],w=t[D++],g(o,s,y,w),o=y,s=w;break;case qu.C:n.push(t[D++],t[D++],t[D++],t[D++],o=t[D++],s=t[D++]);break;case qu.Q:y=t[D++],w=t[D++],I=t[D++],E=t[D++],n.push(o+2/3*(y-o),s+2/3*(w-s),I+2/3*(y-I),E+2/3*(w-E),I,E),o=I,s=E;break;case qu.A:var N=t[D++],H=t[D++],$=t[D++],X=t[D++],K=t[D++],et=t[D++]+K;D+=1;var rt=!t[D++];y=Math.cos(K)*$+N,w=Math.sin(K)*X+H,z?(a=y,u=w,f(a,u)):g(o,s,y,w),o=Math.cos(et)*$+N,s=Math.sin(et)*X+H;for(var lt=(rt?-1:1)*Math.PI/2,ht=K;rt?ht>et:ht<et;ht+=lt){var yt=rt?Math.max(ht+lt,et):Math.min(ht+lt,et);v(ht,yt,N,H,$,X)}break;case qu.R:a=o=t[D++],u=s=t[D++],y=a+t[D++],w=u+t[D++],f(y,u),g(y,u,y,w),g(y,w,a,w),g(a,w,a,u),g(a,u,y,u);break;case qu.Z:n&&g(o,s,a,u),o=a,s=u;break}}return n&&n.length>2&&r.push(n),r}function AB(i,t,e,r,n,o,s,a,u,f){if(Jy(i,e)&&Jy(t,r)&&Jy(n,s)&&Jy(o,a)){u.push(s,a);return}var g=2/f,v=g*g,y=s-i,w=a-t,I=Math.sqrt(y*y+w*w);y/=I,w/=I;var E=e-i,D=r-t,R=n-s,z=o-a,N=E*E+D*D,H=R*R+z*z;if(N<v&&H<v){u.push(s,a);return}var $=y*E+w*D,X=-y*R-w*z,K=N-$*$,et=H-X*X;if(K<v&&$>=0&&et<v&&X>=0){u.push(s,a);return}var rt=[],lt=[];Dp(i,e,n,s,.5,rt),Dp(t,r,o,a,.5,lt),AB(rt[0],lt[0],rt[1],lt[1],rt[2],lt[2],rt[3],lt[3],u,f),AB(rt[4],lt[4],rt[5],lt[5],rt[6],lt[6],rt[7],lt[7],u,f)}function XNt(i,t){var e=TB(i),r=[];t=t||1;for(var n=0;n<e.length;n++){var o=e[n],s=[],a=o[0],u=o[1];s.push(a,u);for(var f=2;f<o.length;){var g=o[f++],v=o[f++],y=o[f++],w=o[f++],I=o[f++],E=o[f++];AB(a,u,g,v,y,w,I,E,s,t),a=I,u=E}r.push(s)}return r}function Grt(i,t,e){var r=i[t],n=i[1-t],o=Math.abs(r/n),s=Math.ceil(Math.sqrt(o*e)),a=Math.floor(e/s);a===0&&(a=1,s=e);for(var u=[],f=0;f<s;f++)u.push(a);var g=s*a,v=e-g;if(v>0)for(var f=0;f<v;f++)u[f%s]+=1;return u}function y7(i,t,e){for(var r=i.r0,n=i.r,o=i.startAngle,s=i.endAngle,a=Math.abs(s-o),u=a*n,f=n-r,g=u>Math.abs(f),v=Grt([u,f],g?0:1,t),y=(g?a:f)/v.length,w=0;w<v.length;w++)for(var I=(g?f:a)/v[w],E=0;E<v[w];E++){var D={};g?(D.startAngle=o+y*w,D.endAngle=o+y*(w+1),D.r0=r+I*E,D.r=r+I*(E+1)):(D.startAngle=o+I*E,D.endAngle=o+I*(E+1),D.r0=r+y*w,D.r=r+y*(w+1)),D.clockwise=i.clockwise,D.cx=i.cx,D.cy=i.cy,e.push(D)}}function YNt(i,t,e){for(var r=i.width,n=i.height,o=r>n,s=Grt([r,n],o?0:1,t),a=o?"width":"height",u=o?"height":"width",f=o?"x":"y",g=o?"y":"x",v=i[a]/s.length,y=0;y<s.length;y++)for(var w=i[u]/s[y],I=0;I<s[y];I++){var E={};E[f]=y*v,E[g]=I*w,E[a]=v,E[u]=w,E.x+=i.x,E.y+=i.y,e.push(E)}}function x7(i,t,e,r){return i*r-e*t}function KNt(i,t,e,r,n,o,s,a){var u=e-i,f=r-t,g=s-n,v=a-o,y=x7(g,v,u,f);if(Math.abs(y)<1e-6)return null;var w=i-n,I=t-o,E=x7(w,I,g,v)/y;return E<0||E>1?null:new er(E*u+i,E*f+t)}function JNt(i,t,e){var r=new er;er.sub(r,e,t),r.normalize();var n=new er;er.sub(n,i,t);var o=n.dot(r);return o}function zy(i,t){var e=i[i.length-1];e&&e[0]===t[0]&&e[1]===t[1]||i.push(t)}function QNt(i,t,e){for(var r=i.length,n=[],o=0;o<r;o++){var s=i[o],a=i[(o+1)%r],u=KNt(s[0],s[1],a[0],a[1],t.x,t.y,e.x,e.y);u&&n.push({projPt:JNt(u,t,e),pt:u,idx:o})}if(n.length<2)return[{points:i},{points:i}];n.sort(function(D,R){return D.projPt-R.projPt});var f=n[0],g=n[n.length-1];if(g.idx<f.idx){var v=f;f=g,g=v}for(var y=[f.pt.x,f.pt.y],w=[g.pt.x,g.pt.y],I=[y],E=[w],o=f.idx+1;o<=g.idx;o++)zy(I,i[o].slice());zy(I,w),zy(I,y);for(var o=g.idx+1;o<=f.idx+r;o++)zy(E,i[o%r].slice());return zy(E,y),zy(E,w),[{points:I},{points:E}]}function b7(i){var t=i.points,e=[],r=[];aE(t,e,r);var n=new sr(e[0],e[1],r[0]-e[0],r[1]-e[1]),o=n.width,s=n.height,a=n.x,u=n.y,f=new er,g=new er;return o>s?(f.x=g.x=a+o/2,f.y=u,g.y=u+s):(f.y=g.y=u+s/2,f.x=a,g.x=a+o),QNt(t,f,g)}function TC(i,t,e,r){if(e===1)r.push(t);else{var n=Math.floor(e/2),o=i(t);TC(i,o[0],n,r),TC(i,o[1],e-n,r)}return r}function t5t(i,t){for(var e=[],r=0;r<t;r++)e.push(NF(i));return e}function e5t(i,t){t.setStyle(i.style),t.z=i.z,t.z2=i.z2,t.zlevel=i.zlevel}function i5t(i){for(var t=[],e=0;e<i.length;)t.push([i[e++],i[e++]]);return t}function r5t(i,t){var e=[],r=i.shape,n;switch(i.type){case"rect":YNt(r,t,e),n=jr;break;case"sector":y7(r,t,e),n=pl;break;case"circle":y7({r0:0,r:r.r,startAngle:0,endAngle:Math.PI*2,cx:r.cx,cy:r.cy},t,e),n=pl;break;default:var o=i.getComputedTransform(),s=o?Math.sqrt(Math.max(o[0]*o[0]+o[1]*o[1],o[2]*o[2]+o[3]*o[3])):1,a=ti(XNt(i.getUpdatedPathProxy(),s),function(R){return i5t(R)}),u=a.length;if(u===0)TC(b7,{points:a[0]},t,e);else if(u===t)for(var f=0;f<u;f++)e.push({points:a[f]});else{var g=0,v=ti(a,function(R){var z=[],N=[];aE(R,z,N);var H=(N[1]-z[1])*(N[0]-z[0]);return g+=H,{poly:R,area:H}});v.sort(function(R,z){return z.area-R.area});for(var y=t,f=0;f<u;f++){var w=v[f];if(y<=0)break;var I=f===u-1?y:Math.ceil(w.area/g*t);I<0||(TC(b7,{points:w.poly},I,e),y-=I)}}n=gl;break}if(!n)return t5t(i,t);for(var E=[],f=0;f<e.length;f++){var D=new n;D.setShape(e[f]),e5t(i,D),E.push(D)}return E}function n5t(i,t){var e=i.length,r=t.length;if(e===r)return[i,t];for(var n=[],o=[],s=e<r?i:t,a=Math.min(e,r),u=Math.abs(r-e)/6,f=(a-2)/6,g=Math.ceil(u/f)+1,v=[s[0],s[1]],y=u,w=2;w<a;){var I=s[w-2],E=s[w-1],D=s[w++],R=s[w++],z=s[w++],N=s[w++],H=s[w++],$=s[w++];if(y<=0){v.push(D,R,z,N,H,$);continue}for(var X=Math.min(y,g-1)+1,K=1;K<=X;K++){var et=K/X;Dp(I,D,z,H,et,n),Dp(E,R,N,$,et,o),I=n[3],E=o[3],v.push(n[1],o[1],n[2],o[2],I,E),D=n[5],R=o[5],z=n[6],N=o[6]}y-=X-1}return s===i?[v,t]:[i,v]}function w7(i,t){for(var e=i.length,r=i[e-2],n=i[e-1],o=[],s=0;s<t.length;)o[s++]=r,o[s++]=n;return o}function a5t(i,t){for(var e,r,n,o=[],s=[],a=0;a<Math.max(i.length,t.length);a++){var u=i[a],f=t[a],g=void 0,v=void 0;u?f?(e=n5t(u,f),g=e[0],v=e[1],r=g,n=v):(v=w7(n||u,u),g=u):(g=w7(r||f,f),v=f),o.push(g),s.push(v)}return[o,s]}function S7(i){for(var t=0,e=0,r=0,n=i.length,o=0,s=n-2;o<n;s=o,o+=2){var a=i[s],u=i[s+1],f=i[o],g=i[o+1],v=a*g-f*u;t+=v,e+=(a+f)*v,r+=(u+g)*v}return t===0?[i[0]||0,i[1]||0]:[e/t/3,r/t/3,t]}function o5t(i,t,e,r){for(var n=(i.length-2)/6,o=1/0,s=0,a=i.length,u=a-2,f=0;f<n;f++){for(var g=f*6,v=0,y=0;y<a;y+=2){var w=y===0?g:(g+y-2)%u+2,I=i[w]-e[0],E=i[w+1]-e[1],D=t[y]-r[0],R=t[y+1]-r[1],z=D-I,N=R-E;v+=z*z+N*N}v<o&&(o=v,s=f)}return s}function s5t(i){for(var t=[],e=i.length,r=0;r<e;r+=2)t[r]=i[e-r-2],t[r+1]=i[e-r-1];return t}function l5t(i,t,e,r){for(var n=[],o,s=0;s<i.length;s++){var a=i[s],u=t[s],f=S7(a),g=S7(u);o==null&&(o=f[2]<0!=g[2]<0);var v=[],y=[],w=0,I=1/0,E=[],D=a.length;o&&(a=s5t(a));for(var R=o5t(a,u,f,g)*6,z=D-2,N=0;N<z;N+=2){var H=(R+N)%z+2;v[N+2]=a[H]-f[0],v[N+3]=a[H+1]-f[1]}if(v[0]=a[R]-f[0],v[1]=a[R+1]-f[1],e>0)for(var $=r/e,X=-r/2;X<=r/2;X+=$){for(var K=Math.sin(X),et=Math.cos(X),rt=0,N=0;N<a.length;N+=2){var lt=v[N],ht=v[N+1],yt=u[N]-g[0],ft=u[N+1]-g[1],kt=yt*et-ft*K,Rt=yt*K+ft*et;E[N]=kt,E[N+1]=Rt;var Ct=kt-lt,Gt=Rt-ht;rt+=Ct*Ct+Gt*Gt}if(rt<I){I=rt,w=X;for(var Vt=0;Vt<E.length;Vt++)y[Vt]=E[Vt]}}else for(var Qt=0;Qt<D;Qt+=2)y[Qt]=u[Qt]-g[0],y[Qt+1]=u[Qt+1]-g[1];n.push({from:v,to:y,fromCp:f,toCp:g,rotation:-w})}return n}function AC(i){return i.__isCombineMorphing}var Hrt="__mOriginal_";function IC(i,t,e){var r=Hrt+t,n=i[r]||i[t];i[r]||(i[r]=i[t]);var o=e.replace,s=e.after,a=e.before;i[t]=function(){var u=arguments,f;return a&&a.apply(this,u),o?f=o.apply(this,u):f=n.apply(this,u),s&&s.apply(this,u),f}}function Rw(i,t){var e=Hrt+t;i[e]&&(i[t]=i[e],i[e]=null)}function T7(i,t){for(var e=0;e<i.length;e++)for(var r=i[e],n=0;n<r.length;){var o=r[n],s=r[n+1];r[n++]=t[0]*o+t[2]*s+t[4],r[n++]=t[1]*o+t[3]*s+t[5]}}function jrt(i,t){var e=i.getUpdatedPathProxy(),r=t.getUpdatedPathProxy(),n=a5t(TB(e),TB(r)),o=n[0],s=n[1],a=i.getComputedTransform(),u=t.getComputedTransform();function f(){this.transform=null}a&&T7(o,a),u&&T7(s,u),IC(t,"updateTransform",{replace:f}),t.transform=null;var g=l5t(o,s,10,Math.PI),v=[];IC(t,"buildPath",{replace:function(y){for(var w=t.__morphT,I=1-w,E=[],D=0;D<g.length;D++){var R=g[D],z=R.from,N=R.to,H=R.rotation*w,$=R.fromCp,X=R.toCp,K=Math.sin(H),et=Math.cos(H);FI(E,$,X,w);for(var rt=0;rt<z.length;rt+=2){var lt=z[rt],ht=z[rt+1],yt=N[rt],ft=N[rt+1],kt=lt*I+yt*w,Rt=ht*I+ft*w;v[rt]=kt*et-Rt*K+E[0],v[rt+1]=kt*K+Rt*et+E[1]}var Ct=v[0],Gt=v[1];y.moveTo(Ct,Gt);for(var rt=2;rt<z.length;){var yt=v[rt++],ft=v[rt++],Vt=v[rt++],Qt=v[rt++],fe=v[rt++],Te=v[rt++];Ct===yt&&Gt===ft&&Vt===fe&&Qt===Te?y.lineTo(fe,Te):y.bezierCurveTo(yt,ft,Vt,Qt,fe,Te),Ct=fe,Gt=Te}}}})}function kN(i,t,e){if(!i||!t)return t;var r=e.done,n=e.during;jrt(i,t),t.__morphT=0;function o(){Rw(t,"buildPath"),Rw(t,"updateTransform"),t.__morphT=-1,t.createPathProxy(),t.dirtyShape()}return t.animateTo({__morphT:1},rr({during:function(s){t.dirtyShape(),n&&n(s)},done:function(){o(),r&&r()}},e)),t}function c5t(i,t,e,r,n,o){var s=16;i=n===e?0:Math.round(32767*(i-e)/(n-e)),t=o===r?0:Math.round(32767*(t-r)/(o-r));for(var a=0,u,f=(1<<s)/2;f>0;f/=2){var g=0,v=0;(i&f)>0&&(g=1),(t&f)>0&&(v=1),a+=f*f*(3*g^v),v===0&&(g===1&&(i=f-1-i,t=f-1-t),u=i,i=t,t=u)}return a}function MC(i){var t=1/0,e=1/0,r=-1/0,n=-1/0,o=ti(i,function(a){var u=a.getBoundingRect(),f=a.getComputedTransform(),g=u.x+u.width/2+(f?f[4]:0),v=u.y+u.height/2+(f?f[5]:0);return t=Math.min(g,t),e=Math.min(v,e),r=Math.max(g,r),n=Math.max(v,n),[g,v]}),s=ti(o,function(a,u){return{cp:a,z:c5t(a[0],a[1],t,e,r,n),path:i[u]}});return s.sort(function(a,u){return a.z-u.z}).map(function(a){return a.path})}function Wrt(i){return r5t(i.path,i.count)}function IB(){return{fromIndividuals:[],toIndividuals:[],count:0}}function u5t(i,t,e){var r=[];function n($){for(var X=0;X<$.length;X++){var K=$[X];AC(K)?n(K.childrenRef()):K instanceof qr&&r.push(K)}}n(i);var o=r.length;if(!o)return IB();var s=e.dividePath||Wrt,a=s({path:t,count:o});if(a.length!==o)return console.error("Invalid morphing: unmatched splitted path"),IB();r=MC(r),a=MC(a);for(var u=e.done,f=e.during,g=e.individualDelay,v=new yd,y=0;y<o;y++){var w=r[y],I=a[y];I.parent=t,I.copyTransform(v),g||jrt(w,I)}t.__isCombineMorphing=!0,t.childrenRef=function(){return a};function E($){for(var X=0;X<a.length;X++)a[X].addSelfToZr($)}IC(t,"addSelfToZr",{after:function($){E($)}}),IC(t,"removeSelfFromZr",{after:function($){for(var X=0;X<a.length;X++)a[X].removeSelfFromZr($)}});function D(){t.__isCombineMorphing=!1,t.__morphT=-1,t.childrenRef=null,Rw(t,"addSelfToZr"),Rw(t,"removeSelfFromZr")}var R=a.length;if(g)for(var z=R,N=function(){z--,z===0&&(D(),u&&u())},y=0;y<R;y++){var H=g?rr({delay:(e.delay||0)+g(y,R,r[y],a[y]),done:N},e):e;kN(r[y],a[y],H)}else t.__morphT=0,t.animateTo({__morphT:1},rr({during:function($){for(var X=0;X<R;X++){var K=a[X];K.__morphT=t.__morphT,K.dirtyShape()}f&&f($)},done:function(){D();for(var $=0;$<i.length;$++)Rw(i[$],"updateTransform");u&&u()}},e));return t.__zr&&E(t.__zr),{fromIndividuals:r,toIndividuals:a,count:R}}function h5t(i,t,e){var r=t.length,n=[],o=e.dividePath||Wrt;function s(w){for(var I=0;I<w.length;I++){var E=w[I];AC(E)?s(E.childrenRef()):E instanceof qr&&n.push(E)}}if(AC(i)){s(i.childrenRef());var a=n.length;if(a<r)for(var u=0,f=a;f<r;f++)n.push(NF(n[u++%a]));n.length=r}else{n=o({path:i,count:r});for(var g=i.getComputedTransform(),f=0;f<n.length;f++)n[f].setLocalTransform(g);if(n.length!==r)return console.error("Invalid morphing: unmatched splitted path"),IB()}n=MC(n),t=MC(t);for(var v=e.individualDelay,f=0;f<r;f++){var y=v?rr({delay:(e.delay||0)+v(f,r,n[f],t[f])},e):e;kN(n[f],t[f],y)}return{fromIndividuals:n,toIndividuals:t,count:t.length}}function A7(i){return Ye(i[0])}function I7(i,t){for(var e=[],r=i.length,n=0;n<r;n++)e.push({one:i[n],many:[]});for(var n=0;n<t.length;n++){var o=t[n].length,s=void 0;for(s=0;s<o;s++)e[s%r].many.push(t[n][s])}for(var a=0,n=r-1;n>=0;n--)if(!e[n].many.length){var u=e[a].many;if(u.length<=1)if(a)a=0;else return e;var o=u.length,f=Math.ceil(o/2);e[n].many=u.slice(f,o),e[a].many=u.slice(0,f),a++}return e}var d5t={clone:function(i){for(var t=[],e=1-Math.pow(1-i.path.style.opacity,1/i.count),r=0;r<i.count;r++){var n=NF(i.path);n.setStyle("opacity",e),t.push(n)}return t},split:null};function Bk(i,t,e,r,n,o){if(!i.length||!t.length)return;var s=U0("update",r,n);if(!(s&&s.duration>0))return;var a=r.getModel("universalTransition").get("delay"),u=Object.assign({setToFinal:!0},s),f,g;A7(i)&&(f=i,g=t),A7(t)&&(f=t,g=i);function v(R,z,N,H,$){var X=R.many,K=R.one;if(X.length===1&&!$){var et=z?X[0]:K,rt=z?K:X[0];if(AC(et))v({many:[et],one:rt},!0,N,H,!0);else{var lt=a?rr({delay:a(N,H)},u):u;kN(et,rt,lt),o(et,rt,et,rt,lt)}}else for(var ht=rr({dividePath:d5t[e],individualDelay:a&&function(Gt,Vt,Qt,fe){return a(Gt+N,H)}},u),yt=z?u5t(X,K,ht):h5t(K,X,ht),ft=yt.fromIndividuals,kt=yt.toIndividuals,Rt=ft.length,Ct=0;Ct<Rt;Ct++){var lt=a?rr({delay:a(Ct,Rt)},u):u;o(ft[Ct],kt[Ct],z?X[Ct]:R.one,z?R.one:X[Ct],lt)}}for(var y=f?f===i:i.length>t.length,w=f?I7(g,f):I7(y?t:i,[y?i:t]),I=0,E=0;E<w.length;E++)I+=w[E].many.length;for(var D=0,E=0;E<w.length;E++)v(w[E],y,D,I),D+=w[E].many.length}function km(i){if(!i)return[];if(Ye(i)){for(var t=[],e=0;e<i.length;e++)t.push(km(i[e]));return t}var r=[];return i.traverse(function(n){n instanceof qr&&!n.disableMorphing&&!n.invisible&&!n.ignore&&r.push(n)}),r}var $rt=1e4,f5t=0,M7=1,C7=2,p5t=Wr();function g5t(i,t){for(var e=i.dimensions,r=0;r<e.length;r++){var n=i.getDimensionInfo(e[r]);if(n&&n.otherDims[t]===0)return e[r]}}function m5t(i,t,e){var r=i.getDimensionInfo(e),n=r&&r.ordinalMeta;if(r){var o=i.get(r.name,t);return n&&n.categories[o]||o+""}}function E7(i,t,e,r){var n=r?"itemChildGroupId":"itemGroupId",o=g5t(i,n);if(o){var s=m5t(i,t,o);return s}var a=i.getRawDataItem(t),u=r?"childGroupId":"groupId";if(a&&a[u])return a[u]+"";if(!r)return e||i.getId(t)}function D7(i){var t=[];return gt(i,function(e){var r=e.data,n=e.dataGroupId;if(!(r.count()>$rt))for(var o=r.getIndices(),s=0;s<o.length;s++)t.push({data:r,groupId:E7(r,s,n,!1),childGroupId:E7(r,s,n,!0),divide:e.divide,dataIndex:s})}),t}function Fk(i,t,e){i.traverse(function(r){r instanceof qr&&ya(r,{style:{opacity:0}},t,{dataIndex:e,isFrom:!0})})}function Nk(i){if(i.parent){var t=i.getComputedTransform();i.setLocalTransform(t),i.parent.remove(i)}}function By(i){i.stopAnimation(),i.isGroup&&i.traverse(function(t){t.stopAnimation()})}function v5t(i,t,e){var r=U0("update",e,t);r&&i.traverse(function(n){if(n instanceof kc){var o=Lxt(n);o&&n.animateFrom({style:o},r)}})}function _5t(i,t){var e=i.length;if(e!==t.length)return!1;for(var r=0;r<e;r++){var n=i[r],o=t[r];if(n.data.getId(n.dataIndex)!==o.data.getId(o.dataIndex))return!1}return!0}function Zrt(i,t,e){var r=D7(i),n=D7(t);function o(N,H,$,X,K){($||N)&&H.animateFrom({style:$&&$!==N?Fe(Fe({},$.style),N.style):N.style},K)}var s=!1,a=f5t,u=Fi(),f=Fi();r.forEach(function(N){N.groupId&&u.set(N.groupId,!0),N.childGroupId&&f.set(N.childGroupId,!0)});for(var g=0;g<n.length;g++){var v=n[g].groupId;if(f.get(v)){a=M7;break}var y=n[g].childGroupId;if(y&&u.get(y)){a=C7;break}}function w(N,H){return function($){var X=$.data,K=$.dataIndex;return H?X.getId(K):N?a===M7?$.childGroupId:$.groupId:a===C7?$.childGroupId:$.groupId}}var I=_5t(r,n),E={};if(!I)for(var g=0;g<n.length;g++){var D=n[g],R=D.data.getItemGraphicEl(D.dataIndex);R&&(E[R.id]=!0)}function z(N,H){var $=r[H],X=n[N],K=X.data.hostModel,et=$.data.getItemGraphicEl($.dataIndex),rt=X.data.getItemGraphicEl(X.dataIndex);if(et===rt){rt&&v5t(rt,X.dataIndex,K);return}et&&E[et.id]||rt&&(By(rt),et?(By(et),Nk(et),s=!0,Bk(km(et),km(rt),X.divide,K,N,o)):Fk(rt,K,N))}new Od(r,n,w(!0,I),w(!1,I),null,"multiple").update(z).updateManyToOne(function(N,H){var $=n[N],X=$.data,K=X.hostModel,et=X.getItemGraphicEl($.dataIndex),rt=Rn(ti(H,function(lt){return r[lt].data.getItemGraphicEl(r[lt].dataIndex)}),function(lt){return lt&&lt!==et&&!E[lt.id]});et&&(By(et),rt.length?(gt(rt,function(lt){By(lt),Nk(lt)}),s=!0,Bk(km(rt),km(et),$.divide,K,N,o)):Fk(et,K,$.dataIndex))}).updateOneToMany(function(N,H){var $=r[H],X=$.data.getItemGraphicEl($.dataIndex);if(!(X&&E[X.id])){var K=Rn(ti(N,function(rt){return n[rt].data.getItemGraphicEl(n[rt].dataIndex)}),function(rt){return rt&&rt!==X}),et=n[N[0]].data.hostModel;K.length&&(gt(K,function(rt){return By(rt)}),X?(By(X),Nk(X),s=!0,Bk(km(X),km(K),$.divide,et,N[0],o)):gt(K,function(rt){return Fk(rt,et,N[0])}))}}).updateManyToMany(function(N,H){new Od(H,N,function($){return r[$].data.getId(r[$].dataIndex)},function($){return n[$].data.getId(n[$].dataIndex)}).update(function($,X){z(N[$],H[X])}).execute()}).execute(),s&&gt(t,function(N){var H=N.data,$=H.hostModel,X=$&&e.getViewOfSeriesModel($),K=U0("update",$,0);X&&$.isAnimationEnabled()&&K&&K.duration>0&&X.group.traverse(function(et){et instanceof qr&&!et.animators.length&&et.animateFrom({style:{opacity:0}},K)})})}function P7(i){var t=i.getModel("universalTransition").get("seriesKey");return t||i.id}function L7(i){return Ye(i)?i.sort().join(","):i}function ep(i){if(i.hostModel)return i.hostModel.getModel("universalTransition").get("divideShape")}function y5t(i,t){var e=Fi(),r=Fi(),n=Fi();return gt(i.oldSeries,function(o,s){var a=i.oldDataGroupIds[s],u=i.oldData[s],f=P7(o),g=L7(f);r.set(g,{dataGroupId:a,data:u}),Ye(f)&&gt(f,function(v){n.set(v,{key:g,dataGroupId:a,data:u})})}),gt(t.updatedSeries,function(o){if(o.isUniversalTransitionEnabled()&&o.isAnimationEnabled()){var s=o.get("dataGroupId"),a=o.getData(),u=P7(o),f=L7(u),g=r.get(f);if(g)e.set(f,{oldSeries:[{dataGroupId:g.dataGroupId,divide:ep(g.data),data:g.data}],newSeries:[{dataGroupId:s,divide:ep(a),data:a}]});else if(Ye(u)){var v=[];gt(u,function(I){var E=r.get(I);E.data&&v.push({dataGroupId:E.dataGroupId,divide:ep(E.data),data:E.data})}),v.length&&e.set(f,{oldSeries:v,newSeries:[{dataGroupId:s,data:a,divide:ep(a)}]})}else{var y=n.get(u);if(y){var w=e.get(y.key);w||(w={oldSeries:[{dataGroupId:y.dataGroupId,data:y.data,divide:ep(y.data)}],newSeries:[]},e.set(y.key,w)),w.newSeries.push({dataGroupId:s,data:a,divide:ep(a)})}}}}),e}function R7(i,t){for(var e=0;e<i.length;e++){var r=t.seriesIndex!=null&&t.seriesIndex===i[e].seriesIndex||t.seriesId!=null&&t.seriesId===i[e].id;if(r)return e}}function x5t(i,t,e,r){var n=[],o=[];gt(na(i.from),function(s){var a=R7(t.oldSeries,s);a>=0&&n.push({dataGroupId:t.oldDataGroupIds[a],data:t.oldData[a],divide:ep(t.oldData[a]),groupIdDim:s.dimension})}),gt(na(i.to),function(s){var a=R7(e.updatedSeries,s);if(a>=0){var u=e.updatedSeries[a].getData();o.push({dataGroupId:t.oldDataGroupIds[a],data:u,divide:ep(u),groupIdDim:s.dimension})}}),n.length>0&&o.length>0&&Zrt(n,o,r)}function b5t(i){i.registerUpdateLifecycle("series:beforeupdate",function(t,e,r){gt(na(r.seriesTransition),function(n){gt(na(n.to),function(o){for(var s=r.updatedSeries,a=0;a<s.length;a++)(o.seriesIndex!=null&&o.seriesIndex===s[a].seriesIndex||o.seriesId!=null&&o.seriesId===s[a].id)&&(s[a][KI]=!0)})})}),i.registerUpdateLifecycle("series:transition",function(t,e,r){var n=p5t(e);if(n.oldSeries&&r.updatedSeries&&r.optionChanged){var o=r.seriesTransition;if(o)gt(na(o),function(w){x5t(w,n,r,e)});else{var s=y5t(n,r);gt(s.keys(),function(w){var I=s.get(w);Zrt(I.oldSeries,I.newSeries,e)})}gt(r.updatedSeries,function(w){w[KI]&&(w[KI]=!1)})}for(var a=t.getSeries(),u=n.oldSeries=[],f=n.oldDataGroupIds=[],g=n.oldData=[],v=0;v<a.length;v++){var y=a[v].getData();y.count()<$rt&&(u.push(a[v]),f.push(a[v].get("dataGroupId")),g.push(y))}})}var w5t=function(){function i(){this.breaks=[],this._elapsedExtent=[1/0,-1/0]}return i.prototype.setBreaks=function(t){this.breaks=t.breaks},i.prototype.update=function(t){T5t(this,t);var e=this._elapsedExtent;e[0]=this.elapse(t[0]),e[1]=this.elapse(t[1])},i.prototype.hasBreaks=function(){return!!this.breaks.length},i.prototype.calcNiceTickMultiple=function(t,e){for(var r=0;r<this.breaks.length;r++){var n=this.breaks[r];if(n.vmin<t&&t<n.vmax){var o=e(t,n.vmax);return o}}return 0},i.prototype.getExtentSpan=function(){return this._elapsedExtent[1]-this._elapsedExtent[0]},i.prototype.normalize=function(t){var e=this._elapsedExtent[1]-this._elapsedExtent[0];return e===0?.5:(this.elapse(t)-this._elapsedExtent[0])/e},i.prototype.scale=function(t){return this.unelapse(t*(this._elapsedExtent[1]-this._elapsedExtent[0])+this._elapsedExtent[0])},i.prototype.elapse=function(t){for(var e=k7,r=O7,n=!0,o=0;o<this.breaks.length;o++){var s=this.breaks[o];if(t<=s.vmax){t>s.vmin?e+=s.vmin-r+(t-s.vmin)/(s.vmax-s.vmin)*s.gapReal:e+=t-r,r=s.vmax,n=!1;break}e+=s.vmin-r+s.gapReal,r=s.vmax}return n&&(e+=t-r),e},i.prototype.unelapse=function(t){for(var e=k7,r=O7,n=!0,o=0,s=0;s<this.breaks.length;s++){var a=this.breaks[s],u=e+a.vmin-r,f=u+a.gapReal;if(t<=f){t>u?o=a.vmin+(t-u)/(f-u)*(a.vmax-a.vmin):o=r+t-e,r=a.vmax,n=!1;break}e=f,r=a.vmax}return n&&(o=r+t-e),o},i}();function S5t(){return new w5t}var k7=0,O7=0;function T5t(i,t){var e=0,r={tpAbs:{span:0,val:0},tpPrct:{span:0,val:0}},n=function(){return{has:!1,span:NaN,inExtFrac:NaN,val:NaN}},o={S:{tpAbs:n(),tpPrct:n()},E:{tpAbs:n(),tpPrct:n()}};gt(i.breaks,function(a){var u=a.gapParsed;u.type==="tpPrct"&&(e+=u.val);var f=ON(a,t);if(f){var g=f.vmin!==a.vmin,v=f.vmax!==a.vmax,y=f.vmax-f.vmin;if(!(g&&v))if(g||v){var w=g?"S":"E";o[w][u.type].has=!0,o[w][u.type].span=y,o[w][u.type].inExtFrac=y/(a.vmax-a.vmin),o[w][u.type].val=u.val}else r[u.type].span+=y,r[u.type].val+=u.val}});var s=e*(0+(t[1]-t[0])+(r.tpAbs.val-r.tpAbs.span)+(o.S.tpAbs.has?(o.S.tpAbs.val-o.S.tpAbs.span)*o.S.tpAbs.inExtFrac:0)+(o.E.tpAbs.has?(o.E.tpAbs.val-o.E.tpAbs.span)*o.E.tpAbs.inExtFrac:0)-r.tpPrct.span-(o.S.tpPrct.has?o.S.tpPrct.span*o.S.tpPrct.inExtFrac:0)-(o.E.tpPrct.has?o.E.tpPrct.span*o.E.tpPrct.inExtFrac:0))/(1-r.tpPrct.val-(o.S.tpPrct.has?o.S.tpPrct.val*o.S.tpPrct.inExtFrac:0)-(o.E.tpPrct.has?o.E.tpPrct.val*o.E.tpPrct.inExtFrac:0));gt(i.breaks,function(a){var u=a.gapParsed;u.type==="tpPrct"&&(a.gapReal=e!==0?Math.max(s,0)*u.val/e:0),u.type==="tpAbs"&&(a.gapReal=u.val),a.gapReal==null&&(a.gapReal=0)})}function A5t(i,t,e,r,n,o){i!=="no"&&gt(e,function(s){var a=ON(s,o);if(a)for(var u=t.length-1;u>=0;u--){var f=t[u],g=r(f),v=n*3/4;g>a.vmin-v&&g<a.vmax+v&&(i!=="preserve_extent_bound"||g!==o[0]&&g!==o[1])&&t.splice(u,1)}})}function I5t(i,t,e,r){gt(t,function(n){var o=ON(n,e);o&&(i.push({value:o.vmin,break:{type:"vmin",parsedBreak:o},time:r?r(o):void 0}),i.push({value:o.vmax,break:{type:"vmax",parsedBreak:o},time:r?r(o):void 0}))}),t.length&&i.sort(function(n,o){return n.value-o.value})}function ON(i,t){var e=Math.max(i.vmin,t[0]),r=Math.min(i.vmax,t[1]);return e<r||e===r&&e>t[0]&&e<t[1]?{vmin:e,vmax:r,breakOption:i.breakOption,gapParsed:i.gapParsed,gapReal:i.gapReal}:null}function MB(i,t,e){var r=[];if(!i)return{breaks:r};function n(s,a){return s>=0&&s<1-1e-5}gt(i,function(s){if(!(!s||s.start==null||s.end==null)&&!s.isExpanded){var a={breakOption:Yi(s),vmin:t(s.start),vmax:t(s.end),gapParsed:{type:"tpAbs",val:0},gapReal:null};if(s.gap!=null){var u=!1;if(bi(s.gap)){var f=Ec(s.gap);if(f.match(/%$/)){var g=parseFloat(f)/100;n(g)||(g=0),a.gapParsed.type="tpPrct",a.gapParsed.val=g,u=!0}}if(!u){var v=t(s.gap);(!isFinite(v)||v<0)&&(v=0),a.gapParsed.type="tpAbs",a.gapParsed.val=v}}if(a.vmin===a.vmax&&(a.gapParsed.type="tpAbs",a.gapParsed.val=0),e&&e.noNegative&&gt(["vmin","vmax"],function(w){a[w]<0&&(a[w]=0)}),a.vmin>a.vmax){var y=a.vmax;a.vmax=a.vmin,a.vmin=y}r.push(a)}}),r.sort(function(s,a){return s.vmin-a.vmin});var o=-1/0;return gt(r,function(s,a){o>s.vmin&&(r[a]=null),o=s.vmax}),{breaks:r.filter(function(s){return!!s})}}function zN(i,t){return CB(t)===CB(i)}function CB(i){return i.start+"_\0_"+i.end}function M5t(i,t,e){var r=[];gt(i,function(o,s){var a=t(o);a&&a.type==="vmin"&&r.push([s])}),gt(i,function(o,s){var a=t(o);if(a&&a.type==="vmax"){var u=bv(r,function(f){return zN(t(i[f[0]]).parsedBreak.breakOption,a.parsedBreak.breakOption)});u&&u.push(s)}});var n=[];return gt(r,function(o){o.length===2&&n.push(e?o:[i[o[0]],i[o[1]]])}),n}function C5t(i,t,e,r){var n,o;if(i.break){var s=i.break.parsedBreak,a=bv(e,function(v){return zN(v.breakOption,i.break.parsedBreak.breakOption)}),u=r(Math.pow(t,s.vmin),a.vmin),f=r(Math.pow(t,s.vmax),a.vmax),g={type:s.gapParsed.type,val:s.gapParsed.type==="tpAbs"?vo(Math.pow(t,s.vmin+s.gapParsed.val))-u:s.gapParsed.val};n={type:i.break.type,parsedBreak:{breakOption:s.breakOption,vmin:u,vmax:f,gapParsed:g,gapReal:s.gapReal}},o=a[i.break.type]}return{brkRoundingCriterion:o,vBreak:n}}function E5t(i,t,e){var r={noNegative:!0},n=MB(i,e,r),o=MB(i,e,r),s=Math.log(t);return o.breaks=ti(o.breaks,function(a){var u=Math.log(a.vmin)/s,f=Math.log(a.vmax)/s,g={type:a.gapParsed.type,val:a.gapParsed.type==="tpAbs"?Math.log(a.vmin+a.gapParsed.val)/s-u:a.gapParsed.val};return{vmin:u,vmax:f,gapParsed:g,gapReal:a.gapReal,breakOption:a.breakOption}}),{parsedOriginal:n,parsedLogged:o}}var D5t={vmin:"start",vmax:"end"};function P5t(i,t){return t&&(i=i||{},i.break={type:D5t[t.type],start:t.parsedBreak.vmin,end:t.parsedBreak.vmax}),i}function L5t(){i1t({createScaleBreakContext:S5t,pruneTicksByBreak:A5t,addBreaksToTicks:I5t,parseAxisBreakOption:MB,identifyAxisBreak:zN,serializeAxisBreakIdentifier:CB,retrieveAxisBreakPairs:M5t,getTicksLogTransformBreak:C5t,logarithmicParseBreaksFromOption:E5t,makeAxisLabelFormatterParamBreak:P5t})}var z7=Wr();function R5t(i,t){var e=bv(i,function(r){return _o().identifyAxisBreak(r.parsedBreak.breakOption,t.breakOption)});return e||i.push(e={zigzagRandomList:[],parsedBreak:t,shouldRemove:!1}),e}function k5t(i){gt(i,function(t){return t.shouldRemove=!0})}function O5t(i){for(var t=i.length-1;t>=0;t--)i[t].shouldRemove&&i.splice(t,1)}function z5t(i,t,e,r,n){var o=e.axis;if(o.scale.isBlank()||!_o())return;var s=_o().retrieveAxisBreakPairs(o.scale.getTicks({breakTicks:"only_break"}),function(rt){return rt.break},!1);if(!s.length)return;var a=e.getModel("breakArea"),u=a.get("zigzagAmplitude"),f=a.get("zigzagMinSpan"),g=a.get("zigzagMaxSpan");f=Math.max(2,f||0),g=Math.max(f,g||0);var v=a.get("expandOnClick"),y=a.get("zigzagZ"),w=a.getModel("itemStyle"),I=w.getItemStyle(),E=I.stroke,D=I.lineWidth,R=I.lineDash,z=I.fill,N=new Ki({ignoreModelZ:!0}),H=o.isHorizontal(),$=z7(t).visualList||(z7(t).visualList=[]);k5t($);for(var X=function(rt){var lt=s[rt][0].break.parsedBreak,ht=[];ht[0]=o.toGlobalCoord(o.dataToCoord(lt.vmin,!0)),ht[1]=o.toGlobalCoord(o.dataToCoord(lt.vmax,!0)),ht[1]<ht[0]&&ht.reverse();var yt=R5t($,lt);yt.shouldRemove=!1;var ft=new Ki;et(yt.zigzagRandomList,ft,ht[0],ht[1],H,lt),v&&ft.on("click",function(){var kt={type:IE,breaks:[{start:lt.breakOption.start,end:lt.breakOption.end}]};kt[o.dim+"AxisIndex"]=e.componentIndex,n.dispatchAction(kt)}),ft.silent=!v,N.add(ft)},K=0;K<s.length;K++)X(K);i.add(N),O5t($);function et(rt,lt,ht,yt,ft,kt){var Rt={stroke:E,lineWidth:D,lineDash:R,fill:"none"},Ct=ft?0:1,Gt=1-Ct,Vt=r[vr[Gt]]+r[yo[Gt]];function Qt(zt){var Zt=[],pe=[];Zt[Ct]=pe[Ct]=zt,Zt[Gt]=r[vr[Gt]],pe[Gt]=Vt;var $e={x1:Zt[0],y1:Zt[1],x2:pe[0],y2:pe[1]};return sE($e,$e,{lineWidth:1}),Zt[0]=$e.x1,Zt[1]=$e.y1,Zt[Ct]}ht=Qt(ht),yt=Qt(yt);for(var fe=[],Te=[],be=!0,Ge=r[vr[Gt]],li=0;;li++){var Pi=Ge===r[vr[Gt]],or=Ge>=Vt;or&&(Ge=Vt);var Ve=[],Ze=[];Ve[Ct]=ht,Ze[Ct]=yt,!Pi&&!or&&(Ve[Ct]+=be?-u:u,Ze[Ct]-=be?u:-u),Ve[Gt]=Ge,Ze[Gt]=Ge,fe.push(Ve),Te.push(Ze);var ye=void 0;if(li<rt.length?ye=rt[li]:(ye=Math.random(),rt.push(ye)),Ge+=ye*(g-f)+f,be=!be,or)break}var Ke=_o().serializeAxisBreakIdentifier(kt.breakOption);if(lt.add(new Us({anid:"break_a_"+Ke,shape:{points:fe},style:Rt,z:y})),kt.gapReal!==0){lt.add(new Us({anid:"break_b_"+Ke,shape:{points:Te},style:Rt,z:y}));var We=Te.slice();We.reverse();var Si=fe.concat(We);lt.add(new gl({anid:"break_c_"+Ke,shape:{points:Si},style:{fill:z,opacity:I.opacity},z:y}))}}}function B5t(i,t,e,r){var n=i.axis,o=e.transform;Vs(r.style);var s=n.getExtent();n.inverse&&(s=s.slice(),s.reverse());var a=_o().retrieveAxisBreakPairs(n.scale.getTicks({breakTicks:"only_break"}),function(D){return D.break},!1),u=ti(a,function(D){var R=D[0].break.parsedBreak,z=[n.dataToCoord(R.vmin,!0),n.dataToCoord(R.vmax,!0)];return z[0]>z[1]&&z.reverse(),{coordPair:z,brkId:_o().serializeAxisBreakIdentifier(R.breakOption)}});u.sort(function(D,R){return D.coordPair[0]-R.coordPair[0]});for(var f=s[0],g=null,v=0;v<u.length;v++){var y=u[v],w=Math.max(y.coordPair[0],s[0]),I=Math.min(y.coordPair[1],s[1]);f<=w&&E(f,w,g,y),f=I,g=y}f<=s[1]&&E(f,s[1],g,null);function E(D,R,z,N){function H(ht,yt){o&&(ho(ht,ht,o),ho(yt,yt,o))}function $(ht,yt){var ft={x1:ht[0],y1:ht[1],x2:yt[0],y2:yt[1]};sE(ft,ft,r.style),ht[0]=ft.x1,ht[1]=ft.y1,yt[0]=ft.x2,yt[1]=ft.y2}var X=[D,0],K=[R,0],et=[D,5],rt=[R,5];H(X,et),$(X,et),H(K,rt),$(K,rt),$(X,K);var lt=new Ro(Fe({shape:{x1:X[0],y1:X[1],x2:K[0],y2:K[1]}},r));t.add(lt),lt.anid="breakLine_"+(z?z.brkId:"\0")+"_\0_"+(N?N.brkId:"\0")}}function F5t(i,t,e){if(bv(e,function(z){return!z}))return;var r=new er;if(!TE(e[0],e[1],r,{direction:-(i?t+Math.PI:t),touchThreshold:0,bidirectional:!1}))return;var n=ns();Up(n,n,-t);var o=ti(e,function(z){return z.transform?fh(ns(),n,z.transform):n});function s(z){var N=e[0].localRect,H=new er(N[yo[z]]*o[0][0],N[yo[z]]*o[0][1]);return Math.abs(H.y)<1e-5}var a=.5;if(s(0)||s(1)){var u=ti(e,function(z,N){var H=z.localRect.clone();return H.applyTransform(o[N]),H}),f=new er;f.copy(e[0].label).add(e[1].label).scale(.5),f.transform(n);var g=r.clone().transform(n),v=u[0].x+u[1].x+(g.x>=0?u[0].width:u[1].width),y=(v+g.x)/2-f.x,w=Math.min(y,y-g.x),I=Math.max(y,y-g.x),E=I<0?I:w>0?w:0;a=(y-E)/g.x}var D=new er,R=new er;er.scale(D,r,-a),er.scale(R,r,1-a),Pz(e[0],D),Pz(e[1],R)}function N5t(i,t){var e={breaks:[]};return gt(t.breaks,function(r){if(r){var n=bv(i.get("breaks",!0),function(a){return _o().identifyAxisBreak(a,r)});if(n){var o=t.type,s={isExpanded:!!n.isExpanded};n.isExpanded=o===IE?!0:o===cet?!1:o===uet?!n.isExpanded:n.isExpanded,e.breaks.push({start:n.start,end:n.end,isExpanded:!!n.isExpanded,old:s})}}}),e}function V5t(){qAt({adjustBreakLabelPair:F5t,buildAxisBreakLine:B5t,rectCoordBuildBreakAxis:z5t,updateModelAxisBreak:N5t})}function U5t(i){iIt(i),L5t(),V5t()}function G5t(){SIt(H5t)}function H5t(i,t){gt(i,function(e){if(!e.model.get(["axisLabel","inside"])){var r=j5t(e);if(r){var n=e.isHorizontal()?"height":"width",o=e.model.get(["axisLabel","margin"]);t[n]-=r[n]+o,e.position==="top"?t.y+=r.height+o:e.position==="left"&&(t.x+=r.width+o)}}})}function j5t(i){var t=i.model,e=i.scale;if(!t.get(["axisLabel","show"])||e.isBlank())return;var r,n,o=e.getExtent();e instanceof dS?n=e.count():(r=e.getTicks(),n=r.length);var s=i.getLabelModel(),a=q0(i),u,f=1;n>40&&(f=Math.ceil(n/40));for(var g=0;g<n;g+=f){var v=r?r[g]:{value:o[0]+g},y=a(v,g),w=s.getTextRect(y),I=E(w,s.get("rotate")||0);u?u.union(I):u=I}return u;function E(D,R){var z=R*Math.PI/180,N=D.width,H=D.height,$=N*Math.abs(Math.cos(z))+Math.abs(H*Math.sin(z)),X=N*Math.abs(Math.sin(z))+Math.abs(H*Math.cos(z)),K=new sr(D.x,D.y,$,X);return K}}Rr([L2t]);Rr([A2t]);Rr([iAt,xAt,RAt,jIt,sMt,nCt,kCt,xEt,ZEt,rDt,dDt,wDt,APt,KPt,uLt,DLt,BLt,eRt,hRt,TRt,LRt,WRt,Pkt]);Rr(tOt);Rr(ROt);Rr(Fet);Rr(XOt);Rr(Ait);Rr(izt);Rr(Azt);Rr(kzt);Rr(kBt);Rr(rFt);Rr(XS);Rr(wFt);Rr(AFt);Rr(VFt);Rr(KFt);Rr(a3t);Rr(f3t);Rr(M3t);Rr(Y3t);Rr(Rrt);Rr(krt);Rr(SNt);Rr(Nrt);Rr(Vrt);Rr(MNt);Rr(LNt);Rr(WNt);Rr(qNt);Rr(b5t);Rr(HTt);Rr(U5t);Rr(G5t);Rr(WIt);Uy.accessToken="pk.eyJ1IjoieG1zMTIxMzgiLCJhIjoiY21oaWw5cnRoMDIyazJpc2Q4azF3ZW81eCJ9.p5vgHrhM1hR6Bvl-vjmO7A";const B7="/casa0017-web-assessment-EcoVision/",Am="london-boroughs",Fy="borough-fill",F7="borough-border-glow",N7="london-outer-glow",V7="borough-labels",_I="busiest-streets",U7="busiest-streets-line",W5t=0,$5t="http://10.129.111.25:3000",yI=i=>{const t=i.toLowerCase().trim();return t==="city of london"?"city of london":t.replace(/london borough of /g,"").replace(/royal borough of /g,"").replace(/city of /g,"").replace(/&/g,"and").replace(/\./g,"").replace(/\s+/g," ").trim()},Z5t=(i,t)=>{const e=I=>I*Math.PI/180,r=I=>I*180/Math.PI,[n,o]=i,[s,a]=t,u=e(o),f=e(a),g=e(s-n),v=Math.sin(g)*Math.cos(f),y=Math.cos(u)*Math.sin(f)-Math.sin(u)*Math.cos(f)*Math.cos(g),w=Math.atan2(v,y);return(r(w)+360)%360},q5t={components:{MapLegend:jht,TimeSlider:wvt},setup(){const i=Po(null),t=Po(W5t);let e=null,r=null,n=null,o=null,s=null,a=null,u=null;const f=Po(!1),g=Po(null);let v=null;const y=()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"auto"}),typeof document<"u"&&(document.documentElement&&(document.documentElement.scrollTop=0,document.documentElement.scrollLeft=0),document.body&&(document.body.scrollTop=0,document.body.scrollLeft=0))},w=async $=>{if(!n)return;const X=new Set;n.features.forEach(et=>{const rt=et.properties.NAME||et.properties.BOROUGH||et.properties.LAD13NM||et.properties.name;if(!rt)return;const lt=yI(rt);lt&&X.add(lt)});const K=await Promise.all(Array.from(X).map(async et=>{const rt=`${et}_${$}`,lt=`${$5t}/api/hourly?borough=${encodeURIComponent(rt)}`;try{const ht=await fetch(lt);if(!ht.ok)return console.warn(`Failed to fetch data for ${et}: ${ht.status}`),null;const yt=await ht.json();return{normName:et,pm25:yt.pm25_g_per_h,co:yt.co_g_per_h,co2:yt.co2_kg_per_h,vehicles:yt.vehicles_per_hour}}catch(ht){return console.error("Error fetching data for",et,ht),null}}));r=new Map,K.forEach(et=>{et&&r.set(et.normName,{pm25:et.pm25,co:et.co,co2:et.co2,vehicles:et.vehicles})})},I=()=>!n||!r?null:{type:"FeatureCollection",features:n.features.map($=>{const X=$.properties.NAME||$.properties.BOROUGH||$.properties.LAD13NM||$.properties.name,K=X?yI(X):null,et=K?r.get(K)||{}:{},rt=et.pm25??null,lt=et.co??null,ht=et.co2??null,yt=et.vehicles??null;return{...$,properties:{...$.properties,BoroughName:X||K||"Unknown",NormName:K||"",pm25:rt,co:lt,co2:ht,vehicles:yt}}})},E=async()=>{try{if(!n){const K=await fetch(`${B7}london_boroughs.geojson`);if(!K.ok){console.error("Failed to load london_boroughs.geojson:",K.status);return}n=await K.json()}await w(t.value);const $=I();if(!$){console.error("No styledGeojson generated");return}e.getSource(Am)?e.getSource(Am).setData($):e.addSource(Am,{type:"geojson",data:$}),e.getLayer(Fy)||e.addLayer({id:Fy,type:"fill",source:Am,paint:{"fill-color":["interpolate",["linear"],["get","pm25"],0,"#22c55e",200,"#84cc16",260,"#eab308",340,"#f97316",430,"#ef4444",550,"#7f1d1d"],"fill-opacity":.78}}),e.getLayer(N7)||e.addLayer({id:N7,type:"line",source:Am,paint:{"line-color":"#a855f7","line-width":6,"line-opacity":.22}}),e.getLayer(F7)||e.addLayer({id:F7,type:"line",source:Am,paint:{"line-color":"#ffffff","line-width":1.2,"line-opacity":.9}}),e.getLayer(V7)||e.addLayer({id:V7,type:"symbol",source:Am,layout:{"text-field":["coalesce",["get","NAME"],["get","BOROUGH"],["get","LAD13NM"],["get","name"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":11,"text-anchor":"center","text-allow-overlap":!1},paint:{"text-color":"#ffffff","text-halo-color":"rgba(10,10,15,0.9)","text-halo-width":1.4}});const X=new Uy.LngLatBounds;$.features.forEach(K=>{const et=K.geometry;(et.type==="Polygon"?et.coordinates.flat():et.coordinates.flat(2)).forEach(([lt,ht])=>X.extend([lt,ht]))}),v=X,e.fitBounds(X,{padding:40,maxZoom:9.2}),e.on("mouseenter",Fy,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",()=>{e.getCanvas().style.cursor=""}),e.on("click",Fy,K=>{if(!K.features||!K.features.length)return;const rt=K.features[0].properties||{},lt=rt.BoroughName||rt.NAME||rt.BOROUGH||rt.LAD13NM||rt.name||"Unknown borough",ht=yI(lt),yt=r&&r.get(ht)||{},ft=rt.pm25!==void 0&&rt.pm25!==null?Number(rt.pm25):yt.pm25??null,kt=rt.co!==void 0&&rt.co!==null?Number(rt.co):yt.co??null,Rt=rt.co2!==void 0&&rt.co2!==null?Number(rt.co2):yt.co2??null,Ct=rt.vehicles!==void 0&&rt.vehicles!==null?Number(rt.vehicles):yt.vehicles??null;o&&(o.remove(),o=null),s&&(s.unmount(),s=null);const Gt=!!a&&!!a.get(ht),Vt=document.createElement("div");s=q9(gvt,{name:lt,hour:t.value,pm25:ft,co:kt,co2:Rt,vehicles:Ct,hasBusiestStreet:Gt,onViewStreet:()=>{o&&(o.remove(),o=null),s&&(s.unmount(),s=null),R(ht)}}),s.mount(Vt),o=new Uy.Popup({closeButton:!0,closeOnClick:!1,offset:16}).setLngLat(K.lngLat).setDOMContent(Vt).addTo(e),o.on("close",()=>{s&&(s.unmount(),s=null),o=null,e&&e.getLayer(Fy)&&!f.value&&(e.setPaintProperty(Fy,"fill-opacity",.78),u=null)})})}catch($){console.error("Failed to load map or backend data",$)}},D=async()=>{if(e)try{const $=await fetch(`${B7}busiest_streets.geojson`);if(!$.ok){console.warn("busiest_streets.geojson not found or failed to load:",$.status);return}const X=await $.json();a=new Map,(X.features||[]).forEach(K=>{const et=K.properties||{},rt=K.geometry;if(!rt)return;const lt=et.borough||et.BoroughName||et.borough_name||"",ht=yI(lt);if(!ht)return;let yt=null;if(rt.type==="LineString"?yt=rt.coordinates:rt.type==="MultiLineString"&&(yt=rt.coordinates.flat()),!yt||yt.length<2)return;const ft=yt.reduce((Ct,Gt)=>Ct.extend(Gt),new Uy.LngLatBounds(yt[0],yt[0])),kt=ft.getCenter(),Rt=Z5t(yt[0],yt[yt.length-1]);a.set(ht,{center:[kt.lng,kt.lat],bearing:Rt,bounds:ft,coords:yt})}),e.getSource(_I)?e.getSource(_I).setData(X):e.addSource(_I,{type:"geojson",data:X}),e.getLayer(U7)||e.addLayer({id:U7,type:"line",source:_I,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ff3b30","line-width":6,"line-opacity":.95,"line-blur":1.2}})}catch($){console.error("Error adding busiest streets layer",$)}},R=async $=>{},z=async $=>{},N=()=>{},H=()=>{e||!i.value||(e=new Uy.Map({container:i.value,style:"mapbox://styles/mapbox/standard",center:[-.1276,51.5072],zoom:9,maxBounds:[[-.6,51.2],[.4,51.8]]}),e.addControl(new Uy.NavigationControl,"top-right"),e.on("load",async()=>{await E(),await D()}))};return k0(()=>{y(),H()}),OC(()=>{y()}),BC(()=>{o&&(o.remove(),o=null),s&&(s.unmount(),s=null),e&&(e.remove(),e=null),f.value=!1,g.value=null,u=null}),{mapContainer:i,activeHour:t,onHourChange:z,isStreetViewActive:f,exitStreetView:N}}},X5t={class:"map-page"},Y5t={class:"nav-links"},K5t={class:"main-container"},J5t={class:"map-container-wrapper"},Q5t={ref:"mapContainer",class:"map-container"},tVt={class:"map-info"},eVt={class:"cta-container"};function iVt(i,t,e,r,n,o){const s=Km("router-link"),a=Km("TimeSlider"),u=Km("MapLegend");return Wo(),ms("div",X5t,[ve("nav",null,[t[5]||(t[5]=ve("div",{class:"logo"},"ECOVISION",-1)),ve("ul",Y5t,[ve("li",null,[qn(s,{to:"/"},{default:jo(()=>[...t[1]||(t[1]=[Gn("HOME",-1)])]),_:1})]),ve("li",null,[qn(s,{to:"/page2"},{default:jo(()=>[...t[2]||(t[2]=[Gn("ABOUT",-1)])]),_:1})]),ve("li",null,[qn(s,{to:"/map",class:"active"},{default:jo(()=>[...t[3]||(t[3]=[Gn("MAP",-1)])]),_:1})]),ve("li",null,[qn(s,{to:"/page4"},{default:jo(()=>[...t[4]||(t[4]=[Gn("TEAM",-1)])]),_:1})])])]),ve("div",K5t,[t[8]||(t[8]=ve("div",{class:"page-header"},[ve("h1",{class:"page-title"},"Interactive London Map"),ve("p",{class:"page-subtitle"}," Real-time air quality visualization across 33 boroughs ")],-1)),ve("div",J5t,[qn(a,{"model-value":r.activeHour,"onUpdate:modelValue":r.onHourChange},null,8,["model-value","onUpdate:modelValue"]),r.isStreetViewActive?(Wo(),ms("button",{key:0,class:"map-back-btn",onClick:t[0]||(t[0]=(...f)=>r.exitStreetView&&r.exitStreetView(...f))},"  BACK TO OVERVIEW ")):dM("",!0),ve("div",Q5t,null,512),qn(u)]),ve("div",tVt,[t[7]||(t[7]=Kf('<div class="info-grid"><div class="info-card"><h3>Historical Data</h3><p> Access previous month&#39;s air quality data to identify patterns and trends across London boroughs. </p></div><div class="info-card"><h3>Interactive Features</h3><p> Zoom, pan, and click on boroughs to see detailed air quality metrics and pollution sources. </p></div><div class="info-card"><h3>Time Slider</h3><p> Navigate through 24 hours of data to understand how air quality changes throughout the day. </p></div><div class="info-card"><h3>Data Sources</h3><p> Powered by the London Air Quality Network and TfL open datasets for accurate, reliable information. </p></div></div>',1)),ve("div",eVt,[qn(s,{to:"/page4",class:"pixel-button"},{default:jo(()=>[...t[6]||(t[6]=[Gn(" Support Our Research ",-1)])]),_:1})])])])])}const rVt=Np(q5t,[["render",iVt]]);const nVt={class:"team-page"},aVt={class:"nav-links"},oVt={class:"modal-content"},sVt={class:"modal-buttons"},lVt={class:"content"},cVt={class:"section survey-section"},uVt={class:"survey-container"},hVt={class:"form-group"},dVt={class:"form-group"},fVt={class:"form-group"},pVt={class:"form-group"},gVt={class:"checkbox-group"},mVt={class:"checkbox-item"},vVt={class:"checkbox-item"},_Vt={class:"checkbox-item"},yVt={class:"checkbox-item"},xVt={class:"checkbox-item"},bVt={class:"checkbox-item"},wVt={class:"form-group"},SVt={class:"form-group"},TVt={class:"comments-header"},AVt={class:"comments-title"},IVt={class:"mode-indicator"},MVt={key:0,class:"no-comments"},CVt={class:"comment-header"},EVt={class:"comment-author"},DVt={class:"comment-date"},PVt={class:"comment-meta"},LVt=["onClick"],RVt={class:"comment-text"},kVt={__name:"Page4",setup(i){const t=()=>{window.scrollTo(0,0),document.body.scrollTop=0,document.documentElement.scrollTop=0;const E=document.getElementById("app");E&&(E.scrollTop=0)};k0(()=>{t()}),OC(()=>{t()});const e=MS({q1:"",q2:"",q3:"",barriers:[],q5:"",comments:""}),r=Po([]),n=Po(!1),o=Po(!1),s=Po(""),a=Po(!1),u=Po(""),f=Yl(()=>({background:n.value?"#10b981":"#888",color:"#fff",padding:"0.5rem 1rem",borderRadius:"4px",fontSize:"0.7rem",fontFamily:"'Press Start 2P', cursive"})),g=E=>new Date(E).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const E={id:Date.now(),date:new Date().toISOString(),q1:e.q1,q2:e.q2,q3:e.q3,barriers:e.barriers.join(", ")||"None selected",q5:e.q5,comments:e.comments};r.value.unshift(E),Object.assign(e,{q1:"",q2:"",q3:"",barriers:[],q5:"",comments:""}),u.value="FEEDBACK SUBMITTED!",a.value=!0,setTimeout(()=>{a.value=!1},3e3),setTimeout(()=>{document.querySelector(".comments-section").scrollIntoView({behavior:"smooth",block:"start"})},500)},y=()=>{n.value?n.value=!1:o.value=!0},w=()=>{s.value==="ecovision2024"?(n.value=!0,o.value=!1,s.value="",u.value="ADMIN MODE ACTIVATED",a.value=!0,setTimeout(()=>{a.value=!1},2e3)):alert("Incorrect password")},I=E=>{n.value&&confirm("Delete this response?")&&(r.value.splice(E,1),u.value="RESPONSE DELETED",a.value=!0,setTimeout(()=>{a.value=!1},2e3))};return(E,D)=>{const R=Km("router-link");return Wo(),ms("div",nVt,[ve("nav",null,[D[17]||(D[17]=ve("div",{class:"logo"},"ECOVISION",-1)),ve("ul",aVt,[ve("li",null,[qn(R,{to:"/"},{default:jo(()=>[...D[13]||(D[13]=[Gn("HOME",-1)])]),_:1})]),ve("li",null,[qn(R,{to:"/page2"},{default:jo(()=>[...D[14]||(D[14]=[Gn("ABOUT",-1)])]),_:1})]),ve("li",null,[qn(R,{to:"/map"},{default:jo(()=>[...D[15]||(D[15]=[Gn("MAP",-1)])]),_:1})]),ve("li",null,[qn(R,{to:"/page4",class:"active"},{default:jo(()=>[...D[16]||(D[16]=[Gn("TEAM",-1)])]),_:1})])])]),ve("div",{class:gd(["success-message",{show:a.value}])},Ta(u.value),3),ve("div",{class:gd(["modal",{active:o.value}])},[ve("div",oVt,[D[18]||(D[18]=ve("h3",{class:"modal-title"},"ADMIN LOGIN",-1)),D[19]||(D[19]=ve("p",{style:{color:"#888","font-size":"0.9rem","margin-bottom":"1rem"}}," Enter password to access admin mode ",-1)),gc(ve("input",{type:"password",class:"modal-input","onUpdate:modelValue":D[0]||(D[0]=z=>s.value=z),onKeyup:Yct(w,["enter"]),placeholder:"Enter admin password"},null,544),[[hG,s.value]]),ve("div",sVt,[ve("button",{class:"modal-btn cancel",onClick:D[1]||(D[1]=z=>o.value=!1)}," CANCEL "),ve("button",{class:"modal-btn confirm",onClick:w},"LOGIN")])])],2),ve("div",lVt,[D[51]||(D[51]=Kf('<div class="hero" data-v-2425c5e3><h1 class="title" data-v-2425c5e3>OUR TEAM</h1><p class="subtitle" data-v-2425c5e3>Making a Difference Through Data and Action</p></div><div class="section team-intro-section" data-v-2425c5e3><div class="box" data-v-2425c5e3><h2 data-v-2425c5e3>Meet Our Team Members</h2><p data-v-2425c5e3> Our dedicated team brings together expertise in data science, design, development, and research to create EcoVision London. </p><div class="team-members-grid" data-v-2425c5e3><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Madina Diallo</h3><p class="member-title" data-v-2425c5e3>Project &amp; Data Integration Lead</p><p class="member-description" data-v-2425c5e3> Leading project coordination and managing data integration from multiple London air quality and transport sources. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Matilda Nelson</h3><p class="member-title" data-v-2425c5e3>Research &amp; Web Content Lead</p><p class="member-description" data-v-2425c5e3> Conducting research on London&#39;s air quality challenges and developing user-focused content strategies. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Vidan Gao</h3><p class="member-title" data-v-2425c5e3>Design &amp; Visualisation Lead</p><p class="member-description" data-v-2425c5e3> Creating intuitive visual designs and interactive data visualizations for the London borough mapping system. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Zihang He</h3><p class="member-title" data-v-2425c5e3>Technical &amp; Web Development Lead</p><p class="member-description" data-v-2425c5e3> Developing the technical infrastructure and web platform for real-time air quality data visualization. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Qingshan Luo</h3><p class="member-title" data-v-2425c5e3>Testing &amp; Editing Lead</p><p class="member-description" data-v-2425c5e3> Ensuring quality assurance, user testing, and content editing for optimal user experience and accuracy. </p></div></div></div></div><div class="section" data-v-2425c5e3><div class="box" data-v-2425c5e3><h2 data-v-2425c5e3>Our Team Structure</h2><p data-v-2425c5e3> Our diverse team of experts combines environmental science, data analytics, and community engagement to create meaningful change. </p><div class="team-grid" data-v-2425c5e3><div class="team-member" data-v-2425c5e3><div class="member-role" data-v-2425c5e3></div><h3 data-v-2425c5e3>Research Team</h3><p data-v-2425c5e3>Environmental scientists and data analysts</p></div><div class="team-member" data-v-2425c5e3><div class="member-role" data-v-2425c5e3></div><h3 data-v-2425c5e3>Tech Team</h3><p data-v-2425c5e3>Software engineers and UX designers</p></div><div class="team-member" data-v-2425c5e3><div class="member-role" data-v-2425c5e3></div><h3 data-v-2425c5e3>Community Team</h3><p data-v-2425c5e3>Outreach coordinators and educators</p></div></div></div></div><div class="section" data-v-2425c5e3><div class="box" data-v-2425c5e3><h2 data-v-2425c5e3>Community Impact</h2><p data-v-2425c5e3> EcoVision empowers Londoners to make informed decisions about their transport choices, contributing to a cleaner, healthier city for everyone. </p><div class="impact-stats" data-v-2425c5e3><div class="impact-card" data-v-2425c5e3><div class="impact-icon" data-v-2425c5e3></div><div class="impact-value" data-v-2425c5e3>10,000+</div><div class="impact-label" data-v-2425c5e3>Active Users</div></div><div class="impact-card" data-v-2425c5e3><div class="impact-icon" data-v-2425c5e3></div><div class="impact-value" data-v-2425c5e3>25%</div><div class="impact-label" data-v-2425c5e3>Increase in Cycling</div></div><div class="impact-card" data-v-2425c5e3><div class="impact-icon" data-v-2425c5e3></div><div class="impact-value" data-v-2425c5e3>30T</div><div class="impact-label" data-v-2425c5e3>CO Reduced (Annual)</div></div></div></div></div>',4)),ve("div",cVt,[ve("div",uVt,[D[49]||(D[49]=ve("div",{class:"survey-header"},[ve("h1",{class:"survey-title"},"SUPPORT OUR RESEARCH"),ve("p",{class:"survey-subtitle"}," Help us understand London's transport preferences. Your feedback will inform policy recommendations to reduce vehicle emissions and improve air quality. ")],-1)),ve("form",{class:"survey-form",onSubmit:qct(v,["prevent"])},[ve("div",hVt,[D[21]||(D[21]=ve("label",{class:"form-label"},"Do you prefer cycling over driving in London?",-1)),gc(ve("select",{class:"form-select","onUpdate:modelValue":D[2]||(D[2]=z=>e.q1=z),required:""},[...D[20]||(D[20]=[Kf('<option value="" data-v-2425c5e3>Select your preference</option><option value="Yes, always" data-v-2425c5e3>Yes, always prefer cycling</option><option value="Yes, mostly" data-v-2425c5e3>Yes, mostly prefer cycling</option><option value="Depends" data-v-2425c5e3>It depends on the situation</option><option value="No, mostly" data-v-2425c5e3>No, mostly prefer driving</option><option value="No, always" data-v-2425c5e3>No, always prefer driving</option>',6)])],512),[[j2,e.q1]])]),ve("div",dVt,[D[23]||(D[23]=ve("label",{class:"form-label"},"How often do you cycle in London?",-1)),gc(ve("select",{class:"form-select","onUpdate:modelValue":D[3]||(D[3]=z=>e.q2=z),required:""},[...D[22]||(D[22]=[Kf('<option value="" data-v-2425c5e3>Select frequency</option><option value="Daily" data-v-2425c5e3>Daily</option><option value="Several times a week" data-v-2425c5e3> Several times a week </option><option value="Once a week" data-v-2425c5e3>Once a week</option><option value="Once a month" data-v-2425c5e3>Once a month</option><option value="Rarely" data-v-2425c5e3>Rarely</option><option value="Never" data-v-2425c5e3>Never</option>',7)])],512),[[j2,e.q2]])]),ve("div",fVt,[D[25]||(D[25]=ve("label",{class:"form-label"},"What's your main reason for your transport choice?",-1)),gc(ve("select",{class:"form-select","onUpdate:modelValue":D[4]||(D[4]=z=>e.q3=z),required:""},[...D[24]||(D[24]=[Kf('<option value="" data-v-2425c5e3>Select main reason</option><option value="Environmental concerns" data-v-2425c5e3> Environmental concerns </option><option value="Health and fitness" data-v-2425c5e3>Health and fitness</option><option value="Cost savings" data-v-2425c5e3>Cost savings</option><option value="Convenience" data-v-2425c5e3>Convenience</option><option value="Speed" data-v-2425c5e3>Speed</option><option value="Safety" data-v-2425c5e3>Safety</option><option value="No alternative" data-v-2425c5e3>No alternative available</option>',8)])],512),[[j2,e.q3]])]),ve("div",pVt,[D[32]||(D[32]=ve("label",{class:"form-label"},"What are the main barriers to cycling more in London? (Select all that apply)",-1)),ve("div",gVt,[ve("div",mVt,[gc(ve("input",{type:"checkbox",id:"b1",value:"Safety concerns with traffic","onUpdate:modelValue":D[5]||(D[5]=z=>e.barriers=z)},null,512),[[cy,e.barriers]]),D[26]||(D[26]=ve("label",{for:"b1"},"Safety concerns with traffic",-1))]),ve("div",vVt,[gc(ve("input",{type:"checkbox",id:"b2",value:"Weather conditions","onUpdate:modelValue":D[6]||(D[6]=z=>e.barriers=z)},null,512),[[cy,e.barriers]]),D[27]||(D[27]=ve("label",{for:"b2"},"Weather conditions",-1))]),ve("div",_Vt,[gc(ve("input",{type:"checkbox",id:"b3",value:"Poor cycling infrastructure","onUpdate:modelValue":D[7]||(D[7]=z=>e.barriers=z)},null,512),[[cy,e.barriers]]),D[28]||(D[28]=ve("label",{for:"b3"},"Poor cycling infrastructure",-1))]),ve("div",yVt,[gc(ve("input",{type:"checkbox",id:"b4",value:"Distance of journeys","onUpdate:modelValue":D[8]||(D[8]=z=>e.barriers=z)},null,512),[[cy,e.barriers]]),D[29]||(D[29]=ve("label",{for:"b4"},"Distance of journeys",-1))]),ve("div",xVt,[gc(ve("input",{type:"checkbox",id:"b5",value:"Bike storage issues","onUpdate:modelValue":D[9]||(D[9]=z=>e.barriers=z)},null,512),[[cy,e.barriers]]),D[30]||(D[30]=ve("label",{for:"b5"},"Bike storage issues",-1))]),ve("div",bVt,[gc(ve("input",{type:"checkbox",id:"b6",value:"Air quality concerns","onUpdate:modelValue":D[10]||(D[10]=z=>e.barriers=z)},null,512),[[cy,e.barriers]]),D[31]||(D[31]=ve("label",{for:"b6"},"Air quality concerns",-1))])])]),ve("div",wVt,[D[34]||(D[34]=ve("label",{class:"form-label"},"Which London borough do you live/work in most?",-1)),gc(ve("select",{class:"form-select","onUpdate:modelValue":D[11]||(D[11]=z=>e.q5=z),required:""},[...D[33]||(D[33]=[Kf('<option value="" data-v-2425c5e3>Select your borough</option><option value="City of London" data-v-2425c5e3>City of London</option><option value="Westminster" data-v-2425c5e3>Westminster</option><option value="Camden" data-v-2425c5e3>Camden</option><option value="Islington" data-v-2425c5e3>Islington</option><option value="Hackney" data-v-2425c5e3>Hackney</option><option value="Tower Hamlets" data-v-2425c5e3>Tower Hamlets</option><option value="Greenwich" data-v-2425c5e3>Greenwich</option><option value="Southwark" data-v-2425c5e3>Southwark</option><option value="Lambeth" data-v-2425c5e3>Lambeth</option><option value="Wandsworth" data-v-2425c5e3>Wandsworth</option><option value="Hammersmith and Fulham" data-v-2425c5e3> Hammersmith and Fulham </option><option value="Kensington and Chelsea" data-v-2425c5e3> Kensington and Chelsea </option><option value="Other" data-v-2425c5e3>Other borough</option>',14)])],512),[[j2,e.q5]])]),ve("div",SVt,[D[35]||(D[35]=ve("label",{class:"form-label"},"Additional comments or suggestions for improving London's transport and air quality:",-1)),gc(ve("textarea",{class:"form-textarea","onUpdate:modelValue":D[12]||(D[12]=z=>e.comments=z),placeholder:"Share your thoughts on how London can reduce vehicle emissions and improve cycling infrastructure..."},null,512),[[hG,e.comments]])]),D[36]||(D[36]=ve("button",{type:"submit",class:"submit-btn"},"Submit Feedback",-1)),D[37]||(D[37]=ve("div",{class:"form-footer"}," Your responses help inform policy recommendations for cleaner transport ",-1))],32),D[50]||(D[50]=Kf('<div class="help-text" data-v-2425c5e3><strong data-v-2425c5e3> Instructions:</strong><br data-v-2425c5e3>  After submitting, your feedback will be displayed in &quot;COMMUNITY RESPONSES&quot; section below<br data-v-2425c5e3>  <strong data-v-2425c5e3>User mode</strong>: View only, cannot delete<br data-v-2425c5e3>  <strong data-v-2425c5e3>Admin mode</strong>: Can delete inappropriate comments<br data-v-2425c5e3>  Click <strong data-v-2425c5e3>ADMIN MODE</strong> button to switch to admin<br data-v-2425c5e3>  Admin password: <strong data-v-2425c5e3>ecovision2024</strong></div>',1)),ve("div",{class:gd(["comments-section",{"admin-mode":n.value}])},[ve("div",TVt,[ve("h2",AVt," COMMUNITY RESPONSES ("+Ta(r.value.length)+") ",1),ve("div",IVt,[ve("span",{class:"role-badge",style:R0(f.value)},Ta(n.value?"ADMIN MODE":"USER MODE"),5),ve("button",{class:gd(["admin-btn",{active:n.value}]),onClick:y},Ta(n.value?"EXIT ADMIN":"ADMIN MODE"),3)])]),r.value.length===0?(Wo(),ms("div",MVt," No responses yet. Be the first to share your feedback! ")):dM("",!0),(Wo(!0),ms(Xl,null,jB(r.value,(z,N)=>(Wo(),ms("div",{key:z.id,class:"comment"},[ve("div",CVt,[ve("div",null,[ve("div",EVt," Response #"+Ta(r.value.length-N),1),ve("div",DVt,Ta(g(z.date)),1)]),ve("div",PVt,[ve("button",{class:"delete-btn",onClick:H=>I(N)}," DELETE ",8,LVt)])]),ve("div",RVt,[D[40]||(D[40]=ve("strong",null,"Preference:",-1)),Gn(" "+Ta(z.q1),1),D[41]||(D[41]=ve("br",null,null,-1)),D[42]||(D[42]=ve("strong",null,"Frequency:",-1)),Gn(" "+Ta(z.q2),1),D[43]||(D[43]=ve("br",null,null,-1)),D[44]||(D[44]=ve("strong",null,"Main reason:",-1)),Gn(" "+Ta(z.q3),1),D[45]||(D[45]=ve("br",null,null,-1)),D[46]||(D[46]=ve("strong",null,"Barriers:",-1)),Gn(" "+Ta(z.barriers),1),D[47]||(D[47]=ve("br",null,null,-1)),D[48]||(D[48]=ve("strong",null,"Borough:",-1)),Gn(" "+Ta(z.q5)+" ",1),z.comments?(Wo(),ms(Xl,{key:0},[D[38]||(D[38]=ve("br",null,null,-1)),D[39]||(D[39]=ve("strong",null,"Comments:",-1)),Gn(" "+Ta(z.comments),1)],64)):dM("",!0)])]))),128))],2)])])])])}}},OVt=Np(kVt,[["__scopeId","data-v-2425c5e3"]]),zVt=[{path:"/",name:"Home",component:Eht},{path:"/page2",name:"Page2",component:zht},{path:"/map",name:"Map",component:rVt},{path:"/page4",name:"Page4",component:OVt},{path:"/test",name:"Test",component:()=>out(()=>import("./Test-d6ef40e9.js"),["assets/Test-d6ef40e9.js","assets/Test-d6a6f5da.css"])}],BVt=fht({history:Wut("/casa0017-web-assessment-EcoVision/"),routes:zVt,scrollBehavior(i,t,e){return e||{left:0,top:0}}});q9(rut).use(BVt).mount("#app");export{Np as _,BC as a,Km as b,Wo as c,ms as d,ve as e,qn as f,Fht as g,Gn as h,Uy as m,k0 as o,Po as r,Ta as t,jo as w};
