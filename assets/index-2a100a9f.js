var Nst=Object.defineProperty;var Vst=(i,t,e)=>t in i?Nst(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Wi=(i,t,e)=>(Vst(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();/**
* @vue/shared v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function kB(i){const t=Object.create(null);for(const e of i.split(","))t[e]=1;return e=>e in t}const Aa={},i0=[],cc=()=>{},q7=()=>!1,PM=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),OB=i=>i.startsWith("onUpdate:"),os=Object.assign,zB=(i,t)=>{const e=i.indexOf(t);e>-1&&i.splice(e,1)},Ust=Object.prototype.hasOwnProperty,fa=(i,t)=>Ust.call(i,t),Hr=Array.isArray,r0=i=>MS(i)==="[object Map]",k0=i=>MS(i)==="[object Set]",VU=i=>MS(i)==="[object Date]",dn=i=>typeof i=="function",zo=i=>typeof i=="string",_h=i=>typeof i=="symbol",Ia=i=>i!==null&&typeof i=="object",X7=i=>(Ia(i)||dn(i))&&dn(i.then)&&dn(i.catch),Y7=Object.prototype.toString,MS=i=>Y7.call(i),Gst=i=>MS(i).slice(8,-1),K7=i=>MS(i)==="[object Object]",BB=i=>zo(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,cw=kB(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),LM=i=>{const t=Object.create(null);return e=>t[e]||(t[e]=i(e))},Hst=/-\w/g,ku=LM(i=>i.replace(Hst,t=>t.slice(1).toUpperCase())),jst=/\B([A-Z])/g,Gp=LM(i=>i.replace(jst,"-$1").toLowerCase()),RM=LM(i=>i.charAt(0).toUpperCase()+i.slice(1)),VP=LM(i=>i?`on${RM(i)}`:""),bp=(i,t)=>!Object.is(i,t),II=(i,...t)=>{for(let e=0;e<i.length;e++)i[e](...t)},J7=(i,t,e,r=!1)=>{Object.defineProperty(i,t,{configurable:!0,enumerable:!1,writable:r,value:e})},kM=i=>{const t=parseFloat(i);return isNaN(t)?i:t};let UU;const OM=()=>UU||(UU=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function O0(i){if(Hr(i)){const t={};for(let e=0;e<i.length;e++){const r=i[e],n=zo(r)?qst(r):O0(r);if(n)for(const o in n)t[o]=n[o]}return t}else if(zo(i)||Ia(i))return i}const Wst=/;(?![^(]*\))/g,$st=/:([^]+)/,Zst=/\/\*[^]*?\*\//g;function qst(i){const t={};return i.replace(Zst,"").split(Wst).forEach(e=>{if(e){const r=e.split($st);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t}function md(i){let t="";if(zo(i))t=i;else if(Hr(i))for(let e=0;e<i.length;e++){const r=md(i[e]);r&&(t+=r+" ")}else if(Ia(i))for(const e in i)i[e]&&(t+=e+" ");return t.trim()}const Xst="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Yst=kB(Xst);function Q7(i){return!!i||i===""}function Kst(i,t){if(i.length!==t.length)return!1;let e=!0;for(let r=0;e&&r<i.length;r++)e=ES(i[r],t[r]);return e}function ES(i,t){if(i===t)return!0;let e=VU(i),r=VU(t);if(e||r)return e&&r?i.getTime()===t.getTime():!1;if(e=_h(i),r=_h(t),e||r)return i===t;if(e=Hr(i),r=Hr(t),e||r)return e&&r?Kst(i,t):!1;if(e=Ia(i),r=Ia(t),e||r){if(!e||!r)return!1;const n=Object.keys(i).length,o=Object.keys(t).length;if(n!==o)return!1;for(const s in i){const a=i.hasOwnProperty(s),c=t.hasOwnProperty(s);if(a&&!c||!a&&c||!ES(i[s],t[s]))return!1}}return String(i)===String(t)}function FB(i,t){return i.findIndex(e=>ES(e,t))}const t9=i=>!!(i&&i.__v_isRef===!0),Hn=i=>zo(i)?i:i==null?"":Hr(i)||Ia(i)&&(i.toString===Y7||!dn(i.toString))?t9(i)?Hn(i.value):JSON.stringify(i,e9,2):String(i),e9=(i,t)=>t9(t)?e9(i,t.value):r0(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[r,n],o)=>(e[UP(r,o)+" =>"]=n,e),{})}:k0(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>UP(e))}:_h(t)?UP(t):Ia(t)&&!Hr(t)&&!K7(t)?String(t):t,UP=(i,t="")=>{var e;return _h(i)?`Symbol(${(e=i.description)!=null?e:t})`:i};/**
* @vue/reactivity v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Dl;class Jst{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Dl,!t&&Dl&&(this.index=(Dl.scopes||(Dl.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Dl;try{return Dl=this,t()}finally{Dl=e}}}on(){++this._on===1&&(this.prevScope=Dl,Dl=this)}off(){this._on>0&&--this._on===0&&(Dl=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let e,r;for(e=0,r=this.effects.length;e<r;e++)this.effects[e].stop();for(this.effects.length=0,e=0,r=this.cleanups.length;e<r;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,r=this.scopes.length;e<r;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0}}}function Qst(){return Dl}let Ra;const GP=new WeakSet;class i9{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Dl&&Dl.active&&Dl.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,GP.has(this)&&(GP.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||n9(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,GU(this),a9(this);const t=Ra,e=hc;Ra=this,hc=!0;try{return this.fn()}finally{o9(this),Ra=t,hc=e,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)UB(t);this.deps=this.depsTail=void 0,GU(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?GP.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Hk(this)&&this.run()}get dirty(){return Hk(this)}}let r9=0,hw,dw;function n9(i,t=!1){if(i.flags|=8,t){i.next=dw,dw=i;return}i.next=hw,hw=i}function NB(){r9++}function VB(){if(--r9>0)return;if(dw){let t=dw;for(dw=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let i;for(;hw;){let t=hw;for(hw=void 0;t;){const e=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(r){i||(i=r)}t=e}}if(i)throw i}function a9(i){for(let t=i.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function o9(i){let t,e=i.depsTail,r=e;for(;r;){const n=r.prevDep;r.version===-1?(r===e&&(e=n),UB(r),tlt(r)):t=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=n}i.deps=t,i.depsTail=e}function Hk(i){for(let t=i.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(s9(t.dep.computed)||t.dep.version!==t.version))return!0;return!!i._dirty}function s9(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===zw)||(i.globalVersion=zw,!i.isSSR&&i.flags&128&&(!i.deps&&!i._dirty||!Hk(i))))return;i.flags|=2;const t=i.dep,e=Ra,r=hc;Ra=i,hc=!0;try{a9(i);const n=i.fn(i._value);(t.version===0||bp(n,i._value))&&(i.flags|=128,i._value=n,t.version++)}catch(n){throw t.version++,n}finally{Ra=e,hc=r,o9(i),i.flags&=-3}}function UB(i,t=!1){const{dep:e,prevSub:r,nextSub:n}=i;if(r&&(r.nextSub=n,i.prevSub=void 0),n&&(n.prevSub=r,i.nextSub=void 0),e.subs===i&&(e.subs=r,!r&&e.computed)){e.computed.flags&=-5;for(let o=e.computed.deps;o;o=o.nextDep)UB(o,!0)}!t&&!--e.sc&&e.map&&e.map.delete(e.key)}function tlt(i){const{prevDep:t,nextDep:e}=i;t&&(t.nextDep=e,i.prevDep=void 0),e&&(e.prevDep=t,i.nextDep=void 0)}let hc=!0;const l9=[];function Dd(){l9.push(hc),hc=!1}function Pd(){const i=l9.pop();hc=i===void 0?!0:i}function GU(i){const{cleanup:t}=i;if(i.cleanup=void 0,t){const e=Ra;Ra=void 0;try{t()}finally{Ra=e}}}let zw=0;class elt{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class GB{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Ra||!hc||Ra===this.computed)return;let e=this.activeLink;if(e===void 0||e.sub!==Ra)e=this.activeLink=new elt(Ra,this),Ra.deps?(e.prevDep=Ra.depsTail,Ra.depsTail.nextDep=e,Ra.depsTail=e):Ra.deps=Ra.depsTail=e,u9(e);else if(e.version===-1&&(e.version=this.version,e.nextDep)){const r=e.nextDep;r.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=r),e.prevDep=Ra.depsTail,e.nextDep=void 0,Ra.depsTail.nextDep=e,Ra.depsTail=e,Ra.deps===e&&(Ra.deps=r)}return e}trigger(t){this.version++,zw++,this.notify(t)}notify(t){NB();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{VB()}}}function u9(i){if(i.dep.sc++,i.sub.flags&4){const t=i.dep.computed;if(t&&!i.dep.subs){t.flags|=20;for(let r=t.deps;r;r=r.nextDep)u9(r)}const e=i.dep.subs;e!==i&&(i.prevSub=e,e&&(e.nextSub=i)),i.dep.subs=i}}const jk=new WeakMap,Jm=Symbol(""),Wk=Symbol(""),Bw=Symbol("");function Ls(i,t,e){if(hc&&Ra){let r=jk.get(i);r||jk.set(i,r=new Map);let n=r.get(e);n||(r.set(e,n=new GB),n.map=r,n.key=e),n.track()}}function fd(i,t,e,r,n,o){const s=jk.get(i);if(!s){zw++;return}const a=c=>{c&&c.trigger()};if(NB(),t==="clear")s.forEach(a);else{const c=Hr(i),f=c&&BB(e);if(c&&e==="length"){const g=Number(r);s.forEach((v,y)=>{(y==="length"||y===Bw||!_h(y)&&y>=g)&&a(v)})}else switch((e!==void 0||s.has(void 0))&&a(s.get(e)),f&&a(s.get(Bw)),t){case"add":c?f&&a(s.get("length")):(a(s.get(Jm)),r0(i)&&a(s.get(Wk)));break;case"delete":c||(a(s.get(Jm)),r0(i)&&a(s.get(Wk)));break;case"set":r0(i)&&a(s.get(Jm));break}}VB()}function fy(i){const t=da(i);return t===i?t:(Ls(t,"iterate",Bw),Lu(i)?t:t.map(ms))}function zM(i){return Ls(i=da(i),"iterate",Bw),i}const ilt={__proto__:null,[Symbol.iterator](){return HP(this,Symbol.iterator,ms)},concat(...i){return fy(this).concat(...i.map(t=>Hr(t)?fy(t):t))},entries(){return HP(this,"entries",i=>(i[1]=ms(i[1]),i))},every(i,t){return Jh(this,"every",i,t,void 0,arguments)},filter(i,t){return Jh(this,"filter",i,t,e=>e.map(ms),arguments)},find(i,t){return Jh(this,"find",i,t,ms,arguments)},findIndex(i,t){return Jh(this,"findIndex",i,t,void 0,arguments)},findLast(i,t){return Jh(this,"findLast",i,t,ms,arguments)},findLastIndex(i,t){return Jh(this,"findLastIndex",i,t,void 0,arguments)},forEach(i,t){return Jh(this,"forEach",i,t,void 0,arguments)},includes(...i){return jP(this,"includes",i)},indexOf(...i){return jP(this,"indexOf",i)},join(i){return fy(this).join(i)},lastIndexOf(...i){return jP(this,"lastIndexOf",i)},map(i,t){return Jh(this,"map",i,t,void 0,arguments)},pop(){return nb(this,"pop")},push(...i){return nb(this,"push",i)},reduce(i,...t){return HU(this,"reduce",i,t)},reduceRight(i,...t){return HU(this,"reduceRight",i,t)},shift(){return nb(this,"shift")},some(i,t){return Jh(this,"some",i,t,void 0,arguments)},splice(...i){return nb(this,"splice",i)},toReversed(){return fy(this).toReversed()},toSorted(i){return fy(this).toSorted(i)},toSpliced(...i){return fy(this).toSpliced(...i)},unshift(...i){return nb(this,"unshift",i)},values(){return HP(this,"values",ms)}};function HP(i,t,e){const r=zM(i),n=r[t]();return r!==i&&!Lu(i)&&(n._next=n.next,n.next=()=>{const o=n._next();return o.done||(o.value=e(o.value)),o}),n}const rlt=Array.prototype;function Jh(i,t,e,r,n,o){const s=zM(i),a=s!==i&&!Lu(i),c=s[t];if(c!==rlt[t]){const v=c.apply(i,o);return a?ms(v):v}let f=e;s!==i&&(a?f=function(v,y){return e.call(this,ms(v),y,i)}:e.length>2&&(f=function(v,y){return e.call(this,v,y,i)}));const g=c.call(s,f,r);return a&&n?n(g):g}function HU(i,t,e,r){const n=zM(i);let o=e;return n!==i&&(Lu(i)?e.length>3&&(o=function(s,a,c){return e.call(this,s,a,c,i)}):o=function(s,a,c){return e.call(this,s,ms(a),c,i)}),n[t](o,...r)}function jP(i,t,e){const r=da(i);Ls(r,"iterate",Bw);const n=r[t](...e);return(n===-1||n===!1)&&WB(e[0])?(e[0]=da(e[0]),r[t](...e)):n}function nb(i,t,e=[]){Dd(),NB();const r=da(i)[t].apply(i,e);return VB(),Pd(),r}const nlt=kB("__proto__,__v_isRef,__isVue"),c9=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(_h));function alt(i){_h(i)||(i=String(i));const t=da(this);return Ls(t,"has",i),t.hasOwnProperty(i)}class h9{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,r){if(e==="__v_skip")return t.__v_skip;const n=this._isReadonly,o=this._isShallow;if(e==="__v_isReactive")return!n;if(e==="__v_isReadonly")return n;if(e==="__v_isShallow")return o;if(e==="__v_raw")return r===(n?o?glt:g9:o?p9:f9).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(r)?t:void 0;const s=Hr(t);if(!n){let c;if(s&&(c=ilt[e]))return c;if(e==="hasOwnProperty")return alt}const a=Reflect.get(t,e,zs(t)?t:r);if((_h(e)?c9.has(e):nlt(e))||(n||Ls(t,"get",e),o))return a;if(zs(a)){const c=s&&BB(e)?a:a.value;return n&&Ia(c)?Zk(c):c}return Ia(a)?n?Zk(a):DS(a):a}}class d9 extends h9{constructor(t=!1){super(!1,t)}set(t,e,r,n){let o=t[e];if(!this._isShallow){const c=Dp(o);if(!Lu(r)&&!Dp(r)&&(o=da(o),r=da(r)),!Hr(t)&&zs(o)&&!zs(r))return c||(o.value=r),!0}const s=Hr(t)&&BB(e)?Number(e)<t.length:fa(t,e),a=Reflect.set(t,e,r,zs(t)?t:n);return t===da(n)&&(s?bp(r,o)&&fd(t,"set",e,r):fd(t,"add",e,r)),a}deleteProperty(t,e){const r=fa(t,e);t[e];const n=Reflect.deleteProperty(t,e);return n&&r&&fd(t,"delete",e,void 0),n}has(t,e){const r=Reflect.has(t,e);return(!_h(e)||!c9.has(e))&&Ls(t,"has",e),r}ownKeys(t){return Ls(t,"iterate",Hr(t)?"length":Jm),Reflect.ownKeys(t)}}class olt extends h9{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const slt=new d9,llt=new olt,ult=new d9(!0);const $k=i=>i,W2=i=>Reflect.getPrototypeOf(i);function clt(i,t,e){return function(...r){const n=this.__v_raw,o=da(n),s=r0(o),a=i==="entries"||i===Symbol.iterator&&s,c=i==="keys"&&s,f=n[i](...r),g=e?$k:t?lC:ms;return!t&&Ls(o,"iterate",c?Wk:Jm),{next(){const{value:v,done:y}=f.next();return y?{value:v,done:y}:{value:a?[g(v[0]),g(v[1])]:g(v),done:y}},[Symbol.iterator](){return this}}}}function $2(i){return function(...t){return i==="delete"?!1:i==="clear"?void 0:this}}function hlt(i,t){const e={get(n){const o=this.__v_raw,s=da(o),a=da(n);i||(bp(n,a)&&Ls(s,"get",n),Ls(s,"get",a));const{has:c}=W2(s),f=t?$k:i?lC:ms;if(c.call(s,n))return f(o.get(n));if(c.call(s,a))return f(o.get(a));o!==s&&o.get(n)},get size(){const n=this.__v_raw;return!i&&Ls(da(n),"iterate",Jm),n.size},has(n){const o=this.__v_raw,s=da(o),a=da(n);return i||(bp(n,a)&&Ls(s,"has",n),Ls(s,"has",a)),n===a?o.has(n):o.has(n)||o.has(a)},forEach(n,o){const s=this,a=s.__v_raw,c=da(a),f=t?$k:i?lC:ms;return!i&&Ls(c,"iterate",Jm),a.forEach((g,v)=>n.call(o,f(g),f(v),s))}};return os(e,i?{add:$2("add"),set:$2("set"),delete:$2("delete"),clear:$2("clear")}:{add(n){!t&&!Lu(n)&&!Dp(n)&&(n=da(n));const o=da(this);return W2(o).has.call(o,n)||(o.add(n),fd(o,"add",n,n)),this},set(n,o){!t&&!Lu(o)&&!Dp(o)&&(o=da(o));const s=da(this),{has:a,get:c}=W2(s);let f=a.call(s,n);f||(n=da(n),f=a.call(s,n));const g=c.call(s,n);return s.set(n,o),f?bp(o,g)&&fd(s,"set",n,o):fd(s,"add",n,o),this},delete(n){const o=da(this),{has:s,get:a}=W2(o);let c=s.call(o,n);c||(n=da(n),c=s.call(o,n)),a&&a.call(o,n);const f=o.delete(n);return c&&fd(o,"delete",n,void 0),f},clear(){const n=da(this),o=n.size!==0,s=n.clear();return o&&fd(n,"clear",void 0,void 0),s}}),["keys","values","entries",Symbol.iterator].forEach(n=>{e[n]=clt(n,i,t)}),e}function HB(i,t){const e=hlt(i,t);return(r,n,o)=>n==="__v_isReactive"?!i:n==="__v_isReadonly"?i:n==="__v_raw"?r:Reflect.get(fa(e,n)&&n in r?e:r,n,o)}const dlt={get:HB(!1,!1)},flt={get:HB(!1,!0)},plt={get:HB(!0,!1)};const f9=new WeakMap,p9=new WeakMap,g9=new WeakMap,glt=new WeakMap;function mlt(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vlt(i){return i.__v_skip||!Object.isExtensible(i)?0:mlt(Gst(i))}function DS(i){return Dp(i)?i:jB(i,!1,slt,dlt,f9)}function m9(i){return jB(i,!1,ult,flt,p9)}function Zk(i){return jB(i,!0,llt,plt,g9)}function jB(i,t,e,r,n){if(!Ia(i)||i.__v_raw&&!(t&&i.__v_isReactive))return i;const o=vlt(i);if(o===0)return i;const s=n.get(i);if(s)return s;const a=new Proxy(i,o===2?r:e);return n.set(i,a),a}function n0(i){return Dp(i)?n0(i.__v_raw):!!(i&&i.__v_isReactive)}function Dp(i){return!!(i&&i.__v_isReadonly)}function Lu(i){return!!(i&&i.__v_isShallow)}function WB(i){return i?!!i.__v_raw:!1}function da(i){const t=i&&i.__v_raw;return t?da(t):i}function _lt(i){return!fa(i,"__v_skip")&&Object.isExtensible(i)&&J7(i,"__v_skip",!0),i}const ms=i=>Ia(i)?DS(i):i,lC=i=>Ia(i)?Zk(i):i;function zs(i){return i?i.__v_isRef===!0:!1}function vo(i){return v9(i,!1)}function ylt(i){return v9(i,!0)}function v9(i,t){return zs(i)?i:new xlt(i,t)}class xlt{constructor(t,e){this.dep=new GB,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:da(t),this._value=e?t:ms(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,r=this.__v_isShallow||Lu(t)||Dp(t);t=r?t:da(t),bp(t,e)&&(this._rawValue=t,this._value=r?t:ms(t),this.dep.trigger())}}function wd(i){return zs(i)?i.value:i}const blt={get:(i,t,e)=>t==="__v_raw"?i:wd(Reflect.get(i,t,e)),set:(i,t,e,r)=>{const n=i[t];return zs(n)&&!zs(e)?(n.value=e,!0):Reflect.set(i,t,e,r)}};function _9(i){return n0(i)?i:new Proxy(i,blt)}class wlt{constructor(t,e,r){this.fn=t,this.setter=e,this._value=void 0,this.dep=new GB(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=zw-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Ra!==this)return n9(this,!0),!0}get value(){const t=this.dep.track();return s9(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function Slt(i,t,e=!1){let r,n;return dn(i)?r=i:(r=i.get,n=i.set),new wlt(r,n,e)}const Z2={},uC=new WeakMap;let Mm;function Tlt(i,t=!1,e=Mm){if(e){let r=uC.get(e);r||uC.set(e,r=[]),r.push(i)}}function Alt(i,t,e=Aa){const{immediate:r,deep:n,once:o,scheduler:s,augmentJob:a,call:c}=e,f=H=>n?H:Lu(H)||n===!1||n===0?pd(H,1):pd(H);let g,v,y,w,I=!1,E=!1;if(zs(i)?(v=()=>i.value,I=Lu(i)):n0(i)?(v=()=>f(i),I=!0):Hr(i)?(E=!0,I=i.some(H=>n0(H)||Lu(H)),v=()=>i.map(H=>{if(zs(H))return H.value;if(n0(H))return f(H);if(dn(H))return c?c(H,2):H()})):dn(i)?t?v=c?()=>c(i,2):i:v=()=>{if(y){Dd();try{y()}finally{Pd()}}const H=Mm;Mm=g;try{return c?c(i,3,[w]):i(w)}finally{Mm=H}}:v=cc,t&&n){const H=v,q=n===!0?1/0:n;v=()=>pd(H(),q)}const D=Qst(),R=()=>{g.stop(),D&&D.active&&zB(D.effects,g)};if(o&&t){const H=t;t=(...q)=>{H(...q),R()}}let z=E?new Array(i.length).fill(Z2):Z2;const N=H=>{if(!(!(g.flags&1)||!g.dirty&&!H))if(t){const q=g.run();if(n||I||(E?q.some((Y,J)=>bp(Y,z[J])):bp(q,z))){y&&y();const Y=Mm;Mm=g;try{const J=[q,z===Z2?void 0:E&&z[0]===Z2?[]:z,w];z=q,c?c(t,3,J):t(...J)}finally{Mm=Y}}}else g.run()};return a&&a(N),g=new i9(v),g.scheduler=s?()=>s(N,!1):N,w=H=>Tlt(H,!1,g),y=g.onStop=()=>{const H=uC.get(g);if(H){if(c)c(H,4);else for(const q of H)q();uC.delete(g)}},t?r?N(!0):z=g.run():s?s(N.bind(null,!0),!0):g.run(),R.pause=g.pause.bind(g),R.resume=g.resume.bind(g),R.stop=R,R}function pd(i,t=1/0,e){if(t<=0||!Ia(i)||i.__v_skip||(e=e||new Map,(e.get(i)||0)>=t))return i;if(e.set(i,t),t--,zs(i))pd(i.value,t,e);else if(Hr(i))for(let r=0;r<i.length;r++)pd(i[r],t,e);else if(k0(i)||r0(i))i.forEach(r=>{pd(r,t,e)});else if(K7(i)){for(const r in i)pd(i[r],t,e);for(const r of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,r)&&pd(i[r],t,e)}return i}/**
* @vue/runtime-core v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function PS(i,t,e,r){try{return r?i(...r):i()}catch(n){BM(n,t,e)}}function yh(i,t,e,r){if(dn(i)){const n=PS(i,t,e,r);return n&&X7(n)&&n.catch(o=>{BM(o,t,e)}),n}if(Hr(i)){const n=[];for(let o=0;o<i.length;o++)n.push(yh(i[o],t,e,r));return n}}function BM(i,t,e,r=!0){const n=t?t.vnode:null,{errorHandler:o,throwUnhandledErrorInProduction:s}=t&&t.appContext.config||Aa;if(t){let a=t.parent;const c=t.proxy,f=`https://vuejs.org/error-reference/#runtime-${e}`;for(;a;){const g=a.ec;if(g){for(let v=0;v<g.length;v++)if(g[v](i,c,f)===!1)return}a=a.parent}if(o){Dd(),PS(o,null,10,[i,c,f]),Pd();return}}Ilt(i,e,n,r,s)}function Ilt(i,t,e,r=!0,n=!1){if(n)throw i;console.error(i)}const hl=[];let th=-1;const a0=[];let tp=null,Hy=0;const y9=Promise.resolve();let cC=null;function Fw(i){const t=cC||y9;return i?t.then(this?i.bind(this):i):t}function Clt(i){let t=th+1,e=hl.length;for(;t<e;){const r=t+e>>>1,n=hl[r],o=Nw(n);o<i||o===i&&n.flags&2?t=r+1:e=r}return t}function $B(i){if(!(i.flags&1)){const t=Nw(i),e=hl[hl.length-1];!e||!(i.flags&2)&&t>=Nw(e)?hl.push(i):hl.splice(Clt(t),0,i),i.flags|=1,x9()}}function x9(){cC||(cC=y9.then(w9))}function Mlt(i){Hr(i)?a0.push(...i):tp&&i.id===-1?tp.splice(Hy+1,0,i):i.flags&1||(a0.push(i),i.flags|=1),x9()}function jU(i,t,e=th+1){for(;e<hl.length;e++){const r=hl[e];if(r&&r.flags&2){if(i&&r.id!==i.uid)continue;hl.splice(e,1),e--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function b9(i){if(a0.length){const t=[...new Set(a0)].sort((e,r)=>Nw(e)-Nw(r));if(a0.length=0,tp){tp.push(...t);return}for(tp=t,Hy=0;Hy<tp.length;Hy++){const e=tp[Hy];e.flags&4&&(e.flags&=-2),e.flags&8||e(),e.flags&=-2}tp=null,Hy=0}}const Nw=i=>i.id==null?i.flags&2?-1:1/0:i.id;function w9(i){const t=cc;try{for(th=0;th<hl.length;th++){const e=hl[th];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),PS(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;th<hl.length;th++){const e=hl[th];e&&(e.flags&=-2)}th=-1,hl.length=0,b9(),cC=null,(hl.length||a0.length)&&w9()}}let Jl=null,S9=null;function hC(i){const t=Jl;return Jl=i,S9=i&&i.type.__scopeId||null,t}function $o(i,t=Jl,e){if(!t||i._n)return i;const r=(...n)=>{r._d&&pC(-1);const o=hC(t);let s;try{s=i(...n)}finally{hC(o),r._d&&pC(1)}return s};return r._n=!0,r._c=!0,r._d=!0,r}function gu(i,t){if(Jl===null)return i;const e=GM(Jl),r=i.dirs||(i.dirs=[]);for(let n=0;n<t.length;n++){let[o,s,a,c=Aa]=t[n];o&&(dn(o)&&(o={mounted:o,updated:o}),o.deep&&pd(s),r.push({dir:o,instance:e,value:s,oldValue:void 0,arg:a,modifiers:c}))}return i}function Yg(i,t,e,r){const n=i.dirs,o=t&&t.dirs;for(let s=0;s<n.length;s++){const a=n[s];o&&(a.oldValue=o[s].value);let c=a.dir[r];c&&(Dd(),yh(c,e,8,[i.el,a,i,t]),Pd())}}const Elt=Symbol("_vte"),Dlt=i=>i.__isTeleport,Plt=Symbol("_leaveCb");function ZB(i,t){i.shapeFlag&6&&i.component?(i.transition=t,ZB(i.component.subTree,t)):i.shapeFlag&128?(i.ssContent.transition=t.clone(i.ssContent),i.ssFallback.transition=t.clone(i.ssFallback)):i.transition=t}function T9(i,t){return dn(i)?(()=>os({name:i.name},t,{setup:i}))():i}function A9(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}const dC=new WeakMap;function fw(i,t,e,r,n=!1){if(Hr(i)){i.forEach((I,E)=>fw(I,t&&(Hr(t)?t[E]:t),e,r,n));return}if(pw(r)&&!n){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&fw(i,t,e,r.component.subTree);return}const o=r.shapeFlag&4?GM(r.component):r.el,s=n?null:o,{i:a,r:c}=i,f=t&&t.r,g=a.refs===Aa?a.refs={}:a.refs,v=a.setupState,y=da(v),w=v===Aa?q7:I=>fa(y,I);if(f!=null&&f!==c){if(WU(t),zo(f))g[f]=null,w(f)&&(v[f]=null);else if(zs(f)){f.value=null;const I=t;I.k&&(g[I.k]=null)}}if(dn(c))PS(c,a,12,[s,g]);else{const I=zo(c),E=zs(c);if(I||E){const D=()=>{if(i.f){const R=I?w(c)?v[c]:g[c]:c.value;if(n)Hr(R)&&zB(R,o);else if(Hr(R))R.includes(o)||R.push(o);else if(I)g[c]=[o],w(c)&&(v[c]=g[c]);else{const z=[o];c.value=z,i.k&&(g[i.k]=z)}}else I?(g[c]=s,w(c)&&(v[c]=s)):E&&(c.value=s,i.k&&(g[i.k]=s))};if(s){const R=()=>{D(),dC.delete(i)};R.id=-1,dC.set(i,R),Wl(R,e)}else WU(i),D()}}}function WU(i){const t=dC.get(i);t&&(t.flags|=8,dC.delete(i))}OM().requestIdleCallback;OM().cancelIdleCallback;const pw=i=>!!i.type.__asyncLoader,I9=i=>i.type.__isKeepAlive;function FM(i,t){C9(i,"a",t)}function Llt(i,t){C9(i,"da",t)}function C9(i,t,e=ks){const r=i.__wdc||(i.__wdc=()=>{let n=e;for(;n;){if(n.isDeactivated)return;n=n.parent}return i()});if(NM(t,r,e),e){let n=e.parent;for(;n&&n.parent;)I9(n.parent.vnode)&&Rlt(r,t,e,n),n=n.parent}}function Rlt(i,t,e,r){const n=NM(t,i,r,!0);M9(()=>{zB(r[t],n)},e)}function NM(i,t,e=ks,r=!1){if(e){const n=e[i]||(e[i]=[]),o=t.__weh||(t.__weh=(...s)=>{Dd();const a=RS(e),c=yh(t,e,i,s);return a(),Pd(),c});return r?n.unshift(o):n.push(o),o}}const Ud=i=>(t,e=ks)=>{(!Uw||i==="sp")&&NM(i,(...r)=>t(...r),e)},klt=Ud("bm"),Av=Ud("m"),Olt=Ud("bu"),zlt=Ud("u"),LS=Ud("bum"),M9=Ud("um"),Blt=Ud("sp"),Flt=Ud("rtg"),Nlt=Ud("rtc");function Vlt(i,t=ks){NM("ec",i,t)}const E9="components";function Qm(i,t){return Glt(E9,i,!0,t)||i}const Ult=Symbol.for("v-ndc");function Glt(i,t,e=!0,r=!1){const n=Jl||ks;if(n){const o=n.type;if(i===E9){const a=Dut(o,!1);if(a&&(a===t||a===ku(t)||a===RM(ku(t))))return o}const s=$U(n[i]||o[i],t)||$U(n.appContext[i],t);return!s&&r?o:s}}function $U(i,t){return i&&(i[t]||i[ku(t)]||i[RM(ku(t))])}function qB(i,t,e,r){let n;const o=e&&e[r],s=Hr(i);if(s||zo(i)){const a=s&&n0(i);let c=!1,f=!1;a&&(c=!Lu(i),f=Dp(i),i=zM(i)),n=new Array(i.length);for(let g=0,v=i.length;g<v;g++)n[g]=t(c?f?lC(ms(i[g])):ms(i[g]):i[g],g,void 0,o&&o[g])}else if(typeof i=="number"){n=new Array(i);for(let a=0;a<i;a++)n[a]=t(a+1,a,void 0,o&&o[a])}else if(Ia(i))if(i[Symbol.iterator])n=Array.from(i,(a,c)=>t(a,c,void 0,o&&o[c]));else{const a=Object.keys(i);n=new Array(a.length);for(let c=0,f=a.length;c<f;c++){const g=a[c];n[c]=t(i[g],g,c,o&&o[c])}}else n=[];return e&&(e[r]=n),n}const qk=i=>i?X9(i)?GM(i):qk(i.parent):null,gw=os(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>qk(i.parent),$root:i=>qk(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>XB(i),$forceUpdate:i=>i.f||(i.f=()=>{$B(i.update)}),$nextTick:i=>i.n||(i.n=Fw.bind(i.proxy)),$watch:i=>uut.bind(i)}),WP=(i,t)=>i!==Aa&&!i.__isScriptSetup&&fa(i,t),Hlt={get({_:i},t){if(t==="__v_skip")return!0;const{ctx:e,setupState:r,data:n,props:o,accessCache:s,type:a,appContext:c}=i;let f;if(t[0]!=="$"){const w=s[t];if(w!==void 0)switch(w){case 1:return r[t];case 2:return n[t];case 4:return e[t];case 3:return o[t]}else{if(WP(r,t))return s[t]=1,r[t];if(n!==Aa&&fa(n,t))return s[t]=2,n[t];if((f=i.propsOptions[0])&&fa(f,t))return s[t]=3,o[t];if(e!==Aa&&fa(e,t))return s[t]=4,e[t];Xk&&(s[t]=0)}}const g=gw[t];let v,y;if(g)return t==="$attrs"&&Ls(i.attrs,"get",""),g(i);if((v=a.__cssModules)&&(v=v[t]))return v;if(e!==Aa&&fa(e,t))return s[t]=4,e[t];if(y=c.config.globalProperties,fa(y,t))return y[t]},set({_:i},t,e){const{data:r,setupState:n,ctx:o}=i;return WP(n,t)?(n[t]=e,!0):r!==Aa&&fa(r,t)?(r[t]=e,!0):fa(i.props,t)||t[0]==="$"&&t.slice(1)in i?!1:(o[t]=e,!0)},has({_:{data:i,setupState:t,accessCache:e,ctx:r,appContext:n,propsOptions:o,type:s}},a){let c,f;return!!(e[a]||i!==Aa&&a[0]!=="$"&&fa(i,a)||WP(t,a)||(c=o[0])&&fa(c,a)||fa(r,a)||fa(gw,a)||fa(n.config.globalProperties,a)||(f=s.__cssModules)&&f[a])},defineProperty(i,t,e){return e.get!=null?i._.accessCache[t]=0:fa(e,"value")&&this.set(i,t,e.value,null),Reflect.defineProperty(i,t,e)}};function ZU(i){return Hr(i)?i.reduce((t,e)=>(t[e]=null,t),{}):i}let Xk=!0;function jlt(i){const t=XB(i),e=i.proxy,r=i.ctx;Xk=!1,t.beforeCreate&&qU(t.beforeCreate,i,"bc");const{data:n,computed:o,methods:s,watch:a,provide:c,inject:f,created:g,beforeMount:v,mounted:y,beforeUpdate:w,updated:I,activated:E,deactivated:D,beforeDestroy:R,beforeUnmount:z,destroyed:N,unmounted:H,render:q,renderTracked:Y,renderTriggered:J,errorCaptured:it,serverPrefetch:at,expose:ut,inheritAttrs:ft,components:_t,directives:ct,filters:Dt}=t;if(f&&Wlt(f,r,null),s)for(const Vt in s){const zt=s[Vt];dn(zt)&&(r[Vt]=zt.bind(e))}if(n){const Vt=n.call(e,e);Ia(Vt)&&(i.data=DS(Vt))}if(Xk=!0,o)for(const Vt in o){const zt=o[Vt],Jt=dn(zt)?zt.bind(e,e):dn(zt.get)?zt.get.bind(e,e):cc,ce=!dn(zt)&&dn(zt.set)?zt.set.bind(e):cc,be=Yl({get:Jt,set:ce});Object.defineProperty(r,Vt,{enumerable:!0,configurable:!0,get:()=>be.value,set:ve=>be.value=ve})}if(a)for(const Vt in a)D9(a[Vt],r,e,Vt);if(c){const Vt=dn(c)?c.call(e):c;Reflect.ownKeys(Vt).forEach(zt=>{CI(zt,Vt[zt])})}g&&qU(g,i,"c");function bt(Vt,zt){Hr(zt)?zt.forEach(Jt=>Vt(Jt.bind(e))):zt&&Vt(zt.bind(e))}if(bt(klt,v),bt(Av,y),bt(Olt,w),bt(zlt,I),bt(FM,E),bt(Llt,D),bt(Vlt,it),bt(Nlt,Y),bt(Flt,J),bt(LS,z),bt(M9,H),bt(Blt,at),Hr(ut))if(ut.length){const Vt=i.exposed||(i.exposed={});ut.forEach(zt=>{Object.defineProperty(Vt,zt,{get:()=>e[zt],set:Jt=>e[zt]=Jt,enumerable:!0})})}else i.exposed||(i.exposed={});q&&i.render===cc&&(i.render=q),ft!=null&&(i.inheritAttrs=ft),_t&&(i.components=_t),ct&&(i.directives=ct),at&&A9(i)}function Wlt(i,t,e=cc){Hr(i)&&(i=Yk(i));for(const r in i){const n=i[r];let o;Ia(n)?"default"in n?o=Sd(n.from||r,n.default,!0):o=Sd(n.from||r):o=Sd(n),zs(o)?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:()=>o.value,set:s=>o.value=s}):t[r]=o}}function qU(i,t,e){yh(Hr(i)?i.map(r=>r.bind(t.proxy)):i.bind(t.proxy),t,e)}function D9(i,t,e,r){let n=r.includes(".")?H9(e,r):()=>e[r];if(zo(i)){const o=t[i];dn(o)&&tv(n,o)}else if(dn(i))tv(n,i.bind(e));else if(Ia(i))if(Hr(i))i.forEach(o=>D9(o,t,e,r));else{const o=dn(i.handler)?i.handler.bind(e):t[i.handler];dn(o)&&tv(n,o,i)}}function XB(i){const t=i.type,{mixins:e,extends:r}=t,{mixins:n,optionsCache:o,config:{optionMergeStrategies:s}}=i.appContext,a=o.get(t);let c;return a?c=a:!n.length&&!e&&!r?c=t:(c={},n.length&&n.forEach(f=>fC(c,f,s,!0)),fC(c,t,s)),Ia(t)&&o.set(t,c),c}function fC(i,t,e,r=!1){const{mixins:n,extends:o}=t;o&&fC(i,o,e,!0),n&&n.forEach(s=>fC(i,s,e,!0));for(const s in t)if(!(r&&s==="expose")){const a=$lt[s]||e&&e[s];i[s]=a?a(i[s],t[s]):t[s]}return i}const $lt={data:XU,props:YU,emits:YU,methods:jb,computed:jb,beforeCreate:ol,created:ol,beforeMount:ol,mounted:ol,beforeUpdate:ol,updated:ol,beforeDestroy:ol,beforeUnmount:ol,destroyed:ol,unmounted:ol,activated:ol,deactivated:ol,errorCaptured:ol,serverPrefetch:ol,components:jb,directives:jb,watch:qlt,provide:XU,inject:Zlt};function XU(i,t){return t?i?function(){return os(dn(i)?i.call(this,this):i,dn(t)?t.call(this,this):t)}:t:i}function Zlt(i,t){return jb(Yk(i),Yk(t))}function Yk(i){if(Hr(i)){const t={};for(let e=0;e<i.length;e++)t[i[e]]=i[e];return t}return i}function ol(i,t){return i?[...new Set([].concat(i,t))]:t}function jb(i,t){return i?os(Object.create(null),i,t):t}function YU(i,t){return i?Hr(i)&&Hr(t)?[...new Set([...i,...t])]:os(Object.create(null),ZU(i),ZU(t??{})):t}function qlt(i,t){if(!i)return t;if(!t)return i;const e=os(Object.create(null),i);for(const r in t)e[r]=ol(i[r],t[r]);return e}function P9(){return{app:null,config:{isNativeTag:q7,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Xlt=0;function Ylt(i,t){return function(r,n=null){dn(r)||(r=os({},r)),n!=null&&!Ia(n)&&(n=null);const o=P9(),s=new WeakSet,a=[];let c=!1;const f=o.app={_uid:Xlt++,_component:r,_props:n,_container:null,_context:o,_instance:null,version:Lut,get config(){return o.config},set config(g){},use(g,...v){return s.has(g)||(g&&dn(g.install)?(s.add(g),g.install(f,...v)):dn(g)&&(s.add(g),g(f,...v))),f},mixin(g){return o.mixins.includes(g)||o.mixins.push(g),f},component(g,v){return v?(o.components[g]=v,f):o.components[g]},directive(g,v){return v?(o.directives[g]=v,f):o.directives[g]},mount(g,v,y){if(!c){const w=f._ceVNode||Xn(r,n);return w.appContext=o,y===!0?y="svg":y===!1&&(y=void 0),v&&t?t(w,g):i(w,g,y),c=!0,f._container=g,g.__vue_app__=f,GM(w.component)}},onUnmount(g){a.push(g)},unmount(){c&&(yh(a,f._instance,16),i(null,f._container),delete f._container.__vue_app__)},provide(g,v){return o.provides[g]=v,f},runWithContext(g){const v=o0;o0=f;try{return g()}finally{o0=v}}};return f}}let o0=null;function CI(i,t){if(ks){let e=ks.provides;const r=ks.parent&&ks.parent.provides;r===e&&(e=ks.provides=Object.create(r)),e[i]=t}}function Sd(i,t,e=!1){const r=Aut();if(r||o0){let n=o0?o0._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(n&&i in n)return n[i];if(arguments.length>1)return e&&dn(t)?t.call(r&&r.proxy):t}}const L9={},R9=()=>Object.create(L9),k9=i=>Object.getPrototypeOf(i)===L9;function Klt(i,t,e,r=!1){const n={},o=R9();i.propsDefaults=Object.create(null),O9(i,t,n,o);for(const s in i.propsOptions[0])s in n||(n[s]=void 0);e?i.props=r?n:m9(n):i.type.props?i.props=n:i.props=o,i.attrs=o}function Jlt(i,t,e,r){const{props:n,attrs:o,vnode:{patchFlag:s}}=i,a=da(n),[c]=i.propsOptions;let f=!1;if((r||s>0)&&!(s&16)){if(s&8){const g=i.vnode.dynamicProps;for(let v=0;v<g.length;v++){let y=g[v];if(VM(i.emitsOptions,y))continue;const w=t[y];if(c)if(fa(o,y))w!==o[y]&&(o[y]=w,f=!0);else{const I=ku(y);n[I]=Kk(c,a,I,w,i,!1)}else w!==o[y]&&(o[y]=w,f=!0)}}}else{O9(i,t,n,o)&&(f=!0);let g;for(const v in a)(!t||!fa(t,v)&&((g=Gp(v))===v||!fa(t,g)))&&(c?e&&(e[v]!==void 0||e[g]!==void 0)&&(n[v]=Kk(c,a,v,void 0,i,!0)):delete n[v]);if(o!==a)for(const v in o)(!t||!fa(t,v))&&(delete o[v],f=!0)}f&&fd(i.attrs,"set","")}function O9(i,t,e,r){const[n,o]=i.propsOptions;let s=!1,a;if(t)for(let c in t){if(cw(c))continue;const f=t[c];let g;n&&fa(n,g=ku(c))?!o||!o.includes(g)?e[g]=f:(a||(a={}))[g]=f:VM(i.emitsOptions,c)||(!(c in r)||f!==r[c])&&(r[c]=f,s=!0)}if(o){const c=da(e),f=a||Aa;for(let g=0;g<o.length;g++){const v=o[g];e[v]=Kk(n,c,v,f[v],i,!fa(f,v))}}return s}function Kk(i,t,e,r,n,o){const s=i[e];if(s!=null){const a=fa(s,"default");if(a&&r===void 0){const c=s.default;if(s.type!==Function&&!s.skipFactory&&dn(c)){const{propsDefaults:f}=n;if(e in f)r=f[e];else{const g=RS(n);r=f[e]=c.call(null,t),g()}}else r=c;n.ce&&n.ce._setProp(e,r)}s[0]&&(o&&!a?r=!1:s[1]&&(r===""||r===Gp(e))&&(r=!0))}return r}const Qlt=new WeakMap;function z9(i,t,e=!1){const r=e?Qlt:t.propsCache,n=r.get(i);if(n)return n;const o=i.props,s={},a=[];let c=!1;if(!dn(i)){const g=v=>{c=!0;const[y,w]=z9(v,t,!0);os(s,y),w&&a.push(...w)};!e&&t.mixins.length&&t.mixins.forEach(g),i.extends&&g(i.extends),i.mixins&&i.mixins.forEach(g)}if(!o&&!c)return Ia(i)&&r.set(i,i0),i0;if(Hr(o))for(let g=0;g<o.length;g++){const v=ku(o[g]);KU(v)&&(s[v]=Aa)}else if(o)for(const g in o){const v=ku(g);if(KU(v)){const y=o[g],w=s[v]=Hr(y)||dn(y)?{type:y}:os({},y),I=w.type;let E=!1,D=!0;if(Hr(I))for(let R=0;R<I.length;++R){const z=I[R],N=dn(z)&&z.name;if(N==="Boolean"){E=!0;break}else N==="String"&&(D=!1)}else E=dn(I)&&I.name==="Boolean";w[0]=E,w[1]=D,(E||fa(w,"default"))&&a.push(v)}}const f=[s,a];return Ia(i)&&r.set(i,f),f}function KU(i){return i[0]!=="$"&&!cw(i)}const YB=i=>i==="_"||i==="_ctx"||i==="$stable",KB=i=>Hr(i)?i.map(rh):[rh(i)],tut=(i,t,e)=>{if(t._n)return t;const r=$o((...n)=>KB(t(...n)),e);return r._c=!1,r},B9=(i,t,e)=>{const r=i._ctx;for(const n in i){if(YB(n))continue;const o=i[n];if(dn(o))t[n]=tut(n,o,r);else if(o!=null){const s=KB(o);t[n]=()=>s}}},F9=(i,t)=>{const e=KB(t);i.slots.default=()=>e},N9=(i,t,e)=>{for(const r in t)(e||!YB(r))&&(i[r]=t[r])},eut=(i,t,e)=>{const r=i.slots=R9();if(i.vnode.shapeFlag&32){const n=t._;n?(N9(r,t,e),e&&J7(r,"_",n,!0)):B9(t,r)}else t&&F9(i,t)},iut=(i,t,e)=>{const{vnode:r,slots:n}=i;let o=!0,s=Aa;if(r.shapeFlag&32){const a=t._;a?e&&a===1?o=!1:N9(n,t,e):(o=!t.$stable,B9(t,n)),s=t}else t&&(F9(i,t),s={default:1});if(o)for(const a in n)!YB(a)&&s[a]==null&&delete n[a]},Wl=vut;function rut(i){return nut(i)}function nut(i,t){const e=OM();e.__VUE__=!0;const{insert:r,remove:n,patchProp:o,createElement:s,createText:a,createComment:c,setText:f,setElementText:g,parentNode:v,nextSibling:y,setScopeId:w=cc,insertStaticContent:I}=i,E=(Bt,Zt,ge,$e=null,He=null,qe=null,Ai=void 0,Ii=null,_i=!!Zt.dynamicChildren)=>{if(Bt===Zt)return;Bt&&!ab(Bt,Zt)&&($e=Ue(Bt),ve(Bt,He,qe,!0),Bt=null),Zt.patchFlag===-2&&(_i=!1,Zt.dynamicChildren=null);const{type:pi,ref:yr,shapeFlag:Li}=Zt;switch(pi){case UM:D(Bt,Zt,ge,$e);break;case Pp:R(Bt,Zt,ge,$e);break;case MI:Bt==null&&z(Zt,ge,$e,Ai);break;case Xl:_t(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i);break;default:Li&1?q(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i):Li&6?ct(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i):(Li&64||Li&128)&&pi.process(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i,Ke)}yr!=null&&He?fw(yr,Bt&&Bt.ref,qe,Zt||Bt,!Zt):yr==null&&Bt&&Bt.ref!=null&&fw(Bt.ref,null,qe,Bt,!0)},D=(Bt,Zt,ge,$e)=>{if(Bt==null)r(Zt.el=a(Zt.children),ge,$e);else{const He=Zt.el=Bt.el;Zt.children!==Bt.children&&f(He,Zt.children)}},R=(Bt,Zt,ge,$e)=>{Bt==null?r(Zt.el=c(Zt.children||""),ge,$e):Zt.el=Bt.el},z=(Bt,Zt,ge,$e)=>{[Bt.el,Bt.anchor]=I(Bt.children,Zt,ge,$e,Bt.el,Bt.anchor)},N=({el:Bt,anchor:Zt},ge,$e)=>{let He;for(;Bt&&Bt!==Zt;)He=y(Bt),r(Bt,ge,$e),Bt=He;r(Zt,ge,$e)},H=({el:Bt,anchor:Zt})=>{let ge;for(;Bt&&Bt!==Zt;)ge=y(Bt),n(Bt),Bt=ge;n(Zt)},q=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i)=>{if(Zt.type==="svg"?Ai="svg":Zt.type==="math"&&(Ai="mathml"),Bt==null)Y(Zt,ge,$e,He,qe,Ai,Ii,_i);else{const pi=Bt.el&&Bt.el._isVueCE?Bt.el:null;try{pi&&pi._beginPatch(),at(Bt,Zt,He,qe,Ai,Ii,_i)}finally{pi&&pi._endPatch()}}},Y=(Bt,Zt,ge,$e,He,qe,Ai,Ii)=>{let _i,pi;const{props:yr,shapeFlag:Li,transition:hr,dirs:xr}=Bt;if(_i=Bt.el=s(Bt.type,qe,yr&&yr.is,yr),Li&8?g(_i,Bt.children):Li&16&&it(Bt.children,_i,null,$e,He,$P(Bt,qe),Ai,Ii),xr&&Yg(Bt,null,$e,"created"),J(_i,Bt,Bt.scopeId,Ai,$e),yr){for(const zn in yr)zn!=="value"&&!cw(zn)&&o(_i,zn,null,yr[zn],qe,$e);"value"in yr&&o(_i,"value",null,yr.value,qe),(pi=yr.onVnodeBeforeMount)&&Hc(pi,$e,Bt)}xr&&Yg(Bt,null,$e,"beforeMount");const tn=aut(He,hr);tn&&hr.beforeEnter(_i),r(_i,Zt,ge),((pi=yr&&yr.onVnodeMounted)||tn||xr)&&Wl(()=>{pi&&Hc(pi,$e,Bt),tn&&hr.enter(_i),xr&&Yg(Bt,null,$e,"mounted")},He)},J=(Bt,Zt,ge,$e,He)=>{if(ge&&w(Bt,ge),$e)for(let qe=0;qe<$e.length;qe++)w(Bt,$e[qe]);if(He){let qe=He.subTree;if(Zt===qe||W9(qe.type)&&(qe.ssContent===Zt||qe.ssFallback===Zt)){const Ai=He.vnode;J(Bt,Ai,Ai.scopeId,Ai.slotScopeIds,He.parent)}}},it=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i=0)=>{for(let pi=_i;pi<Bt.length;pi++){const yr=Bt[pi]=Ii?ip(Bt[pi]):rh(Bt[pi]);E(null,yr,Zt,ge,$e,He,qe,Ai,Ii)}},at=(Bt,Zt,ge,$e,He,qe,Ai)=>{const Ii=Zt.el=Bt.el;let{patchFlag:_i,dynamicChildren:pi,dirs:yr}=Zt;_i|=Bt.patchFlag&16;const Li=Bt.props||Aa,hr=Zt.props||Aa;let xr;if(ge&&Kg(ge,!1),(xr=hr.onVnodeBeforeUpdate)&&Hc(xr,ge,Zt,Bt),yr&&Yg(Zt,Bt,ge,"beforeUpdate"),ge&&Kg(ge,!0),(Li.innerHTML&&hr.innerHTML==null||Li.textContent&&hr.textContent==null)&&g(Ii,""),pi?ut(Bt.dynamicChildren,pi,Ii,ge,$e,$P(Zt,He),qe):Ai||zt(Bt,Zt,Ii,null,ge,$e,$P(Zt,He),qe,!1),_i>0){if(_i&16)ft(Ii,Li,hr,ge,He);else if(_i&2&&Li.class!==hr.class&&o(Ii,"class",null,hr.class,He),_i&4&&o(Ii,"style",Li.style,hr.style,He),_i&8){const tn=Zt.dynamicProps;for(let zn=0;zn<tn.length;zn++){const Kr=tn[zn],Ua=Li[Kr],ma=hr[Kr];(ma!==Ua||Kr==="value")&&o(Ii,Kr,Ua,ma,He,ge)}}_i&1&&Bt.children!==Zt.children&&g(Ii,Zt.children)}else!Ai&&pi==null&&ft(Ii,Li,hr,ge,He);((xr=hr.onVnodeUpdated)||yr)&&Wl(()=>{xr&&Hc(xr,ge,Zt,Bt),yr&&Yg(Zt,Bt,ge,"updated")},$e)},ut=(Bt,Zt,ge,$e,He,qe,Ai)=>{for(let Ii=0;Ii<Zt.length;Ii++){const _i=Bt[Ii],pi=Zt[Ii],yr=_i.el&&(_i.type===Xl||!ab(_i,pi)||_i.shapeFlag&198)?v(_i.el):ge;E(_i,pi,yr,null,$e,He,qe,Ai,!0)}},ft=(Bt,Zt,ge,$e,He)=>{if(Zt!==ge){if(Zt!==Aa)for(const qe in Zt)!cw(qe)&&!(qe in ge)&&o(Bt,qe,Zt[qe],null,He,$e);for(const qe in ge){if(cw(qe))continue;const Ai=ge[qe],Ii=Zt[qe];Ai!==Ii&&qe!=="value"&&o(Bt,qe,Ii,Ai,He,$e)}"value"in ge&&o(Bt,"value",Zt.value,ge.value,He)}},_t=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i)=>{const pi=Zt.el=Bt?Bt.el:a(""),yr=Zt.anchor=Bt?Bt.anchor:a("");let{patchFlag:Li,dynamicChildren:hr,slotScopeIds:xr}=Zt;xr&&(Ii=Ii?Ii.concat(xr):xr),Bt==null?(r(pi,ge,$e),r(yr,ge,$e),it(Zt.children||[],ge,yr,He,qe,Ai,Ii,_i)):Li>0&&Li&64&&hr&&Bt.dynamicChildren?(ut(Bt.dynamicChildren,hr,ge,He,qe,Ai,Ii),(Zt.key!=null||He&&Zt===He.subTree)&&V9(Bt,Zt,!0)):zt(Bt,Zt,ge,yr,He,qe,Ai,Ii,_i)},ct=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i)=>{Zt.slotScopeIds=Ii,Bt==null?Zt.shapeFlag&512?He.ctx.activate(Zt,ge,$e,Ai,_i):Dt(Zt,ge,$e,He,qe,Ai,_i):Et(Bt,Zt,_i)},Dt=(Bt,Zt,ge,$e,He,qe,Ai)=>{const Ii=Bt.component=Tut(Bt,$e,He);if(I9(Bt)&&(Ii.ctx.renderer=Ke),Iut(Ii,!1,Ai),Ii.asyncDep){if(He&&He.registerDep(Ii,bt,Ai),!Bt.el){const _i=Ii.subTree=Xn(Pp);R(null,_i,Zt,ge),Bt.placeholder=_i.el}}else bt(Ii,Bt,Zt,ge,He,qe,Ai)},Et=(Bt,Zt,ge)=>{const $e=Zt.component=Bt.component;if(gut(Bt,Zt,ge))if($e.asyncDep&&!$e.asyncResolved){Vt($e,Zt,ge);return}else $e.next=Zt,$e.update();else Zt.el=Bt.el,$e.vnode=Zt},bt=(Bt,Zt,ge,$e,He,qe,Ai)=>{const Ii=()=>{if(Bt.isMounted){let{next:Li,bu:hr,u:xr,parent:tn,vnode:zn}=Bt;{const Ja=U9(Bt);if(Ja){Li&&(Li.el=zn.el,Vt(Bt,Li,Ai)),Ja.asyncDep.then(()=>{Bt.isUnmounted||Ii()});return}}let Kr=Li,Ua;Kg(Bt,!1),Li?(Li.el=zn.el,Vt(Bt,Li,Ai)):Li=zn,hr&&II(hr),(Ua=Li.props&&Li.props.onVnodeBeforeUpdate)&&Hc(Ua,tn,Li,zn),Kg(Bt,!0);const ma=ZP(Bt),Io=Bt.subTree;Bt.subTree=ma,E(Io,ma,v(Io.el),Ue(Io),Bt,He,qe),Li.el=ma.el,Kr===null&&mut(Bt,ma.el),xr&&Wl(xr,He),(Ua=Li.props&&Li.props.onVnodeUpdated)&&Wl(()=>Hc(Ua,tn,Li,zn),He)}else{let Li;const{el:hr,props:xr}=Zt,{bm:tn,m:zn,parent:Kr,root:Ua,type:ma}=Bt,Io=pw(Zt);if(Kg(Bt,!1),tn&&II(tn),!Io&&(Li=xr&&xr.onVnodeBeforeMount)&&Hc(Li,Kr,Zt),Kg(Bt,!0),hr&&Ti){const Ja=()=>{Bt.subTree=ZP(Bt),Ti(hr,Bt.subTree,Bt,He,null)};Io&&ma.__asyncHydrate?ma.__asyncHydrate(hr,Bt,Ja):Ja()}else{Ua.ce&&Ua.ce._def.shadowRoot!==!1&&Ua.ce._injectChildStyle(ma);const Ja=Bt.subTree=ZP(Bt);E(null,Ja,ge,$e,Bt,He,qe),Zt.el=Ja.el}if(zn&&Wl(zn,He),!Io&&(Li=xr&&xr.onVnodeMounted)){const Ja=Zt;Wl(()=>Hc(Li,Kr,Ja),He)}(Zt.shapeFlag&256||Kr&&pw(Kr.vnode)&&Kr.vnode.shapeFlag&256)&&Bt.a&&Wl(Bt.a,He),Bt.isMounted=!0,Zt=ge=$e=null}};Bt.scope.on();const _i=Bt.effect=new i9(Ii);Bt.scope.off();const pi=Bt.update=_i.run.bind(_i),yr=Bt.job=_i.runIfDirty.bind(_i);yr.i=Bt,yr.id=Bt.uid,_i.scheduler=()=>$B(yr),Kg(Bt,!0),pi()},Vt=(Bt,Zt,ge)=>{Zt.component=Bt;const $e=Bt.vnode.props;Bt.vnode=Zt,Bt.next=null,Jlt(Bt,Zt.props,$e,ge),iut(Bt,Zt.children,ge),Dd(),jU(Bt),Pd()},zt=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i=!1)=>{const pi=Bt&&Bt.children,yr=Bt?Bt.shapeFlag:0,Li=Zt.children,{patchFlag:hr,shapeFlag:xr}=Zt;if(hr>0){if(hr&128){ce(pi,Li,ge,$e,He,qe,Ai,Ii,_i);return}else if(hr&256){Jt(pi,Li,ge,$e,He,qe,Ai,Ii,_i);return}}xr&8?(yr&16&&or(pi,He,qe),Li!==pi&&g(ge,Li)):yr&16?xr&16?ce(pi,Li,ge,$e,He,qe,Ai,Ii,_i):or(pi,He,qe,!0):(yr&8&&g(ge,""),xr&16&&it(Li,ge,$e,He,qe,Ai,Ii,_i))},Jt=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i)=>{Bt=Bt||i0,Zt=Zt||i0;const pi=Bt.length,yr=Zt.length,Li=Math.min(pi,yr);let hr;for(hr=0;hr<Li;hr++){const xr=Zt[hr]=_i?ip(Zt[hr]):rh(Zt[hr]);E(Bt[hr],xr,ge,null,He,qe,Ai,Ii,_i)}pi>yr?or(Bt,He,qe,!0,!1,Li):it(Zt,ge,$e,He,qe,Ai,Ii,_i,Li)},ce=(Bt,Zt,ge,$e,He,qe,Ai,Ii,_i)=>{let pi=0;const yr=Zt.length;let Li=Bt.length-1,hr=yr-1;for(;pi<=Li&&pi<=hr;){const xr=Bt[pi],tn=Zt[pi]=_i?ip(Zt[pi]):rh(Zt[pi]);if(ab(xr,tn))E(xr,tn,ge,null,He,qe,Ai,Ii,_i);else break;pi++}for(;pi<=Li&&pi<=hr;){const xr=Bt[Li],tn=Zt[hr]=_i?ip(Zt[hr]):rh(Zt[hr]);if(ab(xr,tn))E(xr,tn,ge,null,He,qe,Ai,Ii,_i);else break;Li--,hr--}if(pi>Li){if(pi<=hr){const xr=hr+1,tn=xr<yr?Zt[xr].el:$e;for(;pi<=hr;)E(null,Zt[pi]=_i?ip(Zt[pi]):rh(Zt[pi]),ge,tn,He,qe,Ai,Ii,_i),pi++}}else if(pi>hr)for(;pi<=Li;)ve(Bt[pi],He,qe,!0),pi++;else{const xr=pi,tn=pi,zn=new Map;for(pi=tn;pi<=hr;pi++){const Qa=Zt[pi]=_i?ip(Zt[pi]):rh(Zt[pi]);Qa.key!=null&&zn.set(Qa.key,pi)}let Kr,Ua=0;const ma=hr-tn+1;let Io=!1,Ja=0;const Qn=new Array(ma);for(pi=0;pi<ma;pi++)Qn[pi]=0;for(pi=xr;pi<=Li;pi++){const Qa=Bt[pi];if(Ua>=ma){ve(Qa,He,qe,!0);continue}let to;if(Qa.key!=null)to=zn.get(Qa.key);else for(Kr=tn;Kr<=hr;Kr++)if(Qn[Kr-tn]===0&&ab(Qa,Zt[Kr])){to=Kr;break}to===void 0?ve(Qa,He,qe,!0):(Qn[to-tn]=pi+1,to>=Ja?Ja=to:Io=!0,E(Qa,Zt[to],ge,null,He,qe,Ai,Ii,_i),Ua++)}const ou=Io?out(Qn):i0;for(Kr=ou.length-1,pi=ma-1;pi>=0;pi--){const Qa=tn+pi,to=Zt[Qa],xs=Zt[Qa+1],ls=Qa+1<yr?xs.el||xs.placeholder:$e;Qn[pi]===0?E(null,to,ge,ls,He,qe,Ai,Ii,_i):Io&&(Kr<0||pi!==ou[Kr]?be(to,ge,ls,2):Kr--)}}},be=(Bt,Zt,ge,$e,He=null)=>{const{el:qe,type:Ai,transition:Ii,children:_i,shapeFlag:pi}=Bt;if(pi&6){be(Bt.component.subTree,Zt,ge,$e);return}if(pi&128){Bt.suspense.move(Zt,ge,$e);return}if(pi&64){Ai.move(Bt,Zt,ge,Ke);return}if(Ai===Xl){r(qe,Zt,ge);for(let Li=0;Li<_i.length;Li++)be(_i[Li],Zt,ge,$e);r(Bt.anchor,Zt,ge);return}if(Ai===MI){N(Bt,Zt,ge);return}if($e!==2&&pi&1&&Ii)if($e===0)Ii.beforeEnter(qe),r(qe,Zt,ge),Wl(()=>Ii.enter(qe),He);else{const{leave:Li,delayLeave:hr,afterLeave:xr}=Ii,tn=()=>{Bt.ctx.isUnmounted?n(qe):r(qe,Zt,ge)},zn=()=>{qe._isLeaving&&qe[Plt](!0),Li(qe,()=>{tn(),xr&&xr()})};hr?hr(qe,tn,zn):zn()}else r(qe,Zt,ge)},ve=(Bt,Zt,ge,$e=!1,He=!1)=>{const{type:qe,props:Ai,ref:Ii,children:_i,dynamicChildren:pi,shapeFlag:yr,patchFlag:Li,dirs:hr,cacheIndex:xr}=Bt;if(Li===-2&&(He=!1),Ii!=null&&(Dd(),fw(Ii,null,ge,Bt,!0),Pd()),xr!=null&&(Zt.renderCache[xr]=void 0),yr&256){Zt.ctx.deactivate(Bt);return}const tn=yr&1&&hr,zn=!pw(Bt);let Kr;if(zn&&(Kr=Ai&&Ai.onVnodeBeforeUnmount)&&Hc(Kr,Zt,Bt),yr&6)bi(Bt.component,ge,$e);else{if(yr&128){Bt.suspense.unmount(ge,$e);return}tn&&Yg(Bt,null,Zt,"beforeUnmount"),yr&64?Bt.type.remove(Bt,Zt,ge,Ke,$e):pi&&!pi.hasOnce&&(qe!==Xl||Li>0&&Li&64)?or(pi,Zt,ge,!1,!0):(qe===Xl&&Li&384||!He&&yr&16)&&or(_i,Zt,ge),$e&&ke(Bt)}(zn&&(Kr=Ai&&Ai.onVnodeUnmounted)||tn)&&Wl(()=>{Kr&&Hc(Kr,Zt,Bt),tn&&Yg(Bt,null,Zt,"unmounted")},ge)},ke=Bt=>{const{type:Zt,el:ge,anchor:$e,transition:He}=Bt;if(Zt===Xl){ni(ge,$e);return}if(Zt===MI){H(Bt);return}const qe=()=>{n(ge),He&&!He.persisted&&He.afterLeave&&He.afterLeave()};if(Bt.shapeFlag&1&&He&&!He.persisted){const{leave:Ai,delayLeave:Ii}=He,_i=()=>Ai(ge,qe);Ii?Ii(Bt.el,qe,_i):_i()}else qe()},ni=(Bt,Zt)=>{let ge;for(;Bt!==Zt;)ge=y(Bt),n(Bt),Bt=ge;n(Zt)},bi=(Bt,Zt,ge)=>{const{bum:$e,scope:He,job:qe,subTree:Ai,um:Ii,m:_i,a:pi}=Bt;JU(_i),JU(pi),$e&&II($e),He.stop(),qe&&(qe.flags|=8,ve(Ai,Bt,Zt,ge)),Ii&&Wl(Ii,Zt),Wl(()=>{Bt.isUnmounted=!0},Zt)},or=(Bt,Zt,ge,$e=!1,He=!1,qe=0)=>{for(let Ai=qe;Ai<Bt.length;Ai++)ve(Bt[Ai],Zt,ge,$e,He)},Ue=Bt=>{if(Bt.shapeFlag&6)return Ue(Bt.component.subTree);if(Bt.shapeFlag&128)return Bt.suspense.next();const Zt=y(Bt.anchor||Bt.el),ge=Zt&&Zt[Elt];return ge?y(ge):Zt};let Ze=!1;const xe=(Bt,Zt,ge)=>{Bt==null?Zt._vnode&&ve(Zt._vnode,null,null,!0):E(Zt._vnode||null,Bt,Zt,null,null,null,ge),Zt._vnode=Bt,Ze||(Ze=!0,jU(),b9(),Ze=!1)},Ke={p:E,um:ve,m:be,r:ke,mt:Dt,mc:it,pc:zt,pbc:ut,n:Ue,o:i};let We,Ti;return t&&([We,Ti]=t(Ke)),{render:xe,hydrate:We,createApp:Ylt(xe,We)}}function $P({type:i,props:t},e){return e==="svg"&&i==="foreignObject"||e==="mathml"&&i==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:e}function Kg({effect:i,job:t},e){e?(i.flags|=32,t.flags|=4):(i.flags&=-33,t.flags&=-5)}function aut(i,t){return(!i||i&&!i.pendingBranch)&&t&&!t.persisted}function V9(i,t,e=!1){const r=i.children,n=t.children;if(Hr(r)&&Hr(n))for(let o=0;o<r.length;o++){const s=r[o];let a=n[o];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[o]=ip(n[o]),a.el=s.el),!e&&a.patchFlag!==-2&&V9(s,a)),a.type===UM&&a.patchFlag!==-1&&(a.el=s.el),a.type===Pp&&!a.el&&(a.el=s.el)}}function out(i){const t=i.slice(),e=[0];let r,n,o,s,a;const c=i.length;for(r=0;r<c;r++){const f=i[r];if(f!==0){if(n=e[e.length-1],i[n]<f){t[r]=n,e.push(r);continue}for(o=0,s=e.length-1;o<s;)a=o+s>>1,i[e[a]]<f?o=a+1:s=a;f<i[e[o]]&&(o>0&&(t[r]=e[o-1]),e[o]=r)}}for(o=e.length,s=e[o-1];o-- >0;)e[o]=s,s=t[s];return e}function U9(i){const t=i.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:U9(t)}function JU(i){if(i)for(let t=0;t<i.length;t++)i[t].flags|=8}const sut=Symbol.for("v-scx"),lut=()=>Sd(sut);function tv(i,t,e){return G9(i,t,e)}function G9(i,t,e=Aa){const{immediate:r,deep:n,flush:o,once:s}=e,a=os({},e),c=t&&r||!t&&o!=="post";let f;if(Uw){if(o==="sync"){const w=lut();f=w.__watcherHandles||(w.__watcherHandles=[])}else if(!c){const w=()=>{};return w.stop=cc,w.resume=cc,w.pause=cc,w}}const g=ks;a.call=(w,I,E)=>yh(w,g,I,E);let v=!1;o==="post"?a.scheduler=w=>{Wl(w,g&&g.suspense)}:o!=="sync"&&(v=!0,a.scheduler=(w,I)=>{I?w():$B(w)}),a.augmentJob=w=>{t&&(w.flags|=4),v&&(w.flags|=2,g&&(w.id=g.uid,w.i=g))};const y=Alt(i,t,a);return Uw&&(f?f.push(y):c&&y()),y}function uut(i,t,e){const r=this.proxy,n=zo(i)?i.includes(".")?H9(r,i):()=>r[i]:i.bind(r,r);let o;dn(t)?o=t:(o=t.handler,e=t);const s=RS(this),a=G9(n,o.bind(r),e);return s(),a}function H9(i,t){const e=t.split(".");return()=>{let r=i;for(let n=0;n<e.length&&r;n++)r=r[e[n]];return r}}const cut=(i,t)=>t==="modelValue"||t==="model-value"?i.modelModifiers:i[`${t}Modifiers`]||i[`${ku(t)}Modifiers`]||i[`${Gp(t)}Modifiers`];function hut(i,t,...e){if(i.isUnmounted)return;const r=i.vnode.props||Aa;let n=e;const o=t.startsWith("update:"),s=o&&cut(r,t.slice(7));s&&(s.trim&&(n=e.map(g=>zo(g)?g.trim():g)),s.number&&(n=e.map(kM)));let a,c=r[a=VP(t)]||r[a=VP(ku(t))];!c&&o&&(c=r[a=VP(Gp(t))]),c&&yh(c,i,6,n);const f=r[a+"Once"];if(f){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,yh(f,i,6,n)}}const dut=new WeakMap;function j9(i,t,e=!1){const r=e?dut:t.emitsCache,n=r.get(i);if(n!==void 0)return n;const o=i.emits;let s={},a=!1;if(!dn(i)){const c=f=>{const g=j9(f,t,!0);g&&(a=!0,os(s,g))};!e&&t.mixins.length&&t.mixins.forEach(c),i.extends&&c(i.extends),i.mixins&&i.mixins.forEach(c)}return!o&&!a?(Ia(i)&&r.set(i,null),null):(Hr(o)?o.forEach(c=>s[c]=null):os(s,o),Ia(i)&&r.set(i,s),s)}function VM(i,t){return!i||!PM(t)?!1:(t=t.slice(2).replace(/Once$/,""),fa(i,t[0].toLowerCase()+t.slice(1))||fa(i,Gp(t))||fa(i,t))}function ZP(i){const{type:t,vnode:e,proxy:r,withProxy:n,propsOptions:[o],slots:s,attrs:a,emit:c,render:f,renderCache:g,props:v,data:y,setupState:w,ctx:I,inheritAttrs:E}=i,D=hC(i);let R,z;try{if(e.shapeFlag&4){const H=n||r,q=H;R=rh(f.call(q,H,g,v,w,y,I)),z=a}else{const H=t;R=rh(H.length>1?H(v,{attrs:a,slots:s,emit:c}):H(v,null)),z=t.props?a:fut(a)}}catch(H){mw.length=0,BM(H,i,1),R=Xn(Pp)}let N=R;if(z&&E!==!1){const H=Object.keys(z),{shapeFlag:q}=N;H.length&&q&7&&(o&&H.some(OB)&&(z=put(z,o)),N=f0(N,z,!1,!0))}return e.dirs&&(N=f0(N,null,!1,!0),N.dirs=N.dirs?N.dirs.concat(e.dirs):e.dirs),e.transition&&ZB(N,e.transition),R=N,hC(D),R}const fut=i=>{let t;for(const e in i)(e==="class"||e==="style"||PM(e))&&((t||(t={}))[e]=i[e]);return t},put=(i,t)=>{const e={};for(const r in i)(!OB(r)||!(r.slice(9)in t))&&(e[r]=i[r]);return e};function gut(i,t,e){const{props:r,children:n,component:o}=i,{props:s,children:a,patchFlag:c}=t,f=o.emitsOptions;if(t.dirs||t.transition)return!0;if(e&&c>=0){if(c&1024)return!0;if(c&16)return r?QU(r,s,f):!!s;if(c&8){const g=t.dynamicProps;for(let v=0;v<g.length;v++){const y=g[v];if(s[y]!==r[y]&&!VM(f,y))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:r===s?!1:r?s?QU(r,s,f):!0:!!s;return!1}function QU(i,t,e){const r=Object.keys(t);if(r.length!==Object.keys(i).length)return!0;for(let n=0;n<r.length;n++){const o=r[n];if(t[o]!==i[o]&&!VM(e,o))return!0}return!1}function mut({vnode:i,parent:t},e){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===i&&(r.el=i.el),r===i)(i=t.vnode).el=e,t=t.parent;else break}}const W9=i=>i.__isSuspense;function vut(i,t){t&&t.pendingBranch?Hr(i)?t.effects.push(...i):t.effects.push(i):Mlt(i)}const Xl=Symbol.for("v-fgt"),UM=Symbol.for("v-txt"),Pp=Symbol.for("v-cmt"),MI=Symbol.for("v-stc"),mw=[];let Ql=null;function Ka(i=!1){mw.push(Ql=i?null:[])}function _ut(){mw.pop(),Ql=mw[mw.length-1]||null}let Vw=1;function pC(i,t=!1){Vw+=i,i<0&&Ql&&t&&(Ql.hasOnce=!0)}function $9(i){return i.dynamicChildren=Vw>0?Ql||i0:null,_ut(),Vw>0&&Ql&&Ql.push(i),i}function _o(i,t,e,r,n,o){return $9(le(i,t,e,r,n,o,!0))}function Z9(i,t,e,r,n){return $9(Xn(i,t,e,r,n,!0))}function gC(i){return i?i.__v_isVNode===!0:!1}function ab(i,t){return i.type===t.type&&i.key===t.key}const q9=({key:i})=>i??null,EI=({ref:i,ref_key:t,ref_for:e})=>(typeof i=="number"&&(i=""+i),i!=null?zo(i)||zs(i)||dn(i)?{i:Jl,r:i,k:t,f:!!e}:i:null);function le(i,t=null,e=null,r=0,n=null,o=i===Xl?0:1,s=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:i,props:t,key:t&&q9(t),ref:t&&EI(t),scopeId:S9,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:r,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Jl};return a?(JB(c,e),o&128&&i.normalize(c)):e&&(c.shapeFlag|=zo(e)?8:16),Vw>0&&!s&&Ql&&(c.patchFlag>0||o&6)&&c.patchFlag!==32&&Ql.push(c),c}const Xn=yut;function yut(i,t=null,e=null,r=0,n=null,o=!1){if((!i||i===Ult)&&(i=Pp),gC(i)){const a=f0(i,t,!0);return e&&JB(a,e),Vw>0&&!o&&Ql&&(a.shapeFlag&6?Ql[Ql.indexOf(i)]=a:Ql.push(a)),a.patchFlag=-2,a}if(Put(i)&&(i=i.__vccOpts),t){t=xut(t);let{class:a,style:c}=t;a&&!zo(a)&&(t.class=md(a)),Ia(c)&&(WB(c)&&!Hr(c)&&(c=os({},c)),t.style=O0(c))}const s=zo(i)?1:W9(i)?128:Dlt(i)?64:Ia(i)?4:dn(i)?2:0;return le(i,t,e,r,n,s,o,!0)}function xut(i){return i?WB(i)||k9(i)?os({},i):i:null}function f0(i,t,e=!1,r=!1){const{props:n,ref:o,patchFlag:s,children:a,transition:c}=i,f=t?but(n||{},t):n,g={__v_isVNode:!0,__v_skip:!0,type:i.type,props:f,key:f&&q9(f),ref:t&&t.ref?e&&o?Hr(o)?o.concat(EI(t)):[o,EI(t)]:EI(t):o,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:t&&i.type!==Xl?s===-1?16:s|16:s,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:c,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&f0(i.ssContent),ssFallback:i.ssFallback&&f0(i.ssFallback),placeholder:i.placeholder,el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return c&&r&&ZB(g,c.clone(g)),g}function Dn(i=" ",t=0){return Xn(UM,null,i,t)}function ep(i,t){const e=Xn(MI,null,i);return e.staticCount=t,e}function ev(i="",t=!1){return t?(Ka(),Z9(Pp,null,i)):Xn(Pp,null,i)}function rh(i){return i==null||typeof i=="boolean"?Xn(Pp):Hr(i)?Xn(Xl,null,i.slice()):gC(i)?ip(i):Xn(UM,null,String(i))}function ip(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:f0(i)}function JB(i,t){let e=0;const{shapeFlag:r}=i;if(t==null)t=null;else if(Hr(t))e=16;else if(typeof t=="object")if(r&65){const n=t.default;n&&(n._c&&(n._d=!1),JB(i,n()),n._c&&(n._d=!0));return}else{e=32;const n=t._;!n&&!k9(t)?t._ctx=Jl:n===3&&Jl&&(Jl.slots._===1?t._=1:(t._=2,i.patchFlag|=1024))}else dn(t)?(t={default:t,_ctx:Jl},e=32):(t=String(t),r&64?(e=16,t=[Dn(t)]):e=8);i.children=t,i.shapeFlag|=e}function but(...i){const t={};for(let e=0;e<i.length;e++){const r=i[e];for(const n in r)if(n==="class")t.class!==r.class&&(t.class=md([t.class,r.class]));else if(n==="style")t.style=O0([t.style,r.style]);else if(PM(n)){const o=t[n],s=r[n];s&&o!==s&&!(Hr(o)&&o.includes(s))&&(t[n]=o?[].concat(o,s):s)}else n!==""&&(t[n]=r[n])}return t}function Hc(i,t,e,r=null){yh(i,t,7,[e,r])}const wut=P9();let Sut=0;function Tut(i,t,e){const r=i.type,n=(t?t.appContext:i.appContext)||wut,o={uid:Sut++,vnode:i,type:r,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Jst(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:z9(r,n),emitsOptions:j9(r,n),emit:null,emitted:null,propsDefaults:Aa,inheritAttrs:r.inheritAttrs,ctx:Aa,data:Aa,props:Aa,attrs:Aa,slots:Aa,refs:Aa,setupState:Aa,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=t?t.root:o,o.emit=hut.bind(null,o),i.ce&&i.ce(o),o}let ks=null;const Aut=()=>ks||Jl;let mC,Jk;{const i=OM(),t=(e,r)=>{let n;return(n=i[e])||(n=i[e]=[]),n.push(r),o=>{n.length>1?n.forEach(s=>s(o)):n[0](o)}};mC=t("__VUE_INSTANCE_SETTERS__",e=>ks=e),Jk=t("__VUE_SSR_SETTERS__",e=>Uw=e)}const RS=i=>{const t=ks;return mC(i),i.scope.on(),()=>{i.scope.off(),mC(t)}},tG=()=>{ks&&ks.scope.off(),mC(null)};function X9(i){return i.vnode.shapeFlag&4}let Uw=!1;function Iut(i,t=!1,e=!1){t&&Jk(t);const{props:r,children:n}=i.vnode,o=X9(i);Klt(i,r,o,t),eut(i,n,e||t);const s=o?Cut(i,t):void 0;return t&&Jk(!1),s}function Cut(i,t){const e=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,Hlt);const{setup:r}=e;if(r){Dd();const n=i.setupContext=r.length>1?Eut(i):null,o=RS(i),s=PS(r,i,0,[i.props,n]),a=X7(s);if(Pd(),o(),(a||i.sp)&&!pw(i)&&A9(i),a){if(s.then(tG,tG),t)return s.then(c=>{eG(i,c,t)}).catch(c=>{BM(c,i,0)});i.asyncDep=s}else eG(i,s,t)}else Y9(i,t)}function eG(i,t,e){dn(t)?i.type.__ssrInlineRender?i.ssrRender=t:i.render=t:Ia(t)&&(i.setupState=_9(t)),Y9(i,e)}let iG;function Y9(i,t,e){const r=i.type;if(!i.render){if(!t&&iG&&!r.render){const n=r.template||XB(i).template;if(n){const{isCustomElement:o,compilerOptions:s}=i.appContext.config,{delimiters:a,compilerOptions:c}=r,f=os(os({isCustomElement:o,delimiters:a},s),c);r.render=iG(n,f)}}i.render=r.render||cc}{const n=RS(i);Dd();try{jlt(i)}finally{Pd(),n()}}}const Mut={get(i,t){return Ls(i,"get",""),i[t]}};function Eut(i){const t=e=>{i.exposed=e||{}};return{attrs:new Proxy(i.attrs,Mut),slots:i.slots,emit:i.emit,expose:t}}function GM(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(_9(_lt(i.exposed)),{get(t,e){if(e in t)return t[e];if(e in gw)return gw[e](i)},has(t,e){return e in t||e in gw}})):i.proxy}function Dut(i,t=!0){return dn(i)?i.displayName||i.name:i.name||t&&i.__name}function Put(i){return dn(i)&&"__vccOpts"in i}const Yl=(i,t)=>Slt(i,t,Uw);function K9(i,t,e){try{pC(-1);const r=arguments.length;return r===2?Ia(t)&&!Hr(t)?gC(t)?Xn(i,null,[t]):Xn(i,t):Xn(i,null,t):(r>3?e=Array.prototype.slice.call(arguments,2):r===3&&gC(e)&&(e=[e]),Xn(i,t,e))}finally{pC(1)}}const Lut="3.5.24";/**
* @vue/runtime-dom v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Qk;const rG=typeof window<"u"&&window.trustedTypes;if(rG)try{Qk=rG.createPolicy("vue",{createHTML:i=>i})}catch{}const J9=Qk?i=>Qk.createHTML(i):i=>i,Rut="http://www.w3.org/2000/svg",kut="http://www.w3.org/1998/Math/MathML",ld=typeof document<"u"?document:null,nG=ld&&ld.createElement("template"),Out={insert:(i,t,e)=>{t.insertBefore(i,e||null)},remove:i=>{const t=i.parentNode;t&&t.removeChild(i)},createElement:(i,t,e,r)=>{const n=t==="svg"?ld.createElementNS(Rut,i):t==="mathml"?ld.createElementNS(kut,i):e?ld.createElement(i,{is:e}):ld.createElement(i);return i==="select"&&r&&r.multiple!=null&&n.setAttribute("multiple",r.multiple),n},createText:i=>ld.createTextNode(i),createComment:i=>ld.createComment(i),setText:(i,t)=>{i.nodeValue=t},setElementText:(i,t)=>{i.textContent=t},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>ld.querySelector(i),setScopeId(i,t){i.setAttribute(t,"")},insertStaticContent(i,t,e,r,n,o){const s=e?e.previousSibling:t.lastChild;if(n&&(n===o||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),e),!(n===o||!(n=n.nextSibling)););else{nG.innerHTML=J9(r==="svg"?`<svg>${i}</svg>`:r==="mathml"?`<math>${i}</math>`:i);const a=nG.content;if(r==="svg"||r==="mathml"){const c=a.firstChild;for(;c.firstChild;)a.appendChild(c.firstChild);a.removeChild(c)}t.insertBefore(a,e)}return[s?s.nextSibling:t.firstChild,e?e.previousSibling:t.lastChild]}},zut=Symbol("_vtc");function But(i,t,e){const r=i[zut];r&&(t=(t?[t,...r]:[...r]).join(" ")),t==null?i.removeAttribute("class"):e?i.setAttribute("class",t):i.className=t}const aG=Symbol("_vod"),Fut=Symbol("_vsh"),Nut=Symbol(""),Vut=/(?:^|;)\s*display\s*:/;function Uut(i,t,e){const r=i.style,n=zo(e);let o=!1;if(e&&!n){if(t)if(zo(t))for(const s of t.split(";")){const a=s.slice(0,s.indexOf(":")).trim();e[a]==null&&DI(r,a,"")}else for(const s in t)e[s]==null&&DI(r,s,"");for(const s in e)s==="display"&&(o=!0),DI(r,s,e[s])}else if(n){if(t!==e){const s=r[Nut];s&&(e+=";"+s),r.cssText=e,o=Vut.test(e)}}else t&&i.removeAttribute("style");aG in i&&(i[aG]=o?r.display:"",i[Fut]&&(r.display="none"))}const oG=/\s*!important$/;function DI(i,t,e){if(Hr(e))e.forEach(r=>DI(i,t,r));else if(e==null&&(e=""),t.startsWith("--"))i.setProperty(t,e);else{const r=Gut(i,t);oG.test(e)?i.setProperty(Gp(r),e.replace(oG,""),"important"):i[r]=e}}const sG=["Webkit","Moz","ms"],qP={};function Gut(i,t){const e=qP[t];if(e)return e;let r=ku(t);if(r!=="filter"&&r in i)return qP[t]=r;r=RM(r);for(let n=0;n<sG.length;n++){const o=sG[n]+r;if(o in i)return qP[t]=o}return t}const lG="http://www.w3.org/1999/xlink";function uG(i,t,e,r,n,o=Yst(t)){r&&t.startsWith("xlink:")?e==null?i.removeAttributeNS(lG,t.slice(6,t.length)):i.setAttributeNS(lG,t,e):e==null||o&&!Q7(e)?i.removeAttribute(t):i.setAttribute(t,o?"":_h(e)?String(e):e)}function cG(i,t,e,r,n){if(t==="innerHTML"||t==="textContent"){e!=null&&(i[t]=t==="innerHTML"?J9(e):e);return}const o=i.tagName;if(t==="value"&&o!=="PROGRESS"&&!o.includes("-")){const a=o==="OPTION"?i.getAttribute("value")||"":i.value,c=e==null?i.type==="checkbox"?"on":"":String(e);(a!==c||!("_value"in i))&&(i.value=c),e==null&&i.removeAttribute(t),i._value=e;return}let s=!1;if(e===""||e==null){const a=typeof i[t];a==="boolean"?e=Q7(e):e==null&&a==="string"?(e="",s=!0):a==="number"&&(e=0,s=!0)}try{i[t]=e}catch{}s&&i.removeAttribute(n||t)}function op(i,t,e,r){i.addEventListener(t,e,r)}function Hut(i,t,e,r){i.removeEventListener(t,e,r)}const hG=Symbol("_vei");function jut(i,t,e,r,n=null){const o=i[hG]||(i[hG]={}),s=o[t];if(r&&s)s.value=r;else{const[a,c]=Wut(t);if(r){const f=o[t]=qut(r,n);op(i,a,f,c)}else s&&(Hut(i,a,s,c),o[t]=void 0)}}const dG=/(?:Once|Passive|Capture)$/;function Wut(i){let t;if(dG.test(i)){t={};let r;for(;r=i.match(dG);)i=i.slice(0,i.length-r[0].length),t[r[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):Gp(i.slice(2)),t]}let XP=0;const $ut=Promise.resolve(),Zut=()=>XP||($ut.then(()=>XP=0),XP=Date.now());function qut(i,t){const e=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=e.attached)return;yh(Xut(r,e.value),t,5,[r])};return e.value=i,e.attached=Zut(),e}function Xut(i,t){if(Hr(t)){const e=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{e.call(i),i._stopped=!0},t.map(r=>n=>!n._stopped&&r&&r(n))}else return t}const fG=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,Yut=(i,t,e,r,n,o)=>{const s=n==="svg";t==="class"?But(i,r,s):t==="style"?Uut(i,e,r):PM(t)?OB(t)||jut(i,t,e,r,o):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Kut(i,t,r,s))?(cG(i,t,r),!i.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&uG(i,t,r,s,o,t!=="value")):i._isVueCE&&(/[A-Z]/.test(t)||!zo(r))?cG(i,ku(t),r,o,t):(t==="true-value"?i._trueValue=r:t==="false-value"&&(i._falseValue=r),uG(i,t,r,s))};function Kut(i,t,e,r){if(r)return!!(t==="innerHTML"||t==="textContent"||t in i&&fG(t)&&dn(e));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&i.tagName==="IFRAME"||t==="form"||t==="list"&&i.tagName==="INPUT"||t==="type"&&i.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const n=i.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return fG(t)&&zo(e)?!1:t in i}const p0=i=>{const t=i.props["onUpdate:modelValue"]||!1;return Hr(t)?e=>II(t,e):t};function Jut(i){i.target.composing=!0}function pG(i){const t=i.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Td=Symbol("_assign");function gG(i,t,e){return t&&(i=i.trim()),e&&(i=kM(i)),i}const mG={created(i,{modifiers:{lazy:t,trim:e,number:r}},n){i[Td]=p0(n);const o=r||n.props&&n.props.type==="number";op(i,t?"change":"input",s=>{s.target.composing||i[Td](gG(i.value,e,o))}),(e||o)&&op(i,"change",()=>{i.value=gG(i.value,e,o)}),t||(op(i,"compositionstart",Jut),op(i,"compositionend",pG),op(i,"change",pG))},mounted(i,{value:t}){i.value=t??""},beforeUpdate(i,{value:t,oldValue:e,modifiers:{lazy:r,trim:n,number:o}},s){if(i[Td]=p0(s),i.composing)return;const a=(o||i.type==="number")&&!/^0\d/.test(i.value)?kM(i.value):i.value,c=t??"";a!==c&&(document.activeElement===i&&i.type!=="range"&&(r&&t===e||n&&i.value.trim()===c)||(i.value=c))}},py={deep:!0,created(i,t,e){i[Td]=p0(e),op(i,"change",()=>{const r=i._modelValue,n=Gw(i),o=i.checked,s=i[Td];if(Hr(r)){const a=FB(r,n),c=a!==-1;if(o&&!c)s(r.concat(n));else if(!o&&c){const f=[...r];f.splice(a,1),s(f)}}else if(k0(r)){const a=new Set(r);o?a.add(n):a.delete(n),s(a)}else s(Q9(i,o))})},mounted:vG,beforeUpdate(i,t,e){i[Td]=p0(e),vG(i,t,e)}};function vG(i,{value:t,oldValue:e},r){i._modelValue=t;let n;if(Hr(t))n=FB(t,r.props.value)>-1;else if(k0(t))n=t.has(r.props.value);else{if(t===e)return;n=ES(t,Q9(i,!0))}i.checked!==n&&(i.checked=n)}const q2={deep:!0,created(i,{value:t,modifiers:{number:e}},r){const n=k0(t);op(i,"change",()=>{const o=Array.prototype.filter.call(i.options,s=>s.selected).map(s=>e?kM(Gw(s)):Gw(s));i[Td](i.multiple?n?new Set(o):o:o[0]),i._assigning=!0,Fw(()=>{i._assigning=!1})}),i[Td]=p0(r)},mounted(i,{value:t}){_G(i,t)},beforeUpdate(i,t,e){i[Td]=p0(e)},updated(i,{value:t}){i._assigning||_G(i,t)}};function _G(i,t){const e=i.multiple,r=Hr(t);if(!(e&&!r&&!k0(t))){for(let n=0,o=i.options.length;n<o;n++){const s=i.options[n],a=Gw(s);if(e)if(r){const c=typeof a;c==="string"||c==="number"?s.selected=t.some(f=>String(f)===String(a)):s.selected=FB(t,a)>-1}else s.selected=t.has(a);else if(ES(Gw(s),t)){i.selectedIndex!==n&&(i.selectedIndex=n);return}}!e&&i.selectedIndex!==-1&&(i.selectedIndex=-1)}}function Gw(i){return"_value"in i?i._value:i.value}function Q9(i,t){const e=t?"_trueValue":"_falseValue";return e in i?i[e]:t}const Qut=["ctrl","shift","alt","meta"],tct={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,t)=>Qut.some(e=>i[`${e}Key`]&&!t.includes(e))},ect=(i,t)=>{const e=i._withMods||(i._withMods={}),r=t.join(".");return e[r]||(e[r]=(n,...o)=>{for(let s=0;s<t.length;s++){const a=tct[t[s]];if(a&&a(n,t))return}return i(n,...o)})},ict={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},rct=(i,t)=>{const e=i._withKeys||(i._withKeys={}),r=t.join(".");return e[r]||(e[r]=n=>{if(!("key"in n))return;const o=Gp(n.key);if(t.some(s=>s===o||ict[s]===o))return i(n)})},nct=os({patchProp:Yut},Out);let yG;function act(){return yG||(yG=rut(nct))}const tO=(...i)=>{const t=act().createApp(...i),{mount:e}=t;return t.mount=r=>{const n=sct(r);if(!n)return;const o=t._component;!dn(o)&&!o.render&&!o.template&&(o.template=n.innerHTML),n.nodeType===1&&(n.textContent="");const s=e(n,!1,oct(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),s},t};function oct(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function sct(i){return zo(i)?document.querySelector(i):i}const Gd=(i,t)=>{const e=i.__vccOpts||i;for(const[r,n]of t)e[r]=n;return e},lct={};function uct(i,t){const e=Qm("router-view");return Ka(),Z9(e)}const cct=Gd(lct,[["render",uct]]),hct="modulepreload",dct=function(i){return"/casa0017-web-assessment-EcoVision/"+i},xG={},fct=function(t,e,r){if(!e||e.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(e.map(o=>{if(o=dct(o),o in xG)return;xG[o]=!0;const s=o.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(!!r)for(let g=n.length-1;g>=0;g--){const v=n[g];if(v.href===o&&(!s||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const f=document.createElement("link");if(f.rel=s?"stylesheet":hct,s||(f.as="script",f.crossOrigin=""),f.href=o,document.head.appendChild(f),s)return new Promise((g,v)=>{f.addEventListener("load",g),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o})};/*!
 * vue-router v4.6.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */const jy=typeof document<"u";function tX(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}function pct(i){return i.__esModule||i[Symbol.toStringTag]==="Module"||i.default&&tX(i.default)}const ha=Object.assign;function YP(i,t){const e={};for(const r in t){const n=t[r];e[r]=mc(n)?n.map(i):i(n)}return e}const vw=()=>{},mc=Array.isArray;function bG(i,t){const e={};for(const r in i)e[r]=r in t?t[r]:i[r];return e}const eX=/#/g,gct=/&/g,mct=/\//g,vct=/=/g,_ct=/\?/g,iX=/\+/g,yct=/%5B/g,xct=/%5D/g,rX=/%5E/g,bct=/%60/g,nX=/%7B/g,wct=/%7C/g,aX=/%7D/g,Sct=/%20/g;function QB(i){return i==null?"":encodeURI(""+i).replace(wct,"|").replace(yct,"[").replace(xct,"]")}function Tct(i){return QB(i).replace(nX,"{").replace(aX,"}").replace(rX,"^")}function eO(i){return QB(i).replace(iX,"%2B").replace(Sct,"+").replace(eX,"%23").replace(gct,"%26").replace(bct,"`").replace(nX,"{").replace(aX,"}").replace(rX,"^")}function Act(i){return eO(i).replace(vct,"%3D")}function Ict(i){return QB(i).replace(eX,"%23").replace(_ct,"%3F")}function Cct(i){return Ict(i).replace(mct,"%2F")}function Hw(i){if(i==null)return null;try{return decodeURIComponent(""+i)}catch{}return""+i}const Mct=/\/$/,Ect=i=>i.replace(Mct,"");function KP(i,t,e="/"){let r,n={},o="",s="";const a=t.indexOf("#");let c=t.indexOf("?");return c=a>=0&&c>a?-1:c,c>=0&&(r=t.slice(0,c),o=t.slice(c,a>0?a:t.length),n=i(o.slice(1))),a>=0&&(r=r||t.slice(0,a),s=t.slice(a,t.length)),r=Rct(r??t,e),{fullPath:r+o+s,path:r,query:n,hash:Hw(s)}}function Dct(i,t){const e=t.query?i(t.query):"";return t.path+(e&&"?")+e+(t.hash||"")}function wG(i,t){return!t||!i.toLowerCase().startsWith(t.toLowerCase())?i:i.slice(t.length)||"/"}function Pct(i,t,e){const r=t.matched.length-1,n=e.matched.length-1;return r>-1&&r===n&&g0(t.matched[r],e.matched[n])&&oX(t.params,e.params)&&i(t.query)===i(e.query)&&t.hash===e.hash}function g0(i,t){return(i.aliasOf||i)===(t.aliasOf||t)}function oX(i,t){if(Object.keys(i).length!==Object.keys(t).length)return!1;for(const e in i)if(!Lct(i[e],t[e]))return!1;return!0}function Lct(i,t){return mc(i)?SG(i,t):mc(t)?SG(t,i):i===t}function SG(i,t){return mc(t)?i.length===t.length&&i.every((e,r)=>e===t[r]):i.length===1&&i[0]===t}function Rct(i,t){if(i.startsWith("/"))return i;if(!i)return t;const e=t.split("/"),r=i.split("/"),n=r[r.length-1];(n===".."||n===".")&&r.push("");let o=e.length-1,s,a;for(s=0;s<r.length;s++)if(a=r[s],a!==".")if(a==="..")o>1&&o--;else break;return e.slice(0,o).join("/")+"/"+r.slice(s).join("/")}const Vf={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let iO=function(i){return i.pop="pop",i.push="push",i}({}),JP=function(i){return i.back="back",i.forward="forward",i.unknown="",i}({});function kct(i){if(!i)if(jy){const t=document.querySelector("base");i=t&&t.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),Ect(i)}const Oct=/^[^#]+#/;function zct(i,t){return i.replace(Oct,"#")+t}function Bct(i,t){const e=document.documentElement.getBoundingClientRect(),r=i.getBoundingClientRect();return{behavior:t.behavior,left:r.left-e.left-(t.left||0),top:r.top-e.top-(t.top||0)}}const HM=()=>({left:window.scrollX,top:window.scrollY});function Fct(i){let t;if("el"in i){const e=i.el,r=typeof e=="string"&&e.startsWith("#"),n=typeof e=="string"?r?document.getElementById(e.slice(1)):document.querySelector(e):e;if(!n)return;t=Bct(n,i)}else t=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function TG(i,t){return(history.state?history.state.position-t:-1)+i}const rO=new Map;function Nct(i,t){rO.set(i,t)}function Vct(i){const t=rO.get(i);return rO.delete(i),t}function Uct(i){return typeof i=="string"||i&&typeof i=="object"}function sX(i){return typeof i=="string"||typeof i=="symbol"}let so=function(i){return i[i.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",i[i.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",i[i.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",i[i.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",i[i.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",i}({});const lX=Symbol("");so.MATCHER_NOT_FOUND+"",so.NAVIGATION_GUARD_REDIRECT+"",so.NAVIGATION_ABORTED+"",so.NAVIGATION_CANCELLED+"",so.NAVIGATION_DUPLICATED+"";function m0(i,t){return ha(new Error,{type:i,[lX]:!0},t)}function Qh(i,t){return i instanceof Error&&lX in i&&(t==null||!!(i.type&t))}const Gct=["params","query","hash"];function Hct(i){if(typeof i=="string")return i;if(i.path!=null)return i.path;const t={};for(const e of Gct)e in i&&(t[e]=i[e]);return JSON.stringify(t,null,2)}function jct(i){const t={};if(i===""||i==="?")return t;const e=(i[0]==="?"?i.slice(1):i).split("&");for(let r=0;r<e.length;++r){const n=e[r].replace(iX," "),o=n.indexOf("="),s=Hw(o<0?n:n.slice(0,o)),a=o<0?null:Hw(n.slice(o+1));if(s in t){let c=t[s];mc(c)||(c=t[s]=[c]),c.push(a)}else t[s]=a}return t}function AG(i){let t="";for(let e in i){const r=i[e];if(e=Act(e),r==null){r!==void 0&&(t+=(t.length?"&":"")+e);continue}(mc(r)?r.map(n=>n&&eO(n)):[r&&eO(r)]).forEach(n=>{n!==void 0&&(t+=(t.length?"&":"")+e,n!=null&&(t+="="+n))})}return t}function Wct(i){const t={};for(const e in i){const r=i[e];r!==void 0&&(t[e]=mc(r)?r.map(n=>n==null?null:""+n):r==null?r:""+r)}return t}const $ct=Symbol(""),IG=Symbol(""),tF=Symbol(""),uX=Symbol(""),nO=Symbol("");function ob(){let i=[];function t(r){return i.push(r),()=>{const n=i.indexOf(r);n>-1&&i.splice(n,1)}}function e(){i=[]}return{add:t,list:()=>i.slice(),reset:e}}function rp(i,t,e,r,n,o=s=>s()){const s=r&&(r.enterCallbacks[n]=r.enterCallbacks[n]||[]);return()=>new Promise((a,c)=>{const f=y=>{y===!1?c(m0(so.NAVIGATION_ABORTED,{from:e,to:t})):y instanceof Error?c(y):Uct(y)?c(m0(so.NAVIGATION_GUARD_REDIRECT,{from:t,to:y})):(s&&r.enterCallbacks[n]===s&&typeof y=="function"&&s.push(y),a())},g=o(()=>i.call(r&&r.instances[n],t,e,f));let v=Promise.resolve(g);i.length<3&&(v=v.then(f)),v.catch(y=>c(y))})}function QP(i,t,e,r,n=o=>o()){const o=[];for(const s of i)for(const a in s.components){let c=s.components[a];if(!(t!=="beforeRouteEnter"&&!s.instances[a]))if(tX(c)){const f=(c.__vccOpts||c)[t];f&&o.push(rp(f,e,r,s,a,n))}else{let f=c();o.push(()=>f.then(g=>{if(!g)throw new Error(`Couldn't resolve component "${a}" at "${s.path}"`);const v=pct(g)?g.default:g;s.mods[a]=g,s.components[a]=v;const y=(v.__vccOpts||v)[t];return y&&rp(y,e,r,s,a,n)()}))}}return o}function Zct(i,t){const e=[],r=[],n=[],o=Math.max(t.matched.length,i.matched.length);for(let s=0;s<o;s++){const a=t.matched[s];a&&(i.matched.find(f=>g0(f,a))?r.push(a):e.push(a));const c=i.matched[s];c&&(t.matched.find(f=>g0(f,c))||n.push(c))}return[e,r,n]}/*!
 * vue-router v4.6.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let qct=()=>location.protocol+"//"+location.host;function cX(i,t){const{pathname:e,search:r,hash:n}=t,o=i.indexOf("#");if(o>-1){let s=n.includes(i.slice(o))?i.slice(o).length:1,a=n.slice(s);return a[0]!=="/"&&(a="/"+a),wG(a,"")}return wG(e,i)+r+n}function Xct(i,t,e,r){let n=[],o=[],s=null;const a=({state:y})=>{const w=cX(i,location),I=e.value,E=t.value;let D=0;if(y){if(e.value=w,t.value=y,s&&s===I){s=null;return}D=E?y.position-E.position:0}else r(w);n.forEach(R=>{R(e.value,I,{delta:D,type:iO.pop,direction:D?D>0?JP.forward:JP.back:JP.unknown})})};function c(){s=e.value}function f(y){n.push(y);const w=()=>{const I=n.indexOf(y);I>-1&&n.splice(I,1)};return o.push(w),w}function g(){if(document.visibilityState==="hidden"){const{history:y}=window;if(!y.state)return;y.replaceState(ha({},y.state,{scroll:HM()}),"")}}function v(){for(const y of o)y();o=[],window.removeEventListener("popstate",a),window.removeEventListener("pagehide",g),document.removeEventListener("visibilitychange",g)}return window.addEventListener("popstate",a),window.addEventListener("pagehide",g),document.addEventListener("visibilitychange",g),{pauseListeners:c,listen:f,destroy:v}}function CG(i,t,e,r=!1,n=!1){return{back:i,current:t,forward:e,replaced:r,position:window.history.length,scroll:n?HM():null}}function Yct(i){const{history:t,location:e}=window,r={value:cX(i,e)},n={value:t.state};n.value||o(r.value,{back:null,current:r.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function o(c,f,g){const v=i.indexOf("#"),y=v>-1?(e.host&&document.querySelector("base")?i:i.slice(v))+c:qct()+i+c;try{t[g?"replaceState":"pushState"](f,"",y),n.value=f}catch(w){console.error(w),e[g?"replace":"assign"](y)}}function s(c,f){o(c,ha({},t.state,CG(n.value.back,c,n.value.forward,!0),f,{position:n.value.position}),!0),r.value=c}function a(c,f){const g=ha({},n.value,t.state,{forward:c,scroll:HM()});o(g.current,g,!0),o(c,ha({},CG(r.value,c,null),{position:g.position+1},f),!1),r.value=c}return{location:r,state:n,push:a,replace:s}}function Kct(i){i=kct(i);const t=Yct(i),e=Xct(i,t.state,t.location,t.replace);function r(o,s=!0){s||e.pauseListeners(),history.go(o)}const n=ha({location:"",base:i,go:r,createHref:zct.bind(null,i)},t,e);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>t.state.value}),n}let Gm=function(i){return i[i.Static=0]="Static",i[i.Param=1]="Param",i[i.Group=2]="Group",i}({});var jo=function(i){return i[i.Static=0]="Static",i[i.Param=1]="Param",i[i.ParamRegExp=2]="ParamRegExp",i[i.ParamRegExpEnd=3]="ParamRegExpEnd",i[i.EscapeNext=4]="EscapeNext",i}(jo||{});const Jct={type:Gm.Static,value:""},Qct=/[a-zA-Z0-9_]/;function tht(i){if(!i)return[[]];if(i==="/")return[[Jct]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function t(w){throw new Error(`ERR (${e})/"${f}": ${w}`)}let e=jo.Static,r=e;const n=[];let o;function s(){o&&n.push(o),o=[]}let a=0,c,f="",g="";function v(){f&&(e===jo.Static?o.push({type:Gm.Static,value:f}):e===jo.Param||e===jo.ParamRegExp||e===jo.ParamRegExpEnd?(o.length>1&&(c==="*"||c==="+")&&t(`A repeatable param (${f}) must be alone in its segment. eg: '/:ids+.`),o.push({type:Gm.Param,value:f,regexp:g,repeatable:c==="*"||c==="+",optional:c==="*"||c==="?"})):t("Invalid state to consume buffer"),f="")}function y(){f+=c}for(;a<i.length;){if(c=i[a++],c==="\\"&&e!==jo.ParamRegExp){r=e,e=jo.EscapeNext;continue}switch(e){case jo.Static:c==="/"?(f&&v(),s()):c===":"?(v(),e=jo.Param):y();break;case jo.EscapeNext:y(),e=r;break;case jo.Param:c==="("?e=jo.ParamRegExp:Qct.test(c)?y():(v(),e=jo.Static,c!=="*"&&c!=="?"&&c!=="+"&&a--);break;case jo.ParamRegExp:c===")"?g[g.length-1]=="\\"?g=g.slice(0,-1)+c:e=jo.ParamRegExpEnd:g+=c;break;case jo.ParamRegExpEnd:v(),e=jo.Static,c!=="*"&&c!=="?"&&c!=="+"&&a--,g="";break;default:t("Unknown state");break}}return e===jo.ParamRegExp&&t(`Unfinished custom RegExp for param "${f}"`),v(),s(),n}const MG="[^/]+?",eht={sensitive:!1,strict:!1,start:!0,end:!0};var sl=function(i){return i[i._multiplier=10]="_multiplier",i[i.Root=90]="Root",i[i.Segment=40]="Segment",i[i.SubSegment=30]="SubSegment",i[i.Static=40]="Static",i[i.Dynamic=20]="Dynamic",i[i.BonusCustomRegExp=10]="BonusCustomRegExp",i[i.BonusWildcard=-50]="BonusWildcard",i[i.BonusRepeatable=-20]="BonusRepeatable",i[i.BonusOptional=-8]="BonusOptional",i[i.BonusStrict=.7000000000000001]="BonusStrict",i[i.BonusCaseSensitive=.25]="BonusCaseSensitive",i}(sl||{});const iht=/[.+*?^${}()[\]/\\]/g;function rht(i,t){const e=ha({},eht,t),r=[];let n=e.start?"^":"";const o=[];for(const f of i){const g=f.length?[]:[sl.Root];e.strict&&!f.length&&(n+="/");for(let v=0;v<f.length;v++){const y=f[v];let w=sl.Segment+(e.sensitive?sl.BonusCaseSensitive:0);if(y.type===Gm.Static)v||(n+="/"),n+=y.value.replace(iht,"\\$&"),w+=sl.Static;else if(y.type===Gm.Param){const{value:I,repeatable:E,optional:D,regexp:R}=y;o.push({name:I,repeatable:E,optional:D});const z=R||MG;if(z!==MG){w+=sl.BonusCustomRegExp;try{`${z}`}catch(H){throw new Error(`Invalid custom RegExp for param "${I}" (${z}): `+H.message)}}let N=E?`((?:${z})(?:/(?:${z}))*)`:`(${z})`;v||(N=D&&f.length<2?`(?:/${N})`:"/"+N),D&&(N+="?"),n+=N,w+=sl.Dynamic,D&&(w+=sl.BonusOptional),E&&(w+=sl.BonusRepeatable),z===".*"&&(w+=sl.BonusWildcard)}g.push(w)}r.push(g)}if(e.strict&&e.end){const f=r.length-1;r[f][r[f].length-1]+=sl.BonusStrict}e.strict||(n+="/?"),e.end?n+="$":e.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const s=new RegExp(n,e.sensitive?"":"i");function a(f){const g=f.match(s),v={};if(!g)return null;for(let y=1;y<g.length;y++){const w=g[y]||"",I=o[y-1];v[I.name]=w&&I.repeatable?w.split("/"):w}return v}function c(f){let g="",v=!1;for(const y of i){(!v||!g.endsWith("/"))&&(g+="/"),v=!1;for(const w of y)if(w.type===Gm.Static)g+=w.value;else if(w.type===Gm.Param){const{value:I,repeatable:E,optional:D}=w,R=I in f?f[I]:"";if(mc(R)&&!E)throw new Error(`Provided param "${I}" is an array but it is not repeatable (* or + modifiers)`);const z=mc(R)?R.join("/"):R;if(!z)if(D)y.length<2&&(g.endsWith("/")?g=g.slice(0,-1):v=!0);else throw new Error(`Missing required param "${I}"`);g+=z}}return g||"/"}return{re:s,score:r,keys:o,parse:a,stringify:c}}function nht(i,t){let e=0;for(;e<i.length&&e<t.length;){const r=t[e]-i[e];if(r)return r;e++}return i.length<t.length?i.length===1&&i[0]===sl.Static+sl.Segment?-1:1:i.length>t.length?t.length===1&&t[0]===sl.Static+sl.Segment?1:-1:0}function hX(i,t){let e=0;const r=i.score,n=t.score;for(;e<r.length&&e<n.length;){const o=nht(r[e],n[e]);if(o)return o;e++}if(Math.abs(n.length-r.length)===1){if(EG(r))return 1;if(EG(n))return-1}return n.length-r.length}function EG(i){const t=i[i.length-1];return i.length>0&&t[t.length-1]<0}const aht={strict:!1,end:!0,sensitive:!1};function oht(i,t,e){const r=rht(tht(i.path),e),n=ha(r,{record:i,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf==!t.record.aliasOf&&t.children.push(n),n}function sht(i,t){const e=[],r=new Map;t=bG(aht,t);function n(v){return r.get(v)}function o(v,y,w){const I=!w,E=PG(v);E.aliasOf=w&&w.record;const D=bG(t,v),R=[E];if("alias"in v){const H=typeof v.alias=="string"?[v.alias]:v.alias;for(const q of H)R.push(PG(ha({},E,{components:w?w.record.components:E.components,path:q,aliasOf:w?w.record:E})))}let z,N;for(const H of R){const{path:q}=H;if(y&&q[0]!=="/"){const Y=y.record.path,J=Y[Y.length-1]==="/"?"":"/";H.path=y.record.path+(q&&J+q)}if(z=oht(H,y,D),w?w.alias.push(z):(N=N||z,N!==z&&N.alias.push(z),I&&v.name&&!LG(z)&&s(v.name)),dX(z)&&c(z),E.children){const Y=E.children;for(let J=0;J<Y.length;J++)o(Y[J],z,w&&w.children[J])}w=w||z}return N?()=>{s(N)}:vw}function s(v){if(sX(v)){const y=r.get(v);y&&(r.delete(v),e.splice(e.indexOf(y),1),y.children.forEach(s),y.alias.forEach(s))}else{const y=e.indexOf(v);y>-1&&(e.splice(y,1),v.record.name&&r.delete(v.record.name),v.children.forEach(s),v.alias.forEach(s))}}function a(){return e}function c(v){const y=cht(v,e);e.splice(y,0,v),v.record.name&&!LG(v)&&r.set(v.record.name,v)}function f(v,y){let w,I={},E,D;if("name"in v&&v.name){if(w=r.get(v.name),!w)throw m0(so.MATCHER_NOT_FOUND,{location:v});D=w.record.name,I=ha(DG(y.params,w.keys.filter(N=>!N.optional).concat(w.parent?w.parent.keys.filter(N=>N.optional):[]).map(N=>N.name)),v.params&&DG(v.params,w.keys.map(N=>N.name))),E=w.stringify(I)}else if(v.path!=null)E=v.path,w=e.find(N=>N.re.test(E)),w&&(I=w.parse(E),D=w.record.name);else{if(w=y.name?r.get(y.name):e.find(N=>N.re.test(y.path)),!w)throw m0(so.MATCHER_NOT_FOUND,{location:v,currentLocation:y});D=w.record.name,I=ha({},y.params,v.params),E=w.stringify(I)}const R=[];let z=w;for(;z;)R.unshift(z.record),z=z.parent;return{name:D,path:E,params:I,matched:R,meta:uht(R)}}i.forEach(v=>o(v));function g(){e.length=0,r.clear()}return{addRoute:o,resolve:f,removeRoute:s,clearRoutes:g,getRoutes:a,getRecordMatcher:n}}function DG(i,t){const e={};for(const r of t)r in i&&(e[r]=i[r]);return e}function PG(i){const t={path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:i.aliasOf,beforeEnter:i.beforeEnter,props:lht(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function lht(i){const t={},e=i.props||!1;if("component"in i)t.default=e;else for(const r in i.components)t[r]=typeof e=="object"?e[r]:e;return t}function LG(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}function uht(i){return i.reduce((t,e)=>ha(t,e.meta),{})}function cht(i,t){let e=0,r=t.length;for(;e!==r;){const o=e+r>>1;hX(i,t[o])<0?r=o:e=o+1}const n=hht(i);return n&&(r=t.lastIndexOf(n,r-1)),r}function hht(i){let t=i;for(;t=t.parent;)if(dX(t)&&hX(i,t)===0)return t}function dX({record:i}){return!!(i.name||i.components&&Object.keys(i.components).length||i.redirect)}function RG(i){const t=Sd(tF),e=Sd(uX),r=Yl(()=>{const c=wd(i.to);return t.resolve(c)}),n=Yl(()=>{const{matched:c}=r.value,{length:f}=c,g=c[f-1],v=e.matched;if(!g||!v.length)return-1;const y=v.findIndex(g0.bind(null,g));if(y>-1)return y;const w=kG(c[f-2]);return f>1&&kG(g)===w&&v[v.length-1].path!==w?v.findIndex(g0.bind(null,c[f-2])):y}),o=Yl(()=>n.value>-1&&mht(e.params,r.value.params)),s=Yl(()=>n.value>-1&&n.value===e.matched.length-1&&oX(e.params,r.value.params));function a(c={}){if(ght(c)){const f=t[wd(i.replace)?"replace":"push"](wd(i.to)).catch(vw);return i.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>f),f}return Promise.resolve()}return{route:r,href:Yl(()=>r.value.href),isActive:o,isExactActive:s,navigate:a}}function dht(i){return i.length===1?i[0]:i}const fht=T9({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:RG,setup(i,{slots:t}){const e=DS(RG(i)),{options:r}=Sd(tF),n=Yl(()=>({[OG(i.activeClass,r.linkActiveClass,"router-link-active")]:e.isActive,[OG(i.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:e.isExactActive}));return()=>{const o=t.default&&dht(t.default(e));return i.custom?o:K9("a",{"aria-current":e.isExactActive?i.ariaCurrentValue:null,href:e.href,onClick:e.navigate,class:n.value},o)}}}),pht=fht;function ght(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const t=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return i.preventDefault&&i.preventDefault(),!0}}function mht(i,t){for(const e in t){const r=t[e],n=i[e];if(typeof r=="string"){if(r!==n)return!1}else if(!mc(n)||n.length!==r.length||r.some((o,s)=>o!==n[s]))return!1}return!0}function kG(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}const OG=(i,t,e)=>i??t??e,vht=T9({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:t,slots:e}){const r=Sd(nO),n=Yl(()=>i.route||r.value),o=Sd(IG,0),s=Yl(()=>{let f=wd(o);const{matched:g}=n.value;let v;for(;(v=g[f])&&!v.components;)f++;return f}),a=Yl(()=>n.value.matched[s.value]);CI(IG,Yl(()=>s.value+1)),CI($ct,a),CI(nO,n);const c=vo();return tv(()=>[c.value,a.value,i.name],([f,g,v],[y,w,I])=>{g&&(g.instances[v]=f,w&&w!==g&&f&&f===y&&(g.leaveGuards.size||(g.leaveGuards=w.leaveGuards),g.updateGuards.size||(g.updateGuards=w.updateGuards))),f&&g&&(!w||!g0(g,w)||!y)&&(g.enterCallbacks[v]||[]).forEach(E=>E(f))},{flush:"post"}),()=>{const f=n.value,g=i.name,v=a.value,y=v&&v.components[g];if(!y)return zG(e.default,{Component:y,route:f});const w=v.props[g],I=w?w===!0?f.params:typeof w=="function"?w(f):w:null,D=K9(y,ha({},I,t,{onVnodeUnmounted:R=>{R.component.isUnmounted&&(v.instances[g]=null)},ref:c}));return zG(e.default,{Component:D,route:f})||D}}});function zG(i,t){if(!i)return null;const e=i(t);return e.length===1?e[0]:e}const _ht=vht;function yht(i){const t=sht(i.routes,i),e=i.parseQuery||jct,r=i.stringifyQuery||AG,n=i.history,o=ob(),s=ob(),a=ob(),c=ylt(Vf);let f=Vf;jy&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const g=YP.bind(null,Ue=>""+Ue),v=YP.bind(null,Cct),y=YP.bind(null,Hw);function w(Ue,Ze){let xe,Ke;return sX(Ue)?(xe=t.getRecordMatcher(Ue),Ke=Ze):Ke=Ue,t.addRoute(Ke,xe)}function I(Ue){const Ze=t.getRecordMatcher(Ue);Ze&&t.removeRoute(Ze)}function E(){return t.getRoutes().map(Ue=>Ue.record)}function D(Ue){return!!t.getRecordMatcher(Ue)}function R(Ue,Ze){if(Ze=ha({},Ze||c.value),typeof Ue=="string"){const Zt=KP(e,Ue,Ze.path),ge=t.resolve({path:Zt.path},Ze),$e=n.createHref(Zt.fullPath);return ha(Zt,ge,{params:y(ge.params),hash:Hw(Zt.hash),redirectedFrom:void 0,href:$e})}let xe;if(Ue.path!=null)xe=ha({},Ue,{path:KP(e,Ue.path,Ze.path).path});else{const Zt=ha({},Ue.params);for(const ge in Zt)Zt[ge]==null&&delete Zt[ge];xe=ha({},Ue,{params:v(Zt)}),Ze.params=v(Ze.params)}const Ke=t.resolve(xe,Ze),We=Ue.hash||"";Ke.params=g(y(Ke.params));const Ti=Dct(r,ha({},Ue,{hash:Tct(We),path:Ke.path})),Bt=n.createHref(Ti);return ha({fullPath:Ti,hash:We,query:r===AG?Wct(Ue.query):Ue.query||{}},Ke,{redirectedFrom:void 0,href:Bt})}function z(Ue){return typeof Ue=="string"?KP(e,Ue,c.value.path):ha({},Ue)}function N(Ue,Ze){if(f!==Ue)return m0(so.NAVIGATION_CANCELLED,{from:Ze,to:Ue})}function H(Ue){return J(Ue)}function q(Ue){return H(ha(z(Ue),{replace:!0}))}function Y(Ue,Ze){const xe=Ue.matched[Ue.matched.length-1];if(xe&&xe.redirect){const{redirect:Ke}=xe;let We=typeof Ke=="function"?Ke(Ue,Ze):Ke;return typeof We=="string"&&(We=We.includes("?")||We.includes("#")?We=z(We):{path:We},We.params={}),ha({query:Ue.query,hash:Ue.hash,params:We.path!=null?{}:Ue.params},We)}}function J(Ue,Ze){const xe=f=R(Ue),Ke=c.value,We=Ue.state,Ti=Ue.force,Bt=Ue.replace===!0,Zt=Y(xe,Ke);if(Zt)return J(ha(z(Zt),{state:typeof Zt=="object"?ha({},We,Zt.state):We,force:Ti,replace:Bt}),Ze||xe);const ge=xe;ge.redirectedFrom=Ze;let $e;return!Ti&&Pct(r,Ke,xe)&&($e=m0(so.NAVIGATION_DUPLICATED,{to:ge,from:Ke}),be(Ke,Ke,!0,!1)),($e?Promise.resolve($e):ut(ge,Ke)).catch(He=>Qh(He)?Qh(He,so.NAVIGATION_GUARD_REDIRECT)?He:ce(He):zt(He,ge,Ke)).then(He=>{if(He){if(Qh(He,so.NAVIGATION_GUARD_REDIRECT))return J(ha({replace:Bt},z(He.to),{state:typeof He.to=="object"?ha({},We,He.to.state):We,force:Ti}),Ze||ge)}else He=_t(ge,Ke,!0,Bt,We);return ft(ge,Ke,He),He})}function it(Ue,Ze){const xe=N(Ue,Ze);return xe?Promise.reject(xe):Promise.resolve()}function at(Ue){const Ze=ni.values().next().value;return Ze&&typeof Ze.runWithContext=="function"?Ze.runWithContext(Ue):Ue()}function ut(Ue,Ze){let xe;const[Ke,We,Ti]=Zct(Ue,Ze);xe=QP(Ke.reverse(),"beforeRouteLeave",Ue,Ze);for(const Zt of Ke)Zt.leaveGuards.forEach(ge=>{xe.push(rp(ge,Ue,Ze))});const Bt=it.bind(null,Ue,Ze);return xe.push(Bt),or(xe).then(()=>{xe=[];for(const Zt of o.list())xe.push(rp(Zt,Ue,Ze));return xe.push(Bt),or(xe)}).then(()=>{xe=QP(We,"beforeRouteUpdate",Ue,Ze);for(const Zt of We)Zt.updateGuards.forEach(ge=>{xe.push(rp(ge,Ue,Ze))});return xe.push(Bt),or(xe)}).then(()=>{xe=[];for(const Zt of Ti)if(Zt.beforeEnter)if(mc(Zt.beforeEnter))for(const ge of Zt.beforeEnter)xe.push(rp(ge,Ue,Ze));else xe.push(rp(Zt.beforeEnter,Ue,Ze));return xe.push(Bt),or(xe)}).then(()=>(Ue.matched.forEach(Zt=>Zt.enterCallbacks={}),xe=QP(Ti,"beforeRouteEnter",Ue,Ze,at),xe.push(Bt),or(xe))).then(()=>{xe=[];for(const Zt of s.list())xe.push(rp(Zt,Ue,Ze));return xe.push(Bt),or(xe)}).catch(Zt=>Qh(Zt,so.NAVIGATION_CANCELLED)?Zt:Promise.reject(Zt))}function ft(Ue,Ze,xe){a.list().forEach(Ke=>at(()=>Ke(Ue,Ze,xe)))}function _t(Ue,Ze,xe,Ke,We){const Ti=N(Ue,Ze);if(Ti)return Ti;const Bt=Ze===Vf,Zt=jy?history.state:{};xe&&(Ke||Bt?n.replace(Ue.fullPath,ha({scroll:Bt&&Zt&&Zt.scroll},We)):n.push(Ue.fullPath,We)),c.value=Ue,be(Ue,Ze,xe,Bt),ce()}let ct;function Dt(){ct||(ct=n.listen((Ue,Ze,xe)=>{if(!bi.listening)return;const Ke=R(Ue),We=Y(Ke,bi.currentRoute.value);if(We){J(ha(We,{replace:!0,force:!0}),Ke).catch(vw);return}f=Ke;const Ti=c.value;jy&&Nct(TG(Ti.fullPath,xe.delta),HM()),ut(Ke,Ti).catch(Bt=>Qh(Bt,so.NAVIGATION_ABORTED|so.NAVIGATION_CANCELLED)?Bt:Qh(Bt,so.NAVIGATION_GUARD_REDIRECT)?(J(ha(z(Bt.to),{force:!0}),Ke).then(Zt=>{Qh(Zt,so.NAVIGATION_ABORTED|so.NAVIGATION_DUPLICATED)&&!xe.delta&&xe.type===iO.pop&&n.go(-1,!1)}).catch(vw),Promise.reject()):(xe.delta&&n.go(-xe.delta,!1),zt(Bt,Ke,Ti))).then(Bt=>{Bt=Bt||_t(Ke,Ti,!1),Bt&&(xe.delta&&!Qh(Bt,so.NAVIGATION_CANCELLED)?n.go(-xe.delta,!1):xe.type===iO.pop&&Qh(Bt,so.NAVIGATION_ABORTED|so.NAVIGATION_DUPLICATED)&&n.go(-1,!1)),ft(Ke,Ti,Bt)}).catch(vw)}))}let Et=ob(),bt=ob(),Vt;function zt(Ue,Ze,xe){ce(Ue);const Ke=bt.list();return Ke.length?Ke.forEach(We=>We(Ue,Ze,xe)):console.error(Ue),Promise.reject(Ue)}function Jt(){return Vt&&c.value!==Vf?Promise.resolve():new Promise((Ue,Ze)=>{Et.add([Ue,Ze])})}function ce(Ue){return Vt||(Vt=!Ue,Dt(),Et.list().forEach(([Ze,xe])=>Ue?xe(Ue):Ze()),Et.reset()),Ue}function be(Ue,Ze,xe,Ke){const{scrollBehavior:We}=i;if(!jy||!We)return Promise.resolve();const Ti=!xe&&Vct(TG(Ue.fullPath,0))||(Ke||!xe)&&history.state&&history.state.scroll||null;return Fw().then(()=>We(Ue,Ze,Ti)).then(Bt=>Bt&&Fct(Bt)).catch(Bt=>zt(Bt,Ue,Ze))}const ve=Ue=>n.go(Ue);let ke;const ni=new Set,bi={currentRoute:c,listening:!0,addRoute:w,removeRoute:I,clearRoutes:t.clearRoutes,hasRoute:D,getRoutes:E,resolve:R,options:i,push:H,replace:q,go:ve,back:()=>ve(-1),forward:()=>ve(1),beforeEach:o.add,beforeResolve:s.add,afterEach:a.add,onError:bt.add,isReady:Jt,install(Ue){Ue.component("RouterLink",pht),Ue.component("RouterView",_ht),Ue.config.globalProperties.$router=bi,Object.defineProperty(Ue.config.globalProperties,"$route",{enumerable:!0,get:()=>wd(c)}),jy&&!ke&&c.value===Vf&&(ke=!0,H(n.location).catch(Ke=>{}));const Ze={};for(const Ke in Vf)Object.defineProperty(Ze,Ke,{get:()=>c.value[Ke],enumerable:!0});Ue.provide(tF,bi),Ue.provide(uX,m9(Ze)),Ue.provide(nO,c);const xe=Ue.unmount;ni.add(Ue),Ue.unmount=function(){ni.delete(Ue),ni.size<1&&(f=Vf,ct&&ct(),ct=null,c.value=Vf,ke=!1,Vt=!1),xe()}}};function or(Ue){return Ue.reduce((Ze,xe)=>Ze.then(()=>at(xe)),Promise.resolve())}return bi}const xht={class:"home"},bht={class:"loading-status"},wht={class:"loading-bar"},Sht={class:"loading-percent"},Tht={class:"debug hidden",id:"debug"},Aht={class:"stats"},Iht={class:"stat-val"},Cht={id:"content"},Mht={class:"section"},Eht={class:"box"},Dht={class:"section"},Pht={class:"box"},Lht={class:"section"},Rht={class:"box"},kht={__name:"Home",setup(i){const t=vo(!0),e=vo(0),r=vo("Initializing..."),n=vo(95),o=vo(null),s=vo(null);let a=null,c=null;const f=[{lat:51.5,lng:-.1,name:"London",aqi:70},{lat:40.7,lng:-74,name:"New York",aqi:85},{lat:35.7,lng:139.7,name:"Tokyo",aqi:50},{lat:39.9,lng:116.4,name:"Beijing",aqi:180},{lat:28.6,lng:77.2,name:"Delhi",aqi:250},{lat:-23.6,lng:-46.7,name:"So Paulo",aqi:100},{lat:19.4,lng:-99.1,name:"Mexico City",aqi:140},{lat:30,lng:31.2,name:"Cairo",aqi:180},{lat:-33.9,lng:151.2,name:"Sydney",aqi:55},{lat:1.3,lng:103.8,name:"Singapore",aqi:60},{lat:48.9,lng:2.3,name:"Paris",aqi:65},{lat:52.5,lng:13.4,name:"Berlin",aqi:55},{lat:55.8,lng:37.6,name:"Moscow",aqi:95},{lat:34.1,lng:-118.2,name:"Los Angeles",aqi:110},{lat:22.3,lng:114.2,name:"Hong Kong",aqi:80},{lat:31.2,lng:121.5,name:"Shanghai",aqi:160},{lat:37.6,lng:127,name:"Seoul",aqi:90}],g=(R,z=!1)=>{if(console.log(R),s.value){const N=document.createElement("div");N.textContent=R,N.style.color=z?"#f00":"#0f0",s.value.appendChild(N)}},v=(R,z)=>{e.value=R,z&&(r.value=z)},y=()=>{const R=[];for(let N=0;N<20;N++){let H=(Math.random()-.5)*90,q=(Math.random()-.5)*360,Y=0;const J=[[H,q,Y]],it=Math.floor(Math.random()*5e3);for(let at=0;at<it;at++)H+=Math.random()*2-1,q+=Math.random()*2-1,Y+=(Math.random()*2-1)*.01,Y=Math.max(0,Y),J.push([H,q,Y]);R.push(J)}return R},w=R=>R<50?"#10b981":R<100?"#84cc16":R<150?"#fbbf24":R<200?"#f97316":"#ef4444",I=R=>R<50?"Good ":R<100?"Moderate ":R<150?"Unhealthy ":R<200?"Very Unhealthy ":"Hazardous ",E=()=>{try{if(v(50,"Creating globe..."),g("Creating globe instance..."),!o.value)throw new Error("Globe container not found");g(" Container found"),a=Globe()(o.value),g(" Globe instance created"),v(60,"Loading textures..."),a.globeImageUrl("https://unpkg.com/three-globe@2.27.2/example/img/earth-blue-marble.jpg").bumpImageUrl("https://unpkg.com/three-globe@2.27.2/example/img/earth-topology.png").backgroundImageUrl("https://unpkg.com/three-globe@2.27.2/example/img/night-sky.png"),g(" Textures configured"),v(70,"Adding paths...");const R=y();a.pathsData(R).pathPoints(z=>z).pathPointLat(z=>z[0]).pathPointLng(z=>z[1]).pathPointAlt(z=>z[2]).pathColor(()=>["rgba(168,85,247,0.8)","rgba(236,72,153,0.8)"]).pathDashLength(.01).pathDashGap(.004).pathDashAnimateTime(1e5).pathStroke(2),g(" Paths added"),v(80,"Adding cities..."),a.pointsData(f).pointAltitude(.01).pointRadius(z=>Math.sqrt(z.aqi)*.03).pointColor(z=>w(z.aqi)).pointLabel(z=>`<div style="background:#000;padding:12px;border:2px solid #a855f7;font-family:'Press Start 2P';font-size:10px;color:#a855f7;"><b style="color:#fff;font-size:11px;"> ${z.name}</b><br/><b>AQI:</b> <span style="color:${w(z.aqi)};font-size:14px;">${z.aqi}</span><br/><b>Status:</b> ${I(z.aqi)}</div>`),g(" Cities added"),v(85,"Configuring atmosphere..."),a.atmosphereColor("#a855f7").atmosphereAltitude(.3),g(" Atmosphere configured"),v(90,"Setting up view..."),a.width(window.innerWidth).height(window.innerHeight).pointOfView({lat:30,lng:0,altitude:2.2},0),g(" View configured"),v(95,"Enabling controls..."),a.controls().enableZoom=!0,a.controls().autoRotate=!0,a.controls().autoRotateSpeed=.3,g(" Controls enabled"),window.addEventListener("scroll",()=>{const z=window.pageYOffset,N=document.body.scrollHeight-window.innerHeight,q=2.2+Math.min(z/N,1)*1.3;a.pointOfView({altitude:q},500)}),window.addEventListener("resize",()=>{a&&(a.width(window.innerWidth),a.height(window.innerHeight))}),c=setInterval(()=>{const z=f[Math.floor(Math.random()*f.length)];n.value=z.aqi},3e3),v(100,"Complete!"),g("=== GLOBE READY ==="),setTimeout(()=>{t.value=!1},500)}catch(R){g(" ERROR: "+R.message,!0),r.value=" Error: "+R.message}},D=()=>{window.scrollTo({top:window.innerHeight,behavior:"smooth"})};return Av(()=>{g("=== ECOVISION STARTING ==="),v(10,"Checking Globe.GL...");let R=0;const z=setInterval(()=>{R++,typeof Globe<"u"?(clearInterval(z),g(" Globe.GL loaded"),v(30,"Globe.GL loaded"),E()):R>50&&(clearInterval(z),g(" Globe.GL failed to load",!0),r.value=" Error: Globe.GL not loaded")},100);window.addEventListener("keydown",N=>{if(N.key==="d"||N.key==="D"){const H=document.getElementById("debug");H&&H.classList.toggle("hidden")}})}),LS(()=>{c&&clearInterval(c)}),(R,z)=>{const N=Qm("router-link");return Ka(),_o("div",xht,[le("div",{id:"loading",class:md({hidden:!t.value})},[z[0]||(z[0]=le("div",{class:"loading-title"},"ECOVISION",-1)),le("div",bht,Hn(r.value),1),le("div",wht,[le("div",{class:"loading-fill",style:O0({width:e.value+"%"})},null,4)]),le("div",Sht,Hn(Math.floor(e.value))+"%",1)],2),le("div",Tht,[z[1]||(z[1]=le("div",null,[le("strong",null,"DEBUG INFO")],-1)),le("div",{id:"debugInfo",ref_key:"debugInfo",ref:s},null,512)]),le("div",{id:"globeViz",ref_key:"globeContainer",ref:o},null,512),le("div",Aht,[z[3]||(z[3]=le("div",null,[Dn("CITIES: "),le("span",{class:"stat-val"},"17")],-1)),le("div",null,[z[2]||(z[2]=Dn("AQI AVG: ",-1)),le("span",Iht,Hn(n.value),1)]),z[4]||(z[4]=le("div",null,[Dn("STATUS: "),le("span",{class:"stat-val"},"LIVE")],-1))]),z[19]||(z[19]=le("div",{class:"controls"},[Dn("  DRAG TO ROTATE"),le("br"),Dn("  SCROLL TO ZOOM"),le("br"),Dn("  CLICK MARKERS ")],-1)),le("div",Cht,[le("div",{class:"hero"},[z[5]||(z[5]=le("h1",{class:"glitch","data-text":"ECOVISION LONDON"},"ECOVISION LONDON",-1)),z[6]||(z[6]=le("p",{class:"subtitle"},"Global Air Quality Monitoring System",-1)),le("div",{class:"scroll-hint",onClick:D}," SCROLL TO EXPLORE ")]),le("div",Mht,[le("div",Eht,[z[8]||(z[8]=le("h2",null," OUR MISSION",-1)),z[9]||(z[9]=le("p",null,"EcoVision London is a cutting-edge air quality monitoring platform that visualizes pollution data from major cities worldwide.",-1)),z[10]||(z[10]=le("p",null,"Using advanced sensors and data analytics, we track PM2.5, PM10, NO2, O3, and other pollutants.",-1)),Xn(N,{to:"/page2",class:"btn"},{default:$o(()=>[...z[7]||(z[7]=[Dn("EXPLORE LONDON ",-1)])]),_:1})])]),le("div",Dht,[le("div",Pht,[z[12]||(z[12]=le("h2",null," TECHNOLOGY",-1)),z[13]||(z[13]=le("p",null,"Our platform leverages Globe.GL, an open-source WebGL library that renders stunning 3D geographical data visualizations.",-1)),z[14]||(z[14]=le("p",null,"The interactive globe displays real-time data with color-coded markers indicating air quality levels.",-1)),Xn(N,{to:"/map",class:"btn"},{default:$o(()=>[...z[11]||(z[11]=[Dn("VIEW MAP ",-1)])]),_:1})])]),le("div",Lht,[le("div",Rht,[z[16]||(z[16]=le("h2",null," GLOBAL IMPACT",-1)),z[17]||(z[17]=le("p",null,"Air pollution affects millions of lives worldwide. EcoVision London makes pollution data accessible and actionable for everyone.",-1)),z[18]||(z[18]=le("p",null,"Join us in our mission to create awareness and drive change towards cleaner air for future generations.",-1)),Xn(N,{to:"/page4",class:"btn"},{default:$o(()=>[...z[15]||(z[15]=[Dn("MEET THE TEAM ",-1)])]),_:1})])])])])}}},Oht=Gd(kht,[["__scopeId","data-v-ff040298"]]);const zht={class:"page2"},Bht={class:"nav-links"},Fht={class:"cta-section"},Nht={class:"cta-box"},Vht={class:"cta-buttons"},Uht={__name:"Page2",setup(i){function t(){window.scrollTo(0,0),document.body.scrollTop=0,document.documentElement.scrollTop=0;const e=document.getElementById("app");e&&(e.scrollTop=0)}return Av(()=>{t();const e={threshold:.1,rootMargin:"0px 0px -100px 0px"},r=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&(o.target.style.opacity="1",o.target.style.transform="translateY(0)")})},e);document.querySelectorAll(".challenge-card, .feature-item").forEach(n=>{n.style.opacity="0",n.style.transform="translateY(50px)",n.style.transition="all 0.6s ease",r.observe(n)})}),FM(()=>{t()}),(e,r)=>{const n=Qm("router-link");return Ka(),_o("div",zht,[le("nav",null,[r[4]||(r[4]=le("div",{class:"logo"},"ECOVISION",-1)),le("ul",Bht,[le("li",null,[Xn(n,{to:"/"},{default:$o(()=>[...r[0]||(r[0]=[Dn("HOME",-1)])]),_:1})]),le("li",null,[Xn(n,{to:"/page2",class:"active"},{default:$o(()=>[...r[1]||(r[1]=[Dn("ABOUT",-1)])]),_:1})]),le("li",null,[Xn(n,{to:"/map"},{default:$o(()=>[...r[2]||(r[2]=[Dn("MAP",-1)])]),_:1})]),le("li",null,[Xn(n,{to:"/page4"},{default:$o(()=>[...r[3]||(r[3]=[Dn("TEAM",-1)])]),_:1})])])]),r[9]||(r[9]=ep('<div class="pixel-decoration top-left" data-v-a098e632></div><div class="pixel-decoration bottom-right" data-v-a098e632></div><section class="hero" data-v-a098e632><div class="hero-content" data-v-a098e632><h1 data-v-a098e632>Ecovision London</h1><p data-v-a098e632> Mapping London&#39;s vehicle emissions to air quality - Empowering citizens with real-time data for cleaner transport decisions </p></div></section><section class="challenge-section" data-v-a098e632><h2 class="section-title" data-v-a098e632>The Challenge We&#39;re Solving</h2><div class="challenge-grid" data-v-a098e632><div class="challenge-card" data-v-a098e632><span class="card-icon" data-v-a098e632></span><h3 class="card-title" data-v-a098e632>Health Impact</h3><p class="card-text" data-v-a098e632> Vehicle emissions directly affect public health and urban sustainability across London&#39;s 33 boroughs </p></div><div class="challenge-card" data-v-a098e632><span class="card-icon" data-v-a098e632></span><h3 class="card-title" data-v-a098e632>Data Complexity</h3><p class="card-text" data-v-a098e632> Complex air quality reports are difficult for citizens to interpret and use for daily decisions </p></div><div class="challenge-card" data-v-a098e632><span class="card-icon" data-v-a098e632></span><h3 class="card-title" data-v-a098e632>Our Solution</h3><p class="card-text" data-v-a098e632> Interactive visual mapping with hourly data to help citizens make informed transport choices </p></div></div></section><section class="features-section" data-v-a098e632><h2 class="section-title" data-v-a098e632>Key Features</h2><div class="features-list" data-v-a098e632><div class="feature-item" data-v-a098e632><span class="feature-icon" data-v-a098e632></span><div class="feature-content" data-v-a098e632><h3 data-v-a098e632>Real-time Borough Mapping</h3><p data-v-a098e632> Interactive map of all 33 London boroughs with hourly air quality data visualization </p></div></div><div class="feature-item" data-v-a098e632><span class="feature-icon" data-v-a098e632></span><div class="feature-content" data-v-a098e632><h3 data-v-a098e632>24-Hour Time Analysis</h3><p data-v-a098e632> Track pollution patterns throughout the day with interactive time sliders </p></div></div><div class="feature-item" data-v-a098e632><span class="feature-icon" data-v-a098e632></span><div class="feature-content" data-v-a098e632><h3 data-v-a098e632>Cycling vs Car Comparison</h3><p data-v-a098e632> Compare journey times and environmental impact between cycling and driving </p></div></div></div></section>',5)),le("section",Fht,[le("div",Nht,[r[7]||(r[7]=le("h2",null,"Explore the Interactive Map",-1)),r[8]||(r[8]=le("p",{style:{color:"#ccc","margin-bottom":"2rem","line-height":"1.8"}}," Coming soon - Full interactive experience with historical data from previous month ",-1)),le("div",Vht,[Xn(n,{to:"/map",class:"pixel-button primary"},{default:$o(()=>[...r[5]||(r[5]=[Dn("View Map",-1)])]),_:1}),Xn(n,{to:"/page4",class:"pixel-button secondary"},{default:$o(()=>[...r[6]||(r[6]=[Dn("Join Us",-1)])]),_:1})])])])])}}},Ght=Gd(Uht,[["__scopeId","data-v-a098e632"]]);var Hht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jht(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var fX={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(Hht,function(){var e,r,n;function o(a,c){if(!e)e=c;else if(!r)r=c;else{var f="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",g={};e(g),n=c(g),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([f],{type:"text/javascript"})))}}o(["exports"],function(a){var c=1e-6,f=typeof Float32Array<"u"?Float32Array:Array;function g(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=h*S-_*m;return T?(d[0]=S*(T=1/T),d[1]=-m*T,d[2]=-_*T,d[3]=h*T,d):null}function v(){var d=new f(9);return f!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d}function y(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=l[4],C=l[5],L=l[6],k=l[7],F=l[8];return d[0]=T*F-C*k,d[1]=_*k-m*F,d[2]=m*C-_*T,d[3]=C*L-S*F,d[4]=h*F-_*L,d[5]=_*S-h*C,d[6]=S*k-T*L,d[7]=m*L-h*k,d[8]=h*T-m*S,d}function w(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3],C=l[4],L=l[5],k=l[6],F=l[7],V=l[8],U=h[0],$=h[1],Z=h[2],Q=h[3],et=h[4],nt=h[5],dt=h[6],mt=h[7],yt=h[8];return d[0]=U*m+$*T+Z*k,d[1]=U*_+$*C+Z*F,d[2]=U*S+$*L+Z*V,d[3]=Q*m+et*T+nt*k,d[4]=Q*_+et*C+nt*F,d[5]=Q*S+et*L+nt*V,d[6]=dt*m+mt*T+yt*k,d[7]=dt*_+mt*C+yt*F,d[8]=dt*S+mt*L+yt*V,d}function I(){var d=new f(16);return f!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d}function E(d){var l=new f(16);return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l[9]=d[9],l[10]=d[10],l[11]=d[11],l[12]=d[12],l[13]=d[13],l[14]=d[14],l[15]=d[15],l}function D(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function R(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=l[4],C=l[5],L=l[6],k=l[7],F=l[8],V=l[9],U=l[10],$=l[11],Z=l[12],Q=l[13],et=l[14],nt=l[15],dt=h*C-m*T,mt=h*L-_*T,yt=h*k-S*T,Lt=m*L-_*C,It=m*k-S*C,Ot=_*k-S*L,Ut=F*Q-V*Z,Ht=F*et-U*Z,se=F*nt-$*Z,Kt=V*et-U*Q,ue=V*nt-$*Q,me=U*nt-$*et,Te=dt*me-mt*ue+yt*Kt+Lt*se-It*Ht+Ot*Ut;return Te?(d[0]=(C*me-L*ue+k*Kt)*(Te=1/Te),d[1]=(_*ue-m*me-S*Kt)*Te,d[2]=(Q*Ot-et*It+nt*Lt)*Te,d[3]=(U*It-V*Ot-$*Lt)*Te,d[4]=(L*se-T*me-k*Ht)*Te,d[5]=(h*me-_*se+S*Ht)*Te,d[6]=(et*yt-Z*Ot-nt*mt)*Te,d[7]=(F*Ot-U*yt+$*mt)*Te,d[8]=(T*ue-C*se+k*Ut)*Te,d[9]=(m*se-h*ue-S*Ut)*Te,d[10]=(Z*It-Q*yt+nt*dt)*Te,d[11]=(V*yt-F*It-$*dt)*Te,d[12]=(C*Ht-T*Kt-L*Ut)*Te,d[13]=(h*Kt-m*Ht+_*Ut)*Te,d[14]=(Q*mt-Z*Lt-et*dt)*Te,d[15]=(F*Lt-V*mt+U*dt)*Te,d):null}function z(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3],C=l[4],L=l[5],k=l[6],F=l[7],V=l[8],U=l[9],$=l[10],Z=l[11],Q=l[12],et=l[13],nt=l[14],dt=l[15],mt=h[0],yt=h[1],Lt=h[2],It=h[3];return d[0]=mt*m+yt*C+Lt*V+It*Q,d[1]=mt*_+yt*L+Lt*U+It*et,d[2]=mt*S+yt*k+Lt*$+It*nt,d[3]=mt*T+yt*F+Lt*Z+It*dt,d[4]=(mt=h[4])*m+(yt=h[5])*C+(Lt=h[6])*V+(It=h[7])*Q,d[5]=mt*_+yt*L+Lt*U+It*et,d[6]=mt*S+yt*k+Lt*$+It*nt,d[7]=mt*T+yt*F+Lt*Z+It*dt,d[8]=(mt=h[8])*m+(yt=h[9])*C+(Lt=h[10])*V+(It=h[11])*Q,d[9]=mt*_+yt*L+Lt*U+It*et,d[10]=mt*S+yt*k+Lt*$+It*nt,d[11]=mt*T+yt*F+Lt*Z+It*dt,d[12]=(mt=h[12])*m+(yt=h[13])*C+(Lt=h[14])*V+(It=h[15])*Q,d[13]=mt*_+yt*L+Lt*U+It*et,d[14]=mt*S+yt*k+Lt*$+It*nt,d[15]=mt*T+yt*F+Lt*Z+It*dt,d}function N(d,l,h){var m,_,S,T,C,L,k,F,V,U,$,Z,Q=h[0],et=h[1],nt=h[2];return l===d?(d[12]=l[0]*Q+l[4]*et+l[8]*nt+l[12],d[13]=l[1]*Q+l[5]*et+l[9]*nt+l[13],d[14]=l[2]*Q+l[6]*et+l[10]*nt+l[14],d[15]=l[3]*Q+l[7]*et+l[11]*nt+l[15]):(_=l[1],S=l[2],T=l[3],C=l[4],L=l[5],k=l[6],F=l[7],V=l[8],U=l[9],$=l[10],Z=l[11],d[0]=m=l[0],d[1]=_,d[2]=S,d[3]=T,d[4]=C,d[5]=L,d[6]=k,d[7]=F,d[8]=V,d[9]=U,d[10]=$,d[11]=Z,d[12]=m*Q+C*et+V*nt+l[12],d[13]=_*Q+L*et+U*nt+l[13],d[14]=S*Q+k*et+$*nt+l[14],d[15]=T*Q+F*et+Z*nt+l[15]),d}function H(d,l,h){var m=h[0],_=h[1],S=h[2];return d[0]=l[0]*m,d[1]=l[1]*m,d[2]=l[2]*m,d[3]=l[3]*m,d[4]=l[4]*_,d[5]=l[5]*_,d[6]=l[6]*_,d[7]=l[7]*_,d[8]=l[8]*S,d[9]=l[9]*S,d[10]=l[10]*S,d[11]=l[11]*S,d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15],d}function q(d,l,h){var m=Math.sin(h),_=Math.cos(h),S=l[4],T=l[5],C=l[6],L=l[7],k=l[8],F=l[9],V=l[10],U=l[11];return l!==d&&(d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[4]=S*_+k*m,d[5]=T*_+F*m,d[6]=C*_+V*m,d[7]=L*_+U*m,d[8]=k*_-S*m,d[9]=F*_-T*m,d[10]=V*_-C*m,d[11]=U*_-L*m,d}function Y(d,l,h){var m=Math.sin(h),_=Math.cos(h),S=l[0],T=l[1],C=l[2],L=l[3],k=l[8],F=l[9],V=l[10],U=l[11];return l!==d&&(d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[0]=S*_-k*m,d[1]=T*_-F*m,d[2]=C*_-V*m,d[3]=L*_-U*m,d[8]=S*m+k*_,d[9]=T*m+F*_,d[10]=C*m+V*_,d[11]=L*m+U*_,d}function J(d,l,h){var m=Math.sin(h),_=Math.cos(h),S=l[0],T=l[1],C=l[2],L=l[3],k=l[4],F=l[5],V=l[6],U=l[7];return l!==d&&(d[8]=l[8],d[9]=l[9],d[10]=l[10],d[11]=l[11],d[12]=l[12],d[13]=l[13],d[14]=l[14],d[15]=l[15]),d[0]=S*_+k*m,d[1]=T*_+F*m,d[2]=C*_+V*m,d[3]=L*_+U*m,d[4]=k*_-S*m,d[5]=F*_-T*m,d[6]=V*_-C*m,d[7]=U*_-L*m,d}function it(d,l){return d[0]=l[0],d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=l[1],d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=l[2],d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function at(d,l,h){var m,_,S,T=h[0],C=h[1],L=h[2],k=Math.sqrt(T*T+C*C+L*L);return k<c?null:(T*=k=1/k,C*=k,L*=k,m=Math.sin(l),_=Math.cos(l),d[0]=T*T*(S=1-_)+_,d[1]=C*T*S+L*m,d[2]=L*T*S-C*m,d[3]=0,d[4]=T*C*S-L*m,d[5]=C*C*S+_,d[6]=L*C*S+T*m,d[7]=0,d[8]=T*L*S+C*m,d[9]=C*L*S-T*m,d[10]=L*L*S+_,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d)}function ut(d,l){var h=l[0],m=l[1],_=l[2],S=l[4],T=l[5],C=l[6],L=l[8],k=l[9],F=l[10];return d[0]=Math.sqrt(h*h+m*m+_*_),d[1]=Math.sqrt(S*S+T*T+C*C),d[2]=Math.sqrt(L*L+k*k+F*F),d}function ft(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=h+h,C=m+m,L=_+_,k=h*T,F=m*T,V=m*C,U=_*T,$=_*C,Z=_*L,Q=S*T,et=S*C,nt=S*L;return d[0]=1-V-Z,d[1]=F+nt,d[2]=U-et,d[3]=0,d[4]=F-nt,d[5]=1-k-Z,d[6]=$+Q,d[7]=0,d[8]=U+et,d[9]=$-Q,d[10]=1-k-V,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}var _t=z;function ct(){var d=new f(3);return f!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d}function Dt(d){var l=new f(3);return l[0]=d[0],l[1]=d[1],l[2]=d[2],l}function Et(d){var l=d[0],h=d[1],m=d[2];return Math.sqrt(l*l+h*h+m*m)}function bt(d,l,h){var m=new f(3);return m[0]=d,m[1]=l,m[2]=h,m}function Vt(d,l,h,m){return d[0]=l,d[1]=h,d[2]=m,d}function zt(d,l,h){return d[0]=l[0]+h[0],d[1]=l[1]+h[1],d[2]=l[2]+h[2],d}function Jt(d,l,h){return d[0]=l[0]-h[0],d[1]=l[1]-h[1],d[2]=l[2]-h[2],d}function ce(d,l,h){return d[0]=l[0]*h[0],d[1]=l[1]*h[1],d[2]=l[2]*h[2],d}function be(d,l,h){return d[0]=Math.min(l[0],h[0]),d[1]=Math.min(l[1],h[1]),d[2]=Math.min(l[2],h[2]),d}function ve(d,l,h){return d[0]=Math.max(l[0],h[0]),d[1]=Math.max(l[1],h[1]),d[2]=Math.max(l[2],h[2]),d}function ke(d,l,h){return d[0]=l[0]*h,d[1]=l[1]*h,d[2]=l[2]*h,d}function ni(d,l,h,m){return d[0]=l[0]+h[0]*m,d[1]=l[1]+h[1]*m,d[2]=l[2]+h[2]*m,d}function bi(d,l){var h=l[0]-d[0],m=l[1]-d[1],_=l[2]-d[2];return Math.sqrt(h*h+m*m+_*_)}function or(d,l){var h=l[0]-d[0],m=l[1]-d[1],_=l[2]-d[2];return h*h+m*m+_*_}function Ue(d){var l=d[0],h=d[1],m=d[2];return l*l+h*h+m*m}function Ze(d,l){return d[0]=-l[0],d[1]=-l[1],d[2]=-l[2],d}function xe(d,l){var h=l[0],m=l[1],_=l[2],S=h*h+m*m+_*_;return S>0&&(S=1/Math.sqrt(S)),d[0]=l[0]*S,d[1]=l[1]*S,d[2]=l[2]*S,d}function Ke(d,l){return d[0]*l[0]+d[1]*l[1]+d[2]*l[2]}function We(d,l,h){var m=l[0],_=l[1],S=l[2],T=h[0],C=h[1],L=h[2];return d[0]=_*L-S*C,d[1]=S*T-m*L,d[2]=m*C-_*T,d}function Ti(d,l,h,m){var _=l[0],S=l[1],T=l[2];return d[0]=_+m*(h[0]-_),d[1]=S+m*(h[1]-S),d[2]=T+m*(h[2]-T),d}function Bt(d,l,h){var m=l[0],_=l[1],S=l[2],T=h[3]*m+h[7]*_+h[11]*S+h[15];return d[0]=(h[0]*m+h[4]*_+h[8]*S+h[12])/(T=T||1),d[1]=(h[1]*m+h[5]*_+h[9]*S+h[13])/T,d[2]=(h[2]*m+h[6]*_+h[10]*S+h[14])/T,d}function Zt(d,l,h){var m=l[0],_=l[1],S=l[2];return d[0]=m*h[0]+_*h[3]+S*h[6],d[1]=m*h[1]+_*h[4]+S*h[7],d[2]=m*h[2]+_*h[5]+S*h[8],d}function ge(d,l,h){var m=h[0],_=h[1],S=h[2],T=h[3],C=l[0],L=l[1],k=l[2],F=_*k-S*L,V=S*C-m*k,U=m*L-_*C;return d[0]=C+T*(F+=F)+_*(U+=U)-S*(V+=V),d[1]=L+T*V+S*F-m*U,d[2]=k+T*U+m*V-_*F,d}function $e(d){return d[0]=0,d[1]=0,d[2]=0,d}function He(d,l){return d[0]===l[0]&&d[1]===l[1]&&d[2]===l[2]}var qe=Jt,Ai=ce,Ii=Et;function _i(){var d=new f(4);return f!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0,d[3]=0),d}function pi(d,l,h){return d[0]=l[0]*h,d[1]=l[1]*h,d[2]=l[2]*h,d[3]=l[3]*h,d}function yr(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=h*h+m*m+_*_+S*S;return T>0&&(T=1/Math.sqrt(T)),d[0]=h*T,d[1]=m*T,d[2]=_*T,d[3]=S*T,d}function Li(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3];return d[0]=h[0]*m+h[4]*_+h[8]*S+h[12]*T,d[1]=h[1]*m+h[5]*_+h[9]*S+h[13]*T,d[2]=h[2]*m+h[6]*_+h[10]*S+h[14]*T,d[3]=h[3]*m+h[7]*_+h[11]*S+h[15]*T,d}function hr(){var d=new f(4);return f!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d[3]=1,d}function xr(d){return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d}function tn(d,l,h){h*=.5;var m=l[0],_=l[1],S=l[2],T=l[3],C=Math.sin(h),L=Math.cos(h);return d[0]=m*L+T*C,d[1]=_*L+S*C,d[2]=S*L-_*C,d[3]=T*L-m*C,d}function zn(d,l,h){h*=.5;var m=l[0],_=l[1],S=l[2],T=l[3],C=Math.sin(h),L=Math.cos(h);return d[0]=m*L-S*C,d[1]=_*L+T*C,d[2]=S*L+m*C,d[3]=T*L-_*C,d}ct(),_i();var Kr,Ua,ma,Io=yr,Ja=(Kr=ct(),Ua=bt(1,0,0),ma=bt(0,1,0),function(d,l,h){var m=Ke(l,h);return m<-.999999?(We(Kr,Ua,l),Ii(Kr)<1e-6&&We(Kr,ma,l),xe(Kr,Kr),function(_,S,T){T*=.5;var C=Math.sin(T);_[0]=C*S[0],_[1]=C*S[1],_[2]=C*S[2],_[3]=Math.cos(T)}(d,Kr,Math.PI),d):m>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(We(Kr,l,h),d[0]=Kr[0],d[1]=Kr[1],d[2]=Kr[2],d[3]=1+m,Io(d,d))});function Qn(){var d=new f(2);return f!=Float32Array&&(d[0]=0,d[1]=0),d}function ou(d,l){var h=new f(2);return h[0]=d,h[1]=l,h}function Qa(d,l,h){return d[0]=l,d[1]=h,d}function to(d,l,h){return d[0]=l[0]+h[0],d[1]=l[1]+h[1],d}function xs(d,l,h){return d[0]=l[0]-h[0],d[1]=l[1]-h[1],d}function ls(d,l,h){return d[0]=l[0]*h,d[1]=l[1]*h,d}function jn(d){var l=d[0],h=d[1];return Math.sqrt(l*l+h*h)}function Co(d,l){var h=l[0],m=l[1],_=h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),d[0]=l[0]*_,d[1]=l[1]*_,d}function Ch(d,l){return d[0]*l[0]+d[1]*l[1]}hr(),hr(),v();var Tc,Gs,Nv=xs;function qp(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}Qn();var Q0=function(){if(Gs)return Tc;function d(l,h,m,_){this.cx=3*l,this.bx=3*(m-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(_-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=h,this.p2x=m,this.p2y=_}return Gs=1,Tc=d,d.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,h){if(h===void 0&&(h=1e-6),l<0)return 0;if(l>1)return 1;for(var m=l,_=0;_<8;_++){var S=this.sampleCurveX(m)-l;if(Math.abs(S)<h)return m;var T=this.sampleCurveDerivativeX(m);if(Math.abs(T)<1e-6)break;m-=S/T}var C=0,L=1;for(m=l,_=0;_<20&&(S=this.sampleCurveX(m),!(Math.abs(S-l)<h));_++)l>S?C=m:L=m,m=.5*(L-C)+C;return m},solve:function(l,h){return this.sampleCurveY(this.solveCurveX(l,h))}},Tc}(),Zd=qp(Q0);function Me(d,l){this.x=d,this.y=l}function Fu(d,l){if(Array.isArray(d)){if(!Array.isArray(l)||d.length!==l.length)return!1;for(let h=0;h<d.length;h++)if(!Fu(d[h],l[h]))return!1;return!0}if(typeof d=="object"&&d!==null&&l!==null){if(typeof l!="object"||Object.keys(d).length!==Object.keys(l).length)return!1;for(const h in d)if(!Fu(d[h],l[h]))return!1;return!0}return d===l}Me.prototype={clone(){return new Me(this.x,this.y)},add(d){return this.clone()._add(d)},sub(d){return this.clone()._sub(d)},multByPoint(d){return this.clone()._multByPoint(d)},divByPoint(d){return this.clone()._divByPoint(d)},mult(d){return this.clone()._mult(d)},div(d){return this.clone()._div(d)},rotate(d){return this.clone()._rotate(d)},rotateAround(d,l){return this.clone()._rotateAround(d,l)},matMult(d){return this.clone()._matMult(d)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(d){return this.x===d.x&&this.y===d.y},dist(d){return Math.sqrt(this.distSqr(d))},distSqr(d){const l=d.x-this.x,h=d.y-this.y;return l*l+h*h},angle(){return Math.atan2(this.y,this.x)},angleTo(d){return Math.atan2(this.y-d.y,this.x-d.x)},angleWith(d){return this.angleWithSep(d.x,d.y)},angleWithSep(d,l){return Math.atan2(this.x*l-this.y*d,this.x*d+this.y*l)},_matMult(d){const l=d[2]*this.x+d[3]*this.y;return this.x=d[0]*this.x+d[1]*this.y,this.y=l,this},_add(d){return this.x+=d.x,this.y+=d.y,this},_sub(d){return this.x-=d.x,this.y-=d.y,this},_mult(d){return this.x*=d,this.y*=d,this},_div(d){return this.x/=d,this.y/=d,this},_multByPoint(d){return this.x*=d.x,this.y*=d.y,this},_divByPoint(d){return this.x/=d.x,this.y/=d.y,this},_unit(){return this._div(this.mag()),this},_perp(){const d=this.y;return this.y=this.x,this.x=-d,this},_rotate(d){const l=Math.cos(d),h=Math.sin(d),m=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=m,this},_rotateAround(d,l){const h=Math.cos(d),m=Math.sin(d),_=l.y+m*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-m*(this.y-l.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Me},Me.convert=function(d){if(d instanceof Me)return d;if(Array.isArray(d))return new Me(+d[0],+d[1]);if(d.x!==void 0&&d.y!==void 0)return new Me(+d.x,+d.y);throw new Error("Expected [x, y] or {x, y} point format")};const Xp=Math.PI/180,Yp=180/Math.PI;function wr(d){return d*Xp}function Vo(d){return d*Yp}const tx=[[0,0],[1,0],[1,1],[0,1]];function Kp(d){if(d<=0)return 0;if(d>=1)return 1;const l=d*d,h=l*d;return 4*(d<.5?h:3*(d-l)+h-.75)}function Xt(d,l,h,m){const _=new Zd(d,l,h,m);return function(S){return _.solve(S)}}const ot=Xt(.25,.1,.25,1);function lt(d,l,h){return Math.min(h,Math.max(l,d))}function Tt(d,l,h){return(h=lt((h-d)/(l-d),0,1))*h*(3-2*h)}function Nt(d,l,h){const m=h-l,_=((d-l)%m+m)%m+l;return _===l?h:_}function Ft(d,l,h){if(!d.length)return h(null,[]);let m=d.length;const _=new Array(d.length);let S=null;d.forEach((T,C)=>{l(T,(L,k)=>{L&&(S=L),_[C]=k,--m==0&&h(S,_)})})}let Wt=1;function ne(){return Wt++}function $t(d){return d<=1?1:Math.pow(2,Math.ceil(Math.log2(d)))}function ie(d,l){d.forEach(h=>{l[h]&&(l[h]=l[h].bind(l))})}function Oe(d,l,h){const m={};for(const _ in d)m[_]=l.call(this,d[_],_,d);return m}function Ce(d,l,h){const m={};for(const _ in d)l.call(this,d[_],_,d)&&(m[_]=d[_]);return m}function mi(d){return Array.isArray(d)?d.map(mi):typeof d=="object"&&d?Oe(d,mi):d}function Gi(d,l){for(let h=0;h<d.length;h++)if(l.indexOf(d[h])>=0)return!0;return!1}const Bi={};function Mi(d){Bi[d]||(typeof console<"u"&&console.warn(d),Bi[d]=!0)}function dr(d,l,h){return(h.y-d.y)*(l.x-d.x)>(l.y-d.y)*(h.x-d.x)}function pr(d){let l=0;for(let h,m,_=0,S=d.length,T=S-1;_<S;T=_++)h=d[_],m=d[T],l+=(m.x-h.x)*(h.y+m.y);return l}function nn([d,l,h]){const m=wr(l+90),_=wr(h);return{x:d*Math.cos(m)*Math.sin(_),y:d*Math.sin(m)*Math.sin(_),z:d*Math.cos(_),azimuthal:l,polar:h}}function Yn(d){return(typeof self<"u"||d!==void 0)&&typeof WorkerGlobalScope<"u"&&(d!==void 0?d:self)instanceof WorkerGlobalScope}function wa(d){const l={};if(d.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,_,S)=>{const T=_||S;return l[m]=!T||T.toLowerCase(),""}),l["max-age"]){const h=parseInt(l["max-age"],10);isNaN(h)?delete l["max-age"]:l["max-age"]=h}return l}let oa=null;function ia(d,l){return[d[4*l],d[4*l+1],d[4*l+2],d[4*l+3]]}function en(d,l,h,m){for(;l<h;){const _=l+h>>1;d[_]<m?l=_+1:h=_}return l}function Sr(d,l,h,m){for(;l<h;){const _=l+h>>1;d[_]<=m?l=_+1:h=_}return l}function Tn(d){return d>0?1/(1.001-d):1+d}function Wn(d){return d>0?1-1/(1.001-d):-d}function sn(d,l,h){return(d-l.min)*(h.max-h.min)/(l.max-l.min)+h.min}const An={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!An.API_URL)return null;try{const d=new URL(An.API_URL);return d.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":d.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function za(d){return An.API_URL_REGEX.test(d)}function Uo(d){return An.API_SPRITE_REGEX.test(d)}let ml,Mh,Ga,vl,Yo,Bl;function bs(){return ml==null&&(ml=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ml}const ws={now:()=>vl!==void 0?vl:performance.now(),setNow(d){vl=d},restoreNow(){vl=void 0},frame(d){const l=requestAnimationFrame(d);return{cancel:()=>cancelAnimationFrame(l)}},getImageData(d,l=0){const{width:h,height:m}=d;Yo||(Yo=document.createElement("canvas"));const _=Yo.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(h>Yo.width||m>Yo.height)&&(Yo.width=h,Yo.height=m),_.clearRect(-l,-l,h+2*l,m+2*l),_.drawImage(d,0,0,h,m),_.getImageData(-l,-l,h+2*l,m+2*l)},resolveURL:d=>(Mh||(Mh=document.createElement("a")),Mh.href=d,Mh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ga==null&&(Ga=window.matchMedia("(prefers-reduced-motion: reduce)")),Ga.matches)},hasCanvasFingerprintNoise(){if(Bl!==void 0)return Bl;if(!bs())return Bl=!1,!1;const d=new OffscreenCanvas(85,1),l=d.getContext("2d",{willReadFrequently:!0});let h=0;for(let _=0;_<d.width;++_)l.fillStyle=`rgba(${h++},${h++},${h++}, 255)`,l.fillRect(_,0,1,1);const m=l.getImageData(0,0,d.width,d.height);h=0;for(let _=0;_<m.data.length;++_)if(_%4!=3&&h++!==m.data[_])return Bl=!0,!0;return Bl=!1,!1}};function Vv(d,l){const h=d.indexOf("?");if(h<0)return`${d}?${new URLSearchParams(l).toString()}`;const m=new URLSearchParams(d.slice(h));for(const _ in l)m.set(_,l[_]);return`${d.slice(0,h)}?${m.toString()}`}function Jp(d,l={persistentParams:[]}){const h=d.indexOf("?");if(h<0)return d;const m=new URLSearchParams,_=new URLSearchParams(d.slice(h));for(const T of l.persistentParams){const C=_.get(T);C&&m.set(T,C)}const S=m.toString();return`${d.slice(0,h)}${S.length>0?`?${S}`:""}`}const Qp="mapbox-tiles";let tg=500,us=50;const Fl=["language","worldview","jobid"];let Ko,Hs;function Nu(){try{return caches}catch{}}function Eh(){const d=Nu();d&&Ko==null&&(Ko=d.open(Qp))}let Uv=1/0;const Gv={supported:!1,testSupport:function(d){!ex&&Ac&&(tT?ix(d):su=d)}};let su,Ac,ex=!1,tT=!1;const _l=typeof self<"u"?self:{};function ix(d){const l=d.createTexture();d.bindTexture(d.TEXTURE_2D,l);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Ac),d.isContextLost())return;Gv.supported=!0}catch{}d.deleteTexture(l),ex=!0}_l.document&&(Ac=_l.document.createElement("img"),Ac.onload=function(){su&&ix(su),su=null,tT=!0},Ac.onerror=function(){ex=!0,su=null},Ac.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Dh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Dh);class Ph extends Error{constructor(l,h,m){h===401&&za(m)&&(l+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(l),this.status=h,this.url=m}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const rx=Yn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,eg=function(d,l){if(!(/^file:/.test(h=d.url)||/^file:/.test(rx())&&!/^\w+:/.test(h))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(m,_){const S=new AbortController,T=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:rx(),referrerPolicy:m.referrerPolicy,signal:S.signal});let C=!1,L=!1;const k=(F=T.url).indexOf("sku=")>0&&za(F);var F;m.type==="json"&&T.headers.set("Accept","application/json");const V=($,Z,Q)=>{if(L)return;if($&&$.message!=="SecurityError"&&Mi($.toString()),Z&&Q)return U(Z);const et=Date.now();fetch(T).then(nt=>{if(nt.ok){const dt=k?nt.clone():null;return U(nt,dt,et)}return _(new Ph(nt.statusText,nt.status,m.url))}).catch(nt=>{nt.name!=="AbortError"&&_(new Error(`${nt.message} ${m.url}`))})},U=($,Z,Q)=>{(m.type==="arrayBuffer"?$.arrayBuffer():m.type==="json"?$.json():$.text()).then(et=>{L||(Z&&Q&&function(nt,dt,mt){if(Eh(),Ko==null)return;const yt=wa(dt.headers.get("Cache-Control")||"");if(yt["no-store"])return;const Lt={status:dt.status,statusText:dt.statusText,headers:new Headers};dt.headers.forEach((Ut,Ht)=>Lt.headers.set(Ht,Ut)),yt["max-age"]&&Lt.headers.set("Expires",new Date(mt+1e3*yt["max-age"]).toUTCString());const It=Lt.headers.get("Expires");if(!It||new Date(It).getTime()-mt<42e4)return;let Ot=Jp(nt.url,{persistentParams:Fl});if(dt.status===206){const Ut=nt.headers.get("Range");if(!Ut)return;Lt.status=200,Ot=Vv(Ot,{range:Ut})}(function(Ut,Ht){if(Hs===void 0)try{new Response(new ReadableStream),Hs=!0}catch{Hs=!1}Hs?Ht(Ut.body):Ut.blob().then(Ht).catch(se=>Mi(se.message))})(dt,Ut=>{const Ht=new Response((se=dt.status)!==200&&se!==404&&[101,103,204,205,304].includes(se)?null:Ut,Lt);var se;Eh(),Ko!=null&&Ko.then(Kt=>Kt.put(Ot,Ht)).catch(Kt=>Mi(Kt.message))})}(T,Z,Q),C=!0,_(null,et,$.headers))}).catch(et=>{L||_(new Error(et.message))})};return k?function($,Z){if(Eh(),Ko==null)return Z(null);Ko.then(Q=>{let et=Jp($.url,{persistentParams:Fl});const nt=$.headers.get("Range");nt&&(et=Vv(et,{range:nt})),Q.match(et).then(dt=>{const mt=function(yt){if(!yt)return!1;const Lt=new Date(yt.headers.get("Expires")||0),It=wa(yt.headers.get("Cache-Control")||"");return Number(Lt)>Date.now()&&!It["no-cache"]}(dt);Q.delete(et).catch(Z),mt&&Q.put(et,dt.clone()).catch(Z),Z(null,dt,mt)}).catch(Z)}).catch(Z)}(T,V):V(null,null),{cancel:()=>{L=!0,C||S.abort()}}}(d,l);if(Yn(self)&&self.worker.actor)return self.worker.actor.send("getResource",d,l,void 0,!0)}var h;return function(m,_){const S=new XMLHttpRequest;S.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(S.responseType="arraybuffer");for(const T in m.headers)S.setRequestHeader(T,m.headers[T]);return m.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=m.credentials==="include",S.onerror=()=>{_(new Error(S.statusText))},S.onload=()=>{if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let T=S.response;if(m.type==="json")try{T=JSON.parse(S.response)}catch(L){return _(L)}const C=new Headers;S.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(L=>{const k=L.split(": "),F=k.shift(),V=k.join(": ");C.append(F,V)}),_(null,T,C)}else _(new Ph(S.statusText,S.status,m.url))},S.send(m.body),{cancel:()=>S.abort()}}(d,l)},qd=function(d,l){return eg(Object.assign(d,{type:"arrayBuffer"}),l)};function Ur(d){const l=document.createElement("a");return l.href=d,l.protocol===location.protocol&&l.host===location.host}const nx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ig,rg;ig=[],rg=0;const ax=function(d,l){if(Gv.supported&&(d.headers||(d.headers={}),d.headers.accept="image/webp,*/*"),rg>=An.MAX_PARALLEL_IMAGE_REQUESTS){const S={requestParameters:d,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return ig.push(S),S}rg++;let h=!1;const m=()=>{if(!h)for(h=!0,rg--;ig.length&&rg<An.MAX_PARALLEL_IMAGE_REQUESTS;){const S=ig.shift(),{requestParameters:T,callback:C,cancelled:L}=S;L||(S.cancel=ax(T,C).cancel)}},_=qd(d,(S,T,C)=>{m(),S?l(S):T&&(self.createImageBitmap?function(L,k){const F=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(F).then(V=>{k(null,V)}).catch(V=>{k(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(T,(L,k)=>l(L,k,C)):function(L,k){const F=new Image;F.onload=()=>{k(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame(()=>{F.src=nx})},F.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Blob([new Uint8Array(L)],{type:"image/png"});F.src=L.byteLength?URL.createObjectURL(V):nx}(T,(L,k)=>l(L,k,C)))});return{cancel:()=>{_.cancel(),m()}}};var ng,ag,og,Lh={exports:{}},eT={exports:{}},Hv={exports:{}},BE=function(){if(og)return Lh.exports;og=1;var d=(ng||(ng=1,eT.exports=function(h,m){var _,S,T,C,L,k,F,V;for(S=h.length-(_=3&h.length),T=m,L=3432918353,k=461845907,V=0;V<S;)F=255&h.charCodeAt(V)|(255&h.charCodeAt(++V))<<8|(255&h.charCodeAt(++V))<<16|(255&h.charCodeAt(++V))<<24,++V,T=27492+(65535&(C=5*(65535&(T=(T^=F=(65535&(F=(F=(65535&F)*L+(((F>>>16)*L&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(F=0,_){case 3:F^=(255&h.charCodeAt(V+2))<<16;case 2:F^=(255&h.charCodeAt(V+1))<<8;case 1:T^=F=(65535&(F=(F=(65535&(F^=255&h.charCodeAt(V)))*L+(((F>>>16)*L&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295}return T^=h.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),eT.exports),l=(ag||(ag=1,Hv.exports=function(h,m){for(var _,S=h.length,T=m^S,C=0;S>=4;)_=1540483477*(65535&(_=255&h.charCodeAt(C)|(255&h.charCodeAt(++C))<<8|(255&h.charCodeAt(++C))<<16|(255&h.charCodeAt(++C))<<24))+((1540483477*(_>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),S-=4,++C;switch(S){case 3:T^=(255&h.charCodeAt(C+2))<<16;case 2:T^=(255&h.charCodeAt(C+1))<<8;case 1:T=1540483477*(65535&(T^=255&h.charCodeAt(C)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),Hv.exports);return Lh.exports=d,Lh.exports.murmur3=d,Lh.exports.murmur2=l,Lh.exports}(),sg=qp(BE);class js{constructor(l,...h){Object.assign(this,h[0]||{}),this.type=l}}class lg extends js{constructor(l,h={}){super("error",Object.assign({error:l},h))}}function Xd(d,l,h){h[d]&&h[d].indexOf(l)!==-1||(h[d]=h[d]||[],h[d].push(l))}function ug(d,l,h){if(h&&h[d]){const m=h[d].indexOf(l);m!==-1&&h[d].splice(m,1)}}class Vu{on(l,h){return this._listeners=this._listeners||{},Xd(l,h,this._listeners),this}off(l,h){return ug(l,h,this._listeners),ug(l,h,this._oneTimeListeners),this}once(l,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Xd(l,h,this._oneTimeListeners),this):new Promise(m=>{this.once(l,m)})}fire(l,h){const m=typeof l=="string"?new js(l,h):l,_=m.type;if(this.listens(_)){m.target=this;const S=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const L of S)L.call(this,m);const T=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const L of T)ug(_,L,this._oneTimeListeners),L.call(this,m);const C=this._eventedParent;if(C){const L=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(m,L),C.fire(m)}}else m instanceof lg&&console.error(m.error);return this}listens(l){return!!(this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l))}setEventedParent(l,h){return this._eventedParent=l,this._eventedParentData=h,this}}class Ba{constructor(l){typeof l=="string"?this.name=l:(this.name=l.name,this.iconsetId=l.iconsetId)}static from(l){return new Ba(l)}static toString(l){return l.iconsetId?`${l.name}${l.iconsetId}`:l.name}static parse(l){const[h,m]=l.split("");return new Ba({name:h,iconsetId:m})}static isEqual(l,h){return l.name===h.name&&l.iconsetId===h.iconsetId}toString(){return Ba.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ox,sx={},lx=function(){if(ox)return sx;ox=1;var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(S){return(S=Math.round(S))<0?0:S>255?255:S}function h(S){return l(S[S.length-1]==="%"?parseFloat(S)/100*255:parseInt(S))}function m(S){return(T=S[S.length-1]==="%"?parseFloat(S)/100:parseFloat(S))<0?0:T>1?1:T;var T}function _(S,T,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?S+(T-S)*C*6:2*C<1?T:3*C<2?S+(T-S)*(2/3-C)*6:S}try{sx.parseCSSColor=function(S){var T,C=S.replace(/ /g,"").toLowerCase();if(C in d)return d[C].slice();if(C[0]==="#")return C.length===4?(T=parseInt(C.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:C.length===7&&(T=parseInt(C.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var L=C.indexOf("("),k=C.indexOf(")");if(L!==-1&&k+1===C.length){var F=C.substr(0,L),V=C.substr(L+1,k-(L+1)).split(","),U=1;switch(F){case"rgba":if(V.length!==4)return null;U=m(V.pop());case"rgb":return V.length!==3?null:[h(V[0]),h(V[1]),h(V[2]),U];case"hsla":if(V.length!==4)return null;U=m(V.pop());case"hsl":if(V.length!==3)return null;var $=(parseFloat(V[0])%360+360)%360/360,Z=m(V[1]),Q=m(V[2]),et=Q<=.5?Q*(Z+1):Q+Z-Q*Z,nt=2*Q-et;return[l(255*_(nt,et,$+1/3)),l(255*_(nt,et,$)),l(255*_(nt,et,$-1/3)),U];default:return null}}return null}}catch{}return sx}();class Xr{constructor(l,h,m,_=1){this.r=l,this.g=h,this.b=m,this.a=_}static parse(l){if(!l)return;if(l instanceof Xr)return l;if(typeof l!="string")return;const h=lx.parseCSSColor(l);return h?new Xr(h[0]/255,h[1]/255,h[2]/255,h[3]):void 0}toString(){const[l,h,m,_]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*l)},${Math.round(255*h)},${Math.round(255*m)},${_})`}toNonPremultipliedRenderColor(l){const{r:h,g:m,b:_,a:S}=this;return new iT(l,h,m,_,S)}toPremultipliedRenderColor(l){const{r:h,g:m,b:_,a:S}=this;return new rT(l,h*S,m*S,_*S,S)}clone(){return new Xr(this.r,this.g,this.b,this.a)}}class ux{constructor(l,h,m,_,S,T=!1){if(this.premultiplied=!1,this.premultiplied=T,l){const C=l.image.height,L=C*C;this.premultiplied?(h=S===0?0:h/S*(C-1),m=S===0?0:m/S*(C-1),_=S===0?0:_/S*(C-1)):(h*=C-1,m*=C-1,_*=C-1);const k=Math.floor(h),F=Math.floor(m),V=Math.floor(_),U=Math.ceil(h),$=Math.ceil(m),Z=Math.ceil(_),Q=h-k,et=m-F,nt=_-V,dt=l.image.data,mt=4*(k+F*L+V*C),yt=4*(k+F*L+Z*C),Lt=4*(k+$*L+V*C),It=4*(k+$*L+Z*C),Ot=4*(U+F*L+V*C),Ut=4*(U+F*L+Z*C),Ht=4*(U+$*L+V*C),se=4*(U+$*L+Z*C);if(mt<0||se>=dt.length)throw new Error("out of range");this.r=zi(zi(zi(dt[mt],dt[yt],nt),zi(dt[Lt],dt[It],nt),et),zi(zi(dt[Ot],dt[Ut],nt),zi(dt[Ht],dt[se],nt),et),Q)/255*(this.premultiplied?S:1),this.g=zi(zi(zi(dt[mt+1],dt[yt+1],nt),zi(dt[Lt+1],dt[It+1],nt),et),zi(zi(dt[Ot+1],dt[Ut+1],nt),zi(dt[Ht+1],dt[se+1],nt),et),Q)/255*(this.premultiplied?S:1),this.b=zi(zi(zi(dt[mt+2],dt[yt+2],nt),zi(dt[Lt+2],dt[It+2],nt),et),zi(zi(dt[Ot+2],dt[Ut+2],nt),zi(dt[Ht+2],dt[se+2],nt),et),Q)/255*(this.premultiplied?S:1),this.a=S}else this.r=h,this.g=m,this.b=_,this.a=S}toArray(){const{r:l,g:h,b:m,a:_}=this;return[255*l,255*h,255*m,_]}toHslaArray(){let{r:l,g:h,b:m,a:_}=this;if(this.premultiplied){if(_===0)return[0,0,0,0];const Z=1/_;l*=Z,h*=Z,m*=Z}const S=Math.min(Math.max(l,0),1),T=Math.min(Math.max(h,0),1),C=Math.min(Math.max(m,0),1),L=Math.min(S,T,C),k=Math.max(S,T,C),F=k-L,V=.5*(L+k);if(F===0)return[0,0,100*V,_];const U=V>.5?F/(2-k-L):F/(k+L);let $;switch(k){case S:$=60*((T-C)/F+(T<C?6:0));break;case T:$=60*((C-S)/F+2);break;default:$=60*((S-T)/F+4)}return[$,100*U,100*V,_]}toArray01(){const{r:l,g:h,b:m,a:_}=this;return[l,h,m,_]}toArray01Scaled(l){const{r:h,g:m,b:_}=this;return[h*l,m*l,_*l]}toArray01Linear(){const{r:l,g:h,b:m,a:_}=this;return[Math.pow(l,2.2),Math.pow(h,2.2),Math.pow(m,2.2),_]}}class iT extends ux{constructor(l,h,m,_,S){super(l,h,m,_,S,!1)}}class rT extends ux{constructor(l,h,m,_,S){super(l,h,m,_,S,!0)}}function zi(d,l,h){return d*(1-h)+l*h}function cg(d,l,h){return d.map((m,_)=>zi(m,l[_],h))}Xr.black=new Xr(0,0,0,1),Xr.white=new Xr(1,1,1,1),Xr.transparent=new Xr(0,0,0,0),Xr.red=new Xr(1,0,0,1),Xr.blue=new Xr(0,0,1,1);var Uu=Object.freeze({__proto__:null,array:cg,color:function(d,l,h){return new Xr(zi(d.r,l.r,h),zi(d.g,l.g,h),zi(d.b,l.b,h),zi(d.a,l.a,h))},number:zi});class yl extends Error{constructor(l,h){super(h),this.message=h,this.key=l}}class xl{constructor(l,h=[]){this.parent=l,this.bindings={};for(const[m,_]of h)this.bindings[m]=_}concat(l){return new xl(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Yd={kind:"null"},yi={kind:"number"},kr={kind:"string"},$r={kind:"boolean"},Ss={kind:"color"},Kd={kind:"object"},Jr={kind:"value"},hg={kind:"collator"},Rh={kind:"formatted"},dg={kind:"resolvedImage"};function eo(d,l){return{kind:"array",itemType:d,N:l}}function Da(d){if(d.kind==="array"){const l=Da(d.itemType);return typeof d.N=="number"?`array<${l}, ${d.N}>`:d.itemType.kind==="value"?"array":`array<${l}>`}return d.kind}const FE=[Yd,yi,kr,$r,Ss,Rh,Kd,eo(Jr),dg];function fg(d,l){if(l.kind==="error")return null;if(d.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!fg(d.itemType,l.itemType))&&(typeof d.N!="number"||d.N===l.N))return null}else{if(d.kind===l.kind)return null;if(d.kind==="value"){for(const h of FE)if(!fg(h,l))return null}}return`Expected ${Da(d)} but found ${Da(l)} instead.`}function cx(d,l){return l.some(h=>h.kind===d.kind)}function pg(d,l){return l.some(h=>h==="null"?d===null:h==="array"?Array.isArray(d):h==="object"?d&&!Array.isArray(d)&&typeof d=="object":h===typeof d)}function jv(d,l){return d.kind==="array"&&l.kind==="array"?d.N===l.N&&jv(d.itemType,l.itemType):d.kind===l.kind}class hx{constructor(l,h,m){this.sensitivity=l?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,h){return this.collator.compare(l,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gg{constructor(l,h,m,_,S){this.text=l.normalize?l.normalize():l,this.image=h,this.scale=m,this.fontStack=_,this.textColor=S}}class Za{constructor(l){this.sections=l}static fromString(l){return new Za([new gg(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||!!l.image&&l.image.hasPrimary())}static factory(l){return l instanceof Za?l:Za.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}serialize(){const l=["format"];for(const h of this.sections){if(h.image){const _=h.image.getPrimary().id.toString();l.push(["image",_]);continue}l.push(h.text);const m={};h.fontStack&&(m["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(m["font-scale"]=h.scale),h.textColor&&(m["text-color"]=["rgba"].concat(h.textColor.toNonPremultipliedRenderColor(null).toArray())),l.push(m)}return l}}class Gu{constructor(l,h={}){if(this.id=Ba.from(l),this.options=Object.assign({},h),h.transform){const{a:m,b:_,c:S,d:T,e:C,f:L}=h.transform;this.options.transform=new DOMMatrix([m,_,S,T,C,L])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:l,b:h,c:m,d:_,e:S,f:T}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:l,b:h,c:m,d:_,e:S,f:T}})}static parse(l){let h,m,_,S;try{({name:h,iconsetId:m,params:_,transform:S}=JSON.parse(l)||{})}catch{return null}if(!h)return null;const{a:T,b:C,c:L,d:k,e:F,f:V}=S||{};return new Gu({name:h,iconsetId:m},{params:_,transform:new DOMMatrix([T,C,L,k,F,V])})}scaleSelf(l,h){return this.options.transform.scaleSelf(l,h),this}}class cs{constructor(l,h,m,_,S=!1){this.primaryId=Ba.from(l),this.primaryOptions=h,m&&(this.secondaryId=Ba.from(m)),this.secondaryOptions=_,this.available=S}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Gu(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Gu(this.secondaryId,this.secondaryOptions):null}static from(l){return typeof l=="string"?cs.build({name:l}):l}static build(l,h,m,_){return!l||typeof l=="object"&&!("name"in l)?null:new cs(l,m,h,_)}}function Wv(d,l,h,m){return typeof d=="number"&&d>=0&&d<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[d,l,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[d,l,h,m]:[d,l,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Jd(d){if(d===null||typeof d=="string"||typeof d=="boolean"||typeof d=="number"||d instanceof Xr||d instanceof hx||d instanceof Za||d instanceof cs)return!0;if(Array.isArray(d)){for(const l of d)if(!Jd(l))return!1;return!0}if(typeof d=="object"){for(const l in d)if(!Jd(d[l]))return!1;return!0}return!1}function Ha(d){if(d===null)return Yd;if(typeof d=="string")return kr;if(typeof d=="boolean")return $r;if(typeof d=="number")return yi;if(d instanceof Xr)return Ss;if(d instanceof hx)return hg;if(d instanceof Za)return Rh;if(d instanceof cs)return dg;if(Array.isArray(d)){const l=d.length;let h;for(const m of d){const _=Ha(m);if(h){if(h===_)continue;h=Jr;break}h=_}return eo(h||Jr,l)}return Kd}function lu(d){const l=typeof d;return d===null?"":l==="string"||l==="number"||l==="boolean"?String(d):d instanceof Za||d instanceof cs||d instanceof Xr?d.toString():JSON.stringify(d)}class Hu{constructor(l,h){this.type=l,this.value=h}static parse(l,h){if(l.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Jd(l[1]))return h.error("invalid value");const m=l[1];let _=Ha(m);const S=h.expectedType;return _.kind!=="array"||_.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(_=S),new Hu(_,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Za?this.value.serialize():this.value}}class sa{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const lr={string:kr,number:yi,boolean:$r,object:Kd};class fi{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let m,_=1;const S=l[0];if(S==="array"){let C,L;if(l.length>2){const k=l[1];if(typeof k!="string"||!(k in lr)||k==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);C=lr[k],_++}else C=Jr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return h.error('The length argument to "array" must be a positive integer literal',2);L=l[2],_++}m=eo(C,L)}else m=lr[S];const T=[];for(;_<l.length;_++){const C=h.parse(l[_],_,Jr);if(!C)return null;T.push(C)}return new fi(m,T)}evaluate(l){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(l);if(!fg(this.type,Ha(m)))return m;if(h===this.args.length-1)throw new sa(`The expression ${JSON.stringify(this.args[h].serialize())} evaluated to ${Da(Ha(m))} but was expected to be of type ${Da(this.type)}.`)}return null}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=this.type,h=[l.kind];if(l.kind==="array"){const m=l.itemType;if(m.kind==="string"||m.kind==="number"||m.kind==="boolean"){h.push(m.kind);const _=l.N;(typeof _=="number"||this.args.length>1)&&h.push(_)}}return h.concat(this.args.map(m=>m.serialize()))}}class kh{constructor(l){this.type=Rh,this.sections=l}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const _=[];let S=!1;for(let T=1;T<=l.length-1;++T){const C=l[T];if(S&&typeof C=="object"&&!Array.isArray(C)){S=!1;let L=null;if(C["font-scale"]&&(L=h.parseObjectValue(C["font-scale"],T,"font-scale",yi),!L))return null;let k=null;if(C["text-font"]&&(k=h.parseObjectValue(C["text-font"],T,"text-font",eo(kr)),!k))return null;let F=null;if(C["text-color"]&&(F=h.parseObjectValue(C["text-color"],T,"text-color",Ss),!F))return null;const V=_[_.length-1];V.scale=L,V.font=k,V.textColor=F}else{const L=h.parse(l[T],T,Jr);if(!L)return null;const k=L.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,_.push({content:L,scale:null,font:null,textColor:null})}}return new kh(_)}evaluate(l){return new Za(this.sections.map(h=>{const m=h.content.evaluate(l);return jv(Ha(m),dg)?new gg("",m,null,null,null):new gg(lu(m),null,h.scale?h.scale.evaluate(l):null,h.font?h.font.evaluate(l).join(","):null,h.textColor?h.textColor.evaluate(l):null)}))}eachChild(l){for(const h of this.sections)l(h.content),h.scale&&l(h.scale),h.font&&l(h.font),h.textColor&&l(h.textColor)}outputDefined(){return!1}serialize(){const l=["format"];for(const h of this.sections){l.push(h.content.serialize());const m={};h.scale&&(m["font-scale"]=h.scale.serialize()),h.font&&(m["text-font"]=h.font.serialize()),h.textColor&&(m["text-color"]=h.textColor.serialize()),l.push(m)}return l}}class $i{constructor(l,h,m,_){this._imageWarnHistory={},this.type=dg,this.namePrimary=l,this.nameSecondary=h,m&&(this.paramsPrimary=m.params,this.iconsetIdPrimary=m.iconset?m.iconset.id:void 0),_&&(this.paramsSecondary=_.params,this.iconsetIdSecondary=_.iconset?_.iconset.id:void 0)}static parse(l,h){if(l.length<2)return h.error("Expected two or more arguments.");let m=1;const _=[];function S(){if(m<l.length){const C=h.parse(l[m],m++,kr);return C?(_.push({image:C,options:{}}),!0):(h.error(_.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function T(){if(m<l.length){const L=l[m];if((C=L)===null||typeof C!="object"||Array.isArray(C))return!0;const k=L.params,F=L.iconset,V=h.concat(m);if(!k&&!F)return m++,!0;if(k){if(typeof k!="object"||k.constructor!==Object)return V.error('Image options "params" should be an object'),!1;const U={},$=V.concat(void 0,"params");for(const Z in k){if(!Z)return $.error("Image parameter name should be non-empty"),!1;const Q=$.concat(void 0,Z).parse(k[Z],void 0,Ss,void 0,{typeAnnotation:"coerce"});if(!Q)return!1;U[Z]=Q}_[_.length-1].options.params=U}if(F){if(typeof F!="object"||F.constructor!==Object)return V.error('Image options "iconset" should be an object'),!1;if(!F.id)return V.error('Image options "iconset" should have an "id" property'),!1;_[_.length-1].options.iconset=F}return m++,!0}var C;return!0}for(let C=0;C<2;C++)if(!S()||!T())return;return new $i(_[0].image,_[1]?_[1].image:void 0,_[0].options,_[1]?_[1].options:void 0)}evaluateParams(l,h){const m={};if(h){for(const _ in h)if(h[_])try{m[_]=h[_].evaluate(l)}catch{continue}if(Object.keys(m).length!==0)return{params:m}}}evaluate(l){const h={name:this.namePrimary.evaluate(l),iconsetId:this.iconsetIdPrimary},m=this.nameSecondary?{name:this.nameSecondary.evaluate(l),iconsetId:this.iconsetIdSecondary}:void 0,_=cs.build(h,m,this.paramsPrimary?this.evaluateParams(l,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(l,this.paramsSecondary):void 0);if(_&&l.availableImages){const S=_.getPrimary().id;if(_.available=l.availableImages.some(T=>Ba.isEqual(T,S)),_.available){const T=_.getSecondary()?_.getSecondary().id:null;T&&(_.available=l.availableImages.some(C=>Ba.isEqual(C,T)))}}return _}eachChild(l){if(l(this.namePrimary),this.paramsPrimary)for(const h in this.paramsPrimary)this.paramsPrimary[h]&&l(this.paramsPrimary[h]);if(this.nameSecondary&&(l(this.nameSecondary),this.paramsSecondary))for(const h in this.paramsSecondary)this.paramsSecondary[h]&&l(this.paramsSecondary[h])}outputDefined(){return!1}serializeOptions(l,h){const m={};if(h&&(m.iconset={id:h}),l){m.params={};for(const _ in l)l[_]&&(m.params[_]=l[_].serialize())}return Object.keys(m).length>0?m:void 0}serialize(){const l=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const h=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);h&&l.push(h)}if(this.nameSecondary&&(l.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const h=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);h&&l.push(h)}return l}}function Qd(d){return Ni(d)?"string":mg(d)?"number":Zv(d)?"boolean":Array.isArray(d)?"array":d===null?"null":$v(d)?"object":typeof d}function $v(d){return d!=null&&!Array.isArray(d)&&typeof d!="function"&&!(d instanceof String||d instanceof Number||d instanceof Boolean)&&typeof d=="object"}function Ni(d){return typeof d=="string"||d instanceof String}function mg(d){return typeof d=="number"||d instanceof Number}function Zv(d){return typeof d=="boolean"||d instanceof Boolean}const nT={"to-boolean":$r,"to-color":Ss,"to-number":yi,"to-string":kr};class uu{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[0],_=[];let S=Yd;if(m==="to-array"){if(!Array.isArray(l[1]))return null;const T=l[1].length;if(h.expectedType){if(h.expectedType.kind!=="array")return h.error(`Expected ${h.expectedType.kind} but found array.`);S=eo(h.expectedType.itemType,T)}else{if(!(T>0&&Jd(l[1][0])))return null;S=eo(Ha(l[1][0]),T)}for(let C=0;C<T;C++){const L=l[1][C];let k;if(Array.isArray(L))k=h.parse(L,void 0,S.itemType);else{const F=Qd(L);if(F!==S.itemType.kind)return h.error(`Expected ${S.itemType.kind} but found ${F}.`);k=h.registry.literal.parse(["literal",L===void 0?null:L],h)}if(!k)return null;_.push(k)}}else{if((m==="to-boolean"||m==="to-string")&&l.length!==2)return h.error("Expected one argument.");S=nT[m];for(let T=1;T<l.length;T++){const C=h.parse(l[T],T,Jr);if(!C)return null;_.push(C)}}return new uu(S,_)}evaluate(l){if(this.type.kind==="boolean")return!!this.args[0].evaluate(l);if(this.type.kind==="color"){let h,m;for(const _ of this.args){if(h=_.evaluate(l),m=null,h instanceof Xr)return h;if(typeof h=="string"){const S=l.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Wv(h[0],h[1],h[2],h[3]),!m))return new Xr(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new sa(m||`Could not parse color from value '${typeof h=="string"?h:String(JSON.stringify(h))}'`)}if(this.type.kind==="number"){let h=null;for(const m of this.args){if(h=m.evaluate(l),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new sa(`Could not convert ${JSON.stringify(h)} to number.`)}return this.type.kind==="formatted"?Za.fromString(lu(this.args[0].evaluate(l))):this.type.kind==="resolvedImage"?cs.build(lu(this.args[0].evaluate(l))):this.type.kind==="array"?this.args.map(h=>h.evaluate(l)):lu(this.args[0].evaluate(l))}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $i(this.args[0]).serialize();const l=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(h=>{l.push(h.serialize())}),l}}const qv=["Unknown","Point","LineString","Polygon"];class io{constructor(l,h,m){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=l,this.options=h,this.iconImageUseTheme=m}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(l){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const l=this.featureDistanceData.center,h=this.featureDistanceData.scale,{x:m,y:_}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(m*h-l[0])+this.featureDistanceData.bearing[1]*(_*h-l[1])}return 0}parseColor(l){let h=this._parseColorCache[l];return h||(h=this._parseColorCache[l]=Xr.parse(l)),h}getConfig(l){return this.options?this.options.get(l):null}}class Go{constructor(l,h,m,_,S){this.name=l,this.type=h,this._evaluate=m,this.args=_,this._overloadIndex=S}evaluate(l){if(!this._evaluate){const h=Go.definitions[this.name];this._evaluate=Array.isArray(h)?h[2]:h.overloads[this._overloadIndex][1]}return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(l=>l.serialize()))}static parse(l,h){const m=l[0],_=Go.definitions[m];if(!_)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,C=[];let L=null,k=-1;for(const[F,V]of T){if(Array.isArray(F)&&F.length!==l.length-1)continue;C.push(F),k++,L=new n_(h.registry,h.path,null,h.scope,void 0,h._scope,h.options,h.iconImageUseTheme);const U=[];let $=!1;for(let Z=1;Z<l.length;Z++){const Q=l[Z],et=Array.isArray(F)?F[Z-1]:F.type,nt=L.parse(Q,1+U.length,et);if(!nt){$=!0;break}U.push(nt)}if(!$)if(Array.isArray(F)&&F.length!==U.length)L.error(`Expected ${F.length} arguments, but found ${U.length} instead.`);else{for(let Z=0;Z<U.length;Z++){const Q=Array.isArray(F)?F[Z]:F.type,et=U[Z];L.concat(Z+1).checkSubtype(Q,et.type)}if(L.errors.length===0)return new Go(m,S,V,U,k)}}if(C.length===1)h.errors.push(...L.errors);else{const F=(C.length?C:T.map(([U])=>U)).map(Oh).join(" | "),V=[];for(let U=1;U<l.length;U++){const $=h.parse(l[U],1+V.length);if(!$)return null;V.push(Da($.type))}h.error(`Expected arguments of type ${F}, but found (${V.join(", ")}) instead.`)}return null}static register(l,h){Go.definitions=h;for(const m in h)l[m]=Go}}function Oh(d){return Array.isArray(d)?`(${d.map(Da).join(", ")})`:`(${Da(d.type)}...)`}class tf{constructor(l,h,m){this.type=hg,this.locale=m,this.caseSensitive=l,this.diacriticSensitive=h}static parse(l,h){if(l.length!==2)return h.error("Expected one argument.");const m=l[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const _=m["case-sensitive"]===void 0?h.parse(!1,1,$r):h.parseObjectValue(m["case-sensitive"],1,"case-sensitive",$r);if(!_)return null;const S=m["diacritic-sensitive"]===void 0?h.parse(!1,1,$r):h.parseObjectValue(m["diacritic-sensitive"],1,"diacritic-sensitive",$r);if(!S)return null;let T=null;return m.locale&&(T=h.parseObjectValue(m.locale,1,"locale",kr),!T)?null:new tf(_,S,T)}evaluate(l){return new hx(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}serialize(){const l={};return l["case-sensitive"]=this.caseSensitive.serialize(),l["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(l.locale=this.locale.serialize()),["collator",l]}}function ju(d,l,h=0,m=d.length-1,_=NE){for(;m>h;){if(m-h>600){const L=m-h+1,k=l-h+1,F=Math.log(L),V=.5*Math.exp(2*F/3),U=.5*Math.sqrt(F*V*(L-V)/L)*(k-L/2<0?-1:1);ju(d,l,Math.max(h,Math.floor(l-k*V/L+U)),Math.min(m,Math.floor(l+(L-k)*V/L+U)),_)}const S=d[l];let T=h,C=m;for(ro(d,h,l),_(d[m],S)>0&&ro(d,h,m);T<C;){for(ro(d,T,C),T++,C--;_(d[T],S)<0;)T++;for(;_(d[C],S)>0;)C--}_(d[h],S)===0?ro(d,h,C):(C++,ro(d,C,m)),C<=l&&(h=C+1),l<=C&&(m=C-1)}}function ro(d,l,h){const m=d[l];d[l]=d[h],d[h]=m}function NE(d,l){return d<l?-1:d>l?1:0}function VE(d){let l=0;for(let h,m,_=0,S=d.length,T=S-1;_<S;T=_++)h=d[_],m=d[T],l+=(m.x-h.x)*(h.y+m.y);return l}function vg(d,l){d[0]=Math.min(d[0],l[0]),d[1]=Math.min(d[1],l[1]),d[2]=Math.max(d[2],l[0]),d[3]=Math.max(d[3],l[1])}function Ic(d,l){return!(d[0]<=l[0]||d[2]>=l[2]||d[1]<=l[1]||d[3]>=l[3])}function aT(d,l,h){const m=d[0]-l[0],_=d[1]-l[1],S=d[0]-h[0],T=d[1]-h[1];return m*T-S*_==0&&m*S<=0&&_*T<=0}function bl(d,l,h=!1){let m=!1;for(let C=0,L=l.length;C<L;C++){const k=l[C];for(let F=0,V=k.length,U=V-1;F<V;U=F++){const $=k[U],Z=k[F];if(aT(d,$,Z))return h;(S=$)[1]>(_=d)[1]!=(T=Z)[1]>_[1]&&_[0]<(T[0]-S[0])*(_[1]-S[1])/(T[1]-S[1])+S[0]&&(m=!m)}}var _,S,T;return m}function oT(d,l,h,m){const _=m[0]-h[0],S=m[1]-h[1],T=(d[0]-h[0])*S-_*(d[1]-h[1]),C=(l[0]-h[0])*S-_*(l[1]-h[1]);return T>0&&C<0||T<0&&C>0}function Xv(d,l,h,m){return(_=[m[0]-h[0],m[1]-h[1]])[0]*(S=[l[0]-d[0],l[1]-d[1]])[1]-_[1]*S[0]!=0&&!(!oT(d,l,h,m)||!oT(h,m,d,l));var _,S}function _g(d){const l=new Me(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h=new Me(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const m of d[0])l.x>m.x&&(l.x=m.x),l.y>m.y&&(l.y=m.y),h.x<m.x&&(h.x=m.x),h.y<m.y&&(h.y=m.y);return{min:l,max:h}}const Cc=8192;function UE(d,l){const h=(180+d[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d[1]*Math.PI/360)))/360,_=Math.pow(2,l.z);return[Math.round(h*_*Cc),Math.round(m*_*Cc)]}function sT(d,l){for(let h=0;h<l.length;h++)if(bl(d,l[h]))return!0;return!1}function GE(d,l,h){for(const m of h)for(let _=0,S=m.length,T=S-1;_<S;T=_++)if(Xv(d,l,m[T],m[_]))return!0;return!1}function Mc(d,l){for(let h=0;h<d.length;++h)if(!bl(d[h],l))return!1;for(let h=0;h<d.length-1;++h)if(GE(d[h],d[h+1],l))return!1;return!0}function HE(d,l){for(let h=0;h<l.length;h++)if(Mc(d,l[h]))return!0;return!1}function dx(d,l,h){const m=[];for(let _=0;_<d.length;_++){const S=[];for(let T=0;T<d[_].length;T++){const C=UE(d[_][T],h);vg(l,C),S.push(C)}m.push(S)}return m}function Yv(d,l,h){const m=[];for(let _=0;_<d.length;_++){const S=dx(d[_],l,h);m.push(S)}return m}function fx(d,l,h,m){if(d[0]<h[0]||d[0]>h[2]){const _=.5*m;let S=d[0]-h[0]>_?-m:h[0]-d[0]>_?m:0;S===0&&(S=d[0]-h[2]>_?-m:h[2]-d[0]>_?m:0),d[0]+=S}vg(l,d)}function px(d,l,h,m){const _=Math.pow(2,m.z)*Cc,S=[m.x*Cc,m.y*Cc],T=[];if(!d)return T;for(const C of d)for(const L of C){const k=[L.x+S[0],L.y+S[1]];fx(k,l,h,_),T.push(k)}return T}function wl(d,l,h,m){const _=Math.pow(2,m.z)*Cc,S=[m.x*Cc,m.y*Cc],T=[];if(!d)return T;for(const L of d){const k=[];for(const F of L){const V=[F.x+S[0],F.y+S[1]];vg(l,V),k.push(V)}T.push(k)}if(l[2]-l[0]<=_/2){(C=l)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const L of T)for(const k of L)fx(k,l,h,_)}var C;return T}class zh{constructor(l,h){this.type=$r,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Jd(l[1])){const m=l[1];if(m.type==="FeatureCollection")for(let _=0;_<m.features.length;++_){const S=m.features[_].geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new zh(m,m.features[_].geometry)}else if(m.type==="Feature"){const _=m.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new zh(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new zh(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,m){const _=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(!T)return!1;if(m.type==="Polygon"){const C=dx(m.coordinates,S,T),L=px(h.geometry(),_,S,T);if(!Ic(_,S))return!1;for(const k of L)if(!bl(k,C))return!1}if(m.type==="MultiPolygon"){const C=Yv(m.coordinates,S,T),L=px(h.geometry(),_,S,T);if(!Ic(_,S))return!1;for(const k of L)if(!sT(k,C))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,m){const _=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(!T)return!1;if(m.type==="Polygon"){const C=dx(m.coordinates,S,T),L=wl(h.geometry(),_,S,T);if(!Ic(_,S))return!1;for(const k of L)if(!Mc(k,C))return!1}if(m.type==="MultiPolygon"){const C=Yv(m.coordinates,S,T),L=wl(h.geometry(),_,S,T);if(!Ic(_,S))return!1;for(const k of L)if(!HE(k,C))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const yg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},gx=1/298.257223563,mx=gx*(2-gx),ef=Math.PI/180;class rf{static fromTile(l,h,m){const _=Math.PI*(1-2*(l+.5)/Math.pow(2,h)),S=Math.atan(.5*(Math.exp(_)-Math.exp(-_)))/ef;return new rf(S,m)}static get units(){return yg}constructor(l,h){if(l===void 0)throw new Error("No latitude given.");if(h&&!yg[h])throw new Error(`Unknown unit ${h}. Use one of: ${Object.keys(yg).join(", ")}`);const m=6378.137*ef*(h?yg[h]:1),_=Math.cos(l*ef),S=1/(1-mx*(1-_*_)),T=Math.sqrt(S);this.kx=m*T*_,this.ky=m*T*S*(1-mx)}distance(l,h){const m=Ws(l[0]-h[0])*this.kx,_=(l[1]-h[1])*this.ky;return Math.sqrt(m*m+_*_)}bearing(l,h){const m=Ws(h[0]-l[0])*this.kx;return Math.atan2(m,(h[1]-l[1])*this.ky)/ef}destination(l,h,m){const _=m*ef;return this.offset(l,Math.sin(_)*h,Math.cos(_)*h)}offset(l,h,m){return[l[0]+h/this.kx,l[1]+m/this.ky]}lineDistance(l){let h=0;for(let m=0;m<l.length-1;m++)h+=this.distance(l[m],l[m+1]);return h}area(l){let h=0;for(let m=0;m<l.length;m++){const _=l[m];for(let S=0,T=_.length,C=T-1;S<T;C=S++)h+=Ws(_[S][0]-_[C][0])*(_[S][1]+_[C][1])*(m?-1:1)}return Math.abs(h)/2*this.kx*this.ky}along(l,h){let m=0;if(h<=0)return l[0];for(let _=0;_<l.length-1;_++){const S=l[_],T=l[_+1],C=this.distance(S,T);if(m+=C,m>h)return Kv(S,T,(h-(m-C))/C)}return l[l.length-1]}pointToSegmentDistance(l,h,m){let[_,S]=h,T=Ws(m[0]-_)*this.kx,C=(m[1]-S)*this.ky;if(T!==0||C!==0){const L=(Ws(l[0]-_)*this.kx*T+(l[1]-S)*this.ky*C)/(T*T+C*C);L>1?(_=m[0],S=m[1]):L>0&&(_+=T/this.kx*L,S+=C/this.ky*L)}return T=Ws(l[0]-_)*this.kx,C=(l[1]-S)*this.ky,Math.sqrt(T*T+C*C)}pointOnLine(l,h){let m=1/0,_=l[0][0],S=l[0][1],T=0,C=0;for(let L=0;L<l.length-1;L++){let k=l[L][0],F=l[L][1],V=Ws(l[L+1][0]-k)*this.kx,U=(l[L+1][1]-F)*this.ky,$=0;V===0&&U===0||($=(Ws(h[0]-k)*this.kx*V+(h[1]-F)*this.ky*U)/(V*V+U*U),$>1?(k=l[L+1][0],F=l[L+1][1]):$>0&&(k+=V/this.kx*$,F+=U/this.ky*$)),V=Ws(h[0]-k)*this.kx,U=(h[1]-F)*this.ky;const Z=V*V+U*U;Z<m&&(m=Z,_=k,S=F,T=L,C=$)}return{point:[_,S],index:T,t:Math.max(0,Math.min(1,C))}}lineSlice(l,h,m){let _=this.pointOnLine(m,l),S=this.pointOnLine(m,h);if(_.index>S.index||_.index===S.index&&_.t>S.t){const k=_;_=S,S=k}const T=[_.point],C=_.index+1,L=S.index;!vx(m[C],T[0])&&C<=L&&T.push(m[C]);for(let k=C+1;k<=L;k++)T.push(m[k]);return vx(m[L],S.point)||T.push(S.point),T}lineSliceAlong(l,h,m){let _=0;const S=[];for(let T=0;T<m.length-1;T++){const C=m[T],L=m[T+1],k=this.distance(C,L);if(_+=k,_>l&&S.length===0&&S.push(Kv(C,L,(l-(_-k))/k)),_>=h)return S.push(Kv(C,L,(h-(_-k))/k)),S;_>l&&S.push(L)}return S}bufferPoint(l,h){const m=h/this.ky,_=h/this.kx;return[l[0]-_,l[1]-m,l[0]+_,l[1]+m]}bufferBBox(l,h){const m=h/this.ky,_=h/this.kx;return[l[0]-_,l[1]-m,l[2]+_,l[3]+m]}insideBBox(l,h){return Ws(l[0]-h[0])>=0&&Ws(l[0]-h[2])<=0&&l[1]>=h[1]&&l[1]<=h[3]}}function vx(d,l){return d[0]===l[0]&&d[1]===l[1]}function Kv(d,l,h){const m=Ws(l[0]-d[0]);return[d[0]+m*h,d[1]+(l[1]-d[1])*h]}function Ws(d){for(;d<-180;)d+=360;for(;d>180;)d-=360;return d}class Jv{constructor(l=[],h=(m,_)=>m<_?-1:m>_?1:0){if(this.data=l,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:h,compare:m}=this,_=h[l];for(;l>0;){const S=l-1>>1,T=h[S];if(m(_,T)>=0)break;h[l]=T,l=S}h[l]=_}_down(l){const{data:h,compare:m}=this,_=this.length>>1,S=h[l];for(;l<_;){let T=1+(l<<1);const C=T+1;if(C<this.length&&m(h[C],h[T])<0&&(T=C),m(h[T],S)>=0)break;h[l]=h[T],l=T}h[l]=S}}var Ve=8192;function _x(d,l){return l.dist-d.dist}const nf=100,af=50;function xg(d){const l=[1/0,1/0,-1/0,-1/0];if(l.length!==d.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==d[h])return!1;return!0}function bg(d){return d[1]-d[0]+1}function cu(d,l){const h=d[1]>=d[0]&&d[1]<l;return h||console.warn("Distance Expression: Index is out of range"),h}function Qv(d,l){if(d[0]>d[1])return[null,null];const h=bg(d);if(l){if(h===2)return[d,null];const m=Math.floor(h/2);return[[d[0],d[0]+m],[d[0]+m,d[1]]]}{if(h===1)return[d,null];const m=Math.floor(h/2)-1;return[[d[0],d[0]+m],[d[0]+m+1,d[1]]]}}function Sl(d,l){const h=[1/0,1/0,-1/0,-1/0];if(!cu(l,d.length))return h;for(let m=l[0];m<=l[1];++m)vg(h,d[m]);return h}function _r(d){const l=[1/0,1/0,-1/0,-1/0];for(let h=0;h<d.length;++h)for(let m=0;m<d[h].length;++m)vg(l,d[h][m]);return l}function of(d,l,h){if(xg(d)||xg(l))return NaN;let m=0,_=0;return d[2]<l[0]&&(m=l[0]-d[2]),d[0]>l[2]&&(m=d[0]-l[2]),d[1]>l[3]&&(_=d[1]-l[3]),d[3]<l[1]&&(_=l[1]-d[3]),h.distance([0,0],[m,_])}function jE(d){return 360*d-180}function WE(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function t_(d,l){const h=Math.pow(2,l.z),m=(d.y/Ve+l.y)/h;return[jE((d.x/Ve+l.x)/h),WE(m)]}function $E(d,l){const h=[];for(let m=0;m<d.length;++m)h.push(t_(d[m],l));return h}function Vn(d,l,h){const m=h.pointOnLine(l,d).point;return h.distance(d,m)}function lT(d,l,h,m,_){const S=h.slice(m[0],m[1]+1);let T=1/0;for(let C=l[0];C<=l[1];++C)if((T=Math.min(T,Vn(d[C],S,_)))===0)return 0;return T}function yx(d,l,h,m,_){const S=Math.min(_.pointToSegmentDistance(d,h,m),_.pointToSegmentDistance(l,h,m)),T=Math.min(_.pointToSegmentDistance(h,d,l),_.pointToSegmentDistance(m,d,l));return Math.min(S,T)}function ZE(d,l,h,m,_){if(!cu(l,d.length)||!cu(m,h.length))return NaN;let S=1/0;for(let T=l[0];T<l[1];++T)for(let C=m[0];C<m[1];++C){if(Xv(d[T],d[T+1],h[C],h[C+1]))return 0;S=Math.min(S,yx(d[T],d[T+1],h[C],h[C+1],_))}return S}function qE(d,l,h,m,_){if(!cu(l,d.length)||!cu(m,h.length))return NaN;let S=1/0;for(let T=l[0];T<=l[1];++T)for(let C=m[0];C<=m[1];++C)if((S=Math.min(S,_.distance(d[T],h[C])))===0)return S;return S}function XE(d,l,h){if(bl(d,l,!0))return 0;let m=1/0;for(const _ of l){const S=_.length;if(S<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(_[0]!==_[S-1]&&(m=Math.min(m,h.pointToSegmentDistance(d,_[S-1],_[0])))===0||(m=Math.min(m,Vn(d,_,h)))===0)return m}return m}function YE(d,l,h,m){if(!cu(l,d.length))return NaN;for(let S=l[0];S<=l[1];++S)if(bl(d[S],h,!0))return 0;let _=1/0;for(let S=l[0];S<l[1];++S)for(const T of h)for(let C=0,L=T.length,k=L-1;C<L;k=C++){if(Xv(d[S],d[S+1],T[k],T[C]))return 0;_=Math.min(_,yx(d[S],d[S+1],T[k],T[C],m))}return _}function uT(d,l){for(const h of d)for(let m=0;m<=h.length-1;++m)if(bl(h[m],l,!0))return!0;return!1}function KE(d,l,h,m=1/0){const _=_r(d),S=_r(l);if(m!==1/0&&of(_,S,h)>=m)return m;if(Ic(_,S)){if(uT(d,l))return 0}else if(uT(l,d))return 0;let T=m;for(const C of d)for(let L=0,k=C.length,F=k-1;L<k;F=L++)for(const V of l)for(let U=0,$=V.length,Z=$-1;U<$;Z=U++){if(Xv(C[F],C[L],V[Z],V[U]))return 0;T=Math.min(T,yx(C[F],C[L],V[Z],V[U],h))}return T}function e_(d,l,h,m,_,S,T){if(S===null||T===null)return;const C=of(Sl(m,S),Sl(_,T),h);C<l&&d.push({dist:C,range1:S,range2:T})}function JE(d,l,h,m,_=1/0){let S=Math.min(m.distance(d[0],h[0][0]),_);if(S===0)return S;const T=new Jv([{dist:0,range1:[0,d.length-1],range2:[0,0]}],_x),C=l?af:nf,L=_r(h);for(;T.length;){const k=T.pop();if(k.dist>=S)continue;const F=k.range1;if(bg(F)<=C){if(!cu(F,d.length))return NaN;if(l){const V=YE(d,F,h,m);if((S=Math.min(S,V))===0)return S}else for(let V=F[0];V<=F[1];++V){const U=XE(d[V],h,m);if((S=Math.min(S,U))===0)return S}}else{const V=Qv(F,l);if(V[0]!==null){const U=of(Sl(d,V[0]),L,m);U<S&&T.push({dist:U,range1:V[0],range2:[0,0]})}if(V[1]!==null){const U=of(Sl(d,V[1]),L,m);U<S&&T.push({dist:U,range1:V[1],range2:[0,0]})}}}return S}function cT(d,l,h,m,_,S=1/0){let T=Math.min(S,_.distance(d[0],h[0]));if(T===0)return T;const C=new Jv([{dist:0,range1:[0,d.length-1],range2:[0,h.length-1]}],_x),L=l?af:nf,k=m?af:nf;for(;C.length;){const F=C.pop();if(F.dist>=T)continue;const V=F.range1,U=F.range2;if(bg(V)<=L&&bg(U)<=k){if(!cu(V,d.length)||!cu(U,h.length))return NaN;if(l&&m?T=Math.min(T,ZE(d,V,h,U,_)):l||m?l&&!m?T=Math.min(T,lT(h,U,d,V,_)):!l&&m&&(T=Math.min(T,lT(d,V,h,U,_))):T=Math.min(T,qE(d,V,h,U,_)),T===0)return T}else{const $=Qv(V,l),Z=Qv(U,m);e_(C,T,_,d,h,$[0],Z[0]),e_(C,T,_,d,h,$[0],Z[1]),e_(C,T,_,d,h,$[1],Z[0]),e_(C,T,_,d,h,$[1],Z[1])}}return T}function xx(d,l,h,m,_=1/0){let S=_;const T=Sl(d,[0,d.length-1]);for(const C of h)if(!(S!==1/0&&of(T,Sl(C,[0,C.length-1]),m)>=S)&&(S=Math.min(S,cT(d,l,C,!0,m,S)),S===0))return S;return S}function i_(d,l,h,m,_=1/0){let S=_;const T=Sl(d,[0,d.length-1]);for(const C of h){if(S!==1/0&&of(T,_r(C),m)>=S)continue;const L=JE(d,l,C,m,S);if(isNaN(L))return L;if((S=Math.min(S,L))===0)return S}return S}function bx(d){return d==="Point"||d==="MultiPoint"||d==="LineString"||d==="MultiLineString"||d==="Polygon"||d==="MultiPolygon"}class Bh{constructor(l,h){this.type=yi,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'distance' expression requires either one argument, but found ' ${l.length-1} instead.`);if(Jd(l[1])){const m=l[1];if(m.type==="FeatureCollection"){for(let _=0;_<m.features.length;++_)if(bx(m.features[_].geometry.type))return new Bh(m,m.features[_].geometry)}else if(m.type==="Feature"){if(bx(m.geometry.type))return new Bh(m,m.geometry)}else if(bx(m.type))return new Bh(m,m)}return h.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(l){const h=l.geometry(),m=l.canonicalID();if(h!=null&&m!=null){if(l.geometryType()==="Point")return function(_,S,T){const C=[];for(const k of _)for(const F of k)C.push(t_(F,S));const L=new rf(C[0][1],"meters");return T.type==="Point"||T.type==="MultiPoint"||T.type==="LineString"?cT(C,!1,T.type==="Point"?[T.coordinates]:T.coordinates,T.type==="LineString",L):T.type==="MultiLineString"?xx(C,!1,T.coordinates,L):T.type==="Polygon"||T.type==="MultiPolygon"?i_(C,!1,T.type==="Polygon"?[T.coordinates]:T.coordinates,L):null}(h,m,this.geometries);if(l.geometryType()==="LineString")return function(_,S,T){const C=[];for(const k of _){const F=[];for(const V of k)F.push(t_(V,S));C.push(F)}const L=new rf(C[0][0][1],"meters");if(T.type==="Point"||T.type==="MultiPoint"||T.type==="LineString")return xx(T.type==="Point"?[T.coordinates]:T.coordinates,T.type==="LineString",C,L);if(T.type==="MultiLineString"){let k=1/0;for(let F=0;F<T.coordinates.length;F++){const V=xx(T.coordinates[F],!0,C,L,k);if(isNaN(V))return V;if((k=Math.min(k,V))===0)return k}return k}if(T.type==="Polygon"||T.type==="MultiPolygon"){let k=1/0;for(let F=0;F<C.length;F++){const V=i_(C[F],!0,T.type==="Polygon"?[T.coordinates]:T.coordinates,L,k);if(isNaN(V))return V;if((k=Math.min(k,V))===0)return k}return k}return null}(h,m,this.geometries);if(l.geometryType()==="Polygon")return function(_,S,T){const C=[];for(const k of function(F,V){const U=F.length;if(U<=1)return[F];const $=[];let Z,Q;for(let et=0;et<U;et++){const nt=VE(F[et]);nt!==0&&(F[et].area=Math.abs(nt),Q===void 0&&(Q=nt<0),Q===nt<0?(Z&&$.push(Z),Z=[F[et]]):Z.push(F[et]))}return Z&&$.push(Z),$}(_)){const F=[];for(let V=0;V<k.length;++V)F.push($E(k[V],S));C.push(F)}const L=new rf(C[0][0][0][1],"meters");if(T.type==="Point"||T.type==="MultiPoint"||T.type==="LineString")return i_(T.type==="Point"?[T.coordinates]:T.coordinates,T.type==="LineString",C,L);if(T.type==="MultiLineString"){let k=1/0;for(let F=0;F<T.coordinates.length;F++){const V=i_(T.coordinates[F],!0,C,L,k);if(isNaN(V))return V;if((k=Math.min(k,V))===0)return k}return k}return T.type==="Polygon"||T.type==="MultiPolygon"?function(k,F,V){let U=1/0;for(const $ of k)for(const Z of F){const Q=KE($,Z,V,U);if(isNaN(Q))return Q;if((U=Math.min(U,Q))===0)return U}return U}(T.type==="Polygon"?[T.coordinates]:T.coordinates,C,L):null}(h,m,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function sf(d){if(d instanceof Go&&(d.name==="get"&&d.args.length===1||d.name==="feature-state"||d.name==="has"&&d.args.length===1||d.name==="properties"||d.name==="geometry-type"||d.name==="id"||/^filter-/.test(d.name))||d instanceof zh||d instanceof Bh)return!1;if(d instanceof uf)return d.featureConstant;let l=!0;return d.eachChild(h=>{l&&!sf(h)&&(l=!1)}),l}function wg(d){if(d instanceof Go&&d.name==="feature-state")return!1;let l=!0;return d.eachChild(h=>{l&&!wg(h)&&(l=!1)}),l}function lf(d,l){if(d instanceof Go&&l.indexOf(d.name)>=0)return!1;let h=!0;return d.eachChild(m=>{h&&!lf(m,l)&&(h=!1)}),h}function hT(d,l,h){return[d,l,h].filter(Boolean).join("")}function Sx(d,l){switch(d){case"string":return lu(l);case"number":return+l;case"boolean":return!!l;case"color":return Xr.parse(l);case"formatted":return Za.fromString(lu(l));case"resolvedImage":return cs.build(lu(l))}return l}function dT(d,l,h,m){return m!==void 0&&(d=m*Math.round(d/m)),l!==void 0&&d<l&&(d=l),h!==void 0&&d>h&&(d=h),d}class uf{constructor(l,h,m,_=!1){this.type=l,this.key=h,this.scope=m,this.featureConstant=_}static parse(l,h){let m=h.expectedType;if(m==null&&(m=Jr),l.length<2||l.length>3)return h.error("Invalid number of arguments for 'config' expression.");const _=h.parse(l[1],1);if(!(_ instanceof Hu))return h.error("Key name of 'config' expression must be a string literal.");let S,T=!0;const C=lu(_.value);if(l.length>=3){const L=h.parse(l[2],2);if(!(L instanceof Hu))return h.error("Scope of 'config' expression must be a string literal.");S=lu(L.value)}if(h.options){const L=hT(C,S,h._scope),k=h.options.get(L);k&&(T=sf(k.value||k.default))}return new uf(m,C,S,T)}evaluate(l){const h=hT(this.key,this.scope,l.scope),m=l.getConfig(h);if(!m)return null;const{type:_,value:S,values:T,minValue:C,maxValue:L,stepValue:k}=m,F=m.default.evaluate(l);let V=F;if(S){const U=l.scope;l.scope=(U||"").split("").slice(1).join(""),V=S.evaluate(l),l.scope=U}return _&&(V=Sx(_,V)),V===void 0||C===void 0&&L===void 0&&k===void 0||(typeof V=="number"?V=dT(V,C,L,k):Array.isArray(V)&&(V=V.map(U=>typeof U=="number"?dT(U,C,L,k):U))),S!==void 0&&V!==void 0&&T&&!T.includes(V)&&(V=F,_&&(V=Sx(_,V))),(_&&_!==this.type||V!==void 0&&!jv(Ha(V),this.type))&&(V=Sx(this.type.kind,V)),V}eachChild(){}outputDefined(){return!1}serialize(){const l=["config",this.key];return this.scope&&l.concat(this.scope),l}}class r_{constructor(l,h){this.type=h.type,this.name=l,this.boundExpression=h}static parse(l,h){if(l.length!==2||typeof l[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=l[1];return h.scope.has(m)?new r_(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class n_{constructor(l,h=[],m,_=new xl,S=[],T,C,L){this.registry=l,this.path=h,this.key=h.map(k=>typeof k=="string"?`['${k}']`:`[${k}]`).join(""),this.scope=_,this.errors=S,this.expectedType=m,this._scope=T,this.options=C,this.iconImageUseTheme=L}parse(l,h,m,_,S={}){return h||m?this.concat(h,null,m,_)._parse(l,S):this._parse(l,S)}parseObjectValue(l,h,m,_,S,T={}){return this.concat(h,m,_,S)._parse(l,T)}_parse(l,h){function m(_,S,T){return T==="assert"?new fi(S,[_]):T==="coerce"?new uu(S,[_]):_}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=typeof l[0]=="string"?this.registry[l[0]]:void 0;if(_){let S=_.parse(l,this);if(!S)return null;if(this.expectedType){const T=this.expectedType,C=S.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||C.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(T,C))return null}else S=m(S,T,h.typeAnnotation||"coerce");else S=m(S,T,h.typeAnnotation||"assert")}if(!(S instanceof Hu)&&S.type.kind!=="resolvedImage"&&Tx(S)){const T=new io(this._scope,this.options,this.iconImageUseTheme);try{S=new Hu(S.type,S.evaluate(T))}catch(C){return this.error(C.message),null}}return S}return uu.parse(["to-array",l],this)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,h,m,_){let S=typeof l=="number"?this.path.concat(l):this.path;S=typeof h=="string"?S.concat(h):S;const T=_?this.scope.concat(_):this.scope;return new n_(this.registry,S,m||null,T,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(l,...h){const m=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new yl(m,l))}checkSubtype(l,h){const m=fg(l,h);return m&&this.error(m),m}}function Tx(d){if(d instanceof r_)return Tx(d.boundExpression);if(d instanceof Go&&d.name==="error"||d instanceof tf||d instanceof zh||d instanceof Bh||d instanceof uf)return!1;const l=d instanceof uu||d instanceof fi;let h=!0;return d.eachChild(m=>{h=l?h&&Tx(m):h&&m instanceof Hu}),!!h&&sf(d)&&lf(d,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function a_(d,l){const h=d.length-1;let m,_,S=0,T=h,C=0;for(;S<=T;)if(C=Math.floor((S+T)/2),m=d[C],_=d[C+1],m<=l){if(C===h||l<_)return C;S=C+1}else{if(!(m>l))throw new sa("Input is not a number.");T=C-1}return 0}class Sg{constructor(l,h,m){this.type=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,S]of m)this.labels.push(_),this.outputs.push(S)}static parse(l,h){if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(l[1],1,yi);if(!m)return null;const _=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let T=1;T<l.length;T+=2){const C=T===1?-1/0:l[T],L=l[T+1],k=T,F=T+1;if(typeof C!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(_.length&&_[_.length-1][0]>=C)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const V=h.parse(L,F,S);if(!V)return null;S=S||V.type,_.push([C,V])}return new Sg(S,m,_)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const _=this.input.evaluate(l);if(_<=h[0])return m[0].evaluate(l);const S=h.length;return _>=h[S-1]?m[S-1].evaluate(l):m[a_(h,_)].evaluate(l)}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){const l=["step",this.input.serialize()];for(let h=0;h<this.labels.length;h++)h>0&&l.push(this.labels[h]),l.push(this.outputs[h].serialize());return l}}const fT=.95047,pT=1.08883,gT=4/29,cf=6/29,o_=3*cf*cf,QE=cf*cf*cf,mT=Math.PI/180,tD=180/Math.PI;function Ax(d){return d>QE?Math.pow(d,1/3):d/o_+gT}function Ix(d){return d>cf?d*d*d:o_*(d-gT)}function s_(d){return 255*(d<=.0031308?12.92*d:1.055*Math.pow(d,1/2.4)-.055)}function l_(d){return(d/=255)<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4)}function Fh(d){const l=l_(d.r),h=l_(d.g),m=l_(d.b),_=Ax((.4124564*l+.3575761*h+.1804375*m)/fT),S=Ax((.2126729*l+.7151522*h+.072175*m)/1);return{l:116*S-16,a:500*(_-S),b:200*(S-Ax((.0193339*l+.119192*h+.9503041*m)/pT)),alpha:d.a}}function Cx(d){let l=(d.l+16)/116,h=isNaN(d.a)?l:l+d.a/500,m=isNaN(d.b)?l:l-d.b/200;return l=1*Ix(l),h=fT*Ix(h),m=pT*Ix(m),new Xr(s_(3.2404542*h-1.5371385*l-.4985314*m),s_(-.969266*h+1.8760108*l+.041556*m),s_(.0556434*h-.2040259*l+1.0572252*m),d.alpha)}function vT(d,l,h){const m=l-d;return d+h*(m>180||m<-180?m-360*Math.round(m/360):m)}const Tg={forward:Fh,reverse:Cx,interpolate:function(d,l,h){return{l:zi(d.l,l.l,h),a:zi(d.a,l.a,h),b:zi(d.b,l.b,h),alpha:zi(d.alpha,l.alpha,h)}}},Nh={forward:function(d){const{l,a:h,b:m}=Fh(d),_=Math.atan2(m,h)*tD;return{h:_<0?_+360:_,c:Math.sqrt(h*h+m*m),l,alpha:d.a}},reverse:function(d){const l=d.h*mT,h=d.c;return Cx({l:d.l,a:Math.cos(l)*h,b:Math.sin(l)*h,alpha:d.alpha})},interpolate:function(d,l,h){return{h:vT(d.h,l.h,h),c:zi(d.c,l.c,h),l:zi(d.l,l.l,h),alpha:zi(d.alpha,l.alpha,h)}}};var u_=Object.freeze({__proto__:null,hcl:Nh,lab:Tg});class $s{constructor(l,h,m,_,S){this.type=l,this.operator=h,this.interpolation=m,this.input=_,this.labels=[],this.outputs=[];for(const[T,C]of S)this.labels.push(T),this.outputs.push(C)}static interpolationFactor(l,h,m,_){let S=0;if(l.name==="exponential")S=Mx(h,l.base,m,_);else if(l.name==="linear")S=Mx(h,1,m,_);else if(l.name==="cubic-bezier"){const T=l.controlPoints;S=new Zd(T[0],T[1],T[2],T[3]).solve(Mx(h,1,m,_))}return S}static parse(l,h){let[m,_,S,...T]=l;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const k=_[1];if(typeof k!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:k}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const k=_.slice(1);if(k.length!==4||k.some(F=>typeof F!="number"||F<0||F>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:k}}}if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length-1>3&&(l.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,yi),!S)return null;const C=[];let L=null;m==="interpolate-hcl"||m==="interpolate-lab"?L=Ss:h.expectedType&&h.expectedType.kind!=="value"&&(L=h.expectedType);for(let k=0;k<T.length;k+=2){const F=T[k],V=T[k+1],U=k+3,$=k+4;if(typeof F!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(C.length&&C[C.length-1][0]>=F)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const Z=h.parse(V,$,L);if(!Z)return null;L=L||Z.type,C.push([F,Z])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new $s(L,m,_,S,C):h.error(`Type ${Da(L)} is not interpolatable.`)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const _=this.input.evaluate(l);if(_<=h[0])return m[0].evaluate(l);const S=h.length;if(_>=h[S-1])return m[S-1].evaluate(l);const T=a_(h,_),C=$s.interpolationFactor(this.interpolation,_,h[T],h[T+1]),L=m[T].evaluate(l),k=m[T+1].evaluate(l);return this.operator==="interpolate"?Uu[this.type.kind.toLowerCase()](L,k,C):this.operator==="interpolate-hcl"?Nh.reverse(Nh.interpolate(Nh.forward(L),Nh.forward(k),C)):Tg.reverse(Tg.interpolate(Tg.forward(L),Tg.forward(k),C))}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}serialize(){let l;l=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const h=[this.operator,l,this.input.serialize()];for(let m=0;m<this.labels.length;m++)h.push(this.labels[m],this.outputs[m].serialize());return h}}function Mx(d,l,h,m){const _=m-h,S=d-h;return _===0?0:l===1?S/_:(Math.pow(l,S)-1)/(Math.pow(l,_)-1)}class Ag{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expectected at least one argument.");let m=null;const _=h.expectedType;_&&_.kind!=="value"&&(m=_);const S=[];for(const C of l.slice(1)){const L=h.parse(C,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!L)return null;m=m||L.type,S.push(L)}const T=_&&S.some(C=>fg(_,C.type));return new Ag(T?Jr:m,S)}evaluate(l){let h,m=null,_=0;for(const S of this.args){if(_++,m=S.evaluate(l),m&&m instanceof cs&&!m.available&&(h||(h=m),m=null,_===this.args.length))return h;if(m!==null)break}return m}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}serialize(){const l=["coalesce"];return this.eachChild(h=>{l.push(h.serialize())}),l}}class Ig{constructor(l,h){this.type=h.type,this.bindings=[].concat(l),this.result=h}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const h of this.bindings)l(h[1]);l(this.result)}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const m=[];for(let S=1;S<l.length-1;S+=2){const T=l[S];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const C=h.parse(l[S+1],S+1);if(!C)return null;m.push([T,C])}const _=h.parse(l[l.length-1],l.length-1,h.expectedType,m);return _?new Ig(m,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const l=["let"];for(const[h,m]of this.bindings)l.push(h,m.serialize());return l.push(this.result.serialize()),l}}class Ex{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,yi),_=h.parse(l[2],2,eo(h.expectedType||Jr));return m&&_?new Ex(_.type.itemType,m,_):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new sa("Array index out of bounds: negative index");if(h>=m.length)throw new sa("Array index out of bounds: index exceeds array size");if(h!==Math.floor(h))throw new sa("Array index must be an integer. Use at-interpolated for fractional indices");return m[h]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Dx{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,yi),_=h.parse(l[2],2,eo(h.expectedType||Jr));return m&&_?new Dx(_.type.itemType,m,_):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new sa(`Array index out of bounds: ${h} < 0.`);if(h>m.length-1)throw new sa(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h===Math.floor(h))return m[h];const _=Math.floor(h),S=Math.ceil(h),T=m[_],C=m[S];if(typeof T!="number"||typeof C!="number")throw new sa(`Cannot interpolate between non-number values at index ${h}.`);const L=h-_;return T*(1-L)+C*L}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Px{constructor(l,h){this.type=$r,this.needle=l,this.haystack=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Jr),_=h.parse(l[2],2,Jr);return m&&_?cx(m.type,[$r,kr,yi,Yd,Jr])?new Px(m,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Da(m.type)} instead`):null}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(m==null)return!1;if(!pg(h,["boolean","string","number","null"]))throw new sa(`Expected first argument to be of type boolean, string, number or null, but found ${Da(Ha(h))} instead.`);if(!pg(m,["string","array"]))throw new sa(`Expected second argument to be of type array or string, but found ${Da(Ha(m))} instead.`);return m.indexOf(h)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Cg{constructor(l,h,m){this.type=yi,this.needle=l,this.haystack=h,this.fromIndex=m}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Jr),_=h.parse(l[2],2,Jr);if(!m||!_)return null;if(!cx(m.type,[$r,kr,yi,Yd,Jr]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Da(m.type)} instead`);if(l.length===4){const S=h.parse(l[3],3,yi);return S?new Cg(m,_,S):null}return new Cg(m,_)}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!pg(h,["boolean","string","number","null"]))throw new sa(`Expected first argument to be of type boolean, string, number or null, but found ${Da(Ha(h))} instead.`);if(!pg(m,["string","array"]))throw new sa(`Expected second argument to be of type array or string, but found ${Da(Ha(m))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(l);return m.indexOf(h,_)}return m.indexOf(h)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const l=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),l]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class c_{constructor(l,h,m,_,S,T){this.inputType=l,this.type=h,this.input=m,this.cases=_,this.outputs=S,this.otherwise=T}static parse(l,h){if(l.length<5)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return h.error("Expected an even number of arguments.");let m,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const S={},T=[];for(let k=2;k<l.length-1;k+=2){let F=l[k];const V=l[k+1];Array.isArray(F)||(F=[F]);const U=h.concat(k);if(F.length===0)return U.error("Expected at least one branch label.");for(const Z of F){if(typeof Z!="number"&&typeof Z!="string")return U.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return U.error("Numeric branch labels must be integer values.");if(m){if(U.checkSubtype(m,Ha(Z)))return null}else m=Ha(Z);if(S[String(Z)]!==void 0)return U.error("Branch labels must be unique.");S[String(Z)]=T.length}const $=h.parse(V,k,_);if(!$)return null;_=_||$.type,T.push($)}const C=h.parse(l[1],1,Jr);if(!C)return null;const L=h.parse(l[l.length-1],l.length-1,_);return L?C.type.kind!=="value"&&h.concat(1).checkSubtype(m,C.type)?null:new c_(m,_,C,S,T,L):null}evaluate(l){const h=this.input.evaluate(l);return(jv(Ha(h),this.inputType)&&this.outputs[this.cases[h]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["match",this.input.serialize()],h=Object.keys(this.cases).sort(),m=[],_={};for(const T of h){const C=_[this.cases[T]];C===void 0?(_[this.cases[T]]=m.length,m.push([this.cases[T],[T]])):m[C][1].push(T)}const S=T=>this.inputType.kind==="number"?Number(T):T;for(const[T,C]of m)l.push(C.length===1?S(C[0]):C.map(S)),l.push(this.outputs[T].serialize());return l.push(this.otherwise.serialize()),l}}class hf{constructor(l,h,m){this.type=l,this.branches=h,this.otherwise=m}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const _=[];for(let T=1;T<l.length-1;T+=2){const C=h.parse(l[T],T,$r);if(!C)return null;const L=h.parse(l[T+1],T+1,m);if(!L)return null;_.push([C,L]),m=m||L.type}const S=h.parse(l[l.length-1],l.length-1,m);return S?new hf(m,_,S):null}evaluate(l){for(const[h,m]of this.branches)if(h.evaluate(l))return m.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[h,m]of this.branches)l(h),l(m);l(this.otherwise)}outputDefined(){return this.branches.every(([l,h])=>h.outputDefined())&&this.otherwise.outputDefined()}serialize(){const l=["case"];return this.eachChild(h=>{l.push(h.serialize())}),l}}class h_{constructor(l,h,m,_){this.type=l,this.input=h,this.beginIndex=m,this.endIndex=_}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Jr),_=h.parse(l[2],2,yi);if(!m||!_)return null;if(!cx(m.type,[eo(Jr),kr,Jr]))return h.error(`Expected first argument to be of type array or string, but found ${Da(m.type)} instead`);if(l.length===4){const S=h.parse(l[3],3,yi);return S?new h_(m.type,m,_,S):null}return new h_(m.type,m,_)}evaluate(l){const h=this.input.evaluate(l),m=this.beginIndex.evaluate(l);if(!pg(h,["string","array"]))throw new sa(`Expected first argument to be of type array or string, but found ${Da(Ha(h))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(l);return h.slice(m,_)}return h.slice(m)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const l=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),l]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class d_{constructor(l,h){this.type=eo(kr),this.str=l,this.delimiter=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,kr),_=h.parse(l[2],2,kr);return m&&_?new d_(m,_):void 0}evaluate(l){const h=this.str.evaluate(l),m=this.delimiter.evaluate(l);return h.split(m)}eachChild(l){l(this.str),l(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function _T(d,l){return d==="=="||d==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function yT(d,l,h,m){return m.compare(l,h)===0}function df(d,l,h){const m=d!=="=="&&d!=="!=";return class pX{constructor(S,T,C){this.type=$r,this.lhs=S,this.rhs=T,this.collator=C,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const C=S[0];let L=T.parse(S[1],1,Jr);if(!L)return null;if(!_T(C,L.type))return T.concat(1).error(`"${C}" comparisons are not supported for type '${Da(L.type)}'.`);let k=T.parse(S[2],2,Jr);if(!k)return null;if(!_T(C,k.type))return T.concat(2).error(`"${C}" comparisons are not supported for type '${Da(k.type)}'.`);if(L.type.kind!==k.type.kind&&L.type.kind!=="value"&&k.type.kind!=="value")return T.error(`Cannot compare types '${Da(L.type)}' and '${Da(k.type)}'.`);m&&(L.type.kind==="value"&&k.type.kind!=="value"?L=new fi(k.type,[L]):L.type.kind!=="value"&&k.type.kind==="value"&&(k=new fi(L.type,[k])));let F=null;if(S.length===4){if(L.type.kind!=="string"&&k.type.kind!=="string"&&L.type.kind!=="value"&&k.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(F=T.parse(S[3],3,hg),!F)return null}return new pX(L,k,F)}evaluate(S){const T=this.lhs.evaluate(S),C=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const L=Ha(T),k=Ha(C);if(L.kind!==k.kind||L.kind!=="string"&&L.kind!=="number")throw new sa(`Expected arguments for "${d}" to be (string, string) or (number, number), but found (${L.kind}, ${k.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const L=Ha(T),k=Ha(C);if(L.kind!=="string"||k.kind!=="string")return l(S,T,C)}return this.collator?h(S,T,C,this.collator.evaluate(S)):l(S,T,C)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}serialize(){const S=[d];return this.eachChild(T=>{S.push(T.serialize())}),S}}}const xT=df("==",function(d,l,h){return l===h},yT),bT=df("!=",function(d,l,h){return l!==h},function(d,l,h,m){return!yT(0,l,h,m)}),eD=df("<",function(d,l,h){return l<h},function(d,l,h,m){return m.compare(l,h)<0}),iD=df(">",function(d,l,h){return l>h},function(d,l,h,m){return m.compare(l,h)>0}),rD=df("<=",function(d,l,h){return l<=h},function(d,l,h,m){return m.compare(l,h)<=0}),f_=df(">=",function(d,l,h){return l>=h},function(d,l,h,m){return m.compare(l,h)>=0});class Lx{constructor(l,h,m,_,S,T){this.type=kr,this.number=l,this.locale=h,this.currency=m,this.unit=_,this.minFractionDigits=S,this.maxFractionDigits=T}static parse(l,h){if(l.length!==3)return h.error("Expected two arguments.");const m=h.parse(l[1],1,yi);if(!m)return null;const _=l[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let S=null;if(_.locale&&(S=h.parseObjectValue(_.locale,2,"locale",kr),!S))return null;let T=null;if(_.currency&&(T=h.parseObjectValue(_.currency,2,"currency",kr),!T))return null;let C=null;if(_.unit&&(C=h.parseObjectValue(_.unit,2,"unit",kr),!C))return null;let L=null;if(_["min-fraction-digits"]&&(L=h.parseObjectValue(_["min-fraction-digits"],2,"min-fraction-digits",yi),!L))return null;let k=null;return _["max-fraction-digits"]&&(k=h.parseObjectValue(_["max-fraction-digits"],2,"max-fraction-digits",yi),!k)?null:new Lx(m,S,T,C,L,k)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(l):void 0,unit:this.unit?this.unit.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.unit&&l(this.unit),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const l={};return this.locale&&(l.locale=this.locale.serialize()),this.currency&&(l.currency=this.currency.serialize()),this.unit&&(l.unit=this.unit.serialize()),this.minFractionDigits&&(l["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(l["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),l]}}class Rx{constructor(l){this.type=yi,this.input=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=h.parse(l[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Da(m.type)} instead.`):new Rx(m):null}evaluate(l){const h=this.input.evaluate(l);if(typeof h=="string"||Array.isArray(h))return h.length;throw new sa(`Expected value to be of type string or array, but found ${Da(Ha(h))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}serialize(){const l=["length"];return this.eachChild(h=>{l.push(h.serialize())}),l}}function wT(d){return function(){d=1831565813+(d|=0)|0;let l=Math.imul(d^d>>>15,1|d);return l=l+Math.imul(l^l>>>7,61|l)^l,((l^l>>>14)>>>0)/4294967296}}const ff={"==":xT,"!=":bT,">":iD,"<":eD,">=":f_,"<=":rD,array:fi,at:Ex,"at-interpolated":Dx,boolean:fi,case:hf,coalesce:Ag,collator:tf,format:kh,image:$i,in:Px,"index-of":Cg,interpolate:$s,"interpolate-hcl":$s,"interpolate-lab":$s,length:Rx,let:Ig,literal:Hu,match:c_,number:fi,"number-format":Lx,object:fi,slice:h_,step:Sg,string:fi,"to-boolean":uu,"to-color":uu,"to-number":uu,"to-string":uu,var:r_,within:zh,distance:Bh,config:uf,split:d_};function kx(d,[l,h,m,_]){l=l.evaluate(d),h=h.evaluate(d),m=m.evaluate(d);const S=_?_.evaluate(d):1,T=Wv(l,h,m,S);if(T)throw new sa(T);return new Xr(l/255,h/255,m/255,S)}function ST(d,[l,h,m,_]){l=l.evaluate(d),h=h.evaluate(d),m=m.evaluate(d);const S=_?_.evaluate(d):1,T=function(k,F,V,U){return typeof k=="number"&&k>=0&&k<=360?typeof F=="number"&&F>=0&&F<=100&&typeof V=="number"&&V>=0&&V<=100?U===void 0||typeof U=="number"&&U>=0&&U<=1?null:`Invalid hsla value [${[k,F,V,U].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof U=="number"?[k,F,V,U]:[k,F,V]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof U=="number"?[k,F,V,U]:[k,F,V]).join(", ")}]: 'h' must be between 0 and 360.`}(l,h,m,S);if(T)throw new sa(T);const C=`hsla(${l}, ${h}%, ${m}%, ${S})`,L=Xr.parse(C);if(!L)throw new sa(`Failed to parse HSLA color: ${C}`);return L}function TT(d,l){return d in l}function p_(d,l){const h=l[d];return h===void 0?null:h}function Wu(d){return{type:d}}function Mg(d){if(d instanceof uf)return new Set([d.key]);let l=new Set;return d.eachChild(h=>{l=new Set([...l,...Mg(h)])}),l}function g_(d){if(d instanceof Go&&d.name==="is-active-floor")return!0;let l=!1;return d.eachChild(h=>{!l&&g_(h)&&(l=!0)}),l}function Vh(d){return{result:"success",value:d}}function Ec(d){return{result:"error",value:d}}function Ox(d,l){return!!d&&!!d.parameters&&d.parameters.indexOf(l)>-1}function m_(d){return d["property-type"]==="data-driven"}function zx(d){return Ox(d.expression,"measure-light")}function Bx(d){return Ox(d.expression,"zoom")}function v_(d){return!!d.expression&&d.expression.interpolated}function __(d){return typeof d=="object"&&d!==null&&!Array.isArray(d)}function Fx(d){return d}function y_(d,l){const h=l.type==="color",m=d.stops&&typeof d.stops[0][0]=="object",_=m||!(m||d.property!==void 0),S=d.type||(v_(l)?"exponential":"interval");if(h&&((d=Object.assign({},d)).stops&&(d.stops=d.stops.map(k=>[k[0],Xr.parse(k[1])])),d.default=Xr.parse(d.default?d.default:l.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!u_[d.colorSpace])throw new Error(`Unknown color space: ${d.colorSpace}`);let T,C,L;if(S==="exponential")T=AT;else if(S==="interval")T=Dc;else if(S==="categorical"){T=nD,C=Object.create(null);for(const k of d.stops)C[k[0]]=k[1];L=typeof d.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);T=aD}if(m){const k={},F=[];for(let $=0;$<d.stops.length;$++){const Z=d.stops[$],Q=Z[0].zoom;k[Q]===void 0&&(k[Q]={zoom:Q,type:d.type,property:d.property,default:d.default,stops:[]},F.push(Q)),k[Q].stops.push([Z[0].value,Z[1]])}const V=[];for(const $ of F)V.push([k[$].zoom,y_(k[$],l)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:$s.interpolationFactor.bind(void 0,U),zoomStops:V.map($=>$[0]),evaluate:({zoom:$},Z)=>AT({stops:V,base:d.base},l,$).evaluate($,Z)}}if(_){const k=S==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:$s.interpolationFactor.bind(void 0,k),zoomStops:d.stops.map(F=>F[0]),evaluate:({zoom:F})=>T(d,l,F,C,L)}}return{kind:"source",evaluate(k,F){const V=F&&F.properties?F.properties[d.property]:void 0;return V===void 0?pf(d.default,l.default):T(d,l,V,C,L)}}}function pf(d,l,h){return d!==void 0?d:l!==void 0?l:h!==void 0?h:void 0}function nD(d,l,h,m,_){return pf(typeof h===_?m[h]:void 0,d.default,l.default)}function Dc(d,l,h){if(!mg(h))return pf(d.default,l.default);const m=d.stops.length;if(m===1||h<=d.stops[0][0])return d.stops[0][1];if(h>=d.stops[m-1][0])return d.stops[m-1][1];const _=a_(d.stops.map(S=>S[0]),h);return d.stops[_][1]}function AT(d,l,h){const m=d.base!==void 0?d.base:1;if(!mg(h))return pf(d.default,l.default);const _=d.stops.length;if(_===1||h<=d.stops[0][0])return d.stops[0][1];if(h>=d.stops[_-1][0])return d.stops[_-1][1];const S=a_(d.stops.map(F=>F[0]),h),T=function(F,V,U,$){const Z=$-U,Q=F-U;return Z===0?0:V===1?Q/Z:(Math.pow(V,Q)-1)/(Math.pow(V,Z)-1)}(h,m,d.stops[S][0],d.stops[S+1][0]),C=d.stops[S][1],L=d.stops[S+1][1];let k=Uu[l.type]||Fx;if(d.colorSpace&&d.colorSpace!=="rgb"){const F=u_[d.colorSpace];k=(V,U)=>F.reverse(F.interpolate(F.forward(V),F.forward(U),T))}return typeof C.evaluate=="function"?{evaluate(...F){const V=C.evaluate.apply(void 0,F),U=L.evaluate.apply(void 0,F);if(V!==void 0&&U!==void 0)return k(V,U,T)}}:k(C,L,T)}function aD(d,l,h){return l.type==="color"?h=Xr.parse(h):l.type==="formatted"?h=Za.fromString(h.toString()):l.type==="resolvedImage"?h=cs.build(h.toString()):Qd(h)===l.type||l.type==="enum"&&l.values[h]||(h=void 0),pf(h,d.default,l.default)}Go.register(ff,{error:[{kind:"error"},[kr],(d,[l])=>{throw new sa(l.evaluate(d))}],typeof:[kr,[Jr],(d,[l])=>Da(Ha(l.evaluate(d)))],"to-rgba":[eo(yi,4),[Ss],(d,[l])=>l.evaluate(d).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[eo(yi,4),[Ss],(d,[l])=>l.evaluate(d).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ss,[yi,yi,yi],kx],rgba:[Ss,[yi,yi,yi,yi],kx],hsl:[Ss,[yi,yi,yi],ST],hsla:[Ss,[yi,yi,yi,yi],ST],has:{type:$r,overloads:[[[kr],(d,[l])=>TT(l.evaluate(d),d.properties())],[[kr,Kd],(d,[l,h])=>TT(l.evaluate(d),h.evaluate(d))]]},get:{type:Jr,overloads:[[[kr],(d,[l])=>p_(l.evaluate(d),d.properties())],[[kr,Kd],(d,[l,h])=>p_(l.evaluate(d),h.evaluate(d))]]},"feature-state":[Jr,[kr],(d,[l])=>p_(l.evaluate(d),d.featureState||{})],properties:[Kd,[],d=>d.properties()],"geometry-type":[kr,[],d=>d.geometryType()],worldview:[kr,[],d=>d.globals.worldview||""],"is-active-floor":[$r,Wu(kr),(d,l)=>{if(!(d.globals.activeFloors&&d.globals.activeFloors.size>0))return!1;const h=d.globals.activeFloors;return l.some(m=>{const _=m.evaluate(d);return h.has(_)})}],id:[Jr,[],d=>d.id()],zoom:[yi,[],d=>d.globals.zoom],pitch:[yi,[],d=>d.globals.pitch||0],"distance-from-center":[yi,[],d=>d.distanceFromCenter()],"measure-light":[yi,[kr],(d,[l])=>d.measureLight(l.evaluate(d))],"heatmap-density":[yi,[],d=>d.globals.heatmapDensity||0],"line-progress":[yi,[],d=>d.globals.lineProgress||0],"raster-value":[yi,[],d=>d.globals.rasterValue||0],"raster-particle-speed":[yi,[],d=>d.globals.rasterParticleSpeed||0],"sky-radial-progress":[yi,[],d=>d.globals.skyRadialProgress||0],accumulated:[Jr,[],d=>d.globals.accumulated===void 0?null:d.globals.accumulated],"+":[yi,Wu(yi),(d,l)=>{let h=0;for(const m of l)h+=m.evaluate(d);return h}],"*":[yi,Wu(yi),(d,l)=>{let h=1;for(const m of l)h*=m.evaluate(d);return h}],"-":{type:yi,overloads:[[[yi,yi],(d,[l,h])=>l.evaluate(d)-h.evaluate(d)],[[yi],(d,[l])=>-l.evaluate(d)]]},"/":[yi,[yi,yi],(d,[l,h])=>l.evaluate(d)/h.evaluate(d)],"%":[yi,[yi,yi],(d,[l,h])=>l.evaluate(d)%h.evaluate(d)],ln2:[yi,[],()=>Math.LN2],pi:[yi,[],()=>Math.PI],e:[yi,[],()=>Math.E],"^":[yi,[yi,yi],(d,[l,h])=>Math.pow(l.evaluate(d),h.evaluate(d))],sqrt:[yi,[yi],(d,[l])=>Math.sqrt(l.evaluate(d))],log10:[yi,[yi],(d,[l])=>Math.log(l.evaluate(d))/Math.LN10],ln:[yi,[yi],(d,[l])=>Math.log(l.evaluate(d))],log2:[yi,[yi],(d,[l])=>Math.log2(l.evaluate(d))],sin:[yi,[yi],(d,[l])=>Math.sin(l.evaluate(d))],cos:[yi,[yi],(d,[l])=>Math.cos(l.evaluate(d))],tan:[yi,[yi],(d,[l])=>Math.tan(l.evaluate(d))],asin:[yi,[yi],(d,[l])=>Math.asin(l.evaluate(d))],acos:[yi,[yi],(d,[l])=>Math.acos(l.evaluate(d))],atan:[yi,[yi],(d,[l])=>Math.atan(l.evaluate(d))],min:[yi,Wu(yi),(d,l)=>Math.min(...l.map(h=>h.evaluate(d)))],max:[yi,Wu(yi),(d,l)=>Math.max(...l.map(h=>h.evaluate(d)))],abs:[yi,[yi],(d,[l])=>Math.abs(l.evaluate(d))],round:[yi,[yi],(d,[l])=>{const h=l.evaluate(d);return h<0?-Math.round(-h):Math.round(h)}],floor:[yi,[yi],(d,[l])=>Math.floor(l.evaluate(d))],ceil:[yi,[yi],(d,[l])=>Math.ceil(l.evaluate(d))],"filter-==":[$r,[kr,Jr],(d,[l,h])=>d.properties()[l.value]===h.value],"filter-id-==":[$r,[Jr],(d,[l])=>d.id()===l.value],"filter-type-==":[$r,[kr],(d,[l])=>d.geometryType()===l.value],"filter-<":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m<_}],"filter-id-<":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h<m}],"filter->":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m>_}],"filter-id->":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h>m}],"filter-<=":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m<=_}],"filter-id-<=":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h<=m}],"filter->=":[$r,[kr,Jr],(d,[l,h])=>{const m=d.properties()[l.value],_=h.value;return typeof m==typeof _&&m>=_}],"filter-id->=":[$r,[Jr],(d,[l])=>{const h=d.id(),m=l.value;return typeof h==typeof m&&h>=m}],"filter-has":[$r,[Jr],(d,[l])=>l.value in d.properties()],"filter-has-id":[$r,[],d=>d.id()!==null&&d.id()!==void 0],"filter-type-in":[$r,[eo(kr)],(d,[l])=>l.value.indexOf(d.geometryType())>=0],"filter-id-in":[$r,[eo(Jr)],(d,[l])=>l.value.indexOf(d.id())>=0],"filter-in-small":[$r,[kr,eo(Jr)],(d,[l,h])=>h.value.indexOf(d.properties()[l.value])>=0],"filter-in-large":[$r,[kr,eo(Jr)],(d,[l,h])=>function(m,_,S,T){for(;S<=T;){const C=S+T>>1;if(_[C]===m)return!0;_[C]>m?T=C-1:S=C+1}return!1}(d.properties()[l.value],h.value,0,h.value.length-1)],all:{type:$r,overloads:[[[$r,$r],(d,[l,h])=>l.evaluate(d)&&h.evaluate(d)],[Wu($r),(d,l)=>{for(const h of l)if(!h.evaluate(d))return!1;return!0}]]},any:{type:$r,overloads:[[[$r,$r],(d,[l,h])=>l.evaluate(d)||h.evaluate(d)],[Wu($r),(d,l)=>{for(const h of l)if(h.evaluate(d))return!0;return!1}]]},"!":[$r,[$r],(d,[l])=>!l.evaluate(d)],"is-supported-script":[$r,[kr],(d,[l])=>{const h=d.globals&&d.globals.isSupportedScript;return!h||h(l.evaluate(d))}],upcase:[kr,[kr],(d,[l])=>l.evaluate(d).toUpperCase()],downcase:[kr,[kr],(d,[l])=>l.evaluate(d).toLowerCase()],concat:[kr,Wu(Jr),(d,l)=>l.map(h=>lu(h.evaluate(d))).join("")],"resolved-locale":[kr,[hg],(d,[l])=>l.evaluate(d).resolvedLocale()],random:[yi,[yi,yi,Jr],(d,l)=>{const[h,m,_]=l.map(T=>T.evaluate(d));if(h>m||h===m)return h;let S;if(typeof _=="string")S=function(T){let C=0;if(T.length===0)return C;for(let L=0;L<T.length;L++)C=(C<<5)-C+T.charCodeAt(L),C|=0;return C}(_);else{if(typeof _!="number")throw new sa(`Invalid seed input: ${_}`);S=_}return h+wT(S)()*(m-h)}]});class x_{constructor(l,h,m,_,S){this.expression=l,this._warningHistory={},this._scope=m,this._options=_,this._iconImageUseTheme=S,this._evaluator=new io(m,_,S),this._defaultValue=h?function(T){return T.type==="color"&&(__(T.default)||Array.isArray(T.default))?new Xr(0,0,0,0):T.type==="color"?Xr.parse(T.default)||null:T.default===void 0?null:T.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null,this.configDependencies=Mg(l),this.isIndoorDependent=g_(l)}evaluateWithoutErrorHandling(l,h,m,_,S,T,C,L){return this._evaluator.globals=l,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=_||null,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(l,h,m,_,S,T,C,L,k){this._evaluator||(this._evaluator=new io(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=l,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=L||null,this._evaluator.iconImageUseTheme=k||null;try{const F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new sa(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(F)} instead.`);return F}catch(F){return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${F.message}`)),this._defaultValue}}}function b_(d){return Array.isArray(d)&&d.length>0&&typeof d[0]=="string"&&d[0]in ff}function hu(d,l,h,m,_){const S=new n_(ff,[],l?function(C){const L={color:Ss,string:kr,number:yi,enum:kr,boolean:$r,formatted:Rh,resolvedImage:dg};return C.type==="array"?eo(L[C.value]||Jr,C.length):L[C.type]}(l):void 0,void 0,void 0,h,m,_),T=S.parse(d,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?Vh(new x_(T,l,h,m,_)):Ec(S.errors)}class Eg{constructor(l,h,m,_){this.kind=l,this._styleExpression=h,this.isLightConstant=m,this.isLineProgressConstant=_,this.isStateDependent=l!=="constant"&&!wg(h.expression),this.configDependencies=Mg(h.expression),this.isIndoorDependent=g_(h.expression)}evaluateWithoutErrorHandling(l,h,m,_,S,T){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,_,S,T)}evaluate(l,h,m,_,S,T,C){return this._styleExpression.evaluate(l,h,m,_,S,T,void 0,void 0,C)}}class Pc{constructor(l,h,m,_,S,T){this.kind=l,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=l!=="camera"&&!wg(h.expression),this.isIndoorDependent=g_(h.expression),this.isLightConstant=S,this.isLineProgressConstant=T,this.configDependencies=Mg(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(l,h,m,_,S,T){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,_,S,T)}evaluate(l,h,m,_,S,T){return this._styleExpression.evaluate(l,h,m,_,S,T)}interpolationFactor(l,h,m){return this.interpolationType?$s.interpolationFactor(this.interpolationType,l,h,m):0}}function Nx(d,l,h,m,_){if((d=hu(d,l,h,m,_)).result==="error")return d;const S=d.value.expression,T=sf(S);if(!T&&!m_(l))return Ec([new yl("","data expressions not supported")]);const C=lf(S,["zoom","pitch","distance-from-center"]);if(!C&&!Bx(l))return Ec([new yl("","zoom expressions not supported")]);const L=lf(S,["measure-light"]);if(!L&&!zx(l))return Ec([new yl("","measure-light expression not supported")]);const k=lf(S,["line-progress"]);if(!k&&!function(U){return Ox(U.expression,"line-progress")}(l))return Ec([new yl("","line-progress expression not supported")]);const F=l.expression&&l.expression.relaxZoomRestriction,V=S_(S);return V||C||F?V instanceof yl?Ec([V]):V instanceof $s&&!v_(l)?Ec([new yl("",'"interpolate" expressions cannot be used with this property')]):Vh(V?new Pc(T&&k?"camera":"composite",d.value,V.labels,V instanceof $s?V.interpolation:void 0,L,k):new Eg(T&&k?"constant":"source",d.value,L,k)):Ec([new yl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class w_{constructor(l,h){this._parameters=l,this._specification=h,Object.assign(this,y_(this._parameters,this._specification))}static deserialize(l){return new w_(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function S_(d){let l=null;if(d instanceof Ig)l=S_(d.result);else if(d instanceof Ag){for(const h of d.args)if(l=S_(h),l)break}else(d instanceof Sg||d instanceof $s)&&d.input instanceof Go&&d.input.name==="zoom"&&(l=d);return l instanceof yl||d.eachChild(h=>{const m=S_(h);m instanceof yl?l=m:l&&m&&l!==m&&(l=new yl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}var Dg,T_,IT=function(){if(T_)return Dg;T_=1,Dg=l;var d=3;function l(h,m,_){var S=this.cells=[];if(h instanceof ArrayBuffer){this.arrayBuffer=h;var T=new Int32Array(this.arrayBuffer);h=T[0],this.d=(m=T[1])+2*(_=T[2]);for(var C=0;C<this.d*this.d;C++){var L=T[d+C],k=T[d+C+1];S.push(L===k?null:T.subarray(L,k))}var F=T[d+S.length+1];this.keys=T.subarray(T[d+S.length],F),this.bboxes=T.subarray(F),this.insert=this._insertReadonly}else{this.d=m+2*_;for(var V=0;V<this.d*this.d;V++)S.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=h,this.padding=_,this.scale=m/h,this.uid=0;var U=_/m*h;this.min=-U,this.max=h+U}return l.prototype.insert=function(h,m,_,S,T){this._forEachCell(m,_,S,T,this._insertCell,this.uid++),this.keys.push(h),this.bboxes.push(m),this.bboxes.push(_),this.bboxes.push(S),this.bboxes.push(T)},l.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},l.prototype._insertCell=function(h,m,_,S,T,C){this.cells[T].push(C)},l.prototype.query=function(h,m,_,S,T){var C=this.min,L=this.max;if(h<=C&&m<=C&&L<=_&&L<=S&&!T)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(h,m,_,S,this._queryCell,k,{},T),k},l.prototype._queryCell=function(h,m,_,S,T,C,L,k){var F=this.cells[T];if(F!==null)for(var V=this.keys,U=this.bboxes,$=0;$<F.length;$++){var Z=F[$];if(L[Z]===void 0){var Q=4*Z;(k?k(U[Q+0],U[Q+1],U[Q+2],U[Q+3]):h<=U[Q+2]&&m<=U[Q+3]&&_>=U[Q+0]&&S>=U[Q+1])?(L[Z]=!0,C.push(V[Z])):L[Z]=!1}}},l.prototype._forEachCell=function(h,m,_,S,T,C,L,k){for(var F=this._convertToCellCoord(h),V=this._convertToCellCoord(m),U=this._convertToCellCoord(_),$=this._convertToCellCoord(S),Z=F;Z<=U;Z++)for(var Q=V;Q<=$;Q++){var et=this.d*Q+Z;if((!k||k(this._convertFromCellCoord(Z),this._convertFromCellCoord(Q),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(Q+1)))&&T.call(this,h,m,_,S,et,C,L,k))return}},l.prototype._convertFromCellCoord=function(h){return(h-this.padding)/this.scale},l.prototype._convertToCellCoord=function(h){return Math.max(0,Math.min(this.d-1,Math.floor(h*this.scale)+this.padding))},l.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var h=this.cells,m=d+this.cells.length+1+1,_=0,S=0;S<this.cells.length;S++)_+=this.cells[S].length;var T=new Int32Array(m+_+this.keys.length+this.bboxes.length);T[0]=this.extent,T[1]=this.n,T[2]=this.padding;for(var C=m,L=0;L<h.length;L++){var k=h[L];T[d+L]=C,T.set(k,C),C+=k.length}return T[d+h.length]=C,T.set(this.keys,C),T[d+h.length+1]=C+=this.keys.length,T.set(this.bboxes,C),C+=this.bboxes.length,T.buffer},Dg}(),Uh=qp(IT);const gf={};function li(d,l,h={}){Object.defineProperty(d,"_classRegistryKey",{value:l,writable:!1}),gf[l]={klass:d,omit:h.omit||[]}}li(Object,"Object"),Uh.serialize=function(d,l){const h=d.toArrayBuffer();return l&&l.add(h),{buffer:h}},Uh.deserialize=function(d){return new Uh(d.buffer)},Object.defineProperty(Uh,"name",{value:"Grid"}),li(Uh,"Grid"),delete Me.prototype.constructor,typeof DOMMatrix<"u"&&li(DOMMatrix,"DOMMatrix"),li(Xr,"Color"),li(Error,"Error"),li(Za,"Formatted"),li(gg,"FormattedSection"),li(Ph,"AJAXError"),li(cs,"ResolvedImage"),li(w_,"StylePropertyFunction"),li(x_,"StyleExpression",{omit:["_evaluator"]}),li(Ba,"ImageId"),li(Gu,"ImageVariant"),li(Pc,"ZoomDependentExpression"),li(Eg,"ZoomConstantExpression"),li(Go,"CompoundExpression",{omit:["_evaluate"]});for(const d in ff)gf[ff[d]._classRegistryKey]||li(ff[d],`Expression${d}`);function Vx(d){return d&&typeof ArrayBuffer<"u"&&(d instanceof ArrayBuffer||d.constructor&&d.constructor.name==="ArrayBuffer")}function $u(d){return self.ImageBitmap&&d instanceof ImageBitmap}function Lc(d,l){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp)return d;if(Vx(d)||$u(d))return l&&l.add(d),d;if(ArrayBuffer.isView(d))return l&&l.add(d.buffer),d;if(d instanceof ImageData)return l&&l.add(d.data.buffer),d;if(Array.isArray(d)){const h=[];for(const m of d)h.push(Lc(m,l));return h}if(d instanceof Map){const h={$name:"Map",entries:[]};for(const[m,_]of d.entries())h.entries.push(Lc(m),Lc(_,l));return h}if(d instanceof Set){const h={$name:"Set"};let m=0;for(const _ of d.values())h[++m]=Lc(_);return h}if(d instanceof DOMMatrix){const h={$name:"DOMMatrix"},m=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const _ of m)h[_]=d[_];return h}if(typeof d=="bigint")return{$name:"BigInt",value:d.toString()};if(typeof d=="object"){const h=d.constructor,m=h._classRegistryKey;if(!m)throw new Error(`Can't serialize object of unregistered class "${h.name}".`);const _=h.serialize?h.serialize(d,l):{};if(!h.serialize){for(const S in d)d.hasOwnProperty(S)&&(gf[m].omit.indexOf(S)>=0||(_[S]=Lc(d[S],l)));d instanceof Error&&(_.message=d.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(_.$name=m),_}throw new Error("can't serialize object of type "+typeof d)}function Rc(d){if(d==null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||d instanceof Boolean||d instanceof Number||d instanceof String||d instanceof Date||d instanceof RegExp||Vx(d)||$u(d)||ArrayBuffer.isView(d)||d instanceof ImageData)return d;if(Array.isArray(d))return d.map(Rc);if(typeof d=="object"){const l=d.$name||"Object";if(l==="Map"){const _=d.entries||[],S=new Map;for(let T=0;T<_.length;T+=2)S.set(Rc(_[T]),Rc(_[T+1]));return S}if(l==="Set"){const _=new Set;for(const S of Object.keys(d))S!=="$name"&&_.add(Rc(d[S]));return _}if(l==="DOMMatrix"){let _;return _=d.is2D?[d.a,d.b,d.c,d.d,d.e,d.f]:[d.m11,d.m12,d.m13,d.m14,d.m21,d.m22,d.m23,d.m24,d.m31,d.m32,d.m33,d.m34,d.m41,d.m42,d.m43,d.m44],new DOMMatrix(_)}if(l==="BigInt")return BigInt(d.value);const{klass:h}=gf[l];if(!h)throw new Error(`Can't deserialize unregistered class "${l}".`);if(h.deserialize)return h.deserialize(d);const m=Object.create(h.prototype);for(const _ of Object.keys(d))_!=="$name"&&(m[_]=Rc(d[_]));return m}throw new Error("can't deserialize object of type "+typeof d)}const Ei={"Latin-1 Supplement":d=>d>=128&&d<=255,Arabic:d=>d>=1536&&d<=1791,"Arabic Supplement":d=>d>=1872&&d<=1919,"Arabic Extended-A":d=>d>=2208&&d<=2303,"Hangul Jamo":d=>d>=4352&&d<=4607,"Unified Canadian Aboriginal Syllabics":d=>d>=5120&&d<=5759,Khmer:d=>d>=6016&&d<=6143,"Unified Canadian Aboriginal Syllabics Extended":d=>d>=6320&&d<=6399,"General Punctuation":d=>d>=8192&&d<=8303,"Letterlike Symbols":d=>d>=8448&&d<=8527,"Number Forms":d=>d>=8528&&d<=8591,"Miscellaneous Technical":d=>d>=8960&&d<=9215,"Control Pictures":d=>d>=9216&&d<=9279,"Optical Character Recognition":d=>d>=9280&&d<=9311,"Enclosed Alphanumerics":d=>d>=9312&&d<=9471,"Geometric Shapes":d=>d>=9632&&d<=9727,"Miscellaneous Symbols":d=>d>=9728&&d<=9983,"Miscellaneous Symbols and Arrows":d=>d>=11008&&d<=11263,"CJK Radicals Supplement":d=>d>=11904&&d<=12031,"Kangxi Radicals":d=>d>=12032&&d<=12255,"Ideographic Description Characters":d=>d>=12272&&d<=12287,"CJK Symbols and Punctuation":d=>d>=12288&&d<=12351,Hiragana:d=>d>=12352&&d<=12447,Katakana:d=>d>=12448&&d<=12543,Bopomofo:d=>d>=12544&&d<=12591,"Hangul Compatibility Jamo":d=>d>=12592&&d<=12687,Kanbun:d=>d>=12688&&d<=12703,"Bopomofo Extended":d=>d>=12704&&d<=12735,"CJK Strokes":d=>d>=12736&&d<=12783,"Katakana Phonetic Extensions":d=>d>=12784&&d<=12799,"Enclosed CJK Letters and Months":d=>d>=12800&&d<=13055,"CJK Compatibility":d=>d>=13056&&d<=13311,"CJK Unified Ideographs Extension A":d=>d>=13312&&d<=19903,"Yijing Hexagram Symbols":d=>d>=19904&&d<=19967,"CJK Unified Ideographs":d=>d>=19968&&d<=40959,"Yi Syllables":d=>d>=40960&&d<=42127,"Yi Radicals":d=>d>=42128&&d<=42191,"Hangul Jamo Extended-A":d=>d>=43360&&d<=43391,"Hangul Syllables":d=>d>=44032&&d<=55215,"Hangul Jamo Extended-B":d=>d>=55216&&d<=55295,"Private Use Area":d=>d>=57344&&d<=63743,"CJK Compatibility Ideographs":d=>d>=63744&&d<=64255,"Arabic Presentation Forms-A":d=>d>=64336&&d<=65023,"Vertical Forms":d=>d>=65040&&d<=65055,"CJK Compatibility Forms":d=>d>=65072&&d<=65103,"Small Form Variants":d=>d>=65104&&d<=65135,"Arabic Presentation Forms-B":d=>d>=65136&&d<=65279,"Halfwidth and Fullwidth Forms":d=>d>=65280&&d<=65519,Osage:d=>d>=66736&&d<=66815,"CJK Unified Ideographs Extension B":d=>d>=131072&&d<=173791};function Ux(d){for(const l of d)if(I_(l.charCodeAt(0)))return!0;return!1}function CT(d){for(const l of d)if(!A_(l.charCodeAt(0)))return!1;return!0}function A_(d){return!(Ei.Arabic(d)||Ei["Arabic Supplement"](d)||Ei["Arabic Extended-A"](d)||Ei["Arabic Presentation Forms-A"](d)||Ei["Arabic Presentation Forms-B"](d))}function I_(d){return!(d!==746&&d!==747&&(d<4352||!(Ei["Bopomofo Extended"](d)||Ei.Bopomofo(d)||Ei["CJK Compatibility Forms"](d)&&!(d>=65097&&d<=65103)||Ei["CJK Compatibility Ideographs"](d)||Ei["CJK Compatibility"](d)||Ei["CJK Radicals Supplement"](d)||Ei["CJK Strokes"](d)||!(!Ei["CJK Symbols and Punctuation"](d)||d>=12296&&d<=12305||d>=12308&&d<=12319||d===12336)||Ei["CJK Unified Ideographs Extension A"](d)||Ei["CJK Unified Ideographs"](d)||Ei["Enclosed CJK Letters and Months"](d)||Ei["Hangul Compatibility Jamo"](d)||Ei["Hangul Jamo Extended-A"](d)||Ei["Hangul Jamo Extended-B"](d)||Ei["Hangul Jamo"](d)||Ei["Hangul Syllables"](d)||Ei.Hiragana(d)||Ei["Ideographic Description Characters"](d)||Ei.Kanbun(d)||Ei["Kangxi Radicals"](d)||Ei["Katakana Phonetic Extensions"](d)||Ei.Katakana(d)&&d!==12540||!(!Ei["Halfwidth and Fullwidth Forms"](d)||d===65288||d===65289||d===65293||d>=65306&&d<=65310||d===65339||d===65341||d===65343||d>=65371&&d<=65503||d===65507||d>=65512&&d<=65519)||!(!Ei["Small Form Variants"](d)||d>=65112&&d<=65118||d>=65123&&d<=65126)||Ei["Unified Canadian Aboriginal Syllabics"](d)||Ei["Unified Canadian Aboriginal Syllabics Extended"](d)||Ei["Vertical Forms"](d)||Ei["Yijing Hexagram Symbols"](d)||Ei["Yi Syllables"](d)||Ei["Yi Radicals"](d))))}function Gx(d){return!(I_(d)||function(l){return!!(Ei["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Ei["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Ei["Letterlike Symbols"](l)||Ei["Number Forms"](l)||Ei["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Ei["Control Pictures"](l)&&l!==9251||Ei["Optical Character Recognition"](l)||Ei["Enclosed Alphanumerics"](l)||Ei["Geometric Shapes"](l)||Ei["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Ei["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Ei["CJK Symbols and Punctuation"](l)||Ei.Katakana(l)||Ei["Private Use Area"](l)||Ei["CJK Compatibility Forms"](l)||Ei["Small Form Variants"](l)||Ei["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(d))}function Hx(d){return Ei.Arabic(d)||Ei["Arabic Supplement"](d)||Ei["Arabic Extended-A"](d)||Ei["Arabic Presentation Forms-A"](d)||Ei["Arabic Presentation Forms-B"](d)}function MT(d){return d>=1424&&d<=2303||Ei["Arabic Presentation Forms-A"](d)||Ei["Arabic Presentation Forms-B"](d)}function oD(d,l){return!(!l&&MT(d)||d>=2304&&d<=3583||d>=3840&&d<=4255||Ei.Khmer(d))}function sD(d){for(const l of d)if(MT(l.charCodeAt(0)))return!0;return!1}const Ts={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let jx=null,Jo=Ts.unavailable,kc=null;const ET=function(d){d&&typeof d=="string"&&d.indexOf("NetworkError")>-1&&(Jo=Ts.error),jx&&jx(d)};function Wx(){$x.fire(new js("pluginStateChange",{pluginStatus:Jo,pluginURL:kc}))}const $x=new Vu,Zx=function(){return Jo},qx=function(){if(Jo!==Ts.deferred||!kc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jo=Ts.loading,Wx(),kc&&qd({url:kc},d=>{d?ET(d):(Jo=Ts.loaded,Wx())})},As={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Jo===Ts.loaded||As.applyArabicShaping!=null,isLoading:()=>Jo===Ts.loading,setState(d){Jo=d.pluginStatus,kc=d.pluginURL},isParsing:()=>Jo===Ts.parsing,isParsed:()=>Jo===Ts.parsed,getPluginURL:()=>kc};class xn{constructor(l,h){this.zoom=l,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.transition=h.transition,this.pitch=h.pitch,this.brightness=h.brightness,this.worldview=h.worldview,this.activeFloors=h.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(l){return function(h,m){for(const _ of h)if(!oD(_.charCodeAt(0),m))return!1;return!0}(l,As.isLoaded())}}class Pg{constructor(l,h,m,_,S){this.property=l,this.value=h,this.expression=function(T,C,L,k,F){if(__(T))return new w_(T,C);if(b_(T)||Array.isArray(T)&&T.length>0){const V=Nx(T,C,L,k,F);if(V.result==="error")throw new Error(V.value.map(U=>`${U.key}: ${U.message}`).join(", "));return V.value}{let V=T;return typeof T=="string"&&C.type==="color"&&(V=Xr.parse(T)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>V}}}(h===void 0?l.specification.default:h,l.specification,m,_,S)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,h,m,_){return this.property.possiblyEvaluate(this,l,h,m,_)}}class mf{constructor(l,h,m,_){this.property=l,this.value=new Pg(l,void 0,h,m,_)}transitioned(l,h){return new PT(this.property,this.value,h,Object.assign({},l.transition,this.transition),l.now)}untransitioned(){return new PT(this.property,this.value,null,{},0)}}class DT{constructor(l,h,m,_){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues),this._scope=h,this._options=m,this._iconImageUseTheme=_,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(l){return mi(this._values[l].value.value)}setValue(l,h){this._values.hasOwnProperty(l)||(this._values[l]=new mf(this._values[l].property,this._scope,this._options,this._iconImageUseTheme)),this._values[l].value=new Pg(this._values[l].property,h===null?void 0:mi(h),this._scope,this._options,this._iconImageUseTheme),this._values[l].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[l].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[l].value.isIndoorDependent())}setTransitionOrValue(l,h){h&&(this._options=h);const m=this._properties.properties;if(l)for(const _ in l){const S=l[_];if(_.endsWith("-transition")){const T=_.slice(0,-11);m[T]&&this.setTransition(T,S)}else m.hasOwnProperty(_)&&this.setValue(_,S)}}getTransition(l){return mi(this._values[l].transition)}setTransition(l,h){this._values.hasOwnProperty(l)||(this._values[l]=new mf(this._values[l].property)),this._values[l].transition=mi(h)||void 0}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m);const _=this.getTransition(h);_!==void 0&&(l[`${h}-transition`]=_)}return l}transitioned(l,h){const m=new Zu(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].transitioned(l,h._values[_]);return m}untransitioned(){const l=new Zu(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].untransitioned();return l}isIndoorDependent(){return this._isIndoorDependent}}class PT{constructor(l,h,m,_,S){const T=_.delay||0,C=_.duration||0;S=S||0,this.property=l,this.value=h,this.begin=S+T,this.end=this.begin+C,l.specification.transition&&(_.delay||_.duration)&&(this.prior=m)}possiblyEvaluate(l,h,m){const _=l.now||0,S=this.value.possiblyEvaluate(l,h,m),T=this.prior;if(T){if(_>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(_<this.begin)return T.possiblyEvaluate(l,h,m);{const C=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(l,h,m),S,Kp(C))}}return S}}class Zu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,h,m){const _=new Gh(this._properties);for(const S of Object.keys(this._values))_._values[S]=this._values[S].possiblyEvaluate(l,h,m);return _}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Xx{constructor(l,h,m,_){this._properties=l,this._values=Object.create(l.defaultPropertyValues),this._scope=h,this._options=m,this._iconImageUseTheme=_,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(l){return mi(this._values[l].value)}setValue(l,h){this._values[l]=new Pg(this._values[l].property,h===null?void 0:mi(h),this._scope,this._options,this._iconImageUseTheme),this._values[l].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[l].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[l].isIndoorDependent())}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m)}return l}possiblyEvaluate(l,h,m,_){const S=new Gh(this._properties);for(const T of Object.keys(this._values))S._values[T]=this._values[T].possiblyEvaluate(l,h,m,_);return S}isIndoorDependent(){return this._isIndoorDependent}}class Tl{constructor(l,h,m,_){this.property=l,this.value=h,this.parameters=m,this.iconImageUseTheme=_}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,h,m,_){return this.property.evaluate(this.value,this.parameters,l,h,m,_,this.iconImageUseTheme)}}class Gh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Pe{constructor(l){this.specification=l}possiblyEvaluate(l,h){return l.expression.evaluate(h)}interpolate(l,h,m){const _=Uu[this.specification.type];return _?_(l,h,m):l}}class ei{constructor(l,h){this.specification=l,this.overrides=h}possiblyEvaluate(l,h,m,_,S){return l.expression.kind==="constant"||l.expression.kind==="camera"?new Tl(this,{kind:"constant",value:l.expression.evaluate(h,null,{},m,_,void 0,S)},h):new Tl(this,l.expression,h,S)}interpolate(l,h,m){if(l.value.kind!=="constant"||h.value.kind!=="constant")return l;if(l.value.value===void 0||h.value.value===void 0)return new Tl(this,{kind:"constant",value:void 0},l.parameters);const _=Uu[this.specification.type];return _?new Tl(this,{kind:"constant",value:_(l.value.value,h.value.value,m)},l.parameters):l}evaluate(l,h,m,_,S,T,C){return l.kind==="constant"?l.value:l.evaluate(h,m,_,S,T,void 0,C)}}class vf{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,_){return!!l.expression.evaluate(h,null,{},m,_)}interpolate(){return!1}}class Kn{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const h=new xn(0,{});for(const m in l){const _=l[m];_.specification.overridable&&this.overridableProperties.push(m);const S=this.defaultPropertyValues[m]=new Pg(_,void 0),T=this.defaultTransitionablePropertyValues[m]=new mf(_);this.defaultTransitioningPropertyValues[m]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=S.possiblyEvaluate(h)}}}li(ei,"DataDrivenProperty"),li(Pe,"DataConstantProperty"),li(vf,"ColorRampProperty");var Yt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Yx(d){return d instanceof Number||d instanceof String||d instanceof Boolean?d.valueOf():d}function _f(d){if(Array.isArray(d))return d.map(_f);if(d instanceof Object&&!(d instanceof Number||d instanceof String||d instanceof Boolean)){const l={};for(const h in d)l[h]=_f(d[h]);return l}return Yx(d)}function yf(d){if(d===!0||d===!1)return!0;if(!Array.isArray(d)||d.length===0)return!1;switch(d[0]){case"has":return d.length>=2&&d[1]!=="$id"&&d[1]!=="$type";case"in":return d.length>=3&&(typeof d[1]!="string"||Array.isArray(d[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return d.length!==3||Array.isArray(d[1])||Array.isArray(d[2]);case"any":case"all":for(const l of d.slice(1))if(!yf(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}function C_(d,l="",h=null,m="fill"){if(d==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yf(d)||(d=Zs(d));const _=d;let S=!0;try{S=function(F){if(!bf(F))return F;let V=_f(F);return xf(V),V=M_(V),V}(_)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(_,null,2)}
        `)}let T=null,C=null;if(m!=="background"&&m!=="sky"&&m!=="slot"){C=Yt[`filter_${m}`];const F=hu(S,C,l,h);if(F.result==="error")throw new Error(F.value.map(V=>`${V.key}: ${V.message}`).join(", "));T=(V,U,$)=>F.value.evaluate(V,U,{},$)}let L=null,k=null;if(S!==_){const F=hu(_,C,l,h);if(F.result==="error")throw new Error(F.value.map(V=>`${V.key}: ${V.message}`).join(", "));L=(V,U,$,Z,Q)=>F.value.evaluate(V,U,{},$,void 0,void 0,Z,Q),k=!sf(F.value.expression)}return{filter:T,dynamicFilter:L||void 0,needGeometry:RT(S),needFeature:!!k}}function M_(d){if(!Array.isArray(d))return d;const l=function(h){if(lD.has(h[0])){for(let m=1;m<h.length;m++)if(bf(h[m]))return!0}return h}(d);return l===!0?l:l.map(h=>M_(h))}function xf(d){let l=!1;const h=[];if(d[0]==="case"){for(let m=1;m<d.length-1;m+=2)l=l||bf(d[m]),h.push(d[m+1]);h.push(d[d.length-1])}else if(d[0]==="match"){l=l||bf(d[1]);for(let m=2;m<d.length-1;m+=2)h.push(d[m+1]);h.push(d[d.length-1])}else if(d[0]==="step"){l=l||bf(d[1]);for(let m=1;m<d.length-1;m+=2)h.push(d[m+1])}l&&(d.length=0,d.push("any",...h));for(let m=1;m<d.length;m++)xf(d[m])}function bf(d){if(!Array.isArray(d))return!1;if((l=d[0])==="pitch"||l==="distance-from-center")return!0;var l;for(let h=1;h<d.length;h++)if(bf(d[h]))return!0;return!1}const lD=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function LT(d,l){return d<l?-1:d>l?1:0}function RT(d){if(!Array.isArray(d))return!1;if(d[0]==="within"||d[0]==="distance")return!0;for(let l=1;l<d.length;l++)if(RT(d[l]))return!0;return!1}function Zs(d){if(!d)return!0;const l=d[0];return d.length<=1?l!=="any":l==="=="?Kx(d[1],d[2],"=="):l==="!="?E_(Kx(d[1],d[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Kx(d[1],d[2],l):l==="any"?(h=d.slice(1),["any"].concat(h.map(Zs))):l==="all"?["all"].concat(d.slice(1).map(Zs)):l==="none"?["all"].concat(d.slice(1).map(Zs).map(E_)):l==="in"?Jx(d[1],d.slice(2)):l==="!in"?E_(Jx(d[1],d.slice(2))):l==="has"?kT(d[1]):l!=="!has"||E_(kT(d[1]));var h}function Kx(d,l,h){switch(d){case"$type":return[`filter-type-${h}`,l];case"$id":return[`filter-id-${h}`,l];default:return[`filter-${h}`,d,l]}}function Jx(d,l){if(l.length===0)return!1;switch(d){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(h=>typeof h!=typeof l[0])?["filter-in-large",d,["literal",l.sort(LT)]]:["filter-in-small",d,["literal",l]]}}function kT(d){switch(d){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",d]}}function E_(d){return["!",d]}const Lg="";function Hh(d,l){return l?`${d}${Lg}${l}`:d}let OT;const zT=()=>OT||(OT=new Kn({"icon-size":new ei(Yt.layout_symbol["icon-size"]),"icon-image":new ei(Yt.layout_symbol["icon-image"]),"icon-rotate":new ei(Yt.layout_symbol["icon-rotate"]),"icon-offset":new ei(Yt.layout_symbol["icon-offset"])}));class uD{constructor(l,h,m,_,S,T){this.cachedIconPrimary=null;const C=hu(l,Yt.appearance.condition);if(C.result==="success"&&(this.condition=C.value),this.name=h,m){this.properties=new Gh(zT()),this.unevaluatedLayout=new Xx(zT(),_,S,T);for(const L in m)this.unevaluatedLayout.setValue(L,m[L])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(l){this.cachedIconPrimary=l}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(l){return!(this.condition||!l.isHidden||this.name!=="hidden")||this.condition.evaluate(l.globals,l.feature,l.featureState,l.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(l){return this.properties.get(l)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(l,h,m){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(l,void 0,h,m))}serialize(){const l={};return l.condition=this.condition.expression.serialize(),this.name&&(l.name=this.name),this.unevaluatedLayout&&(l.properties=this.unevaluatedLayout.serialize()),l}}const BT="-transition",cD=new Set(["fill","line","background","hillshade","raster"]);class Ho extends Vu{constructor(l,h,m,_,S,T){if(super(),this.id=l.id,this.fqid=Hh(this.id,m),this.type=l.type,this.scope=m,this.lut=_,this.options=S,this.iconImageUseTheme=T,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},l.type!=="custom"){if(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type&&l.type!=="background"&&l.type!=="sky"&&l.type!=="slot"){this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter;const C=hu(this.filter,Yt[`filter_${l.type}`]);C.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...C.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||C.value.isIndoorDependent)}if(l.slot&&(this.slot=l.slot),l.appearances&&this.setAppearances(l.appearances),h.layout&&(this._unevaluatedLayout=new Xx(h.layout,this.scope,S,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),h.paint){this._transitionablePaint=new DT(h.paint,this.scope,S);for(const C in l.paint)this.setPaintProperty(C,l.paint[C]);for(const C in l.layout)this.setLayoutProperty(C,l.layout[C]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gh(h.paint)}}}onAdd(l){}onRemove(l){}isDraped(l){return!this.is3D(!0)&&cD.has(this.type)}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,h){if(this.type==="custom"&&l==="visibility")return void(this.visibility=h);const m=this._unevaluatedLayout;m._properties.properties[l]&&(m.setValue(l,h),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...m.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||m.isIndoorDependent(),l==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(l){this.appearances=[],l.forEach(h=>{this.appearances.push(new uD(h.condition,h.name,h.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(l){return l.endsWith(BT)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}isPaintProperty(l){return!!this._transitionablePaint._properties.properties[l]}setPaintProperty(l,h){const m=this._transitionablePaint,_=m._properties.properties;if(l.endsWith(BT)){const V=l.slice(0,-11);return _[V]&&m.setTransition(V,h||void 0),!1}if(!_[l])return!1;const S=m._values[l],T=S.value.isDataDriven(),C=S.value;m.setValue(l,h),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...m.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||m.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(l);const L=m._values[l].value,k=L.isDataDriven(),F=l.endsWith("pattern")||l==="line-dasharray";return k||T||F||this._handleOverridablePaintPropertyUpdate(l,C,L)}_handleSpecialPaintPropertyUpdate(l){}getProgramIds(){return null}getDefaultProgramParams(l,h,m){return null}_handleOverridablePaintPropertyUpdate(l,h,m){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,h){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,h,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,h)}serialize(){const l={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(l.appearances=this.appearances.map(h=>h.serialize())),Ce(l,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}is3D(l){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const l in this.paint._values){const h=this.paint.get(l);if(h instanceof Tl&&m_(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}for(const l of this.appearances)if(!wg(l.condition.expression))return!0;return!1}compileFilter(l){this._filterCompiled||(this._featureFilter=C_(this.filter,this.scope,l),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(l){this._stats&&(l.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(l,h,m){return{}}queryRadius(l){}queryIntersectsFeature(l,h,m,_,S,T,C,L,k){}}const hD={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rg{constructor(l,h){this._structArray=l,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class In{constructor(){this.capacity=-1,this.resize(0)}static serialize(l,h){return l._trim(),h&&h.add(l.arrayBuffer),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const h=Object.create(this.prototype);return h.arrayBuffer=l.arrayBuffer,h.length=l.length,h.capacity=l.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...l){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...l){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gr(d,l=1){let h=0,m=0;return{members:d.map(_=>{const S=hD[_.type].BYTES_PER_ELEMENT,T=h=Qx(h,Math.max(l,S)),C=_.components||1;return m=Math.max(m,S),h+=S*C,{name:_.name,type:_.type,components:C,offset:T}}),size:Qx(h,Math.max(m,l)),alignment:l}}function Qx(d,l){return Math.ceil(d/l)*l}class hs extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const _=2*l;return this.int16[_+0]=h,this.int16[_+1]=m,l}}hs.prototype.bytesPerElement=4,li(hs,"StructArrayLayout2i4");class jh extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=3*l;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=_,l}}jh.prototype.bytesPerElement=6,li(jh,"StructArrayLayout3i6");class wf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=4*l;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=_,this.int16[T+3]=S,l}}wf.prototype.bytesPerElement=8,li(wf,"StructArrayLayout4i8");class qu extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.float32[1*l+0]=h,l}}qu.prototype.bytesPerElement=4,li(qu,"StructArrayLayout1f4");class t1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=4*l,T=2*l;return this.int16[S+0]=h,this.int16[S+1]=m,this.float32[T+1]=_,l}}t1.prototype.bytesPerElement=8,li(t1,"StructArrayLayout2i1f8");class e1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=4*l;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=_,l}}e1.prototype.bytesPerElement=8,li(e1,"StructArrayLayout3i8");class D_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const C=5*l;return this.int16[C+0]=h,this.int16[C+1]=m,this.int16[C+2]=_,this.int16[C+3]=S,this.int16[C+4]=T,l}}D_.prototype.bytesPerElement=10,li(D_,"StructArrayLayout5i10");class P_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,C)}emplace(l,h,m,_,S,T,C,L){const k=6*l,F=12*l,V=3*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.uint8[F+4]=_,this.uint8[F+5]=S,this.uint8[F+6]=T,this.uint8[F+7]=C,this.float32[V+2]=L,l}}P_.prototype.bytesPerElement=12,li(P_,"StructArrayLayout2i4ub1f12");class qs extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=3*l;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=_,l}}qs.prototype.bytesPerElement=12,li(qs,"StructArrayLayout3f12");class Oc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const C=6*l,L=3*l;return this.uint16[C+0]=h,this.uint16[C+1]=m,this.uint16[C+2]=_,this.uint16[C+3]=S,this.float32[L+2]=T,l}}Oc.prototype.bytesPerElement=12,li(Oc,"StructArrayLayout4ui1f12");class Wh extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=4*l;return this.uint16[T+0]=h,this.uint16[T+1]=m,this.uint16[T+2]=_,this.uint16[T+3]=S,l}}Wh.prototype.bytesPerElement=8,li(Wh,"StructArrayLayout4ui8");class L_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const C=this.length;return this.resize(C+1),this.emplace(C,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,C){const L=6*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.int16[L+2]=_,this.int16[L+3]=S,this.int16[L+4]=T,this.int16[L+5]=C,l}}L_.prototype.bytesPerElement=12,li(L_,"StructArrayLayout6i12");class R_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k,F,V,U){const $=this.length;return this.resize($+1),this.emplace($,l,h,m,_,S,T,C,L,k,F,V,U)}emplace(l,h,m,_,S,T,C,L,k,F,V,U,$){const Z=12*l;return this.int16[Z+0]=h,this.int16[Z+1]=m,this.int16[Z+2]=_,this.int16[Z+3]=S,this.uint16[Z+4]=T,this.uint16[Z+5]=C,this.uint16[Z+6]=L,this.uint16[Z+7]=k,this.int16[Z+8]=F,this.int16[Z+9]=V,this.int16[Z+10]=U,this.int16[Z+11]=$,l}}R_.prototype.bytesPerElement=24,li(R_,"StructArrayLayout4i4ui4i24");class Sf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const C=this.length;return this.resize(C+1),this.emplace(C,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,C){const L=10*l,k=5*l;return this.int16[L+0]=h,this.int16[L+1]=m,this.int16[L+2]=_,this.float32[k+2]=S,this.float32[k+3]=T,this.float32[k+4]=C,l}}Sf.prototype.bytesPerElement=20,li(Sf,"StructArrayLayout3i3f20");class zc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=4*l;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=_,this.float32[T+3]=S,l}}zc.prototype.bytesPerElement=16,li(zc,"StructArrayLayout4f16");class i1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint32[1*l+0]=h,l}}i1.prototype.bytesPerElement=4,li(i1,"StructArrayLayout1ul4");class Al extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const _=2*l;return this.uint16[_+0]=h,this.uint16[_+1]=m,l}}Al.prototype.bytesPerElement=4,li(Al,"StructArrayLayout2ui4");class r1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k,F,V,U,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,l,h,m,_,S,T,C,L,k,F,V,U,$)}emplace(l,h,m,_,S,T,C,L,k,F,V,U,$,Z){const Q=20*l,et=10*l;return this.int16[Q+0]=h,this.int16[Q+1]=m,this.int16[Q+2]=_,this.int16[Q+3]=S,this.int16[Q+4]=T,this.float32[et+3]=C,this.float32[et+4]=L,this.float32[et+5]=k,this.float32[et+6]=F,this.int16[Q+14]=V,this.uint32[et+8]=U,this.uint16[Q+18]=$,this.uint16[Q+19]=Z,l}}r1.prototype.bytesPerElement=40,li(r1,"StructArrayLayout5i4f1i1ul2ui40");class k_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,C)}emplace(l,h,m,_,S,T,C,L){const k=8*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.int16[k+2]=_,this.int16[k+4]=S,this.int16[k+5]=T,this.int16[k+6]=C,this.int16[k+7]=L,l}}k_.prototype.bytesPerElement=16,li(k_,"StructArrayLayout3i2i2i16");class Tf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const C=4*l,L=8*l;return this.float32[C+0]=h,this.float32[C+1]=m,this.float32[C+2]=_,this.int16[L+6]=S,this.int16[L+7]=T,l}}Tf.prototype.bytesPerElement=16,li(Tf,"StructArrayLayout2f1f2i16");class Af extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const C=this.length;return this.resize(C+1),this.emplace(C,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,C){const L=20*l,k=5*l;return this.uint8[L+0]=h,this.uint8[L+1]=m,this.float32[k+1]=_,this.float32[k+2]=S,this.float32[k+3]=T,this.float32[k+4]=C,l}}Af.prototype.bytesPerElement=20,li(Af,"StructArrayLayout2ub4f20");class Ln extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,l,h,m)}emplace(l,h,m,_){const S=3*l;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=_,l}}Ln.prototype.bytesPerElement=6,li(Ln,"StructArrayLayout3ui6");class If extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt){const It=this.length;return this.resize(It+1),this.emplace(It,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt)}emplace(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt,It){const Ot=30*l,Ut=15*l,Ht=60*l;return this.int16[Ot+0]=h,this.int16[Ot+1]=m,this.int16[Ot+2]=_,this.float32[Ut+2]=S,this.float32[Ut+3]=T,this.uint16[Ot+8]=C,this.uint16[Ot+9]=L,this.uint32[Ut+5]=k,this.uint32[Ut+6]=F,this.uint32[Ut+7]=V,this.uint16[Ot+16]=U,this.uint16[Ot+17]=$,this.uint16[Ot+18]=Z,this.float32[Ut+10]=Q,this.float32[Ut+11]=et,this.uint8[Ht+48]=nt,this.uint8[Ht+49]=dt,this.uint8[Ht+50]=mt,this.uint32[Ut+13]=yt,this.int16[Ot+28]=Lt,this.uint8[Ht+58]=It,l}}If.prototype.bytesPerElement=60,li(If,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class n1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt,It,Ot,Ut,Ht,se,Kt,ue,me,Te,Be,De,_e){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt,It,Ot,Ut,Ht,se,Kt,ue,me,Te,Be,De,_e)}emplace(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt,It,Ot,Ut,Ht,se,Kt,ue,me,Te,Be,De,_e,Ee){const ae=20*l,re=40*l,Ie=80*l;return this.float32[ae+0]=h,this.float32[ae+1]=m,this.int16[re+4]=_,this.int16[re+5]=S,this.int16[re+6]=T,this.int16[re+7]=C,this.int16[re+8]=L,this.int16[re+9]=k,this.int16[re+10]=F,this.int16[re+11]=V,this.int16[re+12]=U,this.uint16[re+13]=$,this.uint16[re+14]=Z,this.uint16[re+15]=Q,this.uint16[re+16]=et,this.uint16[re+17]=nt,this.uint16[re+18]=dt,this.uint16[re+19]=mt,this.uint16[re+20]=yt,this.uint16[re+21]=Lt,this.uint16[re+22]=It,this.uint16[re+23]=Ot,this.uint16[re+24]=Ut,this.uint16[re+25]=Ht,this.uint16[re+26]=se,this.uint16[re+27]=Kt,this.uint32[ae+14]=ue,this.float32[ae+15]=me,this.float32[ae+16]=Te,this.float32[ae+17]=Be,this.float32[ae+18]=De,this.uint8[Ie+76]=_e,this.uint16[re+39]=Ee,l}}n1.prototype.bytesPerElement=80,li(n1,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class a1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T){const C=this.length;return this.resize(C+1),this.emplace(C,l,h,m,_,S,T)}emplace(l,h,m,_,S,T,C){const L=6*l;return this.float32[L+0]=h,this.float32[L+1]=m,this.float32[L+2]=_,this.float32[L+3]=S,this.float32[L+4]=T,this.float32[L+5]=C,l}}a1.prototype.bytesPerElement=24,li(a1,"StructArrayLayout6f24");class $h extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,l,h,m,_,S)}emplace(l,h,m,_,S,T){const C=5*l;return this.float32[C+0]=h,this.float32[C+1]=m,this.float32[C+2]=_,this.float32[C+3]=S,this.float32[C+4]=T,l}}$h.prototype.bytesPerElement=20,li($h,"StructArrayLayout5f20");class o1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,C)}emplace(l,h,m,_,S,T,C,L){const k=7*l;return this.float32[k+0]=h,this.float32[k+1]=m,this.float32[k+2]=_,this.float32[k+3]=S,this.float32[k+4]=T,this.float32[k+5]=C,this.float32[k+6]=L,l}}o1.prototype.bytesPerElement=28,li(o1,"StructArrayLayout7f28");class kg extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k,F,V){const U=this.length;return this.resize(U+1),this.emplace(U,l,h,m,_,S,T,C,L,k,F,V)}emplace(l,h,m,_,S,T,C,L,k,F,V,U){const $=11*l;return this.float32[$+0]=h,this.float32[$+1]=m,this.float32[$+2]=_,this.float32[$+3]=S,this.float32[$+4]=T,this.float32[$+5]=C,this.float32[$+6]=L,this.float32[$+7]=k,this.float32[$+8]=F,this.float32[$+9]=V,this.float32[$+10]=U,l}}kg.prototype.bytesPerElement=44,li(kg,"StructArrayLayout11f44");class s1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k){const F=this.length;return this.resize(F+1),this.emplace(F,l,h,m,_,S,T,C,L,k)}emplace(l,h,m,_,S,T,C,L,k,F){const V=9*l;return this.float32[V+0]=h,this.float32[V+1]=m,this.float32[V+2]=_,this.float32[V+3]=S,this.float32[V+4]=T,this.float32[V+5]=C,this.float32[V+6]=L,this.float32[V+7]=k,this.float32[V+8]=F,l}}s1.prototype.bytesPerElement=36,li(s1,"StructArrayLayout9f36");class Bc extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const _=2*l;return this.float32[_+0]=h,this.float32[_+1]=m,l}}Bc.prototype.bytesPerElement=8,li(Bc,"StructArrayLayout2f8");class l1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,_){const S=this.length;return this.resize(S+1),this.emplace(S,l,h,m,_)}emplace(l,h,m,_,S){const T=6*l;return this.uint32[3*l+0]=h,this.uint16[T+2]=m,this.uint16[T+3]=_,this.uint16[T+4]=S,l}}l1.prototype.bytesPerElement=12,li(l1,"StructArrayLayout1ul3ui12");class O_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint16[1*l+0]=h,l}}O_.prototype.bytesPerElement=2,li(O_,"StructArrayLayout1ui2");class z_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et)}emplace(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt){const dt=16*l;return this.float32[dt+0]=h,this.float32[dt+1]=m,this.float32[dt+2]=_,this.float32[dt+3]=S,this.float32[dt+4]=T,this.float32[dt+5]=C,this.float32[dt+6]=L,this.float32[dt+7]=k,this.float32[dt+8]=F,this.float32[dt+9]=V,this.float32[dt+10]=U,this.float32[dt+11]=$,this.float32[dt+12]=Z,this.float32[dt+13]=Q,this.float32[dt+14]=et,this.float32[dt+15]=nt,l}}z_.prototype.bytesPerElement=64,li(z_,"StructArrayLayout16f64");class Cf extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,_,S,T,C){const L=this.length;return this.resize(L+1),this.emplace(L,l,h,m,_,S,T,C)}emplace(l,h,m,_,S,T,C,L){const k=10*l,F=5*l;return this.uint16[k+0]=h,this.uint16[k+1]=m,this.uint16[k+2]=_,this.uint16[k+3]=S,this.float32[F+2]=T,this.float32[F+3]=C,this.float32[F+4]=L,l}}Cf.prototype.bytesPerElement=20,li(Cf,"StructArrayLayout4ui3f20");class u1 extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.int16[1*l+0]=h,l}}u1.prototype.bytesPerElement=2,li(u1,"StructArrayLayout1i2");class B_ extends In{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint8[1*l+0]=h,l}}B_.prototype.bytesPerElement=1,li(B_,"StructArrayLayout1ub1");class c1 extends Rg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}c1.prototype.size=40;class FT extends r1{get(l){return new c1(this,l)}}li(FT,"CollisionBoxArray");class F_ extends Rg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(l){this._structArray.uint8[this._pos1+49]=l}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(l){this._structArray.uint8[this._pos1+50]=l}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(l){this._structArray.uint32[this._pos4+13]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(l){this._structArray.uint8[this._pos1+58]=l}}F_.prototype.size=60;class Og extends If{get(l){return new F_(this,l)}}li(Og,"PlacedSymbolArray");class h1 extends Rg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(l){this._structArray.uint32[this._pos4+14]=l}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(l){this._structArray.float32[this._pos4+18]=l}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}h1.prototype.size=80;class NT extends n1{get(l){return new h1(this,l)}}li(NT,"SymbolInstanceArray");class d1 extends qu{getoffsetX(l){return this.float32[1*l+0]}}li(d1,"GlyphOffsetArray");class VT extends hs{getx(l){return this.int16[2*l+0]}gety(l){return this.int16[2*l+1]}}li(VT,"SymbolLineVertexArray");class N_ extends Rg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}N_.prototype.size=12;class UT extends l1{get(l){return new N_(this,l)}}li(UT,"FeatureIndexArray");class GT extends Al{geta_centroid_pos0(l){return this.uint16[2*l+0]}geta_centroid_pos1(l){return this.uint16[2*l+1]}}li(GT,"FillExtrusionCentroidArray");class HT extends Rg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}HT.prototype.size=6;class jT extends jh{get(l){return new HT(this,l)}}li(jT,"FillExtrusionWallArray");const WT=gr([{name:"a_pos",components:2,type:"Int16"}],4),dD=gr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),fD=gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Un{constructor(l=[]){this.segments=l}_prepareSegment(l,h,m,_){let S=this.segments[this.segments.length-1];return l>Un.MAX_VERTEX_ARRAY_LENGTH&&Mi(`Max vertices per segment is ${Un.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!S||S.vertexLength+l>Un.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==_)&&(S={vertexOffset:h,primitiveOffset:m,vertexLength:0,primitiveLength:0},_!==void 0&&(S.sortKey=_),this.segments.push(S)),S}prepareSegment(l,h,m,_){return this._prepareSegment(l,h.length,m.length,_)}get(){return this.segments}destroy(){for(const l of this.segments)for(const h in l.vaos)l.vaos[h].destroy()}static simpleSegment(l,h,m,_){return new Un([{vertexOffset:l,primitiveOffset:h,vertexLength:m,primitiveLength:_,vaos:{},sortKey:0}])}}function $T(d,l){return 256*(d=lt(Math.floor(d),0,255))+lt(Math.floor(l),0,255)}Un.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,li(Un,"SegmentVector");const pD=gr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),gD=gr([{name:"a_pattern_b",components:4,type:"Uint16"}]),mD=gr([{name:"a_dash",components:4,type:"Uint16"}]);class zg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(l,h,m,_){this.ids.push(Bg(l)),this.positions.push(h,m,_)}eachPosition(l,h){const m=Bg(l);let _=0,S=this.ids.length-1;for(;_<S;){const T=_+S>>1;this.ids[T]>=m?S=T:_=T+1}for(;this.ids[_]===m;)h(this.positions[3*_],this.positions[3*_+1],this.positions[3*_+2]),_++}static serialize(l,h){const m=new Float64Array(l.ids),_=new Uint32Array(l.positions);return f1(m,_,0,m.length-1),h&&(h.add(m.buffer),h.add(_.buffer)),{ids:m,positions:_}}static deserialize(l){const h=new zg;let m;h.ids=l.ids,h.positions=l.positions;for(const _ of h.ids)_!==m&&h.uniqueIds.push(_),m=_;return h.indexed=!0,h}}function Bg(d){const l=+d;return Number.isSafeInteger(l)?l:sg(String(d))}function f1(d,l,h,m){for(;h<m;){const _=d[h+m>>1];let S=h-1,T=m+1;for(;;){do S++;while(d[S]<_);do T--;while(d[T]>_);if(S>=T)break;V_(d,S,T),V_(l,3*S,3*T),V_(l,3*S+1,3*T+1),V_(l,3*S+2,3*T+2)}T-h<m-T?(f1(d,l,h,T),h=T+1):(f1(d,l,T+1,m),m=T)}}function V_(d,l,h){const m=d[l];d[l]=d[h],d[h]=m}li(zg,"FeaturePositionMap");class Il{constructor(l){this.gl=l.gl,this.initialized=!1}fetchUniformLocation(l,h){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(l,h),this.initialized=!0),!!this.location}set(l,h,m){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class U_ extends Il{constructor(l){super(l),this.current=0}set(l,h,m){this.fetchUniformLocation(l,h)&&this.current!==m&&(this.current=m,this.gl.uniform1i(this.location,m))}}class va extends Il{constructor(l){super(l),this.current=0}set(l,h,m){this.fetchUniformLocation(l,h)&&this.current!==m&&(this.current=m,this.gl.uniform1f(this.location,m))}}class du extends Il{constructor(l){super(l),this.current=[0,0]}set(l,h,m){this.fetchUniformLocation(l,h)&&(m[0]===this.current[0]&&m[1]===this.current[1]||(this.current=m,this.gl.uniform2f(this.location,m[0],m[1])))}}class Mf extends Il{constructor(l){super(l),this.current=[0,0,0]}set(l,h,m){this.fetchUniformLocation(l,h)&&(m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]||(this.current=m,this.gl.uniform3f(this.location,m[0],m[1],m[2])))}}class Fg extends Il{constructor(l){super(l),this.current=[0,0,0,0]}set(l,h,m){this.fetchUniformLocation(l,h)&&(m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]&&m[3]===this.current[3]||(this.current=m,this.gl.uniform4f(this.location,m[0],m[1],m[2],m[3])))}}class p1 extends Il{constructor(l){super(l),this.current=Xr.transparent.toPremultipliedRenderColor(null)}set(l,h,m){this.fetchUniformLocation(l,h)&&(m.r===this.current.r&&m.g===this.current.g&&m.b===this.current.b&&m.a===this.current.a||(this.current=m,this.gl.uniform4f(this.location,m.r,m.g,m.b,m.a)))}}const ZT=new Float32Array(16);class Ng extends Il{constructor(l){super(l),this.current=ZT}set(l,h,m){if(this.fetchUniformLocation(l,h)){if(m[12]!==this.current[12]||m[0]!==this.current[0])return this.current=m,void this.gl.uniformMatrix4fv(this.location,!1,m);for(let _=1;_<16;_++)if(m[_]!==this.current[_]){this.current=m,this.gl.uniformMatrix4fv(this.location,!1,m);break}}}}const vD=new Float32Array(9),qT=new Float32Array(4);class g1 extends Il{constructor(l){super(l),this.current=qT}set(l,h,m){if(this.fetchUniformLocation(l,h)){for(let _=0;_<4;_++)if(m[_]!==this.current[_]){this.current=m,this.gl.uniformMatrix2fv(this.location,!1,m);break}}}}function m1(d){return[$T(255*d.r,255*d.g),$T(255*d.b,255*d.a)]}function G_(d,l,h,m,_,S,T,C){return!!d&&(d.kind==="composite"||d.kind==="source"?d.evaluate(new xn(0,{brightness:S,worldview:C}),l,h,_,m,T)==="none":d.value==="none")}class H_{constructor(l,h,m,_){this.value=l,this.uniformNames=h.map(S=>`u_${S}`),this.type=m,this.context=_}setUniform(l,h,m,_,S){const T=_.constantOr(this.value);h.set(l,S,T instanceof Xr?T.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):T)}getBinding(l,h){return this.type==="color"?new p1(l):new va(l)}}class Vg{constructor(l,h){this.uniformNames=h.map(m=>`u_${m}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(l,h){this.pixelRatio=l.pixelRatio||1,this.pattern=l.tl.concat(l.br),this.patternTransition=h?h.tl.concat(h.br):this.pattern}setUniform(l,h,m,_,S){let T=null;S!=="u_pattern"&&S!=="u_dash"||(T=this.pattern),S==="u_pattern_b"&&(T=this.patternTransition),S==="u_pixel_ratio"&&(T=this.pixelRatio),T&&h.set(l,S,T)}getBinding(l,h){return h==="u_pattern"||h==="u_pattern_b"||h==="u_dash"?new Fg(l):new va(l)}}class Xu{constructor(l,h,m,_){this.expression=l,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(l,h,m,_,S,T,C,L){const k=this.paintVertexArray.length,F=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new xn(0,{brightness:T,worldview:L}),h,{},S,_,C):this.expression.kind==="constant"&&this.expression.value,V=G_(this.lutExpression,h,{},_,S,T,C,L);this.paintVertexArray.resize(l),this._setPaintValue(k,l,F,V?null:this.context.lut)}updatePaintArray(l,h,m,_,S,T,C,L){const k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:C,worldview:L},m,_,void 0,S):this.expression.kind==="constant"&&this.expression.value,F=G_(this.lutExpression,m,_,S,void 0,C,void 0,L);this._setPaintValue(l,h,k,F?null:this.context.lut)}_setPaintValue(l,h,m,_){if(this.type==="color"){const S=m1(m.toPremultipliedRenderColor(_));for(let T=l;T<h;T++)this.paintVertexArray.emplace(T,S[0],S[1])}else{for(let S=l;S<h;S++)this.paintVertexArray.emplace(S,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nl{constructor(l,h,m,_,S,T){this.expression=l,this.uniformNames=h.map(C=>`u_${C}_t`),this.type=m,this.useIntegerZoom=_,this.context=S,this.maxValue=0,this.paintVertexAttributes=h.map(C=>({name:`a_${C}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(l,h,m,_,S,T,C,L){const k=this.expression.evaluate(new xn(this.context.zoom,{brightness:T,worldview:L}),h,{},S,_,C),F=this.expression.evaluate(new xn(this.context.zoom+1,{brightness:T,worldview:L}),h,{},S,_,C),V=G_(this.lutExpression,h,{},_,S,T,C,L),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,k,F,V?null:this.context.lut)}updatePaintArray(l,h,m,_,S,T,C,L){const k=this.expression.evaluate({zoom:this.context.zoom,brightness:C,worldview:L},m,_,void 0,S),F=this.expression.evaluate({zoom:this.context.zoom+1,brightness:C,worldview:L},m,_,void 0,S),V=G_(this.lutExpression,m,_,S,void 0,C,void 0,L);this._setPaintValue(l,h,k,F,V?null:this.context.lut)}_setPaintValue(l,h,m,_,S){if(this.type==="color"){const T=m1(m.toPremultipliedRenderColor(S)),C=m1(m.toPremultipliedRenderColor(S));for(let L=l;L<h;L++)this.paintVertexArray.emplace(L,T[0],T[1],C[0],C[1])}else{for(let T=l;T<h;T++)this.paintVertexArray.emplace(T,m,_);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(_))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,h,m,_,S){const T=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,C=lt(this.expression.interpolationFactor(T,this.context.zoom,this.context.zoom+1),0,1);h.set(l,S,C)}getBinding(l,h){return new va(l)}}class Mo{constructor(l,h,m,_,S){this.expression=l,this.layerId=S,this.paintVertexAttributes=(m==="array"?mD:pD).members;for(let T=0;T<h.length;++T);this.paintVertexArray=new _,this.paintTransitionVertexArray=new Wh}populatePaintArray(l,h,m,_){const S=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValues(S,l,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(l,h,m,_,S,T,C){this._setPaintValues(l,h,m.patterns&&m.patterns[this.layerId],T)}_setPaintValues(l,h,m,_){if(!_||!m)return;const S=_[m[0]],T=_[m[1]];if(S){if(S){const{tl:C,br:L,pixelRatio:k}=S;for(let F=l;F<h;F++)this.paintVertexArray.emplace(F,C[0],C[1],L[0],L[1],k)}if(T){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:C,br:L}=T;for(let k=l;k<h;k++)this.paintTransitionVertexArray.emplace(k,C[0],C[1],L[0],L[1])}}}upload(l){const h=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,h)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=l.createVertexBuffer(this.paintTransitionVertexArray,gD.members,h))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Yu{constructor(l,h,m=()=>!0){this.binders={},this._buffers=[],this.context=h;const _=[];for(const S in l.paint._values){const T=l.paint.get(S);if(S.endsWith("-use-theme")||!m(S)||!(T instanceof Tl&&m_(T.property.specification)))continue;const C=yD(S,l.type),L=T.value,k=T.property.specification.type,F=!!T.property.useIntegerZoom,V=S==="line-dasharray"||S.endsWith("pattern"),U=l.paint.get(`${S}-use-theme`),$=S==="line-dasharray"&&l.layout.get("line-cap").value.kind!=="constant"||U&&U.value.kind!=="constant";if(L.kind!=="constant"||$)if(L.kind==="source"||$||V){const Z=v1(S,k,"source");this.binders[S]=V?new Mo(L,C,k,Z,l.id):new Xu(L,C,k,Z),_.push(`/a_${S}`)}else{const Z=v1(S,k,"composite");this.binders[S]=new Nl(L,C,k,F,h,Z),_.push(`/z_${S}`)}else this.binders[S]=V?new Vg(L.value,C):new H_(L.value,C,k,h),_.push(`/u_${S}`);U&&(this.binders[S].lutExpression=U.value)}this.cacheKey=_.sort().join("")}getMaxValue(l){const h=this.binders[l];return h instanceof Xu||h instanceof Nl?h.maxValue:0}populatePaintArrays(l,h,m,_,S,T,C,L){for(const k in this.binders){const F=this.binders[k];F.context=this.context,(F instanceof Xu||F instanceof Nl||F instanceof Mo)&&F.populatePaintArray(l,h,m,_,S,T,C,L)}}setConstantPatternPositions(l,h){for(const m in this.binders){const _=this.binders[m];_ instanceof Vg&&_.setConstantPatternPositions(l,h)}}getPatternTransitionVertexBuffer(l){const h=this.binders[l];return h instanceof Mo?h.paintTransitionVertexBuffer:null}updatePaintArrays(l,h,m,_,S,T,C,L,k,F){let V=!1;const U=Object.keys(l),$=U.length!==0&&!L,Z=$?U:h.uniqueIds;this.context.lut=S.lut;for(const Q in this.binders){const et=this.binders[Q];if(et.context=this.context,(et instanceof Xu||et instanceof Nl||et instanceof Mo)&&et.expression&&et.expression.kind&&et.expression.kind!=="constant"&&(et.expression.isStateDependent===!0||et.expression.isLightConstant===!1)){const nt=S.paint.get(Q);et.expression=nt.value;for(const dt of Z){const mt=l[dt.toString()];h.eachPosition(dt,(yt,Lt,It)=>{const Ot=_.feature(yt);et.updatePaintArray(Lt,It,Ot,mt,T,C,k,F)})}if(!$)for(const dt of m.uniqueIds){const mt=l[dt.toString()];m.eachPosition(dt,(yt,Lt,It)=>{const Ot=_.feature(yt);et.updatePaintArray(Lt,It,Ot,mt,T,C,k,F)})}V=!0}}return V}defines(){const l=[];for(const h in this.binders){const m=this.binders[h];(m instanceof H_||m instanceof Vg)&&l.push(...m.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l){const h=[];for(const m in this.binders){const _=this.binders[m];if(_ instanceof H_||_ instanceof Vg||_ instanceof Nl)for(const S of _.uniformNames)h.push({name:S,property:m,binding:_.getBinding(l,S)})}return h}setUniforms(l,h,m,_,S){for(const{name:T,property:C,binding:L}of m)this.binders[C].setUniform(l,L,S,_.get(C),T)}updatePaintBuffers(){this._buffers=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Xu||h instanceof Nl||h instanceof Mo)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer),h instanceof Mo&&h.paintTransitionVertexBuffer&&this._buffers.push(h.paintTransitionVertexBuffer)}}upload(l){for(const h in this.binders){const m=this.binders[h];(m instanceof Xu||m instanceof Nl||m instanceof Mo)&&m.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const h=this.binders[l];(h instanceof Xu||h instanceof Nl||h instanceof Mo)&&h.destroy()}}}class Vl{constructor(l,h,m=()=>!0){this.programConfigurations={};for(const _ of l)this.programConfigurations[_.id]=new Yu(_,h,m);this.needsUpload=!1,this._featureMap=new zg,this._featureMapWithoutIds=new zg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(l,h,m,_,S,T,C,L,k){for(const F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(l,h,_,S,T,C,L,k);h.id!==void 0?this._featureMap.add(h.id,m,this._bufferOffset,l):(this._featureMapWithoutIds.add(this._idlessCounter,m,this._bufferOffset,l),this._idlessCounter+=1),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,h,m,_,S,T,C,L){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(l,this._featureMap,this._featureMapWithoutIds,h,k,_,S,T,C||0,L)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}const _D={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function yD(d,l){return _D[d]||[d.replace(`${l}-`,"").replace(/-/g,"_")]}const xD={"line-pattern":{source:Oc,composite:Oc},"fill-pattern":{source:Oc,composite:Oc},"fill-extrusion-pattern":{source:Oc,composite:Oc},"line-dasharray":{source:Wh,composite:Wh}},bD={color:{source:Bc,composite:zc},number:{source:qu,composite:Bc}};function v1(d,l,h){const m=xD[d];return m&&m[h]||bD[l][h]}li(H_,"ConstantBinder"),li(Vg,"PatternConstantBinder"),li(Xu,"SourceExpressionBinder"),li(Mo,"PatternCompositeBinder"),li(Nl,"CompositeExpressionBinder"),li(Yu,"ProgramConfiguration",{omit:["_buffers"]}),li(Vl,"ProgramConfigurationSet");const ds=Ve/Math.PI/2,x=5,u=6,p=16383,b=64,A=[b,32,16],M=-ds,P=ds;function O(d,l,h,m=ds){return h=wr(h),[d*Math.sin(h)*m,-l*m,d*Math.cos(h)*m]}function B(d,l,h){return O(Math.cos(wr(d)),Math.sin(wr(d)),l,h)}const G=63710088e-1,j=2*Math.PI*G;class X{constructor(l,h){if(isNaN(l)||isNaN(h))throw new Error(`Invalid LngLat object: (${l}, ${h})`);if(this.lng=+l,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new X(Nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const h=Math.PI/180,m=this.lat*h,_=l.lat*h,S=Math.sin(m)*Math.sin(_)+Math.cos(m)*Math.cos(_)*Math.cos((l.lng-this.lng)*h);return G*Math.acos(Math.min(S,1))}toBounds(l=0){const h=360*l/40075017,m=h/Math.cos(Math.PI/180*this.lat);return new W({lng:this.lng-m,lat:this.lat-h},{lng:this.lng+m,lat:this.lat+h})}toEcef(l){return B(this.lat,this.lng,ds+l*ds/G)}static convert(l){if(l instanceof X)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new X(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new X(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class W{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1]))}setNorthEast(l){return this._ne=l instanceof X?new X(l.lng,l.lat):X.convert(l),this}setSouthWest(l){return this._sw=l instanceof X?new X(l.lng,l.lat):X.convert(l),this}extend(l){const h=this._sw,m=this._ne;let _,S;if(l instanceof X)_=l,S=l;else{if(!(l instanceof W))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(W.convert(l)):this.extend(X.convert(l)):typeof l=="object"&&l!==null&&l.hasOwnProperty("lat")&&(l.hasOwnProperty("lon")||l.hasOwnProperty("lng"))?this.extend(X.convert(l)):this;if(_=l._sw,S=l._ne,!_||!S)return this}return h||m?(h.lng=Math.min(_.lng,h.lng),h.lat=Math.min(_.lat,h.lat),m.lng=Math.max(S.lng,m.lng),m.lat=Math.max(S.lat,m.lat)):(this._sw=new X(_.lng,_.lat),this._ne=new X(S.lng,S.lat)),this}getCenter(){return new X((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new X(this.getWest(),this.getNorth())}getSouthEast(){return new X(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:m}=X.convert(l);let _=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_}static convert(l){if(l)return l instanceof W?l:new W(l)}}const K=0,tt=25.5;function rt(d){return j*Math.cos(d*Math.PI/180)}function ht(d){return(180+d)/360}function st(d){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+d*Math.PI/360)))/360}function gt(d,l){return d/rt(l)}function xt(d){return 360*d-180}function vt(d){return 360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90}function Pt(d,l){return d*rt(vt(l))}const wt=85.051129;function Rt(d){return Math.cos(wr(lt(d,-wt,wt)))}function Mt(d,l){const h=lt(l,K,tt),m=Math.pow(2,h);return Rt(d)*j/(512*m)}function At(d){return 1/Math.cos(d*Math.PI/180)}function kt(d,l=0){const h=Math.exp(Math.PI*(1-(d.y+l/Ve)/(1<<d.z)*2));return 80150034*h/(h*h+1)/Ve/(1<<d.z)}class qt{constructor(l,h,m=0){this.x=+l,this.y=+h,this.z=+m}static fromLngLat(l,h=0){const m=X.convert(l);return new qt(ht(m.lng),st(m.lat),gt(h,m.lat))}toLngLat(){return new X(xt(this.x),vt(this.y))}toAltitude(){return Pt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/j*At(vt(this.y))}}function jt(d,l,h,m,_,S,T,C,L){const k=(l+m)/2,F=(h+_)/2,V=new Me(k,F);C(V),function(U,$,Z,Q,et,nt){const dt=Z-et,mt=Q-nt;return Math.abs((Q-$)*dt-(Z-U)*mt)/Math.hypot(dt,mt)}(V.x,V.y,S.x,S.y,T.x,T.y)>=L?(jt(d,l,h,k,F,S,V,C,L),jt(d,k,F,m,_,V,T,C,L)):d.push(T)}function oe(d,l,h){let m=d[0],_=m.x,S=m.y;l(m);const T=[m];for(let C=1;C<d.length;C++){const L=d[C],{x:k,y:F}=L;l(L),jt(T,_,S,k,F,m,L,l,h),_=k,S=F,m=L}return T}function te(d,l,h,m){if(m(l,h)){const _=l.add(h)._mult(.5);te(d,l,_,m),te(d,_,h,m)}else d.push(h)}function fe(d,l){let h=d[0];const m=[h];for(let _=1;_<d.length;_++){const S=d[_];te(m,h,S,l),h=S}return m}const ze=Math.pow(2,14)-1,Qt=-ze-1;function Gt(d,l){const h=Math.round(d.x*l),m=Math.round(d.y*l);return d.x=lt(h,Qt,ze),d.y=lt(m,Qt,ze),(h<d.x||h>d.x+1||m<d.y||m>d.y+1)&&Mi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),d}function pe(d,l,h){const m=d.loadGeometry(),_=d.extent,S=Ve/_;if(l&&h&&h.projection.isReprojectedInTileSpace){const T=1<<l.z,{scale:C,x:L,y:k,projection:F}=h,V=U=>{const $=xt((l.x+U.x/_)/T),Z=vt((l.y+U.y/_)/T),Q=F.project($,Z);U.x=(Q.x*C-L)*_,U.y=(Q.y*C-k)*_};for(let U=0;U<m.length;U++)if(d.type!==1)m[U]=oe(m[U],V,1);else{const $=[];for(const Z of m[U])Z.x<0||Z.x>=_||Z.y<0||Z.y>=_||(V(Z),$.push(Z));m[U]=$}}for(const T of m)for(const C of T)Gt(C,S);return m}function ee(d,l){return{type:d.type,id:d.id,properties:d.properties,geometry:l?pe(d):[]}}class Ae{constructor(l,h,m,_,S){this.properties={},this.extent=m,this.type=0,this.id=void 0,this._pbf=l,this._geometry=-1,this._keys=_,this._values=S,l.readFields(Ge,this,h)}loadGeometry(){const l=this._pbf;l.pos=this._geometry;const h=l.readVarint()+l.pos,m=[];let _,S=1,T=0,C=0,L=0;for(;l.pos<h;){if(T<=0){const k=l.readVarint();S=7&k,T=k>>3}if(T--,S===1||S===2)C+=l.readSVarint(),L+=l.readSVarint(),S===1&&(_&&m.push(_),_=[]),_&&_.push(new Me(C,L));else{if(S!==7)throw new Error(`unknown command ${S}`);_&&_.push(_[0].clone())}}return _&&m.push(_),m}bbox(){const l=this._pbf;l.pos=this._geometry;const h=l.readVarint()+l.pos;let m=1,_=0,S=0,T=0,C=1/0,L=-1/0,k=1/0,F=-1/0;for(;l.pos<h;){if(_<=0){const V=l.readVarint();m=7&V,_=V>>3}if(_--,m===1||m===2)S+=l.readSVarint(),T+=l.readSVarint(),S<C&&(C=S),S>L&&(L=S),T<k&&(k=T),T>F&&(F=T);else if(m!==7)throw new Error(`unknown command ${m}`)}return[C,k,L,F]}toGeoJSON(l,h,m){const _=this.extent*Math.pow(2,m),S=this.extent*l,T=this.extent*h,C=this.loadGeometry();function L(U){return[360*(U.x+S)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+T)/_)*Math.PI))-90]}function k(U){return U.map(L)}let F;if(this.type===1){const U=[];for(const Z of C)U.push(Z[0]);const $=k(U);F=U.length===1?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$}}else if(this.type===2){const U=C.map(k);F=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=function(Z){const Q=Z.length;if(Q<=1)return[Z];const et=[];let nt,dt;for(let mt=0;mt<Q;mt++){const yt=ui(Z[mt]);yt!==0&&(dt===void 0&&(dt=yt<0),dt===yt<0?(nt&&et.push(nt),nt=[Z[mt]]):nt&&nt.push(Z[mt]))}return nt&&et.push(nt),et}(C),$=[];for(const Z of U)$.push(Z.map(k));F=$.length===1?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$}}}const V={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(V.id=this.id),V}}function Ge(d,l,h){d===1?l.id=h.readVarint():d===2?function(m,_){const S=m.readVarint()+m.pos;for(;m.pos<S;){const T=_._keys[m.readVarint()],C=_._values[m.readVarint()];_.properties[T]=C}}(h,l):d===3?l.type=h.readVarint():d===4&&(l._geometry=h.pos)}function ui(d){let l=0;for(let h,m,_=0,S=d.length,T=S-1;_<S;T=_++)h=d[_],m=d[T],l+=(m.x-h.x)*(h.y+m.y);return l}Ae.types=["Unknown","Point","LineString","Polygon"];class Le{constructor(l,h){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(Fe,this,h),this.length=this._features.length}feature(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];const h=this._pbf.readVarint()+this._pbf.pos;return new Ae(this._pbf,h,this.extent,this._keys,this._values)}}function Fe(d,l,h){d===15?l.version=h.readVarint():d===1?l.name=h.readString():d===5?l.extent=h.readVarint():d===2?l._features.push(h.pos):d===3?l._keys.push(h.readString()):d===4&&l._values.push(function(m){let _=null;const S=m.readVarint()+m.pos;for(;m.pos<S;){const T=m.readVarint()>>3;_=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _}(h))}class hi{constructor(l,h){this.layers=l.readFields(ai,{},h)}}function ai(d,l,h){if(d===3){const m=new Le(h,h.readVarint()+h.pos);m.length&&(l[m.name]=m)}}const ii="3d_elevation_id",oi="level";class Di{constructor(){this._valid=!1}reset(l){return this.feature=l,this._valid=!0,this._geometry=l.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(l,h){return this._valid&&l(h(this._geometry)),this}require(l,h,m){return this.get(l,!0,h,m)}optional(l,h,m){return this.get(l,!1,h,m)}success(){return this._valid}get(l,h,m,_){const S=this.feature.properties.hasOwnProperty(l)?+this.feature.properties[l]:void 0;return this._valid&&S!==void 0&&!Number.isNaN(S)?m(_?_(S):S):h&&(this._valid=!1),this}}class mr{constructor(l,h){this.featureFunc=l,this.vertexFunc=h}parseFeature(l,h,m){return this.featureFunc(l,h,m)}parseVertex(l,h,m){return this.vertexFunc(l,h,m)}}const Ir=new mr((d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).optional("fixed_height_relative",m=>{h.constantHeight=m},Vi.decodeRelativeHeight).geometry(m=>{h.bounds=m},_g).success(),(d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).require("elevation_idx",m=>{h.idx=m}).require("extent",m=>{h.extent=m}).require("height_relative",m=>{h.height=m},Vi.decodeRelativeHeight).geometry(m=>{h.position=m},Vi.getPoint).success()),an=new mr((d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).optional("fixed_height",m=>{h.constantHeight=m},Vi.decodeMetricHeight).geometry(m=>{h.bounds=m},_g).success(),(d,l,h)=>d.reset(l).require(ii,m=>{h.id=m}).require("elevation_idx",m=>{h.idx=m}).require("extent",m=>{h.extent=m}).require("height",m=>{h.height=m},Vi.decodeMetricHeight).geometry(m=>{h.position=m},Vi.getPoint).success());class Vi{static getPoint(l){return ou(l[0][0].x,l[0][0].y)}static decodeRelativeHeight(l){return 1e-4*l*5}static decodeMetricHeight(l){return 1e-4*l}static getVersionSchema(l){return l?l==="1.0.1"?an:void 0:Ir}static parse(l){const h=[],m=[],_=l.length,S=new Di;for(let T=0;T<_;T++){const C=l.feature(T),L=C.properties.version,k=Vi.getVersionSchema(L);if(k===void 0){Mi(`Unknown elevation feature version number ${L||"(unknown)"}`);continue}const F=C.properties.type;if(!F)continue;const V=Ae.types[C.type];if(V==="Point"&&F==="curve_point"){const U={};k.parseVertex(S,C,U)&&h.push(U)}else if(V==="Polygon"&&F==="curve_meta"){const U={};k.parseFeature(S,C,U)&&m.push(U)}}return{vertices:h,features:m}}}class Tr{constructor(l,h){this.pos=l,this.dir=h}intersectsPlane(l,h,m){const _=Ch(h,this.dir);if(Math.abs(_)<1e-6)return!1;const S=((l[0]-this.pos[0])*h[0]+(l[1]-this.pos[1])*h[1])/_;return m[0]=this.pos[0]+this.dir[0]*S,m[1]=this.pos[1]+this.dir[1]*S,!0}}class ir{constructor(l,h){this.pos=l,this.dir=h}intersectsPlane(l,h,m){const _=Ke(h,this.dir);if(Math.abs(_)<1e-6)return!1;const S=((l[0]-this.pos[0])*h[0]+(l[1]-this.pos[1])*h[1]+(l[2]-this.pos[2])*h[2])/_;return m[0]=this.pos[0]+this.dir[0]*S,m[1]=this.pos[1]+this.dir[1]*S,m[2]=this.pos[2]+this.dir[2]*S,!0}closestPointOnSphere(l,h,m){if(function($,Z){var Q=$[0],et=$[1],nt=$[2],dt=Z[0],mt=Z[1],yt=Z[2];return Math.abs(Q-dt)<=c*Math.max(1,Math.abs(Q),Math.abs(dt))&&Math.abs(et-mt)<=c*Math.max(1,Math.abs(et),Math.abs(mt))&&Math.abs(nt-yt)<=c*Math.max(1,Math.abs(nt),Math.abs(yt))}(this.pos,l)||h===0)return m[0]=m[1]=m[2]=0,!1;const[_,S,T]=this.dir,C=this.pos[0]-l[0],L=this.pos[1]-l[1],k=this.pos[2]-l[2],F=_*_+S*S+T*T,V=2*(C*_+L*S+k*T),U=V*V-4*F*(C*C+L*L+k*k-h*h);if(U<0){const $=Math.max(-V/2,0),Z=C+_*$,Q=L+S*$,et=k+T*$,nt=Math.hypot(Z,Q,et);return m[0]=Z*h/nt,m[1]=Q*h/nt,m[2]=et*h/nt,!1}{const $=(-V-Math.sqrt(U))/(2*F);if($<0){const Z=Math.hypot(C,L,k);return m[0]=C*h/Z,m[1]=L*h/Z,m[2]=k*h/Z,!1}return m[0]=C+_*$,m[1]=L+S*$,m[2]=k+T*$,!0}}}class Qr{constructor(l,h,m,_,S){this.TL=l,this.TR=h,this.BR=m,this.BL=_,this.horizon=S}static fromInvProjectionMatrix(l,h,m){const _=[-1,1,1],S=[1,1,1],T=[1,-1,1],C=[-1,-1,1],L=Bt(_,_,l),k=Bt(S,S,l),F=Bt(T,T,l),V=Bt(C,C,l);return new Qr(L,k,F,V,h/m)}}function Cr(d,l,h){let m=1/0,_=-1/0;const S=[];for(const T of d){qe(S,T,l);const C=Ke(S,h);m=Math.min(m,C),_=Math.max(_,C)}return[m,_]}function pn(d,l){let h=!0;for(let m=0;m<d.planes.length;m++){const _=d.planes[m];let S=0;for(let T=0;T<l.length;T++)S+=+(Ke(_,l[T])+_[3]>=0);if(S===0)return 0;S!==l.length&&(h=!1)}return h?2:1}function Or(d,l){for(const h of d.projections){const m=Cr(l,d.points[0],h.axis);if(h.projection[1]<m[0]||h.projection[0]>m[1])return 0}return 1}function ar(d,l){let h=0;const m=[0,0,0,0];for(let T=0;T<d.length;T++)m[0]=d[T][0],m[1]=d[T][1],m[2]=d[T][2],m[3]=1,(_=m)[0]*(S=l)[0]+_[1]*S[1]+_[2]*S[2]+_[3]*S[3]>=0&&h++;var _,S;return h}class Gr{constructor(l,h){this.points=l||new Array(8).fill([0,0,0]),this.planes=h||new Array(6).fill([0,0,0,0]),this.bounds=ur.fromPoints(this.points),this.projections=[],this.frustumEdges=[qe([],this.points[2],this.points[3]),qe([],this.points[0],this.points[3]),qe([],this.points[4],this.points[0]),qe([],this.points[5],this.points[1]),qe([],this.points[6],this.points[2]),qe([],this.points[7],this.points[3])];for(const m of this.frustumEdges){const _=[0,-m[2],m[1]],S=[m[2],0,-m[0]];this.projections.push({axis:_,projection:Cr(this.points,this.points[0],_)}),this.projections.push({axis:S,projection:Cr(this.points,this.points[0],S)})}}static fromInvProjectionMatrix(l,h,m,_){const S=Math.pow(2,m),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const F=Li([],k,l),V=1/F[3]/h*S;return(U=F)[0]=($=F)[0]*(Z=[V,V,_?1/F[3]:V,V])[0],U[1]=$[1]*Z[1],U[2]=$[2]*Z[2],U[3]=$[3]*Z[3],U;var U,$,Z}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const F=xe([],We([],qe([],T[k[0]],T[k[1]]),qe([],T[k[2]],T[k[1]]))),V=-Ke(F,T[k[1]]);return F.concat(V)}),L=[];for(let k=0;k<T.length;k++)L.push([T[k][0],T[k][1],T[k][2]]);return new Gr(L,C)}intersectsPrecise(l,h,m){for(let _=0;_<h.length;_++)if(!ar(l,h[_]))return 0;for(let _=0;_<this.planes.length;_++)if(!ar(l,this.planes[_]))return 0;for(const _ of m)for(const S of this.frustumEdges){const T=We([],_,S),C=Et(T);if(C===0)continue;ke(T,T,1/C);const L=Cr(this.points,this.points[0],T),k=Cr(l,this.points[0],T);if(L[0]>k[1]||k[0]>L[1])return 0}return 1}containsPoint(l){for(const h of this.planes){const m=h[3];if(Ke([h[0],h[1],h[2]],l)+m<0)return!1}return!0}}class ur{static fromPoints(l){const h=[1/0,1/0,1/0],m=[-1/0,-1/0,-1/0];for(const _ of l)be(h,h,_),ve(m,m,_);return new ur(h,m)}static fromTileIdAndHeight(l,h,m){const _=1<<l.canonical.z,S=l.canonical.x,T=l.canonical.y;return new ur([S/_,T/_,h],[(S+1)/_,(T+1)/_,m])}static applyTransform(l,h){const m=l.getCorners();for(let _=0;_<m.length;++_)Bt(m[_],m[_],h);return ur.fromPoints(m)}static applyTransformFast(l,h){const m=[h[12],h[13],h[14]],_=[...m];for(let S=0;S<3;S++)for(let T=0;T<3;T++){const C=h[4*T+S],L=C*l.min[T],k=C*l.max[T];m[S]+=Math.min(L,k),_[S]+=Math.max(L,k)}return new ur(m,_)}static projectAabbCorners(l,h){const m=l.getCorners();for(let _=0;_<m.length;++_)Bt(m[_],m[_],h);return m}constructor(l,h){this.min=l,this.max=h,this.center=ke([],zt([],this.min,this.max),.5)}quadrant(l){const h=[l%2==0,l<2],m=Dt(this.min),_=Dt(this.max);for(let S=0;S<h.length;S++)m[S]=h[S]?this.min[S]:this.center[S],_[S]=h[S]?this.center[S]:this.max[S];return _[2]=this.max[2],new ur(m,_)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}distanceZ(l){return Math.max(Math.min(this.max[2],l[2]),this.min[2])-l[2]}getCorners(){const l=this.min,h=this.max;return[[l[0],l[1],l[2]],[h[0],l[1],l[2]],[h[0],h[1],l[2]],[l[0],h[1],l[2]],[l[0],l[1],h[2]],[h[0],l[1],h[2]],[h[0],h[1],h[2]],[l[0],h[1],h[2]]]}intersects(l){return this.intersectsAabb(l.bounds)?pn(l,this.getCorners()):0}intersectsFlat(l){return this.intersectsAabb(l.bounds)?pn(l,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(l,h){return h||this.intersects(l)?Or(l,this.getCorners()):0}intersectsPreciseFlat(l,h){return h||this.intersectsFlat(l)?Or(l,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(l){for(let h=0;h<3;++h)if(this.min[h]>l.max[h]||l.min[h]>this.max[h])return!1;return!0}intersectsAabbXY(l){return!(this.min[0]>l.max[0]||l.min[0]>this.max[0]||this.min[1]>l.max[1]||l.min[1]>this.max[1])}encapsulate(l){for(let h=0;h<3;h++)this.min[h]=Math.min(this.min[h],l.min[h]),this.max[h]=Math.max(this.max[h],l.max[h])}encapsulatePoint(l){for(let h=0;h<3;h++)this.min[h]=Math.min(this.min[h],l[h]),this.max[h]=Math.max(this.max[h],l[h])}closestPoint(l){return[Math.max(Math.min(this.max[0],l[0]),this.min[0]),Math.max(Math.min(this.max[1],l[1]),this.min[1]),Math.max(Math.min(this.max[2],l[2]),this.min[2])]}}li(ur,"Aabb");class wn{constructor(l,h){this.feature=l,this.metersToTile=h,this.index=0}get(){const l=this.feature.vertices[this.index],h=this.feature.vertexProps[this.index].dir,m=h[1],_=-h[0],S=(l.extent+1)*this.metersToTile;return[new Me(Math.trunc(l.position[0]+m*S),Math.trunc(l.position[1]+_*S)),new Me(Math.trunc(l.position[0]-m*S),Math.trunc(l.position[1]-_*S))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Zr{constructor(l,h,m,_,S,T){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Qn(),Qn(),Qn(),Qn(),Qn(),Qn(),Qn()],this.id=l,this.heightRange={min:m,max:m},this.safeArea=h,this.constantHeight=m,this.constantHeight==null&&(this.constantHeight!=null||_.length!==0)){this.vertices=_,this.edges=S,this.edges=this.edges.filter(C=>{return C.a<this.vertices.length&&C.b<this.vertices.length&&!((L=this.vertices[C.a].position)[0]===(k=this.vertices[C.b].position)[0]&&L[1]===k[1]);var L,k}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const C of this.vertices)this.vertexProps.push({dir:ou(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,C.height),this.heightRange.max=Math.max(this.heightRange.max,C.height);for(const C of this.edges){const L=this.vertices[C.a].position,k=this.vertices[C.b].position,F=xs(Qn(),k,L),V=jn(F),U=ls(Qn(),F,1/V);this.edgeProps.push({vec:F,dir:U,len:V});const $=this.vertexProps[C.a].dir,Z=this.vertexProps[C.b].dir;to($,$,U),to(Z,Z,U)}for(const C of this.vertexProps)C.dir[0]===0&&C.dir[1]===0||Co(C.dir,C.dir);this.tessellate(T)}}pointElevation(l){if(this.constantHeight!=null)return this.constantHeight;const h=this.getClosestEdge(l);if(h==null)return 0;const[m,_]=h;return zi(this.vertices[this.edges[m].a].height,this.vertices[this.edges[m].b].height,_)}computeSlopeNormal(l,h){const m=this.getClosestEdge(l);if(!m)return bt(0,0,1);const _=m[0],S=this.edges[_],T=this.edgeProps[_].vec,C=bt(T[0],T[1],(this.vertices[S.b].height-this.vertices[S.a].height)*h),L=bt(C[1],-C[0],0);We(L,L,C);const k=Et(L);return k>0?ke(L,L,1/k):Vt(L,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(l){if(this.edges.length===0)return;let h=0,m=Number.POSITIVE_INFINITY,_=0;const[S,T,C,L,k,F,V]=this._tmpVec2;Qa(V,l.x,l.y);const U=new Tr(V,null);for(let $=0;$<this.edges.length;$++){const Z=this.edges[$],Q=this.edgeProps[$].dir;U.dir=Q;const et=this.vertices[Z.a].position,nt=this.vertices[Z.b].position,dt=U.intersectsPlane(et,this.vertexProps[Z.a].dir,S),mt=U.intersectsPlane(nt,this.vertexProps[Z.b].dir,T);if(!dt||!mt)continue;xs(C,T,S),xs(L,V,S);const yt=Ch(C,C),Lt=yt>0?Ch(L,C)/yt:0,It=lt(Lt,0,1),Ot=Math.abs((Lt-It)*this.edgeProps[$].len);xs(k,V,et),Qa(F,Q[1],-Q[0]);const Ut=Ot+Math.abs(Ch(k,F));Ut<m&&(h=$,m=Ut,_=It)}return[h,_]}tessellate(l){const h=ct(),m=ct(),_=ct(),S=ct();for(let T=this.edges.length-1;T>=0;--T){const C=this.edges[T].a,L=this.edges[T].b,{position:k,height:F,extent:V}=this.vertices[C],{position:U,height:$,extent:Z}=this.vertices[L],Q=this.vertexProps[C].dir,et=this.vertexProps[L].dir;if(Vt(h,k[0]/l,k[1]/l,F),Vt(m,U[0]/l,U[1]/l,$),Vt(_,Q[1],-Q[0],0),ke(_,_,V),Vt(S,et[1],-et[0],0),ke(S,S,Z),this.distSqLines(bt(h[0]+.5*_[0],h[1]+.5*_[1],h[2]+.5*_[2]),bt(m[0]-.5*S[0],m[1]-.5*S[1],m[2]-.5*S[2]),bt(h[0]-.5*_[0],h[1]-.5*_[1],h[2]-.5*_[2]),bt(m[0]+.5*S[0],m[1]+.5*S[1],m[2]+.5*S[2]))<=.0025000000000000005)continue;const nt=this.vertices.length,dt=to(Qn(),k,U);this.vertices.push({position:ls(dt,dt,.5),height:.5*(F+$),extent:.5*(V+Z)});const mt=to(Qn(),Q,et);this.vertexProps.push({dir:Co(mt,mt)}),this.edges.splice(T,1),this.edgeProps.splice(T,1),this.edges.push({a:C,b:nt}),this.edges.push({a:nt,b:L});const yt=xs(Qn(),this.vertices[nt].position,k),Lt=jn(yt),It={vec:yt,dir:ls(Qn(),yt,1/Lt),len:Lt};this.edgeProps.push(It),this.edgeProps.push(It)}}distSqLines(l,h,m,_){const S=Jt(ct(),h,l),T=Jt(ct(),_,m),C=Jt(ct(),l,m),L=Ke(S,S),k=Ke(S,T),F=Ke(S,C),V=Ke(T,T),U=Ke(T,C),$=L*V-k*k;if($===0)return or(Ti(S,m,_,Ke(C,T)/Ke(T,T)),l);const Z=(L*U-k*F)/$;return or(Ti(S,l,h,(k*U-F*V)/$),Ti(T,m,_,Z))}}class Hi{static parseFrom(l,h){const m=Vi.parse(l);if(!m)return[];let{vertices:_,features:S}=m;const T=1/kt(h);S.sort((F,V)=>F.id-V.id),_.sort((F,V)=>F.id-V.id||F.idx-V.idx),_=_.filter((F,V,U)=>V===U.findIndex($=>$.id===F.id&&$.idx===F.idx));const C=new Array;let L=0;const k=_.length;for(const F of S){if(F.constantHeight){C.push(new Zr(F.id,F.bounds,F.constantHeight));continue}for(;L!==k&&_[L].id<F.id;)L++;if(L===k||_[L].id!==F.id)continue;const V=new Array,U=new Array,$=L;for(;L!==k&&_[L].id===F.id;){const Z=_[L];if(V.push({position:Z.position,height:Z.height,extent:Z.extent}),L!==$&&_[L-1].idx===Z.idx-1){const Q=L-$;U.push({a:Q-1,b:Q})}L++}C.push(new Zr(F.id,F.bounds,void 0,V,U,T))}return C}static getElevationFeature(l,h){if(!h)return;const m=+l.properties[ii];return Number.isNaN(m)?void 0:h.find(_=>_.id===m)}}class Dr{constructor(l,h){this.zScale=1,this.xOffset=0,this.yOffset=0,l.equals(h)||(this.zScale=Math.pow(2,h.z-l.z),this.xOffset=(l.x*this.zScale-h.x)*Ve,this.yOffset=(l.y*this.zScale-h.y)*Ve)}constantElevation(l,h){if(l.constantHeight!=null)return this.computeBiasedHeight(l.constantHeight,h)}pointElevation(l,h,m){const _=this.constantElevation(h,m);return _??(l.x=l.x*this.zScale+this.xOffset,l.y=l.y*this.zScale+this.yOffset,this.computeBiasedHeight(h.pointElevation(l),m))}computeBiasedHeight(l,h){return h<=0?l:l+h*Tt(0,h,l>=0?l:Math.abs(.5*l))}}li(Zr,"ElevationFeature");class Bn{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.projection=l.projection,this.layoutVertexArray=new hs,this.indexArray=new Ln,this.segments=new Un,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new qu),this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){const S=this.layers[0],T=[];let C=null;S.type==="circle"&&(C=S.layout.get("circle-sort-key"));for(const{feature:k,id:F,index:V,sourceLayerIndex:U}of l){const $=this.layers[0]._featureFilter.needGeometry,Z=ee(k,$);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),Z,m))continue;const Q=C?C.evaluate(Z,{},m):void 0,et={id:F,properties:k.properties,type:k.type,sourceLayerIndex:U,index:V,geometry:$?Z.geometry:pe(k,m,_),patterns:{},sortKey:Q};T.push(et)}C&&T.sort((k,F)=>k.sortKey-F.sortKey);let L=null;_.projection.name==="globe"&&(this.globeExtVertexArray=new L_,L=_.projection);for(const k of T){const{geometry:F,index:V,sourceLayerIndex:U}=k,$=l[V].feature;this.addFeature(k,F,V,h.availableImages,m,L,h.brightness,h.elevationFeatures),h.featureIndex.insert($,F,V,U,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(l,h,m,_,S,T,C){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,WT.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,fD.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=l.createVertexBuffer(this.elevatedLayoutVertexArray,dD.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(l,h,m,_,S,T,C,L){let k;this.elevationMode!=="none"&&(k=Hi.getElevationFeature(l,L));for(const F of h)for(const V of F){const U=V.x,$=V.y;if(U<0||U>=Ve||$<0||$>=Ve)continue;if(T){const et=T.projectTilePoint(U,$,S),nt=T.upVector(S,U,$);this.addGlobeExtVertex(et,nt),this.addGlobeExtVertex(et,nt),this.addGlobeExtVertex(et,nt),this.addGlobeExtVertex(et,nt)}const Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),Q=Z.vertexLength;if(this.addCircleVertex(U,$,-1,-1),this.addCircleVertex(U,$,1,-1),this.addCircleVertex(U,$,1,1),this.addCircleVertex(U,$,-1,1),this.elevationMode!=="none"){const et=k?k.pointElevation(new Me(U,$)):0;this.hasElevation=this.hasElevation||et!==0;for(let nt=0;nt<4;nt++)this.elevatedLayoutVertexArray.emplaceBack(et)}this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+2,Q+3),Z.vertexLength+=4,Z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{},_,S,C,void 0,this.worldview)}addCircleVertex(l,h,m,_){this.layoutVertexArray.emplaceBack(2*l+(m+1)/2,2*h+(_+1)/2)}addGlobeExtVertex(l,h){this.globeExtVertexArray.emplaceBack(l.x,l.y,l.z,h[0]*16384,h[1]*16384,h[2]*16384)}}function ra(d,l){for(let h=0;h<d.length;h++)if(qa(l,d[h]))return!0;for(let h=0;h<l.length;h++)if(qa(d,l[h]))return!0;return!!Qo(d,l)}function Gn(d,l,h){return!!qa(d,l)||!!go(l,d,h)}function Jn(d,l){if(d.length===1)return Cl(l,d[0]);for(let h=0;h<l.length;h++){const m=l[h];for(let _=0;_<m.length;_++)if(qa(d,m[_]))return!0}for(let h=0;h<d.length;h++)if(Cl(l,d[h]))return!0;for(let h=0;h<l.length;h++)if(Qo(d,l[h]))return!0;return!1}function fs(d,l,h){if(d.length>1){if(Qo(d,l))return!0;for(let m=0;m<l.length;m++)if(go(l[m],d,h))return!0}for(let m=0;m<d.length;m++)if(go(d[m],l,h))return!0;return!1}function Qo(d,l){if(d.length===0||l.length===0)return!1;for(let h=0;h<d.length-1;h++){const m=d[h],_=d[h+1];for(let S=0;S<l.length-1;S++)if(po(m,_,l[S],l[S+1]))return!0}return!1}function po(d,l,h,m){return dr(d,h,m)!==dr(l,h,m)&&dr(d,l,h)!==dr(d,l,m)}function Eo(d,l,h){return(d.x-h.x)*(l.y-h.y)-(d.y-h.y)*(l.x-h.x)}function Xs(d,l,h,m){const _=Eo(d,l,m),S=Eo(d,l,h);if(Math.sign(_)===Math.sign(S))return;const T=Eo(h,m,d),C=T+S-_;return Math.sign(T)!==Math.sign(C)?[T/(T-C),S/(S-_)]:void 0}function go(d,l,h){const m=h*h;if(l.length===1)return d.distSqr(l[0])<m;for(let _=1;_<l.length;_++)if(Ys(d,l[_-1],l[_])<m)return!0;return!1}function Ys(d,l,h){const m=l.distSqr(h);if(m===0)return d.distSqr(l);const _=((d.x-l.x)*(h.x-l.x)+(d.y-l.y)*(h.y-l.y))/m;return d.distSqr(_<0?l:_>1?h:h.sub(l)._mult(_)._add(l))}function Cl(d,l){let h,m,_,S=!1;for(let T=0;T<d.length;T++){h=d[T];for(let C=0,L=h.length-1;C<h.length;L=C++)m=h[C],_=h[L],m.y>l.y!=_.y>l.y&&l.x<(_.x-m.x)*(l.y-m.y)/(_.y-m.y)+m.x&&(S=!S)}return S}function qa(d,l){let h=!1;for(let m=0,_=d.length-1;m<d.length;_=m++){const S=d[m],T=d[_];S.y>l.y!=T.y>l.y&&l.x<(T.x-S.x)*(l.y-S.y)/(T.y-S.y)+S.x&&(h=!h)}return h}function $n(d,l,h,m,_){for(const T of d)if(l<=T.x&&h<=T.y&&m>=T.x&&_>=T.y)return!0;const S=[new Me(l,h),new Me(l,_),new Me(m,_),new Me(m,h)];if(d.length>2){for(const T of S)if(qa(d,T))return!0}for(let T=0;T<d.length-1;T++)if(na(d[T],d[T+1],S))return!0;return!1}function na(d,l,h){const m=h[0],_=h[2];if(d.x<m.x&&l.x<m.x||d.x>_.x&&l.x>_.x||d.y<m.y&&l.y<m.y||d.y>_.y&&l.y>_.y)return!1;const S=dr(d,l,h[0]);return S!==dr(d,l,h[1])||S!==dr(d,l,h[2])||S!==dr(d,l,h[3])}function hn(d,l,h,m,_,S){let T=l.y-d.y,C=d.x-l.x;if(S=S||0){const L=T*T+C*C;if(L===0)return!0;const k=Math.sqrt(L);T/=k,C/=k}return!((h.x-d.x)*T+(h.y-d.y)*C-S<0||(m.x-d.x)*T+(m.y-d.y)*C-S<0||(_.x-d.x)*T+(_.y-d.y)*C-S<0)}function la(d,l,h,m,_,S,T){return!(hn(d,l,m,_,S,T)||hn(l,h,m,_,S,T)||hn(h,d,m,_,S,T)||hn(m,_,d,l,h,T)||hn(_,S,d,l,h,T)||hn(S,m,d,l,h,T))}function Xa(d,l,h){const m=l.paint.get(d).value;return m.kind==="constant"?m.value:h.programConfigurations.get(l.id).getMaxValue(d)}function Zn(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}function Ks(d,l,h,m,_){if(!l[0]&&!l[1])return d;const S=Me.convert(l)._mult(_);h==="viewport"&&S._rotate(-m);const T=[];for(let C=0;C<d.length;C++)T.push(d[C].sub(S));return T}function Ef(d,l,h,m){const _=Me.convert(d)._mult(m);return l==="viewport"&&_._rotate(-h),_}let Ku,Df;function Pf(d,l,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[d*m-2*Math.PI*6378137/2,l*m-2*Math.PI*6378137/2]}li(Bn,"CircleBucket",{omit:["layers"]});class Js{constructor(l,h,m){this.z=l,this.x=h,this.y=m,this.key=Qs(0,l,l,h,m)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}isChildOf(l){const h=this.z-l.z;return l.z===0||l.z<this.z&&l.x===this.x>>h&&l.y===this.y>>h}url(l,h){const m=function(S,T,C){var L=Pf(256*S,256*(T=Math.pow(2,C)-T-1),C),k=Pf(256*(S+1),256*(T+1),C);return L[0]+","+L[1]+","+k[0]+","+k[1]}(this.x,this.y,this.z),_=function(S,T,C){let L,k="";for(let F=S;F>0;F--)L=1<<F-1,k+=(T&L?1:0)+(C&L?2:0);return k}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",m)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fu{constructor(l,h){this.wrap=l,this.canonical=h,this.key=Qs(l,h.z,h.z,h.x,h.y)}}class ja{constructor(l,h,m,_,S){this.overscaledZ=l,this.wrap=h,this.canonical=new Js(m,+_,+S),this.key=h===0&&l===m?this.canonical.key:Qs(h,l,m,_,S)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){const h=this.canonical.z-l;return l>this.canonical.z?new ja(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ja(l,this.wrap,l,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(l,h=!0){if(this.overscaledZ===l&&h)return this.key;if(l>this.canonical.z)return Qs(this.wrap*+h,l,this.canonical.z,this.canonical.x,this.canonical.y);{const m=this.canonical.z-l;return Qs(this.wrap*+h,l,l,this.canonical.x>>m,this.canonical.y>>m)}}isChildOf(l){if(l.wrap!==this.wrap)return!1;const h=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.z<this.canonical.z&&l.canonical.x===this.canonical.x>>h&&l.canonical.y===this.canonical.y>>h}children(l){if(this.overscaledZ>=l)return[new ja(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,_=2*this.canonical.y;return[new ja(h,this.wrap,h,m,_),new ja(h,this.wrap,h,m+1,_),new ja(h,this.wrap,h,m,_+1),new ja(h,this.wrap,h,m+1,_+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new ja(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new ja(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qs(d,l,h,m,_){const S=1<<Math.min(h,22);let T=S*(_%S)+m%S;return d&&h<22&&(T+=S*S*((d<0?-2*d-1:2*d)%(1<<2*(22-h)))),16*(32*T+h)+(l-h)}const Zh=[d=>{let l=d.canonical.x-1,h=d.wrap;return l<0&&(l=(1<<d.canonical.z)-1,h--),new ja(d.overscaledZ,h,d.canonical.z,l,d.canonical.y)},d=>{let l=d.canonical.x+1,h=d.wrap;return l===1<<d.canonical.z&&(l=0,h++),new ja(d.overscaledZ,h,d.canonical.z,l,d.canonical.y)},d=>new ja(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,(d.canonical.y===0?1<<d.canonical.z:d.canonical.y)-1),d=>new ja(d.overscaledZ,d.wrap,d.canonical.z,d.canonical.x,d.canonical.y===(1<<d.canonical.z)-1?0:d.canonical.y+1)];li(Js,"CanonicalTileID"),li(ja,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const XT=gr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:j_}=XT,ent=gr([{name:"a_pos_3",components:3,type:"Int16"}]);var GN=gr([{name:"a_pos",type:"Int16",components:2}]);function YT(d){return d*ds/G}const int=[new ur([M,M,M],[P,P,P]),new ur([M,M,M],[0,0,P]),new ur([0,M,M],[P,0,P]),new ur([M,0,M],[0,P,P]),new ur([0,0,M],[P,P,P])];function HN(d,l,h,m=!0){const _=ke([],d._camera.position,d.worldSize),S=[l,h,1,1];Li(S,S,d.pixelMatrixInverse),pi(S,S,1/S[3]);const T=xe([],qe([],S,_)),C=d.globeMatrix,L=[C[12],C[13],C[14]],k=qe([],L,_),F=Et(k),V=xe([],k),U=d.worldSize/(2*Math.PI),$=Ke(V,T),Z=Math.asin(U/F);if(Z<Math.acos($)){if(!m)return null;const se=[],Kt=[];ke(se,T,F/$),xe(Kt,qe(Kt,se,k)),xe(T,zt(T,k,ke(T,Kt,Math.tan(Z)*F)))}const Q=[];new ir(_,T).closestPointOnSphere(L,U,Q);const et=xe([],ia(C,0)),nt=xe([],ia(C,1)),dt=xe([],ia(C,2)),mt=Ke(et,Q),yt=Ke(nt,Q),Lt=Ke(dt,Q),It=Vo(Math.asin(-yt/U));let Ot=Vo(Math.atan2(mt,Lt));Ot=d.center.lng+function(se,Kt){const ue=(Kt-se+180)%360-180;return ue<-180?ue+360:ue}(d.center.lng,Ot);const Ut=ht(Ot),Ht=lt(st(It),0,1);return new qt(Ut,Ht)}class rnt{constructor(l,h,m){this.a=qe([],l,m),this.b=qe([],h,m),this.center=m;const _=xe([],this.a),S=xe([],this.b);this.angle=Math.acos(Ke(_,S))}}function wD(d,l){if(d.angle===0)return null;let h;return h=d.a[l]===0?1/d.angle*.5*Math.PI:1/d.angle*Math.atan(d.b[l]/d.a[l]/Math.sin(d.angle)-1/Math.tan(d.angle)),h<0||h>1?null:function(m,_,S,T){const C=Math.sin(S);return m*(Math.sin((1-T)*S)/C)+_*(Math.sin(T*S)/C)}(d.a[l],d.b[l],d.angle,lt(h,0,1))+d.center[l]}function Fc(d){if(d.z<=1)return int[d.z+2*d.y+d.x];const l=SD(KT(d));return ur.fromPoints(l)}function qh(d,l,h){return ke(d,d,1-h),ni(d,d,l,h)}function jN(d,l,h){for(const m of d)Bt(m,m,l),ke(m,m,h)}function WN(d,l,h,m){const _=l/d.worldSize,S=d.globeMatrix;if(h.z<=1){const Ht=Fc(h).getCorners();return jN(Ht,S,_),ur.fromPoints(Ht)}const T=KT(h,m),C=SD(T,ds+YT(d._tileCoverLift));jN(C,S,_);const L=Number.MAX_VALUE,k=[-L,-L,-L],F=[L,L,L];if(T.contains(d.center)){for(const Kt of C)be(F,F,Kt),ve(k,k,Kt);k[2]=0;const Ht=d.point,se=[Ht.x*_,Ht.y*_,0];return be(F,F,se),ve(k,k,se),new ur(F,k)}if(d._tileCoverLift>0){for(const Ht of C)be(F,F,Ht),ve(k,k,Ht);return new ur(F,k)}const V=[S[12]*_,S[13]*_,S[14]*_],U=T.getCenter(),$=lt(d.center.lat,-wt,wt),Z=lt(U.lat,-wt,wt),Q=ht(d.center.lng),et=st($);let nt=Q-ht(U.lng);const dt=et-st(Z);nt>.5?nt-=1:nt<-.5&&(nt+=1);let mt=0;Math.abs(nt)>Math.abs(dt)?mt=nt>=0?1:3:(mt=dt>=0?0:2,ni(V,V,[S[4]*_,S[5]*_,S[6]*_],-Math.sin(wr(dt>=0?T.getSouth():T.getNorth()))*ds));const yt=C[mt],Lt=C[(mt+1)%4],It=new rnt(yt,Lt,V),Ot=[wD(It,0)||yt[0],wD(It,1)||yt[1],wD(It,2)||yt[2]],Ut=Lf(d.zoom);if(Ut>0){const Ht=function({x:Kt,y:ue,z:me},Te,Be,De,_e){const Ee=1/(1<<me);let ae=Kt*Ee,re=ae+Ee,Ie=ue*Ee,Re=Ie+Ee,we=0;const si=(ae+re)/2-De;return si>.5?we=-1:si<-.5&&(we=1),ae=((ae+we)*Te-(De*=Te))*Be+De,re=((re+we)*Te-De)*Be+De,Ie=(Ie*Te-(_e*=Te))*Be+_e,Re=(Re*Te-_e)*Be+_e,[[ae,Re,0],[re,Re,0],[re,Ie,0],[ae,Ie,0]]}(h,l,d._pixelsPerMercatorPixel,Q,et);for(let Kt=0;Kt<C.length;Kt++)qh(C[Kt],Ht[Kt],Ut);const se=zt([],Ht[mt],Ht[(mt+1)%4]);ke(se,se,.5),qh(Ot,se,Ut)}for(const Ht of C)be(F,F,Ht),ve(k,k,Ht);return F[2]=Math.min(yt[2],Lt[2]),be(F,F,Ot),ve(k,k,Ot),new ur(F,k)}function KT({x:d,y:l,z:h},m=!1){const _=1/(1<<h),S=new X(xt(d*_),l===(1<<h)-1&&m?-90:vt((l+1)*_)),T=new X(xt((d+1)*_),l===0&&m?90:vt(l*_));return new W(S,T)}function SD(d,l=ds){const h=wr(d.getNorth()),m=wr(d.getSouth()),_=Math.cos(h),S=Math.cos(m),T=Math.sin(h),C=Math.sin(m),L=d.getWest(),k=d.getEast();return[O(S,C,L,l),O(S,C,k,l),O(_,T,k,l),O(_,T,L,l)]}function _1(d,l,h,m){const _=1<<h.z,S=(d/Ve+h.x)/_;return B(vt((l/Ve+h.y)/_),xt(S),m)}function JT({min:d,max:l}){return p/Math.max(l[0]-d[0],l[1]-d[1],l[2]-d[2])}const $N=new Float64Array(16);function QT(d){const l=JT(d),h=it($N,[l,l,l]);return N(h,h,Ze([],d.min))}function TD(d){const l=(m=d.min,(h=$N)[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=m[0],h[13]=m[1],h[14]=m[2],h[15]=1,h);var h,m;const _=1/JT(d);return H(l,l,[_,_,_])}function AD(d){const l=Ve/(2*Math.PI);return d/(2*Math.PI)/l}function ZN(d,l){return Ve/(512*Math.pow(2,d))*JT(Fc(l))}function qN(d,l,h,m,_){const S=AD(h),T=[d,l,-h/(2*Math.PI)],C=D(new Float64Array(16));return N(C,C,T),H(C,C,[S,S,S]),q(C,C,wr(-_)),Y(C,C,wr(-m)),C}function Lf(d){return Tt(x,u,d)}function XN(d,l){const h=B(l.lat,l.lng),m=function(Z){const Q=B(Z._center.lat,Z._center.lng);let et=We([],bt(0,1,0),Q);const nt=at([],-Z.angle,Q);et=Bt(et,et,nt),at(nt,-Z._pitch,et);const dt=xe([],Q);return ke(dt,dt,YT(Z.cameraToCenterDistance/Z.pixelsPerMeter)),Bt(dt,dt,nt),zt([],Q,dt)}(d);return T=(_=Jt([],m,h))[0],C=_[1],L=_[2],k=(S=h)[0],F=S[1],V=S[2],$=(U=Math.sqrt((T*T+C*C+L*L)*(k*k+F*F+V*V)))&&Ke(_,S)/U,Math.acos(Math.min(Math.max($,-1),1));var _,S,T,C,L,k,F,V,U,$}function ID(d,l){return XN(d,l)>Math.PI/2*1.01}const YN=wr(85),nnt=Math.cos(YN),ant=Math.sin(YN),ont=I(),KN=d=>{const l=[];return d.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l};function JN(d,l,h,m,_,S,T,C,L){if(S&&d.queryGeometry.isAboveHorizon)return!1;S&&(L*=d.pixelToTileUnitsFactor);const k=d.tileID.canonical,F=h.projection.upVectorScale(k,h.center.lat,h.worldSize).metersToTile;for(const V of l)for(const U of V){const $=U.add(C),Z=_&&h.elevation?h.elevation.exaggeration()*_.getElevationAt($.x,$.y,!0):0,Q=h.projection.projectTilePoint($.x,$.y,k);if(Z>0){const mt=h.projection.upVector(k,$.x,$.y);Q.x+=mt[0]*F*Z,Q.y+=mt[1]*F*Z,Q.z+=mt[2]*F*Z}const et=S?$:snt(Q.x,Q.y,Q.z,m),nt=S?d.tilespaceRays.map(mt=>unt(mt,Z)):d.queryGeometry.screenGeometry,dt=Li([],[Q.x,Q.y,Q.z,1],m);if(!T&&S?L*=dt[3]/h.cameraToCenterDistance:T&&!S&&(L*=h.cameraToCenterDistance/dt[3]),S){const mt=vt((U.y/Ve+k.y)/(1<<k.z));L/=h.projection.pixelsPerMeter(mt,1)/gt(1,mt)}if(Gn(nt,et,L))return!0}return!1}function snt(d,l,h,m){const _=Li([],[d,l,h,1],m);return new Me(_[0]/_[3],_[1]/_[3])}const QN=bt(0,0,0),lnt=bt(0,0,1);function unt(d,l){const h=ct();return QN[2]=l,d.intersectsPlane(QN,lnt,h),new Me(h[0],h[1])}class t5 extends Bn{}let e5,i5,r5,n5;function a5(d,{width:l,height:h},m,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==l*h*m)throw new RangeError("mismatched image size")}else _=new Uint8Array(l*h*m);return d.width=l,d.height=h,d.data=_,d}function o5(d,l,h){const{width:m,height:_}=l;m===d.width&&_===d.height||(CD(d,l,{x:0,y:0},{x:0,y:0},{width:Math.min(d.width,m),height:Math.min(d.height,_)},h,null),d.width=m,d.height=_,d.data=l.data)}function CD(d,l,h,m,_,S,T,C){if(_.width===0||_.height===0)return l;if(_.width>d.width||_.height>d.height||h.x>d.width-_.width||h.y>d.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>l.width||_.height>l.height||m.x>l.width-_.width||m.y>l.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const L=d.data,k=l.data,F=S===4&&C;for(let V=0;V<_.height;V++){const U=((h.y+V)*d.width+h.x)*S,$=((m.y+V)*l.width+m.x)*S;if(F)for(let Z=0;Z<_.width;Z++){const Q=U+Z*S+3,et=$+Z*S;k[et+0]=255,k[et+1]=255,k[et+2]=255,k[et+3]=L[Q]}else if(T)for(let Z=0;Z<_.width;Z++){const Q=U+Z*S,et=$+Z*S,nt=new Xr(L[Q+0]/255,L[Q+1]/255,L[Q+2]/255,L[Q+3]).toNonPremultipliedRenderColor(T).toArray();k[et+0]=nt[0],k[et+1]=nt[1],k[et+2]=nt[2],k[et+3]=nt[3]}else for(let Z=0;Z<_.width*S;Z++)k[$+Z]=L[U+Z]}return l}li(t5,"HeatmapBucket",{omit:["layers"]});class Rf{constructor(l,h){a5(this,l,1,h)}resize(l){o5(this,new Rf(l),1)}clone(){return new Rf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,_,S){CD(l,h,m,_,S,1,null)}}class Do{constructor(l,h){a5(this,l,4,h)}resize(l){o5(this,new Do(l),4)}replace(l,h){h?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,_,S,T,C){CD(l,h,m,_,S,4,T,C)}}class s5{constructor(l,h){this.width=l.width,this.height=l.height,this.data=h instanceof Uint8Array?new Float32Array(h.buffer):h}}function y1(d){const l={},h=d.resolution||256,m=d.clips?d.clips.length:1,_=d.image||new Do({width:h,height:m}),S=(T,C,L)=>{l[d.evaluationKey]=L;const k=d.expression.evaluate(l),F=k?k.toNonPremultipliedRenderColor(null):null;F&&(_.data[T+C+0]=Math.floor(255*F.r),_.data[T+C+1]=Math.floor(255*F.g),_.data[T+C+2]=Math.floor(255*F.b),_.data[T+C+3]=Math.floor(255*F.a))};if(d.clips)for(let T=0,C=0;T<m;++T,C+=4*h)for(let L=0,k=0;L<h;L++,k+=4){const F=L/(h-1),{start:V,end:U}=d.clips[T];S(C,k,V*(1-F)+U*F)}else for(let T=0,C=0;T<h;T++,C+=4)S(0,C,T/(h-1));return _}li(Rf,"AlphaImage"),li(Do,"RGBAImage");const cnt=gr([{name:"a_pos",components:2,type:"Int16"}],4),hnt=gr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),dnt=gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),fnt=gr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function W_(d,l,h=2){const m=l&&l.length,_=m?l[0]*h:d.length;let S=l5(d,0,_,h,!0);const T=[];if(!S||S.next===S.prev)return T;let C,L,k;if(m&&(S=function(F,V,U,$){const Z=[];for(let Q=0,et=V.length;Q<et;Q++){const nt=l5(F,V[Q]*$,Q<et-1?V[Q+1]*$:F.length,$,!1);nt===nt.next&&(nt.steiner=!0),Z.push(bnt(nt))}Z.sort(_nt);for(let Q=0;Q<Z.length;Q++)U=ynt(Z[Q],U);return U}(d,l,S,h)),d.length>80*h){C=d[0],L=d[1];let F=C,V=L;for(let U=h;U<_;U+=h){const $=d[U],Z=d[U+1];$<C&&(C=$),Z<L&&(L=Z),$>F&&(F=$),Z>V&&(V=Z)}k=Math.max(F-C,V-L),k=k!==0?32767/k:0}return x1(S,T,h,C,L,k,0),T}function l5(d,l,h,m,_){let S;if(_===function(T,C,L,k){let F=0;for(let V=C,U=L-k;V<L;V+=k)F+=(T[U]-T[V])*(T[V+1]+T[U+1]),U=V;return F}(d,l,h,m)>0)for(let T=l;T<h;T+=m)S=d5(T/m|0,d[T],d[T+1],S);else for(let T=h-m;T>=l;T-=m)S=d5(T/m|0,d[T],d[T+1],S);return S&&$_(S,S.next)&&(S1(S),S=S.next),S}function Ug(d,l){if(!d)return d;l||(l=d);let h,m=d;do if(h=!1,m.steiner||!$_(m,m.next)&&Ya(m.prev,m,m.next)!==0)m=m.next;else{if(S1(m),m=l=m.prev,m===m.next)break;h=!0}while(h||m!==l);return l}function x1(d,l,h,m,_,S,T){if(!d)return;!T&&S&&function(L,k,F,V){let U=L;do U.z===0&&(U.z=MD(U.x,U.y,k,F,V)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==L);U.prevZ.nextZ=null,U.prevZ=null,function($){let Z,Q=1;do{let et,nt=$;$=null;let dt=null;for(Z=0;nt;){Z++;let mt=nt,yt=0;for(let It=0;It<Q&&(yt++,mt=mt.nextZ,mt);It++);let Lt=Q;for(;yt>0||Lt>0&&mt;)yt!==0&&(Lt===0||!mt||nt.z<=mt.z)?(et=nt,nt=nt.nextZ,yt--):(et=mt,mt=mt.nextZ,Lt--),dt?dt.nextZ=et:$=et,et.prevZ=dt,dt=et;nt=mt}dt.nextZ=null,Q*=2}while(Z>1)}(U)}(d,m,_,S);let C=d;for(;d.prev!==d.next;){const L=d.prev,k=d.next;if(S?gnt(d,m,_,S):pnt(d))l.push(L.i,d.i,k.i),S1(d),d=k.next,C=k.next;else if((d=k)===C){T?T===1?x1(d=mnt(Ug(d),l),l,h,m,_,S,2):T===2&&vnt(d,l,h,m,_,S):x1(Ug(d),l,h,m,_,S,1);break}}}function pnt(d){const l=d.prev,h=d,m=d.next;if(Ya(l,h,m)>=0)return!1;const _=l.x,S=h.x,T=m.x,C=l.y,L=h.y,k=m.y,F=Math.min(_,S,T),V=Math.min(C,L,k),U=Math.max(_,S,T),$=Math.max(C,L,k);let Z=m.next;for(;Z!==l;){if(Z.x>=F&&Z.x<=U&&Z.y>=V&&Z.y<=$&&b1(_,C,S,L,T,k,Z.x,Z.y)&&Ya(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function gnt(d,l,h,m){const _=d.prev,S=d,T=d.next;if(Ya(_,S,T)>=0)return!1;const C=_.x,L=S.x,k=T.x,F=_.y,V=S.y,U=T.y,$=Math.min(C,L,k),Z=Math.min(F,V,U),Q=Math.max(C,L,k),et=Math.max(F,V,U),nt=MD($,Z,l,h,m),dt=MD(Q,et,l,h,m);let mt=d.prevZ,yt=d.nextZ;for(;mt&&mt.z>=nt&&yt&&yt.z<=dt;){if(mt.x>=$&&mt.x<=Q&&mt.y>=Z&&mt.y<=et&&mt!==_&&mt!==T&&b1(C,F,L,V,k,U,mt.x,mt.y)&&Ya(mt.prev,mt,mt.next)>=0||(mt=mt.prevZ,yt.x>=$&&yt.x<=Q&&yt.y>=Z&&yt.y<=et&&yt!==_&&yt!==T&&b1(C,F,L,V,k,U,yt.x,yt.y)&&Ya(yt.prev,yt,yt.next)>=0))return!1;yt=yt.nextZ}for(;mt&&mt.z>=nt;){if(mt.x>=$&&mt.x<=Q&&mt.y>=Z&&mt.y<=et&&mt!==_&&mt!==T&&b1(C,F,L,V,k,U,mt.x,mt.y)&&Ya(mt.prev,mt,mt.next)>=0)return!1;mt=mt.prevZ}for(;yt&&yt.z<=dt;){if(yt.x>=$&&yt.x<=Q&&yt.y>=Z&&yt.y<=et&&yt!==_&&yt!==T&&b1(C,F,L,V,k,U,yt.x,yt.y)&&Ya(yt.prev,yt,yt.next)>=0)return!1;yt=yt.nextZ}return!0}function mnt(d,l){let h=d;do{const m=h.prev,_=h.next.next;!$_(m,_)&&c5(m,h,h.next,_)&&w1(m,_)&&w1(_,m)&&(l.push(m.i,h.i,_.i),S1(h),S1(h.next),h=d=_),h=h.next}while(h!==d);return Ug(h)}function vnt(d,l,h,m,_,S){let T=d;do{let C=T.next.next;for(;C!==T.prev;){if(T.i!==C.i&&wnt(T,C)){let L=h5(T,C);return T=Ug(T,T.next),L=Ug(L,L.next),x1(T,l,h,m,_,S,0),void x1(L,l,h,m,_,S,0)}C=C.next}T=T.next}while(T!==d)}function _nt(d,l){let h=d.x-l.x;return h===0&&(h=d.y-l.y,h===0)&&(h=(d.next.y-d.y)/(d.next.x-d.x)-(l.next.y-l.y)/(l.next.x-l.x)),h}function ynt(d,l){const h=function(_,S){let T=S;const C=_.x,L=_.y;let k,F=-1/0;if($_(_,T))return T;do{if($_(_,T.next))return T.next;if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){const Q=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(Q<=C&&Q>F&&(F=Q,k=T.x<T.next.x?T:T.next,Q===C))return k}T=T.next}while(T!==S);if(!k)return null;const V=k,U=k.x,$=k.y;let Z=1/0;T=k;do{if(C>=T.x&&T.x>=U&&C!==T.x&&u5(L<$?C:F,L,U,$,L<$?F:C,L,T.x,T.y)){const Q=Math.abs(L-T.y)/(C-T.x);w1(T,_)&&(Q<Z||Q===Z&&(T.x>k.x||T.x===k.x&&xnt(k,T)))&&(k=T,Z=Q)}T=T.next}while(T!==V);return k}(d,l);if(!h)return l;const m=h5(h,d);return Ug(m,m.next),Ug(h,h.next)}function xnt(d,l){return Ya(d.prev,d,l.prev)<0&&Ya(l.next,d,d.next)<0}function MD(d,l,h,m,_){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-h)*_|0)|d<<8))|d<<4))|d<<2))|d<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-m)*_|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function bnt(d){let l=d,h=d;do(l.x<h.x||l.x===h.x&&l.y<h.y)&&(h=l),l=l.next;while(l!==d);return h}function u5(d,l,h,m,_,S,T,C){return(_-T)*(l-C)>=(d-T)*(S-C)&&(d-T)*(m-C)>=(h-T)*(l-C)&&(h-T)*(S-C)>=(_-T)*(m-C)}function b1(d,l,h,m,_,S,T,C){return!(d===T&&l===C)&&u5(d,l,h,m,_,S,T,C)}function wnt(d,l){return d.next.i!==l.i&&d.prev.i!==l.i&&!function(h,m){let _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==m.i&&_.next.i!==m.i&&c5(_,_.next,h,m))return!0;_=_.next}while(_!==h);return!1}(d,l)&&(w1(d,l)&&w1(l,d)&&function(h,m){let _=h,S=!1;const T=(h.x+m.x)/2,C=(h.y+m.y)/2;do _.y>C!=_.next.y>C&&_.next.y!==_.y&&T<(_.next.x-_.x)*(C-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==h);return S}(d,l)&&(Ya(d.prev,d,l.prev)||Ya(d,l.prev,l))||$_(d,l)&&Ya(d.prev,d,d.next)>0&&Ya(l.prev,l,l.next)>0)}function Ya(d,l,h){return(l.y-d.y)*(h.x-l.x)-(l.x-d.x)*(h.y-l.y)}function $_(d,l){return d.x===l.x&&d.y===l.y}function c5(d,l,h,m){const _=e2(Ya(d,l,h)),S=e2(Ya(d,l,m)),T=e2(Ya(h,m,d)),C=e2(Ya(h,m,l));return _!==S&&T!==C||!(_!==0||!t2(d,h,l))||!(S!==0||!t2(d,m,l))||!(T!==0||!t2(h,d,m))||!(C!==0||!t2(h,l,m))}function t2(d,l,h){return l.x<=Math.max(d.x,h.x)&&l.x>=Math.min(d.x,h.x)&&l.y<=Math.max(d.y,h.y)&&l.y>=Math.min(d.y,h.y)}function e2(d){return d>0?1:d<0?-1:0}function w1(d,l){return Ya(d.prev,d,d.next)<0?Ya(d,l,d.next)>=0&&Ya(d,d.prev,l)>=0:Ya(d,l,d.prev)<0||Ya(d,d.next,l)<0}function h5(d,l){const h=ED(d.i,d.x,d.y),m=ED(l.i,l.x,l.y),_=d.next,S=l.prev;return d.next=l,l.prev=d,h.next=_,_.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function d5(d,l,h,m){const _=ED(d,l,h);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function S1(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function ED(d,l,h){return{i:d,x:l,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function T1(d,l){const h=d.length;if(h<=1)return[d];const m=[];let _,S;for(let T=0;T<h;T++){const C=pr(d[T]);C!==0&&(d[T].area=Math.abs(C),S===void 0&&(S=C<0),S===C<0?(_&&m.push(_),_=[d[T]]):_.push(d[T]))}if(_&&m.push(_),l>1)for(let T=0;T<m.length;T++)m[T].length<=l||(ju(m[T],l,1,m[T].length-1,Snt),m[T]=m[T].slice(0,l));return m}function Snt(d,l){return l.area-d.area}function f5(d,l,h=1){if(!d)return null;const m=typeof d=="string"?cs.from(d).getPrimary():d.getPrimary(),_=typeof d=="string"?null:d.getSecondary();for(const S of[m,_]){if(!S)continue;const T=S.id.toString();l.has(T)||l.set(T,[]),S.scaleSelf(h),l.get(T).push(S)}return{primary:m.toString(),secondary:_?_.toString():null}}function DD(d,l,h,m){const _=m.patternDependencies;let S=!1;for(const T of l){const C=T.paint.get(`${d}-pattern`);C.isConstant()||(S=!0),f5(C.constantOr(null),_,h)&&(S=!0)}return S}function PD(d,l,h,m,_,S){const T=S.patternDependencies;for(const C of l){const L=C.paint.get(`${d}-pattern`).value;if(L.kind!=="constant"){let k=L.evaluate({zoom:m},h,{},S.availableImages);k=k&&k.name?k.name:k;const F=f5(k,T,_);if(!F)continue;const{primary:V,secondary:U}=F;V&&(h.patterns[C.id]=[V,U].filter(Boolean))}}return h}class p5{constructor(){this.polygons=new Map}add(l,...h){const m=this.polygons.get(l);m?m.push(...h):this.polygons.set(l,h)}merge(l){for(const[h,m]of l.polygons)this.add(h,...m)}}class Xh{constructor(){this.portals=[]}static isOnBorder(l,h){return l<=0&&h<=0||l>=Ve&&h>=Ve}static evaluate(l){if(l.length===0)return new Xh;let h=[];for(const L of l)h.push(...L.portals);if(h.length===0)return new Xh;for(const L of h){const k=L.va,F=L.vb;(Xh.isOnBorder(k.x,F.x)||Xh.isOnBorder(k.y,F.y))&&(L.type="border")}const m=h.filter(L=>L.type!=="unevaluated"),_=h.filter(L=>L.type==="unevaluated");if(_.length===0)return new Xh;_.sort((L,k)=>L.hash===k.hash?L.isTunnel===k.isTunnel?0:L.isTunnel?-1:1:L.hash<k.hash?1:-1),h=m.concat(_);let S=m.length,T=S,C=S;do if(T++,T===h.length||h[S].hash!==h[T].hash){if(T-S==2){C<S&&(h[C]=h[S],h[S]=null);const L=h[C],k=h[T-1];L.type=L.isTunnel!==k.isTunnel?"tunnel":"polygon",L.connection={a:L.connection.a,b:k.connection.a},C++}S=T}while(S!==h.length);return h.splice(C),h.sort((L,k)=>L.hash<k.hash?1:-1),{portals:h}}}li(Xh,"ElevationPortalGraph"),li(p5,"ElevationPolygons");class Tnt{constructor(l,h,m){this.outPositions=l,this.outNormals=h,this.outIndices=m,this.vertexLookup=new Map}addVertex(l,h,m){let _=l[2];m!=null&&(_*=m);const S=`${l[0]},${l[1]},${l[2]},${h[0]},${h[1]},${h[2]}`,T=this.vertexLookup.get(S);if(T!=null)return T;const C=this.outPositions.length;this.vertexLookup.set(S,C);const L=Math.trunc(16384*h[0]),k=Math.trunc(16384*h[1]),F=Math.trunc(16384*h[2]);return this.outPositions.emplaceBack(l[0],l[1],_),this.outNormals.emplaceBack(L,k,F),C}addTriangle(l,h,m){this.outIndices.emplaceBack(l,h,m)}addTriangles(l,h,m){if(l.length===0)return;const _=m.length===1,S=ct(),T=ct();for(let C=0;C<l.length;C+=3){const L=h[l[C+0]],k=h[l[C+1]],F=h[l[C+2]],V=_?m[0]:m[l[C+1]],U=_?m[0]:m[l[C+2]];Vt(S,L.x,L.y,_?m[0]:m[l[C+0]]);const $=this.addVertex(S,T);Vt(S,k.x,k.y,V);const Z=this.addVertex(S,T);Vt(S,F.x,F.y,U);const Q=this.addVertex(S,T);this.outIndices.emplaceBack($,Z,Q)}}addQuad(l,h,m,_,S,T){const C=this.addVertex(l,S,T),L=this.addVertex(h,S,T),k=this.addVertex(m,S,T),F=this.addVertex(_,S,T);this.addTriangle(C,L,k),this.addTriangle(k,F,C)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class tl{constructor(l,h,m,_){this.unevaluatedPortals=new Xh,this.portalPolygons=new p5,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new t1,this.vertexNormals=new e1,this.indexArray=new Ln,this.tileToMeters=kt(l),this.bridgeProgramConfigurations=new Vl(h,{zoom:m,lut:_},S=>S!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Vl(h,{zoom:m,lut:_},S=>S!=="fill-bridge-guard-rail-color")}addVertices(l,h){const m=this.unevalVertices.length;for(let _=0;_<l.length;_++)this.unevalVertices.push(l[_]),this.unevalHeights.push(h[_]);return m}addTriangles(l,h,m){const _=m?this.unevalTunnelTriangles:this.unevalTriangles;for(const S of l)_.push(S+h)}addRenderableRing(l,h,m,_,S,T){const C=[new Me(S.min.x,S.min.y),new Me(S.max.x,S.min.y),new Me(S.max.x,S.max.y),new Me(S.min.x,S.max.y)];for(let L=0;L<m-1;L++){const k=h+L,F=k+1,V=this.unevalVertices[k],U=this.unevalVertices[F];if(!(V.x>=S.min.x&&V.x<=S.max.x&&V.y>=S.min.y&&V.y<=S.max.y||U.x>=S.min.x&&U.x<=S.max.x&&U.y>=S.min.y&&U.y<=S.max.y||na(V,U,C))||this.isOnBorder(V.x,U.x)||this.isOnBorder(V.y,U.y))continue;const $=tl.computeEdgeHash(this.unevalVertices[k],this.unevalVertices[F]);let Z,Q=this.vertexHashLookup.get(tl.computePosHash(V));Q!=null?Z=Q.next:(Q=this.vertexHashLookup.get(tl.computePosHash(U)),Z=Q!=null?Q.prev:$),this.unevalEdges.push({polygonIdx:l,a:k,b:F,hash:$,portalHash:Z,isTunnel:_,type:"unevaluated",featureInfo:T})}}addPortalCandidates(l,h,m,_,S){if(h.length===0)return;this.portalPolygons.add(l,{geometry:h,zLevel:S});const T=h[0];this.vertexHashLookup.clear();let C=tl.computeEdgeHash(T[T.length-2],T[T.length-1]);for(let L=0;L<T.length-1;L++){const k=T[L+0],F=T[L+1],V=ou(F.x-k.x,F.y-k.y),U=jn(V);if(U===0)continue;let $="unevaluated";const Z=_.pointElevation(k),Q=_.pointElevation(F);Math.abs(Z)<.01&&Math.abs(Q)<.01?$="entrance":(this.isOnBorder(k.x,F.x)||this.isOnBorder(k.y,F.y))&&($="border");const et=tl.computeEdgeHash(k,F);this.unevaluatedPortals.portals.push({connection:{a:l,b:void 0},va:k,vb:F,vab:V,length:U,hash:et,isTunnel:m,type:$});const nt=tl.computePosHash(k);this.vertexHashLookup.set(nt,{prev:C,next:et}),C=et}}construct(l){if(this.unevalVertices.length===0)return;const h=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),m=U=>{U.primitiveLength=this.indexArray.length-U.primitiveOffset},_=new Tnt(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(l.portals,this.unevalEdges);const S=h(),T=h(),C=h(),L=(U,$)=>{U.sort((Q,et)=>Q.type===$&&et.type!==$?-1:Q.type!==$&&et.type===$?1:0);const Z=U.findIndex(Q=>Q.type!==$);return Z>=0?Z:U.length};let k=0;this.unevalEdges.length>0&&(k=L(this.unevalEdges,"none"),this.constructBridgeStructures(_,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},this.tileToMeters)),m(C);const F=h(),V=h();if(this.unevalEdges.length>0){const U=this.unevalEdges.splice(k),$=L(U,"tunnel")+k;this.unevalEdges.push(...U),this.constructTunnelStructures(_,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:k},{min:k,max:$})}m(F),_.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),m(V),_.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),m(T),_.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),m(S),this.maskSegments=Un.simpleSegment(0,V.primitiveOffset,0,V.primitiveLength),this.depthSegments=Un.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableBridgeSegments=Un.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.renderableTunnelSegments=Un.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.shadowCasterSegments=Un.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength)}update(l,h,m,_,S,T,C,L){this.bridgeProgramConfigurations.updatePaintArrays(l,h,S,m,_,T,C,L),this.tunnelProgramConfigurations.updatePaintArrays(l,h,S,m,_,T,C,L)}upload(l){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=l.createVertexBuffer(this.vertexPositions,dnt.members),this.vertexBufferNormal=l.createVertexBuffer(this.vertexNormals,fnt.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(l),this.tunnelProgramConfigurations.upload(l))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(l,h,m,_,S){const T=(C,L)=>{for(let k=0;k<L.length-1;k++){const F=L[k].featureIndex,V=L[k+1].vertexStart,U=l.feature(F);C.populatePaintArrays(V,U,F,{},m,h,_,void 0,S)}};T(this.bridgeProgramConfigurations,this.bridgeFeatureSections),T(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(l,h,m,_,S){const T=new Map;for(let C=_;C<S;C++){const L=m[C],k=L.a,F=L.b,V=tl.computePosHash(l[k]),U=tl.computePosHash(l[F]);let $=T.get(V);$||($={},T.set(V,$));let Z=T.get(U);Z||(Z={},T.set(U,Z)),h[k]<=0&&h[F]<=0||($.to=F,Z.from=k)}return T}isTerminalVertex(l,h){const m=tl.computePosHash(this.unevalVertices[l]),_=h.get(m);return!_||!_.from||!_.to}constructBridgeStructures(l,h,m,_,S,T){l.clearVertexLookup();const C=this.computeVertexConnections(h,m,_,S.min,S.max),L=1/T,k=.5*L,F=(Be,De)=>Vt(Be,h[De].x,h[De].y,m[De]*L),V=ct(),U=ct(),$=ct(),Z=ct(),Q=ct(),et=(Be,De)=>{const _e=C.get(tl.computePosHash(h[De])),Ee=_e.from,ae=_e.to;if(!Ee||!ae)return;F(V,Ee),F(U,De),F($,ae),$e(Z),He(V,U)||(qe(Q,U,V),xe(Z,Q)),He($,U)||(qe(Q,$,U),zt(Z,Z,xe(Q,Q)));const re=Ii(Z);return re>0?ke(Be,Z,1/re):void 0};let nt=Number.POSITIVE_INFINITY;this.sortSubarray(_,S.min,S.max,(Be,De)=>Be.featureInfo.featureIndex-De.featureInfo.featureIndex);const dt=ct(),mt=ct(),yt=ct(),Lt=ct(),It=ct(),Ot=ct(),Ut=ct(),Ht=ct(),se=ct(),Kt=[ct(),ct(),ct(),ct()],ue=[ct(),ct(),ct(),ct()],me=[{coord:new Me(0,0),height:0},{coord:new Me(0,0),height:0}],Te=(Be,De)=>Be>De;for(let Be=S.min;Be<S.max;Be++){const De=_[Be];if(!De.featureInfo.guardRailEnabled||!this.prepareEdgePoints(me,h,m,De,Te))continue;const[_e,Ee]=me;if(Vt(dt,_e.coord.x,_e.coord.y,L*_e.height),Vt(mt,Ee.coord.x,Ee.coord.y,L*Ee.height),He(dt,mt))continue;qe(yt,mt,dt),xe(yt,yt);const ae=et(Ht,De.a)||yt,re=et(se,De.b)||yt;Vt(Lt,ae[1],-ae[0],0),xe(Lt,Lt),Vt(It,re[1],-re[0],0),xe(It,It),We(Ht,Lt,ae),xe(Ot,Ht),We(Ht,It,re),xe(Ut,Ht),zt(Kt[0],dt,ke(Ht,qe(Ht,Lt,Ot),k)),zt(Kt[1],dt,ke(Ht,zt(Ht,Lt,Ot),k)),zt(Kt[2],dt,ke(Ht,Ot,k)),Kt[3]=dt,zt(ue[0],mt,ke(Ht,qe(Ht,It,Ut),k)),zt(ue[1],mt,ke(Ht,zt(Ht,It,Ut),k)),zt(ue[2],mt,ke(Ht,Ut,k)),ue[3]=mt,nt=this.addFeatureSection(De.featureInfo.featureIndex,nt,this.bridgeFeatureSections,l);const Ie=l.addVertex(Kt[0],Lt,T),Re=l.addVertex(Kt[1],Lt,T),we=l.addVertex(ue[0],It,T),si=l.addVertex(ue[1],It,T);l.addTriangle(Ie,Re,we),l.addTriangle(Re,si,we);const ci=l.addVertex(Kt[1],Ot,T),ri=l.addVertex(Kt[2],Ot,T),Xe=l.addVertex(ue[1],Ut,T),ji=l.addVertex(ue[2],Ut,T);l.addTriangle(ci,ri,Xe),l.addTriangle(ri,ji,Xe),Ze(Lt,Lt),Ze(It,It);const Qe=l.addVertex(Kt[2],Lt,T),Ci=l.addVertex(Kt[3],Lt,T),Zi=l.addVertex(ue[2],It,T),fr=l.addVertex(ue[3],It,T);l.addTriangle(Qe,Ci,Zi),l.addTriangle(Ci,fr,Zi);const Pr=this.isTerminalVertex(De.a,C),qi=this.isTerminalVertex(De.b,C);_e.height<.01&&Pr&&l.addQuad(Kt[3],Kt[2],Kt[1],Kt[0],Ze(ae,ae),T),Ee.height<.01&&qi&&l.addQuad(ue[0],ue[1],ue[2],ue[3],re,T)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:l.getVertexCount()})}constructTunnelStructures(l,h,m,_,S,T){l.clearVertexLookup();let C=Number.POSITIVE_INFINITY;const L=(nt,dt)=>nt.featureInfo.featureIndex-dt.featureInfo.featureIndex;this.sortSubarray(_,S.min,S.max,L),this.sortSubarray(_,T.min,T.max,L);const k=nt=>xe(nt,nt),F=[{coord:new Me(0,0),height:0},{coord:new Me(0,0),height:0}],V=(nt,dt)=>nt<dt,U=ct(),$=ct(),Z=ct(),Q=ct(),et=ct();for(let nt=S.min;nt<S.max;nt++){if(!this.prepareEdgePoints(F,h,m,_[nt],V))continue;const[dt,mt]=F,yt=k(Vt(et,-(mt.coord.y-dt.coord.y),mt.coord.x-dt.coord.x,0));C=this.addFeatureSection(_[nt].featureInfo.featureIndex,C,this.tunnelFeatureSections,l),l.addQuad(Vt(U,dt.coord.x,dt.coord.y,dt.height),Vt($,mt.coord.x,mt.coord.y,mt.height),Vt(Z,mt.coord.x,mt.coord.y,_[nt].isTunnel?-.1:0),Vt(Q,dt.coord.x,dt.coord.y,_[nt].isTunnel?-.1:0),yt)}for(let nt=T.min;nt<T.max;nt++){const dt=_[nt];dt.isTunnel&&([dt.a,dt.b]=[dt.b,dt.a]);const mt=h[dt.a],yt=h[dt.b],Lt=k(Vt(et,-(yt.y-mt.y),yt.x-mt.x,0));C=this.addFeatureSection(dt.featureInfo.featureIndex,C,this.tunnelFeatureSections,l),l.addQuad(Vt(U,yt.x,yt.y,0),Vt($,mt.x,mt.y,0),Vt(Z,mt.x,mt.y,m[dt.a]+4),Vt(Q,yt.x,yt.y,m[dt.b]+4),Lt),l.addQuad(Vt(U,mt.x,mt.y,0),Vt($,yt.x,yt.y,0),Vt(Z,yt.x,yt.y,m[dt.b]+4),Vt(Q,mt.x,mt.y,m[dt.a]+4),Lt)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:l.getVertexCount()})}setElevatedPoint(l,h,m,_){l.coord.x=h,l.coord.y=m,l.height=_}prepareEdgePoints(l,h,m,_,S){let T=h[_.a].x,C=h[_.a].y,L=h[_.b].x,k=h[_.b].y,F=m[_.a],V=m[_.b];const U=S(F,0),$=S(V,0);if(U&&$)return this.setElevatedPoint(l[0],T,C,F),this.setElevatedPoint(l[1],L,k,V),!0;if(!U&&!$)return!1;if(U){if(!$){const Z=V/(V-F);L=zi(L,T,Z),k=zi(k,C,Z),V=zi(V,F,Z)}}else{const Z=F/(F-V);T=zi(T,L,Z),C=zi(C,k,Z),F=zi(F,V,Z)}return this.setElevatedPoint(l[0],T,C,F),this.setElevatedPoint(l[1],L,k,V),!0}prepareEdges(l,h){if(h.length===0)return;h.sort((C,L)=>C.hash===L.hash?L.polygonIdx-C.polygonIdx:L.hash>C.hash?1:-1);let m=0,_=0,S=0,T=h[m].polygonIdx;do _++,(_===h.length||h[m].hash!==h[_].hash)&&((_-m==1||h[_-1].polygonIdx!==T)&&(S<m&&(h[S]=h[m],h[m]=null),h[S].type="none",S++),m=_,m!==h.length&&(T=h[m].polygonIdx));while(m!==h.length);if(h.splice(S),h.length!==0&&l.length!==0){h.sort((k,F)=>k.portalHash<F.portalHash?1:-1);let C=0,L=0;for(;C!==h.length&&L!==l.length;){const k=h[C],F=l[L];k.portalHash>F.hash?C++:F.hash>k.portalHash?L++:(k.type=F.type,C++)}}}isOnBorder(l,h){return l<=0&&h<=0||l>=Ve&&h>=Ve}addFeatureSection(l,h,m,_){return l!==h&&(h=l,m.push({featureIndex:l,vertexStart:_.getVertexCount()}),_.clearVertexLookup()),h}sortSubarray(l,h,m,_){const S=l.slice(h,m);S.sort(_),l.splice(h,S.length,...S)}static computeEdgeHash(l,h){return(l.y===h.y&&l.x>h.x||l.y>h.y)&&([l,h]=[h,l]),BigInt(tl.computePosHash(l))<<32n|BigInt(tl.computePosHash(h))}static computePosHash(l){return((65535&l.x)<<16|65535&l.y)>>>0}}var g5,m5={exports:{}},v5=(g5||(g5=1,function(d,l){(function(h){function m(Ct,St){return Ct>St?1:Ct<St?-1:0}var _=function(Ct,St){Ct===void 0&&(Ct=m),St===void 0&&(St=!1),this._compare=Ct,this._root=null,this._size=0,this._noDuplicates=!!St},S={size:{configurable:!0}};function T(Ct,St,he,je,de){var Je=de-je;if(Je>0){var vi=je+Math.floor(Je/2),gi={key:St[vi],data:he[vi],parent:Ct};return gi.left=T(gi,St,he,je,vi),gi.right=T(gi,St,he,vi+1,de),gi}return null}function C(Ct,St,he,je,de){if(!(he>=je)){for(var Je=Ct[he+je>>1],vi=he-1,gi=je+1;;){do vi++;while(de(Ct[vi],Je)<0);do gi--;while(de(Ct[gi],Je)>0);if(vi>=gi)break;var Ji=Ct[vi];Ct[vi]=Ct[gi],Ct[gi]=Ji,Ji=St[vi],St[vi]=St[gi],St[gi]=Ji}C(Ct,St,he,gi,de),C(Ct,St,gi+1,je,de)}}_.prototype.rotateLeft=function(Ct){var St=Ct.right;St&&(Ct.right=St.left,St.left&&(St.left.parent=Ct),St.parent=Ct.parent),Ct.parent?Ct===Ct.parent.left?Ct.parent.left=St:Ct.parent.right=St:this._root=St,St&&(St.left=Ct),Ct.parent=St},_.prototype.rotateRight=function(Ct){var St=Ct.left;St&&(Ct.left=St.right,St.right&&(St.right.parent=Ct),St.parent=Ct.parent),Ct.parent?Ct===Ct.parent.left?Ct.parent.left=St:Ct.parent.right=St:this._root=St,St&&(St.right=Ct),Ct.parent=St},_.prototype._splay=function(Ct){for(;Ct.parent;){var St=Ct.parent;St.parent?St.left===Ct&&St.parent.left===St?(this.rotateRight(St.parent),this.rotateRight(St)):St.right===Ct&&St.parent.right===St?(this.rotateLeft(St.parent),this.rotateLeft(St)):St.left===Ct&&St.parent.right===St?(this.rotateRight(St),this.rotateLeft(St)):(this.rotateLeft(St),this.rotateRight(St)):St.left===Ct?this.rotateRight(St):this.rotateLeft(St)}},_.prototype.splay=function(Ct){for(var St,he,je,de,Je;Ct.parent;)(he=(St=Ct.parent).parent)&&he.parent?((je=he.parent).left===he?je.left=Ct:je.right=Ct,Ct.parent=je):(Ct.parent=null,this._root=Ct),de=Ct.left,Je=Ct.right,Ct===St.left?(he&&(he.left===St?(St.right?(he.left=St.right,he.left.parent=he):he.left=null,St.right=he,he.parent=St):(de?(he.right=de,de.parent=he):he.right=null,Ct.left=he,he.parent=Ct)),Je?(St.left=Je,Je.parent=St):St.left=null,Ct.right=St,St.parent=Ct):(he&&(he.right===St?(St.left?(he.right=St.left,he.right.parent=he):he.right=null,St.left=he,he.parent=St):(Je?(he.left=Je,Je.parent=he):he.left=null,Ct.right=he,he.parent=Ct)),de?(St.right=de,de.parent=St):St.right=null,Ct.left=St,St.parent=Ct)},_.prototype.replace=function(Ct,St){Ct.parent?Ct===Ct.parent.left?Ct.parent.left=St:Ct.parent.right=St:this._root=St,St&&(St.parent=Ct.parent)},_.prototype.minNode=function(Ct){if(Ct===void 0&&(Ct=this._root),Ct)for(;Ct.left;)Ct=Ct.left;return Ct},_.prototype.maxNode=function(Ct){if(Ct===void 0&&(Ct=this._root),Ct)for(;Ct.right;)Ct=Ct.right;return Ct},_.prototype.insert=function(Ct,St){var he=this._root,je=null,de=this._compare;if(this._noDuplicates)for(;he;){if(je=he,de(he.key,Ct)===0)return;he=de(he.key,Ct)<0?he.right:he.left}else for(;he;)je=he,he=de(he.key,Ct)<0?he.right:he.left;return he={key:Ct,data:St,left:null,right:null,parent:je},je?de(je.key,he.key)<0?je.right=he:je.left=he:this._root=he,this.splay(he),this._size++,he},_.prototype.find=function(Ct){for(var St=this._root,he=this._compare;St;){var je=he(St.key,Ct);if(je<0)St=St.right;else{if(!(je>0))return St;St=St.left}}return null},_.prototype.contains=function(Ct){for(var St=this._root,he=this._compare;St;){var je=he(Ct,St.key);if(je===0)return!0;St=je<0?St.left:St.right}return!1},_.prototype.remove=function(Ct){var St=this.find(Ct);if(!St)return!1;if(this.splay(St),St.left)if(St.right){var he=this.minNode(St.right);he.parent!==St&&(this.replace(he,he.right),he.right=St.right,he.right.parent=he),this.replace(St,he),he.left=St.left,he.left.parent=he}else this.replace(St,St.left);else this.replace(St,St.right);return this._size--,!0},_.prototype.removeNode=function(Ct){if(!Ct)return!1;if(this.splay(Ct),Ct.left)if(Ct.right){var St=this.minNode(Ct.right);St.parent!==Ct&&(this.replace(St,St.right),St.right=Ct.right,St.right.parent=St),this.replace(Ct,St),St.left=Ct.left,St.left.parent=St}else this.replace(Ct,Ct.left);else this.replace(Ct,Ct.right);return this._size--,!0},_.prototype.erase=function(Ct){var St=this.find(Ct);if(St){this.splay(St);var he=St.left,je=St.right,de=null;he&&(he.parent=null,de=this.maxNode(he),this.splay(de),this._root=de),je&&(he?de.right=je:this._root=je,je.parent=de),this._size--}},_.prototype.pop=function(){var Ct=this._root,St=null;if(Ct){for(;Ct.left;)Ct=Ct.left;St={key:Ct.key,data:Ct.data},this.remove(Ct.key)}return St},_.prototype.next=function(Ct){var St=Ct;if(St)if(St.right)for(St=St.right;St&&St.left;)St=St.left;else for(St=Ct.parent;St&&St.right===Ct;)Ct=St,St=St.parent;return St},_.prototype.prev=function(Ct){var St=Ct;if(St)if(St.left)for(St=St.left;St&&St.right;)St=St.right;else for(St=Ct.parent;St&&St.left===Ct;)Ct=St,St=St.parent;return St},_.prototype.forEach=function(Ct){for(var St=this._root,he=[],je=!1,de=0;!je;)St?(he.push(St),St=St.left):he.length>0?(Ct(St=he.pop(),de++),St=St.right):je=!0;return this},_.prototype.range=function(Ct,St,he,je){for(var de=[],Je=this._compare,vi=this._root;de.length!==0||vi;)if(vi)de.push(vi),vi=vi.left;else{if(Je((vi=de.pop()).key,St)>0)break;if(Je(vi.key,Ct)>=0&&he.call(je,vi))return this;vi=vi.right}return this},_.prototype.keys=function(){for(var Ct=this._root,St=[],he=[],je=!1;!je;)Ct?(St.push(Ct),Ct=Ct.left):St.length>0?(Ct=St.pop(),he.push(Ct.key),Ct=Ct.right):je=!0;return he},_.prototype.values=function(){for(var Ct=this._root,St=[],he=[],je=!1;!je;)Ct?(St.push(Ct),Ct=Ct.left):St.length>0?(Ct=St.pop(),he.push(Ct.data),Ct=Ct.right):je=!0;return he},_.prototype.at=function(Ct){for(var St=this._root,he=[],je=!1,de=0;!je;)if(St)he.push(St),St=St.left;else if(he.length>0){if(St=he.pop(),de===Ct)return St;de++,St=St.right}else je=!0;return null},_.prototype.load=function(Ct,St,he){if(Ct===void 0&&(Ct=[]),St===void 0&&(St=[]),he===void 0&&(he=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var je=Ct.length;return he&&C(Ct,St,0,je-1,this._compare),this._root=T(null,Ct,St,0,je),this._size=je,this},_.prototype.min=function(){var Ct=this.minNode(this._root);return Ct?Ct.key:null},_.prototype.max=function(){var Ct=this.maxNode(this._root);return Ct?Ct.key:null},_.prototype.isEmpty=function(){return this._root===null},S.size.get=function(){return this._size},_.createTree=function(Ct,St,he,je,de){return new _(he,de).load(Ct,St,je)},Object.defineProperties(_.prototype,S);var L=0,k=1,F=2,V=3,U=0,$=1,Z=2,Q=3;function et(Ct,St,he){St===null?(Ct.inOut=!1,Ct.otherInOut=!0):(Ct.isSubject===St.isSubject?(Ct.inOut=!St.inOut,Ct.otherInOut=St.otherInOut):(Ct.inOut=!St.otherInOut,Ct.otherInOut=St.isVertical()?!St.inOut:St.inOut),St&&(Ct.prevInResult=!nt(St,he)||St.isVertical()?St.prevInResult:St));var je=nt(Ct,he);Ct.resultTransition=je?function(de,Je){var vi,gi=!de.inOut,Ji=!de.otherInOut;switch(Je){case U:vi=gi&&Ji;break;case $:vi=gi||Ji;break;case Q:vi=gi^Ji;break;case Z:vi=de.isSubject?gi&&!Ji:Ji&&!gi}return vi?1:-1}(Ct,he):0}function nt(Ct,St){switch(Ct.type){case L:switch(St){case U:return!Ct.otherInOut;case $:return Ct.otherInOut;case Z:return Ct.isSubject&&Ct.otherInOut||!Ct.isSubject&&!Ct.otherInOut;case Q:return!0}break;case F:return St===U||St===$;case V:return St===Z;case k:return!1}return!1}var dt=function(Ct,St,he,je,de){this.left=St,this.point=Ct,this.otherEvent=he,this.isSubject=je,this.type=de||L,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},mt={inResult:{configurable:!0}};function yt(Ct,St){return Ct[0]===St[0]&&Ct[1]===St[1]}dt.prototype.isBelow=function(Ct){var St=this.point,he=this.otherEvent.point;return this.left?(St[0]-Ct[0])*(he[1]-Ct[1])-(he[0]-Ct[0])*(St[1]-Ct[1])>0:(he[0]-Ct[0])*(St[1]-Ct[1])-(St[0]-Ct[0])*(he[1]-Ct[1])>0},dt.prototype.isAbove=function(Ct){return!this.isBelow(Ct)},dt.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},mt.inResult.get=function(){return this.resultTransition!==0},dt.prototype.clone=function(){var Ct=new dt(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ct.contourId=this.contourId,Ct.resultTransition=this.resultTransition,Ct.prevInResult=this.prevInResult,Ct.isExteriorRing=this.isExteriorRing,Ct.inOut=this.inOut,Ct.otherInOut=this.otherInOut,Ct},Object.defineProperties(dt.prototype,mt);var Lt=11102230246251565e-32,It=134217729,Ot=(3+8*Lt)*Lt;function Ut(Ct,St,he,je,de){var Je,vi,gi,Ji,Ri=St[0],di=je[0],zr=0,ln=0;di>Ri==di>-Ri?(Je=Ri,Ri=St[++zr]):(Je=di,di=je[++ln]);var Oi=0;if(zr<Ct&&ln<he)for(di>Ri==di>-Ri?(gi=Je-((vi=Ri+Je)-Ri),Ri=St[++zr]):(gi=Je-((vi=di+Je)-di),di=je[++ln]),Je=vi,gi!==0&&(de[Oi++]=gi);zr<Ct&&ln<he;)di>Ri==di>-Ri?(gi=Je-((vi=Je+Ri)-(Ji=vi-Je))+(Ri-Ji),Ri=St[++zr]):(gi=Je-((vi=Je+di)-(Ji=vi-Je))+(di-Ji),di=je[++ln]),Je=vi,gi!==0&&(de[Oi++]=gi);for(;zr<Ct;)gi=Je-((vi=Je+Ri)-(Ji=vi-Je))+(Ri-Ji),Ri=St[++zr],Je=vi,gi!==0&&(de[Oi++]=gi);for(;ln<he;)gi=Je-((vi=Je+di)-(Ji=vi-Je))+(di-Ji),di=je[++ln],Je=vi,gi!==0&&(de[Oi++]=gi);return Je===0&&Oi!==0||(de[Oi++]=Je),Oi}function Ht(Ct){return new Float64Array(Ct)}var se=33306690738754716e-32,Kt=22204460492503146e-32,ue=11093356479670487e-47,me=Ht(4),Te=Ht(8),Be=Ht(12),De=Ht(16),_e=Ht(4);function Ee(Ct,St,he){var je=function(de,Je,vi,gi,Ji,Ri){var di=(Je-Ri)*(vi-Ji),zr=(de-Ji)*(gi-Ri),ln=di-zr;if(di===0||zr===0||di>0!=zr>0)return ln;var Oi=Math.abs(di+zr);return Math.abs(ln)>=se*Oi?ln:-function(Mr,un,Yr,qn,Cn,mn,rn){var Nr,Qi,Vr,vn,ki,Lr,Mn,ta,ua,Pa,En,Sa,Is,Ta,il,Po,Gl,Cs,rl=Mr-Cn,Lo=Yr-Cn,nl=un-mn,Hl=qn-mn;me[0]=(il=(ta=rl-(Mn=(Lr=It*rl)-(Lr-rl)))*(Pa=Hl-(ua=(Lr=It*Hl)-(Lr-Hl)))-((Ta=rl*Hl)-Mn*ua-ta*ua-Mn*Pa))-((En=il-(Gl=(ta=nl-(Mn=(Lr=It*nl)-(Lr-nl)))*(Pa=Lo-(ua=(Lr=It*Lo)-(Lr-Lo)))-((Po=nl*Lo)-Mn*ua-ta*ua-Mn*Pa)))+(ki=il-En))+(ki-Gl),me[1]=(Is=Ta-((Sa=Ta+En)-(ki=Sa-Ta))+(En-ki))-((En=Is-Po)+(ki=Is-En))+(ki-Po),me[2]=Sa-((Cs=Sa+En)-(ki=Cs-Sa))+(En-ki),me[3]=Cs;var ao=function(Nf,Gc){for(var j2=Gc[0],hy=1;hy<4;hy++)j2+=Gc[hy];return j2}(0,me),ts=Kt*rn;if(ao>=ts||-ao>=ts||(Nr=Mr-(rl+(ki=Mr-rl))+(ki-Cn),Vr=Yr-(Lo+(ki=Yr-Lo))+(ki-Cn),Qi=un-(nl+(ki=un-nl))+(ki-mn),vn=qn-(Hl+(ki=qn-Hl))+(ki-mn),Nr===0&&Qi===0&&Vr===0&&vn===0)||(ts=ue*rn+Ot*Math.abs(ao),(ao+=rl*vn+Hl*Nr-(nl*Vr+Lo*Qi))>=ts||-ao>=ts))return ao;_e[0]=(il=(ta=Nr-(Mn=(Lr=It*Nr)-(Lr-Nr)))*(Pa=Hl-(ua=(Lr=It*Hl)-(Lr-Hl)))-((Ta=Nr*Hl)-Mn*ua-ta*ua-Mn*Pa))-((En=il-(Gl=(ta=Qi-(Mn=(Lr=It*Qi)-(Lr-Qi)))*(Pa=Lo-(ua=(Lr=It*Lo)-(Lr-Lo)))-((Po=Qi*Lo)-Mn*ua-ta*ua-Mn*Pa)))+(ki=il-En))+(ki-Gl),_e[1]=(Is=Ta-((Sa=Ta+En)-(ki=Sa-Ta))+(En-ki))-((En=Is-Po)+(ki=Is-En))+(ki-Po),_e[2]=Sa-((Cs=Sa+En)-(ki=Cs-Sa))+(En-ki),_e[3]=Cs;var Uc=Ut(4,me,4,_e,Te);_e[0]=(il=(ta=rl-(Mn=(Lr=It*rl)-(Lr-rl)))*(Pa=vn-(ua=(Lr=It*vn)-(Lr-vn)))-((Ta=rl*vn)-Mn*ua-ta*ua-Mn*Pa))-((En=il-(Gl=(ta=nl-(Mn=(Lr=It*nl)-(Lr-nl)))*(Pa=Vr-(ua=(Lr=It*Vr)-(Lr-Vr)))-((Po=nl*Vr)-Mn*ua-ta*ua-Mn*Pa)))+(ki=il-En))+(ki-Gl),_e[1]=(Is=Ta-((Sa=Ta+En)-(ki=Sa-Ta))+(En-ki))-((En=Is-Po)+(ki=Is-En))+(ki-Po),_e[2]=Sa-((Cs=Sa+En)-(ki=Cs-Sa))+(En-ki),_e[3]=Cs;var Ff=Ut(Uc,Te,4,_e,Be);_e[0]=(il=(ta=Nr-(Mn=(Lr=It*Nr)-(Lr-Nr)))*(Pa=vn-(ua=(Lr=It*vn)-(Lr-vn)))-((Ta=Nr*vn)-Mn*ua-ta*ua-Mn*Pa))-((En=il-(Gl=(ta=Qi-(Mn=(Lr=It*Qi)-(Lr-Qi)))*(Pa=Vr-(ua=(Lr=It*Vr)-(Lr-Vr)))-((Po=Qi*Vr)-Mn*ua-ta*ua-Mn*Pa)))+(ki=il-En))+(ki-Gl),_e[1]=(Is=Ta-((Sa=Ta+En)-(ki=Sa-Ta))+(En-ki))-((En=Is-Po)+(ki=Is-En))+(ki-Po),_e[2]=Sa-((Cs=Sa+En)-(ki=Cs-Sa))+(En-ki),_e[3]=Cs;var cy=Ut(Ff,Be,4,_e,De);return De[cy-1]}(de,Je,vi,gi,Ji,Ri,Oi)}(Ct[0],Ct[1],St[0],St[1],he[0],he[1]);return je>0?-1:je<0?1:0}function ae(Ct,St){var he=Ct.point,je=St.point;return he[0]>je[0]?1:he[0]<je[0]?-1:he[1]!==je[1]?he[1]>je[1]?1:-1:function(de,Je,vi,gi){return de.left!==Je.left?de.left?1:-1:Ee(vi,de.otherEvent.point,Je.otherEvent.point)!==0?de.isBelow(Je.otherEvent.point)?-1:1:!de.isSubject&&Je.isSubject?1:-1}(Ct,St,he)}function re(Ct,St,he){var je=new dt(St,!1,Ct,Ct.isSubject),de=new dt(St,!0,Ct.otherEvent,Ct.isSubject);return yt(Ct.point,Ct.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ct),je.contourId=de.contourId=Ct.contourId,ae(de,Ct.otherEvent)>0&&(Ct.otherEvent.left=!0,de.left=!1),Ct.otherEvent.otherEvent=de,Ct.otherEvent=je,he.push(de),he.push(je),he}function Ie(Ct,St){return Ct[0]*St[1]-Ct[1]*St[0]}function Re(Ct,St){return Ct[0]*St[0]+Ct[1]*St[1]}function we(Ct,St,he){var je=function(Ji,Ri,di,zr,ln){var Oi=[Ri[0]-Ji[0],Ri[1]-Ji[1]],Mr=[zr[0]-di[0],zr[1]-di[1]];function un(Lr,Mn,ta){return[Lr[0]+Mn*ta[0],Lr[1]+Mn*ta[1]]}var Yr=[di[0]-Ji[0],di[1]-Ji[1]],qn=Ie(Oi,Mr),Cn=qn*qn,mn=Re(Oi,Oi);if(Cn>0){var rn=Ie(Yr,Mr)/qn;if(rn<0||rn>1)return null;var Nr=Ie(Yr,Oi)/qn;return Nr<0||Nr>1?null:rn===0||rn===1?[un(Ji,rn,Oi)]:Nr===0||Nr===1?[un(di,Nr,Mr)]:[un(Ji,rn,Oi)]}if((Cn=(qn=Ie(Yr,Oi))*qn)>0)return null;var Qi=Re(Oi,Yr)/mn,Vr=Qi+Re(Oi,Mr)/mn,vn=Math.min(Qi,Vr),ki=Math.max(Qi,Vr);return vn<=1&&ki>=0?vn===1?[un(Ji,vn>0?vn:0,Oi)]:ki===0?[un(Ji,ki<1?ki:1,Oi)]:[un(Ji,vn>0?vn:0,Oi),un(Ji,ki<1?ki:1,Oi)]:null}(Ct.point,Ct.otherEvent.point,St.point,St.otherEvent.point),de=je?je.length:0;if(de===0||de===1&&(yt(Ct.point,St.point)||yt(Ct.otherEvent.point,St.otherEvent.point))||de===2&&Ct.isSubject===St.isSubject)return 0;if(de===1)return yt(Ct.point,je[0])||yt(Ct.otherEvent.point,je[0])||re(Ct,je[0],he),yt(St.point,je[0])||yt(St.otherEvent.point,je[0])||re(St,je[0],he),1;var Je=[],vi=!1,gi=!1;return yt(Ct.point,St.point)?vi=!0:ae(Ct,St)===1?Je.push(St,Ct):Je.push(Ct,St),yt(Ct.otherEvent.point,St.otherEvent.point)?gi=!0:ae(Ct.otherEvent,St.otherEvent)===1?Je.push(St.otherEvent,Ct.otherEvent):Je.push(Ct.otherEvent,St.otherEvent),vi&&gi||vi?(St.type=k,Ct.type=St.inOut===Ct.inOut?F:V,vi&&!gi&&re(Je[1].otherEvent,Je[0].point,he),2):gi?(re(Je[0],Je[1].point,he),3):Je[0]!==Je[3].otherEvent?(re(Je[0],Je[1].point,he),re(Je[1],Je[2].point,he),3):(re(Je[0],Je[1].point,he),re(Je[3].otherEvent,Je[2].point,he),3)}function si(Ct,St){if(Ct===St)return 0;if(Ee(Ct.point,Ct.otherEvent.point,St.point)!==0||Ee(Ct.point,Ct.otherEvent.point,St.otherEvent.point)!==0)return yt(Ct.point,St.point)?Ct.isBelow(St.otherEvent.point)?-1:1:Ct.point[0]===St.point[0]?Ct.point[1]<St.point[1]?-1:1:ae(Ct,St)===1?St.isAbove(Ct.point)?-1:1:Ct.isBelow(St.point)?-1:1;if(Ct.isSubject!==St.isSubject)return Ct.isSubject?-1:1;var he=Ct.point,je=St.point;return he[0]===je[0]&&he[1]===je[1]?(he=Ct.otherEvent.point)[0]===(je=St.otherEvent.point)[0]&&he[1]===je[1]?0:Ct.contourId>St.contourId?1:-1:ae(Ct,St)===1?1:-1}var ci=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ri(Ct,St,he,je){var de,Je=Ct+1,vi=St[Ct].point,gi=St.length;for(Je<gi&&(de=St[Je].point);Je<gi&&de[0]===vi[0]&&de[1]===vi[1];){if(!he[Je])return Je;++Je<gi&&(de=St[Je].point)}for(Je=Ct-1;he[Je]&&Je>je;)Je--;return Je}ci.prototype.isExterior=function(){return this.holeOf==null};var Xe=Qe,ji=Qe;function Qe(Ct,St){if(!(this instanceof Qe))return new Qe(Ct,St);if(this.data=Ct||[],this.length=this.data.length,this.compare=St||Ci,this.length>0)for(var he=(this.length>>1)-1;he>=0;he--)this._down(he)}function Ci(Ct,St){return Ct<St?-1:Ct>St?1:0}Qe.prototype={push:function(Ct){this.data.push(Ct),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ct=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ct}},peek:function(){return this.data[0]},_up:function(Ct){for(var St=this.data,he=this.compare,je=St[Ct];Ct>0;){var de=Ct-1>>1,Je=St[de];if(he(je,Je)>=0)break;St[Ct]=Je,Ct=de}St[Ct]=je},_down:function(Ct){for(var St=this.data,he=this.compare,je=this.length>>1,de=St[Ct];Ct<je;){var Je=1+(Ct<<1),vi=Je+1,gi=St[Je];if(vi<this.length&&he(St[vi],gi)<0&&(Je=vi,gi=St[vi]),he(gi,de)>=0)break;St[Ct]=gi,Ct=Je}St[Ct]=de}},Xe.default=ji;var Zi=Math.max,fr=Math.min,Pr=0;function qi(Ct,St,he,je,de,Je){var vi,gi,Ji,Ri,di,zr;for(vi=0,gi=Ct.length-1;vi<gi;vi++)if(Ri=Ct[vi+1],di=new dt(Ji=Ct[vi],!1,void 0,St),zr=new dt(Ri,!1,di,St),di.otherEvent=zr,Ji[0]!==Ri[0]||Ji[1]!==Ri[1]){di.contourId=zr.contourId=he,Je||(di.isExteriorRing=!1,zr.isExteriorRing=!1),ae(di,zr)>0?zr.left=!0:di.left=!0;var ln=Ji[0],Oi=Ji[1];de[0]=fr(de[0],ln),de[1]=fr(de[1],Oi),de[2]=Zi(de[2],ln),de[3]=Zi(de[3],Oi),je.push(di),je.push(zr)}}var Br=[];function Fr(Ct,St,he){typeof Ct[0][0][0]=="number"&&(Ct=[Ct]),typeof St[0][0][0]=="number"&&(St=[St]);var je=function(Oi,Mr,un){var Yr=null;return Oi.length*Mr.length==0&&(un===U?Yr=Br:un===Z?Yr=Oi:un!==$&&un!==Q||(Yr=Oi.length===0?Mr:Oi)),Yr}(Ct,St,he);if(je)return je===Br?null:je;var de=[1/0,1/0,-1/0,-1/0],Je=[1/0,1/0,-1/0,-1/0],vi=function(Oi,Mr,un,Yr,qn){var Cn,mn,rn,Nr,Qi,Vr,vn=new Xe(null,ae);for(rn=0,Nr=Oi.length;rn<Nr;rn++)for(Qi=0,Vr=(Cn=Oi[rn]).length;Qi<Vr;Qi++)(mn=Qi===0)&&Pr++,qi(Cn[Qi],!0,Pr,vn,un,mn);for(rn=0,Nr=Mr.length;rn<Nr;rn++)for(Qi=0,Vr=(Cn=Mr[rn]).length;Qi<Vr;Qi++)mn=Qi===0,qn===Z&&(mn=!1),mn&&Pr++,qi(Cn[Qi],!1,Pr,vn,Yr,mn);return vn}(Ct,St,de,Je,he);if(je=function(Oi,Mr,un,Yr,qn){var Cn=null;return(un[0]>Yr[2]||Yr[0]>un[2]||un[1]>Yr[3]||Yr[1]>un[3])&&(qn===U?Cn=Br:qn===Z?Cn=Oi:qn!==$&&qn!==Q||(Cn=Oi.concat(Mr))),Cn}(Ct,St,de,Je,he))return je===Br?null:je;for(var gi=function(Oi){var Mr,un,Yr=function(rn){var Nr,Qi,Vr,vn,ki=[];for(Qi=0,Vr=rn.length;Qi<Vr;Qi++)((Nr=rn[Qi]).left&&Nr.inResult||!Nr.left&&Nr.otherEvent.inResult)&&ki.push(Nr);for(var Lr=!1;!Lr;)for(Lr=!0,Qi=0,Vr=ki.length;Qi<Vr;Qi++)Qi+1<Vr&&ae(ki[Qi],ki[Qi+1])===1&&(vn=ki[Qi],ki[Qi]=ki[Qi+1],ki[Qi+1]=vn,Lr=!1);for(Qi=0,Vr=ki.length;Qi<Vr;Qi++)(Nr=ki[Qi]).otherPos=Qi;for(Qi=0,Vr=ki.length;Qi<Vr;Qi++)(Nr=ki[Qi]).left||(vn=Nr.otherPos,Nr.otherPos=Nr.otherEvent.otherPos,Nr.otherEvent.otherPos=vn);return ki}(Oi),qn={},Cn=[],mn=function(){if(!qn[Mr]){var rn=Cn.length,Nr=function(ki,Lr,Mn){var ta=new ci;if(ki.prevInResult!=null){var ua=ki.prevInResult,Pa=ua.outputContourId;if(ua.resultTransition>0){var En=Lr[Pa];if(En.holeOf!=null){var Sa=En.holeOf;Lr[Sa].holeIds.push(Mn),ta.holeOf=Sa,ta.depth=Lr[Pa].depth}else Lr[Pa].holeIds.push(Mn),ta.holeOf=Pa,ta.depth=Lr[Pa].depth+1}else ta.holeOf=null,ta.depth=Lr[Pa].depth}else ta.holeOf=null,ta.depth=0;return ta}(Yr[Mr],Cn,rn),Qi=function(ki){qn[ki]=!0,ki<Yr.length&&Yr[ki]&&(Yr[ki].outputContourId=rn)},Vr=Mr,vn=Mr;for(Nr.points.push(Yr[Mr].point);Qi(Vr),Qi(Vr=Yr[Vr].otherPos),Nr.points.push(Yr[Vr].point),!((Vr=ri(Vr,Yr,qn,vn))==vn||Vr>=Yr.length)&&Yr[Vr];);Cn.push(Nr)}};for(Mr=0,un=Yr.length;Mr<un;Mr++)mn();return Cn}(function(Oi,Mr,un,Yr,qn,Cn){for(var mn,rn,Nr,Qi=new _(si),Vr=[],vn=Math.min(Yr[2],qn[2]);Oi.length!==0;){var ki=Oi.pop();if(Vr.push(ki),Cn===U&&ki.point[0]>vn||Cn===Z&&ki.point[0]>Yr[2])break;if(ki.left){rn=mn=Qi.insert(ki),mn=mn!==(Nr=Qi.minNode())?Qi.prev(mn):null,rn=Qi.next(rn);var Lr=mn?mn.key:null;if(et(ki,Lr,Cn),rn&&we(ki,rn.key,Oi)===2&&(et(ki,Lr,Cn),et(rn.key,ki,Cn)),mn&&we(mn.key,ki,Oi)===2){var Mn=mn;et(Lr,(Mn=Mn!==Nr?Qi.prev(Mn):null)?Mn.key:null,Cn),et(ki,Lr,Cn)}}else rn=mn=Qi.find(ki=ki.otherEvent),mn&&rn&&(mn=mn!==Nr?Qi.prev(mn):null,rn=Qi.next(rn),Qi.remove(ki),rn&&mn&&we(mn.key,rn.key,Oi))}return Vr}(vi,0,0,de,Je,he)),Ji=[],Ri=0;Ri<gi.length;Ri++){var di=gi[Ri];if(di.isExterior()){for(var zr=[di.points],ln=0;ln<di.holeIds.length;ln++)zr.push(gi[di.holeIds[ln]].points);Ji.push(zr)}}return Ji}var Fn={UNION:$,DIFFERENCE:Z,INTERSECTION:U,XOR:Q};h.diff=function(Ct,St){return Fr(Ct,St,Z)},h.intersection=function(Ct,St){return Fr(Ct,St,U)},h.operations=Fn,h.union=function(Ct,St){return Fr(Ct,St,$)},h.xor=function(Ct,St){return Fr(Ct,St,Q)},Object.defineProperty(h,"__esModule",{value:!0})})(l)}(0,m5.exports)),m5.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function i2(d,l,h,m){const _=[],S=m===0?(T,C,L,k,F,V)=>{T.push(new Me(V,L+(V-C)/(k-C)*(F-L)))}:(T,C,L,k,F,V)=>{T.push(new Me(C+(V-L)/(F-L)*(k-C),V))};for(const T of d){const C=[];for(const L of T){if(L.length<=2)continue;const k=[];for(let U=0;U<L.length-1;U++){const $=L[U].x,Z=L[U].y,Q=L[U+1].x,et=L[U+1].y,nt=m===0?$:Z,dt=m===0?Q:et;nt<l?dt>l&&S(k,$,Z,Q,et,l):nt>h?dt<h&&S(k,$,Z,Q,et,h):k.push(L[U]),dt<l&&nt>=l&&S(k,$,Z,Q,et,l),dt>h&&nt<=h&&S(k,$,Z,Q,et,h)}let F=L[L.length-1];const V=m===0?F.x:F.y;V>=l&&V<=h&&k.push(F),k.length&&(F=k[k.length-1],k[0].x===F.x&&k[0].y===F.y||k.push(k[0]),C.push(k))}C.length&&_.push(C)}return _}function Ant(d,l){const h=LD(d),m=LD([l]),_=v5.intersection(h,m);return _==null?[]:_5(_)}function Int(d,l){let m=LD(d,65536);const _=[];for(;l.valid();l.next()){const[S,T]=l.get(),C=S.x*65536,L=S.y*65536,k=T.x*65536,F=T.y*65536,V=k-C,U=F-L,$=Math.hypot(V,U);if($===0)continue;const Z=Math.trunc(U/$*3),Q=-Math.trunc(V/$*3);_.push([[[C,L],[k,F],[k+Z,F+Q],[C+Z,L+Q],[C,L]]])}return _.length>0&&(m=v5.diff(m,_)),_5(m,1/65536)}function LD(d,l=1){return[d.map(h=>h.map(m=>[m.x*l,m.y*l]))]}function _5(d,l=1){return d.map(h=>h.map((m,_)=>{const S=m.map(T=>new Me(T[0]*l,T[1]*l).round());return _>0&&S.reverse(),S}))}class RD{constructor(l,h){this.layoutVertexArray=new hs,this.indexArray=new Ln,this.lineIndexArray=new Al,this.triangleSegments=new Un,this.lineSegments=new Un,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.uploaded=!1,h&&(this.elevatedLayoutVertexArray=new qu)}update(l,h,m,_,S,T,C,L){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C,L)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,cnt.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.lineIndexBuffer=l.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=l.createVertexBuffer(this.elevatedLayoutVertexArray,hnt.members))),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(l,h,m,_,S,T,C){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,h,m,_,S,T,void 0,C)}}class kD{constructor(l){this.zoom=l.zoom,this.pixelRatio=l.pixelRatio,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=l.lut,this.bufferData=new RD(l,!1),this.elevationBufferData=new RD(l,!0),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.projection=l.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=l.sourceLayerIndex,this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.hasPattern=DD("fill",this.layers,this.pixelRatio,h);const S=this.layers[0].layout.get("fill-sort-key"),T=[];for(const{feature:C,id:L,index:k,sourceLayerIndex:F}of l){const V=this.layers[0]._featureFilter.needGeometry,U=ee(C,V);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),U,m))continue;const $=S?S.evaluate(U,{},m,h.availableImages):void 0,Z={id:L,properties:C.properties,type:C.type,sourceLayerIndex:F,index:k,geometry:V?U.geometry:pe(C,m,_),patterns:{},sortKey:$};T.push(Z)}S&&T.sort((C,L)=>C.sortKey-L.sortKey);for(const C of T){const{geometry:L,index:k,sourceLayerIndex:F}=C;if(this.hasPattern){const V=PD("fill",this.layers,C,this.zoom,this.pixelRatio,h);this.patternFeatures.push(V)}else this.addFeature(C,L,k,m,{},h.availableImages,h.brightness,h.elevationFeatures);h.featureIndex.insert(l[k].feature,L,k,F,this.index)}}update(l,h,m,_,S,T,C){this.bufferData.update(l,h,m,_,S,T,C,this.worldview),this.elevationBufferData.update(l,h,m,_,S,T,C,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(l,h,m,_,S,T,C,this.worldview)}addFeatures(l,h,m,_,S,T){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,h,m,_,T,l.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(l){this.bufferData.upload(l),this.elevationBufferData.upload(l),this.elevatedStructures&&this.elevatedStructures.upload(l)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(l,h,m,_,S,T=[],C,L){const k=T1(h,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(l,k,_,m,L):this.addGeometry(k,this.bufferData),this.bufferData.populatePaintArrays(l,m,S,T,_,C,this.worldview),this.elevationBufferData.populatePaintArrays(l,m,S,T,_,C,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(l,h,m,_,S){this.elevatedStructures&&(this.elevatedStructures.construct(l),this.elevatedStructures.populatePaintArrays(h,m,_,S,this.worldview))}addElevatedRoadFeature(l,h,m,_,S){const T=new Array,C=Hi.getElevationFeature(l,S);if(!C)return void this.addGeometry(h,this.bufferData);{const k=this.clipPolygonsToTile(h,1);k.length>0&&T.push({polygons:k,elevationFeature:C,elevationTileID:m})}const L={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(l,{},m),featureIndex:_};for(const k of T)if(k.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new tl(k.elevationTileID,this.layers,this.zoom,this.lut));const V=k.elevationFeature.isTunnel();let U=0;l.properties.hasOwnProperty(oi)&&(U=+l.properties[oi]);for(const $ of k.polygons)this.elevatedStructures.addPortalCandidates(k.elevationFeature.id,$,V,k.elevationFeature,U)}k.elevationFeature.constantHeight==null&&(k.polygons=this.prepareElevatedPolygons(k.polygons,k.elevationFeature,k.elevationTileID));const F=new Dr(m,k.elevationTileID);this.addElevatedGeometry(k.polygons,F,k.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,_,L)}}addElevatedGeometry(l,h,m,_,S,T){const C={elevation:m,elevationSampler:h,bias:_,index:S,featureInfo:T},[L,k]=this.addGeometry(l,this.elevationBufferData,C);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:L,max:k}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,L),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,k))}addGeometry(l,h,m){let _=Number.POSITIVE_INFINITY,S=Number.NEGATIVE_INFINITY,T=null;m&&(T=m.elevationSampler.constantElevation(m.elevation,m.bias),T!=null&&(_=T,S=T));const C=(L,k,F)=>{if(m!=null)if(k.push(L),T!=null)h.elevatedLayoutVertexArray.emplaceBack(T),F.push(T);else{const V=m.elevationSampler.pointElevation(L,m.elevation,m.bias);h.elevatedLayoutVertexArray.emplaceBack(V),F.push(V),_=Math.min(_,V),S=Math.max(S,V)}};for(const L of l){let k=0;for(const mt of L)k+=mt.length;const F=h.triangleSegments.prepareSegment(k,h.layoutVertexArray,h.indexArray),V=F.vertexLength,U=[],$=[],Z=[],Q=[],et=[],nt=h.layoutVertexArray.length;for(const mt of L){if(mt.length===0)continue;mt!==L[0]&&$.push(U.length/2);const yt=h.lineSegments.prepareSegment(mt.length,h.layoutVertexArray,h.lineIndexArray),Lt=yt.vertexLength;m&&et.push(h.layoutVertexArray.length-nt),C(mt[0],Z,Q),h.layoutVertexArray.emplaceBack(mt[0].x,mt[0].y),h.lineIndexArray.emplaceBack(Lt+mt.length-1,Lt),U.push(mt[0].x),U.push(mt[0].y);for(let It=1;It<mt.length;It++)C(mt[It],Z,Q),h.layoutVertexArray.emplaceBack(mt[It].x,mt[It].y),h.lineIndexArray.emplaceBack(Lt+It-1,Lt+It),U.push(mt[It].x),U.push(mt[It].y);yt.vertexLength+=mt.length,yt.primitiveLength+=mt.length}const dt=W_(U,$);for(let mt=0;mt<dt.length;mt+=3)h.indexArray.emplaceBack(V+dt[mt],V+dt[mt+1],V+dt[mt+2]);if(dt.length>0&&m&&this.elevationMode==="hd-road-base"){const mt=m.elevation.isTunnel(),yt=m.elevation.safeArea,Lt=this.elevatedStructures.addVertices(Z,Q);this.elevatedStructures.addTriangles(dt,Lt,mt);const It=et.length;if(It>0){for(let Ot=0;Ot<It-1;Ot++)this.elevatedStructures.addRenderableRing(m.index,et[Ot]+Lt,et[Ot+1]-et[Ot],mt,yt,m.featureInfo);this.elevatedStructures.addRenderableRing(m.index,et[It-1]+Lt,Z.length-et[It-1],mt,yt,m.featureInfo)}}F.vertexLength+=k,F.primitiveLength+=dt.length/3}return[_,S]}prepareElevatedPolygons(l,h,m){const _=1/kt(m),S=[];for(const T of l){const C=Int(T,new wn(h,_));S.push(...C)}return S}clipPolygonsToTile(l,h){const m=-h,_=-h,S=Ve+h,T=Ve+h;let C=0;const L=[],k=[];for(;C<l.length;C++){const U=l[C],$=_g(U);($.min.x>=m&&$.max.x<=S&&$.min.y>=_&&$.max.y<=T?L:k).push(U)}if(L.length===l.length)return l;const F=[new Me(m,_),new Me(S,_),new Me(S,T),new Me(m,T),new Me(m,_)],V=L;for(const U of k)V.push(...Ant(U,F));return V}}let y5,x5,b5,w5;li(kD,"FillBucket",{omit:["layers","patternFeatures"]}),li(RD,"FillBufferData"),li(tl,"ElevatedStructures");class r2{constructor(l,h,m,_){if(this.triangleCount=h.length/3,this.min=new Me(0,0),this.max=new Me(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||l.length===0)return;const[S,T]=[l[0].clone(),l[0].clone()];for(let V=1;V<l.length;++V){const U=l[V];S.x=Math.min(S.x,U.x),S.y=Math.min(S.y,U.y),T.x=Math.max(T.x,U.x),T.y=Math.max(T.y,U.y)}if(_){const V=Math.ceil(Math.max(T.x-S.x,T.y-S.y)/_);m=Math.max(m,V)}if(m===0)return;this.min=S,this.max=T;const C=this.max.sub(this.min);C.x=Math.max(C.x,1),C.y=Math.max(C.y,1);const L=Math.max(C.x,C.y)/m;this.cellsX=Math.max(1,Math.ceil(C.x/L)),this.cellsY=Math.max(1,Math.ceil(C.y/L)),this.xScale=1/L,this.yScale=1/L;const k=[];for(let V=0;V<this.triangleCount;V++){const U=l[h[3*V+0]].sub(this.min),$=l[h[3*V+1]].sub(this.min),Z=l[h[3*V+2]].sub(this.min),Q=Nc(Math.floor(Math.min(U.x,$.x,Z.x)),this.xScale,this.cellsX),et=Nc(Math.floor(Math.max(U.x,$.x,Z.x)),this.xScale,this.cellsX),nt=Nc(Math.floor(Math.min(U.y,$.y,Z.y)),this.yScale,this.cellsY),dt=Nc(Math.floor(Math.max(U.y,$.y,Z.y)),this.yScale,this.cellsY),mt=new Me(0,0),yt=new Me(0,0),Lt=new Me(0,0),It=new Me(0,0);for(let Ot=nt;Ot<=dt;++Ot){mt.y=yt.y=Ot*L,Lt.y=It.y=(Ot+1)*L;for(let Ut=Q;Ut<=et;++Ut)mt.x=Lt.x=Ut*L,yt.x=It.x=(Ut+1)*L,(la(U,$,Z,mt,yt,It)||la(U,$,Z,mt,It,Lt))&&k.push({cellIdx:Ot*this.cellsX+Ut,triIdx:V})}}if(k.length===0)return;k.sort((V,U)=>V.cellIdx-U.cellIdx||V.triIdx-U.triIdx);let F=0;for(;F<k.length;){const V=k[F].cellIdx,U={start:this.payload.length,len:0};for(;F<k.length&&k[F].cellIdx===V;)++U.len,this.payload.push(k[F++].triIdx);this.cells[V]=U}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(l,h){if(this.triangleCount===0||this.cells.length===0||l.x>this.max.x||this.min.x>l.x||l.y>this.max.y||this.min.y>l.y)return;const m=Nc(l.x-this.min.x,this.xScale,this.cellsX),_=Nc(l.y-this.min.y,this.yScale,this.cellsY),S=this.cells[_*this.cellsX+m];if(S){this._lazyInitLookup();for(let T=0;T<S.len;T++){const C=this.payload[S.start+T],L=Math.floor(C/8),k=1<<C%8;if(!(this.lookup[L]&k)&&(this.lookup[L]|=k,h.push(C),h.length===this.triangleCount))return}}}query(l,h,m){if(this.triangleCount===0||this.cells.length===0||l.x>this.max.x||this.min.x>h.x||l.y>this.max.y||this.min.y>h.y)return;this._lazyInitLookup();const _=Nc(l.x-this.min.x,this.xScale,this.cellsX),S=Nc(h.x-this.min.x,this.xScale,this.cellsX),T=Nc(l.y-this.min.y,this.yScale,this.cellsY),C=Nc(h.y-this.min.y,this.yScale,this.cellsY);for(let L=T;L<=C;L++)for(let k=_;k<=S;k++){const F=this.cells[L*this.cellsX+k];if(F)for(let V=0;V<F.len;V++){const U=this.payload[F.start+V],$=Math.floor(U/8),Z=1<<U%8;if(!(this.lookup[$]&Z)&&(this.lookup[$]|=Z,m.push(U),m.length===this.triangleCount))return}}}}function Nc(d,l,h){return Math.max(0,Math.min(h-1,Math.floor(d*l)))}li(r2,"TriangleGridIndex");class S5{constructor(l){this.zoom=l.zoom,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.footprints=[],this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){for(const m of this.footprints)h.push({footprint:m,id:l})}updateAppearances(l,h,m,_){}populate(l,h,m,_){const S=[];for(const{feature:T,id:C,index:L,sourceLayerIndex:k}of l){const F=this.layers[0]._featureFilter.needGeometry,V=ee(T,F);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),V,m))continue;const U={id:C,properties:T.properties,type:T.type,sourceLayerIndex:k,index:L,geometry:F?V.geometry:pe(T,m,_),patterns:{}};S.push(U)}for(const T of S){const{geometry:C,index:L,sourceLayerIndex:k}=T;this.addFeature(T,C,L,m,{},h.availableImages,h.brightness),h.featureIndex.insert(l[L].feature,C,L,k,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(l){}update(l,h,m,_,S,T,C){}destroy(){}addFeature(l,h,m,_,S,T=[],C){for(const L of T1(h,2)){const k=[],F=[],V=[],U=new Me(1/0,1/0),$=new Me(-1/0,-1/0);for(const et of L)if(et.length!==0){et!==L[0]&&V.push(F.length/2);for(let nt=0;nt<et.length;nt++)F.push(et[nt].x),F.push(et[nt].y),k.push(et[nt]),U.x=Math.min(U.x,et[nt].x),U.y=Math.min(U.y,et[nt].y),$.x=Math.max($.x,et[nt].x),$.y=Math.max($.y,et[nt].y)}const Z=W_(F,V),Q=new r2(k,Z,8,256);this.footprints.push({vertices:k,indices:Z,grid:Q,min:U,max:$})}}}li(S5,"ClipBucket",{omit:["layers"]});const Cnt=gr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Mnt=gr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ent=gr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Dnt=gr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pnt=gr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Lnt=gr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Rnt=gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:knt}=Cnt,A1=Number.MAX_SAFE_INTEGER,T5=A1-1;function A5(d,l,h,m){return d.order<l||d.order===A1||!(d.clipMask&h)||function(_,S){return S.length!==0&&S.find(T=>T===_)===void 0}(m,d.clipScope)}function n2(d,l){return d.x-l.x||d.y-l.y}function I5(d,l){return n2(d.min,l.min)===0&&n2(d.max,l.max)===0}function OD(d,l){return!(d.min.x>l.max.x||d.max.x<l.min.x||d.min.y>l.max.y||d.max.y<l.min.y)}function a2(d,l){if(d.length!==l.length)return!1;for(let h=0;h<d.length;h++)if(d[h].sourceId!==l[h].sourceId||!I5(d[h],l[h])||d[h].order!==l[h].order||d[h].clipMask!==l[h].clipMask||!Fu(d[h].clipScope,l[h].clipScope))return!1;return!0}function C5(d,l,h){const m=1/Ve,_=1/(1<<h.canonical.z),S=(l.x*m+h.canonical.x)*_+h.wrap,T=(l.y*m+h.canonical.y)*_;return{min:new Me((d.x*m+h.canonical.x)*_+h.wrap,(d.y*m+h.canonical.y)*_),max:new Me(S,T)}}function Ont(d,l,h){const m=1<<h.canonical.z,_=((l.x-h.wrap)*m-h.canonical.x)*Ve,S=(l.y*m-h.canonical.y)*Ve;return{min:new Me(((d.x-h.wrap)*m-h.canonical.x)*Ve,(d.y*m-h.canonical.y)*Ve),max:new Me(_,S)}}function zD(d,l,h,m,_,S,T){const C=d.indices,L=d.vertices,k=[];for(let F=m;F<m+_;F+=3){const V=l[h[F+0]+S],U=l[h[F+1]+S],$=l[h[F+2]+S],Z=Math.min(V.x,U.x,$.x),Q=Math.max(V.x,U.x,$.x),et=Math.min(V.y,U.y,$.y),nt=Math.max(V.y,U.y,$.y);k.length=0,d.grid.query(new Me(Z,et),new Me(Q,nt),k);for(let dt=0;dt<k.length;dt++){const mt=k[dt];if(la(L[C[3*mt+0]],L[C[3*mt+1]],L[C[3*mt+2]],V,U,$,T))return!0}}return!1}function M5(d,l,h,m){if(!d||!h)return!1;let _=d.vertices;if(!l.canonical.equals(m.canonical)||l.wrap!==m.wrap){if(h.vertices.length<d.vertices.length)return M5(h,m,d,l);const S=l.canonical,T=m.canonical,C=Math.pow(2,T.z-S.z);_=d.vertices.map(L=>new Me((L.x+S.x*Ve)*C-T.x*Ve,(L.y+S.y*Ve)*C-T.y*Ve))}return zD(h,_,d.indices,0,d.indices.length,0,0)}function E5(d,l,h,m){const _=Math.pow(2,m.z-h.z);return new Me((d+h.x*Ve)*_-m.x*Ve,(l+h.y*Ve)*_-m.y*Ve)}function BD(d,l){const h=[];l.grid.queryPoint(d,h);const m=l.indices,_=l.vertices;for(let S=0;S<h.length;S++){const T=h[S];if(qa([_[m[3*T+0]],_[m[3*T+1]],_[m[3*T+2]]],d))return!0}return!1}const FD=[new Me(0,0),new Me(Ve,0),new Me(Ve,Ve),new Me(0,Ve)];function D5(d,l){const h=[];let m=[];if(!l||d.length<2)return[d];if(d.length===2)return na(d[0],d[1],FD)?[d]:[];for(let _=0;_<d.length+2;_++){const S=d[_%d.length],T=d[(_+1)%d.length],C=na(_===0?d[d.length-1]:d[(_-1)%d.length],S,FD),L=na(S,T,FD),k=C||L;k&&m.push(S),k&&L||m.length>0&&(m.length>1&&h.push(m),m=[])}return m.length>1&&h.push(m),h}const ND=Ae.types,znt=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Bnt=["fill-extrusion-flood-light-ground-radius"],Fnt=Math.pow(2,13),Nnt=Math.pow(2,15)-1,P5=new Me(0,1),kf=2147483648,L5=7,R5=450;function I1(d,l,h,m,_,S,T,C){d.emplaceBack((l<<1)+T,(h<<1)+S,(Math.floor(m*Fnt)<<1)+_,Math.round(C))}function C1(d,l,h){d.emplaceBack(l.x*Ve,l.y*Ve,h?1:0)}function o2(d,l,h,m,_,S){d.emplaceBack(l.x,l.y,(h.x<<1)+m,(h.y<<1)+_,S)}function M1(d,l,h){d.emplaceBack(l.x,l.y,l.z,h[0]*16384,h[1]*16384,h[2]*16384)}class k5{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class O5{constructor(){this.centroidXY=new Me(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Me(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Me(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Me(this.max.x-this.min.x,this.max.y-this.min.y)}}class z5{constructor(){this.acc=new Me(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(l,h){l.min.x===Number.MAX_VALUE&&(l.min.x=l.max.x=h.x,l.min.y=l.max.y=h.y)}appendEdge(l,h,m){this.accCount++,this.acc._add(h);let _=!!this.borders;h.x<l.min.x?(l.min.x=h.x,_=!0):h.x>l.max.x&&(l.max.x=h.x,_=!0),h.y<l.min.y?(l.min.y=h.y,_=!0):h.y>l.max.y&&(l.max.y=h.y,_=!0),((h.x===0||h.x===Ve)&&h.x===m.x)!=((h.y===0||h.y===Ve)&&h.y===m.y)&&this.processBorderOverlap(h,m),_&&this.checkBorderIntersection(h,m)}checkBorderIntersection(l,h){h.x<0!=l.x<0&&this.addBorderIntersection(0,zi(h.y,l.y,(0-h.x)/(l.x-h.x))),h.x>Ve!=l.x>Ve&&this.addBorderIntersection(1,zi(h.y,l.y,(Ve-h.x)/(l.x-h.x))),h.y<0!=l.y<0&&this.addBorderIntersection(2,zi(h.x,l.x,(0-h.y)/(l.y-h.y))),h.y>Ve!=l.y>Ve&&this.addBorderIntersection(3,zi(h.x,l.x,(Ve-h.y)/(l.y-h.y)))}addBorderIntersection(l,h){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const m=this.borders[l];h<m[0]&&(m[0]=h),h>m[1]&&(m[1]=h)}processBorderOverlap(l,h){if(l.x===h.x){if(l.y===h.y)return;const m=l.x===0?0:1;this.addBorderIntersection(m,h.y),this.addBorderIntersection(m,l.y)}else{const m=l.y===0?2:3;this.addBorderIntersection(m,h.x),this.addBorderIntersection(m,l.x)}}centroid(){return this.accCount===0?new Me(0,0):new Me(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((l,h)=>l+ +(h[0]!==Number.MAX_VALUE),0):0}}function B5(d,l){const h=d.add(l)._unit(),m=lt(d.x*h.x+d.y*h.y,-1,1);var _,S,T;return _=Math.acos(m),Math.min(4,Math.max(-4,Math.tan(_)))/4*Nnt*((S=d).x*(T=l).y-S.y*T.x<0?-1:1)}const Vnt=[d=>d.x<0,d=>d.x>Ve,d=>d.y<0,d=>d.y>Ve];function Unt(d,l,h,m){const _=[4];if(m===0)return _;h._mult(m);const S=d.sub(h),T=l.sub(h),C=[d,l,S,T];for(let L=0;L<4;L++)for(const k of C)if(Vnt[L](k)){_.push(L);break}return _}class VD{constructor(l){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new D_,this.indexArray=new Ln,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut},h=>Bnt.includes(h)),this._segments=new Un,this.hiddenByLandmarkVertexArray=new B_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Un}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(l,h,m,_=!1){const S=l.length;if(S>2){let T=Math.max(0,this._segments.get().length-1);const C=this._segments._prepareSegment(4*S,this.vertexArray.length,2*this._segmentToGroundQuads[T].length);let L;T!==this._segments.get().length-1&&(T++,this._segmentToGroundQuads[T]=[],this._segmentToRegionTriCounts[T]=[0,0,0,0,0]);{const k=l[0],F=l[1];L=B5(k.sub(l[S-1])._perp()._unit(),F.sub(k)._perp()._unit())}for(let k=0;k<S;k++){const F=k===S-1?0:k+1,V=l[k],U=l[F],$=l[F===S-1?0:F+1],Z=U.sub(V)._perp()._unit(),Q=B5(Z,$.sub(U)._perp()._unit()),et=L,nt=Q;if(UD(V,U,h)||_&&V5(V,h)&&V5(U,h)){L=Q;continue}const dt=C.vertexLength;o2(this.vertexArray,V,U,1,1,et),o2(this.vertexArray,V,U,1,0,et),o2(this.vertexArray,V,U,0,1,nt),o2(this.vertexArray,V,U,0,0,nt),C.vertexLength+=4;const mt=Unt(V,U,Z,m);for(const yt of mt)this._segmentToGroundQuads[T].push({id:dt,region:yt}),this._segmentToRegionTriCounts[T][yt]+=2,C.primitiveLength+=2;L=Q}}}prepareBorderSegments(){if(!this.hasData())return;const l=this._segments.get(),h=l.length;for(let m=0;m<h;m++)this._segmentToGroundQuads[m].sort((_,S)=>_.region-S.region);for(let m=0;m<h;m++){const _=this._segmentToGroundQuads[m],S=l[m],T=this._segmentToRegionTriCounts[m];T.reduce((L,k)=>L+k,0);let C=0;for(let L=0;L<=4;L++){const k=T[L];if(k!==0){let F=this.regionSegments[L];F||(F=this.regionSegments[L]=new Un);const V={vertexOffset:S.vertexOffset,primitiveOffset:S.primitiveOffset+C,vertexLength:S.vertexLength,primitiveLength:k};F.get().push(V)}C+=k}for(let L=0;L<_.length;L++){const k=_[L].id;this.indexArray.emplaceBack(k,k+1,k+3),this.indexArray.emplaceBack(k,k+3,k+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(l,h,m,_,S,T,C){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,l,h,m,_,S,T,void 0,C)}upload(l){this.hasData()&&(this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Mnt.members),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=l.createVertexBuffer(this.groundRadiusArray,Ent.members)))}uploadPaintProperties(l){this.hasData()&&this.programConfigurations.upload(l)}update(l,h,m,_,S,T,C,L){this.hasData()&&this.programConfigurations.updatePaintArrays(l,h,m,_,S,T,C,L)}updateHiddenByLandmark(l){this.updateHiddenByLandmarkRange(l.groundVertexArrayOffset,l.groundVertexCount,!!(l.flags&kf))}updateHiddenByLandmarkRange(l,h,m){if(!this.hasData())return;const _=h+l;if(h!==0){for(let S=l;S<_;++S)this.hiddenByLandmarkVertexArray.emplace(S,m?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(l){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=l.createVertexBuffer(this.hiddenByLandmarkVertexArray,Lnt.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let l=0;l<=4;l++){const h=this.regionSegments[l];h&&h.destroy()}}}}class s2{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaling=l.overscaling,this.layers=l.layers,this.pixelRatio=l.pixelRatio,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=l.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ln,this.footprintVertices=new hs,this.footprintSegments=[],this.layoutVertexArray=new wf,this.centroidVertexArray=new GT,this.wallVertexArray=new jT,this.indexArray=new Ln,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut},h=>znt.includes(h)),this.segments=new Un,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.groundEffect=new VD(l),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.features=[],this.hasPattern=DD("fill-extrusion",this.layers,this.pixelRatio,h),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=kt(m),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:S,id:T,index:C,sourceLayerIndex:L}of l){const k=this.layers[0]._featureFilter.needGeometry,F=ee(S,k);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),F,m))continue;const V={id:T,sourceLayerIndex:L,index:C,geometry:k?F.geometry:pe(S,m,_),properties:S.properties,type:S.type,patterns:{}},U=this.layoutVertexArray.length,$=ND[V.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:S.id,feature:PD("fill-extrusion",this.layers,V,this.zoom,this.pixelRatio,h)});else if(this.wallMode)for(const Z of V.geometry)for(const Q of D5(Z,$))this.addFeature(S.id,V,[Q],C,m,{},h.availableImages,_,h.brightness);else this.addFeature(S.id,V,V.geometry,C,m,{},h.availableImages,_,h.brightness);h.featureIndex.insert(S,V.geometry,C,L,this.index,U)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(l,h,m,_,S,T){for(const{featureId:C,feature:L}of this.features){const k=ND[L.type]==="Polygon",{geometry:F}=L;if(this.wallMode)for(const V of F)for(const U of D5(V,k))this.addFeature(C,L,[U],L.index,h,m,_,S,T);else this.addFeature(C,L,F,L.index,h,m,_,S,T)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(l,h,m,_,S,T,C){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C,this.worldview),this.groundEffect.update(l,h,S,m,_,T,C,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,knt),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.wallVertexBuffer=l.createVertexBuffer(this.wallVertexArray,Pnt.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=l.createVertexBuffer(this.layoutVertexExtArray,Rnt.members,!0)),this.groundEffect.upload(l)),this.groundEffect.uploadPaintProperties(l),this.programConfigurations.upload(l),this.uploaded=!0}uploadCentroid(l){this.groundEffect.uploadHiddenByLandmark(l),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Dnt.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,h,m,_,S,T,C,L,k){const F=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(h,{})/this.tileToMeter,V=[new Me(0,0),new Me(Ve,Ve)],U=L.projection,$=U.name==="globe",Z=this.wallMode||ND[h.type]==="Polygon",Q=new z5;Q.centroidDataIndex=this.centroidData.length;const et=new O5;et.buildingId=l,h.properties&&h.properties.hasOwnProperty("building_id")&&(et.buildingId=h.properties.building_id);const nt=this.layers[0].paint.get("fill-extrusion-base").evaluate(h,{},S)<=0,dt=this.layers[0].paint.get("fill-extrusion-height").evaluate(h,{},S);let mt;if(et.height=dt,et.vertexArrayOffset=this.layoutVertexArray.length,et.groundVertexArrayOffset=this.groundEffect.vertexArray.length,$&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new L_),this.wallMode){if($)return void Mi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(m.length!==1)return;mt=function(Kt){const ue=Kt[0].x===Kt[Kt.length-1].x&&Kt[0].y===Kt[Kt.length-1].y;(function(ri){let Xe=0;const ji=ri.length;for(let Qe=0;Qe<ji;Qe++)Xe+=(ri[(Qe+1)%ji].x-ri[Qe].x)*(ri[(Qe+1)%ji].y+ri[Qe].y);return Xe>=0})(Kt)||(Kt=Kt.reverse());const Te={geometry:[],joinNormals:[],indices:[]},Be=[],De=[],_e=[];let Ee=Kt.length;for(;Ee>=2&&Kt[Ee-1].equals(Kt[Ee-2]);)Ee--;if(Ee<(ue?3:2))return Te;let ae,re,Ie,Re,we,si=0;for(;si<Ee-1&&Kt[si].equals(Kt[si+1]);)si++;ue&&(ae=Kt[Ee-2],we=Kt[si].sub(ae)._unit()._perp());for(let ri=si;ri<Ee;ri++){if(Ie=ri===Ee-1?ue?Kt[si+1]:void 0:Kt[ri+1],Ie&&Kt[ri].equals(Ie))continue;we&&(Re=we),ae&&(re=ae),ae=Kt[ri],we=Ie?Ie.sub(ae)._unit()._perp():Re,Re=Re||we;let Xe=Re.add(we);Xe.x===0&&Xe.y===0||Xe._unit();const ji=Xe.x*we.x+Xe.y*we.y,Qe=ji!==0?1/ji:1/0,Ci=Re.x*we.y-Re.y*we.x>0;let Zi="miter";const fr=2;Zi==="miter"&&Qe>fr&&(Zi="bevel"),Zi==="bevel"&&(Qe>100&&(Zi="flipbevel"),Qe<fr&&(Zi="miter"));const Pr=(qi,Br,Fr,Fn)=>{const Ct=new Me(qi.x,qi.y),St=new Me(qi.x,qi.y);Ct.x+=Br.x*Fn,Ct.y+=Br.y*Fn,St.x-=Br.x*Math.max(Fr,1),St.y-=Br.y*Math.max(Fr,1),_e.push(Br),Be.push(Ct),De.push(St)};if(Zi==="miter")Xe._mult(Qe),Pr(ae,Xe,0,0);else if(Zi==="flipbevel")Xe=we.mult(-1),Pr(ae,Xe,0,0),Pr(ae,Xe.mult(-1),0,0);else{const qi=-Math.sqrt(Qe*Qe-1),Br=Ci?qi:0,Fr=Ci?0:qi;re&&Pr(ae,Re,Br,Fr),Ie&&Pr(ae,we,Br,Fr)}}Te.geometry=[...Be,...De.reverse(),Be[0]],Te.joinNormals=[..._e,..._e.reverse(),_e[_e.length-1]];const ci=Te.geometry.length-1;for(let ri=0;ri<ci/2;ri++)if(ri+1<ci/2){let Xe=ri,ji=ri+1,Qe=ci-1-ri,Ci=ci-2-ri;Xe=Xe===0?ci-1:Xe-1,ji=ji===0?ci-1:ji-1,Qe=Qe===0?ci-1:Qe-1,Ci=Ci===0?ci-1:Ci-1,Te.indices.push(Qe),Te.indices.push(ji),Te.indices.push(Xe),Te.indices.push(Qe),Te.indices.push(Ci),Te.indices.push(ji)}return Te}(m[0]),m=[mt.geometry]}const yt=(Kt,ue)=>Kt<(ue.length-1)/2||Kt===ue.length-1,Lt=this.wallMode?[m]:T1(m,500);for(let Kt=Lt.length-1;Kt>=0;Kt--){const ue=Lt[Kt];(ue.length===0||(It=ue[0]).every(me=>me.x<=0)||It.every(me=>me.x>=Ve)||It.every(me=>me.y<=0)||It.every(me=>me.y>=Ve))&&Lt.splice(Kt,1)}var It;let Ot;if($)Ot=j5(Lt,V,S);else{Ot=[];for(const Kt of Lt)Ot.push({polygon:Kt,bounds:V})}const Ut=Z?this.edgeRadius:0,Ht=Ut>0&&this.zoom<17,se=(Kt,ue)=>{if(Kt.length===0)return!1;const me=Kt[Kt.length-1];return ue.x===me.x&&ue.y===me.y};for(const{polygon:Kt,bounds:ue}of Ot){let me=0,Te=0;for(const Ee of Kt)Z&&!Ee[0].equals(Ee[Ee.length-1])&&Ee.push(Ee[0]),Te+=Z?Ee.length-1:Ee.length;const Be=this.segments.prepareSegment((Z?5:4)*Te,this.layoutVertexArray,this.indexArray);et.footprintSegIdx<0&&(et.footprintSegIdx=this.footprintSegments.length),et.polygonSegIdx<0&&(et.polygonSegIdx=this.polygonSegments.length);const De={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},_e=new k5;if(_e.vertexOffset=this.footprintVertices.length,_e.indexOffset=3*this.footprintIndices.length,_e.ringIndices=[],Z){const Ee=[],ae=[];me=Be.vertexLength;for(let Ie=0;Ie<Kt.length;Ie++){const Re=Kt[Ie];Re.length&&Ie!==0&&ae.push(Ee.length/2);const we=[];let si,ci;si=Re[1].sub(Re[0])._perp()._unit(),_e.ringIndices.push(Re.length-1);for(let ri=1;ri<Re.length;ri++){const Xe=Re[ri],ji=Re[ri===Re.length-1?1:ri+1],Qe=Xe.clone();if(Ut){ci=ji.sub(Xe)._perp()._unit();const Ci=si.add(ci)._unit(),Zi=Ut*Math.min(4,1/(si.x*Ci.x+si.y*Ci.y));Qe.x+=Zi*Ci.x,Qe.y+=Zi*Ci.y,Qe.x=Math.round(Qe.x),Qe.y=Math.round(Qe.y),si=ci}if(!nt||Ut!==0&&!Ht||se(we,Qe)||we.push(Qe),I1(this.layoutVertexArray,Qe.x,Qe.y,0,0,1,1,0),this.wallMode){const Ci=yt(ri,Re);C1(this.wallVertexArray,mt.joinNormals[ri],!Ci)}Be.vertexLength++,this.footprintVertices.emplaceBack(Xe.x,Xe.y),Ee.push(Xe.x,Xe.y),$&&M1(this.layoutVertexExtArray,U.projectTilePoint(Qe.x,Qe.y,S),U.upVector(S,Qe.x,Qe.y))}nt&&(Ut===0||Ht)&&(we.length!==0&&se(we,we[0])&&we.pop(),this.groundEffect.addData(we,ue,F))}const re=this.wallMode?mt.indices:W_(Ee,ae);for(let Ie=0;Ie<re.length;Ie+=3)this.footprintIndices.emplaceBack(_e.vertexOffset+re[Ie+0],_e.vertexOffset+re[Ie+1],_e.vertexOffset+re[Ie+2]),this.indexArray.emplaceBack(me+re[Ie],me+re[Ie+2],me+re[Ie+1]),Be.primitiveLength++;_e.indexCount+=re.length,_e.vertexCount+=this.footprintVertices.length-_e.vertexOffset}for(let Ee=0;Ee<Kt.length;Ee++){const ae=Kt[Ee];Q.startRing(et,ae[0]);let re=ae.length>4&&U5(ae[ae.length-2],ae[0],ae[1]),Ie=Ut?Gnt(ae[ae.length-2],ae[0],ae[1],Ut):0;const Re=[];let we,si,ci;si=ae[1].sub(ae[0])._perp()._unit();let ri=!0;for(let Xe=1,ji=0;Xe<ae.length;Xe++){let Qe=ae[Xe-1],Ci=ae[Xe];const Zi=ae[Xe===ae.length-1?1:Xe+1];if(Q.appendEdge(et,Ci,Qe),UD(Ci,Qe,ue)){Ut&&(si=Zi.sub(Ci)._perp()._unit(),ri=!ri);continue}const fr=Ci.sub(Qe)._perp(),Pr=fr.x/(Math.abs(fr.x)+Math.abs(fr.y)),qi=fr.y>0?1:0,Br=Qe.dist(Ci);if(ji+Br>32768&&(ji=0),Ut){ci=Zi.sub(Ci)._perp()._unit();let St=N5(Qe,Ci,Zi,F5(si,ci),Ut);isNaN(St)&&(St=0);const he=Ci.sub(Qe)._unit();Qe=Qe.add(he.mult(Ie))._round(),Ci=Ci.add(he.mult(-St))._round(),Ie=St,si=ci,nt&&this.zoom>=17&&(se(Re,Qe)||Re.push(Qe),se(Re,Ci)||Re.push(Ci))}const Fr=Be.vertexLength,Fn=ae.length>4&&U5(Qe,Ci,Zi);let Ct=G5(ji,re,ri);if(I1(this.layoutVertexArray,Qe.x,Qe.y,Pr,qi,0,0,Ct),I1(this.layoutVertexArray,Qe.x,Qe.y,Pr,qi,0,1,Ct),this.wallMode){const St=yt(Xe-1,ae),he=mt.joinNormals[Xe-1];C1(this.wallVertexArray,he,St),C1(this.wallVertexArray,he,St)}if(ji+=Br,Ct=G5(ji,Fn,!ri),re=Fn,I1(this.layoutVertexArray,Ci.x,Ci.y,Pr,qi,0,0,Ct),I1(this.layoutVertexArray,Ci.x,Ci.y,Pr,qi,0,1,Ct),this.wallMode){const St=yt(Xe,ae),he=mt.joinNormals[Xe];C1(this.wallVertexArray,he,St),C1(this.wallVertexArray,he,St)}if(Be.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),Be.primitiveLength+=2,Ut){const St=me+(Xe===1?ae.length-2:Xe-2),he=Xe===1?me:St+1;if(this.indexArray.emplaceBack(Fr+1,St,Fr+3),this.indexArray.emplaceBack(St,he,Fr+3),Be.primitiveLength+=2,we===void 0&&(we=Fr),!UD(Zi,ae[Xe],ue)){const je=Xe===ae.length-1?we:Be.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,je),this.indexArray.emplaceBack(Fr+3,je+1,je),this.indexArray.emplaceBack(Fr+3,he,je+1),Be.primitiveLength+=3}ri=!ri}if($){const St=this.layoutVertexExtArray,he=U.projectTilePoint(Qe.x,Qe.y,S),je=U.projectTilePoint(Ci.x,Ci.y,S),de=U.upVector(S,Qe.x,Qe.y),Je=U.upVector(S,Ci.x,Ci.y);M1(St,he,de),M1(St,he,de),M1(St,je,Je),M1(St,je,Je)}}Z&&(me+=ae.length-1),nt&&Ut&&this.zoom>=17&&(Re.length!==0&&se(Re,Re[0])&&Re.pop(),this.groundEffect.addData(Re,ue,F,Ut>0))}this.footprintSegments.push(_e),De.triangleCount=this.indexArray.length-De.triangleArrayOffset,this.polygonSegments.push(De),++et.footprintSegLen,++et.polygonSegLen}if(et.vertexCount=this.layoutVertexArray.length-et.vertexArrayOffset,et.groundVertexCount=this.groundEffect.vertexArray.length-et.groundVertexArrayOffset,et.vertexCount!==0){if(et.centroidXY=Q.borders?P5:this.encodeCentroid(Q,et),this.centroidData.push(et),Q.borders){this.featuresOnBorder.push(Q);const Kt=this.featuresOnBorder.length-1;for(let ue=0;ue<Q.borders.length;ue++)Q.borders[ue][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ue].push(Kt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,_,T,C,S,k,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(h,_,T,C,S,k,this.worldview),this.maxHeight=Math.max(this.maxHeight,dt)}}sortBorders(){for(let l=0;l<this.borderFeatureIndices.length;l++)this.borderFeatureIndices[l].sort((h,m)=>this.featuresOnBorder[h].borders[l][0]-this.featuresOnBorder[m].borders[l][0])}splitToSubtiles(){const l=[];for(let C=0;C<this.centroidData.length;C++){const L=this.centroidData[C],k=+(L.min.y+L.max.y>Ve),F=2*k+(+(L.min.x+L.max.x>Ve)^k);for(let V=0;V<L.polygonSegLen;V++){const U=L.polygonSegIdx+V;l.push({centroidIdx:C,subtile:F,polygonSegmentIdx:U,triangleSegmentIdx:this.polygonSegments[U].triangleSegIdx})}}const h=new Ln;l.sort((C,L)=>C.triangleSegmentIdx===L.triangleSegmentIdx?C.subtile-L.subtile:C.triangleSegmentIdx-L.triangleSegmentIdx);let m=0,_=0,S=0;for(const C of l){if(C.triangleSegmentIdx!==m)break;S++}const T=l.length;for(;_!==l.length;){m=l[_].triangleSegmentIdx;let C=0,L=_,k=_;for(let F=L;F<S&&l[F].subtile===C;F++)k++;for(;L!==S;){const F=l[L];C=F.subtile;const V=this.centroidData[F.centroidIdx].min.clone(),U=this.centroidData[F.centroidIdx].max.clone(),$={vertexOffset:this.segments.segments[m].vertexOffset,primitiveOffset:h.length,vertexLength:this.segments.segments[m].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Z=L;Z<k;Z++){const Q=l[Z],et=this.polygonSegments[Q.polygonSegmentIdx],nt=this.centroidData[Q.centroidIdx].min,dt=this.centroidData[Q.centroidIdx].max,mt=this.indexArray.uint16;for(let yt=et.triangleArrayOffset;yt<et.triangleArrayOffset+et.triangleCount;yt++)h.emplaceBack(mt[3*yt],mt[3*yt+1],mt[3*yt+2]);$.primitiveLength+=et.triangleCount,V.x=Math.min(V.x,nt.x),V.y=Math.min(V.y,nt.y),U.x=Math.max(U.x,dt.x),U.y=Math.max(U.y,dt.y)}$.primitiveLength>0&&this.triangleSubSegments.push({segment:$,min:V,max:U}),L=k;for(let Z=L;Z<S&&l[Z].subtile===l[L].subtile;Z++)k++}_=S;for(let F=_;F<T&&l[F].triangleSegmentIdx===l[_].triangleSegmentIdx;F++)S++}h._trim(),this.indexArray=h}getVisibleSegments(l,h,m){const _=new Un;if(this.wallMode){for(const Q of this.triangleSubSegments)_.segments.push(Q.segment);return _}let S=0,T=0;const C=1<<l.canonical.z;if(h){const Q=h.getMinMaxForTile(l);Q&&(S=Q.min,T=Q.max)}T+=this.maxHeight;const L=l.toUnwrapped();let k;const F=[L.canonical.x/C+L.wrap,L.canonical.y/C],V=[(L.canonical.x+1)/C+L.wrap,(L.canonical.y+1)/C],U=(Q,et,nt)=>[Q[0]*(1-nt[0])+et[0]*nt[0],Q[1]*(1-nt[1])+et[1]*nt[1]],$=[],Z=[];for(const Q of this.triangleSubSegments){$[0]=Q.min.x/Ve,$[1]=Q.min.y/Ve,Z[0]=Q.max.x/Ve,Z[1]=Q.max.y/Ve;const et=U(F,V,$),nt=U(F,V,Z);if(new ur([et[0],et[1],S],[nt[0],nt[1],T]).intersectsPrecise(m)===0){k&&(_.segments.push(k),k=void 0);continue}const dt=Q.segment;k&&k.vertexOffset!==dt.vertexOffset&&(_.segments.push(k),k=void 0),k?(k.vertexLength+=dt.vertexLength,k.primitiveLength+=dt.primitiveLength):k={vertexOffset:dt.vertexOffset,primitiveLength:dt.primitiveLength,vertexLength:dt.vertexLength,primitiveOffset:dt.primitiveOffset,sortKey:void 0,vaos:{}}}return k&&_.segments.push(k),_}encodeCentroid(l,h){const m=l.centroid(),_=h.span(),S=Math.min(7,Math.round(_.x*this.tileToMeter/10)),T=Math.min(7,Math.round(_.y*this.tileToMeter/10));return new Me(lt(m.x,1,Ve-1)<<3|S,lt(m.y,1,Ve-1)<<3|T)}encodeBorderCentroid(l){if(!l.borders)return new Me(0,0);const h=l.borders,m=Number.MAX_VALUE;if(h[0][0]!==m||h[1][0]!==m){const _=h[0][0]!==m?0:1;return new Me(6|(h[0][0]!==m?0:65528),(h[_][0]+h[_][1])/2<<3|6)}{const _=h[2][0]!==m?2:3;return new Me((h[_][0]+h[_][1])/2<<3|6,6|(h[2][0]!==m?0:65528))}}showCentroid(l){const h=this.centroidData[l.centroidDataIndex];h.flags&=2147483647,h.centroidXY.x=0,h.centroidXY.y=0,this.writeCentroidToBuffer(h)}writeCentroidToBuffer(l){this.groundEffect.updateHiddenByLandmark(l);const h=l.vertexArrayOffset,m=l.vertexCount+l.vertexArrayOffset,_=l.flags&kf?P5:l.centroidXY,S=this.centroidVertexArray.geta_centroid_pos0(h);if(this.centroidVertexArray.geta_centroid_pos1(h)!==_.y||S!==_.x){for(let T=h;T<m;++T)this.centroidVertexArray.emplace(T,_.x,_.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const l of this.centroidData)this.writeCentroidToBuffer(l)}updateReplacement(l,h,m){if(h.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=h.updateTime;const _=h.getReplacementRegionsForTile(l.toUnwrapped());if(a2(this.activeReplacements,_))return;if(this.activeReplacements=_,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const T of this.centroidData)T.flags&=2147483647;const S=[];for(const T of this.activeReplacements){if(T.order<m)continue;const C=Math.max(1,Math.pow(2,T.footprintTileId.canonical.z-l.canonical.z));if(T.footprint.buildingId){const L=T.footprint.buildingId;for(const k of this.centroidData)k.buildingId===L&&(k.flags|=kf)}else for(const L of this.centroidData)if(!(L.flags&kf||T.min.x>L.max.x||L.min.x>T.max.x||T.min.y>L.max.y||L.min.y>T.max.y))for(let k=0;k<L.footprintSegLen;k++){const F=this.footprintSegments[L.footprintSegIdx+k];if(S.length=0,Hnt(this.footprintVertices,F.vertexOffset,F.vertexCount,T.footprintTileId.canonical,l.canonical,S),zD(T.footprint,S,this.footprintIndices.uint16,F.indexOffset,F.indexCount,-F.vertexOffset,-C)){L.flags|=kf;break}}}for(const T of this.centroidData)this.writeCentroidToBuffer(T);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(l,h,m){let _=!1;for(let S=0;S<m.footprintSegLen;S++){const T=this.footprintSegments[m.footprintSegIdx+S];let C=0;for(const L of T.ringIndices){for(let k=C,F=L+C-1;k<L+C;F=k++){const V=this.footprintVertices.int16[2*(k+T.vertexOffset)+0],U=this.footprintVertices.int16[2*(k+T.vertexOffset)+1],$=this.footprintVertices.int16[2*(F+T.vertexOffset)+1];U>h!=$>h&&l<(this.footprintVertices.int16[2*(F+T.vertexOffset)+0]-V)*(h-U)/($-U)+V&&(_=!_)}C=L}}return _}getHeightAtTileCoord(l,h){let m=Number.NEGATIVE_INFINITY,_=!0;const S=4*(l+Ve)*Ve+(h+Ve);if(this.partLookup.hasOwnProperty(S)){const T=this.partLookup[S];return T?{height:T.height,hidden:!!(T.flags&kf)}:void 0}for(const T of this.centroidData)l>T.max.x||T.min.x>l||h>T.max.y||T.min.y>h||T.height<=m||this.footprintContainsPoint(l,h,T)&&(m=T.height,this.partLookup[S]=T,_=!!(T.flags&kf));if(m!==Number.NEGATIVE_INFINITY)return{height:m,hidden:_};this.partLookup[S]=void 0}}function F5(d,l){const h=d.add(l)._unit();return d.x*h.x+d.y*h.y}function Gnt(d,l,h,m){const _=l.sub(d)._perp()._unit(),S=h.sub(l)._perp()._unit();return N5(d,l,h,F5(_,S),m)}function N5(d,l,h,m,_){const S=Math.sqrt(1-m*m);return Math.min(d.dist(l)/3,l.dist(h)/3,_*S/m)}function UD(d,l,h){return d.x<h[0].x&&l.x<h[0].x||d.x>h[1].x&&l.x>h[1].x||d.y<h[0].y&&l.y<h[0].y||d.y>h[1].y&&l.y>h[1].y}function V5(d,l){return d.x<l[0].x||d.x>l[1].x||d.y<l[0].y||d.y>l[1].y}function U5(d,l,h){if(d.x<0||d.x>=Ve||l.x<0||l.x>=Ve||h.x<0||h.x>=Ve)return!1;const m=h.sub(l),_=m.perp(),S=d.sub(l);return(m.x*S.x+m.y*S.y)/Math.sqrt((m.x*m.x+m.y*m.y)*(S.x*S.x+S.y*S.y))>-.866&&_.x*S.x+_.y*S.y<0}function G5(d,l,h){const m=l?2|d:-3&d;return h?1|m:-2&m}function H5(){const d=Math.PI/32,l=Math.tan(d),h=G;return h*Math.sqrt(1+2*l*l)-h}function j5(d,l,h){const m=1<<h.z,_=xt(h.x/m),S=xt((h.x+1)/m),T=vt(h.y/m),C=vt((h.y+1)/m);return function(L,k,F,V,U=0,$){const Z=[];if(!L.length||!F||!V)return Z;const Q=(It,Ot)=>{for(const Ut of It)Z.push({polygon:Ut,bounds:Ot})},et=Math.ceil(Math.log2(F)),nt=Math.ceil(Math.log2(V)),dt=et-nt,mt=[];for(let It=0;It<Math.abs(dt);It++)mt.push(dt>0?0:1);for(let It=0;It<Math.min(et,nt);It++)mt.push(0),mt.push(1);let yt=L;if(yt=i2(yt,k[0].y-U,k[1].y+U,1),yt=i2(yt,k[0].x-U,k[1].x+U,0),!yt.length)return Z;const Lt=[];for(mt.length?Lt.push({polygons:yt,bounds:k,depth:0}):Q(yt,k);Lt.length;){const It=Lt.pop(),Ot=It.depth,Ut=mt[Ot],Ht=It.bounds[0],se=It.bounds[1],Kt=Ut===0?Ht.x:Ht.y,ue=Ut===0?se.x:se.y,me=$?$(Ut,Kt,ue):.5*(Kt+ue),Te=i2(It.polygons,Kt-U,me+U,Ut),Be=i2(It.polygons,me-U,ue+U,Ut);if(Te.length){const De=[Ht,new Me(Ut===0?me:se.x,Ut===1?me:se.y)];mt.length>Ot+1?Lt.push({polygons:Te,bounds:De,depth:Ot+1}):Q(Te,De)}if(Be.length){const De=[new Me(Ut===0?me:Ht.x,Ut===1?me:Ht.y),se];mt.length>Ot+1?Lt.push({polygons:Be,bounds:De,depth:Ot+1}):Q(Be,De)}}return Z}(d,l,Math.ceil((S-_)/11.25),Math.ceil((T-C)/11.25),1,(L,k,F)=>{if(L===0)return .5*(k+F);{const V=vt((h.y+k/Ve)/m);return(st(.5*(vt((h.y+F/Ve)/m)+V))*m-h.y)*Ve}})}function Hnt(d,l,h,m,_,S){const T=Math.pow(2,m.z-_.z);for(let C=0;C<h;C++){let L=d.int16[2*(C+l)+0],k=d.int16[2*(C+l)+1];L=(L+_.x*Ve)*T-m.x*Ve,k=(k+_.y*Ve)*T-m.y*Ve,S.push(new Me(L,k))}}let W5,$5;li(s2,"FillExtrusionBucket",{omit:["layers","features"]}),li(O5,"PartData"),li(k5,"FootprintSegment"),li(z5,"BorderCentroidData"),li(VD,"GroundEffect");class Gg extends Me{constructor(l,h,m){super(l,h),this.z=m}}class Z5 extends Gg{constructor(l,h,m,_){super(l,h,m),this.w=_}}function q5(d,l,h,m){const _=h==="x"?"y":"x",S=(m-d[h])/(l[h]-d[h]);d[_]=Math.round(d[_]+(l[_]-d[_])*S),d[h]=m,d.hasOwnProperty("z")&&(d.z=zi(d.z,l.z,S)),d.hasOwnProperty("w")&&(d.w=zi(d.w,l.w,S))}function X5(d,l,h,m){const _=h,S=m;for(const T of["x","y"]){let C=d,L=l;C[T]>=L[T]&&(C=l,L=d),C[T]<_&&L[T]>_&&q5(C,L,T,_),C[T]<S&&L[T]>S&&q5(L,C,T,S)}}function l2(d,l,h,m,_,S){const T=[];for(let C=0;C<d.length;C++){const L=d[C];let k;const F=T.length;let V=0;for(let U=0;U<L.length-1;U++){let $=L[U],Z=L[U+1],Q=0;const et=V;let nt,dt;S&&(Q=Math.hypot(Z.x-$.x,Z.y-$.y),V+=Q,nt=$,dt=Z),$.x<l&&Z.x<l||($.x<l?$=new Me(l,$.y+(l-$.x)/(Z.x-$.x)*(Z.y-$.y))._round():Z.x<l&&(Z=new Me(l,$.y+(l-$.x)/(Z.x-$.x)*(Z.y-$.y))._round()),$.y<h&&Z.y<h||($.y<h?$=new Me($.x+(h-$.y)/(Z.y-$.y)*(Z.x-$.x),h)._round():Z.y<h&&(Z=new Me($.x+(h-$.y)/(Z.y-$.y)*(Z.x-$.x),h)._round()),$.x>=m&&Z.x>=m||($.x>=m?$=new Me(m,$.y+(m-$.x)/(Z.x-$.x)*(Z.y-$.y))._round():Z.x>=m&&(Z=new Me(m,$.y+(m-$.x)/(Z.x-$.x)*(Z.y-$.y))._round()),$.y>=_&&Z.y>=_||($.y>=_?$=new Me($.x+(_-$.y)/(Z.y-$.y)*(Z.x-$.x),_)._round():Z.y>=_&&(Z=new Me($.x+(_-$.y)/(Z.y-$.y)*(Z.x-$.x),_)._round()),k&&$.equals(k[k.length-1])||(k=[$],T.push(k),S&&S.push({progress:{min:et+Y5(nt,dt,$)*Q,max:1},parentIndex:C,prevPoint:nt,nextPoint:dt})),k.push(Z),S&&(S[S.length-1].progress.max=et+Y5(nt,dt,Z)*Q,S[S.length-1].nextPoint=dt)))))}if(S&&V>0)for(let U=F;U<T.length;U++)S[U].progress.min/=V,S[U].progress.max/=V}return T}function jnt(d,l,h,m,_){if(d.length<2)return void m.push(d);const S=[];for(;l.valid();){const[k,F]=l.get();for(let V=0;V<d.length-1;V++){const U=d[V],$=d[V+1],Z=Xs(U,$,k,F);if(Z){const[Q]=Z,et=new Me(zi(U.x,$.x,Q),zi(U.y,$.y,Q));S.push({t:V+Q,distance:0,point:et})}}l.next()}if(S.length===0)return void m.push(d);S.sort((k,F)=>k.t-F.t);let T=0,C=0,L=[];for(m.push(L);T!==d.length;){if(C===S.length){for(;T!==d.length;)L.length!==0&&L[L.length-1].equals(d[T])||L.push(d[T]),T++;break}S[C].t<=T?(L.length!==0&&L[L.length-1].equals(S[C].point)||L.push(S[C].point),Math.trunc(S[C].t),C++):(L.length!==0&&L[L.length-1].equals(d[T])||L.push(d[T]),T++)}}function Y5(d,l,h){return d.x!==l.x?(h.x-d.x)/(l.x-d.x):d.y!==l.y?(h.y-d.y)/(l.y-d.y):0}function E1(d,l){return d.x*l.x+d.y*l.y}function K5(d,l){if(d.length===1){let h=0;const m=l[h++];let _;for(;!_||m.equals(_);)if(_=l[h++],!_)return 1/0;for(;h<l.length;h++){const S=l[h],T=d[0],C=_.sub(m),L=S.sub(m),k=T.sub(m),F=E1(C,C),V=E1(C,L),U=E1(L,L),$=E1(k,C),Z=E1(k,L),Q=F*U-V*V,et=(U*$-V*Z)/Q,nt=(F*Z-V*$)/Q,dt=m.z*(1-et-nt)+_.z*et+S.z*nt;if(isFinite(dt))return dt}return 1/0}{let h=1/0;for(const m of l)h=Math.min(h,m.z);return h}}function J5(d,l,h){let m=1/0;Jn(h,l)&&(m=K5(h,l[0]));for(let _=0;_<l.length;_++){const S=l[_],T=d[_];for(let C=0;C<S.length-1;C++){const L=S[C],k=[L,S[C+1],T[C+1],T[C],L];ra(h,k)&&(m=Math.min(m,K5(h,k)))}}return m!==1/0&&m}function Q5(d,l,h,m,_,S,T,C,L,k,F){return d.projection.name==="globe"?function(V,U,$,Z,Q,et,nt,dt,mt,yt,Lt){const It=[],Ot=[],Ut=V.projection.upVectorScale(Lt,V.center.lat,V.worldSize).metersToTile,Ht=[0,0,0,1],se=[0,0,0,1],Kt=(me,Te,Be,De)=>{me[0]=Te,me[1]=Be,me[2]=De,me[3]=1},ue=H5();$>0&&($+=ue),Z+=ue;for(const me of U){const Te=[],Be=[];for(const De of me){const _e=De.x+Q.x,Ee=De.y+Q.y,ae=V.projection.projectTilePoint(_e,Ee,Lt),re=V.projection.upVector(Lt,De.x,De.y);let Ie=$,Re=Z;if(nt){const we=tV(_e,Ee,$,Z,nt,dt,mt,yt);Ie+=we.base,Re+=we.top}$!==0?Kt(Ht,ae.x+re[0]*Ut*Ie,ae.y+re[1]*Ut*Ie,ae.z+re[2]*Ut*Ie):Kt(Ht,ae.x,ae.y,ae.z),Kt(se,ae.x+re[0]*Ut*Re,ae.y+re[1]*Ut*Re,ae.z+re[2]*Ut*Re),Bt(Ht,Ht,et),Bt(se,se,et),Te.push(new Gg(Ht[0],Ht[1],Ht[2])),Be.push(new Gg(se[0],se[1],se[2]))}It.push(Te),Ot.push(Be)}return[It,Ot]}(d,l,h,m,_,S,T,C,L,k,F):T?function(V,U,$,Z,Q,et,nt,dt,mt){const yt=[],Lt=[],It=[0,0,0,1];for(const Ot of V){const Ut=[],Ht=[];for(const se of Ot){const Kt=se.x+Z.x,ue=se.y+Z.y,me=tV(Kt,ue,U,$,et,nt,dt,mt);It[0]=Kt,It[1]=ue,It[2]=me.base,It[3]=1,Li(It,It,Q),It[3]=Math.max(It[3],1e-5);const Te=new Gg(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=Kt,It[1]=ue,It[2]=me.top,It[3]=1,Li(It,It,Q),It[3]=Math.max(It[3],1e-5);const Be=new Gg(It[0]/It[3],It[1]/It[3],It[2]/It[3]);Ut.push(Te),Ht.push(Be)}yt.push(Ut),Lt.push(Ht)}return[yt,Lt]}(l,h,m,_,S,T,C,L,k):function(V,U,$,Z,Q){const et=[],nt=[],dt=Q[8]*U,mt=Q[9]*U,yt=Q[10]*U,Lt=Q[11]*U,It=Q[8]*$,Ot=Q[9]*$,Ut=Q[10]*$,Ht=Q[11]*$;for(const se of V){const Kt=[],ue=[];for(const me of se){const Te=me.x+Z.x,Be=me.y+Z.y,De=Q[0]*Te+Q[4]*Be+Q[12],_e=Q[1]*Te+Q[5]*Be+Q[13],Ee=Q[2]*Te+Q[6]*Be+Q[14],ae=Q[3]*Te+Q[7]*Be+Q[15],re=De+dt,Ie=_e+mt,Re=Ee+yt,we=Math.max(ae+Lt,1e-5),si=De+It,ci=_e+Ot,ri=Ee+Ut,Xe=Math.max(ae+Ht,1e-5);Kt.push(new Gg(re/we,Ie/we,Re/we)),ue.push(new Gg(si/Xe,ci/Xe,ri/Xe))}et.push(Kt),nt.push(ue)}return[et,nt]}(l,h,m,_,S)}function tV(d,l,h,m,_,S,T,C){const L=T*_.getElevationAt(d,l,!0,!0),k=S[0]!==0,F=k?S[1]===0?T*(S[0]/L5-R5):T*function(V,U,$){const Z=Math.floor(U[0]/8),Q=Math.floor(U[1]/8),et=10*(U[0]-8*Z),nt=10*(U[1]-8*Q),dt=V.getElevationAt(Z,Q,!0,!0),mt=V.getMeterToDEM($),yt=Math.floor(.5*(et*mt-1)),Lt=Math.floor(.5*(nt*mt-1)),It=V.tileCoordToPixel(Z,Q),Ot=2*yt+1,Ut=2*Lt+1,Ht=function(Be,De,_e,Ee,ae){return[Be.getElevationAtPixel(De,_e,!0),Be.getElevationAtPixel(De+ae,_e,!0),Be.getElevationAtPixel(De,_e+ae,!0),Be.getElevationAtPixel(De+Ee,_e+ae,!0)]}(V,It.x-yt,It.y-Lt,Ot,Ut),se=Math.abs(Ht[0]-Ht[1]),Kt=Math.abs(Ht[2]-Ht[3]),ue=Math.abs(Ht[0]-Ht[2])+Math.abs(Ht[1]-Ht[3]),me=Math.min(.25,.5*mt*(se+Kt)/Ot),Te=Math.min(.25,.5*mt*ue/Ut);return dt+Math.max(me*et,Te*nt)}(_,S,C):L;return{base:L+(h===0?-1:h),top:k?Math.max(F+m,L+h+2):L+m}}class Wnt{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class $nt{constructor(){this.tasks={},this.taskQueue=[],ie(["process"],this),this.invoker=new Wnt(this.process),this.nextId=0}add(l,h){const m=this.nextId++,_=function({type:S,isSymbolTile:T,zoom:C}){return C=C||0,S==="message"?0:S!=="maybePrepare"||T?S!=="parseTile"||T?S==="parseTile"&&T?300-C:S==="maybePrepare"&&T?400-C:500:200-C:100-C}(h);if(_===0){try{l()}finally{}return null}return this.tasks[m]={fn:l,metadata:h,priority:_,id:m},this.taskQueue.push(m),this.invoker.trigger(),{cancel:()=>{delete this.tasks[m]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(m=>!!this.tasks[m]),!this.taskQueue.length)return;const l=this.pick();if(l===null)return;const h=this.tasks[l];if(delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),!h)return;h.fn()}finally{}}pick(){let l=null,h=1/0;for(let _=0;_<this.taskQueue.length;_++){const S=this.tasks[this.taskQueue[_]];S.priority<h&&(h=S.priority,l=_)}if(l===null)return null;const m=this.taskQueue[l];return this.taskQueue.splice(l,1),m}remove(){this.invoker.remove()}}class eV{constructor(l,h,m){this.target=l,this.parent=h,this.mapId=m,this.callbacks={},this.cancelCallbacks={},ie(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new $nt}send(l,h,m,_,S=!1,T){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);m&&(m.metadata=T,this.callbacks[C]=m);const L=new Set;return this.target.postMessage({id:C,type:l,hasCallback:!!m,targetMapId:_,mustQueue:S,sourceMapId:this.mapId,data:Lc(h,L)},L),{cancel:()=>{m&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}receive(l){const h=l.data;if(!h)return;const m=h.id;if(m&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){const _=this.cancelCallbacks[m];delete this.cancelCallbacks[m],_&&_.cancel()}else if(h.mustQueue||Yn(self)){const _=this.callbacks[m],S=this.scheduler.add(()=>this.processTask(m,h),_&&_.metadata||{type:"message"});S&&(this.cancelCallbacks[m]=S)}else this.processTask(m,h)}processTask(l,h){if(delete this.cancelCallbacks[l],h.type==="<response>"){const m=this.callbacks[l];delete this.callbacks[l],m&&(h.error?m(Rc(h.error)):m(null,Rc(h.data)))}else{const m=new Set,_=h.hasCallback?(T,C)=>{this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:T?Lc(T):null,data:Lc(C,m)},m)}:()=>{},S=Rc(h.data);if(this.parent[h.type])this.parent[h.type](h.sourceMapId,S,_);else if(this.parent.getWorkerSource){const T=h.type.split("."),{source:C,scope:L}=S;this.parent.getWorkerSource(h.sourceMapId,T[0],C,L)[T[1]](S,_)}else _(new Error(`Could not find function ${h.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var D1={workerUrl:"",workerClass:null,workerParams:void 0};const GD="mapboxgl_preloaded_worker_pool";class Hg{constructor(){this.active={}}acquire(l,h=Hg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<h;)this.workers.push(D1.workerClass!=null?new D1.workerClass:new self.Worker(D1.workerUrl,D1.workerParams));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.workers&&this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[GD]}numActive(){return Object.keys(this.active).length}}Hg.workerCount=2;class Z_{constructor(l,h,m="Worker",_=Hg.workerCount){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=ne();const S=this.workerPool.acquire(this.id,_);for(let T=0;T<S.length;T++){const C=new Z_.Actor(S[T],h,this.id);C.name=`${m} ${T}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,h,m){Ft(this.actors,(_,S)=>{_.send(l,h,S)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}let P1,HD;function u2(){return P1||(P1=new Hg),P1}Z_.Actor=eV;class Znt{constructor(l){this.module=l}createIntArray(l){const h=new Int32Array(l),m=this.module.malloc(h.length*h.BYTES_PER_ELEMENT);return this.module.heap32.set(h,m/h.BYTES_PER_ELEMENT),m}createFloatArray(l){const h=new Float32Array(l),m=this.module.malloc(h.length*h.BYTES_PER_ELEMENT);return this.module.heapF32.set(h,m/h.BYTES_PER_ELEMENT),m}createStringBuffer(l){const h=this.module.malloc(l.length+1);for(let m=0;m<l.length;++m)this.module.heapU8[h+m]=l.charCodeAt(m);return this.module.heapU8[h+l.length]=0,h}readStringBuffer(l){let h="";for(;this.module.heapU8[l]!==0;)h+=String.fromCharCode(this.module.heapU8[l]),++l;return h}setStyle(l){const h=l.entranceColorRgb,m=l.facadeGlazingColorRgb,_=l.roofColorRgb,S=l.wallColorRgb,T=l.normalScale;this.module.setStyle(h[0],h[1],h[2],m[0],m[1],m[2],_[0],_[1],_[2],S[0],S[1],S[2],T[0],T[1],T[2],l.tileToMeters)}setAOOptions(l,h){this.module.setAOOptions(l?1:0,h)}setMetricOptions(l,h){this.module.setMetricOptions(l?1:0,h)}setStructuralOptions(l){this.module.setStructuralOptions(l?1:0)}setFacadeOptions(l,h){this.module.setFacadeOptions(l,h?1:0)}setFauxFacadeOptions(l,h,m){this.module.setFauxFacadeOptions(l?1:0,h?1:0,m)}setFacadeClassifierOptions(l){this.module.setFacadeClassifierOptions(l)}generateMesh(l,h){for(const C of l){const L=this.createStringBuffer(C.roofType),k=[0],F=[];for(const $ of C.coordinates)if(Array.isArray($)){for(const Z of $)F.push(Z.x),F.push(Z.y);k.push(F.length)}const V=this.createIntArray(k),U=this.createFloatArray(F);this.module.addFeature(C.id,C.sourceId,C.minHeight,C.height,L,C.roofType.length,U,V,k.length-1),this.module.free(L),this.module.free(V),this.module.free(U)}for(const C of h){let L;L=C.entrances?JSON.parse(C.entrances):[];const k=this.createFloatArray(L),F=[];for(const U of C.coordinates)F.push(U.x),F.push(U.y);const V=this.createFloatArray(F);this.module.addFacade(C.sourceId,C.crossPerc,C.distanceToRoad,k,L.length,V,F.length),this.module.free(k),this.module.free(V)}if(!this.module.generateMesh()){const C=this.module.getLastError();return this.readStringBuffer(C)}const m=this.module.getMeshCount(),_=new Array(m);for(let C=0;C<m;C++){const L=this.module.getPositionsPtr(C),k=this.module.getPositionsLength(C),F=new Float32Array(this.module.heapF32.buffer,L,k),V=this.module.getNormalsPtr(C),U=this.module.getNormalsLength(C),$=new Float32Array(this.module.heapF32.buffer,V,U),Z=this.module.getColorsPtr(C),Q=this.module.getColorsLength(C),et=new Uint8Array(this.module.heapU8.buffer,Z,Q),nt=this.module.getAOPtr(C),dt=this.module.getAOLength(C),mt=new Float32Array(this.module.heapF32.buffer,nt,dt),yt=this.module.getUVPtr(C),Lt=this.module.getUVLength(C),It=new Float32Array(this.module.heapF32.buffer,yt,Lt),Ot=this.module.getFauxFacadePtr(C),Ut=this.module.getFauxFacadeLength(C),Ht=new Uint8Array(this.module.heapU8.buffer,Ot,Ut),se=this.module.getIndicesPtr(C),Kt=this.module.getIndicesLength(C),ue=new Int32Array(this.module.heap32.buffer,se,Kt),me=this.module.getBuildingPart(C),Te=this.readStringBuffer(me);_[C]={positions:F,normals:$,colors:et,ao:mt,uv:It,isFauxFacade:Ht,indices:ue,buildingPart:Te}}const S=this.module.getRingCount(),T=[];for(let C=0;C<S;C++){const L=this.module.getRingPtr(C),k=this.module.getRingLength(C),F=new Float32Array(this.module.heapF32.buffer,L,k);T.push(F)}return{meshes:_,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:T}}}let L1,jD,Ju,q_,WD,X_=null,Y_=null,iV=null,c2=null;function rV(){return Yn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:jD||An.DRACO_URL}function nV(){if(Yn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(q_)return q_;const d=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return q_=WebAssembly.validate(d)?An.MESHOPT_SIMD_URL:An.MESHOPT_URL,q_}function qnt(){return c2}const h2={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xnt={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},R1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function aV(d,l,h){const m=h.json.bufferViews.length,_=h.buffers.length;l.bufferView=m,h.json.bufferViews[m]={buffer:_,byteLength:d.byteLength},h.buffers[_]=d}const $D="KHR_draco_mesh_compression";function Ynt(d,l){const h=d.extensions&&d.extensions[$D];if(!h)return;const m=new Ju.Decoder,_=uV(l,h.bufferView),S=new Ju.Mesh;if(!m.DecodeArrayToMesh(_,_.byteLength,S))throw new Error("Failed to decode Draco mesh");const T=l.json.accessors[d.indices],C=h2[T.componentType],L=T.count*C.BYTES_PER_ELEMENT,k=Ju._malloc(L);C===Uint16Array?m.GetTrianglesUInt16Array(S,L,k):m.GetTrianglesUInt32Array(S,L,k),aV(Ju.memory.buffer.slice(k,k+L),T,l),Ju._free(k);for(const F of Object.keys(h.attributes)){const V=m.GetAttributeByUniqueId(S,h.attributes[F]),U=l.json.accessors[d.attributes[F]],$=Xnt[U.componentType],Z=U.count*R1[U.type]*h2[U.componentType].BYTES_PER_ELEMENT,Q=Ju._malloc(Z);m.GetAttributeDataArrayForAllPoints(S,V,Ju[$],Z,Q),aV(Ju.memory.buffer.slice(Q,Q+Z),U,l),Ju._free(Q)}m.destroy(),S.destroy(),delete d.extensions[$D]}const d2="EXT_meshopt_compression";function Knt(d,l){if(!d.extensions||!d.extensions[d2])return;const h=d.extensions[d2],m=new Uint8Array(l.buffers[h.buffer],h.byteOffset||0,h.byteLength||0),_=new Uint8Array(h.count*h.byteStride);WD.decodeGltfBuffer(_,h.count,h.byteStride,m,h.mode,h.filter),d.buffer=l.buffers.length,d.byteOffset=0,l.buffers[d.buffer]=_.buffer,delete d.extensions[d2]}const oV=1179937895,sV=new TextDecoder("utf8");function lV(d,l){return new URL(d,l).href}function Jnt(d,l,h,m){return fetch(lV(d.uri,m)).then(_=>_.arrayBuffer()).then(_=>{l.buffers[h]=_})}function uV(d,l){const h=d.json.bufferViews[l];return new Uint8Array(d.buffers[h.buffer],h.byteOffset||0,h.byteLength)}function Qnt(d,l,h,m){if(d.uri){const _=lV(d.uri,m);return fetch(_).then(S=>S.blob()).then(S=>createImageBitmap(S)).then(S=>{l.images[h]=S})}if(d.bufferView!==void 0){const _=uV(l,d.bufferView),S=new Blob([_],{type:d.mimeType});return createImageBitmap(S).then(T=>{l.images[h]=T})}}function cV(d,l=0,h){const m={json:null,images:[],buffers:[]};if(new Uint32Array(d,l,1)[0]===oV){const F=new Uint32Array(d,l);let V=2;const U=(F[V++]>>2)-3,$=F[V++]>>2;if(V++,m.json=JSON.parse(sV.decode(F.subarray(V,V+$))),V+=$,V<U){const Z=F[V++];V++;const Q=l+(V<<2);m.buffers[0]=d.slice(Q,Q+Z)}}else m.json=JSON.parse(sV.decode(new Uint8Array(d,l)));const{buffers:_,images:S,meshes:T,extensionsUsed:C,bufferViews:L}=m.json;let k=Promise.resolve();if(_){const F=[];for(let V=0;V<_.length;V++){const U=_[V];U.uri?F.push(Jnt(U,m,V,h)):m.buffers[V]||(m.buffers[V]=null)}k=Promise.all(F)}return k.then(()=>{const F=[],V=C&&C.includes($D),U=C&&C.includes(d2);if(V&&F.push(function(){if(!Ju)return L1??(L1=function($){let Z,Q=null;function et(){Z=new Uint8Array(Q.buffer)}function nt(){throw new Error("Unexpected Draco error.")}const dt={a:{a:nt,d:function(mt,yt,Lt){return Z.copyWithin(mt,yt,yt+Lt)},c:function(mt){const yt=Z.length,Lt=Math.max(mt>>>0,Math.ceil(1.2*yt)),It=Math.ceil((Lt-yt)/65536);try{return Q.grow(It),et(),!0}catch{return!1}},b:nt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming($,dt):$.then(mt=>mt.arrayBuffer()).then(mt=>WebAssembly.instantiate(mt,dt))).then(mt=>{const{Rb:yt,Qb:Lt,P:It,T:Ot,X:Ut,Ja:Ht,La:se,Qa:Kt,Va:ue,Wa:me,eb:Te,jb:Be,f:De,e:_e,yb:Ee,zb:ae,Ab:re,Bb:Ie,Db:Re,Gb:we}=mt.instance.exports;Q=_e;const si=(()=>{let ci=0,ri=0,Xe=0,ji=0;return Qe=>{Xe&&(yt(ji),yt(ci),ri+=Xe,Xe=ci=0),ci||(ri+=128,ci=Lt(ri));const Ci=Qe.length+7&-8;let Zi=ci;Ci>=ri&&(Xe=Ci,Zi=ji=Lt(Ci));for(let fr=0;fr<Qe.length;fr++)Z[Zi+fr]=Qe[fr];return Zi}})();return et(),De(),{memory:_e,_free:yt,_malloc:Lt,Mesh:class{constructor(){this.ptr=It()}destroy(){Ot(this.ptr)}},Decoder:class{constructor(){this.ptr=Ht()}destroy(){Be(this.ptr)}DecodeArrayToMesh(ci,ri,Xe){const ji=si(ci),Qe=se(this.ptr,ji,ri,Xe.ptr);return!!Ut(Qe)}GetAttributeByUniqueId(ci,ri){return{ptr:Kt(this.ptr,ci.ptr,ri)}}GetTrianglesUInt16Array(ci,ri,Xe){ue(this.ptr,ci.ptr,ri,Xe)}GetTrianglesUInt32Array(ci,ri,Xe){me(this.ptr,ci.ptr,ri,Xe)}GetAttributeDataArrayForAllPoints(ci,ri,Xe,ji,Qe){Te(this.ptr,ci.ptr,ri.ptr,Xe,ji,Qe)}},DT_INT8:Ee(),DT_UINT8:ae(),DT_INT16:re(),DT_UINT16:Ie(),DT_UINT32:Re(),DT_FLOAT32:we()}})}(fetch(rV())),L1.then($=>{Ju=$,L1=void 0}))}()),U&&F.push(function(){if(WD)return;const $=function(Z){let Q;const et=WebAssembly.instantiateStreaming(Z,{}).then(mt=>{Q=mt.instance,Q.exports.__wasm_call_ctors()}),nt={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},dt={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:et,supported:!0,decodeGltfBuffer(mt,yt,Lt,It,Ot,Ut){(function(Ht,se,Kt,ue,me,Te,Be){const De=Ht.exports.sbrk,_e=ue+3&-4,Ee=De(_e*me),ae=De(Te.length),re=new Uint8Array(Ht.exports.memory.buffer);re.set(Te,ae);const Ie=se(Ee,ue,me,ae,Te.length);if(Ie===0&&Be&&Be(Ee,_e,me),Kt.set(re.subarray(Ee,Ee+ue*me)),De(Ee-De(0)),Ie!==0)throw new Error(`Malformed buffer data: ${Ie}`)})(Q,Q.exports[dt[Ot]],mt,yt,Lt,It,Q.exports[nt[Ut]])}}}(fetch(nV()));return $.ready.then(()=>{WD=$})}()),S)for(let $=0;$<S.length;$++)F.push(Qnt(S[$],m,$,h));return(F.length?Promise.all(F):Promise.resolve()).then(()=>{if(V&&T)for(const{primitives:$}of T)for(const Z of $)Ynt(Z,m);if(U&&T&&L)for(const $ of L)Knt($,m);return m})})}function hV(d){return fetch(d).then(l=>l.arrayBuffer()).then(l=>cV(l,0,d))}function ZD(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function qD(d){switch(d){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class XD{constructor(l,h,m,_){this.context=l,this.format=m,this.useMipmap=_&&_.useMipmap,this.texture=l.gl.createTexture(),this.update(h,{premultiply:_&&_.premultiply})}update(l,h){const m=l&&l instanceof HTMLVideoElement&&l.width===0?l.videoWidth:l.width,_=l&&l instanceof HTMLVideoElement&&l.height===0?l.videoHeight:l.height,{context:S}=this,{gl:T}=S,{x:C,y:L}=h&&h.position?h.position:{x:0,y:0},k=C+m,F=L+_;!this.size||this.size[0]===k&&this.size[1]===F||(T.bindTexture(T.TEXTURE_2D,null),T.deleteTexture(this.texture),this.texture=T.createTexture(),this.size=null),T.bindTexture(T.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA8&&(!h||h.premultiply!==!1));const V=l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||ImageBitmap&&l instanceof ImageBitmap;if(!this.size&&k>0&&F>0){const U=this.useMipmap?Math.floor(Math.log2(Math.max(k,F)))+1:1;T.texStorage2D(T.TEXTURE_2D,U,this.format,k,F),this.size=[k,F]}this.size&&(V?T.texSubImage2D(T.TEXTURE_2D,0,C,L,ZD(this.format),qD(this.format),l):"data"in l&&l.data&&T.texSubImage2D(T.TEXTURE_2D,0,C,L,m,_,ZD(this.format),qD(this.format),l.data)),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(l,h,m=!1){const{context:_}=this,{gl:S}=_;S.bindTexture(S.TEXTURE_2D,this.texture),l!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,l),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap&&!m?l===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:l),this.minFilter=l),h!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,h),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,h),this.wrapS=h)}bindExtraParam(l,h,m,_,S){const{context:T}=this,{gl:C}=T;C.bindTexture(C.TEXTURE_2D,this.texture),h!==this.magFilter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,h),this.magFilter=h),l!==this.minFilter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,this.useMipmap?l===C.NEAREST?C.NEAREST_MIPMAP_NEAREST:C.LINEAR_MIPMAP_LINEAR:l),this.minFilter=l),m!==this.wrapS&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,m),this.wrapS=m),_!==this.wrapT&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,_),this.wrapT=_),S!==this.compareMode&&(S?(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_FUNC,S)):C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_MODE,C.NONE),this.compareMode=S)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}class k1{constructor(l,h){this.context=l,this.texture=h}bind(l,h){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),l!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l),this.minFilter=l),h!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,h),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,h),this.wrapS=h)}}const tat=gr([{name:"a_pos_3f",components:3,type:"Float32"}]),eat=gr([{name:"a_color_3f",components:3,type:"Float32"}]),iat=gr([{name:"a_color_4f",components:4,type:"Float32"}]),rat=gr([{name:"a_uv_2f",components:2,type:"Float32"}]),nat=gr([{name:"a_normal_3f",components:3,type:"Float32"}]),aat=gr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),oat=gr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function dV(d,l){const h=f2(d.projection,d.zoom,d.width,d.height),m=function(S,T,C,L,k){const F=new X(C.lng-180*Of,C.lat),V=new X(C.lng+180*Of,C.lat),U=S.project(F.lng,F.lat),$=S.project(V.lng,V.lat),Z=-Math.atan2($.y-U.y,$.x-U.x),Q=qt.fromLngLat(C);Q.y=lt(Q.y,-1+Of,1-Of);const et=Q.toLngLat(),nt=S.project(et.lng,et.lat),dt=qt.fromLngLat(et);dt.x+=Of;const mt=dt.toLngLat(),yt=S.project(mt.lng,mt.lat),Lt=pV(yt.x-nt.x,yt.y-nt.y,Z),It=qt.fromLngLat(et);It.y+=Of;const Ot=It.toLngLat(),Ut=S.project(Ot.lng,Ot.lat),Ht=pV(Ut.x-nt.x,Ut.y-nt.y,Z),se=Math.abs(Lt.x)/Math.abs(Ht.y),Kt=D([]);J(Kt,Kt,-Z*(1-(k?0:L)));const ue=D([]);return H(ue,ue,[1,1-(1-se)*L,1]),ue[4]=-Ht.x/Ht.y*L,J(ue,ue,Z),z(ue,Kt,ue),ue}(d.projection,0,d.center,h,l),_=fV(d);return H(m,m,[_,_,1]),m}function fV(d){const l=d.projection,h=f2(d.projection,d.zoom,d.width,d.height),m=YD(l,d.center),_=YD(l,X.convert(l.center));return Math.pow(2,m*h+(1-h)*_)}function f2(d,l,h,m,_=1/0){const S=d.range;if(!S)return 0;const T=Math.min(_,Math.max(h,m)),C=Math.log2(T/1024);return Tt(S[0]+C,S[1]+C,l)}const Of=1/4e4;function YD(d,l){const h=lt(l.lat,-wt,wt),m=new X(l.lng-180*Of,h),_=new X(l.lng+180*Of,h),S=d.project(m.lng,h),T=d.project(_.lng,h),C=qt.fromLngLat(m),L=qt.fromLngLat(_),k=T.x-S.x,F=T.y-S.y,V=L.x-C.x,U=L.y-C.y,$=Math.sqrt((V*V+U*U)/(k*k+F*F));return Math.log2($)}function pV(d,l,h){const m=Math.cos(h),_=Math.sin(h);return{x:d*m-l*_,y:d*_+l*m}}function gV(d,l,h){D(d),J(d,d,wr(l[2])),q(d,d,wr(l[0])),Y(d,d,wr(l[1])),H(d,d,h),z(d,d,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function p2(d,l,h,m,_,S,T,C){const L=[h[0]-l[0],h[1]-l[1],0],k=[m[0]-l[0],m[1]-l[1],0];if(Et(L)<1e-12||Et(k)<1e-12)return xr(d);const F=We([],L,k);xe(F,F),Jt(k,m,l),L[2]=(S-_)*C,k[2]=(T-_)*C;const V=L;return We(V,L,k),xe(V,V),Ja(d,F,V)}function g2(d,l,h=!1){const m=Lf(l.zoom),_=function(S,T,C){const L=T.worldSize,k=[S[12],S[13],S[14]],F=vt(k[1]/L),V=xt(k[0]/L),U=D([]),$=gt(1,F)*L,Z=gt(1,0)*L*Mt(F,T.zoom),Q=1/AD(L);let et=Z*Q;if(C){const yt=f2(T.projection,T.zoom,T.width,T.height,1024);et=Q*T.projection.pixelSpaceConversion(T.center.lat,L,yt)}const nt=B(F,V);zt(nt,nt,ke([],xe([],nt),$*et*k[2]));const dt=function(yt){const Lt=[yt[0],yt[1],yt[2]];let It=[0,1,0];const Ot=We([],It,Lt);return We(It,Lt,Ot),Ue(It)===0&&(It=[0,1,0],We(Ot,Lt,It)),xe(Ot,Ot),xe(It,It),xe(Lt,Lt),[Ot[0],Ot[1],Ot[2],0,It[0],It[1],It[2],0,Lt[0],Lt[1],Lt[2],0,yt[0],yt[1],yt[2],1]}(nt);H(U,U,[et,et,et*$]),N(U,U,[-k[0],-k[1],-k[2]]);const mt=z([],T.globeMatrix,dt);return z(mt,mt,U),z(mt,mt,S),mt}(d,l,h);if(m>0){const S=function(T,C){const L=C.worldSize,k=gt(1,0)*L*Mt(C.center.lat,C.zoom)/AD(L),F=gt(1,C.center.lat)*L,V=D([]);Y(V,V,wr(C.center.lng)),q(V,V,wr(C.center.lat)),N(V,V,[0,0,ds]),H(V,V,[k,k,k*F]);const U=C.point;return N(V,V,[-U.x,-U.y,0]),z(V,V,T),z(V,C.globeMatrix,V)}(d,l);return function(T,C,L){const k=(Z,Q,et)=>{const nt=Et(Z),dt=Et(Q),mt=qh(Z,Q,et);return ke(mt,mt,1/Et(mt)*zi(nt,dt,et))},F=k([T[0],T[1],T[2]],[C[0],C[1],C[2]],L),V=k([T[4],T[5],T[6]],[C[4],C[5],C[6]],L),U=k([T[8],T[9],T[10]],[C[8],C[9],C[10]],L),$=qh([T[12],T[13],T[14]],[C[12],C[13],C[14]],L);return[F[0],F[1],F[2],0,V[0],V[1],V[2],0,U[0],U[1],U[2],0,$[0],$[1],$[2],1]}(_,S,m)}return _}function KD(d,l,h,m){const _=ur.projectAabbCorners(m,h);let S=Number.MAX_VALUE;for(let C=0;C<_.length;++C){const L=_[C];L[0]=(.5*L[0]+.5)*l.width,L[1]=(.5-.5*L[1])*l.height,L[2]<S&&(S=L[2])}const T=function(C){const L=[];let k=0;for(let $=1;$<C.length;$++)(C[$][0]<C[k][0]||C[$][0]===C[k][0]&&C[$][1]<C[k][1])&&(k=$);let F,V=k;const U=new Uint8Array(C.length);do{if(U[V])break;L.push(new Me(C[V][0],C[V][1])),U[V]=1,F=(V+1)%C.length;for(let $=0;$<C.length;$++){if(C[$][0]===C[F][0]&&C[$][1]===C[F][1]||C[$][0]===C[V][0]&&C[$][1]===C[V][1])continue;const Z=[C[$][0]-C[V][0],C[$][1]-C[V][1]],Q=[C[F][0]-C[V][0],C[F][1]-C[V][1]],et=Z[0]*Q[1]-Z[1]*Q[0];(et>0||et===0&&Z[0]*Q[0]+Z[1]*Q[1]>=0&&Z[0]*Z[0]+Z[1]*Z[1]>Q[0]*Q[0]+Q[1]*Q[1])&&(F=$)}V=F}while(V!==k);return L.length>0&&L.push(L[0]),L}(_);if(ra(d,T))return S}const jg=64,K_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function m2(d,l,h,m,_,S,T,C,L,k=!1){const F=h.zoom,V=h.project(m),U=Mt(m.lat,F),$=1/U;D(d),N(d,d,[V.x+T[0]*$,V.y+T[1]*$,T[2]]);let Z=1,Q=1;const et=h.worldSize;if(k){if(h.projection.name==="mercator"){let yt=0;h.elevation&&(yt=h.elevation.getAtPointOrZero(new qt(V.x/et,V.y/et),0));const Lt=Li([],[V.x,V.y,yt,1],h.projMatrix)[3]/h.cameraToCenterDistance;Z=Lt,Q=Lt*Mt(h.center.lat,F)}else if(h.projection.name==="globe"){const yt=g2(d,h),Lt=[0,0,0,1];Li(Lt,Lt,z([],h.projMatrix,yt));const It=Lt[3]/h.cameraToCenterDistance,Ot=Lf(F),Ut=h.projection.pixelsPerMeter(m.lat,et)*Mt(m.lat,F),Ht=h.projection.pixelsPerMeter(h.center.lat,et)*Mt(h.center.lat,F);Z=It/zi(Ut,Rt(h.center.lat),Ot),Q=It*U/Ut,Z*=Ht,Q*=Ht}}else Z=$;H(d,d,[Z,Z,Q]);const nt=[...d],dt=l.orientation,mt=[];if(gV(mt,[dt[0]+(_?_[0]:0),dt[1]+(_?_[1]:0),dt[2]+(_?_[2]:0)],S),z(d,nt,mt),C&&h.elevation){let yt=0;const Lt=[];if(L&&h.elevation){yt=function(Ot,Ut,Ht,se,Kt){const ue=Ut.elevation;if(!ue)return 0;const me=ur.projectAabbCorners(Ht,se),Te=gt(1,Kt.lat)*Ut.worldSize,Be=function(ri,Xe){const ji=[0,0,1],Qe=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ci of Qe){const Zi=ri[Ci.corners[0]],fr=ri[Ci.corners[1]],Pr=ri[Ci.corners[2]],qi=[fr[0]-Zi[0],fr[1]-Zi[1],Xe*(fr[2]-Zi[2])],Br=We(qi,qi,[Pr[0]-Zi[0],Pr[1]-Zi[1],Xe*(Pr[2]-Zi[2])]);xe(Br,Br),Ci.dotProductWithUp=Ke(Br,ji)}return Qe.sort((Ci,Zi)=>Ci.dotProductWithUp-Zi.dotProductWithUp),Qe[0].corners}(me,Te),De=me[Be[0]],_e=me[Be[1]],Ee=me[Be[2]],ae=me[Be[3]],re=ue.getAtPointOrZero(new qt(De[0]/Ut.worldSize,De[1]/Ut.worldSize),0),Ie=ue.getAtPointOrZero(new qt(_e[0]/Ut.worldSize,_e[1]/Ut.worldSize),0),Re=ue.getAtPointOrZero(new qt(Ee[0]/Ut.worldSize,Ee[1]/Ut.worldSize),0),we=ue.getAtPointOrZero(new qt(ae[0]/Ut.worldSize,ae[1]/Ut.worldSize),0),si=(re+we)/2,ci=(Ie+Re)/2;return si>ci?Ie<Re?p2(Ot,_e,ae,De,Ie,we,re,Te):p2(Ot,Ee,De,ae,Re,re,we,Te):re<we?p2(Ot,De,_e,Ee,re,Ie,Re,Te):p2(Ot,ae,Ee,_e,we,Re,Ie,Te),Math.max(si,ci)}(Lt,h,l.aabb,d,m);const It=z([],ft([],Lt),mt);z(d,nt,It)}else yt=h.elevation.getAtPointOrZero(new qt(V.x/et,V.y/et),0);yt!==0&&(d[14]+=yt)}}class mV{constructor(l,h,m,_,S){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=l,this.uri=h,this.position=m!=null?new X(m[0],m[1]):new X(0,0),this.orientation=_??[0,0,0],this.nodes=S,this.uploaded=!1,this.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,h){z(l.globalMatrix,h,l.localMatrix);const m=this.nodeOverrides.get(l.name);if(m!==void 0){const T=[];S=m.orientation,D(_=T),Y(_,_,wr(S[1])),J(_,_,wr(S[2])),q(_,_,wr(S[0])),z(l.globalMatrix,l.globalMatrix,T)}var _,S;if(l.meshes)for(const T of l.meshes){const C=ur.applyTransformFast(T.aabb,l.globalMatrix);this.aabb.encapsulate(C)}if(l.children)for(const T of l.children)this._applyTransformations(T,l.globalMatrix)}computeBoundsAndApplyParent(){const l=D([]);this.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.nodes)this._applyTransformations(h,l)}computeModelMatrix(l,h,m,_,S,T,C=!1){m2(this.matrix,this,l.transform,this.position,h,m,_,S,T,C)}upload(l){if(!this.uploaded){for(const h of this.nodes)JD(h,l);for(const h of this.nodes)v2(h);this.uploaded=!0}}destroy(){for(const l of this.nodes)QD(l)}}function O1(d,l,h=!1){d.uploaded||(d.gfxTexture=new XD(l,d.image,h?l.gl.R8:l.gl.RGBA8,{useMipmap:d.sampler.minFilter>=l.gl.NEAREST_MIPMAP_NEAREST}),d.uploaded=!0,d.image=null)}function sat(d,l,h){d.indexBuffer=l.createIndexBuffer(d.indexArray,!1,!0),d.vertexBuffer=l.createVertexBuffer(d.vertexArray,tat.members,!1,!0),d.normalArray&&(d.normalBuffer=l.createVertexBuffer(d.normalArray,nat.members,!1,!0)),d.texcoordArray&&(d.texcoordBuffer=l.createVertexBuffer(d.texcoordArray,rat.members,!1,!0)),d.colorArray&&(d.colorBuffer=l.createVertexBuffer(d.colorArray,(d.colorArray.bytesPerElement===12?eat:iat).members,!1,!0)),d.featureArray&&(d.pbrBuffer=l.createVertexBuffer(d.featureArray,oat.members,!0)),d.segments=Un.simpleSegment(0,0,d.vertexArray.length,d.indexArray.length);const m=d.material;m.pbrMetallicRoughness.baseColorTexture&&O1(m.pbrMetallicRoughness.baseColorTexture,l),m.pbrMetallicRoughness.metallicRoughnessTexture&&O1(m.pbrMetallicRoughness.metallicRoughnessTexture,l),m.normalTexture&&O1(m.normalTexture,l),m.occlusionTexture&&O1(m.occlusionTexture,l,h),m.emissionTexture&&O1(m.emissionTexture,l)}function JD(d,l,h){if(d.meshes)for(const m of d.meshes)sat(m,l,h);if(d.children)for(const m of d.children)JD(m,l,h)}function v2(d){if(d.meshes)for(const l of d.meshes)l.indexArray.destroy(),l.vertexArray.destroy(),l.colorArray&&l.colorArray.destroy(),l.normalArray&&l.normalArray.destroy(),l.texcoordArray&&l.texcoordArray.destroy(),l.featureArray&&l.featureArray.destroy();if(d.children)for(const l of d.children)v2(l)}function QD(d){if(d.meshes)for(const h of d.meshes)h.vertexBuffer&&(h.vertexBuffer.destroy(),h.indexBuffer.destroy(),h.normalBuffer&&h.normalBuffer.destroy(),h.texcoordBuffer&&h.texcoordBuffer.destroy(),h.colorBuffer&&h.colorBuffer.destroy(),h.pbrBuffer&&h.pbrBuffer.destroy(),h.segments.destroy(),h.material&&((l=h.material).pbrMetallicRoughness.baseColorTexture&&l.pbrMetallicRoughness.baseColorTexture.gfxTexture&&l.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),l.pbrMetallicRoughness.metallicRoughnessTexture&&l.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&l.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),l.normalTexture&&l.normalTexture.gfxTexture&&l.normalTexture.gfxTexture.destroy(),l.emissionTexture&&l.emissionTexture.gfxTexture&&l.emissionTexture.gfxTexture.destroy(),l.occlusionTexture&&l.occlusionTexture.gfxTexture&&l.occlusionTexture.gfxTexture.destroy()));var l;if(d.children)for(const h of d.children)QD(h)}function Wg(d,l){const h=d.json.bufferViews[l.bufferView],m=h2[l.componentType];return new m(d.buffers[h.buffer],(l.byteOffset||0)+(h.byteOffset||0),l.count*(h.byteStride&&h.byteStride!==R1[l.type]*m.BYTES_PER_ELEMENT?h.byteStride/m.BYTES_PER_ELEMENT:R1[l.type]))}function tP(d,l,h,m){const _=h2[l.componentType],S=function(F){switch(F){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(_),T=d.json.bufferViews[l.bufferView],C=T.byteStride?T.byteStride/_.BYTES_PER_ELEMENT:R1[l.type],L=h.float32,k=L.length/h.capacity;for(let F=0,V=0;F<l.count*C;F+=C,V+=k)for(let U=0;U<k;U++)L[V+U]=m[F+U]*S;h._trim()}function lat(d,l,h){const m=d.indices,_=d.attributes,S={};S.indexArray=new Ln;const T=l.json.accessors[m],C=T.count/3;S.indexArray.reserve(C);const L=Wg(l,T);for(let U=0;U<C;U++)S.indexArray.emplaceBack(L[3*U],L[3*U+1],L[3*U+2]);S.indexArray._trim(),S.vertexArray=new qs;const k=l.json.accessors[_.POSITION];S.vertexArray.reserve(k.count);const F=Wg(l,k);for(let U=0;U<k.count;U++)S.vertexArray.emplaceBack(F[3*U],F[3*U+1],F[3*U+2]);if(S.vertexArray._trim(),S.aabb=new ur(k.min,k.max),S.centroid=function(U,$){const Z=[0,0,0],Q=U.length;if(Q>0){for(let et=0;et<Q;et++){const nt=3*U[et];Z[0]+=$[nt],Z[1]+=$[nt+1],Z[2]+=$[nt+2]}Z[0]/=Q,Z[1]/=Q,Z[2]/=Q}return Z}(L,F),_.COLOR_0!==void 0){const U=l.json.accessors[_.COLOR_0],$=R1[U.type],Z=Wg(l,U);S.colorArray=$===3?new qs:new zc,S.colorArray.resize(U.count),tP(l,U,S.colorArray,Z)}if(_.NORMAL!==void 0){S.normalArray=new qs;const U=l.json.accessors[_.NORMAL];S.normalArray.resize(U.count);const $=Wg(l,U);tP(l,U,S.normalArray,$)}if(_.TEXCOORD_0!==void 0&&h.length>0){S.texcoordArray=new Bc;const U=l.json.accessors[_.TEXCOORD_0];S.texcoordArray.resize(U.count);const $=Wg(l,U);tP(l,U,S.texcoordArray,$)}if(_._FEATURE_ID_RGBA4444!==void 0){const U=l.json.accessors[_._FEATURE_ID_RGBA4444];l.json.extensionsUsed&&l.json.extensionsUsed.includes("EXT_meshopt_compression")&&(S.featureData=Wg(l,U))}_._FEATURE_RGBA4444!==void 0&&(S.featureData=new Uint32Array(Wg(l,l.json.accessors[_._FEATURE_RGBA4444]).buffer));const V=d.material;return S.material=function(U,$){const{emissiveFactor:Z=[0,0,0],alphaMode:Q="OPAQUE",alphaCutoff:et=.5,normalTexture:nt,occlusionTexture:dt,emissiveTexture:mt,doubleSided:yt,name:Lt}=U,{baseColorFactor:It=[1,1,1,1],metallicFactor:Ot=1,roughnessFactor:Ut=1,baseColorTexture:Ht,metallicRoughnessTexture:se}=U.pbrMetallicRoughness||{},Kt=dt?$[dt.index]:void 0;if(dt&&dt.extensions&&dt.extensions.KHR_texture_transform&&Kt){const ue=dt.extensions.KHR_texture_transform;Kt.offsetScale=[ue.offset[0],ue.offset[1],ue.scale[0],ue.scale[1]]}return{name:Lt,pbrMetallicRoughness:{baseColorFactor:new Xr(...It),metallicFactor:Ot,roughnessFactor:Ut,baseColorTexture:Ht?$[Ht.index]:void 0,metallicRoughnessTexture:se?$[se.index]:void 0},doubleSided:yt,emissiveFactor:new Xr(...Z),alphaMode:Q,alphaCutoff:et,normalTexture:nt?$[nt.index]:void 0,occlusionTexture:Kt,emissionTexture:mt?$[mt.index]:void 0,defined:U.defined===void 0}}(V!==void 0?l.json.materials[V]:{defined:!1},h),S}function vV(d,l,h){const{matrix:m,rotation:_,translation:S,scale:T,mesh:C,extras:L,children:k,name:F}=d,V={};if(V.name=F,V.localMatrix=m||function(U,$,Z,Q){var et=$[0],nt=$[1],dt=$[2],mt=$[3],yt=et+et,Lt=nt+nt,It=dt+dt,Ot=et*yt,Ut=et*Lt,Ht=et*It,se=nt*Lt,Kt=nt*It,ue=dt*It,me=mt*yt,Te=mt*Lt,Be=mt*It,De=Q[0],_e=Q[1],Ee=Q[2];return U[0]=(1-(se+ue))*De,U[1]=(Ut+Be)*De,U[2]=(Ht-Te)*De,U[3]=0,U[4]=(Ut-Be)*_e,U[5]=(1-(Ot+ue))*_e,U[6]=(Kt+me)*_e,U[7]=0,U[8]=(Ht+Te)*Ee,U[9]=(Kt-me)*Ee,U[10]=(1-(Ot+se))*Ee,U[11]=0,U[12]=Z[0],U[13]=Z[1],U[14]=Z[2],U[15]=1,U}([],_||[0,0,0,1],S||[0,0,0],T||[1,1,1]),V.globalMatrix=E(V.localMatrix),C!==void 0){V.meshes=h[C];const U=V.anchor=[0,0];for(const $ of V.meshes){const{min:Z,max:Q}=$.aabb;U[0]+=Z[0]+Q[0],U[1]+=Z[1]+Q[1]}U[0]=Math.floor(U[0]/V.meshes.length/2),U[1]=Math.floor(U[1]/V.meshes.length/2)}if(L&&(L.id&&(V.id=L.id),L.lights&&(V.lights=function(U){if(!U.length)return[];const $=function(dt){const mt=atob(dt),yt=new Uint8Array(mt.length);for(let Lt=0;Lt<mt.length;Lt++)yt[Lt]=mt.codePointAt(Lt);return yt}(U),Z=[],Q=$.length/24,et=new Uint16Array($.buffer),nt=new Float32Array($.buffer);for(let dt=0;dt<Q;dt++){const mt=et[2*dt*6]/30,yt=et[2*dt*6+1]/30,Lt=et[2*dt*6+10]/100,It=nt[6*dt+1],Ot=nt[6*dt+2],Ut=nt[6*dt+3],Ht=nt[6*dt+4],se=Ut-It,Kt=Ht-Ot,ue=Math.hypot(se,Kt);Z.push({pos:[It+.5*se,Ot+.5*Kt,yt],normal:[Kt/ue,-se/ue,0],width:ue,height:mt,depth:Lt,points:[It,Ot,Ut,Ht]})}return Z}(L.lights)),L.MAPBOX_geometry_bloom&&(V.isGeometryBloom=L.MAPBOX_geometry_bloom)),k){const U=[];for(const $ of k)U.push(vV(l.json.nodes[$],l,h));V.children=U}return V}function uat(d){if(d.vertices.length===0||d.indices.length===0)return null;const l=new r2(d.vertices,d.indices,8,256),[h,m]=[l.min.clone(),l.max.clone()];return{vertices:d.vertices,indices:d.indices,grid:l,min:h,max:m}}function cat(d){if(!d.extras||!d.extras.ground)return null;const l=d.extras.ground;if(!l||!Array.isArray(l)||l.length===0)return null;const h=l[0];if(!h||!Array.isArray(h)||h.length===0)return null;const m=[];for(const T of h){if(!Array.isArray(T)||T.length!==2)continue;const C=T[0],L=T[1];typeof C=="number"&&typeof L=="number"&&m.push(new Me(C,L))}if(m.length<3)return null;m.length>1&&m[m.length-1].equals(m[0])&&m.pop();let _=0;for(let T=0;T<m.length;T++){const C=m[T],L=m[(T+1)%m.length],k=m[(T+2)%m.length];_+=(C.x-L.x)*(k.y-L.y)-(k.x-L.x)*(C.y-L.y)}_>0&&m.reverse();const S=W_(m.flatMap(T=>[T.x,T.y]),[]);return S.length===0?null:{vertices:m,indices:S}}function hat(d,l){const h=[],m=[];let _=0;const S=[];for(const T of d){_=h.length;const C=T.vertexArray.float32,L=T.indexArray.uint16;for(let k=0;k<T.vertexArray.length;k++)S[0]=C[3*k+0],S[1]=C[3*k+1],S[2]=C[3*k+2],Bt(S,S,l),h.push(new Me(S[0],S[1]));for(let k=0;k<3*T.indexArray.length;k++)m.push(L[k]+_)}if(m.length%3!=0)return null;for(let T=0;T<m.length;T+=3){const C=h[m[T+0]],L=h[m[T+1]],k=h[m[T+2]];(C.x-L.x)*(k.y-L.y)-(k.x-L.x)*(C.y-L.y)>0&&([m[T+1],m[T+2]]=[m[T+2],m[T+1]])}return{vertices:h,indices:m}}function eP(d){const l=function(L,k){const F=[],V=WebGL2RenderingContext;if(L.json.textures)for(const U of L.json.textures){const $={magFilter:V.LINEAR,minFilter:V.NEAREST,wrapS:V.REPEAT,wrapT:V.REPEAT};U.sampler!==void 0&&Object.assign($,L.json.samplers[U.sampler]),F.push({image:k[U.source],sampler:$,uploaded:!1})}return F}(d,d.images),h=function(L,k){const F=[];for(const V of L.json.meshes){const U=[];for(const $ of V.primitives)U.push(lat($,L,k));F.push(U)}return F}(d,l),{scenes:m,scene:_,nodes:S}=d.json,T=m?m[_||0].nodes:[...S.keys()],C=[];for(const L of T)C.push(vV(S[L],d,h));return function(L,k,F){const V={},U=new Set;for(let $=0;$<L.length;$++){const Z=F[k[$]];if(!Z.extras)continue;const Q=Z.extras["mapbox:footprint:version"],et=Z.extras["mapbox:footprint:id"];(Q||et)&&U.add($),Q==="1.0.0"&&et&&(V[et]=$)}for(let $=0;$<L.length;$++){if(U.has($))continue;const Z=L[$],Q=F[k[$]];if(!Q.extras)continue;let et=null;Z.id in V&&(et=hat(L[V[Z.id]].meshes,Z.localMatrix)),et||(et=cat(Q)),et&&(Z.footprint=uat(et))}if(U.size>0){const $=Array.from(U.values()).sort((Z,Q)=>Z-Q);for(let Z=$.length-1;Z>=0;Z--)L.splice($[Z],1)}}(C,T,d.json.nodes),C}function dat(d){d.heightmap=new Float32Array(4096),d.heightmap.fill(-1);const l=d.vertexArray.float32,h=d.aabb.min[0]-1,m=d.aabb.min[1]-1,_=jg/(d.aabb.max[0]-h+2),S=jg/(d.aabb.max[1]-m+2);for(let T=0;T<l.length;T+=3){const C=l[T+2],L=(l[T+0]-h)*_|0,k=(l[T+1]-m)*S|0;C>d.heightmap[k*jg+L]&&(d.heightmap[k*jg+L]=C)}}function _V(d,l,h,m,_){h.reserve(h.length+4*d.length),m.reserve(m.length+10*d.length),_.reserve(_.length+10*d.length);let S=m.length;for(const T of d){const C=Math.min(10,Math.max(4,1.3*T.height))*l,L=[-T.normal[1],T.normal[0],0],k=Math.min(.29,.1*T.width/T.depth),F=T.width-2*T.depth*l*(k+.01),V=ni([],T.pos,L,F/2),U=ni([],T.pos,L,-F/2),$=[V[0],V[1],V[2]+T.height],Z=[U[0],U[1],U[2]+T.height],Q=ni([],T.normal,L,k);ke(Q,Q,C);const et=ni([],T.normal,L,-k);ke(et,et,C),zt(Q,V,Q),zt(et,U,et),V[2]+=.1,U[2]+=.1,m.emplaceBack(Q[0],Q[1],Q[2]),m.emplaceBack(et[0],et[1],et[2]),m.emplaceBack(V[0],V[1],V[2]),m.emplaceBack(U[0],U[1],U[2]),m.emplaceBack($[0],$[1],$[2]),m.emplaceBack(Z[0],Z[1],Z[2]),m.emplaceBack(V[0],V[1],V[2]),m.emplaceBack(U[0],U[1],U[2]),m.emplaceBack(Q[0],Q[1],Q[2]),m.emplaceBack(et[0],et[1],et[2]);const nt=F/C/2;_.emplaceBack(-nt-k,-1,nt,.8),_.emplaceBack(nt+k,-1,nt,.8),_.emplaceBack(-nt,0,nt,1.3),_.emplaceBack(nt,0,nt,1.3),_.emplaceBack(nt+k,-.8,nt,.7),_.emplaceBack(nt+k,-.8,nt,.7),_.emplaceBack(0,0,nt,1.3),_.emplaceBack(0,0,nt,1.3),_.emplaceBack(nt+k,-1.2,nt,.8),_.emplaceBack(nt+k,-1.2,nt,.8),h.emplaceBack(6+S,4+S,8+S),h.emplaceBack(7+S,9+S,5+S),h.emplaceBack(0+S,1+S,2+S),h.emplaceBack(1+S,3+S,2+S),S+=10}}function fat(d,l){const h={};h.indexArray=new Ln,h.vertexArray=new qs,h.colorArray=new zc,_V(d,l,h.indexArray,h.vertexArray,h.colorArray);const m={defined:!0};m.emissiveFactor=Xr.black;const _={};return _.baseColorFactor=Xr.white,m.pbrMetallicRoughness=_,h.material=m,h.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),h}const yV=gr([{name:"a_pos_3f",components:3,type:"Float32"}]),pat=gr([{name:"a_normal_3",components:3,type:"Int16"}]),gat=gr([{name:"a_centroid_3",components:3,type:"Int16"}]),xV=gr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),mat=gr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),vat=gr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),_at=gr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),yat=gr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),xat=gr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),bV=Ae.types,_2=32767;function bat(d,l){const h=Ve+l;for(const m of d)for(const _ of m)if(_.x<-l||_.x>h||_.y<-l||_.y>h)return!1;return!0}class wV{constructor(){this.layoutVertexArray=new qs,this.layoutAttenuationArray=new zc,this.layoutColorArray=new Al,this.indexArray=new Ln,this.indexArrayForConflation=new Ln,this.segmentsBucket=new Un}}class iP{constructor(){this.layoutVertexArray=new qs,this.layoutNormalArray=new jh,this.layoutCentroidArray=new jh,this.layoutColorArray=new Al,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new O_,this.layoutAOArray=new qu,this.indexArray=new Ln,this.indexArrayForConflation=new Ln,this.segmentsBucket=new Un,this.entranceBloom=new wV}}class SV{constructor(l){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new iP,this.buildingWithFacade=new iP,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=l.zoom,this.canonical=l.canonical,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.hasPattern=!1,this.worldview=l.worldview,this.lut=l.lut,this.buildingWithFacade.layoutFacadePaintArray=new Al,this.buildingWithFacade.layoutFacadeDataArray=new Wh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Al,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.projection=l.projection,this.groundEffect=new VD(l),this.groundEffect.groundRadiusArray=new qu,this.hasAppearances=null}updateFootprints(l,h){for(const m of this.footprints)h.push({footprint:m,id:l})}updateAppearances(l,h,m,_){}prepare(){return function(){if(c2!=null||iV!=null)return null;if(Y_!=null)return Y_;const l=fetch(An.BUILDING_GEN_URL);return Y_=function(h){let m,_,S,T;function C(){m=new Uint8Array(T.buffer),_=new Int32Array(T.buffer),S=new Float32Array(T.buffer)}function L(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},F={a:{a:L,f:function(V){const U=m.length,$=Math.max(V>>>0,Math.ceil(1.2*U)),Z=Math.ceil(($-U)/65536);try{return T.grow(Z),C(),!0}catch{return!1}},g:L,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(h,F):h.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,F))).then(V=>{const U=V.instance.exports;return(0,U.g)(),T=U.f,C(),new Znt({setStyle:U.h,setAOOptions:U.i,setMetricOptions:U.j,setStructuralOptions:U.k,setFacadeOptions:U.l,setFauxFacadeOptions:U.m,setFacadeClassifierOptions:U.n,addFeature:U.o,addFacade:U.p,generateMesh:U.q,getLastError:U.r,getOuterRingLength:U.s,getMeshCount:U.t,getPositionsPtr:U.u,getPositionsLength:U.v,getNormalsPtr:U.w,getNormalsLength:U.x,getColorsPtr:U.y,getColorsLength:U.z,getAOPtr:U.A,getAOLength:U.B,getUVPtr:U.C,getUVLength:U.D,getFauxFacadePtr:U.E,getFauxFacadeLength:U.F,getIndicesPtr:U.G,getIndicesLength:U.H,getBuildingPart:U.I,getRingCount:U.J,getRingPtr:U.K,getRingLength:U.L,free:U.M,malloc:U.N,heapU8:m,heap32:_,heapF32:S})})}(l).then(h=>(Y_=null,c2=h,c2)).catch(h=>{Mi("Could not load building-gen"),Y_=null,iV=h}),Y_}()}populate(l,h,m,_){const S=qnt();if(!S)return;const T=kt(m);this.tileToMeter=T,this.brightness=h.brightness,S.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,T],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:T,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),S.setAOOptions(!1,.3),S.setMetricOptions(!1,16),S.setStructuralOptions(!0),S.setFacadeClassifierOptions(3);const C=new Map,L=new Map;for(const{feature:k}of l){if(bV[k.type]!=="LineString"){C.set(k.id,k.properties.source_id);continue}const F=this.layers[0]._featureFilter.needGeometry,V=ee(k,F);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),V,m))continue;const U=F?V.geometry:pe(k,m,_),$=[];for(const nt of U)for(const dt of nt)$.push({x:dt.x,y:dt.y});const Z={coordinates:$,crossPerc:k.properties.cross_perc,distanceToRoad:k.properties.distance_to_road,entrances:k.properties.entrances,sourceId:0},Q=k.properties.source_id;let et=L.get(Q);et||(et=[],L.set(Q,et)),et.push(Z)}this.maxHeight=0;for(const{feature:k,id:F,index:V,sourceLayerIndex:U}of l){if(bV[k.type]==="LineString")continue;const $=this.layers[0]._featureFilter.needGeometry,Z=ee(k,$);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),Z,m))continue;const Q=$?Z.geometry:pe(k,m,_),et=T1(Q,500);if(!bat(Q,163))continue;const nt=this.layers[0],dt=nt.layout.get("building-roof-shape").evaluate(k,{},m);if(dt==="flat")continue;const mt=nt.layout.get("building-base").evaluate(k,{},m),yt=nt.layout.get("building-height").evaluate(k,{},m),Lt=nt.layout.get("building-flood-light-ground-radius").evaluate(k,{},m),It=nt.paint.get("building-ambient-occlusion-intensity"),Ot=Lt/this.tileToMeter;let Ut=nt.layout.get("building-flood-light-wall-radius").evaluate(k,{},m);Ut=lt(Ut,0,2048);const Ht=Ut/2048*_2,se=C.get(F);let Kt;Kt=L.has(se)?L.get(se):[];const ue=Kt.length!==0&&nt.layout.get("building-facade").evaluate(k,{},m);S.setFacadeOptions(4,!0),S.setFauxFacadeOptions(ue,!1,1);let me=0,Te=0,Be=0,De=0,_e=0,Ee=0;if(ue){let de=Math.round(nt.layout.get("building-facade-floors").evaluate(k,{},m));if(mt===0){de=Math.max(1,de-(Kt.length>0?1:0));let vi=4;if(yt>100){const gi=[10,13,15];vi=gi[k.id?k.id%gi.length:0],S.setFacadeOptions(vi,!0)}_e=1.6803*vi/T}else _e=mt/T;Ee=yt/T,_e=Math.min(_e,Ee),Be=nt.layout.get("building-facade-unit-width").evaluate(k,{},m)/T,De=(Ee-_e)/de,S.setFauxFacadeOptions(!0,!0,Be);const Je=nt.layout.get("building-facade-window").evaluate(k,{},m);me=Je[0],Te=Je[1]}const ae=[],re=new Me(1/0,1/0),Ie=new Me(-1/0,-1/0),Re=new Me(0,0);let we=0;for(const de of et)if(de.length>0){const Je=[];for(const vi of de){const gi=[];for(let Ji=vi.length-1;Ji>=0;Ji--){const Ri=vi[Ji];gi.push({x:Ri.x,y:Ri.y}),re.x=Math.min(re.x,Ri.x),re.y=Math.min(re.y,Ri.y),Ie.x=Math.max(Ie.x,Ri.x),Ie.y=Math.max(Ie.y,Ri.y),Re.x+=Ri.x,Re.y+=Ri.y,we++}Je.push(gi)}ae.push({id:k.id?k.id:0,height:yt,minHeight:mt,sourceId:0,roofType:dt,coordinates:Je})}Re.x/=we||1,Re.y/=we||1;const si=S.generateMesh(ae,Kt);if(typeof si=="string"){Mi(`Unable to generate building ${k.id}: ${si}`);continue}if(si.meshes.length===0||si.modifiedPolygonRings.length===0)continue;let ci=0;for(const de of si.meshes)ci+=de.positions.length/3;const ri=ue?this.buildingWithFacade:this.buildingWithoutFacade,Xe=ri.segmentsBucket.prepareSegment(ci,ri.layoutVertexArray,ri.indexArray),ji=[];let Qe=null,Ci=0,Zi=-1;const fr=ri.layoutVertexArray.length,Pr=ri.indexArray.length;let qi=0;for(const de of si.meshes){const Je=ri.layoutVertexArray.length;if(de.buildingPart==="entrance"){const di=new Array;for(let Mr=0;Mr<de.positions.length;Mr+=12){const un=de.positions[Mr+0],Yr=de.positions[Mr+1],qn=de.positions[Mr+3],Cn=de.positions[Mr+4],mn=de.positions[Mr+2],rn=de.positions[Mr+8]-mn,Nr=1,Qi=qn-un,Vr=Cn-Yr,vn=Math.hypot(Qi,Vr);di.push({pos:[un+.5*Qi,Yr+.5*Vr,mn],normal:[Vr/vn,-Qi/vn,0],width:vn,height:rn,depth:Nr,points:[un,Yr,qn,Cn]})}const zr=ri.entranceBloom.segmentsBucket.prepareSegment(10*di.length,ri.entranceBloom.layoutVertexArray,ri.entranceBloom.indexArray),ln=ri.entranceBloom.layoutVertexArray.length;Ci=ri.entranceBloom.indexArray.length,_V(di,.5/this.tileToMeter,ri.entranceBloom.indexArray,ri.entranceBloom.layoutVertexArray,ri.entranceBloom.layoutAttenuationArray);const Oi=ri.entranceBloom.layoutVertexArray.length-ln;Zi=ri.entranceBloom.indexArray.length-Ci;for(let Mr=0;Mr<Oi;Mr++)ri.entranceBloom.layoutColorArray.emplaceBack(65535,65535);zr.vertexLength+=Oi,zr.primitiveLength+=Zi,Qe={part:de.buildingPart,vertexOffset:ln,vertexLength:Oi}}for(let di=0;di<de.positions.length;di+=3)qi=Math.max(qi,de.positions[di+2]),ri.layoutVertexArray.emplaceBack(de.positions[di],de.positions[di+1],de.positions[di+2]);const vi=Math.floor(Re.x),gi=Math.floor(Re.y),Ji=Math.floor(qi);for(let di=0;di<de.positions.length;di+=3)ri.layoutCentroidArray.emplaceBack(vi,gi,Ji),ri.layoutFloodLightDataArray.emplaceBack(de.buildingPart==="wall"?Ht:0);for(let di=0;di<de.normals.length;di+=3)ri.layoutNormalArray.emplaceBack(de.normals[di+0]*_2,de.normals[di+1]*_2,de.normals[di+2]*_2);for(let di=0;di<de.ao.length;di++)ri.layoutAOArray.emplaceBack(de.ao[di]);for(let di=0;di<de.colors.length;di+=3){const zr=1+(de.ao[di/3]-1)*It;ri.layoutColorArray.emplaceBack(de.colors[di]*zr<<8|de.colors[di+1]*zr,de.colors[di+2]*zr<<8)}if(ue){for(let di=0;di<de.positions.length;di+=3)ri.layoutFacadePaintArray.emplaceBack(65535,255);for(let di=0;di<de.isFauxFacade.length;di++)if(de.isFauxFacade[di]){const zr=1|Math.min(65535,Math.floor(de.uv[2*di]*si.outerRingLength)),ln=Math.floor(255*me)<<8|Math.floor(255*Te),Oi=Math.floor(65535*Math.min(1,Be/Ve)),Mr=Math.floor(65535*Math.min(1,De/Ve));ri.layoutFacadeDataArray.emplaceBack(zr,ln,Oi,Mr);const un=Math.floor(65535*Math.min(1,_e/Ve)),Yr=Math.floor(65535*Math.min(1,Ee/Ve));ri.layoutFacadeVerticalRangeArray.emplaceBack(un,Yr)}else ri.layoutFacadeDataArray.emplaceBack(0,0,0,0),ri.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ri=Xe.vertexLength;for(let di=0;di<de.indices.length;di+=3)ri.indexArray.emplaceBack(Ri+de.indices[di],Ri+de.indices[di+1],Ri+de.indices[di+2]);Xe.vertexLength+=de.positions.length/3,Xe.primitiveLength+=de.indices.length/3,(de.buildingPart==="roof"||de.buildingPart==="wall"||de.buildingPart==="facade_glazing"||de.buildingPart==="entrance")&&ji.push({part:de.buildingPart,vertexOffset:Je,vertexLength:de.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,qi),this.buildingFeatures.push({promoteId:F,feature:Z,hasFauxFacade:ue,segment:Xe,parts:ji,buildingBloom:Qe});const Br=ri.indexArray.length-Pr,Fr=[],Fn=[],Ct=new Me(1/0,1/0),St=new Me(-1/0,-1/0),he=this.groundEffect.vertexArray.length;for(const de of si.modifiedPolygonRings){const Je=[],vi=new Me(1/0,1/0),gi=new Me(-1/0,-1/0);for(let Ji=0;Ji<de.length;Ji+=2){const Ri=de.length-Ji-2;vi.x=Math.min(vi.x,de[Ri]),vi.y=Math.min(vi.y,de[Ri+1]),gi.x=Math.max(gi.x,de[Ri]),gi.y=Math.max(gi.y,de[Ri+1]);const di=new Me(de[Ri],de[Ri+1]);Je.push(di),Fr.push(di.x,di.y),Fn.push(di.clone())}Ct.x=Math.min(Ct.x,vi.x),Ct.y=Math.min(Ct.y,vi.y),St.x=Math.max(St.x,gi.x),St.y=Math.max(St.y,gi.y),this.groundEffect.addData(Je,[vi,gi],Ot)}const je=this.groundEffect.vertexArray.length-he;for(let de=0;de<je;de++)this.groundEffect.groundRadiusArray.emplaceBack(Lt);(re.x<0||Ie.x>Ve||re.y<0||Ie.y>Ve)&&this.featuresOnBorder.push({featureId:k.id,footprintIndex:this.footprints.length});{const de=W_(Fr,null,2),Je=new r2(Fn,de,8,256);let vi=k.id;k.properties&&k.properties.hasOwnProperty("building_id")&&(vi=k.properties.building_id);const gi={vertices:Fn,indices:de,grid:Je,min:Ct,max:St,buildingId:vi,hiddenFlags:0,indicesOffset:Pr,indicesLength:Br,bloomIndicesOffset:Ci,bloomIndicesLength:Zi,groundEffectVertexOffset:he,groundEffectVertexLength:je,hasFauxFacade:ue,segment:Xe,height:qi};k.id!==void 0&&this.featureFootprintLookup.set(k.id,this.footprints.length),this.footprints.push(gi)}this.programConfigurations.populatePaintArrays(ri.layoutVertexArray.length,k,V,{},h.availableImages,m,h.brightness),this.groundEffect.addPaintPropertiesData(k,V,{},h.availableImages,m,h.brightness),h.featureIndex.insert(k,Q,V,U,this.index,fr)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(l,h,m,_,S,T,C){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C),this.groundEffect.update(l,h,S,m,_,T,C),this.evaluate(this.layers[0],l),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(l){const h=m=>{m.layoutVertexBuffer=l.createVertexBuffer(m.layoutVertexArray,yV.members),m.layoutNormalBuffer=l.createVertexBuffer(m.layoutNormalArray,pat.members),m.layoutCentroidBuffer=l.createVertexBuffer(m.layoutCentroidArray,gat.members),m.layoutFloodLightDataBuffer=l.createVertexBuffer(m.layoutFloodLightDataArray,xat.members),m.layoutFacadeDataArray&&m.layoutFacadeDataArray.length&&(m.layoutFacadeDataBuffer=l.createVertexBuffer(m.layoutFacadeDataArray,vat.members)),m.layoutFacadeVerticalRangeArray&&m.layoutFacadeVerticalRangeArray.length&&(m.layoutFacadeVerticalRangeBuffer=l.createVertexBuffer(m.layoutFacadeVerticalRangeArray,_at.members)),m.entranceBloom.layoutVertexArray.length&&(m.entranceBloom.layoutVertexBuffer=l.createVertexBuffer(m.entranceBloom.layoutVertexArray,yV.members),m.entranceBloom.layoutAttenuationBuffer=l.createVertexBuffer(m.entranceBloom.layoutAttenuationArray,yat.members)),this.uploadUpdatedColorBuffer(l),this.uploadUpdatedIndexBuffer(l)};this.uploaded||(h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.groundEffect.upload(l)),this.groundEffect.uploadPaintProperties(l),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){const l=h=>{h.layoutVertexBuffer&&(h.layoutVertexBuffer.destroy(),h.layoutNormalBuffer.destroy(),h.layoutColorBuffer.destroy(),h.segmentsBucket.destroy(),h.indexBuffer&&h.indexBuffer.destroy(),h.entranceBloom.layoutVertexBuffer&&(h.entranceBloom.layoutVertexBuffer.destroy(),h.entranceBloom.layoutColorBuffer.destroy(),h.entranceBloom.layoutAttenuationBuffer.destroy(),h.entranceBloom.indexBuffer.destroy(),h.entranceBloom.segmentsBucket.destroy()))};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(l,h,m=!0){let _=!1;const S=m?h:0,T=0|(m?-1:~h);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const C of l){const L=this.footprints[C],k=L.hiddenFlags&T|S;L.hiddenFlags!==k&&(L.hiddenFlags=k,_=!0,this.groundEffect.updateHiddenByLandmarkRange(L.groundEffectVertexOffset,L.groundEffectVertexLength,L.hiddenFlags!==0))}return _&&(this.indexArrayForConflationUploaded=!1),_}uploadUpdatedIndexBuffer(l){if(this.groundEffect.uploadHiddenByLandmark(l),this.indexArrayForConflationUploaded)return;const h=_=>{_.indexArray.length!==0&&(_.indexArrayForConflation.resize(_.indexArray.length),_.indexArrayForConflation.uint16.set(_.indexArray.uint16),_.entranceBloom.indexArrayForConflation.resize(_.entranceBloom.indexArray.length),_.entranceBloom.indexArrayForConflation.uint16.set(_.entranceBloom.indexArray.uint16))};h(this.buildingWithoutFacade),h(this.buildingWithFacade);for(const _ of this.footprints){const S=_.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,T=_.indicesOffset+_.indicesLength;if(_.hiddenFlags!==0){for(let L=_.indicesOffset;L<T;L++)S.indexArrayForConflation.uint16[3*L+0]=0,S.indexArrayForConflation.uint16[3*L+1]=0,S.indexArrayForConflation.uint16[3*L+2]=0;const C=_.bloomIndicesOffset+_.bloomIndicesLength;for(let L=_.bloomIndicesOffset;L<C;L++)S.entranceBloom.indexArrayForConflation.uint16[3*L+0]=0,S.entranceBloom.indexArrayForConflation.uint16[3*L+1]=0,S.entranceBloom.indexArrayForConflation.uint16[3*L+2]=0}}const m=_=>{_.indexArray.length!==0&&(_.indexBuffer?_.indexBuffer.updateData(_.indexArrayForConflation):_.indexBuffer=l.createIndexBuffer(_.indexArrayForConflation,!0),_.entranceBloom.indexBuffer?_.entranceBloom.indexBuffer.updateData(_.entranceBloom.indexArrayForConflation):_.entranceBloom.indexBuffer=l.createIndexBuffer(_.entranceBloom.indexArrayForConflation,!0))};m(this.buildingWithoutFacade),m(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(l){const h=m=>{m.layoutColorBuffer?m.layoutColorBuffer.updateData(m.layoutColorArray):m.layoutColorBuffer=l.createVertexBuffer(m.layoutColorArray,xV.members,!0),m.layoutFacadePaintArray&&(m.layoutFacadePaintBuffer?m.layoutFacadePaintBuffer.updateData(m.layoutFacadePaintArray):m.layoutFacadePaintBuffer=l.createVertexBuffer(m.layoutFacadePaintArray,mat.members,!0)),m.entranceBloom.layoutColorBuffer?m.entranceBloom.layoutColorBuffer.updateData(m.entranceBloom.layoutColorArray):m.entranceBloom.layoutColorBuffer=l.createVertexBuffer(m.entranceBloom.layoutColorArray,xV.members,!0)};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(l,h){const m=l.paint.get("building-ambient-occlusion-intensity");for(const _ of this.buildingFeatures){const S=h[_.promoteId],T=_.feature;T.properties["building-part"]="roof";const C=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),L=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical);T.properties["building-part"]="wall";const k=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),F=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical);T.properties["building-part"]="window";const V=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),U=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical);T.properties["building-part"]="door";const $=l.paint.get("building-color").evaluate(T,S,this.canonical).toPremultipliedRenderColor(this.lut),Z=l.paint.get("building-emissive-strength").evaluate(T,S,this.canonical),Q=_.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const nt of _.parts){let dt,mt=C;nt.part==="roof"?(mt=C,dt=L):nt.part==="wall"?(mt=k,dt=F):nt.part==="facade_glazing"?(mt=V,dt=U):nt.part==="entrance"&&(mt=$,dt=Z),dt=lt(dt,0,1);for(let yt=0;yt<nt.vertexLength;yt++){const Lt=nt.vertexOffset+yt,It=1+(Q.layoutAOArray.float32[Lt]-1)*m;Q.layoutColorArray.emplace(Lt,mt.r*It*255<<8|mt.g*It*255,mt.b*It*255<<8|255*dt),_.hasFauxFacade&&Q.layoutFacadePaintArray.emplace(Lt,255*V.r<<8|255*V.g,255*V.b<<8|255*U)}}const et=_.buildingBloom;if(et)for(let nt=0;nt<et.vertexLength;nt++)Q.entranceBloom.layoutColorArray.emplace(et.vertexOffset+nt,255*$.r<<8|255*$.g,255*$.b<<8|51*Z)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(l,h,m){if(h.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=h.updateTime;const _=h.getReplacementRegionsForTile(l.toUnwrapped());if(a2(this.activeReplacements,_))return;this.activeReplacements=_;for(const T of this.footprints)T.hiddenFlags&=-2;const S=[];for(const T of this.activeReplacements){if(T.order<=T5)continue;const C=Math.max(1,Math.pow(2,T.footprintTileId.canonical.z-l.canonical.z));for(const L of this.footprints)L.min.x>T.max.x||L.max.x<T.min.x||L.min.y>T.max.y||L.max.y<T.min.y||(S.length=0,wat(L.vertices,0,L.vertices.length,T.footprintTileId.canonical,l.canonical,S),zD(T.footprint,S,L.indices,0,L.indices.length,0,-C)&&(L.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const T of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(l){if(l.id!==void 0){const h=this.featureFootprintLookup.get(l.id);return this.footprints[h]}return null}getHeightAtTileCoord(l,h){let m=Number.NEGATIVE_INFINITY,_=!0;const S=4*(l+Ve)*Ve+(h+Ve);if(this.footprintLookup.hasOwnProperty(S)){const C=this.footprintLookup[S];return C?{height:C.height,hidden:C.hiddenFlags!==0}:void 0}const T=new Me(l,h);for(const C of this.footprints)l>C.max.x||C.min.x>l||h>C.max.y||C.min.y>h||C.height<=m||BD(T,C)&&(m=C.height,this.footprintLookup[S]=C,_=C.hiddenFlags!==0);if(m!==Number.NEGATIVE_INFINITY)return{height:m,hidden:_};this.footprintLookup[S]=void 0}}function wat(d,l,h,m,_,S){const T=Math.pow(2,m.z-_.z);for(let C=0;C<h;C++){let L=d[C+l].x,k=d[C+l].y;L=(L+_.x*Ve)*T-m.x*Ve,k=(k+_.y*Ve)*T-m.y*Ve,S.push(new Me(L,k))}}let TV,AV;li(SV,"BuildingBucket",{omit:["layers"]}),li(iP,"BuildingGeometry"),li(wV,"BuildingBloomGeometry");const Sat=gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Tat=gr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Aat}=Sat,Iat=gr([{name:"a_packed",components:3,type:"Float32"}]),{members:Cat}=Iat,Mat=gr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Eat}=Mat;class IV{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.image=new Rf({width:l,height:h}),this.positions={},this.uploaded=!1}getDash(l,h){const m=this.getKey(l,h);return this.positions[m]}trim(){const l=this.width,h=this.height=$t(this.nextRow);this.image.resize({width:l,height:h})}getKey(l,h){return l.join(",")+h}getDashRanges(l,h,m){const _=[];let S=l.length%2==1?-l[l.length-1]*m:0,T=l[0]*m,C=!0;_.push({left:S,right:T,isDash:C,zeroLength:l[0]===0});let L=l[0];for(let k=1;k<l.length;k++){C=!C;const F=l[k];S=L*m,L+=F,T=L*m,_.push({left:S,right:T,isDash:C,zeroLength:F===0})}return _}addRoundDash(l,h,m){const _=h/2;for(let S=-m;S<=m;S++){const T=this.width*(this.nextRow+m+S);let C=0,L=l[C];for(let k=0;k<this.width;k++){k/L.right>1&&(L=l[++C]);const F=Math.abs(k-L.left),V=Math.abs(k-L.right),U=Math.min(F,V);let $;const Z=S/m*(_+1);if(L.isDash){const Q=_-Math.abs(Z);$=Math.sqrt(U*U+Q*Q)}else $=_-Math.sqrt(U*U+Z*Z);this.image.data[T+k]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(l,h){for(let L=l.length-1;L>=0;--L){const k=l[L],F=l[L+1];k.zeroLength?l.splice(L,1):F&&F.isDash===k.isDash&&(F.left=k.left,l.splice(L,1))}const m=l[0],_=l[l.length-1];m.isDash===_.isDash&&(m.left=_.left-this.width,_.right=m.right+this.width);const S=this.width*this.nextRow;let T=0,C=l[T];for(let L=0;L<this.width;L++){L/C.right>1&&(C=l[++T]);const k=Math.abs(L-C.left),F=Math.abs(L-C.right),V=Math.min(k,F);this.image.data[S+L]=Math.max(0,Math.min(255,(C.isDash?V:-V)+h+128))}}addDash(l,h){const m=this.getKey(l,h);if(this.positions[m])return this.positions[m];const _=h==="round",S=_?7:0,T=2*S+1;if(this.nextRow+T>this.height)return Mi("LineAtlas out of space"),null;l.length===0&&l.push(1);let C=0;for(let F=0;F<l.length;F++)l[F]<0&&(Mi("Negative value is found in line dasharray, replacing values with 0"),l[F]=0),C+=l[F];if(C!==0){const F=this.width/C,V=this.getDashRanges(l,this.width,F);_?this.addRoundDash(V,F,S):this.addRegularDash(V,h==="square"?.5*F:0)}const L=this.nextRow+S;this.nextRow+=T;const k={tl:[L,S],br:[C,0]};return this.positions[m]=k,k}}li(IV,"LineAtlas");const Dat=Ae.types,Pat=Math.cos(Math.PI/180*37.5),Lat=Math.cos(Math.PI/180*5);class rP{constructor(l){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=l.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=l.overscaling,this.pixelRatio=l.pixelRatio,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=l.index,this.projection=l.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new P_,this.layoutVertexArray2=new qs,this.patternVertexArray=new qs,this.indexArray=new Ln,this.programConfigurations=new Vl(l.layers,{zoom:l.zoom,lut:l.lut}),this.segments=new Un,this.maxLineLength=0,this.zOffsetVertexArray=new qs,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.tessellationStep=l.tessellationStep?l.tessellationStep:Ve/64,this.worldview=l.worldview,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.hasPattern=DD("line",this.layers,this.pixelRatio,h);const S=this.layers[0].layout.get("line-sort-key");this.tileToMeter=kt(m);const T=this.layers[0].layout.get("line-elevation-reference");if(T==="hd-road-markup")this.elevationType="road";else{const U=this.layers[0].layout.get("line-z-offset"),$=U.isConstant()&&!U.constantOr(0);this.elevationType=T!=="sea"&&T!=="ground"&&$?"none":"offset",this.elevationType==="offset"&&T==="none"&&Mi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const C=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&C!==void 0;const L=[];for(const{feature:U,id:$,index:Z,sourceLayerIndex:Q}of l){const et=this.layers[0]._featureFilter.needGeometry,nt=ee(U,et);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),nt,m))continue;const dt=S?S.evaluate(nt,{},m):void 0,mt={id:$,properties:U.properties,type:U.type,sourceLayerIndex:Q,index:Z,geometry:et?nt.geometry:pe(U,m,_),patterns:{},sortKey:dt};L.push(mt)}S&&L.sort((U,$)=>U.sortKey-$.sortKey);const{lineAtlas:k,featureIndex:F}=h,V=this.addConstantDashes(k);for(const U of L){const{geometry:$,index:Z,sourceLayerIndex:Q}=U;if(V&&this.addFeatureDashes(U,k),this.hasPattern){const et=PD("line",this.layers,U,this.zoom,this.pixelRatio,h);this.patternFeatures.push(et)}else this.addFeature(U,$,Z,m,k.positions,h.availableImages,h.brightness,h.elevationFeatures);F.insert(l[Z].feature,$,Z,Q,this.index)}}addConstantDashes(l){let h=!1;for(const m of this.layers){const _=m.paint.get("line-dasharray").value,S=m.layout.get("line-cap").value;if(_.kind!=="constant"||S.kind!=="constant")h=!0;else{const T=S.value,C=_.value;if(!C)continue;l.addDash(C,T)}}return h}addFeatureDashes(l,h){const m=this.zoom;for(const _ of this.layers){const S=_.paint.get("line-dasharray").value,T=_.layout.get("line-cap").value;if(S.kind==="constant"&&T.kind==="constant")continue;let C,L;if(S.kind==="constant"){if(C=S.value,!C)continue}else C=S.evaluate({zoom:m},l);L=T.kind==="constant"?T.value:T.evaluate({zoom:m},l),h.addDash(C,L),l.patterns[_.id]=[h.getKey(C,L)]}}update(l,h,m,_,S,T,C,L){this.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C,L)}addFeatures(l,h,m,_,S,T){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,h,m,_,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,Cat)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=l.createVertexBuffer(this.patternVertexArray,Eat)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=l.createVertexBuffer(this.zOffsetVertexArray,Tat.members,!0)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Aat),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l,h){let m,_;if(h&&h>0?(m=`mapbox_clip_start_${h}`,_=`mapbox_clip_end_${h}`):(m="mapbox_clip_start",_="mapbox_clip_end"),l.properties&&l.properties.hasOwnProperty(m)&&l.properties.hasOwnProperty(_))return{start:+l.properties[m],end:+l.properties[_]}}addFeature(l,h,m,_,S,T,C,L){const k=this.layers[0].layout,F=k.get("line-join").evaluate(l,{}),V=k.get("line-cap").evaluate(l,{}),U=k.get("line-miter-limit"),$=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(l),this.lineFeature=l;const Z=!(!l.properties||!l.properties.hasOwnProperty("mapbox_line_metrics"))&&l.properties.mapbox_line_metrics;this.zOffsetValue=k.get("line-z-offset").value;const Q=this.layers[0].paint.get("line-width").value;if(Q.kind!=="constant"&&Q.isLineProgressConstant===!1&&(this.variableWidthValue=Q),this.elevationType==="road"){const et=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(l,h,_,L,F,V,U,$)){const[nt,dt]=this.clipRuntimeLinesToTile(h,1);for(let mt=0;mt<nt.length;mt++){const yt=nt[mt],Lt=dt[mt],It={progress:{min:Lt.progress.min,max:Lt.progress.max},nextDir:this.computeSegNextDir(Lt,yt),prevDir:this.computeSegPrevDir(Lt,yt)};this.addLine(yt,l,_,F,V,U,$,It,Z&&Lt.parentIndex>0?Lt.parentIndex:null)}this.fillNonElevatedRoadSegment(et)}}else for(let et=0;et<h.length;et++)this.addLine(h[et],l,_,F,V,U,$,void 0,Z&&et>0?et:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,S,T,_,C,void 0,this.worldview)}computeSegNextDir(l,h){return l.nextPoint.sub(h.at(-2)).unit()}computeSegPrevDir(l,h){return h[1].sub(l.prevPoint).unit()}clipLinesToTile(l,h){return l2(l,-h,-h,Ve+h,Ve+h)}clipRuntimeLinesToTile(l,h){const m=[];return[l2(l,-h,-h,Ve+h,Ve+h,m),m]}addElevatedRoadFeature(l,h,m,_,S,T,C,L){const k=[],F=Hi.getElevationFeature(l,_);if(F){const V=this.clipLinesToTile(h,1),U=this.prepareElevatedLines(V,F,m);for(const $ of U)k.push({geometry:$,elevation:F,elevationTileID:m,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(k.length===0)return!1;for(const V of k){const U=this.layoutVertexArray.length;this.addLine(V.geometry,l,m,S,T,C,L);const $=new Dr(m,V.elevationTileID);if(V.elevation)for(let Z=U;Z<this.layoutVertexArray.length;Z++){const Q=new Me(this.layoutVertexArray.int16[6*Z]>>1,this.layoutVertexArray.int16[6*Z+1]>>1),et=$.pointElevation(Q,V.elevation,.05);this.updateHeightRange(et),this.zOffsetVertexArray.emplaceBack(et,0,0)}else this.fillNonElevatedRoadSegment(U)}return!0}prepareElevatedLines(l,h,m){if(h.constantHeight!=null)return l;const _=[],S=1/kt(m);for(const T of l)jnt(T,new wn(h,S),0,_);return _}fillNonElevatedRoadSegment(l){for(let h=l;h<this.layoutVertexArray.length;h++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(l){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,l),this.heightRange.max=Math.max(this.heightRange.max,l)):this.heightRange={min:l,max:l}}addLine(l,h,m,_,S,T,C,L,k){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=k?this.lineFeatureClips(h,k):this.lineClips;const F=_==="none";this.patternJoinNone=this.hasPattern&&F,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const V=L&&L.progress.min>0,U=L&&L.progress.max<1;if(this.lineClips){let Ht={min:this.lineClips.start,max:this.lineClips.end},se=1;if(L){const me=this.lineClips.end-this.lineClips.start;Ht=function(Te,Be,De){return{min:sn(Te.min,Be,De),max:sn(Te.max,Be,De)}}(L.progress,{min:0,max:1},Ht),me>0&&(se=(Ht.max-Ht.min)/me)}const Kt=+h.properties.mapbox_clip_feature_len,ue=+h.properties.mapbox_clip_seg_len;if(Number.isNaN(Kt)||Number.isNaN(ue)){for(let Te=0;Te<l.length-1;Te++)this.totalDistance+=l[Te].dist(l[Te+1]);const me=this.totalDistance/(Ht.max-Ht.min);this.totalFeatureLength=Number.isFinite(me)?me:0,this.lineClips.start=Ht.min,this.lineClips.end=Ht.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Kt,this.distance=ue*se,this.lineClips.start=Ht.min,this.lineClips.end=Ht.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const $=Dat[h.type]==="Polygon";let Z=l.length;for(;Z>=2&&l[Z-1].equals(l[Z-2]);)Z--;let Q=0;for(;Q<Z-1&&l[Q].equals(l[Q+1]);)Q++;if(Z<($?3:2))return;_==="bevel"&&(T=1.05);const et=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let nt,dt,mt,yt,Lt,It,Ot,Ut;L&&L.prevDir&&(It=L.prevDir.perp()),L&&L.nextDir&&(Ot=L.nextDir.perp()),this.e1=this.e2=-1,$&&(nt=l[Z-2],Lt=l[Q].sub(nt)._unit()._perp());for(let Ht=Q;Ht<Z;Ht++){if(mt=Ht===Z-1?$?l[Q+1]:void 0:l[Ht+1],mt&&l[Ht].equals(mt))continue;Lt&&(yt=Lt),nt&&(dt=nt),nt=l[Ht],Ut=this.evaluateLineProgressFeatures(dt?dt.dist(nt):0),Lt=mt?mt.sub(nt)._unit()._perp():yt,yt=yt||Lt;const se=dt&&mt;let Kt=se?_:$||F?"butt":S;const ue=yt.x*Lt.x+yt.y*Lt.y;if(F){const re=function(Ie){if(Ie.patternJoinNone){const Re=Ie.segmentPoints.length/2,we=Ie.lineSoFar-Ie.segmentStart;for(let si=0;si<Re;++si){const ci=Ie.segmentPoints[2*si+1],ri=Math.round(Ie.segmentPoints[2*si])+.5+.25*ci;Ie.patternVertexArray.emplaceBack(ri,we,Ie.segmentStart),Ie.patternVertexArray.emplaceBack(ri,we,Ie.segmentStart)}Ie.segmentPoints.length=0}Ie.e1=Ie.e2=-1};if(se&&ue<Lat){this.updateDistance(dt,nt),this.addCurrentVertex(nt,yt,1,1,et,Ut),re(this),this.addCurrentVertex(nt,Lt,-1,-1,et,Ut);continue}if(dt){if(!mt){this.updateDistance(dt,nt),this.addCurrentVertex(nt,yt,1,1,et,Ut),re(this);continue}Kt="miter"}}let me=yt.add(Lt);me.x===0&&me.y===0||me._unit();const Te=me.x*Lt.x+me.y*Lt.y,Be=Te!==0?1/Te:1/0,De=2*Math.sqrt(2-2*Te),_e=Te<Pat&&dt&&mt,Ee=yt.x*Lt.y-yt.y*Lt.x>0,ae=this.overscaling<=16?15*Ve/(512*this.overscaling):0;if(se&&Kt==="round"){if(Be<C)Kt="miter";else if(Be<=2){const re=nP(nt,-10,Ve+10);Kt=this.elevationType==="offset"&&(re||this.hasCrossSlope)?"miter":"fakeround"}}if(Kt==="miter"&&Be>T&&(Kt="bevel"),Kt==="bevel"&&(Be>2&&(Kt="flipbevel"),Be<T&&(Kt="miter")),dt&&!(Kt==="miter"&&_e)&&this.updateDistance(dt,nt),Kt==="miter")if(_e){const re=nt.dist(dt);if(re>2*ae){const Re=nt.sub(nt.sub(dt)._mult(ae/re)._round());this.updateDistance(dt,Re),this.addCurrentVertex(Re,yt,0,0,et,Ut),dt=Re}this.updateDistance(dt,nt),me._mult(Be),this.addCurrentVertex(nt,me,0,0,et,Ut);const Ie=nt.dist(mt);if(Ie>2*ae){const Re=nt.add(mt.sub(nt)._mult(ae/Ie)._round());this.updateDistance(nt,Re),this.addCurrentVertex(Re,Lt,0,0,et,Ut),nt=Re}}else me._mult(Be),this.addCurrentVertex(nt,me,0,0,et,Ut);else if(Kt==="flipbevel"){if(Be>100)me=Lt.mult(-1);else{const re=Be*yt.add(Lt).mag()/yt.sub(Lt).mag();me._perp()._mult(re*(Ee?-1:1))}this.addCurrentVertex(nt,me,0,0,et,Ut),this.addCurrentVertex(nt,me.mult(-1),0,0,et,Ut)}else if(Kt==="bevel"||Kt==="fakeround"){Ut!=null&&dt&&this.addCurrentVertex(nt,Ot||yt,-1,-1,et,Ut);const re=nt.dist(dt)<=2*ae&&Kt!=="bevel",Ie=me.mult(Ee?1:-1);Ie._mult(Be);const Re=Lt.mult(Ee?-1:1),we=yt.mult(Ee?-1:1),si=this.evaluateLineProgressFeatures(this.distance);if(Ut==null&&(this.addHalfVertex(nt,Ie.x,Ie.y,!1,!Ee,0,et,si),re||this.addHalfVertex(nt,Ie.x+2*we.x,Ie.y+2*we.y,!1,Ee,0,et,si)),Kt==="fakeround"){const ci=Math.round(180*De/Math.PI/20);this.addHalfVertex(nt,we.x,we.y,!1,Ee,0,et,si);for(let ri=0;ri<ci;ri++){let Xe=ri/ci;if(Xe!==.5){const Qe=Xe-.5;Xe+=Xe*Qe*(Xe-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*Qe*Qe+(.848013+ue*(.215638*ue-1.06021)))}const ji=Re.sub(we)._mult(Xe)._add(we)._unit();this.addHalfVertex(nt,ji.x,ji.y,!1,Ee,0,et,si)}this.addHalfVertex(nt,Re.x,Re.y,!1,Ee,0,et,si)}re||Ut!=null||this.addHalfVertex(nt,Ie.x+2*Re.x,Ie.y+2*Re.y,!1,Ee,0,et,si),Ut!=null&&mt&&this.addCurrentVertex(nt,It||Lt,1,1,et,Ut)}else if(Kt==="butt")this.addCurrentVertex(nt,me,0,0,et,Ut);else if(Kt==="square"){if(!dt){const re=V?0:-1;this.addCurrentVertex(nt,me,re,re,et,Ut)}if(this.addCurrentVertex(nt,me,0,0,et,Ut),dt){const re=U?0:1;this.addCurrentVertex(nt,me,re,re,et,Ut)}}else if(Kt==="round"){if(dt){const re=!se&&Ot?Ot:yt;this.addCurrentVertex(nt,re,0,0,et,Ut),!se&&U||this.addCurrentVertex(nt,re,1,1,et,Ut,!0)}if(mt){const re=!se&&It?It:Lt;!se&&V||this.addCurrentVertex(nt,re,-1,-1,et,Ut,!0),this.addCurrentVertex(nt,re,0,0,et,Ut)}}}}addVerticesTo(l,h,m,_,S,T,C,L,k,F){const V=(h.w-l.w)/this.tessellationStep|0;let U=0;const $=this.scaledDistance;if(V>1){this.lineSoFar=l.w;const Q=(h.x-l.x)/V,et=(h.y-l.y)/V,nt=(h.z-l.z)/V,dt=(h.w-l.w)/V;for(let mt=1;mt<V;++mt){l.x+=Q,l.y+=et,l.z+=nt,this.lineSoFar+=dt,U+=dt;const yt=this.evaluateLineProgressFeatures(this.prevDistance+U);this.scaledDistance=(this.prevDistance+U)/this.totalDistance,this.addHalfVertex(l,m,_,F,!1,C,k,yt),this.addHalfVertex(l,S,T,F,!0,-L,k,yt)}}this.lineSoFar=h.w,this.scaledDistance=$;const Z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(h,m,_,F,!1,C,k,Z),this.addHalfVertex(h,S,T,F,!0,-L,k,Z)}evaluateLineProgressFeatures(l){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+l)/this.totalFeatureLength):Mi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let h=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(h=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:h}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:h}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:h}}addCurrentVertex(l,h,m,_,S,T,C=!1){const L=h.x+h.y*m,k=h.y-h.x*m,F=h.y*_-h.x,V=-h.y-h.x*_;if(T!=null){const U=this.elevationType==="offset",$=-10,Z=Ve+10,Q=T.zOffset,et=new Z5(l.x,l.y,Q,this.lineSoFar),nt=!!U&&nP(l,$,Z),dt=this.lineSoFar,mt=this.distance;if(this.currentVertex)if(nt){const yt=this.currentVertexIsOutside,Lt=this.currentVertex,It=new Z5(l.x,l.y,Q,this.lineSoFar);if(X5(Lt,It,$,Z),!nP(It,$,Z)){if(yt){this.e1=this.e2=-1,this.distance-=Lt.dist(et),this.lineSoFar=Lt.w;const Ot=this.evaluateLineProgressFeatures(Lt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Lt,L,k,C,!1,m,S,Ot),this.addHalfVertex(Lt,F,V,C,!0,-_,S,Ot),this.prevDistance=this.distance}this.distance=this.prevDistance+Lt.dist(It),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Lt,It,L,k,F,V,m,_,S,C),this.distance=mt,this.scaledDistance=this.distance/this.totalDistance}}else{const yt=this.currentVertex;if(this.currentVertexIsOutside){X5(yt,et,$,Z),this.e1=this.e2=-1,this.distance-=yt.dist(et),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=yt.w;const Lt=this.evaluateLineProgressFeatures(yt.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(yt,L,k,C,!1,m,S,Lt),this.addHalfVertex(yt,F,V,C,!0,-_,S,Lt),this.prevDistance=this.distance,this.distance=mt,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(yt,et,L,k,F,V,m,_,S,C)}else nt||(this.addHalfVertex(l,L,k,C,!1,m,S,T),this.addHalfVertex(l,F,V,C,!0,-_,S,T));this.currentVertex=et,this.currentVertexIsOutside=nt,this.lineSoFar=dt}else this.addHalfVertex(l,L,k,C,!1,m,S,T),this.addHalfVertex(l,F,V,C,!0,-_,S,T)}addHalfVertex({x:l,y:h},m,_,S,T,C,L,k){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),T||this.segmentPoints.push(this.lineSoFar-this.segmentStart,C)),this.layoutVertexArray.emplaceBack((l<<1)+(S?1:0),(h<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*_)+128,1+(C===0?0:C<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const V=zi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,V)}const F=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),L.primitiveLength++),T?this.e2=F:this.e1=F,k!=null&&this.zOffsetVertexArray.emplaceBack(k.zOffset,k.variableWidth,k.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(l,h){this.prevDistance=this.distance,this.distance+=l.dist(h),this.updateScaledDistance()}}function nP(d,l,h){return d.x<l||d.x>h||d.y<l||d.y>h}let CV,MV;function EV(d,l,h){return l*(Ve/(d.tileSize*Math.pow(2,h-d.tileID.overscaledZ)))}li(rP,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const DV=(d,l,h)=>(1-h)*d+h*l;function PV(d,l){return 1/EV(d,1,l.tileZoom)}function LV(d,l,h,m){return d.translatePosMatrix(m||l.tileID.projMatrix,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const RV=d=>{const l=[];kV(d)&&l.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&l.push("RENDER_LINE_GRADIENT");const h=d.paint.get("line-trim-offset");h[0]===0&&h[1]===0||l.push("RENDER_LINE_TRIM_OFFSET"),d.paint.get("line-border-width").constantOr(1)!==0&&l.push("RENDER_LINE_BORDER");const m=d.layout.get("line-join").constantOr("miter")==="none",_=!!d.paint.get("line-pattern").constantOr(1);return m&&_&&l.push("LINE_JOIN_NONE"),l};function kV(d){const l=d.paint.get("line-dasharray").value;return l.kind!=="constant"||l.value}let aP;const OV=()=>aP||(aP={layout:CV||(CV=new Kn({"line-cap":new ei(Yt.layout_line["line-cap"]),"line-join":new ei(Yt.layout_line["line-join"]),"line-miter-limit":new Pe(Yt.layout_line["line-miter-limit"]),"line-round-limit":new Pe(Yt.layout_line["line-round-limit"]),"line-sort-key":new ei(Yt.layout_line["line-sort-key"]),"line-z-offset":new ei(Yt.layout_line["line-z-offset"]),"line-elevation-reference":new Pe(Yt.layout_line["line-elevation-reference"]),"line-cross-slope":new Pe(Yt.layout_line["line-cross-slope"]),visibility:new Pe(Yt.layout_line.visibility),"line-width-unit":new Pe(Yt.layout_line["line-width-unit"])})),paint:MV||(MV=new Kn({"line-opacity":new ei(Yt.paint_line["line-opacity"]),"line-color":new ei(Yt.paint_line["line-color"]),"line-translate":new Pe(Yt.paint_line["line-translate"]),"line-translate-anchor":new Pe(Yt.paint_line["line-translate-anchor"]),"line-width":new ei(Yt.paint_line["line-width"]),"line-gap-width":new ei(Yt.paint_line["line-gap-width"]),"line-offset":new ei(Yt.paint_line["line-offset"]),"line-blur":new ei(Yt.paint_line["line-blur"]),"line-dasharray":new ei(Yt.paint_line["line-dasharray"]),"line-pattern":new ei(Yt.paint_line["line-pattern"]),"line-pattern-cross-fade":new Pe(Yt.paint_line["line-pattern-cross-fade"]),"line-gradient":new vf(Yt.paint_line["line-gradient"]),"line-trim-offset":new Pe(Yt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pe(Yt.paint_line["line-trim-fade-range"]),"line-trim-color":new Pe(Yt.paint_line["line-trim-color"]),"line-emissive-strength":new Pe(Yt.paint_line["line-emissive-strength"]),"line-border-width":new ei(Yt.paint_line["line-border-width"]),"line-border-color":new ei(Yt.paint_line["line-border-color"]),"line-occlusion-opacity":new Pe(Yt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},aP);class Rat extends ei{possiblyEvaluate(l,h){return h=new xn(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,transition:h.transition,worldview:h.worldview}),super.possiblyEvaluate(l,h)}evaluate(l,h,m,_){return h=Object.assign({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(l,h,m,_)}}let z1;function zV(d,l){return l>0?l+2*d:d}const kat=gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Oat=gr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zat=gr([{name:"a_projected_pos",components:4,type:"Float32"}],4);gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bat=gr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Fat=gr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Nat=gr([{name:"a_texb",components:2,type:"Uint16"}]),Vat=gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Uat=gr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const BV=gr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gat=gr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gr([{name:"triangle",components:3,type:"Uint16"}]),gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),gr([{type:"Float32",name:"offsetX"}]),gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var no=24;function Hat(d,l,h){return d.sections.forEach(m=>{m.text=function(_,S,T){const C=S.layout.get("text-transform").evaluate(T,{});return C==="uppercase"?_=_.toLocaleUpperCase():C==="lowercase"&&(_=_.toLocaleLowerCase()),As.applyArabicShaping&&(_=As.applyArabicShaping(_)),_}(m.text,l,h)}),d}const B1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function jat(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}function Wat(d){return d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""||d===""}const oP=4294967296,FV=1/oP,NV=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let y2=class{constructor(d=new Uint8Array(16)){this.buf=ArrayBuffer.isView(d)?d:new Uint8Array(d),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(d,l,h=this.length){for(;this.pos<h;){const m=this.readVarint(),_=m>>3,S=this.pos;this.type=7&m,d(_,l,this),this.pos===S&&this.skip(m)}return l}readMessage(d,l){return this.readFields(d,l,this.readVarint()+this.pos)}readFixed32(){const d=this.dataView.getUint32(this.pos,!0);return this.pos+=4,d}readSFixed32(){const d=this.dataView.getInt32(this.pos,!0);return this.pos+=4,d}readFixed64(){const d=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*oP;return this.pos+=8,d}readSFixed64(){const d=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*oP;return this.pos+=8,d}readFloat(){const d=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,d}readDouble(){const d=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,d}readVarint(d){const l=this.buf;let h,m;return m=l[this.pos++],h=127&m,m<128?h:(m=l[this.pos++],h|=(127&m)<<7,m<128?h:(m=l[this.pos++],h|=(127&m)<<14,m<128?h:(m=l[this.pos++],h|=(127&m)<<21,m<128?h:(m=l[this.pos],h|=(15&m)<<28,function(_,S,T){const C=T.buf;let L,k;if(k=C[T.pos++],L=(112&k)>>4,k<128||(k=C[T.pos++],L|=(127&k)<<3,k<128)||(k=C[T.pos++],L|=(127&k)<<10,k<128)||(k=C[T.pos++],L|=(127&k)<<17,k<128)||(k=C[T.pos++],L|=(127&k)<<24,k<128)||(k=C[T.pos++],L|=(1&k)<<31,k<128))return J_(_,L,S);throw new Error("Expected varint not more than 10 bytes")}(h,d,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const d=this.readVarint();return d%2==1?(d+1)/-2:d/2}readBoolean(){return!!this.readVarint()}readString(){const d=this.readVarint()+this.pos,l=this.pos;return this.pos=d,d-l>=12&&NV?NV.decode(this.buf.subarray(l,d)):function(h,m,_){let S="",T=m;for(;T<_;){const C=h[T];let L,k,F,V=null,U=C>239?4:C>223?3:C>191?2:1;if(T+U>_)break;U===1?C<128&&(V=C):U===2?(L=h[T+1],(192&L)==128&&(V=(31&C)<<6|63&L,V<=127&&(V=null))):U===3?(L=h[T+1],k=h[T+2],(192&L)==128&&(192&k)==128&&(V=(15&C)<<12|(63&L)<<6|63&k,(V<=2047||V>=55296&&V<=57343)&&(V=null))):U===4&&(L=h[T+1],k=h[T+2],F=h[T+3],(192&L)==128&&(192&k)==128&&(192&F)==128&&(V=(15&C)<<18|(63&L)<<12|(63&k)<<6|63&F,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,U=1):V>65535&&(V-=65536,S+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),S+=String.fromCharCode(V),T+=U}return S}(this.buf,l,d)}readBytes(){const d=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,d);return this.pos=d,l}readPackedVarint(d=[],l){const h=this.readPackedEnd();for(;this.pos<h;)d.push(this.readVarint(l));return d}readPackedSVarint(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readSVarint());return d}readPackedBoolean(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readBoolean());return d}readPackedFloat(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readFloat());return d}readPackedDouble(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readDouble());return d}readPackedFixed32(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readFixed32());return d}readPackedSFixed32(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readSFixed32());return d}readPackedFixed64(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readFixed64());return d}readPackedSFixed64(d=[]){const l=this.readPackedEnd();for(;this.pos<l;)d.push(this.readSFixed64());return d}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(d){const l=7&d;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(d,l){this.writeVarint(d<<3|l)}realloc(d){let l=this.length||16;for(;l<this.pos+d;)l*=2;if(l!==this.length){const h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(d){this.realloc(4),this.dataView.setInt32(this.pos,d,!0),this.pos+=4}writeSFixed32(d){this.realloc(4),this.dataView.setInt32(this.pos,d,!0),this.pos+=4}writeFixed64(d){this.realloc(8),this.dataView.setInt32(this.pos,-1&d,!0),this.dataView.setInt32(this.pos+4,Math.floor(d*FV),!0),this.pos+=8}writeSFixed64(d){this.realloc(8),this.dataView.setInt32(this.pos,-1&d,!0),this.dataView.setInt32(this.pos+4,Math.floor(d*FV),!0),this.pos+=8}writeVarint(d){(d=+d||0)>268435455||d<0?function(l,h){let m,_;if(l>=0?(m=l%4294967296|0,_=l/4294967296|0):(m=~(-l%4294967296),_=~(-l/4294967296),4294967295^m?m=m+1|0:(m=0,_=_+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,T,C){C.buf[C.pos++]=127&S|128,S>>>=7,C.buf[C.pos++]=127&S|128,S>>>=7,C.buf[C.pos++]=127&S|128,S>>>=7,C.buf[C.pos++]=127&S|128,C.buf[C.pos]=127&(S>>>=7)}(m,0,h),function(S,T){const C=(7&S)<<4;T.buf[T.pos++]|=C|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(_,h)}(d,this):(this.realloc(4),this.buf[this.pos++]=127&d|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=127&(d>>>=7)|(d>127?128:0),d<=127||(this.buf[this.pos++]=d>>>7&127))))}writeSVarint(d){this.writeVarint(d<0?2*-d-1:2*d)}writeBoolean(d){this.writeVarint(+d)}writeString(d){d=String(d),this.realloc(4*d.length),this.pos++;const l=this.pos;this.pos=function(m,_,S){for(let T,C,L=0;L<_.length;L++){if(T=_.charCodeAt(L),T>55295&&T<57344){if(!C){T>56319||L+1===_.length?(m[S++]=239,m[S++]=191,m[S++]=189):C=T;continue}if(T<56320){m[S++]=239,m[S++]=191,m[S++]=189,C=T;continue}T=C-55296<<10|T-56320|65536,C=null}else C&&(m[S++]=239,m[S++]=191,m[S++]=189,C=null);T<128?m[S++]=T:(T<2048?m[S++]=T>>6|192:(T<65536?m[S++]=T>>12|224:(m[S++]=T>>18|240,m[S++]=T>>12&63|128),m[S++]=T>>6&63|128),m[S++]=63&T|128)}return S}(this.buf,d,this.pos);const h=this.pos-l;h>=128&&VV(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeFloat(d){this.realloc(4),this.dataView.setFloat32(this.pos,d,!0),this.pos+=4}writeDouble(d){this.realloc(8),this.dataView.setFloat64(this.pos,d,!0),this.pos+=8}writeBytes(d){const l=d.length;this.writeVarint(l),this.realloc(l);for(let h=0;h<l;h++)this.buf[this.pos++]=d[h]}writeRawMessage(d,l){this.pos++;const h=this.pos;d(l,this);const m=this.pos-h;m>=128&&VV(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m}writeMessage(d,l,h){this.writeTag(d,2),this.writeRawMessage(l,h)}writePackedVarint(d,l){l.length&&this.writeMessage(d,$at,l)}writePackedSVarint(d,l){l.length&&this.writeMessage(d,Zat,l)}writePackedBoolean(d,l){l.length&&this.writeMessage(d,Yat,l)}writePackedFloat(d,l){l.length&&this.writeMessage(d,qat,l)}writePackedDouble(d,l){l.length&&this.writeMessage(d,Xat,l)}writePackedFixed32(d,l){l.length&&this.writeMessage(d,Kat,l)}writePackedSFixed32(d,l){l.length&&this.writeMessage(d,Jat,l)}writePackedFixed64(d,l){l.length&&this.writeMessage(d,Qat,l)}writePackedSFixed64(d,l){l.length&&this.writeMessage(d,tot,l)}writeBytesField(d,l){this.writeTag(d,2),this.writeBytes(l)}writeFixed32Field(d,l){this.writeTag(d,5),this.writeFixed32(l)}writeSFixed32Field(d,l){this.writeTag(d,5),this.writeSFixed32(l)}writeFixed64Field(d,l){this.writeTag(d,1),this.writeFixed64(l)}writeSFixed64Field(d,l){this.writeTag(d,1),this.writeSFixed64(l)}writeVarintField(d,l){this.writeTag(d,0),this.writeVarint(l)}writeSVarintField(d,l){this.writeTag(d,0),this.writeSVarint(l)}writeStringField(d,l){this.writeTag(d,2),this.writeString(l)}writeFloatField(d,l){this.writeTag(d,5),this.writeFloat(l)}writeDoubleField(d,l){this.writeTag(d,1),this.writeDouble(l)}writeBooleanField(d,l){this.writeVarintField(d,+l)}};function J_(d,l,h){return h?4294967296*l+(d>>>0):4294967296*(l>>>0)+(d>>>0)}function VV(d,l,h){const m=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));h.realloc(m);for(let _=h.pos-1;_>=d;_--)h.buf[_+m]=h.buf[_]}function $at(d,l){for(let h=0;h<d.length;h++)l.writeVarint(d[h])}function Zat(d,l){for(let h=0;h<d.length;h++)l.writeSVarint(d[h])}function qat(d,l){for(let h=0;h<d.length;h++)l.writeFloat(d[h])}function Xat(d,l){for(let h=0;h<d.length;h++)l.writeDouble(d[h])}function Yat(d,l){for(let h=0;h<d.length;h++)l.writeBoolean(d[h])}function Kat(d,l){for(let h=0;h<d.length;h++)l.writeFixed32(d[h])}function Jat(d,l){for(let h=0;h<d.length;h++)l.writeSFixed32(d[h])}function Qat(d,l){for(let h=0;h<d.length;h++)l.writeFixed64(d[h])}function tot(d,l){for(let h=0;h<d.length;h++)l.writeSFixed64(d[h])}const sP=3;function eot(d,l,h){l.glyphs=[],d===1&&h.readMessage(iot,l)}function iot(d,l,h){if(d===3){const{id:m,bitmap:_,width:S,height:T,left:C,top:L,advance:k}=h.readMessage(rot,{});l.glyphs.push({id:m,bitmap:new Rf({width:S+2*sP,height:T+2*sP},_),metrics:{width:S,height:T,left:C,top:L,advance:k}})}else d===4?l.ascender=h.readSVarint():d===5&&(l.descender=h.readSVarint())}function rot(d,l,h){d===1?l.id=h.readVarint():d===2?l.bitmap=h.readBytes():d===3?l.width=h.readVarint():d===4?l.height=h.readVarint():d===5?l.left=h.readSVarint():d===6?l.top=h.readSVarint():d===7&&(l.advance=h.readVarint())}const UV=sP,el={horizontal:1,vertical:2,horizontalOnly:3};class F1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(l,h){const m=new F1;return m.scale=l||1,m.fontStack=h,m}static forImage(l){const h=new F1;return h.image=l,h}}class Q_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,h,m){const _=new Q_;for(let S=0;S<l.sections.length;S++){const T=l.sections[S];T.image?_.addImageSection(T,m):_.addTextSection(T,h)}return _}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSections(){return this.sections}getSectionIndex(l){return this.sectionIndex[l]}getCodePoint(l){return this.text.codePointAt(l)}verticalizePunctuation(l){this.text=function(h,m){let _="";for(let S=0;S<h.length;S++){const T=h.charCodeAt(S+1)||null,C=h.charCodeAt(S-1)||null;_+=!m&&(T&&Gx(T)&&!B1[h[S+1]]||C&&Gx(C)&&!B1[h[S-1]])||!B1[h[S]]?h[S]:B1[h[S]]}return _}(this.text,l)}trim(){let l=0;for(let m=0;m<this.text.length&&x2[this.text.charCodeAt(m)];m++)l++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=l&&x2[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(l,h),this.sectionIndex=this.sectionIndex.slice(l,h)}substring(l,h){const m=new Q_;return m.text=this.text.substring(l,h),m.sectionIndex=this.sectionIndex.slice(l,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,h)=>Math.max(l,this.sections[h].scale),0)}addTextSection(l,h){this.text+=l.text,this.sections.push(F1.forText(l.scale,l.fontStack||h));const m=this.sections.length-1;for(let _=0;_<l.text.length;++_)this.sectionIndex.push(m)}addImageSection(l,h){const m=l.image?l.image.getPrimary():null;if(!m)return void Mi("Can't add FormattedSection with an empty image.");m.scaleSelf(h);const _=this.getNextImageSectionCharCode();_?(this.text+=String.fromCodePoint(_),this.sections.push(F1.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function lP(d,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q=1){const et=Q_.fromFeature(d,_,Q);V===el.vertical&&et.verticalizePunctuation(U);let nt=[];const dt=function(Ot,Ut,Ht,se,Kt,ue){if(!Ot)return[];const me=[],Te=function(Ee,ae,re,Ie,Re,we){let si=0;for(let ci=0;ci<Ee.length();ci++){const ri=Ee.getSection(ci);si+=GV(Ee.getCodePoint(ci),ri,Ie,Re,ae,we)}return si/Math.max(1,Math.ceil(si/re))}(Ot,Ut,Ht,se,Kt,ue),Be=Ot.text.indexOf("")>=0;let De=0;for(let Ee=0;Ee<Ot.length();Ee++){const ae=Ot.getSection(Ee),re=Ot.getCodePoint(Ee);if(x2[re]||(De+=GV(re,ae,se,Kt,Ut,ue)),Ee<Ot.length()-1){const Ie=!((_e=re)<11904||!(Ei["Bopomofo Extended"](_e)||Ei.Bopomofo(_e)||Ei["CJK Compatibility Forms"](_e)||Ei["CJK Compatibility Ideographs"](_e)||Ei["CJK Compatibility"](_e)||Ei["CJK Radicals Supplement"](_e)||Ei["CJK Strokes"](_e)||Ei["CJK Symbols and Punctuation"](_e)||Ei["CJK Unified Ideographs Extension A"](_e)||Ei["CJK Unified Ideographs"](_e)||Ei["Enclosed CJK Letters and Months"](_e)||Ei["Halfwidth and Fullwidth Forms"](_e)||Ei.Hiragana(_e)||Ei["Ideographic Description Characters"](_e)||Ei["Kangxi Radicals"](_e)||Ei["Katakana Phonetic Extensions"](_e)||Ei.Katakana(_e)||Ei["Vertical Forms"](_e)||Ei["Yi Radicals"](_e)||Ei["Yi Syllables"](_e)));(not[re]||Ie||ae.image)&&me.push(jV(Ee+1,De,Te,me,aot(re,Ot.getCodePoint(Ee+1),Ie&&Be),!1))}}var _e;return WV(jV(Ot.length(),De,Te,me,0,!0))}(et,k,S,l,m,$),{processBidirectionalText:mt,processStyledBidirectionalText:yt}=As;if(mt&&et.sections.length===1){const Ot=mt(et.toString(),dt);for(const Ut of Ot){const Ht=new Q_;Ht.text=Ut,Ht.sections=et.sections;for(let se=0;se<Ut.length;se++)Ht.sectionIndex.push(0);nt.push(Ht)}}else if(yt){const Ot=yt(et.text,et.sectionIndex,dt);for(const Ut of Ot){const Ht=new Q_;Ht.text=Ut[0],Ht.sectionIndex=Ut[1],Ht.sections=et.sections,nt.push(Ht)}}else nt=function(Ot,Ut){const Ht=[],se=Ot.text;let Kt=0;for(const ue of Ut)Ht.push(Ot.substring(Kt,ue)),Kt=ue;return Kt<se.length&&Ht.push(Ot.substring(Kt,se.length)),Ht}(et,dt);const Lt=[],It={positionedLines:Lt,text:et.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ot,Ut,Ht,se,Kt,ue,me,Te,Be,De,_e,Ee){let ae=0,re=0,Ie=0;const Re=Te==="right"?1:Te==="left"?0:.5;let we=!1;for(const Qe of Kt){const Ci=Qe.getSections();for(const Zi of Ci){if(Zi.image)continue;const fr=Ut[Zi.fontStack];if(fr&&(we=fr.ascender!==void 0&&fr.descender!==void 0,!we))break}if(!we)break}let si=0;for(const Qe of Kt){Qe.trim();const Ci=Qe.getMaxScale(),Zi=(Ci-1)*no,fr={positionedGlyphs:[],lineOffset:0};Ot.positionedLines[si]=fr;const Pr=fr.positionedGlyphs;let qi=0;if(!Qe.length()){re+=ue,++si;continue}let Br=0,Fr=0;for(let Ct=0;Ct<Qe.length();Ct++){const St=Qe.getSection(Ct),he=Qe.getSectionIndex(Ct),je=Qe.getCodePoint(Ct);let de=St.scale,Je=null,vi=null,gi=null,Ji=no,Ri=0,di=Be;di===el.vertical&&((ci=je)===12312||ci===12313||ci===12316||ci===12540||ci===12448)&&(di=el.horizontal);const zr=!(di===el.horizontal||!_e&&!I_(je)||_e&&(x2[je]||Hx(je)));if(St.image){const ln=se.get(St.image.toString());if(!ln)continue;gi=St.image,Ot.iconsInText=Ot.iconsInText||!0,vi=ln.paddedRect;const Oi=ln.displaySize;de=de*no/Ee,Je={width:Oi[0],height:Oi[1],left:0,top:-UV,advance:zr?Oi[1]:Oi[0],localGlyph:!1},Ri=we?-Je.height*de:Ci*no-17-Oi[1]*de,Ji=Je.advance;const Mr=(zr?Oi[0]:Oi[1])*de-no*Ci;Mr>0&&Mr>qi&&(qi=Mr)}else{const ln=Ht[St.fontStack];if(!ln)continue;ln[je]&&(vi=ln[je]);const Oi=Ut[St.fontStack];if(!Oi)continue;const Mr=Oi.glyphs[je];if(!Mr)continue;if(Je=Mr.metrics,Ji=je!==8203?no:0,we){const un=Oi.ascender!==void 0?Math.abs(Oi.ascender):0,Yr=Oi.descender!==void 0?Math.abs(Oi.descender):0,qn=(un+Yr)*de;Br<qn&&(Br=qn,Fr=(un-Yr)/2*de),Ri=-un*de}else Ri=(Ci-de)*no-17}zr?(Ot.verticalizable=!0,Pr.push({glyph:je,image:gi,x:ae,y:re+Ri,vertical:zr,scale:de,localGlyph:Je.localGlyph,fontStack:St.fontStack,sectionIndex:he,metrics:Je,rect:vi}),ae+=Ji*de+De):(Pr.push({glyph:je,image:gi,x:ae,y:re+Ri,vertical:zr,scale:de,localGlyph:Je.localGlyph,fontStack:St.fontStack,sectionIndex:he,metrics:Je,rect:vi}),ae+=Je.advance*de+De)}Pr.length!==0&&(Ie=Math.max(ae-De,Ie),we?$V(Pr,Re,qi,Fr,ue*Ci/2):$V(Pr,Re,qi,0,ue/2)),ae=0;const Fn=ue*Ci+qi;fr.lineOffset=Math.max(qi,Zi),re+=Fn,++si}var ci;const ri=re,{horizontalAlign:Xe,verticalAlign:ji}=uP(me);(function(Qe,Ci,Zi,fr,Pr,qi){const Br=(Ci-Zi)*Pr,Fr=-qi*fr;for(const Fn of Qe)for(const Ct of Fn.positionedGlyphs)Ct.x+=Br,Ct.y+=Fr})(Ot.positionedLines,Re,Xe,ji,Ie,ri),Ot.top+=-ji*ri,Ot.bottom=Ot.top+ri,Ot.left+=-Xe*Ie,Ot.right=Ot.left+Ie,Ot.hasBaseline=we}(It,l,h,m,nt,T,C,L,V,k,U,Z),!function(Ot){for(const Ut of Ot)if(Ut.positionedGlyphs.length!==0)return!1;return!0}(Lt))return It}const x2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},not={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function GV(d,l,h,m,_,S){if(l.image){const T=m.get(l.image.toString());return T?T.displaySize[0]*l.scale*no/S+_:0}{const T=h[l.fontStack],C=T&&T.glyphs[d];return C?C.metrics.advance*l.scale+_:0}}function HV(d,l,h,m){const _=Math.pow(d-l,2);return m?d<l?_/2:2*_:_+Math.abs(h)*h}function aot(d,l,h){let m=0;return d===10&&(m-=1e4),h&&(m+=150),d!==40&&d!==65288||(m+=50),l!==41&&l!==65289||(m+=50),m}function jV(d,l,h,m,_,S){let T=null,C=HV(l,h,_,S);for(const L of m){const k=HV(l-L.x,h,_,S)+L.badness;k<=C&&(T=L,C=k)}return{index:d,x:l,priorBreak:T,badness:C}}function WV(d){return d?WV(d.priorBreak).concat(d.index):[]}function uP(d){let l=.5,h=.5;switch(d){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(d){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:l,verticalAlign:h}}function $V(d,l,h,m,_){if(!(l||h||m||_))return;const S=d.length-1,T=d[S],C=(T.x+T.metrics.advance*T.scale)*l;for(let L=0;L<=S;L++)d[L].x-=C,d[L].y+=h+m+_}function ZV(d){return d.imagePrimary!==void 0&&d.top!==void 0&&d.bottom!==void 0&&d.left!==void 0&&d.right!==void 0}function b2(d,l,h,m){const{horizontalAlign:_,verticalAlign:S}=uP(m),T=h[0]-d.displaySize[0]*_,C=h[1]-d.displaySize[1]*S;return{imagePrimary:d,imageSecondary:l,top:C,bottom:C+d.displaySize[1],left:T,right:T+d.displaySize[0]}}function cP(d,l,h,m,_,S){const T=d.imagePrimary;let C;if(T.content){const et=T.content,nt=T.pixelRatio||1;C=[et[0]/nt,et[1]/nt,T.displaySize[0]-et[2]/nt,T.displaySize[1]-et[3]/nt]}const L=l.left*S,k=l.right*S;let F,V,U,$;h==="width"||h==="both"?($=_[0]+L-m[3],V=_[0]+k+m[1]):($=_[0]+(L+k-T.displaySize[0])/2,V=$+T.displaySize[0]);const Z=l.top*S,Q=l.bottom*S;return h==="height"||h==="both"?(F=_[1]+Z-m[0],U=_[1]+Q+m[2]):(F=_[1]+(Z+Q-T.displaySize[1])/2,U=F+T.displaySize[1]),{imagePrimary:T,imageSecondary:void 0,top:F,right:V,bottom:U,left:$,collisionPadding:C}}function qV(d){return!d.imagePrimary.stretchX}function XV(d){return!d.imagePrimary.stretchY}function YV(d){return{width:d.right-d.left,height:d.bottom-d.top}}const Qu=128;function ty(d,l,h){const{expression:m}=l;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new xn(d+1,{worldview:h}))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:_,interpolationType:S}=m;let T=0;for(;T<_.length&&_[T]<=d;)T++;T=Math.max(0,T-1);let C=T;for(;C<_.length&&_[C]<d+1;)C++;C=Math.min(_.length-1,C);const L=_[T],k=_[C];return m.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:k,interpolationType:S}:{kind:"camera",minZoom:L,maxZoom:k,minSize:m.evaluate(new xn(L,{worldview:h})),maxSize:m.evaluate(new xn(k,{worldview:h})),interpolationType:S}}}function hP(d,{uSize:l,uSizeT:h},{lowerSize:m,upperSize:_}){return d.kind==="source"?m/Qu:d.kind==="composite"?zi(m/Qu,_/Qu,h):l}function ey(d,l,h=1){let m=0,_=0;if(d.kind==="constant")_=d.layoutSize*h;else if(d.kind!=="source"){const{interpolationType:S,minZoom:T,maxZoom:C}=d,L=S?lt($s.interpolationFactor(S,l,T,C),0,1):0;d.kind==="camera"?_=zi(d.minSize,d.maxSize,L)*h:m=L*h}return{uSizeT:m,uSize:_}}class Yh extends Me{constructor(l,h,m,_,S){super(l,h),this.angle=_,this.z=m,S!==void 0&&(this.segment=S)}clone(){return new Yh(this.x,this.y,this.z,this.angle,this.segment)}}function KV(d,l,h,m,_){if(l.segment===void 0)return!0;let S=l,T=l.segment+1,C=0;for(;C>-h/2;){if(T--,T<0)return!1;C-=d[T].dist(S),S=d[T]}C+=d[T].dist(d[T+1]),T++;const L=[];let k=0;for(;C<h/2;){const F=d[T],V=d[T+1];if(!V)return!1;let U=d[T-1].angleTo(F)-F.angleTo(V);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:C,angleDelta:U}),k+=U;C-L[0].distance>m;)k-=L.shift().angleDelta;if(k>_)return!1;T++,C+=F.dist(V)}return!0}function JV(d){let l=0;for(let h=0;h<d.length-1;h++)l+=d[h].dist(d[h+1]);return l}function QV(d,l,h){return d?.6*l*h:0}function t4(d,l){return Math.max(d?d.right-d.left:0,l?l.right-l.left:0)}function oot(d,l,h,m,_,S){const T=QV(h,_,S),C=t4(h,m)*S;let L=0;const k=JV(d)/2;for(let F=0;F<d.length-1;F++){const V=d[F],U=d[F+1],$=V.dist(U);if(L+$>k){const Z=(k-L)/$,Q=zi(V.x,U.x,Z),et=zi(V.y,U.y,Z),nt=new Yh(Q,et,0,U.angleTo(V),F);return!T||KV(d,nt,C,T,l)?nt:void 0}L+=$}}function sot(d,l,h,m,_,S,T,C,L){const k=QV(m,S,T),F=t4(m,_),V=F*T,U=d[0].x===0||d[0].x===L||d[0].y===0||d[0].y===L;return l-V<l/4&&(l=V+l/4),e4(d,U?l/2*C%l:(F/2+2*S)*T*C%l,l,k,h,V,U,!1,L)}function e4(d,l,h,m,_,S,T,C,L){const k=S/2,F=JV(d);let V=0,U=l-h,$=[];for(let Z=0;Z<d.length-1;Z++){const Q=d[Z],et=d[Z+1],nt=Q.dist(et),dt=et.angleTo(Q);for(;U+h<V+nt;){U+=h;const mt=(U-V)/nt,yt=zi(Q.x,et.x,mt),Lt=zi(Q.y,et.y,mt);if(yt>=0&&yt<L&&Lt>=0&&Lt<L&&U-k>=0&&U+k<=F){const It=new Yh(yt,Lt,0,dt,Z);m&&!KV(d,It,S,m,_)||$.push(It)}}V+=nt}return C||$.length||T||($=e4(d,V/2,h,m,_,S,T,!0,L)),$}function i4(d){let l=0,h=0;for(const T of d)l+=T.w*T.h,h=Math.max(h,T.w);d.sort((T,C)=>C.h-T.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),h),h:1/0}];let _=0,S=0;for(const T of d)for(let C=m.length-1;C>=0;C--){const L=m[C];if(!(T.w>L.w||T.h>L.h)){if(T.x=L.x,T.y=L.y,S=Math.max(S,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===L.w&&T.h===L.h){const k=m.pop();k&&C<m.length&&(m[C]=k)}else T.h===L.h?(L.x+=T.w,L.w-=T.w):T.w===L.w?(L.y+=T.h,L.h-=T.h):(m.push({x:L.x+T.w,y:L.y,w:L.w-T.w,h:T.h}),L.y+=T.h,L.h-=T.h);break}}return{w:_,h:S,fill:l/(_*S)||0}}li(Yh,"Anchor");const $g=1;class N1{static getImagePositionScale(l,h,m){if(h&&l&&l.options&&l.options.transform){const _=l.options.transform;return{x:_.a,y:_.d}}return{x:m,y:m}}constructor(l,h,m,_){this.paddedRect=l;const{pixelRatio:S,version:T,stretchX:C,stretchY:L,content:k,sdf:F,usvg:V}=h;this.pixelRatio=S,this.stretchX=C,this.stretchY=L,this.content=k,this.version=T,this.padding=m,this.sdf=F,this.usvg=V,this.scale=N1.getImagePositionScale(_,V,S)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function dP(d,l,h){const m=Gu.parse(d),_=function(S,T,C=[1,1]){return{x:0,y:0,w:(S.data?S.data.width:S.width*C[0])+2*T,h:(S.data?S.data.height:S.height*C[1])+2*T}}(l,h,[m.options.transform.a,m.options.transform.d]);return{bin:_,imagePosition:new N1(_,l,h,m),imageVariant:m}}class r4{constructor(l,h,m){const _=new Map,S=new Map;this.haveRenderCallbacks=[];const T=[];this.addImages(l,_,$g,T),this.addImages(h,S,2,T);const{w:C,h:L}=i4(T),k=new Do({width:C||1,height:L||1});for(const[F,V]of l.entries()){const U=_.get(F).paddedRect;Do.copy(V.data,k,{x:0,y:0},{x:U.x+$g,y:U.y+$g},V.data,null,V.sdf)}for(const[F,V]of h.entries()){const U=S.get(F),$=U.paddedRect;let Z=U.padding;const Q=$.x+Z,et=$.y+Z,nt=V.data.width,dt=V.data.height;Z=Z>1?Z-1:Z,Do.copy(V.data,k,{x:0,y:0},{x:Q,y:et},V.data,m),Do.copy(V.data,k,{x:0,y:dt-Z},{x:Q,y:et-Z},{width:nt,height:Z},m),Do.copy(V.data,k,{x:0,y:0},{x:Q,y:et+dt},{width:nt,height:Z},m),Do.copy(V.data,k,{x:nt-Z,y:0},{x:Q-Z,y:et},{width:Z,height:dt},m),Do.copy(V.data,k,{x:0,y:0},{x:Q+nt,y:et},{width:Z,height:dt},m),Do.copy(V.data,k,{x:nt-Z,y:dt-Z},{x:Q-Z,y:et-Z},{width:Z,height:Z},m),Do.copy(V.data,k,{x:0,y:dt-Z},{x:Q+nt,y:et-Z},{width:Z,height:Z},m),Do.copy(V.data,k,{x:0,y:0},{x:Q+nt,y:et+dt},{width:Z,height:Z},m),Do.copy(V.data,k,{x:nt-Z,y:0},{x:Q-Z,y:et+dt},{width:Z,height:Z},m)}this.lut=m,this.image=k,this.iconPositions=_,this.patternPositions=S}addImages(l,h,m,_){for(const[S,T]of l.entries()){const{bin:C,imagePosition:L,imageVariant:k}=dP(S,T,m);h.set(S,L),_.push(C),T.hasRenderCallback&&this.haveRenderCallbacks.push(k.id)}}patchUpdatedImages(l,h,m){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(_=>l.hasImage(_,m)),l.dispatchRenderCallbacks(this.haveRenderCallbacks,m);for(const _ of l.getUpdatedImages(m)){for(const S of this.iconPositions.keys()){const T=Gu.parse(S);if(Ba.isEqual(T.id,_)){const C=l.getImage(_,m);this.patchUpdatedImage(this.iconPositions.get(S),C,h,null)}}for(const S of this.patternPositions.keys()){const T=Gu.parse(S);if(Ba.isEqual(T.id,_)){const C=l.getImage(_,m);this.patchUpdatedImage(this.patternPositions.get(S),C,h,this.lut)}}}}patchUpdatedImage(l,h,m,_=null){if(!l||!h||l.version===h.version)return;l.version=h.version;const[S,T]=l.tl,C=l.sdf;if(this.lut||C){const L={width:h.data.width,height:h.data.height},k=new Do(L);Do.copy(h.data,k,{x:0,y:0},{x:0,y:0},L,_,C),m.update(k,{position:{x:S,y:T}})}else m.update(h.data,{position:{x:S,y:T}})}}li(N1,"ImagePosition"),li(r4,"ImageAtlas");const V1=1e20;function n4(d,l,h,m,_,S,T,C,L){for(let k=l;k<l+m;k++)a4(d,h*S+k,S,_,T,C,L);for(let k=h;k<h+_;k++)a4(d,k*S+l,1,m,T,C,L)}function a4(d,l,h,m,_,S,T){S[0]=0,T[0]=-V1,T[1]=V1,_[0]=d[l];for(let C=1,L=0,k=0;C<m;C++){_[C]=d[l+C*h];const F=C*C;do{const V=S[L];k=(_[C]-_[V]+F-V*V)/(C-V)/2}while(k<=T[L]&&--L>-1);L++,S[L]=C,T[L]=k,T[L+1]=V1}for(let C=0,L=0;C<m;C++){for(;T[L+1]<C;)L++;const k=S[L],F=C-k;d[l+C*h]=_[k]+F*F}}const tc=2,fP={none:0,ideographs:1,all:2};class iy{constructor(l,h,m){this.requestManager=l,this.localGlyphMode=h,this.localFontFamily=m,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(l){this.url=l}getGlyphs(l,h){const m=[],_=this.url||An.GLYPHS_URL;for(const S in l)for(const T of l[S])m.push({stack:S,id:T});Ft(m,({stack:S,id:T},C)=>{let L=this.entries[S];L||(L=this.entries[S]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=L.glyphs[T];if(k!==void 0)return void C(null,{stack:S,id:T,glyph:k});if(k=this._tinySDF(L,S,T),k)return L.glyphs[T]=k,void C(null,{stack:S,id:T,glyph:k});const F=Math.floor(T/256);if(256*F>65535)return Mi("glyphs > 65535 not supported"),void C(null,{stack:S,id:T,glyph:k});if(L.ranges[F])return void C(null,{stack:S,id:T,glyph:k});let V=L.requests[F];V||(V=L.requests[F]=[],iy.loadGlyphRange(S,F,_,this.requestManager,(U,$)=>{if($){L.ascender=$.ascender,L.descender=$.descender;for(const Z in $.glyphs)this._doesCharSupportLocalGlyph(+Z)||(L.glyphs[+Z]=$.glyphs[+Z]);L.ranges[F]=!0}for(const Z of V)Z(U,$);delete L.requests[F]})),V.push((U,$)=>{U?C(U):$&&C(null,{stack:S,id:T,glyph:$.glyphs[T]||null})})},(S,T)=>{if(S)h(S);else if(T){const C={};for(const{stack:L,id:k,glyph:F}of T)C[L]===void 0&&(C[L]={}),C[L].glyphs===void 0&&(C[L].glyphs={}),C[L].glyphs[k]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},C[L].ascender=this.entries[L].ascender,C[L].descender=this.entries[L].descender;h(null,C)}})}_doesCharSupportLocalGlyph(l){return this.localGlyphMode!==fP.none&&(this.localGlyphMode===fP.all?!!this.localFontFamily:!!this.localFontFamily&&(Ei["CJK Unified Ideographs"](l)||Ei["Hangul Syllables"](l)||Ei.Hiragana(l)||Ei.Katakana(l)||Ei["CJK Symbols and Punctuation"](l)||Ei["CJK Unified Ideographs Extension A"](l)||Ei["CJK Unified Ideographs Extension B"](l)||Ei.Osage(l)))}_tinySDF(l,h,m){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(m))return;let S=l.tinySDF;if(!S){let Q="400";/bold/i.test(h)?Q="900":/medium/i.test(h)?Q="500":/light/i.test(h)&&(Q="200"),S=l.tinySDF=new iy.TinySDF({fontFamily:_,fontWeight:Q,fontSize:24*tc,buffer:3*tc,radius:8*tc}),S.fontWeight=Q}if(this.localGlyphs[S.fontWeight][m])return this.localGlyphs[S.fontWeight][m];const T=String.fromCodePoint(m),{data:C,width:L,height:k,glyphWidth:F,glyphHeight:V,glyphLeft:U,glyphTop:$,glyphAdvance:Z}=S.draw(T);return this.localGlyphs[S.fontWeight][m]={id:m,bitmap:new Rf({width:L,height:k},C),metrics:{width:F/tc,height:V/tc,left:U/tc,top:$/tc-27,advance:Z/tc,localGlyph:!0}}}}iy.loadGlyphRange=function(d,l,h,m,_){const S=256*l,T=S+255,C=m.transformRequest(m.normalizeGlyphsURL(h).replace("{fontstack}",d).replace("{range}",`${S}-${T}`),Dh.Glyphs);qd(C,(L,k)=>{if(L)_(L);else if(k){const F={},V=function(U){return new y2(U).readFields(eot,{})}(k);for(const U of V.glyphs)F[U.id]=U;_(null,{glyphs:F,ascender:V.ascender,descender:V.descender})}})},iy.TinySDF=class{constructor({fontSize:d=24,buffer:l=3,radius:h=8,cutoff:m=.25,fontFamily:_="sans-serif",fontWeight:S="normal",fontStyle:T="normal",lang:C=null}={}){this.buffer=l,this.cutoff=m,this.radius=h,this.lang=C;const L=this.size=d+4*l,k=this._createCanvas(L),F=this.ctx=k.getContext("2d",{willReadFrequently:!0});F.font=`${T} ${S} ${d}px ${_}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(d){const l=document.createElement("canvas");return l.width=l.height=d,l}draw(d){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:_,actualBoundingBoxRight:S}=this.ctx.measureText(d),T=Math.ceil(h),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-_))),L=Math.min(this.size-this.buffer,T+Math.ceil(m)),k=C+2*this.buffer,F=L+2*this.buffer,V=Math.max(k*F,0),U=new Uint8ClampedArray(V),$={data:U,width:k,height:F,glyphWidth:C,glyphHeight:L,glyphTop:T,glyphLeft:0,glyphAdvance:l};if(C===0||L===0)return $;const{ctx:Z,buffer:Q,gridInner:et,gridOuter:nt}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(Q,Q,C,L),Z.fillText(d,Q,Q+T);const dt=Z.getImageData(Q,Q,C,L);nt.fill(V1,0,V),et.fill(0,0,V);for(let mt=0;mt<L;mt++)for(let yt=0;yt<C;yt++){const Lt=dt.data[4*(mt*C+yt)+3]/255;if(Lt===0)continue;const It=(mt+Q)*k+yt+Q;if(Lt===1)nt[It]=0,et[It]=V1;else{const Ot=.5-Lt;nt[It]=Ot>0?Ot*Ot:0,et[It]=Ot<0?Ot*Ot:0}}n4(nt,0,0,k,F,k,this.f,this.v,this.z),n4(et,Q,Q,C,L,k,this.f,this.v,this.z);for(let mt=0;mt<V;mt++){const yt=Math.sqrt(nt[mt])-Math.sqrt(et[mt]);U[mt]=Math.round(255-255*(yt/this.radius+this.cutoff))}return $}};const Vc=$g;function o4(d,l){return d+l[1]-l[0]}function pP(d,l,h,m,_=1){const S=[],T=d.imagePrimary,C=T.pixelRatio,L=T.paddedRect.w-2*Vc,k=T.paddedRect.h-2*Vc,F=(d.right-d.left)*_,V=(d.bottom-d.top)*_,U=T.stretchX||[[0,L]],$=T.stretchY||[[0,k]],Z=U.reduce(o4,0),Q=$.reduce(o4,0),et=L-Z,nt=k-Q;let dt=0,mt=Z,yt=0,Lt=Q,It=0,Ot=et,Ut=0,Ht=nt;if(T.content&&m){const Kt=T.content;dt=w2(U,0,Kt[0]),yt=w2($,0,Kt[1]),mt=w2(U,Kt[0],Kt[2]),Lt=w2($,Kt[1],Kt[3]),It=Kt[0]-dt,Ut=Kt[1]-yt,Ot=Kt[2]-Kt[0]-mt,Ht=Kt[3]-Kt[1]-Lt}const se=(Kt,ue,me,Te)=>{const Be=S2(Kt.stretch-dt,mt,F,d.left*_),De=T2(Kt.fixed-It,Ot,Kt.stretch,Z),_e=S2(ue.stretch-yt,Lt,V,d.top*_),Ee=T2(ue.fixed-Ut,Ht,ue.stretch,Q),ae=S2(me.stretch-dt,mt,F,d.left*_),re=T2(me.fixed-It,Ot,me.stretch,Z),Ie=S2(Te.stretch-yt,Lt,V,d.top*_),Re=T2(Te.fixed-Ut,Ht,Te.stretch,Q),we=new Me(Be,_e),si=new Me(ae,_e),ci=new Me(ae,Ie),ri=new Me(Be,Ie),Xe=new Me(De/C,Ee/C),ji=new Me(re/C,Re/C),Qe=l*Math.PI/180;if(Qe){const Br=Math.sin(Qe),Fr=Math.cos(Qe),Fn=[Fr,-Br,Br,Fr];we._matMult(Fn),si._matMult(Fn),ri._matMult(Fn),ci._matMult(Fn)}const Ci=Kt.stretch+Kt.fixed,Zi=me.stretch+me.fixed,fr=ue.stretch+ue.fixed,Pr=Te.stretch+Te.fixed,qi=d.imageSecondary;return{tl:we,tr:si,bl:ri,br:ci,texPrimary:{x:T.paddedRect.x+Vc+Ci,y:T.paddedRect.y+Vc+fr,w:Zi-Ci,h:Pr-fr},texSecondary:qi?{x:qi.paddedRect.x+Vc+Ci,y:qi.paddedRect.y+Vc+fr,w:Zi-Ci,h:Pr-fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xe,pixelOffsetBR:ji,minFontScaleX:Ot/C/F,minFontScaleY:Ht/C/V,isSDF:h}};if(m&&(T.stretchX||T.stretchY)){const Kt=s4(U,et,Z),ue=s4($,nt,Q);for(let me=0;me<Kt.length-1;me++){const Te=Kt[me],Be=Kt[me+1];for(let De=0;De<ue.length-1;De++)S.push(se(Te,ue[De],Be,ue[De+1]))}}else S.push(se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:k+1}));return S}function lot(d,l){const h=d.stretchY||[[0,d.paddedRect.h-2*Vc]];return l&&(d.stretchX||d.stretchY)?l4(d.stretchX||[[0,d.paddedRect.w-2*Vc]])*l4(h):1}function w2(d,l,h){let m=0;for(const _ of d)m+=Math.max(l,Math.min(h,_[1]))-Math.max(l,Math.min(h,_[0]));return m}function s4(d,l,h){const m=[{fixed:-Vc,stretch:0}];for(const[_,S]of d){const T=m[m.length-1];m.push({fixed:_-T.stretch,stretch:T.stretch}),m.push({fixed:_-T.stretch,stretch:T.stretch+(S-_)})}return m.push({fixed:l+Vc,stretch:h}),m}function l4(d){return 2*d.length+1}function S2(d,l,h,m){return d/l*h+m}function T2(d,l,h,m){return d-l*h/m}function uot(d,l,h,m){const _=l+d.positionedLines[m].lineOffset;return m===0?h+_/2:h+(_+(l+d.positionedLines[m-1].lineOffset))/2}function cot(d,l=1,h=!1){let m=1/0,_=1/0,S=-1/0,T=-1/0;const C=d[0];for(let $=0;$<C.length;$++){const Z=C[$];(!$||Z.x<m)&&(m=Z.x),(!$||Z.y<_)&&(_=Z.y),(!$||Z.x>S)&&(S=Z.x),(!$||Z.y>T)&&(T=Z.y)}const L=Math.min(S-m,T-_);let k=L/2;const F=new Jv([],hot);if(L===0)return new Me(m,_);for(let $=m;$<S;$+=L)for(let Z=_;Z<T;Z+=L)F.push(new ry($+k,Z+k,k,d));let V=function($){let Z=0,Q=0,et=0;const nt=$[0];for(let dt=0,mt=nt.length,yt=mt-1;dt<mt;yt=dt++){const Lt=nt[dt],It=nt[yt],Ot=Lt.x*It.y-It.x*Lt.y;Q+=(Lt.x+It.x)*Ot,et+=(Lt.y+It.y)*Ot,Z+=3*Ot}return new ry(Q/Z,et/Z,0,$)}(d),U=F.length;for(;F.length;){const $=F.pop();($.d>V.d||!V.d)&&(V=$,h&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,U)),$.max-V.d<=l||(k=$.h/2,F.push(new ry($.p.x-k,$.p.y-k,k,d)),F.push(new ry($.p.x+k,$.p.y-k,k,d)),F.push(new ry($.p.x-k,$.p.y+k,k,d)),F.push(new ry($.p.x+k,$.p.y+k,k,d)),U+=4)}return h&&(console.log(`num probes: ${U}`),console.log(`best distance: ${V.d}`)),V.p}function hot(d,l){return l.max-d.max}class ry{constructor(l,h,m,_){this.p=new Me(l,h),this.h=m,this.d=function(S,T){let C=!1,L=1/0;for(let k=0;k<T.length;k++){const F=T[k];for(let V=0,U=F.length,$=U-1;V<U;$=V++){const Z=F[V],Q=F[$];Z.y>S.y!=Q.y>S.y&&S.x<(Q.x-Z.x)*(S.y-Z.y)/(Q.y-Z.y)+Z.x&&(C=!C),L=Math.min(L,Ys(S,Z,Q))}}return(C?1:-1)*Math.sqrt(L)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const dot=Object.keys,gP=Number.POSITIVE_INFINITY,fot=Math.sqrt(2);function A2(d,l,h,m){const _=d.collisionPadding||[0,0,0,0],S={top:d.top-_[1],bottom:d.bottom+_[3],left:d.left-_[0],right:d.right+_[2],scaled:!1};return m!==void 0&&function(T,C){T.top*=C,T.bottom*=C,T.left*=C,T.right*=C,T.scaled=!0}(S,m),h&&function(T,C){if(!C)return;const L=wr(C),k=new Me(T.left,T.top),F=new Me(T.right,T.top),V=new Me(T.left,T.bottom),U=new Me(T.right,T.bottom);k._rotateAround(L,new Me(0,0)),F._rotateAround(L,new Me(0,0)),V._rotateAround(L,new Me(0,0)),U._rotateAround(L,new Me(0,0)),T.left=Math.min(k.x,F.x,V.x,U.x),T.right=Math.max(k.x,F.x,V.x,U.x),T.top=Math.min(k.y,F.y,V.y,U.y),T.bottom=Math.max(k.y,F.y,V.y,U.y)}(S,h),l?{top:Math.min(l.top,S.top),bottom:Math.max(l.bottom,S.bottom),left:Math.min(l.left,S.left),right:Math.max(l.right,S.right),scaled:l.scaled||S.scaled}:S}function u4(d,[l,h]){let m=0,_=0;if(h===gP){l<0&&(l=0);const S=l/fot;switch(d){case"top-right":case"top-left":_=S-7;break;case"bottom-right":case"bottom-left":_=7-S;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(d){case"top-right":case"bottom-right":m=-S;break;case"top-left":case"bottom-left":m=S;break;case"left":m=l;break;case"right":m=-l}}else{switch(l=Math.abs(l),h=Math.abs(h),d){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(d){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}}return[m,_]}function pot(d,l,h,m,_,S,T,C,L,k,F){const V=d.layers[0],U=V.appearances;if(U.length===0)return{iconBBox:null,iconVerticalBBox:null};let $=null,Z=null;const Q=m.get("icon-rotate").evaluate(_,{},S);l&&($=A2(l,$,Q,T),h)&&(Z=A2(h,Z,Q+90,T));const[et,nt]=m.get("icon-size-scale-range"),dt=lt(1,et,nt);for(const mt of U){const yt=mt.getUnevaluatedProperties(),Lt=yt._values["icon-image"].value!==void 0,It=yt._values["icon-size"].value!==void 0,Ot=yt._values["icon-offset"].value!==void 0,Ut=yt._values["icon-rotate"].value!==void 0;if(Lt||It||Ot||Ut){const Ht=Ot?V.getAppearanceValueAndResolveTokens(mt,"icon-offset",_,S,[]):null,se=Ht&&Array.isArray(Ht)?Ht:C,Kt=Ut?V.getAppearanceValueAndResolveTokens(mt,"icon-rotate",_,S,[]):null,ue=typeof Kt=="number"?Kt:Q,me=It?V.getAppearanceValueAndResolveTokens(mt,"icon-size",_,S,[]):null,Te=typeof me=="number"?me*L.iconScaleFactor:T;let Be=null,De=null,_e=null;if(Lt){const Ee=V.getAppearanceValueAndResolveTokens(mt,"icon-image",_,S,[]);if(Ee){const ae=d.getResolvedImageFromTokens(Ee),re=yt._values["icon-size"],Ie=U1(ae,ty(d.zoom,re,d.worldview),re,S,d.zoom,_,d.pixelRatio,dt,d.worldview);_e=k.get(Ie.iconPrimary.toString())}}else l&&(_e=l.imagePrimary);_e&&(Be=b2(_e,null,se,F),d.allowVerticalPlacement&&(De=b2(_e,null,se,F))),Be&&($=A2(Be,$,ue,Te)),De&&(Z=A2(De,Z,ue+90,Te))}}return{iconBBox:$,iconVerticalBBox:Z}}function I2(d,l,h,m,_,S,T,C,L){if(!l||!l.usvg)return;const k=YV(m),F=YV(_),V=S!=="both"&&S!=="width"||!qV(m)?1:F.width/k.width,U=S!=="both"&&S!=="height"||!XV(m)?1:F.height/k.height;h.scaleSelf(V,U);const $=h.toString();T.set($,h),C.set($,l);const{imagePosition:Z}=dP($,l,$g);L.set($,Z)}function c4(d,l,h,m,_,S,T,C,L){if(!d)return;const k=function(F,V,U,$,Z,Q){if(F.kind==="camera")return F.maxSize;if(F.kind==="composite"){const et=V.possiblyEvaluate(new xn(F.maxZoom,{worldview:Q}),U).evaluate(Z,{},U),nt=V.possiblyEvaluate(new xn(F.minZoom,{worldview:Q}),U).evaluate(Z,{},U);return Math.max(et,nt)}return V.possiblyEvaluate(new xn($,{worldview:Q})).evaluate(Z,{},U)}(l,h,m,_,S,L);return d.scaleSelf(k*C*T)}function U1(d,l,h,m,_,S,T,C,L){return{iconPrimary:c4(d.getPrimary(),l,h,m,_,S,T,C,L),iconSecondary:c4(d.getSecondary(),l,h,m,_,S,T,C,L)}}function got(d,l,h){if(!l)return;const m=h.get(d.toString()),_=h.get(l.toString());m&&_&&(m.paddedRect.w===_.paddedRect.w&&m.paddedRect.h===_.paddedRect.h||Mi(`Mismatch in icon variant sizes: ${d.toString()} and ${l.toString()}`),m.usvg!==_.usvg&&Mi(`Mismatch in icon variant image types: ${d.id} and ${l.id}`))}function h4(d,l,h,m){if(!d)return;const _=l.get(h.toString());if(d.imagePrimary=_,m){const S=l.get(m.toString());d.imageSecondary=S}}function mot(d,l){for(const h in d.horizontal)d4(d.horizontal[h],l);d4(d.vertical,l)}function d4(d,l){if(d){for(const h of d.positionedLines)for(const m of h.positionedGlyphs)if(m.image!==null){const _=m.image.toString();m.rect=l.get(_).paddedRect}}}function mP(d){switch(d){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vot(d,l,h,m,_,S,T,C,L){const k=vP(S.horizontal)||S.vertical,F=h.get("icon-text-fit-padding").evaluate(m,{},_);let V,U=l;return l&&L!=="none"&&(d.allowVerticalPlacement&&S.vertical&&(V=cP(l,S.vertical,L,F,C,T)),k&&(U=cP(l,k,L,F,C,T))),{defaultShapedIcon:U,verticallyShapedIcon:V}}function _ot(d,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt,mt,yt,Lt){let It=T.textMaxSize.evaluate(l,{},U);It===void 0?It=C*T.textScaleFactor:It*=T.textScaleFactor;const Ot=d.layers[0].layout,Ut=no,Ht=C*T.textScaleFactor/Ut,se=vP(h.horizontal)||h.vertical;if(et!=="none"&&d.appearanceFeatureData&&l.index<d.appearanceFeatureData.length){const we=d.appearanceFeatureData[l.index];we&&(we.textShaping=se,we.iconTextFitPadding=Ot.get("icon-text-fit-padding").evaluate(l,{},U),we.fontScale=Ht)}const Kt=$.name==="globe",ue=d.tilePixelRatio*It/Ut,me=(ae=d.overscaling,d.zoom>18&&ae>2&&(ae>>=1),Math.max(Ve/(512*ae),1)*Ot.get("symbol-spacing")),Te=Ot.get("text-padding")*d.tilePixelRatio,Be=Ot.get("icon-padding")*d.tilePixelRatio,De=wr(Ot.get("text-max-angle")),_e=Ot.get("icon-rotation-alignment")==="map"&&mt!=="point",Ee=me/2;var ae;d.hasAnyIconTextFit===!1&&et!=="none"&&(d.hasAnyIconTextFit=!0);const re=l.properties?+l.properties[ii]:null,Ie=re&&d.elevationFeatureIdToIndex?d.elevationFeatureIdToIndex.get(re):65535,Re=(we,si,ci)=>{if(si.x<0||si.x>=Ve||si.y<0||si.y>=Ve)return;let ri=null;if(Kt){const{x:Xe,y:ji,z:Qe}=$.projectTilePoint(si.x,si.y,ci);ri={anchor:new Yh(Xe,ji,Qe,0,void 0),up:$.upVector(ci,si.x,si.y)}}(function(Xe,ji,Qe,Ci,Zi,fr,Pr,qi,Br,Fr,Fn,Ct,St,he,je,de,Je,vi,gi,Ji,Ri,di,zr,ln,Oi,Mr,un,Yr,qn,Cn,mn){const rn=Xe.addToLineVertexArray(ji,Ci);let Nr,Qi,Vr,vn,ki,Lr,Mn,ta=0,ua=0,Pa=0,En=0,Sa=-1,Is=-1;const Ta={};let il=sg("");const Po=Qe?Qe.anchor:ji,Gl=Yr!=="none";let Cs=0,rl=0;if(Br._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ao=Br.layout.get("text-offset").evaluate(Ri,{},Oi);Cs=ao[0]*no,rl=ao[1]*no}else Cs=Br.layout.get("text-radial-offset").evaluate(Ri,{},Oi)*no,rl=gP;if(Xe.allowVerticalPlacement&&Zi.vertical){const ao=Zi.vertical;if(je)Lr=_P(ao),qi&&(Mn=_P(qi));else{const ts=Br.layout.get("text-rotate").evaluate(Ri,{},Oi)+90;Vr=C2(Fr,Po,ji,Fn,Ct,St,ao,he,ts,de),qi&&(vn=C2(Fr,Po,ji,Fn,Ct,St,qi,vi,ts,null,mn))}}if(fr){const ao=Xe.iconSizeData,ts=Br.layout.get("icon-rotate").evaluate(Ri,{},Oi),Uc=pP(fr,ts,zr,Gl,di.iconScaleFactor),Ff=qi?pP(qi,ts,zr,Gl,di.iconScaleFactor):void 0;Qi=C2(Fr,Po,ji,Fn,Ct,St,fr,vi,ts,null,Cn);const cy=function(Gc,j2,hy,Pst,PU,LU,Lst,Rst){const RU=Gc.layers[0],kU=RU.appearances;let dy=j2.length;if(hy&&(dy=Math.max(dy,hy.length)),kU.length===0)return dy;const[kst,Ost]=Pst.get("icon-size-scale-range"),zst=lt(1,kst,Ost);for(const OU of kU){const zU=OU.getUnevaluatedProperties();if(zU._values["icon-image"].value!==void 0){const BU=RU.getAppearanceValueAndResolveTokens(OU,"icon-image",PU,LU,[]);if(BU){const FU=Gc.getResolvedImageFromTokens(BU);if(FU){const NU=zU._values["icon-size"],Bst=U1(FU,ty(Gc.zoom,NU,Gc.worldview),NU,LU,Gc.zoom,PU,Gc.pixelRatio,zst,Gc.worldview),Fst=Lst.get(Bst.iconPrimary.toString());dy=Math.max(dy,lot(Fst,Rst))}}}}return dy}(Xe,Uc,Ff,Br.layout,Ri,Oi,Xe.iconAtlasPositions,Gl);ta=4*cy;let Nf=null;ao.kind==="source"?(Nf=[Qu*Br.layout.get("icon-size").evaluate(Ri,{},Oi)*di.iconScaleFactor],Nf[0]>Kh&&Mi(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${G1}. Reduce your "icon-size".`)):ao.kind==="composite"&&(Nf=[Qu*di.compositeIconSizes[0].evaluate(Ri,{},Oi)*di.iconScaleFactor,Qu*di.compositeIconSizes[1].evaluate(Ri,{},Oi)*di.iconScaleFactor],(Nf[0]>Kh||Nf[1]>Kh)&&Mi(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${G1}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Uc,Nf,Ji,gi,Ri,void 0,Qe,ji,rn.lineStartIndex,rn.lineLength,-1,ln,Oi,Mr,un,Xe.symbolInstances.length,cy),Sa=Xe.icon.placedSymbolArray.length-1,Ff&&(ua=4*cy,Xe.addSymbols(Xe.icon,Ff,Nf,Ji,gi,Ri,el.vertical,Qe,ji,rn.lineStartIndex,rn.lineLength,-1,ln,Oi,Mr,un,Xe.symbolInstances.length,cy),Is=Xe.icon.placedSymbolArray.length-1)}for(const ao in Zi.horizontal){const ts=ao,Uc=Zi.horizontal[ts];Nr||(il=sg(Uc.text),je?ki=_P(Uc):Nr=C2(Fr,Po,ji,Fn,Ct,St,Uc,he,Br.layout.get("text-rotate").evaluate(Ri,{},Oi),de));const Ff=Uc.positionedLines.length===1;if(Pa+=f4(Xe,Qe,ji,Uc,Pr,Br,je,Ri,de,rn,Zi.vertical?el.horizontal:el.horizontalOnly,Ff?dot(Zi.horizontal):[ts],Ta,Sa,di,ln,Oi,Xe.symbolInstances.length,Mr),Ff)break}Zi.vertical&&(En+=f4(Xe,Qe,ji,Zi.vertical,Pr,Br,je,Ri,de,rn,el.vertical,["vertical"],Ta,Is,di,ln,Oi,Xe.symbolInstances.length,Mr));let Lo=-1;const nl=(ao,ts)=>ao?Math.max(ao,ts):ts;Lo=nl(ki,Lo),Lo=nl(Lr,Lo),Lo=nl(Mn,Lo);const Hl=Lo>-1?1:0;Xe.glyphOffsetArray.length>=65535&&Mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ri.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,Ri.sortKey),Xe.symbolInstances.emplaceBack(ji.x,ji.y,Po.x,Po.y,Po.z,Ta.right>=0?Ta.right:-1,Ta.center>=0?Ta.center:-1,Ta.left>=0?Ta.left:-1,Ta.vertical>=0?Ta.vertical:-1,Sa,Is,il,Nr!==void 0?Nr:Xe.collisionBoxArray.length,Nr!==void 0?Nr+1:Xe.collisionBoxArray.length,Vr!==void 0?Vr:Xe.collisionBoxArray.length,Vr!==void 0?Vr+1:Xe.collisionBoxArray.length,Qi!==void 0?Qi:Xe.collisionBoxArray.length,Qi!==void 0?Qi+1:Xe.collisionBoxArray.length,vn||Xe.collisionBoxArray.length,vn?vn+1:Xe.collisionBoxArray.length,Fn,Pa,En,ta,ua,Hl,0,Cs,rl,Lo,0,Gl?1:0,qn)})(d,si,ri,we,h,m,S,_,d.layers[0],d.collisionBoxArray,l.index,l.sourceLayerIndex,d.index,Te,dt,k,0,Be,_e,nt,l,T,F,V,U,Z,Q,et,Ie,yt,Lt)};if(mt==="line")for(const we of l2(l.geometry,0,0,Ve,Ve)){const si=sot(we,me,De,h.vertical||se,m,Ut,ue,d.overscaling,Ve);for(const ci of si)se&&yot(d,se.text,Ee,ci)||Re(we,ci,U)}else if(mt==="line-center"){for(const we of l.geometry)if(we.length>1){const si=oot(we,De,h.vertical||se,m,Ut,ue);si&&Re(we,si,U)}}else if(l.type==="Polygon")for(const we of T1(l.geometry,0)){const si=cot(we,16);Re(we[0],new Yh(si.x,si.y,0,0,void 0),U)}else if(l.type==="LineString")for(const we of l.geometry)Re(we,new Yh(we[0].x,we[0].y,0,0,void 0),U);else if(l.type==="Point")for(const we of l.geometry)for(const si of we)Re([si],new Yh(si.x,si.y,0,0,void 0),U)}const G1=255,Kh=G1*Qu;function f4(d,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt){const mt=function(It,Ot,Ut,Ht,se,Kt,ue,me){const Te=[];if(Ot.positionedLines.length===0)return Te;const Be=Ht.layout.get("text-rotate").evaluate(Kt,{})*Math.PI/180,De=function(Ie){const Re=Ie[0],we=Ie[1],si=Re*we;return si>0?[Re,-we]:si<0?[-Re,we]:Re===0?[we,Re]:[we,-Re]}(Ut);let _e=Math.abs(Ot.top-Ot.bottom);for(const Ie of Ot.positionedLines)_e-=Ie.lineOffset;const Ee=Ot.positionedLines.length,ae=_e/Ee;let re=Ot.top-Ut[1];for(let Ie=0;Ie<Ee;++Ie){const Re=Ot.positionedLines[Ie];re=uot(Ot,ae,re,Ie);for(const we of Re.positionedGlyphs){if(!we.rect)continue;const si=we.rect||{};let ci=UV+1,ri=!0,Xe=1,ji=0;if(we.image){const gi=ue.get(we.image.toString());if(!gi)continue;if(gi.sdf){Mi("SDF images are not supported in formatted text and will be ignored.");continue}ri=!1,Xe=gi.pixelRatio,ci=$g/Xe}const Qe=(se||me)&&we.vertical,Ci=we.metrics.advance*we.scale/2,Zi=we.metrics,fr=we.rect;if(fr===null)continue;me&&Ot.verticalizable&&(ji=we.image?Ci-we.metrics.width*we.scale/2:0);const Pr=se?[we.x+Ci,we.y]:[0,0];let qi=[0,0],Br=[0,0],Fr=!1;se||(Qe?(Br=[we.x+Ci+De[0],we.y+De[1]-ji],Fr=!0):qi=[we.x+Ci+Ut[0],we.y+Ut[1]-ji]);const Fn=fr.w*we.scale/(Xe*(we.localGlyph?tc:1)),Ct=fr.h*we.scale/(Xe*(we.localGlyph?tc:1));let St,he,je,de;if(Qe){const gi=we.y-re,Ji=new Me(-Ci,Ci-gi),Ri=-Math.PI/2,di=new Me(...Br);St=new Me(-Ci+qi[0],qi[1]),St._rotateAround(Ri,Ji)._add(di),St.x+=-gi+Ci,St.y-=(Zi.left-ci)*we.scale;const zr=we.image?Zi.advance*we.scale:no*we.scale,ln=String.fromCodePoint(we.glyph);jat(ln)?St.x+=(1-ci)*we.scale:Wat(ln)?St.x+=zr-Zi.height*we.scale+(-ci-1)*we.scale:St.x+=we.image||Zi.width+2*ci===fr.w&&Zi.height+2*ci===fr.h?(zr-Ct)/2:(zr-(Zi.height+2*ci)*we.scale)/2,he=new Me(St.x,St.y-Fn),je=new Me(St.x+Ct,St.y),de=new Me(St.x+Ct,St.y-Fn)}else{const gi=(Zi.left-ci)*we.scale-Ci+qi[0],Ji=(-Zi.top-ci)*we.scale+qi[1],Ri=gi+Fn,di=Ji+Ct;St=new Me(gi,Ji),he=new Me(Ri,Ji),je=new Me(gi,di),de=new Me(Ri,di)}if(Be){let gi;gi=se?new Me(0,0):Fr?new Me(De[0],De[1]):new Me(Ut[0],Ut[1]),St._rotateAround(Be,gi),he._rotateAround(Be,gi),je._rotateAround(Be,gi),de._rotateAround(Be,gi)}const Je=new Me(0,0),vi=new Me(0,0);Te.push({tl:St,tr:he,bl:je,br:de,texPrimary:si,texSecondary:void 0,writingMode:Ot.writingMode,glyphOffset:Pr,sectionIndex:we.sectionIndex,isSDF:ri,pixelOffsetTL:Je,pixelOffsetBR:vi,minFontScaleX:0,minFontScaleY:0})}}return Te}(0,m,L,S,T,C,_,d.allowVerticalPlacement),yt=d.textSizeData;let Lt=null;yt.kind==="source"?(Lt=[Qu*S.layout.get("text-size").evaluate(C,{},et)*Z.textScaleFactor],Lt[0]>Kh&&Mi(`${d.layerIds[0]}: Value for "text-size" is >= ${G1}. Reduce your "text-size".`)):yt.kind==="composite"&&(Lt=[Qu*Z.compositeTextSizes[0].evaluate(C,{},et)*Z.textScaleFactor,Qu*Z.compositeTextSizes[1].evaluate(C,{},et)*Z.textScaleFactor],(Lt[0]>Kh||Lt[1]>Kh)&&Mi(`${d.layerIds[0]}: Value for "text-size" is >= ${G1}. Reduce your "text-size".`)),d.addSymbols(d.text,mt,Lt,L,T,C,F,l,h,k.lineStartIndex,k.lineLength,$,Q,et,dt,!1,nt,mt.length);for(const It of V)U[It]=d.text.placedSymbolArray.length-1;return 4*mt.length}function vP(d){for(const l in d)return d[l];return null}function C2(d,l,h,m,_,S,T,C,L,k,F){let V,U,$,Z;if(V=F?F.top:T.top,U=F?F.bottom:T.bottom,$=F?F.left:T.left,Z=F?F.right:T.right,ZV(T)&&T.collisionPadding){const Q=T.collisionPadding;$-=Q[0],V-=Q[1],Z+=Q[2],U+=Q[3]}if(L){const Q=new Me($,V),et=new Me(Z,V),nt=new Me($,U),dt=new Me(Z,U),mt=wr(L);let yt=new Me(0,0);k&&(yt=new Me(k[0],k[1])),Q._rotateAround(mt,yt),et._rotateAround(mt,yt),nt._rotateAround(mt,yt),dt._rotateAround(mt,yt),$=Math.min(Q.x,et.x,nt.x,dt.x),Z=Math.max(Q.x,et.x,nt.x,dt.x),V=Math.min(Q.y,et.y,nt.y,dt.y),U=Math.max(Q.y,et.y,nt.y,dt.y)}return d.emplaceBack(l.x,l.y,l.z,h.x,h.y,$,V,Z,U,C,m,_,S),d.length-1}function _P(d){ZV(d)&&d.collisionPadding&&(d.top-=d.collisionPadding[1],d.bottom+=d.collisionPadding[3]);const l=d.bottom-d.top;return l>0?Math.max(10,l):null}function yot(d,l,h,m){const _=d.compareText;if(l in _){const S=_[l];for(let T=S.length-1;T>=0;T--)if(m.dist(S[T])<h)return!0}else _[l]=[];return _[l].push(m),!1}function p4(d,l){const h=d.fovAboveCenter,m=d.elevation?d.elevation.getMinElevationBelowMSL()*l:0,_=(d._camera.position[2]*d.worldSize-m)/Math.cos(d._pitch),S=Math.sin(h)*_/Math.sin(Math.max(Math.PI/2-d._pitch-h,.01));let T=Math.sin(d._pitch)*S+_;const C=_*(1/d._horizonShift);if(!d.elevation||d.elevation.exaggeration()===0){let L=Math.max(d.zoom-17,0);d.isOrthographic&&(L/=10),T*=1+L}return Math.min(1.01*T,C)}function H1(d,l){if(!l.isReprojectedInTileSpace)return{scale:1<<d.z,x:d.x,y:d.y,x2:d.x+1,y2:d.y+1,projection:l};const h=Math.pow(2,-d.z),m=d.x*h,_=(d.x+1)*h,S=d.y*h,T=(d.y+1)*h,C=xt(m),L=xt(_),k=vt(S),F=vt(T),V=l.project(C,k),U=l.project(L,k),$=l.project(L,F),Z=l.project(C,F);let Q=Math.min(V.x,U.x,$.x,Z.x),et=Math.min(V.y,U.y,$.y,Z.y),nt=Math.max(V.x,U.x,$.x,Z.x),dt=Math.max(V.y,U.y,$.y,Z.y);const mt=h/16;function yt(It,Ot,Ut,Ht,se,Kt){const ue=(Ut+se)/2,me=(Ht+Kt)/2,Te=l.project(xt(ue),vt(me)),Be=Math.max(0,Q-Te.x,et-Te.y,Te.x-nt,Te.y-dt);Q=Math.min(Q,Te.x),nt=Math.max(nt,Te.x),et=Math.min(et,Te.y),dt=Math.max(dt,Te.y),Be>mt&&(yt(It,Te,Ut,Ht,ue,me),yt(Te,Ot,ue,me,se,Kt))}yt(V,U,m,S,_,S),yt(U,$,_,S,_,T),yt($,Z,_,T,m,T),yt(Z,V,m,T,m,S),Q-=mt,et-=mt,nt+=mt,dt+=mt;const Lt=1/Math.max(nt-Q,dt-et);return{scale:Lt,x:Q*Lt,y:et*Lt,x2:nt*Lt,y2:dt*Lt,projection:l}}function g4(d,{x:l,y:h},m=0){return new Me(((l-m)*d.scale-d.x)*Ve,(h*d.scale-d.y)*Ve)}const xot=D(new Float32Array(16));class zf{constructor(l){this.spec=l,this.name=l.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(l,h){return{x:0,y:0,z:0}}unproject(l,h){return new X(0,0)}projectTilePoint(l,h,m){return{x:l,y:h,z:0}}locationPoint(l,h,m,_=!0){return l._coordinatePoint(l.locationCoordinate(h,m),_)}pixelsPerMeter(l,h){return gt(1,l)*h}pixelSpaceConversion(l,h,m){return 1}farthestPixelDistance(l){return p4(l,l.pixelsPerMeter)}pointCoordinate(l,h,m,_){const S=l.horizonLineFromTop(!1),T=new Me(h,Math.max(S,m));return l.rayIntersectionCoordinate(l.pointRayIntersection(T,_))}pointCoordinate3D(l,h,m){const _=new Me(h,m);if(l.elevation)return l.elevation.pointCoordinate(_);{const S=this.pointCoordinate(l,_.x,_.y,0);return[S.x,S.y,S.z]}}isPointAboveHorizon(l,h){if(l.elevation&&l.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(l,h.x,h.y);const m=l.horizonLineFromTop();return h.y<m}createInversionMatrix(l,h){return xot}createTileMatrix(l,h,m){let _,S,T;const C=m.canonical,L=D(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=H1(C,this);_=1,S=k.x+m.wrap*k.scale,T=k.y,H(L,L,[_/k.scale,_/k.scale,l.pixelsPerMeter/h])}else _=h/l.zoomScale(C.z),S=(C.x+Math.pow(2,C.z)*m.wrap)*_,T=C.y*_;return N(L,L,[S,T,0]),H(L,L,[_/Ve,_/Ve,1]),L}upVector(l,h,m){return[0,0,1]}upVectorScale(l,h,m){return{metersToTile:1}}}class bot extends zf{constructor(l){super(l),this.range=[4,7],this.center=l.center||[-96,37.5];const[h,m]=this.parallels=l.parallels||[29.5,45.5],_=Math.sin(wr(h));this.n=(_+Math.sin(wr(m)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(l,h){const{n:m,c:_,r0:S}=this,T=wr(l-this.center[0]),C=wr(h),L=Math.sqrt(_-2*m*Math.sin(C))/m;return{x:L*Math.sin(T*m),y:L*Math.cos(T*m)-S,z:0}}unproject(l,h){const{n:m,c:_,r0:S}=this,T=S+h;let C=Math.atan2(l,Math.abs(T))*Math.sign(T);T*m<0&&(C-=Math.PI*Math.sign(l)*Math.sign(T));const L=wr(this.center[0])*m;C=Nt(C,-Math.PI-L,Math.PI-L);const k=lt(Vo(C/m)+this.center[0],-180,180),F=Math.asin(lt((_-(l*l+T*T)*m*m)/(2*m),-1,1)),V=lt(Vo(F),-wt,wt);return new X(k,V)}}const j1=1.340264,W1=-.081106,$1=893e-6,Z1=.003796,M2=Math.sqrt(3)/2;class wot extends zf{project(l,h){h=h/180*Math.PI,l=l/180*Math.PI;const m=Math.asin(M2*Math.sin(h)),_=m*m,S=_*_*_;return{x:.5*(l*Math.cos(m)/(M2*(j1+3*W1*_+S*(7*$1+9*Z1*_)))/Math.PI+.5),y:1-.5*(m*(j1+W1*_+S*($1+Z1*_))/Math.PI+1),z:0}}unproject(l,h){l=(2*l-.5)*Math.PI;let m=h=(2*(1-h)-1)*Math.PI,_=m*m,S=_*_*_;for(let F,V,U,$=0;$<12&&(V=m*(j1+W1*_+S*($1+Z1*_))-h,U=j1+3*W1*_+S*(7*$1+9*Z1*_),F=V/U,m=lt(m-F,-Math.PI/3,Math.PI/3),_=m*m,S=_*_*_,!(Math.abs(F)<1e-12));++$);const T=M2*l*(j1+3*W1*_+S*(7*$1+9*Z1*_))/Math.cos(m),C=Math.asin(Math.sin(m)/M2),L=lt(180*T/Math.PI,-180,180),k=lt(180*C/Math.PI,-wt,wt);return new X(L,k)}}class Sot extends zf{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0}project(l,h){return{x:.5+l/360,y:.5-h/360,z:0}}unproject(l,h){const m=360*(l-.5),_=lt(360*(.5-h),-wt,wt);return new X(m,_)}}const ny=Math.PI/2;function E2(d){return Math.tan((ny+d)/2)}class Tot extends zf{constructor(l){super(l),this.center=l.center||[0,30];const[h,m]=this.parallels=l.parallels||[30,30];let _=wr(h),S=wr(m);this.southernCenter=_+S<0,this.southernCenter&&(_=-_,S=-S);const T=Math.cos(_),C=E2(_);this.n=_===S?Math.sin(_):Math.log(T/Math.cos(S))/Math.log(E2(S)/C),this.f=T*Math.pow(E2(_),this.n)/this.n}project(l,h){h=wr(h),this.southernCenter&&(h=-h),l=wr(l-this.center[0]);const m=1e-6,{n:_,f:S}=this;S>0?h<-ny+m&&(h=-ny+m):h>ny-m&&(h=ny-m);const T=S/Math.pow(E2(h),_);let C=T*Math.sin(_*l),L=S-T*Math.cos(_*l);return C=.5*(C/Math.PI+.5),L=.5*(L/Math.PI+.5),{x:C,y:this.southernCenter?L:1-L,z:0}}unproject(l,h){l=(2*l-.5)*Math.PI,this.southernCenter&&(h=1-h),h=(2*(1-h)-.5)*Math.PI;const{n:m,f:_}=this,S=_-h,T=Math.sign(S),C=Math.sign(m)*Math.sqrt(l*l+S*S);let L=Math.atan2(l,Math.abs(S))*T;S*m<0&&(L-=Math.PI*Math.sign(l)*T);const k=lt(Vo(L/m)+this.center[0],-180,180),F=lt(Vo(2*Math.atan(Math.pow(_/C,1/m))-ny),-wt,wt);return new X(k,this.southernCenter?-F:F)}}class m4 extends zf{constructor(l){super(l),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(l,h){return{x:ht(l),y:st(h),z:0}}unproject(l,h){const m=xt(l),_=vt(h);return new X(m,_)}}const v4=wr(wt);class Aot extends zf{project(l,h){const m=(h=wr(h))*h,_=m*m;return{x:.5*((l=wr(l))*(.8707-.131979*m+_*(_*(.003971*m-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(h*(1.007226+m*(.015085+_*(.028874*m-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(l,h){l=(2*l-.5)*Math.PI;let m=h=(2*(1-h)-1)*Math.PI,_=25,S=0,T=m*m;do{T=m*m;const k=T*T;S=(m*(1.007226+T*(.015085+k*(.028874*T-.044475-.005916*k)))-h)/(1.007226+T*(.045255+k*(.259866*T-.311325-.005916*11*k))),m=lt(m-S,-v4,v4)}while(Math.abs(S)>1e-6&&--_>0);T=m*m;const C=lt(Vo(l/(.8707+T*(T*(T*T*T*(.003971-.001529*T)-.013791)-.131979))),-180,180),L=Vo(m);return new X(C,L)}}const _4=wr(wt);class Iot extends zf{project(l,h){h=wr(h),l=wr(l);const m=Math.cos(h),_=2/Math.PI,S=Math.acos(m*Math.cos(l/2)),T=Math.sin(S)/S,C=.5*(l*_+2*m*Math.sin(l/2)/T)||0,L=.5*(h+Math.sin(h)/T)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(l,h){let m=l=(2*l-.5)*Math.PI,_=h=(2*(1-h)-1)*Math.PI,S=25;const T=1e-6;let C=0,L=0;do{const k=Math.cos(_),F=Math.sin(_),V=2*F*k,U=F*F,$=k*k,Z=Math.cos(m/2),Q=Math.sin(m/2),et=2*Z*Q,nt=Q*Q,dt=1-$*Z*Z,mt=dt?1/dt:0,yt=dt?Math.acos(k*Z)*Math.sqrt(1/dt):0,Lt=.5*(2*yt*k*Q+2*m/Math.PI)-l,It=.5*(yt*F+_)-h,Ot=.5*mt*($*nt+yt*k*Z*U)+1/Math.PI,Ut=mt*(et*V/4-yt*F*Q),Ht=.125*mt*(V*Q-yt*F*$*et),se=.5*mt*(U*Z+yt*nt*k)+.5,Kt=Ut*Ht-se*Ot;C=(It*Ut-Lt*se)/Kt,L=(Lt*Ht-It*Ot)/Kt,m=lt(m-C,-Math.PI,Math.PI),_=lt(_-L,-_4,_4)}while((Math.abs(C)>T||Math.abs(L)>T)&&--S>0);return new X(Vo(m),Vo(_))}}class y4 extends zf{constructor(l){super(l),this.center=l.center||[0,0],this.parallels=l.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(l,h){const{scale:m,cosPhi:_}=this;return{x:wr(l)*_*m+.5,y:-Math.sin(wr(h))/_*m+.5,z:0}}unproject(l,h){const{scale:m,cosPhi:_}=this,S=-(h-.5)/m,T=lt(Vo((l-.5)/m)/_,-180,180),C=Math.asin(lt(S*_,-1,1)),L=lt(Vo(C),-wt,wt);return new X(T,L)}}class Cot extends m4{constructor(l){super(l),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(l,h,m){const _=_1(l,h,m);return Bt(_,_,QT(Fc(m))),{x:_[0],y:_[1],z:_[2]}}locationPoint(l,h,m){const _=B(h.lat,h.lng),S=xe([],_),T=m?l._centerAltitude+m:l.elevation?l.elevation.getAtPointOrZero(l.locationCoordinate(h),l._centerAltitude):l._centerAltitude;ni(_,_,S,gt(1,0)*Ve*T);const C=D(new Float64Array(16));return z(C,l.pixelMatrix,l.globeMatrix),Bt(_,_,C),new Me(_[0],_[1])}pixelsPerMeter(l,h){return gt(1,0)*h}pixelSpaceConversion(l,h,m){const _=gt(1,l)*h,S=zi(gt(1,45)*h,_,m);return this.pixelsPerMeter(l,h)/S}createTileMatrix(l,h,m){const _=TD(Fc(m.canonical));return z(new Float64Array(16),l.globeMatrix,_)}createInversionMatrix(l,h){const{center:m}=l,_=QT(Fc(h));return Y(_,_,wr(m.lng)),q(_,_,wr(m.lat)),H(_,_,[l._pixelsPerMercatorPixel,l._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(l,h,m,_){return HN(l,h,m,!0)||new qt(0,0)}pointCoordinate3D(l,h,m){const _=this.pointCoordinate(l,h,m,0);return[_.x,_.y,_.z]}isPointAboveHorizon(l,h){return!HN(l,h.x,h.y,!1)}farthestPixelDistance(l){const h=function(_,S){const T=_.cameraToCenterDistance,C=_._centerAltitude*S,L=_._camera,k=_._camera.forward(),F=zt([],ke([],k,-T),[0,0,C]),V=_.worldSize/(2*Math.PI),U=[0,0,-V],$=_.width/_.height,Z=Math.tan(_.fovAboveCenter),Q=ke([],L.up(),Z),et=ke([],L.right(),Z*$),nt=xe([],zt([],zt([],k,Q),et)),dt=[];let mt;if(new ir(F,nt).closestPointOnSphere(U,V,dt)){const yt=zt([],dt,U),Lt=qe([],yt,F);mt=Math.cos(_.fovAboveCenter)*Et(Lt)}else{const yt=qe([],F,U),Lt=qe([],U,F);xe(Lt,Lt);const It=Et(yt)-V;mt=Math.sqrt(It*(It+2*V));const Ot=Math.acos(mt/(V+It))-Math.acos(Ke(k,Lt));mt*=Math.cos(Ot)}return 1.01*mt}(l,this.pixelsPerMeter(l.center.lat,l.worldSize)),m=Lf(l.zoom);if(m>0){const _=p4(l,gt(1,l.center.lat)*l.worldSize),S=l.worldSize/(2*Math.PI),T=Math.max(l.width,l.height)/l.worldSize*Math.PI;return zi(h,_+S*(1-Math.cos(T)),Math.pow(m,10))}return h}upVector(l,h,m){return _1(h,m,l,1)}upVectorScale(l){return{metersToTile:YT(JT(Fc(l)))}}}function x4(d){const l=d.parallels,h=!!l&&Math.abs(l[0]+l[1])<.01;switch(d.name){case"mercator":return new m4(d);case"equirectangular":return new Sot(d);case"naturalEarth":return new Aot(d);case"equalEarth":return new wot(d);case"winkelTripel":return new Iot(d);case"albers":return h?new y4(d):new bot(d);case"lambertConformalConic":return h?new y4(d):new Tot(d);case"globe":return new Cot(d)}throw new Error(`Invalid projection name: ${d.name}`)}const Mot=Ae.types,Eot=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function q1(d,l,h,m,_,S,T,C,L,k,F,V,U){const $=C?Math.min(Kh,Math.round(C[0])):0,Z=C?Math.min(Kh,Math.round(C[1])):0;d.emplaceBack(l,h,Math.round(32*m),Math.round(32*_),S,T,($<<1)+(L?1:0),0+(Z<<1),16*k,16*F,256*V,256*U)}function X1(d,l,h){d.emplaceBack(l,h)}function Y1(d,l,h,m,_,S,T){d.emplaceBack(l,h,m,_,S,T)}const D2=(d,l,h,m)=>{for(let _=0;_<l;_++)d.emplaceBack(h[0],h[1],h[2],m[0],m[1],m[2])};function ay(d,l,h,m,_){d.emplaceBack(l,h,m,_),d.emplaceBack(l,h,m,_),d.emplaceBack(l,h,m,_),d.emplaceBack(l,h,m,_)}function Dot(d){for(const l of d.sections)if(sD(l.text))return!0;return!1}class yP{constructor(l){this.layoutVertexArray=new R_,this.indexArray=new Ln,this.programConfigurations=l,this.segments=new Un,this.dynamicLayoutVertexArray=new zc,this.opacityVertexArray=new i1,this.placedSymbolArray=new Og,this.iconTransitioningVertexArray=new Al,this.globeExtVertexArray=new Sf,this.zOffsetVertexArray=new qu,this.orientationVertexArray=new a1,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(l,h){const m=[],_=this.layoutVertexArray.uint16;for(let S=0;S<h;++S){const T=12*(l+S);m.push(..._.slice(T,T+12))}return m}updateIconVertexData(l,h,m,_,S,T,C,L,k,F,V,U,$){const Z=this.layoutVertexArray.uint16,Q=12*l;Z[Q]=h,Z[Q+1]=m,Z[Q+2]=_,Z[Q+3]=S,Z[Q+4]=T,Z[Q+5]=C,Z[Q+6]=L,Z[Q+7]=k,Z[Q+8]=F,Z[Q+9]=V,Z[Q+10]=U,Z[Q+11]=$}upload(l,h,m,_,S,T){this.isEmpty()||(m&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,kat.members,!!T),this.indexBuffer=l.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,zat.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,Eot,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=l.createVertexBuffer(this.iconTransitioningVertexArray,Nat.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=l.createVertexBuffer(this.globeExtVertexArray,Oat.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||S)&&(this.zOffsetVertexBuffer=l.createVertexBuffer(this.zOffsetVertexArray,Bat.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=l.createVertexBuffer(this.orientationVertexArray,Fat.members,!0)),this.opacityVertexBuffer.itemSize=1),(m||_)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}li(yP,"SymbolBuffers");class xP{constructor(l,h,m){this.layoutVertexArray=new l,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Un,this.collisionVertexArray=new Af,this.collisionVertexArrayExt=new zc}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Vat.members,!0),this.collisionVertexBufferExt=l.createVertexBuffer(this.collisionVertexArrayExt,Uat.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}li(xP,"CollisionBuffers");class P2{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(T=>T.fqid),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=D([]),this.placementViewportMatrix=D([]);const h=this.layers[0]._unevaluatedLayout._values;this.worldview=l.worldview,this.textSizeData=ty(this.zoom,h["text-size"],this.worldview),this.iconSizeData=ty(this.zoom,h["icon-size"],this.worldview);const m=this.layers[0].layout,_=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.lut=l.lut,this.canOverlap=m.get("text-allow-overlap")||m.get("icon-allow-overlap")||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&_.constantOr(1)!==void 0,this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=m.get("text-writing-mode").map(T=>el[T]),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=l.sourceID,this.projection=l.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(l){const h=this.layers[0].getAppearances();return!(!h||h.length===0)&&h.some(m=>m.getProperty(l)!=null)}createArrays(){this.text=new yP(new Vl(this.layers,{zoom:this.zoom,lut:this.lut},l=>l.startsWith("text")||l.startsWith("symbol"))),this.icon=new yP(new Vl(this.layers,{zoom:this.zoom,lut:this.lut},l=>l.startsWith("icon")||l.startsWith("symbol"))),this.glyphOffsetArray=new d1,this.lineVertexArray=new VT,this.symbolInstances=new NT}calculateGlyphDependencies(l,h,m,_,S){for(const T of l){const C=T.codePointAt(0);if(C===void 0)break;if(h[C]=!0,_&&S&&C<=65535){const L=B1[T];L&&(h[L.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(l,h,m,_,S,T){let C=1;const L=l.getUnevaluatedProperties()._values["icon-size"],k=ty(this.zoom,L,this.worldview),F=ey(k,h);if(k.kind!=="constant"&&k.kind!=="camera"||(C=F.uSize),k.kind==="composite"){const{minZoom:V,maxZoom:U}=k,$=L.possiblyEvaluate(new xn(V,{worldview:this.worldview}),_),Z=L.possiblyEvaluate(new xn(U,{worldview:this.worldview}),_),Q=$.evaluate(m,{},_,S);C=Q+(Z.evaluate(m,{},_,S)-Q)*F.uSizeT}return k.kind==="source"&&(C=L.possiblyEvaluate(new xn(this.zoom,{worldview:this.worldview}),_).evaluate(m,{},_,S)),C*T}updateFootprints(l,h){}updateReplacement(l,h){if(h.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=h.updateTime;const m=h.getReplacementRegionsForTile(l.toUnwrapped(),!0);return!a2(this.activeReplacements,m)&&(this.activeReplacements=m,!0)}getResolvedImageFromTokens(l){return typeof l=="string"?cs.build(l):l}populate(l,h,m,_){const S=this.layers[0],T=S.layout,C=this.projection.name==="globe",L=T.get("text-font"),k=T.get("text-field"),F=T.get("icon-image"),[V,U]=T.get("icon-size-scale-range"),$=lt(h.scaleFactor||1,V,U),Z=(k.value.kind!=="constant"||k.value.value instanceof Za&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),Q=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,et=this.hasAnyAppearanceProperty("icon-image"),nt=T.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Z&&!Q&&!et)return;const dt=h.iconDependencies,mt=h.glyphDependencies,yt=h.availableImages,Lt=new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),It=Ot=>{const Ut=Ot.id.toString();dt.has(Ut)?dt.get(Ut).push(Ot):dt.set(Ut,[Ot])};for(const Ot of l){const{feature:Ut,id:Ht,index:se,sourceLayerIndex:Kt}=Ot,ue=S._featureFilter.needGeometry,me=ee(Ut,ue);if(!S._featureFilter.filter(Lt,me,m))continue;if(ue||(me.geometry=pe(Ut,m,_)),C&&Ut.type!==1&&m.z<=5){const Ie=me.geometry,Re=.98078528056,we=(si,ci)=>Ke(_1(si.x,si.y,m,1),_1(ci.x,ci.y,m,1))<Re;for(let si=0;si<Ie.length;si++)Ie[si]=fe(Ie[si],we)}let Te,Be;if(Z){const Ie=S.getValueAndResolveTokens("text-field",me,m,yt),Re=Za.factory(Ie);Dot(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||Zx()==="unavailable"||this.hasRTLText&&As.isParsed())&&(Te=Hat(Re,S,me))}if(Q){const Ie=S.getValueAndResolveTokens("icon-image",me,m,yt);Be=this.getResolvedImageFromTokens(Ie)}const De=this.layers[0];let _e=!1;if(!Be&&et){const Ie=De.getAppearances();for(const Re of Ie)if(Re.getProperty("icon-image")){const we=De.getAppearanceValueAndResolveTokens(Re,"icon-image",me,m,yt);if(we){Be=this.getResolvedImageFromTokens(we),_e=!0;break}}}if(!Te&&!Be)continue;const Ee=this.sortFeaturesByKey?nt.evaluate(me,{},m):void 0,ae={id:Ht,text:Te,icon:Be,index:se,sourceLayerIndex:Kt,geometry:me.geometry,properties:Ut.properties,type:Mot[Ut.type],sortKey:Ee};if(this.features.push(ae),this.appearanceFeatureData.push({id:Ht,properties:Ut.properties,usesAppearanceIconAsPlaceholder:_e,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Be){const Ie=De._unevaluatedLayout._values,{iconPrimary:Re,iconSecondary:we}=U1(Be,this.iconSizeData,Ie["icon-size"],m,this.zoom,ae,this.pixelRatio,$,this.worldview);It(Re),we&&(this.hasAnySecondaryIcon=!0,It(we))}const re=De.getAppearances();if(re.length!==0&&re.forEach(Ie=>{if(!Ie.getProperty("icon-image"))return;const Re=this.getCombinedIconPrimary(Ie,De,me,m,yt,ae,$);Re&&It(Re)}),Te){const Ie=L.evaluate(me,{},m).join(","),Re=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(el.vertical)>=0;for(const we of Te.sections)if(we.image){const si=we.image.getPrimary().scaleSelf(this.pixelRatio),ci=si.id.toString(),ri=dt.get(ci)||[];ri.push(si),dt.set(ci,ri)}else{const si=Ux(Te.toString()),ci=we.fontStack||Ie,ri=mt[ci]=mt[ci]||{};this.calculateGlyphDependencies(we.text,ri,Re,this.allowVerticalPlacement,si)}}}if(T.get("symbol-placement")==="line"&&(this.features=function(Ot){const Ut={},Ht={},se=[];let Kt=0;function ue(De){se.push(Ot[De]),Kt++}function me(De,_e,Ee){const ae=Ht[De];return delete Ht[De],Ht[_e]=ae,se[ae].geometry[0].pop(),se[ae].geometry[0]=se[ae].geometry[0].concat(Ee[0]),ae}function Te(De,_e,Ee){const ae=Ut[_e];return delete Ut[_e],Ut[De]=ae,se[ae].geometry[0].shift(),se[ae].geometry[0]=Ee[0].concat(se[ae].geometry[0]),ae}function Be(De,_e,Ee){const ae=Ee?_e[0][_e[0].length-1]:_e[0][0];return`${De}:${ae.x}:${ae.y}`}for(let De=0;De<Ot.length;De++){const _e=Ot[De],Ee=_e.geometry,ae=_e.text?_e.text.toString():null;if(!ae){ue(De);continue}const re=Be(ae,Ee),Ie=Be(ae,Ee,!0);if(re in Ht&&Ie in Ut&&Ht[re]!==Ut[Ie]){const Re=Te(re,Ie,Ee),we=me(re,Ie,se[Re].geometry);delete Ut[re],delete Ht[Ie],Ht[Be(ae,se[we].geometry,!0)]=we,se[Re].geometry=null}else re in Ht?me(re,Ie,Ee):Ie in Ut?Te(re,Ie,Ee):(ue(De),Ut[re]=Kt-1,Ht[Ie]=Kt-1)}return se.filter(De=>De.geometry)}(this.features)),T.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",h.elevationFeatures){!this.elevationFeatures&&h.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ot of h.elevationFeatures)this.elevationFeatureIdToIndex.set(Ot.id,this.elevationFeatures.length),this.elevationFeatures.push(Ot)}}else T.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ot,Ut)=>Ot.sortKey-Ut.sortKey)}getCombinedIconPrimary(l,h,m,_,S,T,C){let L,k;const F=l.getUnevaluatedProperties();if(F._values["icon-image"].value!==void 0){const V=h.getAppearanceValueAndResolveTokens(l,"icon-image",m,_,S);L=this.getResolvedImageFromTokens(V)}else{const V=h.getValueAndResolveTokens("icon-image",m,_,S);L=this.getResolvedImageFromTokens(V)}if(L){const V=F._values["icon-size"]||h._unevaluatedLayout._values["icon-size"];k=U1(L,ty(this.zoom,V,this.worldview),V,_,this.zoom,T,this.pixelRatio,C,this.worldview).iconPrimary}return k}updateAppearanceBasedIconTextures(l,h,m,_){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const S=this.layers[0];let T=!1,C=0;const L=S.layout,[k,F]=L.get("icon-size-scale-range"),V=lt(1,k,F);for(let U=0;U<this.symbolInstances.length;U++){const $=this.symbolInstances.get(U),Z=this.appearanceFeatureData[$.featureIndex];if(Z&&$.placedIconSymbolIndex>=0){const Q=Z.id,et=h&&Q!==void 0?h[String(Q)]:void 0,nt={type:"Point",id:Z.id,properties:Z.properties,geometry:[]},dt=this.layers[0].appearances&&this.layers[0].appearances.find(mt=>mt.isActive({globals:_,feature:nt,canonical:l,featureState:et}));if(Z.activeAppearance===dt)continue;if(dt){Z.activeAppearance=dt;const mt={sortKey:void 0,text:void 0,icon:null,index:$.featureIndex,sourceLayerIndex:$.featureIndex,geometry:[],properties:Z.properties,type:"Point",id:Z.id};if(!dt.hasCachedIconPrimary()){const Ot=this.getCombinedIconPrimary(dt,S,nt,l,m,mt,V);dt.setCachedIconPrimary(Ot)}const yt=dt.getCachedIconPrimary();if(!yt)continue;const Lt=yt.toString(),It=this.iconAtlasPositions&&this.iconAtlasPositions.get(Lt);if(It){const Ot=S.getAppearanceValueAndResolveTokens(dt,"icon-offset",nt,l,m),Ut=Ot&&Array.isArray(Ot)?Ot:[0,0];let Ht=b2(It,void 0,Ut,S.layout.get("icon-anchor").evaluate(nt,{},l));const se=S.getAppearanceValueAndResolveTokens(dt,"icon-rotate",nt,l,m),Kt=typeof se=="number"?se:0,ue=It.sdf,me=S.layout.get("icon-text-fit").constantOr("none");me!=="none"&&Z.textShaping&&Z.iconTextFitPadding&&Z.fontScale&&(Ht=cP(Ht,Z.textShaping,me,Z.iconTextFitPadding,Ut,Z.fontScale));const Te=this.calculateEffectiveAppearanceIconSize(dt,_.zoom,nt,l,m,V),Be=0,De=1+(Math.min(Kh,Math.round(Te*Qu))<<1),_e=pP(Ht,Kt,ue,me!=="none",V);Z.isUsingAppearanceVertexData||(Z.isUsingAppearanceVertexData=!0,Z.layoutBasedVertexData=this.icon.getIconVertexData(C,$.numIconVertices));for(let ae=0;ae<_e.length;++ae){const re=_e[ae],Ie=Z.layoutBasedVertexData[0]||$.tileAnchorX,Re=Z.layoutBasedVertexData[1]||$.tileAnchorY,we=16*re.pixelOffsetTL.x,si=16*re.pixelOffsetTL.y,ci=16*re.pixelOffsetBR.x,ri=16*re.pixelOffsetBR.y,Xe=16*re.minFontScaleX,ji=16*re.minFontScaleY;this.icon.updateIconVertexData(C,Ie,Re,Math.round(32*re.tl.x),Math.round(32*re.tl.y),re.texPrimary.x,re.texPrimary.y,Be,De,we,si,Xe,ji),this.icon.updateIconVertexData(C+1,Ie,Re,Math.round(32*re.tr.x),Math.round(32*re.tr.y),re.texPrimary.x+re.texPrimary.w,re.texPrimary.y,Be,De,ci,si,Xe,ji),this.icon.updateIconVertexData(C+2,Ie,Re,Math.round(32*re.bl.x),Math.round(32*re.bl.y),re.texPrimary.x,re.texPrimary.y+re.texPrimary.h,Be,De,we,ri,Xe,ji),this.icon.updateIconVertexData(C+3,Ie,Re,Math.round(32*re.br.x),Math.round(32*re.br.y),re.texPrimary.x+re.texPrimary.w,re.texPrimary.y+re.texPrimary.h,Be,De,ci,ri,Xe,ji),C+=4}const Ee=$.numIconVertices-4*_e.length;for(let ae=0;ae<Ee;++ae)this.icon.updateIconVertexData(C+ae,0,0,0,0,0,0,0,0,0,0,0,0);T=!0}else C+=$.numIconVertices}else if(Z.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(C,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+3,0,0,0,0,0,0,0,0,0,0,0,0),T=!0),C+=$.numIconVertices,Z.activeAppearance=null;else if(Z.isUsingAppearanceVertexData){const yt=Z.layoutBasedVertexData.length/12;for(let Lt=0;Lt<yt;++Lt){const It=Lt*12;this.icon.updateIconVertexData(C+Lt,Z.layoutBasedVertexData[It+0],Z.layoutBasedVertexData[It+1],Z.layoutBasedVertexData[It+2],Z.layoutBasedVertexData[It+3],Z.layoutBasedVertexData[It+4],Z.layoutBasedVertexData[It+5],Z.layoutBasedVertexData[It+6],Z.layoutBasedVertexData[It+7],Z.layoutBasedVertexData[It+8],Z.layoutBasedVertexData[It+9],Z.layoutBasedVertexData[It+10],Z.layoutBasedVertexData[It+11])}C+=yt,Z.isUsingAppearanceVertexData=!1,Z.activeAppearance=null,T=!0}else C+=$.numIconVertices,Z.activeAppearance=null}}return T}update(l,h,m,_,S,T,C){this.text.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C,this.worldview),this.icon.programConfigurations.updatePaintArrays(l,h,S,m,_,T,C,this.worldview)}updateRoadElevation(l){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let h=!1;const m=kt(l),_=1/m;let S=!1,T=!1;for(let C=0;C<this.symbolInstances.length;C++){const L=this.symbolInstances.get(C),k=bt(1,0,0),F=bt(0,1,0),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:U,numIconVertices:$,numVerticalIconVertices:Z}=L,Q=V>0||U>0,et=$>0,nt=this.elevationFeatures[L.elevationFeatureIndex];if(nt){const dt=new Me(L.tileAnchorX,L.tileAnchorY),mt=.075+nt.pointElevation(dt);L.zOffset!==mt&&(h=!0,L.zOffset=mt),mt!==0&&(this.hasAnyZOffset=!0);const yt=nt.computeSlopeNormal(dt,_),Lt=Ja(hr(),bt(0,0,1),yt);ge(k,k,Lt),ge(F,F,Lt),k[2]*=m,F[2]*=m,k[0]===1&&k[1]===0&&k[2]===0&&F[0]===0&&F[1]===1&&F[2]===0||(S=S||Q,T=T||et)}if(Q&&(D2(this.text.orientationVertexArray,V,k,F),D2(this.text.orientationVertexArray,U,k,F)),et){const{placedIconSymbolIndex:dt,verticalPlacedIconSymbolIndex:mt}=L;dt>=0&&D2(this.icon.orientationVertexArray,$,k,F),mt>=0&&D2(this.icon.orientationVertexArray,Z,k,F)}}S||(this.text.orientationVertexArray=void 0),T||(this.icon.orientationVertexArray=void 0),h&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const l=(S,T,C)=>{m+=T,m>S.length&&S.resize(m);for(let L=-T;L<0;L++)S.emplace(L+m,C)},h=(S,T,C)=>{_+=T,_>S.length&&S.resize(_);for(let L=-T;L<0;L++)S.emplace(L+_,C)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let m=0,_=0;for(let S=0;S<this.symbolInstances.length;S++){const T=this.symbolInstances.get(S),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:L,numIconVertices:k}=T,F=T.zOffset,V=k>0;if((C>0||L>0)&&(l(this.text.zOffsetVertexArray,C,F),l(this.text.zOffsetVertexArray,L,F)),V){const{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:$}=T;U>=0&&h(this.icon.zOffsetVertexArray,k,F),$>=0&&h(this.icon.zOffsetVertexArray,T.numVerticalIconVertices,F)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l,h,m,_,S){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(T=>T.appearances&&T.appearances.length>0)),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(l,h,m,_){return!!(l&&h&&m)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(l,h,m,_)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=x4(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,h){const m=this.lineVertexArray.length;if(l.segment!==void 0)for(const{x:_,y:S}of h)this.lineVertexArray.emplaceBack(_,S);return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q,et,nt,dt){const mt=l.indexArray,yt=l.layoutVertexArray,Lt=l.globeExtVertexArray,It=l.segments.prepareSegment(4*dt,yt,mt,this.canOverlap?T.sortKey:void 0),Ot=this.glyphOffsetArray.length,Ut=It.vertexLength,Ht=this.allowVerticalPlacement&&C===el.vertical?Math.PI/2:0,se=T.text&&T.text.sections;for(let me=0;me<h.length;me++){const{tl:Te,tr:Be,bl:De,br:_e,texPrimary:Ee,texSecondary:ae,pixelOffsetTL:re,pixelOffsetBR:Ie,minFontScaleX:Re,minFontScaleY:we,glyphOffset:si,isSDF:ci,sectionIndex:ri}=h[me],Xe=It.vertexLength,ji=si[1];if(q1(yt,k.x,k.y,Te.x,ji+Te.y,Ee.x,Ee.y,m,ci,re.x,re.y,Re,we),q1(yt,k.x,k.y,Be.x,ji+Be.y,Ee.x+Ee.w,Ee.y,m,ci,Ie.x,re.y,Re,we),q1(yt,k.x,k.y,De.x,ji+De.y,Ee.x,Ee.y+Ee.h,m,ci,re.x,Ie.y,Re,we),q1(yt,k.x,k.y,_e.x,ji+_e.y,Ee.x+Ee.w,Ee.y+Ee.h,m,ci,Ie.x,Ie.y,Re,we),L){const{x:Qe,y:Ci,z:Zi}=L.anchor,[fr,Pr,qi]=L.up;Y1(Lt,Qe,Ci,Zi,fr,Pr,qi),Y1(Lt,Qe,Ci,Zi,fr,Pr,qi),Y1(Lt,Qe,Ci,Zi,fr,Pr,qi),Y1(Lt,Qe,Ci,Zi,fr,Pr,qi),ay(l.dynamicLayoutVertexArray,Qe,Ci,Zi,Ht)}else ay(l.dynamicLayoutVertexArray,k.x,k.y,k.z,Ht);if(et){const Qe=ae||Ee;X1(l.iconTransitioningVertexArray,Qe.x,Qe.y),X1(l.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y),X1(l.iconTransitioningVertexArray,Qe.x,Qe.y+Qe.h),X1(l.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y+Qe.h)}mt.emplaceBack(Xe,Xe+1,Xe+2),mt.emplaceBack(Xe+1,Xe+2,Xe+3),It.vertexLength+=4,It.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(si[0]),me!==h.length-1&&ri===h[me+1].sectionIndex||l.programConfigurations.populatePaintArrays(yt.length,T,T.index,{},$,Z,Q,se&&se[ri],this.worldview)}const Kt=dt-h.length;Kt!==0&&this._addNullVertices(Kt,yt,m,L,Lt,l,et,It,mt);const ue=L?L.anchor:k;l.placedSymbolArray.emplaceBack(ue.x,ue.y,ue.z,k.x,k.y,Ot,this.glyphOffsetArray.length-Ot,Ut,F,V,k.segment,m?m[0]:0,m?m[1]:0,_[0],_[1],C,0,0,0,U,0),l.symbolInstanceIndices.push(nt)}_addNullVertices(l,h,m,_,S,T,C,L,k){for(let F=0;F<l;F++){for(let U=0;U<4;U++)q1(h,0,0,0,0,0,0,m,!1,0,0,0,0),_&&Y1(S,0,0,0,0,0,0),ay(T.dynamicLayoutVertexArray,0,0,0,0),C&&X1(T.iconTransitioningVertexArray,0,0);const V=L.vertexLength;k.emplaceBack(V,V+1,V+2),k.emplaceBack(V+1,V+2,V+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(l,h,m,_,S,T,C){l.emplaceBack(h,m,_,S,T,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(l,h,m,_,S,T,C){const L=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=L.vertexLength,F=C.tileAnchorX,V=C.tileAnchorY;for(let $=0;$<4;$++)m.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(m.collisionVertexArrayExt,h,l.padding,C.zOffset),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Me(l.x1,l.y1)),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Me(l.x2,l.y1)),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Me(l.x2,l.y2)),this._commitLayoutVertex(m.layoutVertexArray,_,S,T,F,V,new Me(l.x1,l.y2)),L.vertexLength+=4;const U=m.indexArray;U.emplaceBack(k,k+1),U.emplaceBack(k+1,k+2),U.emplaceBack(k+2,k+3),U.emplaceBack(k+3,k),L.primitiveLength+=4}_addTextDebugCollisionBoxes(l,h,m,_,S,T){for(let C=_;C<S;C++){const L=m.get(C),k=this.getSymbolInstanceTextSize(l,T,h,C);this._addCollisionDebugVertices(L,k,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,T)}}_addIconDebugCollisionBoxes(l,h,m,_,S,T){for(let C=_;C<S;C++){const L=m.get(C),k=this.getSymbolInstanceIconSize(l,h,T.placedIconSymbolIndex);this._addCollisionDebugVertices(L,k,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,T)}}generateCollisionDebugBuffers(l,h,m){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xP(k_,BV.members,Al),this.iconCollisionBox=new xP(k_,BV.members,Al);const _=ey(this.iconSizeData,l),S=ey(this.textSizeData,l,m);for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T);this._addTextDebugCollisionBoxes(S,l,h,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(S,l,h,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(_,l,h,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(_,l,h,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(l,h,m,_){const S=this.text.placedSymbolArray.get(h.rightJustifiedTextSymbolIndex>=0?h.rightJustifiedTextSymbolIndex:h.centerJustifiedTextSymbolIndex>=0?h.centerJustifiedTextSymbolIndex:h.leftJustifiedTextSymbolIndex>=0?h.leftJustifiedTextSymbolIndex:h.verticalPlacedTextSymbolIndex>=0?h.verticalPlacedTextSymbolIndex:_),T=hP(this.textSizeData,l,S)/no;return this.tilePixelRatio*T}getSymbolInstanceIconSize(l,h,m){const _=this.icon.placedSymbolArray.get(m),S=hP(this.iconSizeData,l,_);return this.tilePixelRatio*S}_commitDebugCollisionVertexUpdate(l,h,m,_){l.emplaceBack(h,-m,-m,_),l.emplaceBack(h,m,-m,_),l.emplaceBack(h,m,m,_),l.emplaceBack(h,-m,m,_)}_updateTextDebugCollisionBoxes(l,h,m,_,S,T,C){for(let L=_;L<S;L++){const k=m.get(L),F=this.getSymbolInstanceTextSize(l,T,h,L);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,k.padding,T.zOffset)}}_updateIconDebugCollisionBoxes(l,h,m,_,S,T,C){for(let L=_;L<S;L++){const k=m.get(L),F=this.getSymbolInstanceIconSize(l,h,T.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,F,k.padding,T.zOffset)}}updateCollisionDebugBuffers(l,h,m,_){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const S=ey(this.iconSizeData,l,_),T=ey(this.textSizeData,l,m);for(let C=0;C<this.symbolInstances.length;C++){const L=this.symbolInstances.get(C);this._updateTextDebugCollisionBoxes(T,l,h,L.textBoxStartIndex,L.textBoxEndIndex,L,m),this._updateTextDebugCollisionBoxes(T,l,h,L.verticalTextBoxStartIndex,L.verticalTextBoxEndIndex,L,m),this._updateIconDebugCollisionBoxes(S,l,h,L.iconBoxStartIndex,L.iconBoxEndIndex,L,_),this._updateIconDebugCollisionBoxes(S,l,h,L.verticalIconBoxStartIndex,L.verticalIconBoxEndIndex,L,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(l,h,m,_,S,T,C,L,k){const F={};if(h<m){const{x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt,featureIndex:Lt}=l.get(h);F.textBox={x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt},F.textFeatureIndex=Lt}if(_<S){const{x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt,featureIndex:Lt}=l.get(_);F.verticalTextBox={x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt},F.verticalTextFeatureIndex=Lt}if(T<C){const{x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt,featureIndex:Lt}=l.get(T);F.iconBox={x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt},F.iconFeatureIndex=Lt}if(L<k){const{x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt,featureIndex:Lt}=l.get(L);F.verticalIconBox={x1:V,y1:U,x2:$,y2:Z,padding:Q,projectedAnchorX:et,projectedAnchorY:nt,projectedAnchorZ:dt,tileAnchorX:mt,tileAnchorY:yt},F.verticalIconFeatureIndex=Lt}return F}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(l,h){const m=l.placedSymbolArray.get(h),_=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<_;S+=4)l.indexArray.emplaceBack(S,S+1,S+2),l.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(l),m=Math.cos(l),_=[],S=[],T=[];for(let C=0;C<this.symbolInstances.length;++C){T.push(C);const L=this.symbolInstances.get(C);_.push(0|Math.round(h*L.tileAnchorX+m*L.tileAnchorY)),S.push(L.featureIndex)}return T.sort((C,L)=>_[C]-_[L]||S[L]-S[C]),T}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let l=0;l<this.symbolInstances.length;++l)this.symbolInstanceIndexesSortedZOffset.push(l)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((l,h)=>this.symbolInstances.get(h).zOffset-this.symbolInstances.get(l).zOffset)}addToSortKeyRanges(l,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:S,leftJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:k}=m;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&S!==_&&this.addIndicesForPlacedSymbol(this.text,S),T>=0&&T!==S&&T!==_&&this.addIndicesForPlacedSymbol(this.text,T),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(l){const h=this.symbolInstances.get(this.text.symbolInstanceIndices[l]).elevationFeatureIndex;let m;return this.elevationFeatures&&h<this.elevationFeatures.length&&(m=this.elevationFeatures[h]),m}}function b4(d,l){return l.replace(/{([^{}]+)}/g,(h,m)=>m in d?String(d[m]):"")}let w4,S4,bP;li(P2,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),P2.addDynamicAttributes=ay;class T4{constructor(l){this.type=l.property.overrides?l.property.overrides.runtimeType:Yd,this.defaultValue=l}evaluate(l){if(l.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(l.formattedSection))return h.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}li(T4,"FormatSectionOverride",{omit:["defaultValue"]});const wP=()=>bP||(bP={layout:w4||(w4=new Kn({"symbol-placement":new Pe(Yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Pe(Yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pe(Yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ei(Yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pe(Yt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pe(Yt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Pe(Yt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Pe(Yt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pe(Yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pe(Yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pe(Yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ei(Yt.layout_symbol["icon-size"]),"icon-size-scale-range":new Pe(Yt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ei(Yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ei(Yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ei(Yt.layout_symbol["icon-image"]),"icon-image-use-theme":new Pe({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new ei(Yt.layout_symbol["icon-rotate"]),"icon-padding":new Pe(Yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Pe(Yt.layout_symbol["icon-keep-upright"]),"icon-offset":new ei(Yt.layout_symbol["icon-offset"]),"icon-anchor":new ei(Yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pe(Yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pe(Yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pe(Yt.layout_symbol["text-rotation-alignment"]),"text-field":new ei(Yt.layout_symbol["text-field"]),"text-font":new ei(Yt.layout_symbol["text-font"]),"text-size":new ei(Yt.layout_symbol["text-size"]),"text-size-scale-range":new Pe(Yt.layout_symbol["text-size-scale-range"]),"text-max-width":new ei(Yt.layout_symbol["text-max-width"]),"text-line-height":new ei(Yt.layout_symbol["text-line-height"]),"text-letter-spacing":new ei(Yt.layout_symbol["text-letter-spacing"]),"text-justify":new ei(Yt.layout_symbol["text-justify"]),"text-radial-offset":new ei(Yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pe(Yt.layout_symbol["text-variable-anchor"]),"text-anchor":new ei(Yt.layout_symbol["text-anchor"]),"text-max-angle":new Pe(Yt.layout_symbol["text-max-angle"]),"text-writing-mode":new Pe(Yt.layout_symbol["text-writing-mode"]),"text-rotate":new ei(Yt.layout_symbol["text-rotate"]),"text-padding":new Pe(Yt.layout_symbol["text-padding"]),"text-keep-upright":new Pe(Yt.layout_symbol["text-keep-upright"]),"text-transform":new ei(Yt.layout_symbol["text-transform"]),"text-offset":new ei(Yt.layout_symbol["text-offset"]),"text-allow-overlap":new Pe(Yt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pe(Yt.layout_symbol["text-ignore-placement"]),"text-optional":new Pe(Yt.layout_symbol["text-optional"]),visibility:new Pe(Yt.layout_symbol.visibility)})),paint:S4||(S4=new Kn({"icon-opacity":new ei(Yt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ei(Yt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ei(Yt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ei(Yt.paint_symbol["text-emissive-strength"]),"icon-color":new ei(Yt.paint_symbol["icon-color"]),"icon-halo-color":new ei(Yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ei(Yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ei(Yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Pe(Yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pe(Yt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Pe(Yt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ei(Yt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ei(Yt.paint_symbol["text-occlusion-opacity"]),"text-color":new ei(Yt.paint_symbol["text-color"],{runtimeType:Ss,getOverride:d=>d.textColor,hasOverride:d=>!!d.textColor}),"text-halo-color":new ei(Yt.paint_symbol["text-halo-color"]),"text-halo-width":new ei(Yt.paint_symbol["text-halo-width"]),"text-halo-blur":new ei(Yt.paint_symbol["text-halo-blur"]),"text-translate":new Pe(Yt.paint_symbol["text-translate"]),"text-translate-anchor":new Pe(Yt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pe(Yt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pe(Yt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pe(Yt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pe(Yt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ei(Yt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},bP);class L2 extends Ho{constructor(l,h,m,_){super(l,wP(),h,m,_,l.layout?l.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=D([]),this.hasOcclusionOpacityProperties=l.paint!==void 0&&("icon-occlusion-opacity"in l.paint||"text-occlusion-opacity"in l.paint)}_handleSpecialPaintPropertyUpdate(l){l!=="icon-occlusion-opacity"&&l!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(l,h){super.recalculate(l,h),this.appearances&&this.appearances.forEach(_=>{_.recalculate(l,h,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const m=this.layout.get("text-writing-mode");if(m){const _=[];for(const S of m)_.indexOf(S)<0&&_.push(S);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(l,h,m,_){return this._saturation===l&&this._contrast===h&&this._brightnessMin===m&&this._brightnessMax===_||(this._colorAdjustmentMatrix=function(S,T,C,L){S=Wn(S),T=Tn(T);const k=I(),F=S/3,V=1-2*F,U=[V,F,F,0,F,V,F,0,F,F,V,0,0,0,0,1],$=.5-.5*T,Z=L-C;return z(k,[Z,0,0,0,0,Z,0,0,0,0,Z,0,C,C,C,1],[T,0,0,0,0,T,0,0,0,0,T,0,$,$,$,1]),z(k,k,U),k}(l,h,m,_),this._saturation=l,this._contrast=h,this._brightnessMin=m,this._brightnessMax=_),this._colorAdjustmentMatrix}getValueAndResolveTokens(l,h,m,_){const S=this.layout.get(l).evaluate(h,{},m,_),T=this._unevaluatedLayout._values[l];return T.isDataDriven()||b_(T.value)||!S?S:b4(h.properties,S)}getAppearanceValueAndResolveTokens(l,h,m,_,S){const T=l.getProperty(h);if(!T)return;const C=T.evaluate(m,{},_,S),L=l.getUnevaluatedProperties()._values[h];return L.isDataDriven()||b_(L.value)||!C||typeof C!="string"?C:b4(m.properties,C)}createBucket(l){return new P2(l)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const l of wP().paint.overridableProperties){if(!L2.hasPaintOverride(this.layout,l))continue;const h=this.paint.get(l),m=new T4(h),_=new x_(m,h.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Eg("source",_):new Pc("composite",_,h.value.zoomStops,h.value.interpolationType),this.paint._values[l]=new Tl(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(l,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&L2.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,h){const m=l.get("text-field"),_=wP().paint.properties[h];let S=!1;const T=C=>{for(const L of C)if(_.overrides&&_.overrides.hasOverride(L))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Za)T(m.value.value.sections);else if(m.value.kind==="source"){const C=k=>{S||(k instanceof Hu&&Ha(k.value)===Rh?T(k.value.sections):k instanceof kh?T(k.sections):k.eachChild(C))},L=m.value;L._styleExpression&&C(L._styleExpression.expression)}return S}getProgramIds(){return["symbol"]}getDefaultProgramParams(l,h,m){return{config:new Yu(this,{zoom:h,lut:m}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let A4,I4,C4,M4;var SP=gr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function R2(d,l,h,m,_,S,T,C){const L=[d,l,1,h,m,1,_,S,1],k=[T,C,1],F=y([],L),[V,U,$]=Zt(k,k,F);return w(L,L,[V,0,0,0,U,0,0,0,$])}function E4(d,l,h,m,_,S,T,C){const L=function(k,F,V,U,$,Z,Q,et){const nt=R2(0,0,1,0,1,1,0,1),dt=R2(k,F,V,U,$,Z,Q,et);return w(dt,dt,y([],nt))}(d,l,h,m,_,S,T,C);return[L[2]/L[8]/Ve,L[5]/L[8]/Ve]}function k2(d){return[d[0],Math.min(Math.max(d[1],-wt),wt)]}class D4 extends Vu{constructor(l,h,m,_){super(),this.id=l,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(_),this.options=h,this._dirty=!1}load(l,h){if(this._loaded=h||!1,this.fire(new js("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return l&&(this.coordinates=l),this._loaded=!0,void this._finishLoading();this._imageRequest=ax(this.map._requestManager.transformRequest(this.url,Dh.Image),(m,_)=>{this._imageRequest=null,this._loaded=!0,m?this.fire(new lg(m)):_&&(this.image=_ instanceof HTMLImageElement?ws.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading())})}loaded(){return this._loaded}updateImage(l){return l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}setTexture(l){if(!(l.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new k1(this.map.painter.context,l.handle),this.width=l.dimensions[0],this.height=l.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new js("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(l){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof k1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(l){if(this.coordinates=l,this._boundsArray=void 0,this._unsupportedCoords=!1,!l.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let h=l[0][1],m=l[0][1];for(const S of l)S[1]>m&&(m=S[1]),S[1]<h&&(h=S[1]);const _=(m+h)/2;if(_>wt?this.onNorthPole=!0:_<-wt&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const S=l.map(qt.fromLngLat);this.tileID=function(T){let C=1/0,L=1/0,k=-1/0,F=-1/0;for(const Q of T)C=Math.min(C,Q.x),L=Math.min(L,Q.y),k=Math.max(k,Q.x),F=Math.max(F,Q.y);const V=Math.max(k-C,F-L),U=Math.max(0,Math.floor(-Math.log2(V))),$=Math.pow(2,U);let Z=Math.floor((C+k)/2*$);return Z>1&&(Z-=1),new Js(U,Z,Math.floor((L+F)/2*$))}(S),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new js("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof k1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(l){for(const nt in this.tiles){const dt=this.tiles[nt];dt.state!=="loaded"&&(dt.state="loaded",dt.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const h=H1(new Js(0,0,0),this.map.transform.projection),m=[h.projection.project(this.coordinates[0][0],this.coordinates[0][1]),h.projection.project(this.coordinates[1][0],this.coordinates[1][1]),h.projection.project(this.coordinates[2][0],this.coordinates[2][1]),h.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(nt){const dt=nt[1].x-nt[0].x,mt=nt[1].y-nt[0].y,yt=nt[2].x-nt[1].x,Lt=nt[2].y-nt[1].y,It=nt[3].x-nt[2].x,Ot=nt[3].y-nt[2].y,Ut=nt[0].x-nt[3].x,Ht=nt[0].y-nt[3].y,se=dt*Lt-yt*mt,Kt=yt*Ot-It*Lt,ue=It*Ht-Ut*Ot,me=Ut*mt-dt*Ht;return se>0&&Kt>0&&ue>0&&me>0||se<0&&Kt<0&&ue<0&&me<0}(m))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const _=H1(this.tileID,this.map.transform.projection),[S,T,C,L]=this.coordinates.map(nt=>{const dt=_.projection.project(nt[0],nt[1]);return g4(_,dt)._round()});this.perspectiveTransform=E4(S.x,S.y,T.x,T.y,C.x,C.y,L.x,L.y);const k=this._boundsArray=new wf;k.emplaceBack(S.x,S.y,0,0),k.emplaceBack(T.x,T.y,Ve,0),k.emplaceBack(L.x,L.y,0,Ve),k.emplaceBack(C.x,C.y,Ve,Ve),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=l.createVertexBuffer(k,SP.members),this.boundsSegments=Un.simpleSegment(0,0,4,2);const F=[],V=[k2((U=this.coordinates)[0]),k2(U[1]),k2(U[2]),k2(U[3])];var U;const[$,Z,Q,et]=function(nt){let dt=nt[0][0],mt=dt,yt=nt[0][1],Lt=yt;for(let It=1;It<nt.length;It++)nt[It][0]<dt?dt=nt[It][0]:nt[It][0]>mt&&(mt=nt[It][0]),nt[It][1]<yt?yt=nt[It][1]:nt[It][1]>Lt&&(Lt=nt[It][1]);return[dt,yt,mt-dt,Lt-yt]}(V);{const nt=new wf,[dt,mt,yt,Lt]=function(_e){let Ee=_e[0].x,ae=Ee,re=_e[0].y,Ie=re;for(let Re=1;Re<_e.length;Re++)_e[Re].x<Ee?Ee=_e[Re].x:_e[Re].x>ae&&(ae=_e[Re].x),_e[Re].y<re?re=_e[Re].y:_e[Re].y>Ie&&(Ie=_e[Re].y);return[Ee,re,ae-Ee,Ie-re]}(m),It=_e=>[(_e.x-dt)/yt,(_e.y-mt)/Lt],[Ot,Ut,Ht,se]=m.map(It),Kt=function(_e,Ee,ae,re,Ie,Re,we,si){const ci=R2(0,0,1,0,1,1,0,1);return w(ci,ci,y([],R2(_e,Ee,ae,re,Ie,Re,we,si)))}(Ot[0],Ot[1],Ut[0],Ut[1],Ht[0],Ht[1],se[0],se[1]);this.elevatedGlobePerspectiveTransform=E4(Ot[0],Ot[1],Ut[0],Ut[1],Ht[0],Ht[1],se[0],se[1]);const ue=(_e,Ee)=>{F.push(_e.lng);const ae=Math.round((_e.lng-$)/Q*Ve),re=Math.round((_e.lat-Z)/et*Ve),Ie=It(Ee),Re=Zt([],[Ie[0],Ie[1],1],Kt),we=Math.round(Re[0]/Re[2]*Ve),si=Math.round(Re[1]/Re[2]*Ve);nt.emplaceBack(ae,re,we,si)},me=m[3].x-m[0].x,Te=m[3].y-m[0].y,Be=m[2].x-m[1].x,De=m[2].y-m[1].y;for(let _e=0;_e<65;_e++){const Ee=_e/64,ae=[m[0].x+Ee*me,m[0].y+Ee*Te],re=[m[1].x+Ee*Be,m[1].y+Ee*De],Ie=re[0]-ae[0],Re=re[1]-ae[1];for(let we=0;we<65;we++){const si=we/64,ci={x:ae[0]+Ie*si,y:ae[1]+Re*si};ue(h.projection.unproject(ci.x,ci.y),ci)}}this.elevatedGlobeVertexBuffer=l.createVertexBuffer(nt,SP.members)}{this.maxLongitudeTriangleSize=0;let nt=[],dt=new Ln;const mt=(yt,Lt,It)=>{dt.emplaceBack(yt,Lt,It);const Ot=F[yt],Ut=F[Lt],Ht=F[It],se=Math.min(Math.min(Ot,Ut),Ht),Kt=Math.max(Math.max(Ot,Ut),Ht)-se;Kt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Kt),nt.push(se+Kt/2)};for(let yt=0;yt<64;yt++)for(let Lt=0;Lt<64;Lt++){const It=65*yt+Lt,Ot=It+1,Ut=It+65,Ht=Ut+1;mt(It,Ut,Ot),mt(Ot,Ut,Ht)}[nt,dt]=function(yt,Lt){const It=Array.from({length:yt.length},(Ht,se)=>se);It.sort((Ht,se)=>yt[Ht]-yt[se]);const Ot=[],Ut=new Ln;for(let Ht=0;Ht<It.length;Ht++){const se=It[Ht];Ot.push(yt[se]);const Kt=3*se,ue=Kt+1;Ut.emplaceBack(Lt.uint16[Kt],Lt.uint16[ue],Lt.uint16[ue+1])}return[Ot,Ut]}(nt,dt),this.elevatedGlobeTrianglesCenterLongitudes=nt,this.elevatedGlobeIndexBuffer=l.createIndexBuffer(dt)}this.elevatedGlobeSegments=Un.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Q/Ve,0,et/Ve,0,0,Z,$,0])}prepare(){const l=Object.keys(this.tiles).length!==0;if(this.tileID&&!l)return;const h=this.map.painter.context,m=h.gl;!this._dirty||this.texture instanceof k1||(this.texture?this.texture.update(this.image):(this.texture=new XD(h,this.image,m.RGBA8),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this._dirty=!1),l&&this._prepareData(h)}loadTile(l,h){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},h(null)):(l.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(l){const h=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!h)return null;const m=this.elevatedGlobeTrianglesCenterLongitudes;let _=(S=l+180)+360*Math.round((m[0]-S)/360);var S;const T=new Un,C=(V,U)=>{T.segments.push({vertexOffset:0,primitiveOffset:V,vertexLength:h.segments[0].vertexLength,primitiveLength:U,sortKey:void 0,vaos:{}})},L=.51*this.maxLongitudeTriangleSize;if(Math.abs(m[0]-_)<=L){const V=Sr(m,0,m.length,_+L);return V===m.length||C(V,en(m,V+1,m.length,_+360-L)-V),T}_<m[0]&&(_+=360);const k=en(m,0,m.length,_-L);if(k===m.length)return C(0,m.length),T;C(0,k-0);const F=Sr(m,k+1,m.length,_+L);return F!==m.length&&C(F,m.length-F),T}}const Pot=(Math.pow(256,2)-1)/16907520;class P4 extends Ho{constructor(l,h,m,_){super(l,{layout:C4||(C4=new Kn({visibility:new Pe(Yt.layout_raster.visibility)})),paint:M4||(M4=new Kn({"raster-opacity":new Pe(Yt.paint_raster["raster-opacity"]),"raster-color":new vf(Yt.paint_raster["raster-color"]),"raster-color-mix":new Pe(Yt.paint_raster["raster-color-mix"]),"raster-color-range":new Pe(Yt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pe(Yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pe(Yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pe(Yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Pe(Yt.paint_raster["raster-saturation"]),"raster-contrast":new Pe(Yt.paint_raster["raster-contrast"]),"raster-resampling":new Pe(Yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Pe(Yt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pe(Yt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pe(Yt.paint_raster["raster-array-band"]),"raster-elevation":new Pe(Yt.paint_raster["raster-elevation"]),"raster-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},h,m,_),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(l){return!(l&&l._source instanceof D4&&(l._source.onNorthPole||l._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(l){l!=="raster-color"&&l!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(l){if(!this.hasColorMap()||!this._curRampRange)return;const h=this._transitionablePaint._values["raster-color"].value.expression,[m,_]=l||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(m)&&isNaN(_)||m===this._curRampRange[0]&&_===this._curRampRange[1]||(this.colorRamp=y1({expression:h,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:m,end:_}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[m,_])}}let L4,R4,k4,O4,z4;class B4 extends Ho{constructor(l,h,m,_){super(l,{layout:L4||(L4=new Kn({visibility:new Pe(Yt["layout_raster-particle"].visibility)})),paint:R4||(R4=new Kn({"raster-particle-array-band":new Pe(Yt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pe(Yt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new vf(Yt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pe(Yt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pe(Yt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pe(Yt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pe(Yt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pe(Yt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},h,m,_),this._updateColorRamp(),this.lastInvalidatedAt=ws.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(l){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(l){return!1}_handleSpecialPaintPropertyUpdate(l){l!=="raster-particle-color"&&l!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),l==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const l=this._transitionablePaint._values["raster-particle-color"].value.expression,h=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=y1({expression:l,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:h}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ws.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Lot extends Ho{constructor(l,h){super(l,{},h,null),this.implementation=l,l.slot&&(this.slot=l.slot)}is3D(l){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(l){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)}onRemove(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)}}function TP(d,l,h){const m=[0,0,1],_=xr([]);return zn(_,_,h?-wr(d)+Math.PI:wr(d)),tn(_,_,-wr(l)),ge(m,m,_),xe(m,m)}const F4={None:0,Model:1,Symbol:2,FillExtrusion:4};class O2{constructor(l,h,m,_){this.message=(l?`${l}: `:"")+m,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function AP(d,l){const h=d.indexOf("://")===-1;try{return new URL(d,h&&l?"http://example.com":void 0),!0}catch{return!1}}class N4{constructor(l,h){this.feature=l,this.instancedDataOffset=h,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class V4{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new z_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(l){const h=16*l,m=this.instancedDataArray.float32;let _=Math.floor(m[h+2]);const S=1.05*(m[h+2]-_);return _/=100,[m[h]%1*1.05,m[h+1]%1*1.05,S,_]}tileCoordinatesForInstance(l){const h=16*l,m=this.instancedDataArray.float32;let _=m[h+0];return _=_>Ve?_-Ve:_,new Me(Math.trunc(_),Math.trunc(m[h+1]))}translationForInstance(l){const h=16*l,m=this.instancedDataArray.float32;return[m[h+4],m[h+5],m[h+6]]}rotationScaleForInstance(l){const h=16*l,m=this.instancedDataArray.float32;return[m[h+7],m[h+8],m[h+9],m[h+10],m[h+11],m[h+12],m[h+13],m[h+14],m[h+15]]}transformForInstance(l){const h=16*l,m=this.instancedDataArray.float32;return[m[h+7],m[h+8],m[h+9],m[h+4],m[h+10],m[h+11],m[h+12],m[h+5],m[h+13],m[h+14],m[h+15],m[h+6],0,0,0,1]}}class IP{constructor(l){this.zoom=l.zoom,this.canonical=l.canonical,this.overscaledZ=this.canonical.z+Math.log2(l.overscaling),this.layers=l.layers,this.layerIds=this.layers.map(h=>h.fqid),this.projection=l.projection,this.index=l.index,this.worldview=l.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=l.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(l,h){}updateAppearances(l,h,m,_){}populate(l,h,m,_){this.tileToMeter=kt(m);const S=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:T,id:C,index:L,sourceLayerIndex:k}of l){const F=C??(T.properties&&T.properties.hasOwnProperty("id")?T.properties.id:void 0),V=ee(T,S);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom,{worldview:this.worldview,activeFloors:h.activeFloors}),V,m))continue;const U={id:F,sourceLayerIndex:k,index:L,geometry:S?V.geometry:pe(T,m,_),properties:T.properties,type:T.type,patterns:{}},$=this.addFeature(U,U.geometry,V);$&&h.featureIndex.insert(T,U.geometry,L,k,this.index,this.instancesPerModel[$].instancedDataArray.length,Ve/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const l=this.layers[0].modelManager,h=this.layers[0].scope;let m=0;for(const _ of this.modelUris){const S=l.getModel(_,h);if(!S)continue;const T=this.instancesPerModel[_];if(T){const C=.5*bi(S.aabb.max,S.aabb.min)*T.maxScale+T.maxXYTranslationDistance,L=Math.min(Ve,Math.max(C/this.tileToMeter,Ve/32));m=Math.max(L,m)}}return m}update(l,h,m,_){for(const S in this.instancesPerModel){const T=this.instancesPerModel[S];for(const C in l)T.idToFeaturesIndex.hasOwnProperty(C)&&(this.evaluate(T.features[T.idToFeaturesIndex[C]],l[C],T,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let l=!1;for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];for(const _ of m.features){const S=this.layers[0],T=_.feature,C=this.canonical,L=S.paint.get("model-rotation").evaluate(T,{},C),k=S.paint.get("model-scale").evaluate(T,{},C),F=S.paint.get("model-translation").evaluate(T,{},C);He(_.rotation,L)&&He(_.scale,k)&&He(_.translation,F)||(this.evaluate(_,_.featureStates,m,!0),l=!0)}}return l}updateReplacement(l,h,m,_){if(h.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=h.updateTime;const S=h.getReplacementRegionsForTile(l.toUnwrapped(),!0);if(a2(this.activeReplacements,S))return!1;this.activeReplacements=S;let T=!1;for(const C in this.instancesPerModel){const L=this.instancesPerModel[C],k=L.instancedDataArray;for(const F of L.features){const V=F.instancedDataOffset,U=F.instancedDataCount;for(let $=0;$<U;$++){const Z=16*($+V);let Q=k.float32[Z+0];const et=Q>Ve;Q=et?Q-Ve:Q;const nt=Math.floor(Q),dt=Math.floor(k.float32[Z+1]);let mt=!1;for(const yt of this.activeReplacements)if(!A5(yt,m,F4.Model,_)&&!(yt.min.x>nt||nt>yt.max.x||yt.min.y>dt||dt>yt.max.y)&&(mt=BD(E5(nt,dt,l.canonical,yt.footprintTileId.canonical),yt.footprint),mt))break;k.float32[Z]=mt?Q+Ve:Q,T=T||mt!==et}}}return T}isEmpty(){for(const l in this.instancesPerModel)if(this.instancesPerModel[l].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(l){if(!this.uploaded)for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];m.instancedDataArray.length<0||m.instancedDataArray.length===0||(m.instancedDataBuffer?m.instancedDataBuffer.updateData(m.instancedDataArray):m.instancedDataBuffer=l.createVertexBuffer(m.instancedDataArray,aat.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const h in this.instancesPerModel){const m=this.instancesPerModel[h];m.instancedDataArray.length!==0&&m.instancedDataBuffer&&m.instancedDataBuffer.destroy()}const l=this.layers[0].modelManager;if(l&&this.modelUris&&this.modelsRequested)for(const h of this.modelUris)l.removeModel(h,"",!0)}addFeature(l,h,m){const _=this.layers[0],S=_.layout.get("model-id").evaluate(m,{},this.canonical);if(!S)return Mi(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),S;(AP(S,!1)||this.styleDefinedModelURLs[S]!==void 0)&&(this.modelUris.includes(S)||this.modelUris.push(S)),this.instancesPerModel[S]||(this.instancesPerModel[S]=new V4);const T=this.instancesPerModel[S],C=T.instancedDataArray,L=new N4(m,C.length);for(const k of h)for(const F of k){if(F.x<0||F.x>=Ve||F.y<0||F.y>=Ve)continue;if(this.lookupDim!==0){const U=(this.lookupDim-1)/Ve,$=this.lookupDim*(F.y*U|0)+F.x*U|0;if(this.lookup){if(this.lookup[$]!==0)continue;this.lookup[$]=1}}this.instanceCount++;const V=C.length;C.resize(V+1),T.instancesEvaluatedElevation.push(0),C.float32[16*V]=F.x,C.float32[16*V+1]=F.y}return L.instancedDataCount=T.instancedDataArray.length-L.instancedDataOffset,L.instancedDataCount>0&&(l.id&&(T.idToFeaturesIndex[l.id]=T.features.length),T.features.push(L),this.evaluate(L,{},T,!1)),S}getModelUris(){return this.modelUris}evaluate(l,h,m,_){const S=this.layers[0],T=l.feature,C=this.canonical,L=l.rotation=S.paint.get("model-rotation").evaluate(T,h,C),k=l.scale=S.paint.get("model-scale").evaluate(T,h,C),F=l.translation=S.paint.get("model-translation").evaluate(T,h,C),V=Object.assign({},S.paint.get("model-color").evaluate(T,h,C));V.a=S.paint.get("model-color-mix-intensity").evaluate(T,h,C);const U=[];this.maxVerticalOffset<F[2]&&(this.maxVerticalOffset=F[2]);const $=F[0]*F[0]+F[1]*F[1],Z=$>0?Math.sqrt($):0;m.maxScale=Math.max(Math.max(m.maxScale,k[0]),Math.max(k[1],k[2])),m.maxXYTranslationDistance=Math.max(m.maxXYTranslationDistance,Z),this.maxScale=Math.max(Math.max(this.maxScale,k[0]),Math.max(k[1],k[2])),gV(U,L,k);const Q=Math.round(100*V.a)+V.b/1.05;for(let et=0;et<l.instancedDataCount;++et){const nt=l.instancedDataOffset+et,dt=16*nt,mt=m.instancedDataArray.float32;let yt=0;_&&(yt=mt[dt+6]-m.instancesEvaluatedElevation[nt]);const Lt=0|mt[dt+1];mt[dt]=(0|mt[dt])+V.r/1.05,mt[dt+1]=Lt+V.g/1.05,mt[dt+2]=Q,mt[dt+3]=1/(C.z>10?this.tileToMeter:kt(C,Lt)),mt[dt+4]=F[0],mt[dt+5]=F[1],mt[dt+6]=F[2]+yt,mt[dt+7]=U[0],mt[dt+8]=U[1],mt[dt+9]=U[2],mt[dt+10]=U[4],mt[dt+11]=U[5],mt[dt+12]=U[6],mt[dt+13]=U[8],mt[dt+14]=U[9],mt[dt+15]=U[10],m.instancesEvaluatedElevation[nt]=F[2]}}}let U4,G4;li(IP,"ModelBucket",{omit:["layers"]}),li(V4,"PerModelAttributes"),li(N4,"ModelFeature");class oy{constructor(l,h,m){this._demTile=l,this._dem=this._demTile.dem,this._scale=h,this._offset=m}static create(l,h,m){const _=m||l.findDEMTileFor(h);if(!_||!_.dem)return;const S=_.dem,T=_.tileID,C=1<<h.canonical.z-T.canonical.z;return new oy(_,S.dim/Ve/C,[(h.canonical.x/C-T.canonical.x)*S.dim,(h.canonical.y/C-T.canonical.y)*S.dim])}tileCoordToPixel(l,h){const m=h*this._scale+this._offset[1];return new Me(Math.floor(l*this._scale+this._offset[0]),Math.floor(m))}getElevationAt(l,h,m,_){const S=l*this._scale+this._offset[0],T=h*this._scale+this._offset[1],C=Math.floor(S),L=Math.floor(T),k=this._dem;return _=!!_,m?zi(zi(k.get(C,L,_),k.get(C,L+1,_),T-L),zi(k.get(C+1,L,_),k.get(C+1,L+1,_),T-L),S-C):k.get(C,L,_)}getElevationAtPixel(l,h,m){return this._dem.get(l,h,!!m)}getMeterToDEM(l){return(1<<this._demTile.tileID.canonical.z)*gt(1,l)*this._dem.stride}}const CP=new Float32Array(262144),Zg=new Uint8Array(262144);function H4(d){let l=0;if(d.meshes)for(const h of d.meshes)l=Math.max(l,h.aabb.max[2]);if(d.children)for(const h of d.children)l=Math.max(l,H4(h));return l}function j4(d,l,h){if(d.meshes)for(const m of d.meshes){if(m.aabb.min[0]===1/0)continue;const _=ur.applyTransform(m.aabb,d.globalMatrix);h.insert(l,_.min[0],_.min[1],_.max[0],_.max[1])}if(d.children)for(const m of d.children)j4(m,l,h)}const W4=["","wall","door","roof","window","lamp","logo"];class $4{constructor(l){this.node=l,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:l.id,geometry:[],properties:{height:H4(l)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let l=0;const h=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const m of this.node.meshes)this.node.lightMeshIndex!==l&&(m.transformedAabb=ur.applyTransformFast(m.aabb,this.node.globalMatrix),h.encapsulate(m.transformedAabb)),l++;this.aabb=h}return this.aabb}}class z2{constructor(l,h,m,_,S,T,C,L){this.id=m,this.layers=l,this.layerIds=this.layers.map(k=>k.fqid),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.modelTraits|=K_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,_&&(this.modelTraits|=K_.HasMapboxMeshFeatures),S&&(this.modelTraits|=K_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=T,this.worldview=L,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const k of h)this.nodesInfo.push(new $4(k)),j4(k,C.featureIndexArray.length,C.grid),C.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,C.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(l,h){for(const m of this.getNodesInfo()){const _=m.node;_.footprint&&h.push({footprint:_.footprint,id:l})}}updateAppearances(l,h,m,_){}update(l){const h=Object.keys(l).length!==0;if(h&&!this.stateDependentLayers.length)return;const m=h?this.stateDependentLayers:this.layers;if(!Fu(l,this.states))for(const _ of m)this.evaluate(_,l);this.states=structuredClone(l)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(l){if(!this.needsUpload)return;const h=this.getNodesInfo();for(const m of h){const _=m.node;this.uploaded?this.updatePbrBuffer(_):JD(_,l,!0)}for(const m of h)v2(m.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(l){let h=!1;if(!l.meshes)return h;for(const m of l.meshes)m.pbrBuffer&&(m.pbrBuffer.updateData(m.featureArray),h=!0);return h}needsReEvaluation(l,h,m){const _=l.transform.projectionOptions,S=l.style.getBrightness(),T=this.brightness!==S;if(!this.uploaded||this.dirty||_.name!==this.projection.name||K1(m.paint.get("model-color").value,T)||K1(m.paint.get("model-color-mix-intensity").value,T)||K1(m.paint.get("model-roughness").value,T)||K1(m.paint.get("model-emissive-strength").value,T)||K1(m.paint.get("model-height-based-emissive-strength-multiplier").value,T)){this.projection=_,this.brightness=S;const C=this.getNodesInfo();for(const L of C)L.state=null;return!0}return!1}evaluateTransform(l,h){if(l.transform.zoom===this.zoom)return;this.zoom=l.transform.zoom;const m=this.getNodesInfo(),_=this.id.canonical;for(const S of m){const T=S.feature;S.evaluatedTranslation=h.paint.get("model-translation").evaluate(T,{},_),S.evaluatedScale=h.paint.get("model-scale").evaluate(T,{},_)}}evaluate(l,h){const m=this.getNodesInfo();for(const _ of m){if(!_.node.meshes)continue;const S=_.feature,T=h&&h[S.id];if(Fu(T,_.state))continue;_.state=structuredClone(T);const C=_.node.meshes&&_.node.meshes[0].featureData,L=_.evaluatedColor[2],k=_.evaluatedRMEA[2],F=this.id.canonical;if(_.hasTranslucentParts=!1,C){for(let V=0;V<W4.length;V++){const U=W4[V];U.length&&(S.properties.part=U);const $=l.paint.get("model-color").evaluate(S,T,F).toPremultipliedRenderColor(null),Z=l.paint.get("model-color-mix-intensity").evaluate(S,T,F);_.evaluatedColor[V]=[$.r,$.g,$.b,Z],_.evaluatedRMEA[V][0]=l.paint.get("model-roughness").evaluate(S,T,F),_.evaluatedRMEA[V][2]=l.paint.get("model-emissive-strength").evaluate(S,T,F),_.evaluatedRMEA[V][3]=$.a,_.emissionHeightBasedParams[V]=l.paint.get("model-height-based-emissive-strength-multiplier").evaluate(S,T,F),!_.hasTranslucentParts&&$.a<1&&(_.hasTranslucentParts=!0)}delete S.properties.part,kot(_,L!==_.evaluatedColor[2]||k!==_.evaluatedRMEA[2],this.modelTraits)}else _.evaluatedRMEA[0][2]=l.paint.get("model-emissive-strength").evaluate(S,T,F);_.evaluatedTranslation=l.paint.get("model-translation").evaluate(S,T,F),_.evaluatedScale=l.paint.get("model-scale").evaluate(S,T,F),this.updatePbrBuffer(_.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(l,h,m,_){const S=l.findDEMTileFor(m);if(S&&(S.tileID.canonical!==this.terrainTile||h!==this.terrainExaggeration)){if(S.dem&&S.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=S.tileID.overscaledZ;const T=oy.create(l,m,S);if(!T)return;this.modelTraits&K_.HasMapboxMeshFeatures&&this.updateDEM(l,T,m,_);for(const C of this.getNodesInfo()){const L=C.node;if(!L.footprint||!L.footprint.vertices||!L.footprint.vertices.length)continue;const k=L.footprint.vertices;let F=T.getElevationAt(k[0].x,k[0].y,!0,!0);for(let V=1;V<k.length;V++)F=Math.min(F,T.getElevationAt(k[V].x,k[V].y,!0,!0));L.elevation=F}}this.terrainTile=S.tileID.canonical,this.terrainExaggeration=h}}updateDEM(l,h,m,_){let S=h._dem._modifiedForSources[_];if(S===void 0&&(h._dem._modifiedForSources[_]=[],S=h._dem._modifiedForSources[_]),S.includes(m.canonical))return;const T=h._dem.dim;S.push(m.canonical);let C=!1;for(const L of this.getNodesInfo()){const k=L.node;if(!k.footprint||!k.footprint.grid)continue;const F=k.footprint.grid,V=h.tileCoordToPixel(F.min.x,F.min.y),U=h.tileCoordToPixel(F.max.x,F.max.y),$=Math.min(Math.min(T-U.y,V.x),Math.min(V.y,T-U.x));if($<0)continue;const Z=lt($,2,5);let Q=Math.max(0,V.x-Z),et=Math.max(0,V.y-Z),nt=Math.min(U.x+Z,T-1),dt=Math.min(U.y+Z,T-1);for(let It=et;It<=dt;++It)for(let Ot=Q;Ot<=nt;++Ot)Zg[It*T+Ot]=255;let mt=0,yt=0;for(let It=0;It<F.cellsY;++It)for(let Ot=0;Ot<F.cellsX;++Ot){if(!F.cells[It*F.cellsX+Ot])continue;const Ut=h.tileCoordToPixel(F.min.x+Ot/F.xScale,F.min.y+It/F.yScale),Ht=h.tileCoordToPixel(F.min.x+(Ot+1)/F.xScale,F.min.y+(It+1)/F.yScale);for(let se=Ut.y;se<=Math.min(Ht.y+1,T-1);++se)for(let Kt=Ut.x;Kt<=Math.min(Ht.x+1,T-1);++Kt)Zg[se*T+Kt]===255&&(Zg[se*T+Kt]=0,mt+=h.getElevationAtPixel(Kt,se),yt++)}const Lt=mt/yt;Q=Math.max(1,V.x-Z),et=Math.max(1,V.y-Z),nt=Math.min(U.x+Z,T-2),dt=Math.min(U.y+Z,T-2),C=!0;for(let It=et;It<=dt;++It)for(let Ot=Q;Ot<=nt;++Ot)Zg[It*T+Ot]===0&&(CP[It*T+Ot]=h._dem.set(Ot,It,Lt));for(let It=1;It<Z;++It){Q=Math.max(1,V.x-It),et=Math.max(1,V.y-It),nt=Math.min(U.x+It,T-2),dt=Math.min(U.y+It,T-2);for(let Ot=et;Ot<=dt;++Ot)for(let Ut=Q;Ut<=nt;++Ut){const Ht=Ot*T+Ut;if(Zg[Ht]===255){let se=0,Kt=0,ue=-1,me=-1;for(let Te=-1;Te<=1;++Te)for(let Be=-1;Be<=1;++Be){const De=(Ot+Te)*T+Ut+Be;if(Zg[De]>=It)continue;const _e=CP[De],Ee=Math.abs(_e);Ee>Kt&&(se=_e,Kt=Ee,ue=Be,me=Te)}if(Kt>.1){const Te=1-(It+.5*Math.abs(ue*me))/Z;let Be=h._dem.get(Ut,Ot)+se*Te;const De=h._dem.get(Ut+ue,Ot+me),_e=h._dem.get(Ut-ue,Ot-me,!0);(Be-De)*(Be-_e)>0&&(Be=(De+_e)/2),CP[Ht]=h._dem.set(Ut,Ot,Be),Zg[Ht]=It}}}}}C&&(h._demTile.needsDEMTextureUpload=!0,h._dem._timestamp=ws.now())}setFilter(l){this.filter=l?C_(l):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(l=>this.filter.filter(new xn(this.id.overscaledZ,{worldview:this.worldview}),l.feature,this.id.canonical)):this.nodesInfo}destroy(){const l=this.getNodesInfo();for(const h of l)v2(h.node),QD(h.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(l,h){if(h.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=h.updateTime;const m=h.getReplacementRegionsForTile(l.toUnwrapped());for(const _ of this.getNodesInfo()){const S=_.node.footprint;_.hiddenByReplacement=!!S&&!m.find(T=>T.footprint===S)}}getHeightAtTileCoord(l,h){const m=[],_=[0,0,0],S=D([]);for(const T of this.getNodesInfo()){const C=T.node.meshes[0],L=C.transformedAabb;if(l<L.min[0]||h<L.min[1]||l>L.max[0]||h>L.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};R(S,T.node.globalMatrix),_[0]=l,_[1]=h,Bt(_,_,S);const k=(_[0]-C.aabb.min[0])/(C.aabb.max[0]-C.aabb.min[0])*jg|0,F=Math.min(63,(_[1]-C.aabb.min[1])/(C.aabb.max[1]-C.aabb.min[1])*jg|0)*jg+Math.min(63,k),V=C.heightmap[F];if(!(V<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:V,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new Me(l,h),new Me(l,h),m),m.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function K1(d,l){return d instanceof Eg&&!d.isLightConstant&&l}function Rot(d,l,h,m,_,S,T,C){let L=(61440&l|(61440&l)>>4)>>8,k=(3840&l|(3840&l)>>4)>>4,F=240&l|(240&l)>>4;h[3]>0&&(L=zi(L,255*h[0],h[3]),k=zi(k,255*h[1],h[3]),F=zi(F,255*h[2],h[3]));const V=L<<8|k,U=F<<8|Math.floor(255*m[3]),$=function(It){const Ot=lt(It,0,2);return Math.min(Math.round(.5*Ot*255),255)}(m[2])<<8|15*m[0]<<4|15*m[1],Z=lt(_[0],0,1),Q=lt(_[1],0,1),et=lt(_[2],0,1),nt=lt(_[3],0,1);let dt,mt,yt,Lt;if(Z!==Q&&T!==S&&Q!==Z){const It=T-S;mt=1/(It*(Q-Z)),yt=-(S+It*Z)/(It*(Q-Z));const Ot=lt(_[4],-1,1);Lt=Math.pow(10,Ot),dt=255*et<<8|255*nt}else dt=65535,mt=0,yt=1,Lt=1;if(d.emplaceBack(V,U,$,dt,mt,yt,Lt),C){const It=C.length;C.clear();for(let Ot=0;Ot<It;Ot++)C.emplaceBack(V,U,$,dt,mt,yt,Lt)}}function kot(d,l,h){const m=d.node;let _=0;const S=h&K_.HasMeshoptCompression;for(const T of m.meshes){if(m.lights&&m.lightMeshIndex===_||!T.featureData)continue;T.featureArray=new Cf,T.featureArray.reserve(T.featureData.length);let C=l;for(const L of T.featureData){const k=S?65535&L:L>>16&65535,F=S?L>>16&65535:65535&L,V=(15&F)<8?15&F:0,U=d.evaluatedRMEA[V],$=d.evaluatedColor[V],Z=d.emissionHeightBasedParams[V];let Q;if(C&&V===2&&m.lights&&(Q=new Cf,Q.resize(10*m.lights.length)),Rot(T.featureArray,k,$,U,Z,T.aabb.min[2],T.aabb.max[2],Q),Q&&C){C=!1;const et=m.meshes[m.lightMeshIndex];et.featureArray=Q,et.featureArray._trim()}}T.featureArray._trim(),_++}}li(z2,"Tiled3dModelBucket",{omit:["layers"]}),li($4,"Tiled3dModelFeature");const Oot=["id","tile","layer","source","sourceLayer","state"];class qg{constructor(l,h,m,_,S){this.type="Feature",this._vectorTileFeature=l,this._z=h,this._x=m,this._y=_,this.properties=l?l.properties:{},this.id=S}clone(){const l=new qg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(l.state=Object.assign({},this.state)),this.layer&&(l.layer=Object.assign({},this.layer)),this.source&&(l.source=this.source),this.sourceLayer&&(l.sourceLayer=this.sourceLayer),l}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const h of Oot)this[h]!==void 0&&(l[h]=this[h]);return l}}class Xg extends Vu{constructor(l,h,m,_){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=h,this._modelsInfo=new Map}load(){const l=[];for(const h in this._options.models){const m=this._options.models[h],_=this._modelsInfo.get(h);if(_){const S=_.model;S.position=m.position!=null?new X(m.position[0],m.position[1]):new X(0,0),S.orientation=m.orientation!=null?m.orientation:[0,0,0],_.modelSpec=m,Xg.applyModelSpecification(S,m),S.computeBoundsAndApplyParent(),this.models.push(S)}else{const S=hV(this.map._requestManager.transformRequest(m.uri,Dh.Model).url).then(T=>{if(!T)return;const C=eP(T),L=new mV(h,m.uri,m.position,m.orientation,C);Xg.applyModelSpecification(L,m),L.computeBoundsAndApplyParent(),this.models.push(L),this._modelsInfo.set(h,{modelSpec:m,model:L})}).catch(T=>{this.fire(new lg(new Error(`Could not load model ${h} from ${m.uri}: ${T.message}`)))});l.push(S)}}Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new js("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(h=>{this._loaded=!0,this.fire(new lg(new Error(`Could not load models: ${h.message}`)))})}static applyModelSpecification(l,h){h.nodeOverrides&&Xg.convertNodeOverrides(l,h.nodeOverrides),h.materialOverrides&&Xg.convertMaterialOverrides(l,h.materialOverrides),h.nodeOverrideNames&&(l.nodeOverrideNames=[...h.nodeOverrideNames]),h.materialOverrideNames&&(l.materialOverrideNames=[...h.materialOverrideNames]),h.featureProperties&&(l.featureProperties=h.featureProperties)}static convertNodeOverrides(l,h){if(Array.isArray(h)&&h.every(m=>typeof m=="string")){l.nodeOverrideNames=[];for(const m of h)l.nodeOverrideNames.push(m)}else Object.entries(h).forEach(([m,_])=>{const S={orientation:[0,0,0]};if(_.hasOwnProperty("orientation")){const T=_.orientation;T&&(S.orientation=T)}l.nodeOverrides.set(m,S)})}static convertMaterialOverrides(l,h){if(Array.isArray(h)&&h.every(m=>typeof m=="string")){l.materialOverrideNames=[];for(const m of h)l.materialOverrideNames.push(m)}else Object.entries(h).forEach(([m,_])=>{const S={color:new Xr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},T=_["model-color"];T!==void 0&&(S.color.r=T[0],S.color.g=T[1],S.color.b=T[2]);const C=_["model-color-mix-intensity"];C!==void 0&&(S.colorMix=C);const L=_["model-emissive-strength"];L!==void 0&&(S.emissionStrength=L);const k=_["model-opacity"];k!==void 0&&(S.opacity=k),l.materialOverrides.set(m,S)})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,h){}serialize(){return this._options}setProperty(l,h){return!1}reload(){const l=Hh(this.id,this.scope);this.map.style.clearSource(l),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(l){this.models=[];const h=new Map;for(const m in l){const _=l[m];if(this._modelsInfo.has(m)){const S=this._modelsInfo.get(m);S&&S.modelSpec.uri===_.uri&&h.set(m,S)}}this._modelsInfo=h,this._options.models=l,this._loaded=!1,this.load()}}function MP(d,l,h,m){const _=1<<d.z;l.lat=vt((m/Ve+d.y)/_),l.lng=xt((h/Ve+d.x)/_)}function zot(d,l,h,m){const _=d.getNodesInfo()[l];if(!_||_.hiddenByReplacement||!_.node.meshes)return;let S=Number.MAX_VALUE;const T=_.node,C=h.tile,L=m.calculatePosMatrix(C.tileID.toUnwrapped(),m.worldSize),k=_.evaluatedScale;let F=0;m.elevation&&T.elevation&&(F=T.elevation*m.elevation.exaggeration()),N(L,L,[(T.anchor?T.anchor[0]:0)*(k[0]-1),(T.anchor?T.anchor[1]:0)*(k[1]-1),F]),H(L,L,k);const V=h.queryGeometry,U=V.isPointQuery()?V.screenBounds:V.screenGeometry,$=function(Q){const et=z([],L,Q.globalMatrix);z(et,m.expandedFarZProjMatrix,et);for(let nt=0;nt<Q.meshes.length;++nt){const dt=Q.meshes[nt];if(nt===Q.lightMeshIndex)continue;const mt=KD(U,m,et,dt.aabb);mt!=null&&(S=Math.min(mt,S))}if(Q.children)for(const nt of Q.children)$(nt)};if($(T),S===Number.MAX_VALUE)return;const Z=new X(0,0);return MP(C.tileID.canonical,Z,_.node.anchor[0],_.node.anchor[1]),{intersectionZ:S,position:Z,feature:_.feature}}const Bot={circle:class extends Ho{constructor(d,l,h,m){super(d,{layout:Ku||(Ku=new Kn({"circle-sort-key":new ei(Yt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Pe(Yt.layout_circle["circle-elevation-reference"]),visibility:new Pe(Yt.layout_circle.visibility)})),paint:Df||(Df=new Kn({"circle-radius":new ei(Yt.paint_circle["circle-radius"]),"circle-color":new ei(Yt.paint_circle["circle-color"]),"circle-blur":new ei(Yt.paint_circle["circle-blur"]),"circle-opacity":new ei(Yt.paint_circle["circle-opacity"]),"circle-translate":new Pe(Yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Pe(Yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pe(Yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pe(Yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ei(Yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ei(Yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ei(Yt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pe(Yt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}createBucket(d){return new Bn(d)}queryRadius(d){const l=d;return Xa("circle-radius",this,l)+Xa("circle-stroke-width",this,l)+Zn(this.paint.get("circle-translate"))}queryIntersectsFeature(d,l,h,m,_,S,T,C){const L=Ef(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h);return JN(d,m,S,T,C,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,k)}getProgramIds(){return["circle"]}getDefaultProgramParams(d,l,h){const m=KN(this);return{config:new Yu(this,{zoom:l,lut:h}),defines:m,overrideFog:!1}}is3D(d){return!d&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ho{createBucket(d){return new t5(d)}constructor(d,l,h,m){super(d,{layout:e5||(e5=new Kn({visibility:new Pe(Yt.layout_heatmap.visibility)})),paint:i5||(i5=new Kn({"heatmap-radius":new ei(Yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ei(Yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pe(Yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vf(Yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pe(Yt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(d){d==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=y1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(d){return Xa("heatmap-radius",this,d)}queryIntersectsFeature(d,l,h,m,_,S,T,C){const L=this.paint.get("heatmap-radius").evaluate(l,h);return JN(d,m,S,T,C,!0,!0,new Me(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(d,l,h){return d==="heatmap"?{config:new Yu(this,{zoom:l,lut:h}),overrideFog:!1}:{}}},hillshade:class extends Ho{constructor(d,l,h,m){super(d,{layout:r5||(r5=new Kn({visibility:new Pe(Yt.layout_hillshade.visibility)})),paint:n5||(n5=new Kn({"hillshade-illumination-direction":new Pe(Yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pe(Yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pe(Yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pe(Yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pe(Yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pe(Yt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pe(Yt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(d,l,h){return{overrideFog:!1}}},fill:class extends Ho{constructor(d,l,h,m){super(d,{layout:y5||(y5=new Kn({"fill-sort-key":new ei(Yt.layout_fill["fill-sort-key"]),visibility:new Pe(Yt.layout_fill.visibility),"fill-elevation-reference":new Pe(Yt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ei(Yt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:x5||(x5=new Kn({"fill-antialias":new Pe(Yt.paint_fill["fill-antialias"]),"fill-opacity":new ei(Yt.paint_fill["fill-opacity"]),"fill-color":new ei(Yt.paint_fill["fill-color"]),"fill-outline-color":new ei(Yt.paint_fill["fill-outline-color"]),"fill-translate":new Pe(Yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Pe(Yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ei(Yt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Pe(Yt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Pe(Yt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ei(Yt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ei(Yt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ei(Yt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}getProgramIds(){const d=this.paint.get("fill-pattern"),l=d&&d.constantOr(1),h=[l?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&h.push(l&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),h}getDefaultProgramParams(d,l,h){return{config:new Yu(this,{zoom:l,lut:h}),overrideFog:!1}}recalculate(d,l){super.recalculate(d,l);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(d){return new kD(d)}queryRadius(){return Zn(this.paint.get("fill-translate"))}queryIntersectsFeature(d,l,h,m,_,S){return!d.queryGeometry.isAboveHorizon&&Jn(Ks(d.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),m)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(d){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const l=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return d!=null?l&&!d:l}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ho{constructor(d,l,h,m){super(d,{layout:W5||(W5=new Kn({visibility:new Pe(Yt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pe(Yt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:$5||($5=new Kn({"fill-extrusion-opacity":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ei(Yt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Pe(Yt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new s2(d)}queryRadius(){return Zn(this.paint.get("fill-extrusion-translate"))}is3D(d){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(d,l,h,m,_,S,T,C,L){const k=Ef(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(l,h),V=this.paint.get("fill-extrusion-base").evaluate(l,h),U=[0,0],$=C&&S.elevation,Z=S.elevation?S.elevation.exaggeration():1,Q=d.tile.getBucket(this);if($&&Q instanceof s2){const yt=Q.centroidVertexArray,Lt=L+1;Lt<yt.length&&(U[0]=yt.geta_centroid_pos0(Lt),U[1]=yt.geta_centroid_pos1(Lt))}if(U[0]===0&&U[1]===1)return!1;S.projection.name==="globe"&&(m=j5([m],[new Me(0,0),new Me(Ve,Ve)],d.tileID.canonical).map(yt=>yt.polygon).flat());const et=$?C:null,[nt,dt]=Q5(S,m,V,F,k,T,et,U,Z,S.center.lat,d.tileID.canonical),mt=d.queryGeometry;return J5(nt,dt,mt.isPointQuery()?mt.screenBounds:mt.screenGeometry)}},building:class extends Ho{constructor(d,l,h,m){super(d,{layout:TV||(TV=new Kn({visibility:new Pe(Yt.layout_building.visibility),"building-facade":new ei(Yt.layout_building["building-facade"]),"building-facade-floors":new ei(Yt.layout_building["building-facade-floors"]),"building-facade-unit-width":new ei(Yt.layout_building["building-facade-unit-width"]),"building-facade-window":new ei(Yt.layout_building["building-facade-window"]),"building-roof-shape":new ei(Yt.layout_building["building-roof-shape"]),"building-height":new ei(Yt.layout_building["building-height"]),"building-base":new ei(Yt.layout_building["building-base"]),"building-flood-light-wall-radius":new ei(Yt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new ei(Yt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new ei(Yt.layout_building["building-flip-roof-orientation"])})),paint:AV||(AV=new Kn({"building-opacity":new Pe(Yt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Pe(Yt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Pe(Yt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Pe(Yt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Pe(Yt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Pe(Yt.paint_building["building-vertical-scale"]),"building-cast-shadows":new Pe(Yt.paint_building["building-cast-shadows"]),"building-color":new ei(Yt.paint_building["building-color"]),"building-emissive-strength":new ei(Yt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Pe(Yt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Pe(Yt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Pe(Yt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Pe(Yt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Pe(Yt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new SV(d)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(d){return!0}queryRadius(d){return 0}queryIntersectsFeature(d,l,h,m,_,S,T,C,L){let k=this.layout.get("building-height").evaluate(l,h);const F=this.layout.get("building-base").evaluate(l,h),V=d.tile.getBucket(this).getFootprint(l);if(V){if(V.hiddenFlags!==0)return!1;k=V.height}const[U,$]=Q5(S,m,F,k,new Me(0,0),T,null,[0,0],1,S.center.lat,d.tileID.canonical),Z=d.queryGeometry;return J5(U,$,Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends Ho{constructor(d,l,h,m){const _=OV();super(d,_,l,h,m),_.layout&&(this.layout=new Gh(_.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(d){if(d==="line-gradient"){const l=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=l._styleExpression&&l._styleExpression.expression instanceof Sg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(d,l){super.recalculate(d,l),this.paint._values["line-floorwidth"]=(()=>{if(z1)return z1;const h=OV();return z1=new Rat(h.paint.properties["line-width"].specification),z1.useIntegerZoom=!0,z1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,d)}createBucket(d){return new rP(d)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(d,l,h){const m=RV(this);return{config:new Yu(this,{zoom:l,lut:h}),defines:m,overrideFog:!1}}queryRadius(d){const l=d,h=zV(Xa("line-width",this,l),Xa("line-gap-width",this,l)),m=Xa("line-offset",this,l);return h/2+Math.abs(m)+Zn(this.paint.get("line-translate"))}queryIntersectsFeature(d,l,h,m,_,S){if(d.queryGeometry.isAboveHorizon)return!1;const T=Ks(d.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,d.pixelToTileUnitsFactor),C=d.pixelToTileUnitsFactor/2*zV(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),L=this.paint.get("line-offset").evaluate(l,h);return L&&(m=function(k,F){const V=[],U=new Me(0,0);for(let $=0;$<k.length;$++){const Z=k[$],Q=[];for(let et=0;et<Z.length;et++){const nt=Z[et],dt=Z[et+1],mt=et===0?U:nt.sub(Z[et-1])._unit()._perp(),yt=et===Z.length-1?U:dt.sub(nt)._unit()._perp(),Lt=mt._add(yt)._unit();Lt._mult(1/(Lt.x*yt.x+Lt.y*yt.y)),Q.push(Lt._mult(F)._add(nt))}V.push(Q)}return V}(m,L*d.pixelToTileUnitsFactor)),function(k,F,V){for(let U=0;U<F.length;U++){const $=F[U];if(k.length>=3){for(let Z=0;Z<$.length;Z++)if(qa(k,$[Z]))return!0}if(fs(k,$,V))return!0}return!1}(T,m,C)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(d){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:L2,background:class extends Ho{constructor(d,l,h,m){super(d,{layout:A4||(A4=new Kn({visibility:new Pe(Yt.layout_background.visibility)})),paint:I4||(I4=new Kn({"background-pitch-alignment":new Pe(Yt.paint_background["background-pitch-alignment"]),"background-color":new Pe(Yt.paint_background["background-color"]),"background-pattern":new Pe(Yt.paint_background["background-pattern"]),"background-opacity":new Pe(Yt.paint_background["background-opacity"]),"background-emissive-strength":new Pe(Yt.paint_background["background-emissive-strength"]),"background-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(d,l,h){return{overrideFog:!1}}is3D(d){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:P4,"raster-particle":B4,sky:class extends Ho{constructor(d,l,h,m){super(d,{layout:k4||(k4=new Kn({visibility:new Pe(Yt.layout_sky.visibility)})),paint:O4||(O4=new Kn({"sky-type":new Pe(Yt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pe(Yt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pe(Yt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pe(Yt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pe(Yt.paint_sky["sky-gradient-radius"]),"sky-gradient":new vf(Yt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pe(Yt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pe(Yt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pe(Yt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(d){d==="sky-gradient"?this._updateColorRamp():d!=="sky-atmosphere-sun"&&d!=="sky-atmosphere-halo-color"&&d!=="sky-atmosphere-color"&&d!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=y1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(d){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const l=d.style.light.properties.get("position");return this._lightPosition.azimuthal!==l.azimuthal||this._lightPosition.polar!==l.polar}return!1}getCenter(d,l){if(this.paint.get("sky-type")==="atmosphere"){const m=this.paint.get("sky-atmosphere-sun"),_=!m,S=d.style.light,T=S.properties.get("position");return _&&S.properties.get("anchor")==="viewport"&&Mi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?TP(T.azimuthal,90-T.polar,l):TP(m[0],90-m[1],l)}const h=this.paint.get("sky-gradient-center");return TP(h[0],90-h[1],l)}isSky(){return!0}markSkyboxValid(d){this._skyboxInvalidated=!1,this._lightPosition=d.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const d=this.paint.get("sky-type");return d==="atmosphere"?["skyboxCapture","skybox"]:d==="gradient"?["skyboxGradient"]:null}},slot:class extends Ho{constructor(d,l,h,m){super(d,{paint:z4||(z4=new Kn({}))},l,null)}},model:class extends Ho{constructor(d,l,h,m){super(d,{layout:U4||(U4=new Kn({visibility:new Pe(Yt.layout_model.visibility),"model-id":new ei(Yt.layout_model["model-id"])})),paint:G4||(G4=new Kn({"model-opacity":new ei(Yt.paint_model["model-opacity"]),"model-rotation":new ei(Yt.paint_model["model-rotation"]),"model-scale":new ei(Yt.paint_model["model-scale"]),"model-translation":new ei(Yt.paint_model["model-translation"]),"model-color":new ei(Yt.paint_model["model-color"]),"model-color-mix-intensity":new ei(Yt.paint_model["model-color-mix-intensity"]),"model-type":new Pe(Yt.paint_model["model-type"]),"model-cast-shadows":new Pe(Yt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pe(Yt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pe(Yt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ei(Yt.paint_model["model-emissive-strength"]),"model-roughness":new ei(Yt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ei(Yt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pe(Yt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pe(Yt.paint_model["model-front-cutoff"]),"model-elevation-reference":new Pe(Yt.paint_model["model-elevation-reference"]),"model-color-use-theme":new ei({type:"string",default:"default","property-type":"data-driven"})}))},l,h,m),this.layer=d,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(d){return new IP(d)}getProgramIds(){return["model"]}is3D(d){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(d){return d instanceof z2?Ve-1:0}queryRenderedFeatures(d,l,h){const m=l.getSource();if(!(m&&m instanceof Xg))return{};const _=m,S={};S[this.id]=[];const T=S[this.id];let C=0;for(const L of _.models){const k=l.getFeatureState(this.sourceLayer,L.id),F={type:"Unknown",id:L.id,properties:L.featureProperties},V=this.paint.get("model-rotation").evaluate(F,k),U=this.paint.get("model-scale").evaluate(F,k),$=this.paint.get("model-translation").evaluate(F,k),Z=this.paint.get("model-elevation-reference");let Q=[];m2(Q,L,h,L.position,V,U,$,Z==="ground",Z==="ground",!1),h.projection.name==="globe"&&(Q=g2(Q,h));const et=z([],h.projMatrix,Q),nt=KD(d.isPointQuery()?d.screenBounds:d.screenGeometry,h,et,L.aabb);if(nt!=null){const dt=new qg(void 0,0,0,0,L.id);dt.layer=this.layer,dt.properties=structuredClone(L.featureProperties),dt.properties.layer=this.id,dt.properties.uri=L.uri,dt.properties.orientation=L.orientation,dt.sourceLayer=this.sourceLayer,dt.geometry={type:"Point",coordinates:[L.position.lng,L.position.lat]},dt.state=k,dt.source=this.source,T.push({featureIndex:C,feature:dt,intersectionZ:nt})}++C}return S}queryIntersectsFeature(d,l,h,m,_,S){if(!this.modelManager)return!1;const T=this.modelManager,C=d.tile.getBucket(this);if(!(C&&C instanceof IP))return!1;for(const L in C.instancesPerModel){const k=C.instancesPerModel[L],F=l.id!==void 0?l.id:l.properties&&l.properties.hasOwnProperty("id")?l.properties.id:void 0;if(k.idToFeaturesIndex.hasOwnProperty(F)){const V=k.features[k.idToFeaturesIndex[F]],U=T.getModel(L,this.scope);if(!U)return!1;let $=[];const Z=new X(0,0),Q=C.canonical;let et=Number.MAX_VALUE;for(let nt=0;nt<V.instancedDataCount;++nt){const dt=16*(V.instancedDataOffset+nt),mt=k.instancedDataArray.float32,yt=[mt[dt+4],mt[dt+5],mt[dt+6]];MP(Q,Z,Math.floor(mt[dt]),Math.floor(mt[dt+1])),m2($,U,S,Z,V.rotation,V.scale,yt,!1,!1,!1),S.projection.name==="globe"&&($=g2($,S));const Lt=z([],S.projMatrix,$),It=d.queryGeometry,Ot=KD(It.isPointQuery()?It.screenBounds:It.screenGeometry,S,Lt,U.aabb);Ot!=null&&(et=Math.min(Ot,et))}return et!==Number.MAX_VALUE&&et}}return!1}_handleOverridablePaintPropertyUpdate(d,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven()||d!=="model-color"&&d!=="model-color-mix-intensity"&&d!=="model-rotation"&&d!=="model-scale"&&d!=="model-translation"&&d!=="model-emissive-strength")}_isPropertyZoomDependent(d){const l=this._transitionablePaint._values[d];return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof Pc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ho{constructor(d,l,h,m){super(d,{layout:b5||(b5=new Kn({"clip-layer-types":new Pe(Yt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pe(Yt.layout_clip["clip-layer-scope"])})),paint:w5||(w5=new Kn({}))},l,h,m)}recalculate(d,l){super.recalculate(d,l)}createBucket(d){return new S5(d)}is3D(d){return!0}}},EP=new Xr(0,0,0),DP={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},PP={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},B2={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Fot={PAINT_ORDER_FILL_AND_STROKE:1},J1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Z4={MASK_TYPE_LUMINANCE:1};function Not(d,l,h){d===1&&l.icons.push(function(m,_){return function(S){if(S.usvg_tree.height||(S.usvg_tree.height=S.usvg_tree.width),!S.metadata)return S;const{metadata:T}=S;if(T.content_area){const{content_area:C}=T;C.left==null&&(C.left=0),C.top==null&&(C.top=C.left),C.width==null&&(C.width=S.usvg_tree.width),C.height==null&&(C.height=C.width)}if(T.text_placeholder){const{text_placeholder:C}=T;C.top==null&&(C.top=C.left),C.height==null&&(C.height=C.width)}return T.stretch_x&&T.stretch_x.length&&q4(T,"x"),T.stretch_y&&T.stretch_y.length&&q4(T,"y"),S}(m.readFields(Vot,{name:void 0},_))}(h,h.readVarint()+h.pos))}function q4(d,l){const h=[],m=d[`stretch_${l}`];let _=null;for(let S=0;S<m.length;S++)_===null?_=h.length===0?m[0]:h[h.length-1][1]+m[S]:(h.push([_,_+m[S]]),_=null);d[`stretch_${l}_areas`]=h}function Vot(d,l,h){d===1?l.name=h.readString():d===2?l.metadata=function(m,_){return m.readFields(Uot,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},_)}(h,h.readVarint()+h.pos):d===3&&(l.usvg_tree=function(m,_){return m.readFields(jot,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},_)}(h,h.readVarint()+h.pos),l.data="usvg_tree")}function Uot(d,l,h){d===1?l.stretch_x=h.readPackedVarint():d===2?l.stretch_y=h.readPackedVarint():d===3?l.content_area=X4(h,h.readVarint()+h.pos):d===4?l.variables.push(function(m,_){return m.readFields(Hot,{name:void 0},_)}(h,h.readVarint()+h.pos)):d===5&&(l.text_placeholder=X4(h,h.readVarint()+h.pos))}function X4(d,l){return d.readFields(Got,{},l)}function Got(d,l,h){d===1?l.left=h.readVarint():d===2?l.width=h.readVarint():d===3?l.top=h.readVarint():d===4&&(l.height=h.readVarint())}function Hot(d,l,h){d===1?l.name=h.readString():d===2&&(l.rgb_color=V2(h.readVarint()),l.value="rgb_color")}function jot(d,l,h){d===1?l.width=l.height=h.readVarint():d===2?l.height=h.readVarint():d===3?l.children.push(F2(h,h.readVarint()+h.pos)):d===4?l.linear_gradients.push(function(m,_){return m.readFields(Kot,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},_)}(h,h.readVarint()+h.pos)):d===5?l.radial_gradients.push(function(m,_){return m.readFields(Qot,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},_)}(h,h.readVarint()+h.pos)):d===7?l.clip_paths.push(function(m,_){return m.readFields(tst,{children:[]},_)}(h,h.readVarint()+h.pos)):d===8&&l.masks.push(function(m,_){const S=m.readFields(est,{left:0,width:20,mask_type:Z4.MASK_TYPE_LUMINANCE,children:[]},_);return S.height==null&&(S.height=S.width),S.top==null&&(S.top=S.left),S}(h,h.readVarint()+h.pos))}function F2(d,l){return d.readFields(Wot,{},l)}function Wot(d,l,h){d===1?(l.group=function(m,_){return m.readFields($ot,{opacity:255,children:[]},_)}(h,h.readVarint()+h.pos),l.node="group"):d===2&&(l.path=function(m,_){return m.readFields(qot,{paint_order:1,commands:[],step:1,diffs:[],rule:DP.PATH_RULE_NON_ZERO},_)}(h,h.readVarint()+h.pos),l.node="path")}function $ot(d,l,h){d===1?l.transform=N2(h,h.readVarint()+h.pos):d===2?l.opacity=h.readVarint():d===5?l.clip_path_idx=h.readVarint():d===6?l.mask_idx=h.readVarint():d===7&&l.children.push(F2(h,h.readVarint()+h.pos))}function N2(d,l){return d.readFields(Zot,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},l)}function Zot(d,l,h){d===1?l.sx=h.readFloat():d===2?l.ky=h.readFloat():d===3?l.kx=h.readFloat():d===4?l.sy=h.readFloat():d===5?l.tx=h.readFloat():d===6&&(l.ty=h.readFloat())}function qot(d,l,h){d===1?l.fill=function(m,_){return m.readFields(Xot,{rgb_color:EP,paint:"rgb_color",opacity:255},_)}(h,h.readVarint()+h.pos):d===2?l.stroke=function(m,_){return m.readFields(Yot,{rgb_color:EP,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},_)}(h,h.readVarint()+h.pos):d===3?l.paint_order=h.readVarint():d===5?h.readPackedVarint(l.commands):d===6?l.step=h.readFloat():d===7?h.readPackedSVarint(l.diffs):d===8&&(l.rule=h.readVarint())}function Xot(d,l,h){d===1?(l.rgb_color=V2(h.readVarint()),l.paint="rgb_color"):d===2?(l.linear_gradient_idx=h.readVarint(),l.paint="linear_gradient_idx"):d===3?(l.radial_gradient_idx=h.readVarint(),l.paint="radial_gradient_idx"):d===5&&(l.opacity=h.readVarint())}function V2(d){return new Xr((d>>16&255)/255,(d>>8&255)/255,(255&d)/255,1)}function Yot(d,l,h){d===1?(l.rgb_color=V2(h.readVarint()),l.paint="rgb_color"):d===2?(l.linear_gradient_idx=h.readVarint(),l.paint="linear_gradient_idx"):d===3?(l.radial_gradient_idx=h.readVarint(),l.paint="radial_gradient_idx"):d===5?h.readPackedFloat(l.dasharray):d===6?l.dashoffset=h.readFloat():d===7?l.miterlimit=h.readFloat():d===8?l.opacity=h.readVarint():d===9?l.width=h.readFloat():d===10?l.linecap=h.readVarint():d===11&&(l.linejoin=h.readVarint())}function Kot(d,l,h){d===1?l.transform=N2(h,h.readVarint()+h.pos):d===2?l.spread_method=h.readVarint():d===3?l.stops.push(Y4(h,h.readVarint()+h.pos)):d===4?l.x1=h.readFloat():d===5?l.y1=h.readFloat():d===6?l.x2=h.readFloat():d===7&&(l.y2=h.readFloat())}function Y4(d,l){return d.readFields(Jot,{offset:0,opacity:255,rgb_color:EP},l)}function Jot(d,l,h){d===1?l.offset=h.readFloat():d===2?l.opacity=h.readVarint():d===3&&(l.rgb_color=V2(h.readVarint()))}function Qot(d,l,h){d===1?l.transform=N2(h,h.readVarint()+h.pos):d===2?l.spread_method=h.readVarint():d===3?l.stops.push(Y4(h,h.readVarint()+h.pos)):d===4?l.cx=h.readFloat():d===5?l.cy=h.readFloat():d===6?l.r=h.readFloat():d===7?l.fx=h.readFloat():d===8?l.fy=h.readFloat():d===9&&(l.fr=h.readFloat())}function tst(d,l,h){d===1?l.transform=N2(h,h.readVarint()+h.pos):d===2?l.clip_path_idx=h.readVarint():d===3&&l.children.push(F2(h,h.readVarint()+h.pos))}function est(d,l,h){d===1?l.left=l.top=h.readFloat():d===2?l.width=l.height=h.readFloat():d===3?l.top=h.readFloat():d===4?l.height=h.readFloat():d===5?l.mask_type=h.readVarint():d===6?l.mask_idx=h.readVarint():d===7&&l.children.push(F2(h,h.readVarint()+h.pos))}class ist{static calculate(l={},h=[]){const m=new Map,_=new Map;if(Object.keys(l).length===0)return m;h.forEach(S=>{_.set(S.name,S.rgb_color||new Xr(0,0,0))});for(const[S,T]of Object.entries(l))_.has(S)?m.set(_.get(S).toString(),T):console.warn(`Ignoring unknown image variable "${S}"`);return m}}function sy(d,l=255,h){const m=l/255,_=d.toString(),S=h.has(_)?h.get(_).clone():d.clone();return S.a*=m,S.toString()}function Q1(d,l){if(!bs()){const h=document.createElement("canvas");return h.width=d,h.height=l,h}return new OffscreenCanvas(d,l)}function rst(d,l){const h=ist.calculate(l.params,d.metadata?d.metadata.variables:[]),m=d.usvg_tree,_=m.width,S=m.height,T=l.transform?l.transform:new DOMMatrix,C=Math.max(1,Math.round(_*T.a)),L=Math.max(1,Math.round(S*T.d)),k=new DOMMatrix([C/_,0,0,L/S,0,0]),F=Q1(C,L).getContext("2d");return LP(F,k,m,m,h),F.getImageData(0,0,C,L)}function LP(d,l,h,m,_){for(const S of m.children)K4(d,l,h,S,_)}function K4(d,l,h,m,_){m.group?(d.save(),function(S,T,C,L,k){const F=L.mask_idx!=null?C.masks[L.mask_idx]:null,V=L.clip_path_idx!=null?C.clip_paths[L.clip_path_idx]:null;if(L.transform&&(T=ly(L.transform).preMultiplySelf(T)),!function(Z,Q,et){return Z.opacity!==255||Q||et}(L,V!=null,F!=null))return void LP(S,T,C,L,k);const U=Q1(S.canvas.width,S.canvas.height),$=U.getContext("2d");LP($,T,C,L,k),V&&nU($,T,C,V),F&&aU($,T,C,F,k),S.globalAlpha=L.opacity/255,S.drawImage(U,0,0)}(d,l,h,m.group,_),d.restore()):m.path&&(d.save(),function(S,T,C,L,k){S.setTransform(T),L.paint_order===Fot.PAINT_ORDER_FILL_AND_STROKE?(J4(S,C,L,k),tU(S,C,L,k)):(tU(S,C,L,k),J4(S,C,L,k))}(d,l,h,m.path,_),d.restore())}function J4(d,l,h,m){const _=h.fill;if(!_)return;const S=_.opacity/255;switch(d.save(),d.beginPath(),oU(h,d),_.paint){case"rgb_color":d.fillStyle=sy(_.rgb_color,_.opacity,m);break;case"linear_gradient_idx":{const T=l.linear_gradients[_.linear_gradient_idx];T.transform&&d.setTransform(ly(T.transform).preMultiplySelf(d.getTransform())),d.fillStyle=eU(d,T,S,m);break}case"radial_gradient_idx":{const T=l.radial_gradients[_.radial_gradient_idx];T.transform&&d.setTransform(ly(T.transform).preMultiplySelf(d.getTransform())),d.fillStyle=iU(d,T,S,m)}}d.fill(Q4(h)),d.restore()}function Q4(d){return d.rule===DP.PATH_RULE_NON_ZERO?"nonzero":d.rule===DP.PATH_RULE_EVEN_ODD?"evenodd":void 0}function tU(d,l,h,m){const _=h.stroke;if(!_)return;const S=sU(h);d.lineWidth=_.width,d.miterLimit=_.miterlimit,d.setLineDash(_.dasharray),d.lineDashOffset=_.dashoffset;const T=_.opacity/255;switch(_.paint){case"rgb_color":d.strokeStyle=sy(_.rgb_color,_.opacity,m);break;case"linear_gradient_idx":d.strokeStyle=eU(d,l.linear_gradients[_.linear_gradient_idx],T,m,!0);break;case"radial_gradient_idx":d.strokeStyle=iU(d,l.radial_gradients[_.radial_gradient_idx],T,m,!0)}switch(_.linejoin){case B2.LINE_JOIN_MITER_CLIP:case B2.LINE_JOIN_MITER:d.lineJoin="miter";break;case B2.LINE_JOIN_ROUND:d.lineJoin="round";break;case B2.LINE_JOIN_BEVEL:d.lineJoin="bevel"}switch(_.linecap){case PP.LINE_CAP_BUTT:d.lineCap="butt";break;case PP.LINE_CAP_ROUND:d.lineCap="round";break;case PP.LINE_CAP_SQUARE:d.lineCap="square"}d.stroke(S)}function eU(d,l,h,m,_=!1){if(l.stops.length===1){const U=l.stops[0];return sy(U.rgb_color,U.opacity*h,m)}const{x1:S,y1:T,x2:C,y2:L}=l;let k=new DOMPoint(S,T),F=new DOMPoint(C,L);if(_){const U=ly(l.transform);k=U.transformPoint(k),F=U.transformPoint(F)}const V=d.createLinearGradient(k.x,k.y,F.x,F.y);for(const U of l.stops)V.addColorStop(U.offset,sy(U.rgb_color,U.opacity*h,m));return V}function iU(d,l,h,m,_=!1){if(l.stops.length===1){const nt=l.stops[0];return sy(nt.rgb_color,nt.opacity*h,m)}const S=ly(l.transform),{fx:T,fy:C,fr:L,cx:k,cy:F,r:V}=l;let U=new DOMPoint(T,C),$=new DOMPoint(k,F),Z=L,Q=V;if(_){U=S.transformPoint(U),$=S.transformPoint($);const nt=(S.a+S.d)/2;Z=L*nt,Q=l.r*nt}const et=d.createRadialGradient(U.x,U.y,Z,$.x,$.y,Q);for(const nt of l.stops)et.addColorStop(nt.offset,sy(nt.rgb_color,nt.opacity*h,m));return et}function rU(d,l,h,m){const _=m.transform?ly(m.transform).preMultiplySelf(l):l,S=Q1(d.canvas.width,d.canvas.height),T=S.getContext("2d");for(const L of m.children)if(L.group)rU(T,_,h,L.group);else if(L.path){const k=L.path,F=new Path2D;F.addPath(sU(k),_),T.fill(F,Q4(k))}const C=m.clip_path_idx!=null?h.clip_paths[m.clip_path_idx]:null;C&&nU(T,_,h,C),d.globalCompositeOperation="source-over",d.drawImage(S,0,0)}function nU(d,l,h,m){const _=Q1(d.canvas.width,d.canvas.height);rU(_.getContext("2d"),l,h,m),d.globalCompositeOperation="destination-in",d.drawImage(_,0,0)}function aU(d,l,h,m,_){if(m.children.length===0)return;const S=m.mask_idx!=null?h.masks[m.mask_idx]:null;S&&aU(d,l,h,S,_);const T=d.canvas.width,C=d.canvas.height,L=Q1(T,C),k=L.getContext("2d"),F=m.width,V=m.height,U=m.left,$=m.top,Z=new Path2D,Q=new Path2D;Q.rect(U,$,F,V),Z.addPath(Q,l),k.clip(Z);for(const dt of m.children)K4(k,l,h,dt,_);const et=k.getImageData(0,0,T,C),nt=et.data;if(m.mask_type===Z4.MASK_TYPE_LUMINANCE)for(let dt=0;dt<nt.length;dt+=4)nt[dt+3]=nt[dt+3]/255*(.2126*nt[dt]+.7152*nt[dt+1]+.0722*nt[dt+2]);k.putImageData(et,0,0),d.globalCompositeOperation="destination-in",d.drawImage(L,0,0)}function ly(d){return d?new DOMMatrix([d.sx,d.ky,d.kx,d.sy,d.tx,d.ty]):new DOMMatrix}function oU(d,l){const h=d.step;let m=d.diffs[0]*h,_=d.diffs[1]*h;l.moveTo(m,_);for(let S=0,T=2;S<d.commands.length;S++)switch(d.commands[S]){case J1.PATH_COMMAND_MOVE:m+=d.diffs[T++]*h,_+=d.diffs[T++]*h,l.moveTo(m,_);break;case J1.PATH_COMMAND_LINE:m+=d.diffs[T++]*h,_+=d.diffs[T++]*h,l.lineTo(m,_);break;case J1.PATH_COMMAND_QUAD:{const C=m+d.diffs[T++]*h,L=_+d.diffs[T++]*h;m=C+d.diffs[T++]*h,_=L+d.diffs[T++]*h,l.quadraticCurveTo(C,L,m,_);break}case J1.PATH_COMMAND_CUBIC:{const C=m+d.diffs[T++]*h,L=_+d.diffs[T++]*h,k=C+d.diffs[T++]*h,F=L+d.diffs[T++]*h;m=k+d.diffs[T++]*h,_=F+d.diffs[T++]*h,l.bezierCurveTo(C,L,k,F,m,_);break}case J1.PATH_COMMAND_CLOSE:l.closePath()}return l}function sU(d){return oU(d,new Path2D)}class U2{constructor(l){this.capacity=l,this.cache=new Map}get(l){if(!this.cache.has(l))return;const h=this.cache.get(l);return this.cache.delete(l),this.cache.set(l,h),h}put(l,h){this.cache.has(l)?this.cache.delete(l):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(l,h)}delete(l){this.cache.delete(l)}}li(U2,"LRUCache");class RP{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(l){return new Do(l,l.data)}getFromCache(l,h,m){return this.cacheMap.has(m)||this.cacheMap.set(m,new U2(150)),this.cacheMap.get(m).get(Hh(l.toString(),h))}setInCache(l,h,m,_){this.cacheDependenciesMap.has(_)||this.cacheDependenciesMap.set(_,new Map),this.cacheMap.has(_)||this.cacheMap.set(_,new U2(150));const S=this.cacheDependenciesMap.get(_),T=Hh(l.id.toString(),m);S.get(T)||S.set(T,new Set);const C=this.cacheMap.get(_),L=l.toString();S.get(T).add(L),C.put(Hh(l.toString(),m),h)}removeImagesFromCacheByIds(l,h,m=0){if(!this.cacheMap.has(m)||!this.cacheDependenciesMap.has(m))return;const _=this.cacheMap.get(m),S=this.cacheDependenciesMap.get(m);for(const T of l){const C=Hh(T.toString(),h);if(S.has(C)){for(const L of S.get(C))_.delete(L);S.delete(C)}}}rasterize(l,h,m,_,S=rst){const T=this.getFromCache(l,m,_);if(T)return T.clone();const C=S(h.icon,l.options),L=RP._getImage(C);return this.setInCache(l,L,m,_),L.clone()}}class lU{constructor(l){this.size=l,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(l,h){const m=this.toIdx(l,h);return{min:this.minimums[m],max:this.maximums[m]}}isLeaf(l,h){return this.leaves[this.toIdx(l,h)]}toIdx(l,h){return h*this.size+l}}function uU(d,l,h,m){let _=0,S=Number.MAX_VALUE;for(let T=0;T<3;T++)if(Math.abs(m[T])<1e-15){if(h[T]<d[T]||h[T]>l[T])return null}else{const C=1/m[T];let L=(d[T]-h[T])*C,k=(l[T]-h[T])*C;if(L>k){const F=L;L=k,k=F}if(L>_&&(_=L),k<S&&(S=k),_>S)return null}return _}function cU(d,l,h,m,_,S,T,C,L,k,F){const V=m-d,U=_-l,$=S-h,Z=T-d,Q=C-l,et=L-h,nt=F[1]*et-F[2]*Q,dt=F[2]*Z-F[0]*et,mt=F[0]*Q-F[1]*Z,yt=V*nt+U*dt+$*mt;if(Math.abs(yt)<1e-15)return null;const Lt=1/yt,It=k[0]-d,Ot=k[1]-l,Ut=k[2]-h,Ht=(It*nt+Ot*dt+Ut*mt)*Lt;if(Ht<0||Ht>1)return null;const se=Ot*$-Ut*U,Kt=Ut*V-It*$,ue=It*U-Ot*V,me=(F[0]*se+F[1]*Kt+F[2]*ue)*Lt;return me<0||Ht+me>1?null:(Z*se+Q*Kt+et*ue)*Lt}function hU(d,l,h){return(d-l)/(h-l)}function dU(d,l,h,m,_,S,T,C,L){const k=1<<h,F=S-m,V=T-_,U=(d+1)/k*F+m,$=(l+0)/k*V+_,Z=(l+1)/k*V+_;C[0]=(d+0)/k*F+m,C[1]=$,L[0]=U,L[1]=Z}class fU{constructor(l){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=l,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const h=function(S){const T=Math.ceil(Math.log2(S.dim/8)),C=[];let L=Math.ceil(Math.pow(2,T));const k=1/L,F=($,Z,Q,et,nt)=>{const dt=et?1:0,mt=($+1)*Q-dt,yt=Z*Q,Lt=(Z+1)*Q-dt;nt[0]=$*Q,nt[1]=yt,nt[2]=mt,nt[3]=Lt};let V=new lU(L);const U=[];for(let $=0;$<L*L;$++){F($%L,Math.floor($/L),k,!1,U);const Z=Bf(U[0],U[1],S),Q=Bf(U[2],U[1],S),et=Bf(U[2],U[3],S),nt=Bf(U[0],U[3],S);V.minimums.push(Math.min(Z,Q,et,nt)),V.maximums.push(Math.max(Z,Q,et,nt)),V.leaves.push(1)}for(C.push(V),L/=2;L>=1;L/=2){const $=C[C.length-1];V=new lU(L);for(let Z=0;Z<L*L;Z++){F(Z%L,Math.floor(Z/L),2,!0,U);const Q=$.getElevation(U[0],U[1]),et=$.getElevation(U[2],U[1]),nt=$.getElevation(U[2],U[3]),dt=$.getElevation(U[0],U[3]),mt=$.isLeaf(U[0],U[1]),yt=$.isLeaf(U[2],U[1]),Lt=$.isLeaf(U[2],U[3]),It=$.isLeaf(U[0],U[3]),Ot=Math.min(Q.min,et.min,nt.min,dt.min),Ut=Math.max(Q.max,et.max,nt.max,dt.max),Ht=mt&&yt&&Lt&&It;V.maximums.push(Ut),V.minimums.push(Ot),V.leaves.push(Ut-Ot<=5&&Ht?1:0)}C.push(V)}return C}(this.dem),m=h.length-1,_=h[m];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(h,0,0,m,0)}raycastRoot(l,h,m,_,S,T,C=1){return uU([l,h,-100],[m,_,this.maximums[0]*C],S,T)}raycast(l,h,m,_,S,T,C=1){if(!this.nodeCount)return null;const L=this.raycastRoot(l,h,m,_,S,T,C);if(L==null)return null;const k=[],F=[],V=[],U=[],$=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;$.length>0;){const{idx:Z,t:Q,nodex:et,nodey:nt,depth:dt}=$.pop();if(this.leaves[Z]){dU(et,nt,dt,l,h,m,_,V,U);const yt=1<<dt,Lt=(et+0)/yt,It=(et+1)/yt,Ot=(nt+0)/yt,Ut=(nt+1)/yt,Ht=Bf(Lt,Ot,this.dem)*C,se=Bf(It,Ot,this.dem)*C,Kt=Bf(It,Ut,this.dem)*C,ue=Bf(Lt,Ut,this.dem)*C,me=cU(V[0],V[1],Ht,U[0],V[1],se,U[0],U[1],Kt,S,T),Te=cU(U[0],U[1],Kt,V[0],U[1],ue,V[0],V[1],Ht,S,T),Be=Math.min(me!==null?me:Number.MAX_VALUE,Te!==null?Te:Number.MAX_VALUE);if(Be!==Number.MAX_VALUE)return Be;{const De=ni([],S,T,Q);if(pU(Ht,se,ue,Kt,hU(De[0],V[0],U[0]),hU(De[1],V[1],U[1]))>=De[2])return Q}continue}let mt=0;for(let yt=0;yt<this._siblingOffset.length;yt++){dU((et<<1)+this._siblingOffset[yt][0],(nt<<1)+this._siblingOffset[yt][1],dt+1,l,h,m,_,V,U),V[2]=-100,U[2]=this.maximums[this.childOffsets[Z]+yt]*C;const Lt=uU(V,U,S,T);if(Lt!=null){const It=Lt;k[yt]=It;let Ot=!1;for(let Ut=0;Ut<mt&&!Ot;Ut++)It>=k[F[Ut]]&&(F.splice(Ut,0,yt),Ot=!0);Ot||(F[mt]=yt),mt++}}for(let yt=0;yt<mt;yt++){const Lt=F[yt];$.push({idx:this.childOffsets[Z]+Lt,t:k[Lt],nodex:(et<<1)+this._siblingOffset[Lt][0],nodey:(nt<<1)+this._siblingOffset[Lt][1],depth:dt+1})}}return null}_addNode(l,h,m){return this.minimums.push(l),this.maximums.push(h),this.leaves.push(m),this.childOffsets.push(0),this.nodeCount++}_construct(l,h,m,_,S){if(l[_].isLeaf(h,m)===1)return;this.childOffsets[S]||(this.childOffsets[S]=this.nodeCount);const T=_-1,C=l[T];let L=0,k=0;for(let F=0;F<this._siblingOffset.length;F++){const V=2*h+this._siblingOffset[F][0],U=2*m+this._siblingOffset[F][1],$=C.getElevation(V,U),Z=C.isLeaf(V,U),Q=this._addNode($.min,$.max,Z);Z&&(L|=1<<F),k||(k=Q)}for(let F=0;F<this._siblingOffset.length;F++)L&1<<F||this._construct(l,2*h+this._siblingOffset[F][0],2*m+this._siblingOffset[F][1],T,k+F)}}function pU(d,l,h,m,_,S){return zi(zi(d,h,S),zi(l,m,S),_)}function Bf(d,l,h){const m=h.dim,_=lt(d*m-.5,0,m-1),S=lt(l*m-.5,0,m-1),T=Math.floor(_),C=Math.floor(S),L=Math.min(T+1,m-1),k=Math.min(C+1,m-1);return pU(h.get(T,C),h.get(L,C),h.get(T,k),h.get(L,k),_-T,S-C)}const nst={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function ast(d,l,h){return(256*d*256+256*l+h)/10-1e4}function ost(d,l,h){return 256*d+l+h/256-32768}class G2{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(l,h,m,_=!1){if(this.uid=l,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&m!=="mapbox"&&m!=="terrarium")return void Mi(`"${m}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const S=this.dim=h.height-2,T=new Uint32Array(h.data.buffer);if(this.pixels=new Uint8Array(h.data.buffer),this.floatView=new Float32Array(h.data.buffer),this.borderReady=_,this._modifiedForSources={},!_){for(let L=0;L<S;L++)T[this._idx(-1,L)]=T[this._idx(0,L)],T[this._idx(S,L)]=T[this._idx(S-1,L)],T[this._idx(L,-1)]=T[this._idx(L,0)],T[this._idx(L,S)]=T[this._idx(L,S-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(S,-1)]=T[this._idx(S-1,0)],T[this._idx(-1,S)]=T[this._idx(0,S-1)],T[this._idx(S,S)]=T[this._idx(S-1,S-1)]}const C=m==="terrarium"?ost:ast;for(let L=0;L<T.length;++L){const k=4*L;this.floatView[L]=C(this.pixels[k],this.pixels[k+1],this.pixels[k+2])}this._timestamp=ws.now()}_buildQuadTree(){this._tree=new fU(this)}get(l,h,m=!1){m&&(l=lt(l,-1,this.dim),h=lt(h,-1,this.dim));const _=this._idx(l,h);return this.floatView[_]}set(l,h,m){const _=this._idx(l,h),S=this.floatView[_];return this.floatView[_]=m,m-S}static getUnpackVector(l){return nst[l]}_idx(l,h){if(l<-1||l>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(l+1)}static pack(l,h){const m=[0,0,0,0],_=G2.getUnpackVector(h);let S=Math.floor((l+_[3])/_[2]);return m[2]=S%256,S=Math.floor(S/256),m[1]=S%256,S=Math.floor(S/256),m[0]=S,m}getPixels(){return new s5({width:this.stride,height:this.stride},this.pixels)}backfillBorder(l,h,m){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,S=h*this.dim+this.dim,T=m*this.dim,C=m*this.dim+this.dim;switch(h){case-1:_=S-1;break;case 1:S=_+1}switch(m){case-1:T=C-1;break;case 1:C=T+1}const L=-h*this.dim,k=-m*this.dim;for(let F=T;F<C;F++)for(let V=_;V<S;V++){const U=4*this._idx(V,F),$=4*this._idx(V+L,F+k);this.pixels[U+0]=l.pixels[$+0],this.pixels[U+1]=l.pixels[$+1],this.pixels[U+2]=l.pixels[$+2],this.pixels[U+3]=l.pixels[$+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function sst(d,l,h){d===1?l.headerLength=h.readFixed32():d===2?l.x=h.readVarint():d===3?l.y=h.readVarint():d===4?l.z=h.readVarint():d===5&&l.layers.push(function(m,_){return m.readFields(dst,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},_)}(h,h.readVarint()+h.pos))}function lst(d,l,h){d===1?(l.delta_filter=function(m,_){return m.readFields(ust,{blockSize:0},_)}(h,h.readVarint()+h.pos),l.filter="delta_filter"):d===2?(h.readVarint(),l.filter="zigzag_filter"):d===3?(h.readVarint(),l.filter="bitshuffle_filter"):d===4&&(h.readVarint(),l.filter="byteshuffle_filter")}function ust(d,l,h){d===1&&(l.blockSize=h.readVarint())}function cst(d,l,h){d===1?(h.readVarint(),l.codec="gzip_data"):d===2?(h.readVarint(),l.codec="jpeg_image"):d===3?(h.readVarint(),l.codec="webp_image"):d===4&&(h.readVarint(),l.codec="png_image")}function hst(d,l,h){let m=0,_=0;d===1?l.firstByte=h.readFixed64():d===2?l.lastByte=h.readFixed64():d===3?l.filters.push(function(S,T){return S.readFields(lst,{},T)}(h,h.readVarint()+h.pos)):d===4?l.codec=function(S,T){return S.readFields(cst,{},T)}(h,h.readVarint()+h.pos):d===5?_=h.readFloat():d===6?m=h.readFloat():d===7?l.bands.push(h.readString()):d===8?l.offset=h.readDouble():d===9&&(l.scale=h.readDouble()),l.offset===0&&(l.offset=_),l.scale===0&&(l.scale=m)}function dst(d,l,h){d===1?l.version=h.readVarint():d===2?l.name=h.readString():d===3?l.units=h.readString():d===4?l.tileSize=h.readVarint():d===5?l.buffer=h.readVarint():d===6?l.pixelFormat=h.readVarint():d===7&&l.dataIndex.push(function(m,_){return m.readFields(hst,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},_)}(h,h.readVarint()+h.pos))}function fst(d,l,h){if(d===2)(function(m,_,S){m.readFields(pst,S,_)})(h,h.readVarint()+h.pos,l);else if(d===3)throw new Error("Not implemented")}function pst(d,l,h){if(d===1){let m=0;const _=h.readVarint()+h.pos;for(;h.pos<_;)l[m++]=h.readVarint()}}function gst(d,l){if(l.length!==4)throw new Error(`Expected data of dimension 4 but got ${l.length}.`);let h=l[3];for(let m=2;m>=1;m--){const _=m===1?1:0,S=m===2?1:0;for(let T=0;T<l[0];T++){const C=l[1]*T;for(let L=_;L<l[1];L++){const k=l[2]*(L+C);for(let F=S;F<l[2];F++){const V=l[3]*(F+k);for(let U=0;U<l[3];U++){const $=V+U;d[$]+=d[$-h]}}}}h*=l[m]}return d}function mst(d){for(let l=0,h=d.length;l<h;l++)d[l]=d[l]>>>1^-(1&d[l]);return d}function vst(d,l){switch(l){case"uint32":return d;case"uint16":for(let h=0;h<d.length;h+=2){const m=d[h],_=d[h+1];d[h]=(240&m)>>4|(61440&m)>>8|(240&_)<<4|61440&_,d[h+1]=15&m|(3840&m)>>4|(15&_)<<8|(3840&_)<<4}return d;case"uint8":for(let h=0;h<d.length;h+=4){const m=d[h],_=d[h+1],S=d[h+2],T=d[h+3];d[h+0]=(192&m)>>6|(192&_)>>4|(192&S)>>2|192&T,d[h+1]=(48&m)>>4|(48&_)>>2|48&S|(48&T)<<2,d[h+2]=(12&m)>>2|12&_|(12&S)<<2|(12&T)<<4,d[h+3]=3&m|(3&_)<<2|(3&S)<<4|(3&T)<<6}return d;default:throw new Error(`Invalid pixel format, "${l}"`)}}li(G2,"DEMData"),li(fU,"DemMinMaxQuadTree",{omit:["dem"]});var Ul=Uint8Array,tb=Uint16Array,_st=Int32Array,gU=new Ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mU=new Ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yst=new Ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vU=function(d,l){for(var h=new tb(31),m=0;m<31;++m)h[m]=l+=1<<d[m-1];var _=new _st(h[30]);for(m=1;m<30;++m)for(var S=h[m];S<h[m+1];++S)_[S]=S-h[m]<<5|m;return{b:h,r:_}},_U=vU(gU,2),yU=_U.b,xst=_U.r;yU[28]=258,xst[258]=28;for(var bst=vU(mU,0).b,xU=new tb(32768),Fa=0;Fa<32768;++Fa){var uy=(43690&Fa)>>1|(21845&Fa)<<1;xU[Fa]=((65280&(uy=(61680&(uy=(52428&uy)>>2|(13107&uy)<<2))>>4|(3855&uy)<<4))>>8|(255&uy)<<8)>>1}var eb=function(d,l,h){for(var m=d.length,_=0,S=new tb(l);_<m;++_)d[_]&&++S[d[_]-1];var T,C=new tb(l);for(_=1;_<l;++_)C[_]=C[_-1]+S[_-1]<<1;T=new tb(1<<l);var L=15-l;for(_=0;_<m;++_)if(d[_])for(var k=_<<4|d[_],F=l-d[_],V=C[d[_]-1]++<<F,U=V|(1<<F)-1;V<=U;++V)T[xU[V]>>L]=k;return T},ib=new Ul(288);for(Fa=0;Fa<144;++Fa)ib[Fa]=8;for(Fa=144;Fa<256;++Fa)ib[Fa]=9;for(Fa=256;Fa<280;++Fa)ib[Fa]=7;for(Fa=280;Fa<288;++Fa)ib[Fa]=8;var bU=new Ul(32);for(Fa=0;Fa<32;++Fa)bU[Fa]=5;var wst=eb(ib,9),Sst=eb(bU,5),kP=function(d){for(var l=d[0],h=1;h<d.length;++h)d[h]>l&&(l=d[h]);return l},ec=function(d,l,h){var m=l/8|0;return(d[m]|d[m+1]<<8)>>(7&l)&h},OP=function(d,l){var h=l/8|0;return(d[h]|d[h+1]<<8|d[h+2]<<16)>>(7&l)},Tst=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ic=function(d,l,h){var m=new Error(l||Tst[d]);if(m.code=d,Error.captureStackTrace&&Error.captureStackTrace(m,ic),!h)throw m;return m},Ast=new Ul(0),Ist=typeof TextDecoder<"u"&&new TextDecoder;try{Ist.decode(Ast,{stream:!0})}catch{}const Cst={gzip_data:"gzip"};class pu extends Error{constructor(l){super(l),this.name="MRTError"}}const Mst={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},wU={uint32:1,uint16:2,uint8:4},Est={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let zP;class H2{constructor(l=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=l}getLayer(l){const h=this.layers[l];if(!h)throw new pu(`Layer '${l}' not found`);return h}getHeaderLength(l){const h=new Uint8Array(l),m=new DataView(l);if(h[0]!==13)throw new pu("File is not a valid MRT.");return m.getUint32(1,!0)}parseHeader(l){const h=new Uint8Array(l),m=this.getHeaderLength(l);if(h.length<m)throw new pu(`Expected header with length >= ${m} but got buffer of length ${h.length}`);const _=new zP(h.subarray(0,m)).readFields(sst,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==_.x||this.y!==_.y||this.z!==_.z))throw new pu(`Invalid attempt to parse header ${_.z}/${_.x}/${_.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=_.x,this.y=_.y,this.z=_.z;for(const S of _.layers)this.layers[S.name]=new SU(S,{cacheSize:this._cacheSize});return this}createDecodingTask(l){const h=[],m=this.getLayer(l.layerName);for(let _ of l.blockIndices){const S=m.dataIndex[_],T=S.firstByte-l.firstByte,C=S.lastByte-l.firstByte;if(m._blocksInProgress.has(_))continue;const L={layerName:m.name,firstByte:T,lastByte:C,pixelFormat:m.pixelFormat,blockIndex:_,blockShape:[S.bands.length].concat(m.bandShape),buffer:m.buffer,codec:S.codec.codec,filters:S.filters.map(k=>k.filter)};m._blocksInProgress.add(_),h.push(L)}return new TU(h,()=>{h.forEach(_=>m._blocksInProgress.delete(_.blockIndex))},(_,S)=>{if(h.forEach(T=>m._blocksInProgress.delete(T.blockIndex)),_)throw _;S.forEach(T=>{this.getLayer(T.layerName).processDecodedData(T)})})}}class SU{constructor({version:l,name:h,units:m,tileSize:_,pixelFormat:S,buffer:T,dataIndex:C},L){if(this.version=l,this.version!==1)throw new pu(`Cannot parse raster layer encoded with MRT version ${l}`);this.name=h,this.units=m,this.tileSize=_,this.buffer=T,this.pixelFormat=Mst[S],this.dataIndex=C,this.bandShape=[_+2*T,_+2*T,wU[this.pixelFormat]],this._decodedBlocks=new U2(L?L.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return wU[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:l})=>l).flat()}processDecodedData(l){const h=l.blockIndex.toString();this._decodedBlocks.get(h)||this._decodedBlocks.put(h,l.data)}getBlockForBand(l){let h=0;switch(typeof l){case"string":for(const[m,_]of this.dataIndex.entries()){for(const[S,T]of _.bands.entries())if(T===l)return{bandIndex:h+S,blockIndex:m,blockBandIndex:S};h+=_.bands.length}break;case"number":for(const[m,_]of this.dataIndex.entries()){if(l>=h&&l<h+_.bands.length)return{bandIndex:l,blockIndex:m,blockBandIndex:l-h};h+=_.bands.length}break;default:throw new pu(`Invalid band \`${JSON.stringify(l)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(l){let h=1/0,m=-1/0;const _=[],S=new Set;for(const T of l){const{blockIndex:C}=this.getBlockForBand(T);if(C<0)throw new pu(`Invalid band: ${JSON.stringify(T)}`);const L=this.dataIndex[C];_.includes(C)||_.push(C),S.add(C),h=Math.min(h,L.firstByte),m=Math.max(m,L.lastByte)}if(S.size>this.cacheSize)throw new pu(`Number of blocks to decode (${S.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:h,lastByte:m,blockIndices:_}}hasBand(l){const{blockIndex:h}=this.getBlockForBand(l);return h>=0}hasDataForBand(l){const{blockIndex:h}=this.getBlockForBand(l);return h>=0&&!!this._decodedBlocks.get(h.toString())}getBandView(l){const{blockIndex:h,blockBandIndex:m}=this.getBlockForBand(l);if(h<0)throw new pu(`Band not found: ${JSON.stringify(l)}`);const _=this._decodedBlocks.get(h.toString());if(!_)throw new pu(`Data for band ${JSON.stringify(l)} of layer "${this.name}" not decoded.`);const S=this.dataIndex[h],T=this.bandShape.reduce((k,F)=>k*F,1),C=m*T,L=_.subarray(C,C+T);return{data:L,bytes:new Uint8Array(L.buffer).subarray(L.byteOffset,L.byteOffset+L.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:S.offset,scale:S.scale}}}H2.setPbf=function(d){zP=d};class TU{constructor(l,h,m){this.tasks=l,this._onCancel=h,this._onComplete=m,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(l,h){this._finalized||(this._onComplete(l,h),this._finalized=!0)}}H2.performDecoding=function(d,l){const h=new Uint8Array(d);return Promise.all(l.tasks.map(m=>{const{layerName:_,firstByte:S,lastByte:T,pixelFormat:C,blockShape:L,blockIndex:k,filters:F,codec:V}=m,U=h.subarray(S,T+1),$=new Uint32Array(L[0]*L[1]*L[2]);let Z;if(V!=="gzip_data")throw new pu(`Unhandled codec: ${V}`);return Z=function(Q,et){if(!globalThis.DecompressionStream&&et==="gzip_data")return Promise.resolve(((yt=function(Ot){Ot[0]==31&&Ot[1]==139&&Ot[2]==8||ic(6,"invalid gzip data");var Ut=Ot[3],Ht=10;4&Ut&&(Ht+=2+(Ot[10]|Ot[11]<<8));for(var se=(Ut>>3&1)+(Ut>>4&1);se>0;se-=!Ot[Ht++]);return Ht+(2&Ut)}(mt=Q))+8>mt.length&&ic(6,"invalid gzip data"),function(Ot,Ut,Ht,se){var Kt=Ot.length;if(!Kt||Ut.f&&!Ut.l)return Ht||new Ul(0);var ue=!Ht,me=ue||Ut.i!=2,Te=Ut.i;ue&&(Ht=new Ul(3*Kt));var Be,De,_e=function(qn){var Cn=Ht.length;if(qn>Cn){var mn=new Ul(Math.max(2*Cn,qn));mn.set(Ht),Ht=mn}},Ee=Ut.f||0,ae=Ut.p||0,re=Ut.b||0,Ie=Ut.l,Re=Ut.d,we=Ut.m,si=Ut.n,ci=8*Kt;do{if(!Ie){Ee=ec(Ot,ae,1);var ri=ec(Ot,ae+1,3);if(ae+=3,!ri){var Xe=Ot[(Ct=4+((ae+7)/8|0))-4]|Ot[Ct-3]<<8,ji=Ct+Xe;if(ji>Kt){Te&&ic(0);break}me&&_e(re+Xe),Ht.set(Ot.subarray(Ct,ji),re),Ut.b=re+=Xe,Ut.p=ae=8*ji,Ut.f=Ee;continue}if(ri==1)Ie=wst,Re=Sst,we=9,si=5;else if(ri==2){var Qe=ec(Ot,ae,31)+257,Ci=ec(Ot,ae+10,15)+4,Zi=Qe+ec(Ot,ae+5,31)+1;ae+=14;for(var fr=new Ul(Zi),Pr=new Ul(19),qi=0;qi<Ci;++qi)Pr[yst[qi]]=ec(Ot,ae+3*qi,7);ae+=3*Ci;var Br=kP(Pr),Fr=(1<<Br)-1,Fn=eb(Pr,Br);for(qi=0;qi<Zi;){var Ct,St=Fn[ec(Ot,ae,Fr)];if(ae+=15&St,(Ct=St>>4)<16)fr[qi++]=Ct;else{var he=0,je=0;for(Ct==16?(je=3+ec(Ot,ae,3),ae+=2,he=fr[qi-1]):Ct==17?(je=3+ec(Ot,ae,7),ae+=3):Ct==18&&(je=11+ec(Ot,ae,127),ae+=7);je--;)fr[qi++]=he}}var de=fr.subarray(0,Qe),Je=fr.subarray(Qe);we=kP(de),si=kP(Je),Ie=eb(de,we),Re=eb(Je,si)}else ic(1);if(ae>ci){Te&&ic(0);break}}me&&_e(re+131072);for(var vi=(1<<we)-1,gi=(1<<si)-1,Ji=ae;;Ji=ae){var Ri=(he=Ie[OP(Ot,ae)&vi])>>4;if((ae+=15&he)>ci){Te&&ic(0);break}if(he||ic(2),Ri<256)Ht[re++]=Ri;else{if(Ri==256){Ji=ae,Ie=null;break}var di=Ri-254;Ri>264&&(di=ec(Ot,ae,(1<<(Oi=gU[qi=Ri-257]))-1)+yU[qi],ae+=Oi);var zr=Re[OP(Ot,ae)&gi],ln=zr>>4;if(zr||ic(3),ae+=15&zr,Je=bst[ln],ln>3){var Oi=mU[ln];Je+=OP(Ot,ae)&(1<<Oi)-1,ae+=Oi}if(ae>ci){Te&&ic(0);break}me&&_e(re+131072);var Mr=re+di;if(re<Je){var un=0-Je,Yr=Math.min(Je,Mr);for(un+re<0&&ic(3);re<Yr;++re)Ht[re]=(void 0)[un+re]}for(;re<Mr;++re)Ht[re]=Ht[re-Je]}}Ut.l=Ie,Ut.p=Ji,Ut.b=re,Ut.f=Ee,Ie&&(Ee=1,Ut.m=we,Ut.d=Re,Ut.n=si)}while(!Ee);return re!=Ht.length&&ue?(Be=Ht,((De=re)==null||De>Be.length)&&(De=Be.length),new Ul(Be.subarray(0,De))):Ht.subarray(0,re)}(mt.subarray(yt,-8),{i:2},new Ul(((nt=mt)[(dt=nt.length)-4]|nt[dt-3]<<8|nt[dt-2]<<16|nt[dt-1]<<24)>>>0))));var nt,dt,mt,yt;const Lt=Cst[et];if(!Lt)throw new Error(`Unhandled codec: ${et}`);const It=new globalThis.DecompressionStream(Lt);return new Response(new Blob([Q]).stream().pipeThrough(It)).arrayBuffer().then(Ot=>new Uint8Array(Ot))}(U,V).then(Q=>(function(et,nt){et.readFields(fst,nt)}(new zP(Q),$),new Est[C]($.buffer))),Z.then(Q=>{for(let et=F.length-1;et>=0;et--)switch(F[et]){case"delta_filter":gst(Q,L);break;case"zigzag_filter":mst(Q);break;case"bitshuffle_filter":vst(Q,C);break;default:throw new pu(`Unhandled filter "${F[et]}"`)}return{layerName:_,blockIndex:k,data:Q}}).catch(Q=>{throw Q})}))},li(TU,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),li(H2,"MapboxRasterTile"),li(SU,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class AU{constructor(l){this._stringToNumber={},this._numberToString=[];for(let h=0;h<l.length;h++){const m=l[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(l){return this._stringToNumber[l]}decode(l){return this._numberToString[l]}}class IU{constructor(l,h){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Uh(Ve,16,0),this.featureIndexArray=new UT,this.promoteId=h,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(l,h,m,_,S,T=0,C=0){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,_,S,T);const k=this.grid;for(let F=0;F<h.length;F++){const V=h[F],U=[1/0,1/0,-1/0,-1/0];for(let $=0;$<V.length;$++){const Z=V[$];U[0]=Math.min(U[0],Z.x),U[1]=Math.min(U[1],Z.y),U[2]=Math.max(U[2],Z.x),U[3]=Math.max(U[3],Z.y)}C!==0&&(U[0]-=C,U[1]-=C,U[2]+=C,U[3]+=C),U[0]<Ve&&U[1]<Ve&&U[2]>=0&&U[3]>=0&&k.insert(L,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hi(new y2(this.rawTileData)).layers,this.sourceLayerCoder=new AU(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const l in this.vtLayers)this.vtFeatures[l]=[]}return this.vtLayers}query(l,h){const{tilespaceGeometry:m,transform:_,tileTransform:S,pixelPosMatrix:T,availableImages:C,worldview:L}=h;this.loadVTLayers(),this.serializedLayersCache.clear();const k=h.queryRadius?h.queryRadius:0,F=m.bufferedTilespaceBounds,V=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,(Q,et,nt,dt)=>$n(m.bufferedTilespaceGeometry,Q-k,et-k,nt+k,dt+k));V.sort(Dst);let U=null;_.elevation&&V.length>0&&(U=oy.create(_.elevation,this.tileID));const $={};let Z;for(let Q=0;Q<V.length;Q++){const et=V[Q];if(et===Z)continue;Z=et;const nt=this.featureIndexArray.get(et);let dt=null;this.is3DTile?this.loadMatchingModelFeature($,nt,l,m,_,L):this.loadMatchingFeature($,nt,l,C,L,(mt,yt,Lt,It=0)=>(dt||(dt=pe(mt,this.tileID.canonical,S)),yt.queryIntersectsFeature(m,mt,Lt,dt,this.z,_,T,U,It)))}return $}loadMatchingFeature(l,h,m,_,S,T){const{featureIndex:C,bucketIndex:L,sourceLayerIndex:k,layoutVertexArrayOffset:F}=h,V=this.bucketLayerIDs[L],U=m.layers,$=Object.keys(U);if($.length&&!Gi($,V))return;const Z=m.sourceCache,Q=this.sourceLayerCoder.decode(k),et=this.vtLayers[Q].feature(C),nt=this.getId(et,Q);for(let dt=0;dt<V.length;dt++){const mt=V[dt];if(!U[mt])continue;const{styleLayer:yt,targets:Lt}=U[mt];let It={};nt!==void 0&&(It=Z.getFeatureState(yt.sourceLayer,nt));const Ot=!T||T(et,yt,It,F);if(!Ot)continue;const Ut=new qg(et,this.z,this.x,this.y,nt);Ut.tile=this.tileID.canonical,Ut.state=It;let Ht=this.serializedLayersCache.get(mt);Ht||(Ht=yt.serialize(),Ht.id=mt,this.serializedLayersCache.set(mt,Ht)),Ut.source=Ht.source,Ut.sourceLayer=Ht["source-layer"],Ut.layer=Object.assign({},Ht),Ut.layer.paint=CU(Ht.paint,yt.paint,et,It,_),Ut.layer.layout=CU(Ht.layout,yt.layout,et,It,_);let se=!1;for(const Kt of Lt){this.updateFeatureProperties(Ut,Kt);const{filter:ue}=Kt;if(ue){if(et.properties=Ut.properties,ue.needGeometry){const me=ee(et,!0);if(!ue.filter(new xn(this.tileID.overscaledZ,{worldview:S}),me,this.tileID.canonical))continue}else if(!ue.filter(new xn(this.tileID.overscaledZ,{worldview:S}),et))continue}se=!0,Kt.targetId&&this.addFeatureVariant(Ut,Kt)}se&&this.appendToResult(l,mt,C,Ut,Ot)}}loadMatchingModelFeature(l,h,m,_,S,T){const{featureIndex:C,bucketIndex:L}=h,k=this.bucketLayerIDs[L],F=m.layers,V=Object.keys(F);if(!V.length||Gi(V,k))for(let U=0;U<k.length;U++){const $=k[U],{styleLayer:Z,targets:Q}=F[$];if(Z.type!=="model")continue;const et=_.tile,nt=et.getBucket(Z);if(!(nt&&nt instanceof z2))continue;const dt=zot(nt,C,_,S);if(!dt)continue;const{z:mt,x:yt,y:Lt}=et.tileID.canonical,{feature:It,intersectionZ:Ot,position:Ut}=dt;let Ht={};It.id!==void 0&&(Ht=m.sourceCache.getFeatureState(Z.sourceLayer,It.id));const se=new qg({},mt,yt,Lt,It.id);se.tile=this.tileID.canonical,se.state=Ht,se.properties=It.properties,se.geometry={type:"Point",coordinates:[Ut.lng,Ut.lat]};let Kt=this.serializedLayersCache.get($);Kt||(Kt=Z.serialize(),Kt.id=$,this.serializedLayersCache.set($,Kt)),se.source=Kt.source,se.sourceLayer=Kt["source-layer"],se.layer=Object.assign({},Kt);let ue=!1;for(const me of Q){this.updateFeatureProperties(se,me);const{filter:Te}=me;if(Te){if(It.properties=se.properties,Te.needGeometry){if(!Te.filter(new xn(this.tileID.overscaledZ,{worldview:T}),It,this.tileID.canonical))continue}else if(!Te.filter(new xn(this.tileID.overscaledZ,{worldview:T}),It))continue}ue=!0,me.targetId&&this.addFeatureVariant(se,me)}ue&&this.appendToResult(l,$,C,se,Ot)}}updateFeatureProperties(l,h,m){if(h.properties){const _={};for(const S in h.properties){const T=h.properties[S].evaluate({zoom:this.z},l._vectorTileFeature,l.state,l.tile,m);T!=null&&(_[S]=T)}l.properties=_}}addFeatureVariant(l,h,m){const _={target:h.target,namespace:h.namespace,uniqueFeatureID:h.uniqueFeatureID};h.properties&&(_.properties=l.properties),l.variants=l.variants||{},l.variants[h.targetId]=l.variants[h.targetId]||[],l.variants[h.targetId].push(_)}appendToResult(l,h,m,_,S){let T=l[h];T===void 0&&(T=l[h]=[]),T.push({featureIndex:m,feature:_,intersectionZ:S})}lookupSymbolFeatures(l,h,m,_,S,T){const C={};this.loadVTLayers();for(const L of l)this.loadMatchingFeature(C,{bucketIndex:h,sourceLayerIndex:m,featureIndex:L,layoutVertexArrayOffset:0},_,S,T);return C}loadFeature(l){const{featureIndex:h,sourceLayerIndex:m}=l;this.loadVTLayers();const _=this.sourceLayerCoder.decode(m),S=this.vtFeatures[_];if(S[h])return S[h];const T=this.vtLayers[_].feature(h);return S[h]=T,T}hasLayer(l){for(const h of this.bucketLayerIDs)for(const m of h)if(l===m)return!0;return!1}getId(l,h){let m=l.id;if(this.promoteId){const _=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[h];if(_!=null)if(Array.isArray(_)){if(!this.promoteIdExpression){const S=hu(_);if(S.result!=="success"){const T=S.value.map(C=>`${C.key}: ${C.message}`).join(", ");return void Mi(`Failed to create expression for promoteId: ${T}`)}this.promoteIdExpression=S.value}m=this.promoteIdExpression.evaluate({zoom:0},l)}else m=l.properties[_];typeof m=="boolean"&&(m=Number(m))}return m}}function CU(d,l,h,m,_){return Oe(d,(S,T)=>{const C=l instanceof Gh?l.get(T):null;return C&&C.evaluate?C.evaluate(h,m,void 0,_):C})}function Dst(d,l){return l-d}li(IU,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const MU=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class BP{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(l,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=m>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const S=MU[15&m];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(l,2,1),[C]=new Uint32Array(l,4,1);return new BP(C,T,S,l)}constructor(l,h=64,m=Float64Array,_){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const S=MU.indexOf(this.ArrayType),T=2*l*this.ArrayType.BYTES_PER_ELEMENT,C=l*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-C%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+C+L,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+T+C+L),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+C+L,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=l)}add(l,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=l,this.coords[this._pos++]=h,m}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return FP(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,h,m,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:C}=this,L=[0,S.length-1,0],k=[];for(;L.length;){const F=L.pop()||0,V=L.pop()||0,U=L.pop()||0;if(V-U<=C){for(let et=U;et<=V;et++){const nt=T[2*et],dt=T[2*et+1];nt>=l&&nt<=m&&dt>=h&&dt<=_&&k.push(S[et])}continue}const $=U+V>>1,Z=T[2*$],Q=T[2*$+1];Z>=l&&Z<=m&&Q>=h&&Q<=_&&k.push(S[$]),(F===0?l<=Z:h<=Q)&&(L.push(U),L.push($-1),L.push(1-F)),(F===0?m>=Z:_>=Q)&&(L.push($+1),L.push(V),L.push(1-F))}return k}within(l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:S,nodeSize:T}=this,C=[0,_.length-1,0],L=[],k=m*m;for(;C.length;){const F=C.pop()||0,V=C.pop()||0,U=C.pop()||0;if(V-U<=T){for(let et=U;et<=V;et++)DU(S[2*et],S[2*et+1],l,h)<=k&&L.push(_[et]);continue}const $=U+V>>1,Z=S[2*$],Q=S[2*$+1];DU(Z,Q,l,h)<=k&&L.push(_[$]),(F===0?l-m<=Z:h-m<=Q)&&(C.push(U),C.push($-1),C.push(1-F)),(F===0?l+m>=Z:h+m>=Q)&&(C.push($+1),C.push(V),C.push(1-F))}return L}}function FP(d,l,h,m,_,S){if(_-m<=h)return;const T=m+_>>1;EU(d,l,T,m,_,S),FP(d,l,h,m,T-1,1-S),FP(d,l,h,T+1,_,1-S)}function EU(d,l,h,m,_,S){for(;_>m;){if(_-m>600){const k=_-m+1,F=h-m+1,V=Math.log(k),U=.5*Math.exp(2*V/3),$=.5*Math.sqrt(V*U*(k-U)/k)*(F-k/2<0?-1:1);EU(d,l,h,Math.max(m,Math.floor(h-F*U/k+$)),Math.min(_,Math.floor(h+(k-F)*U/k+$)),S)}const T=l[2*h+S];let C=m,L=_;for(rb(d,l,m,h),l[2*_+S]>T&&rb(d,l,m,_);C<L;){for(rb(d,l,C,L),C++,L--;l[2*C+S]<T;)C++;for(;l[2*L+S]>T;)L--}l[2*m+S]===T?rb(d,l,m,L):(L++,rb(d,l,L,_)),L<=h&&(m=L+1),h<=L&&(_=L-1)}}function rb(d,l,h,m){NP(d,h,m),NP(l,2*h,2*m),NP(l,2*h+1,2*m+1)}function NP(d,l,h){const m=d[l];d[l]=d[h],d[h]=m}function DU(d,l,h,m){const _=d-h,S=l-m;return _*_+S*S}a.$=Zv,a.A=Gu,a.B=Hh,a.C=2,a.D=Z_,a.E=Vu,a.F=N1,a.G=i4,a.H=$v,a.I=Ba,a.J=Yx,a.K=Qd,a.L=mg,a.M=v_,a.N=m_,a.O=Bx,a.P=Me,a.Q=b_,a.R=Dh,a.S=_f,a.T=XD,a.U=hu,a.V=O2,a.W=Nx,a.X=lf,a.Y=sf,a.Z=wg,a._=Go,a.a=function(d){return An.API_CDN_URL_REGEX.test(d)},a.a$=wf,a.a0=Ni,a.a1=lx,a.a2=yf,a.a3=class extends O2{},a.a4=__,a.a5=zx,a.a6=Yt,a.a7=function(d){const l=d.value;return l?Ni(l)?AP(l,!0)?[]:[new O2(d.key,l,`invalid url "${l}"`)]:[new O2(d.key,l,`string expected, "${Qd(l)}" found`)]:[]},a.a8=DT,a.a9=Kn,a.aA=lt,a.aB=z,a.aC=Li,a.aD=ds,a.aE=qa,a.aF=ht,a.aG=oe,a.aH=function(d,l){const h={};for(let m=0;m<l.length;m++){const _=l[m];_ in d&&(h[_]=d[_])}return h},a.aI=W,a.aJ=st,a.aK=class{constructor(d){this.entries={},this.scheduler=d}request(d,l,h,m){const _=this.entries[d]=this.entries[d]||{callbacks:[]};if(_.result){const[S,T]=_.result;return this.scheduler?this.scheduler.add(()=>{m(S,T)},l):m(S,T),()=>{}}return _.callbacks.push(m),_.cancel||(_.cancel=h((S,T)=>{_.result=[S,T];for(const C of _.callbacks)this.scheduler?this.scheduler.add(()=>{C(S,T)},l):C(S,T);setTimeout(()=>delete this.entries[d],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(S=>S!==m),_.callbacks.length||(_.cancel(),delete this.entries[d]))}}},a.aL=function(d,l,h){const m=JSON.stringify(d.request);return d.data&&(this.deduped.entries[m]={result:[null,d.data]}),this.deduped.request(m,{type:"parseTile",isSymbolTile:d.isSymbolTile,zoom:d.tileZoom},_=>{const S=qd(d.request,(T,C,L)=>{T?_(T):C&&_(null,{vectorTile:h?void 0:new hi(new y2(C)),rawData:C,responseHeaders:new Map(L.entries())})});return()=>{S.cancel(),_()}},l)},a.aM=function(d){return d?{cacheControl:d.get("Cache-Control"),expires:d.get("Expires")}:{cacheControl:void 0,expires:void 0}},a.aN=function(d){Uv++,Uv>us&&(d.getActor().send("enforceCacheSizeLimit",tg),Uv=0)},a.aO=function(d){return d<=1?1:Math.pow(2,Math.floor(Math.log2(d)))},a.aP=ja,a.aQ=P4,a.aR=B4,a.aS=X,a.aT=D4,a.aU=function(d,l){const h=document.createElement("video");h.muted=!0,h.onloadstart=function(){l(null,h)};for(let m=0;m<d.length;m++){const _=document.createElement("source");Ur(d[m])||(h.crossOrigin="Anonymous"),_.src=d[m],h.appendChild(_)}return{cancel:()=>{}}},a.aV=k1,a.aW=Xg,a.aX=ie,a.aY=H1,a.aZ=xt,a.a_=vt,a.aa=Pe,a.ab=class{constructor(d){this.specification=d}possiblyEvaluate(d,l){return nn(d.expression.evaluate(l))}interpolate(d,l,h){return{x:zi(d.x,l.x,h),y:zi(d.y,l.y,h),z:zi(d.z,l.z,h),azimuthal:zi(d.azimuthal,l.azimuthal,h),polar:zi(d.polar,l.polar,h)}}},a.ac=xn,a.ad=Pc,a.ae=qt,a.af=Bt,a.ag=Et,a.ah=Tt,a.ai=Gh,a.aj=Lf,a.ak=zi,a.al=Ve,a.am=cg,a.an=wr,a.ao=Xr,a.ap=class{constructor(d){this.specification=d}possiblyEvaluate(d,l){return function([h,m]){const _=nn([1,h,m]);return{x:_.x,y:_.y,z:_.z}}(d.expression.evaluate(l))}interpolate(d,l,h){return{x:zi(d.x,l.x,h),y:zi(d.y,l.y,h),z:zi(d.z,l.z,h)}}},a.aq=function(d,l,h=0,m=!0){const _=new Me(h,h),S=d.sub(_),T=l.add(_),C=[S,new Me(T.x,S.y),T,new Me(S.x,T.y)];return m&&C.push(S.clone()),C},a.ar=function(d,l){const h=[];for(let m=0;m<d.length;m++){const _=Nt(m-1,-1,d.length-1),S=Nt(m+1,-1,d.length-1),T=d[m],C=d[S],L=d[_].sub(T).unit(),k=C.sub(T).unit(),F=k.angleWithSep(L.x,L.y),V=L.add(k).unit().mult(-1*l/Math.sin(F/2));h.push(T.add(V))}return h},a.as=g4,a.at=$n,a.au=function(d,l,h=0){return bt(((l.x-h)*d.scale-d.x)*Ve,(l.y*d.scale-d.y)*Ve,Pt(l.z,l.y))},a.av=qe,a.aw=xe,a.ax=ir,a.ay=EV,a.az=function(d){let l=1/0,h=1/0,m=-1/0,_=-1/0;for(const S of d)l=Math.min(l,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),_=Math.max(_,S.y);return{min:new Me(l,h),max:new Me(m,_)}},a.b=function(d){return An.API_FONTS_REGEX.test(d)},a.b$=BD,a.b0=Ln,a.b1=ne,a.b2=FT,a.b3=P2,a.b4=function(){As.isLoading()||As.isLoaded()||Zx()!=="deferred"||qx()},a.b5=C_,a.b6=ee,a.b7=qg,a.b8=wa,a.b9=rP,a.bA=J,a.bB=I,a.bC=function(d,l){const{x:h,y:m}=d.point,_=qN(h,m,d.worldSize/d._pixelsPerMercatorPixel,0,0);return z(_,_,TD(Fc(l)))},a.bD=g,a.bE=$e,a.bF=bi,a.bG=ni,a.bH=We,a.bI=Ke,a.bJ=ey,a.bK=el,a.bL=hP,a.bM=function(d,l,h,m,_){const S=5*l+2;d.float32[S+0]=h,d.float32[S+1]=m,d.float32[S+2]=_},a.bN=ay,a.bO=ou,a.bP=ls,a.bQ=to,a.bR=Nv,a.bS=Nt,a.bT=function(d,l,h,m){var _=new f(4);return _[0]=d,_[1]=l,_[2]=h,_[3]=m,_},a.bU=class{isDataAvailableAtPoint(d){const l=this._source();if(this.isUsingMockSource()||!l||d.y<0||d.y>1)return!1;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(d.x),S=Math.floor((d.x-_)*m),T=Math.floor(d.y*m),C=this.findDEMTileFor(new ja(h,_,h,S,T));return!(!C||!C.dem)}getAtPointOrZero(d,l=0){return this.getAtPoint(d,l)||0}getAtPoint(d,l,h=!0){if(this.isUsingMockSource())return null;l==null&&(l=null);const m=this._source();if(!m||d.y<0||d.y>1)return l;const _=m.getSource().maxzoom,S=1<<_,T=Math.floor(d.x),C=d.x-T,L=new ja(_,T,_,Math.floor(C*S),Math.floor(d.y*S)),k=this.findDEMTileFor(L);if(!k||!k.dem)return l;const F=k.dem,V=1<<k.tileID.canonical.z,U=(C*V-k.tileID.canonical.x)*F.dim,$=(d.y*V-k.tileID.canonical.y)*F.dim,Z=Math.floor(U),Q=Math.floor($);return(h?this.exaggeration():1)*zi(zi(F.get(Z,Q),F.get(Z,Q+1),$-Q),zi(F.get(Z+1,Q),F.get(Z+1,Q+1),$-Q),U-Z)}static getAtTileOffset(d,l,h,m){const _=1<<d.canonical.z;return m?m.pointElevation(l):h?h.getAtPointOrZero(new qt(d.wrap+(d.canonical.x+l.x/Ve)/_,(d.canonical.y+l.y/Ve)/_)):0}static getAtTileOffsetFunc(d,l,h,m){return(_,S,T)=>{const C=this.getAtTileOffset(d,_,S,T),L=m.upVector(d.canonical,_.x,_.y);return ke(L,L,C*m.upVectorScale(d.canonical,l,h).metersToTile),L}}getForTilePoints(d,l,h,m){if(this.isUsingMockSource())return!1;const _=oy.create(this,d,m);return!!_&&(l.forEach(S=>{S[2]=this.exaggeration()*_.getElevationAt(S[0],S[1],h)}),!0)}getMinMaxForTile(d){if(this.isUsingMockSource())return null;const l=this.findDEMTileFor(d);if(!l||!l.dem)return null;const h=l.dem.tree,m=l.tileID,_=1<<d.canonical.z-m.canonical.z;let S=d.canonical.x/_-m.canonical.x,T=d.canonical.y/_-m.canonical.y,C=0;for(let L=0;L<d.canonical.z-m.canonical.z&&!h.leaves[C];L++){S*=2,T*=2;const k=2*Math.floor(T)+Math.floor(S);C=h.childOffsets[C]+k,S%=1,T%=1}return{min:this.exaggeration()*h.minimums[C],max:this.exaggeration()*h.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(d,l,h){throw new Error("Pure virtual method called.")}pointCoordinate(d){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(d){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const d=this.visibleDemTiles;if(d.length===0)return null;let l=!1,h=Number.MAX_VALUE,m=Number.MIN_VALUE;for(const _ of d){const S=this.getMinMaxForTile(_.tileID);S&&(h=Math.min(h,S.min),m=Math.max(m,S.max),l=!0)}return l?{min:h,max:m}:null}},a.bV=l2,a.bW=ra,a.bX=no,a.bY=A5,a.bZ=F4,a.b_=E5,a.ba=kD,a.bb=pe,a.bc=hs,a.bd=O_,a.be=GN,a.bf=Un,a.bg=W_,a.bh=SP,a.bi=function(d,l){const h=Lf(l.zoom);if(h===0)return Fc(d);const m=KT(d),_=SD(m),S=ht(m.getWest())*l.worldSize,T=ht(m.getEast())*l.worldSize,C=st(m.getNorth())*l.worldSize,L=st(m.getSouth())*l.worldSize,k=[S,C,0],F=[T,C,0],V=[S,L,0],U=[T,L,0],$=R([],l.globeMatrix);return Bt(k,k,$),Bt(F,F,$),Bt(V,V,$),Bt(U,U,$),_[0]=qh(_[0],V,h),_[1]=qh(_[1],U,h),_[2]=qh(_[2],F,h),_[3]=qh(_[3],k,h),ur.fromPoints(_)},a.bj=QT,a.bk=R,a.bl=_1,a.bm=qh,a.bn=jh,a.bo=ent,a.bp=it,a.bq=N,a.br=H2,a.bs=y2,a.bt=qd,a.bu=function(d,l){const h=[];for(const m in d)m in l||h.push(m);return h},a.bv=Ft,a.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bx=Fu,a.by=E,a.bz=D,a.c=Uo,a.c$=function(d){return d*d*d*d*d},a.c0=uP,a.c1=u4,a.c2=mP,a.c3=BP,a.c4=ke,a.c5=Ii,a.c6=xr,a.c7=function(d,l,h){h*=.5;var m=l[0],_=l[1],S=l[2],T=l[3],C=Math.sin(h),L=Math.cos(h);return d[0]=m*L+_*C,d[1]=_*L-m*C,d[2]=S*L+T*C,d[3]=T*L-S*C,d},a.c8=tn,a.c9=ia,a.cA=Gr,a.cB=fV,a.cC=Js,a.cD=WN,a.cE=function(d,l,h,m,_,S,T,C,L){if(L.name==="globe")return WN(d,l,new Js(h,m,_),!1);const k=H1({z:h,x:m,y:_},L);return new ur([(S+k.x/k.scale)*l,l*(k.y/k.scale),T],[(S+k.x2/k.scale)*l,l*(k.y2/k.scale),C])},a.cF=function(d,l,h){return d[0]=Math.min(l[0],h[0]),d[1]=Math.min(l[1],h[1]),d[2]=Math.min(l[2],h[2]),d[3]=Math.min(l[3],h[3]),d},a.cG=function(d,l,h){return d[0]=Math.max(l[0],h[0]),d[1]=Math.max(l[1],h[1]),d[2]=Math.max(l[2],h[2]),d[3]=Math.max(l[3],h[3]),d},a.cH=function(d){const l=Math.round((d+45+360)%360/90)%4;return tx[l]},a.cI=wt,a.cJ=pi,a.cK=u,a.cL=function(d){const l=D(new Float64Array(16));z(l,d.pixelMatrix,d.globeMatrix);const h=[0,M,0],m=[0,P,0];return Bt(h,h,l),Bt(m,m,l),[h[0]>0&&h[0]<=d.width&&h[1]>0&&h[1]<=d.height&&!ID(d,new X(d.center.lat,90)),m[0]>0&&m[0]<=d.width&&m[1]>0&&m[1]<=d.height&&!ID(d,new X(d.center.lat,-90))]},a.cM=function(d,l){const{scale:h}=d.tileTransform,m=h*Ve/(d.tileSize*Math.pow(2,l.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return function(_,S,T){var C=S[1],L=S[2],k=S[3],F=T[0],V=T[1];return _[0]=S[0]*F,_[1]=C*F,_[2]=L*V,_[3]=k*V,_}(new Float32Array(4),l.inverseAdjustmentMatrix,[m,m])},a.cN=f2,a.cO=_t,a.cP=dV,a.cQ=function(d){const l=dV(d,!0);return g([],[l[0],l[1],l[4],l[5]])},a.cR=H,a.cS=Qr,a.cT=q,a.cU=function(d){const{x:l,y:h}=d.point,{lng:m,lat:_}=d._center;return qN(l,h,d.worldSize,m,_)},a.cV=ce,a.cW=Vo,a.cX=Qs,a.cY=na,a.cZ=x,a.c_=function(d,l,h){let m=0;for(let _=0;_<2;++_)d[_]>0&&(m+=(d[_]-0)*(d[_]-0)),l[_]<0&&(m+=(0-l[_])*(0-l[_]));return m},a.ca=function(d,l){return d[0]=-l[0],d[1]=-l[1],d[2]=-l[2],d[3]=l[3],d},a.cb=ft,a.cc=function(d,l,h,m,_){var S=1/Math.tan(l/2);if(d[0]=S/h,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=S,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,_!=null&&_!==1/0){var T=1/(m-_);d[10]=(_+m)*T,d[14]=2*_*m*T}else d[10]=-1,d[14]=-2*m;return d},a.cd=function(d,l,h,m,_,S,T){var C=1/(l-h),L=1/(m-_),k=1/(S-T);return d[0]=-2*C,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*L,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*k,d[11]=0,d[12]=(l+h)*C,d[13]=(_+m)*L,d[14]=(T+S)*k,d[15]=1,d},a.ce=gt,a.cf=function(d,l,h){d[4*l+0]=h[0],d[4*l+1]=h[1],d[4*l+2]=h[2],d[4*l+3]=h[3]},a.cg=U_,a.ch=Mf,a.ci=va,a.cj=du,a.ck=Ng,a.cl=x4,a.cm=function(){var d=new f(4);return f!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},a.cn=function(d,l,h){var m=l[0],_=l[1],S=l[2],T=l[3],C=Math.sin(h),L=Math.cos(h);return d[0]=m*L+S*C,d[1]=_*L+T*C,d[2]=m*-C+S*L,d[3]=_*-C+T*L,d},a.co=function(d,l){return d[0]===l[0]&&d[1]===l[1]&&d[2]===l[2]&&d[3]===l[3]},a.cp=He,a.cq=function(d){var l=d[0],h=d[1],m=d[2],_=d[3];return Math.sqrt(l*l+h*h+m*m+_*_)},a.cr=Io,a.cs=ge,a.ct=fu,a.cu=3,a.cv=2,a.cw=7,a.cx=6,a.cy=Ti,a.cz=ct,a.d=function(d){return An.API_TILEJSON_REGEX.test(d)},a.d$=KN,a.d0=rt,a.d1=45,a.d2=Fg,a.d3=function(d,l,h){const m=Math.sqrt(d*d+l*l+h*h),_=m>0?Math.acos(h/m)*Yp:0;let S=d!==0||l!==0?Math.atan2(-l,-d)*Yp+90:0;return S<0&&(S+=360),[m,S,_]},a.d4=bt,a.d5=nn,a.d6=kt,a.d7=zt,a.d8=ur,a.d9=Jt,a.dA=p1,a.dB=class extends Il{constructor(d){super(d),this.current=vD}set(d,l,h){if(this.fetchUniformLocation(d,l)){for(let m=0;m<9;m++)if(h[m]!==this.current[m]){this.current=h,this.gl.uniformMatrix3fv(this.location,!1,h);break}}}},a.dC=Kp,a.dD=function(d,l,h){const m=Lf(h.zoom),_=d.style.map._antialias,S=d.terrain&&d.terrain.exaggeration()>0;return m===0&&!_&&!S},a.dE=function(d){const l=d.pixelsPerMeter,h=l/gt(1,d.center.lat),m=D(new Float64Array(16));return N(m,m,[d.point.x,d.point.y,0]),H(m,m,[h,h,l]),Float32Array.from(m)},a.dF=KT,a.dG=function(d){const l=wt-5;d=lt(d,-l,l)/l*90;const h=Math.pow(Math.abs(Math.sin(wr(d))),3);return Math.round(h*(A.length-1))},a.dH=function(d,l,h,m){const _=l.getNorth(),S=l.getSouth(),T=l.getWest(),C=l.getEast(),L=1<<d.z,k=C-T,F=_-S,V=k/b,U=-F/A[h],$=[0,V,0,U,0,0,_,T,0];if(d.z>0){const Z=180/m;w($,$,[Z/k+1,0,0,0,Z/F+1,0,-.5*Z/V,.5*Z/U,1])}return $[2]=L,$[5]=d.x,$[8]=d.y,$},a.dI=Fc,a.dJ=function(d,l,h){const m=D(new Float64Array(16)),_=(l/(1<<d)-.5)*Math.PI*2;return Y(m,h.globeMatrix,_),Float32Array.from(m)},a.dK=s5,a.dL=YT,a.dM=function(d,l){return[Math.pow(d[0],2.2)*l,Math.pow(d[1],2.2)*l,Math.pow(d[2],2.2)*l]},a.dN=v,a.dO=function(d,l){var h=Math.sin(l),m=Math.cos(l);return d[0]=m,d[1]=h,d[2]=0,d[3]=-h,d[4]=m,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},a.dP=Zt,a.dQ=ZN,a.dR=Tn,a.dS=Wn,a.dT=256,a.dU=function(d,l){const h=[0,0,0];return Bt(h,h,QT(Fc(l.canonical))),Bt(h,h,d),h},a.dV=d=>({u_matrix:new Ng(d),u_texsize:new du(d),u_pixels_to_tile_units:new g1(d),u_device_pixel_ratio:new va(d),u_width_scale:new va(d),u_floor_width_scale:new va(d),u_image:new U_(d),u_units_to_pixels:new du(d),u_tile_units_to_pixels:new va(d),u_alpha_discard_threshold:new va(d),u_trim_offset:new du(d),u_trim_fade_range:new du(d),u_trim_color:new Fg(d),u_emissive_strength:new va(d),u_zbias_factor:new va(d),u_tile_to_meter:new va(d),u_ground_shadow_factor:new Mf(d),u_pattern_transition:new va(d)}),a.dW=d=>({u_matrix:new Ng(d),u_pixels_to_tile_units:new g1(d),u_device_pixel_ratio:new va(d),u_width_scale:new va(d),u_floor_width_scale:new va(d),u_units_to_pixels:new du(d),u_dash_image:new U_(d),u_gradient_image:new U_(d),u_image_height:new va(d),u_texsize:new du(d),u_tile_units_to_pixels:new va(d),u_alpha_discard_threshold:new va(d),u_trim_offset:new du(d),u_trim_fade_range:new du(d),u_trim_color:new Fg(d),u_emissive_strength:new va(d),u_zbias_factor:new va(d),u_tile_to_meter:new va(d),u_ground_shadow_factor:new Mf(d)}),a.dX=d=>({u_camera_to_center_distance:new va(d),u_extrude_scale:new g1(d),u_device_pixel_ratio:new va(d),u_matrix:new Ng(d),u_inv_rot_matrix:new Ng(d),u_merc_center:new du(d),u_tile_id:new Mf(d),u_zoom_transition:new va(d),u_up_dir:new Mf(d),u_emissive_strength:new va(d)}),a.dY=Tf,a.dZ=Gat,a.d_=class{constructor(d,l,h,m){this.context=d,this.format=m,this.size=h,this.texture=d.gl.createTexture();const[_,S,T]=this.size,{gl:C}=d;C.bindTexture(C.TEXTURE_3D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in l&&l.data&&C.texImage3D(C.TEXTURE_3D,0,this.format,_,S,T,0,ZD(this.format),qD(this.format),l.data)}bind(d,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_3D,this.texture),d!==this.minFilter&&(m.texParameteri(m.TEXTURE_3D,m.TEXTURE_MAG_FILTER,d),m.texParameteri(m.TEXTURE_3D,m.TEXTURE_MIN_FILTER,d),this.minFilter=d),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_3D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_3D,m.TEXTURE_WRAP_T,l),this.wrapS=l)}destroy(){const{gl:d}=this.context;d.deleteTexture(this.texture),this.texture=null}},a.da=function(d){return[Math.pow(d[0],1/2.2),Math.pow(d[1],1/2.2),Math.pow(d[2],1/2.2)]},a.db=hV,a.dc=eP,a.dd=mV,a.de=AP,a.df=function(d,l){return d.readFields(Not,{icons:[]},l)},a.dg=u2,a.dh=iy,a.di=fP,a.dj=rx,a.dk=ET,a.dl=Jp,a.dm=sg,a.dn=mi,a.dp=function(d){const l=d.indexOf(Lg);return l>=0?d.slice(0,l):d},a.dq=function(d){return d.indexOf(Lg)>=0},a.dr=function(d){const l=d.lastIndexOf(Lg);return l>=0?d.slice(l+1):""},a.ds=function(d){const l=[],h=d.id;return h===void 0&&l.push({message:`layers.${h}: missing required property "id"`}),d.render===void 0&&l.push({message:`layers.${h}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&l.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),l},a.dt=function(d,l,h,m){return d.type==="custom"?new Lot(d,l):new Bot[d.type](d,l,h,m)},a.du=Ce,a.dv=function(d){const l=d.indexOf(Lg);return l>=0?d.slice(l+1):""},a.dw=class extends qg{constructor(d,l){super(d._vectorTileFeature,d._z,d._x,d._y,d.id),d.state&&(this.state=Object.assign({},d.state)),this.target=l.target,this.namespace=l.namespace,l.properties&&(this.properties=l.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=d.source,this.sourceLayer=d.sourceLayer,this.layer=d.layer)}toJSON(){const d=super.toJSON();return d.target=this.target,d.namespace=this.namespace,d}},a.dx=$x,a.dy=eg,a.dz=function(d){return d({pluginStatus:Jo,pluginURL:kc}),$x.on("pluginStateChange",d),d},a.e=An,a.e$=function([d,l,h]){const m=Math.hypot(d,l,h),_=Math.atan2(d,h),S=.5*Math.PI-Math.acos(-l/m);return new X(Vo(_),Vo(S))},a.e0=(d,l,h,m,_,S)=>{const T=d.transform,C=T.projection.name==="globe";let L;if(S.paint.get("circle-pitch-alignment")==="map")if(C){const F=ZN(T.zoom,l.canonical)*T._pixelsPerMercatorPixel;L=Float32Array.from([F,0,0,F])}else L=T.calculatePixelsToTileUnitsMatrix(h);else L=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:d.transform.getCameraToCenterDistance(T.projection),u_matrix:d.translatePosMatrix(l.projMatrix,h,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ws.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:ont,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:S.paint.get("circle-emissive-strength")};if(C){k.u_inv_rot_matrix=m,k.u_merc_center=_,k.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],k.u_zoom_transition=Lf(T.zoom);const F=_[0]*Ve,V=_[1]*Ve;k.u_up_dir=T.projection.upVector(new Js(0,0,0),F,V)}return k},a.e1=RV,a.e2=cs,a.e3=(d,l,h,m,_,S,T,C,L,k)=>{const F=d.transform,V=F.pitch<15?DV(.07,.7,lt((14-F.zoom)/5,0,1)):.07,U=h.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:LV(d,l,h,m),u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:F.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:_,u_width_scale:S,u_floor_width_scale:T,u_image:0,u_tile_units_to_pixels:PV(l,F),u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:h.paint.get("line-trim-fade-range"),u_trim_color:h.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:h.lut).toArray01(),u_emissive_strength:h.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:kt(l.tileID.canonical,0),u_ground_shadow_factor:L,u_pattern_transition:k}},a.e4=(d,l,h,m,_,S,T,C,L,k)=>{const F=d.transform,V=F.calculatePixelsToTileUnitsMatrix(l),U=h.paint.get("line-trim-color-use-theme").constantOr("default")==="none",$=F.pitch<15?DV(.07,.7,lt((14-F.zoom)/5,0,1)):.07;return{u_matrix:LV(d,l,h,m),u_pixels_to_tile_units:V,u_device_pixel_ratio:S,u_width_scale:T,u_floor_width_scale:C,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:kV(h)&&l.lineAtlasTexture?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:PV(l,d.transform),u_alpha_discard_threshold:0,u_trim_offset:L,u_trim_fade_range:h.paint.get("line-trim-fade-range"),u_trim_color:h.paint.get("line-trim-color").toPremultipliedRenderColor(U?null:h.lut).toArray01(),u_emissive_strength:h.paint.get("line-emissive-strength"),u_zbias_factor:$,u_tile_to_meter:kt(l.tileID.canonical,0),u_ground_shadow_factor:k}},a.e5=$t,a.e6=y1,a.e7=Pt,a.e8=Zh,a.e9=s2,a.eA=MP,a.eB=m2,a.eC=g2,a.eD=[1,1,1],a.eE=oy,a.eF=_i,a.eG=function(d,l,h,m){var _=l[0],S=l[1],T=l[2],C=l[3];return d[0]=_+m*(h[0]-_),d[1]=S+m*(h[1]-S),d[2]=T+m*(h[2]-T),d[3]=C+m*(h[3]-C),d},a.eH=K_,a.eI=Al,a.eJ=Bc,a.eK=function(d,l,h,m,_,S,T,C,L,k,F,V,U,$,Z,Q){var et=new f(16);return et[0]=d,et[1]=l,et[2]=h,et[3]=m,et[4]=_,et[5]=S,et[6]=T,et[7]=C,et[8]=L,et[9]=k,et[10]=F,et[11]=V,et[12]=U,et[13]=$,et[14]=Z,et[15]=Q,et},a.eL=G,a.eM=s1,a.eN=kg,a.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Me(1/0,1/0),max:new Me(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(d,l=!1){const h=C5(new Me(0,0),new Me(Ve,Ve),d),m=[];if(l&&!OD(h,this._globalClipBounds))return m;for(const _ of this._activeRegions){if(_.hiddenByOverlap||!OD(h,_))continue;const S=Ont(_.min,_.max,d);m.push({min:S.min,max:S.max,sourceId:this._sourceIds[_.priority],footprint:_.footprint,footprintTileId:_.tileId,order:_.order,clipMask:_.clipMask,clipScope:_.clipScope})}return m}setSources(d){this._setSources(d.map(l=>({getSourceId:()=>l.cache.id,getFootprints:()=>{const h=[];for(const m of l.cache.getVisibleCoordinates()){const _=l.cache.getTile(m).buckets[l.layer];_&&_.updateFootprints(m.toUnwrapped(),h)}return h},getOrder:()=>l.order,getClipMask:()=>l.clipMask,getClipScope:()=>l.clipScope})))}_addSource(d){const l=d.getFootprints();if(l.length===0)return;const h=d.getOrder(),m=d.getClipMask(),_=d.getClipScope();for(const S of l){if(!S.footprint)continue;const T=C5(S.footprint.min,S.footprint.max,S.id);this._activeRegions.push({min:T.min,max:T.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:S.id,footprint:S.footprint,order:h,clipMask:m,clipScope:_})}this._sourceIds.push(d.getSourceId())}_computeReplacement(){this._activeRegions.sort((l,h)=>l.priority-h.priority||n2(l.min,h.min)||n2(l.max,h.max)||l.order-h.order||l.clipMask-h.clipMask||function(m,_){const S=(T,C)=>T+C;return m.length-_.length||m.reduce(S,"").localeCompare(_.reduce(S,""))}(l.clipScope,h.clipScope));let d=this._activeRegions.length!==this._prevRegions.length;if(!d){let l=0;for(;!d&&l!==this._activeRegions.length;){const h=this._activeRegions[l],m=this._prevRegions[l];d=h.priority!==m.priority||!I5(h,m)||h.order!==m.order||h.clipMask!==m.clipMask||!Fu(h.clipScope,m.clipScope),this._activeRegions[l].hiddenByOverlap=m.hiddenByOverlap,++l}}if(d){++this._updateTime;for(const h of this._activeRegions)h.order!==A1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,h.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,h.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,h.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,h.max.y));const l=h=>{const m=this._activeRegions;if(h>=m.length)return h;const _=m[h].priority;for(;h<m.length&&m[h].priority===_;)++h;return h};if(this._sourceIds.length>1){let h=0,m=l(h);for(;h!==m;){let _=h;const S=h;for(;_!==m;){const T=this._activeRegions[_];T.hiddenByOverlap=!1;for(let C=0;C<S;C++){const L=this._activeRegions[C];if(!L.hiddenByOverlap&&T.order===A1&&OD(T,L)&&(T.hiddenByOverlap=M5(T.footprint,T.tileId,L.footprint,L.tileId),T.hiddenByOverlap))break}++_}h=m,m=l(h)}}}}_setSources(d){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let l=d.length-1;l>=0;l--)this._addSource(d[l]);this._computeReplacement()}},a.eP=A1,a.eQ=class{constructor(d){this._createGrid(d),this._createPoles(d)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const d of this._poleSegments)d.destroy();for(const d of this._gridSegments)d.withSkirts.destroy(),d.withoutSkirts.destroy()}_fillGridMeshWithLods(d,l){const h=new hs,m=new Ln,_=[],S=d+1+2,T=l[0]+1,C=l[0]+1+(1+l.length),L=(k,F,V)=>{let U=k===S-1?k-2:k===0?k:k-1;return U+=V?24575:0,[U,F]};for(let k=0;k<S;++k)h.emplaceBack(...L(k,0,!0));for(let k=0;k<T;++k)for(let F=0;F<S;++F)h.emplaceBack(...L(F,k,(F===0||F===S-1)&&!0));for(let k=0;k<l.length;++k){const F=l[k];for(let V=0;V<S;++V)h.emplaceBack(...L(V,F,!0))}for(let k=0;k<l.length;++k){const F=m.length,V=l[k]+1+2,U=new Ln;for(let Q=0;Q<V-1;Q++){const et=Q===V-2,nt=et?S*(C-l.length+k-Q):S;for(let dt=0;dt<S-1;dt++){const mt=Q*S+dt;Q===0||et||dt===0||dt===S-2?(U.emplaceBack(mt+1,mt,mt+nt),U.emplaceBack(mt+nt,mt+nt+1,mt+1)):(m.emplaceBack(mt+1,mt,mt+nt),m.emplaceBack(mt+nt,mt+nt+1,mt+1))}}const $=Un.simpleSegment(0,F,h.length,m.length-F);for(let Q=0;Q<U.uint16.length;Q+=3)m.emplaceBack(U.uint16[Q],U.uint16[Q+1],U.uint16[Q+2]);const Z=Un.simpleSegment(0,F,h.length,m.length-F);_.push({withoutSkirts:$,withSkirts:Z})}return{vertices:h,indices:m,segments:_}}_createGrid(d){const l=this._fillGridMeshWithLods(b,A);this._gridSegments=l.segments,this._gridBuffer=d.createVertexBuffer(l.vertices,GN.members),this._gridIndexBuffer=d.createIndexBuffer(l.indices,!0)}_createPoles(d){const l=new Ln;for(let T=0;T<=b;T++)l.emplaceBack(0,T+1,T+2);this._poleIndexBuffer=d.createIndexBuffer(l,!0);const h=new $h,m=new $h,_=new $h,S=new $h;this._poleSegments=[];for(let T=0,C=0;T<x;T++){const L=360/(1<<T);h.emplaceBack(0,-ds,0,.5,0),m.emplaceBack(0,-ds,0,.5,1),_.emplaceBack(0,-ds,0,.5,.5),S.emplaceBack(0,-ds,0,.5,.5);for(let k=0;k<=b;k++){let F=k/b,V=0;const U=zi(0,L,F),[$,Z,Q]=O(nnt,ant,U,ds);h.emplaceBack($,Z,Q,F,V),m.emplaceBack($,Z,Q,F,1-V);const et=wr(U);F=.5+.5*Math.sin(et),V=.5+.5*Math.cos(et),_.emplaceBack($,Z,Q,F,V),S.emplaceBack($,Z,Q,F,1-V)}this._poleSegments.push(Un.simpleSegment(C,0,66,64)),C+=66}this._poleNorthVertexBuffer=d.createVertexBuffer(h,j_,!1),this._poleSouthVertexBuffer=d.createVertexBuffer(m,j_,!1),this._texturedPoleNorthVertexBuffer=d.createVertexBuffer(_,j_,!1),this._texturedPoleSouthVertexBuffer=d.createVertexBuffer(S,j_,!1)}getGridBuffers(d,l){return[this._gridBuffer,this._gridIndexBuffer,l?this._gridSegments[d].withSkirts:this._gridSegments[d].withoutSkirts]}getPoleBuffers(d,l){return[l?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,l?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[d]]}},a.eR=T5,a.eS=Xt,a.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.eU=ot,a.eV=At,a.eW=function(d,l,h){return d[0]=l[0]/h[0],d[1]=l[1]/h[1],d[2]=l[2]/h[2],d},a.eX=Ai,a.eY=B,a.eZ=Ue,a.e_=Vt,a.ea=H5,a.eb=kf,a.ec=R5,a.ed=L5,a.ee=Mt,a.ef=function(d,l){if(d===l){var h=l[1],m=l[2],_=l[3],S=l[6],T=l[7],C=l[11];d[1]=l[4],d[2]=l[8],d[3]=l[12],d[4]=h,d[6]=l[9],d[7]=l[13],d[8]=m,d[9]=S,d[11]=l[14],d[12]=_,d[13]=T,d[14]=C}else d[0]=l[0],d[1]=l[4],d[2]=l[8],d[3]=l[12],d[4]=l[1],d[5]=l[5],d[6]=l[9],d[7]=l[13],d[8]=l[2],d[9]=l[6],d[10]=l[10],d[11]=l[14],d[12]=l[3],d[13]=l[7],d[14]=l[11],d[15]=l[15];return d},a.eg=Pot,a.eh=gr,a.ei=u1,a.ej=256,a.ek=TD,a.el=qs,a.em=Y,a.en=function(d,l){return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[4],d[4]=l[5],d[5]=l[6],d[6]=l[8],d[7]=l[9],d[8]=l[10],d},a.eo=$h,a.ep=o1,a.eq=wT,a.er=function(d,l,h,m,_){return lt((d-l)/(h-l)*(_-m)+m,m,_)},a.es=zn,a.et=function(d,l){var h=l[0],m=l[1],_=l[2],S=l[3],T=l[4],C=l[5],L=l[6],k=l[7],F=l[8],V=F*T-C*k,U=-F*S+C*L,$=k*S-T*L,Z=h*V+m*U+_*$;return Z?(d[0]=V*(Z=1/Z),d[1]=(-F*m+_*k)*Z,d[2]=(C*m-_*T)*Z,d[3]=U*Z,d[4]=(F*h-_*L)*Z,d[5]=(-C*h+_*S)*Z,d[6]=$*Z,d[7]=(-k*h+m*L)*Z,d[8]=(T*h-m*S)*Z,d):null},a.eu=2,a.ev=Ze,a.ew=hr,a.ex=ut,a.ey=function(d,l){var h=new f(3);ut(h,l);var m=1/h[0],_=1/h[1],S=1/h[2],T=l[0]*m,C=l[1]*_,L=l[2]*S,k=l[4]*m,F=l[5]*_,V=l[6]*S,U=l[8]*m,$=l[9]*_,Z=l[10]*S,Q=T+F+Z,et=0;return Q>0?(et=2*Math.sqrt(Q+1),d[3]=.25*et,d[0]=(V-$)/et,d[1]=(U-L)/et,d[2]=(C-k)/et):T>F&&T>Z?(et=2*Math.sqrt(1+T-F-Z),d[3]=(V-$)/et,d[0]=.25*et,d[1]=(C+k)/et,d[2]=(U+L)/et):F>Z?(et=2*Math.sqrt(1+F-T-Z),d[3]=(U-L)/et,d[0]=(C+k)/et,d[1]=.25*et,d[2]=(V+$)/et):(et=2*Math.sqrt(1+Z-T-F),d[3]=(C-k)/et,d[0]=(U+L)/et,d[1]=(V+$)/et,d[2]=.25*et),d},a.ez=function(d,l){var h=2*Math.acos(l[3]),m=Math.sin(h/2);return m>c?(d[0]=l[0]/m,d[1]=l[1]/m,d[2]=l[2]/m):(d[0]=1,d[1]=0,d[2]=0),h},a.f=function(d){return btoa(encodeURIComponent(d).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(+("0x"+h))))},a.f0=yr,a.f1=YD,a.f2=function(d){const l=d.navigator?d.navigator.userAgent:null;return!!function(h){if(oa==null){const m=h.navigator?h.navigator.userAgent:null;oa=!!h.safari||!(!m||!(/\b(iPad|iPhone|iPod)\b/.test(m)||m.match("Safari")&&!m.match("Chrome")))}return oa}(d)&&!(!l||!(l.match("Version/15.4")||l.match("Version/15.5")||l.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.f3=function(d,l){tg=d,us=l},a.f4=ID,a.f5=XN,a.f6=function(d){const l=[0,0,0],h=D(new Float64Array(16));return z(h,d.pixelMatrix,d.globeMatrix),Bt(l,l,h),new Me(l[0],l[1])},a.f7=function(){const d=P1;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(GD),P1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.f8=function(){u2().acquire(GD)},a.f9=Zx,a.fA=Ae,a.fB=function(d){let l=0;if(new Uint32Array(d,0,1)[0]!==oV){const h=new Uint32Array(d,0,7),[,,m,_,S,T]=h;l=h.byteLength+_+S+T+S,(m!==d.byteLength||l>=d.byteLength)&&Mi("Invalid b3dm header information.")}return cV(d,l)},a.fC=function(d,l){const h=eP(d);for(const m of h){for(const _ of m.meshes)dat(_);m.lights&&(m.lightMeshIndex=m.meshes.length,m.meshes.push(fat(m.lights,l)))}return h},a.fD=z2,a.fE=Yn,a.fF=eV,a.fG=As,a.fH=Ts,a.fI=function(d){Eh(),Ko!=null&&Ko.then(l=>{l.keys().then(h=>{for(let m=0;m<h.length-d;m++)l.delete(h[m]).catch(_=>Mi(_.message))}).catch(h=>Mi(h.message))}).catch(l=>Mi(l.message))},a.fa=function(d,l,h=!1){if(Jo===Ts.deferred||Jo===Ts.loading||Jo===Ts.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");kc=ws.resolveURL(d),Jo=Ts.deferred,jx=l,Wx(),h||qx()},a.fb=function(d){q_=ws.resolveURL(d),X_||(X_=new Z_(u2(),new Vu)),X_.broadcast("setMeshoptUrl",q_)},a.fc=nV,a.fd=function(d){jD=ws.resolveURL(d),X_||(X_=new Z_(u2(),new Vu)),X_.broadcast("setDracoUrl",jD)},a.fe=rV,a.ff=D1,a.fg=function(d){const l=Nu();if(!l)return;const h=l.delete(Qp);d&&h.then(()=>d()).catch(d)},a.fh=Hg,a.fi=li,a.fj=Rf,a.fk=tc,a.fl=AU,a.fm=IU,a.fn=IV,a.fo=ii,a.fp="hd_road_elevation",a.fq=Hi,a.fr=Oe,a.fs=Xh,a.ft=dP,a.fu=$g,a.fv=function(d,l,h,m,_,S,T,C=1,L,k,F){d.createArrays(),d.tilePixelRatio=Ve/(512*d.overscaling),d.compareText={},d.iconsNeedLinear=!1;const V=d.layers[0].layout,U=d.layers[0]._unevaluatedLayout._values,$={};$.scaleFactor=C,$.textSizeScaleRange=V.get("text-size-scale-range"),$.iconSizeScaleRange=V.get("icon-size-scale-range");const[Z,Q]=$.textSizeScaleRange,[et,nt]=$.iconSizeScaleRange;$.textScaleFactor=lt($.scaleFactor,Z,Q),$.iconScaleFactor=lt($.scaleFactor,et,nt);const dt=U["text-size"],mt=U["icon-size"];if(d.textSizeData.kind==="composite"){const{minZoom:Ht,maxZoom:se}=d.textSizeData;$.compositeTextSizes=[dt.possiblyEvaluate(new xn(Ht,{worldview:F}),S),dt.possiblyEvaluate(new xn(se,{worldview:F}),S)]}if(d.iconSizeData.kind==="composite"){const{minZoom:Ht,maxZoom:se}=d.iconSizeData;$.compositeIconSizes=[mt.possiblyEvaluate(new xn(Ht,{worldview:F}),S),mt.possiblyEvaluate(new xn(se,{worldview:F}),S)]}$.layoutTextSize=dt.possiblyEvaluate(new xn(T+1,{worldview:F}),S),$.layoutIconSize=mt.possiblyEvaluate(new xn(T+1,{worldview:F}),S),$.textMaxSize=dt.possiblyEvaluate(new xn(18,{worldview:F}),S);const yt=V.get("symbol-placement"),Lt=V.get("text-rotation-alignment")==="map"&&yt!=="point",It=V.get("text-size");let Ot=!1;const Ut=[];for(const Ht of d.features){const se=V.get("text-font").evaluate(Ht,{},S).join(","),Kt=It.evaluate(Ht,{},S)*$.textScaleFactor,ue=$.layoutTextSize.evaluate(Ht,{},S)*$.textScaleFactor,me=$.layoutIconSize.evaluate(Ht,{},S)*$.iconScaleFactor,Te={horizontal:{},vertical:void 0},Be=Ht.text;let De,_e=[0,0];if(Be){const fr=Be.toString(),Pr=V.get("text-letter-spacing").evaluate(Ht,{},S)*no,qi=V.get("text-line-height").evaluate(Ht,{},S)*no,Br=CT(fr)?Pr:0,Fr=V.get("text-anchor").evaluate(Ht,{},S),Fn=V.get("text-variable-anchor");if(!Fn){const de=V.get("text-radial-offset").evaluate(Ht,{},S);if(de)_e=u4(Fr,[de*no,gP]);else{const Je=V.get("text-offset").evaluate(Ht,{},S);_e=[Je[0]*no,Je[1]*no]}}let Ct=Lt?"center":V.get("text-justify").evaluate(Ht,{},S);const St=yt==="point",he=St?V.get("text-max-width").evaluate(Ht,{},S)*no:1/0,je=de=>{d.allowVerticalPlacement&&Ux(fr)&&(Te.vertical=lP(Be,l,h,_,se,he,qi,Fr,de,Br,_e,el.vertical,!0,ue,Kt,L))};if(!Lt&&Fn){const de=Ct==="auto"?Fn.map(vi=>mP(vi)):[Ct];let Je=!1;for(let vi=0;vi<de.length;vi++){const gi=de[vi];if(!Te.horizontal[gi])if(Je)Te.horizontal[gi]=Te.horizontal[0];else{const Ji=lP(Be,l,h,_,se,he,qi,"center",gi,Br,_e,el.horizontal,!1,ue,Kt,L);Ji&&(Te.horizontal[gi]=Ji,Je=Ji.positionedLines.length===1)}}je("left")}else{if(Ct==="auto"&&(Ct=mP(Fr)),St||V.get("text-writing-mode").indexOf("horizontal")>=0||!Ux(fr)){const de=lP(Be,l,h,_,se,he,qi,Fr,Ct,Br,_e,el.horizontal,!1,ue,Kt,L);de&&(Te.horizontal[Ct]=de)}je(St?"left":Ct)}}let Ee,ae,re,Ie,Re,we,si=!1;const ci=V.get("icon-text-fit").evaluate(Ht,{},S);if(Ht.icon&&Ht.icon.hasPrimary()){const fr=U1(Ht.icon,d.iconSizeData,U["icon-size"],S,d.zoom,Ht,L,$.iconScaleFactor,F);Ee=fr.iconPrimary,re=fr.iconSecondary;const Pr=Ee.toString();if(ae=m.get(Pr),ae&&(Re=V.get("icon-offset").evaluate(Ht,{},S),we=V.get("icon-anchor").evaluate(Ht,{},S),De=b2(_.get(Pr),re?_.get(re.toString()):void 0,Re,we),si=ae.sdf,d.sdfIcons===void 0?d.sdfIcons=ae.sdf:d.sdfIcons!==ae.sdf&&Mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==d.pixelRatio||V.get("icon-rotate").constantOr(1)!==0)&&(d.iconsNeedLinear=!0)),re){const qi=re.toString();Ie=m.get(qi)}}Ot=Ot||!(!Ht.icon||!Ht.icon.hasSecondary());const ri=vP(Te.horizontal)||Te.vertical;d.iconsInText||(d.iconsInText=!!ri&&ri.iconsInText);const Xe=ue*$.textScaleFactor/no,{defaultShapedIcon:ji,verticallyShapedIcon:Qe}=vot(d,De,V,Ht,S,Te,Xe,Re,ci);ci!=="none"&&De&&(qV(De)||XV(De))&&(I2(0,ae,Ee,De,ji,ci,k,m,_),I2(0,Ie,re,De,ji,ci,k,m,_),Qe&&(I2(0,ae,Ee,De,Qe,ci,k,m,_),I2(0,Ie,re,De,Qe,ci,k,m,_))),De=ji;const{iconBBox:Ci,iconVerticalBBox:Zi}=pot(d,De,Qe,V,Ht,S,me,Re,$,_,we);Ut.push({feature:Ht,shapedTextOrientations:Te,shapedText:ri,shapedIcon:De,iconPrimary:Ee,iconSecondary:re,iconOffset:Re,iconAnchor:we,verticallyShapedIcon:Qe,layoutTextSize:ue,layoutIconSize:me,textOffset:_e,isSDFIcon:si,iconTextFit:ci,iconCollisionBounds:Ci,iconVerticalCollisionBounds:Zi})}return{featureData:Ut,sizes:$,hasAnySecondaryIcon:Ot,textAlongLine:Lt,symbolPlacement:yt}},a.fw=r4,a.fx=function(d,l,h,m,_,S,T,C,L,k){d.iconAtlasPositions=k.iconPositions;const{featureData:F,hasAnySecondaryIcon:V,sizes:U,textAlongLine:$,symbolPlacement:Z}=l;for(const Q of F){const{shapedIcon:et,verticallyShapedIcon:nt,feature:dt,shapedTextOrientations:mt,shapedText:yt,layoutTextSize:Lt,textOffset:It,isSDFIcon:Ot,iconPrimary:Ut,iconSecondary:Ht,iconTextFit:se,iconOffset:Kt,iconCollisionBounds:ue,iconVerticalCollisionBounds:me}=Q;h4(et,k.iconPositions,Ut,Ht),h4(nt,k.iconPositions,Ut,Ht),mot(mt,k.iconPositions),got(Ut,Ht,k.iconPositions),(yt||et)&&_ot(d,dt,mt,et,nt,L,U,Lt,0,It,Ot,m,_,T,C,V,se,Kt,$,Z,ue,me)}h&&d.generateCollisionDebugBuffers(S,d.collisionBoxArray,U.textScaleFactor)},a.fy=hi,a.fz=G2,a.g=function(d,l){return eg(Object.assign(d,{method:"GET"}),l)},a.h=function(d){return d.indexOf("mapbox:")===0},a.i=function(d){return An.API_STYLE_REGEX.test(d)&&!Uo(d)},a.j=za,a.k=Gv,a.l=function(d){return decodeURIComponent(atob(d).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join(""))},a.m=function(d,l){return eg(Object.assign(d,{type:"json"}),l)},a.n=ax,a.o=ws,a.p=function(d,l){return eg(Object.assign(d,{method:"POST"}),l)},a.q=Do,a.r=bs,a.s=function(d){try{const l=self[d];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=function(){return HD||(HD=new Hg),HD},a.u=function(){return function d(l){return l?(l^Math.random()*(16>>l/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,d)}()},a.v=function(d){return!!d&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(d)},a.w=Mi,a.x=RP,a.y=lg,a.z=js}),o(["./shared"],function(a){function c(Xt){const ot=Xt?Xt.url.toString():void 0;return ot?performance.getEntriesByName(ot):[]}function f(Xt){if(typeof Xt=="number"||typeof Xt=="boolean"||typeof Xt=="string"||Xt==null)return JSON.stringify(Xt);if(Array.isArray(Xt)){let lt="[";for(const Tt of Xt)lt+=`${f(Tt)},`;return`${lt}]`}let ot="{";for(const lt of Object.keys(Xt).sort())ot+=`${lt}:${f(Xt[lt])},`;return`${ot}}`}function g(Xt){let ot="";for(const lt of a.bw)ot+=`/${f(Xt[lt])}`;return ot}class v{constructor(ot){this.keyCache={},this._layers={},this._layerConfigs={},ot&&this.replace(ot)}replace(ot,lt){this._layerConfigs={},this._layers={},this.update(ot,[],lt)}update(ot,lt,Tt){this._options=Tt;for(const Ft of ot)this._layerConfigs[Ft.id]=Ft,(this._layers[Ft.id]=a.dt(Ft,this.scope,null,this._options)).compileFilter(Tt),this.keyCache[Ft.id]&&delete this.keyCache[Ft.id];for(const Ft of lt)delete this.keyCache[Ft],delete this._layerConfigs[Ft],delete this._layers[Ft];this.familiesBySource={};const Nt=function(Ft,Wt){const ne={};for(let ie=0;ie<Ft.length;ie++){const Oe=Ft[ie];let Ce=Wt&&Wt[Oe.id];Ce||(Oe.type==="symbol"?Ce=Oe.id:(Ce=g(Oe),Oe.type==="line"&&Oe.paint&&function Gi(Bi){return typeof Bi=="string"&&Bi==="line-progress"||(Array.isArray(Bi)?Bi.some(Gi):!(!Bi||typeof Bi!="object")&&Object.values(Bi).some(Gi))}(Oe.paint["line-width"])&&(Ce+=`/${f(Oe.paint["line-width"])}`))),Wt&&(Wt[Oe.id]=Ce);let mi=ne[Ce];mi||(mi=ne[Ce]=[]),mi.push(Oe)}const $t=[];for(const ie in ne)$t.push(ne[ie]);return $t}(Object.values(this._layerConfigs),this.keyCache);for(const Ft of Nt){const Wt=Ft.map(mi=>this._layers[mi.id]),ne=Wt[0];if(ne.visibility==="none")continue;const $t=ne.source||"";let ie=this.familiesBySource[$t];ie||(ie=this.familiesBySource[$t]={});const Oe=ne.sourceLayer||"_geojsonTileLayer";let Ce=ie[Oe];Ce||(Ce=ie[Oe]=[]),Ce.push(Wt)}}}const y=1*a.fk;class w{constructor(ot){const lt={},Tt=[];for(const ne in ot){const $t=ot[ne],ie=lt[ne]={};for(const Oe in $t.glyphs){const Ce=$t.glyphs[+Oe];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const mi=Ce.metrics.localGlyph?y:1,Gi={x:0,y:0,w:Ce.bitmap.width+2*mi,h:Ce.bitmap.height+2*mi};Tt.push(Gi),ie[Oe]=Gi}}const{w:Nt,h:Ft}=a.G(Tt),Wt=new a.fj({width:Nt||1,height:Ft||1});for(const ne in ot){const $t=ot[ne];for(const ie in $t.glyphs){const Oe=$t.glyphs[+ie];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Ce=lt[ne][ie],mi=Oe.metrics.localGlyph?y:1;a.fj.copy(Oe.bitmap,Wt,{x:0,y:0},{x:Ce.x+mi,y:Ce.y+mi},Oe.bitmap)}}this.image=Wt,this.positions=lt}}function I(Xt,ot,lt){Xt[ot]?lt&&(Xt[ot].center=lt):Xt[ot]={floorIds:new Set,center:lt||[0,0],floors:{}}}function E(Xt,ot,lt,Tt){for(const Nt of ot)I(Xt,Nt),Xt[Nt].floors[lt]=Tt,Xt[Nt].floorIds.add(lt)}function D(Xt){return{id:Xt.properties.id.toString(),center:Xt.properties.center.toString().split(";").map(Number)}}function R(Xt){return{id:Xt.properties.id.toString(),isDefault:!!Xt.properties.is_default&&Xt.properties.is_default,connections:Xt.properties.connected_floor_ids?new Set(Xt.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Xt.properties.conflicted_floor_ids?new Set(Xt.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Xt.properties.building_ids?new Set(Xt.properties.building_ids.toString().split(";")):new Set,name:Xt.properties.name.toString(),zIndex:Xt.properties.z_index}}function z(Xt,ot){return ot.every(lt=>Xt.properties&&Xt.properties[lt]!=null)}function N(Xt){return z(Xt,["type","id","name"])&&Xt.properties.type==="building"}function H(Xt){return z(Xt,["type","id","name","z_index"])&&Xt.properties.type==="floor"}a.fi(w,"GlyphAtlas");class q{constructor(ot){this.tileID=new a.aP(ot.tileID.overscaledZ,ot.tileID.wrap,ot.tileID.canonical.z,ot.tileID.canonical.x,ot.tileID.canonical.y),this.tileZoom=ot.tileZoom,this.uid=ot.uid,this.zoom=ot.zoom,this.lut=ot.lut,this.canonical=ot.tileID.canonical,this.pixelRatio=ot.pixelRatio,this.tileSize=ot.tileSize,this.source=ot.source,this.scope=ot.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ot.showCollisionBoxes,this.collectResourceTiming=!!ot.request&&ot.request.collectResourceTiming,this.promoteId=ot.promoteId,this.isSymbolTile=ot.isSymbolTile,this.tileTransform=a.aY(ot.tileID.canonical,ot.projection),this.projection=ot.projection,this.worldview=ot.worldview,this.localizableLayerIds=ot.localizableLayerIds,this.brightness=ot.brightness,this.extraShadowCaster=!!ot.extraShadowCaster,this.tessellationStep=ot.tessellationStep,this.scaleFactor=ot.scaleFactor,this.worldview=ot.worldview,this.indoor=ot.indoor}parse(ot,lt,Tt,Nt,Ft,Wt){this.status="parsing",this.data=ot,this.collisionBoxArray=new a.b2;const ne=new a.fl(Object.keys(ot.layers).sort()),$t=new a.fm(this.tileID,this.promoteId);$t.bucketLayerIDs=[];const ie={},Oe=new a.fn(256,256),Ce={featureIndex:$t,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Oe,availableImages:Tt,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Mi=this.indoor.indoorState.activeFloorsVisible,dr=function(pr,nn,Yn){const wa=function(en,Sr){if(!en)return a.w("No source layers defined in indoor specification"),Sr;if(en.size===0)return Sr;const Tn=en.difference(Sr);for(const Wn of Tn)a.w(`Missing source layer required in indoor specification: ${Wn}`);return Sr.intersection(Sr)}(nn.sourceLayers,new Set(Object.keys(pr.layers))),oa=nn.indoorState,ia=function(en,Sr,Tn,Wn){const sn=new Set,An=new Set,za=new Set,Uo=new Map,ml={},Mh=Ga=>{const vl=Uo.get(Ga)||new Set;for(const Yo of sn)if((Uo.get(Yo)||new Set).has(Ga)||vl.has(Yo))return!0;return!1};for(const Ga of Sr){const vl=en.layers[Ga];if(vl)for(let Yo=0;Yo<vl.length;Yo++){const Bl=vl.feature(Yo);if(N(Bl)){const{id:bs,center:ws}=D(Bl);I(ml,bs,ws),sn.add(bs)}else if(H(Bl)){const{id:bs,isDefault:ws,connections:Vv,conflicts:Jp,buildings:Qp,name:tg,zIndex:us}=R(Bl);E(ml,Qp,bs,{name:tg,zIndex:us}),Uo.set(bs,Jp),(bs===Wn||Vv.has(Wn))&&sn.add(bs),An.add(bs),ws&&za.add(bs)}}else a.w(`indoor source layer not found: ${Ga}`)}if(Tn)for(const Ga of Tn)An.has(Ga)&&(Mh(Ga)||sn.add(Ga));for(const Ga of za)sn.has(Ga)||Mh(Ga)||sn.add(Ga);return{buildings:ml,activeFloors:sn}}(pr,wa,oa.lastActiveFloors,oa.selectedFloorId);return Yn.send("setIndoorData",ia),ia}(ot,this.indoor,Ft);Ce.activeFloors=Mi?dr.activeFloors:void 0}const mi=[],Gi=lt.familiesBySource[this.source];for(const Mi in Gi){const dr=ot.layers[Mi];if(!dr)continue;let pr=!1,nn=!1,Yn=!1;for(const en of Gi[Mi])en[0].type==="symbol"?pr=!0:nn=!0,en[0].is3D()&&en[0].type!=="model"&&(Yn=!0);if(this.extraShadowCaster&&!Yn||this.isSymbolTile===!0&&!pr||this.isSymbolTile===!1&&!nn)continue;dr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wa=ne.encode(Mi),oa=[];let ia=!1;for(let en=0,Sr=0;en<dr.length;en++){const Tn=dr.feature(en),Wn=$t.getId(Tn,Mi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Mi)){const sn=Tn.properties?Tn.properties.worldview:null;if(this.worldview&&typeof sn=="string")if(sn==="all")Tn.properties.$localized=!0;else{if(!sn.split(",").includes(this.worldview))continue;Tn.properties.$localized=!0,Tn.properties.worldview=this.worldview}}!ia&&Tn.properties&&Tn.properties.hasOwnProperty(a.fo)&&(ia=!0),oa.push({feature:Tn,id:Wn,index:Sr,sourceLayerIndex:wa}),Sr++}ia&&!Ce.elevationFeatures&&ot.layers.hasOwnProperty(a.fp)&&(Ce.elevationFeatures=a.fq.parseFrom(ot.layers[a.fp],this.canonical));for(const en of Gi[Mi]){const Sr=en[0];if(this.extraShadowCaster&&(!Sr.is3D()||Sr.type==="model")||this.isSymbolTile!==void 0&&Sr.type==="symbol"!==this.isSymbolTile||Sr.minzoom&&this.zoom<Math.floor(Sr.minzoom)||Sr.maxzoom&&this.zoom>=Sr.maxzoom||Sr.visibility==="none")continue;Y(en,this.zoom,Ce.brightness,Tt,this.worldview);const Tn=ie[Sr.id]=Sr.createBucket({index:$t.bucketLayerIDs.length,layers:en,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wa,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Nt,worldview:this.worldview});$t.bucketLayerIDs.push(en.map(sn=>a.B(sn.id,sn.scope)));let Wn=Tn.prepare?Tn.prepare():null;Wn!=null?(Wn=Wn.then(()=>Tn.populate(oa,Ce,this.tileID.canonical,this.tileTransform)),mi.push(Wn)):Tn.populate(oa,Ce,this.tileID.canonical,this.tileTransform)}}const Bi=()=>{let Mi,dr,pr,nn,Yn,wa;Oe.trim();const oa={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ia=()=>{if(Mi)return this.status="done",Wt(Mi);if(this.extraShadowCaster)this.status="done",Wt(null,{buckets:Object.values(ie).filter(Sr=>!Sr.isEmpty()),featureIndex:$t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ce.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(dr&&pr&&nn){const Sr=new w(dr),Tn=new Map;for(const[An,za]of pr.entries()){const{imagePosition:Uo}=a.ft(An,za,a.fu);Tn.set(An,Uo)}const Wn={};for(const An in ie){const za=ie[An];za instanceof a.b3&&(Y(za.layers,this.zoom,Ce.brightness,Tt,this.worldview),Wn[An]=a.fv(za,dr,Sr.positions,pr,Tn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Yn,this.worldview))}const sn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ft,pr,Yn,()=>{sn.iconsPending=!1,en(Wn,Sr,sn)}),this.rasterizeIfNeeded(Ft,nn,wa,()=>{sn.patternsPending=!1,en(Wn,Sr,sn)})}},en=(Sr,Tn,Wn,sn)=>{if(Wn.iconsPending||Wn.patternsPending)return;const An=new a.fw(pr,nn,this.lut);for(const za in ie){const Uo=ie[za];if(za in Sr)a.fx(Uo,Sr[za],this.showCollisionBoxes,Tt,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,pr,An);else if(Uo.hasPattern&&(Uo instanceof a.b9||Uo instanceof a.ba||Uo instanceof a.e9)){Y(Uo.layers,this.zoom,Ce.brightness,Tt,this.worldview);const ml=Object.fromEntries(An.patternPositions);Uo.addFeatures(Ce,this.tileID.canonical,ml,Tt,this.tileTransform,this.brightness)}}this.status="done",Wt(null,{buckets:Object.values(ie).filter(za=>!za.isEmpty()),featureIndex:$t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tn.image,lineAtlas:Oe,imageAtlas:An,brightness:Ce.brightness})};if(!this.extraShadowCaster){const Sr=a.fr(Ce.glyphDependencies,sn=>Object.keys(sn).map(Number));Object.keys(Sr).length?Ft.send("getGlyphs",{uid:this.uid,stacks:Sr},(sn,An)=>{Mi||(Mi=sn,dr=An,ia())},void 0,!1,oa):dr={};const Tn=Array.from(Ce.iconDependencies.keys()).map(sn=>a.I.parse(sn));Tn.length?Ft.send("getImages",{images:Tn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sn,An)=>{Mi||(Mi=sn,pr=new Map,Yn=this.updateImageMapAndGetImageTaskQueue(pr,An,Ce.iconDependencies),ia())},void 0,!1,oa):(pr=new Map,Yn=new Map);const Wn=Array.from(Ce.patternDependencies.keys()).map(sn=>a.I.parse(sn));Wn.length?Ft.send("getImages",{images:Wn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sn,An)=>{Mi||(Mi=sn,nn=new Map,wa=this.updateImageMapAndGetImageTaskQueue(nn,An,Ce.patternDependencies),ia())},void 0,!1,oa):(nn=new Map,wa=new Map)}if(Ce.elevationFeatures&&Ce.elevationFeatures.length>0){const Sr=[];for(const Wn of Object.values(ie))if(Wn instanceof a.ba){const sn=Wn.getUnevaluatedPortalGraph();sn&&Sr.push(sn)}const Tn=a.fs.evaluate(Sr);for(const Wn of Object.values(ie))if(Wn instanceof a.ba){const sn=ot.layers[ne.decode(Wn.sourceLayerIndex)];Wn.setEvaluatedPortalGraph(Tn,sn,this.tileID.canonical,Ce.availableImages,Ce.brightness)}}ia()};mi.length>0?Promise.allSettled(mi).then(Bi).catch(Wt):Bi()}updateParameters(ot){this.scaleFactor=ot.scaleFactor,this.showCollisionBoxes=ot.showCollisionBoxes,this.projection=ot.projection,this.brightness=ot.brightness,this.tileTransform=a.aY(ot.tileID.canonical,ot.projection),this.extraShadowCaster=ot.extraShadowCaster,this.lut=ot.lut,this.worldview=ot.worldview,this.indoor=ot.indoor}rasterizeIfNeeded(ot,lt,Tt,Nt){Array.from(lt.values()).some(Ft=>Ft.usvg)?this.rasterize(ot,lt,Tt,Nt):Nt()}updateImageMapAndGetImageTaskQueue(ot,lt,Tt){const Nt=new Map;for(const Ft of lt.keys()){const Wt=Tt.get(Ft)||[];for(const ne of Wt){const $t=ne.toString(),ie=lt.get(ne.id.toString());ie.usvg?Nt.has($t)||(Nt.set($t,ne),ot.set($t,Object.assign({},ie))):ot.set($t,ie)}}return Nt}rasterize(ot,lt,Tt,Nt){this.rasterizeTask=ot.send("rasterizeImages",{scope:this.scope,tasks:Tt},(Ft,Wt)=>{if(!Ft)for(const[ne,$t]of Wt.entries()){const ie=Object.assign(lt.get(ne),{data:$t});lt.set(ne,ie)}Nt()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Y(Xt,ot,lt,Tt,Nt){const Ft=new a.ac(ot,{brightness:lt,worldview:Nt});for(const Wt of Xt)Wt.recalculate(Ft,Tt)}class J extends a.E{constructor(ot,lt,Tt,Nt,Ft,Wt,ne){super(),this.actor=ot,this.layerIndex=lt,this.availableImages=Tt,this.availableModels=Nt,this.loadVectorData=Wt||a.aL,this.loading={},this.loaded={},this.deduped=new a.aK(ot.scheduler),this.isSpriteLoaded=Ft,this.scheduler=ot.scheduler,this.brightness=ne}loadTile(ot,lt){const Tt=ot.uid,Nt=ot&&ot.request,Ft=Nt&&Nt.collectResourceTiming,Wt=this.loading[Tt]=new q(ot);Wt.abort=this.loadVectorData(ot,(ne,$t)=>{const ie=!this.loading[Tt];if(delete this.loading[Tt],Wt.cancelRasterize(),ie||ne||!$t)return Wt.status="done",ie||(this.loaded[Tt]=Wt),lt(ne);const Oe=$t.rawData,Ce={},mi=a.aM($t.responseHeaders);mi&&mi.expires&&(Ce.expires=mi.expires),mi&&mi.cacheControl&&(Ce.cacheControl=mi.cacheControl),Wt.vectorTile=$t.vectorTile||new a.fy(new a.bs(Oe));const Gi=()=>{Wt.parse(Wt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Bi,Mi)=>{if(Bi||!Mi)return lt(Bi);const dr={};if(Ft){const pr=c(Nt);pr.length>0&&(dr.resourceTiming=JSON.parse(JSON.stringify(pr)))}lt(null,Object.assign({rawTileData:Oe.slice(0),responseHeaders:$t.responseHeaders},Mi,Ce,dr))})};this.isSpriteLoaded?Gi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Gi,{type:"parseTile",isSymbolTile:ot.isSymbolTile,zoom:ot.tileZoom}):Gi()}),this.loaded=this.loaded||{},this.loaded[Tt]=Wt})}reloadTile(ot,lt){const Tt=this.loaded,Nt=ot.uid;if(Tt&&Tt[Nt]){const Ft=Tt[Nt];Ft.updateParameters(ot);const Wt=(ne,$t)=>{const ie=Ft.reloadCallback;ie&&(delete Ft.reloadCallback,Ft.parse(Ft.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ie)),lt(ne,$t)};Ft.status==="parsing"?Ft.reloadCallback=Wt:Ft.status==="done"&&(Ft.vectorTile?Ft.parse(Ft.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Wt):Wt())}else lt(null,void 0)}abortTile(ot,lt){const Tt=ot.uid,Nt=this.loading[Tt];Nt&&(Nt.abort&&Nt.abort(),delete this.loading[Tt]),lt()}removeTile(ot,lt){const Tt=this.loaded,Nt=ot.uid;Tt&&Tt[Nt]&&delete Tt[Nt],lt()}}class it{loadTile(ot,lt){const{uid:Tt,encoding:Nt,rawImageData:Ft,padding:Wt}=ot,ne=ImageBitmap&&Ft instanceof ImageBitmap?this.getImageData(Ft,Wt):Ft;lt(null,new a.fz(Tt,ne,Nt,Wt<1))}reloadTile(ot,lt){lt(null,null)}abortTile(ot,lt){lt()}removeTile(ot,lt){lt()}getImageData(ot,lt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ot.width,ot.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ot.width,this.offscreenCanvas.height=ot.height,this.offscreenCanvasContext.drawImage(ot,0,0,ot.width,ot.height);const Tt=this.offscreenCanvasContext.getImageData(-lt,-lt,ot.width+2*lt,ot.height+2*lt);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Tt}}a.br.setPbf(a.bs);class at{constructor(ot){this._mrt=new a.br(ot.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ot.uid,this.tileID=ot.tileID,this.source=ot.source}parse(ot,lt){const Tt=this._mrt;this.status="parsing",this._entireBuffer=ot;try{Tt.parseHeader(ot),this._isHeaderLoaded=!0;const Nt=[];for(const Ft in Tt.layers){const Wt=Tt.getLayer(Ft),ne=Wt.getDataRange(Wt.getBandList()),$t=Tt.createDecodingTask(ne),ie=ot.slice(ne.firstByte,ne.lastByte+1),Oe=a.br.performDecoding(ie,$t).then(Ce=>$t.complete(null,Ce)).catch(Ce=>$t.complete(Ce,null));Nt.push(Oe)}Promise.allSettled(Nt).then(()=>lt(null,Tt)).catch(Ft=>lt(Ft))}catch(Nt){lt(Nt)}}}class ut{constructor(ot){this.actor=ot,this.loading={},this.loaded={}}loadTile(ot,lt){const Tt=ot.uid,Nt=ot.request,Ft=this.loading[Tt]=new at(ot),{cancel:Wt}=a.bt(Nt,(ne,$t,ie)=>{const Oe=!this.loading[Tt];if(delete this.loading[Tt],Oe||ne||!$t)return Ft.status="done",Oe||(this.loaded[Tt]=Ft),lt(ne);Ft.parse($t,(Ce,mi)=>{if(Ce||!mi)return lt(Ce);lt(null,mi,ie)}),this.loaded[Tt]=Ft});Ft.abort=Wt}reloadTile(ot,lt){lt(null,void 0)}abortTile(ot,lt){const Tt=ot.uid,Nt=this.loading[Tt];Nt&&(Nt.abort&&Nt.abort(),delete this.loading[Tt]),lt()}removeTile(ot,lt){const Tt=ot.uid;this.loaded[Tt]&&delete this.loaded[Tt],lt()}decodeRasterArray(ot,lt){a.br.performDecoding(ot.buffer,ot.task).then(Tt=>lt(null,Tt)).catch(Tt=>lt(Tt))}}const ft=a.fA.prototype.toGeoJSON;class _t{constructor(ot){this._feature=ot,this.extent=a.al,this.type=ot.type,this.properties=ot.tags,"id"in ot&&!isNaN(ot.id)&&(this.id=parseInt(ot.id,10))}loadGeometry(){if(this._feature.type===1){const ot=[];for(const lt of this._feature.geometry)ot.push([new a.P(lt[0],lt[1])]);return ot}{const ot=[];for(const lt of this._feature.geometry){const Tt=[];for(const Nt of lt)Tt.push(new a.P(Nt[0],Nt[1]));ot.push(Tt)}return ot}}toGeoJSON(ot,lt,Tt){return ft.call(this,ot,lt,Tt)}}class ct{constructor(ot,lt){this.name=ot,this.extent=a.al,this.length=lt.length,this._jsonFeatures=lt}feature(ot){return new _t(this._jsonFeatures[ot])}}class Dt{constructor(ot){this.layers={},this.extent=a.al;for(const lt of Object.keys(ot))this.layers[lt]=new ct(lt,ot[lt])}}const Et=64/4096,bt=128;class Vt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ot=[],lt){for(const Tt of ot){const Nt=Tt.id;if(Nt==null)continue;let Ft=this.features.get(Nt);Ft&&this.updateCache(Ft,lt),Tt.geometry?(Ft=Jt(Tt),this.updateCache(Ft,lt),this.features.set(Nt,Ft)):this.features.delete(Nt),this.updateCache(Ft,lt)}}updateCache(ot,lt){for(const{canonical:Tt,uid:Nt}of Object.values(lt)){const{z:Ft,x:Wt,y:ne}=Tt;zt(ot,Math.pow(2,Ft),Wt,ne)&&delete lt[Nt]}}getTile(ot,lt,Tt){const Nt=Math.pow(2,ot),Ft=[];for(const Wt of this.features.values())zt(Wt,Nt,lt,Tt)&&Ft.push(ke(Wt,Nt,lt,Tt));return{features:Ft}}getFeatures(){return[...this.features.values()]}}function zt({minX:Xt,minY:ot,maxX:lt,maxY:Tt},Nt,Ft,Wt){return Xt<(Ft+1+Et)/Nt&&ot<(Wt+1+Et)/Nt&&lt>(Ft-Et)/Nt&&Tt>(Wt-Et)/Nt}function Jt(Xt){const{id:ot,geometry:lt,properties:Tt}=Xt;if(!lt)return;if(lt.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Nt,coordinates:Ft}=lt,Wt={id:ot,type:1,geometry:[],tags:Tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ne=Wt.geometry;if(Nt==="Point")ce(Ft,ne,Wt);else if(Nt==="MultiPoint")for(const $t of Ft)ce($t,ne,Wt);else if(Nt==="LineString")Wt.type=2,be(Ft,ne,Wt);else if(Nt==="MultiLineString")Wt.type=2,ve(Ft,ne,Wt);else if(Nt==="Polygon")Wt.type=3,ve(Ft,ne,Wt,!0);else{if(Nt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Wt.type=3;for(const $t of Ft)ve($t,ne,Wt,!0)}return Wt}function ce([Xt,ot],lt,Tt){const Nt=a.aF(Xt);let Ft=a.aJ(ot);Ft=Ft<0?0:Ft>1?1:Ft,lt.push(Nt,Ft),Tt.minX=Math.min(Tt.minX,Nt),Tt.minY=Math.min(Tt.minY,Ft),Tt.maxX=Math.max(Tt.maxX,Nt),Tt.maxY=Math.max(Tt.maxY,Ft)}function be(Xt,ot,lt,Tt=!1,Nt=!1){const Ft=[];for(const Wt of Xt)ce(Wt,Ft,lt);ot.push(Ft),Tt&&function(Wt,ne){let $t=0;for(let ie=0,Oe=Wt.length,Ce=Oe-2;ie<Oe;Ce=ie,ie+=2)$t+=(Wt[ie]-Wt[Ce])*(Wt[ie+1]+Wt[Ce+1]);if($t>0===ne)for(let ie=0,Oe=Wt.length;ie<Oe/2;ie+=2){const Ce=Wt[ie],mi=Wt[ie+1];Wt[ie]=Wt[Oe-2-ie],Wt[ie+1]=Wt[Oe-1-ie],Wt[Oe-2-ie]=Ce,Wt[Oe-1-ie]=mi}}(Ft,Nt)}function ve(Xt,ot,lt,Tt=!1){for(let Nt=0;Nt<Xt.length;Nt++)be(Xt[Nt],ot,lt,Tt,Nt===0)}function ke(Xt,ot,lt,Tt){const{id:Nt,type:Ft,geometry:Wt,tags:ne}=Xt,$t=[];if(Ft===1)(function(ie,Oe,Ce,mi,Gi){for(let Bi=0;Bi<ie.length;Bi+=2){const Mi=Math.round(a.al*(ie[Bi+0]*Oe-Ce)),dr=Math.round(a.al*(ie[Bi+1]*Oe-mi));Gi.push([Mi,dr])}})(Wt,ot,lt,Tt,$t);else for(const ie of Wt)ni(ie,ot,lt,Tt,$t);return{id:Nt,type:Ft,geometry:$t,tags:ne}}function ni(Xt,ot,lt,Tt,Nt){const Ft=-bt,Wt=a.al+bt;let ne;for(let $t=0;$t<Xt.length-2;$t+=2){let ie=Math.round(a.al*(Xt[$t+0]*ot-lt)),Oe=Math.round(a.al*(Xt[$t+1]*ot-Tt)),Ce=Math.round(a.al*(Xt[$t+2]*ot-lt)),mi=Math.round(a.al*(Xt[$t+3]*ot-Tt));const Gi=Ce-ie,Bi=mi-Oe;ie<Ft&&Ce<Ft||(ie<Ft?(Oe+=Math.round(Bi*((Ft-ie)/Gi)),ie=Ft):Ce<Ft&&(mi=Oe+Math.round(Bi*((Ft-ie)/Gi)),Ce=Ft),Oe<Ft&&mi<Ft||(Oe<Ft?(ie+=Math.round(Gi*((Ft-Oe)/Bi)),Oe=Ft):mi<Ft&&(Ce=ie+Math.round(Gi*((Ft-Oe)/Bi)),mi=Ft),ie>=Wt&&Ce>=Wt||(ie>=Wt?(Oe+=Math.round(Bi*((Wt-ie)/Gi)),ie=Wt):Ce>=Wt&&(mi=Oe+Math.round(Bi*((Wt-ie)/Gi)),Ce=Wt),Oe>=Wt&&mi>=Wt||(Oe>=Wt?(ie+=Math.round(Gi*((Wt-Oe)/Bi)),Oe=Wt):mi>=Wt&&(Ce=ie+Math.round(Gi*((Wt-Oe)/Bi)),mi=Wt),ne&&ie===ne[ne.length-1][0]&&Oe===ne[ne.length-1][1]||(ne=[[ie,Oe]],Nt.push(ne)),ne.push([Ce,mi])))))}}function bi({name:Xt,features:ot},lt){lt.writeStringField(1,Xt),lt.writeVarintField(5,a.al);const Tt=new Map,Nt=new Map,Ft={keys:Tt,values:Nt,feature:null};for(const Wt of ot)Ft.feature=Wt,lt.writeMessage(2,or,Ft);for(const Wt of Tt.keys())lt.writeStringField(3,Wt);for(const Wt of Nt.keys())lt.writeMessage(4,We,Wt)}function or(Xt,ot){const lt=Xt.feature;lt.id!==void 0&&Number.isSafeInteger(+lt.id)&&ot.writeVarintField(1,+lt.id),lt.tags&&ot.writeMessage(2,Ue,Xt),ot.writeVarintField(3,lt.type),ot.writeMessage(4,Ke,lt)}function Ue({keys:Xt,values:ot,feature:lt},Tt){for(const Nt of Object.keys(lt.tags)){let Ft=lt.tags[Nt];if(Ft===null)continue;let Wt=Xt.get(Nt);Wt===void 0&&(Wt=Xt.size,Xt.set(Nt,Wt)),Tt.writeVarint(Wt);const ne=typeof Ft;ne!=="string"&&ne!=="boolean"&&ne!=="number"&&(Ft=JSON.stringify(Ft));let $t=ot.get(Ft);$t===void 0&&($t=ot.size,ot.set(Ft,$t)),Tt.writeVarint($t)}}function Ze(Xt,ot){return(ot<<3)+(7&Xt)}function xe(Xt){return Xt<<1^Xt>>31}function Ke(Xt,ot){const{geometry:lt,type:Tt}=Xt;let Nt=0,Ft=0;if(Tt===1){ot.writeVarint(Ze(1,lt.length));for(const Wt of lt){const ne=Wt[0]-Nt,$t=Wt[1]-Ft;ot.writeVarint(xe(ne)),ot.writeVarint(xe($t)),Nt+=ne,Ft+=$t}}else for(const Wt of lt){ot.writeVarint(Ze(1,1));const ne=Wt.length-(Tt===3?1:0);for(let $t=0;$t<ne;$t++){$t===1&&ot.writeVarint(Ze(2,ne-1));const ie=Wt[$t][0]-Nt,Oe=Wt[$t][1]-Ft;ot.writeVarint(xe(ie)),ot.writeVarint(xe(Oe)),Nt+=ie,Ft+=Oe}Tt===3&&ot.writeVarint(Ze(7,1))}}function We(Xt,ot){const lt=typeof Xt;lt==="string"?ot.writeStringField(1,Xt):lt==="boolean"?ot.writeBooleanField(7,Xt):lt==="number"&&(Xt%1!=0?ot.writeDoubleField(3,Xt):Xt<0?ot.writeSVarintField(6,Xt):ot.writeVarintField(5,Xt))}const Ti={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xt=>Xt},Bt=Math.fround||(Zt=new Float32Array(1),Xt=>(Zt[0]=+Xt,Zt[0]));var Zt;const ge=3,$e=5,He=6;class qe{constructor(ot){this.options=Object.assign(Object.create(Ti),ot),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ot){const{log:lt,minZoom:Tt,maxZoom:Nt}=this.options;lt&&console.time("total time");const Ft=`prepare ${ot.length} points`;lt&&console.time(Ft),this.points=ot;const Wt=[];for(let $t=0;$t<ot.length;$t++){const ie=ot[$t];if(!ie.geometry)continue;const[Oe,Ce]=ie.geometry.coordinates,mi=Bt(_i(Oe)),Gi=Bt(pi(Ce));Wt.push(mi,Gi,1/0,$t,-1,1),this.options.reduce&&Wt.push(0)}let ne=this.trees[Nt+1]=this._createTree(Wt);lt&&console.timeEnd(Ft);for(let $t=Nt;$t>=Tt;$t--){const ie=+Date.now();ne=this.trees[$t]=this._createTree(this._cluster(ne,$t)),lt&&console.log("z%d: %d clusters in %dms",$t,ne.numItems,+Date.now()-ie)}return lt&&console.timeEnd("total time"),this}getClusters(ot,lt){let Tt=((ot[0]+180)%360+360)%360-180;const Nt=Math.max(-90,Math.min(90,ot[1]));let Ft=ot[2]===180?180:((ot[2]+180)%360+360)%360-180;const Wt=Math.max(-90,Math.min(90,ot[3]));if(ot[2]-ot[0]>=360)Tt=-180,Ft=180;else if(Tt>Ft){const Ce=this.getClusters([Tt,Nt,180,Wt],lt),mi=this.getClusters([-180,Nt,Ft,Wt],lt);return Ce.concat(mi)}const ne=this.trees[this._limitZoom(lt)],$t=ne.range(_i(Tt),pi(Wt),_i(Ft),pi(Nt)),ie=ne.data,Oe=[];for(const Ce of $t){const mi=this.stride*Ce;Oe.push(ie[mi+$e]>1?Ai(ie,mi,this.clusterProps):this.points[ie[mi+ge]])}return Oe}getChildren(ot){const lt=this._getOriginId(ot),Tt=this._getOriginZoom(ot),Nt="No cluster with the specified id.",Ft=this.trees[Tt];if(!Ft)throw new Error(Nt);const Wt=Ft.data;if(lt*this.stride>=Wt.length)throw new Error(Nt);const ne=this.options.radius/(this.options.extent*Math.pow(2,Tt-1)),$t=Ft.within(Wt[lt*this.stride],Wt[lt*this.stride+1],ne),ie=[];for(const Oe of $t){const Ce=Oe*this.stride;Wt[Ce+4]===ot&&ie.push(Wt[Ce+$e]>1?Ai(Wt,Ce,this.clusterProps):this.points[Wt[Ce+ge]])}if(ie.length===0)throw new Error(Nt);return ie}getLeaves(ot,lt,Tt){const Nt=[];return this._appendLeaves(Nt,ot,lt=lt||10,Tt=Tt||0,0),Nt}getTile(ot,lt,Tt){const Nt=this.trees[this._limitZoom(ot)],Ft=Math.pow(2,ot),{extent:Wt,radius:ne}=this.options,$t=ne/Wt,ie=(Tt-$t)/Ft,Oe=(Tt+1+$t)/Ft,Ce={features:[]};return this._addTileFeatures(Nt.range((lt-$t)/Ft,ie,(lt+1+$t)/Ft,Oe),Nt.data,lt,Tt,Ft,Ce),lt===0&&this._addTileFeatures(Nt.range(1-$t/Ft,ie,1,Oe),Nt.data,Ft,Tt,Ft,Ce),lt===Ft-1&&this._addTileFeatures(Nt.range(0,ie,$t/Ft,Oe),Nt.data,-1,Tt,Ft,Ce),Ce.features.length?Ce:null}getClusterExpansionZoom(ot){let lt=this._getOriginZoom(ot)-1;for(;lt<=this.options.maxZoom;){const Tt=this.getChildren(ot);if(lt++,Tt.length!==1)break;ot=Tt[0].properties.cluster_id}return lt}_appendLeaves(ot,lt,Tt,Nt,Ft){const Wt=this.getChildren(lt);for(const ne of Wt){const $t=ne.properties;if($t&&$t.cluster?Ft+$t.point_count<=Nt?Ft+=$t.point_count:Ft=this._appendLeaves(ot,$t.cluster_id,Tt,Nt,Ft):Ft<Nt?Ft++:ot.push(ne),ot.length===Tt)break}return Ft}_createTree(ot){const lt=new a.c3(ot.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Tt=0;Tt<ot.length;Tt+=this.stride)lt.add(ot[Tt],ot[Tt+1]);return lt.finish(),lt.data=ot,lt}_addTileFeatures(ot,lt,Tt,Nt,Ft,Wt){for(const ne of ot){const $t=ne*this.stride,ie=lt[$t+$e]>1;let Oe,Ce,mi;if(ie)Oe=Ii(lt,$t,this.clusterProps),Ce=lt[$t],mi=lt[$t+1];else{const Mi=this.points[lt[$t+ge]];Oe=Mi.properties;const[dr,pr]=Mi.geometry.coordinates;Ce=_i(dr),mi=pi(pr)}const Gi={type:1,geometry:[[Math.round(this.options.extent*(Ce*Ft-Tt)),Math.round(this.options.extent*(mi*Ft-Nt))]],tags:Oe};let Bi;Bi=ie||this.options.generateId?lt[$t+ge]:this.points[lt[$t+ge]].id,Bi!==void 0&&(Gi.id=Bi),Wt.features.push(Gi)}}_limitZoom(ot){return Math.max(this.options.minZoom,Math.min(Math.floor(+ot),this.options.maxZoom+1))}_cluster(ot,lt){const{radius:Tt,extent:Nt,reduce:Ft,minPoints:Wt}=this.options,ne=Tt/(Nt*Math.pow(2,lt)),$t=ot.data,ie=[],Oe=this.stride;for(let Ce=0;Ce<$t.length;Ce+=Oe){if($t[Ce+2]<=lt)continue;$t[Ce+2]=lt;const mi=$t[Ce],Gi=$t[Ce+1],Bi=ot.within($t[Ce],$t[Ce+1],ne),Mi=$t[Ce+$e];let dr=Mi;for(const pr of Bi){const nn=pr*Oe;$t[nn+2]>lt&&(dr+=$t[nn+$e])}if(dr>Mi&&dr>=Wt){let pr,nn=mi*Mi,Yn=Gi*Mi,wa=-1;const oa=(Ce/Oe<<5)+(lt+1)+this.points.length;for(const ia of Bi){const en=ia*Oe;if($t[en+2]<=lt)continue;$t[en+2]=lt;const Sr=$t[en+$e];nn+=$t[en]*Sr,Yn+=$t[en+1]*Sr,$t[en+4]=oa,Ft&&(pr||(pr=this._map($t,Ce,!0),wa=this.clusterProps.length,this.clusterProps.push(pr)),Ft(pr,this._map($t,en)))}$t[Ce+4]=oa,ie.push(nn/dr,Yn/dr,1/0,oa,-1,dr),Ft&&ie.push(wa)}else{for(let pr=0;pr<Oe;pr++)ie.push($t[Ce+pr]);if(dr>1)for(const pr of Bi){const nn=pr*Oe;if(!($t[nn+2]<=lt)){$t[nn+2]=lt;for(let Yn=0;Yn<Oe;Yn++)ie.push($t[nn+Yn])}}}}return ie}_getOriginId(ot){return ot-this.points.length>>5}_getOriginZoom(ot){return(ot-this.points.length)%32}_map(ot,lt,Tt){if(ot[lt+$e]>1){const Wt=this.clusterProps[ot[lt+He]];return Tt?Object.assign({},Wt):Wt}const Nt=this.points[ot[lt+ge]].properties,Ft=this.options.map(Nt);return Tt&&Ft===Nt?Object.assign({},Ft):Ft}}function Ai(Xt,ot,lt){return{type:"Feature",id:Xt[ot+ge],properties:Ii(Xt,ot,lt),geometry:{type:"Point",coordinates:[(Tt=Xt[ot],360*(Tt-.5)),yr(Xt[ot+1])]}};var Tt}function Ii(Xt,ot,lt){const Tt=Xt[ot+$e],Nt=Tt>=1e4?`${Math.round(Tt/1e3)}k`:Tt>=1e3?Math.round(Tt/100)/10+"k":Tt,Ft=Xt[ot+He],Wt=Ft===-1?{}:Object.assign({},lt[Ft]);return Object.assign(Wt,{cluster:!0,cluster_id:Xt[ot+ge],point_count:Tt,point_count_abbreviated:Nt})}function _i(Xt){return Xt/360+.5}function pi(Xt){const ot=Math.sin(Xt*Math.PI/180),lt=.5-.25*Math.log((1+ot)/(1-ot))/Math.PI;return lt<0?0:lt>1?1:lt}function yr(Xt){const ot=(180-360*Xt)*Math.PI/180;return 360*Math.atan(Math.exp(ot))/Math.PI-90}function Li(Xt,ot,lt,Tt){let Nt=Tt;const Ft=ot+(lt-ot>>1);let Wt,ne=lt-ot;const $t=Xt[ot],ie=Xt[ot+1],Oe=Xt[lt],Ce=Xt[lt+1];for(let mi=ot+3;mi<lt;mi+=3){const Gi=hr(Xt[mi],Xt[mi+1],$t,ie,Oe,Ce);if(Gi>Nt)Wt=mi,Nt=Gi;else if(Gi===Nt){const Bi=Math.abs(mi-Ft);Bi<ne&&(Wt=mi,ne=Bi)}}Nt>Tt&&(Wt-ot>3&&Li(Xt,ot,Wt,Tt),Xt[Wt+2]=Nt,lt-Wt>3&&Li(Xt,Wt,lt,Tt))}function hr(Xt,ot,lt,Tt,Nt,Ft){let Wt=Nt-lt,ne=Ft-Tt;if(Wt!==0||ne!==0){const $t=((Xt-lt)*Wt+(ot-Tt)*ne)/(Wt*Wt+ne*ne);$t>1?(lt=Nt,Tt=Ft):$t>0&&(lt+=Wt*$t,Tt+=ne*$t)}return Wt=Xt-lt,ne=ot-Tt,Wt*Wt+ne*ne}function xr(Xt,ot,lt,Tt){const Nt={id:Xt??null,type:ot,geometry:lt,tags:Tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")tn(Nt,lt);else if(ot==="Polygon")tn(Nt,lt[0]);else if(ot==="MultiLineString")for(const Ft of lt)tn(Nt,Ft);else if(ot==="MultiPolygon")for(const Ft of lt)tn(Nt,Ft[0]);return Nt}function tn(Xt,ot){for(let lt=0;lt<ot.length;lt+=3)Xt.minX=Math.min(Xt.minX,ot[lt]),Xt.minY=Math.min(Xt.minY,ot[lt+1]),Xt.maxX=Math.max(Xt.maxX,ot[lt]),Xt.maxY=Math.max(Xt.maxY,ot[lt+1])}function zn(Xt,ot,lt,Tt){if(!ot.geometry)return;const Nt=ot.geometry.coordinates;if(Nt&&Nt.length===0)return;const Ft=ot.geometry.type,Wt=Math.pow(lt.tolerance/((1<<lt.maxZoom)*lt.extent),2);let ne=[],$t=ot.id;if(lt.promoteId?$t=ot.properties[lt.promoteId]:lt.generateId&&($t=Tt||0),Ft==="Point")Kr(Nt,ne);else if(Ft==="MultiPoint")for(const ie of Nt)Kr(ie,ne);else if(Ft==="LineString")Ua(Nt,ne,Wt,!1);else if(Ft==="MultiLineString"){if(lt.lineMetrics){for(const ie of Nt)ne=[],Ua(ie,ne,Wt,!1),Xt.push(xr($t,"LineString",ne,ot.properties));return}ma(Nt,ne,Wt,!1)}else if(Ft==="Polygon")ma(Nt,ne,Wt,!0);else{if(Ft!=="MultiPolygon"){if(Ft==="GeometryCollection"){for(const ie of ot.geometry.geometries)zn(Xt,{id:$t,geometry:ie,properties:ot.properties},lt,Tt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ie of Nt){const Oe=[];ma(ie,Oe,Wt,!0),ne.push(Oe)}}Xt.push(xr($t,Ft,ne,ot.properties))}function Kr(Xt,ot){ot.push(Io(Xt[0]),Ja(Xt[1]),0)}function Ua(Xt,ot,lt,Tt){let Nt,Ft,Wt=0;for(let $t=0;$t<Xt.length;$t++){const ie=Io(Xt[$t][0]),Oe=Ja(Xt[$t][1]);ot.push(ie,Oe,0),$t>0&&(Wt+=Tt?(Nt*Oe-ie*Ft)/2:Math.sqrt(Math.pow(ie-Nt,2)+Math.pow(Oe-Ft,2))),Nt=ie,Ft=Oe}const ne=ot.length-3;ot[2]=1,Li(ot,0,ne,lt),ot[ne+2]=1,ot.size=Math.abs(Wt),ot.start=0,ot.end=ot.size}function ma(Xt,ot,lt,Tt){for(let Nt=0;Nt<Xt.length;Nt++){const Ft=[];Ua(Xt[Nt],Ft,lt,Tt),ot.push(Ft)}}function Io(Xt){return Xt/360+.5}function Ja(Xt){const ot=Math.sin(Xt*Math.PI/180),lt=.5-.25*Math.log((1+ot)/(1-ot))/Math.PI;return lt<0?0:lt>1?1:lt}function Qn(Xt,ot,lt,Tt,Nt,Ft,Wt,ne){if(Tt/=ot,Ft>=(lt/=ot)&&Wt<Tt)return Xt;if(Wt<lt||Ft>=Tt)return null;const $t=[];for(const ie of Xt){const Oe=ie.geometry;let Ce=ie.type;const mi=Nt===0?ie.minX:ie.minY,Gi=Nt===0?ie.maxX:ie.maxY;if(mi>=lt&&Gi<Tt){$t.push(ie);continue}if(Gi<lt||mi>=Tt)continue;let Bi=[];if(Ce==="Point"||Ce==="MultiPoint")ou(Oe,Bi,lt,Tt,Nt);else if(Ce==="LineString")Qa(Oe,Bi,lt,Tt,Nt,!1,ne.lineMetrics);else if(Ce==="MultiLineString")xs(Oe,Bi,lt,Tt,Nt,!1);else if(Ce==="Polygon")xs(Oe,Bi,lt,Tt,Nt,!0);else if(Ce==="MultiPolygon")for(const Mi of Oe){const dr=[];xs(Mi,dr,lt,Tt,Nt,!0),dr.length&&Bi.push(dr)}if(Bi.length){if(ne.lineMetrics&&Ce==="LineString"){for(const Mi of Bi)$t.push(xr(ie.id,Ce,Mi,ie.tags));continue}Ce!=="LineString"&&Ce!=="MultiLineString"||(Bi.length===1?(Ce="LineString",Bi=Bi[0]):Ce="MultiLineString"),Ce!=="Point"&&Ce!=="MultiPoint"||(Ce=Bi.length===3?"Point":"MultiPoint"),$t.push(xr(ie.id,Ce,Bi,ie.tags))}}return $t.length?$t:null}function ou(Xt,ot,lt,Tt,Nt){for(let Ft=0;Ft<Xt.length;Ft+=3){const Wt=Xt[Ft+Nt];Wt>=lt&&Wt<=Tt&&ls(ot,Xt[Ft],Xt[Ft+1],Xt[Ft+2])}}function Qa(Xt,ot,lt,Tt,Nt,Ft,Wt){let ne=to(Xt);const $t=Nt===0?jn:Co;let ie,Oe,Ce=Xt.start;for(let dr=0;dr<Xt.length-3;dr+=3){const pr=Xt[dr],nn=Xt[dr+1],Yn=Xt[dr+2],wa=Xt[dr+3],oa=Xt[dr+4],ia=Nt===0?pr:nn,en=Nt===0?wa:oa;let Sr=!1;Wt&&(ie=Math.sqrt(Math.pow(pr-wa,2)+Math.pow(nn-oa,2))),ia<lt?en>lt&&(Oe=$t(ne,pr,nn,wa,oa,lt),Wt&&(ne.start=Ce+ie*Oe)):ia>Tt?en<Tt&&(Oe=$t(ne,pr,nn,wa,oa,Tt),Wt&&(ne.start=Ce+ie*Oe)):ls(ne,pr,nn,Yn),en<lt&&ia>=lt&&(Oe=$t(ne,pr,nn,wa,oa,lt),Sr=!0),en>Tt&&ia<=Tt&&(Oe=$t(ne,pr,nn,wa,oa,Tt),Sr=!0),!Ft&&Sr&&(Wt&&(ne.end=Ce+ie*Oe),ot.push(ne),ne=to(Xt)),Wt&&(Ce+=ie)}let mi=Xt.length-3;const Gi=Xt[mi],Bi=Xt[mi+1],Mi=Nt===0?Gi:Bi;Mi>=lt&&Mi<=Tt&&ls(ne,Gi,Bi,Xt[mi+2]),mi=ne.length-3,Ft&&mi>=3&&(ne[mi]!==ne[0]||ne[mi+1]!==ne[1])&&ls(ne,ne[0],ne[1],ne[2]),ne.length&&ot.push(ne)}function to(Xt){const ot=[];return ot.size=Xt.size,ot.start=Xt.start,ot.end=Xt.end,ot}function xs(Xt,ot,lt,Tt,Nt,Ft){for(const Wt of Xt)Qa(Wt,ot,lt,Tt,Nt,Ft,!1)}function ls(Xt,ot,lt,Tt){Xt.push(ot,lt,Tt)}function jn(Xt,ot,lt,Tt,Nt,Ft){const Wt=(Ft-ot)/(Tt-ot);return ls(Xt,Ft,lt+(Nt-lt)*Wt,1),Wt}function Co(Xt,ot,lt,Tt,Nt,Ft){const Wt=(Ft-lt)/(Nt-lt);return ls(Xt,ot+(Tt-ot)*Wt,Ft,1),Wt}function Ch(Xt,ot){const lt=[];for(let Tt=0;Tt<Xt.length;Tt++){const Nt=Xt[Tt],Ft=Nt.type;let Wt;if(Ft==="Point"||Ft==="MultiPoint"||Ft==="LineString")Wt=Tc(Nt.geometry,ot);else if(Ft==="MultiLineString"||Ft==="Polygon"){Wt=[];for(const ne of Nt.geometry)Wt.push(Tc(ne,ot))}else if(Ft==="MultiPolygon"){Wt=[];for(const ne of Nt.geometry){const $t=[];for(const ie of ne)$t.push(Tc(ie,ot));Wt.push($t)}}lt.push(xr(Nt.id,Ft,Wt,Nt.tags))}return lt}function Tc(Xt,ot){const lt=[];lt.size=Xt.size,Xt.start!==void 0&&(lt.start=Xt.start,lt.end=Xt.end);for(let Tt=0;Tt<Xt.length;Tt+=3)lt.push(Xt[Tt]+ot,Xt[Tt+1],Xt[Tt+2]);return lt}function Gs(Xt,ot){if(Xt.transformed)return Xt;const lt=1<<Xt.z,Tt=Xt.x,Nt=Xt.y;for(const Ft of Xt.features){const Wt=Ft.geometry,ne=Ft.type;if(Ft.geometry=[],ne===1)for(let $t=0;$t<Wt.length;$t+=2)Ft.geometry.push(Nv(Wt[$t],Wt[$t+1],ot,lt,Tt,Nt));else for(let $t=0;$t<Wt.length;$t++){const ie=[];for(let Oe=0;Oe<Wt[$t].length;Oe+=2)ie.push(Nv(Wt[$t][Oe],Wt[$t][Oe+1],ot,lt,Tt,Nt));Ft.geometry.push(ie)}}return Xt.transformed=!0,Xt}function Nv(Xt,ot,lt,Tt,Nt,Ft){return[Math.round(lt*(Xt*Tt-Nt)),Math.round(lt*(ot*Tt-Ft))]}function qp(Xt,ot,lt,Tt,Nt){const Ft=ot===Nt.maxZoom?0:Nt.tolerance/((1<<ot)*Nt.extent),Wt={features:[],numPoints:0,numSimplified:0,numFeatures:Xt.length,source:null,x:lt,y:Tt,z:ot,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ne of Xt)Q0(Wt,ne,Ft,Nt);return Wt}function Q0(Xt,ot,lt,Tt){const Nt=ot.geometry,Ft=ot.type,Wt=[];if(Xt.minX=Math.min(Xt.minX,ot.minX),Xt.minY=Math.min(Xt.minY,ot.minY),Xt.maxX=Math.max(Xt.maxX,ot.maxX),Xt.maxY=Math.max(Xt.maxY,ot.maxY),Ft==="Point"||Ft==="MultiPoint")for(let ne=0;ne<Nt.length;ne+=3)Wt.push(Nt[ne],Nt[ne+1]),Xt.numPoints++,Xt.numSimplified++;else if(Ft==="LineString")Zd(Wt,Nt,Xt,lt,!1,!1);else if(Ft==="MultiLineString"||Ft==="Polygon")for(let ne=0;ne<Nt.length;ne++)Zd(Wt,Nt[ne],Xt,lt,Ft==="Polygon",ne===0);else if(Ft==="MultiPolygon")for(let ne=0;ne<Nt.length;ne++){const $t=Nt[ne];for(let ie=0;ie<$t.length;ie++)Zd(Wt,$t[ie],Xt,lt,!0,ie===0)}if(Wt.length){let ne=ot.tags||null;if(Ft==="LineString"&&Tt.lineMetrics){ne={};for(const ie in ot.tags)ne[ie]=ot.tags[ie];ne.mapbox_clip_start=Nt.start/Nt.size,ne.mapbox_clip_end=Nt.end/Nt.size}const $t={geometry:Wt,type:Ft==="Polygon"||Ft==="MultiPolygon"?3:Ft==="LineString"||Ft==="MultiLineString"?2:1,tags:ne};ot.id!==null&&($t.id=ot.id),Xt.features.push($t)}}function Zd(Xt,ot,lt,Tt,Nt,Ft){const Wt=Tt*Tt;if(Tt>0&&ot.size<(Nt?Wt:Tt))return void(lt.numPoints+=ot.length/3);const ne=[];for(let $t=0;$t<ot.length;$t+=3)(Tt===0||ot[$t+2]>Wt)&&(lt.numSimplified++,ne.push(ot[$t],ot[$t+1])),lt.numPoints++;Nt&&function($t,ie){let Oe=0;for(let Ce=0,mi=$t.length,Gi=mi-2;Ce<mi;Gi=Ce,Ce+=2)Oe+=($t[Ce]-$t[Gi])*($t[Ce+1]+$t[Gi+1]);if(Oe>0===ie)for(let Ce=0,mi=$t.length;Ce<mi/2;Ce+=2){const Gi=$t[Ce],Bi=$t[Ce+1];$t[Ce]=$t[mi-2-Ce],$t[Ce+1]=$t[mi-1-Ce],$t[mi-2-Ce]=Gi,$t[mi-1-Ce]=Bi}}(ne,Ft),Xt.push(ne)}const Me={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fu{constructor(ot,lt){const Tt=(lt=this.options=function(Ft,Wt){for(const ne in Wt)Ft[ne]=Wt[ne];return Ft}(Object.create(Me),lt)).debug;if(Tt&&console.time("preprocess data"),lt.maxZoom<0||lt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lt.promoteId&&lt.generateId)throw new Error("promoteId and generateId cannot be used together.");let Nt=function(Ft,Wt){const ne=[];if(Ft.type==="FeatureCollection")for(let $t=0;$t<Ft.features.length;$t++)zn(ne,Ft.features[$t],Wt,$t);else zn(ne,Ft.type==="Feature"?Ft:{geometry:Ft},Wt);return ne}(ot,lt);this.tiles={},this.tileCoords=[],Tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lt.indexMaxZoom,lt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Nt=function(Ft,Wt){const ne=Wt.buffer/Wt.extent;let $t=Ft;const ie=Qn(Ft,1,-1-ne,ne,0,-1,2,Wt),Oe=Qn(Ft,1,1-ne,2+ne,0,-1,2,Wt);return(ie||Oe)&&($t=Qn(Ft,1,-ne,1+ne,0,-1,2,Wt)||[],ie&&($t=Ch(ie,1).concat($t)),Oe&&($t=$t.concat(Ch(Oe,-1)))),$t}(Nt,lt),Nt.length&&this.splitTile(Nt,0,0,0),Tt&&(Nt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ot,lt,Tt,Nt,Ft,Wt,ne){const $t=[ot,lt,Tt,Nt],ie=this.options,Oe=ie.debug;for(;$t.length;){Nt=$t.pop(),Tt=$t.pop(),lt=$t.pop(),ot=$t.pop();const Ce=1<<lt,mi=Xp(lt,Tt,Nt);let Gi=this.tiles[mi];if(!Gi&&(Oe>1&&console.time("creation"),Gi=this.tiles[mi]=qp(ot,lt,Tt,Nt,ie),this.tileCoords.push({z:lt,x:Tt,y:Nt}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lt,Tt,Nt,Gi.numFeatures,Gi.numPoints,Gi.numSimplified),console.timeEnd("creation"));const Sr=`z${lt}`;this.stats[Sr]=(this.stats[Sr]||0)+1,this.total++}if(Gi.source=ot,Ft==null){if(lt===ie.indexMaxZoom||Gi.numPoints<=ie.indexMaxPoints)continue}else{if(lt===ie.maxZoom||lt===Ft)continue;if(Ft!=null){const Sr=Ft-lt;if(Tt!==Wt>>Sr||Nt!==ne>>Sr)continue}}if(Gi.source=null,ot.length===0)continue;Oe>1&&console.time("clipping");const Bi=.5*ie.buffer/ie.extent,Mi=.5-Bi,dr=.5+Bi,pr=1+Bi;let nn=null,Yn=null,wa=null,oa=null,ia=Qn(ot,Ce,Tt-Bi,Tt+dr,0,Gi.minX,Gi.maxX,ie),en=Qn(ot,Ce,Tt+Mi,Tt+pr,0,Gi.minX,Gi.maxX,ie);ot=null,ia&&(nn=Qn(ia,Ce,Nt-Bi,Nt+dr,1,Gi.minY,Gi.maxY,ie),Yn=Qn(ia,Ce,Nt+Mi,Nt+pr,1,Gi.minY,Gi.maxY,ie),ia=null),en&&(wa=Qn(en,Ce,Nt-Bi,Nt+dr,1,Gi.minY,Gi.maxY,ie),oa=Qn(en,Ce,Nt+Mi,Nt+pr,1,Gi.minY,Gi.maxY,ie),en=null),Oe>1&&console.timeEnd("clipping"),$t.push(nn||[],lt+1,2*Tt,2*Nt),$t.push(Yn||[],lt+1,2*Tt,2*Nt+1),$t.push(wa||[],lt+1,2*Tt+1,2*Nt),$t.push(oa||[],lt+1,2*Tt+1,2*Nt+1)}}getTile(ot,lt,Tt){ot=+ot,lt=+lt,Tt=+Tt;const Nt=this.options,{extent:Ft,debug:Wt}=Nt;if(ot<0||ot>24)return null;const ne=1<<ot,$t=Xp(ot,lt=lt+ne&ne-1,Tt);if(this.tiles[$t])return Gs(this.tiles[$t],Ft);Wt>1&&console.log("drilling down to z%d-%d-%d",ot,lt,Tt);let ie,Oe=ot,Ce=lt,mi=Tt;for(;!ie&&Oe>0;)Oe--,Ce>>=1,mi>>=1,ie=this.tiles[Xp(Oe,Ce,mi)];return ie&&ie.source?(Wt>1&&(console.log("found parent tile z%d-%d-%d",Oe,Ce,mi),console.time("drilling down")),this.splitTile(ie.source,Oe,Ce,mi,ot,lt,Tt),Wt>1&&console.timeEnd("drilling down"),this.tiles[$t]?Gs(this.tiles[$t],Ft):null):null}}function Xp(Xt,ot,lt){return 32*((1<<Xt)*lt+ot)+Xt}function Yp(Xt,ot){const lt=Xt.tileID.canonical;if(!this._geoJSONIndex)return void ot(null,null);const Tt=this._geoJSONIndex.getTile(lt.z,lt.x,lt.y);if(!Tt)return void ot(null,null);const Nt=ie=>ie.tags&&"3d_elevation_id"in ie.tags&&"source"in ie.tags&&ie.tags.source==="elevation",Ft=Tt.features.filter(ie=>Nt(ie));let Wt={_geojsonTileLayer:Tt.features};Ft.length>0&&(Wt={_geojsonTileLayer:Tt.features.filter(ie=>!Nt(ie)),hd_road_elevation:Ft});const ne=new Dt(Wt),$t=function(ie){const Oe=new a.bs;for(const Ce of Object.keys(ie))Oe.writeMessage(3,bi,{name:Ce,features:ie[Ce]});return Oe.finish()}(Wt).buffer;ot(null,{vectorTile:ne,rawData:$t})}class wr extends J{constructor(ot,lt,Tt,Nt,Ft,Wt,ne){super(ot,lt,Tt,Nt,Ft,Yp,ne),Wt&&(this.loadGeoJSON=Wt),this._dynamicIndex=new Vt}loadData(ot,lt){const Tt=ot&&ot.request,Nt=Tt&&Tt.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ot,(Ft,Wt)=>{if(Ft||!Wt)return lt(Ft);if(typeof Wt!="object")return lt(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`));{try{if(ot.filter){const $t=a.U(ot.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($t.result==="error")throw new Error($t.value.map(ie=>`${ie.key}: ${ie.message}`).join(", "));Wt.features=Wt.features.filter(ie=>$t.value.evaluate({zoom:0},ie))}ot.dynamic?(Wt.type==="Feature"&&(Wt={type:"FeatureCollection",features:[Wt]}),ot.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Wt.features,this.loaded),ot.cluster&&(Wt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ot.cluster?new qe(function({superclusterOptions:$t,clusterProperties:ie}){if(!ie||!$t)return $t;const Oe={},Ce={},mi={accumulated:null,zoom:0},Gi={properties:null},Bi=Object.keys(ie);for(const Mi of Bi){const[dr,pr]=ie[Mi],nn=a.U(pr),Yn=a.U(typeof dr=="string"?[dr,["accumulated"],["get",Mi]]:dr);Oe[Mi]=nn.value,Ce[Mi]=Yn.value}return $t.map=Mi=>{Gi.properties=Mi;const dr={};for(const pr of Bi)dr[pr]=Oe[pr].evaluate(mi,Gi);return dr},$t.reduce=(Mi,dr)=>{Gi.properties=dr;for(const pr of Bi)mi.accumulated=Mi[pr],Mi[pr]=Ce[pr].evaluate(mi,Gi)},$t}(ot)).load(Wt.features):ot.dynamic?this._dynamicIndex:function($t,ie){return new Fu($t,ie)}(Wt,ot.geojsonVtOptions)}catch($t){return lt($t)}const ne={};if(Nt){const $t=c(Tt);$t&&(ne.resourceTiming={},ne.resourceTiming[ot.source]=JSON.parse(JSON.stringify($t)))}lt(null,ne)}})}reloadTile(ot,lt){const Tt=this.loaded;return Tt&&Tt[ot.uid]?ot.partial?lt(null,void 0):super.reloadTile(ot,lt):this.loadTile(ot,lt)}loadGeoJSON(ot,lt){if(ot.request)a.m(ot.request,lt);else{if(typeof ot.data!="string")return lt(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return lt(null,JSON.parse(ot.data))}catch{return lt(new Error(`Input data given to '${ot.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ot,lt){try{lt(null,this._geoJSONIndex.getClusterExpansionZoom(ot.clusterId))}catch(Tt){lt(Tt)}}getClusterChildren(ot,lt){try{lt(null,this._geoJSONIndex.getChildren(ot.clusterId))}catch(Tt){lt(Tt)}}getClusterLeaves(ot,lt){try{lt(null,this._geoJSONIndex.getLeaves(ot.clusterId,ot.limit,ot.offset))}catch(Tt){lt(Tt)}}}class Vo{constructor(ot,lt,Tt){this.tileID=new a.aP(ot.tileID.overscaledZ,ot.tileID.wrap,ot.tileID.canonical.z,ot.tileID.canonical.x,ot.tileID.canonical.y),this.tileZoom=ot.tileZoom,this.uid=ot.uid,this.zoom=ot.zoom,this.canonical=ot.tileID.canonical,this.pixelRatio=ot.pixelRatio,this.tileSize=ot.tileSize,this.source=ot.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ot.projection,this.brightness=lt,this.worldview=Tt}parse(ot,lt,Tt,Nt){this.status="parsing";const Ft=new a.aP(Tt.tileID.overscaledZ,Tt.tileID.wrap,Tt.tileID.canonical.z,Tt.tileID.canonical.x,Tt.tileID.canonical.y),Wt=[],ne=lt.familiesBySource[Tt.source],$t=new a.fm(Ft,Tt.promoteId);$t.bucketLayerIDs=[],$t.is3DTile=!0,a.fB(ot).then(ie=>{if(!ie)return Nt(new Error("Could not parse tile"));const Oe=ie.json.extensionsUsed&&ie.json.extensionsUsed.includes("MAPBOX_mesh_features")||ie.json.asset.extras&&ie.json.asset.extras.MAPBOX_mesh_features,Ce=ie.json.extensionsUsed&&ie.json.extensionsUsed.includes("EXT_meshopt_compression"),mi=new a.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Gi in ne)for(const Bi of ne[Gi]){const Mi=Bi[0];$t.bucketLayerIDs.push(Bi.map(nn=>a.B(nn.id,nn.scope))),Mi.recalculate(mi,[]);const dr=a.fC(ie,1/a.d6(Tt.tileID.canonical)),pr=new a.fD(Bi,dr,Ft,Oe,Ce,this.brightness,$t,this.worldview);Oe||(pr.needsUpload=!0),Wt.push(pr),pr.evaluate(Mi)}this.status="done",Nt(null,{buckets:Wt,featureIndex:$t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ie=>Nt(new Error(ie.message)))}}class tx{constructor(ot,lt,Tt,Nt,Ft,Wt,ne,$t){this.actor=ot,this.layerIndex=lt,this.availableImages=Tt,this.availableModels=Nt,this.brightness=ne,this.loading={},this.loaded={},this.worldview=$t}loadTile(ot,lt){const Tt=ot.uid,Nt=this.loading[Tt]=new Vo(ot,this.brightness,this.worldview);a.bt(ot.request,(Ft,Wt)=>{const ne=!this.loading[Tt];return delete this.loading[Tt],ne||Ft?(Nt.status="done",ne||(this.loaded[Tt]=Nt),lt(Ft)):Wt&&Wt.byteLength!==0?void Nt.parse(Wt,this.layerIndex,ot,($t,ie)=>{Nt.status="done",this.loaded=this.loaded||{},this.loaded[Tt]=Nt,$t||!ie?lt($t):lt(null,ie)}):(Nt.status="done",this.loaded[Tt]=Nt,lt())})}reloadTile(ot,lt){const Tt=this.loaded,Nt=ot.uid;if(Tt&&Tt[Nt]){const Ft=Tt[Nt];Ft.projection=ot.projection,Ft.brightness=ot.brightness;const Wt=(ne,$t)=>{Ft.reloadCallback&&(delete Ft.reloadCallback,this.loadTile(ot,lt)),lt(ne,$t)};Ft.status==="parsing"?Ft.reloadCallback=Wt:Ft.status==="done"&&this.loadTile(ot,lt)}}abortTile(ot,lt){const Tt=ot.uid;this.loading[Tt]&&delete this.loading[Tt],lt()}removeTile(ot,lt){const Tt=this.loaded,Nt=ot.uid;Tt&&Tt[Nt]&&delete Tt[Nt],lt()}}class Kp{constructor(ot){this.self=ot,this.actor=new a.fF(ot,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.cl({name:"mercator"}),this.workerSourceTypes={vector:J,geojson:wr,"raster-dem":it,"raster-array":ut,"batched-model":tx},this.workerSources={},this.self.registerWorkerSource=(lt,Tt)=>{if(this.workerSourceTypes[lt])throw new Error(`Worker source with name "${lt}" already registered.`);this.workerSourceTypes[lt]=Tt},this.self.registerRTLTextPlugin=lt=>{if(a.fG.isParsed())throw new Error("RTL text plugin already registered.");a.fG.setState({pluginStatus:a.fH.parsed,pluginURL:a.fG.getPluginURL()}),a.fG.applyArabicShaping=lt.applyArabicShaping,a.fG.processBidirectionalText=lt.processBidirectionalText,a.fG.processStyledBidirectionalText=lt.processStyledBidirectionalText;for(const Tt of this.rtlPluginParsingListeners)Tt(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ot,lt,Tt){delete this.layerIndexes[ot],delete this.availableImages[ot],delete this.availableModels[ot],delete this.workerSources[ot],Tt()}checkIfReady(ot,lt,Tt){Tt()}setReferrer(ot,lt){this.referrer=lt}spriteLoaded(ot,lt){this.isSpriteLoaded[ot]||(this.isSpriteLoaded[ot]={});const{scope:Tt,isLoaded:Nt}=lt;if(this.isSpriteLoaded[ot][Tt]=Nt,this.workerSources[ot]&&this.workerSources[ot][Tt])for(const Ft in this.workerSources[ot][Tt]){const Wt=this.workerSources[ot][Tt][Ft];for(const ne in Wt){const $t=Wt[ne];$t instanceof J&&($t.isSpriteLoaded=Nt,$t.fire(new a.z("isSpriteLoaded")))}}}setImages(ot,lt,Tt){this.availableImages[ot]||(this.availableImages[ot]={});const{scope:Nt,images:Ft}=lt;if(this.availableImages[ot][Nt]=Ft,this.workerSources[ot]&&this.workerSources[ot][Nt]){for(const Wt in this.workerSources[ot][Nt]){const ne=this.workerSources[ot][Nt][Wt];for(const $t in ne)ne[$t].availableImages=Ft}Tt()}else Tt()}setModels(ot,{scope:lt,models:Tt},Nt){if(this.availableModels[ot]||(this.availableModels[ot]={}),this.availableModels[ot][lt]=Tt,this.workerSources[ot]&&this.workerSources[ot][lt]){for(const Ft in this.workerSources[ot][lt]){const Wt=this.workerSources[ot][lt][Ft];for(const ne in Wt)Wt[ne].availableModels=Tt}Nt()}else Nt()}setProjection(ot,lt){this.projections[ot]=a.cl(lt)}setBrightness(ot,lt,Tt){this.brightness=lt,Tt()}setWorldview(ot,lt,Tt){this.worldview=lt,Tt()}setLayers(ot,lt,Tt){this.getLayerIndex(ot,lt.scope).replace(lt.layers,lt.options),Tt()}updateLayers(ot,lt,Tt){this.getLayerIndex(ot,lt.scope).update(lt.layers,lt.removedIds,lt.options),Tt()}loadTile(ot,lt,Tt){lt.projection=this.projections[ot]||this.defaultProjection,this.getWorkerSource(ot,lt.type,lt.source,lt.scope).loadTile(lt,Tt)}decodeRasterArray(ot,lt,Tt){this.getWorkerSource(ot,lt.type,lt.source,lt.scope).decodeRasterArray(lt,Tt)}reloadTile(ot,lt,Tt){lt.projection=this.projections[ot]||this.defaultProjection,this.getWorkerSource(ot,lt.type,lt.source,lt.scope).reloadTile(lt,Tt)}abortTile(ot,lt,Tt){this.getWorkerSource(ot,lt.type,lt.source,lt.scope).abortTile(lt,Tt)}removeTile(ot,lt,Tt){this.getWorkerSource(ot,lt.type,lt.source,lt.scope).removeTile(lt,Tt)}removeSource(ot,lt,Tt){if(!(this.workerSources[ot]&&this.workerSources[ot][lt.scope]&&this.workerSources[ot][lt.scope][lt.type]&&this.workerSources[ot][lt.scope][lt.type][lt.source]))return;const Nt=this.workerSources[ot][lt.scope][lt.type][lt.source];delete this.workerSources[ot][lt.scope][lt.type][lt.source],Nt.removeSource!==void 0?Nt.removeSource(lt,Tt):Tt()}loadWorkerSource(ot,lt,Tt){try{this.self.importScripts(lt.url),Tt()}catch(Nt){Tt(Nt.toString())}}syncRTLPluginState(ot,lt,Tt){if(a.fG.isParsed())Tt(null,!0);else if(a.fG.isParsing())this.rtlPluginParsingListeners.push(Tt);else try{a.fG.setState(lt);const Nt=a.fG.getPluginURL();!a.fG.isLoaded()||a.fG.isParsed()||a.fG.isParsing()||Nt==null||(a.fG.setState({pluginStatus:a.fH.parsing,pluginURL:a.fG.getPluginURL()}),this.self.importScripts(Nt),a.fG.isParsed()?Tt(null,!0):this.rtlPluginParsingListeners.push(Tt))}catch(Nt){Tt(Nt.toString())}}setDracoUrl(ot,lt){this.dracoUrl=lt}getAvailableImages(ot,lt){this.availableImages[ot]||(this.availableImages[ot]={});let Tt=this.availableImages[ot][lt];return Tt||(Tt=[]),Tt}getAvailableModels(ot,lt){this.availableModels[ot]||(this.availableModels[ot]={});let Tt=this.availableModels[ot][lt];return Tt||(Tt={}),Tt}getLayerIndex(ot,lt){this.layerIndexes[ot]||(this.layerIndexes[ot]={});let Tt=this.layerIndexes[ot][lt];return Tt||(Tt=this.layerIndexes[ot][lt]=new v,Tt.scope=lt),Tt}getWorkerSource(ot,lt,Tt,Nt){const Ft=this.workerSources;return Ft[ot]||(Ft[ot]={}),Ft[ot][Nt]||(Ft[ot][Nt]={}),Ft[ot][Nt][lt]||(Ft[ot][Nt][lt]={}),this.isSpriteLoaded[ot]||(this.isSpriteLoaded[ot]={}),Ft[ot][Nt][lt][Tt]||(Ft[ot][Nt][lt][Tt]=new this.workerSourceTypes[lt]({send:(Wt,ne,$t,ie,Oe,Ce)=>this.actor.send(Wt,ne,$t,ot,Oe,Ce),scheduler:this.actor.scheduler},this.getLayerIndex(ot,Nt),this.getAvailableImages(ot,Nt),this.getAvailableModels(ot,Nt),this.isSpriteLoaded[ot][Nt],void 0,this.brightness,this.worldview)),Ft[ot][Nt][lt][Tt]}rasterizeImagesWorker(ot,lt,Tt){const Nt=new Map;for(const[Ft,{image:Wt,imageVariant:ne}]of lt.tasks.entries()){const $t=this.imageRasterizer.rasterize(ne,Wt,lt.scope,ot);Nt.set(Ft,$t)}Tt(void 0,Nt)}removeRasterizedImages(ot,lt,Tt){this.imageRasterizer.removeImagesFromCacheByIds(lt.imageIds,lt.scope,ot),Tt()}enforceCacheSizeLimit(ot,lt){a.fI(lt)}getWorkerPerformanceMetrics(ot,lt,Tt){Tt(void 0,void 0)}}return a.fE(self)&&(self.worker=new Kp(self)),Kp}),o(["./shared"],function(a){var c="3.16.0";const f={create:"create",load:"load",fullLoad:"fullLoad"},g={mark(x){performance.mark(x)},measure(x,u,p){performance.measure(x,u,p)}};function v(x){const u=x.name.split("?")[0];return a.a(u)&&u.includes("mapbox-gl.js")?"javascript":a.a(u)&&u.includes("mapbox-gl.css")?"css":a.b(u)?"fontRange":a.c(u)?"sprite":a.i(u)?"style":a.d(u)?"tilejson":"other"}var y,w={},I=function(){if(y)return w;function x(b){return!u(b)}function u(b){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,P,O=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(O);try{P=new Worker(B),M=!0}catch{M=!1}return P&&P.terminate(),URL.revokeObjectURL(B),M}()?function(){var M=document.createElement("canvas");M.width=M.height=1;var P=M.getContext("2d");if(!P)return!1;var O=P.getImageData(0,0,1,1);return O&&O.width===M.width}()?(p[A=b&&b.failIfMajorPerformanceCaveat]===void 0&&(p[A]=function(M){var P,O=function(B){var G=document.createElement("canvas"),j=Object.create(x.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=B,G.getContext("webgl2",j)}(M);if(!O)return!1;try{P=O.createShader(O.VERTEX_SHADER)}catch{return!1}return!(!P||O.isContextLost())&&(O.shaderSource(P,"void main() {}"),O.compileShader(P),O.getShaderParameter(P,O.COMPILE_STATUS)===!0)}(A)),p[A]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var A}y=1,w.supported=x,w.notSupportedReason=u;var p={};return x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},w}();function E(x,u,p){const b=document.createElement(x);return u!=null&&(b.className=u),p&&p.appendChild(b),b}function D(x,u,p){const b=document.createElementNS("http://www.w3.org/2000/svg",x);for(const A of Object.keys(u))b.setAttributeNS(null,A,String(u[A]));return p&&p.appendChild(b),b}const R=typeof document<"u"?document.documentElement&&document.documentElement.style:null,z=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect";let N;function H(){R&&z&&(N=R[z],R[z]="none")}function q(){R&&z&&(R[z]=N)}function Y(x){x.preventDefault(),x.stopPropagation(),window.removeEventListener("click",Y,!0)}function J(){window.addEventListener("click",Y,!0),window.setTimeout(()=>{window.removeEventListener("click",Y,!0)},0)}function it(x,u){const p=x.getBoundingClientRect();return ft(x,p,u)}function at(x,u){const p=x.getBoundingClientRect(),b=[];for(let A=0;A<u.length;A++)b.push(ft(x,p,u[A]));return b}function ut(x){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&x.button===2&&x.ctrlKey?0:x.button}function ft(x,u,p){const b=x.offsetWidth===u.width?1:x.offsetWidth/u.width;return new a.P((p.clientX-u.left)*b,(p.clientY-u.top)*b)}const _t="01",ct="NO_ACCESS_TOKEN";class Dt{constructor(u,p,b){this._transformRequestFn=u,this._customAccessToken=p,this._silenceAuthErrors=!!b,this._createSkuToken()}_createSkuToken(){const u=function(){let p="";for(let b=0;b<10;b++)p+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_t,p].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=u.token,this._skuTokenExpiresAt=u.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(u,p){return this._transformRequestFn&&this._transformRequestFn(u,p)||{url:u}}normalizeStyleURL(u,p){if(!a.h(u))return u;const b=bt(u);return b.params.push(`sdk=js-${c}`),b.path=`/styles/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||p)}normalizeGlyphsURL(u,p){if(!a.h(u))return u;const b=bt(u);return b.path=`/fonts/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||p)}normalizeModelURL(u,p){if(!a.h(u))return u;const b=bt(u);return b.path=`/models/v1${b.path}`,this._makeAPIURL(b,this._customAccessToken||p)}normalizeSourceURL(u,p,b,A){if(!a.h(u))return u;const M=bt(u);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),b&&M.params.push(`language=${b}`),A&&M.params.push(`worldview=${A}`),this._makeAPIURL(M,this._customAccessToken||p)}normalizeIconsetURL(u,p){const b=bt(u);return a.h(u)?(b.path=`/styles/v1${b.path}/iconset.pbf`,this._makeAPIURL(b,this._customAccessToken||p)):Vt(b)}normalizeSpriteURL(u,p,b,A){const M=bt(u);return a.h(u)?(M.path=`/styles/v1${M.path}/sprite${p}${b}`,this._makeAPIURL(M,this._customAccessToken||A)):(M.path+=`${p}${b}`,Vt(M))}normalizeTileURL(u,p,b){if(this._isSkuTokenExpired()&&this._createSkuToken(),u&&!a.h(u))return u;const A=bt(u);A.path=A.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${p||b&&A.authority!=="raster"&&b===512?"@2x":""}${a.k.supported?".webp":"$1"}`),A.authority==="raster"?A.path=`/${a.e.RASTER_URL_PREFIX}${A.path}`:A.authority==="rasterarrays"?A.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${A.path}`:A.authority==="3dtiles"?A.path=`/${a.e.TILES3D_URL_PREFIX}${A.path}`:(A.path=A.path.replace(/^.+\/v4\//,"/"),A.path=`/${a.e.TILE_URL_VERSION}${A.path}`);const M=this._customAccessToken||function(P){for(const O of P){const B=O.match(/^access_token=(.*)$/);if(B)return B[1]}return null}(A.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&A.params.push(`sku=${this._skuToken}`),this._makeAPIURL(A,M)}canonicalizeTileURL(u,p){const b=bt(u);if(!b.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!b.path.match(/\.[\w]+$/))return u;let A="mapbox://";b.path.match(/^\/raster\/v1\//)?A+=`raster/${b.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:b.path.match(/^\/rasterarrays\/v1\//)?A+=`rasterarrays/${b.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:A+=`tiles/${b.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let M=b.params;return p&&(M=M.filter(P=>!P.match(/^access_token=/))),M.length&&(A+=`?${M.join("&")}`),A}canonicalizeTileset(u,p){const b=!!p&&a.h(p),A=[];for(const M of u.tiles||[])a.j(M)?A.push(this.canonicalizeTileURL(M,b)):A.push(M);return A}_makeAPIURL(u,p){const b="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",A=bt(a.e.API_URL);if(u.protocol=A.protocol,u.authority=A.authority,u.protocol==="http"){const M=u.params.indexOf("secure");M>=0&&u.params.splice(M,1)}if(A.path!=="/"&&(u.path=`${A.path}${u.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Vt(u);if(p=p||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!p)throw new Error(`An API access token is required to use Mapbox GL. ${b}`);if(p[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${b}`)}return u.params=u.params.filter(M=>M.indexOf("access_token")===-1),u.params.push(`access_token=${p||""}`),Vt(u)}}const Et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bt(x){const u=x.match(Et);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function Vt(x){const u=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${u}`}const zt="mapbox.eventData";function Jt(x){if(!x)return null;const u=x.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(a.l(u[1]))}catch{return null}}class ce{constructor(u){this.type=u,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(u){const p=Jt(a.e.ACCESS_TOKEN);let b="";return b=p&&p.u?a.f(p.u):a.e.ACCESS_TOKEN||"",u?`${zt}.${u}:${b}`:`${zt}:${b}`}fetchEventData(){const u=a.s("localStorage"),p=this.getStorageKey(),b=this.getStorageKey("uuid"),A=this.getStorageKey("uuidTimestamp");if(u)try{const M=localStorage.getItem(p);M&&(this.eventData=JSON.parse(M));const P=localStorage.getItem(b);P&&(this.anonId=P);const O=localStorage.getItem(A);O&&(this.anonIdTimestamp=Number(O));const B=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<B)&&this.refreshUUID()}catch{a.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=a.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const u=a.s("localStorage"),p=this.getStorageKey(),b=this.getStorageKey("uuid"),A=this.getStorageKey("uuidTimestamp"),M=this.anonId,P=this.anonIdTimestamp;if(u&&M)try{localStorage.setItem(b,M),Object.keys(this.eventData).length>=1&&localStorage.setItem(p,JSON.stringify(this.eventData)),P&&localStorage.setItem(A,P.toString())}catch{a.w("Unable to write to LocalStorage")}}processRequests(u){}postEvent(u,p,b,A){if(!a.e.EVENTS_URL)return;const M=bt(a.e.EVENTS_URL);M.params.push(`access_token=${A||a.e.ACCESS_TOKEN||""}`);const P={event:this.type,created:new Date(u).toISOString()},O=p?Object.assign(P,p):P,B={url:Vt(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=a.p(B,G=>{this.pendingRequest=null,b(G),this.saveEventData(),this.processRequests(A)})}queueRequest(u,p){this.queue.push(u),this.processRequests(p)}}const be=new class extends ce{constructor(x){super("appUserTurnstile"),this._customAccessToken=x}postTurnstileEvent(x,u){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(x)&&x.some(p=>a.h(p)||a.j(p))&&this.queueRequest(Date.now(),u)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const u=Jt(a.e.ACCESS_TOKEN),p=u?u.u:a.e.ACCESS_TOKEN;let b=p!==this.eventData.tokenU;a.v(this.anonId)||(this.refreshUUID(),b=!0);const A=this.queue.shift();if(this.eventData.lastSuccess){const M=new Date(this.eventData.lastSuccess),P=new Date(A),O=(A-this.eventData.lastSuccess)/864e5;b=b||O>=1||O<-1||M.getDate()!==P.getDate()}else b=!0;b?this.postEvent(A,{sdkIdentifier:"mapbox-gl-js",sdkVersion:c,skuId:_t,"enabled.telemetry":!1,userId:this.anonId},M=>{M||(this.eventData.lastSuccess=A,this.eventData.tokenU=p)},x):this.processRequests()}},ve=be.postTurnstileEvent.bind(be),ke=new class extends ce{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(x,u,p,b){this.skuToken=u,this.errorCb=b,a.e.EVENTS_URL&&(p||a.e.ACCESS_TOKEN?this.queueRequest({id:x,timestamp:Date.now()},p):this.errorCb(new Error(ct)))}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{id:u,timestamp:p}=this.queue.shift();u&&this.success[u]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID(),this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:c,skuId:_t,skuToken:this.skuToken,userId:this.anonId},b=>{b?this.errorCb(b):u&&(this.success[u]=!0)},x))}remove(){this.errorCb=null}},ni=ke.postMapLoadEvent.bind(ke),bi=new class extends ce{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(x){let u=this.mapInstanceIdMap.get(x);return u||(u=a.u(),this.mapInstanceIdMap.set(x,u)),u}getEventId(x){const u=this.eventIdPerMapInstanceMap.get(x)||0;return this.eventIdPerMapInstanceMap.set(x,u+1),u}postStyleLoadEvent(x,u){const{map:p,style:b,importedStyles:A}=u;if(!a.e.EVENTS_URL||!x&&!a.e.ACCESS_TOKEN)return;const M=this.getMapInstanceId(p),P={mapInstanceId:M,eventId:this.getEventId(M),style:b};A.length&&(P.importedStyles=A),this.queueRequest({timestamp:Date.now(),payload:P},x)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,payload:p}=this.queue.shift();this.postEvent(u,p,()=>{},x)}},or=bi.postStyleLoadEvent.bind(bi),Ue=new class extends ce{constructor(x){super("metrics"),x&&(this.data=x)}postMetricsEvent(x){if(!a.e.EVENTS_URL||!x&&!a.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),a.v(this.anonId)||this.refreshUUID();const u=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:u},x)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,payload:p}=this.queue.shift();this.postEvent(u,p,()=>{},x)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Ze=Ue.postMetricsEvent.bind(Ue),xe=new class extends ce{constructor(){super("gljs.performance")}postPerformanceEvent(x,u){a.e.EVENTS_URL&&(x||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:u},x)}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:u,performanceData:p}=this.queue.shift(),b=function(A){const M=performance.getEntriesByType("resource"),P=performance.getEntriesByType("mark"),O=function(K){const tt={};if(K){for(const rt in K)if(rt!=="other")for(const ht of K[rt]){const st=`${rt}ResolveRangeMin`,gt=`${rt}ResolveRangeMax`,xt=`${rt}RequestCount`,vt=`${rt}RequestCachedCount`;tt[st]=Math.min(tt[st]||1/0,ht.startTime),tt[gt]=Math.max(tt[gt]||-1/0,ht.responseEnd);const Pt=wt=>{tt[wt]===void 0&&(tt[wt]=0),++tt[wt]};ht.transferSize!==void 0&&ht.transferSize===0&&Pt(vt),Pt(xt)}}return tt}(function(K,tt){const rt={};if(K)for(const ht of K){const st=tt(ht);rt[st]===void 0&&(rt[st]=[]),rt[st].push(ht)}return rt}(M,v)),B=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=G?G.effectiveType:void 0,X={counters:[],metadata:[],attributes:[]},W=(K,tt,rt)=>{rt!=null&&K.push({name:tt,value:rt.toString()})};for(const K in O)W(X.counters,K,O[K]);if(A.interactionRange[0]!==1/0&&A.interactionRange[1]!==-1/0&&(W(X.counters,"interactionRangeMin",A.interactionRange[0]),W(X.counters,"interactionRangeMax",A.interactionRange[1])),P)for(const K of Object.values(f)){const tt=P.find(rt=>rt.name===K);tt&&W(X.counters,K,tt.startTime)}return W(X.counters,"visibilityHidden",A.visibilityHidden),W(X.attributes,"style",function(K){if(K)for(const tt of K){const rt=tt.name.split("?")[0];if(a.i(rt)){const ht=rt.split("/").slice(-2);if(ht.length===2)return`mapbox://styles/${ht[0]}/${ht[1]}`}}}(M)),W(X.attributes,"terrainEnabled",A.terrainEnabled?"true":"false"),W(X.attributes,"fogEnabled",A.fogEnabled?"true":"false"),W(X.attributes,"projection",A.projection),W(X.attributes,"zoom",A.zoom),W(X.metadata,"devicePixelRatio",B),W(X.metadata,"connectionEffectiveType",j),W(X.metadata,"navigatorUserAgent",navigator.userAgent),W(X.metadata,"screenWidth",window.screen.width),W(X.metadata,"screenHeight",window.screen.height),W(X.metadata,"windowWidth",window.innerWidth),W(X.metadata,"windowHeight",window.innerHeight),W(X.metadata,"mapWidth",A.width/B),W(X.metadata,"mapHeight",A.height/B),W(X.metadata,"webglRenderer",A.renderer),W(X.metadata,"webglVendor",A.vendor),W(X.metadata,"sdkVersion",c),W(X.metadata,"sdkIdentifier","mapbox-gl-js"),X}(p);for(const A of b.metadata);for(const A of b.counters);for(const A of b.attributes);this.postEvent(u,b,()=>{},x)}},Ke=xe.postPerformanceEvent.bind(xe),We=new class extends ce{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(x,u,p,b){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const A=bt(a.e.API_URL+a.e.SESSION_PATH);A.params.push(`sku=${u||""}`),A.params.push(`access_token=${b||a.e.ACCESS_TOKEN||""}`);const M={url:Vt(A),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(M,P=>{this.pendingRequest=null,p(P),this.saveEventData(),this.processRequests(b)})}getSessionAPI(x,u,p,b){this.skuToken=u,this.errorCb=b,a.e.SESSION_PATH&&a.e.API_URL&&(p||a.e.ACCESS_TOKEN?this.queueRequest({id:x,timestamp:Date.now()},p):this.errorCb(new Error(ct)))}processRequests(x){if(this.pendingRequest||this.queue.length===0)return;const{id:u,timestamp:p}=this.queue.shift();u&&this.success[u]||this.getSession(p,this.skuToken,b=>{b?this.errorCb(b):u&&(this.success[u]=!0)},x)}remove(){this.errorCb=null}},Ti=We.getSessionAPI.bind(We),Bt=new Set;function Zt(x,u){u?Bt.add(x):Bt.delete(x)}class ge{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(u,p){this._updatedSourceCaches[u]=p,this.setDirty()}discardSourceCacheUpdate(u){delete this._updatedSourceCaches[u]}updateLayer(u){const p=u.scope;this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._updatedLayers[p].add(u.id),this.setDirty()}removeLayer(u){const p=u.scope;this._removedLayers[p]=this._removedLayers[p]||{},this._updatedLayers[p]=this._updatedLayers[p]||new Set,this._removedLayers[p][u.id]=u,this._updatedLayers[p].delete(u.id),this._updatedPaintProps.delete(u.fqid),this.setDirty()}getRemovedLayer(u){return this._removedLayers[u.scope]?this._removedLayers[u.scope][u.id]:null}discardLayerRemoval(u){this._removedLayers[u.scope]&&delete this._removedLayers[u.scope][u.id]}getLayerUpdatesByScope(){const u={};for(const p in this._updatedLayers)u[p]=u[p]||{},u[p].updatedIds=Array.from(this._updatedLayers[p].values());for(const p in this._removedLayers)u[p]=u[p]||{},u[p].removedIds=Object.keys(this._removedLayers[p]);return u}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(u){this._updatedPaintProps.add(u.fqid),this.setDirty()}getUpdatedImages(u){return this._updatedImages[u]?Array.from(this._updatedImages[u].values()):[]}updateImage(u,p){this._updatedImages[p]=this._updatedImages[p]||new Set,this._updatedImages[p].add(a.I.toString(u)),this.setDirty()}resetUpdatedImages(u){this._updatedImages[u]&&this._updatedImages[u].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function $e(x){const{userImage:u}=x;return!!(u&&u.render&&u.render())&&(x.data.replace(new Uint8Array(u.data.buffer)),!0)}class He extends a.E{constructor(u){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=u,u!=="raster"&&a.r()&&(this.imageRasterizerDispatcher=new a.D(a.t(),this,"Image Rasterizer Worker",1))}addScope(u){this.loaded.set(u,!1),this.imageProviders.set(u,new Map),this.images.set(u,new Map),this.updatedImages.set(u,new Set),this.callbackDispatchedThisFrame.set(u,new Set),this.patterns.set(u,new Map),this.atlasImage.set(u,new a.q({width:1,height:1}))}removeScope(u){this.loaded.delete(u),this.imageProviders.delete(u),this.images.delete(u),this.updatedImages.delete(u),this.callbackDispatchedThisFrame.delete(u),this.patterns.delete(u),this.atlasImage.delete(u);const p=this.atlasTexture.get(u);p&&(p.destroy(),this.atlasTexture.delete(u))}addImageProvider(u,p){this.imageProviders.has(p)||this.imageProviders.set(p,new Map),this.imageProviders.get(p).set(u.id,u)}removeImageProvider(u,p){this.imageProviders.has(p)&&this.imageProviders.get(p).delete(u)}getPendingImageProviders(){const u=[];for(const p of this.imageProviders.values())for(const b of p.values())b.hasPendingRequests()&&u.push(b);return u}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.x),this._imageRasterizer}isLoaded(){for(const u of this.loaded.keys())if(!this.loaded.get(u))return!1;return!0}setLoaded(u,p){if(this.loaded.get(p)!==u&&(this.loaded.set(p,u),u)){for(const{ids:b,callback:A}of this.requestors)this._notify(b,p,A);this.requestors=[]}}hasImage(u,p){return!!this.getImage(u,p)}getImage(u,p){return this.images.get(p).get(u.toString())}addImage(u,p,b){this._validate(u,b)&&this.images.get(p).set(u.toString(),b)}_validate(u,p){let b=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new a.y(new Error(`Image "${u.name}" has invalid "stretchX" value`))),b=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new a.y(new Error(`Image "${u.name}" has invalid "stretchY" value`))),b=!1),this._validateContent(p.content,p)||(this.fire(new a.y(new Error(`Image "${u.name}" has invalid "content" value`))),b=!1),b}_validateStretch(u,p){if(!u)return!0;let b=0;for(const A of u){if(A[0]<b||A[1]<A[0]||p<A[1])return!1;b=A[1]}return!0}_validateContent(u,p){return u?u.length!==4||!p.usvg&&(u[0]<0||p.data.width<u[0]||u[1]<0||p.data.height<u[1]||u[2]<0||p.data.width<u[2]||u[3]<0||p.data.height<u[3])?!1:!(u[2]<u[0]||u[3]<u[1]):!0}updateImage(u,p,b){const A=this.images.get(p).get(u.toString());b.version=A.version+1,this.images.get(p).set(u.toString(),b),this.updatedImages.get(p).add(u),this.removeFromImageRasterizerCache(u,p)}clearUpdatedImages(u){this.updatedImages.get(u).clear()}removeFromImageRasterizerCache(u,p){this.spriteFormat!=="raster"&&(a.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[u],scope:p}):this.imageRasterizer.removeImagesFromCacheByIds([u],p))}removeImage(u,p){const b=this.images.get(p),A=b.get(u.toString());b.delete(u.toString()),this.patterns.get(p).delete(u.toString()),this.removeFromImageRasterizerCache(u,p),A.userImage&&A.userImage.onRemove&&A.userImage.onRemove()}listImages(u){return Array.from(this.images.get(u).keys()).map(p=>a.I.from(p))}getImages(u,p,b){const A=[],M=[],P=this.imageProviders.get(p);for(const j of u){if(!j.iconsetId){A.push(j);continue}const X=P.get(j.iconsetId);X&&(this.getImage(j,p)?M.push(j):X.addPendingRequest(j))}if(A.length===0)return void this._notify(M,p,b);let O=!0;const B=!!this.loaded.get(p),G=this.images.get(p);if(!B)for(const j of A)G.has(j.toString())||(O=!1);B||O?this._notify(A,p,b):this.requestors.push({ids:A,scope:p,callback:b})}rasterizeImages(u,p){const b=new Map,{tasks:A,scope:M}=u;for(const[P,O]of A.entries()){const B=this.getImage(O.id,M);B&&b.set(P,{image:B,imageVariant:O})}this._rasterizeImages(M,b,p)}_rasterizeImages(u,p,b){if(a.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:p,scope:u},b);else{const A=new Map;for(const[M,{image:P,imageVariant:O}]of p.entries())A.set(M,this.imageRasterizer.rasterize(O,P,u,0));b(void 0,A)}}getUpdatedImages(u){return this.updatedImages.get(u)||new Set}_notify(u,p,b){const A=this.images.get(p),M=new Map;for(const P of u){if(!A.get(P.toString())){if(P.iconsetId)continue;this.fire(new a.z("styleimagemissing",{id:P.name}))}const O=A.get(P.toString());if(!O){a.w(`Image "${P.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const B={data:O.usvg?null:O.data.clone(),pixelRatio:O.pixelRatio,sdf:O.sdf,usvg:O.usvg,version:O.version,stretchX:O.stretchX,stretchY:O.stretchY,content:O.content,hasRenderCallback:!!(O.userImage&&O.userImage.render)};O.usvg&&Object.assign(B,{width:O.icon.usvg_tree.width,height:O.icon.usvg_tree.height}),M.set(a.I.toString(P),B)}b(null,M)}getPixelSize(u){const{width:p,height:b}=this.atlasImage.get(u);return{width:p,height:b}}getPattern(u,p,b){const A=u.toString(),M=this.patterns.get(p),P=M.get(A),O=this.getImage(u,p);if(!O)return null;if(P){if(P.position.version===O.version)return P.position;P.position.version=O.version}else{if(O.usvg&&!O.data){const B=this.getPatternInFlightId(A,p);if(this.patternsInFlight.has(B))return null;this.patternsInFlight.add(B);const G=new a.A(u).scaleSelf(a.o.devicePixelRatio),j=new Map([[G.toString(),{image:O,imageVariant:G}]]);return this._rasterizeImages(p,j,(X,W)=>this.storePatternImage(G,p,O,b,W)),null}this.storePattern(u,p,O)}return this._updatePatternAtlas(p,b),M.get(A).position}getPatternInFlightId(u,p){return a.B(u,p)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(u,p,b,A,M){const P=u.toString(),O=M?M.get(P):void 0;O&&(b.data=O,this.storePattern(u.id,p,b),this._updatePatternAtlas(p,A),this.patternsInFlight.delete(this.getPatternInFlightId(u.id.toString(),p)))}storePattern(u,p,b){const A={w:b.data.width+2*a.C,h:b.data.height+2*a.C,x:0,y:0},M=new a.F(A,b,a.C);this.patterns.get(p).set(u.toString(),{bin:A,position:M})}destroyAtlasTextures(){for(const u of this.atlasTexture.values())u&&u.destroy();this.atlasTexture.clear()}bind(u,p){const b=u.gl;let A=this.atlasTexture.get(p);A?this.dirty&&(A.update(this.atlasImage.get(p)),this.dirty=!1):(A=new a.T(u,this.atlasImage.get(p),b.RGBA8),this.atlasTexture.set(p,A)),A.bind(b.LINEAR,b.CLAMP_TO_EDGE)}_updatePatternAtlas(u,p){const b=this.patterns.get(u),A=Array.from(b.values()).map(({bin:G})=>G),{w:M,h:P}=a.G(A),O=this.atlasImage.get(u);O.resize({width:M||1,height:P||1});const B=this.images.get(u);for(const[G,{bin:j,position:X}]of b.entries()){let W=X.padding;const K=j.x+W,tt=j.y+W,rt=B.get(G).data,ht=rt.width,st=rt.height;W=W>1?W-1:W,a.q.copy(rt,O,{x:0,y:0},{x:K,y:tt},{width:ht,height:st},p),a.q.copy(rt,O,{x:0,y:st-W},{x:K,y:tt-W},{width:ht,height:W},p),a.q.copy(rt,O,{x:0,y:0},{x:K,y:tt+st},{width:ht,height:W},p),a.q.copy(rt,O,{x:ht-W,y:0},{x:K-W,y:tt},{width:W,height:st},p),a.q.copy(rt,O,{x:0,y:0},{x:K+ht,y:tt},{width:W,height:st},p),a.q.copy(rt,O,{x:ht-W,y:st-W},{x:K-W,y:tt-W},{width:W,height:W},p),a.q.copy(rt,O,{x:0,y:st-W},{x:K+ht,y:tt-W},{width:W,height:W},p),a.q.copy(rt,O,{x:0,y:0},{x:K+ht,y:tt+st},{width:W,height:W},p),a.q.copy(rt,O,{x:ht-W,y:0},{x:K-W,y:tt+st},{width:W,height:W},p)}this.dirty=!0}beginFrame(){for(const u of this.images.keys())this.callbackDispatchedThisFrame.set(u,new Set)}dispatchRenderCallbacks(u,p){const b=this.images.get(p);for(const A of u){if(this.callbackDispatchedThisFrame.get(p).has(A.toString()))continue;this.callbackDispatchedThisFrame.get(p).add(A.toString());const M=b.get(A.toString());$e(M)&&this.updateImage(A,p,M)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function qe(x){const u=x.value,p=x.valueSpec,b=x.style,A=x.styleSpec,M=x.key,P=x.arrayElementValidator||jn;if(!Array.isArray(u))return[new a.V(M,u,`array expected, ${a.K(u)} found`)];if(p.length&&u.length!==p.length)return[new a.V(M,u,`array length ${p.length} expected, length ${u.length} found`)];if(p["min-length"]&&u.length<p["min-length"])return[new a.V(M,u,`array length at least ${p["min-length"]} expected, length ${u.length} found`)];let O={type:p.value,values:p.values,minimum:p.minimum,maximum:p.maximum,function:void 0};A.$version<7&&(O.function=p.function),a.H(p.value)&&(O=p.value);let B=[];for(let G=0;G<u.length;G++)B=B.concat(P({array:u,arrayIndex:G,value:u[G],valueSpec:O,style:b,styleSpec:A,key:`${M}[${G}]`},!0));return B}function Ai(x){const u=x.key,p=x.value,b=x.valueSpec;if(!a.L(p))return[new a.V(u,p,`number expected, ${a.K(p)} found`)];if(p!=p)return[new a.V(u,p,"number expected, NaN found")];if("minimum"in b){let A=b.minimum;if(Array.isArray(b.minimum)&&(A=b.minimum[x.arrayIndex]),p<A)return[new a.V(u,p,`${p} is less than the minimum value ${A}`)]}if("maximum"in b){let A=b.maximum;if(Array.isArray(b.maximum)&&(A=b.maximum[x.arrayIndex]),p>A)return[new a.V(u,p,`${p} is greater than the maximum value ${A}`)]}return[]}function Ii(x){const u=x.key,p=x.value;if(!a.H(p))return[new a.V(u,p,`object expected, ${a.K(p)} found`)];const b=x.valueSpec,A=a.J(p.type);let M,P,O,B={};const G=A!=="categorical"&&p.property===void 0,j=!G,X=function(rt){const ht=rt.stops;return Array.isArray(ht)&&Array.isArray(ht[0])&&a.H(ht[0][0])}(p),W=Co({key:x.key,value:x.value,valueSpec:x.styleSpec.function,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{stops:function(rt){if(A==="identity")return[new a.V(rt.key,rt.value,'identity function may not have a "stops" property')];let ht=[];const st=rt.value;return ht=ht.concat(qe({key:rt.key,value:st,valueSpec:rt.valueSpec,style:rt.style,styleSpec:rt.styleSpec,arrayElementValidator:K})),Array.isArray(st)&&st.length===0&&ht.push(new a.V(rt.key,st,"array must have at least one stop")),ht},default:function(rt){return jn({key:rt.key,value:rt.value,valueSpec:b,style:rt.style,styleSpec:rt.styleSpec})}}});return A==="identity"&&G&&W.push(new a.V(x.key,x.value,'missing required property "property"')),A==="identity"||p.stops||W.push(new a.V(x.key,x.value,'missing required property "stops"')),A==="exponential"&&b.expression&&!a.M(b)&&W.push(new a.V(x.key,x.value,"exponential functions not supported")),x.styleSpec.$version>=8&&(j&&!a.N(b)?W.push(new a.V(x.key,x.value,"property functions not supported")):G&&!a.O(b)&&W.push(new a.V(x.key,x.value,"zoom functions not supported"))),A!=="categorical"&&!X||p.property!==void 0||W.push(new a.V(x.key,x.value,'"property" property is required')),W;function K(rt){let ht=[];const st=rt.value,gt=rt.key;if(!Array.isArray(st))return[new a.V(gt,st,`array expected, ${a.K(st)} found`)];if(st.length!==2)return[new a.V(gt,st,`array length 2 expected, length ${st.length} found`)];if(X){if(!a.H(st[0]))return[new a.V(gt,st,`object expected, ${a.K(st[0])} found`)];const xt=st[0];if(xt.zoom===void 0)return[new a.V(gt,st,"object stop key must have zoom")];if(xt.value===void 0)return[new a.V(gt,st,"object stop key must have value")];const vt=a.J(xt.zoom);if(typeof vt!="number")return[new a.V(gt,xt.zoom,"stop zoom values must be numbers")];if(O&&O>vt)return[new a.V(gt,xt.zoom,"stop zoom values must appear in ascending order")];vt!==O&&(O=vt,P=void 0,B={}),ht=ht.concat(Co({key:`${gt}[0]`,value:st[0],valueSpec:{zoom:{}},style:rt.style,styleSpec:rt.styleSpec,objectElementValidators:{zoom:Ai,value:tt}}))}else ht=ht.concat(tt({key:`${gt}[0]`,value:st[0],style:rt.style,styleSpec:rt.styleSpec},st));return a.Q(a.S(st[1]))?ht.concat([new a.V(`${gt}[1]`,st[1],"expressions are not allowed in function stops.")]):ht.concat(jn({key:`${gt}[1]`,value:st[1],valueSpec:b,style:rt.style,styleSpec:rt.styleSpec}))}function tt(rt,ht){const st=a.K(rt.value),gt=a.J(rt.value),xt=rt.value!==null?rt.value:ht;if(M){if(st!==M)return[new a.V(rt.key,xt,`${st} stop domain type must match previous stop domain type ${M}`)]}else M=st;if(st!=="number"&&st!=="string"&&st!=="boolean"&&typeof gt!="number"&&typeof gt!="string"&&typeof gt!="boolean")return[new a.V(rt.key,xt,"stop domain value must be a number, string, or boolean")];if(st!=="number"&&A!=="categorical"){let vt=`number expected, ${st} found`;return a.N(b)&&A===void 0&&(vt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(rt.key,xt,vt)]}return A!=="categorical"||st!=="number"||typeof gt=="number"&&isFinite(gt)&&Math.floor(gt)===gt?A!=="categorical"&&st==="number"&&typeof gt=="number"&&typeof P=="number"&&P!==void 0&&gt<P?[new a.V(rt.key,xt,"stop domain values must appear in ascending order")]:(P=gt,A==="categorical"&&gt in B?[new a.V(rt.key,xt,"stop domain values must be unique")]:(B[gt]=!0,[])):[new a.V(rt.key,xt,`integer expected, found ${String(gt)}`)]}}function _i(x){const u=(x.expressionContext==="property"?a.W:a.U)(a.S(x.value),x.valueSpec);if(u.result==="error")return u.value.map(b=>new a.V(`${x.key}${b.key}`,x.value,b.message));const p=u.value.expression||u.value._styleExpression.expression;if(x.expressionContext==="property"&&x.propertyKey==="text-font"&&!p.outputDefined())return[new a.V(x.key,x.value,`Invalid data expression for "${x.propertyKey}". Output values must be contained as literals within the expression.`)];if(x.expressionContext==="property"&&x.propertyType==="layout"&&!a.Z(p))return[new a.V(x.key,x.value,'"feature-state" data expressions are not supported with layout properties.')];if(x.expressionContext==="filter")return pi(p,x);if(x.expressionContext==="appearance")return yr(p,x);if(x.expressionContext&&x.expressionContext.indexOf("cluster")===0){if(!a.X(p,["zoom","feature-state"]))return[new a.V(x.key,x.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(x.expressionContext==="cluster-initial"&&!a.Y(p))return[new a.V(x.key,x.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pi(x,u){const p=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(u.valueSpec&&u.valueSpec.expression)for(const A of u.valueSpec.expression.parameters)p.delete(A);if(p.size===0)return[];const b=[];return x instanceof a._&&p.has(x.name)?[new a.V(u.key,u.value,`["${x.name}"] expression is not supported in a filter for a ${u.object.type} layer with id: ${u.object.id}`)]:(x.eachChild(A=>{b.push(...pi(A,u))}),b)}function yr(x,u){const p=new Set;if(u.valueSpec&&u.valueSpec.expression)for(const A of u.valueSpec.expression.parameters)p.add(A);if(p.size===0)return[];const b=[];return x instanceof a._&&!p.has(x.name)?[new a.V(u.key,u.value,`["${x.name}"] is not an allowed parameter`)]:(x.eachChild(A=>{b.push(...yr(A,u))}),b)}function Li(x){const u=x.key,p=x.value,b=x.valueSpec,A=[];return Array.isArray(b.values)?b.values.indexOf(a.J(p))===-1&&A.push(new a.V(u,p,`expected one of [${b.values.join(", ")}], ${JSON.stringify(p)} found`)):Object.keys(b.values).indexOf(a.J(p))===-1&&A.push(new a.V(u,p,`expected one of [${Object.keys(b.values).join(", ")}], ${JSON.stringify(p)} found`)),A}function hr(x){return a.a2(a.S(x.value))?_i(Object.assign({},x,{expressionContext:"filter",valueSpec:x.styleSpec[`filter_${x.layerType||"fill"}`]})):xr(x)}function xr(x){const u=x.value,p=x.key;if(!Array.isArray(u))return[new a.V(p,u,`array expected, ${a.K(u)} found`)];if(u.length<1)return[new a.V(p,u,"filter array must have at least 1 element")];const b=x.styleSpec;let A=Li({key:`${p}[0]`,value:u[0],valueSpec:b.filter_operator});switch(a.J(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&a.J(u[1])==="$type"&&A.push(new a.V(p,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&A.push(new a.V(p,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(a.a0(u[1])||A.push(new a.V(`${p}[1]`,u[1],`string expected, ${a.K(u[1])} found`)));for(let M=2;M<u.length;M++)a.J(u[1])==="$type"?A=A.concat(Li({key:`${p}[${M}]`,value:u[M],valueSpec:b.geometry_type})):a.a0(u[M])||a.L(u[M])||a.$(u[M])||A.push(new a.V(`${p}[${M}]`,u[M],`string, number, or boolean expected, ${a.K(u[M])} found.`));break;case"any":case"all":case"none":for(let M=1;M<u.length;M++)A=A.concat(xr({key:`${p}[${M}]`,value:u[M],style:x.style,styleSpec:x.styleSpec}));break;case"has":case"!has":u.length!==2?A.push(new a.V(p,u,`filter array for "${u[0]}" operator must have 2 elements`)):a.a0(u[1])||A.push(new a.V(`${p}[1]`,u[1],`string expected, ${a.K(u[1])} found`))}return A}function tn(x,u){const p=x.key,b=x.style,A=x.layer,M=x.styleSpec,P=x.value,O=x.objectKey,B=M[`${u}_${x.layerType}`];if(!B)return[];const G=O.match(/^(.*)-use-theme$/);if(G&&B[G[1]])return a.Q(a.S(P))?[].concat(jn({key:p,value:P,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:b,styleSpec:M,expressionContext:"property",propertyType:u,propertyKey:O})):jn({key:p,value:P,valueSpec:{type:"string"},style:b,styleSpec:M});const j=O.match(/^(.*)-transition$/);if(u==="paint"&&j&&B[j[1]]&&B[j[1]].transition)return jn({key:p,value:P,valueSpec:M.transition,style:b,styleSpec:M});const X=x.valueSpec||B[O];if(!X)return[new a.a3(p,P,`unknown property "${O}"`)];let W;if(a.a0(P)&&a.N(X)&&!X.tokens&&(W=/^{([^}]+)}$/.exec(P))){const tt=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new a.V(p,P,`"${O}" does not support interpolation syntax
Use an identity property function instead: ${tt}.`)]}const K=[];if(x.layerType==="symbol")O!=="text-field"||!b||b.glyphs||b.imports||K.push(new a.V(p,P,'use of "text-field" requires a style "glyphs" property')),O==="text-font"&&a.a4(a.S(P))&&a.J(P.type)==="identity"&&K.push(new a.V(p,P,'"text-font" does not support identity functions'));else if(x.layerType==="model"&&u==="paint"&&A&&A.layout&&A.layout.hasOwnProperty("model-id")&&a.N(X)&&(a.a5(X)||a.O(X))){const tt=a.W(a.S(P),X).value,rt="expression"in tt&&tt.expression||"_styleExpression"in tt&&tt._styleExpression&&tt._styleExpression.expression;rt&&!a.X(rt,["measure-light"])&&(O==="model-emissive-strength"&&a.Y(rt)&&a.Z(rt)||K.push(new a.V(p,P,`${O} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return K.concat(jn({key:x.key,value:P,valueSpec:X,style:b,styleSpec:M,expressionContext:"property",propertyType:u,propertyKey:O}))}function zn(x){return tn(x,"paint")}function Kr(x){return tn(x,"layout")}function Ua(x){let u=[];const p=x.value,b=x.key,A=x.style,M=x.styleSpec;if(!a.H(p))return[new a.V(b,p,"object expected")];p.type||p.ref||u.push(new a.V(b,p,'either "type" or "ref" is required'));let P=a.J(p.type);const O=a.J(p.ref);if(p.id){const B=a.J(p.id);for(let G=0;G<x.arrayIndex;G++){const j=A.layers[G];a.J(j.id)===B&&u.push(new a.V(b,p.id,`duplicate layer id "${B}", previously used at line ${j.id.__line__}`))}}if("ref"in p){let B;["type","source","source-layer","filter","layout"].forEach(G=>{G in p&&u.push(new a.V(b,p[G],`"${G}" is prohibited for ref layers`))}),A.layers.forEach(G=>{a.J(G.id)===O&&(B=G)}),B?B.ref?u.push(new a.V(b,p.ref,"ref cannot reference another ref layer")):P=a.J(B.type):typeof O=="string"&&u.push(new a.V(b,p.ref,`ref layer "${O}" not found`))}else if(P!=="background"&&P!=="sky"&&P!=="slot")if(p.source)if(a.a0(p.source)){const B=A.sources&&A.sources[p.source],G=B&&a.J(B.type);B?G==="vector"&&P==="raster"?u.push(new a.V(b,p.source,`layer "${p.id}" requires a raster source`)):G==="raster"&&P!=="raster"?u.push(new a.V(b,p.source,`layer "${p.id}" requires a vector source`)):G!=="vector"||p["source-layer"]?G==="raster-dem"&&P!=="hillshade"?u.push(new a.V(b,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(P)?P==="line"&&p.paint&&(p.paint["line-gradient"]||p.paint["line-trim-offset"])&&G==="geojson"&&!B.lineMetrics?u.push(new a.V(b,p,`layer "${p.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):P==="raster-particle"&&G!=="raster-array"&&u.push(new a.V(b,p.source,`layer "${p.id}" requires a 'raster-array' source.`)):u.push(new a.V(b,p.source,"raster-array source can only be used with layer type 'raster'.")):u.push(new a.V(b,p,`layer "${p.id}" must specify a "source-layer"`)):u.push(new a.V(b,p.source,`source "${p.source}" not found`))}else u.push(new a.V(`${b}.source`,p.source,'"source" must be a string'));else u.push(new a.V(b,p,'missing required property "source"'));return u=u.concat(Co({key:b,value:p,valueSpec:M.layer,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":()=>[],type:()=>jn({key:`${b}.type`,value:p.type,valueSpec:M.layer.type,style:x.style,styleSpec:x.styleSpec,object:p,objectKey:"type"}),filter:B=>hr(Object.assign({layerType:P},B)),layout:B=>Co({layer:p,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>Kr(Object.assign({layerType:P},G))}}),paint:B=>Co({layer:p,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>zn(Object.assign({layerType:P,layer:p},G))}}),appearances(B){const G=qe({key:B.key,value:B.value,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:W=>function(K){const{key:tt,layer:rt,layerType:ht}=K,st=a.J(K.value),gt=a.J(st.name),xt=a.J(st.condition),vt=Co({key:tt,value:st,valueSpec:K.styleSpec.appearance,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{condition:Pt=>function(wt){const Rt=[];return Rt.push(..._i({key:wt.key,value:wt.object.condition,valueSpec:a.a6.appearance.condition,expressionContext:"appearance"})),Rt}(Object.assign({layer:rt,layerType:ht},Pt)),properties:Pt=>function(wt){const Rt=[],{styleSpec:Mt,layer:At,layerType:kt}=wt,qt=Mt[`paint_${kt}`],jt=Mt[`layout_${kt}`],oe=wt.object[wt.objectKey];for(const te in oe){const fe=te in qt?"paint":te in jt?"layout":void 0;if(!fe){Rt.push(new a.V(wt.key,te,`unknown property "${te}" for layer type "${kt}"`));continue}const ze=Object.assign({},wt,{key:`${wt.key}.${te}`,object:oe,objectKey:te,layer:At,layerType:kt,value:oe[te],valueSpec:fe==="paint"?qt[te]:jt[te]});Rt.push(...tn(ze,fe))}return Rt}(Object.assign({layer:rt,layerType:ht},Pt))}});return gt!=="hidden"&&xt===void 0&&vt.push(new a.V(K.key,"name",'Appearance with name different than "hidden" must have a condition')),vt}(Object.assign({layerType:P,layer:p},W))}),j=Array.isArray(B.value)?B.value:[],X=new Set;return j.forEach((W,K)=>{const tt=a.J(W.name);if(tt)if(X.has(tt)){const rt=a.J(p.id);G.push(new a.V(B.key,tt,`Duplicated appearance name "${tt}" for layer "${rt}"`))}else X.add(tt)}),G}}})),u}function ma({key:x,value:u}){return a.a0(u)?[]:[new a.V(x,u,`string expected, ${a.K(u)} found`)]}const Io={promoteId:function x({key:u,value:p}){if(a.a0(p))return ma({key:u,value:p});if(Array.isArray(p)){const A=[],M=a.S(p),P=a.U(M);return P.result==="error"&&P.value.forEach(O=>{A.push(new a.V(`${u}${O.key}`,null,`${O.message}`))}),a.X(P.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||A.push(new a.V(`${u}`,null,"promoteId expression should be only feature dependent")),A}if(!a.H(p))return[new a.V(u,p,`string, expression or object expected, "${a.K(p)}" found`)];const b=[];for(const A in p)b.push(...x({key:`${u}.${A}`,value:p[A]}));return b}};function Ja(x){const u=x.value,p=x.key,b=x.styleSpec,A=x.style;if(!a.H(u))return[new a.V(p,u,`object expected, ${a.K(u)} found`)];if(!("type"in u))return[new a.V(p,u,'"type" is required')];const M=a.J(u.type);let P=[];switch(["vector","raster","raster-dem","raster-array"].includes(M)&&("url"in u||"tiles"in u||P.push(new a.a3(p,u,'Either "url" or "tiles" is required.'))),M){case"vector":case"raster":case"raster-dem":case"raster-array":return P=P.concat(Co({key:p,value:u,valueSpec:b[`source_${M.replace("-","_")}`],style:x.style,styleSpec:b,objectElementValidators:Io})),P;case"geojson":if(P=Co({key:p,value:u,valueSpec:b.source_geojson,style:A,styleSpec:b,objectElementValidators:Io}),"cluster"in u&&"clusterProperties"in u){if(!a.H(u.clusterProperties))return[new a.V(`${p}.clusterProperties`,u,`object expected, ${a.K(u)} found`)];for(const O in u.clusterProperties){const B=u.clusterProperties[O];if(!Array.isArray(B))return[new a.V(`${p}.clusterProperties.${O}`,B,"array expected")];const[G,j]=B,X=typeof G=="string"?[G,["accumulated"],["get",O]]:G;P.push(..._i({key:`${p}.${O}.map`,value:j,expressionContext:"cluster-map"})),P.push(..._i({key:`${p}.${O}.reduce`,value:X,expressionContext:"cluster-reduce"}))}}return P;case"video":return Co({key:p,value:u,valueSpec:b.source_video,style:A,styleSpec:b});case"image":return Co({key:p,value:u,valueSpec:b.source_image,style:A,styleSpec:b});case"canvas":return[new a.V(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Li({key:`${p}.type`,value:u.type,valueSpec:{values:Qn(b)}})}}function Qn(x){return x.source.reduce((u,p)=>{const b=x[p];return b.type.type==="enum"&&(u=u.concat(Object.keys(b.type.values||{}))),u},[])}function ou(x){const u=x.value,p=x.styleSpec,b=p.light,A=x.style;if(u===void 0)return[];if(!a.H(u))return[new a.V("light",u,`object expected, ${a.K(u)} found`)];let M=[];for(const P in u){const O=P.match(/^(.*)-transition$/),B=P.match(/^(.*)-use-theme$/);M=M.concat(B&&b[B[1]]?jn({key:P,value:u[P],valueSpec:{type:"string"},style:A,styleSpec:p}):O&&b[O[1]]&&b[O[1]].transition?jn({key:P,value:u[P],valueSpec:p.transition,style:A,styleSpec:p}):b[P]?jn({key:P,value:u[P],valueSpec:b[P],style:A,styleSpec:p}):[new a.V(P,u[P],`unknown property "${P}"`)])}return M}function Qa(x){const u=x.value;if(!u)return[];const p=x.key;if(!a.H(u))return[new a.V(p,u,`object expected, ${a.K(u)} found`)];let b=[];const A=x.styleSpec,M=A["light-3d"],P=x.style,O=x.style.lights;for(const j of["type","id"])if(!(j in u))return b=b.concat([new a.V(p,u,`missing property "${j}"`)]),b;if(!a.a0(u.type))return b=b.concat([new a.V(`${p}.type`,u.type,"string expected")]),b;if(O)for(let j=0;j<x.arrayIndex;j++){const X=a.J(u.type),W=O[j];a.J(W.type)===X&&b.push(new a.V(p,u.id,`duplicate light type "${u.type}", previously defined at line ${W.id.__line__}`))}const B=`properties_light_${u.type}`;if(!(B in A))return b=b.concat([new a.V(`${p}.type`,u,`Invalid light type ${u.type}`)]),b;const G=A[B];for(const j in u)if(j==="properties"){const X=u[j];if(!a.H(X))return b=b.concat([new a.V("properties",X,`object expected, ${a.K(X)} found`)]),b;for(const W in X){const K=W.match(/^(.*)-transition$/),tt=W.match(/^(.*)-use-theme$/);b=b.concat(tt&&G[tt[1]]?jn({key:j,value:X[W],valueSpec:{type:"string"},style:P,styleSpec:A}):K&&G[K[1]]&&G[K[1]].transition?jn({key:j,value:u[j],valueSpec:A.transition,style:P,styleSpec:A}):G[W]?jn({key:W,value:X[W],valueSpec:G[W],style:P,styleSpec:A}):[new a.a3(x.key,X[W],`unknown property "${W}"`)])}}else b=b.concat(M[j]?jn({key:j,value:u[j],valueSpec:M[j],style:P,styleSpec:A}):[new a.a3(j,u[j],`unknown property "${j}"`)]);return b}function to(x){const u=x.value,p=x.key,b=x.style,A=x.styleSpec,M=A.terrain;if(u==null)return[];if(!a.H(u))return[new a.V("terrain",u,`object expected, ${a.K(u)} found`)];let P=[];for(const O in u){const B=O.match(/^(.*)-transition$/),G=O.match(/^(.*)-use-theme$/);P=P.concat(G&&M[G[1]]?jn({key:O,value:u[O],valueSpec:{type:"string"},style:b,styleSpec:A}):B&&M[B[1]]&&M[B[1]].transition?jn({key:O,value:u[O],valueSpec:A.transition,style:b,styleSpec:A}):M[O]?jn({key:O,value:u[O],valueSpec:M[O],style:b,styleSpec:A}):[new a.a3(O,u[O],`unknown property "${O}"`)])}if(u.source)if(a.a0(u.source)){const O=b.sources&&b.sources[u.source],B=O&&a.J(O.type);O?B!=="raster-dem"&&P.push(new a.V(`${p}.source`,u.source,`terrain cannot be used with a source of type ${B}, it only be used with a "raster-dem" source type`)):P.push(new a.V(`${p}.source`,u.source,`source "${u.source}" not found`))}else P.push(new a.V(`${p}.source`,u.source,"source must be a string"));else P.push(new a.V(p,u,'terrain is missing required property "source"'));return P}function xs(x){const u=x.value,p=x.style,b=x.styleSpec,A=b.fog;if(u===void 0)return[];if(!a.H(u))return[new a.V("fog",u,`object expected, ${a.K(u)} found`)];let M=[];for(const P in u){const O=P.match(/^(.*)-transition$/),B=P.match(/^(.*)-use-theme$/);M=M.concat(B&&A[B[1]]?jn({key:P,value:u[P],valueSpec:{type:"string"},style:p,styleSpec:b}):O&&A[O[1]]&&A[O[1]].transition?jn({key:P,value:u[P],valueSpec:b.transition,style:p,styleSpec:b}):A[P]?jn({key:P,value:u[P],valueSpec:A[P],style:p,styleSpec:b}):[new a.a3(P,u[P],`unknown property "${P}"`)])}return M}const ls={"*":()=>[],array:qe,boolean:function(x){const u=x.value,p=x.key;return a.$(u)?[]:[new a.V(p,u,`boolean expected, ${a.K(u)} found`)]},number:Ai,color:function({key:x,value:u}){return a.a0(u)?a.a1.parseCSSColor(u)===null?[new a.V(x,u,`color expected, "${u}" found`)]:[]:[new a.V(x,u,`color expected, ${a.K(u)} found`)]},enum:Li,filter:hr,function:Ii,layer:Ua,object:Co,source:Ja,model:a.a7,light:ou,"light-3d":Qa,terrain:to,fog:xs,string:ma,formatted:function(x){return ma(x).length===0?[]:_i(x)},resolvedImage:function(x){return ma(x).length===0?[]:_i(x)},projection:function(x){const u=x.value,p=x.styleSpec,b=p.projection,A=x.style;if(a.H(u)){let M=[];for(const P in u)M=M.concat(jn({key:P,value:u[P],valueSpec:b[P],style:A,styleSpec:p}));return M}return a.a0(u)?[]:[new a.V("projection",u,`object or string expected, ${a.K(u)} found`)]},import:function(x){const u=x.key,{value:p,styleSpec:b}=x;if(!a.H(p))return[new a.V(u,p,"import must be an object")];const{data:A,...M}=p;Object.defineProperty(M,"__line__",{value:p.__line__,enumerable:!1});let P=Co(Object.assign({},x,{value:M,valueSpec:b.import}));return a.J(M.id)===""&&P.push(new a.V(`${x.key}.id`,M,"import id can't be an empty string")),A&&(P=P.concat(Tc(A,b,{key:`${x.key}.data`}))),P},iconset:function(x){const u=x.value,p=x.key,b=x.styleSpec,A=x.style;if(!a.H(u))return[new a.V(p,u,"object expected")];if(!u.type)return[new a.V(p,u,'"type" is required')];const M=a.J(u.type);let P=[];if(P=P.concat(Co({key:p,value:u,valueSpec:b[`iconset_${M}`],style:A,styleSpec:b})),function(O,B){return!(O!=="source"||!B.source)}(M,u)){const O=A.sources&&A.sources[u.source],B=O&&a.J(O.type);O?B!=="raster-array"&&P.push(new a.V(p,u.source,`iconset cannot be used with a source of type ${String(B)}, it only be used with a "raster-array" source type`)):P.push(new a.V(p,u.source,`source "${u.source}" not found`))}return P}};function jn(x,u=!1){const p=x.value,b=x.valueSpec,A=x.styleSpec;if(b.expression){if(a.a4(a.J(p)))return Ii(x);if(a.Q(a.S(p)))return _i(x)}if(b.type&&ls[b.type]){const M=ls[b.type](x);return u===!0&&M.length>0&&Array.isArray(x.value)?_i(x):M}return Co(Object.assign({},x,{valueSpec:b.type?A[b.type]:b}))}function Co(x){const u=x.key,p=x.value,b=x.valueSpec||{},A=x.objectElementValidators||{},M=x.style,P=x.styleSpec;if(!a.H(p))return[new a.V(u,p,`object expected, ${a.K(p)} found`)];let O=[];for(const B in p){const G=B.split(".")[0];let j;A[G]?j=A[G]:b[G]?j=jn:A["*"]?j=A["*"]:b["*"]&&(j=jn),j?O=O.concat(j({key:(u&&`${u}.`)+B,value:p[B],valueSpec:b[G]||b["*"],style:M,styleSpec:P,object:p,objectKey:B},p)):O.push(new a.a3(u,p[B],`unknown property "${B}"`))}for(const B in b){if(A[B])continue;const G=b[B];G.required&&G.default===void 0&&p[B]===void 0&&O.push(new a.V(u,p,`missing required property "${B}"`))}return O}function Ch({key:x,value:u}){const p=ma({key:x,value:u});if(p.length)return p;const b=u;return b.indexOf("{fontstack}")===-1&&p.push(new a.V(x,u,'"glyphs" url must include a "{fontstack}" token')),b.indexOf("{range}")===-1&&p.push(new a.V(x,u,'"glyphs" url must include a "{range}" token')),p}function Tc(x,u=a.a6,p={}){return Co({key:p.key||"",value:x,valueSpec:Object.assign(u.$root,{"*":{type:"*"}}),styleSpec:u,style:x,objectElementValidators:{glyphs:Ch}})}function Gs(x,u=a.a6){return Xt(Tc(x,u))}const Nv=x=>Xt(Ja(x)),qp=x=>Xt(ou(x)),Q0=x=>Xt(Qa(x)),Zd=x=>Xt(to(x)),Me=x=>Xt(xs(x)),Fu=x=>Xt(function(u){const p=u.value,b=u.style,A=u.styleSpec,M=A.snow;if(p===void 0)return[];if(!a.H(p))return[new a.V("snow",p,`object expected, ${a.K(p)} found`)];let P=[];for(const O in p){const B=O.match(/^(.*)-transition$/);P=P.concat(B&&M[B[1]]&&M[B[1]].transition?jn({key:O,value:p[O],valueSpec:A.transition,style:b,styleSpec:A}):M[O]?jn({key:O,value:p[O],valueSpec:M[O],style:b,styleSpec:A}):[new a.a3(O,p[O],`unknown property "${O}"`)])}return P}(x)),Xp=x=>Xt(function(u){const p=u.value,b=u.style,A=u.styleSpec,M=A.rain;if(p===void 0)return[];if(!a.H(p))return[new a.V("rain",p,`object expected, ${a.K(p)} found`)];let P=[];for(const O in p){const B=O.match(/^(.*)-transition$/);P=P.concat(B&&M[B[1]]&&M[B[1]].transition?jn({key:O,value:p[O],valueSpec:A.transition,style:b,styleSpec:A}):M[O]?jn({key:O,value:p[O],valueSpec:M[O],style:b,styleSpec:A}):[new a.a3(O,p[O],`unknown property "${O}"`)])}return P}(x)),Yp=x=>Xt(Ua(x)),wr=x=>Xt(hr(x)),Vo=x=>Xt(zn(x)),tx=x=>Xt(Kr(x)),Kp=x=>Xt(a.a7(x));function Xt(x){return x.slice().sort((u,p)=>u.line&&p.line?u.line-p.line:0)}function ot(x,u){let p=!1;if(u&&u.length)for(const b of u)b instanceof a.a3?a.w(b.message):(x.fire(new a.y(new Error(b.message))),p=!0);return p}const lt=a.a6.light;let Tt;class Nt extends a.E{constructor(u,p="flat"){super(),this._transitionable=new a.a8(Tt||(Tt=new a.a9({anchor:new a.aa(lt.anchor),position:new a.ab(lt.position),color:new a.aa(lt.color),intensity:new a.aa(lt.intensity)}))),this.setLight(u,p),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,p,b={}){this._validate(qp,u,b)||(this._transitionable.setTransitionOrValue(u),this.id=p)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,p,b){return(!b||b.validate!==!1)&&ot(this,u.call(Gs,Object.assign({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}const Ft=a.a6.terrain;let Wt=class extends a.E{constructor(x,u,p,b,A){super(),this.scope=p,this._transitionable=new a.a8(new a.a9({source:new a.aa(Ft.source),exaggeration:new a.aa(Ft.exaggeration)}),p,b),this._transitionable.setTransitionOrValue(x,b),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u,this.worldview=A}get(){return this._transitionable.serialize()}set(x,u){this._transitionable.setTransitionOrValue(x,u)}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}getExaggeration(x){return this._transitioning.possiblyEvaluate(new a.ac(x,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const x=this._transitionable._values.exaggeration;if(!x)return null;const u=x.value.expression;if(!u)return null;let p=-1,b=-1,A=1;for(const M of u.zoomStops)A=u.evaluate(new a.ac(M,{worldview:this.worldview})),A>.01?(p=M,b=-1):b=M;return A<.01&&p>0&&b>p?[p,b]:null}isZoomDependent(){const x=this._transitionable._values.exaggeration;return x!=null&&x.value!=null&&x.value.expression!=null&&x.value.expression instanceof a.ad}};const ne=45,$t=65,ie=.05;function Oe(x,u,p,b){const A=a.ah(ne,$t,p),[M,P]=Ce(x,b);let O=1-Math.min(1,Math.exp((u-M)/(P-M)*-6));return O*=O*O,O=Math.min(1,1.00747*O),O*A*x.alpha}function Ce(x,u){const p=.5/Math.tan(.5*u);return[x.range[0]+p,x.range[1]+p]}function mi(x,u,p,b,A){const M=a.af([],[u,p,b],A.mercatorFogMatrix);return Oe(x,a.ag(M),A.pitch,A._fov)}function Gi(x,u,p,b,A,M,P){const O=[[p,b,0],[A,b,0],[A,M,0],[p,M,0]];let B=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const j of O){const X=a.af([],j,u),W=a.ag(X);B=Math.min(B,W),G=Math.max(G,W)}return[Oe(x,B,P.pitch,P._fov),Oe(x,G,P.pitch,P._fov)]}const Bi=a.a6.fog;class Mi extends a.E{constructor(u,p,b,A){super();const M=new a.a9({range:new a.aa(Bi.range),color:new a.aa(Bi.color),"color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.aa(Bi["high-color"]),"high-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.aa(Bi["space-color"]),"space-color-use-theme":new a.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.aa(Bi["horizon-blend"]),"star-intensity":new a.aa(Bi["star-intensity"]),"vertical-range":new a.aa(Bi["vertical-range"])});this._transitionable=new a.a8(M,b,new Map(A)),this.set(u,A),this._transitioning=this._transitionable.untransitioned(),this._transform=p,this.properties=new a.ai(M),this.scope=b}get state(){const u=this._transform,p=u.projection.name==="globe",b=a.aj(u.zoom),A=this.properties.get("range"),M=[.5,3];return{range:p?[a.ak(M[0],A[0],b),a.ak(M[1],A[1],b)]:A,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(u,p,b={}){if(this._validate(Me,u,b))return;const A=Object.assign({},u);for(const M of Object.keys(Bi))A[M]===void 0&&(A[M]=Bi[M].default);this._options=A,this._transitionable.setTransitionOrValue(this._options,p)}getOpacity(u){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.ah(ne,$t,u))*p.a}getOpacityAtLatLng(u,p){return this._transform.projection.supportsFog?function(b,A,M){const P=a.ae.fromLngLat(A),O=M.elevation?M.elevation.getAtPointOrZero(P):0;return mi(b,P.x,P.y,O,M)}(this.state,u,p):0}getOpacityForTile(u){if(!this._transform.projection.supportsFog)return[1,1];const p=this._transform.calculateFogTileMatrix(u.toUnwrapped());return Gi(this.state,p,0,0,a.al,a.al,this._transform)}getOpacityForBounds(u,p,b,A,M){return this._transform.projection.supportsFog?Gi(this.state,u,p,b,A,M,this._transform):[1,1]}getFovAdjustedRange(u){return this._transform.projection.supportsFog?Ce(this.state,u):[0,1]}isVisibleOnFrustum(u){if(!this._transform.projection.supportsFog)return!1;const p=[4,5,6,7];for(const b of p){const A=u.points[b];let M;if(A[2]>=0)M=A;else{const P=u.points[b-4];M=a.am(P,A,P[2]/(P[2]-A[2]))}if(mi(this.state,M[0],M[1],0,this._transform)>=ie)return!0}return!1}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,p,b){return(!b||b.validate!==!1)&&ot(this,u.call(Gs,Object.assign({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}}let dr,pr,nn,Yn,wa=class extends a.E{constructor(x,u,p,b){super();const A=dr||(dr=new a.a9({density:new a.aa(a.a6.snow.density),intensity:new a.aa(a.a6.snow.intensity),color:new a.aa(a.a6.snow.color),opacity:new a.aa(a.a6.snow.opacity),vignette:new a.aa(a.a6.snow.vignette),"vignette-color":new a.aa(a.a6.snow["vignette-color"]),"center-thinning":new a.aa(a.a6.snow["center-thinning"]),direction:new a.aa(a.a6.snow.direction),"flake-size":new a.aa(a.a6.snow["flake-size"])}));this._transitionable=new a.a8(A,p,new Map(b)),this.set(x,b),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(A),this.scope=p}get state(){const x=this.properties.get("opacity"),u=this.properties.get("color"),p=this.properties.get("direction"),b=a.an(p[0]),A=-Math.max(a.an(p[1]),.01),M=[Math.cos(b)*Math.cos(A),Math.sin(b)*Math.cos(A),Math.sin(A)],P=this.properties.get("vignette"),O=this.properties.get("vignette-color");return O.a=P,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(u.r,u.g,u.b,u.a*x),direction:M,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:O}}get(){return this._transitionable.serialize()}set(x,u,p={}){if(this._validate(Fu,x,p))return;const b=Object.assign({},x),A=a.a6.snow;for(const M of Object.keys(A))b[M]===void 0&&(b[M]=A[M].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,u)}updateConfig(x){this._transitionable.setTransitionOrValue(this._options,new Map(x))}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}_validate(x,u,p){return(!p||p.validate!==!1)&&ot(this,x.call(Gs,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}},oa=class extends a.E{constructor(x,u,p,b){super();const A=pr||(pr=new a.a9({density:new a.aa(a.a6.rain.density),intensity:new a.aa(a.a6.rain.intensity),color:new a.aa(a.a6.rain.color),opacity:new a.aa(a.a6.rain.opacity),vignette:new a.aa(a.a6.rain.vignette),"vignette-color":new a.aa(a.a6.rain["vignette-color"]),"center-thinning":new a.aa(a.a6.rain["center-thinning"]),direction:new a.aa(a.a6.rain.direction),"droplet-size":new a.aa(a.a6.rain["droplet-size"]),"distortion-strength":new a.aa(a.a6.rain["distortion-strength"])}));this._transitionable=new a.a8(A,p,new Map(b)),this.set(x,b),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ai(A),this.scope=p}get state(){const x=this.properties.get("opacity"),u=this.properties.get("color"),p=this.properties.get("direction"),b=a.an(p[0]),A=-Math.max(a.an(p[1]),.01),M=[Math.cos(b)*Math.cos(A),Math.sin(b)*Math.cos(A),Math.sin(A)],P=this.properties.get("vignette-color");return P.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.ao(u.r,u.g,u.b,u.a*x),direction:M,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(x,u,p={}){if(this._validate(Xp,x,p))return;const b=Object.assign({},x),A=a.a6.rain;for(const M of Object.keys(A))b[M]===void 0&&(b[M]=A[M].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,u)}updateConfig(x){this._transitionable.setTransitionOrValue(this._options,new Map(x))}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}_validate(x,u,p){return(!p||p.validate!==!1)&&ot(this,x.call(Gs,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.a6})))}};class ia extends a.E{constructor(u,p,b,A){super(),this.scope=b,this._options=u,this.properties=new a.ai(p),this._transitionable=new a.a8(p,b,new Map(A)),this._transitionable.setTransitionOrValue(u.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(u){this._transitionable.setTransitionOrValue(this._options.properties,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(u,p){this._options=u,this._transitionable.setTransitionOrValue(u.properties,p)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class en{constructor(u,p,b){this.screenBounds=u,this.cameraPoint=b.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(u,p){let b,A;if(u instanceof a.P||typeof u[0]=="number"){const M=a.P.convert(u);b=[M],A=p.isPointAboveHorizon(M)}else{const M=a.P.convert(u[0]),P=a.P.convert(u[1]),O=M.add(P)._div(2);b=[M,P],A=a.aq(M,P).every(B=>p.isPointAboveHorizon(B))&&p.isPointAboveHorizon(O)}return new en(b,A,p)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(u){return a.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],u)}bufferedCameraGeometry(u){const p=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],A=a.aq(p,b,0,!1);return this.cameraPoint.y>b.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<b.x?A.splice(3,0,this.cameraPoint):this.cameraPoint.x>=b.x?A[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(A[3]=this.cameraPoint)),a.ar(A,u)}bufferedCameraGeometryGlobe(u){const p=this.screenBounds[0],b=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],A=a.aq(p,b,u),M=this.cameraPoint.clone();switch(3*((M.y>p.y)+(M.y>b.y))+((M.x>p.x)+(M.x>b.x))){case 0:A[0]=M,A[4]=M.clone();break;case 1:A.splice(1,0,M);break;case 2:A[1]=M;break;case 3:A.splice(4,0,M);break;case 5:A.splice(2,0,M);break;case 6:A[3]=M;break;case 7:A.splice(3,0,M);break;case 8:A[2]=M}return A}containsTile(u,p,b,A=0){const M=Math.max(u.queryPadding,u.evaluateQueryRenderedFeaturePadding())/p._pixelsPerMercatorPixel+1,P=b?this._bufferedCameraMercator(M,p):this._bufferedScreenMercator(M,p);let O=u.tileID.wrap+(P.unwrapped?A:0);const B=P.polygon.map(ht=>a.as(u.tileTransform,ht,O));if(!a.at(B,0,0,a.al,a.al))return;O=u.tileID.wrap+(this.screenGeometryMercator.unwrapped?A:0);const G=this.screenGeometryMercator.polygon.map(ht=>a.au(u.tileTransform,ht,O)),j=G.map(ht=>new a.P(ht[0],ht[1])),X=p.getFreeCameraOptions().position||new a.ae(0,0,0),W=a.au(u.tileTransform,X,O),K=G.map(ht=>{const st=a.av(ht,ht,W);return a.aw(st,st),new a.ax(W,st)}),tt=a.ay(u,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:K,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(rt=a.az(B),rt.min.x=a.aA(rt.min.x,0,a.al),rt.min.y=a.aA(rt.min.y,0,a.al),rt.max.x=a.aA(rt.max.x,0,a.al),rt.max.y=a.aA(rt.max.y,0,a.al),rt),tile:u,tileID:u.tileID,pixelToTileUnitsFactor:tt};var rt}_bufferedScreenMercator(u,p){const b=Wn(u);if(this._screenRaycastCache[b])return this._screenRaycastCache[b];{let A;return A=p.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(u),p):{polygon:this.bufferedScreenGeometry(u).map(M=>p.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[b]=A,A}}_bufferedCameraMercator(u,p){const b=Wn(u);if(this._cameraRaycastCache[b])return this._cameraRaycastCache[b];{let A;return A=p.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(u),p):{polygon:this.bufferedCameraGeometry(u).map(M=>p.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[b]=A,A}}_projectAndResample(u,p){const b=function(M,P){const O=a.aB([],P.pixelMatrix,P.globeMatrix),B=[0,-a.aD,0,1],G=[0,a.aD,0,1],j=[0,0,0,1];a.aC(B,B,O),a.aC(G,G,O),a.aC(j,j,O);const X=new a.P(B[0]/B[3],B[1]/B[3]),W=new a.P(G[0]/G[3],G[1]/G[3]),K=a.aE(M,X)&&B[3]<j[3],tt=a.aE(M,W)&&G[3]<j[3];if(!K&&!tt)return null;const rt=function(Rt,Mt,At){for(let kt=1;kt<Rt.length;kt++){const qt=Tn(Mt.pointCoordinate3D(Rt[kt-1]).x),jt=Tn(Mt.pointCoordinate3D(Rt[kt]).x);if(At<0){if(qt<jt)return{idx:kt,t:-qt/(jt-1-qt)}}else if(jt<qt)return{idx:kt,t:(1-qt)/(jt+1-qt)}}return null}(M,P,K?-1:1);if(!rt)return null;const{idx:ht,t:st}=rt;let gt=ht>1?Sr(M.slice(0,ht),P):[],xt=ht<M.length?Sr(M.slice(ht),P):[];gt=gt.map(Rt=>new a.P(Tn(Rt.x),Rt.y)),xt=xt.map(Rt=>new a.P(Tn(Rt.x),Rt.y));const vt=[...gt];vt.length===0&&vt.push(xt[xt.length-1]);const Pt=a.ak(vt[vt.length-1].y,(xt.length===0?gt[0]:xt[0]).y,st);let wt;return wt=K?[new a.P(0,Pt),new a.P(0,0),new a.P(1,0),new a.P(1,Pt)]:[new a.P(1,Pt),new a.P(1,1),new a.P(0,1),new a.P(0,Pt)],vt.push(...wt),xt.length===0?vt.push(gt[0]):vt.push(...xt),{polygon:vt.map(Rt=>new a.ae(Rt.x,Rt.y)),unwrapped:!1}}(u,p);if(b)return b;const A=function(M,P){let O=!1,B=-1/0,G=0;for(let X=0;X<M.length-1;X++)M[X].x>B&&(B=M[X].x,G=X);for(let X=0;X<M.length-1;X++){const W=(G+X)%(M.length-1),K=M[W],tt=M[W+1];Math.abs(K.x-tt.x)>.5&&(K.x<tt.x?(K.x+=1,W===0&&(M[M.length-1].x+=1)):(tt.x+=1,W+1===M.length-1&&(M[0].x+=1)),O=!0)}const j=a.aF(P.center.lng);return O&&j<Math.abs(j-1)&&M.forEach(X=>{X.x-=1}),{polygon:M,unwrapped:O}}(Sr(u,p).map(M=>new a.P(Tn(M.x),M.y)),p);return{polygon:A.polygon.map(M=>new a.ae(M.x,M.y)),unwrapped:A.unwrapped}}}function Sr(x,u){return a.aG(x,p=>{const b=u.pointCoordinate3D(p);p.x=b.x,p.y=b.y},1/256)}function Tn(x){return x<0?1+x%1:x%1}function Wn(x){return 100*x|0}function sn(x,u,p,b,A){const M=function(O,B){if(O)return A(O);if(B){if(x.url&&B.tiles&&x.tiles&&delete x.tiles,B.variants){if(!Array.isArray(B.variants))return A(new Error("variants must be an array"));for(const j of B.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return A(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return A(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){B=Object.assign(B,j);break}}}const G=a.aH(Object.assign({},B,x),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=u.canonicalizeTileset(G,x.url),A(null,G)}},P=function(O,B,G){if(!O)return null;if(!B&&!G)return O;G=G||O.worldview_default;const j=Object.values(O.language||{});if(j.length===0)return null;const X=Object.values(O.worldview||{});if(X.length===0)return null;const W=j.every(tt=>tt===B),K=X.every(tt=>tt===G);return W&&K?O:B in(O.language_options||{})||G in(O.worldview_options||{})?null:O.language_options&&O.worldview_options?O:null}(x.data,p,b);return P?a.o.frame(()=>M(null,P)):x.url?a.m(u.transformRequest(u.normalizeSourceURL(x.url,null,p,b),a.R.Source),M):a.o.frame(()=>{const{data:O,...B}=x;M(null,B)})}function An(x,u){const p=Math.pow(2,u.z),b=Math.floor(a.aF(x.getWest())*p),A=Math.floor(a.aJ(x.getNorth())*p),M=Math.ceil(a.aF(x.getEast())*p),P=Math.ceil(a.aJ(x.getSouth())*p);return u.x>=b&&u.x<M&&u.y>=A&&u.y<P}class za{constructor(u,p,b){this.bounds=u?a.aI.convert(this.validateBounds(u)):null,this.minzoom=p||0,this.maxzoom=b||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}addExtraBounds(u){if(u){this.extraBounds||(this.extraBounds=[]);for(const p of u)this.extraBounds.push(a.aI.convert(this.validateBounds(p)))}}contains(u){if(u.z>this.maxzoom||u.z<this.minzoom||this.bounds&&!An(this.bounds,u))return!1;if(!this.extraBounds)return!0;for(const p of this.extraBounds)if(An(p,u))return!0;return!1}static fromTileJSON(u){if(!u.bounds&&!u.extra_bounds)return null;const p=new za(u.bounds,u.minzoom,u.maxzoom);return p.addExtraBounds(u.extra_bounds),p}}class Uo extends a.E{constructor(u,p,b,A){if(super(),this.id=u,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,a.aH(p,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},p),this._collectResourceTiming=!!p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A),this._tileWorkers={},this._deduped=new a.aK}load(u){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const p=Array.isArray(this.map._language)?this.map._language.join():this.map._language,b=this.map.getWorldview();this._tileJSONRequest=sn(this._options,this.map._requestManager,p,b,(A,M)=>{if(this._tileJSONRequest=null,this._loaded=!0,A)p&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${p}`),b&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${b}`),this.fire(new a.y(A));else if(M){if(Object.assign(this,M),this.hasWorldviews=!!M.worldview_options,M.worldview_default&&(this.worldviewDefault=M.worldview_default),M.vector_layers){this.vectorLayers=M.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const P of M.vector_layers)this.vectorLayerIds.push(P.id),M.worldview&&M.worldview[P.source]&&this.localizableLayerIds.add(P.id)}this.tileBounds=za.fromTileJSON(M),ve(M.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}u&&u(A)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(u){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(u,p){const b=u.tileID.canonical.url(this.tiles,this.scheme),A=this.map._requestManager.normalizeTileURL(b),M=this.map._requestManager.transformRequest(A,a.R.Tile),P=this.map.style?this.map.style.getLut(this.scope):null,O=P?{image:P.image.clone()}:null,B={request:M,data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,lut:O,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&a.h(b)&&(B.localizableLayerIds=this.localizableLayerIds),B.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=p:u.request=u.actor.send("reloadTile",B,G.bind(this));else if(u.actor=this._tileWorkers[A]=this._tileWorkers[A]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",B,G.bind(this),void 0,!0);else{const j=a.aL.call({deduped:this._deduped},B,(X,W)=>{if(X||!W)G.call(this,X);else{const K=a.aM(W.responseHeaders);B.data={cacheControl:K.cacheControl,expires:K.expires,rawData:W.rawData.slice(0)},u.actor&&u.actor.send("loadTile",B,G.bind(this),void 0,!0)}},!0);u.request={cancel:j}}function G(j,X){return delete u.request,u.aborted?p(null):j&&j.status!==404?p(j):(X&&X.resourceTiming&&(u.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&u.setExpiryData(X),u.loadVectorData(X,this.map.painter),a.aN(this.dispatcher),p(null,X),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(u,p){u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ml extends a.E{constructor(u,p,b,A){super(),this.id=u,this.dispatcher=b,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},p),Object.assign(this,a.aH(p,["url","scheme","tileSize"]))}load(u){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const p=this.map.getWorldview();this._tileJSONRequest=sn(this._options,this.map._requestManager,null,p,(b,A)=>{this._tileJSONRequest=null,this._loaded=!0,b?this.fire(new a.y(b)):A&&(Object.assign(this,A),A.raster_layers&&(this.rasterLayers=A.raster_layers,this.rasterLayerIds=this.rasterLayers.map(M=>M.id)),this.tileBounds=za.fromTileJSON(A),ve(A.tiles),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(b)})}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}setTiles(u){return this._options.tiles=u,this.reload(),this}setUrl(u){return this.url=u,this._options.url=u,this.reload(),this}onRemove(u){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,p){const b=a.o.devicePixelRatio>=2,A=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),b,this.tileSize);u.request=a.n(this.map._requestManager.transformRequest(A,a.R.Tile),(M,P,O)=>{if(delete u.request,u.aborted)return u.state="unloaded",p(null);if(M)return u.state="errored",p(M);if(!P)return p(null);const B=a.aM(O);this.map._refreshExpiredTiles&&u.setExpiryData(B),u.setTexture(P,this.map.painter),u.state="loaded",a.aN(this.dispatcher),p(null)})}abortTile(u,p){u.request&&(u.request.cancel(),delete u.request),p&&p()}unloadTile(u,p){u.texture&&u.texture instanceof a.T?(u.destroy(!0),u.texture&&u.texture instanceof a.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),p&&p()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Mh([x,u],p,b,{scaled:A=!0}={}){const{tileSize:M,buffer:P}=b,{x:O,y:B,z:G}=p;if(!isFinite(O)||!isFinite(B)||!isFinite(G))throw new Error("Invalid MRT header");const j=2**G,X=j*a.aF(x),W=j*a.aJ(u);return function([K,tt],rt,{scaled:ht=!0}={}){if(!rt)throw new Error("bandView is undefined");const{data:st,tileSize:gt,buffer:xt,offset:vt,scale:Pt,dimension:wt}=rt;if(K<-xt||K>gt+xt||tt<-xt||tt>gt+xt)throw new Error(`Point (${K}, ${tt}) out of bounds for tileSize=${gt}, buffer=${xt}`);const Rt=(tt+xt)*(gt+2*xt)+(K+xt);if(new Uint32Array(st.buffer)[Rt]===4294967295)return null;let Mt=[];Mt=ht?[]:new rt.data.constructor(wt);for(let At=0;At<wt;At++)Mt[At]=Math.round(1e12*(st[wt*Rt+At]*Pt+vt))/1e12;return Mt}([Math.min(Math.max(-P,Math.floor((X-O)*M)),M-1+P),Math.min(Math.max(-P,Math.floor((W-B)*M)),M-1+P)],b,{scaled:A})}class Ga extends ml{constructor(u,p,b,A){super(u,p,b,A),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},p)}triggerRepaint(u){const p=this.map.painter._terrain,b=this.map.style.getSourceCache(this.id);p&&p.enabled&&b&&p._clearRenderCacheForTile(b.id,u.tileID),this.map.triggerRepaint()}loadTile(u,p){const b=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),A=this.map._requestManager.transformRequest(b,a.R.Tile),M={request:A,uid:u.uid,tileID:u.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};u.source=this.id,u.scope=this.scope,u.requestParams=A,u.actor||(u.actor=this.dispatcher.getActor());const P=(O,B,G)=>{if(delete u.request,u.aborted)return u.state="unloaded",p(null);if(O)return O.name==="AbortError"?void 0:(u.state="errored",p(O));if(this.map._refreshExpiredTiles&&B){const j=a.aM(G);u.setExpiryData(j)}if(this.partial&&u.state!=="expired")u.state="empty";else if(!this.partial){if(!B)return p(null);u.state="loaded",u._isHeaderLoaded=!0,u._mrt=B}p(null)};u.request=this.partial?u.fetchHeader(void 0,P.bind(this)):u.actor.send("loadTile",M,P.bind(this),void 0,!0)}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(u,p){const b=u.texturePerLayer;if(u.flushAllQueues(),b.size){u.destroy(!0);for(const A of b.values())this.map.painter.saveTileTexture(A)}else u.destroy()}prepareTile(u,p,b,A){u._isHeaderLoaded&&(u.state!=="empty"&&(u.state="reloading"),u.fetchBandForRender(p,b,A,(M,P)=>{if(M)return u.state="errored",this.fire(new a.y(M)),void this.triggerRepaint(u);P&&(u._isHeaderLoaded=!0,u.setTexturePerLayer(b,P,this.map.painter),u.state="loaded",this.triggerRepaint(u))}))}getInitialBand(u){if(!this.rasterLayers)return 0;const p=this.rasterLayers.find(({id:M})=>M===u),b=p&&p.fields,A=b&&b.bands&&b.bands;return A?A[0]:0}getTextureDescriptor(u,p,b){if(!u)return;const A=p.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!A)return;let M=null;p instanceof a.aQ?M=p.paint.get("raster-array-band"):p instanceof a.aR&&(M=p.paint.get("raster-particle-array-band"));const P=M||this.getInitialBand(A);if(P==null)return;if(!u.textureDescriptorPerLayer.get(p.id))return void this.prepareTile(u,A,p.id,P);if(u.updateNeeded(p.id,P)&&!b)return;const O=u.textureDescriptorPerLayer.get(p.id);return Object.assign({},O,{texture:u.texturePerLayer.get(p.id)})}getImages(u,p){const b=new Map;for(const A of u)for(const M of p){const[P,O]=M.split("/"),B=A.getLayer(P);if(!B||!B.hasBand(O)||!B.hasDataForBand(O))continue;const{bytes:G,tileSize:j,buffer:X}=B.getBandView(O),W=j+2*X,K={data:new a.q({width:W,height:W},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};b.set(M,K)}return b}queryRasterArrayValueByBandId(u,p,b){const A=p._mrt;return new Promise(M=>{const P={},O=new Set;for(const[B,G]of Object.entries(A.layers)){if(b.layerName&&B!==b.layerName)continue;const j={};P[B]=j;for(const{bands:X}of G.dataIndex)for(const W of X)b.bands&&!b.bands.includes(W)||(O.add(a.B(B,W)),p.fetchBand(B,null,W,K=>{a.o.frame(()=>{j[W]=K?null:Mh([u.lng,u.lat],A,G.getBandView(W)),O.delete(a.B(B,W)),O.size===0&&M(P)})},!1))}O.size===0&&M(P)})}_loadTileForQuery(u,p){if(this._loadTileLoaded[u.uid])return void p(null,u._mrt);if(this._loadTilePending[u.uid])return void this._loadTilePending[u.uid].push(p);this._loadTilePending[u.uid]=[p];const b=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),A=this.map._requestManager.transformRequest(b,a.R.Tile);u.actor.send("loadTile",{request:A,uid:u.uid,tileID:u.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(M,P,O)=>{if(M)return this._loadTilePending[u.uid].forEach(B=>B(M,null)),void delete this._loadTilePending[u.uid];if(!P)return this._loadTilePending[u.uid].forEach(B=>B(null,null)),void delete this._loadTilePending[u.uid];if(this.map._refreshExpiredTiles&&P){const B=a.aM(O);u.setExpiryData(B)}u._mrt=P,u._isHeaderLoaded=!0,u.state="loaded",this._loadTilePending[u.uid].forEach(B=>B(null,P)),this._loadTileLoaded[u.uid]=!0,delete this._loadTilePending[u.uid]},void 0,!0)}queryRasterArrayValueByAllBands(u,p,b){return new Promise((A,M)=>{this._loadTileForQuery(p,(P,O)=>{P?M(P):A(O?this.queryRasterArrayValueByBandId(u,p,b):null)})})}queryRasterArrayValue(u,p){const b=a.aS.convert(u),A=this.findLoadedParent(b);return A&&A._mrt?p.bands||!this.partial?this.queryRasterArrayValueByBandId(b,A,p):this.queryRasterArrayValueByAllBands(b,A,p):Promise.resolve(null)}findLoadedParent(u){const p=a.ae.fromLngLat(u,this.map.transform.tileSize),b=this.maxzoom+1,A=1<<b,M=Math.floor(p.x),P=Math.floor((p.x-M)*A),O=Math.floor(p.y*A),B=this.map.style.getSourceCache(this.id),G=new a.aP(b,M,b,P,O);return B.findLoadedParent(G,this.minzoom)}}const vl={vector:Uo,raster:ml,"raster-dem":class extends ml{constructor(x,u,p,b){super(x,u,p,b),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}loadTile(x,u){const p=this.map._requestManager.normalizeTileURL(x.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function b(A,M){A&&(x.state="errored",u(A)),M&&(x.dem=M,x.dem.onDeserialize(),x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0,x.state="loaded",u(null))}x.request=a.n(this.map._requestManager.transformRequest(p,a.R.Tile),(function(A,M,P){if(delete x.request,x.aborted)x.state="unloaded",u(null);else if(A)x.state="errored",u(A);else if(M){const O=a.aM(P);this.map._refreshExpiredTiles&&x.setExpiryData(O);const B=ImageBitmap&&M instanceof ImageBitmap&&a.r(),G=1-(M.width-a.aO(M.width))/2;G<1||x.neighboringTiles||(x.neighboringTiles=this._getNeighboringTiles(x.tileID));const j=B?M:a.o.getImageData(M,G),X={uid:x.uid,tileID:x.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:G};x.actor&&x.state!=="expired"||(x.actor=this.dispatcher.getActor(),x.actor.send("loadTile",X,b.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(x){const u=x.canonical,p=Math.pow(2,u.z),b=(u.x-1+p)%p,A=u.x===0?x.wrap-1:x.wrap,M=(u.x+1+p)%p,P=u.x+1===p?x.wrap+1:x.wrap,O={};return O[new a.aP(x.overscaledZ,A,u.z,b,u.y).key]={backfilled:!1},O[new a.aP(x.overscaledZ,P,u.z,M,u.y).key]={backfilled:!1},u.y>0&&(O[new a.aP(x.overscaledZ,A,u.z,b,u.y-1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,x.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,P,u.z,M,u.y-1).key]={backfilled:!1}),u.y+1<p&&(O[new a.aP(x.overscaledZ,A,u.z,b,u.y+1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,x.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},O[new a.aP(x.overscaledZ,P,u.z,M,u.y+1).key]={backfilled:!1}),O}},"raster-array":Ga,geojson:class extends a.E{constructor(x,u,p,b){super(),this.id=x,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(b),this._data=u.data,this._options=Object.assign({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.minzoom!==void 0&&(this.minzoom=u.minzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const A=a.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*A,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*A,extent:a.al,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:a.al,radius:(u.clusterRadius!==void 0?u.clusterRadius:50)*A,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter,dynamic:u.dynamic},u.workerOptions)}onAdd(x){this.map=x,this.setData(this._data)}setData(x){return this._data=x,this._updateWorkerData(),this}updateData(x){if(!this._options.dynamic)return this.fire(new a.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof x!="string"&&(x.type==="Feature"&&(x={type:"FeatureCollection",features:[x]}),x.type!=="FeatureCollection"))return this.fire(new a.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof x!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const u=new Map;for(const p of this._data.features)u.set(p.id,p);for(const p of x.features)u.set(p.id,p);this._data.features=[...u.values()]}else this._data=x;return this._updateWorkerData(!0),this}getClusterExpansionZoom(x,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:x,source:this.id,scope:this.scope},u),this}getClusterChildren(x,u){return this.actor.send("geojson.getClusterChildren",{clusterId:x,source:this.id,scope:this.scope},u),this}getClusterLeaves(x,u,p,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:x,limit:u,offset:p},b),this}_updateWorkerData(x=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.z("dataloading",{dataType:"source"})),this._loaded=!1;const u=Object.assign({append:x},this.workerOptions);u.scope=this.scope;const p=this._data;typeof p=="string"?(u.request=this.map._requestManager.transformRequest(a.o.resolveURL(p),a.R.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(p),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(b,A)=>{if(this._loaded=!0,this._pendingLoad=null,b)this.fire(new a.y(b));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&A&&A.resourceTiming&&A.resourceTiming[this.id]&&(M.resourceTiming=A.resourceTiming[this.id]),x&&(this._partialReload=!0),this.fire(new a.z("data",M)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(x),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const x=a.B(this.id,this.scope);this.map.style.clearSource(x),this._updateWorkerData()}loadTile(x,u){const p=x.actor?"reloadTile":"loadTile";x.actor=this.actor;const b=this.map.style?this.map.style.getLut(this.scope):null,A=b?{image:b.image.clone()}:null,M=this._partialReload,P={type:this.type,uid:x.uid,tileID:x.tileID,tileZoom:x.tileZoom,zoom:x.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:A,scope:this.scope,pixelRatio:a.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:x.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:M,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};x.request=this.actor.send(p,P,(O,B)=>M&&!B?(x.state="loaded",u(null)):(delete x.request,x.destroy(),x.aborted?u(null):O?u(O):(x.loadVectorData(B,this.map.painter,p==="reloadTile"),u(null))),void 0,p==="loadTile")}abortTile(x){x.request&&(x.request.cancel(),delete x.request),x.aborted=!0}unloadTile(x,u){this.actor.send("removeTile",{uid:x.uid,type:this.type,source:this.id,scope:this.scope}),x.destroy()}onRemove(x){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aT{constructor(x,u,p,b){super(x,u,p,b),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const x=this.options;this.urls=[];for(const u of x.urls)this.urls.push(this.map._requestManager.transformRequest(u,a.R.Source).url);a.aU(this.urls,(u,p)=>{this._loaded=!0,u?this.fire(new a.y(u)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(x){if(this.video){const u=this.video.seekable;x<u.start(0)||x>u.end(0)?this.fire(new a.y(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=x}}getVideo(){return this.video}onAdd(x){this.map||(this.map=x,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const x=this.map.painter.context,u=x.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(x,this.video,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(x)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aT,model:a.aW,"batched-model":class extends a.E{constructor(x,u,p,b){super(),this.type="batched-model",this.id=x,this.tileSize=512,this._options=u,this.tiles=this._options.tiles,this.maxzoom=u.maxzoom||19,this.minzoom=u.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=p,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(b)}onAdd(x){this.map=x,this.load()}reload(){this.cancelTileJSONRequest();const x=a.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(x))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(x){this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=sn(this._options,this.map._requestManager,u,p,(b,A)=>{this._tileJSONRequest=null,this._loaded=!0,b?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new a.y(b))):A&&(Object.assign(this,A),A.bounds&&(this.tileBounds=new za(A.bounds,this.minzoom,this.maxzoom)),ve(A.tiles,this.map._requestManager._customAccessToken),this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))),x&&x(b)})}hasTransition(){return!1}hasTile(x){return!this.tileBounds||this.tileBounds.contains(x.canonical)}loaded(){return this._loaded}loadTile(x,u){const p=this.map._requestManager.normalizeTileURL(x.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(p,a.R.Tile),data:void 0,uid:x.uid,tileID:x.tileID,tileZoom:x.tileZoom,zoom:x.tileID.overscaledZ,tileSize:this.tileSize*x.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:x.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.o.devicePixelRatio,promoteId:this.promoteId};if(x.actor&&x.state!=="expired")if(x.state==="loading")x.reloadCallback=u;else{if(x.buckets){const M=Object.values(x.buckets);for(const P of M)P.dirty=!0;return void(x.state="loaded")}x.request=x.actor.send("reloadTile",b,A.bind(this))}else x.actor=this.dispatcher.getActor(),x.request=x.actor.send("loadTile",b,A.bind(this),void 0,!0);function A(M,P){return x.aborted?u(null):M&&M.status!==404?u(M):(this.map._refreshExpiredTiles&&P&&x.setExpiryData(P),x.loadModelData(P,this.map.painter),x.state="loaded",void u(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends a.aT{constructor(x,u,p,b){super(x,u,p,b),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(M=>typeof M!="number"))||this.fire(new a.y(new a.V(`sources.${x}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.y(new a.V(`sources.${x}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new a.y(new a.V(`sources.${x}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new a.y(new a.V(`sources.${x}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.y(new a.V(`sources.${x}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(x){this.map=x,this.load(),this.canvas&&this.animate&&this.play()}onRemove(x){this.pause()}prepare(){let x=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,x=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,x=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context;this.texture?!x&&!this._playing||this.texture instanceof a.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(u,this.canvas,u.gl.RGBA8,{premultiply:!0}),this._prepareData(u)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const x of[this.canvas.width,this.canvas.height])if(isNaN(x)||x<=0)return!0;return!1}},custom:class extends a.E{constructor(x,u,p,b){super(),this.id=x,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=u,this.setEventedParent(b),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new za(this._implementation.bounds,this.minzoom,this.maxzoom)),u.update=this._update.bind(this),u.clearTiles=this._clearTiles.bind(this),u.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,a.aH(u,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(x){this.map=x,this._loaded=!1,this.fire(new a.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(x),this.load()}onRemove(x){this._implementation.onRemove&&this._implementation.onRemove(x)}hasTile(x){if(this._implementation.hasTile){const{x:u,y:p,z:b}=x.canonical;return this._implementation.hasTile({x:u,y:p,z:b})}return!this.tileBounds||this.tileBounds.contains(x.canonical)}loadTile(x,u){const{x:p,y:b,z:A}=x.tileID.canonical,M=new AbortController;x.request=Promise.resolve(this._implementation.loadTile({x:p,y:b,z:A},{signal:M.signal})).then((function(P){return delete x.request,x.aborted?(x.state="unloaded",u(null)):P===void 0?(x.state="errored",u(null)):P===null?(this.loadTileData(x,{width:this.tileSize,height:this.tileSize,data:null}),x.state="loaded",u(null)):function(O){return O instanceof ImageData||O instanceof HTMLCanvasElement||O instanceof ImageBitmap||O instanceof HTMLImageElement}(P)?(this.loadTileData(x,P),x.state="loaded",void u(null)):(x.state="errored",u(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(P=>{P.name!=="AbortError"&&(x.state="errored",u(P))}),x.request.cancel=()=>M.abort()}loadTileData(x,u){x.setTexture(u,this.map.painter)}unloadTile(x,u){if(x.texture&&x.texture instanceof a.T?(x.destroy(!0),x.texture&&x.texture instanceof a.T&&this.map.painter.saveTileTexture(x.texture)):x.destroy(),this._implementation.unloadTile){const{x:p,y:b,z:A}=x.tileID.canonical;this._implementation.unloadTile({x:p,y:b,z:A})}u&&u()}abortTile(x,u){x.request&&x.request.cancel&&(x.request.cancel(),delete x.request),u&&u()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(x=>({x:x.canonical.x,y:x.canonical.y,z:x.canonical.z}))}_clearTiles(){const x=a.B(this.id,this.scope);this.map.style.clearSource(x)}_update(){this.fire(new a.z("data",{dataType:"source",sourceDataType:"content"}))}}},Yo=function(x,u,p,b){const A=new vl[u.type](x,u,p,b);if(A.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${A.id}`);return a.aX(["load","abort","unload","serialize","prepare"],A),A};function Bl(x,u,p=""){return`${p}:${u.id||""}:${u.layer.id}:${function(b){if("layerId"in b)return`layer:${b.layerId}`;{const{featuresetId:A,importId:M}=b;return`featureset:${A}${M?`:import:${M}`:""}`}}(x.target)}`}function bs(x,u,p,b=""){if(x.uniqueFeatureID){const A=Bl(x,u,b);if(p.has(A))return!0;p.add(A)}return!1}function ws(x,u,p,b,A=!1){const M=u.sourceCache.transform,P=u.sourceCache.tilesIn(x,u.has3DLayers,A);P.sort(Qp);const O=[];for(const B of P){const G=B.tile.queryRenderedFeatures(u,B,p,b,M,A);Object.keys(G).length&&O.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:G})}for(const B in u.layers){const G=u.layers[B];if(G.styleLayer){const j=G.styleLayer.queryRenderedFeatures(x,u.sourceCache,b);Object.keys(j).length&&O.push({wrappedTileID:0,queryResults:j})}}return O.length===0?{}:function(B){const G={},j={};for(const X of B){const W=X.queryResults,K=X.wrappedTileID,tt=j[K]=j[K]||{};for(const rt in W){const ht=W[rt],st=tt[rt]=tt[rt]||{},gt=G[rt]=G[rt]||[];for(const xt of ht)st[xt.featureIndex]||(st[xt.featureIndex]=!0,gt.push(xt))}}return G}(O)}function Vv(x,u,p,b,A,M){const P={},O=b.queryRenderedSymbols(x),B=[];for(const G of Object.keys(O).map(Number))B.push(A[G]);B.sort(Qp);for(const G of B){const j=G.featureIndex.lookupSymbolFeatures(O[G.bucketInstanceId],G.bucketIndex,G.sourceLayerIndex,u,p,M);for(const X in j){const W=P[X]=P[X]||[],K=j[X];K.sort((tt,rt)=>{const ht=G.featureSortOrder;if(ht){const st=ht.indexOf(tt.featureIndex);return ht.indexOf(rt.featureIndex)-st}return rt.featureIndex-tt.featureIndex});for(const tt of K)W.push(tt)}}return P}function Jp(x,u){const p=x.getRenderableIds().map(M=>x.getTileByID(M)),b=[],A={};for(let M=0;M<p.length;M++){const P=p[M],O=P.tileID.canonical.key;A[O]||(A[O]=!0,P.querySourceFeatures(b,u))}return b}function Qp(x,u){const p=x.tileID,b=u.tileID;return p.overscaledZ-b.overscaledZ||p.canonical.y-b.canonical.y||p.wrap-b.wrap||p.canonical.x-b.canonical.x}function tg(x,u){const p={};if(!u)return p;for(const b of x){const A=b.layerIds.map(M=>u.getLayer(M)).filter(Boolean);if(A.length!==0){b.layers=A,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>A.filter(P=>P.id===M)[0]));for(const M of A)p[M.fqid]=b}}return p}const us=32,Fl=33,Ko=new Uint16Array(8184);for(let x=0;x<2046;x++){let u=x+2,p=0,b=0,A=0,M=0,P=0,O=0;for(1&u?A=M=P=us:p=b=O=us;(u>>=1)>1;){const G=p+A>>1,j=b+M>>1;1&u?(A=p,M=b,p=P,b=O):(p=A,b=M,A=P,M=O),P=G,O=j}const B=4*x;Ko[B+0]=p,Ko[B+1]=b,Ko[B+2]=A,Ko[B+3]=M}const Hs=new Uint16Array(2178),Nu=new Uint8Array(1089),Eh=new Uint16Array(1089);function Uv(x){return x===0?-.03125:x===32?.03125:0}const Gv=(()=>({type:2,extent:a.al,loadGeometry:()=>[[new a.P(0,0),new a.P(a.al+1,0),new a.P(a.al+1,a.al+1),new a.P(0,a.al+1),new a.P(0,0)]]}))();class su{constructor(u,p,b,A,M,P){this.tileID=u,this.uid=a.b1(),this.uses=0,this.tileSize=p,this.tileZoom=b,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=M,A&&A.style&&(this._lastUpdatedBrightness=A.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",A&&A.transform&&(this.projection=A.transform.projection),this.worldview=P,this._hasAppearances=null}registerFadeDuration(u){const p=u+this.timeAdded;p<a.o.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(u,p,b){if(this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=tg(u.buckets,p.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const M=this.buckets[A];if(M instanceof a.b3){if(this.hasSymbolBuckets=!0,!b)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const M=this.buckets[A];if(M instanceof a.b3&&M.hasRTLText){this.hasRTLText=!0,a.b4();break}}this.queryPadding=0;for(const A in this.buckets){const M=this.buckets[A],P=p.style.getOwnLayer(A);if(!P)continue;const O=P.queryRadius(M);this.queryPadding=Math.max(this.queryPadding,O)}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage),u.lineAtlas&&(this.lineAtlas=u.lineAtlas),this._lastUpdatedBrightness=u.brightness}else this.collisionBoxArray=new a.b2}unloadVectorData(){if(this.hasData()){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(u,p,b){u&&(u.resourceTiming&&(this.resourceTiming=u.resourceTiming),this.buckets=Object.assign({},this.buckets,tg(u.buckets,p.style)),u.featureIndex&&(this.latestFeatureIndex=u.featureIndex))}getBucket(u){return this.buckets[u.fqid]}upload(u,p){for(const M in this.buckets){const P=this.buckets[M];if(P.uploadPending()){let O={},B=[],G={zoom:0,pitch:0,brightness:0,worldview:""};if(p){if(p.style){B=p.style.listImages();const j=P.layers[0],X=j.sourceLayer||"_geojsonTileLayer",W=p.style.getLayerSourceCache(j);W&&(O=W._state.getState(X,void 0))}G={zoom:p.transform.zoom||0,pitch:p.transform.pitch||0,brightness:p.style.getBrightness()||0,worldview:p.worldview||""}}P.upload(u,this.tileID.canonical,O,B,G)}}const b=u.gl,A=this.imageAtlas;A&&!A.uploaded&&(this.imageAtlasTexture=new a.T(u,A.image,b.RGBA8,{useMipmap:!!A.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(u,this.glyphAtlasImage,b.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(u,this.lineAtlas.image,b.R8),this.lineAtlas.uploaded=!0)}prepare(u,p,b){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture,b),!p||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const A=p.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(p)),(this._lastUpdatedBrightness||A||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&A&&Math.abs(this._lastUpdatedBrightness-A)<.001||(this.updateBuckets(p,this._lastUpdatedBrightness!==A),this._lastUpdatedBrightness=A))}evaluateQueryRenderedFeaturePadding(){let u=0;for(const p in this.buckets){const b=this.buckets[p];b.evaluateQueryRenderedFeaturePadding&&(u=Math.max(u,b.evaluateQueryRenderedFeaturePadding()))}return u}queryRenderedFeatures(u,p,b,A,M,P){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const O=this.evaluateQueryRenderedFeaturePadding(),B=function(G,j){const X=a.bp([],[.5*G.width,.5*-G.height,1]);return a.bq(X,X,[1,-1,0]),a.aB(X,X,G.calculateProjMatrix(j.toUnwrapped())),Float32Array.from(X)}(M,this.tileID);return this.latestFeatureIndex.query(u,{tilespaceGeometry:p,pixelPosMatrix:B,transform:A,availableImages:b,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:O})}querySourceFeatures(u,p){const b=this.latestFeatureIndex;if(!b||!b.rawTileData)return;const A=b.loadVTLayers(),M=p?p.sourceLayer:"",P=A._geojsonTileLayer||A[M];if(!P)return;const O=a.b5(p&&p.filter),{z:B,x:G,y:j}=this.tileID.canonical,X={z:B,x:G,y:j};for(let W=0;W<P.length;W++){const K=P.feature(W);if(O.needGeometry){const ht=a.b6(K,!0);if(!O.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ht,this.tileID.canonical))continue}else if(!O.filter(new a.ac(this.tileID.overscaledZ,{worldview:this.worldview}),K))continue;const tt=b.getId(K,M),rt=new a.b7(K,B,G,j,tt);rt.tile=X,u.push(rt)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(u){const p=this.expirationTime;if(u.cacheControl){const b=a.b8(u.cacheControl);b["max-age"]&&(this.expirationTime=Date.now()+1e3*b["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const b=Date.now();let A=!1;if(this.expirationTime>b)A=!1;else if(p)if(this.expirationTime<p)A=!0;else{const M=this.expirationTime-p;M?this.expirationTime=b+Math.max(M,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(u){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&u&&this.updateBuckets(u)}hasAppearances(u){for(const p in this.buckets)if(u.style.hasLayer(p)&&this.buckets[p].layers.some(b=>b.appearances&&b.appearances.length>0))return!0;return!1}updateBuckets(u,p){if(!this.latestFeatureIndex||!u.style)return;const b=this.latestFeatureIndex.loadVTLayers(),A=u.style.listImages(),M=u.style.getBrightness();for(const P in this.buckets){if(!u.style.hasLayer(P))continue;const O=this.buckets[P],B=O.layers[0],G=B.sourceLayer||"_geojsonTileLayer",j=b[G],X=u.style.getLayerSourceCache(B);let W={};X&&(W=X._state.getState(G,void 0));const K=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},tt=Object.keys(W).length>0&&!p;if(O.hasAppearances=O.layers.some(ht=>ht.appearances&&ht.appearances.length>0),(tt&&O.stateDependentLayers.length!==0||p)&&O.update(W,j,A,K,tt?O.stateDependentLayers:O.layers,p,M),tt&&O.stateDependentLayers.length!==0||p||O.hasAppearances){const ht={zoom:u.transform.zoom,pitch:u.transform.pitch,brightness:u.style.getBrightness()||0,worldview:u.worldview};O.updateAppearances(this.tileID.canonical,W,A,ht)}(O instanceof a.b9||O instanceof a.ba)&&u._terrain&&u._terrain.enabled&&X&&O.uploadPending()&&u._terrain._clearRenderCacheForTile(X.id,this.tileID);const rt=u&&u.style&&u.style.getOwnLayer(P);rt&&(this.queryPadding=Math.max(this.queryPadding,rt.queryRadius(O)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(u){this.symbolFadeHoldUntil=a.o.now()+u}setTexture(u,p){const b=p.context,A=b.gl;this.texture=this.texture||p.getTileTexture(u.width),this.texture&&this.texture instanceof a.T?this.texture.update(u):(this.texture=new a.T(b,u,A.RGBA8,{useMipmap:!0}),this.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE))}setDependencies(u,p){const b={};for(const A of p)b[A]=!0;this.dependencies[u]=b}hasDependency(u,p){for(const b of u){const A=this.dependencies[b];if(A){for(const M of p)if(A[M])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(u,p){if(!p||p.name==="mercator"||this._tileDebugBuffer)return;const b=a.bb(Gv,this.tileID.canonical,this.tileTransform)[0],A=new a.bc,M=new a.bd;for(let P=0;P<b.length;P++){const{x:O,y:B}=b[P];A.emplaceBack(O,B),M.emplaceBack(P)}M.emplaceBack(0),this._tileDebugIndexBuffer=u.createIndexBuffer(M),this._tileDebugBuffer=u.createVertexBuffer(A,a.be.members),this._tileDebugSegments=a.bf.simpleSegment(0,0,A.length,M.length)}_makeTileBoundsBuffers(u,p){if(this._tileBoundsBuffer||!p||p.name==="mercator")return;const b=a.bb(Gv,this.tileID.canonical,this.tileTransform)[0];let A,M;if(this.isRaster){const P=function(O,B){const G=a.aY(O,B),j=Math.pow(2,O.z);for(let ht=0;ht<Fl;ht++)for(let st=0;st<Fl;st++){const gt=a.aZ((O.x+(st+Uv(st))/us)/j),xt=a.a_((O.y+(ht+Uv(ht))/us)/j),vt=B.project(gt,xt),Pt=ht*Fl+st;Hs[2*Pt+0]=Math.round((vt.x*G.scale-G.x)*a.al),Hs[2*Pt+1]=Math.round((vt.y*G.scale-G.y)*a.al)}Nu.fill(0),Eh.fill(0);for(let ht=2045;ht>=0;ht--){const st=4*ht,gt=Ko[st+0],xt=Ko[st+1],vt=Ko[st+2],Pt=Ko[st+3],wt=gt+vt>>1,Rt=xt+Pt>>1,Mt=wt+Rt-xt,At=Rt+gt-wt,kt=xt*Fl+gt,qt=Pt*Fl+vt,jt=Rt*Fl+wt,oe=Math.hypot((Hs[2*kt+0]+Hs[2*qt+0])/2-Hs[2*jt+0],(Hs[2*kt+1]+Hs[2*qt+1])/2-Hs[2*jt+1])>=16;Nu[jt]=Nu[jt]||(oe?1:0),ht<1022&&(Nu[jt]=Nu[jt]||Nu[(xt+At>>1)*Fl+(gt+Mt>>1)]||Nu[(Pt+At>>1)*Fl+(vt+Mt>>1)])}const X=new a.a$,W=new a.b0;let K=0;function tt(ht,st){const gt=st*Fl+ht;return Eh[gt]===0&&(X.emplaceBack(Hs[2*gt+0],Hs[2*gt+1],ht*a.al/us,st*a.al/us),Eh[gt]=++K),Eh[gt]-1}function rt(ht,st,gt,xt,vt,Pt){const wt=ht+gt>>1,Rt=st+xt>>1;if(Math.abs(ht-vt)+Math.abs(st-Pt)>1&&Nu[Rt*Fl+wt])rt(vt,Pt,ht,st,wt,Rt),rt(gt,xt,vt,Pt,wt,Rt);else{const Mt=tt(ht,st),At=tt(gt,xt),kt=tt(vt,Pt);W.emplaceBack(Mt,At,kt)}}return rt(0,0,us,us,us,0),rt(us,us,0,0,0,us),{vertices:X,indices:W}}(this.tileID.canonical,p);A=P.vertices,M=P.indices}else{A=new a.a$,M=new a.b0;for(const{x:O,y:B}of b)A.emplaceBack(O,B,0,0);const P=a.bg(A.int16.subarray(0,4*A.length),void 0,4);for(let O=0;O<P.length;O+=3)M.emplaceBack(P[O],P[O+1],P[O+2])}this._tileBoundsBuffer=u.createVertexBuffer(A,a.bh.members),this._tileBoundsIndexBuffer=u.createIndexBuffer(M),this._tileBoundsSegments=a.bf.simpleSegment(0,0,A.length,M.length)}_makeGlobeTileDebugBuffers(u,p){const b=p.projection;if(!b||b.name!=="globe"||p.freezeTileCoverage)return;const A=this.tileID.canonical,M=a.bi(A,p),P=a.bj(M),O=a.aj(p.zoom);let B;O>0&&(B=a.bk(new Float64Array(16),p.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(u,A,p,P,B,O),this._makeGlobeTileDebugTextBuffer(u,A,p,P,B,O)}_globePoint(u,p,b,A,M,P,O){let B=a.bl(u,p,b);if(P){const G=1<<b.z,j=a.aF(A.center.lng),X=a.aJ(A.center.lat),W=(b.x+.5)/G-j;let K=0;W>.5?K=-1:W<-.5&&(K=1);let tt=(u/a.al+b.x)/G+K,rt=(p/a.al+b.y)/G;tt=(tt-j)*A._pixelsPerMercatorPixel+j,rt=(rt-X)*A._pixelsPerMercatorPixel+X;const ht=[tt*A.worldSize,rt*A.worldSize,0];a.af(ht,ht,P),B=a.bm(B,ht,O)}return a.af(B,B,M)}_makeGlobeTileDebugBorderBuffer(u,p,b,A,M,P){const O=new a.bc,B=new a.bd,G=new a.bn,j=(W,K,tt,rt,ht)=>{const st=(tt-W)/(ht-1),gt=(rt-K)/(ht-1),xt=O.length;for(let vt=0;vt<ht;vt++){const Pt=W+vt*st,wt=K+vt*gt;O.emplaceBack(Pt,wt);const Rt=this._globePoint(Pt,wt,p,b,A,M,P);G.emplaceBack(Rt[0],Rt[1],Rt[2]),B.emplaceBack(xt+vt)}},X=a.al;j(0,0,X,0,16),j(X,0,X,X,16),j(X,X,0,X,16),j(0,X,0,0,16),this._tileDebugIndexBuffer=u.createIndexBuffer(B),this._tileDebugBuffer=u.createVertexBuffer(O,a.be.members),this._globeTileDebugBorderBuffer=u.createVertexBuffer(G,a.bo.members),this._tileDebugSegments=a.bf.simpleSegment(0,0,O.length,B.length)}_makeGlobeTileDebugTextBuffer(u,p,b,A,M,P){const O=a.al/4,B=new a.bc,G=new a.b0,j=new a.bn,X=25;G.reserve(32),B.reserve(X),j.reserve(X);const W=(K,tt)=>X*K+tt;for(let K=0;K<X;K++){const tt=K*O;for(let rt=0;rt<X;rt++){const ht=rt*O;B.emplaceBack(ht,tt);const st=this._globePoint(ht,tt,p,b,A,M,P);j.emplaceBack(st[0],st[1],st[2])}}for(let K=0;K<4;K++)for(let tt=0;tt<4;tt++){const rt=W(K,tt),ht=W(K,tt+1),st=W(K+1,tt),gt=W(K+1,tt+1);G.emplaceBack(rt,ht,st),G.emplaceBack(st,ht,gt)}this._tileDebugTextIndexBuffer=u.createIndexBuffer(G),this._tileDebugTextBuffer=u.createVertexBuffer(B,a.be.members),this._globeTileDebugTextBuffer=u.createVertexBuffer(j,a.bo.members),this._tileDebugTextSegments=a.bf.simpleSegment(0,0,X,32)}destroy(u=!1){for(const p in this.buckets)this.buckets[p].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!u&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.br.setPbf(a.bs);class Ac extends su{constructor(u,p,b,A,M){super(u,p,b,A,M),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(u){return this._mrt&&this._mrt.getLayer(u)}setTexturePerLayer(u,p,b){const A=b.context,M=A.gl;let P=this.texturePerLayer.get(u)||b.getTileTexture(p.width);P&&P instanceof a.T?P.update(p,{premultiply:!1}):P=new a.T(A,p,M.RGBA8,{premultiply:!1}),this.texturePerLayer.has(u)||this.texturePerLayer.set(u,P)}flushQueues(u){const p=this._workQueuePerLayer.get(u)||[],b=this._fetchQueuePerLayer.get(u)||[];for(;p.length;)p.pop()();for(;b.length;)b.pop()()}flushAllQueues(){for(const u of this._workQueuePerLayer.keys()){const p=this._workQueuePerLayer.get(u)||[];for(;p.length;)p.pop()()}for(const u of this._fetchQueuePerLayer.keys()){const p=this._fetchQueuePerLayer.get(u)||[];for(;p.length;)p.pop()()}}fetchHeader(u=16384,p){const b=this._mrt=new a.br(30),A=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(u-1)}});return this.entireBuffer=null,this.request=a.bt(A,(M,P,O)=>{if(M)p(M);else try{const B=b.getHeaderLength(P);if(B>u)return void(this.request=this.fetchHeader(B,p));b.parseHeader(P),this._isHeaderLoaded=!0;let G=0;for(const j of Object.values(b.layers))G=Math.max(G,j.dataIndex[j.dataIndex.length-1].lastByte);P.byteLength>=G&&(this.entireBuffer=P),p(null,this.entireBuffer||P,O)}catch(B){p(B)}}),this.request}fetchBandForRender(u,p,b,A){this.fetchBand(u,p,b,M=>{if(M)return void A(M);this.updateTextureDescriptor(u,p,b);const P=this.textureDescriptorPerLayer.get(p);A(null,P?P.img:null)})}fetchBand(u,p,b,A,M=!0){const P=this._mrt;if(!this._isHeaderLoaded||!P)return void A(new Error("Tile header is not ready"));const O=this.actor;if(!O)return void A(new Error("Can't fetch tile band without an actor"));let B;const G=a.B(String(b),a.B(this.tileID.key,u));let j=this._taskQueue.get(G);j?j.add(A):(j=new Set,j.add(A),this._taskQueue.set(G,j));const X=(rt,ht)=>{B.complete(rt,ht),rt?A(rt):(j.values().forEach(st=>st(null,ht)),this._taskQueue.delete(G))},W=(rt,ht)=>{if(rt)return A(rt);const st=O.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ht,task:B},X,void 0,!0);if(p!==null){const gt=this._workQueuePerLayer.get(p)||[];gt.push(()=>{st&&st.cancel(),B.cancel()}),this._workQueuePerLayer.has(p)||this._workQueuePerLayer.set(p,gt)}};let K;try{K=P.getLayer(u)}catch(rt){if(this.state==="reloading")return;throw rt}if(!K)return void A(new Error(`Unknown sourceLayer "${u}"`));if(K.hasDataForBand(b))return j.values().forEach(rt=>rt(null,null)),void this._taskQueue.delete(G);const tt=K.getDataRange([b]);if(B=P.createDecodingTask(tt),!B||B.tasks.length)if(p!==null&&this.flushQueues(p),this.entireBuffer)W(null,this.entireBuffer.slice(tt.firstByte,tt.lastByte+1));else{const rt=Object.assign({},this.requestParams,{headers:{Range:`bytes=${tt.firstByte}-${tt.lastByte}`}}),ht=a.bt(rt,W);if(p!==null){const st=this._fetchQueuePerLayer.get(p)||[];st.push(()=>{ht.cancel(),B.cancel()}),this._fetchQueuePerLayer.has(p)||this._fetchQueuePerLayer.set(p,st)}}}updateNeeded(u,p){return(!this.textureDescriptorPerLayer.get(u)||this.textureDescriptorPerLayer.get(u).band!==p||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(u,p,b){if(!this._mrt)return;const A=this._mrt.getLayer(u);if(!A||!A.hasBand(b)||!A.hasDataForBand(b))return;const{bytes:M,tileSize:P,buffer:O,offset:B,scale:G}=A.getBandView(b),j=P+2*O,X=new a.q({width:j,height:j},M),W=this.texturePerLayer.get(p);W&&W instanceof a.T&&W.update(X,{premultiply:!1}),this.textureDescriptorPerLayer.set(p,{layer:u,band:b,img:X,buffer:O,offset:B,tileSize:P,format:A.pixelFormat,mix:[G,256*G,65536*G,16777216*G]})}destroy(u=!1){if(super.destroy(u),delete this._mrt,!u)for(const p of this.texturePerLayer.values())p&&p instanceof a.T&&p.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ex{constructor(u,p){this.max=u,this.onRemove=p,this.reset()}reset(){for(const u in this.data)for(const p of this.data[u])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(u,p,b){const A=u.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const M={value:p,timeout:void 0};if(b!==void 0&&(M.timeout=setTimeout(()=>{this.remove(u,M)},b)),this.data[A].push(M),this.order.push(A),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const p=this.data[u].shift();return p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),p.value}getByKey(u){const p=this.data[u];return p?p[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,p){if(!this.has(u))return this;const b=u.wrapped().key,A=p===void 0?0:this.data[b].indexOf(p),M=this.data[b][A];return this.data[b].splice(A,1),M.timeout&&clearTimeout(M.timeout),this.data[b].length===0&&delete this.data[b],this.onRemove(M.value),this.order.splice(this.order.indexOf(b),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(u){const p=[];for(const b in this.data)for(const A of this.data[b])u(A.value)||p.push(A);for(const b of p)this.remove(b.value.tileID,b)}}class tT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,p,b){const A=String(p);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][A]=this.stateChanges[u][A]||{},Object.assign(this.stateChanges[u][A],b),this.deletedStates[u]===null){this.deletedStates[u]={};for(const M in this.state[u])M!==A&&(this.deletedStates[u][M]=null)}else if(this.deletedStates[u]&&this.deletedStates[u][A]===null){this.deletedStates[u][A]={};for(const M in this.state[u][A])b[M]||(this.deletedStates[u][A][M]=null)}else for(const M in b)this.deletedStates[u]&&this.deletedStates[u][A]&&this.deletedStates[u][A][M]===null&&delete this.deletedStates[u][A][M]}removeFeatureState(u,p,b){if(this.deletedStates[u]===null)return;const A=String(p);if(this.deletedStates[u]=this.deletedStates[u]||{},b&&p!==void 0)this.deletedStates[u][A]!==null&&(this.deletedStates[u][A]=this.deletedStates[u][A]||{},this.deletedStates[u][A][b]=null);else if(p!==void 0)if(this.stateChanges[u]&&this.stateChanges[u][A])for(b in this.deletedStates[u][A]={},this.stateChanges[u][A])this.deletedStates[u][A][b]=null;else this.deletedStates[u][A]=null;else this.deletedStates[u]=null}getState(u,p){const b=this.state[u]||{},A=this.stateChanges[u]||{},M=this.deletedStates[u];if(M===null)return{};if(p!==void 0){const O=String(p),B=Object.assign({},b[O],A[O]);if(M){const G=M[p];if(G===null)return{};for(const j in G)delete B[j]}return B}const P=Object.assign({},b,A);if(M)for(const O in M)delete P[O];return P}initializeTileState(u,p){u.refreshFeatureState(p)}coalesceChanges(u,p){const b={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const M={};for(const P in this.stateChanges[A])this.state[A][P]||(this.state[A][P]={}),Object.assign(this.state[A][P],this.stateChanges[A][P]),M[P]=this.state[A][P];b[A]=M}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const M={};if(this.deletedStates[A]===null)for(const P in this.state[A])M[P]={},this.state[A][P]={};else for(const P in this.deletedStates[A]){if(this.deletedStates[A][P]===null)this.state[A][P]={};else if(this.state[A][P])for(const O of Object.keys(this.deletedStates[A][P]))delete this.state[A][P][O];M[P]=this.state[A][P]}b[A]=b[A]||{},Object.assign(b[A],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(b).length!==0)for(const A in u)u[A].refreshFeatureState(p)}}class _l extends a.E{constructor(u,p,b){super(),this.id=u,this._onlySymbols=b,p.on("data",A=>{A.dataType==="source"&&A.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),p.on("error",()=>{this._sourceErrored=!0}),this._source=p,this._tiles={},this._cache=new ex(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new tT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(u){this.map=u,this._minTileCacheSize=this._minTileCacheSize===void 0&&u?u._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&u?u._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const u in this._tiles)if(!this._tiles[u].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(u,p){return u.isSymbolTile=this._onlySymbols,u.isExtraShadowCaster=this._shadowCasterTiles[u.tileID.key],this._source.loadTile(u,p)}_unloadTile(u){if(this._source.unloadTile)return this._source.unloadTile(u)}_abortTile(u){if(this._source.abortTile)return this._source.abortTile(u)}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const b=this._tiles[p];b.upload(u,this.map?this.map.painter:void 0),b.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(u=>u.tileID).sort(ix).map(u=>u.key)}getRenderableIds(u,p){const b=[];for(const A in this._tiles)this._isIdRenderable(+A,u,p)&&b.push(this._tiles[A]);return u?b.sort((A,M)=>{const P=A.tileID,O=M.tileID,B=new a.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle),G=new a.P(O.canonical.x,O.canonical.y)._rotate(this.transform.angle);return P.overscaledZ-O.overscaledZ||G.y-B.y||G.x-B.x}).map(A=>A.tileID.key):b.map(A=>A.tileID).sort(ix).map(A=>A.key)}hasRenderableParent(u){const p=this.findLoadedParent(u,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(u,p,b){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(p||!this._tiles[u].holdingForFade())&&(b||!this._shadowCasterTiles[u])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(+u,"reloading")}}_reloadTile(u,p){const b=this._tiles[u];b&&(b.state!=="loading"&&(b.state=p),this._loadTile(b,this._tileLoaded.bind(this,b,u,p)))}_tileLoaded(u,p,b,A,M){if(A){if(u.state="errored",A.status!==404)this._source.fire(new a.y(A,{tile:u}));else{if(this._source.fire(new a.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:u})),!(u.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const O=this.map.painter.terrain;this.update(this.transform,O.getScaledDemTileSize(),!0),O.resetTileLookupCache(this.id)}else this.update(this.transform)}return}u.timeAdded=a.o.now(),b==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(p,u),this._source.type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null);let P=new Map;M&&M.responseHeaders&&(P=M.responseHeaders),this._source.fire(new a.z("data",{dataType:"source",tile:u,coord:u.tileID,sourceCacheId:this.id,responseHeaders:P}))}_backfillDEM(u){const p=this.getRenderableIds();for(let A=0;A<p.length;A++){const M=p[A];if(u.neighboringTiles&&u.neighboringTiles[M]){const P=this.getTileByID(M);b(u,P),b(P,u)}}function b(A,M){if(!A.dem||A.dem.borderReady)return;A.needsHillshadePrepare=!0,A.needsDEMTextureUpload=!0;let P=M.tileID.canonical.x-A.tileID.canonical.x;const O=M.tileID.canonical.y-A.tileID.canonical.y,B=Math.pow(2,A.tileID.canonical.z),G=M.tileID.key;P===0&&O===0||Math.abs(O)>1||(Math.abs(P)>1&&(Math.abs(P+B)===1?P+=B:Math.abs(P-B)===1&&(P-=B)),M.dem&&A.dem&&(A.dem.backfillBorder(M.dem,P,O),A.neighboringTiles&&A.neighboringTiles[G]&&(A.neighboringTiles[G].backfilled=!0)))}}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._tiles[u]}_retainLoadedChildren(u,p,b,A){for(const M in this._tiles){let P=this._tiles[M];if(A[M]||!P.hasData()||P.tileID.overscaledZ<=p||P.tileID.overscaledZ>b)continue;let O=P.tileID;for(;P&&P.tileID.overscaledZ>p+1;){const G=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[G.key],P&&P.hasData()&&(O=G)}let B=O;for(;B.overscaledZ>p;)if(B=B.scaledTo(B.overscaledZ-1),u[B.key]){A[O.key]=O;break}}}findLoadedParent(u,p){if(u.key in this._loadedParentTiles){const b=this._loadedParentTiles[u.key];return b&&b.tileID.overscaledZ>=p?b:null}for(let b=u.overscaledZ-1;b>=p;b--){const A=u.scaledTo(b),M=this._getLoadedTile(A);if(M)return M}}_getLoadedTile(u){const p=this._tiles[u.key];return p&&p.hasData()?p:this._cache.getByKey(this._source.reparseOverscaled?u.wrapped().key:u.canonical.key)}updateCacheSize(u,p){p=p||this._source.tileSize;const b=Math.ceil(u.width/p)+1,A=Math.ceil(u.height/p)+1,M=Math.floor(b*A*5),P=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,M):M,O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(O)}handleWrapJump(u){const p=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,p){const b={};for(const A in this._tiles){const M=this._tiles[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+p),b[M.tileID.key]=M}this._tiles=b;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(+A,this._tiles[A])}}update(u,p,b,A,M){if(this.transform=u,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!b)return;this.updateCacheSize(u,p),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const P=this._source.type==="batched-model";let O,B=this._source.maxzoom;const G=this.map&&this.map.painter?this.map.painter._terrain:null;if(G&&G.sourceCache===this&&G.attenuationRange()){const W=G.attenuationRange()[0],K=Math.floor(W)-Math.log2(G.getDemUpscale());B>K&&(B=K)}if(this.used||this.usedForTerrain){if(this._source.tileID)O=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(W=>new a.aP(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y));else if(this.tileCoverLift!==0){const W=u.clone();W.tileCoverLift=this.tileCoverLift,O=W.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!b,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:P}),this._source.minzoom<=1&&u.projection.name==="globe"&&(O.push(new a.aP(1,0,1,0,0)),O.push(new a.aP(1,0,1,1,0)),O.push(new a.aP(1,0,1,0,1)),O.push(new a.aP(1,0,1,1,1)))}else if(O=u.coveringTiles({tileSize:p||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!b,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:P}),this._source.hasTile){const W=this._source.hasTile.bind(this._source);O=O.filter(K=>W(K))}}else O=[];if(O.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Dh(this._source.type)){const W=u.coveringZoomLevel({tileSize:p||this._source.tileSize,roundZoom:this._source.roundZoom&&!b}),K=Math.min(W,this._source.maxzoom);if(P){const tt=u.extendTileCover(O,K);for(const rt of tt)O.push(rt)}else if(M){const tt=u.extendTileCoverToNearPlane(O,this.transform.getFrustum(K),K);for(const rt of tt)O.push(rt)}else if(this.castsShadows&&A){const tt=u.extendTileCover(O,K,A);for(const rt of tt)this._shadowCasterTiles[rt.key]=!0,O.push(rt)}}const j=this._updateRetainedTiles(O);if(Dh(this._source.type)&&O.length!==0){const W={},K={},tt=Object.keys(j);for(const ht of tt){const st=j[ht],gt=this._tiles[ht];if(!gt||gt.fadeEndTime&&gt.fadeEndTime<=a.o.now())continue;const xt=this.findLoadedParent(st,Math.max(st.overscaledZ-_l.maxOverzooming,this._source.minzoom));xt&&(this._addTile(xt.tileID),W[xt.tileID.key]=xt.tileID),K[ht]=st}const rt=O[O.length-1].overscaledZ;for(const ht in this._tiles){const st=this._tiles[ht];if(j[ht]||!st.hasData())continue;let gt=st.tileID;for(;gt.overscaledZ>rt;){gt=gt.scaledTo(gt.overscaledZ-1);const xt=this._tiles[gt.key];if(xt&&xt.hasData()&&K[gt.key]){j[ht]=st.tileID;break}}}for(const ht in W)j[ht]||(this._coveredTiles[ht]=!0,j[ht]=W[ht])}for(const W in j)this._tiles[W].clearFadeHold();const X=a.bu(this._tiles,j);for(const W of X){const K=this._tiles[W];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(+W)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(+u)}_updateRetainedTiles(u){const p={};if(u.length===0)return p;const b={},A=u.reduce((G,j)=>Math.min(G,j.overscaledZ),1/0),M=u[0].overscaledZ,P=Math.max(M-_l.maxOverzooming,this._source.minzoom),O=Math.max(M+_l.maxUnderzooming,this._source.minzoom),B={};for(const G of u){const j=this._addTile(G);p[G.key]=G,j.hasData()||A<this._source.maxzoom&&(B[G.key]=G)}this._retainLoadedChildren(B,A,O,p);for(const G of u){let j=this._tiles[G.key];if(j.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const W=G.children(this._source.maxzoom)[0],K=this.getTile(W);if(K&&K.hasData()){p[W.key]=W;continue}}else{const W=G.children(this._source.maxzoom);if(p[W[0].key]&&p[W[1].key]&&p[W[2].key]&&p[W[3].key])continue}let X=j.wasRequested();for(let W=G.overscaledZ-1;W>=P;--W){const K=G.scaledTo(W);if(b[K.key]||(b[K.key]=!0,j=this.getTile(K),!j&&X&&(j=this._addTile(K)),j&&(p[K.key]=K,X=j.wasRequested(),j.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const u in this._tiles){const p=[];let b,A=this._tiles[u].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){b=this._loadedParentTiles[A.key];break}p.push(A.key);const M=A.scaledTo(A.overscaledZ-1);if(b=this._getLoadedTile(M),b)break;A=M}for(const M of p)this._loadedParentTiles[M]=b}}_addTile(u){let p=this._tiles[u.key];if(p)return p.isExtraShadowCaster!==!0||this._shadowCasterTiles[u.key]||this._reloadTile(u.key,"reloading"),p;p=this._cache.getAndRemove(u),p&&(this._setTileReloadTimer(u.key,p),p.tileID=u,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,p)));const b=!!p;if(!b){const A=this.map?this.map.painter:null,M=this._source.tileSize*u.overscaleFactor();p=this._source.type==="raster-array"?new Ac(u,M,this.transform.tileZoom,A,this._isRaster):new su(u,M,this.transform.tileZoom,A,this._isRaster,this._source.worldview),this._loadTile(p,this._tileLoaded.bind(this,p,u.key,p.state))}return p.uses++,this._tiles[u.key]=p,b||this._source.fire(new a.z("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(u,p){u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);const b=p.getExpiryTimeout();b&&(this._timers[u]=setTimeout(()=>{this._reloadTile(u,"expired"),delete this._timers[u]},b))}_removeTile(u){const p=this._tiles[u];p&&(p.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),p.uses>0||(p.hasData()&&p.state!=="reloading"||p.state==="empty"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u in this._tiles)this._removeTile(+u);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(u,p,b){const A=[],M=this.transform;if(!M)return A;const P=M.projection.name==="globe",O=a.aF(M.center.lng);for(const B in this._tiles){const G=this._tiles[B];if(b&&G.clearQueryDebugViz(),G.holdingForFade())continue;let j;if(P){const X=G.tileID.canonical;if(X.z===0){const W=[Math.abs(a.aA(O,...Ph(X,-1))-O),Math.abs(a.aA(O,...Ph(X,1))-O)];j=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(a.aA(O,...Ph(X,-1))-O),Math.abs(a.aA(O,...Ph(X,0))-O),Math.abs(a.aA(O,...Ph(X,1))-O)];j=[W.indexOf(Math.min(...W))-1]}}else j=[0];for(const X of j){const W=u.containsTile(G,M,p,X);W&&A.push(W)}}return A}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(u){return this._getRenderableCoordinates(u)}_getRenderableCoordinates(u,p){const b=this.getRenderableIds(u,p).map(M=>this._tiles[M].tileID),A=this.transform.projection.name==="globe";for(const M of b)M.projMatrix=this.transform.calculateProjMatrix(M.toUnwrapped()),M.expandedProjMatrix=A?this.transform.calculateProjMatrix(M.toUnwrapped(),!1,!0):M.projMatrix;return b}sortCoordinatesByDistance(u){const p=u.slice(),b=this.transform._camera.position,A=this.transform._camera.forward(),M={};for(const P of p){const O=1/(1<<P.canonical.z);M[P.key]=((P.canonical.x+.5)*O+P.wrap-b[0])*A[0]+((P.canonical.y+.5)*O-b[1])*A[1]-b[2]*A[2]}return p.sort((P,O)=>M[P.key]-M[O.key]),p}hasTransition(){if(this._source.hasTransition())return!0;if(Dh(this._source.type))for(const u in this._tiles){const p=this._tiles[u];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=a.o.now())return!0}return!1}setFeatureState(u,p,b){this._state.updateState(u=u||"_geojsonTileLayer",p,b)}removeFeatureState(u,p,b){this._state.removeFeatureState(u=u||"_geojsonTileLayer",p,b)}getFeatureState(u,p){return this._state.getState(u=u||"_geojsonTileLayer",p)}setDependencies(u,p,b){const A=this._tiles[u];A&&A.setDependencies(p,b)}reloadTilesForDependencies(u,p){for(const b in this._tiles)this._tiles[b].hasDependency(u,p)&&this._reloadTile(+b,"reloading");this._cache.filter(b=>!b.hasDependency(u,p))}_preloadTiles(u,p){if(!this._sourceLoaded){const B=()=>{this._sourceLoaded&&(this._source.off("data",B),this._preloadTiles(u,p))};return void this._source.on("data",B)}const b=new Map,A=Array.isArray(u)?u:[u],M=this.map.painter.terrain,P=this.usedForTerrain&&M?M.getScaledDemTileSize():this._source.tileSize;for(const B of A){const G=B.coveringTiles({tileSize:P,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of G)b.set(j.key,j);this.usedForTerrain&&B.updateElevation(!1)}const O=Array.from(b.values());a.bv(O,(B,G)=>{const j=new su(B,this._source.tileSize*B.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(j,X=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),G(X,j)})},p)}}function ix(x,u){const p=Math.abs(2*x.wrap)-+(x.wrap<0),b=Math.abs(2*u.wrap)-+(u.wrap<0);return x.overscaledZ-u.overscaledZ||b-p||u.canonical.y-x.canonical.y||u.canonical.x-x.canonical.x}function Dh(x){return x==="raster"||x==="image"||x==="video"||x==="custom"}function Ph(x,u){const p=1<<x.z;return[x.x/p+u,(x.x+1)/p+u]}_l.maxOverzooming=10,_l.maxUnderzooming=3;class rx{constructor(u){this.style=u,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const u=!1,p=!1;for(const b in this.style._mergedLayers){const A=this.style._mergedLayers[b];if(A.type==="fill-extrusion"||A.type==="building")this.layers.push({layer:A,visible:u,visibilityChanged:p});else if(A.type==="model"){const M=this.style.getLayerSource(A);M&&M.type==="batched-model"&&this.layers.push({layer:A,visible:u,visibilityChanged:p})}}}onNewFrame(u){this.layersGotHidden=!1;for(const p of this.layers){const b=p.layer;let A=!1;b.type==="fill-extrusion"?A=!b.isHidden(u)&&b.paint.get("fill-extrusion-opacity")>0:b.type==="building"?A=!b.isHidden(u)&&b.paint.get("building-opacity")>0:b.type==="model"&&(A=!b.isHidden(u)&&b.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!A&&p.visible,p.visible=A}}updateZOffset(u,p){this.currentBuildingBuckets=[];for(const A of this.layers){const M=A.layer,P=this.style.getLayerSourceCache(M);let O=1;M.type==="fill-extrusion"?O=A.visible?M.paint.get("fill-extrusion-vertical-scale"):0:M.type==="building"&&(O=A.visible?M.paint.get("building-vertical-scale"):0);let B=P?P.getTile(p):null;if(!B&&P)for(const G in P._tiles){const j=P._tiles[G];if(p.canonical.isChildOf(j.tileID.canonical)){B=j;break}}this.currentBuildingBuckets.push({bucket:B?B.getBucket(M):null,tileID:B?B.tileID:p,verticalScale:O})}u.hasAnyZOffset=!1;let b=!1;for(let A=0;A<u.symbolInstances.length;A++){const M=u.symbolInstances.get(A),P=M.zOffset,O=this._getHeightAtTileOffset(p,M.tileAnchorX,M.tileAnchorY);M.zOffset=O!==Number.NEGATIVE_INFINITY?O:P,b||P===M.zOffset||(b=!0),u.hasAnyZOffset||M.zOffset===0||(u.hasAnyZOffset=!0)}b&&(u.zOffsetBuffersNeedUpload=!0,u.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(u,p,b,A){let M=p,P=b;if(u.canonical.z!==A.canonical.z){const O=A.canonical,B=1/(1<<u.canonical.z-O.z);M=(p+u.canonical.x*a.al)*B-O.x*a.al|0,P=(b+u.canonical.y*a.al)*B-O.y*a.al|0}return{tileX:M,tileY:P}}_getHeightAtTileOffset(u,p,b){let A,M;for(let P=0;P<this.layers.length;++P){const O=this.layers[P].layer;if(O.type!=="fill-extrusion"&&O.type!=="building")continue;const{bucket:B,tileID:G,verticalScale:j}=this.currentBuildingBuckets[P];if(!B)continue;const{tileX:X,tileY:W}=this._mapCoordToOverlappingTile(u,p,b,G),K=B.getHeightAtTileCoord(X,W);K&&K.height!==void 0&&(K.hidden?A=K.height:M=Math.max(K.height*j,M||0))}if(M!==void 0)return M;for(let P=0;P<this.layers.length;++P){const O=this.layers[P];if(O.layer.type!=="model"||!O.visible)continue;const{bucket:B,tileID:G}=this.currentBuildingBuckets[P];if(!B)continue;const{tileX:j,tileY:X}=this._mapCoordToOverlappingTile(u,p,b,G),W=B.getHeightAtTileCoord(j,X);if(W&&!W.hidden)return W.height===void 0&&A!==void 0?Math.min(W.maxHeight,A)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function eg(x,u){const p={};for(const b in x)b!=="ref"&&(p[b]=x[b]);return a.bw.forEach(b=>{b in u&&(p[b]=u[b])}),p}function qd(x){x=x.slice();const u=Object.create(null);for(let p=0;p<x.length;p++)u[x[p].id]=x[p];for(let p=0;p<x.length;p++)"ref"in x[p]&&(x[p]=eg(x[p],u[x[p].ref]));return x}const Ur={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function nx(x,u,p){p.push({command:Ur.addSource,args:[x,u[x]]})}function ig(x,u,p){u.push({command:Ur.removeSource,args:[x]}),p[x]=!0}function rg(x,u,p,b){ig(x,p,b),nx(x,u,p)}function ax(x,u,p){let b;for(b in x[p])if(x[p].hasOwnProperty(b)&&b!=="data"&&!a.bx(x[p][b],u[p][b]))return!1;for(b in u[p])if(u[p].hasOwnProperty(b)&&b!=="data"&&!a.bx(x[p][b],u[p][b]))return!1;return!0}function ng(x,u,p,b,A,M){let P;for(P in u=u||{},x=x||{})x.hasOwnProperty(P)&&(a.bx(x[P],u[P])||p.push({command:M,args:[b,P,u[P],A]}));for(P in u)u.hasOwnProperty(P)&&!x.hasOwnProperty(P)&&(a.bx(x[P],u[P])||p.push({command:M,args:[b,P,u[P],A]}))}function ag(x){return x.id}function og(x,u){return x[u.id]=u,x}function Lh(x,u,p){const b=u.createTileMatrix(x,x.worldSize,p.toUnwrapped());return a.aB(new Float32Array(16),x.projMatrix,b)}function eT(x,u,p){if(u.projection.name===p.projection.name)return x.projMatrix;const b=p.clone();return b.setProjection(u.projection),Lh(b,u.getProjection(),x)}function Hv(x,u,p){return u.name===p.projection.name?x.projMatrix:Lh(p,u,x)}class BE{constructor(u,p){this.reset(u,p)}reset(u,p){this.points=u||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=a.aA(u,0,1);let p=1,b=this._distances[p];const A=u*this.paddedLength+this.padding;for(;b<A&&p<this._distances.length;)b=this._distances[++p];const M=p-1,P=this._distances[M],O=b-P,B=O>0?(A-P)/O:0;return this.points[M].mult(1-B).add(this.points[p].mult(B))}}class sg{constructor(u,p,b){const A=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(u/b),this.yCellCount=Math.ceil(p/b);for(let P=0;P<this.xCellCount*this.yCellCount;P++)A.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=p,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,p,b,A,M){this._forEachCell(p,b,A,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(p),this.bboxes.push(b),this.bboxes.push(A),this.bboxes.push(M)}insertCircle(u,p,b,A){this._forEachCell(p-A,b-A,p+A,b+A,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(p),this.circles.push(b),this.circles.push(A)}_insertBoxCell(u,p,b,A,M,P){this.boxCells[M].push(P)}_insertCircleCell(u,p,b,A,M,P){this.circleCells[M].push(P)}_query(u,p,b,A,M,P){if(b<0||u>this.width||A<0||p>this.height)return!M&&[];const O=[];if(u<=0&&p<=0&&this.width<=b&&this.height<=A){if(M)return!0;for(let B=0;B<this.boxKeys.length;B++)O.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const G=this.circles[3*B],j=this.circles[3*B+1],X=this.circles[3*B+2];O.push({key:this.circleKeys[B],x1:G-X,y1:j-X,x2:G+X,y2:j+X})}return P?O.filter(P):O}return this._forEachCell(u,p,b,A,this._queryCell,O,{hitTest:M,seenUids:{box:{},circle:{}}},P),M?O.length>0:O}_queryCircle(u,p,b,A,M){const P=u-b,O=u+b,B=p-b,G=p+b;if(O<0||P>this.width||G<0||B>this.height)return!A&&[];const j=[];return this._forEachCell(P,B,O,G,this._queryCellCircle,j,{hitTest:A,circle:{x:u,y:p,radius:b},seenUids:{box:{},circle:{}}},M),A?j.length>0:j}query(u,p,b,A,M){return this._query(u,p,b,A,!1,M)}hitTest(u,p,b,A,M){return this._query(u,p,b,A,!0,M)}hitTestCircle(u,p,b,A){return this._queryCircle(u,p,b,!0,A)}_queryCell(u,p,b,A,M,P,O,B){const G=O.seenUids,j=this.boxCells[M];if(j!==null){const W=this.bboxes;for(const K of j)if(!G.box[K]){G.box[K]=!0;const tt=4*K;if(u<=W[tt+2]&&p<=W[tt+3]&&b>=W[tt+0]&&A>=W[tt+1]&&(!B||B(this.boxKeys[K]))){if(O.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[K],x1:W[tt],y1:W[tt+1],x2:W[tt+2],y2:W[tt+3]})}}}const X=this.circleCells[M];if(X!==null){const W=this.circles;for(const K of X)if(!G.circle[K]){G.circle[K]=!0;const tt=3*K;if(this._circleAndRectCollide(W[tt],W[tt+1],W[tt+2],u,p,b,A)&&(!B||B(this.circleKeys[K]))){if(O.hitTest)return P.push(!0),!0;{const rt=W[tt],ht=W[tt+1],st=W[tt+2];P.push({key:this.circleKeys[K],x1:rt-st,y1:ht-st,x2:rt+st,y2:ht+st})}}}}}_queryCellCircle(u,p,b,A,M,P,O,B){const G=O.circle,j=O.seenUids,X=this.boxCells[M];if(X!==null){const K=this.bboxes;for(const tt of X)if(!j.box[tt]){j.box[tt]=!0;const rt=4*tt;if(this._circleAndRectCollide(G.x,G.y,G.radius,K[rt+0],K[rt+1],K[rt+2],K[rt+3])&&(!B||B(this.boxKeys[tt])))return P.push(!0),!0}}const W=this.circleCells[M];if(W!==null){const K=this.circles;for(const tt of W)if(!j.circle[tt]){j.circle[tt]=!0;const rt=3*tt;if(this._circlesCollide(K[rt],K[rt+1],K[rt+2],G.x,G.y,G.radius)&&(!B||B(this.circleKeys[tt])))return P.push(!0),!0}}}_forEachCell(u,p,b,A,M,P,O,B){const G=this._convertToXCellCoord(u),j=this._convertToYCellCoord(p),X=this._convertToXCellCoord(b),W=this._convertToYCellCoord(A);for(let K=G;K<=X;K++)for(let tt=j;tt<=W;tt++)if(M.call(this,u,p,b,A,this.xCellCount*tt+K,P,O,B))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,p,b,A,M,P){const O=A-u,B=M-p,G=b+P;return G*G>O*O+B*B}_circleAndRectCollide(u,p,b,A,M,P,O){const B=(P-A)/2,G=Math.abs(u-(A+B));if(G>B+b)return!1;const j=(O-M)/2,X=Math.abs(p-(M+j));if(X>j+b)return!1;if(G<=B||X<=j)return!0;const W=G-B,K=X-j;return W*W+K*K<=b*b}}const js={unknown:0,flipRequired:1,flipNotRequired:2},lg=Math.tan(85*Math.PI/180);function Xd(x,u,p,b,A,M,P){const O=a.bB();if(p)if(M.name==="globe"){const B=a.bC(A,u);a.aB(O,O,B)}else{const B=a.bD([],P);O[0]=B[0],O[1]=B[1],O[4]=B[2],O[5]=B[3],b||a.bA(O,O,A.angle)}else a.aB(O,A.labelPlaneMatrix,x);return O}function ug(x,u,p,b,A,M,P){const O=Xd(x,u,p,b,A,M,P);return M.name==="globe"&&p||(O[2]=O[6]=O[10]=O[14]=0),O}function Vu(x,u,p,b,A,M,P){if(p){if(M.name==="globe"){const O=Xd(x,u,p,b,A,M,P);return a.bk(O,O),a.aB(O,x,O),O}{const O=a.by(x),B=a.bz([]);return B[0]=P[0],B[1]=P[1],B[4]=P[2],B[5]=P[3],a.aB(O,O,B),b||a.bA(O,O,-A.angle),O}}return A.glCoordMatrix}function Ba(x,u,p,b){const A=[x,u,p,1];p?a.aC(A,A,b):yl(A,A,b);const M=A[3];return A[0]/=M,A[1]/=M,A[2]/=M,A}function ox(x,u){return Math.min(.5+x/u*.5,1.5)}function sx(x,u){const p=x[0]/x[3],b=x[1]/x[3];return p>=-u[0]&&p<=u[0]&&b>=-u[1]&&b<=u[1]}function lx(x,u,p,b,A,M,P,O,B,G,j=1){const X=p.transform,W=b?x.textSizeData:x.iconSizeData,K=a.bJ(W,p.transform.zoom,j),tt=X.projection.name==="globe",rt=[256/p.width*2+1,256/p.height*2+1],ht=b?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;ht.clear();let st=null;tt&&(st=b?x.text.globeExtVertexArray:x.icon.globeExtVertexArray);const gt=x.lineVertexArray,xt=b?x.text.placedSymbolArray:x.icon.placedSymbolArray,vt=p.transform.width/p.transform.height;let Pt,wt=!1;for(let Rt=0;Rt<xt.length;Rt++){const Mt=xt.get(Rt),{numGlyphs:At,writingMode:kt}=Mt;if(kt!==a.bK.vertical||wt||Pt===a.bK.horizontal||(wt=!0),Pt=kt,(Mt.hidden||kt===a.bK.vertical)&&!wt){Uu(At,ht);continue}wt=!1;const qt=new a.P(Mt.tileAnchorX,Mt.tileAnchorY),jt=x.elevationType==="road",oe=!!X.elevation||jt;let{x:te,y:fe,z:ze}=X.projection.projectTilePoint(qt.x,qt.y,G.canonical),Qt=null;if(oe){const oi=jt?x.getElevationFeatureForText(Rt):null;Qt={getElevation:B,elevation:X.elevation,elevationFeature:oi};const[Di,mr,Ir]=B(qt,X.elevation,oi);te+=Di,fe+=mr,ze+=Ir}const Gt=[te,fe,ze,1];if(a.aC(Gt,Gt,u),!sx(Gt,rt)){Uu(At,ht);continue}const pe=Gt[3],ee=ox(p.transform.getCameraToCenterDistance(X.projection),pe),Ae=a.bL(W,K,Mt),Ge=P?Ae/ee:Ae*ee,ui=Ba(te,fe,ze,A);if(ui[3]<=0){Uu(At,ht);continue}let Le={};const Fe=a.an(x.layers[0].layout.get("text-max-angle")),hi=Math.cos(Fe),ai=P?null:Qt,ii=iT(Mt,Ge,!1,O,u,A,M,x.glyphOffsetArray,gt,ht,st,ui,qt,Le,vt,ai,X.projection,G,P,hi);wt=ii.useVertical,ai&&ii.needsFlipping&&(Le={}),(ii.notEnoughRoom||wt||ii.needsFlipping&&iT(Mt,Ge,!0,O,u,A,M,x.glyphOffsetArray,gt,ht,st,ui,qt,Le,vt,ai,X.projection,G,P,hi).notEnoughRoom)&&Uu(At,ht)}b?(x.text.dynamicLayoutVertexBuffer.updateData(ht),st&&x.text.globeExtVertexBuffer&&x.text.globeExtVertexBuffer.updateData(st)):(x.icon.dynamicLayoutVertexBuffer.updateData(ht),st&&x.icon.globeExtVertexBuffer&&x.icon.globeExtVertexBuffer.updateData(st))}function Xr(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht){const{lineStartIndex:st,glyphStartIndex:gt,segment:xt}=O,vt=gt+O.numGlyphs,Pt=st+O.lineLength,wt=u.getoffsetX(gt),Rt=u.getoffsetX(vt-1),Mt=cg(x*wt,p,b,A,M,P,xt,st,Pt,B,G,j,X,W,!0,K,tt,rt,ht);if(!Mt)return null;const At=cg(x*Rt,p,b,A,M,P,xt,st,Pt,B,G,j,X,W,!0,K,tt,rt,ht);return At?{first:Mt,last:At}:null}function ux(x,u,p,b){return x===a.bK.horizontal&&Math.abs(b)>Math.abs(p)?{useVertical:!0}:x===a.bK.vertical?b>0?{needsFlipping:!0}:null:u!==js.unknown&&function(A,M){return A===0||Math.abs(M/A)>lg}(p,b)?u===js.flipRequired?{needsFlipping:!0}:null:p<0?{needsFlipping:!0}:null}function iT(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st,gt,xt){const vt=u/24,Pt=x.lineOffsetX*vt,wt=x.lineOffsetY*vt,{lineStartIndex:Rt,glyphStartIndex:Mt,numGlyphs:At,segment:kt,writingMode:qt,flipState:jt}=x,oe=Rt+x.lineLength,te=fe=>{if(j){const[pe,ee,Ae]=fe.up,Ge=G.length;a.bM(j,Ge+0,pe,ee,Ae),a.bM(j,Ge+1,pe,ee,Ae),a.bM(j,Ge+2,pe,ee,Ae),a.bM(j,Ge+3,pe,ee,Ae)}const[ze,Qt,Gt]=fe.point;a.bN(G,ze,Qt,Gt,fe.angle)};if(At>1){const fe=Xr(vt,O,Pt,wt,p,X,W,x,B,M,K,rt,!1,ht,st,gt,xt);if(!fe)return{notEnoughRoom:!0};if(b&&!p){let[ze,Qt,Gt]=fe.first.point,[pe,ee,Ae]=fe.last.point;[ze,Qt]=Ba(ze,Qt,Gt,P),[pe,ee]=Ba(pe,ee,Ae,P);const Ge=ux(qt,jt,(pe-ze)*tt,ee-Qt);if(x.flipState=Ge&&Ge.needsFlipping?js.flipRequired:js.flipNotRequired,Ge)return Ge}te(fe.first);for(let ze=Mt+1;ze<Mt+At-1;ze++){const Qt=cg(vt*O.getoffsetX(ze),Pt,wt,p,X,W,kt,Rt,oe,B,M,K,rt,!1,!1,ht,st,gt,xt);if(!Qt)return G.length-=4*(ze-Mt),{notEnoughRoom:!0};te(Qt)}te(fe.last)}else{if(b&&!p){const ze=Ba(W.x,W.y,0,A),Qt=Rt+kt+1,Gt=new a.P(B.getx(Qt),B.gety(Qt)),pe=Ba(Gt.x,Gt.y,0,A),ee=pe[3]>0?pe:zi(W,Gt,ze,1,A,void 0,ht,st.canonical),Ae=ux(qt,jt,(ee[0]-ze[0])*tt,ee[1]-ze[1]);if(x.flipState=Ae&&Ae.needsFlipping?js.flipRequired:js.flipNotRequired,Ae)return Ae}const fe=cg(vt*O.getoffsetX(Mt),Pt,wt,p,X,W,kt,Rt,oe,B,M,K,rt,!1,!1,ht,st,gt,xt);if(!fe)return{notEnoughRoom:!0};te(fe)}return{}}function rT(x,u,p,b,A){const{x:M,y:P,z:O}=b.projectTilePoint(x.x,x.y,u);if(!A)return Ba(M,P,O,p);const[B,G,j]=A.getElevation(x,A.elevation,A.elevationFeature);return Ba(M+B,P+G,O+j,p)}function zi(x,u,p,b,A,M,P,O){const B=rT(x.sub(u)._unit()._add(x),O,A,P,M);return a.av(B,p,B),a.aw(B,B),a.bG(B,p,B,b)}function cg(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st,gt){const xt=b?x-u:x+u;let vt=xt>0?1:-1,Pt=0;b&&(vt*=-1,Pt=Math.PI),vt<0&&(Pt+=Math.PI);let wt=O+P+(vt>0?0:1)|0,Rt=A,Mt=A,At=0,kt=0;const qt=Math.abs(xt),jt=[],oe=[];let te=M,fe=te,ze=a.bE([]);const Qt=()=>zi(fe,te,Mt,qt-At+1,j,W,rt,ht.canonical);for(;At+kt<=qt;){if(wt+=vt,wt<O||wt>=B)return null;if(Mt=Rt,fe=te,jt.push(Mt),K&&oe.push(fe),te=new a.P(G.getx(wt),G.gety(wt)),Rt=X[wt],!Rt){const ai=rT(te,ht.canonical,j,rt,W);Rt=ai[3]>0?X[wt]=ai:Qt()}At+=kt;const Fe=a.av([],Rt,Mt),hi=a.bF(Mt,Rt);if(p&&hi>0&&kt>0&&a.bI(ze,Fe)/(kt*hi)<gt)return null;kt=hi,ze=Fe}tt&&W&&(X[wt]&&(Rt=Qt(),kt=a.bF(Mt,Rt),ze=a.av([],Rt,Mt)),X[wt]=Rt);const Gt=(qt-At)/kt,pe=te.sub(fe)._mult(Gt)._add(fe),ee=a.bG([],Mt,ze,Gt);let Ae=[0,0,1],Ge=ze[0],ui=ze[1];if(st&&(Ae=rt.upVector(ht.canonical,pe.x,pe.y),Ae[0]!==0||Ae[1]!==0||Ae[2]!==1)){const Fe=[Ae[2],0,-Ae[0]],hi=a.bH([],Ae,Fe);a.aw(Fe,Fe),a.aw(hi,hi),Ge=a.bI(ze,Fe),ui=a.bI(ze,hi)}if(p){const Fe=a.bH([],Ae,ze);a.aw(Fe,Fe),a.bG(ee,ee,Fe,p*vt)}const Le=Pt+Math.atan2(ui,Ge);return jt.push(ee),K&&oe.push(pe),{point:ee,angle:Le,path:jt,tilePath:oe,up:Ae}}function Uu(x,u){const p=u.length,b=p+4*x;u.resize(b),u.float32.fill(-1/0,4*p,4*b)}function yl(x,u,p){const b=u[0],A=u[1];return x[0]=p[0]*b+p[4]*A+p[12],x[1]=p[1]*b+p[5]*A+p[13],x[3]=p[3]*b+p[7]*A+p[15],x}const xl=100;class Yd{constructor(u,p,b=new sg(u.width+200,u.height+200,25),A=new sg(u.width+200,u.height+200,25)){this.transform=u,this.grid=b,this.ignoredGrid=A,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+xl,this.screenBottomBoundary=u.height+xl,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.fogState=p}placeCollisionBox(u,p,b,A,M,P,O,B,G,j,X){let W=b.projectedAnchorX,K=b.projectedAnchorY,tt=b.projectedAnchorZ;const rt=b.tileAnchorX,ht=b.tileAnchorY,st=b.elevation,gt=b.tileID,xt=u.getProjection();if(st&&gt){const[oe,te,fe]=xt.upVector(gt.canonical,b.tileAnchorX,b.tileAnchorY),ze=xt.upVectorScale(gt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=oe*st*ze,K+=te*st*ze,tt+=fe*st*ze}const vt=u.projection.name==="globe",Pt=u.projection.name==="globe"?a.aj(this.transform.zoom):0;if(gt&&vt&&Pt<1&&!P){const oe=1<<gt.canonical.z,te=a.bO(rt,ht);a.bP(te,te,1/a.al),a.bQ(te,te,a.bO(gt.canonical.x,gt.canonical.y)),a.bP(te,te,1/oe),a.bR(te,te,a.bO(A[0],A[1])),te[0]=a.bS(te[0],-.5,.5),a.bP(te,te,a.al);const fe=a.bT(te[0],te[1],a.al/(2*Math.PI),1);a.aC(fe,fe,M),W=a.ak(W,fe[0],Pt),K=a.ak(K,fe[1],Pt),tt=a.ak(tt,fe[2],Pt)}const wt=this.projectAndGetPerspectiveRatio(j,W,K,tt,b.tileID,xt.name==="globe"||!!st||this.transform.pitch>0,xt),Rt=G*wt.perspectiveRatio,Mt=(b.x1*p+O.x-b.padding)*Rt+wt.point.x,At=(b.y1*p+O.y-b.padding)*Rt+wt.point.y,kt=(b.x2*p+O.x+b.padding)*Rt+wt.point.x,qt=(b.y2*p+O.y+b.padding)*Rt+wt.point.y,jt=wt.perspectiveRatio<=.55||wt.occluded;return!this.isInsideGrid(Mt,At,kt,qt)||!B&&this.grid.hitTest(Mt,At,kt,qt,X)||jt?{box:[],offscreen:!1,occluded:wt.occluded}:{box:[Mt,At,kt,qt],offscreen:this.isOffscreen(Mt,At,kt,qt),occluded:!1}}placeCollisionCircles(u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht){const st=[],gt=this.transform.elevation,xt=u.getProjection(),vt=u.elevationType==="road",Pt=!!gt||vt,wt=a.bU.getAtTileOffsetFunc(ht,this.transform.center.lat,this.transform.worldSize,xt),Rt=new a.P(b.tileAnchorX,b.tileAnchorY),Mt=new a.P(b.tileAnchorX,b.tileAnchorY);let{x:At,y:kt,z:qt}=xt.projectTilePoint(Mt.x,Mt.y,ht.canonical),jt=null;if(Pt){const hi=vt?u.getElevationFeatureForText(A):null;jt={getElevation:wt,elevation:gt,elevationFeature:hi};const[ai,ii,oi]=wt(Rt,gt,hi);At+=ai,kt+=ii,qt+=oi}const oe=xt.name==="globe",te=this.projectAndGetPerspectiveRatio(B,At,kt,qt,ht,oe||!!gt||this.transform.pitch>0,xt),{perspectiveRatio:fe}=te,ze=(W?O/fe:O*fe)/a.bX,Qt=Ba(At,kt,qt,G),Gt=b.lineOffsetX*ze,pe=b.lineOffsetY*ze,ee=a.an(u.layers[0].layout.get("text-max-angle")),Ae=Math.cos(ee),Ge=te.signedDistanceFromCamera>0?Xr(ze,P,Gt,pe,vt&&b.flipState===1,Qt,Mt,b,M,G,{},Pt&&!W?jt:null,W&&Pt,xt,ht,W,Ae):null;let ui=!1,Le=!1,Fe=!0;if(Ge&&!te.occluded){const hi=.5*tt*fe+rt,ai=new a.P(-100,-100),ii=new a.P(this.screenRightBoundary,this.screenBottomBoundary),oi=new BE,{first:Di,last:mr}=Ge,Ir=Di.path.length;let an=[];for(let ir=Ir-1;ir>=1;ir--)an.push(Di.path[ir]);for(let ir=1;ir<mr.path.length;ir++)an.push(mr.path[ir]);const Vi=2.5*hi;j&&(an=an.map(([ir,Qr,Cr],pn)=>(Pt&&!oe&&(Cr=wt(pn<Ir-1?Di.tilePath[Ir-1-pn]:mr.tilePath[pn-Ir+2],gt,jt.elevationFeature)[2]),Ba(ir,Qr,Cr,j))),an.some(ir=>ir[3]<=0)&&(an=[]));let Tr=[];if(an.length>0){let ir=1/0,Qr=-1/0,Cr=1/0,pn=-1/0;for(const Or of an)ir=Math.min(ir,Or[0]),Cr=Math.min(Cr,Or[1]),Qr=Math.max(Qr,Or[0]),pn=Math.max(pn,Or[1]);Qr>=ai.x&&ir<=ii.x&&pn>=ai.y&&Cr<=ii.y&&(Tr=[an.map(Or=>new a.P(Or[0],Or[1]))],(ir<ai.x||Qr>ii.x||Cr<ai.y||pn>ii.y)&&(Tr=a.bV(Tr,ai.x,ai.y,ii.x,ii.y)))}for(const ir of Tr){oi.reset(ir,.25*hi);let Qr=0;Qr=oi.length<=.5*hi?1:Math.ceil(oi.paddedLength/Vi)+1;for(let Cr=0;Cr<Qr;Cr++){const pn=Cr/Math.max(Qr-1,1),Or=oi.lerp(pn),ar=Or.x+xl,Gr=Or.y+xl;st.push(ar,Gr,hi,0);const ur=ar-hi,wn=Gr-hi,Zr=ar+hi,Hi=Gr+hi;if(Fe=Fe&&this.isOffscreen(ur,wn,Zr,Hi),Le=Le||this.isInsideGrid(ur,wn,Zr,Hi),!p&&this.grid.hitTestCircle(ar,Gr,hi,K)&&(ui=!0,!X))return{circles:[],offscreen:!1,collisionDetected:ui,occluded:!1}}}}return{circles:!X&&ui||!Le?[]:st,offscreen:Fe,collisionDetected:ui,occluded:te.occluded}}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let b=1/0,A=1/0,M=-1/0,P=-1/0;for(const j of u){const X=new a.P(j.x+xl,j.y+xl);b=Math.min(b,X.x),A=Math.min(A,X.y),M=Math.max(M,X.x),P=Math.max(P,X.y),p.push(X)}const O=this.grid.query(b,A,M,P).concat(this.ignoredGrid.query(b,A,M,P)),B={},G={};for(const j of O){const X=j.key;if(B[X.bucketInstanceId]===void 0&&(B[X.bucketInstanceId]={}),B[X.bucketInstanceId][X.featureIndex])continue;const W=[new a.P(j.x1,j.y1),new a.P(j.x2,j.y1),new a.P(j.x2,j.y2),new a.P(j.x1,j.y2)];a.bW(p,W)&&(B[X.bucketInstanceId][X.featureIndex]=!0,G[X.bucketInstanceId]===void 0&&(G[X.bucketInstanceId]=[]),G[X.bucketInstanceId].push(X.featureIndex))}return G}insertCollisionBox(u,p,b,A,M){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:A,collisionGroupID:M},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,p,b,A,M){const P=p?this.ignoredGrid:this.grid,O={bucketInstanceId:b,featureIndex:A,collisionGroupID:M};for(let B=0;B<u.length;B+=4)P.insertCircle(O,u[B],u[B+1],u[B+2])}projectAndGetPerspectiveRatio(u,p,b,A,M,P,O){const B=[p,b,A,1];let G=!1;A||this.transform.pitch>0?(a.aC(B,B,u),this.fogState&&M&&O.name!=="globe"&&(G=function(W,K,tt,rt,ht,st){const gt=st.calculateFogTileMatrix(ht),xt=[K,tt,rt];return a.af(xt,xt,gt),Oe(W,a.ag(xt),st.pitch,st._fov)}(this.fogState,p,b,A,M.toUnwrapped(),this.transform)>.9)):yl(B,B,u);const j=B[3];return{point:new a.P((B[0]/j+1)/2*this.transform.width+xl,(-B[1]/j+1)/2*this.transform.height+xl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(O)/j*.5,1.5),signedDistanceFromCamera:j,occluded:P&&B[2]>j||G}}isOffscreen(u,p,b,A){return b<xl||u>=this.screenRightBoundary||A<xl||p>this.screenBottomBoundary}isInsideGrid(u,p,b,A){return b>=0&&u<this.gridRightBoundary&&A>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const u=a.bz([]);return a.bq(u,u,[-100,-100,0]),u}}class yi{constructor(u,p,b,A){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?p:-p))):A&&b?1:0,this.placed=b}isHidden(){return this.opacity===0&&!this.placed}}class kr{constructor(u,p,b,A,M,P=!1){this.text=new yi(u?u.text:null,p,b,M),this.icon=new yi(u?u.icon:null,p,A,M),this.clipped=P}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $r{constructor(u,p,b,A=!1){this.text=u,this.icon=p,this.skipFade=b,this.clipped=A}}class Ss{constructor(){this.invProjMatrix=a.bB(),this.viewportMatrix=a.bB(),this.circles=[]}}class Kd{constructor(u,p,b,A,M){this.bucketInstanceId=u,this.featureIndex=p,this.sourceLayerIndex=b,this.bucketIndex=A,this.tileID=M}}class Jr{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const p=++this.maxGroupID;this.collisionGroups[u]={ID:p,predicate:b=>b.collisionGroupID===p}}return this.collisionGroups[u]}}function hg(x,u,p,b,A){const{horizontalAlign:M,verticalAlign:P}=a.c0(x),O=-(M-.5)*u,B=-(P-.5)*p,G=a.c1(x,b);return new a.P(O+G[0]*A,B+G[1]*A)}function Rh(x,u,p,b,A){const M=new a.P(x,u);return p&&M._rotate(b?A:-A),M}class dg{constructor(u,p,b,A,M,P){this.transform=u.clone(),this.projection=u.projection.name,this.collisionIndex=new Yd(this.transform,M),this.buildingIndex=P,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Jr(b),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(u,p,b,A,M=1){const P=b.getBucket(p),O=b.latestFeatureIndex;if(!P||!O||p.fqid!==P.layerIds[0])return;const B=P.layers[0].layout,G=P.layers[0].paint,j=b.collisionBoxArray,X=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),W=b.tileSize/a.al,K=b.tileID.toUnwrapped();this.transform.setProjection(P.projection);const tt=(rt=b.tileID,ht=P.getProjection(),st=this.transform,ht.name===this.projection?st.calculateProjMatrix(rt.toUnwrapped()):Lh(st,ht,rt));var rt,ht,st;const gt=B.get("text-pitch-alignment")==="map",xt=B.get("text-rotation-alignment")==="map";p.compileFilter(p.options);const vt=p.dynamicFilter(),Pt=p.dynamicFilterNeedsFeature(),wt=this.transform.calculatePixelsToTileUnitsMatrix(b),Rt=ug(tt,b.tileID.canonical,gt,xt,this.transform,P.getProjection(),wt);let Mt=null;const At=P.getProjection().createInversionMatrix(this.transform,b.tileID.canonical);if(gt){const Gt=Vu(tt,b.tileID.canonical,gt,xt,this.transform,P.getProjection(),wt);Mt=a.aB([],this.transform.labelPlaneMatrix,Gt)}let kt=null;vt&&b.latestFeatureIndex&&(kt={unwrappedTileID:K,dynamicFilter:vt,dynamicFilterNeedsFeature:Pt}),this.retainedQueryData[P.bucketInstanceId]=new Kd(P.bucketInstanceId,O,P.sourceLayerIndex,P.index,b.tileID);const[qt,jt]=P.layers[0].layout.get("text-size-scale-range"),oe=a.aA(M,qt,jt),[te,fe]=B.get("icon-size-scale-range"),ze=a.aA(M,te,fe),Qt={bucket:P,layout:B,paint:G,posMatrix:tt,invMatrix:At,mercatorCenter:[a.aF(this.transform.center.lng),a.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Rt,labelToScreenMatrix:Mt,clippingData:kt,scale:X,textPixelRatio:W,holdingForFade:b.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:a.bJ(P.textSizeData,this.transform.zoom,oe),partiallyEvaluatedIconSize:a.bJ(P.iconSizeData,this.transform.zoom,ze),collisionGroup:this.collisionGroups.get(P.sourceID),latestFeatureIndex:b.latestFeatureIndex};if(A)for(const Gt of P.sortKeyRanges){const{sortKey:pe,symbolInstanceStart:ee,symbolInstanceEnd:Ae}=Gt;u.push({sortKey:pe,symbolInstanceStart:ee,symbolInstanceEnd:Ae,parameters:Qt})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:Qt})}attemptAnchorPlacement(u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st,gt,xt,vt,Pt){const{textOffset0:wt,textOffset1:Rt,crossTileID:Mt}=rt,At=[wt,Rt],kt=hg(u,P,O,At,B),qt=this.collisionIndex.placeCollisionBox(st,B,p,b,A,M,Rh(kt.x,kt.y,G,j,this.transform.angle),tt,X,W,K.predicate);if(xt){const jt=st.getSymbolInstanceIconSize(Pt,this.transform.zoom,rt.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(st,jt,xt,b,A,M,Rh(kt.x,kt.y,G,j,this.transform.angle),tt,X,W,K.predicate).box.length===0)return}if(qt.box.length>0){let jt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Mt]&&this.prevPlacement.placements[Mt]&&this.prevPlacement.placements[Mt].text&&(jt=this.prevPlacement.variableOffsets[Mt].anchor),this.variableOffsets[Mt]={textOffset:At,width:P,height:O,anchor:u,textScale:B,prevAnchor:jt},this.markUsedJustification(st,u,rt,gt),st.allowVerticalPlacement&&(this.markUsedOrientation(st,gt,rt),this.placedOrientations[Mt]=gt),{shift:kt,placedGlyphBoxes:qt}}}placeLayerBucketPart(u,p,b,A,M=1){const{bucket:P,layout:O,paint:B,posMatrix:G,textLabelPlaneMatrix:j,labelToScreenMatrix:X,clippingData:W,textPixelRatio:K,mercatorCenter:tt,invMatrix:rt,holdingForFade:ht,collisionBoxArray:st,partiallyEvaluatedTextSize:gt,partiallyEvaluatedIconSize:xt,collisionGroup:vt,latestFeatureIndex:Pt}=u.parameters,wt=O.get("text-optional"),Rt=O.get("icon-optional"),Mt=O.get("text-allow-overlap"),At=O.get("icon-allow-overlap"),kt=O.get("text-rotation-alignment")==="map",qt=O.get("icon-rotation-alignment")==="map",jt=O.get("text-pitch-alignment")==="map",oe=B.get("symbol-z-offset"),te=O.get("symbol-elevation-reference")==="sea",fe=O.get("symbol-placement"),[ze,Qt]=O.get("text-size-scale-range"),[Gt,pe]=O.get("icon-size-scale-range"),ee=a.aA(M,ze,Qt),Ae=a.aA(M,Gt,pe),Ge=O.get("text-variable-anchor"),ui=kt&&fe!=="point",Le=qt&&fe!=="point",Fe=Ge&&P.hasTextData(),hi=P.hasIconTextFit()&&Fe&&P.hasIconData();this.transform.setProjection(P.projection);const ai=Fe||ui,ii=Le||hi;let oi=Mt&&(At||!P.hasIconData()||Rt),Di=At&&(Mt||!P.hasTextData()||wt);const mr=!oe.isConstant();!P.collisionArrays&&st&&P.deserializeCollisionBoxes(st),b&&A&&P.updateCollisionDebugBuffers(this.transform.zoom,st,ee,Ae);const Ir=(Vi,Tr,ir)=>{const{crossTileID:Qr,numVerticalGlyphVertices:Cr}=Vi;let pn=null;if(W&&W.dynamicFilterNeedsFeature||mr){const $n=this.retainedQueryData[P.bucketInstanceId];pn=Pt.loadFeature({featureIndex:Vi.featureIndex,bucketIndex:$n.bucketIndex,sourceLayerIndex:$n.sourceLayerIndex,layoutVertexArrayOffset:0})}if(W&&!(0,W.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:P.worldview},pn,this.retainedQueryData[P.bucketInstanceId].tileID.canonical,new a.P(Vi.tileAnchorX,Vi.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[Qr]=new $r(!1,!1,!1,!0),void p.add(Qr);const Or=oe.evaluate(pn,{});if(p.has(Qr))return;if(ht)return void(this.placements[Qr]=new $r(!1,!1,!1));let ar=!1,Gr=!1,ur=!0,wn=!1,Zr=!1,Hi=null,Dr={box:null,offscreen:null,occluded:null},Bn={box:null},ra=null,Gn=null,Jn=null,fs=0,Qo=0,po=0;ir.textFeatureIndex?fs=ir.textFeatureIndex:Vi.useRuntimeCollisionCircles&&(fs=Vi.featureIndex),ir.verticalTextFeatureIndex&&(Qo=ir.verticalTextFeatureIndex);const Eo=P.elevationFeatures?P.elevationFeatures[Vi.elevationFeatureIndex]:void 0,Xs=$n=>{$n.tileID=this.retainedQueryData[P.bucketInstanceId].tileID;const na=this.transform.elevation;$n.elevation=te?Or:Or+a.bU.getAtTileOffset($n.tileID,new a.P($n.tileAnchorX,$n.tileAnchorY),na,Eo),$n.elevation+=Vi.zOffset},go=ir.textBox;if(go){Xs(go);const $n=hn=>{let la=a.bK.horizontal;if(P.allowVerticalPlacement&&!hn&&this.prevPlacement){const Xa=this.prevPlacement.placedOrientations[Qr];Xa&&(this.placedOrientations[Qr]=Xa,la=Xa,this.markUsedOrientation(P,la,Vi))}return la},na=(hn,la)=>{if(P.allowVerticalPlacement&&Cr>0&&ir.verticalTextBox){for(const Xa of P.writingModes)if(Xa===a.bK.vertical?(Dr=la(),Bn=Dr):Dr=hn(),Dr&&Dr.box&&Dr.box.length)break}else Dr=hn()};if(Ge){let hn=Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qr]){const Zn=this.prevPlacement.variableOffsets[Qr];hn.indexOf(Zn.anchor)>0&&(hn=hn.filter(Ks=>Ks!==Zn.anchor),hn.unshift(Zn.anchor))}const la=(Zn,Ks,Ef)=>{const Ku=P.getSymbolInstanceTextSize(gt,Vi,this.transform.zoom,Tr),Df=(Zn.x2-Zn.x1)*Ku+2*Zn.padding,Pf=(Zn.y2-Zn.y1)*Ku+2*Zn.padding,Js=Vi.hasIconTextFit&&!At?Ks:null;Js&&Xs(Js);let fu={box:[],offscreen:!1,occluded:!1};const ja=Mt?2*hn.length:hn.length;for(let Qs=0;Qs<ja;++Qs){const Zh=this.attemptAnchorPlacement(hn[Qs%hn.length],Zn,tt,rt,ai,Df,Pf,Ku,kt,jt,K,G,vt,Qs>=hn.length,Vi,Tr,P,Ef,Js,gt,xt);if(Zh&&(fu=Zh.placedGlyphBoxes,fu&&fu.box&&fu.box.length)){ar=!0,Hi=Zh.shift;break}}return fu};na(()=>la(go,ir.iconBox,a.bK.horizontal),()=>{const Zn=ir.verticalTextBox;return Zn&&Xs(Zn),P.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&Cr>0&&Zn?la(Zn,ir.verticalIconBox,a.bK.vertical):{box:null,offscreen:null,occluded:null}}),Dr&&(ar=Dr.box,ur=Dr.offscreen,wn=Dr.occluded);const Xa=$n(!(!Dr||!Dr.box));if(!ar&&this.prevPlacement){const Zn=this.prevPlacement.variableOffsets[Qr];Zn&&(this.variableOffsets[Qr]=Zn,this.markUsedJustification(P,Zn.anchor,Vi,Xa))}}else{const hn=(la,Xa)=>{const Zn=P.getSymbolInstanceTextSize(gt,Vi,this.transform.zoom,Tr),Ks=this.collisionIndex.placeCollisionBox(P,Zn,la,tt,rt,ai,new a.P(0,0),Mt,K,G,vt.predicate);return Ks&&Ks.box&&Ks.box.length&&(this.markUsedOrientation(P,Xa,Vi),this.placedOrientations[Qr]=Xa),Ks};na(()=>hn(go,a.bK.horizontal),()=>{const la=ir.verticalTextBox;return P.allowVerticalPlacement&&Cr>0&&la?(Xs(la),hn(la,a.bK.vertical)):{box:null,offscreen:null,occluded:null}}),$n(!!(Dr&&Dr.box&&Dr.box.length))}}if(ra=Dr,ar=ra&&ra.box&&ra.box.length>0,ur=ra&&ra.offscreen,wn=ra&&ra.occluded,Vi.useRuntimeCollisionCircles){const $n=Vi.centerJustifiedTextSymbolIndex>=0?Vi.centerJustifiedTextSymbolIndex:Vi.verticalPlacedTextSymbolIndex,na=P.text.placedSymbolArray.get($n),hn=a.bL(P.textSizeData,gt,na),la=O.get("text-padding");Gn=this.collisionIndex.placeCollisionCircles(P,Mt,na,$n,P.lineVertexArray,P.glyphOffsetArray,hn,G,j,X,b,jt,vt.predicate,Vi.collisionCircleDiameter*hn/a.bX,la,this.retainedQueryData[P.bucketInstanceId].tileID),ar=Mt||Gn.circles.length>0&&!Gn.collisionDetected,ur=ur&&Gn.offscreen,wn=Gn.occluded}if(ir.iconFeatureIndex&&(po=ir.iconFeatureIndex),ir.iconBox){const $n=na=>{Xs(na);const hn=Vi.hasIconTextFit&&Hi?Rh(Hi.x,Hi.y,kt,jt,this.transform.angle):new a.P(0,0),la=P.getSymbolInstanceIconSize(xt,this.transform.zoom,Vi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(P,la,na,tt,rt,ii,hn,At,K,G,vt.predicate)};Bn&&Bn.box&&Bn.box.length&&ir.verticalIconBox?(Jn=$n(ir.verticalIconBox),Gr=Jn.box.length>0):(Jn=$n(ir.iconBox),Gr=Jn.box.length>0),ur=ur&&Jn.offscreen,Zr=Jn.occluded}const Ys=wt||Vi.numHorizontalGlyphVertices===0&&Cr===0,Cl=Rt||Vi.numIconVertices===0;if(Ys||Cl?Cl?Ys||(Gr=Gr&&ar):ar=Gr&&ar:Gr=ar=Gr&&ar,ar&&ra&&ra.box&&this.collisionIndex.insertCollisionBox(ra.box,O.get("text-ignore-placement"),P.bucketInstanceId,Bn&&Bn.box&&Qo?Qo:fs,vt.ID),Gr&&Jn&&this.collisionIndex.insertCollisionBox(Jn.box,O.get("icon-ignore-placement"),P.bucketInstanceId,po,vt.ID),Gn&&(ar&&this.collisionIndex.insertCollisionCircles(Gn.circles,O.get("text-ignore-placement"),P.bucketInstanceId,fs,vt.ID),b)){const $n=P.bucketInstanceId;let na=this.collisionCircleArrays[$n];na===void 0&&(na=this.collisionCircleArrays[$n]=new Ss);for(let hn=0;hn<Gn.circles.length;hn+=4)na.circles.push(Gn.circles[hn+0]),na.circles.push(Gn.circles[hn+1]),na.circles.push(Gn.circles[hn+2]),na.circles.push(Gn.collisionDetected?1:0)}const qa=P.projection.name!=="globe";oi=oi&&(qa||!wn),Di=Di&&(qa||!Zr),this.placements[Qr]=new $r(ar||oi,Gr||Di,ur||P.justReloaded),p.add(Qr)},an=this.retainedQueryData[P.bucketInstanceId].tileID;if(P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,an),P.elevationType==="road"&&P.updateRoadElevation(an.canonical),P.updateZOffset(),P.sortFeaturesByY){const Vi=P.getSortedSymbolIndexes(this.transform.angle);for(let Tr=Vi.length-1;Tr>=0;--Tr){const ir=Vi[Tr];Ir(P.symbolInstances.get(ir),ir,P.collisionArrays[ir])}P.hasAnyZOffset&&a.w(`${P.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(P.hasAnyZOffset){const Vi=P.getSortedIndexesByZOffset();for(let Tr=0;Tr<Vi.length;++Tr){const ir=Vi[Tr];Ir(P.symbolInstances.get(ir),ir,P.collisionArrays[ir])}}else for(let Vi=u.symbolInstanceStart;Vi<u.symbolInstanceEnd;Vi++)Ir(P.symbolInstances.get(Vi),Vi,P.collisionArrays[Vi]);if(b&&P.bucketInstanceId in this.collisionCircleArrays){const Vi=this.collisionCircleArrays[P.bucketInstanceId];a.bk(Vi.invProjMatrix,G),Vi.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1}markUsedJustification(u,p,b,A){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:B,crossTileID:G}=b,j=a.c2(p),X=A===a.bK.vertical?B:j==="left"?M:j==="center"?P:j==="right"?O:-1;M>=0&&(u.text.placedSymbolArray.get(M).crossTileID=X>=0&&M!==X?0:G),P>=0&&(u.text.placedSymbolArray.get(P).crossTileID=X>=0&&P!==X?0:G),O>=0&&(u.text.placedSymbolArray.get(O).crossTileID=X>=0&&O!==X?0:G),B>=0&&(u.text.placedSymbolArray.get(B).crossTileID=X>=0&&B!==X?0:G)}markUsedOrientation(u,p,b){const A=p===a.bK.horizontal||p===a.bK.horizontalOnly?p:0,M=p===a.bK.vertical?p:0,{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:G}=b,j=u.text.placedSymbolArray;P>=0&&(j.get(P).placedOrientation=A),O>=0&&(j.get(O).placedOrientation=A),B>=0&&(j.get(B).placedOrientation=A),G>=0&&(j.get(G).placedOrientation=M)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let b=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const A=p?p.symbolFadeChange(u):1,M=p?p.opacities:{},P=p?p.variableOffsets:{},O=p?p.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],j=M[B];j?(this.opacities[B]=new kr(j,A,G.text,G.icon,null,G.clipped),b=b||G.text!==j.text.placed||G.icon!==j.icon.placed):(this.opacities[B]=new kr(null,A,G.text,G.icon,G.skipFade,G.clipped),b=b||G.text||G.icon)}for(const B in M){const G=M[B];if(!this.opacities[B]){const j=new kr(G,A,!1,!1);j.isHidden()||(this.opacities[B]=j,b=b||G.text.placed||G.icon.placed)}}for(const B in P)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=P[B]);for(const B in O)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=O[B]);b?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:u)}updateLayerOpacities(u,p,b,A){const M=new Set;for(const P of p){const O=P.getBucket(u);O&&P.latestFeatureIndex&&u.fqid===O.layerIds[0]&&(this.updateBucketOpacities(O,M,P,P.collisionBoxArray,b,A,P.tileID,u.scope),O.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(O,P.tileID),O.elevationType==="road"&&O.updateRoadElevation(P.tileID.canonical),O.updateZOffset())}}updateBucketOpacities(u,p,b,A,M,P,O,B){u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const G=u.layers[0].layout,j=u.layers[0].paint,X=!!u.layers[0].dynamicFilter(),W=new kr(null,0,!1,!1,!0),K=G.get("text-allow-overlap"),tt=G.get("icon-allow-overlap"),rt=G.get("text-variable-anchor"),ht=G.get("text-rotation-alignment")==="map",st=G.get("text-pitch-alignment")==="map",gt=j.get("symbol-z-offset"),xt=G.get("symbol-elevation-reference")==="sea",vt=!gt.isConstant(),Pt=new kr(null,0,K&&(tt||!u.hasIconData()||G.get("icon-optional")),tt&&(K||!u.hasTextData()||G.get("text-optional")),!0);!u.collisionArrays&&A&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(A);const wt=(Mt,At,kt)=>{for(let qt=0;qt<At/4;qt++)Mt.opacityVertexArray.emplaceBack(kt)};let Rt=0;P&&u.updateReplacement(O,P);for(let Mt=0;Mt<u.symbolInstances.length;Mt++){const At=u.symbolInstances.get(Mt),{numHorizontalGlyphVertices:kt,numVerticalGlyphVertices:qt,crossTileID:jt,numIconVertices:oe,tileAnchorX:te,tileAnchorY:fe}=At;let ze=null;const Qt=this.retainedQueryData[u.bucketInstanceId];vt&&At&&Qt&&(ze=b.latestFeatureIndex.loadFeature({featureIndex:At.featureIndex,bucketIndex:Qt.bucketIndex,sourceLayerIndex:Qt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Gt=gt.evaluate(ze,{}),pe=p.has(jt);let ee=this.opacities[jt];pe?ee=W:ee||(ee=Pt,this.opacities[jt]=ee),p.add(jt);const Ae=kt>0||qt>0,Ge=oe>0,ui=this.placedOrientations[jt],Le=ui===a.bK.vertical,Fe=ui===a.bK.horizontal||ui===a.bK.horizontalOnly;!Ae&&!Ge||ee.isHidden()||Rt++;let hi=!1;if((Ae||Ge)&&P)for(const ai of u.activeReplacements){if(a.bY(ai,M,a.bZ.Symbol,B)||ai.min.x>te||te>ai.max.x||ai.min.y>fe||fe>ai.max.y)continue;const ii=a.b_(te,fe,O.canonical,ai.footprintTileId.canonical);if(hi=a.b$(ii,ai.footprint),hi)break}if(Ae){const ai=hi?Za:gg(ee.text);wt(u.text,kt,Le?Za:ai),wt(u.text,qt,Fe?Za:ai);const ii=ee.text.isHidden(),{leftJustifiedTextSymbolIndex:oi,centerJustifiedTextSymbolIndex:Di,rightJustifiedTextSymbolIndex:mr,verticalPlacedTextSymbolIndex:Ir}=At,an=u.text.placedSymbolArray,Vi=ii||Le?1:0;oi>=0&&(an.get(oi).hidden=Vi),Di>=0&&(an.get(Di).hidden=Vi),mr>=0&&(an.get(mr).hidden=Vi),Ir>=0&&(an.get(Ir).hidden=ii||Fe?1:0);const Tr=this.variableOffsets[jt];Tr&&this.markUsedJustification(u,Tr.anchor,At,ui);const ir=this.placedOrientations[jt];ir&&(this.markUsedJustification(u,"left",At,ir),this.markUsedOrientation(u,ir,At))}if(Ge){const ai=hi?Za:gg(ee.icon),{placedIconSymbolIndex:ii,verticalPlacedIconSymbolIndex:oi}=At,Di=u.icon.placedSymbolArray,mr=ee.icon.isHidden()?1:0;ii>=0&&(wt(u.icon,oe,Le?Za:ai),Di.get(ii).hidden=mr),oi>=0&&(wt(u.icon,At.numVerticalIconVertices,Fe?Za:ai),Di.get(oi).hidden=mr)}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const ai=u.collisionArrays[Mt];if(ai){let ii=new a.P(0,0),oi=!0;if(ai.textBox||ai.verticalTextBox){if(rt){const mr=this.variableOffsets[jt];mr?(ii=hg(mr.anchor,mr.width,mr.height,mr.textOffset,mr.textScale),ht&&ii._rotate(st?this.transform.angle:-this.transform.angle)):oi=!1}X&&(oi=!ee.clipped),ai.textBox&&eo(u.textCollisionBox.collisionVertexArray,ee.text.placed,!oi||Le,Gt,xt,ii.x,ii.y),ai.verticalTextBox&&eo(u.textCollisionBox.collisionVertexArray,ee.text.placed,!oi||Fe,Gt,xt,ii.x,ii.y)}const Di=oi&&!!(!Fe&&ai.verticalIconBox);ai.iconBox&&eo(u.iconCollisionBox.collisionVertexArray,ee.icon.placed,Di,Gt,xt,At.hasIconTextFit?ii.x:0,At.hasIconTextFit?ii.y:0),ai.verticalIconBox&&eo(u.iconCollisionBox.collisionVertexArray,ee.icon.placed,!Di,Gt,xt,At.hasIconTextFit?ii.x:0,At.hasIconTextFit?ii.y:0)}}}if(u.fullyClipped=Rt===0,u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){const Mt=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=Mt.invProjMatrix,u.placementViewportMatrix=Mt.viewportMatrix,u.collisionCircleArray=Mt.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,p){const b=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*b>u}setStale(){this.stale=!0}}function eo(x,u,p,b,A,M,P){x.emplaceBack(u?1:0,p?1:0,M||0,P||0,b,A?1:0),x.emplaceBack(u?1:0,p?1:0,M||0,P||0,b,A?1:0),x.emplaceBack(u?1:0,p?1:0,M||0,P||0,b,A?1:0),x.emplaceBack(u?1:0,p?1:0,M||0,P||0,b,A?1:0)}const Da=Math.pow(2,25),FE=Math.pow(2,24),fg=Math.pow(2,17),cx=Math.pow(2,16),pg=Math.pow(2,9),jv=Math.pow(2,8),hx=Math.pow(2,1);function gg(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const u=x.placed?1:0,p=Math.floor(127*x.opacity);return p*Da+u*FE+p*fg+u*cx+p*pg+u*jv+p*hx+u}const Za=0;class Gu{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(u,p,b,A,M,P){const O=this._bucketParts;for(;this._currentTileIndex<u.length;)if(p.getBucketParts(O,A,u[this._currentTileIndex],this._sortAcrossTiles,P),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((B,G)=>B.sortKey-G.sortKey));this._currentPartIndex<O.length;){const B=O[this._currentPartIndex];if(p.placeLayerBucketPart(B,this._seenCrossTileIDs,b,B.symbolInstanceStart===0,P),this._currentPartIndex++,M())return!0}return!1}}class cs{constructor(u,p,b,A,M,P,O,B,G){this.placement=new dg(u,M,P,O,B,G),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(u,p,b,A,M){const P=a.o.now(),O=()=>{const B=a.o.now()-P;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=p[u[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=G)&&(!B.maxzoom||B.maxzoom>G)){const j=B,X=j.layout.get("symbol-z-elevate"),W=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,K=j.layout.get("symbol-z-order"),tt=K==="viewport-y"||K==="auto"&&!(K!=="viewport-y"&&W),rt=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),ht=tt&&rt,st=this._inProgressLayer=this._inProgressLayer||new Gu(j),gt=a.B(B.source,B.scope);if(st.continuePlacement(X||ht?A[gt]:b[gt],this.placement,this._showCollisionBoxes,B,O,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const Wv=512/a.al/2;class Jd{constructor(u,p,b){this.tileID=u,this.bucketInstanceId=b,this.index=new a.c3(p.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const A=u.canonical.x*a.al,M=u.canonical.y*a.al;for(let P=0;P<p.length;P++){const{key:O,crossTileID:B,tileAnchorX:G,tileAnchorY:j}=p.get(P),X=Math.floor((A+G)*Wv),W=Math.floor((M+j)*Wv);this.index.add(X,W),this.keys.push(O),this.crossTileIDs.push(B)}this.index.finish()}findMatches(u,p,b){const A=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),M=Wv/Math.pow(2,p.canonical.z-this.tileID.canonical.z),P=p.canonical.x*a.al,O=p.canonical.y*a.al;for(let B=0;B<u.length;B++){const G=u.get(B);if(G.crossTileID)continue;const{key:j,tileAnchorX:X,tileAnchorY:W}=G,K=Math.floor((P+X)*M),tt=Math.floor((O+W)*M),rt=this.index.range(K-A,tt-A,K+A,tt+A).sort((ht,st)=>ht-st);for(const ht of rt){const st=this.crossTileIDs[ht];if(this.keys[ht]===j&&!b.has(st)){b.add(st),G.crossTileID=st;break}}}}}class Ha{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class lu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const p=Math.round((u-this.lng)/360);if(p!==0)for(const b in this.indexes){const A=this.indexes[b],M={};for(const P in A){const O=A[P];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+p),M[O.tileID.key]=O}this.indexes[b]=M}this.lng=u}addBucket(u,p,b){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let M=0;M<p.symbolInstances.length;M++)p.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]=new Set);const A=this.usedCrossTileIDs[u.overscaledZ];for(const M in this.indexes){const P=this.indexes[M];if(Number(M)>u.overscaledZ)for(const O in P){const B=P[O];B.tileID.isChildOf(u)&&B.findMatches(p.symbolInstances,u,A)}else{const O=P[u.scaledTo(Number(M)).key];O&&O.findMatches(p.symbolInstances,u,A)}}for(let M=0;M<p.symbolInstances.length;M++){const P=p.symbolInstances.get(M);P.crossTileID||(P.crossTileID=b.generate(),A.add(P.crossTileID))}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new Jd(u,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(u,p){for(const b of p.crossTileIDs)this.usedCrossTileIDs[u].delete(b)}removeStaleBuckets(u){let p=!1;for(const b in this.indexes){const A=this.indexes[b];for(const M in A)u[A[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,A[M]),delete A[M],p=!0)}return p}}class Hu{constructor(){this.layerIndexes={},this.crossTileIDs=new Ha,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,p,b,A){let M=this.layerIndexes[u.fqid];M===void 0&&(M=this.layerIndexes[u.fqid]=new lu);let P=!1;const O={};A.name!=="globe"&&M.handleWrapJump(b);for(const B of p){const G=B.getBucket(u);G&&u.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(B.tileID,G,this.crossTileIDs)&&(P=!0),O[G.bucketInstanceId]=!0)}return M.removeStaleBuckets(O)&&(P=!0),P}pruneUnusedLayers(u){const p={};u.forEach(b=>{p[b]=!0});for(const b in this.layerIndexes)p[b]||delete this.layerIndexes[b]}}const sa=771;class lr{constructor(u,p,b,A){this.blendFunction=u,this.blendColor=p.toNonPremultipliedRenderColor(null),this.mask=b,this.blendEquation=A}}lr.Replace=[1,0,1,0],lr.disabled=new lr(lr.Replace,a.ao.transparent,[!1,!1,!1,!1]),lr.unblended=new lr(lr.Replace,a.ao.transparent,[!0,!0,!0,!0]),lr.alphaBlended=new lr([1,sa,1,sa],a.ao.transparent,[!0,!0,!0,!0]),lr.alphaBlendedNonPremultiplied=new lr([770,sa,770,sa],a.ao.transparent,[!0,!0,!0,!0]),lr.multiply=new lr([774,0,774,0],a.ao.transparent,[!0,!0,!0,!0]),lr.additive=new lr([1,1,1,1],a.ao.transparent,[!0,!0,!0,!0]);class fi{constructor(u,p,b){this.func=u,this.mask=p,this.range=b}}fi.ReadOnly=!1,fi.ReadWrite=!0,fi.disabled=new fi(519,fi.ReadOnly,[0,1]);const kh=7680;class $i{constructor(u,p,b,A,M,P){this.test=u,this.ref=p,this.mask=b,this.fail=A,this.depthFail=M,this.pass=P}}$i.disabled=new $i({func:519,mask:0},0,0,kh,kh,kh);const Qd=1029,$v=2305;class Ni{constructor(u,p,b){this.enable=u,this.mode=p,this.frontFace=b}}function mg(x,u){const p=a.c9(x,3);a.cb(x,u),a.cf(x,3,p)}function Zv(x,u){const p=a.c6([]);return a.c7(p,p,-u),a.c8(p,p,-x),p}function nT(x,u){const p=[x[0],x[1],0],b=[u[0],u[1],0];if(a.ag(p)>=1e-15){const P=a.aw([],p);a.c4(b,P,a.bI(b,P)),u[0]=b[0],u[1]=b[1]}const A=a.bH([],u,x);if(a.c5(A)<1e-15)return null;const M=Math.atan2(-A[1],A[0]);return Zv(Math.atan2(Math.sqrt(x[0]*x[0]+x[1]*x[1]),-x[2]),M)}Ni.disabled=new Ni(!1,Qd,$v),Ni.backCCW=new Ni(!0,Qd,$v),Ni.backCW=new Ni(!0,Qd,2304),Ni.frontCW=new Ni(!0,1028,2304),Ni.frontCCW=new Ni(!0,1028,$v);class uu{constructor(u,p){this.position=u,this.orientation=p}get position(){return this._position}set position(u){if(u){const p=u instanceof a.ae?u:new a.ae(u[0],u[1],u[2]);this._renderWorldCopies&&(p.x=a.bS(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(u,p,b){if(this.orientation=null,!this.position)return;const A=this.position,M=b||(this._elevation?this._elevation.getAtPointOrZero(a.ae.fromLngLat(u)):0),P=a.ae.fromLngLat(u,M),O=[P.x-A.x,P.y-A.y,P.z-A.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=nT(O,p)}setPitchBearing(u,p){this.orientation=Zv(a.an(u),a.an(-p))}}class qv{constructor(u,p){this._transform=a.bz([]),this.orientation=p,this.position=u}get mercatorPosition(){const u=this.position;return new a.ae(u[0],u[1],u[2])}get position(){const u=a.c9(this._transform,3);return[u[0],u[1],u[2]]}set position(u){var p;u&&a.cf(this._transform,3,[(p=u)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(u){this._orientation=u||a.c6([]),u&&mg(this._transform,this._orientation)}getPitchBearing(){const u=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2])}}setPitchBearing(u,p){this._orientation=Zv(u,p),mg(this._transform,this._orientation)}forward(){const u=a.c9(this._transform,2);return[-u[0],-u[1],-u[2]]}up(){const u=a.c9(this._transform,1);return[-u[0],-u[1],-u[2]]}right(){const u=a.c9(this._transform,0);return[u[0],u[1],u[2]]}getCameraToWorld(u,p){const b=new Float64Array(16);return a.bk(b,this.getWorldToCamera(u,p)),b}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(u,p,b){const A=this.position;a.c4(A,A,-u);const M=new Float64Array(16);return a.bp(M,[b,b,b]),a.bq(M,M,A),M[10]*=p,M}getWorldToCamera(u,p){const b=new Float64Array(16),A=new Float64Array(4),M=this.position;return a.ca(A,this._orientation),a.c4(M,M,-u),a.cb(b,A),a.bq(b,b,M),b[1]*=-1,b[5]*=-1,b[9]*=-1,b[13]*=-1,b[8]*=p,b[9]*=p,b[10]*=p,b[11]*=p,b}getCameraToClipPerspective(u,p,b,A){const M=new Float64Array(16);return a.cc(M,u,p,b,A),M}getCameraToClipOrthographic(u,p,b,A,M,P){const O=new Float64Array(16);return a.cd(O,u,p,b,A,M,P),O}getDistanceToElevation(u,p=!1){const b=u===0?0:a.ce(u,p?a.a_(this.position[1]):this.position[1]),A=this.forward();return(b-this.position[2])/A[2]}clone(){return new qv([...this.position],[...this.orientation])}}const io={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Go{constructor(u=0,p=0,b=0,A=0){if(isNaN(u)||u<0||isNaN(p)||p<0||isNaN(b)||b<0||isNaN(A)||A<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=p,this.left=b,this.right=A}interpolate(u,p,b){return p.top!=null&&u.top!=null&&(this.top=a.ak(u.top,p.top,b)),p.bottom!=null&&u.bottom!=null&&(this.bottom=a.ak(u.bottom,p.bottom,b)),p.left!=null&&u.left!=null&&(this.left=a.ak(u.left,p.left,b)),p.right!=null&&u.right!=null&&(this.right=a.ak(u.right,p.right,b)),this}getCenter(u,p){const b=a.aA((this.left+u-this.right)/2,0,u),A=a.aA((this.top+p-this.bottom)/2,0,p);return new a.P(b,A)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new Go(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Oh=15;class tf{constructor(u,p,b,A,M,P,O){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=u||0,this._maxZoom=p||22,this._minPitch=b??0,this._maxPitch=A??60,this.setProjection(P),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new a.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Go,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const u=new tf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return u._elevation=this._elevation,u._centerAltitude=this._centerAltitude,u._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,u.tileSize=this.tileSize,u.mercatorFromTransition=this.mercatorFromTransition,u.width=this.width,u.height=this.height,u.cameraElevationReference=this.cameraElevationReference,u._center=this._center,u._setZoom(this.zoom),u._seaLevelZoom=this._seaLevelZoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._nearZ=this._nearZ,u._farZ=this._farZ,u._averageElevation=this._averageElevation,u._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._camera=this._camera.clone(),u._calcMatrices(),u.freezeTileCoverage=this.freezeTileCoverage,u.frustumCorners=this.frustumCorners,u._allowWorldUnderZoom=this._allowWorldUnderZoom,u}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Oh}get elevation(){return this._elevation}set elevation(u){this._elevation!==u&&(this._elevation=u,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(u,p=!1){const b=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||b)&&this._updateCameraOnTerrain(),(u||b)&&this._constrainCamera(p),this._calcMatrices()}getProjection(){return a.aH(this.projection,["name","center","parallels"])}setProjection(u){this.projectionOptions=u||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=a.cl(this.projectionOptions);const b=this.getProjection(),A=!a.bx(p,b);return A&&this._calcMatrices(),this.mercatorFromTransition=!1,A}setOrthographicProjectionAtLowPitch(u){return this._orthographicProjectionAtLowPitch!==u&&(this._orthographicProjectionAtLowPitch=u,this._calcMatrices(),!0)}setMercatorFromTransition(){const u=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.cl({name:"mercator"});const p=u!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get cameraWorldSize(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bS(this.rotation,-180,180)}set bearing(u){this.rotation=u}get rotation(){return-this.angle/Math.PI*180}set rotation(u){const p=-u*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=a.cm(),a.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const p=a.aA(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=a.an(u),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const u=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/u)}get averageElevation(){return this._averageElevation}set averageElevation(u){this._averageElevation=u,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(u){const p=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(u){this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(u){this._tileCoverLift!==u&&(this._tileCoverLift=u)}_updateCameraOnTerrain(){const u=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,p=this.elevation&&u===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||u===Number.NEGATIVE_INFINITY&&(!p||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const b=this._elevation;p||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&b.exaggeration()&&this._centerAltitudeValidForExaggeration!==b.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*b.exaggeration(),this._centerAltitudeValidForExaggeration=b.exaggeration()):(this._centerAltitude=u||0,this._centerAltitudeValidForExaggeration=b.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const u=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(u)}sampleAverageElevation(){if(!this._elevation)return 0;const u=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],b=this.horizonLineFromTop();let A=0,M=0;for(let P=0;P<p.length;P++){const O=new a.P(p[P][0]*this.width,b+p[P][1]*(this.height-b)),B=u.pointCoordinate(O);if(!B)continue;const G=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);A+=B[3]*G,M+=G}return M===0?NaN:A/M}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const u=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),b=this.pixelsPerMeter/this.worldSize*p,A=this._mercatorZfromZoom(u),M=this._mercatorZfromZoom(this._maxZoom),P=Math.max(A-b,M);this._setZoom(this._zoomFromMercatorZ(P))}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}computeZoomRelativeTo(u){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,u.toAltitude()));let b;b=u.z<this._camera.position[2]?[p.x,p.y,p.z]:[u.x,u.y,u.z];const A=a.ag(a.av([],this._camera.position,b));return a.aA(this._zoomFromMercatorZ(A),this._minZoom,this._maxZoom)}setFreeCameraOptions(u){if(!this.height||!u.position&&!u.orientation)return;this._updateCameraState();let p=!1;if(u.orientation&&!a.co(u.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(u.orientation)),u.position){const b=[u.position.x,u.position.y,u.position.z];a.cp(b,this._camera.position)||(this._setCameraPosition(b),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const u=this._camera.position,p=new uu;return p.position=new a.ae(u[0],u[1],u[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(u){if(!a.cq(u))return!1;a.cr(u,u);const p=a.cs([],[0,0,-1],u),b=a.cs([],[0,-1,0],u);if(b[2]<0)return!1;const A=nT(p,b);return!!A&&(this._camera.orientation=A,!0)}_setCameraPosition(u){const p=this.zoomScale(this.minZoom)*this.tileSize,b=this.zoomScale(this.maxZoom)*this.tileSize,A=this.cameraToCenterDistance;u[2]=a.aA(u[2],A/b,A/p),this._camera.position=u}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,p,b){this._unmodified=!1,this._edgeInsets.interpolate(u,p,b),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const p=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(u){const p=[new a.ct(0,u)];if(this.renderWorldCopies){const b=this.pointCoordinate(new a.P(0,0)),A=this.pointCoordinate(new a.P(this.width,0)),M=this.pointCoordinate(new a.P(this.width,this.height)),P=this.pointCoordinate(new a.P(0,this.height)),O=Math.floor(Math.min(b.x,A.x,M.x,P.x)),B=Math.floor(Math.max(b.x,A.x,M.x,P.x)),G=1;for(let j=O-G;j<=B+G;j++)j!==0&&p.push(new a.ct(j,u))}return p}isLODDisabled(u){return(!u||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(u,p,b){let A=[];const M=b!=null,P=!M;if(P&&this.zoom<p||M&&b[0]===0&&b[1]===0)return A;const O=new Set,B=(j,X,W,K,tt)=>{const rt=a.cX(X,j,W,K,tt);O.has(rt)||(A.push(new a.aP(j,X,W,K,tt)),O.add(rt))};for(let j=0;j<u.length;j++){const X=u[j];if(P&&X.canonical.z!==p)continue;const W=X.canonical,K=X.overscaledZ,tt=X.wrap,rt=1<<W.z,ht=W.x+1<rt,st=W.x>0,gt=W.y+1<rt,xt=W.y>0,vt=X.wrap-(st?0:1),Pt=X.wrap+(ht?0:1),wt=st?W.x-1:rt-1,Rt=ht?W.x+1:0;if(M)b[0]<0?(B(K,Pt,W.z,Rt,W.y),b[1]<0&&gt&&(B(K,tt,W.z,W.x,W.y+1),B(K,Pt,W.z,Rt,W.y+1)),b[1]>0&&xt&&(B(K,tt,W.z,W.x,W.y-1),B(K,Pt,W.z,Rt,W.y-1))):b[0]>0?(B(K,vt,W.z,wt,W.y),b[1]<0&&gt&&(B(K,tt,W.z,W.x,W.y+1),B(K,vt,W.z,wt,W.y+1)),b[1]>0&&xt&&(B(K,tt,W.z,W.x,W.y-1),B(K,vt,W.z,wt,W.y-1))):b[1]<0&&gt?B(K,tt,W.z,W.x,W.y+1):xt&&B(K,tt,W.z,W.x,W.y-1);else{const Mt=X.visibleQuadrants;1&Mt&&(B(K,vt,W.z,wt,W.y),xt&&(B(K,tt,W.z,W.x,W.y-1),B(K,vt,W.z,wt,W.y-1))),2&Mt&&(B(K,Pt,W.z,Rt,W.y),xt&&(B(K,tt,W.z,W.x,W.y-1),B(K,Pt,W.z,Rt,W.y-1))),4&Mt&&(B(K,vt,W.z,wt,W.y),gt&&(B(K,tt,W.z,W.x,W.y+1),B(K,vt,W.z,wt,W.y+1))),8&Mt&&(B(K,Pt,W.z,Rt,W.y),gt&&(B(K,tt,W.z,W.x,W.y+1),B(K,Pt,W.z,Rt,W.y+1)))}}const G=[];for(const j of A)A.some(X=>j.isChildOf(X))||G.push(j);if(A=G.filter(j=>!u.some(X=>!!(j.overscaledZ<p&&X.isChildOf(j))||j.equals(X)||j.isChildOf(X))),P){const j=1<<p,X=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[j*X.x,j*X.y],K=4,tt=K*K;A=A.filter(rt=>{const ht=rt.canonical.x+.5-W[0],st=rt.canonical.y+.5-W[1];return ht*ht+st*st<tt})}return A}extendTileCoverToNearPlane(u,p,b){const A=[],M=new Set;for(const gt of u)M.add(gt.key);const P=(gt,xt,vt,Pt,wt)=>{const Rt=a.cX(xt,gt,vt,Pt,wt);M.has(Rt)||(A.push(new a.aP(gt,xt,vt,Pt,wt)),M.add(Rt))},O=u.reduce((gt,xt)=>Math.max(gt,xt.overscaledZ),b),B=1<<b,G=[new a.P(0,0),new a.P(a.al,0),new a.P(a.al,a.al),new a.P(0,a.al)],j=new a.P(0,0),X=new a.P(0,0),W=(gt,xt)=>{const vt=Math.floor(gt[0]),Pt=Math.floor(gt[1]),wt=(gt[0]-vt)*a.al,Rt=(gt[1]-Pt)*a.al,Mt=Math.floor(xt[0]),At=Math.floor(xt[1]),kt=(xt[0]-Mt)*a.al,qt=(xt[1]-At)*a.al;for(let jt=-1;jt<=1;jt++){const oe=vt+jt;if(!(oe<0||oe>=B)){j.x=wt-jt*a.al,X.x=kt-(oe-Mt)*a.al;for(let te=-1;te<=1;te++){const fe=Pt+te;j.y=Rt-te*a.al,X.y=qt-(fe-At)*a.al,a.cY(j,X,G)&&P(O,0,b,oe,fe)}}}},K=p.points,tt=K[a.cu],rt=K[a.cv],ht=this._projectToGround(tt,K[a.cw]),st=this._projectToGround(rt,K[a.cx]);return W(tt,ht),W(rt,st),A}_projectToGround(u,p){return a.cy(a.cz(),u,p,u[2]/(u[2]-p[2]))}coveringTiles(u){let p=this.coveringZoomLevel(u);const b=p,A=this.elevation&&this.elevation.exaggeration(),M=A&&!u.isTerrainDEM,P=this.projection.name==="mercator";if(u.minzoom!==void 0&&p<u.minzoom)return[];u.maxzoom!==void 0&&p>u.maxzoom&&(p=u.maxzoom);const O=this.locationCoordinate(this.center),B=this.center.lat,G=1<<p,j=[G*O.x,G*O.y,0],X=this.projection.name==="globe",W=!X,K=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,W),tt=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),rt=G*a.ce(1,this.center.lat),ht=this._camera.position[2]/a.ce(1,this.center.lat),st=[G*tt.x,G*tt.y,ht*(W?1:rt)],gt=X||A,xt=this.cameraToCenterDistance/u.tileSize*(u.roundZoom?1:.502),vt=this.isLODDisabled(!0)?p:0;let Pt;if(this._elevation&&u.isTerrainDEM)Pt=1e4*this._elevation.exaggeration();else if(this._elevation){const Gt=this._elevation.getMinMaxForVisibleTiles();Pt=Gt?Gt.max:this._centerAltitude}else Pt=this._centerAltitude;const wt=u.isTerrainDEM?-Pt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Rt=this.projection.isReprojectedInTileSpace?a.cB(this):1,Mt=Gt=>{const ee=new a.ae(Gt.x+25e-6,Gt.y,Gt.z),Ae=new a.ae(Gt.x,Gt.y+25e-6,Gt.z),Ge=Gt.toLngLat(),ui=ee.toLngLat(),Le=Ae.toLngLat(),Fe=this.locationCoordinate(Ge),hi=this.locationCoordinate(ui),ai=this.locationCoordinate(Le),ii=Math.hypot(hi.x-Fe.x,hi.y-Fe.y),oi=Math.hypot(ai.x-Fe.x,ai.y-Fe.y);return Math.sqrt(ii*oi)*Rt/25e-6},At=Gt=>{const pe=Pt,ee=wt;return{aabb:a.cE(this,G,0,0,0,Gt,ee,pe,this.projection),zoom:0,x:0,y:0,minZ:ee,maxZ:pe,wrap:Gt,fullyVisible:!1}},kt=[];let qt=[];const jt=p,oe=u.reparseOverscaled?b:p,te=(ht-this._centerAltitude)*rt,fe=Gt=>{if(!this._elevation||!Gt.tileID||!P)return;const pe=this._elevation.getMinMaxForTile(Gt.tileID),ee=Gt.aabb;pe?(ee.min[2]=pe.min,ee.max[2]=pe.max,ee.center[2]=(ee.min[2]+ee.max[2])/2):(Gt.shouldSplit=Qt(Gt),Gt.shouldSplit||(ee.min[2]=ee.max[2]=ee.center[2]=this._centerAltitude))},ze=(Gt,pe)=>{if(.707*pe<Gt)return 1;const ee=pe/Gt;return ee/(1.4144271570014144+(Math.pow(1.1,ee-1.4144271570014144+1)-1)/(1.1-1)-1)},Qt=Gt=>{if(Gt.zoom<vt)return!0;if(Gt.zoom===jt)return!1;if(Gt.shouldSplit!=null)return Gt.shouldSplit;const pe=Gt.aabb.distanceX(st),ee=Gt.aabb.distanceY(st);let Ae=te,Ge=1;if(X){Ae=Gt.aabb.distanceZ(st);const oi=Math.pow(2,Gt.zoom),Di=a.a_((Gt.y+1)/oi),mr=a.a_(Gt.y/oi),Ir=Math.min(Math.max(B,Di),mr),an=a.d0(Ir)/a.d0(B);if(Ge=Ir===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,an/this._mercatorScaleRatio),this.zoom<=a.cZ&&Gt.zoom===jt-1&&an>=.9)return!0}else if(M&&(Ae=Gt.aabb.distanceZ(st)*rt),this.projection.isReprojectedInTileSpace&&b<=5){const oi=Math.pow(2,Gt.zoom),Di=Mt(new a.ae((Gt.x+.5)/oi,(Gt.y+.5)/oi));Ge=Di>.85?1:Di}if(!P&&!X){const oi=Math.sqrt(pe*pe+ee*ee+Ae*Ae);let Di=(1<<jt-Gt.zoom)*xt*Ge;return Di*=ze(Math.max(Ae,te),oi),oi<Di}let ui=Number.MAX_VALUE,Le=0;const Fe=Gt.aabb.getCorners(),hi=[];for(const oi of Fe){a.av(hi,oi,st),X||(M?hi[2]*=rt:hi[2]=te);const Di=a.bI(hi,this._camera.forward());Di<ui&&(ui=Di,Le=Math.abs(hi[2]))}let ai=(1<<jt-Gt.zoom)*xt*Ge;if(ai*=ze(Math.max(Le,te),ui),ui<ai)return!0;const ii=Gt.aabb.closestPoint(j);return ii[0]===j[0]&&ii[1]===j[1]};if(this.renderWorldCopies)for(let Gt=1;Gt<=3;Gt++)kt.push(At(-Gt)),kt.push(At(Gt));for(kt.push(At(0));kt.length>0;){const Gt=kt.pop(),pe=Gt.x,ee=Gt.y;let Ae=Gt.fullyVisible;const Ge=()=>this.projection.name==="globe"&&(Gt.y===0||Gt.y===(1<<Gt.zoom)-1);if(!Ae){let ui=gt?Gt.aabb.intersects(K):Gt.aabb.intersectsFlat(K);if(ui===0&&Ge()){const Le=new a.cC(Gt.zoom,pe,ee);ui=a.cD(this,G,Le,!0).intersects(K)}if(ui===0)continue;Ae=ui===2}if(Gt.zoom!==jt&&Qt(Gt))for(let ui=0;ui<4;ui++){const Le=(pe<<1)+ui%2,Fe=(ee<<1)+(ui>>1),hi={aabb:P?Gt.aabb.quadrant(ui):a.cE(this,G,Gt.zoom+1,Le,Fe,Gt.wrap,Gt.minZ,Gt.maxZ,this.projection),zoom:Gt.zoom+1,x:Le,y:Fe,wrap:Gt.wrap,fullyVisible:Ae,tileID:void 0,shouldSplit:void 0,minZ:Gt.minZ,maxZ:Gt.maxZ};M&&!X&&(hi.tileID=new a.aP(Gt.zoom+1===jt?oe:Gt.zoom+1,Gt.wrap,Gt.zoom+1,Le,Fe),fe(hi)),kt.push(hi)}else{const ui=Gt.zoom===jt?oe:Gt.zoom;if(u.minzoom&&u.minzoom>ui)continue;let Le=0;if(!Ae){let ii=gt?Gt.aabb.intersectsPrecise(K):Gt.aabb.intersectsPreciseFlat(K);if(ii===0&&Ge()){const oi=new a.cC(Gt.zoom,pe,ee);ii=a.cD(this,G,oi,!0).intersectsPrecise(K)}if(ii===0)continue;if(u.calculateQuadrantVisibility)if(K.containsPoint(Gt.aabb.center))Le=15;else for(let oi=0;oi<4;oi++)Gt.aabb.quadrant(oi).intersects(K)!==0&&(Le|=1<<oi)}const Fe=j[0]-(.5+pe+(Gt.wrap<<Gt.zoom))*(1<<p-Gt.zoom),hi=j[1]-.5-ee,ai=Gt.tileID?Gt.tileID:new a.aP(ui,Gt.wrap,Gt.zoom,pe,ee);u.calculateQuadrantVisibility&&(ai.visibleQuadrants=Le),qt.push({tileID:ai,distanceSq:Fe*Fe+hi*hi})}}if(this.fogCullDistSq){const Gt=this.fogCullDistSq,pe=this.horizonLineFromTop();qt=qt.filter(ee=>{const Ae=[0,0,0,1],Ge=[a.al,a.al,0,1],ui=this.calculateFogTileMatrix(ee.tileID.toUnwrapped());a.aC(Ae,Ae,ui),a.aC(Ge,Ge,ui);const Le=a.cF([],Ae,Ge),Fe=a.cG([],Ae,Ge),hi=a.c_(Le,Fe);if(hi===0)return!0;let ai=!1;const ii=this._elevation;if(ii&&hi>Gt&&pe!==0){const oi=this.calculateProjMatrix(ee.tileID.toUnwrapped());let Di;u.isTerrainDEM||(Di=ii.getMinMaxForTile(ee.tileID)),Di||(Di={min:wt,max:Pt});const mr=a.cH(this.rotation),Ir=[mr[0]*a.al,mr[1]*a.al,Di.max];a.af(Ir,Ir,oi),ai=(1-Ir[1])*this.height*.5<pe}return hi<Gt||ai})}return qt.sort((Gt,pe)=>Gt.distanceSq-pe.distanceSq).map(Gt=>Gt.tileID)}resize(u,p){this.width=u,this.height=p,this.pixelsToGLUnits=[2/u,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log2(u)}project(u){const p=a.aA(u.lat,-a.cI,a.cI),b=this.projection.project(u.lng,p);return new a.P(b.x*this.worldSize,b.y*this.worldSize)}unproject(u){return this.projection.unproject(u.x/this.worldSize,u.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(u,p){let b,A;const M=this.centerPoint;if(this.projection.name==="globe"){const O=this.worldSize;b=(p.x-M.x)/O,A=(p.y-M.y)/O}else{const O=this.pointCoordinate(p),B=this.pointCoordinate(M);b=O.x-B.x,A=O.y-B.y}const P=this.locationCoordinate(u);this.setLocation(new a.ae(P.x-b,P.y-A))}setLocation(u){this.center=this.coordinateLocation(u),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(u,p){return this.projection.locationPoint(this,u,p)}locationPoint3D(u,p){return this.projection.locationPoint(this,u,p,!0)}pointLocation(u){return this.coordinateLocation(this.pointCoordinate(u))}pointLocation3D(u,p){return this.coordinateLocation(this.pointCoordinate3D(u,p))}locationCoordinate(u,p){const b=p?a.ce(p,u.lat):void 0,A=this.projection.project(u.lng,u.lat);return new a.ae(A.x,A.y,b)}coordinateLocation(u){return this.projection.unproject(u.x,u.y)}pointRayIntersection(u,p){const b=p??this._centerAltitude,A=[u.x,u.y,0,1],M=[u.x,u.y,1,1];a.aC(A,A,this.pixelMatrixInverse),a.aC(M,M,this.pixelMatrixInverse);const P=M[3];a.cJ(A,A,1/A[3]),a.cJ(M,M,1/P);const O=A[2],B=M[2];return{p0:A,p1:M,t:O===B?0:(b-O)/(B-O)}}screenPointToMercatorRay(u){const p=[u.x,u.y,0,1],b=[u.x,u.y,1,1];return a.aC(p,p,this.pixelMatrixInverse),a.aC(b,b,this.pixelMatrixInverse),a.cJ(p,p,1/p[3]),a.cJ(b,b,1/b[3]),p[2]=a.ce(p[2],this._center.lat)*this.worldSize,b[2]=a.ce(b[2],this._center.lat)*this.worldSize,a.cJ(p,p,1/this.worldSize),a.cJ(b,b,1/this.worldSize),new a.ax([p[0],p[1],p[2]],a.aw([],a.av([],b,p)))}rayIntersectionCoordinate(u){const{p0:p,p1:b,t:A}=u,M=a.ce(p[2],this._center.lat),P=a.ce(b[2],this._center.lat);return new a.ae(a.ak(p[0],b[0],A)/this.worldSize,a.ak(p[1],b[1],A)/this.worldSize,a.ak(M,P,A))}pointCoordinate(u,p=this._centerAltitude){return this.projection.pointCoordinate(this,u.x,u.y,p)}pointCoordinate3D(u,p){if(!this.elevation)return this.pointCoordinate(u,p);let b=this.projection.pointCoordinate3D(this,u.x,u.y);if(b)return new a.ae(b[0],b[1],b[2]);let A=0,M=this.horizonLineFromTop();if(u.y>M)return this.pointCoordinate(u,p);const P=.02*M,O=u.clone();for(let B=0;B<10&&M-A>P;B++){O.y=a.ak(A,M,.66);const G=this.projection.pointCoordinate3D(this,O.x,O.y);G?(M=O.y,b=G):A=O.y}return b?new a.ae(b[0],b[1],b[2]):this.pointCoordinate(u)}isPointAboveHorizon(u){return this.projection.isPointAboveHorizon(this,u)}isPointOnSurface(u){if(u.y<0||u.y>this.height||u.x<0||u.x>this.width)return!1;if(this.elevation||this.zoom>=a.cK)return!this.isPointAboveHorizon(u);const p=this.pointCoordinate(u);return p.y>=0&&p.y<=1}_coordinatePoint(u,p){const b=p&&this.elevation?this.elevation.getAtPointOrZero(u,this._centerAltitude):this._centerAltitude,A=[u.x*this.worldSize,u.y*this.worldSize,b+u.toAltitude(),1];return a.aC(A,A,this.pixelMatrix),A[3]>0?new a.P(A[0]/A[3],A[1]/A[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:u,left:p}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,M=this.pointLocation3D(new a.P(p,u)),P=this.pointLocation3D(new a.P(A,u)),O=this.pointLocation3D(new a.P(A,b)),B=this.pointLocation3D(new a.P(p,b));let G=Math.min(M.lng,P.lng,O.lng,B.lng),j=Math.max(M.lng,P.lng,O.lng,B.lng),X=Math.min(M.lat,P.lat,O.lat,B.lat),W=Math.max(M.lat,P.lat,O.lat,B.lat);const K=Math.pow(2,-this.zoom)/16*270,tt=this.projection.name==="globe"?1:4,rt=(ht,st,gt,xt,vt)=>{const Pt=(ht+gt)/2,wt=(st+xt)/2,Rt=new a.P(Pt,wt),{lng:Mt,lat:At}=this.pointLocation3D(Rt),kt=Math.max(0,G-Mt,X-At,Mt-j,At-W);G=Math.min(G,Mt),j=Math.max(j,Mt),X=Math.min(X,At),W=Math.max(W,At),(vt<tt||kt>K)&&(rt(ht,st,Pt,wt,vt+1),rt(Pt,wt,gt,xt,vt+1))};if(rt(p,u,A,u,1),rt(A,u,A,b,1),rt(A,b,p,b,1),rt(p,b,p,u,1),this.projection.name==="globe"){const[ht,st]=a.cL(this);ht?(W=90,j=180,G=-180):st&&(X=-90,j=180,G=-180)}return new a.aI(new a.aS(G,X),new a.aS(j,W))}_getBoundsRectangular(u,p){const{top:b,left:A}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,P=this.width-this._edgeInsets.right,O=new a.P(A,b),B=new a.P(P,b),G=new a.P(P,M),j=new a.P(A,M);let X=this.pointCoordinate(O,u),W=this.pointCoordinate(B,u);const K=this.pointCoordinate(G,p),tt=this.pointCoordinate(j,p),rt=(ht,st)=>(st.y-ht.y)/(st.x-ht.x);return X.y>1&&W.y>=0?X=new a.ae((1-tt.y)/rt(tt,X)+tt.x,1):X.y<0&&W.y<=1&&(X=new a.ae(-tt.y/rt(tt,X)+tt.x,0)),W.y>1&&X.y>=0?W=new a.ae((1-K.y)/rt(K,W)+K.x,1):W.y<0&&X.y<=1&&(W=new a.ae(-K.y/rt(K,W)+K.x,0)),new a.aI().extend(this.coordinateLocation(X)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(tt)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const u=this.elevation;if(!u.visibleDemTiles.length||u.isUsingMockSource())return this._getBoundsRectangular(0,0);const p=u.visibleDemTiles.reduce((b,A)=>{if(A.dem){const M=A.dem.tree;b.min=Math.min(b.min,M.minimums[0]),b.max=Math.max(b.max,M.maximums[0])}return b},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(p.min*u.exaggeration(),p.max*u.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(u=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,b=this.height/2-p*(1-this._horizonShift);return u?Math.max(0,b):b}getMaxBounds(){return this.maxBounds}setMaxBounds(u){this.maxBounds=u,this.minLat=-a.cI,this.maxLat=a.cI,this.minLng=-180,this.maxLng=180,u&&(this.minLat=u.getSouth(),this.maxLat=u.getNorth(),this.minLng=u.getWest(),this.maxLng=u.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aF(this.minLng)*this.tileSize,this.worldMaxX=a.aF(this.maxLng)*this.tileSize,this.worldMinY=a.aJ(this.maxLat)*this.tileSize,this.worldMaxY=a.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(u,p){return this.projection.createTileMatrix(this,p,u)}calculateDistanceTileData(u){const p=u.key,b=this._distanceTileDataCache;if(b[p])return b[p];const A=u.canonical,M=1/this.height,P=this.cameraWorldSize,O=P/this.zoomScale(A.z),B=(A.x+Math.pow(2,A.z)*u.wrap)*O,G=A.y*O,j=this.point;j.x*=P/this.worldSize,j.y*=P/this.worldSize;const X=this.angle,W=Math.sin(-X),K=-Math.cos(-X);return b[p]={bearing:[W,K],center:[(j.x-B)*M,(j.y-G)*M],scale:O/a.al*M},b[p]}calculateFogTileMatrix(u){const p=u.key,b=this._fogTileMatrixCache;if(b[p])return b[p];const A=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,u);return a.aB(A,this.worldToFogMatrix,A),b[p]=new Float32Array(A),b[p]}calculateProjMatrix(u,p=!1,b=!1){const A=u.key;let M;if(M=b?this._expandedProjMatrixCache:p?this._alignedProjMatrixCache:this._projMatrixCache,M[A])return M[A];const P=this.calculatePosMatrix(u,this.worldSize);let O;return O=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:b?this.expandedFarZProjMatrix:p?this.alignedProjMatrix:this.projMatrix,a.aB(P,O,P),M[A]=new Float32Array(P),M[A]}calculatePixelsToTileUnitsMatrix(u){const p=u.tileID.key,b=this._pixelsToTileUnitsCache;if(b[p])return b[p];const A=a.cM(u,this);return b[p]=A,b[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const u=1/this.worldSize,p=a.bp([],[u,u,u]);return a.aB(p,p,this.globeMatrix),p}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const u=this._elevation;this._updateCameraState();const p=a.ce(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(p),A=this._camera.forward(),M=a.ce(1,this._center.lat);b[2]/=M,A[2]/=M,a.aw(A,A);const P=u.raycast(b,A,u.exaggeration());if(P){const O=a.bG([],b,A,P),B=new a.ae(O[0],O[1],a.ce(O[2],a.a_(O[1]))),G=(B.z+a.ag([B.x-b[0],B.y-b[1],B.z-b[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(u=!1){if(!this._elevation)return;const p=this._elevation,b=a.ce(1,this._center.lat)*this.worldSize,A=this._computeCameraPosition(b),M=p.getAtPointOrZero(new a.ae(...A)),P=this.pixelsPerMeter/this.worldSize*M,O=this._minimumHeightOverTerrain(),B=A[2]-P;if(B<=O)if(B<0||u){const G=this.locationCoordinate(this._center,this._centerAltitude),j=[A[0],A[1],G.z-A[2]],X=a.ag(j);j[2]-=(O-B)/this._pixelsPerMercatorPixel;const W=a.ag(j);if(W===0)return;a.c4(j,j,X/W*this._pixelsPerMercatorPixel),this._camera.position=[A[0],A[1],G.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||u){const W=this.center;return W.lat=a.aA(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!u)&&(W.lng=a.aA(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const p=this._unmodified,{x:b,y:A}=this.point;let M=0,P=b,O=A;const B=this.width/2,G=this.height/2,j=this.worldMinY*this.scale,X=this.worldMaxY*this.scale;if(A-G<j&&(O=j+G),A+G>X&&(O=X-G),X-j<this.height&&(M=Math.max(M,this.height/(X-j)),O=(X+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,tt=this.worldSize/2-(W+K)/2;P=(b+tt+this.worldSize)%this.worldSize-tt,P-B<W&&(P=W+B),P+B>K&&(P=K-B),K-W<this.width&&(M=Math.max(M,this.width/(K-W)),P=(K+W)/2)}P===b&&O===A||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(P,O))),M&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let u=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(u=Math.max(u,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),u}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,p=this.projection.name==="globe",b=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ce(1,this.center.lat)/a.ce(1,a.d1));const A=a.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,A),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this.projection.zAxisUnit==="meters"?b:1,P=this._camera.getWorldToCamera(this.worldSize,M);let O;const B=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(B[8]=2*-u.x/this.width,B[9]=2*u.y/this.height,this.isOrthographic){let At=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),kt=At*this.aspect,qt=-kt,jt=-At;kt-=u.x,qt-=u.x,At+=u.y,jt+=u.y,O=this._camera.getCameraToClipOrthographic(qt,kt,jt,At,this._nearZ,this._farZ),((oe,te,fe,ze)=>{for(let Qt=0;Qt<16;Qt++)oe[Qt]=a.ak(te[Qt],fe[Qt],ze)})(O,O,B,a.c$(this.pitch>=Oh?1:this.pitch/Oh))}else O=B;const G=a.cO([],B,P);let j=a.cO([],O,P);if(this.projection.isReprojectedInTileSpace){const At=this.locationCoordinate(this.center),kt=a.bz([]);a.bq(kt,kt,[At.x*this.worldSize,At.y*this.worldSize,0]),a.aB(kt,kt,a.cP(this)),a.bq(kt,kt,[-At.x*this.worldSize,-At.y*this.worldSize,0]),a.aB(j,j,kt),a.aB(G,G,kt),this.inverseAdjustmentMatrix=a.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cR([],j,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=j,this.invProjMatrix=a.bk(new Float64Array(16),this.projMatrix),p){const At=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);At[8]=2*-u.x/this.width,At[9]=2*u.y/this.height,this.expandedFarZProjMatrix=a.cO([],At,P)}else this.expandedFarZProjMatrix=this.projMatrix;const X=a.bk([],O);this.frustumCorners=a.cS.fromInvProjectionMatrix(X,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!p);const W=new Float32Array(16);a.bz(W),a.cR(W,W,[1,-1,1]),a.cT(W,W,this._pitch),a.bA(W,W,this.angle);const K=a.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.by(K);const tt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-u.x/this.width,K[9]=2*(u.y+tt)/this.height,this.skyboxMatrix=a.aB(W,K,W);const rt=this.point,ht=rt.x,st=rt.y,gt=this.width%2/2,xt=this.height%2/2,vt=Math.cos(this.angle),Pt=Math.sin(this.angle),wt=ht-Math.round(ht)+vt*gt+Pt*xt,Rt=st-Math.round(st)+vt*xt+Pt*gt,Mt=new Float64Array(j);if(a.bq(Mt,Mt,[wt>.5?wt-1:wt,Rt>.5?Rt-1:Rt,0]),this.alignedProjMatrix=Mt,j=a.bB(),a.cR(j,j,[this.width/2,-this.height/2,1]),a.bq(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=a.bB(),a.cR(j,j,[1,-1,1]),a.bq(j,j,[-1,-1,0]),a.cR(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=a.aB(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},j=a.bk(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cU(this);const At=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.af(At,At,P),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const u=this.cameraWorldSizeForFog,p=this.cameraPixelsPerMeter,b=this._camera.position,A=1/this.height/this._pixelsPerMercatorPixel,M=[u,u,p];a.c4(M,M,A),a.c4(b,b,-1),a.cV(b,b,M);const P=a.bB();a.bq(P,P,b),a.cR(P,P,M),this.mercatorFogMatrix=P,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(u,p,A)}_computeCameraPosition(u){const p=(u=u||this.pixelsPerMeter)/this.pixelsPerMeter,b=this._camera.forward(),A=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-u/this.worldSize*this._centerAltitude;return[A.x/this.worldSize-b[0]*M,A.y/this.worldSize-b[1]*M,u/this.worldSize*this._centerAltitude-b[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(u){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),b=this._camera.position[2],A=u[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),A>0&&(M=Math.min((p-b)/A,1)),this._camera.position=a.bG([],this._camera.position,u,M),this._updateStateFromCamera()}_updateStateFromCamera(){const u=this._camera.position,p=this._camera.forward(),{pitch:b,bearing:A}=this._camera.getPitchBearing(),M=a.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,P=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.an(this._maxPitch)),O=Math.max((u[2]-M)/Math.cos(b),P),B=this._zoomFromMercatorZ(O);a.bG(u,u,p,O),this._pitch=a.aA(b,a.an(this.minPitch),a.an(this.maxPitch)),this.angle=a.bS(A,-Math.PI,Math.PI),this._setZoom(a.aA(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ae(u[0],u[1],u[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(u){return Math.pow(2,u)*this.tileSize}_mercatorZfromZoom(u){return this.cameraToCenterDistance/this._worldSizeFromZoom(u)}_minimumHeightOverTerrain(){const u=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(u)}_zoomFromMercatorZ(u){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,u)*this.tileSize))}zoomFromMercatorZAdjusted(u){let p=0,b=a.cK,A=0,M=1/0;for(;b-p>1e-6&&b>p;){const P=p+.5*(b-p),O=this.tileSize*Math.pow(2,P),B=this.getCameraToCenterDistance(this.projection,P,O),G=this.scaleZoom(B/(Math.max(0,u)*this.tileSize)),j=Math.abs(P-G);j<M&&(M=j,A=P),P<G?p=P:b=P}return A}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(u,p){const b=Math.min(u.x,p.x),A=Math.max(u.x,p.x),M=Math.min(u.y,p.y),P=Math.max(u.y,p.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const O=[new a.P(b,M),new a.P(A,P),new a.P(b,P),new a.P(A,M)],B=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const j of O){const X=this.pointRayIntersection(j);if(X.t<0)return!0;const W=this.rayIntersectionCoordinate(X);if(W.x<B||W.y<0||W.x>G||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(u,p){const b=a.ag(a.av([],this._camera.position,u)),A=this._zoomFromMercatorZ(b)+p;return b-this._mercatorZfromZoom(A)}getCameraPoint(){if(this.projection.name==="globe"){const u=function([p,b,A],M){const P=[p,b,A,1];a.aC(P,P,M);const O=P[3]=Math.max(P[3],1e-6);return P[0]/=O,P[1]/=O,P[2]/=O,P}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(u[0],u[1])}{const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,u))}}getCameraToCenterDistance(u,p=this.zoom,b=this.worldSize){const A=a.cN(u,p,this.width,this.height,1024),M=u.pixelSpaceConversion(this.center.lat,b,A);let P=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(P=a.ak(1,P,a.c$(this.pitch>=Oh?1:this.pitch/Oh))),P}getWorldToCameraMatrix(){const u=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.aB(u,u,this.globeMatrix),u}getFrustum(u){return a.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,this.projection.zAxisUnit==="meters")}}const ju=(x,u)=>{if(u>0&&x.terrain&&a.w("Cutoff is currently disabled on terrain"),u<=0||x.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const p=x.transform,b=Math.max(Math.abs(p._zoom-(x.minCutoffZoom-1)),1),A=p.isLODDisabled(!1)?a.ah(60,45,p.pitch):a.ah(30,15,p.pitch),M=p._farZ-p._nearZ,P=u*p.height,O=((1-(B=A))*p.cameraToCenterDistance+B*(p._farZ+P))*b;var B;return{shouldRenderCutoff:A<1,uniformValues:{u_cutoff_params:[p._nearZ,p._farZ,(O-p._nearZ)/M,(O-P-p._nearZ)/M]}}},ro={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class NE{constructor(u,p){this.aabb=u,this.lastCascade=p}}class VE{add(u,p){const b=this.receivers[u.key];b!==void 0?(b.aabb.min[0]=Math.min(b.aabb.min[0],p.min[0]),b.aabb.min[1]=Math.min(b.aabb.min[1],p.min[1]),b.aabb.min[2]=Math.min(b.aabb.min[2],p.min[2]),b.aabb.max[0]=Math.max(b.aabb.max[0],p.max[0]),b.aabb.max[1]=Math.max(b.aabb.max[1],p.max[1]),b.aabb.max[2]=Math.max(b.aabb.max[2],p.max[2])):this.receivers[u.key]=new NE(p,null)}clear(){this.receivers={}}get(u){return this.receivers[u.key]}computeRequiredCascades(u,p,b){const A=a.d8.fromPoints(u.points);let M=0;for(const P in this.receivers){const O=this.receivers[P];if(!O||!A.intersectsAabb(O.aabb))continue;O.aabb.min=A.closestPoint(O.aabb.min),O.aabb.max=A.closestPoint(O.aabb.max);const B=O.aabb.getCorners();for(let G=0;G<b.length;G++){let j=!0;for(const X of B){const W=[X[0]*p,X[1]*p,X[2]];if(a.af(W,W,b[G].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){j=!1;break}}if(O.lastCascade=G,M=Math.max(M,G),j)break}}return M+1}}class vg{constructor(u){this.painter=u,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new VE,this._depthMode=new fi(u.context.gl.LEQUAL,fi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,u.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),u.tp.registerParameter(ro,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),u.tp.registerParameter(ro,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),u.tp.registerParameter(ro,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),u.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const u of this._cascades)u.texture.destroy(),u.framebuffer.destroy();this._cascades=[]}updateShadowParameters(u,p){const b=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!p||!p.properties)return;const A=p.properties.get("shadow-intensity");if(!p.shadowsEnabled()||A<=0||(this._shadowLayerCount=b.style.order.reduce((tt,rt)=>{const ht=b.style._mergedLayers[rt];return tt+(ht.hasShadowPass()&&!ht.isHidden(u.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const M=b.context,P=ro.shadowMapResolution,O=ro.shadowMapResolution;if(this._cascades.length===0||ro.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let tt=0;tt<ro.cascadeCount;++tt){const rt=b._shadowMapDebug,ht=M.gl,st=M.createFramebuffer(P,O,rt,"texture"),gt=new a.T(M,{width:P,height:O,data:null},ht.DEPTH_COMPONENT16);if(st.depthAttachment.set(gt.texture),rt){const xt=new a.T(M,{width:P,height:O,data:null},ht.RGBA8);st.colorAttachment.set(xt.texture)}this._cascades.push({framebuffer:st,texture:gt,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cA,scale:0})}}this.shadowDirection=aT(p);let B=0;if(u.elevation){const tt=u.elevation,rt=[1e4,-1e4];tt.visibleDemTiles.filter(ht=>ht.dem).forEach(ht=>{const st=ht.dem.tree;rt[0]=Math.min(rt[0],st.minimums[0]),rt[1]=Math.max(rt[1],st.maximums[0])}),rt[0]!==1e4&&(B=(rt[1]-rt[0])*tt.exaggeration())}const G=1.5*u.cameraToCenterDistance,j=3*G,X=new Float64Array(16);for(let tt=0;tt<this._cascades.length;++tt){const rt=this._cascades[tt];let ht=u.height/50,st=1;ro.cascadeCount===1?st=j:tt===0?st=G:(ht=G,st=j);const[gt,xt]=oT(u,this.shadowDirection,ht,st,ro.shadowMapResolution,B);rt.scale=u.scale,rt.matrix=gt,rt.boundingSphereRadius=xt,a.bk(X,rt.matrix),rt.frustum=a.cA.fromInvProjectionMatrix(X,1,0,!0),rt.far=st}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=A,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ro.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ro.shadowMapResolution,this._uniformValues.u_shadowmap_0=io.ShadowMap0,this._uniformValues.u_shadowmap_1=io.ShadowMap0+1,this._groundShadowTiles=b.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const K=b.transform.elevation;for(const tt of this._groundShadowTiles){let rt={min:0,max:0};if(K){const ht=K.getMinMaxForTile(tt);ht&&(rt=ht)}this.addShadowReceiver(tt.toUnwrapped(),rt.min,rt.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(u){this._enabled=u}drawShadowPass(u,p){if(!this.enabled)return;const b=this.painter,A=b.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(b.transform.getFrustum(0),b.transform.worldSize,this._cascades),A.viewport.set([0,0,ro.shadowMapResolution,ro.shadowMapResolution]);for(let M=0;M<this._numCascadesToRender;++M){b.currentShadowCascade=M,A.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),A.clear({color:a.ao.white,depth:1});for(const P of u.order){const O=u._mergedLayers[P];if(!O.hasShadowPass()||O.isHidden(b.transform.zoom))continue;const B=u.getLayerSourceCache(O),G=B?p[B.id]:void 0;(O.type==="model"||G&&G.length)&&b.renderLayer(b,B,O,G)}}b.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const u=this.painter,p=u.style,b=u.context,A=b.gl,M=p.directionalLight,P=p.ambientLight;if(!M||!P)return;const O=[],B=ju(u,u.longestCutoffRange);B.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),O.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&O.push("NORMAL_OFFSET");const G=bl(p,M,P),j=new fi(A.LEQUAL,fi.ReadOnly,u.depthRangeFor3D),X=new $i({func:A.EQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.KEEP);for(const W of this._groundShadowTiles){const K=W.toUnwrapped(),tt=u.isTileAffectedByFog(W),rt=u.getOrCreateProgram("groundShadow",{defines:O,overrideFog:tt});this.setupShadows(K,rt),u.uploadCommonUniforms(b,rt,K,null,B);const ht={u_matrix:u.transform.calculateProjMatrix(K),u_ground_shadow_factor:G};rt.draw(u,A.TRIANGLES,j,X,lr.multiply,Ni.disabled,ht,"ground_shadow",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments,null,u.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?lr.unblended:lr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(u){const p=this.painter.transform,b=p.calculatePosMatrix(u,p.worldSize);return a.aB(b,this._cascades[this.painter.currentShadowCascade].matrix,b),Float32Array.from(b)}calculateShadowPassMatrixFromMatrix(u){const p=a.by(u);return a.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,u),p}setupShadows(u,p,b){if(!this.enabled)return;const A=this.painter.transform,M=this.painter.context,P=M.gl,O=this._uniformValues,B=new Float64Array(16),G=A.calculatePosMatrix(u,A.worldSize);for(let j=0;j<this._cascades.length;j++)a.aB(B,this._cascades[j].matrix,G),O[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),M.activeTexture.set(P.TEXTURE0+io.ShadowMap0+j),this._cascades[j].texture.bindExtraParam(P.LINEAR,P.LINEAR,P.CLAMP_TO_EDGE,P.CLAMP_TO_EDGE,P.GREATER);if(this.useNormalOffset=!!b,this.useNormalOffset){const j=a.d6(u.canonical),X=2/A.tileSize*a.al/ro.shadowMapResolution,W=X*this._cascades[0].boundingSphereRadius,K=X*this._cascades[this._cascades.length-1].boundingSphereRadius,tt=(b==="vector-tile"?1:3)*function(rt,ht,st,gt,xt){const vt=a.aA((rt-22)/-22,0,1);return .125*(1-vt)+4*vt}(A.zoom);O.u_shadow_normal_offset=[j,W*tt,K*tt],O.u_shadow_bias=[1e-4,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(M,O)}setupShadowsFromMatrix(u,p,b=!1){if(!this.enabled)return;const A=this.painter.context,M=A.gl,P=this._uniformValues,O=new Float64Array(16);for(let B=0;B<ro.cascadeCount;B++)a.aB(O,this._cascades[B].matrix,u),P[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),A.activeTexture.set(M.TEXTURE0+io.ShadowMap0+B),this._cascades[B].texture.bindExtraParam(M.LINEAR,M.LINEAR,M.CLAMP_TO_EDGE,M.CLAMP_TO_EDGE,M.GREATER);if(this.useNormalOffset=b,b){const B=ro.normalOffset;P.u_shadow_normal_offset=[1,B,B],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];p.setShadowUniformValues(A,P)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(u,p,b,A){if(A[2]>=0)return{};const M=function(B,G,j){const X=j/(1<<B.canonical.z);return new a.d8([B.canonical.x*X+B.wrap*j,B.canonical.y*X+B.wrap*j,0],[(B.canonical.x+1)*X+B.wrap*j,(B.canonical.y+1)*X+B.wrap*j,G])}(u,p,b).getCorners(),P=p/-A[2];A[0]<0?(a.d7(M[0],M[0],[A[0]*P,0,0]),a.d7(M[3],M[3],[A[0]*P,0,0])):A[0]>0&&(a.d7(M[1],M[1],[A[0]*P,0,0]),a.d7(M[2],M[2],[A[0]*P,0,0])),A[1]<0?(a.d7(M[0],M[0],[0,A[1]*P,0]),a.d7(M[1],M[1],[0,A[1]*P,0])):A[1]>0&&(a.d7(M[2],M[2],[0,A[1]*P,0]),a.d7(M[3],M[3],[0,A[1]*P,0]));const O={};return O.vertices=M,O.planes=[Ic(M[1],M[0],M[4]),Ic(M[2],M[1],M[5]),Ic(M[3],M[2],M[6]),Ic(M[0],M[3],M[7])],O}addShadowReceiver(u,p,b){this._receivers.add(u,a.d8.fromTileIdAndHeight(u,p,b))}getMaxCascadeForTile(u){const p=this._receivers.get(u);return p&&p.lastCascade?p.lastCascade:0}}function Ic(x,u,p){const b=a.av([],p,u),A=a.av([],x,u),M=a.bH([],b,A),P=a.ag(M);return P===0?[0,0,1,0]:(a.c4(M,M,1/P),[M[0],M[1],M[2],-a.bI(M,u)])}function aT(x){const u=x.properties.get("direction"),p=a.d3(u.x,u.y,u.z);p[2]=a.aA(p[2],0,75);const b=a.d5([p[0],p[1],p[2]]);return a.d4(b.x,b.y,b.z)}function bl(x,u,p){const b=u.properties.get("color-use-theme")==="none",A=u.properties.get("color"),M=u.properties.get("intensity"),P=u.properties.get("direction"),O=[P.x,P.y,P.z],B=p.properties.get("color-use-theme")==="none",G=p.properties.get("color"),j=p.properties.get("intensity"),X=Math.max(a.bI([0,0,1],O),0),W=[0,0,0];a.c4(W,G.toPremultipliedRenderColor(B?null:x.getLut(u.scope)).toArray01Linear().slice(0,3),j);const K=[0,0,0];return a.c4(K,A.toPremultipliedRenderColor(b?null:x.getLut(p.scope)).toArray01Linear().slice(0,3),X*M),a.da([W[0]>0?W[0]/(W[0]+K[0]):0,W[1]>0?W[1]/(W[1]+K[1]):0,W[2]>0?W[2]/(W[2]+K[2]):0])}function oT(x,u,p,b,A,M){const P=x.zoom,O=x.scale,B=x.worldSize,G=1/B,j=x.aspect,X=Math.sqrt(1+j*j)*Math.tan(.5*x.fovX),W=X*X,K=b-p,tt=b+p;let rt,ht;W>K/tt?(rt=b,ht=b*X):(rt=.5*tt*(1+W),ht=.5*Math.sqrt(K*K+2*(b*b+p*p)*W+tt*tt*W*W));const st=x.projection.pixelsPerMeter(x.center.lat,B),gt=x._camera.getCameraToWorldMercator(),xt=[0,0,-rt*G];a.af(xt,xt,gt);let vt=ht*G;const Pt=x._edgeInsets;if(!(Pt.left===0&&Pt.top===0&&Pt.right===0&&Pt.bottom===0||Pt.left===Pt.right&&Pt.top===Pt.bottom)){const Ae=x._camera.getWorldToCamera(x.worldSize,x.projection.zAxisUnit==="meters"?st:1),Ge=x._camera.getCameraToClipPerspective(x._fov,x.width/x.height,p,b);Ge[8]=2*-x.centerOffset.x/x.width,Ge[9]=2*x.centerOffset.y/x.height;const ui=new Float64Array(16);a.cO(ui,Ge,Ae);const Le=new Float64Array(16);a.bk(Le,ui);const Fe=a.cA.fromInvProjectionMatrix(Le,B,P,!0);for(const hi of Fe.points){const ai=((wt=hi)[0]/=O,wt[1]/=O,wt[2]=a.ce(wt[2],x._center.lat),wt);vt=Math.max(vt,a.c5(a.d9([],xt,ai)))}}var wt;vt*=A/(A-1);const Rt=Math.acos(u[2]),Mt=Math.atan2(-u[0],-u[1]),At=new qv;At.position=xt,At.setPitchBearing(Rt,Mt);const kt=At.getWorldToCamera(B,st),qt=vt*B,jt=Math.min(x._mercatorZfromZoom(17)*B*-2,-2*qt),oe=At.getCameraToClipOrthographic(-qt,qt,-qt,qt,jt,(qt+M*st)/u[2]),te=new Float64Array(16);a.aB(te,oe,kt);const fe=a.d4(Math.floor(1e6*xt[0])/1e6*B,Math.floor(1e6*xt[1])/1e6*B,0),ze=.5*A,Qt=[0,0,0];a.af(Qt,fe,te),a.c4(Qt,Qt,ze);const Gt=[Math.floor(Qt[0]),Math.floor(Qt[1]),Math.floor(Qt[2])],pe=[0,0,0];a.av(pe,Qt,Gt),a.c4(pe,pe,-1/ze);const ee=new Float64Array(16);return a.bz(ee),a.bq(ee,ee,pe),a.aB(te,ee,te),[te,qt]}class Xv extends a.E{constructor(u){super(),this.requestManager=u,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(u,p){return a.db(this.requestManager.transformRequest(p,a.R.Model).url).then(b=>{if(!b)return;const A=a.dc(b),M=new a.dd(u,p,void 0,void 0,A);return M.computeBoundsAndApplyParent(),M}).catch(b=>{if(b&&b.status===404)return null;this.fire(new a.y(new Error(`Could not load model ${u} from ${p}: ${b.message}`)))})}load(u,p,b={forceReload:!1}){this.models[p]||(this.models[p]={});const A=Object.keys(u),M=[],P=[];for(const O of A){const B=u[O];this.hasURLBeenRequested(B)&&!b.forceReload||(this.modelByURL[B]={modelId:O,scope:p},M.push(this.loadModel(O,B)),P.push(O)),this.models[p][O]||(this.models[p][O]={model:null,numReferences:1})}this.numModelsLoading[p]=(this.numModelsLoading[p]||0)+P.length,Promise.allSettled(M).then(O=>{for(let B=0;B<O.length;B++){const{status:G}=O[B];if(G==="rejected")continue;const{value:j}=O[B];this.models[p][P[B]]||(this.models[p][P[B]]={model:null,numReferences:1}),this.models[p][P[B]].model=j}this.numModelsLoading[p]-=P.length,this.fire(new a.z("data",{dataType:"style"}))}).catch(O=>{this.fire(new a.y(new Error(`Could not load models: ${O.message}`)))})}isLoaded(){for(const u in this.numModelsLoading)if(this.numModelsLoading[u]>0)return!1;return!0}hasModel(u,p,b={exactIdMatch:!1}){return!!(b.exactIdMatch?this.getModel(u,p):this.getModelByURL(this.modelUris[p][u]))}getModel(u,p){return this.models[p]||(this.models[p]={}),this.models[p][u]?this.models[p][u].model:void 0}getModelByURL(u){if(!u)return null;const p=this.modelByURL[u];return p?this.models[p.scope][p.modelId].model:null}hasModelBeenAdded(u,p){return this.models[p]&&this.models[p][u]!==void 0}getModelURIs(u){return this.modelUris[u]||{}}addModel(u,p,b){this.models[b]||(this.models[b]={}),this.modelUris[b]||(this.modelUris[b]={});const A=this.requestManager.normalizeModelURL(p);if((this.hasModel(u,b,{exactIdMatch:!0})||this.hasModelBeenAdded(u,b))&&this.modelUris[b][u]===A)this.models[b][u].numReferences++;else if(this.hasURLBeenRequested(A)){const{scope:M,modelId:P}=this.modelByURL[A];this.models[M][P].numReferences++}else this.modelUris[b][u]=A,this.load({[u]:this.modelUris[b][u]},b)}addModelURLs(u,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const b=this.modelUris[p];for(const A in u)b[A]=this.requestManager.normalizeModelURL(u[A])}reloadModels(u){this.load(this.modelUris[u],u,{forceReload:!0})}addModelsFromBucket(u,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const b={};for(const A of u)this.hasModel(A,p,{exactIdMatch:!0})||this.hasURLBeenRequested(A)?this.models[p][A].numReferences++:this.modelUris[p][A]&&!this.hasURLBeenRequested(A)?b[A]=this.modelUris[p][A]:!this.hasURLBeenRequested(A)&&a.de(A,!1)&&(this.modelUris[p][A]=this.requestManager.normalizeModelURL(A),b[A]=this.modelUris[p][A]);this.load(b,p)}hasURLBeenRequested(u){return this.modelByURL[u]!==void 0}removeModel(u,p,b=!1,A=!1){if(this.models[p]&&this.models[p][u]&&(this.models[p][u].numReferences--,this.models[p][u].numReferences===0||A)){const M=this.modelUris[p][u];b||delete this.modelUris[p][u],delete this.modelByURL[M];const P=this.models[p][u].model;if(!P)return;delete this.models[p][u],P.destroy()}}destroy(){for(const u of Object.keys(this.models))for(const p of Object.keys(this.models[u])){const b=this.models[u][p].model;delete this.models[u][p],b&&b.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(u){return this.models[u]||(this.models[u]={}),Object.keys(this.models[u])}upload(u,p){this.models[p]||(this.models[p]={});for(const b in this.models[p])this.models[p][b].model&&this.models[p][b].model.upload(u.context)}}const _g=a.a6.colorTheme,Cc=new a.a9({data:new a.aa(_g.data)});function UE(x){if(!x.metadata||!x.metadata.content_area)return;const u=a.o.devicePixelRatio,{left:p,top:b,width:A,height:M}=x.metadata.content_area,P=p*u,O=b*u;return[P,O,P+A*u,O+M*u]}function sT(x){if(x)return x.map(([u,p])=>[u*a.o.devicePixelRatio,p*a.o.devicePixelRatio])}class GE{constructor(u,p,b){this.id=u,this.scope=p,this.sourceCache=b,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(u){this.missingRequests.has(u.name)||this.pendingRequests.has(u.name)||this.pendingRequests.add(u.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const u=new Map;if(!this.sourceCache.loaded())return u;const p=this.sourceCache.getVisibleCoordinates();if(p.length===0)return u;const b=this.sourceCache.getSource();if(!(b instanceof Ga))return u;const A=p.map(P=>this.sourceCache.getTile(P)),M=b.getImages(A,Array.from(this.pendingRequests));for(const[P,O]of M)u.set(a.I.from({name:P,iconsetId:this.id}),O),this.pendingRequests.delete(P);for(const P of this.pendingRequests)this.missingRequests.add(P);return this.pendingRequests.clear(),u}}const Mc=(x,u)=>ot(x,u&&u.filter(p=>p.identifier!=="source.canvas")),HE=a.aH(Ur,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),dx=a.aH(Ur,["setCenter","setZoom","setBearing","setPitch"]),Yv=new Set(["background","sky","slot","custom"]),fx={version:8,layers:[],sources:{}},px={duration:300,delay:0};class wl extends a.E{constructor(u,p={}){super(),this.map=u,this.scope=p.scope||"",this.globalId=null,this.fragments=[],this.importDepth=p.importDepth||0,this.importsCache=p.importsCache||new Map,this.resolvedImports=p.resolvedImports||new Set,this.transition=Object.assign({},px),this._buildingIndex=new rx(this),this.crossTileSymbolIndex=new Hu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=p.styleChanges||new ge,this.dispatcher=p.dispatcher?p.dispatcher:new a.D(a.dg(),this),p.imageManager?this.imageManager=p.imageManager:(this.imageManager=new He(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=p.glyphManager?p.glyphManager:new a.dh(u._requestManager,p.localFontFamily?a.di.all:p.localIdeographFontFamily?a.di.ideographs:a.di.none,p.localFontFamily||p.localIdeographFontFamily),p.modelManager?this.modelManager=p.modelManager:(this.modelManager=new Xv(u._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=p.configOptions?p.configOptions:new Map,this._configDependentLayers=p.configDependentLayers?p.configDependentLayers:new Set,this._indoorDependentLayers=p.indoorDependentLayers?p.indoorDependentLayers:new Set,this._config=p.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:p.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=p.initialConfig,this.dispatcher.broadcast("setReferrer",a.dj());const b=this;this._rtlTextPluginCallback=wl.registerForPluginStateChange(A=>{b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},(M,P)=>{if(a.dk(M),P&&P.every(O=>O))for(const O in b._sourceCaches){const B=b._sourceCaches[O],G=B.getSource().type;G!=="vector"&&G!=="geojson"||B.reload()}})}),this.on("data",A=>{if(A.dataType!=="source"||A.sourceDataType!=="metadata")return;const M=this.getOwnSource(A.sourceId);if(M&&M.vectorLayerIds)for(const P in this._layers){const O=this._layers[P];O.source===M.id&&this._validateLayer(O)}})}load(u){return u?(typeof u=="string"?this.loadURL(u):this.loadJSON(u),this):this}_getGlobalId(u){if(!u)return null;if(typeof u=="string"){if(a.h(u))return u;const p=a.dl(u);if(!p.startsWith("http"))try{return new URL(p,location.href).toString()}catch{return p}return p}return`json://${a.dm(JSON.stringify(u))}`}_diffStyle(u,p,b){this.globalId=this._getGlobalId(u);const A=(M,P)=>{try{P(null,this.setState(M,b))}catch(O){P(O,!1)}};if(typeof u=="string"){const M=this.map._requestManager.normalizeStyleURL(u),P=this.map._requestManager.transformRequest(M,a.R.Style);a.m(P,(O,B)=>{O?this.fire(new a.y(O)):B&&A(B,p)})}else typeof u=="object"&&A(u,p)}loadURL(u,p={}){this.fire(new a.z("dataloading",{dataType:"style"}));const b=typeof p.validate=="boolean"?p.validate:!a.h(u);this.globalId=this._getGlobalId(u),u=this.map._requestManager.normalizeStyleURL(u,p.accessToken),this.resolvedImports.add(u);const A=this.importsCache.get(u);if(A)return this._load(A,b);const M=this.map._requestManager.transformRequest(u,a.R.Style);this._request=a.m(M,(P,O)=>{if(this._request=null,P)this.fire(new a.y(P));else if(O)return this.importsCache.set(u,O),this._load(O,b)})}loadJSON(u,p={}){this.fire(new a.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(u),this._request=a.o.frame(()=>{this._request=null,this._load(u,p.validate!==!1)})}loadEmpty(){this.fire(new a.z("dataloading",{dataType:"style"})),this._load(fx,!1)}_loadImports(u,p,b){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const A=[];for(const M of u){const P=this._createFragmentStyle(M),O=new Promise(j=>{P.once("style.import.load",j),P.once("error",j)}).then(()=>this.mergeAll());if(A.push(O),this.resolvedImports.has(M.url)){P.loadEmpty();continue}const B=M.data||this.importsCache.get(M.url);B?(P.loadJSON(B,{validate:p}),this._isInternalStyle(B)&&(P.globalId=null)):M.url?P.loadURL(M.url,{validate:p}):P.loadEmpty();const G={style:P,id:M.id,config:M.config};if(b){const j=this.fragments.findIndex(({id:X})=>X===b);this.fragments=this.fragments.slice(0,j).concat(G).concat(this.fragments.slice(j))}else this.fragments.push(G)}return Promise.allSettled(A)}getImportGlobalIds(u=this,p=new Set){for(const b of u.fragments)b.style.globalId&&p.add(b.style.globalId),this.getImportGlobalIds(b.style,p);return[...p.values()]}_createFragmentStyle(u){const p=this.scope?a.B(u.id,this.scope):u.id;let b;const A=this._initialConfig&&this._initialConfig[p];(u.config||A)&&(b=Object.assign({},u.config,A));const M=new wl(this.map,{scope:p,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:b,configOptions:this.options,colorThemeOverride:u["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return M.setEventedParent(this.map,{style:M}),M}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(u){return this.isRootStyle()&&(u.fragment||!!u.schema&&u.fragment!==!1)}_load(u,p){if(this._isInternalStyle(u)){const M=Object.assign({},fx,{imports:[{id:"basemap",data:u,url:""}]},u.center?{center:u.center}:{},u.bearing?{bearing:u.bearing}:{},u.pitch?{pitch:u.pitch}:{},u.zoom?{zoom:u.zoom}:{},u.light?{light:u.light}:{});return this._importedAsBasemap=!0,void this._load(M,p)}if(this.updateConfig(this._config,u.schema),p&&Mc(this,Gs(u)))return;this._loaded=!0,this.stylesheet=a.dn(u);const b=()=>{for(const B in u.sources)this.addSource(B,u.sources[B],{validate:!1,isInitialLoad:!0});if(u.iconsets)for(const B in u.iconsets)this.addIconset(B,u.iconsets[B]);u.sprite?this._loadIconset(u.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&u.glyphs&&this.glyphManager.setURL(u.glyphs);const M=qd(this.stylesheet.layers);if(this._order=M.map(B=>B.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const B=this.stylesheet.lights[0];this.light=new Nt(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Nt(this.stylesheet.light)),this._layers={};for(const B of M){const G=a.dt(B,this.scope,this._styleColorTheme.lut,this.options);G.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(G.fqid),G.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(G.fqid),this._hasAppearances=this._hasAppearances||G.getAppearances().length!==0,G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G;const j=this.getOwnLayerSourceCache(G),X=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&G.canCastShadows()&&X&&(j.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.z("data",{dataType:"style"}));const O=this.isRootStyle();u.imports?this._loadImports(u.imports,p).then(()=>{this._reloadImports(),this.fire(new a.z(O?"style.load":"style.import.load"))}).catch(B=>{this.fire(new a.y(new Error("Failed to load imports",B))),this.fire(new a.z(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.z(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const A=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(A){const M=this._evaluateColorThemeData(A);this._loadColorTheme(M).then(()=>{b()}).catch(P=>{a.w(`Couldn't load color theme from the stylesheet: ${P}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let u,p,b,A,M,P,O,B,G,j;const X={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(u=W.light),W.stylesheet.lights)for(const K of W.stylesheet.lights)K.type==="ambient"&&W.ambientLight!=null&&(p=W.ambientLight),K.type==="directional"&&W.directionalLight!=null&&(b=W.directionalLight);A=this._prioritizeTerrain(A,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(M=W.fog),W.stylesheet.snow&&W.snow!=null&&(P=W.snow),W.stylesheet.rain&&W.rain!=null&&(O=W.rain),W.stylesheet.camera!=null&&(j=W.stylesheet.camera),W.stylesheet.projection!=null&&(B=W.stylesheet.projection),W.stylesheet.transition!=null&&(G=W.stylesheet.transition),X[W.scope]=W._styleColorTheme}}),this.light=u,this.ambientLight=p,this.directionalLight=b,this.fog=M,this.snow=P,this.rain=O,this._styleColorThemeForScope=X,A===null?delete this.terrain:this.terrain=A,this.camera=j||{"camera-projection":"perspective"},this.projection=B||{name:"mercator"},this.transition=Object.assign({},px,G),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(u){const p=b=>{for(const A of b.fragments)p(A.style);u(b)};p(this)}_prioritizeTerrain(u,p,b){const A=u&&u.drapeRenderMode===0;return b===null?p&&p.drapeRenderMode===0?p:A?u:null:p!=null&&(!u||A||p&&p.drapeRenderMode===1)?p:u}mergeTerrain(){let u;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{u=this._prioritizeTerrain(u,p.terrain,p.stylesheet.terrain)}),u===null?delete this.terrain:this.terrain=u}mergeProjection(){let u;this.forEachFragmentStyle(p=>{p.stylesheet.projection!=null&&(u=p.stylesheet.projection)}),this.projection=u||{name:"mercator"}}mergeSources(){const u={},p={},b={};this.forEachFragmentStyle(A=>{for(const M in A._sourceCaches){const P=a.B(M,A.scope);u[P]=A._sourceCaches[M]}for(const M in A._otherSourceCaches){const P=a.B(M,A.scope);p[P]=A._otherSourceCaches[M]}for(const M in A._symbolSourceCaches){const P=a.B(M,A.scope);b[P]=A._symbolSourceCaches[M]}}),this._mergedSourceCaches=u,this._mergedOtherSourceCaches=p,this._mergedSymbolSourceCaches=b}mergeIndoor(){this.forEachFragmentStyle(u=>{if(u.stylesheet&&u.stylesheet.indoor)for(const p of Object.values(u.stylesheet.indoor)){const b=p,A=a.B(b.sourceId,u.scope);this._mergedIndoor[A]=new Set(b.sourceLayers||[])}})}mergeLayers(){const u={},p=[],b={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(P=>{for(const O of P._order){const B=P._layers[O];if(B.type==="slot"){const G=a.dp(O);if(u[G])continue;u[G]=[]}B.slot&&u[B.slot]?u[B.slot].push(B):p.push(B)}}),this._mergedOrder=[];let A=-1;const M=(P=[])=>{for(const O of P)if(O.type==="slot"){const B=a.dp(O.id);u[B]&&M(u[B]),this._mergedSlots.push(B)}else{const B=a.B(O.id,O.scope);this._mergedOrder.push(B),b[B]=O,O.is3D(!!this.terrain)&&(this._has3DLayers=!0,A=this._mergedOrder.length-1),O.type==="circle"&&(this._hasCircleLayers=!0),O.type==="symbol"&&(this._hasSymbolLayers=!0),O.type==="clip"&&(this._clipLayerPresent=!0)}};if(M(p),this._has3DLayers){const P={};for(let O=0;O<this._mergedOrder.length;++O){const B=this._mergedOrder[O];P[B]=O===A?1:O<A?b[B].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((O,B)=>P[O]-P[B])}this._mergedLayers=b,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(u){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,u),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(u){return u.data?function(p,b,A,M){const P=Object.assign({},b);for(const B of Object.keys(_g))P[B]===void 0&&(P[B]=_g[B].default);const O=new a.a8(Cc,p,new Map(A));return O.setTransitionOrValue(P,A),O.untransitioned().possiblyEvaluate(new a.ac(0,{worldview:void 0}))}(this.scope,u,this.options).get("data"):null}_loadColorTheme(u){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const p=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((b,A)=>{const M="data:image/png;base64,";if(!u||u.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void b();let P=u;P.startsWith(M)||(P=M+P);const O=a.I.from("mapbox-reserved-lut"),B=new Image;B.src=P,B.onerror=()=>{this._styleColorTheme.lutLoading=!1,A(new Error("Failed to load image data"))},B.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==p)return void b();this._styleColorTheme.lutLoading=!1;const{width:G,height:j,data:X}=a.o.getImageData(B);if(j>32)return void A(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==j*j)return void A(new Error("The width of the image must be equal to the height squared."));this.getImage(O)&&this.removeImage(O),this.addImage(O,{data:new a.q({width:G,height:j},X),pixelRatio:1,sdf:!1,usvg:!1,version:0});const W=this.imageManager.getImage(O,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:u},b()):A(new Error("Missing LUT image."))}})}getLut(u){const p=this._styleColorThemeForScope[u];return p?p.lut:null}setProjection(u){u?this.stylesheet.projection=u:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(u){this._spriteRequest=function(p,b,A){let M,P,O;const B=a.o.devicePixelRatio>1?"@2x":"";let G=a.m(b.transformRequest(b.normalizeSpriteURL(p,B,".json"),a.R.SpriteJSON),(W,K)=>{G=null,O||(O=W,M=K,X())}),j=a.n(b.transformRequest(b.normalizeSpriteURL(p,B,".png"),a.R.SpriteImage),(W,K)=>{j=null,O||(O=W,P=K,X())});function X(){if(O)A(O);else if(M&&P){const W=a.o.getImageData(P),K={};for(const tt in M){const{width:rt,height:ht,x:st,y:gt,sdf:xt,pixelRatio:vt,stretchX:Pt,stretchY:wt,content:Rt}=M[tt],Mt=new a.q({width:rt,height:ht});a.q.copy(W,Mt,{x:st,y:gt},{x:0,y:0},{width:rt,height:ht},null),K[tt]={data:Mt,pixelRatio:vt!==void 0?vt:1,sdf:xt!==void 0&&xt,stretchX:Pt,stretchY:wt,content:Rt,usvg:!1,version:0}}A(null,K)}}return{cancel(){G&&(G.cancel(),G=null),j&&(j.cancel(),j=null)}}}(u,this.map._requestManager,(p,b)=>{if(this._spriteRequest=null,p)this.fire(new a.y(p));else if(b){const A=new Map;for(const M in b)A.set(a.I.from(M),b[M]);this.addImages(A)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))})}addIconset(u,p){if(p.type==="sprite")return void this._loadSprite(p.url);const b=this.getOwnSourceCache(p.source);if(!b)return void this.fire(new a.y(new Error(`Source "${p.source}" as specified by iconset "${u}" does not exist and cannot be used as an iconset source`)));const A=b.getSource();if(A.type!=="raster-array")return void this.fire(new a.y(new Error(`Source "${p.source}" as specified by iconset "${u}" is not a "raster-array" source and cannot be used as an iconset source`)));A.partial=!1;const M=new GE(u,this.scope,b);this.imageManager.addImageProvider(M,this.scope)}removeIconset(u){this.imageManager.removeImageProvider(u,this.scope)}_loadIconset(u){if(!a.h(u)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(u);const p=this.map._spriteFormat==="auto";var b,A;this._spriteRequest=(A=(M,P)=>{if(this._spriteRequest=null,M)p?this._loadSprite(u):this.fire(new a.y(M));else if(P){const O=new Map;for(const B in P)O.set(a.I.from(B),P[B]);this.addImages(O)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.z("data",{dataType:"style"}))},a.bt((b=this.map._requestManager).transformRequest(b.normalizeIconsetURL(u),a.R.Iconset),(M,P)=>{if(M)return void A(M);const O={},B=a.df(new a.bs(P));for(const G of B.icons){const j={version:1,pixelRatio:a.o.devicePixelRatio,content:UE(G),stretchX:G.metadata?sT(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?sT(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};O[G.name]=j}A(null,O)}))}_validateLayer(u){const p=this.getOwnSource(u.source);if(!p)return;const b=u.sourceLayer;b&&(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(b)===-1)&&this.fire(new a.y(new Error(`Source layer "${b}" does not exist on source "${p.id}" as specified by style layer "${u.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const u in this._sourceCaches)if(!this._sourceCaches[u].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:u}of this.fragments)if(!u.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((u,p)=>{const b=this.fragments[p];return b&&b.style&&(u.data=b.style.serialize()),u})}_serializeSources(){const u={};for(const p in this._sourceCaches){const b=this._sourceCaches[p].getSource();u[b.id]||(u[b.id]=b.serialize())}return u}_serializeLayers(u){const p=[];for(const b of u){const A=this._layers[b];A&&A.type!=="custom"&&p.push(A.serialize())}return p}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const u in this._sourceCaches)if(this._sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(u){return u?this.order:this._mergedOrder}isLayerDraped(u){return!!this.terrain&&u.isDraped(this.getLayerSourceCache(u))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(u){const p=this.getOwnLayer(u);if(p)return p;this.fire(new a.y(new Error(`The layer '${u}' does not exist in the map's style.`)))}_checkSource(u){const p=this.getOwnSource(u);if(p)return p;this.fire(new a.y(new Error(`The source '${u}' does not exist in the map's style.`)))}precompilePrograms(u,p){const b=this.map.painter;if(b)for(let A=u.minzoom||0;A<(u.maxzoom||25.5);A++){const M=u.getProgramIds();if(M)for(const P of M){const O=u.getDefaultProgramParams(P,p.zoom,this._styleColorTheme.lut);O&&(b.style=this,this.fog&&(b._fogVisible=!0,O.overrideFog=!0,b.getOrCreateProgram(P,O)),b._fogVisible=!1,O.overrideFog=!1,b.getOrCreateProgram(P,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,b.getOrCreateProgram(P,O)))}}}update(u){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u);const p=this.calculateLightsBrightness();u.brightness=p||0,p!==this._brightness&&(this._brightness=p,this.dispatcher.broadcast("setBrightness",p)),u.worldview!==this._worldview&&(this._worldview=u.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const b=this._changes.isDirty();let A=!1;if(this._changes.isDirty()){const O=this._changes.getLayerUpdatesByScope();for(const B in O){const{updatedIds:G,removedIds:j}=O[B];(G||j)&&(this._updateWorkerLayers(B,G,j),A=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(u),this.light&&this.light.updateTransitions(u),this.ambientLight&&this.ambientLight.updateTransitions(u),this.directionalLight&&this.directionalLight.updateTransitions(u),this.fog&&this.fog.updateTransitions(u),this.snow&&this.snow.updateTransitions(u),this.rain&&this.rain.updateTransitions(u),this._changes.reset()}const M={};for(const O in this._mergedSourceCaches){const B=this._mergedSourceCaches[O];M[O]=B.used,B.used=!1,B.tileCoverLift=0}for(const O of this._mergedOrder){const B=this._mergedLayers[O];if(B.recalculate(u,this._availableImages),!B.isHidden(u.zoom)){const G=this.getLayerSourceCache(B);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,B.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(B,u)}):this.precompilePrograms(B,u))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&A&&this.mergeLayers();const P=this.imageManager.getPendingImageProviders();for(const O of P)O.sourceCache.used=!0;for(const O in M){const B=this._mergedSourceCaches[O];M[O]!==B.used&&B.getSource().fire(new a.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:B.getSource().id}))}this.light&&this.light.recalculate(u),this.terrain&&this.terrain.recalculate(u),this.fog&&this.fog.recalculate(u),this.snow&&this.snow.recalculate(u),this.rain&&this.rain.recalculate(u),this.z=u.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),b&&this.fire(new a.z("data",{dataType:"style"}))}updateImageProviders(){const u=this.imageManager.getPendingImageProviders();for(const p of u){const b=p.resolvePendingRequests(),A=this.getFragmentStyle(p.scope);A&&A.addImages(b)}}_updateTilesForChangedImages(){const u={};for(const p in this._mergedSourceCaches){const b=this._mergedSourceCaches[p].getSource().scope;u[b]=u[b]||this._changes.getUpdatedImages(b),u[b].length!==0&&this._mergedSourceCaches[p].reloadTilesForDependencies(["icons","patterns"],u[b])}for(const p in u)this._changes.resetUpdatedImages(p)}_updateWorkerLayers(u,p,b){const A=this.getFragmentStyle(u);A&&this.dispatcher.broadcast("updateLayers",{layers:p?A._serializeLayers(p):[],scope:u,removedIds:b||[],options:A.options})}setState(u,p){if(this._checkLoaded(),Mc(this,Gs(u)))return!1;(u=a.dn(u)).layers=qd(u.layers);const b=function(P,O){if(!P)return[{command:Ur.setStyle,args:[O]}];let B=[];try{if(!a.bx(P.version,O.version))return[{command:Ur.setStyle,args:[O]}];if(a.bx(P.center,O.center)||B.push({command:Ur.setCenter,args:[O.center]}),a.bx(P.zoom,O.zoom)||B.push({command:Ur.setZoom,args:[O.zoom]}),a.bx(P.bearing,O.bearing)||B.push({command:Ur.setBearing,args:[O.bearing]}),a.bx(P.pitch,O.pitch)||B.push({command:Ur.setPitch,args:[O.pitch]}),a.bx(P.sprite,O.sprite)||B.push({command:Ur.setSprite,args:[O.sprite]}),a.bx(P.glyphs,O.glyphs)||B.push({command:Ur.setGlyphs,args:[O.glyphs]}),a.bx(P.imports,O.imports)||function(K=[],tt=[],rt){tt=tt||[];const ht=(K=K||[]).map(ag),st=tt.map(ag),gt=K.reduce(og,{}),xt=tt.reduce(og,{}),vt=ht.slice();let Pt,wt,Rt,Mt;for(Pt=0,wt=0;Pt<ht.length;Pt++)Rt=ht[Pt],xt.hasOwnProperty(Rt)?wt++:(rt.push({command:Ur.removeImport,args:[Rt]}),vt.splice(vt.indexOf(Rt,wt),1));for(Pt=0,wt=0;Pt<st.length;Pt++)Rt=st[st.length-1-Pt],vt[vt.length-1-Pt]!==Rt&&(gt.hasOwnProperty(Rt)?(rt.push({command:Ur.removeImport,args:[Rt]}),vt.splice(vt.lastIndexOf(Rt,vt.length-wt),1)):wt++,Mt=vt[vt.length-Pt],rt.push({command:Ur.addImport,args:[xt[Rt],Mt]}),vt.splice(vt.length-Pt,0,Rt));for(const At of tt){const kt=gt[At.id];kt&&(delete kt.data,a.bx(kt,At)||rt.push({command:Ur.updateImport,args:[At.id,At]}))}}(P.imports,O.imports,B),a.bx(P.transition,O.transition)||B.push({command:Ur.setTransition,args:[O.transition]}),a.bx(P.light,O.light)||B.push({command:Ur.setLight,args:[O.light]}),a.bx(P.fog,O.fog)||B.push({command:Ur.setFog,args:[O.fog]}),a.bx(P.snow,O.snow)||B.push({command:Ur.setSnow,args:[O.snow]}),a.bx(P.rain,O.rain)||B.push({command:Ur.setRain,args:[O.rain]}),a.bx(P.projection,O.projection)||B.push({command:Ur.setProjection,args:[O.projection]}),a.bx(P.lights,O.lights)||B.push({command:Ur.setLights,args:[O.lights]}),a.bx(P.camera,O.camera)||B.push({command:Ur.setCamera,args:[O.camera]}),a.bx(P.iconsets,O.iconsets)||function(K,tt,rt){let ht;for(ht in tt=tt||{},K=K||{})K.hasOwnProperty(ht)&&(tt.hasOwnProperty(ht)||rt.push({command:Ur.removeIconset,args:[ht]}));for(ht in tt){if(!tt.hasOwnProperty(ht))continue;const st=tt[ht];K.hasOwnProperty(ht)?a.bx(K[ht],st)||(rt.push({command:Ur.removeIconset,args:[ht]}),rt.push({command:Ur.addIconset,args:[ht,st]})):rt.push({command:Ur.addIconset,args:[ht,st]})}}(P.iconsets,O.iconsets,B),!a.bx(P["color-theme"],O["color-theme"]))return[{command:Ur.setStyle,args:[O]}];const G={},j=[];(function(K,tt,rt,ht){let st;for(st in tt=tt||{},K=K||{})K.hasOwnProperty(st)&&(tt.hasOwnProperty(st)||ig(st,rt,ht));for(st in tt){if(!tt.hasOwnProperty(st))continue;const gt=tt[st];K.hasOwnProperty(st)?a.bx(K[st],gt)||(K[st].type==="geojson"&&gt.type==="geojson"&&ax(K,tt,st)?rt.push({command:Ur.setGeoJSONSourceData,args:[st,gt.data]}):rg(st,tt,rt,ht)):nx(st,tt,rt)}})(P.sources,O.sources,j,G);const X=[];P.layers&&P.layers.forEach(K=>{K.source&&G[K.source]?B.push({command:Ur.removeLayer,args:[K.id]}):X.push(K)});let W=P.terrain;W&&G[W.source]&&(B.push({command:Ur.setTerrain,args:[void 0]}),W=void 0),B=B.concat(j),a.bx(W,O.terrain)||B.push({command:Ur.setTerrain,args:[O.terrain]}),function(K,tt,rt){tt=tt||[];const ht=(K=K||[]).map(ag),st=tt.map(ag),gt=K.reduce(og,{}),xt=tt.reduce(og,{}),vt=ht.slice(),Pt=Object.create(null);let wt,Rt,Mt,At,kt,qt,jt;for(wt=0,Rt=0;wt<ht.length;wt++)Mt=ht[wt],xt.hasOwnProperty(Mt)?Rt++:(rt.push({command:Ur.removeLayer,args:[Mt]}),vt.splice(vt.indexOf(Mt,Rt),1));for(wt=0,Rt=0;wt<st.length;wt++)Mt=st[st.length-1-wt],vt[vt.length-1-wt]!==Mt&&(gt.hasOwnProperty(Mt)?(rt.push({command:Ur.removeLayer,args:[Mt]}),vt.splice(vt.lastIndexOf(Mt,vt.length-Rt),1)):Rt++,qt=vt[vt.length-wt],rt.push({command:Ur.addLayer,args:[xt[Mt],qt]}),vt.splice(vt.length-wt,0,Mt),Pt[Mt]=!0);for(wt=0;wt<st.length;wt++)if(Mt=st[wt],At=gt[Mt],kt=xt[Mt],!Pt[Mt]&&!a.bx(At,kt))if(a.bx(At.source,kt.source)&&a.bx(At["source-layer"],kt["source-layer"])&&a.bx(At.type,kt.type)){for(jt in ng(At.layout,kt.layout,rt,Mt,null,Ur.setLayoutProperty),ng(At.paint,kt.paint,rt,Mt,null,Ur.setPaintProperty),a.bx(At.slot,kt.slot)||rt.push({command:Ur.setSlot,args:[Mt,kt.slot]}),a.bx(At.filter,kt.filter)||rt.push({command:Ur.setFilter,args:[Mt,kt.filter]}),a.bx(At.minzoom,kt.minzoom)&&a.bx(At.maxzoom,kt.maxzoom)||rt.push({command:Ur.setLayerZoomRange,args:[Mt,kt.minzoom,kt.maxzoom]}),At)At.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&jt!=="slot"&&(jt.indexOf("paint.")===0?ng(At[jt],kt[jt],rt,Mt,jt.slice(6),Ur.setPaintProperty):a.bx(At[jt],kt[jt])||rt.push({command:Ur.setLayerProperty,args:[Mt,jt,kt[jt]]}));for(jt in kt)kt.hasOwnProperty(jt)&&!At.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&jt!=="slot"&&(jt.indexOf("paint.")===0?ng(At[jt],kt[jt],rt,Mt,jt.slice(6),Ur.setPaintProperty):a.bx(At[jt],kt[jt])||rt.push({command:Ur.setLayerProperty,args:[Mt,jt,kt[jt]]}))}else rt.push({command:Ur.removeLayer,args:[Mt]}),qt=vt[vt.lastIndexOf(Mt)+1],rt.push({command:Ur.addLayer,args:[kt,qt]})}(X,O.layers,B)}catch(G){console.warn("Unable to compute style diff:",G),B=[{command:Ur.setStyle,args:[O]}]}return B}(this.serialize(),u).filter(P=>!(P.command in dx));if(b.length===0)return!1;const A=b.filter(P=>!(P.command in HE));if(A.length>0)throw new Error(`Unimplemented: ${A.map(P=>P.command).join(", ")}.`);const M=[];return b.forEach(P=>{M.push(this[P.command](...P.args))}),p&&Promise.all(M).then(p).catch(p),this.stylesheet=u,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(u){if(u.size===0)return this;for(const[p,b]of u.entries()){if(this.getImage(p))return this.fire(new a.y(new Error(`An image with the name "${p.name}" already exists.`)));this.imageManager.addImage(p,this.scope,b),this._changes.updateImage(p,this.scope)}return this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this}addImage(u,p){return this.getImage(u)?this.fire(new a.y(new Error(`An image with the name "${u.name}" already exists.`))):(this.imageManager.addImage(u,this.scope,p),this._changes.updateImage(u,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this)}updateImage(u,p,b=!1){this.imageManager.updateImage(u,this.scope,p),b&&(this._changes.updateImage(u,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})))}getImage(u){return this.imageManager.getImage(u,this.scope)}removeImage(u){return this.getImage(u)?(this.imageManager.removeImage(u,this.scope),this._changes.updateImage(u,this.scope),this._updateWorkerImages(),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(u){return this.modelManager.addModelURLs(u,this.scope),this._updateWorkerModels(),this.fire(new a.z("data",{dataType:"style"})),this}addModel(u,p,b={}){return this._checkLoaded(),this._validate(Kp,`models.${u}`,p,null,b)||(this.modelManager.addModel(u,p,this.scope),this.fire(new a.z("data",{dataType:"style"}))),this}hasModel(u){return this.modelManager.hasModel(u,this.scope)}removeModel(u){return this.hasModel(u)?(this.modelManager.removeModel(u,this.scope,!1,!0),this.fire(new a.z("data",{dataType:"style"})),this):this.fire(new a.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(u,p,b={}){if(this._checkLoaded(),this.getOwnSource(u)!==void 0)throw new Error(`There is already a source with ID "${u}".`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(Nv,`sources.${u}`,p,null,b))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const A=Yo(u,p,this.dispatcher,this);A.scope=this.scope,A.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(A.id),source:A.serialize(),sourceId:A.id}));const M=P=>{const O=(P?"symbol:":"other:")+A.id,B=a.B(O,this.scope),G=this._sourceCaches[O]=new _l(B,A,P);(P?this._symbolSourceCaches:this._otherSourceCaches)[A.id]=G,G.onAdd(this.map)};M(!1),p.type!=="vector"&&p.type!=="geojson"||M(!0),A.onAdd&&A.onAdd(this.map),b.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(u){this._checkLoaded();const p=this.getOwnSource(u);if(!p)throw new Error("There is no source with this ID");for(const A in this._layers)if(this._layers[A].source===u)return this.fire(new a.y(new Error(`Source "${u}" cannot be removed while layer "${A}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===u)return this.fire(new a.y(new Error(`Source "${u}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const A=Object.entries(this.stylesheet.iconsets).find(([M,P])=>P.type==="source"&&P.source===u);if(A)return this.fire(new a.y(new Error(`Source "${u}" cannot be removed while iconset "${A[0]}" is using it.`)))}const b=this.getOwnSourceCaches(u);for(const A of b){const M=a.dp(A.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(A.id),A.fire(new a.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:A.getSource().id})),A.setEventedParent(null),A.clearTiles()}return delete this._otherSourceCaches[u],delete this._symbolSourceCaches[u],this.mergeSources(),p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(u,p){this._checkLoaded(),this.getOwnSource(u).setData(p),this._changes.setDirty()}getOwnSource(u){const p=this.getOwnSourceCache(u);return p&&p.getSource()}getOwnSources(){const u=[];for(const p in this._otherSourceCaches){const b=this.getOwnSourceCache(p);b&&u.push(b.getSource())}return u}areTilesLoaded(){const u=this._mergedSourceCaches;for(const p in u){const b=u[p]._tiles;for(const A in b){const M=b[A];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}setLights(u){if(this._checkLoaded(),!u)return delete this.ambientLight,void delete this.directionalLight;const p=this._getTransitionParameters();for(const M of u){if(this._validate(Q0,"lights",M))return;switch(M.type){case"ambient":if(this.ambientLight){const P=this.ambientLight;P.set(M),P.updateTransitions(p)}else this.ambientLight=new ia(M,nn||(nn=new a.a9({color:new a.aa(a.a6.properties_light_ambient.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const P=this.directionalLight;P.set(M),P.updateTransitions(p)}else this.directionalLight=new ia(M,Yn||(Yn=new a.a9({direction:new a.ap(a.a6.properties_light_directional.direction),color:new a.aa(a.a6.properties_light_directional.color),"color-use-theme":new a.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.aa(a.a6.properties_light_directional.intensity),"cast-shadows":new a.aa(a.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new a.aa(a.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.aa(a.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const b=Object.assign(p,{worldview:this.map.getWorldview()}),A=new a.ac(this.z||0,b);this.ambientLight&&this.ambientLight.recalculate(A),this.directionalLight&&this.directionalLight.recalculate(A),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const u=this.directionalLight,p=this.ambientLight;if(!u||!p)return;const b=W=>.2126*(W[0]<=.03928?W[0]/12.92:Math.pow((W[0]+.055)/1.055,2.4))+.7152*(W[1]<=.03928?W[1]/12.92:Math.pow((W[1]+.055)/1.055,2.4))+.0722*(W[2]<=.03928?W[2]/12.92:Math.pow((W[2]+.055)/1.055,2.4)),A=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=u.properties.get("intensity"),P=u.properties.get("direction"),O=1-a.d3(P.x,P.y,P.z)[2]/90,B=b(A)*M*O,G=p.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=p.properties.get("intensity"),X=b(G)*j;return Number(((B+X)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const u=[];return this.directionalLight&&u.push(this.directionalLight.get()),this.ambientLight&&u.push(this.ambientLight.get()),u}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(u){if(u==null||u===""&&this.isRootStyle())return this;if(a.dq(u)){const p=a.dr(u),b=this.fragments.find(({id:M})=>M===p);if(!b)return;const A=a.dp(u);return b.style.getFragmentStyle(A)}{const p=this.fragments.find(({id:b})=>b===u);return p?p.style:void 0}}setFeaturesetSelectors(u){if(!u)return;const p={},b=(A,M="")=>`${A}::${M}`;this._featuresetSelectors={};for(const A in u){const M=this._featuresetSelectors[A]=[];for(const P of u[A].selectors){if(P.featureNamespace){const B=this.getOwnLayer(P.layer);if(!B){a.w(`Layer is undefined for selector: ${P.layer}`);continue}const G=b(B.source,B.sourceLayer);if(G in p&&p[G]!==P.featureNamespace){a.w(`"featureNamespace ${P.featureNamespace} of featureset ${A}'s selector is not associated to the same source, skip this selector`);continue}p[G]=P.featureNamespace}let O;if(P.properties)for(const B in P.properties){const G=a.U(P.properties[B]);G.result==="success"&&(O=O||{},O[B]=G.value)}M.push({layerId:P.layer,namespace:P.featureNamespace,properties:O,uniqueFeatureID:P._uniqueFeatureID})}}}getFeaturesetDescriptors(u){const p=this.getFragmentStyle(u);if(!p||!p.stylesheet.featuresets)return[];const b=[];for(const A in p.stylesheet.featuresets)b.push({featuresetId:A,importId:p.scope?p.scope:void 0});return b}getFeaturesetLayers(u,p){const b=this.getFragmentStyle(p),A=b.stylesheet.featuresets;if(!A||!A[u])return this.fire(new a.y(new Error(`The featureset '${u}' does not exist in the map's style and cannot be queried.`))),[];const M=[];for(const P of A[u].selectors){const O=b.getOwnLayer(P.layer);O&&M.push(O)}return M}getConfigProperty(u,p){const b=this.getFragmentStyle(u);if(!b)return null;const A=a.B(p,b.scope),M=b.options.get(A),P=M?M.value||M.default:null;return P?P.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(u,p){const b=a.B(u,p);return this._mergedIndoor[b]}setIndoorData(u,p){this.map.indoor.setIndoorData(p)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(u,p,b){const A=this.getFragmentStyle(u);if(!A)return;const M=A.stylesheet.schema;if(!M||!M[p])return;const P=a.U(b);if(P.result!=="success")return void Mc(this,P.value);const O=P.value.expression,B=a.B(p,A.scope),G=A.options.get(B);if(!G)return;let j;const{minValue:X,maxValue:W,stepValue:K,type:tt,values:rt}=M[p],ht=a.U(M[p].default);ht.result==="success"&&(j=ht.value.expression),j?(this.options.set(B,Object.assign({},G,{value:O,default:j,minValue:X,maxValue:W,stepValue:K,type:tt,values:rt})),this.updateConfigDependencies(p)):this.fire(new a.y(new Error(`No schema defined for the config option "${p}" in the "${u}" fragment.`)))}getConfig(u){const p=this.getFragmentStyle(u);if(!p)return null;const b=p.stylesheet.schema;if(!b)return null;const A={};for(const M in b){const P=a.B(M,p.scope),O=p.options.get(P),B=O?O.value||O.default:null;A[M]=B?B.serialize():null}return A}setConfig(u,p){const b=this.getFragmentStyle(u);b&&(b.updateConfig(p,b.stylesheet.schema),this.updateConfigDependencies())}getSchema(u){const p=this.getFragmentStyle(u);return p?p.stylesheet.schema:null}setSchema(u,p){const b=this.getFragmentStyle(u);b&&(b.stylesheet.schema=p,b.updateConfig(b._config,p),this.updateConfigDependencies())}updateConfig(u,p){if(this._config=u,u||p)if(p)for(const b in p){let A,M;const P=a.U(p[b].default);if(P.result==="success"&&(A=P.value.expression),u&&u[b]!==void 0){const W=a.U(u[b]);W.result==="success"&&(M=W.value.expression)}const{minValue:O,maxValue:B,stepValue:G,type:j,values:X}=p[b];if(A){const W=a.B(b,this.scope);this.options.set(W,{default:A,value:M,minValue:O,maxValue:B,stepValue:G,type:j,values:X})}else this.fire(new a.y(new Error(`No schema defined for config option "${b}".`)))}else this.fire(new a.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(u,p=()=>!0){for(const b of u){const A=this.getLayer(b);A&&p(A)&&(A.possiblyEvaluateVisibility(),this._updateLayer(A),this._changes.setDirty())}}updateConfigDependencies(u){this._updateLayers(this._configDependentLayers,p=>!u||p.expressionDependencies.configDependencies.has(u)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(p=>{const b=p._styleColorTheme.colorThemeOverride?p._styleColorTheme.colorThemeOverride:p._styleColorTheme.colorTheme;if(b){const A=p._evaluateColorThemeData(b);(!p._styleColorTheme.lut&&A!==""||p._styleColorTheme.lut&&A!==p._styleColorTheme.lut.data)&&p.setColorTheme(b)}}),this._changes.setDirty()}addLayer(u,p,b={}){this._checkLoaded();const A=u.id;if(this._layers[A])return void this.fire(new a.y(new Error(`Layer with id "${A}" already exists on this map`)));let M;if(u.type==="custom"){if(Mc(this,a.ds(u)))return;M=a.dt(u,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof u.source=="object"&&(this.addSource(A,u.source),u=a.dn(u),u=Object.assign(u,{source:A})),this._validate(Yp,`layers.${A}`,u,{arrayIndex:-1},b))return;M=a.dt(u,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:A}})}const P=a.B(M.source,M.scope);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P);let O=this._order.length;if(p){const X=this._order.indexOf(p);if(X===-1)return void this.fire(new a.y(new Error(`Layer with id "${p}" does not exist on this map.`)));M.slot===this._layers[p].slot?O=X:a.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(O,0,A),this._layerOrderChanged=!0,this._layers[A]=M;const B=this.getOwnLayerSourceCache(M),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&M.canCastShadows()&&G&&(B.castsShadows=!0);const j=this._changes.getRemovedLayer(M);if(j&&M.source&&B&&M.type!=="custom"){this._changes.discardLayerRemoval(M);const X=a.B(M.source,M.scope);j.type!==M.type?this._changes.updateSourceCache(X,"clear"):(this._changes.updateSourceCache(X,"reload"),B.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(u,p){this._checkLoaded();const b=this._checkLayer(u);if(!b||u===p)return;const A=this._order.indexOf(u);this._order.splice(A,1);let M=this._order.length;if(p){const P=this._order.indexOf(p);if(P===-1)return void this.fire(new a.y(new Error(`Layer with id "${p}" does not exist on this map.`)));b.slot===this._layers[p].slot?M=P:a.w(`Layer with id "${p}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,u),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(u){this._checkLoaded();const p=this._checkLayer(u);if(!p)return;p.setEventedParent(null);const b=this._order.indexOf(u);this._order.splice(b,1),delete this._layers[u],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(p.fqid),this._indoorDependentLayers.delete(p.fqid),this._changes.removeLayer(p);const A=this.getOwnLayerSourceCache(p);if(A&&A.castsShadows){let M=!1;for(const P in this._layers)if(this._layers[P].source===p.source&&this._layers[P].canCastShadows()){M=!0;break}A.castsShadows=M}p.onRemove&&p.onRemove(this.map),this.mergeLayers()}getOwnLayer(u){return this._layers[u]}hasLayer(u){return u in this._mergedLayers}hasLayerType(u){for(const p in this._layers)if(this._layers[p].type===u)return!0;return!1}setLayerZoomRange(u,p,b){this._checkLoaded();const A=this._checkLayer(u);A&&(A.minzoom===p&&A.maxzoom===b||(p!=null&&(A.minzoom=p),b!=null&&(A.maxzoom=b),this._updateLayer(A)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(u,p){this._checkLoaded();const b=this._checkLayer(u);b&&b.slot!==p&&(b.slot=p,this._updateLayer(b))}setFilter(u,p,b={}){this._checkLoaded();const A=this._checkLayer(u);if(A&&!a.bx(A.filter,p))return p==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(wr,`layers.${A.id}.filter`,p,{layerType:A.type},b)||(A.filter=a.dn(p),this._updateLayer(A)))}getFilter(u){const p=this._checkLayer(u);if(p)return a.dn(p.filter)}setLayoutProperty(u,p,b,A={}){this._checkLoaded();const M=this._checkLayer(u);if(M&&!a.bx(M.getLayoutProperty(p),b)){if(b!=null&&(!A||A.validate!==!1)&&Mc(M,tx.call(Gs,{key:`layers.${u}.layout.${p}`,layerType:M.type,objectKey:p,value:b,styleSpec:a.a6,style:{glyphs:!0,sprite:!0}})))return;M.setLayoutProperty(p,b),M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._updateLayer(M)}}setLayerProperty(u,p,b,A={}){this._checkLoaded();const M=this._checkLayer(u);M&&(p==="appearances"?(M.setAppearances(b),this._changes.setDirty()):M.isPaintProperty(p)?this.setPaintProperty(u,p,b,A):this.setLayoutProperty(u,p,b,A))}getLayoutProperty(u,p){const b=this._checkLayer(u);if(b)return b.getLayoutProperty(p)}setPaintProperty(u,p,b,A={}){this._checkLoaded();const M=this._checkLayer(u);if(!M||a.bx(M.getPaintProperty(p),b)||b!=null&&(!A||A.validate!==!1)&&Mc(M,Vo.call(Gs,{key:`layers.${u}.paint.${p}`,layerType:M.type,objectKey:p,value:b,styleSpec:a.a6})))return;const P=M.setPaintProperty(p,b);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),P&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(u,p){const b=this._checkLayer(u);if(b)return b.getPaintProperty(p)}setFeatureState(u,p){if(this._checkLoaded(),"target"in u){if("featuresetId"in u.target){const{featuresetId:B,importId:G}=u.target,j=this.getFragmentStyle(G),X=j.getFeaturesetLayers(B);for(const{source:W,sourceLayer:K}of X)j.setFeatureState({id:u.id,source:W,sourceLayer:K},p)}else if("layerId"in u.target){const{layerId:B}=u.target,G=this.getLayer(B);this.setFeatureState({id:u.id,source:G.source,sourceLayer:G.sourceLayer},p)}return}const b=u.source,A=u.sourceLayer,M=this._checkSource(b);if(!M)return;const P=M.type;if(P==="geojson"&&A)return void this.fire(new a.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(P==="vector"&&!A)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));u.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided.")));const O=this.getOwnSourceCaches(b);for(const B of O)B.setFeatureState(A,u.id,p)}removeFeatureState(u,p){if(this._checkLoaded(),"target"in u){if("featuresetId"in u.target){const{featuresetId:B,importId:G}=u.target,j=this.getFragmentStyle(G),X=j.getFeaturesetLayers(B);for(const{source:W,sourceLayer:K}of X)j.removeFeatureState({id:u.id,source:W,sourceLayer:K},p)}else if("layerId"in u.target){const{layerId:B}=u.target,G=this.getLayer(B);this.removeFeatureState({id:u.id,source:G.source,sourceLayer:G.sourceLayer},p)}return}const b=u.source,A=this._checkSource(b);if(!A)return;const M=A.type,P=M==="vector"?u.sourceLayer:void 0;if(M==="vector"&&!P)return void this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&typeof u.id!="string"&&typeof u.id!="number")return void this.fire(new a.y(new Error("A feature id is required to remove its specific state property.")));const O=this.getOwnSourceCaches(b);for(const B of O)B.removeFeatureState(P,u.id,p)}getFeatureState(u){if(this._checkLoaded(),"target"in u){let M;if("featuresetId"in u.target){const{featuresetId:P,importId:O}=u.target,B=this.getFragmentStyle(O),G=B.getFeaturesetLayers(P);for(const{source:j,sourceLayer:X}of G){const W=B.getFeatureState({id:u.id,source:j,sourceLayer:X});if(W&&!M)M=W;else if(!a.bx(M,W))return void this.fire(new a.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in u.target){const{layerId:P}=u.target,O=this.getLayer(P);M=this.getFeatureState({id:u.id,source:O.source,sourceLayer:O.sourceLayer})}return M}const p=u.source,b=u.sourceLayer,A=this._checkSource(p);if(A){if(A.type!=="vector"||b)return u.id===void 0&&this.fire(new a.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(p)[0].getFeatureState(b,u.id);this.fire(new a.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(u){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,u),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const u=this.getTerrain(),p=u&&this.terrain&&this.terrain.scope===this.scope?u:this.stylesheet.terrain;return a.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:p,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},b=>b!==void 0)}_updateFilteredLayers(u){for(const p of Object.values(this._mergedLayers))u(p)&&this._updateLayer(p)}_updateLayer(u){this._changes.updateLayer(u);const p=this.getLayerSourceCache(u),b=a.B(u.source,u.scope),A=this._changes.getUpdatedSourceCaches();u.source&&!A[b]&&p&&p.getSource().type!=="raster"&&(this._changes.updateSourceCache(b,"reload"),p.pause()),u.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(u){const p=O=>this._mergedLayers[O].is3D(!!this.terrain),b=this.order,A={},M=[];for(let O=b.length-1;O>=0;O--){const B=b[O];if(p(B)){A[B]=O;for(const G of u){const j=G[B];if(j)for(const X of j)M.push(X)}}}M.sort((O,B)=>B.intersectionZ-O.intersectionZ);const P=[];for(let O=b.length-1;O>=0;O--){const B=b[O];if(p(B))for(let G=M.length-1;G>=0;G--){const j=M[G].feature;if(j.layer&&A[j.layer.id]<O)break;P.push(j),M.pop()}else for(const G of u){const j=G[B];if(j)for(const X of j)P.push(X.feature)}}return P}queryRasterValue(u,p,b){const A=this.getOwnSource(u);return A?A.type!=="raster-array"?(this.fire(new a.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):A.queryRasterArrayValue(p,b):(this.fire(new a.y(new Error(`Source with id "${u}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(u,p,b){let A;p&&!Array.isArray(p)&&p.filter&&(this._validate(wr,"queryRenderedFeatures.filter",p.filter,null,p),A=a.b5(p.filter));const M={},P=j=>{if(Yv.has(j.type))return;const X=this.getOwnLayerSourceCache(j),W=M[X.id]=M[X.id]||{sourceCache:X,layers:{},has3DLayers:!1};j.is3D(!!this.terrain)&&(W.has3DLayers=!0),W.layers[j.fqid]=W.layers[j.fqid]||{styleLayer:j,targets:[]},W.layers[j.fqid].targets.push({filter:A})};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new a.y(new Error("parameters.layers must be an Array."))),[];for(const j of p.layers){const X=this._layers[j];if(!X)return this.fire(new a.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];P(X)}}else for(const j in this._layers)P(this._layers[j]);const O=this._queryRenderedFeatures(u,M,b),B=this._flattenAndSortRenderedFeatures(O),G=[];for(const j of B)a.dv(j.layer.id)===this.scope&&G.push(j);return G}queryRenderedFeatureset(u,p,b){let A;p&&!Array.isArray(p)&&p.filter&&(this._validate(wr,"queryRenderedFeatures.filter",p.filter,null,p),A=a.b5(p.filter));const M="mock",P=[];if(p&&p.target)P.push(Object.assign({},p,{targetId:M,filter:A}));else{const j=this.getFeaturesetDescriptors();for(const X of j)P.push({targetId:M,filter:A,target:X});for(const{style:X}of this.fragments){const W=X.getFeaturesetDescriptors();for(const K of W)P.push({targetId:M,filter:A,target:K})}}const O=this.queryRenderedTargets(u,P,b),B=[],G=new Set;for(const j of O)for(const X of j.variants[M])bs(X,j,G)||B.push(new a.dw(j,X));return B}queryRenderedTargets(u,p,b){const A={},M=(O,B,G,j)=>{const X=A[B.id]=A[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};if(X.layers[O.fqid]=X.layers[O.fqid]||{styleLayer:O,targets:[]},O.is3D(!!this.terrain)&&(X.has3DLayers=!0),!j)return G.uniqueFeatureID=!1,void X.layers[O.fqid].targets.push(G);X.layers[O.fqid].targets.push(Object.assign({},G,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const O of p)if("featuresetId"in O.target){const{featuresetId:B,importId:G}=O.target,j=this.getFragmentStyle(G);if(!j||!j._featuresetSelectors)continue;const X=j._featuresetSelectors[B];if(!X){this.fire(new a.y(new Error(`The featureset '${B}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const W of X){const K=j.getOwnLayer(W.layerId);K&&!Yv.has(K.type)&&M(K,j.getOwnLayerSourceCache(K),O,W)}}else if("layerId"in O.target){const{layerId:B}=O.target,G=this.getLayer(B);if(!G||Yv.has(G.type))continue;M(G,this.getLayerSourceCache(G),O)}const P=this._queryRenderedFeatures(u,A,b);return this._flattenAndSortRenderedFeatures(P)}_queryRenderedFeatures(u,p,b){const A=[],M=!!this.map._showQueryGeometry,P=en.createFromScreenPoints(u,b);for(const O in p){const B=ws(P,p[O],this._availableImages,b,M);Object.keys(B).length&&A.push(B)}if(this.placement)for(const O in p){if(!p[O].sourceCache._onlySymbols)continue;const B=Vv(P.screenGeometry,p[O],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(B).length&&A.push(B)}return A}querySourceFeatures(u,p){const b=p&&p.filter;b&&this._validate(wr,"querySourceFeatures.filter",b,null,p);let A=[];const M=this.getOwnSourceCaches(u);for(const P of M)A=A.concat(Jp(P,p));return A}addSourceType(u,p,b){return wl.getSourceType(u)?b(new Error(`A source type called "${u}" already exists.`)):(wl.setSourceType(u,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:p.workerSourceURL},b):b(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(u,p,b={}){this._checkLoaded();const A=this.light.getLight();let M=!1;for(const O in u)if(!a.bx(u[O],A[O])){M=!0;break}if(!M)return;const P=this._getTransitionParameters();this.light.setLight(u,p,b),this.light.updateTransitions(P)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(u,p=1){if(this._checkLoaded(),!u)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),p===0&&delete this.terrain,u===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let b=u;const A=u.source==null;if(p===1){if(this.disableElevatedTerrain)return;if(typeof b.source=="object"){const O="terrain-dem-src";this.addSource(O,b.source),b=a.dn(b),b=Object.assign(b,{source:O})}const M=Object.assign({},b),P={};if(this.terrain&&A){M.source=this.terrain.get().source;const O=this.terrain?this.getFragmentStyle(this.terrain.scope):null;O&&(P.style=O.serialize())}if(this._validate(Zd,"terrain",M,P))return}if(!this.terrain||this.terrain.scope!==this.scope&&!A||this.terrain&&p!==this.terrain.drapeRenderMode){if(!b)return;this._createTerrain(b,p),this.fire(new a.z("data",{dataType:"style"}))}else{const M=this.terrain,P=M.get();for(const O of Object.keys(a.a6.terrain))!b.hasOwnProperty(O)&&a.a6.terrain[O].default&&(b[O]=a.a6.terrain[O].default);for(const O in u)if(!a.bx(u[O],P[O])){M.set(u,this.options),this.stylesheet.terrain=u;const B=this._getTransitionParameters({duration:0});M.updateTransitions(B),this.fire(new a.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(u){const p=this.fog=new Mi(u,this.map.transform,this.scope,this.options);this.stylesheet.fog=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}_createSnow(u){const p=this.snow=new wa(u,this.map.transform,this.scope,this.options);this.stylesheet.snow=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}_createRain(u){const p=this.rain=new oa(u,this.map.transform,this.scope,this.options);this.stylesheet.rain=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const u of this.map._markers)u._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(u){if(this._checkLoaded(),!u)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog;if(!a.bx(p.get(),u)){p.set(u,this.options),this.stylesheet.fog=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}}else this._createFog(u);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(u){if(this._checkLoaded(),!u)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const p=this.snow;if(!a.bx(p.get(),u)){p.set(u,this.options),this.stylesheet.snow=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}}else this._createSnow(u);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(u){if(this._checkLoaded(),!u)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const p=this.rain;if(!a.bx(p.get(),u)){p.set(u,this.options),this.stylesheet.rain=p.get();const b=this._getTransitionParameters({duration:0});p.updateTransitions(b)}}else this._createRain(u);this._markersNeedUpdate=!0}_reloadColorTheme(){const u=()=>{for(const A in this._layers)this._layers[A].lut=this._styleColorTheme.lut;for(const A in this._sourceCaches)this._sourceCaches[A].clearTiles()},p=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!p)return this._styleColorTheme.lut=null,void u();const b=this._evaluateColorThemeData(p);this._loadColorTheme(b).then(()=>{this.fire(new a.z("colorthemeset")),u()}).catch(A=>{a.w(`Couldn't set color theme: ${A}`)})}setColorTheme(u){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=u,this._reloadColorTheme()}setImportColorTheme(u,p){const b=this.getFragmentStyle(u);b&&(b._styleColorTheme.colorThemeOverride=p,b._reloadColorTheme())}_getTransitionParameters(u){return{now:a.o.now(),transition:Object.assign(this.transition,u)}}updateDrapeFirstLayers(){if(!this.terrain)return;const u=[],p=[];for(const b of this._mergedOrder)this.isLayerDraped(this._mergedLayers[b])?u.push(b):p.push(b);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...u),this._drapedFirstOrder.push(...p)}_createTerrain(u,p){const b=this.terrain=new Wt(u,p,this.scope,this.options,this.map.getWorldview());p===1&&(this.stylesheet.terrain=u),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const A=this._getTransitionParameters({duration:0});b.updateTransitions(A)}_force3DLayerUpdate(){for(const u in this._layers){const p=this._layers[u];p.type==="fill-extrusion"&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const u in this._layers){const p=this._layers[u];p.type==="symbol"&&this._updateLayer(p)}}_validate(u,p,b,A,M={}){if(M&&M.validate===!1)return!1;const P=Object.assign({},this.serialize());return Mc(this,u.call(Gs,Object.assign({key:p,style:P,value:b,styleSpec:a.a6},A)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._mergedLayers)this._mergedLayers[u].setEventedParent(null);for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].clearTiles(),this._mergedSourceCaches[u].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(u){const p=this.getSourceCaches(u);for(const b of p)b.clearTiles()}clearSources(){for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].clearTiles()}clearLayers(){for(const u in this._mergedLayers){const p=this._mergedLayers[u];p._clear&&p._clear()}}reloadSource(u){const p=this.getSourceCaches(u);for(const b of p)b.resume(),b.reload()}reloadSources(){for(const u of this.getSources())u.reload&&u.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(u=>{u.modelManager.reloadModels(u.scope)})}updateSources(u){let p;this.directionalLight&&(p=aT(this.directionalLight));const b=new Set;for(const A in this._mergedLayers){const M=this._mergedLayers[A];M.hasElevation()&&!b.has(M.source)&&b.add(M.source)}for(const A in this._mergedSourceCaches){const M=this._mergedSourceCaches[A],P=b.has(M._source.id);M.update(u,void 0,void 0,p,P)}}_generateCollisionBoxes(){for(const u in this._sourceCaches){const p=this._sourceCaches[u];p.resume(),p.reload()}}_updatePlacement(u,p,b,A,M,P,O=!1){let B=!1,G=!1;const j={},X={};for(const W of this._mergedOrder){const K=this._mergedLayers[W];if(K.type!=="symbol")continue;const tt=a.B(K.source,K.scope);let rt=j[tt];if(!rt){const st=this.getLayerSourceCache(K);if(!st)continue;const gt=st.getRenderableIds(!0).map(xt=>st.getTileByID(xt));X[tt]=gt.slice(),rt=j[tt]=gt.sort((xt,vt)=>vt.tileID.overscaledZ-xt.tileID.overscaledZ||(xt.tileID.isLessThan(vt.tileID)?-1:1))}const ht=this.crossTileSymbolIndex.addLayer(K,rt,p.center.lng,p.projection);B=B||ht}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),O=O||this._layerOrderChanged||A===0,this._layerOrderChanged&&this.fire(new a.z("neworder")),(O||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.o.now(),p.zoom))&&(this.pauseablePlacement=new cs(p,this._mergedOrder,O,b,A,M,this.placement,this.fog&&p.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,X,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.o.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B){this._buildingIndex.onNewFrame(p.zoom);for(let W=0;W<this._mergedOrder.length;W++){const K=this._mergedLayers[this._mergedOrder[W]];if(K.type!=="symbol")continue;const tt=this.isLayerClipped(K);this.placement.updateLayerOpacities(K,j[a.B(K.source,K.scope)],W,tt?P:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.o.now())}}_releaseSymbolFadeTiles(){for(const u in this._sourceCaches)this._sourceCaches[u].releaseSymbolFadeTiles()}addImport(u,p){this._checkLoaded();const b=this.stylesheet.imports=this.stylesheet.imports||[];if(b.findIndex(({id:M})=>M===u.id)!==-1)return void this.fire(new a.y(new Error(`Import with id '${u.id}' already exists in the map's style.`)));if(!p)return b.push(u),this._loadImports([u],!0);const A=b.findIndex(({id:M})=>M===p);return A===-1&&this.fire(new a.y(new Error(`Import with id "${p}" does not exist on this map.`))),this.stylesheet.imports=b.slice(0,A).concat(u).concat(b.slice(A)),this._loadImports([u],!0,p)}updateImport(u,p){this._checkLoaded();const b=this.stylesheet.imports||[],A=this.getImportIndex(u);return A===-1?this:typeof p=="string"?(this.setImportUrl(u,p),this):(p.url&&p.url!==b[A].url&&this.setImportUrl(u,p.url),a.bx(p.config,b[A].config)||this.setImportConfig(u,p.config,p.data.schema),a.bx(p.data,b[A].data)||this.setImportData(u,p.data),this)}moveImport(u,p){this._checkLoaded();let b=this.stylesheet.imports||[];const A=this.getImportIndex(u);if(A===-1)return this;const M=this.getImportIndex(p);if(M===-1)return this;const P=b[A],O=this.fragments[A];return b=b.filter(({id:B})=>B!==u),this.fragments=this.fragments.filter(({id:B})=>B!==u),this.stylesheet.imports=b.slice(0,M).concat(P).concat(b.slice(M)),this.fragments=this.fragments.slice(0,M).concat(O).concat(this.fragments.slice(M)),this.mergeLayers(),this}setImportUrl(u,p){this._checkLoaded();const b=this.stylesheet.imports||[],A=this.getImportIndex(u);if(A===-1)return this;b[A].url=p;const M=this.fragments[A];return M.style=this._createFragmentStyle(b[A]),M.style.on("style.import.load",()=>this.mergeAll()),M.style.loadURL(p),this}setImportData(u,p){this._checkLoaded();const b=this.getImportIndex(u),A=this.stylesheet.imports||[];return b===-1?this:p?(this.fragments[b].style.setState(p),this._reloadImports(),this):(delete A[b].data,this.setImportUrl(u,A[b].url))}setImportConfig(u,p,b){this._checkLoaded();const A=this.getImportIndex(u),M=this.stylesheet.imports||[];if(A===-1)return this;p?M[A].config=p:delete M[A].config;const P=this.fragments[A];b&&P.style.stylesheet&&(P.style.stylesheet.schema=b);const O=P.style.stylesheet&&P.style.stylesheet.schema;return P.config=p,P.style.updateConfig(p,O),this.updateConfigDependencies(),this}removeImport(u){this._checkLoaded();const p=this.stylesheet.imports||[],b=this.getImportIndex(u);b!==-1&&(p.splice(b,1),this.fragments[b].style._remove(),this.fragments.splice(b,1),this._reloadImports())}getImportIndex(u){const p=(this.stylesheet.imports||[]).findIndex(b=>b.id===u);return p===-1&&this.fire(new a.y(new Error(`Import '${u}' does not exist in the map's style and cannot be updated.`))),p}getLayer(u){return this._mergedLayers[u]}getSources(){const u=[];for(const p in this._mergedOtherSourceCaches){const b=this._mergedOtherSourceCaches[p];b&&u.push(b.getSource())}return u}getSource(u,p){const b=this.getSourceCache(u,p);return b&&b.getSource()}getLayerSource(u){const p=this.getLayerSourceCache(u);return p&&p.getSource()}getSourceCache(u,p){const b=a.B(u,p);return this._mergedOtherSourceCaches[b]}getLayerSourceCache(u){const p=a.B(u.source,u.scope);return u.type==="symbol"?this._mergedSymbolSourceCaches[p]:this._mergedOtherSourceCaches[p]}getSourceCaches(u){if(u==null)return Object.values(this._mergedSourceCaches);const p=[];return this._mergedOtherSourceCaches[u]&&p.push(this._mergedOtherSourceCaches[u]),this._mergedSymbolSourceCaches[u]&&p.push(this._mergedSymbolSourceCaches[u]),p}updateSourceCaches(){const u=this._changes.getUpdatedSourceCaches();for(const p in u){const b=u[p];b==="reload"?this.reloadSource(p):b==="clear"&&this.clearSource(p)}}updateLayers(u){const p=this._changes.getUpdatedPaintProperties();for(const b of p){const A=this.getLayer(b);A&&A.updateTransitions(u)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(u){this.stylesheet.glyphs=u,this.glyphManager.setURL(u)}getImages(u,p,b){this.imageManager.getImages(p.images,p.scope,b),this._updateTilesForChangedImages();const A=P=>{if(P){const O=p.images.map(B=>a.I.toString(B));P.setDependencies(p.tileID.key,p.type,O)}},M=a.B(p.source,p.scope);A(this._mergedOtherSourceCaches[M]),A(this._mergedSymbolSourceCaches[M]),p.images.some(P=>P.iconsetId)&&this.fire(new a.z("data",{dataType:"style"}))}rasterizeImages(u,p,b){this.imageManager.rasterizeImages(p,b)}getGlyphs(u,p,b){this.glyphManager.getGlyphs(p.stacks,b)}getResource(u,p,b){return a.dy(p,b)}getOwnSourceCache(u){return this._otherSourceCaches[u]}getOwnLayerSourceCache(u){return u.type==="symbol"?this._symbolSourceCaches[u.source]:this._otherSourceCaches[u.source]}getOwnSourceCaches(u){const p=[];return this._otherSourceCaches[u]&&p.push(this._otherSourceCaches[u]),this._symbolSourceCaches[u]&&p.push(this._symbolSourceCaches[u]),p}_isSourceCacheLoaded(u){const p=this.getOwnSourceCaches(u);return p.length===0?(this.fire(new a.y(new Error(`There is no source with ID '${u}'`))),!1):p.every(b=>b.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(u,p){if(!this._clipLayerPresent&&u.type!=="fill-extrusion"&&u.type!=="building")return!1;const b=u.type==="fill-extrusion"&&(u.sourceLayer==="building"||u.sourceLayer==="procedural_buildings"),A=u.type==="building";if(u.is3D(!!this.terrain)){if(b||A||p&&p.type==="batched-model"||u.type==="model")return!0}else if(u.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(u=>{u.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}wl.getSourceType=function(x){return vl[x]},wl.setSourceType=function(x,u){vl[x]=u},wl.registerForPluginStateChange=a.dz;class zh extends a.E{constructor(u){super(),this._style=u,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},a.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(u){u===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=u,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(u){this._activeFloorsVisible=u,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(u){for(const[p,b]of Object.entries(u.buildings))if(this._buildings[p])for(const A of b.floorIds)this._buildings[p].floors[A]||(this._buildings[p].floors[A]=b.floors[A]);else this._buildings[p]=b;for(const p of u.activeFloors)this._activeFloors.add(p);this._updateIndoorSelector()}getIndoorTileOptions(u,p){const b=this._style.getIndoorSourceLayers(u,p);return b&&this._indoorState?{sourceLayers:b,indoorState:this._indoorState}:null}_updateUI(u,p,b){const A=function(M,P,O,B){let G=null,j=Number.MAX_SAFE_INTEGER;if(B<16)return null;for(const[X,W]of Object.entries(M)){const K=W.center;if(K){const tt=P.distanceTo(a.aS.convert(K));tt<j&&O.contains(K)&&(j=tt,G=X)}}return G}(this._buildings,p,b,u);A!==this._closestBuildingId&&(this._closestBuildingId=A,this._updateIndoorSelector())}_updateIndoorSelector(){const u=this._buildings,p=this._closestBuildingId,b=p&&u?u[p]:void 0;if(!b)return void this.fire(new a.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let A=null;for(const P of b.floorIds)if(this._activeFloors&&this._activeFloors.has(P)){A=P;break}const M=Array.from(b.floorIds).map(P=>({id:P,name:b.floors[P].name,zIndex:b.floors[P].zIndex})).sort((P,O)=>O.zIndex-P.zIndex);this.fire(new a.z("selector-update",{selectedFloorId:A,activeFloorsVisible:this._activeFloorsVisible,floors:M}))}_updateActiveFloors(){const u=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:u,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var yg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,gx=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,mx=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ef="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",rf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,vx=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Kv=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ws=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Jv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ve=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,_x=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const nf=[];Sl(yg,nf),Sl(mx,nf),Sl(gx,nf);const af={"_prelude_fog.vertex.glsl":vx,"_prelude_terrain.vertex.glsl":rf,"_prelude_shadow.vertex.glsl":Ve,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Kv,"_prelude_shadow.fragment.glsl":_x,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ws,"_prelude_raster_particle.glsl":Jv},xg={};_r("",rf),_r(Kv,vx),_r(_x,Ve),_r(Ws,""),_r(Jv,"");const bg=_r(gx,mx),cu=yg;var Qv={background:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:_r(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:_r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:_r("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_r(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:_r(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:_r("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:_r("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:_r("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:_r(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:_r(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:_r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:_r(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:_r(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:_r(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:_r("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:_r("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:_r(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:_r(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:_r("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:_r(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ef),skyboxGradient:_r(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ef),skyboxCapture:_r(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:_r(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:_r(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:_r(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:_r(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:_r("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:_r("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:_r("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:_r("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Sl(x,u){const p=x.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let b of p)if(b=b.trim(),b[0]==="#"&&b.includes("if")&&!b.includes("endif")){b=b.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const A=b.split(" ");for(const M of A)u.includes(M)||u.push(M)}}function _r(x,u){const p=/#include\s+"([^"]+)"/g,b=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,A={},M=[],P=[];if(x=x.replace(p,(B,G)=>(P.push(G),"")),(u=u.replace(p,(B,G)=>(M.push(G),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...nf];Sl(x,O),Sl(u,O);for(const B of[...M,...P])af[B]||console.error(`Undefined include: ${B}`),xg[B]||(xg[B]=[],Sl(af[B],xg[B])),O=[...O,...xg[B]];return{fragmentSource:x=x.replace(b,(B,G,j,X,W)=>(A[W]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${j} ${X} ${W};
#else
uniform ${j} ${X} u_${W};
#endif
`:G==="initialize"?`
#ifdef HAS_UNIFORM_u_${W}
    ${j} ${X} ${W} = u_${W};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${j} ${X} ${W};
#endif
`:G==="initialize-attribute"?"":void 0)),vertexSource:u=u.replace(b,(B,G,j,X,W)=>{const K=`MATERIAL_ATTRIBUTE_OFFSET_${W}`,tt=X==="float"?"vec2":X,rt=`GET_ATTRIBUTE_${tt}(a_${W}, materialInfo, ${K})`,ht=W.match(/color/)?"color":tt;return G==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${W}
in ${j} ${X} a_${W};
#endif
`:A[W]?G==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
    #if !defined(${K})
        in ${j} ${tt} a_${W};
    #endif
out ${j} ${X} ${W};
#else
uniform ${j} ${X} u_${W};
#endif
`:G==="initialize"?ht==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${j} ${X} ${W} = u_${W};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${W}) 
    #ifdef ${K}
        ${W} = unpack_mix_${ht}(${rt}, u_${W}_t);
    #else
        ${W} = unpack_mix_${ht}(a_${W}, u_${W}_t);
    #endif
#else
    ${j} ${X} ${W} = u_${W};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${j} ${X} a_${W};
    out ${j} ${X} ${W};
#endif
`:G==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${W} = a_${W};
#endif
`:void 0:G==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
    #if !defined(${K})
        in ${j} ${tt} a_${W};
    #endif  
#else
uniform ${j} ${X} u_${W};
#endif
`:G==="define-instanced"?ht==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${W}0;
in vec4 a_${W}1;
in vec4 a_${W}2;
in vec4 a_${W}3;
#else
uniform ${j} ${X} u_${W};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${tt} a_${W};
#else
uniform ${j} ${X} u_${W};
#endif
`:G==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${j} ${X} ${W} = a_${W};
#endif
`:ht==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    #ifdef ${K}
        ${j} ${X} ${W} = ${rt};
    #else
        ${j} ${X} ${W} = a_${W};
    #endif
#else
    ${j} ${X} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    #ifdef ${K}
        ${j} ${X} ${W} = unpack_mix_${ht}(${rt}, u_${W}_t);
    #else
        ${j} ${X} ${W} = unpack_mix_${ht}(a_${W}, u_${W}_t);
    #endif
#else
    ${j} ${X} ${W} = u_${W};
#endif
`}),usedDefines:O,vertexIncludes:M,fragmentIncludes:P}}class of{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(u,p,b,A,M,P,O,B){this.context=u;let G=this.boundPaintVertexBuffers.length!==A.length;for(let X=0;!G&&X<A.length;X++)this.boundPaintVertexBuffers[X]!==A[X]&&(G=!0);let j=this.boundDynamicVertexBuffers.length!==O.length;for(let X=0;!j&&X<O.length;X++)this.boundDynamicVertexBuffers[X]!==O[X]&&(j=!0);if(!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==b||G||j||this.boundIndexBuffer!==M||this.boundVertexOffset!==P)this.freshBind(p,b,A,M,P,O,B);else{u.bindVertexArrayOES.set(this.vao);for(const X of O)X&&(X.bind(),B&&X.instanceCount&&X.setVertexAttribDivisor(u.gl,p,B));M&&M.dynamicDraw&&M.bind()}}freshBind(u,p,b,A,M,P,O){const B=this.context,G=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=u,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=A,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=P,p.enableAttributes(G,u),p.bind(),p.setVertexAttribPointers(G,u,M);for(const j of b)j.enableAttributes(G,u),j.bind(),j.setVertexAttribPointers(G,u,M);for(const j of P)j&&(j.enableAttributes(G,u),j.bind(),j.setVertexAttribPointers(G,u,M),O&&j.instanceCount&&j.setVertexAttribDivisor(G,u,O));A&&A.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function jE(x,u){const p=Math.pow(2,u.canonical.z),b=u.canonical.y;return[new a.ae(0,b/p).toLngLat().lat,new a.ae(0,(b+1)/p).toLngLat().lat]}function WE(x,u,p,b,A,M,P){const O=x.context,B=O.gl,G=p.hillshadeFBO;if(!G)return;x.prepareDrawTile();const j=x.isTileAffectedByFog(u),X=x.getOrCreateProgram("hillshade",{overrideFog:j});O.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get());const W=((ht,st,gt,xt)=>{const vt=gt.paint.get("hillshade-shadow-color"),Pt=gt.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",wt=gt.paint.get("hillshade-highlight-color"),Rt=gt.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Mt=gt.paint.get("hillshade-accent-color"),At=gt.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",kt=gt.paint.get("hillshade-emissive-strength");let qt=a.an(gt.paint.get("hillshade-illumination-direction"));if(gt.paint.get("hillshade-illumination-anchor")==="viewport")qt-=ht.transform.angle;else if(ht.style&&ht.style.enable3dLights()&&ht.style.directionalLight){const oe=ht.style.directionalLight.properties.get("direction"),te=a.d3(oe.x,oe.y,oe.z);qt=a.an(te[1])}const jt=!ht.options.moving;return{u_matrix:xt||ht.transform.calculateProjMatrix(st.tileID.toUnwrapped(),jt),u_image:0,u_latrange:jE(0,st.tileID),u_light:[gt.paint.get("hillshade-exaggeration"),qt],u_shadow:vt.toPremultipliedRenderColor(Pt?null:gt.lut),u_highlight:wt.toPremultipliedRenderColor(Rt?null:gt.lut),u_emissive_strength:kt,u_accent:Mt.toPremultipliedRenderColor(At?null:gt.lut)}})(x,p,b,x.terrain?u.projMatrix:null);x.uploadCommonUniforms(O,X,u.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:tt,tileBoundsSegments:rt}=x.getTileBoundsBuffers(p);X.draw(x,B.TRIANGLES,A,M,P,Ni.disabled,W,b.id,K,tt,rt)}function t_(x,u,p){if(!u.needsDEMTextureUpload)return;const b=x.context,A=b.gl;b.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||x.getTileTexture(p.stride);const M=p.getPixels();u.demTexture?u.demTexture.update(M,{premultiply:!1}):u.demTexture=new a.T(b,M,A.R32F,{premultiply:!1}),u.needsDEMTextureUpload=!1}function $E(x,u,p){const b=x.context,A=b.gl;if(!u.dem)return;const M=u.dem;if(b.activeTexture.set(A.TEXTURE1),t_(x,u,M),!u.demTexture)return;u.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const P=M.dim;b.activeTexture.set(A.TEXTURE0);let O=u.hillshadeFBO;if(!O){const W=new a.T(b,{width:P,height:P,data:null},A.RGBA8);W.bind(A.LINEAR,A.CLAMP_TO_EDGE),O=u.hillshadeFBO=b.createFramebuffer(P,P,!0,"renderbuffer"),O.colorAttachment.set(W.texture)}b.bindFramebuffer.set(O.framebuffer),b.viewport.set([0,0,P,P]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:j}=x.getMercatorTileBoundsBuffers(),X=[];x.linearFloatFilteringSupported()&&X.push("TERRAIN_DEM_FLOAT_FORMAT"),x.getOrCreateProgram("hillshadePrepare",{defines:X}).draw(x,A.TRIANGLES,fi.disabled,$i.disabled,lr.unblended,Ni.disabled,((W,K)=>{const tt=K.stride,rt=a.bB();return a.cd(rt,0,a.al,-a.al,0,0,1),a.bq(rt,rt,[0,-a.al,0]),{u_matrix:rt,u_image:1,u_dimension:[tt,tt],u_zoom:W.overscaledZ}})(u.tileID,M),p.id,B,G,j),u.needsHillshadePrepare=!1}class Vn{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lT extends Vn{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(u){const p=this.current;(u.r!==p.r||u.g!==p.g||u.b!==p.b||u.a!==p.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class yx extends Vn{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class ZE extends Vn{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class qE extends Vn{getDefault(){return[!0,!0,!0,!0]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class XE extends Vn{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class YE extends Vn{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class uT extends Vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const p=this.current;(u.func!==p.func||u.ref!==p.ref||u.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class KE extends Vn{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class e_ extends Vn{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=u,this.dirty=!1}}class JE extends Vn{getDefault(){return[0,1]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class cT extends Vn{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=u,this.dirty=!1}}class xx extends Vn{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class i_ extends Vn{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.BLEND):p.disable(p.BLEND),this.current=u,this.dirty=!1}}class bx extends Vn{getDefault(){const u=this.gl;return[u.ONE,u.ZERO,u.ONE,u.ZERO]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.blendFuncSeparate(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class Bh extends Vn{getDefault(){return a.ao.transparent.toNonPremultipliedRenderColor(null)}set(u){const p=this.current;(u.r!==p.r||u.g!==p.g||u.b!==p.b||u.a!==p.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class sf extends Vn{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(u,u),this.current=u,this.dirty=!1)}}class wg extends Vn{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=u,this.dirty=!1}}class lf extends Vn{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class hT extends Vn{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}let Sx=class extends Vn{getDefault(){return null}set(x){(x!==this.current||this.dirty)&&(this.gl.useProgram(x),this.current=x,this.dirty=!1)}};class dT extends Vn{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class uf extends Vn{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class r_ extends Vn{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class n_ extends Vn{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Tx extends Vn{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class a_ extends Vn{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Sg extends Vn{getDefault(){return null}set(u){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class fT extends Vn{getDefault(){return null}set(u){this.gl&&(u!==this.current||this.dirty)&&(this.gl.bindVertexArray(u),this.current=u,this.dirty=!1)}}class pT extends Vn{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class gT extends Vn{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class cf extends Vn{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class o_ extends Vn{constructor(u,p){super(u),this.context=u,this.parent=p}getDefault(){return null}}class QE extends o_{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class mT extends o_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class tD extends o_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,this.attachment(),p.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Ax extends mT{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ix=(x,u,p)=>({u_matrix:x,u_image0:0,u_skirt_height:u,u_ground_shadow_factor:p}),s_=(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt)=>({u_proj_matrix:Float32Array.from(x),u_globe_matrix:u,u_normalize_matrix:Float32Array.from(b),u_merc_matrix:p,u_zoom_transition:A,u_merc_center:M,u_image0:0,u_frustum_tl:P,u_frustum_tr:O,u_frustum_br:B,u_frustum_bl:G,u_globe_pos:j,u_globe_radius:X,u_viewport:W,u_grid_matrix:rt?Float32Array.from(rt):new Float32Array(9),u_skirt_height:K,u_far_z_cutoff:tt});function l_(x,u){return x!=null&&u!=null&&!(!x.hasData()||!u.hasData())&&x.demTexture!=null&&u.demTexture!=null&&x.tileID.key!==u.tileID.key}const Fh=new class{constructor(){this.operations={}}newMorphing(x,u,p,b,A){if(x in this.operations){const M=this.operations[x];M.to.tileID.key!==p.tileID.key&&(M.queued=p)}else this.operations[x]={startTime:b,phase:0,duration:A,from:u,to:p,queued:null}}getMorphValuesForProxy(x){if(!(x in this.operations))return null;const u=this.operations[x];return{from:u.from,to:u.to,phase:u.phase}}update(x){for(const u in this.operations){const p=this.operations[u];for(p.phase=(x-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,x)){delete this.operations[u];break}}}_nextOp(x,u){return!!x.queued&&(x.from=x.to,x.to=x.queued,x.queued=null,x.phase=0,x.startTime=u,!0)}_validOp(x){return x.from.hasData()&&x.to.hasData()}},Cx={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vT(x,u,p){if(u===0)return 0;const b=u<1&&p===514?.25/u:1;return 6*Math.pow(1.5,22-x)*Math.max(u,1)*b}function Tg(x,u){const p=1<<x.z;return!u&&(x.x===0||x.x===p-1)||x.y===0||x.y===p-1}const Nh=x=>({u_matrix:x});function u_(x,u,p,b,A){if(A>0){const M=a.o.now(),P=(M-x.timeAdded)/A,O=u?(M-u.timeAdded)/A:-1,B=p.getSource(),G=b.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),j=!u||Math.abs(u.tileID.overscaledZ-G)>Math.abs(x.tileID.overscaledZ-G),X=j&&x.refreshedUponExpiration?1:a.aA(j?P:1-O,0,1);return u?{opacity:1,mix:1-X,isFading:P<1}:{opacity:X,mix:0,isFading:P<1}}return{opacity:1,mix:0,isFading:!1}}class $s extends _l{constructor(u){const p=Yo("mock-dem",{type:"raster-dem",maxzoom:u.transform.maxZoom},u.style.dispatcher,u.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(u,p){u.state="loaded",p(null)}}class Mx extends _l{constructor(u){const p=Yo("proxy",{type:"geojson",maxzoom:u.transform.maxZoom},u.style.dispatcher,u.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=u,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(u,p,b){if(u.freezeTileCoverage)return;this.transform=u;const A=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,P)=>{if(M[P.key]="",!this._tiles[P.key]){const O=new su(P,this._source.tileSize*P.overscaleFactor(),u.tileZoom,void 0,void 0,this._source.worldview);O.state="loaded",this._tiles[P.key]=O}return M},{});for(const M in this._tiles)M in A||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(u){const p=this.proxyCachedFBO[u];if(p!==void 0){const b=Object.values(p);this.renderCachePool.push(...b),delete this.proxyCachedFBO[u]}}deallocRenderCache(){this.renderCache.forEach(u=>u.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ag extends a.aP{constructor(u,p,b){super(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y),this.proxyTileKey=p,this.projMatrix=b}}class Ig extends a.bU{constructor(u,p){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},u.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),u.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),u.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=u,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[b,A,M]=function(B){const G=new a.bc,j=new a.b0,X=131;G.reserve(17161),j.reserve(33800);const W=a.al/128,K=a.al+W/2,tt=K+W;for(let ht=-W;ht<tt;ht+=W)for(let st=-W;st<tt;st+=W){const gt=st<0||st>K||ht<0||ht>K?24575:0,xt=a.aA(Math.round(st),0,a.al),vt=a.aA(Math.round(ht),0,a.al);G.emplaceBack(xt+gt,vt)}const rt=(ht,st)=>{const gt=st*X+ht;j.emplaceBack(gt+1,gt,gt+X),j.emplaceBack(gt+X,gt+X+1,gt+1)};for(let ht=1;ht<129;ht++)for(let st=1;st<129;st++)rt(st,ht);return[0,129].forEach(ht=>{for(let st=0;st<130;st++)rt(st,ht),rt(ht,st)}),[G,j,32768]}(),P=u.context;this.gridBuffer=P.createVertexBuffer(b,a.be.members),this.gridIndexBuffer=P.createIndexBuffer(A),this.gridSegments=a.bf.simpleSegment(0,0,b.length,A.length),this.gridNoSkirtSegments=a.bf.simpleSegment(0,0,b.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Mx(p.map),this.orthoMatrix=a.bB(),a.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.al,0,a.al,0,1);const O=P.gl;this._overlapStencilMode=new $i({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=u.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $s(p.map),this._pendingGroundEffectLayers=[]}set style(u){u.on("data",this._onStyleDataEvent.bind(this)),this._style=u,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(u,p,b){if(u&&u.terrain){this._style!==u&&(this.style=u,this._evaluationZoom=void 0);const A=u.terrain.properties,M=u.terrain.drapeRenderMode===0,P=u.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.o.now();const O=u.terrain&&u.terrain.scope,B=A.get("source"),G=M?this._mockSourceCache:u.getSourceCache(B,O);if(!G)return void a.w(`Couldn't find terrain source "${B}".`);if(this.sourceCache=G,this._attenuationRange=u.terrain.getAttenuationRange(),this._exaggeration=P?this.calculateExaggeration(p):A.get("exaggeration"),!p.projection.requiresDraping&&P&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const X=this.getScaledDemTileSize();this.sourceCache.update(p,X,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),p.updateElevation(!0,b),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0,this._previousZoom=p.zoom}else this._disable()}calculateExaggeration(u){if(this._attenuationRange&&u.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(u.zoom);const p=this._previousCameraAltitude,b=u.getFreeCameraOptions().position.z/u.pixelsPerMeter*u.worldSize;this._previousCameraAltitude=b;const A=p!=null?b-p:Number.MAX_VALUE;if(Math.abs(A)<2)return this._exaggeration;const M=u.zoom,P=this._style.terrain;if(!this._previousUpdateTimestamp)return P.getExaggeration(M);let O=M-this._previousZoom;const B=this._previousUpdateTimestamp;let G=M;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(M-G)>.5&&(O=.5*(M-G+O)),O*A<0&&(G+=O)),this._evaluationZoom=G;const j=P.getExaggeration(G),X=j===P.getExaggeration(Math.max(0,G-.1));if(X&&Math.abs(j-this._exaggeration)<.01)return j;let W=Math.min(.1,.00375*(this._updateTimestamp-B));return(X||j<.1||Math.abs(O)<1e-4)&&(W=Math.min(.2,4*W)),a.ak(this._exaggeration,j,W)}resetTileLookupCache(u){this._findCoveringTileCache[u]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(u){u.dataType==="source"&&u.coord?this._clearRenderCacheForTile(u.sourceCacheId,u.coord):u.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const u in this._style._mergedSourceCaches)this._style._mergedSourceCaches[u].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(u=>u.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const u=2*this.proxySourceCache.getSource().tileSize;return[u,u]}set useVertexMorphing(u){this._useVertexMorphing=u}updateTileBinding(u){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,b=this.painter.transform;this._initializing&&(this._initializing=b._centerAltitude===0&&this.getAtPointOrZero(a.ae.fromLngLat(b.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const A=this.proxyCoords=p.getIds().map(B=>{const G=p.getTileByID(B).tileID;return G.projMatrix=b.calculateProjMatrix(G.toUnwrapped()),G});(function(B,G){const j=G.transform.pointCoordinate(G.transform.getCameraPoint()),X=new a.P(j.x,j.y);B.sort((W,K)=>{if(K.overscaledZ-W.overscaledZ)return K.overscaledZ-W.overscaledZ;const tt=new a.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),rt=new a.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ht=X.mult(1<<W.canonical.z);return ht.x-=.5,ht.y-=.5,ht.distSqr(tt)-ht.distSqr(rt)})})(A,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},A.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const P=this._style._mergedSourceCaches;for(const B in P){const G=P[B];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,u[B],M),G.usedForTerrain))continue;const j=u[B];G.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[p.id]=A.map(B=>new Ag(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(A),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const O={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const G=this.terrainTileForTile[B.key];if(!G)continue;const j=G.tileID.key;j in O||(this._visibleDemTiles.push(G),O[j]=j)}}_assignTerrainTiles(u){this._initializing||u.forEach(p=>{if(this.terrainTileForTile[p.key])return;const b=this._findTileCoveringTileID(p,this.sourceCache);b&&(this.terrainTileForTile[p.key]=b)})}_prepareDEMTextures(){const u=this.painter.context,p=u.gl;for(const b in this.terrainTileForTile){const A=this.terrainTileForTile[b],M=A.dem;!M||A.demTexture&&!A.needsDEMTextureUpload||(u.activeTexture.set(p.TEXTURE1),t_(this.painter,A,M))}}_prepareDemTileUniforms(u,p,b,A){if(!p||p.demTexture==null)return!1;const M=u.tileID.canonical,P=Math.pow(2,p.tileID.canonical.z-M.z),O=A||"";return b[`u_dem_tl${O}`]=[M.x*P%1,M.y*P%1],b[`u_dem_scale${O}`]=P,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let u=0;const p=this._visibleDemTiles.reduce((b,A)=>{if(!A.dem)return b;const M=A.dem.tree.minimums[0];return M>0&&u++,b+M},0);return u?p/u:0}_updateEmptyDEMTexture(){const u=this.painter.context,p=u.gl;u.activeTexture.set(p.TEXTURE2);const b=this._getLoadedAreaMinimum(),A=new a.dK({width:1,height:1},new Float32Array([b]));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(A,{premultiply:!1}):M=this._emptyDEMTexture=new a.T(u,A,p.R32F,{premultiply:!1}),M}setupElevationDraw(u,p,b){const A=this.painter.context,M=A.gl,P={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};P.u_exaggeration=this.exaggeration();let O=null,B=null,G=1;if(b&&b.morphing&&this._useVertexMorphing){const K=b.morphing.srcDemTile,tt=b.morphing.dstDemTile;G=b.morphing.phase,K&&tt&&(this._prepareDemTileUniforms(u,K,P,"_prev")&&(B=K),this._prepareDemTileUniforms(u,tt,P)&&(O=tt))}const j=K=>K&&K.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST;let X=null;var W;if(this.enabled?B&&O?(X=O.demTexture,A.activeTexture.set(M.TEXTURE4),B.demTexture.bind(j(B),M.CLAMP_TO_EDGE),P.u_dem_lerp=G):(O=this.terrainTileForTile[u.tileID.key],X=this._prepareDemTileUniforms(u,O,P)?O.demTexture:this.emptyDEMTexture):X=this.emptyDEMTexture,A.activeTexture.set(M.TEXTURE2),X&&(P.u_dem_size=(W=X).size[0]===1?1:W.size[0]-2,X.bind(j(O),M.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(b&&b.useDepthForOcclusion,p,P),b&&b.useMeterToDem&&O){const K=(1<<O.tileID.canonical.z)*a.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;P.u_meter_to_dem=K}if(b&&b.labelPlaneMatrixInv&&(P.u_label_plane_matrix_inv=b.labelPlaneMatrixInv),p.setTerrainUniformValues(A,P),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,u.tileID.canonical,b&&b.useDenormalizedUpVectorScale);p.setGlobeUniformValues(A,K)}}globeUniformValues(u,p,b){const A=u.projection;return{u_tile_tl_up:A.upVector(p,0,0),u_tile_tr_up:A.upVector(p,a.al,0),u_tile_br_up:A.upVector(p,a.al,a.al),u_tile_bl_up:A.upVector(p,0,a.al),u_tile_up_scale:b?a.dL(1):A.upVectorScale(p,u.center.lat,u.worldSize).metersToTile}}renderToBackBuffer(u){const p=this.painter,b=this.painter.context;u.length!==0&&(b.bindFramebuffer.set(null),b.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(A,M,P,O,B){if(A.transform.projection.name==="globe")(function(G,j,X,W,K){const tt=G.context,rt=tt.gl;let ht,st;const gt=G.transform,xt=a.dD(G,tt,gt),vt=(oe,te)=>{if(st===te)return;const fe=[Cx[te],"PROJECTION_GLOBE_VIEW"];xt&&fe.push("CUSTOM_ANTIALIASING");const ze=G.isTileAffectedByFog(oe);ht=G.getOrCreateProgram("globeRaster",{defines:fe,overrideFog:ze}),st=te},Pt=G.colorModeForRenderPass(),wt=new fi(rt.LEQUAL,fi.ReadWrite,G.depthRangeFor3D);Fh.update(K);const Rt=a.dE(gt),Mt=[a.aF(gt.center.lng),a.aJ(gt.center.lat)],At=G.globeSharedBuffers,kt=[gt.width*a.o.devicePixelRatio,gt.height*a.o.devicePixelRatio],qt=Float32Array.from(gt.globeMatrix),jt={useDenormalizedUpVectorScale:!0};{const oe=G.transform,te=vT(oe.zoom,j.exaggeration(),j.sourceCache._source.tileSize);st=-1;const fe=rt.TRIANGLES;for(const ze of W){const Qt=X.getTile(ze),Gt=$i.disabled,pe=j.prevTerrainTileForTile[ze.key],ee=j.terrainTileForTile[ze.key];l_(pe,ee)&&Fh.newMorphing(ze.key,pe,ee,K,250),tt.activeTexture.set(rt.TEXTURE0),Qt.texture&&Qt.texture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE);const Ae=Fh.getMorphValuesForProxy(ze.key),Ge=Ae?1:0;Ae&&Object.assign(jt,{morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:a.dC(Ae.phase)}});const ui=a.dF(ze.canonical),Le=a.dG(ui.getCenter().lat),Fe=a.dH(ze.canonical,ui,Le,oe.worldSize/oe._pixelsPerMercatorPixel),hi=a.bj(a.dI(ze.canonical)),ai=s_(oe.expandedFarZProjMatrix,qt,Rt,hi,a.aj(oe.zoom),Mt,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,kt,te,oe._farZ,Fe);if(vt(ze,Ge),ht&&(j.setupElevationDraw(Qt,ht,jt),G.uploadCommonUniforms(tt,ht,ze.toUnwrapped()),At)){const[ii,oi,Di]=At.getGridBuffers(Le,te!==0);ht.draw(G,fe,wt,Gt,Pt,Ni.backCCW,ai,"globe_raster",ii,oi,Di)}}}if(At&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xt&&oe.push("CUSTOM_ANTIALIASING"),ht=G.getOrCreateProgram("globeRaster",{defines:oe});for(const te of W){const{x:fe,y:ze,z:Qt}=te.canonical,Gt=ze===0,pe=ze===(1<<Qt)-1,[ee,Ae,Ge,ui]=At.getPoleBuffers(Qt,!1);if(ui&&(Gt||pe)){const Le=X.getTile(te);tt.activeTexture.set(rt.TEXTURE0),Le.texture&&Le.texture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE);let Fe=a.dJ(Qt,fe,gt);const hi=a.bj(a.dI(te.canonical)),ai=(ii,oi)=>ii.draw(G,rt.TRIANGLES,wt,$i.disabled,Pt,Ni.disabled,s_(gt.expandedFarZProjMatrix,Fe,Fe,hi,0,Mt,gt.frustumCorners.TL,gt.frustumCorners.TR,gt.frustumCorners.BR,gt.frustumCorners.BL,gt.globeCenterInViewSpace,gt.globeRadius,kt,0,gt._farZ),"globe_pole_raster",oi,Ge,ui);j.setupElevationDraw(Le,ht,jt),G.uploadCommonUniforms(tt,ht,te.toUnwrapped()),Gt&&G.renderDefaultNorthPole&&ai(ht,ee),pe&&G.renderDefaultSouthPole&&(Fe=a.cR(a.bB(),Fe,[1,-1,1]),ai(ht,Ae))}}}})(A,M,P,O,B);else{const G=A.context,j=G.gl;let X,W;const K=A.shadowRenderer,tt=ju(A,A.longestCutoffRange),rt=Pt=>{if(W===Pt)return;const wt=[];wt.push(Cx[Pt]),tt.shouldRenderCutoff&&wt.push("RENDER_CUTOFF"),K&&(wt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&wt.push("NORMAL_OFFSET")),X=A.getOrCreateProgram("terrainRaster",{defines:wt}),W=Pt},ht=A.colorModeForRenderPass(),st=new fi(j.LEQUAL,fi.ReadWrite,A.depthRangeFor3D);Fh.update(B);const gt=A.transform,xt=vT(gt.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let vt=[0,0,0];if(K){const Pt=A.style.directionalLight,wt=A.style.ambientLight;Pt&&wt&&(vt=bl(A.style,Pt,wt))}{W=-1;const Pt=j.TRIANGLES,[wt,Rt]=[M.gridIndexBuffer,M.gridSegments];for(const Mt of O){const At=P.getTile(Mt),kt=$i.disabled,qt=M.prevTerrainTileForTile[Mt.key],jt=M.terrainTileForTile[Mt.key];l_(qt,jt)&&Fh.newMorphing(Mt.key,qt,jt,B,250),G.activeTexture.set(j.TEXTURE0),At.texture&&At.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const oe=Fh.getMorphValuesForProxy(Mt.key),te=oe?1:0;let fe;oe&&(fe={morphing:{srcDemTile:oe.from,dstDemTile:oe.to,phase:a.dC(oe.phase)}});const ze=Ix(Mt.projMatrix,Tg(Mt.canonical,gt.renderWorldCopies)?xt/10:xt,vt);if(rt(te),!X)continue;M.setupElevationDraw(At,X,fe);const Qt=Mt.toUnwrapped();K&&K.setupShadows(Qt,X),A.uploadCommonUniforms(G,X,Qt,null,tt),X.draw(A,Pt,st,kt,ht,Ni.backCCW,ze,"terrain_raster",M.gridBuffer,wt,Rt)}}}}(p,this,this.proxySourceCache,u,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),u.splice(0,u.length))}renderBatch(u){if(this._drapedRenderBatches.length===0)return u+1;this.renderingToTexture=!0;const p=this.painter,b=this.painter.context,A=this.proxySourceCache,M=this.proxiedCoords[A.id],P=this._drapedRenderBatches.shift(),O=p.style.order,B=[];let G=0;for(const j of M){const X=A.getTileByID(j.proxyTileKey),W=A.proxyCachedFBO[j.key]?A.proxyCachedFBO[j.key][u]:void 0,K=W!==void 0?A.renderCache[W]:this.pool[G++],tt=W!==void 0;if(X.texture=K.tex,tt&&!K.dirty){B.push(X.tileID);continue}let rt;b.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(b.clear({color:a.ao.transparent,stencil:0}),K.dirty=!1);for(let ht=P.start;ht<=P.end;++ht){const st=p.style._mergedLayers[O[ht]];if(st.isHidden(p.transform.zoom))continue;const gt=p.style.getLayerSourceCache(st),xt=gt?this.proxyToSource[j.key][gt.id]:[j];if(!xt)continue;const vt=xt;b.viewport.set([0,0,K.fb.width,K.fb.height]),rt!==(gt?gt.id:null)&&(this._setupStencil(K,xt,st,gt),rt=gt?gt.id:null),p.renderLayer(p,gt,st,vt)}if(this._drapedRenderBatches.length===0)for(const ht of this._pendingGroundEffectLayers){const st=p.style._mergedLayers[O[ht]];if(st.isHidden(p.transform.zoom))continue;const gt=p.style.getLayerSourceCache(st),xt=gt?this.proxyToSource[j.key][gt.id]:[j];if(!xt)continue;const vt=xt;b.viewport.set([0,0,K.fb.width,K.fb.height]),rt!==(gt?gt.id:null)&&(this._setupStencil(K,xt,st,gt),rt=gt?gt.id:null),p.renderLayer(p,gt,st,vt)}this.renderedToTile?(K.dirty=!0,B.push(X.tileID)):tt||--G,G===5&&(G=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,b.bindFramebuffer.set(null),b.viewport.set([0,0,p.width,p.height]),P.end+1}postRender(){}isLayerOrderingCorrect(u){const p=u.order.length;let b=-1,A=p;for(let M=0;M<p;++M)this._style.isLayerDraped(u._mergedLayers[u.order[M]])?b=Math.max(b,M):A=Math.min(A,M);return A>b}getMinElevationBelowMSL(){let u=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{u=Math.min(u,p.dem.tree.minimums[0])}),u===0?u:(u-30)*this._exaggeration}raycast(u,p,b){if(!this._visibleDemTiles)return null;const A=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const P=M.tileID,O=1<<P.overscaledZ,{x:B,y:G}=P.canonical,j=B/O,X=(B+1)/O,W=G/O,K=(G+1)/O;return{minx:j,miny:W,maxx:X,maxy:K,t:M.dem.tree.raycastRoot(j,W,X,K,u,p,b),tile:M}});A.sort((M,P)=>(M.t!==null?M.t:Number.MAX_VALUE)-(P.t!==null?P.t:Number.MAX_VALUE));for(const M of A){if(M.t==null)return null;const P=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,u,p,b);if(P!=null)return P}return null}_createFBO(){const u=this.painter.context,p=u.gl,b=this.drapeBufferSize;u.activeTexture.set(p.TEXTURE0);const A=new a.T(u,{width:b[0],height:b[1],data:null},p.RGBA8);A.bind(p.LINEAR,p.CLAMP_TO_EDGE);const M=u.createFramebuffer(b[0],b[1],!0,null);return M.colorAttachment.set(A.texture),M.depthAttachment=new Ax(u,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=u.createRenderbuffer(u.gl.DEPTH_STENCIL,b[0],b[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),u.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax),{fb:M,tex:A,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u].hasTransition())return!0;return this._style.order.some(u=>{const p=this._style._mergedLayers[u],b=p.isHidden(this.painter.transform.zoom);return p.type==="hillshade"||p.type==="custom"?!b&&p.shouldRedrape():!b&&p.hasTransition()})}_clearLineLayersFromRenderCache(){let u=!1;for(const b of this._style.getSources())if(b instanceof Uo){u=!0;break}if(!u)return;const p={};for(let b=0;b<this._style.order.length;++b){const A=this._style._mergedLayers[this._style.order[b]],M=this._style.getLayerSourceCache(A);if(M&&!p[M.id]&&!A.isHidden(this.painter.transform.zoom)&&A.type==="line"&&A.widthExpression()instanceof a.ad){p[M.id]=!0;for(const P of this.proxyCoords){const O=this.proxyToSource[P.key][M.id];if(O)for(const B of O)this._clearRenderCacheForTile(M.id,B)}}}}_clearRasterLayersFromRenderCache(){let u=!1;for(const b in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[b]._source instanceof ml){u=!0;break}if(!u)return;const p={};for(let b=0;b<this._style.order.length;++b){const A=this._style._mergedLayers[this._style.order[b]],M=this._style.getLayerSourceCache(A);if(!M||p[M.id]||A.isHidden(this.painter.transform.zoom)||A.type!=="raster")continue;const P=A.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const B=this.proxyToSource[O.key][M.id];if(B)for(const G of B){const j=u_(M.getTile(G),M.findLoadedParent(G,0),M,this.painter.transform,P);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(M.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const u=this._style.order,p=u.length;if(p===0)return;const b=[];this._pendingGroundEffectLayers=[];let A,M=0,P=this._style._mergedLayers[u[M]];for(;!this._style.isLayerDraped(P)&&P.isHidden(this.painter.transform.zoom)&&++M<p;)P=this._style._mergedLayers[u[M]];for(;M<p;++M){const O=this._style._mergedLayers[u[M]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?A===void 0&&(A=M):(O.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(M),A!==void 0&&(b.push({start:A,end:M-1}),A=void 0)))}if(A!==void 0&&b.push({start:A,end:M-1}),b.length!==0){const O=b[b.length-1];this._pendingGroundEffectLayers.every(B=>B>O.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=b}_setupRenderCache(u){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const P=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let O=0;O<P.length;++O){const B=Object.values(P[O]);p.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const b=this.proxyCoords,A=this._tilesDirty;for(let P=b.length-1;P>=0;P--){const O=b[P];if(p.getTileByID(O.key),p.proxyCachedFBO[O.key]!==void 0){const B=u[O.key],G=this.proxyToSource[O.key];let j=0;for(const X in G){const W=G[X],K=B[X];if(!K||K.length!==W.length||W.some((tt,rt)=>tt!==K[rt]||A[X]&&A[X].hasOwnProperty(tt.key))){j=-1;break}++j}for(const X in p.proxyCachedFBO[O.key])p.renderCache[p.proxyCachedFBO[O.key][X]].dirty=j<0||j!==Object.values(B).length}}const M=[...this._drapedRenderBatches];M.sort((P,O)=>O.end-O.start-(P.end-P.start));for(const P of M)for(const O of b){if(p.proxyCachedFBO[O.key])continue;let B=p.renderCachePool.pop();B===void 0&&p.renderCache.length<50&&(B=p.renderCache.length,p.renderCache.push(this._createFBO())),B!==void 0&&(p.proxyCachedFBO[O.key]={},p.proxyCachedFBO[O.key][P.start]=B,p.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(u,p,b,A){if(!A||!this._sourceTilesOverlap[A.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,P=M.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let O;if(b.isTileClipped())O=p.length,this._overlapStencilMode.test={func:P.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:P.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,b.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(u){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[u.key]),this._overlapStencilMode):$i.disabled}_renderTileClippingMasks(u,p){const b=this.painter,A=this.painter.context,M=A.gl;b._tileClippingMaskIDs={},A.setColorMode(lr.disabled),A.setDepthMode(fi.disabled);const P=b.getOrCreateProgram("clippingMask");for(const O of u){const B=b._tileClippingMaskIDs[O.key]=--p;P.draw(b,M.TRIANGLES,fi.disabled,new $i({func:M.ALWAYS,mask:0},B,255,M.KEEP,M.KEEP,M.REPLACE),lr.disabled,Ni.disabled,Nh(O.projMatrix),"$clipping",b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}}pointCoordinate(u){const p=this.painter.transform;if(u.x<0||u.x>p.width||u.y<0||u.y>p.height)return null;const b=[u.x,u.y,1,1];a.aC(b,b,p.pixelMatrixInverse),a.cJ(b,b,1/b[3]),b[0]/=p.worldSize,b[1]/=p.worldSize;const A=p._camera.position,M=a.ce(1,p.center.lat),P=[A[0],A[1],A[2]/M,0],O=a.d9([],b.slice(0,3),P);a.aw(O,O);const B=this.raycast(P,O,this._exaggeration);return B!==null&&B?(a.bG(P,P,O,B),P[3]=P[2],P[2]*=M,P):null}_setupProxiedCoordsForOrtho(u,p,b){if(u.getSource()instanceof a.aT)return this._setupProxiedCoordsForImageSource(u,p,b);this._findCoveringTileCache[u.id]=this._findCoveringTileCache[u.id]||{};const A=this.proxiedCoords[u.id]=[],M=this.proxyCoords;for(let B=0;B<M.length;B++){const G=M[B],j=this._findTileCoveringTileID(G,u);if(j){const X=this._createProxiedId(G,j,b[G.key]&&b[G.key][u.id]);A.push(X),this.proxyToSource[G.key][u.id]=[X]}}let P=!1;const O=new Set;for(let B=0;B<p.length;B++){const G=u.getTile(p[B]);if(!G||!G.hasData())continue;const j=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==G.tileID.canonical.z){const X=this.proxyToSource[j.tileID.key][u.id],W=this._createProxiedId(j.tileID,G,b[j.tileID.key]&&b[j.tileID.key][u.id]);X?X.splice(X.length-1,0,W):this.proxyToSource[j.tileID.key][u.id]=[W];const K=this.proxyToSource[j.tileID.key][u.id];O.has(K)||O.add(K),A.push(W),P=!0}}if(this._sourceTilesOverlap[u.id]=P,P&&this._debugParams.sortTilesHiZFirst)for(const B of O)B.sort((G,j)=>j.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(u,p,b){if(!u.getSource().loaded())return;const A=this.proxiedCoords[u.id]=[],M=this.proxyCoords,P=u.getSource(),O=P.tileID;if(!O)return;const B=new a.P(O.x,O.y)._div(1<<O.z),G=P.coordinates.map(a.ae.fromLngLat).reduce((X,W)=>(X.min.x=Math.min(X.min.x,W.x-B.x),X.min.y=Math.min(X.min.y,W.y-B.y),X.max.x=Math.max(X.max.x,W.x-B.x),X.max.y=Math.max(X.max.y,W.y-B.y),X),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(X,W)=>{const K=X.wrap+X.canonical.x/(1<<X.canonical.z),tt=X.canonical.y/(1<<X.canonical.z),rt=a.al/(1<<X.canonical.z),ht=W.wrap+W.canonical.x/(1<<W.canonical.z),st=W.canonical.y/(1<<W.canonical.z);return K+rt<ht+G.min.x||K>ht+G.max.x||tt+rt<st+G.min.y||tt>st+G.max.y};for(let X=0;X<M.length;X++){const W=M[X];for(let K=0;K<p.length;K++){const tt=u.getTile(p[K]);if(!tt||!tt.hasData()||j(W,tt.tileID))continue;const rt=this._createProxiedId(W,tt,b[W.key]&&b[W.key][u.id]),ht=this.proxyToSource[W.key][u.id];ht?ht.push(rt):this.proxyToSource[W.key][u.id]=[rt],A.push(rt)}}}_createProxiedId(u,p,b){let A=this.orthoMatrix;if(b){const M=b.find(P=>P.key===p.tileID.key);if(M)return M}if(p.tileID.key!==u.key){const M=u.canonical.z-p.tileID.canonical.z;let P,O,B;A=a.bB();const G=p.tileID.wrap-u.wrap<<u.overscaledZ;M>0?(P=a.al>>M,O=P*((p.tileID.canonical.x<<M)-u.canonical.x+G),B=P*((p.tileID.canonical.y<<M)-u.canonical.y)):(P=a.al<<-M,O=a.al*(p.tileID.canonical.x-(u.canonical.x+G<<-M)),B=a.al*(p.tileID.canonical.y-(u.canonical.y<<-M))),a.cd(A,0,P,0,P,0,1),a.bq(A,A,[O,B,0])}return new Ag(p.tileID,u.key,A)}_findTileCoveringTileID(u,p){let b=p.getTile(u);if(b&&b.hasData())return b;const A=this._findCoveringTileCache[p.id],M=A[u.key];if(b=M?p.getTileByID(M):null,b&&b.hasData()||M===null)return b;let P=b?b.tileID:u,O=P.overscaledZ;const B=p.getSource().minzoom,G=[];if(!M){const X=p.getSource().maxzoom;if(u.canonical.z>=X){const W=u.canonical.z-X;p.getSource().reparseOverscaled?(O=Math.max(u.canonical.z+2,p.transform.tileZoom),P=new a.aP(O,u.wrap,X,u.canonical.x>>W,u.canonical.y>>W)):W!==0&&(O=X,P=new a.aP(O,u.wrap,X,u.canonical.x>>W,u.canonical.y>>W))}P.key!==u.key&&(G.push(P.key),b=p.getTile(P))}const j=X=>{G.forEach(W=>{A[W]=X}),G.length=0};for(O-=1;O>=B&&(!b||!b.hasData());O--){b&&j(b.tileID.key);const X=P.calculateScaledKey(O);if(b=p.getTileByID(X),b&&b.hasData())break;const W=A[X];if(W===null)break;W===void 0?G.push(X):b=p.getTileByID(W)}return j(b?b.tileID.key:null),b&&b.hasData()?b:null}findDEMTileFor(u){return this.enabled?this._findTileCoveringTileID(u,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(u,p){let b=this._tilesDirty[u];b||(b=this._tilesDirty[u]={}),b[p.key]=!0}}function Ex(x,u,p){const b=function(O,B,G){const j=a.bI(B,O),X=a.bI(G,[.2126,.7152,.0722]),W=(tt,rt,ht)=>(1-ht)*tt+ht*rt,K=W(1-.3*Math.min(X,1),1,Math.min(j+1,1));return W(.92,1,Math.asin(a.aA(B[2],-1,1))/Math.PI+.5)*K}(x,[0,0,1],u),A=[0,0,0];a.c4(A,p.slice(0,3),b);const M=[0,0,0];a.c4(M,u.slice(0,3),x[2]);const P=[0,0,0];return a.d7(P,A,M),a.da(P)}const Dx=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Px=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Cg{static cacheKey(u,p,b,A){let M=`${p}${A?A.cacheKey:""}`;for(const P of b)u.usedDefines.includes(P)&&(M+=`/${P}`);return M}constructor(u,p,b,A,M,P){const O=u.gl;this.program=O.createProgram(),this.configuration=A,this.name=p,this.fixedDefines=[...P];let B=A?A.defines():[];B=B.concat(P.map(tt=>`#define ${tt}`));const G=`#version 300 es
`;let j=G+B.concat("precision mediump float;",cu,bg.fragmentSource).join(`
`);for(const tt of b.fragmentIncludes)j+=`
${af[tt]}`;j+=`
${b.fragmentSource}`;let X=G+B.concat("precision highp float;",cu,bg.vertexSource).join(`
`);for(const tt of b.vertexIncludes)X+=`
${af[tt]}`;this.forceManualRenderingForInstanceIDShaders=u.forceManualRenderingForInstanceIDShaders&&b.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(X+=`
uniform int u_instanceID;
`),X+=`
${b.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const W=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(W,j),O.compileShader(W),O.attachShader(this.program,W);const K=O.createShader(O.VERTEX_SHADER);O.isContextLost()?this.failedToCreate=!0:(O.shaderSource(K,X),O.compileShader(K),O.attachShader(this.program,K),this.attributes={},O.linkProgram(this.program),O.deleteShader(K),O.deleteShader(W),this.fixedUniforms=M(u),this.binderUniforms=A?A.getUniforms(u):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(tt=>({u_instanceID:new a.cg(tt)}))(u)),(P.includes("TERRAIN")||p.indexOf("symbol")!==-1||p.indexOf("circle")!==-1)&&(this.terrainUniforms=(tt=>({u_dem:new a.cg(tt),u_dem_prev:new a.cg(tt),u_dem_tl:new a.cj(tt),u_dem_scale:new a.ci(tt),u_dem_tl_prev:new a.cj(tt),u_dem_scale_prev:new a.ci(tt),u_dem_size:new a.ci(tt),u_dem_lerp:new a.ci(tt),u_exaggeration:new a.ci(tt),u_depth:new a.cg(tt),u_depth_size_inv:new a.cj(tt),u_depth_range_unpack:new a.cj(tt),u_occluder_half_size:new a.ci(tt),u_occlusion_depth_offset:new a.ci(tt),u_meter_to_dem:new a.ci(tt),u_label_plane_matrix_inv:new a.ck(tt)}))(u)),P.includes("GLOBE")&&(this.globeUniforms=(tt=>({u_tile_tl_up:new a.ch(tt),u_tile_tr_up:new a.ch(tt),u_tile_br_up:new a.ch(tt),u_tile_bl_up:new a.ch(tt),u_tile_up_scale:new a.ci(tt)}))(u)),P.includes("FOG")&&(this.fogUniforms=(tt=>({u_fog_matrix:new a.ck(tt),u_fog_range:new a.cj(tt),u_fog_color:new a.d2(tt),u_fog_horizon_blend:new a.ci(tt),u_fog_vertical_limit:new a.cj(tt),u_fog_temporal_offset:new a.ci(tt),u_frustum_tl:new a.ch(tt),u_frustum_tr:new a.ch(tt),u_frustum_br:new a.ch(tt),u_frustum_bl:new a.ch(tt),u_globe_pos:new a.ch(tt),u_globe_radius:new a.ci(tt),u_globe_transition:new a.ci(tt),u_is_globe:new a.cg(tt),u_viewport:new a.cj(tt)}))(u)),P.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(tt=>({u_cutoff_params:new a.d2(tt)}))(u)),P.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(tt=>({u_lighting_ambient_color:new a.ch(tt),u_lighting_directional_dir:new a.ch(tt),u_lighting_directional_color:new a.ch(tt),u_ground_radiance:new a.ch(tt)}))(u)),P.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(tt=>({u_light_matrix_0:new a.ck(tt),u_light_matrix_1:new a.ck(tt),u_fade_range:new a.cj(tt),u_shadow_normal_offset:new a.ch(tt),u_shadow_intensity:new a.ci(tt),u_shadow_texel_size:new a.ci(tt),u_shadow_map_resolution:new a.ci(tt),u_shadow_direction:new a.ch(tt),u_shadow_bias:new a.ch(tt),u_shadowmap_0:new a.cg(tt),u_shadowmap_1:new a.cg(tt)}))(u)))}getAttributeLocation(u,p){let b=this.attributes[p];return b===void 0&&(b=this.attributes[p]=u.getAttribLocation(this.program,p)),b}setTerrainUniformValues(u,p){if(!this.terrainUniforms)return;const b=this.terrainUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const A in p)b[A]&&b[A].set(this.program,A,p[A])}}setGlobeUniformValues(u,p){if(!this.globeUniforms)return;const b=this.globeUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const A in p)b[A]&&b[A].set(this.program,A,p[A])}}setFogUniformValues(u,p){if(!this.fogUniforms)return;const b=this.fogUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}}setCutoffUniformValues(u,p){if(!this.cutoffUniforms)return;const b=this.cutoffUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}}setLightsUniformValues(u,p){if(!this.lightsUniforms)return;const b=this.lightsUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}}setShadowUniformValues(u,p){if(this.failedToCreate||!this.shadowUniforms)return;const b=this.shadowUniforms;u.program.set(this.program);for(const A in p)b[A].set(this.program,A,p[A])}_drawDebugWireframe(u,p,b,A,M,P,O,B,G,j){const X=u.options.wireframe;if(X.terrain===!1&&X.layers2D===!1&&X.layers3D===!1)return;const W=u.context;if(!(()=>!(!X.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!X.layers2D||u._terrain&&u._terrain.renderingToTexture||!Dx.includes(this.name))||!(!X.layers3D||!Px.includes(this.name)))())return;const K=W.gl,tt=u.wireframeDebugCache.getLinesFromTrianglesBuffer(u.frameCounter,M,W);if(!tt)return;const rt=[...this.fixedDefines];rt.push("DEBUG_WIREFRAME");const ht=u.getOrCreateProgram(this.name,{config:this.configuration,defines:rt});W.program.set(ht.program);const st=(vt,Pt,wt)=>{if(Pt[vt]&&wt[vt])for(const Rt in Pt[vt])wt[vt][Rt]&&wt[vt][Rt].set(wt.program,Rt,Pt[vt][Rt].current)};G&&G.setUniforms(ht.program,W,ht.binderUniforms,O,{zoom:B}),st("fixedUniforms",this,ht),st("terrainUniforms",this,ht),st("globeUniforms",this,ht),st("fogUniforms",this,ht),st("lightsUniforms",this,ht),st("shadowUniforms",this,ht),tt.bind(),W.setColorMode(new lr([K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ZERO,K.ONE],a.ao.transparent,[!0,!0,!0,!1])),W.setDepthMode(new fi(p.func===K.LESS?K.LEQUAL:p.func,fi.ReadOnly,p.range)),W.setStencilMode($i.disabled);const gt=3*P.primitiveLength*2,xt=3*P.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const vt=j||1;for(let Pt=0;Pt<vt;++Pt)ht.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pt),K.drawElements(K.LINES,gt,K.UNSIGNED_SHORT,xt)}else j&&j>1?K.drawElementsInstanced(K.LINES,gt,K.UNSIGNED_SHORT,xt,j):K.drawElements(K.LINES,gt,K.UNSIGNED_SHORT,xt);M.bind(),W.program.set(this.program),W.setDepthMode(p),W.setStencilMode(b),W.setColorMode(A)}checkUniforms(u,p,b){if(this.fixedDefines.includes(p)){for(const A of Object.keys(b))if(!b[A].initialized)throw new Error(`Program '${this.name}', from draw '${u}': uniform ${A} not set but required by ${p} being defined`)}}draw(u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht){const st=u.context,gt=st.gl;if(this.failedToCreate)return;st.program.set(this.program),st.setDepthMode(b),st.setStencilMode(A),st.setColorMode(M),st.setCullFace(P);for(const Pt of Object.keys(this.fixedUniforms))this.fixedUniforms[Pt].set(this.program,Pt,O[Pt]);tt&&tt.setUniforms(this.program,st,this.binderUniforms,W,{zoom:K});const xt={[gt.POINTS]:1,[gt.LINES]:2,[gt.TRIANGLES]:3,[gt.LINE_STRIP]:1}[p];this.checkUniforms(B,"RENDER_SHADOWS",this.shadowUniforms);const vt=ht&&ht>0?1:void 0;for(const Pt of X.get()){const wt=Pt.vaos||(Pt.vaos={});if((wt[B]||(wt[B]=new of)).bind(st,this,G,tt?tt.getPaintVertexBuffers():[],j,Pt.vertexOffset,rt||[],vt),this.forceManualRenderingForInstanceIDShaders){const Rt=ht||1;for(let Mt=0;Mt<Rt;++Mt)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Mt),j?gt.drawElements(p,Pt.primitiveLength*xt,gt.UNSIGNED_SHORT,Pt.primitiveOffset*xt*2):gt.drawArrays(p,Pt.vertexOffset,Pt.vertexLength)}else ht&&ht>1?gt.drawElementsInstanced(p,Pt.primitiveLength*xt,gt.UNSIGNED_SHORT,Pt.primitiveOffset*xt*2,ht):j?gt.drawElements(p,Pt.primitiveLength*xt,gt.UNSIGNED_SHORT,Pt.primitiveOffset*xt*2):gt.drawArrays(p,Pt.vertexOffset,Pt.vertexLength);p===gt.TRIANGLES&&j&&this._drawDebugWireframe(u,b,A,M,j,Pt,W,K,tt,ht)}}}function c_(x,u,p=0){const b=Math.pow(2,u.tileID.overscaledZ),A=u.tileSize*Math.pow(2,x.transform.tileZoom)/b,M=A*(u.tileID.canonical.x+u.tileID.wrap*b),P=A*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture?u.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ay(u,1,x.transform.tileZoom),u_pixel_coord_upper:[M>>16,P>>16],u_pixel_coord_lower:[65535&M,65535&P],u_pattern_transition:p}}const hf={terrain:0,flat:1},h_=a.bB(),d_=(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st)=>{const gt=u.style.light,xt=gt.properties.get("position"),vt=[xt.x,xt.y,xt.z],Pt=a.dN();gt.properties.get("anchor")==="viewport"&&(a.dO(Pt,-u.transform.angle),a.dP(vt,vt,Pt));const wt=gt.properties.get("color").toPremultipliedRenderColor(null),Rt=u.transform,Mt={u_matrix:x,u_lightpos:vt,u_lightintensity:gt.properties.get("intensity"),u_lightcolor:[wt.r,wt.g,wt.b],u_vertical_gradient:+p,u_opacity:b,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:h_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:hf[G],u_base_type:hf[j],u_ao:A,u_edge_radius:M,u_width_scale:P,u_flood_light_color:tt,u_vertical_scale:rt,u_flood_light_intensity:ht,u_ground_shadow_factor:st};return Rt.projection.name==="globe"&&(Mt.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],Mt.u_zoom_transition=X,Mt.u_inv_rot_matrix=K,Mt.u_merc_center=W,Mt.u_up_dir=Rt.projection.upVector(new a.cC(0,0,0),W[0]*a.al,W[1]*a.al),Mt.u_height_lift=B),Mt},_T=(x,u,p,b,A,M)=>({u_matrix:x,u_edge_radius:u,u_width_scale:p,u_vertical_scale:b,u_height_type:hf[A],u_base_type:hf[M]}),yT=(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st)=>{const gt=d_(x,u,p,b,A,M,P,O,G,j,X,W,K,tt,rt,ht,1,[0,0,0]),xt={u_height_factor:-Math.pow(2,O.overscaledZ)/B.tileSize/8};return Object.assign(gt,c_(u,B,st),xt)},df=(x,u,p,b,A,M,P,O,B,G,j)=>({u_matrix:u,u_opacity:p,u_ao_pass:b?1:0,u_meter_to_tile:A,u_ao:M,u_flood_light_intensity:P,u_flood_light_color:O,u_attenuation:B,u_edge_radius:G,u_fb:0,u_fb_size:j,u_dynamic_offset:1}),xT=(x,u,p)=>({u_matrix:x,u_emissive_strength:u,u_ground_shadow_factor:p}),bT=(x,u,p,b,A,M=0)=>Object.assign(xT(x,u,A),c_(p,b,M)),eD=(x,u,p,b)=>({u_matrix:x,u_world:p,u_emissive_strength:u,u_ground_shadow_factor:b}),iD=(x,u,p,b,A,M,P=0)=>Object.assign(bT(x,u,p,b,M,P),{u_world:A}),rD=(x,u)=>({u_matrix:x,u_ground_shadow_factor:u}),f_=(x,u,p,b,A)=>({u_matrix:x,u_camera_pos:[u[0],u[1],u[2]],u_depth_bias:p,u_height_scale:b,u_reset_depth:A}),Lx=(x,u,p,b,A,M,P,O,B)=>({u_matrix:x,u_normal_matrix:u,u_opacity:p,u_faux_facade_ao_intensity:b,u_camera_pos:A,u_tile_to_meter:M,u_facade_emissive_chance:P,u_flood_light_color:O,u_flood_light_intensity:B}),Rx=x=>({u_matrix:x}),wT=x=>({u_matrix:x}),ff=(x,u,p,b,A,M,P,O)=>{const B=a.al/M.tileSize;return{u_matrix:x,u_inv_rot_matrix:u,u_camera_to_center_distance:p.getCameraToCenterDistance(O),u_extrude_scale:[p.pixelsToGLUnits[0]/B,p.pixelsToGLUnits[1]/B],u_zoom_transition:b,u_tile_id:P,u_merc_center:A}},kx=(x,u,p=1)=>({u_matrix:x,u_color:u,u_overlay:0,u_overlay_scale:p}),ST=a.bB(),TT=(x,u,p,b,A,M,P)=>{const O=x.transform,B=O.projection.name==="globe",G=B?a.dQ(O.zoom,u.canonical)*O._pixelsPerMercatorPixel:a.ay(p,1,M),j={u_matrix:u.projMatrix,u_extrude_scale:G,u_intensity:P,u_inv_rot_matrix:ST,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){j.u_inv_rot_matrix=b,j.u_merc_center=A,j.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],j.u_zoom_transition=a.aj(O.zoom);const X=A[0]*a.al,W=A[1]*a.al;j.u_up_dir=O.projection.upVector(new a.cC(0,0,0),X,W)}return j};function p_(x,[u,p,b,A],[M,P]){if(M===P)return[0,0,0,0];const O=255*(x-1)/(x*(P-M));return[u*O,p*O,b*O,A*O]}function Wu(x,u,[p,b]){return p===b?0:.5/x+(u-p)*(x-1)/(x*(b-p))}const Mg=(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st,gt,xt,vt)=>({u_matrix:x,u_normalize_matrix:u,u_globe_matrix:p,u_merc_matrix:b,u_grid_matrix:A,u_tl_parent:M,u_scale_parent:G,u_fade_t:j.mix,u_opacity:j.opacity*X.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:X.paint.get("raster-brightness-min"),u_brightness_high:X.paint.get("raster-brightness-max"),u_saturation_factor:a.dS(X.paint.get("raster-saturation")),u_contrast_factor:a.dR(X.paint.get("raster-contrast")),u_spin_weights:g_(X.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:K,u_zoom_transition:P,u_merc_center:O,u_cutoff_params:B,u_colorization_mix:p_(a.dT,rt,st),u_colorization_offset:Wu(a.dT,ht,st),u_color_ramp:tt,u_texture_offset:[xt/(gt+2*xt),gt/(gt+2*xt)],u_texture_res:[gt+2*xt,gt+2*xt],u_emissive_strength:vt});function g_(x){x*=Math.PI/180;const u=Math.sin(x),p=Math.cos(x);return[(2*p+1)/3,(-Math.sqrt(3)*u-p+1)/3,(Math.sqrt(3)*u-p+1)/3]}const Vh=.05,Ec=(x,u,p,b,A,M,P,O,B,G,j,X)=>({u_matrix:x,u_normalize_matrix:u,u_globe_matrix:p,u_merc_matrix:b,u_grid_matrix:A,u_tl_parent:M,u_scale_parent:G,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:X,u_zoom_transition:P,u_merc_center:O,u_cutoff_params:B}),Ox=(x,u,p,b,A,M,P,O,B,G)=>({u_particle_texture:x,u_particle_texture_side_len:u,u_tile_offset:p,u_velocity:b,u_color_ramp:M,u_velocity_res:A,u_max_speed:P,u_uv_offset:O,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vh,Vh]}),m_=(x,u,p,b,A,M,P,O,B,G)=>({u_particle_texture:x,u_particle_texture_side_len:u,u_velocity:p,u_velocity_res:b,u_max_speed:A,u_speed_factor:M,u_reset_rate:P,u_rand_seed:Math.random(),u_uv_offset:O,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vh,Vh]}),zx=a.bB(),Bx=(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st,gt,xt,vt,Pt,wt,Rt)=>{const Mt=A.transform,At={u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Mt.getCameraToCenterDistance(gt),u_rotate_symbol:+p,u_aspect_ratio:Mt.width/Mt.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:P,u_coord_matrix:O,u_is_text:+G,u_elevation_from_sea:B?1:0,u_pitch_with_map:+b,u_texsize:j,u_texsize_icon:X,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zx,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:zx,u_up_vector:[0,-1,0],u_color_adj_mat:Pt,u_icon_transition:wt||0,u_gamma_scale:b?A.transform.getCameraToCenterDistance(gt)*Math.cos(A.terrain?0:A.transform._pitch):1,u_device_pixel_ratio:a.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Rt||1,u_ground_shadow_factor:xt,u_inv_matrix:a.bk(a.bB(),P),u_normal_scale:vt,u_lutTexture:io.LUT};return gt.name==="globe"&&(At.u_tile_id=[K.canonical.x,K.canonical.y,1<<K.canonical.z],At.u_zoom_transition=tt,At.u_inv_rot_matrix=ht,At.u_merc_center=rt,At.u_camera_forward=Mt._camera.forward(),At.u_ecef_origin=a.dU(Mt.globeMatrix,K.toUnwrapped()),At.u_tile_matrix=Float32Array.from(Mt.globeMatrix),At.u_up_vector=st),At},v_=(x,u,p,b)=>({u_matrix:x,u_emissive_strength:u,u_opacity:p,u_color:b}),__=(x,u,p,b,A,M,P,O,B)=>Object.assign(function(G,j,X,W,K,tt){const{width:rt,height:ht}=W.imageManager.getPixelSize(j),st=Math.pow(2,tt.tileID.overscaledZ),gt=tt.tileSize*Math.pow(2,W.transform.tileZoom)/st,xt=gt*(tt.tileID.canonical.x+tt.tileID.wrap*st),vt=gt*tt.tileID.canonical.y;return{u_image:0,u_pattern_tl:X.tl,u_pattern_br:X.br,u_texsize:[rt,ht],u_pattern_size:X.displaySize,u_pattern_units_to_pixels:K?[W.transform.width,-1*W.transform.height]:[1/a.ay(tt,1,W.transform.tileZoom),1/a.ay(tt,1,W.transform.tileZoom)],u_pixel_coord_upper:[xt>>16,vt>>16],u_pixel_coord_lower:[65535&xt,65535&vt]}}(0,M,P,b,O,B),{u_matrix:x,u_emissive_strength:u,u_opacity:p}),Fx=new Float32Array(a.bz([])),y_=(x,u,p,b,A,M,P,O,B,G,j,X,W,K=[0,0,0],tt,rt,ht)=>{const st=A.style.light,gt=st.properties.get("position"),xt=[-gt.x,-gt.y,gt.z],vt=a.dN();st.properties.get("anchor")==="viewport"&&(a.dO(vt,-A.transform.angle),a.dP(xt,xt,vt));const Pt=j.alphaMode==="MASK",wt=st.properties.get("color").toNonPremultipliedRenderColor(null),Rt=W.paint.get("model-ambient-occlusion-intensity"),Mt=W.paint.get("model-color").constantOr(a.ao.white).toNonPremultipliedRenderColor(null);return Mt.a=W.paint.get("model-color-mix-intensity").constantOr(0),ht&&(Mt.r=ht[0],Mt.g=ht[1],Mt.b=ht[2],Mt.a=ht[3]),rt&&(Mt.r=rt.color.r,Mt.g=rt.color.g,Mt.b=rt.color.b,Mt.a=rt.colorMix,X=rt.emissionStrength,M=rt.opacity),{u_matrix:x,u_lighting_matrix:u,u_normal_matrix:p,u_node_matrix:b||Fx,u_lightpos:xt,u_lightintensity:st.properties.get("intensity"),u_lightcolor:[wt.r,wt.g,wt.b],u_camera_pos:K,u_opacity:M,u_baseTextureIsAlpha:0,u_alphaMask:+Pt,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:O.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:B,u_roughnessFactor:G,u_baseColorTexture:io.BaseColor,u_metallicRoughnessTexture:io.MetallicRoughness,u_normalTexture:io.Normal,u_occlusionTexture:io.Occlusion,u_emissionTexture:io.Emission,u_lutTexture:io.LUT,u_color_mix:Mt.toArray01(),u_aoIntensity:Rt,u_emissive_strength:X,u_occlusionTextureTransform:tt||[0,0,0,0]}},pf=(x,u=Fx,p=Fx)=>({u_matrix:x,u_instance:u,u_node_matrix:p}),nD={fillExtrusion:x=>({u_matrix:new a.ck(x),u_lightpos:new a.ch(x),u_lightintensity:new a.ci(x),u_lightcolor:new a.ch(x),u_vertical_gradient:new a.ci(x),u_opacity:new a.ci(x),u_edge_radius:new a.ci(x),u_width_scale:new a.ci(x),u_ao:new a.cj(x),u_height_type:new a.cg(x),u_base_type:new a.cg(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_up_dir:new a.ch(x),u_height_lift:new a.ci(x),u_flood_light_color:new a.ch(x),u_vertical_scale:new a.ci(x),u_flood_light_intensity:new a.ci(x),u_ground_shadow_factor:new a.ch(x)}),fillExtrusionDepth:x=>({u_matrix:new a.ck(x),u_edge_radius:new a.ci(x),u_width_scale:new a.ci(x),u_vertical_scale:new a.ci(x),u_height_type:new a.cg(x),u_base_type:new a.cg(x)}),fillExtrusionPattern:x=>({u_matrix:new a.ck(x),u_lightpos:new a.ch(x),u_lightintensity:new a.ci(x),u_lightcolor:new a.ch(x),u_vertical_gradient:new a.ci(x),u_height_factor:new a.ci(x),u_edge_radius:new a.ci(x),u_width_scale:new a.ci(x),u_ao:new a.cj(x),u_height_type:new a.cg(x),u_base_type:new a.cg(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_up_dir:new a.ch(x),u_height_lift:new a.ci(x),u_image:new a.cg(x),u_texsize:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_tile_units_to_pixels:new a.ci(x),u_opacity:new a.ci(x),u_pattern_transition:new a.ci(x)}),fillExtrusionGroundEffect:x=>({u_matrix:new a.ck(x),u_opacity:new a.ci(x),u_ao_pass:new a.ci(x),u_meter_to_tile:new a.ci(x),u_ao:new a.cj(x),u_flood_light_intensity:new a.ci(x),u_flood_light_color:new a.ch(x),u_attenuation:new a.ci(x),u_edge_radius:new a.ci(x),u_fb:new a.cg(x),u_fb_size:new a.ci(x),u_dynamic_offset:new a.ci(x)}),fill:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_ground_shadow_factor:new a.ch(x)}),fillPattern:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_image:new a.cg(x),u_texsize:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_tile_units_to_pixels:new a.ci(x),u_ground_shadow_factor:new a.ch(x),u_pattern_transition:new a.ci(x)}),fillOutline:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_world:new a.cj(x),u_ground_shadow_factor:new a.ch(x)}),fillOutlinePattern:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_world:new a.cj(x),u_image:new a.cg(x),u_texsize:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_tile_units_to_pixels:new a.ci(x),u_ground_shadow_factor:new a.ch(x),u_pattern_transition:new a.ci(x)}),building:x=>({u_matrix:new a.ck(x),u_normal_matrix:new a.ck(x),u_opacity:new a.ci(x),u_faux_facade_ao_intensity:new a.ci(x),u_camera_pos:new a.ch(x),u_tile_to_meter:new a.ci(x),u_facade_emissive_chance:new a.ci(x),u_flood_light_color:new a.ch(x),u_flood_light_intensity:new a.ci(x)}),buildingBloom:x=>({u_matrix:new a.ck(x)}),buildingDepth:x=>({u_matrix:new a.ck(x)}),elevatedStructuresDepth:x=>({u_matrix:new a.ck(x),u_depth_bias:new a.ci(x)}),elevatedStructures:x=>({u_matrix:new a.ck(x),u_ground_shadow_factor:new a.ch(x)}),elevatedStructuresDepthReconstruct:x=>({u_matrix:new a.ck(x),u_camera_pos:new a.ch(x),u_depth_bias:new a.ci(x),u_height_scale:new a.ci(x),u_reset_depth:new a.ci(x)}),circle:a.dX,collisionBox:x=>({u_matrix:new a.ck(x),u_inv_rot_matrix:new a.ck(x),u_camera_to_center_distance:new a.ci(x),u_extrude_scale:new a.cj(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_tile_id:new a.ch(x)}),collisionCircle:x=>({u_matrix:new a.ck(x),u_inv_matrix:new a.ck(x),u_camera_to_center_distance:new a.ci(x),u_viewport_size:new a.cj(x)}),debug:x=>({u_color:new a.dA(x),u_matrix:new a.ck(x),u_overlay:new a.cg(x),u_overlay_scale:new a.ci(x)}),clippingMask:x=>({u_matrix:new a.ck(x)}),heatmap:x=>({u_extrude_scale:new a.ci(x),u_intensity:new a.ci(x),u_matrix:new a.ck(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_up_dir:new a.ch(x)}),heatmapTexture:x=>({u_image:new a.cg(x),u_color_ramp:new a.cg(x),u_opacity:new a.ci(x)}),hillshade:x=>({u_matrix:new a.ck(x),u_image:new a.cg(x),u_latrange:new a.cj(x),u_light:new a.cj(x),u_shadow:new a.dA(x),u_highlight:new a.dA(x),u_emissive_strength:new a.ci(x),u_accent:new a.dA(x)}),hillshadePrepare:x=>({u_matrix:new a.ck(x),u_image:new a.cg(x),u_dimension:new a.cj(x),u_zoom:new a.ci(x)}),line:a.dW,linePattern:a.dV,raster:x=>({u_matrix:new a.ck(x),u_normalize_matrix:new a.ck(x),u_globe_matrix:new a.ck(x),u_merc_matrix:new a.ck(x),u_grid_matrix:new a.dB(x),u_tl_parent:new a.cj(x),u_scale_parent:new a.ci(x),u_fade_t:new a.ci(x),u_opacity:new a.ci(x),u_image0:new a.cg(x),u_image1:new a.cg(x),u_brightness_low:new a.ci(x),u_brightness_high:new a.ci(x),u_saturation_factor:new a.ci(x),u_contrast_factor:new a.ci(x),u_spin_weights:new a.ch(x),u_perspective_transform:new a.cj(x),u_raster_elevation:new a.ci(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_cutoff_params:new a.d2(x),u_colorization_mix:new a.d2(x),u_colorization_offset:new a.ci(x),u_color_ramp:new a.cg(x),u_texture_offset:new a.cj(x),u_texture_res:new a.cj(x),u_emissive_strength:new a.ci(x)}),rasterParticle:x=>({u_matrix:new a.ck(x),u_normalize_matrix:new a.ck(x),u_globe_matrix:new a.ck(x),u_merc_matrix:new a.ck(x),u_grid_matrix:new a.dB(x),u_tl_parent:new a.cj(x),u_scale_parent:new a.ci(x),u_fade_t:new a.ci(x),u_opacity:new a.ci(x),u_image0:new a.cg(x),u_image1:new a.cg(x),u_raster_elevation:new a.ci(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_cutoff_params:new a.d2(x)}),rasterParticleTexture:x=>({u_texture:new a.cg(x),u_opacity:new a.ci(x)}),rasterParticleDraw:x=>({u_particle_texture:new a.cg(x),u_particle_texture_side_len:new a.ci(x),u_tile_offset:new a.cj(x),u_velocity:new a.cg(x),u_color_ramp:new a.cg(x),u_velocity_res:new a.cj(x),u_max_speed:new a.ci(x),u_uv_offset:new a.cj(x),u_data_scale:new a.cj(x),u_data_offset:new a.ci(x),u_particle_pos_scale:new a.ci(x),u_particle_pos_offset:new a.cj(x)}),rasterParticleUpdate:x=>({u_particle_texture:new a.cg(x),u_particle_texture_side_len:new a.ci(x),u_velocity:new a.cg(x),u_velocity_res:new a.cj(x),u_max_speed:new a.ci(x),u_speed_factor:new a.ci(x),u_reset_rate:new a.ci(x),u_rand_seed:new a.ci(x),u_uv_offset:new a.cj(x),u_data_scale:new a.cj(x),u_data_offset:new a.ci(x),u_particle_pos_scale:new a.ci(x),u_particle_pos_offset:new a.cj(x)}),symbol:x=>({u_is_size_zoom_constant:new a.cg(x),u_is_size_feature_constant:new a.cg(x),u_size_t:new a.ci(x),u_size:new a.ci(x),u_camera_to_center_distance:new a.ci(x),u_rotate_symbol:new a.cg(x),u_aspect_ratio:new a.ci(x),u_fade_change:new a.ci(x),u_matrix:new a.ck(x),u_label_plane_matrix:new a.ck(x),u_coord_matrix:new a.ck(x),u_is_text:new a.cg(x),u_elevation_from_sea:new a.cg(x),u_pitch_with_map:new a.cg(x),u_texsize:new a.cj(x),u_texsize_icon:new a.cj(x),u_texture:new a.cg(x),u_texture_icon:new a.cg(x),u_gamma_scale:new a.ci(x),u_device_pixel_ratio:new a.ci(x),u_tile_id:new a.ch(x),u_zoom_transition:new a.ci(x),u_inv_rot_matrix:new a.ck(x),u_merc_center:new a.cj(x),u_camera_forward:new a.ch(x),u_tile_matrix:new a.ck(x),u_up_vector:new a.ch(x),u_ecef_origin:new a.ch(x),u_is_halo:new a.cg(x),u_icon_transition:new a.ci(x),u_color_adj_mat:new a.ck(x),u_scale_factor:new a.ci(x),u_ground_shadow_factor:new a.ch(x),u_inv_matrix:new a.ck(x),u_normal_scale:new a.ci(x),u_lutTexture:new a.cg(x)}),background:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_opacity:new a.ci(x),u_color:new a.dA(x)}),backgroundPattern:x=>({u_matrix:new a.ck(x),u_emissive_strength:new a.ci(x),u_opacity:new a.ci(x),u_image:new a.cg(x),u_pattern_tl:new a.cj(x),u_pattern_br:new a.cj(x),u_texsize:new a.cj(x),u_pattern_size:new a.cj(x),u_pixel_coord_upper:new a.cj(x),u_pixel_coord_lower:new a.cj(x),u_pattern_units_to_pixels:new a.cj(x)}),terrainRaster:x=>({u_matrix:new a.ck(x),u_image0:new a.cg(x),u_skirt_height:new a.ci(x),u_ground_shadow_factor:new a.ch(x)}),skybox:x=>({u_matrix:new a.ck(x),u_sun_direction:new a.ch(x),u_cubemap:new a.cg(x),u_opacity:new a.ci(x),u_temporal_offset:new a.ci(x)}),skyboxGradient:x=>({u_matrix:new a.ck(x),u_color_ramp:new a.cg(x),u_center_direction:new a.ch(x),u_radius:new a.ci(x),u_opacity:new a.ci(x),u_temporal_offset:new a.ci(x)}),skyboxCapture:x=>({u_matrix_3f:new a.dB(x),u_sun_direction:new a.ch(x),u_sun_intensity:new a.ci(x),u_color_tint_r:new a.d2(x),u_color_tint_m:new a.d2(x),u_luminance:new a.ci(x)}),globeRaster:x=>({u_proj_matrix:new a.ck(x),u_globe_matrix:new a.ck(x),u_normalize_matrix:new a.ck(x),u_merc_matrix:new a.ck(x),u_zoom_transition:new a.ci(x),u_merc_center:new a.cj(x),u_image0:new a.cg(x),u_grid_matrix:new a.dB(x),u_skirt_height:new a.ci(x),u_far_z_cutoff:new a.ci(x),u_frustum_tl:new a.ch(x),u_frustum_tr:new a.ch(x),u_frustum_br:new a.ch(x),u_frustum_bl:new a.ch(x),u_globe_pos:new a.ch(x),u_globe_radius:new a.ci(x),u_viewport:new a.cj(x)}),globeAtmosphere:x=>({u_frustum_tl:new a.ch(x),u_frustum_tr:new a.ch(x),u_frustum_br:new a.ch(x),u_frustum_bl:new a.ch(x),u_horizon:new a.ci(x),u_transition:new a.ci(x),u_fadeout_range:new a.ci(x),u_atmosphere_fog_color:new a.d2(x),u_high_color:new a.d2(x),u_space_color:new a.d2(x),u_temporal_offset:new a.ci(x),u_horizon_angle:new a.ci(x)}),model:x=>({u_matrix:new a.ck(x),u_lighting_matrix:new a.ck(x),u_normal_matrix:new a.ck(x),u_node_matrix:new a.ck(x),u_lightpos:new a.ch(x),u_lightintensity:new a.ci(x),u_lightcolor:new a.ch(x),u_camera_pos:new a.ch(x),u_opacity:new a.ci(x),u_baseColorFactor:new a.d2(x),u_emissiveFactor:new a.d2(x),u_metallicFactor:new a.ci(x),u_roughnessFactor:new a.ci(x),u_baseTextureIsAlpha:new a.cg(x),u_alphaMask:new a.cg(x),u_alphaCutoff:new a.ci(x),u_baseColorTexture:new a.cg(x),u_metallicRoughnessTexture:new a.cg(x),u_normalTexture:new a.cg(x),u_occlusionTexture:new a.cg(x),u_emissionTexture:new a.cg(x),u_lutTexture:new a.cg(x),u_color_mix:new a.d2(x),u_aoIntensity:new a.ci(x),u_emissive_strength:new a.ci(x),u_occlusionTextureTransform:new a.d2(x)}),modelDepth:x=>({u_matrix:new a.ck(x),u_instance:new a.ck(x),u_node_matrix:new a.ck(x)}),groundShadow:x=>({u_matrix:new a.ck(x),u_ground_shadow_factor:new a.ch(x)}),stars:x=>({u_matrix:new a.ck(x),u_up:new a.ch(x),u_right:new a.ch(x),u_intensity_multiplier:new a.ci(x)}),snowParticle:x=>({u_modelview:new a.ck(x),u_projection:new a.ck(x),u_time:new a.ci(x),u_cam_pos:new a.ch(x),u_velocityConeAperture:new a.ci(x),u_velocity:new a.ci(x),u_horizontalOscillationRadius:new a.ci(x),u_horizontalOscillationRate:new a.ci(x),u_boxSize:new a.ci(x),u_billboardSize:new a.ci(x),u_simpleShapeParameters:new a.cj(x),u_screenSize:new a.cj(x),u_thinningCenterPos:new a.cj(x),u_thinningShape:new a.ch(x),u_thinningAffectedRatio:new a.ci(x),u_thinningParticleOffset:new a.ci(x),u_particleColor:new a.d2(x),u_direction:new a.ch(x)}),rainParticle:x=>({u_modelview:new a.ck(x),u_projection:new a.ck(x),u_time:new a.ci(x),u_cam_pos:new a.ch(x),u_texScreen:new a.cg(x),u_velocityConeAperture:new a.ci(x),u_velocity:new a.ci(x),u_boxSize:new a.ci(x),u_rainDropletSize:new a.cj(x),u_distortionStrength:new a.ci(x),u_rainDirection:new a.ch(x),u_color:new a.d2(x),u_screenSize:new a.cj(x),u_thinningCenterPos:new a.cj(x),u_thinningShape:new a.ch(x),u_thinningAffectedRatio:new a.ci(x),u_thinningParticleOffset:new a.ci(x),u_shapeDirectionalPower:new a.ci(x),u_shapeNormalPower:new a.ci(x),u_mode:new a.ci(x)}),vignette:x=>({u_vignetteShape:new a.ch(x),u_vignetteColor:new a.d2(x)}),occlusion:x=>({u_matrix:new a.ck(x),u_anchorPos:new a.ch(x),u_screenSizePx:new a.cj(x),u_occluderSizePx:new a.cj(x),u_color:new a.d2(x)})};class Dc{constructor(u,p,b,A){this.id=Dc.uniqueIdxCounter,Dc.uniqueIdxCounter++,this.context=u;const M=u.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!b,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||A||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){this.id=Dc.uniqueIdxCounter,Dc.uniqueIdxCounter++;const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Dc.uniqueIdxCounter=0;const AT={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class aD{constructor(u,p,b,A,M,P){this.length=p.length,this.attributes=b,this.itemSize=p.bytesPerElement,this.dynamicDraw=A,this.instanceCount=P,this.context=u;const O=u.gl;this.buffer=O.createBuffer(),u.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||M||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,p){for(let b=0;b<this.attributes.length;b++){const A=p.getAttributeLocation(u,this.attributes[b].name);A!==-1&&u.enableVertexAttribArray(A)}}setVertexAttribPointers(u,p,b){for(let A=0;A<this.attributes.length;A++){const M=this.attributes[A],P=p.getAttributeLocation(u,M.name);P!==-1&&u.vertexAttribPointer(P,M.components,u[AT[M.type]],!1,this.itemSize,M.offset+this.itemSize*(b||0))}}setVertexAttribDivisor(u,p,b){for(let A=0;A<this.attributes.length;A++){const M=p.getAttributeLocation(u,this.attributes[A].name);M!==-1&&this.instanceCount&&this.instanceCount>0&&u.vertexAttribDivisor(M,b)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class x_{constructor(u,p,b,A,M){this.context=u,this.width=p,this.height=b;const P=this.framebuffer=u.gl.createFramebuffer();A&&(this.colorAttachment=new QE(u,P)),M&&(this.depthAttachmentType=M,this.depthAttachment=M==="renderbuffer"?new mT(u,P):new tD(u,P))}destroy(){const u=this.context.gl;if(this.colorAttachment){const p=this.colorAttachment.get();p&&u.deleteTexture(p)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const p=this.depthAttachment.get();p&&u.deleteRenderbuffer(p)}else{const p=this.depthAttachment.get();p&&u.deleteTexture(p)}u.deleteFramebuffer(this.framebuffer)}}class b_{constructor(u,p){this.gl=u,this.clearColor=new lT(this),this.clearDepth=new yx(this),this.clearStencil=new ZE(this),this.colorMask=new qE(this),this.depthMask=new XE(this),this.stencilMask=new YE(this),this.stencilFunc=new uT(this),this.stencilOp=new KE(this),this.stencilTest=new e_(this),this.depthRange=new JE(this),this.depthTest=new cT(this),this.depthFunc=new xx(this),this.blend=new i_(this),this.blendFunc=new bx(this),this.blendColor=new Bh(this),this.blendEquation=new sf(this),this.cullFace=new wg(this),this.cullFaceSide=new lf(this),this.frontFace=new hT(this),this.program=new Sx(this),this.activeTexture=new dT(this),this.viewport=new uf(this),this.bindFramebuffer=new r_(this),this.bindRenderbuffer=new n_(this),this.bindTexture=new Tx(this),this.bindVertexBuffer=new a_(this),this.bindElementBuffer=new Sg(this),this.bindVertexArrayOES=new fT(this),this.pixelStoreUnpack=new pT(this),this.pixelStoreUnpackPremultiplyAlpha=new gT(this),this.pixelStoreUnpackFlipY=new cf(this),this.options=p?Object.assign({},p):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=u.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=u.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=u.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=p&&!!p.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=u.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),this.maxPointSize=u.getParameter(u.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,p,b){return new Dc(this,u,p,b)}createVertexBuffer(u,p,b,A,M){return new aD(this,u,p,b,A,M)}createRenderbuffer(u,p,b){const A=this.gl,M=A.createRenderbuffer();return this.bindRenderbuffer.set(M),A.renderbufferStorage(A.RENDERBUFFER,u,p,b),this.bindRenderbuffer.set(null),M}createFramebuffer(u,p,b,A){return new x_(this,u,p,b,A)}clear({color:u,depth:p,stencil:b,colorMask:A}){const M=this.gl;let P=0;u&&(P|=M.COLOR_BUFFER_BIT,this.clearColor.set(u.toNonPremultipliedRenderColor(null)),this.colorMask.set(A||[!0,!0,!0,!0])),p!==void 0&&(P|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),b!==void 0&&(P|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),M.clear(P)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){a.bx(u.blendFunction,lr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor),u.blendEquation?this.blendEquation.set(u.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(u.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let hu;function Eg(x,u,p,b,A,M,P){const O=x.context,B=O.gl,G=x.transform,j=[a.aF(G.center.lng),a.aJ(G.center.lat)],X=p.layout.get("symbol-placement"),W=p.layout.get("text-variable-anchor"),K=p.layout.get("icon-rotation-alignment")==="map",tt=p.layout.get("text-rotation-alignment")==="map",rt=X!=="point",ht=[];let st=0,gt=0;for(let At=0;At<b.length;At++){const kt=b[At],qt=u.getTile(kt),jt=qt.getBucket(p);if(!jt)continue;const oe=jt.getProjection().createInversionMatrix(G,kt.canonical),te=[],fe=eT(kt,jt,G),ze=!P&&K&&rt,Qt=P&&tt&&rt,Gt=W&&jt.hasTextData(),pe=jt.hasIconTextFit()&&Gt&&jt.hasIconData(),ee=ze||Qt||P&&Gt||pe,Ae=jt.projection.name==="globe",Ge=Ae?a.aj(G.zoom):0;Ae&&(te.push("PROJECTION_GLOBE_VIEW"),ee&&te.push("PROJECTED_POS_ON_VIEWPORT"));const ui=x.getOrCreateProgram("collisionBox",{defines:te});let Le=fe;A[0]===0&&A[1]===0||(Le=x.translatePosMatrix(fe,qt,A,M));const Fe=P?jt.textCollisionBox:jt.iconCollisionBox,hi=jt.collisionCircleArray;if(hi.length>0){const ii=a.bB(),oi=Le;a.cO(ii,jt.placementInvProjMatrix,G.glCoordMatrix),a.cO(ii,ii,jt.placementViewportMatrix),ht.push({circleArray:hi,circleOffset:gt,transform:oi,invTransform:ii,projection:jt.getProjection()}),st+=hi.length/4,gt=st}if(!Fe)continue;x.terrain&&x.terrain.setupElevationDraw(qt,ui);const ai=Ae?[kt.canonical.x,kt.canonical.y,1<<kt.canonical.z]:[0,0,0];ui.draw(x,B.LINES,fi.disabled,$i.disabled,x.colorModeForRenderPass(),Ni.disabled,ff(Le,oe,G,Ge,j,qt,ai,jt.getProjection()),p.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,G.zoom,null,[Fe.collisionVertexBuffer,Fe.collisionVertexBufferExt])}if(!P||!ht.length)return;const xt=x.getOrCreateProgram("collisionCircle"),vt=new a.dY;vt.resize(4*st),vt._trim();let Pt=0;for(const At of ht)for(let kt=0;kt<At.circleArray.length/4;kt++){const qt=4*kt,jt=At.circleArray[qt+0],oe=At.circleArray[qt+1],te=At.circleArray[qt+2],fe=At.circleArray[qt+3];vt.emplace(Pt++,jt,oe,te,fe,0),vt.emplace(Pt++,jt,oe,te,fe,1),vt.emplace(Pt++,jt,oe,te,fe,2),vt.emplace(Pt++,jt,oe,te,fe,3)}(!hu||hu.length<2*st)&&(hu=function(At){const kt=2*At,qt=new a.b0;qt.resize(kt),qt._trim();for(let jt=0;jt<kt;jt++){const oe=6*jt;qt.uint16[oe+0]=4*jt+0,qt.uint16[oe+1]=4*jt+1,qt.uint16[oe+2]=4*jt+2,qt.uint16[oe+3]=4*jt+2,qt.uint16[oe+4]=4*jt+3,qt.uint16[oe+5]=4*jt+0}return qt}(st));const wt=O.createIndexBuffer(hu,!0),Rt=O.createVertexBuffer(vt,a.dZ.members,!0);for(const At of ht){const kt={u_matrix:At.transform,u_inv_matrix:At.invTransform,u_camera_to_center_distance:(Mt=G).getCameraToCenterDistance(At.projection),u_viewport_size:[Mt.width,Mt.height]};xt.draw(x,B.TRIANGLES,fi.disabled,$i.disabled,x.colorModeForRenderPass(),Ni.disabled,kt,p.id,Rt,wt,a.bf.simpleSegment(0,2*At.circleOffset,At.circleArray.length,At.circleArray.length/2),null,G.zoom)}var Mt;Rt.destroy(),wt.destroy()}const Pc=a.bB();function Nx(x){const u=x._camera.getWorldToCamera(x.worldSize,1),p=a.aB([],u,x.globeMatrix);a.bk(p,p);const b=[0,0,0],A=[0,1,0,0];return a.aC(A,A,p),b[0]=A[0],b[1]=A[1],b[2]=A[2],a.aw(b,b),b}function w_({width:x,height:u,anchor:p,textOffset:b,textScale:A},M){const{horizontalAlign:P,verticalAlign:O}=a.c0(p),B=-(P-.5)*x,G=-(O-.5)*u,j=a.c1(p,b);return new a.P((B/A+j[0])*M,(G/A+j[1])*M)}function S_(x,u,p,b,A,M,P,O,B,G){const j=x.text.placedSymbolArray,X=x.text.dynamicLayoutVertexArray,W=x.icon.dynamicLayoutVertexArray,K={},tt=x.getProjection(),rt=Hv(P,tt,A),ht=A.elevation,st=tt.upVectorScale(P.canonical,A.center.lat,A.worldSize).metersToTile;X.clear();for(let gt=0;gt<j.length;gt++){const xt=j.get(gt),{tileAnchorX:vt,tileAnchorY:Pt,numGlyphs:wt}=xt,Rt=xt.hidden||!xt.crossTileID||x.allowVerticalPlacement&&!xt.placedOrientation?null:b[xt.crossTileID];if(Rt){let Mt=0,At=0,kt=0;const qt=x.elevationType==="road";if(ht||qt){const ee=qt?x.getElevationFeatureForText(gt):null,Ae=a.bU.getAtTileOffset(P,new a.P(vt,Pt),ht,ee),[Ge,ui,Le]=tt.upVector(P.canonical,vt,Pt);Mt=Ae*Ge*st,At=Ae*ui*st,kt=Ae*Le*st}let[jt,oe,te,fe]=Ba(xt.projectedAnchorX+Mt,xt.projectedAnchorY+At,xt.projectedAnchorZ+kt,p?rt:M);const ze=ox(A.getCameraToCenterDistance(tt),fe);let Qt=a.bL(x.textSizeData,B,xt)*ze/a.bX;p&&(Qt*=x.tilePixelRatio/O);const Gt=w_(Rt,Qt);p?({x:jt,y:oe,z:te}=tt.projectTilePoint(vt+Gt.x,Pt+Gt.y,P.canonical),[jt,oe,te]=Ba(jt+Mt,oe+At,te+kt,M)):(u&&Gt._rotate(-A.angle),jt+=Gt.x,oe+=Gt.y,te=0);const pe=x.allowVerticalPlacement&&xt.placedOrientation===a.bK.vertical?Math.PI/2:0;for(let ee=0;ee<wt;ee++)a.bN(X,jt,oe,te,pe);G&&xt.associatedIconIndex>=0&&(K[xt.associatedIconIndex]={x:jt,y:oe,z:te,angle:pe})}else Uu(wt,X)}if(G){W.clear();const gt=x.icon.placedSymbolArray;for(let xt=0;xt<gt.length;xt++){const vt=gt.get(xt),{numGlyphs:Pt}=vt,wt=K[xt];if(vt.hidden||!wt)Uu(Pt,W);else{const{x:Rt,y:Mt,z:At,angle:kt}=wt;for(let qt=0;qt<Pt;qt++)a.bN(W,Rt,Mt,At,kt)}}x.icon.dynamicLayoutVertexBuffer.updateData(W)}x.text.dynamicLayoutVertexBuffer.updateData(X)}function Dg(x,u,p,b,A,M,P={}){const O=p.paint.get("icon-translate"),B=p.paint.get("text-translate"),G=p.paint.get("icon-translate-anchor"),j=p.paint.get("text-translate-anchor"),X=p.layout.get("icon-rotation-alignment"),W=p.layout.get("text-rotation-alignment"),K=p.layout.get("icon-pitch-alignment"),tt=p.layout.get("text-pitch-alignment"),rt=p.layout.get("icon-keep-upright"),ht=p.layout.get("text-keep-upright"),st=p.paint.get("icon-color-saturation"),gt=p.paint.get("icon-color-contrast"),xt=p.paint.get("icon-color-brightness-min"),vt=p.paint.get("icon-color-brightness-max"),Pt=p.layout.get("symbol-elevation-reference")==="sea",wt=p.layout.get("icon-image-use-theme")==="none",Rt=x.context,Mt=Rt.gl,At=x.transform,kt=X==="map",qt=W==="map",jt=K==="map",oe=tt==="map",te=p.layout.get("symbol-sort-key").constantOr(1)!==void 0;let fe=!1;const ze=x.depthModeForSublayer(0,fi.ReadOnly),Qt=new fi(x.context.gl.LEQUAL,fi.ReadOnly,x.depthRangeFor3D),Gt=[a.aF(At.center.lng),a.aJ(At.center.lat)],pe=p.layout.get("text-variable-anchor"),ee=At.projection.name==="globe",Ae=[],Ge=[0,-1,0];for(const ui of b){const Le=u.getTile(ui),Fe=Le.getBucket(p);if(!Fe||Fe.projection.name==="mercator"&&ee||Fe.fullyClipped)continue;const hi=Fe.projection.name==="globe",ai=hi?a.aj(At.zoom):0,ii=Hv(ui,Fe.getProjection(),At),oi=At.calculatePixelsToTileUnitsMatrix(Le),Di=pe&&Fe.hasTextData(),mr=Fe.hasIconTextFit()&&Di&&Fe.hasIconData(),Ir=Fe.getProjection().createInversionMatrix(At,ui.canonical),an=(1<<Le.tileID.canonical.z)*a.al/x.transform.worldSize,Vi=Zr=>{let Hi=[0,0,0];if(Zr){const Dr=x.style.directionalLight,Bn=x.style.ambientLight;Dr&&Bn&&(Hi=bl(x.style,Dr,Bn))}return Hi},Tr=Zr=>{At.depthOcclusionForSymbolsAndCircles&&(p.hasOcclusionOpacityProperties||x.terrain)&&(Zr.push("DEPTH_D24"),Zr.push("DEPTH_OCCLUSION"))},ir=Zr=>{p.lut&&!wt&&(p.lut.texture||(p.lut.texture=new a.d_(x.context,p.lut.image,[p.lut.image.height,p.lut.image.height,p.lut.image.height],Rt.gl.RGBA8)),Rt.activeTexture.set(Rt.gl.TEXTURE0+io.LUT),p.lut.texture&&p.lut.texture.bind(Rt.gl.LINEAR,Rt.gl.CLAMP_TO_EDGE),Zr.push("APPLY_LUT_ON_GPU"))},Qr=()=>{const Zr=kt&&p.layout.get("symbol-placement")!=="point",Hi=[];Tr(Hi),ir(Hi);const Dr=Zr||mr,Bn=Fe.elevationType==="road",ra=x.shadowRenderer,Gn=Bn&&jt&&!!ra&&ra.enabled,Jn=Vi(Gn),fs=Bn&&jt&&!x.terrain?Qt:ze,Qo=p.paint.get("icon-image-cross-fade");x.terrainRenderModeElevated()&&jt&&Hi.push("PITCH_WITH_MAP_TERRAIN"),hi&&(Hi.push("PROJECTION_GLOBE_VIEW"),Dr&&Hi.push("PROJECTED_POS_ON_VIEWPORT")),Qo>0&&Fe.hasAnySecondaryIcon&&Hi.push("ICON_TRANSITION"),!Fe.icon.zOffsetVertexBuffer||Bn&&x.terrain||Hi.push("Z_OFFSET"),st===0&&gt===0&&xt===0&&vt===1||Hi.push("COLOR_ADJUSTMENT"),Fe.sdfIcons&&Hi.push("RENDER_SDF"),Gn&&Hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bn&&jt&&!x.terrain&&Fe.icon.orientationVertexBuffer&&Hi.push("ELEVATED_ROADS");const po=Fe.icon.programConfigurations.get(p.id),Eo=x.getOrCreateProgram("symbol",{config:po,defines:Hi}),Xs=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0],go=Fe.iconSizeData,Ys=a.bJ(go,At.zoom),Cl=jt||!At.isOrthographic,qa=Xd(ii,Le.tileID.canonical,jt,kt,At,Fe.getProjection(),oi),$n=Vu(ii,Le.tileID.canonical,jt,kt,At,Fe.getProjection(),oi),na=x.translatePosMatrix($n,Le,O,G,!0),hn=x.translatePosMatrix(ii,Le,O,G),la=Dr?Pc:qa,Xa=kt&&!jt&&!Zr;let Zn=Ge;!ee&&!At.mercatorFromTransition||kt||(Zn=Nx(At));const Ks=hi?Zn:Ge,Ef=p.getColorAdjustmentMatrix(st,gt,xt,vt),Ku=Bx(go.kind,Ys,Xa,jt,x,hn,la,na,Pt,!1,Xs,[0,0],0,ui,ai,Gt,Ir,Ks,Fe.getProjection(),Jn,an,Ef,Qo,null),Df=Le.imageAtlasTexture?Le.imageAtlasTexture:null,Pf=p.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear,Js=Fe.sdfIcons||x.options.rotating||x.options.zooming||Pf||Cl?Mt.LINEAR:Mt.NEAREST,fu=Fe.sdfIcons&&p.paint.get("icon-halo-width").constantOr(1)!==0,ja=x.terrain&&jt&&Zr?a.bk(a.bB(),qa):Pc;if(Zr&&Fe.icon){const Qs=a.bU.getAtTileOffsetFunc(ui,At.center.lat,At.worldSize,Fe.getProjection()),Zh=ug(ii,Le.tileID.canonical,jt,kt,At,Fe.getProjection(),oi),XT=p.layout.get("icon-size-scale-range"),j_=a.aA(x.scaleFactor,XT[0],XT[1]);lx(Fe,ii,x,!1,Zh,$n,jt,rt,Qs,ui,j_)}return{program:Eo,buffers:Fe.icon,uniformValues:Ku,atlasTexture:Df,atlasTextureIcon:null,atlasInterpolation:Js,atlasInterpolationIcon:null,isSDF:Fe.sdfIcons,hasHalo:fu,depthMode:fs,tile:Le,renderWithShadows:Gn,labelPlaneMatrixInv:ja}},Cr=()=>{const Zr=qt&&p.layout.get("symbol-placement")!=="point",Hi=[],Dr=Zr||pe||mr,Bn=Fe.elevationType==="road",ra=x.shadowRenderer,Gn=Bn&&oe&&!!ra&&ra.enabled,Jn=Vi(Gn),fs=Bn&&oe&&!x.terrain?Qt:ze;x.terrainRenderModeElevated()&&oe&&Hi.push("PITCH_WITH_MAP_TERRAIN"),hi&&(Hi.push("PROJECTION_GLOBE_VIEW"),Dr&&Hi.push("PROJECTED_POS_ON_VIEWPORT")),!Fe.text.zOffsetVertexBuffer||Bn&&x.terrain||Hi.push("Z_OFFSET"),Fe.iconsInText&&Hi.push("RENDER_TEXT_AND_SYMBOL"),Hi.push("RENDER_SDF"),Gn&&Hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bn&&oe&&!x.terrain&&Fe.text.orientationVertexBuffer&&Hi.push("ELEVATED_ROADS"),Tr(Hi);const Qo=Fe.text.programConfigurations.get(p.id),po=x.getOrCreateProgram("symbol",{config:Qo,defines:Hi});let Eo,Xs=[0,0],go=null;const Ys=Fe.textSizeData;Fe.iconsInText&&(Xs=Le.imageAtlasTexture?Le.imageAtlasTexture.size:[0,0],go=Le.imageAtlasTexture?Le.imageAtlasTexture:null,Eo=oe||!At.isOrthographic||x.options.rotating||x.options.zooming||Ys.kind==="composite"||Ys.kind==="camera"?Mt.LINEAR:Mt.NEAREST);const Cl=Le.glyphAtlasTexture?Le.glyphAtlasTexture.size:[0,0],qa=p.layout.get("text-size-scale-range"),$n=a.aA(x.scaleFactor,qa[0],qa[1]),na=a.bJ(Ys,At.zoom,$n),hn=Xd(ii,Le.tileID.canonical,oe,qt,At,Fe.getProjection(),oi),la=Vu(ii,Le.tileID.canonical,oe,qt,At,Fe.getProjection(),oi),Xa=x.translatePosMatrix(la,Le,B,j,!0),Zn=x.translatePosMatrix(ii,Le,B,j),Ks=Dr?Pc:hn,Ef=qt&&!oe&&!Zr;let Ku=Ge;!ee&&!At.mercatorFromTransition||qt||(Ku=Nx(At));const Df=Bx(Ys.kind,na,Ef,oe,x,Zn,Ks,Xa,Pt,!0,Cl,Xs,0,ui,ai,Gt,Ir,hi?Ku:Ge,Fe.getProjection(),Jn,an,null,null,$n),Pf=Le.glyphAtlasTexture?Le.glyphAtlasTexture:null,Js=Mt.LINEAR,fu=p.paint.get("text-halo-width").constantOr(1)!==0,ja=x.terrain&&oe&&Zr?a.bk(a.bB(),hn):Pc;if(Zr&&Fe.text){const Qs=a.bU.getAtTileOffsetFunc(ui,At.center.lat,At.worldSize,Fe.getProjection()),Zh=ug(ii,Le.tileID.canonical,oe,qt,At,Fe.getProjection(),oi);lx(Fe,ii,x,!0,Zh,la,oe,ht,Qs,ui,$n)}return{program:po,buffers:Fe.text,uniformValues:Df,atlasTexture:Pf,atlasTextureIcon:go,atlasInterpolation:Js,atlasInterpolationIcon:Eo,isSDF:!0,hasHalo:fu,depthMode:fs,tile:Le,renderWithShadows:Gn,labelPlaneMatrixInv:ja}},pn=Fe.icon.segments.get().length,Or=Fe.text.segments.get().length,ar=pn&&!P.onlyText?Qr():null,Gr=Or&&!P.onlyIcons?Cr():null,ur=p.paint.get("icon-opacity").constantOr(1),wn=p.paint.get("text-opacity").constantOr(1);if(te&&Fe.canOverlap){fe=!0;const Zr=ur&&!P.onlyText?Fe.icon.segments.get():[],Hi=wn&&!P.onlyIcons?Fe.text.segments.get():[];for(const Dr of Zr)Ae.push({segments:new a.bf([Dr]),sortKey:Dr.sortKey,state:ar});for(const Dr of Hi)Ae.push({segments:new a.bf([Dr]),sortKey:Dr.sortKey,state:Gr})}else P.onlyText||Ae.push({segments:ur?Fe.icon.segments:new a.bf([]),sortKey:0,state:ar}),P.onlyIcons||Ae.push({segments:wn?Fe.text.segments:new a.bf([]),sortKey:0,state:Gr})}fe&&Ae.sort((ui,Le)=>ui.sortKey-Le.sortKey);for(const ui of Ae){const Le=ui.state;if(Le)if(x.terrain?x.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:At.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}):x.setupDepthForOcclusion(At.depthOcclusionForSymbolsAndCircles,Le.program),Rt.activeTexture.set(Mt.TEXTURE0),Le.atlasTexture&&Le.atlasTexture.bind(Le.atlasInterpolation,Mt.CLAMP_TO_EDGE,!0),Le.atlasTextureIcon&&(Rt.activeTexture.set(Mt.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Mt.CLAMP_TO_EDGE,!0)),Le.renderWithShadows&&x.shadowRenderer.setupShadows(Le.tile.tileID.toUnwrapped(),Le.program,"vector-tile"),x.uploadCommonLightUniforms(x.context,Le.program),Le.hasHalo){const Fe=Le.uniformValues;Fe.u_is_halo=1,T_(Le.buffers,ui.segments,p,x,Le.program,Le.depthMode,A,M,Fe,2),Fe.u_is_halo=0}else{if(Le.isSDF){const Fe=Le.uniformValues;Le.hasHalo&&(Fe.u_is_halo=1,T_(Le.buffers,ui.segments,p,x,Le.program,Le.depthMode,A,M,Fe,1)),Fe.u_is_halo=0}T_(Le.buffers,ui.segments,p,x,Le.program,Le.depthMode,A,M,Le.uniformValues,1)}}}function T_(x,u,p,b,A,M,P,O,B,G){const j=[x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer,x.iconTransitioningVertexBuffer,x.globeExtVertexBuffer,x.zOffsetVertexBuffer,x.orientationVertexBuffer];A.draw(b,b.context.gl.TRIANGLES,M,P,O,Ni.disabled,B,p.id,x.layoutVertexBuffer,x.indexBuffer,u,p.paint,b.transform.zoom,x.programConfigurations.get(p.id),j,G)}function IT(x,u){const p=1<<x.canonical.z,b=(u.x*p-x.canonical.x-x.wrap*p)*a.al,A=(u.y*p-x.canonical.y)*a.al,M=a.e7(u.z,u.y);return a.d4(b,A,M)}function Uh(x,u,p,b,A){if(!p.layout||p.layout.get("fill-elevation-reference")==="none"||p.paint.get("fill-opacity").constantOr(1)===0)return;const M=x.context.gl,P=new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D),O=new fi(x.context.gl.GREATER,fi.ReadWrite,x.depthRangeFor3D),B=function(K){let tt=.01;return K.isOrthographic&&(tt=a.ak(1e-4,tt,a.c$(K.pitch>=Oh?1:K.pitch/Oh))),2*tt}(x.transform),G=x.transform.getFreeCameraOptions().position,j="elevatedStructuresDepthReconstruct",X=x.getOrCreateProgram(j,{defines:["DEPTH_RECONSTRUCTION"]}),W=x.getOrCreateProgram(j);for(const K of b){const tt=u.getTile(K),rt=tt.getBucket(p);if(!rt)continue;const ht=rt.elevatedStructures;if(!ht)continue;const st=rt.elevationBufferData.heightRange,gt=IT(K.toUnwrapped(),G),xt=x.translatePosMatrix(K.projMatrix,tt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));let vt,Pt,wt,Rt;if(A==="initialize"){if(!st||st.min>=1||ht.depthSegments.segments[0].primitiveLength===0)continue;vt=f_(xt,gt,B,1,0),Pt=P,wt=ht.depthSegments,Rt=X}else if(A==="reset"){if(!st||st.min>=0||ht.maskSegments.segments[0].primitiveLength===0)continue;vt=f_(xt,gt,0,0,1),Pt=O,wt=ht.maskSegments,Rt=X}else if(A==="geometry"){if(ht.depthSegments.segments[0].primitiveLength===0)continue;vt=f_(xt,gt,B,1,0),Pt=P,wt=ht.depthSegments,Rt=W}Rt.draw(x,M.TRIANGLES,Pt,$i.disabled,lr.disabled,Ni.disabled,vt,p.id,ht.vertexBuffer,ht.indexBuffer,wt,p.paint,x.transform.zoom)}}function gf(x,u,p){const{painter:b,sourceCache:A,layer:M,coords:P,colorMode:O,elevationType:B,terrainEnabled:G,pass:j}=x,X=b.context.gl,W=M.paint.get("fill-pattern"),K=M.paint.get("fill-pattern-cross-fade"),tt=W.constantOr(null);let rt=B;B!=="road"||u&&!G||(rt="none");const ht=rt==="road",st=x.painter.shadowRenderer,gt=ht&&!!st&&st.enabled,xt=new fi(b.context.gl.LEQUAL,fi.ReadOnly,b.depthRangeFor3D);let vt=[0,0,0];if(gt){const Rt=b.style.directionalLight,Mt=b.style.ambientLight;Rt&&Mt&&(vt=bl(b.style,Rt,Mt))}const Pt=W&&W.constantOr(1),wt=(Rt,Mt)=>{let At,kt,qt,jt,oe;Mt?(At=Pt&&!M.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",qt=X.LINES):(At=Pt?"fillPattern":"fill",qt=X.TRIANGLES);for(const te of P){const fe=A.getTile(te);if(Pt&&!fe.patternsLoaded())continue;const ze=fe.getBucket(M);if(!ze)continue;const Qt=u?ze.elevationBufferData:ze.bufferData;if(Qt.isEmpty())continue;b.prepareDrawTile();const Gt=Qt.programConfigurations.get(M.id),pe=b.isTileAffectedByFog(te),ee=[],Ae=[];ht&&(ee.push("ELEVATED_ROADS"),Ae.push(Qt.elevatedLayoutVertexBuffer)),gt&&ee.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pt&&(b.context.activeTexture.set(X.TEXTURE0),fe.imageAtlasTexture&&fe.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Gt.updatePaintBuffers());let Ge=!1;if(tt&&fe.imageAtlas){const ai=fe.imageAtlas,ii=a.e2.from(tt),oi=ii.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),Di=ii.getSecondary(),mr=ai.patternPositions.get(oi),Ir=Di?ai.patternPositions.get(Di.scaleSelf(a.o.devicePixelRatio).toString()):null;Ge=!!mr&&!!Ir,mr&&Gt.setConstantPatternPositions(mr,Ir)}K>0&&(Ge||Gt.getPatternTransitionVertexBuffer("fill-pattern"))&&ee.push("FILL_PATTERN_TRANSITION");const ui=b.getOrCreateProgram(At,{config:Gt,overrideFog:pe,defines:ee}),Le=b.translatePosMatrix(te.projMatrix,fe,M.paint.get("fill-translate"),M.paint.get("fill-translate-anchor"));gt&&st.setupShadows(fe.tileID.toUnwrapped(),ui,"vector-tile");const Fe=M.paint.get("fill-emissive-strength");if(Mt){jt=Qt.lineIndexBuffer,oe=Qt.lineSegments;const ai=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[X.drawingBufferWidth,X.drawingBufferHeight];kt=At==="fillOutlinePattern"&&Pt?iD(Le,Fe,b,fe,ai,vt,K):eD(Le,Fe,ai,vt)}else jt=Qt.indexBuffer,oe=Qt.triangleSegments,kt=Pt?bT(Le,Fe,b,fe,vt,K):xT(Le,Fe,vt);b.uploadCommonUniforms(b.context,ui,te.toUnwrapped());let hi=Rt;(B==="road"&&!G||B==="offset")&&(hi=xt),ui.draw(b,qt,hi,p||b.stencilModeForClipping(te),O,Ni.disabled,kt,M.id,Qt.layoutVertexBuffer,jt,oe,M.paint,b.transform.zoom,Gt,Ae)}};b.renderPass===j&&wt(b.depthModeForSublayer(1,b.renderPass==="opaque"?fi.ReadWrite:fi.ReadOnly),!1),rt==="none"&&b.renderPass==="translucent"&&M.paint.get("fill-antialias")&&wt(b.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,fi.ReadOnly),!0)}function li(x,u,p,b,A,M,P,O){p.resetLayerRenderingStats(x);const B=x.context,G=B.gl,j=x.transform,X=p.paint.get("fill-extrusion-pattern"),W=p.paint.get("fill-extrusion-pattern-cross-fade"),K=X.constantOr(null),tt=X.constantOr(1),rt=p.paint.get("fill-extrusion-opacity"),ht=x.style.enable3dLights(),st=p.paint.get(ht&&!tt?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),gt=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),st],xt=p.layout.get("fill-extrusion-edge-radius"),vt=xt>0&&!p.paint.get("fill-extrusion-rounded-roof"),Pt=vt?0:xt,wt=j.projection.name==="globe"?a.ea():0,Rt=j.projection.name==="globe",Mt=Rt?a.aj(j.zoom):0,At=[a.aF(j.center.lng),a.aJ(j.center.lat)],kt=p.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",qt=p.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(kt?null:p.lut).toArray01().slice(0,3),jt=p.paint.get("fill-extrusion-flood-light-intensity"),oe=p.paint.get("fill-extrusion-vertical-scale"),te=p.paint.get("fill-extrusion-line-width").constantOr(1)!==0,fe=p.paint.get("fill-extrusion-height-alignment"),ze=p.paint.get("fill-extrusion-base-alignment"),Qt=ju(x,p.paint.get("fill-extrusion-cutoff-fade-range")),Gt=[];let pe;Rt&&Gt.push("PROJECTION_GLOBE_VIEW"),gt[0]>0&&Gt.push("FAUX_AO"),vt&&Gt.push("ZERO_ROOF_RADIUS"),O&&Gt.push("HAS_CENTROID"),jt>0&&Gt.push("FLOOD_LIGHT"),Qt.shouldRenderCutoff&&Gt.push("RENDER_CUTOFF"),te&&Gt.push("RENDER_WALL_MODE");const ee=x.renderPass==="shadow",Ae=x.shadowRenderer,Ge=ee&&!!Ae,ui=ee?Ni.disabled:Ni.backCCW;x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!0);let Le=[0,0,0];if(Ae){const ai=x.style.directionalLight,ii=x.style.ambientLight;ai&&ii&&(Le=bl(x.style,ai,ii)),ee||(Gt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ae.useNormalOffset&&Gt.push("NORMAL_OFFSET")),pe=Gt.concat(["SHADOWS_SINGLE_CASCADE"])}const Fe=Ge?"fillExtrusionDepth":tt?"fillExtrusionPattern":"fillExtrusion",hi=p.getLayerRenderingStats();for(const ai of b){const ii=u.getTile(ai),oi=ii.getBucket(p);if(!oi||oi.projection.name!==j.projection.name)continue;let Di=!1;Ae&&(Di=Ae.getMaxCascadeForTile(ai.toUnwrapped())===0);const mr=x.isTileAffectedByFog(ai),Ir=oi.programConfigurations.get(p.id);let an=!1;if(K&&ii.imageAtlas){const Or=ii.imageAtlas,ar=a.e2.from(K),Gr=ar.getPrimary().scaleSelf(a.o.devicePixelRatio).toString(),ur=ar.getSecondary(),wn=Or.patternPositions.get(Gr),Zr=ur?Or.patternPositions.get(ur.scaleSelf(a.o.devicePixelRatio).toString()):null;an=!!wn&&!!Zr,wn&&Ir.setConstantPatternPositions(wn,Zr)}W>0&&(an||Ir.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Gt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Vi=x.getOrCreateProgram(Fe,{config:Ir,defines:Di?pe:Gt,overrideFog:mr});if(x.terrain&&x.terrain.setupElevationDraw(ii,Vi,{useMeterToDem:!0}),!oi.centroidVertexBuffer){const Or=Vi.getAttributeLocation(G,"a_centroid_pos");Or!==-1&&G.vertexAttrib2f(Or,0,0)}!ee&&Ae&&Ae.setupShadows(ii.tileID.toUnwrapped(),Vi,"vector-tile"),tt&&(x.context.activeTexture.set(G.TEXTURE0),ii.imageAtlasTexture&&ii.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Ir.updatePaintBuffers());const Tr=p.paint.get("fill-extrusion-vertical-gradient"),ir=1/oi.tileToMeter;let Qr;if(ee&&Ae){if(CT(ii.tileID,oi.maxHeight,x))continue;const Or=Ae.calculateShadowPassMatrixFromTile(ii.tileID.toUnwrapped());Qr=_T(Or,Pt,ir,oe,fe,ze)}else{const Or=x.translatePosMatrix(ai.expandedProjMatrix,ii,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),ar=j.projection.createInversionMatrix(j,ai.canonical);Qr=tt?yT(Or,x,Tr,rt,gt,Pt,ir,ai,ii,wt,fe,ze,Mt,At,ar,qt,oe,W):d_(Or,x,Tr,rt,gt,Pt,ir,ai,wt,fe,ze,Mt,At,ar,qt,oe,jt,Le)}x.uploadCommonUniforms(B,Vi,ai.toUnwrapped(),null,Qt);let Cr=oi.segments;if(j.projection.name==="mercator"&&!ee&&(Cr=oi.getVisibleSegments(ii.tileID,x.terrain,x.transform.getFrustum(0)),!Cr.get().length))continue;if(hi)if(ee)for(const Or of Cr.get())hi.numRenderedVerticesInShadowPass+=Or.primitiveLength;else for(const Or of Cr.get())hi.numRenderedVerticesInTransparentPass+=Or.primitiveLength;const pn=[];(x.terrain||O)&&pn.push(oi.centroidVertexBuffer),Rt&&pn.push(oi.layoutVertexExtBuffer),te&&pn.push(oi.wallVertexBuffer),Vi.draw(x,B.gl.TRIANGLES,A,M,P,ui,Qr,p.id,oi.layoutVertexBuffer,oi.indexBuffer,Cr,p.paint,x.transform.zoom,Ir,pn)}x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!1)}class Vx{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function $u(x,u,p,b,A,M,P,O,B,G,j,X,W,K,tt,rt,ht,st,gt,xt){const vt=u.context,Pt=vt.gl,wt=u.transform,Rt=u.transform.zoom,Mt=[],At=x.translate,kt=x.translateAnchor,qt=x.edgeRadius,jt=ju(u,x.cutoffFadeRange);j==="clear"?(Mt.push("CLEAR_SUBPASS"),xt&&(Mt.push("CLEAR_FROM_TEXTURE"),vt.activeTexture.set(Pt.TEXTURE0),xt.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE))):j==="sdf"&&Mt.push("SDF_SUBPASS"),st&&Mt.push("HAS_CENTROID"),jt.shouldRenderCutoff&&Mt.push("RENDER_CUTOFF");const oe=(te,fe,ze,Qt,Gt)=>{let pe=Mt;fe.groundRadiusBuffer!=null&&(pe=Mt.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ee=fe.programConfigurations.get(b.id),Ae=u.isTileAffectedByFog(te),Ge=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:ee,defines:pe,overrideFog:Ae}),ui=df(u,Qt,X,G,Gt,[W,K*Gt],tt,rt,ht,Rt>=17?0:qt*Gt,xt?xt.size[0]:0),Le=[];st&&Le.push(fe.hiddenByLandmarkVertexBuffer),fe.groundRadiusBuffer!=null&&Le.push(fe.groundRadiusBuffer),u.uploadCommonUniforms(vt,Ge,te.toUnwrapped(),null,jt),Ge.draw(u,vt.gl.TRIANGLES,M,P,O,B,ui,b.id,fe.vertexBuffer,fe.indexBuffer,ze,b.paint,Rt,ee,Le)};for(const te of A){const fe=p.getTile(te),ze=fe.getBucket(b);if(!ze||ze.projection.name!==wt.projection.name||!ze.groundEffect||ze.groundEffect&&!ze.groundEffect.hasData())continue;const Qt=ze.groundEffect,Gt=1/ze.tileToMeter;{const pe=u.translatePosMatrix(te.projMatrix,fe,At,kt),ee=Qt.getDefaultSegment();oe(te,Qt,ee,pe,Gt)}if(gt)for(let pe=0;pe<4;pe++){const ee=a.e8[pe](te),Ae=p.getTile(ee);if(!Ae)continue;const Ge=Ae.getBucket(b);if(!Ge||Ge.projection.name!==wt.projection.name||!Ge.groundEffect||Ge.groundEffect&&!Ge.groundEffect.hasData())continue;const ui=Ge.groundEffect;let Le,Fe;pe===0?(Le=[-a.al,0,0],Fe=1):pe===1?(Le=[a.al,0,0],Fe=0):pe===2?(Le=[0,-a.al,0],Fe=3):(Le=[0,a.al,0],Fe=2);const hi=ui.regionSegments[Fe];if(!hi)continue;const ai=new Float32Array(16);a.bq(ai,te.projMatrix,Le),oe(te,ui,hi,u.translatePosMatrix(ai,fe,At,kt),Gt)}}}function Lc(x,u,p,b,A,M,P){b.centroidVertexArray.length===0&&b.createCentroidsBuffer();const O=M?M.findDEMTileFor(p):null;if(!(O&&O.dem||P))return;M&&O&&O.dem&&b.selfDEMTileTimestamp!==O.dem._timestamp&&(b.borderDoneWithNeighborZ=[-1,-1,-1,-1],b.selfDEMTileTimestamp=O.dem._timestamp);const B=st=>new a.P(Math.ceil((st+a.ec)*a.ed),0),G=st=>{const gt=u.getSource().minzoom,xt=Pt=>{const wt=u.getTileByID(Pt);if(wt&&wt.hasData())return wt.getBucket(A)},vt=[0,-1,1];for(const Pt of vt){if(st.overscaledZ+Pt<gt)continue;const wt=xt(st.calculateScaledKey(st.overscaledZ+Pt));if(wt)return wt}},j=[0,0,0],X=(st,gt)=>(j[0]=Math.min(st.min.y,gt.min.y),j[1]=Math.max(st.max.y,gt.max.y),j[2]=a.al-gt.min.x>st.max.x?gt.min.x-a.al:st.max.x,j),W=(st,gt)=>(j[0]=Math.min(st.min.x,gt.min.x),j[1]=Math.max(st.max.x,gt.max.x),j[2]=a.al-gt.min.y>st.max.y?gt.min.y-a.al:st.max.y,j),K=[(st,gt)=>X(st,gt),(st,gt)=>X(gt,st),(st,gt)=>W(st,gt),(st,gt)=>W(gt,st)],tt=(st,gt,xt,vt,Pt,wt,Rt)=>{if(!M)return 0;const Mt=[[wt?xt:st,wt?st:xt,0],[wt?xt:gt,wt?gt:xt,0]],At=Rt<0?a.al+Rt:Rt,kt=[wt?At:(st+gt)/2,wt?(st+gt)/2:At,0];return xt===0&&Rt<0||xt!==0&&Rt>0?M.getForTilePoints(Pt,[kt],!0,vt):Mt.push(kt),M.getForTilePoints(p,Mt,!0,O),Math.max(Mt[0][2],Mt[1][2],kt[2])/M.exaggeration()};for(let st=0;st<4;st++){const gt=b.borderFeatureIndices[st];if(gt.length===0)continue;const xt=a.e8[st](p),vt=G(xt);if(!(vt&&vt instanceof a.e9))continue;const Pt=M?M.findDEMTileFor(xt):null;if(!(Pt&&Pt.dem||P)||(M&&Pt&&Pt.dem&&b.borderDEMTileTimestamp[st]!==Pt.dem._timestamp&&(b.borderDoneWithNeighborZ[st]=-1,b.borderDEMTileTimestamp[st]=Pt.dem._timestamp),b.borderDoneWithNeighborZ[st]===vt.canonical.z))continue;vt.centroidVertexArray.length===0&&vt.createCentroidsBuffer();const wt=(st<2?1:5)-st,Rt=vt.borderDoneWithNeighborZ[wt]!==b.canonical.z,Mt=vt.borderFeatureIndices[wt];let At=0;if(b.canonical.z!==vt.canonical.z){for(const kt of gt)b.showCentroid(b.featuresOnBorder[kt]);if(Rt)for(const kt of Mt)vt.showCentroid(vt.featuresOnBorder[kt]);b.borderDoneWithNeighborZ[st]=vt.canonical.z,vt.borderDoneWithNeighborZ[wt]=b.canonical.z}for(const kt of gt){const qt=b.featuresOnBorder[kt],jt=b.centroidData[qt.centroidDataIndex],oe=qt.borders[st];let te;for(;At<Mt.length;){te=vt.featuresOnBorder[Mt[At]];const fe=te.borders[wt];if(fe[1]>oe[0]+3||fe[0]>oe[0]-3)break;vt.showCentroid(te),At++}if(te&&At<Mt.length){const fe=At;let ze=0;for(;!(te.borders[wt][0]>oe[1]-3)&&(ze++,++At!==Mt.length);)te=vt.featuresOnBorder[Mt[At]];te=vt.featuresOnBorder[Mt[fe]];let Qt=!1;if(ze>=1){const ee=te.borders[wt];Math.abs(oe[0]-ee[0])<3&&Math.abs(oe[1]-ee[1])<3&&(ze=1,Qt=!0,At=fe+1)}else if(ze===0){b.showCentroid(qt);continue}const Gt=vt.centroidData[te.centroidDataIndex];P&&Qt&&(((rt=jt).flags|(ht=Gt).flags)&a.eb?(rt.flags|=a.eb,ht.flags|=a.eb):(rt.flags&=~a.eb,ht.flags&=~a.eb));const pe=qt.intersectsCount()>1||te.intersectsCount()>1;if(ze>1)At=fe,jt.centroidXY=Gt.centroidXY=new a.P(0,0);else if(Pt&&Pt.dem&&!pe){const ee=K[st](jt,Gt),Ae=st%2?a.al-1:0,Ge=tt(ee[0],Math.min(a.al-1,ee[1]),Ae,Pt,xt,st<2,ee[2]);jt.centroidXY=Gt.centroidXY=B(Ge)}else pe?jt.centroidXY=Gt.centroidXY=new a.P(0,0):(jt.centroidXY=b.encodeBorderCentroid(qt),Gt.centroidXY=vt.encodeBorderCentroid(te));b.writeCentroidToBuffer(jt),vt.writeCentroidToBuffer(Gt)}else b.showCentroid(qt)}b.borderDoneWithNeighborZ[st]=vt.canonical.z,vt.borderDoneWithNeighborZ[wt]=b.canonical.z}var rt,ht;(b.needsCentroidUpdate||!b.centroidVertexBuffer&&b.centroidVertexArray.length!==0)&&b.uploadCentroid(x)}const Rc=[1,0,0],Ei=[0,1,0],Ux=[0,0,1];function CT(x,u,p){const b=p.transform,A=p.shadowRenderer;if(!A)return!0;const M=x.toUnwrapped(),P=b.tileSize*A._cascades[p.currentShadowCascade].scale;let O=u;if(b.elevation){const rt=b.elevation.getMinMaxForTile(x);rt&&(O+=rt.max)}const B=[...A.shadowDirection];B[2]=-B[2];const G=A.computeSimplifiedTileShadowVolume(M,O,P,B);if(!G)return!1;const j=[Rc,Ei,Ux,B,[B[0],0,B[2]],[0,B[1],B[2]]],X=b.projection.name==="globe",W=b.scaleZoom(P),K=a.cA.fromInvProjectionMatrix(b.invProjMatrix,b.worldSize,W,!X),tt=A.getCurrentCascadeFrustum();return K.intersectsPrecise(G.vertices,G.planes,j)===0||tt.intersectsPrecise(G.vertices,G.planes,j)===0}function A_(x){const{painter:u,source:p,layer:b,coords:A}=x;let M=x.defines;const P=u.context,O=u.renderPass==="shadow",B=u.renderPass==="light-beam",G=u.shadowRenderer,j=a.ee(u.transform.center.lat,u.transform.zoom),X=ju(u,b.paint.get("building-cutoff-fade-range"));X.shouldRenderCutoff&&(M=M.concat("RENDER_CUTOFF")),x.floodLightIntensity>0&&(M=M.concat("FLOOD_LIGHT"));for(const W of A){const K=p.getTile(W),tt=K.getBucket(b);if(!tt)continue;G&&G.getMaxCascadeForTile(W.toUnwrapped())===0&&(M=M.concat("SHADOWS_SINGLE_CASCADE"));const rt=tt.programConfigurations.get(b.id);let ht,st,gt,xt=u.translatePosMatrix(W.expandedProjMatrix,K,[0,0],"map");if(xt=a.cR(a.bB(),xt,[1,1,x.verticalScale]),O&&G){if(CT(K.tileID,tt.maxHeight*j,u))continue;let Pt=G.calculateShadowPassMatrixFromTile(K.tileID.toUnwrapped());Pt=a.cR(a.bB(),Pt,[1,1,x.verticalScale]),gt=wT(Pt),ht=st=u.getOrCreateProgram("buildingDepth",{config:rt,defines:M,overrideFog:!1})}else if(B)ht=st=u.getOrCreateProgram("buildingBloom",{config:rt,defines:M,overrideFog:!1}),gt=Rx(xt);else{const Pt=u.transform.calculatePosMatrix(W.toUnwrapped(),u.transform.worldSize);a.cR(Pt,Pt,[1,1,x.verticalScale]);const wt=a.bB();a.cR(wt,Pt,[1,-1,1/j]),a.bk(wt,wt),a.ef(wt,wt);const Rt=u.transform.getFreeCameraOptions().position,Mt=1<<W.canonical.z;if(gt=Lx(xt,wt,x.opacity,x.facadeAOIntensity,[((Rt.x-W.wrap)*Mt-W.canonical.x)*a.al,(Rt.y*Mt-W.canonical.y)*a.al,Rt.z*Mt*a.al],tt.tileToMeter,x.facadeEmissiveChance,x.floodLightColor,x.floodLightIntensity),st=u.getOrCreateProgram("building",{config:rt,defines:M,overrideFog:!1}),x.depthOnly===!0)ht=st;else{const At=M.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ht=u.getOrCreateProgram("building",{config:rt,defines:At,overrideFog:!1})}G&&(G.setupShadowsFromMatrix(Pt,st,!0),ht!==st&&G.setupShadowsFromMatrix(Pt,ht,!0))}const vt=(Pt,wt)=>{if(B){const Rt=Pt.entranceBloom;wt.draw(u,P.gl.TRIANGLES,x.depthMode,$i.disabled,x.blendMode,Ni.disabled,gt,b.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segmentsBucket,b.paint,u.transform.zoom,rt,[Rt.layoutAttenuationBuffer,Rt.layoutColorBuffer])}else{const Rt=Pt.segmentsBucket;let Mt=[Pt.layoutNormalBuffer,Pt.layoutCentroidBuffer,Pt.layoutColorBuffer,Pt.layoutFloodLightDataBuffer];Pt.layoutFacadePaintBuffer&&(Mt=Mt.concat([Pt.layoutFacadeDataBuffer,Pt.layoutFacadeVerticalRangeBuffer,Pt.layoutFacadePaintBuffer])),wt.draw(u,P.gl.TRIANGLES,x.depthMode,$i.disabled,x.blendMode,O?Ni.disabled:Ni.backCW,gt,b.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Rt,b.paint,u.transform.zoom,rt,Mt)}};u.uploadCommonUniforms(P,st,W.toUnwrapped(),null,X),tt.buildingWithoutFacade&&vt(tt.buildingWithoutFacade,st),tt.buildingWithFacade&&(ht!==st&&u.uploadCommonUniforms(P,ht,W.toUnwrapped(),null,X),vt(tt.buildingWithFacade,ht))}}function I_(x,u,p,b,A,M,P,O,B,G,j,X,W){const K=x.context.gl,tt=x.depthModeForSublayer(1,fi.ReadOnly,K.LEQUAL,!0),rt=.1*(1-(ht=j))+3*ht;var ht;const st=x._showOverdrawInspector,gt=X,xt=new Vx;st||$u(xt,x,u,p,b,tt,new $i({func:K.ALWAYS,mask:255},255,255,K.KEEP,K.KEEP,K.REPLACE),new lr([K.ONE,K.ONE,K.ONE,K.ONE],a.ao.transparent,[!1,!1,!1,!0],K.MIN),Ni.disabled,A,"sdf",M,P,O,B,G,rt,gt,!1);{const vt=st?$i.disabled:new $i({func:K.EQUAL,mask:255},255,255,K.KEEP,K.DECR,K.DECR),Pt=st?x.colorModeForRenderPass():new lr([K.ONE_MINUS_DST_ALPHA,K.DST_ALPHA,K.ONE,K.ONE],a.ao.transparent,[!0,!0,!0,!0]);$u(xt,x,u,p,b,tt,vt,Pt,Ni.disabled,A,"color",M,P,O,B,G,rt,gt,!1)}}function Gx(x){return[x[0]*a.eg,x[1]*a.eg,x[2]*a.eg,0]}function Hx(x,u,p,b,A,M,P,O,B){const G=b.getSource(),j=p.globeSharedBuffers;if(!j)return;let X,W,K;if(u&&(X=b.getTile(u)),G instanceof a.aT?(W=G.texture,K=a.dJ(0,0,p.transform)):X&&u&&(W=X.texture,K=a.dJ(u.canonical.z,u.canonical.x,p.transform)),!W||!K)return;x||(K=a.cR(a.bB(),K,[1,-1,1]));const tt=p.context,rt=tt.gl,ht=A.paint.get("raster-resampling")==="nearest"?rt.NEAREST:rt.LINEAR,st=p.colorModeForDrapableLayerRenderPass(M),gt=P.defines;gt.push("GLOBE_POLES");const xt=new fi(rt.LEQUAL,fi.ReadWrite,p.depthRangeFor3D),vt=Float32Array.from(p.transform.expandedFarZProjMatrix),Pt=Float32Array.from(a.bj(a.dI(new a.cC(0,0,0))));p.terrain&&p.terrain.prepareDrawTile(),tt.activeTexture.set(rt.TEXTURE0),W.bind(ht,rt.CLAMP_TO_EDGE),tt.activeTexture.set(rt.TEXTURE1),W.bind(ht,rt.CLAMP_TO_EDGE),"useMipmap"in W&&tt.extTextureFilterAnisotropic&&p.transform.pitch>20&&rt.texParameterf(rt.TEXTURE_2D,tt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,tt.extTextureFilterAnisotropicMax);const[wt,Rt,Mt,At]=u?j.getPoleBuffers(u.canonical.z,!1):j.getPoleBuffers(0,!0),kt=A.paint.get("raster-elevation");let qt;x?(qt=wt,p.renderDefaultNorthPole=kt!==0):(qt=Rt,p.renderDefaultSouthPole=kt!==0);const jt=Gx(P.mix),oe=((fe,ze,Qt,Gt,pe,ee,Ae,Ge,ui,Le,Fe,hi,ai)=>Mg(fe,ze,Qt,new Float32Array(16),new Float32Array(9),[0,0],Gt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ee,[0,0],Ge,2,Le,Fe,hi,1,0,ai))(vt,Pt,K,a.aj(p.transform.zoom),0,A,0,kt,0,jt,P.offset,P.range,M),te=p.getOrCreateProgram("raster",{defines:gt});p.uploadCommonUniforms(tt,te,null),te.draw(p,rt.TRIANGLES,xt,B,st,O,oe,A.id,qt,Mt,At)}function MT(x){const u=x._nearZ,p=x.projection.farthestPixelDistance(x),b=p-u,A=.2*x.height,M=u+A;return[u,p,(M-A-u)/b,(M-u)/b]}function oD(x,u,p,b){if(x)return u instanceof Ga&&x instanceof Ac?u.getTextureDescriptor(x,p,!0):{texture:x.texture,mix:Gx(b.mix),offset:b.offset,buffer:0,tileSize:1}}var sD=a.eh([{name:"a_index",type:"Int16",components:1}]);class Ts{constructor(u,p,b,A){const M={width:b[0],height:b[1],data:null},P=u.gl;this.targetColorTexture=new a.T(u,M,P.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(u,M,P.RGBA8,{useMipmap:!1}),this.context=u,this.updateParticleTexture(p,A),this.lastInvalidatedAt=0}updateParticleTexture(u,p){if(this.particleTextureDimension===p.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const b=this.context.gl,A=p.width*p.height;this.particleTexture0=new a.T(this.context,p,b.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,p,b.RGBA8,{premultiply:!1,useMipmap:!1});const M=new a.ei;M.reserve(A);for(let P=0;P<A;P++)M.emplaceBack(P);this.particleIndexBuffer=this.context.createVertexBuffer(M,sD.members,!0),this.particleSegment=a.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=p.width}update(u){return!(this.lastInvalidatedAt<u&&(this.lastInvalidatedAt=a.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function jx(x,u,p){if(!x)return null;const b=u.getTextureDescriptor(x,p,!0);if(!b)return null;let{texture:A,mix:M,offset:P,tileSize:O,buffer:B,format:G}=b;if(!A||!G)return null;let j=!1;return G==="uint32"&&(j=!0,M[3]=0,M=p_(a.ej,M,[0,p.paint.get("raster-particle-max-speed")]),P=Wu(a.ej,P,[0,p.paint.get("raster-particle-max-speed")])),{texture:A,textureOffset:[B/(O+2*B),O/(O+2*B)],tileSize:O,scalarData:j,scale:M,offset:P,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function Jo(x){const u=x._nearZ,p=x.projection.farthestPixelDistance(x),b=p-u,A=.2*x.height,M=u+A;return[u,p,(M-A-u)/b,(M-u)/b]}const kc=new a.ao(1,0,0,1),ET=new a.ao(0,1,0,1),Wx=new a.ao(0,0,1,1),$x=new a.ao(1,0,1,1),Zx=new a.ao(0,1,1,1);function qx(x,u,p,b,A,M){for(let P=0;P<p.length;P++)if(A){const G=new a.ao(b.r*.8,b.g*.8,b.b*.8,1);As(x,u,p[P],b,-1,-1,M),As(x,u,p[P],b,-1,1,M),As(x,u,p[P],b,1,1,M),As(x,u,p[P],b,1,-1,M),As(x,u,p[P],G,0,0,M)}else As(x,u,p[P],b,0,0,M)}function As(x,u,p,b,A,M,P){const O=x.context,B=x.transform,G=O.gl,j=B.projection.name==="globe",X=j?["PROJECTION_GLOBE_VIEW"]:[];let W=a.by(p.projMatrix);if(j&&a.aj(B.zoom)>0){const jt=a.bi(p.canonical,B),oe=a.ek(jt);W=a.aB(new Float32Array(16),B.globeMatrix,oe),a.aB(W,B.projMatrix,W)}const K=a.bB();K[12]+=2*A/(a.o.devicePixelRatio*B.width),K[13]+=2*M/(a.o.devicePixelRatio*B.height),a.aB(W,K,W);const tt=x.getOrCreateProgram("debug",{defines:X}),rt=u.getTileByID(p.key);x.terrain&&x.terrain.setupElevationDraw(rt,tt);const ht=fi.disabled,st=$i.disabled,gt=x.colorModeForRenderPass(),xt="$debug";O.activeTexture.set(G.TEXTURE0),x.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),j?rt._makeGlobeTileDebugBuffers(x.context,B):rt._makeDebugTileBoundsBuffers(x.context,B.projection);const vt=rt._tileDebugBuffer||x.debugBuffer,Pt=rt._tileDebugIndexBuffer||x.debugIndexBuffer,wt=rt._tileDebugSegments||x.debugSegments;if(tt.draw(x,G.LINE_STRIP,ht,st,gt,Ni.disabled,kx(W,b.toPremultipliedRenderColor(null)),xt,vt,Pt,wt,null,null,null,[rt._globeTileDebugBorderBuffer]),P){const jt=rt.latestRawTileData,oe=Math.floor((jt&&jt.byteLength||0)/1024);let te=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(te+=` => ${p.overscaledZ}`),te+=` ${rt.state}`,te+=` ${oe}kb`,function(fe,ze){fe.initDebugOverlayCanvas();const Qt=fe.debugOverlayCanvas,Gt=fe.context.gl,pe=fe.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,Qt.width,Qt.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(ze,5,5),pe.strokeText(ze,5,5),fe.debugOverlayTexture.update(Qt),fe.debugOverlayTexture.bind(Gt.LINEAR,Gt.CLAMP_TO_EDGE)}(x,te)}const Rt=u.getTile(p).tileSize,Mt=512/Math.min(Rt,512)*(p.overscaledZ/B.zoom)*.5,At=rt._tileDebugTextBuffer||x.debugBuffer,kt=rt._tileDebugTextIndexBuffer||x.quadTriangleIndexBuffer,qt=rt._tileDebugTextSegments||x.debugSegments;tt.draw(x,G.TRIANGLES,ht,st,lr.alphaBlended,Ni.disabled,kx(W,a.ao.transparent.toPremultipliedRenderColor(null),Mt),xt,At,kt,qt,null,null,null,[rt._globeTileDebugTextBuffer])}function xn(x,u,p,b){mf(x,0,u+p/2,x.transform.width,p,b)}function Pg(x,u,p,b){mf(x,u-p/2,0,p,x.transform.height,b)}function mf(x,u,p,b,A,M){const P=x.context,O=P.gl;O.enable(O.SCISSOR_TEST),O.scissor(u*a.o.devicePixelRatio,p*a.o.devicePixelRatio,b*a.o.devicePixelRatio,A*a.o.devicePixelRatio),P.clear({color:M}),O.disable(O.SCISSOR_TEST)}const DT=a.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:PT}=DT;function Zu(x,u,p,b){x.emplaceBack(u,p,b)}class Xx{constructor(u){this.vertexArray=new a.el,this.indices=new a.b0,Zu(this.vertexArray,-1,-1,1),Zu(this.vertexArray,1,-1,1),Zu(this.vertexArray,-1,1,1),Zu(this.vertexArray,1,1,1),Zu(this.vertexArray,-1,-1,-1),Zu(this.vertexArray,1,-1,-1),Zu(this.vertexArray,-1,1,-1),Zu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=u.createVertexBuffer(this.vertexArray,PT),this.indexBuffer=u.createIndexBuffer(this.indices),this.segment=a.bf.simpleSegment(0,0,36,12)}}function Tl(x,u,p,b,A,M){const P=x.context.gl,O=u.paint.get("sky-atmosphere-color"),B=u.paint.get("sky-atmosphere-halo-color"),G=u.paint.get("sky-atmosphere-sun-intensity"),j=((X,W,K,tt,rt)=>({u_matrix_3f:X,u_sun_direction:W,u_sun_intensity:K,u_color_tint_r:[tt.r,tt.g,tt.b,tt.a],u_color_tint_m:[rt.r,rt.g,rt.b,rt.a],u_luminance:5e-5}))(a.en(a.dN(),b),A,G,O.toPremultipliedRenderColor(null),B.toPremultipliedRenderColor(null));P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+M,u.skyboxTexture,0),p.draw(x,P.TRIANGLES,fi.disabled,$i.disabled,lr.unblended,Ni.frontCW,j,"skyboxCapture",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}const Gh=a.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Pe{constructor(u){const p=new a.eo;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const b=new a.b0;b.emplaceBack(0,1,2),b.emplaceBack(2,3,0),this.vertexBuffer=u.createVertexBuffer(p,Gh.members),this.indexBuffer=u.createIndexBuffer(b),this.segments=a.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ei=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class vf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Kn{constructor(u){this.colorModeAlphaBlendedWriteRGB=new lr([1,sa,1,sa],a.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new lr([1,0,1,0],a.ao.transparent,[!1,!1,!1,!0]),this.params=new vf,this.updateNeeded=!0,u.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),u.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),u.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),u.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(u){const p=u.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Pe(p);const b=this.params.sizeRange,A=this.params.intensityRange,M=function(j){const X=a.eq(30),W=[];for(let K=0;K<j;++K){const tt=2*Math.PI*X(),rt=Math.acos(1-2*X())-.5*Math.PI;W.push(a.d4(Math.cos(rt)*Math.cos(tt),Math.cos(rt)*Math.sin(tt),Math.sin(rt)))}return W}(this.params.starsCount),P=a.eq(300),O=new a.ep,B=new a.b0;let G=0;for(let j=0;j<M.length;++j){const X=a.c4([],M[j],200),W=Math.max(0,1+.01*b*(1*P()-.5)),K=Math.max(0,1+.01*A*(1*P()-.5));O.emplaceBack(X[0],X[1],X[2],-1,-1,W,K),O.emplaceBack(X[0],X[1],X[2],1,-1,W,K),O.emplaceBack(X[0],X[1],X[2],1,1,W,K),O.emplaceBack(X[0],X[1],X[2],-1,1,W,K),B.emplaceBack(G+0,G+1,G+2),B.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=p.createVertexBuffer(O,ei.members),this.starsIdx=p.createIndexBuffer(B),this.starsSegments=a.bf.simpleSegment(0,0,O.length,B.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(u,p){const b=u.context,A=b.gl,M=u.transform,P=new fi(A.LEQUAL,fi.ReadOnly,[0,1]),O=a.aj(M.zoom),B=u.style.getLut(p.scope),G=p.properties.get("color-use-theme")==="none",j=p.properties.get("color").toNonPremultipliedRenderColor(G?null:B),X=p.properties.get("high-color-use-theme")==="none",W=p.properties.get("high-color").toNonPremultipliedRenderColor(X?null:B),K=p.properties.get("space-color-use-theme")==="none",tt=p.properties.get("space-color").toNonPremultipliedRenderColor(K?null:B),rt=5e-4,ht=a.er(p.properties.get("horizon-blend"),0,1,rt,.25),st=a.dD(u,b,M)&&ht===rt?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,gt=u.frameCounter/1e3%1,xt=a.ag(M.globeCenterInViewSpace),vt=Math.sqrt(Math.pow(xt,2)-Math.pow(st,2)),Pt=Math.acos(vt/xt),wt=Rt=>{const Mt=M.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Rt&&Mt.push("ALPHA_PASS");const At=u.getOrCreateProgram("globeAtmosphere",{defines:Mt}),kt=((jt,oe,te,fe,ze,Qt,Gt,pe,ee,Ae,Ge,ui)=>({u_frustum_tl:jt,u_frustum_tr:oe,u_frustum_br:te,u_frustum_bl:fe,u_horizon:ze,u_transition:Qt,u_fadeout_range:Gt,u_atmosphere_fog_color:pe.toArray01(),u_high_color:ee.toArray01(),u_space_color:Ae.toArray01(),u_temporal_offset:Ge,u_horizon_angle:ui}))(M.frustumCorners.TL,M.frustumCorners.TR,M.frustumCorners.BR,M.frustumCorners.BL,M.frustumCorners.horizon,O,ht,j,W,tt,gt,Pt);u.uploadCommonUniforms(b,At);const qt=this.atmosphereBuffer;qt&&At.draw(u,A.TRIANGLES,P,$i.disabled,Rt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ni.backCW,kt,Rt?"atmosphere_glow_alpha":"atmosphere_glow",qt.vertexBuffer,qt.indexBuffer,qt.segments)};wt(!1),wt(!0)}drawStars(u,p){const b=a.aA(p.properties.get("star-intensity"),0,1);if(b===0)return;const A=u.context,M=A.gl,P=u.transform,O=u.getOrCreateProgram("stars"),B=a.c6([]);a.c8(B,B,-P._pitch),a.c7(B,B,-P.angle),a.c8(B,B,a.an(P._center.lat)),a.es(B,B,-a.an(P._center.lng));const G=a.cb(new Float32Array(16),B),j=a.aB([],P.starsProjMatrix,G),X=a.en([],G),W=a.et([],X),K=[0,1,0];a.dP(K,K,W),a.c4(K,K,this.params.sizeMultiplier);const tt=[1,0,0];a.dP(tt,tt,W),a.c4(tt,tt,this.params.sizeMultiplier);const rt=(ht=K,st=tt,gt=b,{u_matrix:Float32Array.from(j),u_up:ht,u_right:st,u_intensity_multiplier:gt});var ht,st,gt;u.uploadCommonUniforms(A,O),this.starsVx&&this.starsIdx&&O.draw(u,M.TRIANGLES,fi.disabled,$i.disabled,this.colorModeAlphaBlendedWriteRGB,Ni.disabled,rt,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Yt{constructor(){this.visibleTiles=[]}updateBorders(u,p){const b=[],A=[],M=u._getRenderableCoordinates(!1,!0);for(const B of M){const G=u.getTile(B);if(!G.hasData())continue;const j=G.getBucket(p);j&&(j.isEmpty()||(b.push(B.key),A.push({bucket:j,tileID:B.canonical})))}let P=b.length!==this.visibleTiles.length;if(!P){b.sort();for(let B=0;B<b.length;B++)if(b[B]!==this.visibleTiles[B]){P=!0;break}}if(!P)return;const O=new Set;this.visibleTiles=b,A.sort((B,G)=>B.tileID.z-G.tileID.z||B.tileID.x-G.tileID.x||B.tileID.y-G.tileID.y);for(const B of A){const G=new Array,j=new Array,X=B.bucket;for(const W of X.featuresOnBorder)O.has(W.featureId)?j.push(W.footprintIndex):(O.add(W.featureId),G.push(W.footprintIndex));X.updateFootprintHiddenFlags(G,a.eu,!1),X.updateFootprintHiddenFlags(j,a.eu,!0)}}}function Yx(x,u){const p=[...x],b=u.cameraWorldSizeForFog/u.worldSize,A=a.bz([]);return a.cR(A,A,[b,b,1]),a.aB(p,A,p),a.aB(p,u.worldToFogMatrix,p),p}function _f(x,u,p,b,A){const M=p.material,P=b.context,{baseColorTexture:O,metallicRoughnessTexture:B}=M.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:j,emissionTexture:X}=M;function W(tt,rt,ht){if(tt&&(x.push(rt),P.activeTexture.set(P.gl.TEXTURE0+ht),tt.gfxTexture)){const{minFilter:st,magFilter:gt,wrapS:xt,wrapT:vt}=tt.sampler;tt.gfxTexture.bindExtraParam(st,gt,xt,vt)}}W(O,"HAS_TEXTURE_u_baseColorTexture",io.BaseColor),W(B,"HAS_TEXTURE_u_metallicRoughnessTexture",io.MetallicRoughness),W(G,"HAS_TEXTURE_u_normalTexture",io.Normal),W(j,"HAS_TEXTURE_u_occlusionTexture",io.Occlusion),W(X,"HAS_TEXTURE_u_emissionTexture",io.Emission),A&&(A.texture||(A.texture=new a.d_(b.context,A.image,[A.image.height,A.image.height,A.image.height],P.gl.RGBA8)),P.activeTexture.set(P.gl.TEXTURE0+io.LUT),A.texture&&A.texture.bind(P.gl.LINEAR,P.gl.CLAMP_TO_EDGE),x.push("APPLY_LUT_ON_GPU")),p.texcoordBuffer&&(x.push("HAS_ATTRIBUTE_a_uv_2f"),u.push(p.texcoordBuffer)),p.colorBuffer&&(x.push(p.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),u.push(p.colorBuffer)),p.normalBuffer&&(x.push("HAS_ATTRIBUTE_a_normal_3f"),u.push(p.normalBuffer)),p.pbrBuffer&&(x.push("HAS_ATTRIBUTE_a_pbr"),x.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),u.push(p.pbrBuffer)),M.alphaMode!=="OPAQUE"&&M.alphaMode!=="MASK"||x.push("UNPREMULT_TEXTURE_IN_SHADER"),M.defined||x.push("DIFFUSE_SHADED");const K=b.shadowRenderer;K&&(x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&x.push("NORMAL_OFFSET"))}function yf(x,u,p,b,A,M){const P=p.paint.get("model-opacity").constantOr(1),O=u.context,B=new fi(u.context.gl.LEQUAL,x.isLightMesh?fi.ReadOnly:fi.ReadWrite,u.depthRangeFor3D),G=u.transform,j=x.mesh,X=j.material,W=X.pbrMetallicRoughness,K=u.style.fog;let tt;tt=u.transform.projection.zAxisUnit==="pixels"?[...x.nodeModelMatrix]:a.aB([],b.zScaleMatrix,x.nodeModelMatrix),a.aB(tt,b.negCameraPosMatrix,tt);const rt=a.bk([],tt);a.ef(rt,rt);const ht=p.paint.get("model-color-use-theme").constantOr("default")==="none",st=p.paint.get("model-emissive-strength").constantOr(0),gt=y_(new Float32Array(x.worldViewProjection),new Float32Array(tt),new Float32Array(rt),null,u,P,W.baseColorFactor,X.emissiveFactor,W.metallicFactor,W.roughnessFactor,X,st,p,void 0,void 0,x.materialOverride,x.modelColor),xt={defines:[]},vt=[],Pt=u.shadowRenderer;Pt&&(Pt.useNormalOffset=!1),_f(xt.defines,vt,j,u,ht?null:p.lut);let wt=null;if(K){const At=Yx(x.nodeModelMatrix,u.transform);if(wt=new Float32Array(At),G.projection.name!=="globe"){const kt=j.aabb.min,qt=j.aabb.max,[jt,oe]=K.getOpacityForBounds(At,kt[0],kt[1],qt[0],qt[1]);xt.overrideFog=jt>=ie||oe>=ie}}const Rt=ju(u,p.paint.get("model-cutoff-fade-range"));Rt.shouldRenderCutoff&&xt.defines.push("RENDER_CUTOFF");const Mt=u.getOrCreateProgram("model",xt);u.uploadCommonUniforms(O,Mt,null,wt,Rt),u.renderPass!=="shadow"&&Pt&&Pt.setupShadowsFromMatrix(x.nodeModelMatrix,Mt),Mt.draw(u,O.gl.TRIANGLES,B,A,M,j.material.doubleSided?Ni.disabled:Ni.backCCW,gt,p.id,j.vertexBuffer,j.indexBuffer,j.segments,p.paint,u.transform.zoom,void 0,vt)}function C_(x,u,p){return x.type==="vector"?u.scope:p?"basemap":""}function M_(x,u,p,b,A,M,P,O,B){const G=x.transform,j=!!u.isGeometryBloom&&u.isGeometryBloom;if(j&&x.renderPass==="shadow")return;const X=G.projection.name==="globe"?a.eC(p,G):[...p];a.aB(X,X,u.globalMatrix);const W=a.aB([],b,X);if(u.meshes)for(const K of u.meshes){const tt=O.get(K.material.name);if(tt&&tt.opacity<=0)continue;if(K.material.alphaMode!=="BLEND"){P.push({mesh:K,depth:0,modelIndex:A,worldViewProjection:W,nodeModelMatrix:X,isLightMesh:j,materialOverride:tt,modelColor:B});continue}const rt=a.af([],K.centroid,W);!G.isOrthographic&&rt[2]<=0||M.push({mesh:K,depth:rt[2],modelIndex:A,worldViewProjection:W,nodeModelMatrix:X,isLightMesh:j,materialOverride:tt,modelColor:B})}if(u.children)for(const K of u.children)M_(x,K,p,b,A,M,P,O,B)}function xf(x,u,p,b){const A=p.shadowRenderer;if(!A)return;const M=A.getShadowPassDepthMode(),P=A.getShadowPassColorMode(),O=A.calculateShadowPassMatrixFromMatrix(u),B=pf(O);p.getOrCreateProgram("modelDepth",{defines:p._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(p,p.context.gl.TRIANGLES,M,$i.disabled,P,Ni.disabled,B,b.id,x.vertexBuffer,x.indexBuffer,x.segments,b.paint,p.transform.zoom,void 0,void 0)}function bf(x,u,p,b,A,M){for(const P of A){const O=Object.assign({},b);O.part=P;const B={type:"Unknown",id:u,properties:O},G={orientation:x.paint.get("model-rotation").evaluate(B,p)};M.set(P,G)}}function lD(x,u,p,b,A,M){for(const P of A){const O=Object.assign({},b);O.part=P;const B={type:"Unknown",id:u,properties:O},G={color:x.paint.get("model-color").evaluate(B,p),colorMix:x.paint.get("model-color-mix-intensity").evaluate(B,p),opacity:x.paint.get("model-opacity").evaluate(B,p),emissionStrength:x.paint.get("model-emissive-strength").evaluate(B,p)};M.set(P,G)}}function LT(x,u,p,b,A,M){if(p===1)for(const O of A)yf(O,x,u,M[O.modelIndex],$i.disabled,x.colorModeForRenderPass());else{for(const O of A)yf(O,x,u,M[O.modelIndex],$i.disabled,lr.disabled);for(const O of A)yf(O,x,u,M[O.modelIndex],x.stencilModeFor3D(),x.colorModeForRenderPass());x.resetStencilClippingMasks()}const P=lr.additive;for(const O of b)yf(O,x,u,M[O.modelIndex],$i.disabled,O.isLightMesh?P:x.colorModeForRenderPass())}function RT(x,u,p){const b=u.updateZoomBasedPaintProperties(),A=function(M,P,O){let B,G,j,X=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&X>0){const W=M.terrain,K=W.findDEMTileFor(O);K&&K.dem?B=a.eE.create(W,O,K):X=0}if(X===0&&(P.terrainElevationMin=0,P.terrainElevationMax=0),X===P.validForExaggeration&&(X===0||B&&B._demTile&&B._demTile.tileID===P.validForDEMTile.id&&B._dem._timestamp===P.validForDEMTile.timestamp))return!1;for(const W in P.instancesPerModel){const K=P.instancesPerModel[W];for(let tt=0;tt<K.instancedDataArray.length;++tt){const rt=(B?X*B.getElevationAt(0|K.instancedDataArray.float32[16*tt],0|K.instancedDataArray.float32[16*tt+1],!0,!0):0)+K.instancesEvaluatedElevation[tt];K.instancedDataArray.float32[16*tt+6]=rt,G=G?Math.min(P.terrainElevationMin,rt):rt,j=j?Math.max(P.terrainElevationMax,rt):rt}}return P.terrainElevationMin=G||0,P.terrainElevationMax=j||0,P.validForExaggeration=X,P.validForDEMTile=B&&B._demTile?{id:B._demTile.tileID,timestamp:B._dem._timestamp}:{id:void 0,timestamp:0},!0}(x,u,p);(b||A)&&(u.uploaded=!1,u.upload(x.context))}const Zs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.d8([0,0,0],[a.al,a.al,0])};function Kx(x,u){const p=1<<x.canonical.z,b=u.getFreeCameraOptions().position,A=u.elevation,M=x.canonical.x/p,P=(x.canonical.x+1)/p,O=x.canonical.y/p,B=(x.canonical.y+1)/p;let G=u._centerAltitude;if(A){const K=A.getMinMaxForTile(x);K&&K.max>G&&(G=K.max)}const j=a.aA(b.x,M,P)-b.x,X=a.aA(b.y,O,B)-b.y,W=a.ce(G,u.center.lat)-b.z;return u._zoomFromMercatorZ(Math.sqrt(j*j+X*X+W*W))}function Jx(x,u,p,b,A,M,P){const O=x.context,B=x.renderPass==="shadow",G=x.shadowRenderer,j=B&&G?G.getShadowPassDepthMode():new fi(O.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D),X=x.isTileAffectedByFog(M),W=x.transform.projection.name==="globe";if(p.meshes)for(const K of p.meshes){const tt=W?[]:["MODEL_POSITION_ON_GPU"],rt=[];let ht,st,gt;const xt=!W&&b.instancedDataArray.length>20;xt&&tt.push("INSTANCED_ARRAYS");const vt=ju(x,u.paint.get("model-cutoff-fade-range"));if(vt.shouldRenderCutoff&&tt.push("RENDER_CUTOFF"),B&&G)ht=x.getOrCreateProgram("modelDepth",{defines:tt}),st=pf(P.shadowTileMatrix,P.shadowTileMatrix,Float32Array.from(p.globalMatrix)),gt=G.getShadowPassColorMode();else{_f(tt,rt,K,x,u.paint.get("model-color-use-theme").constantOr("default")==="none"?null:u.lut),ht=x.getOrCreateProgram("model",{defines:tt,overrideFog:X});const wt=K.material,Rt=wt.pbrMetallicRoughness,Mt=u.paint.get("model-opacity").constantOr(1),At=u.paint.get("model-emissive-strength").constantOr(0);st=y_(M.expandedProjMatrix,Float32Array.from(p.globalMatrix),new Float32Array(16),null,x,Mt,Rt.baseColorFactor,wt.emissiveFactor,Rt.metallicFactor,Rt.roughnessFactor,wt,At,u,A),G&&(P.shadowUniformsInitialized?ht.setShadowUniformValues(O,G.getShadowUniformValues()):(G.setupShadows(M.toUnwrapped(),ht,"model-tile"),P.shadowUniformsInitialized=!0)),gt=vt.shouldRenderCutoff||Mt<1||wt.alphaMode!=="OPAQUE"?lr.alphaBlended:lr.unblended}x.uploadCommonUniforms(O,ht,M.toUnwrapped(),null,vt);const Pt=K.material.doubleSided?Ni.disabled:Ni.backCCW;if(xt)rt.push(b.instancedDataBuffer),ht.draw(x,O.gl.TRIANGLES,j,$i.disabled,gt,Pt,st,u.id,K.vertexBuffer,K.indexBuffer,K.segments,u.paint,x.transform.zoom,void 0,rt,b.instancedDataArray.length);else{const wt=B?"u_instance":"u_normal_matrix";for(let Rt=0;Rt<b.instancedDataArray.length;++Rt)st[wt]=new Float32Array(b.instancedDataArray.arrayBuffer,64*Rt,16),ht.draw(x,O.gl.TRIANGLES,j,$i.disabled,gt,Pt,st,u.id,K.vertexBuffer,K.indexBuffer,K.segments,u.paint,x.transform.zoom,void 0,rt)}}if(p.children)for(const K of p.children)Jx(x,u,K,b,A,M,P)}const kT=[1,-1,1];function E_(x,u,p,b){if(!p.modelManager)return!0;const A=p.modelManager;if(!p.shadowRenderer)return!0;const M=p.shadowRenderer,P=u.aabb;let O=!0,B=x.maxHeight;if(B===0){let j=0;for(const X in x.instancesPerModel){const W=A.getModel(X,b);W?j=Math.max(j,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):O=!1}B=x.maxScale*j*1.41+x.maxVerticalOffset,O&&(x.maxHeight=B)}P.max[2]=B,P.min[2]+=x.terrainElevationMin,P.max[2]+=x.terrainElevationMax,a.af(P.min,P.min,u.tileMatrix),a.af(P.max,P.max,u.tileMatrix);const G=P.intersects(M.getCurrentCascadeFrustum());return p.currentShadowCascade===0&&(x.isInsideFirstShadowMapFrustum=G===2),G===0}function Lg(x,u){const p=x.uniformValues.u_cutoff_params[0],b=x.uniformValues.u_cutoff_params[1],A=x.uniformValues.u_cutoff_params[2],M=x.uniformValues.u_cutoff_params[3];return b===p||M===A?1:a.aA(((u-p)/(b-p)-A)/(M-A),0,1)}function Hh(x,u,p,b){if(u.pitch<20)return 1;const A=u.getWorldToCameraMatrix();a.aB(A,A,x);const M=a.bT(p.min[0],p.min[1],p.min[2],1);let P=a.aC(a.eF(),M,A),O=P,B=P;M[1]=p.max[1],P=a.aC(a.eF(),M,A),O=P[1]<O[1]?P:O,B=P[1]>B[1]?P:B,M[0]=p.max[0],P=a.aC(a.eF(),M,A),O=P[1]<O[1]?P:O,B=P[1]>B[1]?P:B,M[1]=p.min[1],P=a.aC(a.eF(),M,A),O=P[1]<O[1]?P:O,B=P[1]>B[1]?P:B;const G=a.aA(b[0],0,1),j=100*u.pixelsPerMeter*a.aA(b[1],0,1),X=a.aA(b[2],0,1),W=a.eG(a.eF(),O,B,G),K=Math.tan(.5*u.fovX),tt=-W[2]*K;if(j===0)return W[1]<-Math.abs(tt)?X:1;const rt=(-Math.abs(tt)-W[1])/j,ht=(gt,xt,vt)=>(1-vt)*gt+vt*xt,st=a.aA(ht(1,X,rt),X,1);return ht(1,st,a.aA((u.pitch-20)/20,0,1))}class OT{}class zT{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(u,p,b){{const X=this._storage.get(p.id);if(X)return X.lastUsedFrameIdx=u,X.buf}const A=b.gl,M=A.getBufferParameter(A.ELEMENT_ARRAY_BUFFER,A.BUFFER_SIZE),P=new ArrayBuffer(M),O=new Int16Array(P);A.getBufferSubData(A.ELEMENT_ARRAY_BUFFER,0,new Int16Array(P));const B=new a.eI;for(let X=0;X<M/2;X+=3){const W=O[X],K=O[X+1],tt=O[X+2];B.emplaceBack(W,K),B.emplaceBack(K,tt),B.emplaceBack(tt,W)}const G=b.bindVertexArrayOES.current,j=new OT;return j.buf=new Dc(b,B),j.lastUsedFrameIdx=u,this._storage.set(p.id,j),b.bindVertexArrayOES.set(G),j.buf}update(u){for(const[p,b]of this._storage)u-b.lastUsedFrameIdx>30&&(b.buf.destroy(),this._storage.delete(p))}destroy(){for(const[u,p]of this._storage)p.buf.destroy(),this._storage.delete(u)}}class uD{constructor(u){this.occluderSize=30,this.depthOffset=-1e-4,u.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),u.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const BT=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class cD{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ho{constructor(u,p){this.revealStart=11,this.revealRange=2,u.registerParameter(this,[...p,"Reveal"],"revealStart",{min:0,max:17,step:.05}),u.registerParameter(this,[...p,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const hD=a.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Rg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(u,p){const b=u.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const P=new a.eJ,O=new a.b0;P.emplaceBack(-1,-1),P.emplaceBack(1,-1),P.emplaceBack(1,1),P.emplaceBack(-1,1),O.emplaceBack(0,1,2),O.emplaceBack(0,2,3),this.vignetteVx=u.context.createVertexBuffer(P,hD.members),this.vignetteIdx=u.context.createIndexBuffer(O)}const A=a.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){u.uploadCommonUniforms(u.context,b);const P={u_vignetteShape:(M={vignetteShape:[p.start,p.range,Math.pow(10,p.fadePower)],vignetteColor:[p.color.r,p.color.g,p.color.b,p.color.a*p.strength]}).vignetteShape,u_vignetteColor:M.vignetteColor};b.draw(u,u.context.gl.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,P,"vignette",this.vignetteVx,this.vignetteIdx,A)}var M}}class In{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(u,p){const b=u.getFreeCameraOptions().position,A=b.toAltitude(),M=b.toLngLat(),P=a.an(M.lng),O=a.an(M.lat),B=u.pixelsPerMeter/p,G=P*a.eL,j=a.eL*Math.log(Math.tan(Math.PI/4+O/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const X=-this._offsetYPrev+j,W=-this._elevationPrev+A;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*B,this._accumulatedOffsetY+=X*B,this._accumulatedElevation+=W*B,this._offsetXPrev=G,this._offsetYPrev=j,this._elevationPrev=A}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function gr(x,u){return[-(x[0]-Math.floor(x[0]/u)*u),-(x[1]-Math.floor(x[1]/u)*u),-(x[2]-Math.floor(x[2]/u)*u)]}function Qx(x){const u=a.eq(1323123451230),p=[];for(let b=0;b<x;++b){const A=2*u()-1,M=2*u()-1,P=2*u()-1;p.push(a.d4(A,M,P))}return p}function hs(x,u,p,b,A){const M=a.aA((A-p)/(b-p),0,1);return(1-M)*x+M*u}class jh{constructor(u){this._movement=new In,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Rg,this._ppmScaleFactor=u}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(u,p){const b=u.transform;this._movement.update(b,this._ppmScaleFactor);const A=b.starsProjMatrix,M=a.c6([]);a.c8(M,M,a.an(90)-b._pitch),a.c7(M,M,-b.angle);const P=a.cb(new Float32Array(16),M),O=a.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),B=a.ef([],O),G=a.aB([],B,P),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*p,this._prevTime=j,{projectionMatrix:A,modelviewMatrix:G}}}class wf extends jh{constructor(u){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ho(u.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(u){const p=u.context;if(!this.particlesVx){const b=Qx(this.particlesCount),A=new a.eM,M=new a.b0;let P=0;const O=a.eq(1323123451230);for(let B=0;B<b.length;++B){const G=b[B],j=[2*O()-1,O(),O(),O()];A.emplaceBack(G[0],G[1],G[2],-1,-1,...j),A.emplaceBack(G[0],G[1],G[2],1,-1,...j),A.emplaceBack(G[0],G[1],G[2],1,1,...j),A.emplaceBack(G[0],G[1],G[2],-1,1,...j),M.emplaceBack(P+0,P+1,P+2),M.emplaceBack(P+0,P+2,P+3),P+=4}this.particlesVx=p.createVertexBuffer(A,BT.members),this.particlesIdx=p.createIndexBuffer(M)}}draw(u){if(!this._params.overrideStyleParameters&&!u.style.rain)return;const p=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=u.transform.zoom;if(p.revealStart>b)return;const A=hs(0,1,p.revealStart,p.revealStart+p.revealRange,b);if(!this.particlesVx||!this.particlesIdx)return;const M=structuredClone(this._params);let P=[-M.direction.x,M.direction.y,-100];a.aw(P,P);const O=structuredClone(this._vignetteParams);O.strength*=A,M.overrideStyleParameters||(M.intensity=u.style.rain.state.density,M.timeFactor=u.style.rain.state.intensity,M.color=structuredClone(u.style.rain.state.color),P=structuredClone(u.style.rain.state.direction),M.screenThinning.intensity=u.style.rain.state.centerThinning,M.dropletSizeX=u.style.rain.state.dropletSize[0],M.dropletSizeYScale=u.style.rain.state.dropletSize[1]/u.style.rain.state.dropletSize[0],M.distortionStrength=100*u.style.rain.state.distortionStrength,O.strength=1,O.color=structuredClone(u.style.rain.state.vignetteColor));const B=this.updateOnRender(u,M.timeFactor),G=u.context,j=G.gl,X=u.transform;this.screenTexture&&this.screenTexture.size[0]===u.width&&this.screenTexture.size[1]===u.height||(this.screenTexture=new a.T(G,{width:u.width,height:u.height,data:null},j.RGBA8)),M.distortionStrength>0&&(G.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,u.width,u.height));const W=u.getOrCreateProgram("rainParticle");u.uploadCommonUniforms(G,W),G.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const K=[M.color.r,M.color.g,M.color.b,M.color.a],tt=(rt,ht)=>{const st=gr(this._movement.getPosition(),rt),gt=M.dropletSizeX,xt=M.dropletSizeX*M.dropletSizeYScale,vt=u.width/2,Pt=u.height/2,wt=hs(0,M.screenThinning.start,0,1,M.screenThinning.intensity),Rt=hs(.001,M.screenThinning.range,0,1,M.screenThinning.intensity),Mt=hs(0,M.screenThinning.particleOffset,0,1,M.screenThinning.intensity),At=(kt={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:st,velocityConeAperture:M.velocityConeAperture,velocity:M.velocity,boxSize:rt,rainDropletSize:[gt,xt],distortionStrength:M.distortionStrength,rainDirection:P,color:K,screenSize:[X.width,X.height],thinningCenterPos:[vt,Pt],thinningShape:[wt,Rt,Math.pow(10,M.screenThinning.fadePower)],thinningAffectedRatio:M.screenThinning.affectedRatio,thinningParticleOffset:Mt,shapeDirectionalPower:M.shapeDirPower,shapeNormalPower:M.shapeNormalPower,mode:ht?0:1},{u_modelview:Float32Array.from(kt.modelview),u_projection:Float32Array.from(kt.projection),u_time:kt.time,u_cam_pos:kt.camPos,u_texScreen:0,u_velocityConeAperture:kt.velocityConeAperture,u_velocity:kt.velocity,u_boxSize:kt.boxSize,u_rainDropletSize:kt.rainDropletSize,u_distortionStrength:kt.distortionStrength,u_rainDirection:kt.rainDirection,u_color:kt.color,u_screenSize:kt.screenSize,u_thinningCenterPos:kt.thinningCenterPos,u_thinningShape:kt.thinningShape,u_thinningAffectedRatio:kt.thinningAffectedRatio,u_thinningParticleOffset:kt.thinningParticleOffset,u_shapeDirectionalPower:kt.shapeDirectionalPower,u_shapeNormalPower:kt.shapeNormalPower,u_mode:kt.mode});var kt;const qt=Math.round(M.intensity*this.particlesCount),jt=a.bf.simpleSegment(0,0,4*qt,2*qt);W.draw(u,j.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,At,"rain_particles",this.particlesVx,this.particlesIdx,jt)};M.distortionStrength>0&&tt(M.boxSize,!0),tt(M.boxSize,!1),this._vignette.draw(u,O)}}const qu=a.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class t1 extends jh{constructor(u){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ho(u.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(u){const p=u.context;if(!this.particlesVx){const b=Qx(this.particlesCount),A=new a.eN,M=new a.b0;let P=0;const O=a.eq(1323123451230);for(let B=0;B<b.length;++B){const G=b[B],j=O(),X=O(),W=O(),K=[B/b.length,j,X,W],tt=[O(),O()];A.emplaceBack(G[0],G[1],G[2],-1,-1,...K,...tt),A.emplaceBack(G[0],G[1],G[2],1,-1,...K,...tt),A.emplaceBack(G[0],G[1],G[2],1,1,...K,...tt),A.emplaceBack(G[0],G[1],G[2],-1,1,...K,...tt),M.emplaceBack(P+0,P+1,P+2),M.emplaceBack(P+0,P+2,P+3),P+=4}this.particlesVx=p.createVertexBuffer(A,qu.members),this.particlesIdx=p.createIndexBuffer(M)}}draw(u){if(!this._params.overrideStyleParameters&&!u.style.snow)return;const p=structuredClone(this._params);let b=[-p.direction.x,p.direction.y,-100];a.aw(b,b);const A=structuredClone(this._vignetteParams),M=p.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},P=u.transform.zoom;if(M.revealStart>P)return;const O=hs(0,1,M.revealStart,M.revealStart+M.revealRange,P);A.strength*=O,p.overrideStyleParameters||(p.intensity=u.style.snow.state.density,p.timeFactor=u.style.snow.state.intensity,p.color=structuredClone(u.style.snow.state.color),b=structuredClone(u.style.snow.state.direction),p.screenThinning.intensity=u.style.snow.state.centerThinning,p.billboardSize=2.79*u.style.snow.state.flakeSize,A.strength=1,A.color=structuredClone(u.style.snow.state.vignetteColor));const B=this.updateOnRender(u,p.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=u.context,j=G.gl,X=u.transform,W=u.getOrCreateProgram("snowParticle");u.uploadCommonUniforms(G,W),((K,tt,rt)=>{const ht=gr(this._movement.getPosition(),K),st=X.width/2,gt=X.height/2,xt=hs(0,rt.screenThinning.start,0,1,rt.screenThinning.intensity),vt=hs(.001,rt.screenThinning.range,0,1,rt.screenThinning.intensity),Pt=hs(0,rt.screenThinning.particleOffset,0,1,rt.screenThinning.intensity),wt=(Rt={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ht,velocityConeAperture:rt.velocityConeAperture,velocity:rt.velocity,horizontalOscillationRadius:rt.horizontalOscillationRadius,horizontalOscillationRate:rt.horizontalOscillationRate,boxSize:K,billboardSize:1*rt.billboardSize,simpleShapeParameters:[rt.shapeFadeStart,rt.shapeFadePower],screenSize:[X.width,X.height],thinningCenterPos:[st,gt],thinningShape:[xt,vt,Math.pow(10,rt.screenThinning.fadePower)],thinningAffectedRatio:rt.screenThinning.affectedRatio,thinningParticleOffset:Pt,color:[rt.color.r,rt.color.g,rt.color.b,rt.color.a],direction:b},{u_modelview:Float32Array.from(Rt.modelview),u_projection:Float32Array.from(Rt.projection),u_time:Rt.time,u_cam_pos:Rt.camPos,u_velocityConeAperture:Rt.velocityConeAperture,u_velocity:Rt.velocity,u_horizontalOscillationRadius:Rt.horizontalOscillationRadius,u_horizontalOscillationRate:Rt.horizontalOscillationRate,u_boxSize:Rt.boxSize,u_billboardSize:Rt.billboardSize,u_simpleShapeParameters:Rt.simpleShapeParameters,u_screenSize:Rt.screenSize,u_thinningCenterPos:Rt.thinningCenterPos,u_thinningShape:Rt.thinningShape,u_thinningAffectedRatio:Rt.thinningAffectedRatio,u_thinningParticleOffset:Rt.thinningParticleOffset,u_particleColor:Rt.color,u_direction:Rt.direction});var Rt;const Mt=Math.round(rt.intensity*this.particlesCount),At=a.bf.simpleSegment(0,0,4*Mt,2*Mt);this.particlesVx&&this.particlesIdx&&W.draw(u,j.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,wt,"snow_particles",this.particlesVx,this.particlesIdx,At)})(p.boxSize,0,p),this._vignette.draw(u,A)}}const e1={symbol:function(x,u,p,b,A){if(x.renderPass!=="translucent")return;const M=$i.disabled,P=x.colorModeForRenderPass(),O=p.layout.get("text-variable-anchor"),B=p.layout.get("text-size-scale-range"),G=a.aA(x.scaleFactor,B[0],B[1]);O&&function(W,K,tt,rt,ht,st,gt,xt){const vt=K.transform,Pt=ht==="map",wt=st==="map";for(const Rt of W){const Mt=rt.getTile(Rt),At=Mt.getBucket(tt);if(!At||!At.text||!At.text.segments.get().length)continue;const kt=a.bJ(At.textSizeData,vt.zoom,xt),qt=Hv(Rt,At.getProjection(),vt),jt=vt.calculatePixelsToTileUnitsMatrix(Mt),oe=Xd(qt,Mt.tileID.canonical,wt,Pt,vt,At.getProjection(),jt),te=At.hasIconTextFit()&&At.hasIconData();kt&&S_(At,Pt,wt,gt,vt,oe,Rt,Math.pow(2,vt.zoom-Mt.tileID.overscaledZ),kt,te)}}(b,x,p,u,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),A,G);const j=p.paint.get("icon-opacity").constantOr(1)!==0,X=p.paint.get("text-opacity").constantOr(1)!==0;p.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||X)?Dg(x,u,p,b,M,P):(j&&Dg(x,u,p,b,M,P,{onlyIcons:!0}),X&&Dg(x,u,p,b,M,P,{onlyText:!0})),u.map.showCollisionBoxes&&(Eg(x,u,p,b,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Eg(x,u,p,b,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(x,u,p,b){if(x.renderPass!=="translucent")return;const A=p.paint.get("circle-opacity"),M=p.paint.get("circle-stroke-width"),P=p.paint.get("circle-stroke-opacity"),O=p.layout.get("circle-sort-key").constantOr(1)!==void 0,B=p.paint.get("circle-emissive-strength");if(A.constantOr(1)===0&&(M.constantOr(1)===0||P.constantOr(1)===0))return;const G=x.context,j=G.gl,X=x.transform,W=!(!x.terrain||!x.terrain.enabled),K=p.layout.get("circle-elevation-reference"),tt=x.depthModeForSublayer(0,fi.ReadOnly),rt=new fi(x.context.gl.LEQUAL,fi.ReadOnly,x.depthRangeFor3D),ht=K==="none"||W?tt:rt,st=$i.disabled,gt=x.colorModeForDrapableLayerRenderPass(B),xt=X.projection.name==="globe",vt=[a.aF(X.center.lng),a.aJ(X.center.lat)],Pt=[];for(let Rt=0;Rt<b.length;Rt++){const Mt=b[Rt],At=u.getTile(Mt),kt=At.getBucket(p);if(!kt||kt.projection.name!==X.projection.name)continue;const qt=kt.programConfigurations.get(p.id),jt=kt.layoutVertexBuffer,oe=kt.globeExtVertexBuffer,te=kt.indexBuffer,fe=a.d$(p),ze=[oe],Qt=x.isTileAffectedByFog(Mt);xt&&fe.push("PROJECTION_GLOBE_VIEW"),fe.push("DEPTH_D24"),x.terrain&&X.depthOcclusionForSymbolsAndCircles&&fe.push("DEPTH_OCCLUSION"),kt.hasElevation&&!x.terrain&&(fe.push("ELEVATED_ROADS"),ze.push(kt.elevatedLayoutVertexBuffer));const Gt=x.getOrCreateProgram("circle",{config:qt,defines:fe,overrideFog:Qt}),pe=X.projection.createInversionMatrix(X,Mt.canonical),ee={programConfiguration:qt,program:Gt,layoutVertexBuffer:jt,dynamicBuffers:ze,indexBuffer:te,uniformValues:a.e0(x,Mt,At,pe,vt,p),tile:At};if(O){const Ae=kt.segments.get();for(const Ge of Ae)Pt.push({segments:new a.bf([Ge]),sortKey:Ge.sortKey,state:ee})}else Pt.push({segments:kt.segments,sortKey:0,state:ee})}O&&Pt.sort((Rt,Mt)=>Rt.sortKey-Mt.sortKey);const wt={useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles};for(const Rt of Pt){const{programConfiguration:Mt,program:At,layoutVertexBuffer:kt,dynamicBuffers:qt,indexBuffer:jt,uniformValues:oe,tile:te}=Rt.state,fe=Rt.segments;x.terrain&&x.terrain.setupElevationDraw(te,At,wt),x.uploadCommonUniforms(G,At,te.tileID.toUnwrapped()),At.draw(x,j.TRIANGLES,ht,st,gt,Ni.disabled,oe,p.id,kt,jt,fe,p.paint,X.zoom,Mt,qt)}},heatmap:function(x,u,p,b){if(p.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const A=x.context,M=A.gl,P=$i.disabled,O=new lr([M.ONE,M.ONE,M.ONE,M.ONE],a.ao.transparent,[!0,!0,!0,!0]);(function(K,tt,rt,ht){const st=K.gl,gt=tt.width*ht,xt=tt.height*ht;K.activeTexture.set(st.TEXTURE1),K.viewport.set([0,0,gt,xt]);let vt=rt.heatmapFbo;if(!vt||vt&&(vt.width!==gt||vt.height!==xt)){vt&&vt.destroy();const Pt=st.createTexture();st.bindTexture(st.TEXTURE_2D,Pt),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_WRAP_S,st.CLAMP_TO_EDGE),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_WRAP_T,st.CLAMP_TO_EDGE),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_MIN_FILTER,st.LINEAR),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_MAG_FILTER,st.LINEAR),vt=rt.heatmapFbo=K.createFramebuffer(gt,xt,!0,null),function(wt,Rt,Mt,At,kt,qt){const jt=wt.gl;jt.texImage2D(jt.TEXTURE_2D,0,wt.extRenderToTextureHalfFloat?jt.RGBA16F:jt.RGBA,kt,qt,0,jt.RGBA,wt.extRenderToTextureHalfFloat?jt.HALF_FLOAT:jt.UNSIGNED_BYTE,null),At.colorAttachment.set(Mt)}(K,0,Pt,vt,gt,xt)}else st.bindTexture(st.TEXTURE_2D,vt.colorAttachment.get()),K.bindFramebuffer.set(vt.framebuffer)})(A,x,p,x.transform.projection.name==="globe"?.5:.25),A.clear({color:a.ao.transparent});const B=x.transform,G=B.projection.name==="globe",j=G?["PROJECTION_GLOBE_VIEW"]:[],X=G?Ni.frontCCW:Ni.disabled,W=[a.aF(B.center.lng),a.aJ(B.center.lat)];for(let K=0;K<b.length;K++){const tt=b[K];if(u.hasRenderableParent(tt))continue;const rt=u.getTile(tt),ht=rt.getBucket(p);if(!ht||ht.projection.name!==B.projection.name)continue;const st=x.isTileAffectedByFog(tt),gt=ht.programConfigurations.get(p.id),xt=x.getOrCreateProgram("heatmap",{config:gt,defines:j,overrideFog:st}),{zoom:vt}=x.transform;x.terrain&&x.terrain.setupElevationDraw(rt,xt),x.uploadCommonUniforms(A,xt,tt.toUnwrapped());const Pt=B.projection.createInversionMatrix(B,tt.canonical);xt.draw(x,M.TRIANGLES,fi.disabled,P,O,X,TT(x,tt,rt,Pt,W,vt,p.paint.get("heatmap-intensity")),p.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,p.paint,x.transform.zoom,gt,G?[ht.globeExtVertexBuffer]:null)}A.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(A,M){const P=A.context,O=P.gl,B=M.heatmapFbo;if(!B)return;P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,B.colorAttachment.get()),P.activeTexture.set(O.TEXTURE1);let G=M.colorRampTexture;G||(G=M.colorRampTexture=new a.T(P,M.colorRamp,O.RGBA8)),G.bind(O.LINEAR,O.CLAMP_TO_EDGE),A.getOrCreateProgram("heatmapTexture").draw(A,O.TRIANGLES,fi.disabled,$i.disabled,A.colorModeForRenderPass(),Ni.disabled,((j,X,W,K)=>({u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}))(0,M),M.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,M.paint,A.transform.zoom)}(x,p))},line:function(x,u,p,b){if(x.renderPass!=="translucent")return;const A=p.paint.get("line-opacity"),M=p.paint.get("line-width");if(A.constantOr(1)===0||M.constantOr(1)===0)return;const P=p.paint.get("line-emissive-strength"),O=p.paint.get("line-occlusion-opacity"),B=p.layout.get("line-elevation-reference"),G=p.layout.get("line-width-unit")==="meters",j=B==="sea",X=!(!x.terrain||!x.terrain.enabled),W=x.context,K=W.gl;if(p.hasElevatedBuckets&&x.transform.projection.name==="globe")return;const tt=p.layout.get("line-cross-slope"),rt=tt!==void 0,ht=tt<1,st=x.colorModeForDrapableLayerRenderPass(P),gt=x.terrain&&x.terrain.renderingToTexture,xt=gt?1:a.o.devicePixelRatio,vt=p.paint.get("line-dasharray"),Pt=vt.constantOr(1),wt=p.layout.get("line-cap"),Rt=vt.constantOr(null),Mt=wt.constantOr(null),At=p.paint.get("line-pattern"),kt=At.constantOr(1),qt=p.paint.get("line-pattern-cross-fade"),jt=At.constantOr(null),oe=p.paint.get("line-opacity").constantOr(1);let te=!kt&&oe!==1||x.depthOcclusion&&O>0&&O<1;const fe=p.paint.get("line-gradient"),ze=kt?"linePattern":"line",Qt=a.e1(p);let Gt;if(gt&&x.terrain&&x.terrain.clipOrMaskOverlapStencilType()&&(te=!1),O!==0&&x.depthOcclusion){const Ge=p.paint._values["line-opacity"];Ge&&Ge.value&&Ge.value.kind==="constant"?Gt=Ge.value:a.w(`Occlusion opacity for layer ${p.id} is supported only when line-opacity isn't data-driven.`)}M.value.kind!=="constant"&&M.value.isLineProgressConstant===!1&&Qt.push("VARIABLE_LINE_WIDTH");const pe=(Ge,ui,Le,Fe,hi,ai)=>{for(const ii of Ge){const oi=u.getTile(ii);if(kt&&!oi.patternsLoaded())continue;const Di=oi.getBucket(p);if(!Di||Di.elevationType!=="none"&&!hi||Di.elevationType==="none"&&hi)continue;x.prepareDrawTile();const mr=[...ui],Ir=x.shadowRenderer,an=Di.elevationType==="road"&&!!Ir&&Ir.enabled;let Vi=[0,0,0];if(an){const Hi=x.style.directionalLight,Dr=x.style.ambientLight;Hi&&Dr&&(Vi=bl(x.style,Hi,Dr)),mr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Tr=Di.programConfigurations.get(p.id);let ir=!1;if(jt&&oi.imageAtlas){const Hi=a.e2.from(jt),Dr=Hi.getPrimary().scaleSelf(xt).toString(),Bn=oi.imageAtlas.patternPositions.get(Dr),ra=Hi.getSecondary(),Gn=ra?oi.imageAtlas.patternPositions.get(ra.scaleSelf(xt).toString()):null;ir=!!Bn&&!!Gn,Bn&&Tr.setConstantPatternPositions(Bn,Gn)}qt>0&&(ir||Tr.getPatternTransitionVertexBuffer("line-pattern"))&&mr.push("LINE_PATTERN_TRANSITION");const Qr=x.isTileAffectedByFog(ii),Cr=x.getOrCreateProgram(ze,{config:Tr,defines:mr,overrideFog:Qr});if(!kt&&Rt&&Mt&&oi.lineAtlas){const Hi=oi.lineAtlas.getDash(Rt,Mt);Hi&&Tr.setConstantPatternPositions(Hi)}an&&Ir.setupShadows(oi.tileID.toUnwrapped(),Cr,"vector-tile");let[pn,Or]=p.paint.get("line-trim-offset");(Mt==="round"||Mt==="square")&&pn!==Or&&(pn===0&&(pn-=1),Or===1&&(Or+=1));const ar=gt?ii.projMatrix:null,Gr=G?1/Di.tileToMeter/a.ay(oi,1,x.transform.zoom):1,ur=G?1/Di.tileToMeter/a.ay(oi,1,Math.floor(x.transform.zoom)):1,wn=kt?a.e3(x,oi,p,ar,xt,Gr,ur,[pn,Or],Vi,qt):a.e4(x,oi,p,ar,Di.lineClipsArray.length,xt,Gr,ur,[pn,Or],Vi);if(fe){const Hi=Di.gradients[p.id];let Dr=Hi.texture;if(p.gradientVersion!==Hi.version){let Bn=256;if(p.stepInterpolant){const ra=u.getSource().maxzoom,Gn=ii.canonical.z===ra?Math.ceil(1<<x.transform.maxZoom-ii.canonical.z):1;Bn=a.aA(a.e5(Di.maxLineLength/a.al*1024*Gn),256,W.maxTextureSize)}Hi.gradient=a.e6({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:Bn,image:Hi.gradient||void 0,clips:Di.lineClipsArray}),Hi.texture?Hi.texture.update(Hi.gradient):Hi.texture=new a.T(W,Hi.gradient,K.RGBA8),Hi.version=p.gradientVersion,Dr=Hi.texture}W.activeTexture.set(K.TEXTURE1),Dr.bind(p.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}Pt&&(W.activeTexture.set(K.TEXTURE0),oi.lineAtlasTexture&&oi.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),Tr.updatePaintBuffers()),kt&&(W.activeTexture.set(K.TEXTURE0),oi.imageAtlasTexture&&oi.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Tr.updatePaintBuffers()),hi&&!j&&x.terrain.setupElevationDraw(oi,Cr),x.uploadCommonUniforms(W,Cr,ii.toUnwrapped());const Zr=Hi=>{Gt!=null&&(Gt.value=oe*O),Cr.draw(x,K.TRIANGLES,Le,Hi,st,Ni.disabled,wn,p.id,Di.layoutVertexBuffer,Di.indexBuffer,Di.segments,p.paint,x.transform.zoom,Tr,[Di.layoutVertexBuffer2,Di.patternVertexBuffer,Di.zOffsetVertexBuffer]),Gt!=null&&(Gt.value=oe)};if(te&&!hi){const Hi=x.stencilModeForClipping(ii).ref;Hi===0&&gt&&W.clear({stencil:0});const Dr={func:K.EQUAL,mask:255};wn.u_alpha_discard_threshold=.8,Zr(new $i(Dr,Hi,255,K.KEEP,K.KEEP,K.INVERT)),wn.u_alpha_discard_threshold=0,Zr(new $i(Dr,Hi,255,K.KEEP,K.KEEP,K.KEEP))}else wn.u_alpha_discard_threshold=te&&hi&&ai?.8:0,Zr(hi?Fe:x.stencilModeForClipping(ii))}};let ee=x.depthModeForSublayer(0,fi.ReadOnly);const Ae=new fi(x.depthOcclusion?K.GREATER:K.LEQUAL,fi.ReadOnly,x.depthRangeFor3D);if(p.hasNonElevatedBuckets){const Ge=!gt&&x.terrain;O!==0&&Ge?a.w(`Occlusion opacity for layer ${p.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ge?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${p.id}.`):pe(b,Qt,ee,$i.disabled,!1,!0)}if(p.hasElevatedBuckets){B==="hd-road-markup"?X||(ee=Ae,Qt.push("ELEVATED_ROADS")):(Qt.push("ELEVATED"),ee=Ae,rt&&Qt.push(ht?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&Qt.push("ELEVATION_REFERENCE_SEA"));const Ge=te?x.stencilModeFor3D():$i.disabled;x.forceTerrainMode=!0,pe(b,Qt,ee,Ge,!0,!0),te&&pe(b,Qt,ee,Ge,!0,!1),x.forceTerrainMode=!1}te&&(x.resetStencilClippingMasks(),gt&&W.clear({stencil:0})),O===0||x.depthOcclusion||gt||x.layersWithOcclusionOpacity.push(x.currentLayer)},fill:function(x,u,p,b){const A=p.paint.get("fill-color"),M=p.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const P=p.paint.get("fill-emissive-strength"),O=x.colorModeForDrapableLayerRenderPass(P),B=p.paint.get("fill-pattern"),G=x.opaquePassEnabledForLayer()&&!B.constantOr(1)&&A.constantOr(a.ao.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";let j="none";p.layout.get("fill-elevation-reference")!=="none"?j="road":p.paint.get("fill-z-offset").constantOr(1)!==0&&(j="offset");const X=!(!x.terrain||!x.terrain.enabled),W={painter:x,sourceCache:u,layer:p,coords:b,colorMode:O,elevationType:j,terrainEnabled:X,pass:G};if(x.renderPass!=="shadow")if(j!=="offset"){if(gf(W,!1),j==="road"){const K=!X&&x.renderPass==="translucent";K&&Uh(x,u,p,b,"geometry"),gf(W,!0,$i.disabled),K&&function(tt){const{painter:rt,sourceCache:ht,layer:st,coords:gt,colorMode:xt}=tt,vt=rt.context.gl,Pt=tt.painter.shadowRenderer,wt=!!Pt&&Pt.enabled,Rt=new fi(rt.context.gl.LEQUAL,fi.ReadOnly,rt.depthRangeFor3D);let Mt=[0,0,0];if(wt){const kt=rt.style.directionalLight,qt=rt.style.ambientLight;kt&&qt&&(Mt=bl(rt.style,kt,qt))}const At=kt=>{for(const qt of gt){const jt=ht.getTile(qt),oe=jt.getBucket(st);if(!oe)continue;const te=oe.elevatedStructures;if(!te)continue;let fe,ze;if(kt?(fe=te.renderableBridgeSegments,ze=te.bridgeProgramConfigurations.get(st.id)):(fe=te.renderableTunnelSegments,ze=te.tunnelProgramConfigurations.get(st.id)),!fe||fe.segments[0].primitiveLength===0)continue;ze.updatePaintBuffers(),rt.prepareDrawTile();const Qt=rt.isTileAffectedByFog(qt),Gt=[];wt&&Gt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const pe=rt.getOrCreateProgram("elevatedStructures",{config:ze,overrideFog:Qt,defines:Gt}),ee=rt.translatePosMatrix(qt.projMatrix,jt,st.paint.get("fill-translate"),st.paint.get("fill-translate-anchor"));wt&&Pt.setupShadows(jt.tileID.toUnwrapped(),pe,"vector-tile");const Ae=rD(ee,Mt);rt.uploadCommonUniforms(rt.context,pe,qt.toUnwrapped()),pe.draw(rt,vt.TRIANGLES,Rt,$i.disabled,xt,Ni.backCCW,Ae,st.id,te.vertexBuffer,te.indexBuffer,fe,st.paint,rt.transform.zoom,ze,[te.vertexBufferNormal])}};At(!0),At(!1)}(W)}}else gf(W,!1,x.stencilModeFor3D());else x.shadowRenderer&&j==="road"&&!X&&function(K){const{painter:tt,sourceCache:rt,layer:ht,coords:st}=K,gt=tt.context.gl,xt=K.painter.shadowRenderer;for(const vt of st){const Pt=rt.getTile(vt),wt=Pt.getBucket(ht);if(!wt)continue;const Rt=wt.elevatedStructures;if(!Rt||!Rt.shadowCasterSegments||Rt.shadowCasterSegments.segments[0].primitiveLength===0)continue;tt.prepareDrawTile();const Mt=wt.bufferData.programConfigurations.get(ht.id),At=tt.isTileAffectedByFog(vt),kt=tt.getOrCreateProgram("elevatedStructuresDepth",{config:Mt,overrideFog:At}),qt=xt.calculateShadowPassMatrixFromTile(Pt.tileID.toUnwrapped());tt.uploadCommonUniforms(tt.context,kt,vt.toUnwrapped());const jt={u_matrix:qt,u_depth_bias:0};kt.draw(tt,gt.TRIANGLES,xt.getShadowPassDepthMode(),$i.disabled,xt.getShadowPassColorMode(),Ni.disabled,jt,ht.id,Rt.vertexBuffer,Rt.indexBuffer,Rt.shadowCasterSegments,ht.paint,tt.transform.zoom,Mt)}}(W)},"fill-extrusion":function(x,u,p,b){const A=p.paint.get("fill-extrusion-opacity"),M=x.context,P=M.gl,O=x.terrain,B=O&&O.renderingToTexture;if(A===0)return;const G=x.conflationActive&&x.style.isLayerClipped(p,u.getSource()),j=x.style.order.indexOf(p.fqid);if(G&&function(X,W,K,tt,rt){for(const ht of tt){const st=W.getTile(ht).getBucket(K);st&&(st.updateReplacement(ht,X.replacementSource,rt),st.uploadCentroid(X.context))}}(x,u,p,b,j),O||G)for(const X of b){const W=u.getTile(X).getBucket(p);W&&Lc(x.context,u,X,W,p,O,G)}if(x.renderPass==="shadow"&&x.shadowRenderer){const X=x.shadowRenderer;if(O&&A<.65&&p._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ad)return;const W=X.getShadowPassDepthMode(),K=X.getShadowPassColorMode();li(x,u,p,b,W,$i.disabled,K,G)}else if(x.renderPass==="translucent"){const X=!p.paint.get("fill-extrusion-pattern").constantOr(1),W=p.paint.get("fill-extrusion-color").constantOr(a.ao.white);if(!B&&W.a!==0){const K=new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D);A===1&&X?li(x,u,p,b,K,$i.disabled,lr.unblended,G):(li(x,u,p,b,K,$i.disabled,lr.disabled,G),li(x,u,p,b,K,x.stencilModeFor3D(),x.colorModeForRenderPass(),G),x.resetStencilClippingMasks())}if(x.style.enable3dLights()&&X&&(!O&&x.transform.projection.name!=="globe"||B)){const K=p.paint.get("fill-extrusion-opacity"),tt=p.paint.get("fill-extrusion-ambient-occlusion-intensity"),rt=p.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ht=p.paint.get("fill-extrusion-flood-light-intensity"),st=p.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",gt=p.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(st?null:p.lut).toArray01().slice(0,3),xt=tt>0&&rt>0,vt=ht>0,Pt=(Mt,At,kt)=>(1-kt)*Mt+kt*At,wt=new Vx;wt.translate=p.paint.get("fill-extrusion-translate"),wt.translateAnchor=p.paint.get("fill-extrusion-translate-anchor"),wt.edgeRadius=p.layout.get("fill-extrusion-edge-radius"),wt.cutoffFadeRange=p.paint.get("fill-extrusion-cutoff-fade-range");const Rt=Mt=>{const At=x.depthModeForSublayer(1,fi.ReadOnly,P.LEQUAL,!0),kt=p.paint.get(Mt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qt=Pt(.1,3,kt),jt=x._showOverdrawInspector;if(!jt){const oe=new $i({func:P.ALWAYS,mask:255},255,255,P.KEEP,P.KEEP,P.REPLACE),te=new lr([P.ONE,P.ONE,P.ONE,P.ONE],a.ao.transparent,[!1,!1,!1,!0],P.MIN);$u(wt,x,u,p,b,At,oe,te,Ni.disabled,Mt,"sdf",K,tt,rt,ht,gt,qt,G,!1)}{const oe=jt?$i.disabled:new $i({func:P.EQUAL,mask:255},255,255,P.KEEP,P.DECR,P.DECR),te=jt?x.colorModeForRenderPass():new lr([P.ONE_MINUS_DST_ALPHA,P.DST_ALPHA,P.ONE,P.ONE],a.ao.transparent,[!0,!0,!0,!0]);$u(wt,x,u,p,b,At,oe,te,Ni.disabled,Mt,"color",K,tt,rt,ht,gt,qt,G,!1)}};if(B){const Mt=(At,kt,qt)=>{const jt=x.depthModeForSublayer(1,fi.ReadOnly,P.LEQUAL,!1),oe=p.paint.get(At?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),te=Pt(.1,3,oe);{const fe=new lr([P.ONE,P.ONE,P.ONE,P.ONE],a.ao.transparent,[!1,!1,!1,!0]);$u(wt,x,u,p,b,jt,$i.disabled,fe,Ni.disabled,At,"clear",K,tt,rt,ht,gt,te,G,kt)}{const fe=new $i({func:P.ALWAYS,mask:255},255,255,P.KEEP,P.KEEP,P.REPLACE),ze=new lr([P.ONE,P.ONE,P.ONE,P.ONE],a.ao.transparent,[!1,!1,!1,!0],P.MIN);$u(wt,x,u,p,b,jt,fe,ze,Ni.disabled,At,"sdf",K,tt,rt,ht,gt,te,G,kt)}{const fe=At?P.ZERO:P.ONE_MINUS_DST_ALPHA,ze=new $i({func:P.EQUAL,mask:255},255,255,P.KEEP,P.DECR,P.DECR),Qt=new lr([fe,P.DST_ALPHA,P.ONE_MINUS_DST_ALPHA,P.ZERO],a.ao.transparent,[!0,!0,!0,!0]);$u(wt,x,u,p,b,jt,ze,Qt,Ni.disabled,At,"color",K,tt,rt,ht,gt,te,G,kt)}{const fe=new lr([P.ONE,P.ONE,P.ONE,At?P.ZERO:P.ONE],a.ao.transparent,[!1,!1,!1,!0],At?P.FUNC_ADD:P.MAX);$u(wt,x,u,p,b,jt,$i.disabled,fe,Ni.disabled,At,"clear",K,tt,rt,ht,gt,te,G,kt,qt)}};if(xt||vt){let At;if(x.prepareDrawTile(),O){const kt=O.drapeBufferSize[0],qt=O.drapeBufferSize[1];At=O.framebufferCopyTexture,At&&(!At||At.size[0]===kt&&At.size[1]===qt)||(At&&At.destroy(),At=O.framebufferCopyTexture=new a.T(M,new a.q({width:kt,height:qt}),P.RGBA8)),At.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,kt,qt)}xt&&Mt(!0,!1,At),vt&&Mt(!1,!0,At)}}else xt&&Rt(!0),vt&&Rt(!1),(xt||vt)&&x.resetStencilClippingMasks()}}},building:function(x,u,p,b){x.currentLayer<x.firstLightBeamLayer&&(x.firstLightBeamLayer=x.currentLayer);const A=p.paint.get("building-ambient-occlusion-ground-intensity"),M=p.paint.get("building-ambient-occlusion-ground-radius"),P=p.paint.get("building-ambient-occlusion-ground-attenuation"),O=p.paint.get("building-opacity");if(O<=0)return;let B=A>0&&M>0,G=!0;const j=p.paint.get("building-vertical-scale");if(j<=0)return;(!x.shadowRenderer||j<1)&&(G=!1);const X=x.conflationActive&&x.style.isLayerClipped(p,u.getSource()),W=x.style.order.indexOf(p.fqid);if(function(K,tt,rt,ht,st,gt){for(const xt of gt){const vt=tt.getTile(xt).getBucket(rt);vt&&(st&&vt.updateReplacement(xt,K.replacementSource,ht),vt.uploadUpdatedIndexBuffer(K.context))}}(x,u,p,W,X,b),function(K,tt,rt,ht){for(const st of ht){const gt=tt.getTile(st).getBucket(rt);gt&&gt.needsEvaluation()&&gt.uploadUpdatedColorBuffer(K.context)}}(x,u,p,b),p.resetLayerRenderingStats(x),x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!0),x.renderPass==="shadow"&&x.shadowRenderer){const K=x.shadowRenderer,tt=[],rt=K.getShadowPassDepthMode();A_({painter:x,source:u,layer:p,coords:b,defines:tt,blendMode:K.getShadowPassColorMode(),depthMode:rt,opacity:O,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(x.renderPass==="translucent"){let K=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];G&&(K=K.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),x.shadowRenderer&&x.shadowRenderer.useNormalOffset&&(K=K.concat("NORMAL_OFFSET"));const tt=p.paint.get("building-facade-emissive-chance"),rt=p.paint.get("building-ambient-occlusion-intensity"),ht=p.paint.get("building-flood-light-intensity"),st=p.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",gt=p.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(st?null:p.lut).toArray01().slice(0,3),xt=p.paint.get("building-flood-light-ground-attenuation"),vt=ht>0,Pt=new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D);O<1&&A_({painter:x,source:u,layer:p,coords:b,defines:K,blendMode:lr.disabled,depthMode:Pt,opacity:O,verticalScale:j,facadeEmissiveChance:tt,facadeAOIntensity:rt,floodLightIntensity:ht,floodLightColor:gt,depthOnly:!0});const wt=x.colorModeForRenderPass();A_({painter:x,source:u,layer:p,coords:b,defines:K,blendMode:wt,depthMode:Pt,opacity:O,verticalScale:j,facadeEmissiveChance:tt,facadeAOIntensity:rt,floodLightIntensity:ht,floodLightColor:gt}),B&&I_(x,u,p,b,!0,O,A,M,ht,gt,P,X),vt&&I_(x,u,p,b,!1,O,A,M,ht,gt,xt,X)}else if(x.renderPass==="light-beam"){const K=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],tt=new fi(x.context.gl.LEQUAL,fi.ReadOnly,x.depthRangeFor3D);A_({painter:x,source:u,layer:p,coords:b,defines:K,blendMode:lr.alphaBlended,depthMode:tt,opacity:O,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}x.shadowRenderer&&(x.shadowRenderer.useNormalOffset=!1),x.resetStencilClippingMasks()},hillshade:function(x,u,p,b){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent"||x.style.disableElevatedTerrain)return;const A=x.context,M=x.terrain&&x.terrain.renderingToTexture,[P,O]=x.renderPass!=="translucent"||M?[{},b]:x.stencilConfigForOverlap(b);for(const B of O){const G=u.getTile(B);if(G.needsHillshadePrepare&&x.renderPass==="offscreen")$E(x,G,p);else if(x.renderPass==="translucent"){const j=x.depthModeForSublayer(0,fi.ReadOnly),X=p.paint.get("hillshade-emissive-strength"),W=x.colorModeForDrapableLayerRenderPass(X),K=M&&x.terrain?x.terrain.stencilModeForRTTOverlap(B):P[B.overscaledZ];WE(x,B,G,p,j,K,W)}}A.viewport.set([0,0,x.width,x.height]),x.resetStencilClippingMasks()},raster:function(x,u,p,b,A,M){if(x.renderPass!=="translucent"||p.paint.get("raster-opacity")===0)return;const P=x.transform.projection.name==="globe",O=p.paint.get("raster-elevation")!==0,B=O&&P;if(x.renderElevatedRasterBackface&&!B)return;const G=x.context,j=G.gl,X=u.getSource(),W=function(wt,Rt,Mt,At){const kt=Rt.paint.get("raster-color"),qt=wt.type==="raster-array",jt=[],oe=Rt.paint.get("raster-resampling"),te=Rt.paint.get("raster-color-mix");let fe=Rt.paint.get("raster-color-range");const ze=[te[0],te[1],te[2],0],Qt=te[3];let Gt=oe==="nearest"?At.NEAREST:At.LINEAR;if(qt&&(jt.push("RASTER_ARRAY"),kt||jt.push("RASTER_COLOR"),oe==="linear"&&jt.push("RASTER_ARRAY_LINEAR"),Gt=At.NEAREST,!fe&&wt.rasterLayers)){const pe=wt.rasterLayers.find(({id:ee})=>ee===Rt.sourceLayer);pe&&pe.fields&&pe.fields.range&&(fe=pe.fields.range)}if(fe=fe||[0,1],kt){jt.push("RASTER_COLOR"),Mt.activeTexture.set(At.TEXTURE2),Rt.updateColorRamp(fe);let pe=Rt.colorRampTexture;pe||(pe=Rt.colorRampTexture=new a.T(Mt,Rt.colorRamp,At.RGBA8)),pe.bind(At.LINEAR,At.CLAMP_TO_EDGE)}return{mix:ze,range:fe,offset:Qt,defines:jt,resampling:Gt}}(X,p,G,j);if(X instanceof a.aT&&!b.length&&!P)return;const K=p.paint.get("raster-emissive-strength"),tt=x.colorModeForDrapableLayerRenderPass(K),rt=x.terrain&&x.terrain.renderingToTexture,ht=!x.options.moving,st=p.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(X instanceof a.aT&&!b.length&&(X.onNorthPole||X.onSouthPole)){const wt=O?x.stencilModeFor3D():$i.disabled;return void Hx(!!X.onNorthPole,null,x,u,p,K,W,Ni.disabled,wt)}if(!b.length)return;const[gt,xt]=X instanceof a.aT||rt?[{},b]:x.stencilConfigForOverlap(b),vt=xt[xt.length-1].overscaledZ;B&&W.defines.push("PROJECTION_GLOBE_VIEW"),O&&W.defines.push("RENDER_CUTOFF");const Pt=(wt,Rt,Mt)=>{for(const At of wt){const kt=At.toUnwrapped(),qt=u.getTile(At);if(rt&&(!qt||!qt.hasData()))continue;G.activeTexture.set(j.TEXTURE0);const jt=oD(qt,X,p,W);if(!jt||!jt.texture)continue;const{texture:oe,mix:te,offset:fe,tileSize:ze,buffer:Qt}=jt;let Gt,pe;rt?(Gt=fi.disabled,pe=At.projMatrix):O?(Gt=new fi(j.LEQUAL,fi.ReadWrite,x.depthRangeFor3D),pe=P?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(kt,ht)):(Gt=x.depthModeForSublayer(At.overscaledZ-vt,p.paint.get("raster-opacity")===1?fi.ReadWrite:fi.ReadOnly,j.LESS),pe=x.transform.calculateProjMatrix(kt,ht));const ee=x.terrain&&rt?x.terrain.stencilModeForRTTOverlap(At):gt[At.overscaledZ],Ae=M?0:p.paint.get("raster-fade-duration");qt.registerFadeDuration(Ae);const Ge=u.findLoadedParent(At,0),ui=u_(qt,Ge,u,x.transform,Ae);let Le,Fe;!ui.isFading&&qt.refreshedUponExpiration&&(qt.refreshedUponExpiration=!1),x.terrain&&x.terrain.prepareDrawTile(),G.activeTexture.set(j.TEXTURE0),oe.bind(st,j.CLAMP_TO_EDGE),G.activeTexture.set(j.TEXTURE1),Ge?(Ge.texture&&Ge.texture.bind(st,j.CLAMP_TO_EDGE),Le=Math.pow(2,Ge.tileID.overscaledZ-qt.tileID.overscaledZ),Fe=[qt.tileID.canonical.x*Le%1,qt.tileID.canonical.y*Le%1]):oe.bind(st,j.CLAMP_TO_EDGE),"useMipmap"in oe&&G.extTextureFilterAnisotropic&&x.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const hi=x.transform;let ai;const ii=O?MT(hi):[0,0,0,0];let oi,Di,mr,Ir,an,Vi=0;if(B&&X instanceof a.aT&&X.coordinates.length>3)oi=Float32Array.from(a.bj(a.dI(new a.cC(0,0,0)))),Di=Float32Array.from(hi.globeMatrix),mr=Float32Array.from(a.dE(hi)),Ir=[a.aF(hi.center.lng),a.aJ(hi.center.lat)],ai=X.elevatedGlobePerspectiveTransform,an=X.elevatedGlobeGridMatrix||new Float32Array(9);else if(B){const Cr=a.dF(At.canonical);Vi=a.dG(Cr.getCenter().lat),oi=Float32Array.from(a.bj(a.dI(At.canonical))),Di=Float32Array.from(hi.globeMatrix),mr=Float32Array.from(a.dE(hi)),Ir=[a.aF(hi.center.lng),a.aJ(hi.center.lat)],ai=[0,0],an=Float32Array.from(a.dH(At.canonical,Cr,Vi,hi.worldSize/hi._pixelsPerMercatorPixel))}else ai=X instanceof a.aT?X.perspectiveTransform:[0,0],oi=new Float32Array(16),Di=new Float32Array(9),mr=new Float32Array(16),Ir=[0,0],an=new Float32Array(9);const Tr=Mg(pe,oi,Di,mr,an,Fe||[0,0],a.aj(x.transform.zoom),Ir,ii,Le||1,ui,p,ai,O?p.paint.get("raster-elevation"):0,2,te,fe,W.range,ze,Qt,K),ir=x.isTileAffectedByFog(At),Qr=x.getOrCreateProgram("raster",{defines:W.defines,overrideFog:ir});if(x.uploadCommonUniforms(G,Qr,kt),X instanceof a.aT){const Cr=X.elevatedGlobeVertexBuffer,pn=X.elevatedGlobeIndexBuffer;if(rt||!P)X.boundsBuffer&&X.boundsSegments&&Qr.draw(x,j.TRIANGLES,Gt,$i.disabled,tt,Ni.disabled,Tr,p.id,X.boundsBuffer,x.quadTriangleIndexBuffer,X.boundsSegments);else if(Cr&&pn){const Or=hi.zoom<=a.cZ?X.elevatedGlobeSegments:X.getSegmentsForLongitude(hi.center.lng);Or&&Qr.draw(x,j.TRIANGLES,Gt,$i.disabled,tt,Rt,Tr,p.id,Cr,pn,Or)}}else if(B){Gt=new fi(j.LEQUAL,fi.ReadOnly,x.depthRangeFor3D);const Cr=x.globeSharedBuffers;if(Cr){const[pn,Or,ar]=Cr.getGridBuffers(Vi,!1);Qr.draw(x,j.TRIANGLES,Gt,Mt||ee,x.colorModeForRenderPass(),Rt,Tr,p.id,pn,Or,ar)}}else{const{tileBoundsBuffer:Cr,tileBoundsIndexBuffer:pn,tileBoundsSegments:Or}=x.getTileBoundsBuffers(qt);Qr.draw(x,j.TRIANGLES,Gt,ee,tt,Ni.disabled,Tr,p.id,Cr,pn,Or)}}if(!(X instanceof a.aT)&&B)for(const At of wt){const kt=At.canonical.y===(1<<At.canonical.z)-1;At.canonical.y===0&&Hx(!0,At,x,u,p,K,W,Rt,Mt||$i.disabled),kt&&Hx(!1,At,x,u,p,K,W,Rt===Ni.frontCW?Ni.backCW:Ni.frontCW,Mt||$i.disabled)}};B?Pt(xt,x.renderElevatedRasterBackface?Ni.backCW:Ni.frontCW,x.stencilModeFor3D()):Pt(xt,Ni.disabled,void 0),x.resetStencilClippingMasks()},"raster-particle":function(x,u,p,b,A,M){x.renderPass==="offscreen"&&function(P,O,B,G){if(!G.length)return;const j=P.context,X=j.gl,W=O.getSource();if(!(W instanceof Ga))return;const K=Math.ceil(Math.sqrt(B.paint.get("raster-particle-count")));let tt=B.particlePositionRGBAImage;if(!tt||tt.width!==K){const xt=function(vt){const Pt=vt*vt,wt=new Uint8Array(4*Pt),Rt=function(At){return At|=0,At=Math.imul(2747636419^At,2654435769),At=Math.imul(At^At>>>16,2654435769),((At=Math.imul(At^At>>>16,2654435769))>>>0)/4294967296},Mt=1/1.1;for(let At=0;At<Pt;At++){const kt=Mt*(Rt(2*At+0)+Vh),qt=Mt*(Rt(2*At+1)+Vh),jt=255*kt%1,oe=255*qt%1,te=jt,fe=qt-oe/255,ze=oe;wt[4*At+0]=255*(kt-jt/255),wt[4*At+1]=255*te,wt[4*At+2]=255*fe,wt[4*At+3]=255*ze}return wt}(K);tt=B.particlePositionRGBAImage=new a.q({width:K,height:K},xt)}let rt=B.particleFramebuffer;rt?rt.width!==K&&(rt.destroy(),rt=B.particleFramebuffer=j.createFramebuffer(K,K,!0,null)):rt=B.particleFramebuffer=j.createFramebuffer(K,K,!0,null);const ht=[];for(const xt of G){const vt=O.getTile(xt);if(!(vt instanceof Ac))continue;const Pt=jx(vt,W,B);if(!Pt)continue;const wt=[vt.tileSize,vt.tileSize];let Rt=B.tileFramebuffer;Rt||(Rt=B.tileFramebuffer=j.createFramebuffer(wt[0],wt[1],!0,null));let Mt=vt.rasterParticleState;Mt||(Mt=vt.rasterParticleState=new Ts(j,xt,wt,tt));const At=Mt.update(B.lastInvalidatedAt);Mt.particleTextureDimension!==K&&Mt.updateParticleTexture(xt,tt);const kt=Mt.targetColorTexture;Mt.targetColorTexture=Mt.backgroundColorTexture,Mt.backgroundColorTexture=kt;const qt=Mt.particleTexture0;Mt.particleTexture0=Mt.particleTexture1,Mt.particleTexture1=qt,ht.push([xt,Pt,Mt,At])}if(ht.length===0)return;const st=a.o.now(),gt=B.previousDrawTimestamp?.001*(st-B.previousDrawTimestamp):.0167;if(B.previousDrawTimestamp=st,B.hasColorMap()){j.activeTexture.set(X.TEXTURE0+2);let xt=B.colorRampTexture;xt||(xt=B.colorRampTexture=new a.T(j,B.colorRamp,X.RGBA8)),xt.bind(X.LINEAR,X.CLAMP_TO_EDGE)}j.bindFramebuffer.set(B.tileFramebuffer.framebuffer),function(xt,vt,Pt){const wt=xt.context,Rt=wt.gl,Mt=vt.tileFramebuffer;wt.activeTexture.set(Rt.TEXTURE0);const At={u_texture:0,u_opacity:1.05*(qt=vt.paint.get("raster-particle-fade-opacity-factor"))/(qt+.05)},kt=xt.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var qt;for(const jt of Pt){const[,,oe,te]=jt;Mt.colorAttachment.set(oe.targetColorTexture.texture),wt.viewport.set([0,0,Mt.width,Mt.height]),wt.clear({color:a.ao.transparent}),te&&(oe.backgroundColorTexture.bind(Rt.NEAREST,Rt.CLAMP_TO_EDGE),kt.draw(xt,Rt.TRIANGLES,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,At,vt.id,xt.viewportBuffer,xt.quadTriangleIndexBuffer,xt.viewportSegments))}}(P,B,ht),function(xt,vt,Pt,wt){const Rt=xt.context,Mt=Rt.gl,At=Pt.tileFramebuffer,kt=xt.transform.projection.name==="globe",qt=Pt.paint.get("raster-particle-max-speed");for(const jt of wt){const[oe,te,fe]=jt;Rt.activeTexture.set(Mt.TEXTURE0+0),te.texture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE),At.colorAttachment.set(fe.targetColorTexture.texture);const ze=xt.getOrCreateProgram("rasterParticleDraw",{defines:te.defines,overrideFog:!1});Rt.activeTexture.set(Mt.TEXTURE0+1);const Qt=te.scalarData?[]:[0,1,2,3].map(ee=>a.e8[ee](oe));Qt.push(oe);const Gt=oe.canonical.x,pe=oe.canonical.y;for(const ee of Qt){const Ae=vt.getTile(kt?ee.wrapped():ee);if(!Ae)continue;const Ge=Ae.rasterParticleState;if(!Ge)continue;const ui=ee.canonical.x+(1<<ee.canonical.z)*(ee.wrap-oe.wrap),Le=ee.canonical.y;Ge.particleTexture0.bind(Mt.NEAREST,Mt.CLAMP_TO_EDGE);const Fe=Ox(1,Ge.particleTexture0.size[0],[ui-Gt,Le-pe],0,te.texture.size,2,qt,te.textureOffset,te.scale,te.offset);ze.draw(xt,Mt.POINTS,fi.disabled,$i.disabled,lr.alphaBlended,Ni.disabled,Fe,Pt.id,Ge.particleIndexBuffer,void 0,Ge.particleSegment)}}}(P,O,B,ht),j.bindFramebuffer.set(B.particleFramebuffer.framebuffer),function(xt,vt,Pt,wt){const Rt=xt.context,Mt=Rt.gl,At=vt.paint.get("raster-particle-max-speed"),kt=wt*vt.paint.get("raster-particle-speed-factor")*.15,qt=function(oe){return Math.pow(oe,6)}(.01+1*vt.paint.get("raster-particle-reset-rate-factor")),jt=vt.particleFramebuffer;Rt.viewport.set([0,0,jt.width,jt.height]);for(const oe of Pt){const[,te,fe]=oe;Rt.activeTexture.set(Mt.TEXTURE0+0),te.texture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE),Rt.activeTexture.set(Mt.TEXTURE0+1);const ze=fe.particleTexture0;ze.bind(Mt.NEAREST,Mt.CLAMP_TO_EDGE);const Qt=m_(1,ze.size[0],0,te.texture.size,At,kt,qt,te.textureOffset,te.scale,te.offset);jt.colorAttachment.set(fe.particleTexture1.texture),Rt.clear({color:a.ao.transparent}),xt.getOrCreateProgram("rasterParticleUpdate",{defines:te.defines}).draw(xt,Mt.TRIANGLES,fi.disabled,$i.disabled,lr.unblended,Ni.disabled,Qt,vt.id,xt.viewportBuffer,xt.quadTriangleIndexBuffer,xt.viewportSegments)}}(P,B,ht,gt)}(x,u,p,b),x.renderPass==="translucent"&&(function(P,O,B,G,j){const X=P.context,W=X.gl,K=O.getSource().tileSize,tt=5*(1-a.ah(a.cK,a.cK+1,P.transform.zoom))*K+B.paint.get("raster-particle-elevation"),rt=!P.options.moving,ht=P.transform.projection.name==="globe";if(!G.length)return;const[st,gt]=P.stencilConfigForOverlap(G),xt=[];ht&&xt.push("PROJECTION_GLOBE_VIEW");const vt=P.stencilModeFor3D();for(const Pt of gt){const wt=Pt.toUnwrapped(),Rt=O.getTile(Pt);if(!Rt.rasterParticleState)continue;const Mt=Rt.rasterParticleState,At=100;Rt.registerFadeDuration(At);const kt=O.findLoadedParent(Pt,0),qt=u_(Rt,kt,O,P.transform,At);let jt,oe;P.terrain&&P.terrain.prepareDrawTile(),X.activeTexture.set(W.TEXTURE0),Mt.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),X.activeTexture.set(W.TEXTURE1),kt&&kt.rasterParticleState?(kt.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),jt=Math.pow(2,kt.tileID.overscaledZ-Rt.tileID.overscaledZ),oe=[Rt.tileID.canonical.x*jt%1,Rt.tileID.canonical.y*jt%1]):Mt.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const te=ht?Float32Array.from(P.transform.expandedFarZProjMatrix):P.transform.calculateProjMatrix(wt,rt),fe=P.transform,ze=Jo(fe),Qt=a.dF(Pt.canonical),Gt=a.dG(Qt.getCenter().lat);let pe,ee,Ae,Ge,ui;ht?(pe=Float32Array.from(a.bj(a.dI(Pt.canonical))),ee=Float32Array.from(fe.globeMatrix),Ae=Float32Array.from(a.dE(fe)),Ge=[a.aF(fe.center.lng),a.aJ(fe.center.lat)],ui=Float32Array.from(a.dH(Pt.canonical,Qt,Gt,fe.worldSize/fe._pixelsPerMercatorPixel))):(pe=new Float32Array(16),ee=new Float32Array(9),Ae=new Float32Array(16),Ge=[0,0],ui=new Float32Array(9));const Le=Ec(te,pe,ee,Ae,ui,oe||[0,0],a.aj(P.transform.zoom),Ge,ze,jt||1,qt,tt),Fe=P.isTileAffectedByFog(Pt),hi=P.getOrCreateProgram("rasterParticle",{defines:xt,overrideFog:Fe});if(P.uploadCommonUniforms(X,hi,wt),ht){const ai=new fi(W.LEQUAL,fi.ReadOnly,P.depthRangeFor3D),ii=0,oi=P.globeSharedBuffers;if(oi){const[Di,mr,Ir]=oi.getGridBuffers(Gt,ii!==0);hi.draw(P,W.TRIANGLES,ai,vt,lr.alphaBlended,P.renderElevatedRasterBackface?Ni.frontCCW:Ni.backCCW,Le,B.id,Di,mr,Ir)}}else{const ai=P.depthModeForSublayer(0,fi.ReadOnly),ii=st[Pt.overscaledZ],{tileBoundsBuffer:oi,tileBoundsIndexBuffer:Di,tileBoundsSegments:mr}=P.getTileBoundsBuffers(Rt);hi.draw(P,W.TRIANGLES,ai,ii,lr.alphaBlended,Ni.disabled,Le,B.id,oi,Di,mr)}}P.resetStencilClippingMasks()}(x,u,p,b),x.style.map.triggerRepaint())},background:function(x,u,p,b){const A=p.paint.get("background-color"),M=p.paint.get("background-color-use-theme").constantOr("default")==="none",P=p.paint.get("background-opacity"),O=p.paint.get("background-emissive-strength"),B=p.paint.get("background-pitch-alignment")==="viewport";if(P===0)return;const G=x.context,j=G.gl,X=x.transform,W=X.tileSize,K=p.paint.get("background-pattern");let tt;if(K!==void 0&&(K===null||(tt=x.imageManager.getPattern(a.I.from(K.toString()),p.scope,x.style.getLut(p.scope)),!tt)))return;const rt=!K&&A.a===1&&P===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==rt)return;const ht=$i.disabled,st=x.depthModeForSublayer(0,rt==="opaque"?fi.ReadWrite:fi.ReadOnly),gt=x.colorModeForDrapableLayerRenderPass(O),xt=K?"backgroundPattern":"background";let vt,Pt=b;if(Pt||(vt=x.getBackgroundTiles(),Pt=Object.values(vt).map(wt=>wt.tileID)),K&&(G.activeTexture.set(j.TEXTURE0),x.imageManager.bind(x.context,p.scope)),B){const wt=x.getOrCreateProgram(xt,{overrideFog:!1,overrideRtt:!0}),Rt=new Float32Array(a.bz([])),Mt=new a.aP(0,0,0,0,0),At=K?__(Rt,O,P,x,0,p.scope,tt,B,{tileID:Mt,tileSize:W}):v_(Rt,O,P,A.toPremultipliedRenderColor(M?null:p.lut));wt.draw(x,j.TRIANGLES,st,ht,gt,Ni.disabled,At,p.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments)}else for(const wt of Pt){const Rt=x.isTileAffectedByFog(wt),Mt=x.getOrCreateProgram(xt,{overrideFog:Rt}),At=wt.toUnwrapped(),kt=b?wt.projMatrix:x.transform.calculateProjMatrix(At);x.prepareDrawTile();const qt=u?u.getTile(wt):vt?vt[wt.key]:new su(wt,W,X.zoom,x),jt=K?__(kt,O,P,x,0,p.scope,tt,B,{tileID:wt,tileSize:W}):v_(kt,O,P,A.toPremultipliedRenderColor(M?null:p.lut));x.uploadCommonUniforms(G,Mt,At);const{tileBoundsBuffer:oe,tileBoundsIndexBuffer:te,tileBoundsSegments:fe}=x.getTileBoundsBuffers(qt);Mt.draw(x,j.TRIANGLES,st,ht,gt,Ni.disabled,jt,p.id,oe,te,fe)}},sky:function(x,u,p){const b=x._atmosphere?a.aj(x.transform.zoom):1,A=p.paint.get("sky-opacity")*b;if(A===0)return;const M=x.context,P=p.paint.get("sky-type"),O=new fi(M.gl.LEQUAL,fi.ReadOnly,[0,1]),B=x.frameCounter/1e3%1;P==="atmosphere"?x.renderPass==="offscreen"?p.needsSkyboxCapture(x)&&(function(G,j,X,W){const K=G.context,tt=K.gl;let rt=j.skyboxFbo;if(!rt){rt=j.skyboxFbo=K.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new Xx(K),j.skyboxTexture=K.gl.createTexture(),tt.bindTexture(tt.TEXTURE_CUBE_MAP,j.skyboxTexture),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_WRAP_S,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_WRAP_T,tt.CLAMP_TO_EDGE),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_MIN_FILTER,tt.LINEAR),tt.texParameteri(tt.TEXTURE_CUBE_MAP,tt.TEXTURE_MAG_FILTER,tt.LINEAR);for(let xt=0;xt<6;++xt)tt.texImage2D(tt.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,tt.RGBA,32,32,0,tt.RGBA,tt.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(rt.framebuffer),K.viewport.set([0,0,32,32]);const ht=j.getCenter(G,!0),st=G.getOrCreateProgram("skyboxCapture"),gt=new Float64Array(16);a.bz(gt),a.em(gt,gt,.5*-Math.PI),Tl(G,j,st,gt,ht,0),a.bz(gt),a.em(gt,gt,.5*Math.PI),Tl(G,j,st,gt,ht,1),a.bz(gt),a.cT(gt,gt,.5*-Math.PI),Tl(G,j,st,gt,ht,2),a.bz(gt),a.cT(gt,gt,.5*Math.PI),Tl(G,j,st,gt,ht,3),a.bz(gt),Tl(G,j,st,gt,ht,4),a.bz(gt),a.em(gt,gt,Math.PI),Tl(G,j,st,gt,ht,5),K.viewport.set([0,0,G.width,G.height])}(x,p),p.markSkyboxValid(x)):x.renderPass==="sky"&&function(G,j,X,W,K){const tt=G.context,rt=tt.gl,ht=G.transform,st=G.getOrCreateProgram("skybox");tt.activeTexture.set(rt.TEXTURE0),rt.bindTexture(rt.TEXTURE_CUBE_MAP,j.skyboxTexture);const gt=((xt,vt,Pt,wt,Rt)=>({u_matrix:xt,u_sun_direction:vt,u_cubemap:0,u_opacity:wt,u_temporal_offset:Rt}))(ht.skyboxMatrix,j.getCenter(G,!1),0,W,K);G.uploadCommonUniforms(tt,st),st.draw(G,rt.TRIANGLES,X,$i.disabled,G.colorModeForRenderPass(),Ni.backCW,gt,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(x,p,O,A,B):P==="gradient"&&x.renderPass==="sky"&&function(G,j,X,W,K){const tt=G.context,rt=tt.gl,ht=G.transform,st=G.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Xx(tt)),tt.activeTexture.set(rt.TEXTURE0);let gt=j.colorRampTexture;gt||(gt=j.colorRampTexture=new a.T(tt,j.colorRamp,rt.RGBA8)),gt.bind(rt.LINEAR,rt.CLAMP_TO_EDGE);const xt=((vt,Pt,wt,Rt,Mt)=>({u_matrix:vt,u_color_ramp:0,u_center_direction:Pt,u_radius:a.an(wt),u_opacity:Rt,u_temporal_offset:Mt}))(ht.skyboxMatrix,j.getCenter(G,!1),j.paint.get("sky-gradient-radius"),W,K);G.uploadCommonUniforms(tt,st),st.draw(G,rt.TRIANGLES,X,$i.disabled,G.colorModeForRenderPass(),Ni.backCW,xt,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(x,p,O,A,B)},custom:function(x,u,p,b){const A=x.context,M=p.implementation;if(!x.transform.projection.unsupportedLayers||!x.transform.projection.unsupportedLayers.includes("custom")||x.terrain&&(x.terrain.renderingToTexture||x.renderPass==="offscreen")&&p.isDraped(u)){if(x.renderPass==="offscreen"){const P=M.prerender;if(P){if(x.setCustomLayerDefaults(),A.setColorMode(x.colorModeForRenderPass()),x.transform.projection.name==="globe"){const O=x.transform.pointMerc;P.call(M,A.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),a.aj(x.transform.zoom),[O.x,O.y],x.transform.pixelsPerMeterRatio)}else P.call(M,A.gl,x.transform.customLayerMatrix());A.setDirty(),x.setBaseState()}}else if(x.renderPass==="translucent"){if(x.terrain&&x.terrain.renderingToTexture){const O=M.renderToTile;if(O){const B=b[0].canonical,G={x:B.x+b[0].wrap*(M.wrapTileId?0:1<<B.z),y:B.y,z:B.z};A.setDepthMode(fi.disabled),A.setStencilMode($i.disabled),A.setColorMode(x.colorModeForRenderPass()),x.setCustomLayerDefaults(),O.call(M,A.gl,G),A.setDirty(),x.setBaseState()}return}x.setCustomLayerDefaults(),A.setColorMode(x.colorModeForRenderPass()),A.setStencilMode($i.disabled);const P=M.renderingMode==="3d"?new fi(x.context.gl.LEQUAL,fi.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,fi.ReadOnly);if(A.setDepthMode(P),x.transform.projection.name==="globe"){const O=x.transform.pointMerc;M.render(A.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),a.aj(x.transform.zoom),[O.x,O.y],x.transform.pixelsPerMeterRatio)}else M.render(A.gl,x.transform.customLayerMatrix());A.setDirty(),x.setBaseState(),A.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(x,u,p,b){if(x.renderPass==="opaque")return;const A=p.paint.get("model-opacity").constantOr(1),M=p.paint.get("model-elevation-reference"),P=M==="ground",O=M==="ground";if(A===0)return;const B=p.paint.get("model-cast-shadows");if(x.renderPass==="shadow"&&(!B||x.terrain&&A<.65&&p._transitionablePaint._values["model-opacity"].value.expression instanceof a.ad))return;const G=x.shadowRenderer,j=p.paint.get("model-receive-shadows");G&&(G.useNormalOffset=!0,j||(G.enabled=!1));const X=()=>{G&&(G.useNormalOffset=!0,j||(G.enabled=!0))},W=u.getSource();if(x.renderPass==="light-beam"&&W.type!=="batched-model")return;if(W.type==="vector"||W.type==="geojson")return function(vt,Pt,wt,Rt,Mt){const At=vt.transform,kt=At.projection.name==="globe",qt=At.getFreeCameraOptions().position;if(!vt.modelManager)return;const jt=vt.modelManager;wt.modelManager=jt;const oe=vt.shadowRenderer;if(!wt._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const te=wt._unevaluatedLayout._values["model-id"],fe=Object.assign({},wt.layout.get("model-id").parameters),ze=vt.style.order.indexOf(wt.fqid);for(const Qt of Rt){const Gt=Pt.getTile(Qt).getBucket(wt);if(!Gt||Gt.projection.name!==At.projection.name)continue;const pe=Gt.getModelUris();if(pe&&!Gt.modelsRequested&&(jt.addModelsFromBucket(pe,Mt),Gt.modelsRequested=!0),kt)fe.zoom=Qt.overscaledZ;else{const ai=Kx(Qt,At);fe.zoom=ai}const ee=te.possiblyEvaluate(fe);if(RT(vt,Gt,Qt),Zs.shadowUniformsInitialized=!1,Zs.useSingleShadowCascade=!!oe&&oe.getMaxCascadeForTile(Qt.toUnwrapped())===0,vt.renderPass==="shadow"&&oe){if(vt.currentShadowCascade===1&&Gt.isInsideFirstShadowMapFrustum)continue;const ai=At.calculatePosMatrix(Qt.toUnwrapped(),At.worldSize);if(Zs.tileMatrix.set(ai),Zs.shadowTileMatrix=Float32Array.from(oe.calculateShadowPassMatrixFromMatrix(ai)),Zs.aabb.min=[0,0,0],Zs.aabb.max[0]=Zs.aabb.max[1]=a.al,Zs.aabb.max[2]=0,E_(Gt,Zs,vt,wt.scope))continue}const Ae=1<<Qt.canonical.z,Ge=[((qt.x-Qt.wrap)*Ae-Qt.canonical.x)*a.al,(qt.y*Ae-Qt.canonical.y)*a.al,qt.z*Ae*a.al];vt.conflationActive&&Object.keys(Gt.instancesPerModel).length>0&&vt.style.isLayerClipped(wt,Pt.getSource())&&Gt.updateReplacement(Qt,vt.replacementSource,ze,Mt)&&(Gt.uploaded=!1,Gt.upload(vt.context));let ui=0;const Le=new Array,Fe=new Array,hi=new Array;for(let ai in Gt.instancesPerModel){const ii=Gt.instancesPerModel[ai];ii.features.length>0&&!kt&&(ai=ee.evaluate(ii.features[0].feature,{}));const oi=jt.getModel(ai,Mt);if(oi||jt.hasURLBeenRequested(ai)||Gt.modelUris.includes(ai)||(Gt.modelUris.push(ai),Gt.modelsRequested=!1),oi&&oi.uploaded)if(kt){const Di=a.c4([],[qt.x,qt.y,qt.z],vt.transform.worldSize);a.ev(Di,Di);for(let mr=0;mr<ii.instancedDataArray.length;++mr){const Ir=[0,0,0],an=[1,1,1],Vi=a.ew(),Tr=ii.tileCoordinatesForInstance(mr),ir=ii.transformForInstance(mr);a.ex(an,ir),a.ey(Vi,ir),a.ez(Ir,Vi);const Qr=ii.translationForInstance(mr),Cr=new a.aS(0,0);a.eA(Gt.canonical,Cr,Tr.x,Tr.y);const pn=a.bB();a.eB(pn,oi,vt.transform,Cr,Ir,an,Qr,!0,!1,!1);const Or=ii.colorForInstance(mr),ar=a.bz([]),Gr=a.ee(Cr.lat,vt.transform.zoom),ur=a.bp([],[1,1,1/Gr]);a.bq(ar,ar,Di),hi.push({zScaleMatrix:ur,negCameraPosMatrix:ar});for(const wn of oi.nodes)M_(vt,wn,pn,vt.transform.expandedFarZProjMatrix,ui,Le,Fe,oi.materialOverrides,Or);++ui}}else for(const Di of oi.nodes)Jx(vt,wt,Di,ii,Ge,Qt,Zs)}if(kt)if(vt.renderPass==="shadow"){for(const ai of Fe)xf(ai.mesh,ai.nodeModelMatrix,vt,wt);for(const ai of Le)xf(ai.mesh,ai.nodeModelMatrix,vt,wt)}else LT(vt,wt,1,Le,Fe,hi)}}(x,u,p,b,C_(W,p,x.style._importedAsBasemap)),void X();if(!W.loaded())return;if(W.type==="batched-model")return function(vt,Pt,wt,Rt){wt.resetLayerRenderingStats(vt);const Mt=vt.context,At=vt.transform,kt=vt.style.fog,qt=vt.shadowRenderer;if(At.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${At.projection.name} projection is not yet implemented`);const jt=vt.transform.getFreeCameraOptions().position,oe=a.c4([],[jt.x,jt.y,jt.z],vt.transform.worldSize),te=a.ev([],oe),fe=a.bz([]),ze=a.ee(At.center.lat,At.zoom),Qt=a.bp([],[1,1,1/ze]);a.bq(fe,fe,te);const Gt=wt.paint.get("model-opacity").constantOr(1),pe=new fi(Mt.gl.LEQUAL,fi.ReadWrite,vt.depthRangeFor3D),ee=new fi(Mt.gl.LEQUAL,fi.ReadOnly,vt.depthRangeFor3D),Ae=new a.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ge=vt.renderPass==="shadow",ui=Ge&&qt?qt.getCurrentCascadeFrustum():At.getFrustum(At.scaleZoom(At.worldSize)),Le=wt.paint.get("model-front-cutoff"),Fe=Le[2]<1,hi=ju(vt,wt.paint.get("model-cutoff-fade-range")),ai=wt.getLayerRenderingStats();(function(ii,oi,Di,mr){const Ir=ii.terrain?ii.terrain.exaggeration():0,an=ii.transform.zoom;for(const Vi of mr){const Tr=oi.getTile(Vi).getBucket(Di);Tr&&(Tr.setFilter(Di.filter),ii.conflationActive&&Tr.updateReplacement(Vi,ii.replacementSource),Tr.evaluateTransform(ii,Di),ii.terrain&&Ir>0&&Tr.elevationUpdate(ii.terrain,Ir,Vi,Di.source),Tr.needsReEvaluation(ii,an,Di)&&Tr.evaluate(Di))}})(vt,Pt,wt,Rt),function(){let ii,oi,Di;Fe?(ii=Rt.length-1,oi=-1,Di=-1):(ii=0,oi=Rt.length,Di=1);const mr=new Float64Array(16),Ir=a.cz(),an=new a.P(0,0);for(let Vi=ii;Vi!==oi;Vi+=Di){const Tr=Rt[Vi],ir=Pt.getTile(Tr).getBucket(wt);if(!ir||!ir.uploaded)continue;let Qr=!1;qt&&(Qr=qt.getMaxCascadeForTile(Tr.toUnwrapped())===0);const Cr=At.calculatePosMatrix(Tr.toUnwrapped(),At.worldSize),pn=ir.modelTraits;!Ge&&Fe&&(a.bk(mr,Cr),a.af(Ir,oe,mr),an.x=Ir[0],an.y=Ir[1]);const Or=[];ir.setFilter(wt.filter);for(const ar of ir.getNodesInfo()){if(ar.hiddenByReplacement||!ar.node.meshes)continue;const Gr=ar.node;let ur=0;vt.terrain&&Gr.elevation&&(ur=Gr.elevation*vt.terrain.exaggeration());const wn=(()=>{const Eo=ar.aabb;return Ae.min=[...Eo.min],Ae.max=[...Eo.max],Ae.min[2]+=ur,Ae.max[2]+=ur,a.af(Ae.min,Ae.min,Cr),a.af(Ae.max,Ae.max,Cr),Ae})(),Zr=ar.evaluatedScale;if(Zr[0]<=1&&Zr[1]<=1&&Zr[2]<=1&&wn.intersects(ui)===0)continue;if(!Ge&&Fe){const Eo=.16666666666666666;ar.cameraCollisionOpacity=oe[0]>wn.min[0]&&oe[0]<wn.max[0]&&oe[1]>wn.min[1]&&oe[1]<wn.max[1]&&oe[2]*ze<wn.max[2]&&Gr.footprint&&a.b$(an,Gr.footprint)?Math.max(ar.cameraCollisionOpacity-Eo,0):Math.min(1,ar.cameraCollisionOpacity+Eo)}const Hi=[...Cr],Dr=1/a.d6(Tr.canonical),Bn=Gr.anchor?Gr.anchor[0]:0,ra=Gr.anchor?Gr.anchor[1]:0;a.bq(Hi,Hi,[Bn*(Zr[0]-1)+ar.evaluatedTranslation[0]*Dr,ra*(Zr[1]-1)+ar.evaluatedTranslation[1]*Dr,ur+ar.evaluatedTranslation[2]]),a.cp(Zr,a.eD)||a.cR(Hi,Hi,Zr);const Gn=a.aB([],Hi,Gr.globalMatrix),Jn=a.aB([],At.expandedFarZProjMatrix,Gn),fs=a.aB([],At.expandedFarZProjMatrix,Hi),Qo=a.aC([],[Bn,ra,ur,1],Jn)[2];Gr.hidden=!1;let po=Gt;Ge||(Fe&&(po*=ar.cameraCollisionOpacity,po*=Hh(Hi,At,ar.aabb,Le)),po*=Lg(hi,Qo)),po!==0?Or.push({nodeInfo:ar,depth:Qo,opacity:po,wvpForNode:Jn,wvpForTile:fs,nodeModelMatrix:Gn,tileModelMatrix:Hi}):Gr.hidden=!0}Ge||Or.sort((ar,Gr)=>!Fe||ar.opacity===1&&Gr.opacity===1?ar.depth<Gr.depth?-1:1:ar.opacity===1?-1:Gr.opacity===1?1:ar.depth>Gr.depth?-1:1);for(const ar of Or){const Gr=ar.nodeInfo,ur=Gr.node;let wn=a.aB([],Qt,ar.tileModelMatrix);a.aB(wn,fe,wn);const Zr=a.bk([],wn);a.ef(Zr,Zr),a.cR(Zr,Zr,kT),wn=a.aB(wn,wn,ur.globalMatrix);const Hi=vt.renderPass==="light-beam",Dr=wt.paint.get("model-color-use-theme").constantOr("default")==="none",Bn=pn&a.eH.HasMapboxMeshFeatures,ra=Bn?0:Gr.evaluatedRMEA[0][2];for(let Gn=0;Gn<ur.meshes.length;++Gn){const Jn=ur.meshes[Gn],fs=Gn===ur.lightMeshIndex;let Qo=ar.wvpForNode;if(fs){if(!Hi&&!vt.terrain&&vt.shadowRenderer){vt.currentLayer<vt.firstLightBeamLayer&&(vt.firstLightBeamLayer=vt.currentLayer);continue}Qo=ar.wvpForTile}else if(Hi)continue;const po={defines:[]},Eo=[];if(!Ge&&qt&&(qt.useNormalOffset=!!Jn.normalBuffer),_f(po.defines,Eo,Jn,vt,Dr?null:wt.lut),Bn||po.defines.push("DIFFUSE_SHADED"),Qr&&po.defines.push("SHADOWS_SINGLE_CASCADE"),ai&&(Ge?ai.numRenderedVerticesInShadowPass+=Jn.vertexArray.length:ai.numRenderedVerticesInTransparentPass+=Jn.vertexArray.length),Ge){xf(Jn,ar.nodeModelMatrix,vt,wt);continue}let Xs=null;if(kt){const na=Yx(ar.nodeModelMatrix,vt.transform);if(Xs=new Float32Array(na),At.projection.name!=="globe"){const hn=Jn.aabb.min,la=Jn.aabb.max,[Xa,Zn]=kt.getOpacityForBounds(na,hn[0],hn[1],la[0],la[1]);po.overrideFog=Xa>=ie||Zn>=ie}}const go=Jn.material;let Ys;go.occlusionTexture&&go.occlusionTexture.offsetScale&&(Ys=go.occlusionTexture.offsetScale,po.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Cl=vt.getOrCreateProgram("model",po);!Ge&&qt&&qt.setupShadowsFromMatrix(ar.tileModelMatrix,Cl,qt.useNormalOffset),vt.uploadCommonUniforms(Mt,Cl,null,Xs);const qa=go.pbrMetallicRoughness;qa.metallicFactor=.9,qa.roughnessFactor=.5;const $n=y_(new Float32Array(Qo),new Float32Array(wn),new Float32Array(Zr),new Float32Array(ur.globalMatrix),vt,ar.opacity,qa.baseColorFactor,go.emissiveFactor,qa.metallicFactor,qa.roughnessFactor,go,ra,wt,[0,0,0],Ys);!fs&&(Gr.hasTranslucentParts||ar.opacity<1)&&Cl.draw(vt,Mt.gl.TRIANGLES,pe,$i.disabled,lr.disabled,Ni.backCCW,$n,wt.id,Jn.vertexBuffer,Jn.indexBuffer,Jn.segments,wt.paint,vt.transform.zoom,void 0,Eo),Cl.draw(vt,Mt.gl.TRIANGLES,fs?ee:pe,$i.disabled,fs||ar.opacity<1||Gr.hasTranslucentParts?lr.alphaBlended:lr.unblended,Ni.backCCW,$n,wt.id,Jn.vertexBuffer,Jn.indexBuffer,Jn.segments,wt.paint,vt.transform.zoom,void 0,Eo)}}}}()}(x,u,p,b),void X();if(W.type!=="model")return;const K=W.getModels(),tt=[],rt=x.transform.getFreeCameraOptions().position,ht=a.c4([],[rt.x,rt.y,rt.z],x.transform.worldSize);a.ev(ht,ht);const st=[],gt=[];let xt=0;for(const vt of K){const Pt=u.getFeatureState("",vt.id),wt={type:"Unknown",id:vt.id,properties:vt.featureProperties},Rt=p.paint.get("model-rotation").evaluate(wt,Pt),Mt=p.paint.get("model-scale").evaluate(wt,Pt),At=p.paint.get("model-translation").evaluate(wt,Pt);bf(p,vt.id,Pt,vt.featureProperties,vt.nodeOverrideNames,vt.nodeOverrides),lD(p,vt.id,Pt,vt.featureProperties,vt.materialOverrideNames,vt.materialOverrides),vt.nodeOverrides.size>0&&vt.computeBoundsAndApplyParent(),vt.computeModelMatrix(x,Rt,Mt,At,O,P,!1);const kt=a.bz([]),qt=a.ee(vt.position.lat,x.transform.zoom),jt=a.bp([],[1,1,1/qt]);a.bq(kt,kt,ht),tt.push({zScaleMatrix:jt,negCameraPosMatrix:kt});for(const oe of vt.nodes)M_(x,oe,vt.matrix,x.transform.expandedFarZProjMatrix,xt,st,gt,vt.materialOverrides);xt++}if(st.sort((vt,Pt)=>Pt.depth-vt.depth),x.renderPass!=="shadow")LT(x,p,A,st,gt,tt),X();else{for(const vt of gt)xf(vt.mesh,vt.nodeModelMatrix,x,p);for(const vt of st)xf(vt.mesh,vt.nodeModelMatrix,x,p);X()}}},D_={line:function(x,u,p){if(x.hasElevatedBuckets=!1,x.hasNonElevatedBuckets=!1,x._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||x._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(u){const b=u.getVisibleCoordinates();for(const A of b){const M=u.getTile(A).getBucket(x);if(M&&(M.elevationType!=="none"?x.hasElevatedBuckets=!0:x.hasNonElevatedBuckets=!0,x.hasElevatedBuckets&&x.hasNonElevatedBuckets))break}}}else x.hasNonElevatedBuckets=!0},model:function(x,u,p){const b=u.getSource();if(!b.loaded())return;if(b.type==="vector"||b.type==="geojson"){const M=C_(b,x,p.style._importedAsBasemap);return void(p.modelManager&&p.modelManager.upload(p,M))}if(b.type==="batched-model"||b.type!=="model")return;const A=b.getModels();for(const M of A)M.upload(p.context)},raster:function(x,u,p){const b=u.getSource();if(!(b instanceof Ga&&b.loaded()))return;const A=x.sourceLayer||b.rasterLayerIds&&b.rasterLayerIds[0];if(!A)return;const M=x.paint.get("raster-array-band")||b.getInitialBand(A);if(M==null)return;const P=u.getIds().map(O=>u.getTileByID(O));for(const O of P)O.updateNeeded(x.id,M)&&b.prepareTile(O,A,x.id,M)},"raster-particle":function(x,u,p){const b=u.getSource();if(!(b instanceof Ga&&b.loaded()))return;const A=x.sourceLayer||b.rasterLayerIds&&b.rasterLayerIds[0];if(!A)return;const M=x.paint.get("raster-particle-array-band")||b.getInitialBand(A);if(M==null)return;const P=u.getIds().map(O=>u.getTileByID(O));for(const O of P)O.updateNeeded(x.id,M)&&b.prepareTile(O,A,x.id,M)}},P_={fill:Uh},qs={fill:function(x,u,p,b){if(!p.layout||p.layout.get("fill-elevation-reference")==="none"||p.paint.get("fill-opacity").constantOr(1)===0)return;const A=x.context.gl,M=new fi(A.LEQUAL,fi.ReadOnly,x.depthRangeFor3D),P=new $i({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),O=x.transform.getFreeCameraOptions().position,B=x.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const G of b){const j=u.getTile(G),X=j.getBucket(p);if(!X)continue;const W=X.elevatedStructures;if(!W||W.depthSegments.segments[0].primitiveLength===0)continue;const K=IT(G.toUnwrapped(),O),tt=x.translatePosMatrix(G.projMatrix,j,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor")),rt=f_(tt,K,0,1,0);B.draw(x,A.TRIANGLES,M,P,lr.disabled,Ni.disabled,rt,p.id,W.vertexBuffer,W.indexBuffer,W.depthSegments,p.paint,x.transform.zoom)}}};class Oc{constructor(u,p,b,A,M,P){this.context=new b_(u,p),this.transform=b,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=M,this._timeStamp=a.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const O=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of O)this._debugParams.enabledLayers[G]=!0;M.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),M.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),M.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),M.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const G of O)M.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],G);this.occlusionParams=new uD(M),this.setup(),this.numSublayers=_l.maxUnderzooming+_l.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vg(this),this._wireframeDebugCache=new zT,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const B=new a.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,B,u.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=A,this.worldview=P}updateTerrain(u,p){const b=!!u&&!!u.terrain&&this.transform.projection.supportsTerrain;if(!(b||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ig(this,u));const A=this._terrain;this.transform.elevation=b?A:null,A.update(u,this.transform,p),this.transform.elevation&&!A.enabled&&(this.transform.elevation=null)}_updateFog(u){const p=u.fog;if(!p||this.transform.projection.name==="globe"||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[b,A]=p.getFovAdjustedRange(this.transform._fov);if(b>A)return void(this.transform.fogCullDistSq=null);const M=b+.78*(A-b);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(u){u&&!this._terrain&&(this._terrain=new Ig(this,this.style)),this._forceTerrainMode=u}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(u,p){if(this.width=u*a.o.devicePixelRatio,this.height=p*a.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style.order)this.style._mergedLayers[b].resize()}setup(){const u=this.context,p=new a.bc;p.emplaceBack(0,0),p.emplaceBack(a.al,0),p.emplaceBack(0,a.al),p.emplaceBack(a.al,a.al),this.tileExtentBuffer=u.createVertexBuffer(p,a.be.members),this.tileExtentSegments=a.bf.simpleSegment(0,0,4,2);const b=new a.bc;b.emplaceBack(0,0),b.emplaceBack(a.al,0),b.emplaceBack(0,a.al),b.emplaceBack(a.al,a.al),this.debugBuffer=u.createVertexBuffer(b,a.be.members),this.debugSegments=a.bf.simpleSegment(0,0,4,5);const A=new a.bc;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(-1,1),A.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(A,a.be.members),this.viewportSegments=a.bf.simpleSegment(0,0,4,2);const M=new a.a$;M.emplaceBack(0,0,0,0),M.emplaceBack(a.al,0,a.al,0),M.emplaceBack(0,a.al,0,a.al),M.emplaceBack(a.al,a.al,a.al,a.al),this.mercatorBoundsBuffer=u.createVertexBuffer(M,a.bh.members),this.mercatorBoundsSegments=a.bf.simpleSegment(0,0,4,2);const P=new a.b0;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(P);const O=new a.bd;for(const G of[0,1,3,2,0])O.emplaceBack(G);this.debugIndexBuffer=u.createIndexBuffer(O),this.emptyTexture=new a.T(u,new a.q({width:1,height:1},Uint8Array.of(0,0,0,0)),u.gl.RGBA8),this.identityMat=a.bB();const B=this.context.gl;this.stencilClearMode=new $i({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(u){return u._makeTileBoundsBuffers(this.context,this.transform.projection),u._tileBoundsBuffer?{tileBoundsBuffer:u._tileBoundsBuffer,tileBoundsIndexBuffer:u._tileBoundsIndexBuffer,tileBoundsSegments:u._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const u=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,u.TRIANGLES,fi.disabled,this.stencilClearMode,lr.disabled,Ni.disabled,Nh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(u,p,b){if(!p||this.currentStencilSource===p.id||!u.isTileClipped()||!b||b.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const B of b)if(this._tileClippingMaskIDs[B.key]===void 0){O=!0;break}if(!O)return}this.currentStencilSource=p.id;const A=this.context,M=A.gl;this.nextStencilID+b.length>256&&this.clearStencil(),A.setColorMode(lr.disabled),A.setDepthMode(fi.disabled);const P=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of b){const B=p.getTile(O),G=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=this.getTileBoundsBuffers(B);P.draw(this,M.TRIANGLES,fi.disabled,new $i({func:M.ALWAYS,mask:0},G,255,M.KEEP,M.KEEP,M.REPLACE),lr.disabled,Ni.disabled,Nh(O.projMatrix),"$clipping",j,X,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,p=this.context.gl;return new $i({func:p.NOTEQUAL,mask:255},u,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(u){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(u);const p=this.context.gl;return new $i({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(u){const p=this.context.gl,b=u.sort((P,O)=>O.overscaledZ-P.overscaledZ),A=b[b.length-1].overscaledZ,M=b[0].overscaledZ-A+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const P={};for(let O=0;O<M;O++)P[O+A]=new $i({func:p.GEQUAL,mask:255},O+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=M,[P,b]}return[{[A]:$i.disabled},b]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new lr([u.CONSTANT_COLOR,u.ONE,u.CONSTANT_COLOR,u.ONE],new a.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?lr.unblended:lr.alphaBlended}colorModeForDrapableLayerRenderPass(u){const p=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new lr([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.CONSTANT_ALPHA,p.ONE_MINUS_SRC_ALPHA],new a.ao(0,0,0,u===void 0?0:u),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(u,p,b,A=!1){if(this.depthOcclusion)return new fi(this.context.gl.GREATER,fi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!A)return fi.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new fi(b||this.context.gl.LEQUAL,p,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const u=this.context.gl,p=Math.ceil(this.width),b=Math.ceil(this.height),A=this.context.bindFramebuffer.get(),M=u.getParameter(u.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===p&&this.depthFBO.height===b||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),p!==0&&b!==0&&(this.depthFBO=new x_(this.context,p,b,!1,"texture"),this.depthTexture=new a.T(this.context,{width:p,height:b,data:null},u.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(A),u.bindTexture(u.TEXTURE_2D,M),this.depthFBO&&(u.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.bindFramebuffer(u.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),u.blitFramebuffer(0,0,p,b,0,0,p,b,u.DEPTH_BUFFER_BIT,u.NEAREST),u.bindFramebuffer(u.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((u,p)=>u+p/this._fpsHistory.length,0))}render(u,p){const b=a.o.now();this._dt=b-this._timeStamp,this._timeStamp=b,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=u.map.repaint,this.style=u,this.options=p;const A=this.style._mergedLayers,M=!(!this.terrain||!this.terrain.enabled),P=()=>this.style._getOrder(M).filter(Qt=>{const Gt=A[Qt];return!(Gt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Gt.type]});let O=P(),B=!1,G=!1,j=null;for(const Qt of O){const Gt=A[Qt];Gt.type==="circle"?B=!0:Gt.type==="building"?j=Gt:Gt.type==="symbol"&&(Gt.hasOcclusionOpacityProperties?G=!0:B=!0)}let X=O.map(Qt=>A[Qt]);const W=this.style._mergedSourceCaches;this.imageManager=u.imageManager,this.modelManager=u.modelManager,this.symbolFadeChange=u.placement.symbolFadeChange(a.o.now()),this.imageManager.beginFrame();let K=0,tt=!1;for(const Qt in W){const Gt=W[Qt];Gt.used&&(Gt.prepare(this.context),Gt.getSource().usedInConflation&&++K)}let rt=!1;for(const Qt of X)Qt.isHidden(this.transform.zoom)||(Qt.type==="clip"&&(rt=!0),this.prepareLayer(Qt));const ht={},st={},gt={},xt={},vt={};for(const Qt in W){const Gt=W[Qt];ht[Qt]=Gt.getVisibleCoordinates(),st[Qt]=ht[Qt].slice().reverse(),gt[Qt]=Gt.getVisibleCoordinates(!0).reverse(),xt[Qt]=Gt.getShadowCasterCoordinates(),vt[Qt]=Gt.sortCoordinatesByDistance(ht[Qt])}const Pt=Qt=>{const Gt=this.style.getLayerSourceCache(Qt);return Gt&&Gt.used?Gt.getSource():null};if(K||rt||this._clippingActiveLastFrame){const Qt=[],Gt=[];let pe=0;for(const ee of X)this.isSourceForClippingOrConflation(ee,Pt(ee))&&(Qt.push(ee),Gt.push(pe)),pe++;if(Qt&&(rt||Qt.length>1)||this._clippingActiveLastFrame){rt=!1;const ee=[];for(let Ae=0;Ae<Qt.length;Ae++){const Ge=Qt[Ae],ui=Gt[Ae],Le=this.style.getLayerSourceCache(Ge);if(!Le||!Le.used||!Le.getSource().usedInConflation&&Ge.type!=="clip"&&Ge.type!=="building")continue;let Fe=a.eP,hi=a.bZ.None;const ai=[];let ii=!0;if(Ge.type==="building")Fe=a.eR;else if(Ge.type==="clip"){Fe=ui;for(const oi of Ge.layout.get("clip-layer-types"))hi|=oi==="model"?a.bZ.Model:oi==="symbol"?a.bZ.Symbol:a.bZ.FillExtrusion;for(const oi of Ge.layout.get("clip-layer-scope"))ai.push(oi);Ge.isHidden(this.transform.zoom)?ii=!1:rt=!0}ii&&ee.push({layer:Ge.fqid,cache:Le,order:Fe,clipMask:hi,clipScope:ai})}this.replacementSource.setSources(ee),tt=!0}}this._clippingActiveLastFrame=rt,tt||this.replacementSource.clear(),this.conflationActive=tt,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Qt=0;Qt<X.length;Qt++){const Gt=X[Qt],pe=Gt.cutoffRange();if(this.longestCutoffRange=Math.max(pe,this.longestCutoffRange),pe>0){const ee=Pt(Gt);ee&&(this.minCutoffZoom=Math.max(ee.minzoom,this.minCutoffZoom)),Gt.minzoom&&(this.minCutoffZoom=Math.max(Gt.minzoom,this.minCutoffZoom))}Gt.is3D(M)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Qt),this._lastOcclusionLayer=Qt)}const wt=this.style&&this.style.fog;wt?(this._fogVisible=wt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=wt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(gt),this.opaquePassCutoff=0,O=P(),X=O.map(Qt=>A[Qt]));const Rt=this._shadowRenderer;if(Rt){Rt.updateShadowParameters(this.transform,this.style.directionalLight);for(const Qt in W)for(const Gt of ht[Qt]){let pe={min:0,max:0};this.terrain&&(pe=this.terrain.getMinMaxForTile(Gt)||pe),Rt.addShadowReceiver(Gt.toUnwrapped(),pe.min,pe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Kn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Mt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),At=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Mt&&!this._snow&&(this._snow=new t1(this)),!Mt&&this._snow&&(this._snow.destroy(),delete this._snow),At&&!this._rain&&(this._rain=new wf(this)),!At&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),j){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Yt);const Qt=this.style.getLayerSourceCache(j);this.buildingTileBorderManager.updateBorders(Qt,j)}if(!Bt.has(this.context.gl))return;this.renderPass="offscreen";for(const Qt of X){const Gt=u.getLayerSourceCache(Qt);if(!Qt.hasOffscreenPass()||Qt.isHidden(this.transform.zoom))continue;const pe=Gt?st[Gt.id]:void 0;(Qt.type==="custom"||Qt.type==="raster"||Qt.type==="raster-particle"||Qt.isSky()||pe&&pe.length)&&this.renderLayer(this,Gt,Qt,pe)}this.depthRangeFor3D=[0,1-(X.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,xt)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const kt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),qt=(()=>{if(p.showOverdrawInspector)return a.ao.black;const Qt=this.style.fog;if(Qt&&this.transform.projection.supportsFog){const Gt=this.style.getLut(Qt.scope);if(!kt){const pe=Qt.properties.get("color-use-theme")==="none",ee=Qt.properties.get("color").toNonPremultipliedRenderColor(pe?null:Gt).toArray01();return new a.ao(...ee)}if(kt){const pe=Qt.properties.get("space-color-use-theme")==="none",ee=Qt.properties.get("space-color").toNonPremultipliedRenderColor(pe?null:Gt).toArray01();return new a.ao(...ee)}}return a.ao.transparent})();if(this.context.clear({color:qt,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&kt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=O.length-1;this.currentLayer>=0;this.currentLayer--){const Qt=X[this.currentLayer],Gt=u.getLayerSourceCache(Qt);if(Qt.isSky())continue;const pe=Gt?(Qt.is3D(M)?vt:st)[Gt.id]:void 0;this._renderTileClippingMasks(Qt,Gt,pe),this.renderLayer(this,Gt,Qt,pe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&kt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<O.length;this.currentLayer++){const Qt=X[this.currentLayer],Gt=u.getLayerSourceCache(Qt);Qt.isSky()&&this.renderLayer(this,Gt,Qt,Gt?st[Gt.id]:void 0)}function jt(Qt,Gt){let pe;return Gt&&(pe=(Qt.type==="symbol"?gt:Qt.is3D(M)?vt:st)[Gt.id]),pe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<O.length;){const Qt=X[this.currentLayer];if(Qt.type==="raster"||Qt.type==="raster-particle"){const Gt=u.getLayerSourceCache(Qt);this.renderLayer(this,Gt,Qt,jt(Qt,Gt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let oe=0;Rt&&(oe=Rt.getShadowCastingLayerCount());let te=!1,fe=-1;for(let Qt=0;Qt<O.length;++Qt){const Gt=X[Qt];Gt.isHidden(this.transform.zoom)||Gt.is3D(M)&&(fe=Qt)}G&&fe===-1&&(B=!0);let ze=!1;for(;this.currentLayer<O.length;){const Qt=X[this.currentLayer],Gt=u.getLayerSourceCache(Qt);if(Qt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Qt)){if(Qt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ze&&Qt.is3D(M)&&!M){const pe=this.currentLayer,ee=Ae=>{for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const Ge=X[this.currentLayer];if(P_[Ge.type]){const ui=this.style.getLayerSourceCache(Ge);P_[Ge.type](this,ui,Ge,jt(Ge,ui),Ae)}}};ee("initialize"),ee("reset"),this.currentLayer=pe,ze=!0}if(B&&!te&&this.terrain&&!this.transform.isOrthographic&&(te=!0,this.blitDepth()),G&&fe!==-1&&this.currentLayer===fe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Qt,Gt,Gt?ht[Gt.id]:void 0),this.renderLayer(this,Gt,Qt,jt(Qt,Gt)),!this.terrain&&Rt&&oe>0&&Qt.hasShadowPass()&&--oe==0){{this.clearStencil(),this.resetStencilClippingMasks();const pe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<X.length;this.currentLayer++){const ee=X[this.currentLayer];if(qs[ee.type]){const Ae=this.style.getLayerSourceCache(ee);qs[ee.type](this,Ae,ee,jt(ee,Ae))}}this.currentLayer=pe}if(Rt.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const pe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=pe;this.currentLayer++){const ee=X[this.currentLayer];if(!ee.hasLightBeamPass())continue;const Ae=u.getLayerSourceCache(ee);this.renderLayer(this,Ae,ee,Ae?st[Ae.id]:void 0)}this.currentLayer=pe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const pe=this.currentLayer;this.depthOcclusion=!0;for(const ee of this.layersWithOcclusionOpacity){this.currentLayer=ee;const Ae=X[this.currentLayer],Ge=u.getLayerSourceCache(Ae),ui=Ge?st[Ge.id]:void 0;this.terrain||this._renderTileClippingMasks(Ae,Ge,Ge?ht[Ge.id]:void 0),this.renderLayer(this,Ge,Ae,ui)}this.depthOcclusion=!1,this.currentLayer=pe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Qt=null;X.forEach(Gt=>{const pe=u.getLayerSourceCache(Gt);pe&&!Gt.isHidden(this.transform.zoom)&&pe.getVisibleCoordinates().length&&(!Qt||Qt.getSource().maxzoom<pe.getSource().maxzoom)&&(Qt=pe)}),Qt&&this.options.showTileBoundaries&&qx(this,Qt,Qt.getVisibleCoordinates(),a.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qx(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Qt){const Gt=Qt.transform.padding;xn(Qt,Qt.transform.height-(Gt.top||0),3,kc),xn(Qt,Gt.bottom||0,3,ET),Pg(Qt,Gt.left||0,3,Wx),Pg(Qt,Qt.transform.width-(Gt.right||0),3,$x);const pe=Qt.transform.centerPoint;(function(ee,Ae,Ge,ui){mf(ee,Ae-1,Ge-10,2,20,ui),mf(ee,Ae-10,Ge-1,20,2,ui)})(Qt,pe.x,Qt.transform.height-pe.y,Zx)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),tt||(this.conflationActive=!1)}prepareLayer(u){this.gpuTimingStart(u);const{unsupportedLayers:p}=this.transform.projection,b=!p||!p.includes(u.type);if(D_[u.type]&&(b||this.terrain&&u.type==="custom")){const A=this.style.getLayerSourceCache(u);D_[u.type](u,A,this)}this.gpuTimingEnd()}renderLayer(u,p,b,A){b.isHidden(this.transform.zoom)||(b.type==="background"||b.type==="sky"||b.type==="custom"||b.type==="model"||b.type==="raster"||b.type==="raster-particle"||A&&A.length)&&(this.id=b.id,this.gpuTimingStart(b),u.transform.projection.unsupportedLayers&&u.transform.projection.unsupportedLayers.includes(b.type)&&(!u.terrain||b.type!=="custom")||b.type==="clip"||e1[b.type](u,p,b,A,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(u){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery,b=this.context.gl;let A=this.gpuTimers[u.id];A||(A=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:b.createQuery()}),A.calls++,b.beginQuery(p.TIME_ELAPSED_EXT,A.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const u=this.context.extTimerQuery,p=this.context.gl,b=p.createQuery();this.deferredRenderGpuTimeQueries.push(b),p.beginQuery(u.TIME_ELAPSED_EXT,b)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const u=this.gpuTimers;return this.gpuTimers={},u}collectDeferredRenderGpuQueries(){const u=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],u}queryGpuTimers(u){const p={};for(const b in u){const A=u[b],M=this.context.extTimerQuery,P=M.getQueryParameter(A.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(A.query),p[b]=P}return p}queryGpuTimeDeferredRender(u){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.gl;let b=0;for(const A of u)b+=p.getQueryParameter(A,p.QUERY_RESULT)/1e6,p.deleteQuery(A);return b}translatePosMatrix(u,p,b,A,M){if(!b[0]&&!b[1])return u;const P=M?A==="map"?this.transform.angle:0:A==="viewport"?-this.transform.angle:0;if(P){const G=Math.sin(P),j=Math.cos(P);b=[b[0]*j-b[1]*G,b[0]*G+b[1]*j]}const O=[M?b[0]:a.ay(p,b[0],this.transform.zoom),M?b[1]:a.ay(p,b[1],this.transform.zoom),0],B=new Float32Array(16);return a.bq(B,u,O),B}saveTileTexture(u){if(u.context!==this.context)return;const p=u.size[0],b=this._tileTextures[p];b?b.push(u):this._tileTextures[p]=[u]}getTileTexture(u){const p=this._tileTextures[u];return p&&p.length>0?p.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(u,p,b){const A=b===void 0?this.terrain&&this.terrain.renderingToTexture:b,M=[];return this.style&&this.style.enable3dLights()&&(u==="globeRaster"||u==="terrainRaster"?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):A||M.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||M.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&M.push("GLOBE"),!this._fogVisible||A||p!==void 0&&!p||M.push("FOG","FOG_DITHERING"),A&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(u,p){this.cache=this.cache||{};const b=p&&p.defines||[],A=p&&p.config,M=this.currentGlobalDefines(u,p&&p.overrideFog,p&&p.overrideRtt).concat(b),P=Cg.cacheKey(Qv[u],u,M,A);return this.cache[P]||(this.cache[P]=new Cg(this.context,u,Qv[u],A,nD[u],M)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(u,p){if(this.style.enable3dLights()){const b=this.style.directionalLight,A=this.style.ambientLight;if(b&&A){const M=((P,O,B)=>{const G=P.properties.get("direction"),j=P.properties.get("color-use-theme")==="none",X=P.properties.get("color").toNonPremultipliedRenderColor(j?null:B.getLut(P.scope)).toArray01(),W=P.properties.get("intensity"),K=O.properties.get("color-use-theme")==="none",tt=O.properties.get("color").toNonPremultipliedRenderColor(K?null:B.getLut(O.scope)).toArray01(),rt=O.properties.get("intensity"),ht=[G.x,G.y,G.z],st=a.dM(tt,rt),gt=a.dM(X,W);return{u_lighting_ambient_color:st,u_lighting_directional_dir:ht,u_lighting_directional_color:gt,u_ground_radiance:Ex(ht,gt,st)}})(b,A,this.style);p.setLightsUniformValues(u,M)}}}uploadCommonUniforms(u,p,b,A,M){if(this.uploadCommonLightUniforms(u,p),this.terrain&&this.terrain.renderingToTexture)return;const P=this.style.fog;if(P){const O=P.getOpacity(this.transform.pitch),B=((G,j,X,W,K,tt,rt,ht,st,gt,xt,vt)=>{const Pt=G.transform,wt=j.properties.get("color-use-theme")==="none",Rt=j.properties.get("color").toNonPremultipliedRenderColor(wt?null:G.style.getLut(j.scope)).toArray01();Rt[3]=W;const Mt=G.frameCounter/1e3%1,[At,kt]=j.properties.get("vertical-range");return{u_fog_matrix:X?Pt.calculateFogTileMatrix(X):vt||G.identityMat,u_fog_range:j.getFovAdjustedRange(Pt._fov),u_fog_color:Rt,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(At,kt),kt],u_fog_temporal_offset:Mt,u_frustum_tl:K,u_frustum_tr:tt,u_frustum_br:rt,u_frustum_bl:ht,u_globe_pos:st,u_globe_radius:gt,u_viewport:xt,u_globe_transition:a.aj(Pt.zoom),u_is_globe:+(Pt.projection.name==="globe")}})(this,P,b,O,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.o.devicePixelRatio,this.transform.height*a.o.devicePixelRatio],A);p.setFogUniformValues(u,B)}M&&p.setCutoffUniformValues(u,M.uniformValues)}setTileLoadedFlag(u){this.tileLoaded=u}saveCanvasCopy(){const u=this.canvasCopy();u&&(this.frameCopies.push(u),this.tileLoaded=!1)}canvasCopy(){const u=this.context.gl,p=u.createTexture();return u.bindTexture(u.TEXTURE_2D,p),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,u.drawingBufferWidth,u.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const u=this.style&&this.style.fog;return!!u&&u.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const u=this._backgroundTiles,p=this._backgroundTiles={},b=this.transform.coveringTiles({tileSize:512});for(const A of b)p[A.key]=u[A.key]||new su(A,512,this.transform.tileZoom,this,void 0,this.worldview);return p}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(u,p){return!(!u.is3D(!(!this.terrain||!this.terrain.enabled))||u.type!=="clip"&&u.type!=="building"&&(u.minzoom&&u.minzoom>this.transform.zoom||(this.style._clipLayerPresent||u.sourceLayer!=="building"&&u.sourceLayer!=="procedural_buildings")&&(!p||p.type!=="batched-model")))}isTileAffectedByFog(u){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let p=this._cachedTileFogOpacities[u.key];return p||(this._cachedTileFogOpacities[u.key]=p=this.style.fog.getOpacityForTile(u)),p[0]>=ie||p[1]>=ie}setupDepthForOcclusion(u,p,b){const A=this.context,M=A.gl,P=!!b;var O;b||(b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),A.activeTexture.set(M.TEXTURE3),u&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),b.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],b.u_depth_range_unpack=[2/((O=this.depthRangeFor3D)[1]-O[0]),-1-2*O[0]/(O[1]-O[0])],b.u_occluder_half_size=.5*this.occlusionParams.occluderSize,b.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),A.activeTexture.set(M.TEXTURE0),P||p.setTerrainUniformValues(A,b)}}function Wh(x,u){let p=!1,b=null;const A=()=>{b=null,p&&(x(),b=setTimeout(A,u),p=!1)};return()=>(p=!0,b||A(),b)}class L_{constructor(u){this._hashName=u&&encodeURIComponent(u),a.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Wh(this._updateHashUnthrottled.bind(this),300)}addTo(u){return this._map=u,window.addEventListener("hashchange",this._onHashChange,!1),u.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const u=this._map;if(!u)return"";const p=R_(u);if(this._hashName){const b=this._hashName;let A=!1;const M=location.hash.slice(1).split("&").map(P=>{const O=P.split("=")[0];return O===b?(A=!0,`${O}=${p}`):P}).filter(P=>P);return A||M.push(`${b}=${p}`),`#${M.join("&")}`}return`#${p}`}_getCurrentHash(){const u=location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(p=b)}),(p&&p[1]||"").split("/")}return u.split("/")}_onHashChange(){const u=this._map;if(!u)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(b=>isNaN(Number(b)))){const b=u.dragRotate.isEnabled()&&u.touchZoomRotate.isEnabled()?+(p[3]||0):u.getBearing();return u.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:b,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function R_(x,u){const p=x.getCenter(),b=Math.round(100*x.getZoom())/100,A=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,A),P=Math.round(p.lng*M)/M,O=Math.round(p.lat*M)/M,B=x.getBearing(),G=x.getPitch();let j=u?`/${P}/${O}/${b}`:`${b}/${O}/${P}`;return(B||G)&&(j+="/"+Math.round(10*B)/10),G&&(j+=`/${Math.round(G)}`),j}const Sf={linearity:.3,easing:a.eS(0,0,.3,1)},zc=Object.assign({deceleration:2500,maxSpeed:1400},Sf),i1=Object.assign({deceleration:20,maxSpeed:1400},Sf),Al=Object.assign({deceleration:1e3,maxSpeed:360},Sf),r1=Object.assign({deceleration:1e3,maxSpeed:90},Sf);class k_{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.o.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,p=a.o.now();for(;u.length>0&&p-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const p={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)p.zoom+=M.zoomDelta||0,p.bearing+=M.bearingDelta||0,p.pitch+=M.pitchDelta||0,M.panDelta&&p.pan._add(M.panDelta),M.around&&(p.around=M.around),M.pinchAround&&(p.pinchAround=M.pinchAround);const b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(p.pan.mag()){const M=Af(p.pan.mag(),b,Object.assign({},zc,u||{}));A.offset=p.pan.mult(M.amount/p.pan.mag()),A.center=this._map.transform.center,Tf(A,M)}if(p.zoom){const M=Af(p.zoom,b,i1);A.zoom=this._map.transform.zoom+M.amount,Tf(A,M)}if(p.bearing){const M=Af(p.bearing,b,Al);A.bearing=this._map.transform.bearing+a.aA(M.amount,-179,179),Tf(A,M)}if(p.pitch){const M=Af(p.pitch,b,r1);A.pitch=this._map.transform.pitch+M.amount,Tf(A,M)}if(A.zoom||A.bearing){const M=p.pinchAround===void 0?p.around:p.pinchAround;A.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),A.noMoveStart=!0,A}}function Tf(x,u){(!x.duration||x.duration<u.duration)&&(x.duration=u.duration,x.easing=u.easing)}function Af(x,u,p){const{maxSpeed:b,linearity:A,deceleration:M}=p,P=a.aA(x*A/(u/1e3),-b,b),O=Math.abs(P)/(M*A);return{easing:p.easing,duration:1e3*O,amount:P*(O/2)}}class Ln extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,b,A={}){const M=it(p.getCanvasContainer(),b),P=p.unproject(M);super(u,Object.assign({point:M,lngLat:P,originalEvent:b},A)),this._defaultPrevented=!1,this.target=p}}class If extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,b){const A=u==="touchend"?b.changedTouches:b.touches,M=at(p.getCanvasContainer(),A),P=M.map(B=>p.unproject(B)),O=M.reduce((B,G,j,X)=>B.add(G.div(X.length)),new a.P(0,0));super(u,{points:M,point:O,lngLats:P,lngLat:p.unproject(O),originalEvent:b}),this._defaultPrevented=!1}}class n1 extends a.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p){super("wheel",{originalEvent:p}),this._defaultPrevented=!1}}class a1{constructor(u,p){this._map=u,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(u){return this._firePreventable(new n1(this._map,u))}mousedown(u,p){return this._mousedownPos=p,this._firePreventable(new Ln(u.type,this._map,u))}mouseup(u){this._map.fire(new Ln(u.type,this._map,u))}preclick(u){const p=new MouseEvent("preclick",u);this._map.fire(new Ln(p.type,this._map,p))}click(u,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(u),this._map.fire(new Ln(u.type,this._map,u)))}dblclick(u){return this._firePreventable(new Ln(u.type,this._map,u))}mouseover(u){this._map.fire(new Ln(u.type,this._map,u))}mouseout(u){this._map.fire(new Ln(u.type,this._map,u))}touchstart(u){return this._firePreventable(new If(u.type,this._map,u))}touchmove(u){this._map.fire(new If(u.type,this._map,u))}touchend(u){this._map.fire(new If(u.type,this._map,u))}touchcancel(u){this._map.fire(new If(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $h{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(u){this._map.fire(new Ln(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new Ln(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class o1{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,p){this.isEnabled()&&u.shiftKey&&u.button===0&&(H(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(u,p){if(!this._active)return;const b=p,A=this._startPos,M=this._lastPos;if(!A||!M||M.equals(b)||!this._box&&b.dist(A)<this._clickTolerance)return;this._lastPos=b,this._box||(this._box=E("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));const P=Math.min(A.x,b.x),O=Math.max(A.x,b.x),B=Math.min(A.y,b.y),G=Math.max(A.y,b.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${P}px,${B}px)`,this._box.style.width=O-P+"px",this._box.style.height=G-B+"px")})}mouseupWindow(u,p){if(!this._active)return;const b=this._startPos,A=p;if(b&&u.button===0){if(this.reset(),J(),b.x!==A.x||b.y!==A.y)return this._map.fire(new a.z("boxzoomend",{originalEvent:u})),{cameraAnimation:M=>M.fitScreenCoordinates(b,A,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",u)}}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),q(),delete this._startPos,delete this._lastPos}_fireEvent(u,p){return this._map.fire(new a.z(u,{originalEvent:p}))}}function kg(x,u){const p={};for(let b=0;b<x.length;b++)p[x[b].identifier]=u[b];return p}class s1{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(u,p,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=u.timeStamp),b.length===this.numTouches&&(this.centroid=function(A){const M=new a.P(0,0);for(const P of A)M._add(P);return M.div(A.length)}(p),this.touches=kg(b,p)))}touchmove(u,p,b){if(this.aborted||!this.centroid)return;const A=kg(b,p);for(const M in this.touches){const P=A[M];(!P||P.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(u,p,b){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),b.length===0){const A=!this.aborted&&this.centroid;if(this.reset(),A)return A}}}class Bc{constructor(u){this.singleTap=new s1(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(u,p,b){this.singleTap.touchstart(u,p,b)}touchmove(u,p,b){this.singleTap.touchmove(u,p,b)}touchend(u,p,b){const A=this.singleTap.touchend(u,p,b);if(A){const M=u.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(A)<30;if(M&&P||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=A,this.count===this.numTaps)return this.reset(),A}}}class l1{constructor(){this._zoomIn=new Bc({numTouches:1,numTaps:2}),this._zoomOut=new Bc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,p,b){this._zoomIn.touchstart(u,p,b),this._zoomOut.touchstart(u,p,b)}touchmove(u,p,b){this._zoomIn.touchmove(u,p,b),this._zoomOut.touchmove(u,p,b)}touchend(u,p,b){const A=this._zoomIn.touchend(u,p,b),M=this._zoomOut.touchend(u,p,b);return A?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(A)},{originalEvent:u})}):M?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(M)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const O_={0:1,2:2},z_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Cf{constructor(u){this.reset(),this._clickTolerance=u.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(u,p){return!1}_move(u,p){return{}}mousedown(u,p){if(this._lastPoint)return;const b=ut(u);this._correctButton(u,b)&&(this._lastPoint=p,this._eventButton=b)}mousemoveWindow(u,p){const b=this._lastPoint;if(b){if(u.preventDefault(),this._eventButton!=null&&function(A,M){const P=O_[M];return A.buttons===void 0||(A.buttons&P)!==P}(u,this._eventButton))this.reset();else if(this._moved||!(p.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(b,p)}}mouseupWindow(u){this._lastPoint&&ut(u)===this._eventButton&&(this._moved&&J(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class u1 extends Cf{mousedown(u,p){super.mousedown(u,p),this._lastPoint&&(this._active=!0)}_correctButton(u,p){return p===0&&!u.ctrlKey}_move(u,p){return{around:p,panDelta:p.sub(u)}}}class B_ extends Cf{constructor(u){super(u),this._pitchRotateKey=u.pitchRotateKey?z_[u.pitchRotateKey]:void 0}_correctButton(u,p){return this._pitchRotateKey?p===0&&u[this._pitchRotateKey]:p===0&&u.ctrlKey||p===2}_move(u,p){const b=.8*(p.x-u.x);if(b)return this._active=!0,{bearingDelta:b}}contextmenu(u){this._pitchRotateKey||u.preventDefault()}}class c1 extends Cf{constructor(u){super(u),this._pitchRotateKey=u.pitchRotateKey?z_[u.pitchRotateKey]:void 0}_correctButton(u,p){return this._pitchRotateKey?p===0&&u[this._pitchRotateKey]:p===0&&u.ctrlKey||p===2}_move(u,p){const b=-.5*(p.y-u.y);if(b)return this._active=!0,{pitchDelta:b}}contextmenu(u){this._pitchRotateKey||u.preventDefault()}}class FT{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),a.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(u,p,b){return this._calculateTransform(u,p,b)}touchmove(u,p,b){if(this._active&&!(b.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(b.length===1&&!a.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return u.cancelable&&u.preventDefault(),this._calculateTransform(u,p,b)}}touchend(u,p,b){this._calculateTransform(u,p,b),this._active&&b.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,p,b){b.length>0&&(this._active=!0);const A=kg(b,p),M=new a.P(0,0),P=new a.P(0,0);let O=0;for(const G in A){const j=A[G],X=this._touches[G];X&&(M._add(j),P._add(j.sub(X)),O++,A[G]=j)}if(this._touches=A,O<this._minTouches||!P.mag())return;const B=P.div(O);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(O),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=E("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class F_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(u){}_move(u,p,b){return{}}touchstart(u,p,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([p[0],p[1]]))}touchmove(u,p,b){const A=this._firstTwoTouches;if(!A)return;u.preventDefault();const[M,P]=A,O=Og(b,p,M),B=Og(b,p,P);if(!O||!B)return;const G=this._aroundCenter?null:O.add(B).div(2);return this._move([O,B],G,u)}touchend(u,p,b){if(!this._firstTwoTouches)return;const[A,M]=this._firstTwoTouches,P=Og(b,p,A),O=Og(b,p,M);P&&O||(this._active&&J(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Og(x,u,p){for(let b=0;b<x.length;b++)if(x[b].identifier===p)return u[b]}function h1(x,u){return Math.log2(x/u)}class NT extends F_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,p){const b=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(h1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:h1(this._distance,b),pinchAround:p}}}function d1(x,u){return 180*x.angleWith(u)/Math.PI}class VT extends F_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,p){const b=this._vector;if(this._vector=u[0].sub(u[1]),b&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:d1(this._vector,b),pinchAround:p}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const p=25/(Math.PI*this._minDiameter)*360,b=this._startVector;if(!b)return!1;const A=d1(u,b);return Math.abs(A)<p}}function N_(x){return Math.abs(x.y)>Math.abs(x.x)}class UT extends F_{constructor(u){super(),this._map=u}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(u){this._lastPoints=u,N_(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,p,b){const A=this._lastPoints;if(!A)return;const M=u[0].sub(A[0]),P=u[1].sub(A[1]);return this._map._cooperativeGestures&&!a.eT()&&b.touches.length<3||(this._valid=this.gestureBeginsVertically(M,P,b.timeStamp),!this._valid)?void 0:(this._lastPoints=u,this._active=!0,{pitchDelta:(M.y+P.y)/2*-.5})}gestureBeginsVertically(u,p,b){if(this._valid!==void 0)return this._valid;const A=u.mag()>=2,M=p.mag()>=2;if(!A&&!M)return;if(!A||!M)return this._firstMove==null&&(this._firstMove=b),b-this._firstMove<100&&void 0;const P=u.y>0==p.y>0;return N_(u)&&N_(p)&&P}}const GT={panStep:100,bearingStep:15,pitchStep:10};class HT{constructor(){const u=GT;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let p=0,b=0,A=0,M=0,P=0;switch(u.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:u.shiftKey?b=-1:(u.preventDefault(),M=-1);break;case 39:u.shiftKey?b=1:(u.preventDefault(),M=1);break;case 38:u.shiftKey?A=1:(u.preventDefault(),P=-1);break;case 40:u.shiftKey?A=-1:(u.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(b=0,A=0),{cameraAnimation:O=>{const B=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:jT,zoom:p?Math.round(B)+p*(u.shiftKey?2:1):B,bearing:O.getBearing()+b*this._bearingStep,pitch:O.getPitch()+A*this._pitchStep,offset:[-M*this._panStep,-P*this._panStep],center:O.getCenter()},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jT(x){return x*(2-x)}const WT=4.000244140625,dD=1/450;class fD{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._handler=p,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=dD,a.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(u){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(u.ctrlKey||u.metaKey||this.isZooming()||a.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=u.deltaMode===WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const b=a.o.now(),A=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,p!==0&&p%WT==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":A>400?(this._type=null,this._lastValue=p,this._timeout=window.setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(A*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),u.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=u,this._delta-=p,this._active||this._start(u)),u.preventDefault()}_onTimeout(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=it(this._el,u);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._map.transform;this._type==="wheel"&&u.projection.wrap&&(u._center.lng>=180||u._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>u._terrainEnabled()&&this._aroundCoord?u.computeZoomRelativeTo(this._aroundCoord):u.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>WT?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&j!==0&&(j=1/j);const X=p(),W=Math.pow(2,X),K=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(K*j))),this._type==="wheel"&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const b=typeof this._targetZoom=="number"?this._targetZoom:p(),A=this._startZoom,M=this._easing;let P,O=!1;if(this._type==="wheel"&&A&&M){const G=Math.min((a.o.now()-this._lastWheelEventTime)/200,1),j=M(G);P=a.ak(A,b,j),G<1?this._frameId||(this._frameId=!0):O=!0}else P=b,O=!0;this._active=!0,O&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let B=P-p();return B*this._lastDelta<0&&(B=0),{noInertia:!0,needsRenderFrame:!O,zoomDelta:B,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let p=a.eU;if(this._prevEase){const b=this._prevEase,A=(a.o.now()-b.start)/b.duration,M=b.easing(A+.01)-b.easing(A),P=.27/Math.sqrt(M*M+1e-4)*.01,O=Math.sqrt(.0729-P*P);p=a.eS(P,O,.25,1)}return this._prevEase={start:a.o.now(),duration:u,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=E("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Un{constructor(u,p){this._clickZoom=u,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $T{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(u,p){return u.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:b.getZoom()+(u.shiftKey?-1:1),around:b.unproject(p)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pD{constructor(){this._tap=new Bc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(u,p,b){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?b.length>0&&(this._swipePoint=p[0],this._swipeTouch=b[0].identifier):this._tap.touchstart(u,p,b))}touchmove(u,p,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;const A=p[0],M=A.y-this._swipePoint.y;return this._swipePoint=A,u.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(u,p,b)}touchend(u,p,b){this._tapTime?this._swipePoint&&b.length===0&&this.reset():this._tap.touchend(u,p,b)&&(this._tapTime=u.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gD{constructor(u,p,b){this._el=u,this._mousePan=p,this._touchPan=b}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class mD{constructor(u,p,b){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=p,this._mousePitch=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zg{constructor(u,p,b,A){this._el=u,this._touchZoom=p,this._touchRotate=b,this._tapDragZoom=A,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bg=x=>x.zoom||x.drag||x.pitch||x.rotate;class f1 extends a.z{}class V_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(u,p){const b=a.av([],p,u);this.radius=a.ag(b[2]<0?a.eW([],b,this.constants):[b[0],b[1],0])}projectRay(u){a.eW(u,u,this.constants),a.aw(u,u),a.eX(u,u,this.constants);const p=a.c4([],u,this.radius);if(p[2]>0){const b=a.c4([],[0,0,1],a.bI(p,[0,0,1])),A=a.c4([],a.aw([],[p[0],p[1],0]),this.radius),M=a.d7([],p,a.c4([],a.av([],a.d7([],A,b),p),2));p[0]=M[0],p[1]=M[1]}return p}}function Il(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class U_{constructor(u,p){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new k_(u),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new V_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),a.aX(["handleEvent","handleWindowEvent"],this);const b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[window,"blur",void 0]];for(const[A,M,P]of this._listeners){const O=A===document?this.handleWindowEvent:this.handleEvent;A.addEventListener(M,O,P)}}destroy(){for(const[u,p,b]of this._listeners){const A=u===document?this.handleWindowEvent:this.handleEvent;u.removeEventListener(p,A,b)}}_addDefaultHandlers(u){const p=this._map,b=p.getCanvasContainer();this._add("mapEvent",new a1(p,u));const A=p.boxZoom=new o1(p,u);this._add("boxZoom",A);const M=new l1,P=new $T;p.doubleClickZoom=new Un(P,M),this._add("tapZoom",M),this._add("clickZoom",P);const O=new pD;this._add("tapDragZoom",O);const B=p.touchPitch=new UT(p);this._add("touchPitch",B);const G=new B_(u),j=new c1(u);p.dragRotate=new mD(u,G,j),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const X=new u1(u),W=new FT(p,u);p.dragPan=new gD(b,X,W),this._add("mousePan",X),this._add("touchPan",W,["touchZoom","touchRotate"]);const K=new VT,tt=new NT;p.touchZoomRotate=new zg(b,tt,K,O),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",tt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $h(p));const rt=p.scrollZoom=new fD(p,this);this._add("scrollZoom",rt,["mousePan"]);const ht=p.keyboard=new HT;this._add("keyboard",ht);for(const st of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])u.interactive&&u[st]&&p[st].enable(u[st])}_add(u,p,b){this._handlers.push({handlerName:u,handler:p,allowed:b}),this._handlersById[u]=p}stop(u){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(u,p,b){for(const A in u)if(A!==b&&(!p||p.indexOf(A)<0))return!0;return!1}handleWindowEvent(u){this.handleEvent(u,`${u.type}Window`)}_getMapTouches(u){const p=[];for(const b of u)this._el.contains(b.target)&&p.push(b);return p}handleEvent(u,p){this._updatingCamera=!0;const b=u.type==="renderFrame",A=b?void 0:u,M={needsRenderFrame:!1},P={},O={},B=u.touches?this._getMapTouches(u.touches):void 0,G=B?at(this._el,B):b?void 0:it(this._el,u);for(const{handlerName:W,handler:K,allowed:tt}of this._handlers){if(!K.isEnabled())continue;let rt;this._blockedByActive(O,tt,W)?K.reset():K[p||u.type]&&(rt=K[p||u.type](u,G,B),this.mergeHandlerResult(M,P,rt,W,A),rt&&rt.needsRenderFrame&&this._triggerRenderFrame()),(rt||K.isActive())&&(O[W]=K)}const j={};for(const W in this._previousActiveHandlers)O[W]||(j[W]=A);this._previousActiveHandlers=O,(Object.keys(j).length||Il(M))&&(this._changes.push([M,P,j]),this._triggerRenderFrame()),(Object.keys(O).length||Il(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=M;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(u,p,b,A,M){if(!b)return;Object.assign(u,b);const P={handlerName:A,originalEvent:b.originalEvent||M};b.zoomDelta!==void 0&&(p.zoom=P),b.panDelta!==void 0&&(p.drag=P),b.pitchDelta!==void 0&&(p.pitch=P),b.bearingDelta!==void 0&&(p.rotate=P)}_applyChanges(){const u={},p={},b={};for(const[A,M,P]of this._changes)A.panDelta&&(u.panDelta=(u.panDelta||new a.P(0,0))._add(A.panDelta)),A.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(u.around=A.around),A.aroundCoord!==void 0&&(u.aroundCoord=A.aroundCoord),A.pinchAround!==void 0&&(u.pinchAround=A.pinchAround),A.noInertia&&(u.noInertia=A.noInertia),Object.assign(p,M),Object.assign(b,P);this._updateMapTransform(u,p,b),this._changes=[]}_updateMapTransform(u,p,b){const A=this._map,M=A.transform,P=gt=>[gt.x,gt.y,gt.z];if((gt=>{const xt=this._eventsInProgress.drag;return xt&&!this._handlersById[xt.handlerName].isActive()})()&&!Il(u)){const gt=M.zoom;M.cameraElevationReference="sea",this._originalZoom!=null&&M._orthographicProjectionAtLowPitch&&M.projection.name!=="globe"&&M.pitch===0?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),gt!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&A._stop(!0),!Il(u))return void this._fireEvents(p,b,!0);let{panDelta:O,zoomDelta:B,bearingDelta:G,pitchDelta:j,around:X,aroundCoord:W,pinchAround:K}=u;M._isCameraConstrained&&(B>0&&(B=0),M._isCameraConstrained=!1),K!==void 0&&(X=K),(B||(gt=>p[gt]&&!this._eventsInProgress[gt])("drag"))&&X&&(this._dragOrigin=P(M.pointCoordinate3D(X)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",A._stop(!0),X=X||A.transform.centerPoint,G&&(M.bearing+=G),j&&(M.pitch+=j),M._updateCameraState();const tt=[0,0,0];if(O)if(M.projection.name==="mercator"){const gt=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(X).dir),xt=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(X.sub(O)).dir);tt[0]=xt[0]-gt[0],tt[1]=xt[1]-gt[1]}else{const gt=M.pointCoordinate(X);if(M.projection.name==="globe"){O=O.rotate(-M.angle);const xt=M._pixelsPerMercatorPixel/M.worldSize;tt[0]=-O.x*a.eV(a.a_(gt.y))*xt,tt[1]=-O.y*a.eV(M.center.lat)*xt}else{const xt=M.pointCoordinate(X.sub(O));gt&&xt&&(tt[0]=xt.x-gt.x,tt[1]=xt.y-gt.y)}}const rt=M.zoom,ht=[0,0,0];if(B){const gt=P(W||M.pointCoordinate3D(X)),xt={dir:a.aw([],a.av([],gt,M._camera.position))};if(xt.dir[2]<0){const vt=M.zoomDeltaToMovement(gt,B);a.c4(ht,xt.dir,vt)}}const st=a.d7(tt,tt,ht);M._translateCameraConstrained(st),B&&Math.abs(M.zoom-rt)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(p,b,!0)}_fireEvents(u,p,b){const A=Bg(this._eventsInProgress),M=Bg(u),P={};for(const j in u){const{originalEvent:X}=u[j];this._eventsInProgress[j]||(P[`${j}start`]=X),this._eventsInProgress[j]=u[j]}!A&&M&&this._fireEvent("movestart",M.originalEvent);for(const j in P)this._fireEvent(j,P[j]);M&&this._fireEvent("move",M.originalEvent);for(const j in u){const{originalEvent:X}=u[j];this._fireEvent(j,X)}const O={};let B;for(const j in this._eventsInProgress){const{handlerName:X,originalEvent:W}=this._eventsInProgress[j];this._handlersById[X].isActive()||(delete this._eventsInProgress[j],B=p[X]||W,O[`${j}end`]=B)}for(const j in O)this._fireEvent(j,O[j]);const G=Bg(this._eventsInProgress);if(b&&(A||M)&&!G){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;j?(X(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:B})):(this._map.fire(new a.z("moveend",{originalEvent:B})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(u,p){this._map.fire(new a.z(u,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(u=>{this._frameId=void 0,this.handleEvent(new f1("renderFrame",{timeStamp:u})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const va="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class du extends a.E{constructor(u,p){super(),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=p.bearingSnap,this._respectPrefersReducedMotion=p.respectPrefersReducedMotion!==!1,a.aX(["_renderFrameCallback"],this)}getCenter(){return new a.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(u,p){return this.jumpTo({center:u},p)}panBy(u,p,b){return u=a.P.convert(u).mult(-1),this.panTo(this.transform.center,Object.assign({offset:u},p),b)}panTo(u,p,b){return this.easeTo(Object.assign({center:u},p),b)}getZoom(){return this.transform.zoom}setZoom(u,p){return this.jumpTo({zoom:u},p),this}zoomTo(u,p,b){return this.easeTo(Object.assign({zoom:u},p),b)}zoomIn(u,p){return this.zoomTo(this.getZoom()+1,u,p),this}zoomOut(u,p){return this.zoomTo(this.getZoom()-1,u,p),this}getBearing(){return this.transform.bearing}setBearing(u,p){return this.jumpTo({bearing:u},p),this}getPadding(){return this.transform.padding}setPadding(u,p){return this.jumpTo({padding:u},p),this}rotateTo(u,p,b){return this.easeTo(Object.assign({bearing:u},p),b)}resetNorth(u,p){return this.rotateTo(0,Object.assign({duration:1e3},u),p),this}resetNorthPitch(u,p){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},u),p),this}snapToNorth(u,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,p):this}getPitch(){return this.transform.pitch}setPitch(u,p){return this.jumpTo({pitch:u},p),this}cameraForBounds(u,p){u=a.aI.convert(u);const b=p&&p.bearing||0,A=p&&p.pitch||0,M=u.getNorthWest(),P=u.getSouthEast();return this._cameraForBounds(this.transform,M,P,b,A,p)}_extendPadding(u){const p={top:0,right:0,bottom:0,left:0};return u==null?Object.assign({},p,this.transform.padding):typeof u=="number"?{top:u,bottom:u,right:u,left:u}:Object.assign({},p,u)}_extendCameraOptions(u){return(u=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=this._extendPadding(u.padding),u}_minimumAABBFrustumDistance(u,p){const b=p.max[0]-p.min[0],A=p.max[1]-p.min[1];return b/A>u.aspect?b/(2*Math.tan(.5*u.fovX)*u.aspect):A/(2*Math.tan(.5*u.fovY)*u.aspect)}_cameraForBoundsOnGlobe(u,p,b,A,M,P){const O=u.clone(),B=this._extendCameraOptions(P);O.bearing=A,O.pitch=M;const G=a.aS.convert(p),j=a.aS.convert(b),X=.5*(G.lat+j.lat),W=.5*(G.lng+j.lng),K=a.eY(X,W),tt=a.aw([],K),rt=a.aw([],a.bH([],tt,[0,1,0])),ht=a.bH([],rt,tt),st=[rt[0],rt[1],rt[2],0,ht[0],ht[1],ht[2],0,tt[0],tt[1],tt[2],0,0,0,0,1],gt=[K,a.eY(G.lat,G.lng),a.eY(j.lat,G.lng),a.eY(j.lat,j.lng),a.eY(G.lat,j.lng),a.eY(X,G.lng),a.eY(X,j.lng),a.eY(G.lat,W),a.eY(j.lat,W)];let xt=a.d8.fromPoints(gt.map(ee=>[a.bI(rt,ee),a.bI(ht,ee),a.bI(tt,ee)]));const vt=a.af([],xt.center,st);a.eZ(vt)===0&&a.e_(vt,0,0,1),a.aw(vt,vt),a.c4(vt,vt,a.aD),O.center=a.e$(vt);const Pt=O.getWorldToCameraMatrix(),wt=a.bk(new Float64Array(16),Pt);xt=a.d8.applyTransform(xt,a.aB([],Pt,st));const Rt=this._extendAABB(xt,O,B,A);if(!Rt)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xt=Rt,a.af(vt,vt,Pt);const Mt=.5*(xt.max[2]-xt.min[2]),At=this._minimumAABBFrustumDistance(O,xt),kt=a.c4([],[0,0,1],Mt),qt=a.d7(kt,vt,kt),jt=At+(O.pitch===0?0:a.bF(vt,qt)),oe=O.globeCenterInViewSpace,te=a.av([],vt,[oe[0],oe[1],oe[2]]);a.aw(te,te),a.c4(te,te,jt);const fe=a.d7([],vt,te);a.af(fe,fe,wt);const ze=a.eL/a.aD,Qt=a.ag(fe),Gt=a.ce(Math.max(Qt*ze-a.eL,Number.EPSILON),0),pe=Math.min(O.zoomFromMercatorZAdjusted(Gt),B.maxZoom);return pe>.5*(a.cZ+a.cK)?(O.setProjection({name:"mercator"}),O.zoom=pe,this._cameraForBounds(O,p,b,A,M,P)):{center:O.center,zoom:pe,bearing:A,pitch:M}}_extendAABB(u,p,b,A){const M=.5*((b.padding.left||0)+(b.padding.right||0)),P=.5*((b.padding.top||0)+(b.padding.bottom||0)),O=P,B=M,G=M,j=P,X=p.width-(B+G),W=p.height-(O+j),K=a.av([],u.max,u.min),tt=Math.min(X/K[0],W/K[1]),rt=Math.min(p.scaleZoom(p.scale*tt),b.maxZoom);if(isNaN(rt))return null;const ht=p.scale/p.zoomScale(rt),st=new a.d8([u.min[0]-B*ht,u.min[1]-j*ht,u.min[2]],[u.max[0]+G*ht,u.max[1]+O*ht,u.max[2]]),gt=(typeof b.offset.x=="number"&&typeof b.offset.y=="number"?new a.P(b.offset.x,b.offset.y):a.P.convert(b.offset)).rotate(-a.an(A));return st.center[0]-=gt.x*ht,st.center[1]+=gt.y*ht,st}queryTerrainElevation(u,p){const b=this.transform.elevation;return b?(p=Object.assign({},{exaggerated:!0},p),b.getAtPoint(a.ae.fromLngLat(u),null,p.exaggerated)):null}_cameraForBounds(u,p,b,A,M,P){if(u.projection.name==="globe")return this._cameraForBoundsOnGlobe(u,p,b,A,M,P);const O=u.clone(),B=this._extendCameraOptions(P);O.bearing=A,O.pitch=M;const G=a.aS.convert(p),j=a.aS.convert(b),X=new a.aS(G.lng,j.lat),W=new a.aS(j.lng,G.lat),K=O.project(G),tt=O.project(j),rt=this.queryTerrainElevation(G),ht=this.queryTerrainElevation(j),st=this.queryTerrainElevation(X),gt=this.queryTerrainElevation(W),xt=[[K.x,K.y,Math.min(rt||0,ht||0,st||0,gt||0)],[tt.x,tt.y,Math.max(rt||0,ht||0,st||0,gt||0)]];let vt=a.d8.fromPoints(xt);const Pt=O.getWorldToCameraMatrix(),wt=a.bk(new Float64Array(16),Pt);vt=a.d8.applyTransform(vt,Pt);const Rt=this._extendAABB(vt,O,B,A);if(!Rt)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");vt=Rt;const Mt=.5*a.av([],vt.max,vt.min)[2],At=this._minimumAABBFrustumDistance(O,vt),kt=[0,0,1,0];a.aC(kt,kt,Pt),a.f0(kt,kt);const qt=a.c4([],kt,At+Mt),jt=a.d7([],vt.center,qt);a.af(vt.center,vt.center,wt),a.af(jt,jt,wt);const oe=O.unproject(new a.P(vt.center[0],vt.center[1])),te=a.f1(O.projection,oe),fe=Math.pow(2,te),ze=Math.min(O._zoomFromMercatorZ(jt[2]*O.pixelsPerMeter*fe/O.worldSize),B.maxZoom);return O.mercatorFromTransition&&ze<.5*(a.cZ+a.cK)?(O.setProjection({name:"globe"}),O.zoom=ze,this._cameraForBounds(O,p,b,A,M,P)):{center:oe,zoom:ze,bearing:A,pitch:M}}fitBounds(u,p,b){const A=this.cameraForBounds(u,p);return this._fitInternal(A,p,b)}fitScreenCoordinates(u,p,b,A,M){const P=a.P.convert(u),O=a.P.convert(p),B=new a.P(Math.min(P.x,O.x),Math.min(P.y,O.y)),G=new a.P(Math.max(P.x,O.x),Math.max(P.y,O.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(P,O))return this;const j=this.transform.pointLocation3D(B),X=this.transform.pointLocation3D(G),W=this.transform.pointLocation3D(new a.P(B.x,G.y)),K=this.transform.pointLocation3D(new a.P(G.x,B.y)),tt=[Math.min(j.lng,X.lng,W.lng,K.lng),Math.min(j.lat,X.lat,W.lat,K.lat)],rt=[Math.max(j.lng,X.lng,W.lng,K.lng),Math.max(j.lat,X.lat,W.lat,K.lat)],ht=A&&A.pitch?A.pitch:this.getPitch(),st=this._cameraForBounds(this.transform,tt,rt,b,ht,A);return this._fitInternal(st,A,M)}_fitInternal(u,p,b){return u?(p=Object.assign(u,p)).linear?this.easeTo(p,b):this.flyTo(p,b):this}jumpTo(u,p){this.stop();const b=u.preloadOnly?this.transform.clone():this.transform;let A=!1,M=!1,P=!1;"zoom"in u&&b.zoom!==+u.zoom&&(A=!0,b.zoom=+u.zoom),u.center!==void 0&&(b.center=a.aS.convert(u.center)),"bearing"in u&&b.bearing!==+u.bearing&&(M=!0,b.bearing=+u.bearing),"pitch"in u&&b.pitch!==+u.pitch&&(P=!0,b.pitch=+u.pitch);const O=typeof u.padding=="number"?this._extendPadding(u.padding):u.padding;if(u.padding!=null&&!b.isPaddingEqual(O))if(u.retainPadding===!1){const B=b.clone();B.padding=O,b.setLocationAtPoint(b.center,B.centerPoint)}else b.padding=O;return u.preloadOnly?(this._preloadTiles(b),this):(this.fire(new a.z("movestart",p)).fire(new a.z("move",p)),A&&this.fire(new a.z("zoomstart",p)).fire(new a.z("zoom",p)).fire(new a.z("zoomend",p)),M&&this.fire(new a.z("rotatestart",p)).fire(new a.z("rotate",p)).fire(new a.z("rotateend",p)),P&&this.fire(new a.z("pitchstart",p)).fire(new a.z("pitch",p)).fire(new a.z("pitchend",p)),this.fire(new a.z("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(va),this.transform.getFreeCameraOptions()}setFreeCameraOptions(u,p){const b=this.transform;if(!b.projection.supportsFreeCamera)return a.w(va),this;this.stop();const A=b.zoom,M=b.pitch,P=b.bearing;b.setFreeCameraOptions(u);const O=A!==b.zoom,B=M!==b.pitch,G=P!==b.bearing;return this.fire(new a.z("movestart",p)).fire(new a.z("move",p)),O&&this.fire(new a.z("zoomstart",p)).fire(new a.z("zoom",p)).fire(new a.z("zoomend",p)),G&&this.fire(new a.z("rotatestart",p)).fire(new a.z("rotate",p)).fire(new a.z("rotateend",p)),B&&this.fire(new a.z("pitchstart",p)).fire(new a.z("pitch",p)).fire(new a.z("pitchend",p)),this.fire(new a.z("moveend",p)),this}easeTo(u,p){this._stop(!1,u.easeId),((u=Object.assign({offset:[0,0],duration:500,easing:a.eU},u)).animate===!1||this._prefersReducedMotion(u))&&(u.duration=0);const b=this.transform,A=this.getZoom(),M=this.getBearing(),P=this.getPitch(),O=this.getPadding(),B="zoom"in u?+u.zoom:A,G="bearing"in u?this._normalizeBearing(u.bearing,M):M,j="pitch"in u?+u.pitch:P,X=this._extendPadding(u.padding),W=a.P.convert(u.offset);let K,tt,rt;if(b.projection.name==="globe"){const kt=a.ae.fromLngLat(b.center),qt=W.rotate(-b.angle);kt.x+=qt.x/b.worldSize,kt.y+=qt.y/b.worldSize;const jt=kt.toLngLat(),oe=a.aS.convert(u.center||jt);this._normalizeCenter(oe),K=b.centerPoint.add(qt),tt=new a.P(kt.x,kt.y).mult(b.worldSize),rt=new a.P(a.aF(oe.lng),a.aJ(oe.lat)).mult(b.worldSize).sub(tt)}else{K=b.centerPoint.add(W);const kt=b.pointLocation(K),qt=a.aS.convert(u.center||kt);this._normalizeCenter(qt),tt=b.project(kt),rt=b.project(qt).sub(tt)}const ht=b.zoomScale(B-A);let st,gt;u.around&&(st=a.aS.convert(u.around),gt=b.locationPoint(st));const xt=this._zooming||B!==A,vt=this._rotating||M!==G,Pt=this._pitching||j!==P,wt=!b.isPaddingEqual(X),Rt=u.retainPadding===!1?b.clone():b,Mt=kt=>qt=>{if(xt&&(kt.zoom=a.ak(A,B,qt)),vt&&(kt.bearing=a.ak(M,G,qt)),Pt&&(kt.pitch=a.ak(P,j,qt)),wt&&(Rt.interpolatePadding(O,X,qt),K=Rt.centerPoint.add(W)),st)kt.setLocationAtPoint(st,gt);else{const jt=kt.zoomScale(kt.zoom-A),oe=B>A?Math.min(2,ht):Math.max(.5,ht),te=Math.pow(oe,1-qt),fe=kt.unproject(tt.add(rt.mult(qt*te)).mult(jt));kt.setLocationAtPoint(kt.renderWorldCopies?fe.wrap():fe,K)}return u.preloadOnly||this._fireMoveEvents(p),kt};if(u.preloadOnly){const kt=this._emulate(Mt,u.duration,b);return this._preloadTiles(kt),this}const At={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xt,this._rotating=vt,this._pitching=Pt,this._padding=wt,this._easeId=u.easeId,this._prepareEase(p,u.noMoveStart,At),this._ease(Mt(b),kt=>{b.cameraElevationReference==="sea"&&b.recenterOnTerrain(),this._afterEase(p,kt)},u),this}_prepareEase(u,p,b={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),p||b.moving||this.fire(new a.z("movestart",u)),this._zooming&&!b.zooming&&this.fire(new a.z("zoomstart",u)),this._rotating&&!b.rotating&&this.fire(new a.z("rotatestart",u)),this._pitching&&!b.pitching&&this.fire(new a.z("pitchstart",u))}_fireMoveEvents(u){this.fire(new a.z("move",u)),this._zooming&&this.fire(new a.z("zoom",u)),this._rotating&&this.fire(new a.z("rotate",u)),this._pitching&&this.fire(new a.z("pitch",u))}_afterEase(u,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const b=this._zooming,A=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new a.z("zoomend",u)),A&&this.fire(new a.z("rotateend",u)),M&&this.fire(new a.z("pitchend",u)),this.fire(new a.z("moveend",u))}flyTo(u,p){if(this._prefersReducedMotion(u)){const ee=a.aH(u,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ee,p)}this.stop(),u=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:a.eU},u);const b=this.transform,A=this.getZoom(),M=this.getBearing(),P=this.getPitch(),O=this.getPadding(),B="zoom"in u?a.aA(+u.zoom,b.minZoom,b.maxZoom):A,G="bearing"in u?this._normalizeBearing(u.bearing,M):M,j="pitch"in u?+u.pitch:P,X=this._extendPadding(u.padding),W=b.zoomScale(B-A),K=a.P.convert(u.offset);let tt=b.centerPoint.add(K);const rt=b.pointLocation(tt),ht=a.aS.convert(u.center||rt);this._normalizeCenter(ht);const st=b.project(rt),gt=b.project(ht).sub(st);let xt=u.curve;const vt=Math.max(b.width,b.height),Pt=vt/W,wt=gt.mag();if("minZoom"in u){const ee=a.aA(Math.min(u.minZoom,A,B),b.minZoom,b.maxZoom),Ae=vt/b.zoomScale(ee-A);xt=Math.sqrt(Ae/wt*2)}const Rt=xt*xt;function Mt(ee){const Ae=(Pt*Pt-vt*vt+(ee?-1:1)*Rt*Rt*wt*wt)/(2*(ee?Pt:vt)*Rt*wt);return Math.log(Math.sqrt(Ae*Ae+1)-Ae)}function At(ee){return(Math.exp(ee)-Math.exp(-ee))/2}function kt(ee){return(Math.exp(ee)+Math.exp(-ee))/2}const qt=Mt(0);let jt=function(ee){return kt(qt)/kt(qt+xt*ee)},oe=function(ee){return vt*((kt(qt)*(At(Ae=qt+xt*ee)/kt(Ae))-At(qt))/Rt)/wt;var Ae},te=(Mt(1)-qt)/xt;if(Math.abs(wt)<1e-6||!isFinite(te)){if(Math.abs(vt-Pt)<1e-6)return this.easeTo(u,p);const ee=Pt<vt?-1:1;te=Math.abs(Math.log(Pt/vt))/xt,oe=function(){return 0},jt=function(Ae){return Math.exp(ee*xt*Ae)}}u.duration="duration"in u?+u.duration:1e3*te/("screenSpeed"in u?+u.screenSpeed/xt:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0);const fe=M!==G,ze=j!==P,Qt=!b.isPaddingEqual(X),Gt=u.retainPadding===!1?b.clone():b,pe=ee=>Ae=>{const Ge=Ae*te,ui=1/jt(Ge);ee.zoom=Ae===1?B:A+ee.scaleZoom(ui),fe&&(ee.bearing=a.ak(M,G,Ae)),ze&&(ee.pitch=a.ak(P,j,Ae)),Qt&&(Gt.interpolatePadding(O,X,Ae),tt=Gt.centerPoint.add(K));const Le=Ae===1?ht:ee.unproject(st.add(gt.mult(oe(Ge))).mult(ui));return ee.setLocationAtPoint(ee.renderWorldCopies?Le.wrap():Le,tt),ee._updateCameraOnTerrain(),u.preloadOnly||this._fireMoveEvents(p),ee};if(u.preloadOnly){const ee=this._emulate(pe,u.duration,b);return this._preloadTiles(ee),this}return this._zooming=!0,this._rotating=fe,this._pitching=ze,this._padding=Qt,this._prepareEase(p,!1),this._ease(pe(b),()=>this._afterEase(p),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(u){}_cancelRenderFrame(u){}_stop(u,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const b=this._onEaseEnd;this._onEaseEnd=void 0,b.call(this,p)}if(!u){const b=this.handlers;b&&b.stop(!1)}return this}_ease(u,p,b){b.animate===!1||b.duration===0?(u(1),p()):(this._easeStart=a.o.now(),this._easeOptions=b,this._onEaseFrame=u,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const u=Math.min((a.o.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(u,p){u=a.bS(u,-180,180);const b=Math.abs(u-p);return Math.abs(u-360-p)<b&&(u-=360),Math.abs(u+360-p)<b&&(u+=360),u}_normalizeCenter(u){const p=this.transform;if(p.maxBounds||p.projection.name!=="globe"&&!p.renderWorldCopies)return;const b=u.lng-p.center.lng;u.lng+=b>180?-360:b<-180?360:0}_prefersReducedMotion(u){return this._respectPrefersReducedMotion&&a.o.prefersReducedMotion&&!(u&&u.essential)}_emulate(u,p,b){const A=Math.ceil(15*p/1e3),M=[],P=u(b.clone());for(let O=0;O<=A;O++){const B=P(O/A);M.push(B.clone())}return M}_preloadTiles(u,p){}}class Mf{constructor(u={}){this.options=u,a.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(u){const p=this.options&&this.options.compact,b=u._getUIString("AttributionControl.ToggleAttribution");this._map=u,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=E("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",b);const A=E("span","mapboxgl-ctrl-icon",this._compactButton);return A.setAttribute("aria-hidden","true"),A.setAttribute("title",b),this._innerContainer=E("div","mapboxgl-ctrl-attrib-inner",this._container),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(u){const b=p.reduce((A,M,P)=>(M.value&&(A+=`${M.key}=${M.value}${P<p.length-1?"&":""}`),A),"?");u.href=`${a.e.FEEDBACK_URL}/${b}#${R_(this._map,!0)}`,u.rel="noopener nofollow"}}_updateData(u){!u||(u.dataType!=="source"||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility")&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let u=[];if(this._map.style.stylesheet){const A=this._map.style.stylesheet;this.styleOwner=A.owner,this.styleId=A.id}const p=this._map.style._mergedSourceCaches;for(const A in p){const M=p[A];if(M.used){const P=M.getSource();P.attribution&&u.indexOf(P.attribution)<0&&u.push(P.attribution)}}u.sort((A,M)=>A.length-M.length),u=u.filter((A,M)=>{for(let P=M+1;P<u.length;P++)if(u[P].indexOf(A)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=[...this.options.customAttribution,...u]:u.unshift(this.options.customAttribution));const b=u.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,u.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fg{constructor(){a.aX(["_updateLogo","_updateCompact"],this)}onAdd(u){this._map=u,this._container=E("div","mapboxgl-ctrl");const p=E("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const u=this._map.style._sourceCaches;if(Object.entries(u).length===0)return!0;for(const p in u){const b=u[p].getSource();if(b.hasOwnProperty("mapbox_logo")&&!b.mapbox_logo)return!1}return!0}_updateCompact(){const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class p1{constructor(){a.aX(["_onIndoorUpdate"],this)}onAdd(u){return this._map=u,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",p=>this._onIndoorUpdate(p)),this._container}_createButton(u,p){const b=E("button",u,this._container);return b.type="button",b.addEventListener("click",p),b}_createSeparator(){return E("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(u,p){this._map&&(u.setAttribute("aria-label",p),u.textContent=p)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(u){if(!u||!u.floors)return this._model=u,void(this._container.style.display="none");const p=this._model;this._model=u,this._container.style.display="inline-block",this._container.style.borderRadius="8px",p&&Array.from(this._container.children).forEach(b=>b.remove()),u.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(u.floors,u.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const u=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const p=this._map;this._model&&p&&p._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});E("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&u.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(u),this._createSeparator()}_updateBuildingsButtonState(){const u=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");u&&this._model&&(this._model.activeFloorsVisible?u.classList.remove("mapboxgl-ctrl-level-button-selected"):u.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(u,p){for(let b=0;b<u.length;b++){const A=u[b],M=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(A.id)});this._setButtonTitle(M,A.zIndex.toString()),this._model&&A.id===this._model.selectedFloorId&&p&&M.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(M),b<u.length-1&&this._createSeparator()}}}class ZT{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const p=++this._id;return this._queue.push({callback:u,id:p,cancelled:!1}),p}remove(u){const p=this._currentlyRunning,b=p?this._queue.concat(p):this._queue;for(const A of b)if(A.id===u)return void(A.cancelled=!0)}run(u=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const b of p)if(!b.cancelled&&(b.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Ng{constructor(u){this.jumpTo(u)}getValue(u){if(u<=this._startTime)return this._start;if(u>=this._endTime)return this._end;const p=a.dC((u-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(u){return u>=this._startTime&&u<=this._endTime}jumpTo(u){this._startTime=-1/0,this._endTime=-1/0,this._start=u,this._end=u}easeTo(u,p,b){this._start=this.getValue(p),this._end=u,this._startTime=p,this._endTime=p+b}}const vD={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class qT extends a.z{constructor(u,p,b,A){const{point:M,lngLat:P,originalEvent:O,target:B}=u;super(u.type,{point:M,lngLat:P,originalEvent:O,target:B}),this.preventDefault=()=>{u.preventDefault()},this.id=p,this.interaction=b,this.feature=A}}class g1{constructor(u){this.map=u,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(u,p){if(this.typeById.has(u))throw new Error(`Interaction id "${u}" already exists.`);const b=p.filter;let A=p.type;b&&this.filters.set(u,a.b5(b)),A==="mouseover"&&(A="mouseenter"),A==="mouseout"&&(A="mouseleave");const M=this.interactionsByType.get(A)||new Map;A==="mouseenter"||A==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(u,p)):M.size===0&&this.map.on(A,this.handleType),M.size===0&&this.interactionsByType.set(A,M),M.set(u,p),this.typeById.set(u,A)}get(u){const p=this.typeById.get(u);if(!p)return;const b=this.interactionsByType.get(p);return b?b.get(u):void 0}remove(u){const p=this.typeById.get(u);if(!p)return;this.typeById.delete(u),this.filters.delete(u);const b=this.interactionsByType.get(p);b&&(b.delete(u),p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.delete(u),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):b.size===0&&this.map.off(p,this.handleType))}queryTargets(u,p){const b=[];for(const[A,M]of p)M.target&&b.push({targetId:A,target:M.target,filter:this.filters.get(A)});return this.map.style.queryRenderedTargets(u,b,this.map.transform)}handleMove(u){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const p=this.queryTargets(u.point,Array.from(this.delegatedInteractions).reverse());p.length&&(u.type="mouseenter",this.handleType(u,p));const b=new Map;for(const[A,{feature:M}]of this.prevHoveredFeatures)this.hoveredFeatures.has(A)||b.set(M.id,M);b.size&&(u.type="mouseleave",this.handleType(u,Array.from(b.values())))}handleOut(u){const p=Array.from(this.hoveredFeatures.values()).map(({feature:b})=>b);p.length&&(u.type="mouseleave",this.handleType(u,p)),this.hoveredFeatures.clear()}handleType(u,p){const b=u.type==="mouseenter";if(b&&!this.interactionsByType.has(u.type))return void a.w("mouseenter interaction required for mouseleave to work.");const A=Array.from(this.interactionsByType.get(u.type)).reverse(),M=!!p;p=p||this.queryTargets(u.point,A);let P=!1;const O=new Set;for(const B of p){for(const[G,j]of A){if(!j.target)continue;const X=B.variants?B.variants[G]:null;if(X){for(const W of X){if(bs(W,B,O,G))continue;const K=new a.dw(B,W),tt=Bl(W,B,G);M&&K.id!==void 0&&(K.state=this.map.getFeatureState(K));const rt=b?this.prevHoveredFeatures.get(tt):null,ht=new qT(u,G,j,K),st=rt?rt.stop:j.handler(ht);if(b&&this.hoveredFeatures.set(tt,{feature:B,stop:st}),st!==!1){P=!0;break}}if(P)break}}if(P)break}if(!P)for(const[B,G]of A){const{handler:j,target:X}=G;if(!X&&j(new qT(u,B,G,null))!==!1)break}}}function m1(x,u){if(Array.isArray(x)&&Array.isArray(u)){const p=new Set(x),b=new Set(u);return p.size===b.size&&x.every(A=>b.has(A))}return a.bx(x,u)}const G_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},H_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vg{constructor(u,p,b=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new B_({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,b&&(this.mousePitch=new c1({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),a.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(u,p){this.mouseRotate.mousedown(u,p),this.mousePitch&&this.mousePitch.mousedown(u,p),H()}move(u,p){const b=this.map,A=this.mouseRotate.mousemoveWindow(u,p),M=A&&A.bearingDelta;if(M&&b.setBearing(b.getBearing()+M),this.mousePitch){const P=this.mousePitch.mousemoveWindow(u,p),O=P&&P.pitchDelta;O&&b.setPitch(b.getPitch()+O)}}off(){const u=this.element;u.removeEventListener("mousedown",this.mousedown),u.removeEventListener("touchstart",this.touchstart),u.removeEventListener("touchmove",this.touchmove),u.removeEventListener("touchend",this.touchend),u.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(u){this.down(Object.assign({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),it(this.element,u)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(u){this.move(u,it(this.element,u))}mouseup(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()}touchstart(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=at(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>u.preventDefault()},this._startPos))}touchmove(u){u.targetTouches.length!==1?this.reset():(this._lastPos=at(this.element,u.targetTouches)[0],this.move({preventDefault:()=>u.preventDefault()},this._lastPos))}touchend(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Xu(x,u,p){if(x=new a.aS(x.lng,x.lat),u){const b=new a.aS(x.lng-360,x.lat),A=new a.aS(x.lng+360,x.lat),M=360*Math.ceil(Math.abs(x.lng-p.center.lng)/360),P=p.locationPoint3D(x).distSqr(u),O=u.x<0||u.y<0||u.x>p.width||u.y>p.height;p.locationPoint3D(b).distSqr(u)<P&&(O||Math.abs(b.lng-p.center.lng)<M)?x=b:p.locationPoint3D(A).distSqr(u)<P&&(O||Math.abs(A.lng-p.center.lng)<M)&&(x=A)}for(;Math.abs(x.lng-p.center.lng)>180;){const b=p.locationPoint3D(x);if(b.x>=0&&b.y>=0&&b.x<=p.width&&b.y<=p.height)break;x.lng>p.center.lng?x.lng-=360:x.lng+=360}return x}const Nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Mo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Yu extends a.E{constructor(u,p){super(),(u instanceof HTMLElement||p)&&(u=Object.assign({element:u},p)),a.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:b="center",color:A="#3FB1CE",scale:M=1,draggable:P=!1,clickTolerance:O=0,rotation:B=Mo.rotation,rotationAlignment:G=Mo.rotationAlignment,pitchAlignment:j=Mo.pitchAlignment,occludedOpacity:X=Mo.occludedOpacity,altitude:W=Mo.altitude}=u||{};this._anchor=b,this._color=A,this._scale=M,this._draggable=P,this._clickTolerance=O,this._rotation=B,this._rotationAlignment=G,this._pitchAlignment=j,this._occludedOpacity=X,this._altitude=W,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),u&&u.element?(this._element=u.element,this._offset=a.P.convert(u&&u.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(u&&u.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",rt=>{rt.preventDefault()}),this._element.addEventListener("mousedown",rt=>{rt.preventDefault()});const K=this._element.classList;for(const rt in Nl)K.remove(`mapboxgl-marker-anchor-${rt}`);K.add(`mapboxgl-marker-anchor-${this._anchor}`);const tt=u&&u.className?u.className.trim().split(/\s+/):[];K.add(...tt),this._popup=null}_createDefaultMarker(){const u=E("div"),p=D("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},u);if(this._altitude===0){const b=D("radialGradient",{id:"shadowGradient"},D("defs",{},p));D("stop",{offset:"10%","stop-opacity":.4},b),D("stop",{offset:"100%","stop-opacity":.05},b),D("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},p)}return D("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},p),D("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},p),D("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},p),u}addTo(u){return u===this._map||(this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._updateMoving),u.on("moveend",this._update),u.on("remove",this._clearFadeTimer),u._addMarker(this),this.setDraggable(this._draggable),this._update(),u.on("click",this._onMapClick)),this}remove(){const u=this._map;return u&&(u.off("click",this._onMapClick),u.off("move",this._updateMoving),u.off("moveend",this._update),u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler),u.off("mouseup",this._onUp),u.off("touchend",this._onUp),u.off("mousemove",this._onMove),u.off("touchmove",this._onMove),u.off("remove",this._clearFadeTimer),u._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.aS.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(u){return u===this._altitude||(this._defaultMarker&&(this._altitude===0&&u!==0||this._altitude!==0&&u===0)&&(this._element=this._createDefaultMarker()),this._altitude=u||Mo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const A=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[A,-1*(38.1-13.5+A)],"bottom-right":[-A,-1*(38.1-13.5+A)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,u._marker=this,u._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(u){const p=u.code,b=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&b!==32&&b!==13||this.togglePopup()}_onMapClick(u){const p=u.originalEvent.target,b=this._element;this._popup&&(p===b||b.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const u=this._popup;return u?(u.isOpen()?(u.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(u.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const u=this._map,p=this._pos;if(!u||!p)return!1;const b=u.unproject(p,this._altitude),A=u.getFreeCameraOptions();if(!A.position)return!1;const M=A.position.toLngLat();return M.distanceTo(b)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const u=this._map;if(!u)return;const p=this._pos;if(!p||p.x<0||p.x>u.transform.width||p.y<0||p.y>u.transform.height)return void this._clearFadeTimer();const b=u.unproject(p,this._altitude);let A;u._showingGlobe()&&a.f4(u.transform,this._lngLat)?A=0:(A=1-u._queryFogOpacity(b),u.transform._terrainEnabled()&&u.getTerrain()&&this._behindTerrain()&&(A*=this._occludedOpacity)),this._element.style.opacity=`${A}`,this._element.style.pointerEvents=A>0?"auto":"none",this._popup&&this._popup._setOpacity(A),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const u=this._pos;if(!u||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${u.x}px,${u.y}px)
            ${Nl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){const u=this._pos,p=this._map,b=this.getPitchAlignment();if(!p||!u||b!=="map")return"";if(!p._showingGlobe()){const B=p.getPitch();return B?`rotateX(${B}deg)`:""}const A=a.cW(a.f5(p.transform,this._lngLat)),M=u.sub(a.f6(p.transform)),P=Math.abs(M.x)+Math.abs(M.y);if(P===0)return"";const O=A/P;return`rotateX(${-M.y*O}deg) rotateY(${M.x*O}deg)`}_calculateZTransform(){const u=this._pos,p=this._map;if(!p||!u)return"";let b=0;const A=this.getRotationAlignment();if(A==="map")if(p._showingGlobe()){const M=p.project(new a.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),P=p.project(new a.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(M);b=a.cW(Math.atan2(P.y,P.x))-90}else b=-p.getBearing();else if(A==="horizon"){const M=a.ah(4,6,p.getZoom()),P=a.f6(p.transform);P.y+=M*p.transform.height;const O=u.sub(P),B=a.cW(Math.atan2(O.y,O.x));b=(B>90?B-270:B+90)*(1-M)}return b+=this._rotation,b?`rotateZ(${b}deg)`:""}_update(u){cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=Xu(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat,this._altitude),u===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(u){return this._offset=a.P.convert(u),this._update(),this}addClassName(u){return this._element.classList.add(u),this}removeClassName(u){return this._element.classList.remove(u),this}toggleClassName(u){return this._element.classList.toggle(u)}_onMove(u){const p=this._map;if(!p)return;const b=this._pointerdownPos,A=this._positionDelta;if(b&&A){if(!this._isDragging){const M=this._clickTolerance||p._clickTolerance;if(u.point.dist(b)<M)return;this._isDragging=!0}this._pos=u.point.sub(A),this._lngLat=p.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.z("dragstart"))),this.fire(new a.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const u=this._map;u&&(u.off("mousemove",this._onMove),u.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.z("dragend")),this._state="inactive"}_addDragHandler(u){const p=this._map,b=this._pos;p&&b&&this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(b),this._pointerdownPos=u.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(u){this._draggable=!!u;const p=this._map;return p&&(u?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||Mo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||Mo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u||Mo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(u){return this._occludedOpacity=u||Mo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_D={maxWidth:100,unit:"metric"},yD={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},xD={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},bD=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function v1(x=new a.P(0,0),u="bottom"){if(typeof x=="number"){const p=Math.round(Math.sqrt(.5*Math.pow(x,2)));switch(u){case"top":return new a.P(0,x);case"top-left":return new a.P(p,p);case"top-right":return new a.P(-p,p);case"bottom":return new a.P(0,-x);case"bottom-left":return new a.P(p,-p);case"bottom-right":return new a.P(-p,-p);case"left":return new a.P(x,0);case"right":return new a.P(-x,0)}return new a.P(0,0)}return x instanceof a.P||Array.isArray(x)?a.P.convert(x):a.P.convert(x[u]||[0,0])}return{version:c,supported:I.supported,setRTLTextPlugin:a.fa,getRTLTextPluginStatus:a.f9,Map:class extends du{constructor(x){g.mark(f.create);const u=x;if((x=Object.assign({},G_,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(x.antialias&&a.f2(window)&&(x.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tf(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies,null,null),x),this._repaint=!!x.repaint,this._interactive=x.interactive,this._minTileCacheSize=x.minTileCacheSize,this._maxTileCacheSize=x.maxTileCacheSize,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=x.crossSourceCollisions,this._collectResourceTiming=x.collectResourceTiming,this._language=this._parseLanguage(x.language),this._worldview=x.worldview,this._renderTaskQueue=new ZT,this._domRenderTaskQueue=new ZT,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.b1(),this._locale=Object.assign({},vD,x.locale),this._clickTolerance=x.clickTolerance,this._cooperativeGestures=x.cooperativeGestures,this._performanceMetricsCollection=x.performanceMetricsCollection,this._tessellationStep=x.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=x.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Ng(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=x.scaleFactor,this._requestManager=new Dt(x.transformRequest,x.accessToken,x.testMode),this._silenceAuthErrors=!!x.testMode,this._contextCreateOptions=x.contextCreateOptions?Object.assign({},x.contextCreateOptions):{},typeof x.container=="string"){const p=document.getElementById(x.container);if(!p)throw new Error(`Container '${x.container.toString()}' not found.`);this._container=p}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),x.maxBounds&&this.setMaxBounds(x.maxBounds),this._spriteFormat=x.spriteFormat,a.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new cD),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new U_(this,x),this._localFontFamily=x.localFontFamily,this._localIdeographFontFamily=x.localIdeographFontFamily,(x.style||!x.testMode)&&this.setStyle(x.style||a.e.DEFAULT_STYLE,{config:x.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),x.projection&&this.setProjection(x.projection),x.hash&&(this._hash=new L_(typeof x.hash=="string"&&x.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){u.center==null&&u.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch});const p=x.bounds;p&&(this.resize(),this.fitBounds(p,Object.assign({},x.fitBoundsOptions,{duration:0})))}this.resize(),x.attributionControl&&this.addControl(new Mf({customAttribution:x.customAttribution})),this._logoControl=new Fg,this.addControl(this._logoControl,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",p=>{this._update(p.dataType==="style"),this.fire(new a.z(`${p.dataType}data`,p))}),this.on("dataloading",p=>{this.fire(new a.z(`${p.dataType}dataloading`,p))}),this._interactions=new g1(this)}_getMapId(){return this._mapId}addControl(x,u){if(u===void 0&&(u=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=x.onAdd(this);this._controls.push(x);const b=this._controlPositions[u];return u.indexOf("bottom")!==-1?b.insertBefore(p,b.firstChild):b.appendChild(p),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(x);return u>-1&&this._controls.splice(u,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(x){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const u=!this._moving;return u&&this.fire(new a.z("movestart",x)).fire(new a.z("move",x)),this.fire(new a.z("resize",x)),u&&this.fire(new a.z("moveend",x)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(x){return this.transform.setMaxBounds(a.aI.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x?this.setZoom(x):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x?this.setZoom(x):this.fire(new a.z("zoomstart")).fire(new a.z("zoom")).fire(new a.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x?this.setPitch(x):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x?this.setPitch(x):this.fire(new a.z("pitchstart")).fire(new a.z("pitch")).fire(new a.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(x){return this._scaleFactor=x,this.painter.scaleFactor=x,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(u=>u.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(x){return x==="auto"?navigator.language:Array.isArray(x)?x.length===0?void 0:x.map(u=>u==="auto"?navigator.language:u):x}setLanguage(x){const u=this._parseLanguage(x);if(!this.style||u===this._language)return this;this._language=u,this.style.reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(x){return this.style&&x!==this._worldview?(this._worldview=x,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(x){return this._lazyInitEmptyStyle(),x?typeof x=="string"&&(x={name:x}):x=null,this._useExplicitProjection=!!x,this._prioritizeAndUpdateProjection(x,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const x=this.transform,u=x.projection.name;let p;u==="globe"&&x.zoom>=a.cK?(x.setMercatorFromTransition(),p=!0):u==="mercator"&&x.zoom<a.cK&&(x.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(x,u){return this._updateProjection(x||u||{name:"mercator"})}_updateProjection(x){let u;const p=this.transform.mercatorFromTransition;u=x.name==="globe"&&this.transform.zoom>=a.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(x),this.style.applyProjectionUpdate();const b=this.transform.getProjection().name==="mercator"&&p!==this.transform.mercatorFromTransition;return(u||b)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(x,u){return this.transform.locationPoint3D(a.aS.convert(x),u)}unproject(x,u){return this.transform.pointLocation3D(a.P.convert(x),u)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(x,u,p){const b=A=>{let M=[];if(Array.isArray(u)){const P=u.filter(O=>this.getLayer(O));M=P.length?this.queryRenderedFeatures(A,{layers:P}):[]}else M=this.queryRenderedFeatures(A,{target:u});return M};if(x==="mouseenter"||x==="mouseover"){let A=!1;return{listener:p,targets:u,delegates:{mousemove:P=>{const O=b(P.point);O.length?A||(A=!0,p.call(this,new Ln(x,this,P.originalEvent,{features:O}))):A=!1},mouseout:()=>{A=!1}}}}if(x==="mouseleave"||x==="mouseout"){let A=!1;return{listener:p,targets:u,delegates:{mousemove:O=>{b(O.point).length?A=!0:A&&(A=!1,p.call(this,new Ln(x,this,O.originalEvent)))},mouseout:O=>{A&&(A=!1,p.call(this,new Ln(x,this,O.originalEvent)))}}}}{const A=M=>{const P=b(M.point);P.length&&(M.features=P,p.call(this,M),delete M.features)};return{listener:p,targets:u,delegates:{[x]:A}}}}on(x,u,p){if(typeof u=="function"||p===void 0)return super.on(x,u);if(typeof u=="string"&&(u=[u]),!this._areTargetsValid(u))return this;const b=this._createDelegatedListener(x,u,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(b);for(const A in b.delegates)this.on(A,b.delegates[A]);return this}once(x,u,p){if(typeof u=="function"||p===void 0)return super.once(x,u);if(typeof u=="string"&&(u=[u]),!this._areTargetsValid(u))return this;const b=this._createDelegatedListener(x,u,p);for(const A in b.delegates)this.once(A,b.delegates[A]);return this}off(x,u,p){if(typeof u=="function"||p===void 0)return super.off(x,u);if(typeof u=="string"&&(u=[u]),!this._areTargetsValid(u))return this;const b=this._delegatedListeners?this._delegatedListeners[x]:void 0;return b&&(A=>{for(let M=0;M<A.length;M++){const P=A[M];if(P.listener===p&&m1(P.targets,u)){for(const O in P.delegates)this.off(O,P.delegates[O]);return A.splice(M,1),this}}})(b),this}queryRenderedFeatures(x,u){if(!this.style)return[];if(x===void 0||x instanceof a.P||Array.isArray(x)||u!==void 0||(u=x,x=void 0),x=x||[[0,0],[this.transform.width,this.transform.height]],!u){const M=this.style.queryRenderedFeatures(x,void 0,this.transform),P=this.style.queryRenderedFeatureset(x,void 0,this.transform);return M.concat(P)}let p=!0;if(u.target&&(p=this._isTargetValid(u.target),p&&!u.layers))return this.style.queryRenderedFeatureset(x,u,this.transform);let b=!0;if(u.layers&&Array.isArray(u.layers)){for(const M of u.layers)if(!this._isValidId(M)){b=!1;break}if(b&&!u.target)return this.style.queryRenderedFeatures(x,u,this.transform)}let A=[];return b&&(A=A.concat(this.style.queryRenderedFeatures(x,u,this.transform))),p&&(A=A.concat(this.style.queryRenderedFeatureset(x,u,this.transform))),A}querySourceFeatures(x,u){return!x||typeof x=="string"&&!this._isValidId(x)?[]:this.style.querySourceFeatures(x,u)}queryRasterValue(x,u,p){return this._isValidId(x)?this.style.queryRasterValue(x,u,p):Promise.resolve(null)}isPointOnSurface(x){const{name:u}=this.transform.projection;return u!=="globe"&&u!=="mercator"&&a.w(`${u} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(x))}addInteraction(x,u){return this._interactions.add(x,u),this}removeInteraction(x){return this._interactions.remove(x),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(x){return this._cooperativeGestures=x,this}setStyle(x,u){return u=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},u),this.style&&x&&u.diff!==!1&&u.localFontFamily===this._localFontFamily&&u.localIdeographFontFamily===this._localIdeographFontFamily&&!u.config?(this.style._diffStyle(x,(p,b)=>{if(p){const A=typeof p=="string"?p:p instanceof Error?p.message:p.error;a.w(`Unable to perform style diff: ${A}. Rebuilding the style from scratch.`),this._updateStyle(x,u)}else b&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._localFontFamily=u.localFontFamily,this._updateStyle(x,u))}_getUIString(x){const u=this._locale[x];if(u==null)throw new Error(`Missing UI string '${x}'`);return u}_updateStyle(x,u){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),x){const p=Object.assign({},u);u&&u.config&&(p.initialConfig=u.config,delete p.config),this.style=new wl(this,p).load(x),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(x){return x==null?(this.fire(new a.y(new Error("IDs can't be empty."))),!1):!a.dq(x)||(this.fire(new a.y(new Error(`IDs can't contain special symbols: "${x}".`))),!1)}_isTargetValid(x){return"featuresetId"in x?this._isValidId("importId"in x?x.importId:x.featuresetId):"layerId"in x&&this._isValidId(x.layerId)}_areTargetsValid(x){if(Array.isArray(x)){for(const u of x)if(!this._isValidId(u))return!1;return!0}return this._isTargetValid(x)}addSource(x,u){return this._isValidId(x)?(this._lazyInitEmptyStyle(),this.style.addSource(x,u),this._update(!0)):this}isSourceLoaded(x){return!!this._isValidId(x)&&!!this.style&&this.style._isSourceCacheLoaded(x)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(x,u,p){this._lazyInitEmptyStyle(),this.style.addSourceType(x,u,p)}removeSource(x){return this._isValidId(x)?(this.style.removeSource(x),this._updateTerrain(),this._update(!0)):this}getSource(x){return this._isValidId(x)?this.style.getOwnSource(x):null}addImage(x,u,{pixelRatio:p=1,sdf:b=!1,stretchX:A,stretchY:M,content:P}={}){this._lazyInitEmptyStyle();const O=a.I.from(x);if(u instanceof HTMLImageElement||ImageBitmap&&u instanceof ImageBitmap){const{width:B,height:G,data:j}=a.o.getImageData(u);this.style.addImage(O,{data:new a.q({width:B,height:G},j),pixelRatio:p,stretchX:A,stretchY:M,content:P,sdf:b,version:0,usvg:!1})}else if(u.width===void 0||u.height===void 0)this.fire(new a.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:B,height:G}=u,j=u;this.style.addImage(O,{data:new a.q({width:B,height:G},new Uint8Array(j.data)),pixelRatio:p,stretchX:A,stretchY:M,content:P,sdf:b,usvg:!1,version:0,userImage:j}),j.onAdd&&j.onAdd(this,x)}}updateImage(x,u){this._lazyInitEmptyStyle();const p=a.I.from(x),b=this.style.getImage(p);if(!b)return void this.fire(new a.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const A=u instanceof HTMLImageElement||ImageBitmap&&u instanceof ImageBitmap?a.o.getImageData(u):u,{width:M,height:P,data:O}=A;if(M===void 0||P===void 0)return void this.fire(new a.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==(b.usvg?b.icon.usvg_tree.width:b.data.width)||P!==(b.usvg?b.icon.usvg_tree.height:b.data.height))return void this.fire(new a.y(new Error(`The width and height of the updated image (${M}, ${P})
                must be that same as the previous version of the image
                (${b.data.width}, ${b.data.height})`)));const B=!(u instanceof HTMLImageElement||ImageBitmap&&u instanceof ImageBitmap);let G=!1;b.usvg?(b.data=new a.q({width:M,height:P},new Uint8Array(O)),b.usvg=!1,b.icon=void 0,G=!0):b.data.replace(O,B),this.style.updateImage(p,b,G)}hasImage(x){return x?!!this.style&&!!this.style.getImage(a.I.from(x)):(this.fire(new a.y(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(a.I.from(x))}loadImage(x,u){a.n(this._requestManager.transformRequest(x,a.R.Image),(p,b)=>{u(p,b instanceof HTMLImageElement?a.o.getImageData(b):b)})}listImages(){return this.style.listImages().map(x=>x.name)}addModel(x,u){this._lazyInitEmptyStyle(),this.style.addModel(x,u)}hasModel(x){return x?this.style.hasModel(x):(this.fire(new a.y(new Error("Missing required model id"))),!1)}removeModel(x){this.style.removeModel(x)}listModels(){return this.style.listModels()}addLayer(x,u){return this._isValidId(x.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(x,u),this._update(!0)):this}getSlot(x){const u=this.getLayer(x);return u&&u.slot||null}setSlot(x,u){return this.style.setSlot(x,u),this.style.mergeLayers(),this._update(!0)}addImport(x,u){return this.style.addImport(x,u).catch(p=>this.fire(new a.y(new Error("Failed to add import",p)))),this}updateImport(x,u){return typeof u!="string"&&u.id!==x?(this.removeImport(x),this.addImport(u)):(this.style.updateImport(x,u),this._update(!0))}removeImport(x){return this.style.removeImport(x),this}moveImport(x,u){return this.style.moveImport(x,u),this._update(!0)}moveLayer(x,u){return this._isValidId(x)?(this.style.moveLayer(x,u),this._update(!0)):this}removeLayer(x){return this._isValidId(x)?(this.style.removeLayer(x),this._update(!0)):this}getLayer(x){if(!this._isValidId(x))return null;const u=this.style.getOwnLayer(x);return u?u.type==="custom"?u.implementation:u.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(x,u,p){return this._isValidId(x)?(this.style.setLayerZoomRange(x,u,p),this._update(!0)):this}setFilter(x,u,p={}){return this._isValidId(x)?(this.style.setFilter(x,u,p),this._update(!0)):this}getFilter(x){return this._isValidId(x)?this.style.getFilter(x):null}setPaintProperty(x,u,p,b={}){return this._isValidId(x)?(this.style.setPaintProperty(x,u,p,b),this._update(!0)):this}getPaintProperty(x,u){return this._isValidId(x)?this.style.getPaintProperty(x,u):null}setLayoutProperty(x,u,p,b={}){return this._isValidId(x)?(this.style.setLayoutProperty(x,u,p,b),this._update(!0)):this}getLayoutProperty(x,u){return this._isValidId(x)?this.style.getLayoutProperty(x,u):null}setLayerProperty(x,u,p,b={}){return this._isValidId(x)?(this.style.setLayerProperty(x,u,p,b),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(x){return this.style.setGlyphsUrl(x),this._update(!0)}getSchema(x){return this.style.getSchema(x)}setSchema(x,u){return this.style.setSchema(x,u),this._update(!0)}getConfig(x){return this.style.getConfig(x)}setConfig(x,u){return this.style.setConfig(x,u),this._update(!0)}getConfigProperty(x,u){return this.style.getConfigProperty(x,u)}setConfigProperty(x,u,p){return this.style.setConfigProperty(x,u,p),this._update(!0)}getFeaturesetDescriptors(x){return this.style.getFeaturesetDescriptors(x)}setLights(x){if(this._lazyInitEmptyStyle(),x&&x.length===1&&x[0].type==="flat"){const u=x[0];u.properties?this.style.setFlatLight(u.properties,u.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(x),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const x=this.style.getLights()||[];return x.length===0&&x.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),x}setLight(x,u={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:x}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(x){return this._lazyInitEmptyStyle(),!x&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(x),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(x){return this._lazyInitEmptyStyle(),this.style.setFog(x),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(x){return this._lazyInitEmptyStyle(),this.style.setSnow(x),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(x){return this._lazyInitEmptyStyle(),this.style.setRain(x),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(x){return this._lazyInitEmptyStyle(),this.style.setColorTheme(x),this._update(!0)}setImportColorTheme(x,u){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(x,u),this._update(!0)}setCamera(x){return this.style.setCamera(x),this._triggerCameraUpdate(x)}_triggerCameraUpdate(x){return this._update(this.transform.setOrthographicProjectionAtLowPitch(x["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(x){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aS.convert(x),this.transform):0}setFeatureState(x,u){return x.source&&!this._isValidId(x.source)?this:(this.style.setFeatureState(x,u),this._update())}removeFeatureState(x,u){return x.source&&!this._isValidId(x.source)?this:(this.style.removeFeatureState(x,u),this._update())}getFeatureState(x){return x.source&&!this._isValidId(x.source)?null:this.style.getFeatureState(x)}_selectIndoorFloor(x){this.indoor.selectFloor(x)}_setIndoorActiveFloorsVisibility(x){this.indoor.setActiveFloorsVisibility(x)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new p1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const x=this._container.getBoundingClientRect().width||400,u=this._container.getBoundingClientRect().height||300;let p,b,A,M=this._container;for(;M&&(!b||!A);){const P=window.getComputedStyle(M).transform;P&&P!=="none"&&(p=P.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&p[0]!=="0"&&p[0]!=="1"&&(b=p[0]),p[3]&&p[3]!=="0"&&p[3]!=="1"&&(A=p[3])),M=M.parentElement}this._containerWidth=b?Math.abs(x/b):x,this._containerHeight=A?Math.abs(u/A):u}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new zh(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const x=this._container;x.classList.add("mapboxgl-map"),(this._missingCSSCanary=E("div","mapboxgl-canary",x)).style.visibility="hidden",this._detectMissingCSS();const u=this._canvasContainer=E("div","mapboxgl-canvas-container",x);this._canvas=E("canvas","mapboxgl-canvas",u),this._interactive&&(u.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=E("div","mapboxgl-control-container",x),b=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(A=>{b[A]=E("div",`mapboxgl-ctrl-${A}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,u){const p=a.o.devicePixelRatio||1;this._canvas.width=p*Math.ceil(x),this._canvas.height=p*Math.ceil(u),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${u}px`}_addMarker(x){this._markers.push(x)}_removeMarker(x){const u=this._markers.indexOf(x);u!==-1&&this._markers.splice(u,1)}_addPopup(x){this._popups.push(x)}_removePopup(x){const u=this._popups.indexOf(x);u!==-1&&this._popups.splice(u,1)}_setupPainter(){const x=Object.assign({},I.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),u=this._canvas.getContext("webgl2",x);u?(Zt(u,!0),this.painter=new Oc(u,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.k.testSupport(u)):this.fire(new a.y(new Error("Failed to initialize WebGL")))}_contextLost(x){x.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.z("webglcontextlost",{originalEvent:x}))}_contextRestored(x){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.z("webglcontextrestored",{originalEvent:x}))}_onMapScroll(x){if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(x){return this.style?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_requestDomTask(x){!this.loaded()||this.loaded()&&!this.isMoving()?x():this._domRenderTaskQueue.add(x)}_render(x){let u;this.fire(new a.z("renderstart")),++this._frameId;const p=this.painter.context.extTimerQuery,b=a.o.now(),A=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(u=A.createQuery(),A.beginQuery(p.TIME_ELAPSED_EXT,u)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(x),this._domRenderTaskQueue.run(x),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,j=this.transform.pitch,X=a.o.now(),W=new a.ac(G,{now:X,fadeDuration:M,pitch:j,transition:this.style.transition,worldview:this._worldview});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let P=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),P=this._updateAverageElevation(b),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):P=this._updateAverageElevation(b);const O=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),O&&(this._placementDirty=O.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,g.mark(f.load),this.fire(new a.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),u){const G=a.o.now()-b;A.endQuery(p.TIME_ELAPSED_EXT),setTimeout(()=>{const j=A.getQueryParameter(u,A.QUERY_RESULT)/1e6;A.deleteQuery(u),this.fire(new a.z("gpu-timing-frame",{cpuTime:G,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(G);this.fire(new a.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(G);this.fire(new a.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||P;if(B||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(P=this._updateAverageElevation(b,!0)),P)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new a.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new a.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,g.mark(f.fullLoad),this._performanceMetricsCollection&&Ke(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(x){for(const u of this._markers)x&&!this.getRenderWorldCopies()&&(u._lngLat=u._lngLat.wrap()),u._update();for(const u of this._popups)!x||this.getRenderWorldCopies()||u._trackPointer||(u._lngLat=u._lngLat.wrap()),u._update()}_updateAverageElevation(x,u=!1){const p=A=>(this.transform.averageElevation=A,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&p(0);const b=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(b||(u||x-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(x)){const A=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=x;const P=Math.abs(A-M);if(P>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(M),p(M);this._averageElevation.easeTo(M,x,300)}else if(P>1e-4)return this._averageElevation.jumpTo(M),p(M)}return!!this._averageElevation.isEasing(x)&&p(this._averageElevation.getValue(x))}_authenticate(){Ti(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,x=>{if(x&&(x.message===ct||x.status===401)){const u=this.painter.context.gl;Zt(u,!1),this._logoControl instanceof Fg&&this._logoControl._updateLogo(),u&&u.clear(u.DEPTH_BUFFER_BIT|u.COLOR_BUFFER_BIT|u.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ni(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&or(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Ze(this._requestManager._customAccessToken)}_updateTerrain(){const x=this._isDragging();this.painter.updateTerrain(this.style,x)}_calculateSpeedIndex(){const x=this.painter.canvasCopy(),u=this.painter.getCanvasCopiesAndTimestamps();u.timeStamps.push(performance.now());const p=this.painter.context.gl,b=p.createFramebuffer();function A(M){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,M,0);const P=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,P),P}return p.bindFramebuffer(p.FRAMEBUFFER,b),this._canvasPixelComparison(A(x),u.canvasCopies.map(A),u.timeStamps)}_canvasPixelComparison(x,u,p){let b=p[1]-p[0];const A=x.length/4;for(let M=0;M<u.length;M++){const P=u[M];let O=0;for(let B=0;B<P.length;B+=4)P[B]===x[B]&&P[B+1]===x[B+1]&&P[B+2]===x[B+2]&&P[B+3]===x[B+3]&&(O+=1);b+=(p[M+2]-p[M+1])*(1-O/A)}return b}remove(){this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const x=this.painter.context.gl.getExtension("WEBGL_lose_context");x&&x.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Bt.delete(this.painter.context.gl),We.remove(),ke.remove(),this._removed=!0,this.fire(new a.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(x){this._renderNextFrame=this._renderNextFrame||x,this.style&&!this._frame&&(this._frame=a.o.frame(u=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(u)}))}_preloadTiles(x){const u=this.style?this.style.getSourceCaches():[];return a.bv(u,(p,b)=>p._preloadTiles(x,b),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(x){this._trackResize&&this.resize({originalEvent:x})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(x){this._showParseStatus!==x&&(this._showParseStatus=x,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(x){this._showTerrainWireframe!==x&&(this._showTerrainWireframe=x,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(x){this._showLayers2DWireframe!==x&&(this._showLayers2DWireframe=x,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(x){this._showLayers3DWireframe!==x&&(this._showLayers3DWireframe=x,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(x){this._speedIndexTiming!==x&&(this._speedIndexTiming=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,this._tp.refreshUI(),x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(x){this._showTileAABBs!==x&&(this._showTileAABBs=x,this._tp.refreshUI(),x&&this._update())}_setCacheLimits(x,u){a.f3(x,u)}get version(){return c}},NavigationControl:class{constructor(x={}){this.options=Object.assign({},H_,x),this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this.options.showZoom&&(a.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",u=>{this._map&&this._map.zoomIn({},{originalEvent:u})}),E("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",u=>{this._map&&this._map.zoomOut({},{originalEvent:u})}),E("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",u=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:u}):p.resetNorth({},{originalEvent:u}))}),this._compassIcon=E("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const x=this._map;if(!x)return;const u=x.getZoom(),p=u===x.getMaxZoom(),b=u===x.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())}_rotateCompassArrow(){const x=this._map;if(!x)return;const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(x.transform.pitch*(Math.PI/180)),.5)}) rotateX(${x.transform.pitch}deg) rotateZ(${x.transform.angle*(180/Math.PI)}deg)`:`rotate(${x.transform.angle*(180/Math.PI)}deg)`;x._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),x.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&x.on("pitch",this._rotateCompassArrow),x.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vg(x,this._compass,this.options.visualizePitch)),this._container}onRemove(){const x=this._map;x&&(this._container.remove(),this.options.showZoom&&x.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&x.off("pitch",this._rotateCompassArrow),x.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(x,u){const p=E("button",x,this._container);return p.type="button",p.addEventListener("click",u),p}_setButtonTitle(x,u){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${u}`);x.setAttribute("aria-label",p),x.firstElementChild&&x.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends a.E{constructor(x={}){super();const u=navigator.geolocation;this.options=Object.assign({geolocation:u},Vl,x),a.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Wh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(x){return this._map=x,this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(x){const u=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,x(p)};this._supportsGeolocation!==void 0?x(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(p=>u(p.state!=="denied")).catch(()=>u()):u()}_isOutOfMapMaxBounds(x){const u=this._map.getMaxBounds(),p=x.coords;return!!u&&(p.longitude<u.getWest()||p.longitude>u.getEast()||p.latitude<u.getSouth()||p.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(x){if(this._map){if(this._isOutOfMapMaxBounds(x))return this._setErrorState(),this.fire(new a.z("outofmaxbounds",x)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=x,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(x),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(x),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("geolocate",Object.assign({coords:x.coords,timestamp:x.timestamp},x.toJSON?{toJSON:x.toJSON.bind(x)}:{}))),this._finish()}}_updateCamera(x){const u=new a.aS(x.coords.longitude,x.coords.latitude),p=x.coords.accuracy,b=this._map.getBearing(),A=Object.assign({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(u.toBounds(p),A,{geolocateSource:!0})}_updateMarker(x){if(x){const u=new a.aS(x.coords.longitude,x.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=x.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const x=this._map.transform,u=a.ce(1,x._center.lat)*x.worldSize,p=Math.ceil(2*this._accuracy*u);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(x){if(this._map){if(this.options.trackUserLocation)if(x.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(x.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.z("error",x)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(x){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=E("button","mapboxgl-ctrl-geolocate",this._container),E("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",x===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E("div","mapboxgl-user-location"),this._dotElement.appendChild(E("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(E("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=E("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.z("trackuserlocationend")))})}}_onDeviceOrientation(x){this._userLocationDotMarker&&(x.webkitCompassHeading?this._heading=x.webkitCompassHeading:x.absolute===!0&&(this._heading=-1*x.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(x={maximumAge:6e5,timeout:0},this._noTimeout=!0):(x=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,x),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const x=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(u=>{u==="granted"&&x()}).catch(console.error):x()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mf,ScaleControl:class{constructor(x={}){this.options=Object.assign({},_D,x),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const x=this.options.maxWidth||100,u=this._map,p=u._containerHeight/2,b=u._containerWidth/2-x/2,A=u.unproject([b,p]),M=u.unproject([b+x,p]),P=A.distanceTo(M);if(this.options.unit==="imperial"){const O=3.2808*P;O>5280?this._setScale(x,O/5280,"mile"):this._setScale(x,O,"foot")}else this.options.unit==="nautical"?this._setScale(x,P/1852,"nautical-mile"):P>=1e3?this._setScale(x,P/1e3,"kilometer"):this._setScale(x,P,"meter")}_setScale(x,u,p){this._map._requestDomTask(()=>{const b=function(M){const P=Math.pow(10,`${Math.floor(M)}`.length-1);let O=M/P;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(O),P*O}(u),A=b/u;this._container.innerHTML=this._isNumberFormatSupported&&p!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:p}).format(b):`${b}&nbsp;${yD[p]}`,this._container.style.width=x*A+"px"})}onAdd(x){return this._map=x,this._language=x.getLanguage(),this._container=E("div","mapboxgl-ctrl mapboxgl-ctrl-scale",x.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(x){this._language=x,this._update()}setUnit(x){this.options.unit=x,this._update()}},FullscreenControl:class{constructor(x={}){this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),a.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=E("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const x=this._fullscreenButton=E("button","mapboxgl-ctrl-fullscreen",this._controlContainer);E("span","mapboxgl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",x)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:p1,Popup:class extends a.E{constructor(x){super(),this.options=Object.assign(Object.create(xD),x),this._altitude=this.options.altitude,a.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(x&&x.className?x.className.trim().split(/\s+/):[])}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&x.on("preclick",this._onClose),this.options.closeOnMove&&x.on("move",this._onClose),x.on("remove",this.remove),this._update(),x._addPopup(this),this._focusFirstElement(),this._trackPointer?(x.on("mousemove",this._onMouseEvent),x.on("mouseup",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")):x.on("move",this._update),this.fire(new a.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const x=this._map;return x&&(x.off("move",this._update),x.off("move",this._onClose),x.off("preclick",this._onClose),x.off("click",this._onClose),x.off("remove",this.remove),x.off("mousemove",this._onMouseEvent),x.off("mouseup",this._onMouseEvent),x.off("drag",this._onMouseEvent),x._canvasContainer&&x._canvasContainer.classList.remove("mapboxgl-track-pointer"),x._removePopup(this),this._map=void 0),this.fire(new a.z("close")),this}getLngLat(){return this._lngLat}setLngLat(x){this._lngLat=a.aS.convert(x),this._pos=null,this._trackPointer=!1,this._update();const u=this._map;return u&&(u.on("move",this._update),u.off("mousemove",this._onMouseEvent),u._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(x){return this._altitude=x,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const x=this._map;return x&&(x.off("move",this._update),x.on("mousemove",this._onMouseEvent),x.on("drag",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const u=document.createDocumentFragment(),p=document.createElement("body");let b;for(p.innerHTML=x;b=p.firstChild,b;)u.appendChild(b);return this.setDOMContent(u)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){let u=this._content;if(u)for(;u.hasChildNodes();)u.firstChild&&u.removeChild(u.firstChild);else u=this._content=E("div","mapboxgl-popup-content",this._container||void 0);if(u.appendChild(x),this.options.closeButton){const p=this._closeButton=E("button","mapboxgl-popup-close-button",u);p.type="button",p.setAttribute("aria-label","Close popup"),p.innerHTML='<span aria-hidden="true">&#215;</span>',p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(x){return this._classList.add(x),this._updateClassList(),this}removeClassName(x){return this._classList.delete(x),this._updateClassList(),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){let u;return this._classList.delete(x)?u=!1:(this._classList.add(x),u=!0),this._updateClassList(),u}_onMouseEvent(x){this._update(x.point)}_getAnchor(x){if(this.options.anchor)return this.options.anchor;const u=this._map,p=this._container,b=this._pos;if(!u||!p||!b)return"bottom";const A=p.offsetWidth,M=p.offsetHeight,P=b.x<A/2,O=b.x>u.transform.width-A/2;if(b.y+x<M)return P?"top-left":O?"top-right":"top";if(b.y>u.transform.height-M){if(P)return"bottom-left";if(O)return"bottom-right"}return P?"left":O?"right":"bottom"}_updateClassList(){const x=this._container;if(!x)return;const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),x.className=u.join(" ")}_update(x){const u=this._map,p=this._content;if(!u||!this._lngLat&&!this._trackPointer||!p)return;let b=this._container;if(b||(b=this._container=E("div","mapboxgl-popup",u.getContainer()),this._tip=E("div","mapboxgl-popup-tip",b),b.appendChild(p)),this.options.maxWidth&&b.style.maxWidth!==this.options.maxWidth&&(b.style.maxWidth=this.options.maxWidth),u.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xu(this._lngLat,this._pos,u.transform)),!this._trackPointer||x){const A=this._pos=this._trackPointer&&x instanceof a.P?x:u.project(this._lngLat,this._altitude),M=v1(this.options.offset),P=this._anchor=this._getAnchor(M.y),O=v1(this.options.offset,P),B=A.add(O).round();u._requestDomTask(()=>{this._container&&P&&(this._container.style.transform=`${Nl[P]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&u._showingGlobe()){const A=a.f4(u.transform,this._lngLat)?0:1;this._setOpacity(A)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(bD);x&&x.focus()}_onClose(){this.remove()}_setOpacity(x){this._container&&(this._container.style.opacity=`${x}`),this._content&&(this._content.style.pointerEvents=x?"auto":"none")}},Marker:Yu,Style:wl,LngLat:a.aS,LngLatBounds:a.aI,Point:a.P,MercatorCoordinate:a.ae,FreeCameraOptions:uu,Evented:a.E,config:a.e,prewarm:a.f8,clearPrewarmedResources:a.f7,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(x){a.e.ACCESS_TOKEN=x},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(x){a.e.API_URL=x},get workerCount(){return a.fh.workerCount},set workerCount(x){a.fh.workerCount=x},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(x){a.e.MAX_PARALLEL_IMAGE_REQUESTS=x},clearStorage(x){a.fg(x)},get workerUrl(){return a.ff.workerUrl},set workerUrl(x){a.ff.workerUrl=x},get workerClass(){return a.ff.workerClass},set workerClass(x){a.ff.workerClass=x},get workerParams(){return a.ff.workerParams},set workerParams(x){a.ff.workerParams=x},get dracoUrl(){return a.fe()},set dracoUrl(x){a.fd(x)},get meshoptUrl(){return a.fc()},set meshoptUrl(x){a.fb(x)},setNow:a.o.setNow,restoreNow:a.o.restoreNow}});var s=n;return s})})(fX);var Wht=fX.exports;const Em=jht(Wht);const $ht={class:"map-legend"},Zht={class:"legend-title"},qht={class:"legend-note"},Xht={__name:"MapLegend",props:{title:{type:String,default:"PM2.5 Emissions (g/hour)"},note:{type:String,default:"* Based on backend hourly emissions"},levels:{type:Array,default:()=>[{color:"#22c55e",label:"0  200 Very Low"},{color:"#84cc16",label:"200  260 Low"},{color:"#eab308",label:"260  340 Moderate"},{color:"#f97316",label:"340  430 High"},{color:"#ef4444",label:"430  550 Very High"},{color:"#7f1d1d",label:"> 550 Extreme"}]}},setup(i){return(t,e)=>(Ka(),_o("div",$ht,[le("div",Zht,Hn(i.title),1),(Ka(!0),_o(Xl,null,qB(i.levels,(r,n)=>(Ka(),_o("div",{key:n,class:"legend-row"},[le("span",{class:"legend-color",style:O0({background:r.color})},null,4),le("span",null,Hn(r.label),1)]))),128)),le("div",qht,Hn(i.note),1)]))}},Yht=Gd(Xht,[["__scopeId","data-v-d086de57"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function kS(i){return i+.5|0}const sp=(i,t,e)=>Math.max(Math.min(i,e),t);function Wb(i){return sp(kS(i*2.55),0,255)}function wp(i){return sp(kS(i*255),0,255)}function hd(i){return sp(kS(i/2.55)/100,0,1)}function BG(i){return sp(kS(i*100),0,100)}const mu={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},aO=[..."0123456789ABCDEF"],Kht=i=>aO[i&15],Jht=i=>aO[(i&240)>>4]+aO[i&15],X2=i=>(i&240)>>4===(i&15),Qht=i=>X2(i.r)&&X2(i.g)&&X2(i.b)&&X2(i.a);function tdt(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&mu[i[1]]*17,g:255&mu[i[2]]*17,b:255&mu[i[3]]*17,a:t===5?mu[i[4]]*17:255}:(t===7||t===9)&&(e={r:mu[i[1]]<<4|mu[i[2]],g:mu[i[3]]<<4|mu[i[4]],b:mu[i[5]]<<4|mu[i[6]],a:t===9?mu[i[7]]<<4|mu[i[8]]:255})),e}const edt=(i,t)=>i<255?t(i):"";function idt(i){var t=Qht(i)?Kht:Jht;return i?"#"+t(i.r)+t(i.g)+t(i.b)+edt(i.a,t):void 0}const rdt=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function gX(i,t,e){const r=t*Math.min(e,1-e),n=(o,s=(o+i/30)%12)=>e-r*Math.max(Math.min(s-3,9-s,1),-1);return[n(0),n(8),n(4)]}function ndt(i,t,e){const r=(n,o=(n+i/60)%6)=>e-e*t*Math.max(Math.min(o,4-o,1),0);return[r(5),r(3),r(1)]}function adt(i,t,e){const r=gX(i,1,.5);let n;for(t+e>1&&(n=1/(t+e),t*=n,e*=n),n=0;n<3;n++)r[n]*=1-t-e,r[n]+=t;return r}function odt(i,t,e,r,n){return i===n?(t-e)/r+(t<e?6:0):t===n?(e-i)/r+2:(i-t)/r+4}function eF(i){const e=i.r/255,r=i.g/255,n=i.b/255,o=Math.max(e,r,n),s=Math.min(e,r,n),a=(o+s)/2;let c,f,g;return o!==s&&(g=o-s,f=a>.5?g/(2-o-s):g/(o+s),c=odt(e,r,n,g,o),c=c*60+.5),[c|0,f||0,a]}function iF(i,t,e,r){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,r)).map(wp)}function rF(i,t,e){return iF(gX,i,t,e)}function sdt(i,t,e){return iF(adt,i,t,e)}function ldt(i,t,e){return iF(ndt,i,t,e)}function mX(i){return(i%360+360)%360}function udt(i){const t=rdt.exec(i);let e=255,r;if(!t)return;t[5]!==r&&(e=t[6]?Wb(+t[5]):wp(+t[5]));const n=mX(+t[2]),o=+t[3]/100,s=+t[4]/100;return t[1]==="hwb"?r=sdt(n,o,s):t[1]==="hsv"?r=ldt(n,o,s):r=rF(n,o,s),{r:r[0],g:r[1],b:r[2],a:e}}function cdt(i,t){var e=eF(i);e[0]=mX(e[0]+t),e=rF(e),i.r=e[0],i.g=e[1],i.b=e[2]}function hdt(i){if(!i)return;const t=eF(i),e=t[0],r=BG(t[1]),n=BG(t[2]);return i.a<255?`hsla(${e}, ${r}%, ${n}%, ${hd(i.a)})`:`hsl(${e}, ${r}%, ${n}%)`}const FG={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},NG={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function ddt(){const i={},t=Object.keys(NG),e=Object.keys(FG);let r,n,o,s,a;for(r=0;r<t.length;r++){for(s=a=t[r],n=0;n<e.length;n++)o=e[n],a=a.replace(o,FG[o]);o=parseInt(NG[s],16),i[a]=[o>>16&255,o>>8&255,o&255]}return i}let Y2;function fdt(i){Y2||(Y2=ddt(),Y2.transparent=[0,0,0,0]);const t=Y2[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const pdt=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function gdt(i){const t=pdt.exec(i);let e=255,r,n,o;if(t){if(t[7]!==r){const s=+t[7];e=t[8]?Wb(s):sp(s*255,0,255)}return r=+t[1],n=+t[3],o=+t[5],r=255&(t[2]?Wb(r):sp(r,0,255)),n=255&(t[4]?Wb(n):sp(n,0,255)),o=255&(t[6]?Wb(o):sp(o,0,255)),{r,g:n,b:o,a:e}}}function mdt(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${hd(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const tL=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,gy=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function vdt(i,t,e){const r=gy(hd(i.r)),n=gy(hd(i.g)),o=gy(hd(i.b));return{r:wp(tL(r+e*(gy(hd(t.r))-r))),g:wp(tL(n+e*(gy(hd(t.g))-n))),b:wp(tL(o+e*(gy(hd(t.b))-o))),a:i.a+e*(t.a-i.a)}}function K2(i,t,e){if(i){let r=eF(i);r[t]=Math.max(0,Math.min(r[t]+r[t]*e,t===0?360:1)),r=rF(r),i.r=r[0],i.g=r[1],i.b=r[2]}}function vX(i,t){return i&&Object.assign(t||{},i)}function VG(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=wp(i[3]))):(t=vX(i,{r:0,g:0,b:0,a:1}),t.a=wp(t.a)),t}function _dt(i){return i.charAt(0)==="r"?gdt(i):udt(i)}class jw{constructor(t){if(t instanceof jw)return t;const e=typeof t;let r;e==="object"?r=VG(t):e==="string"&&(r=tdt(t)||fdt(t)||_dt(t)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var t=vX(this._rgb);return t&&(t.a=hd(t.a)),t}set rgb(t){this._rgb=VG(t)}rgbString(){return this._valid?mdt(this._rgb):void 0}hexString(){return this._valid?idt(this._rgb):void 0}hslString(){return this._valid?hdt(this._rgb):void 0}mix(t,e){if(t){const r=this.rgb,n=t.rgb;let o;const s=e===o?.5:e,a=2*s-1,c=r.a-n.a,f=((a*c===-1?a:(a+c)/(1+a*c))+1)/2;o=1-f,r.r=255&f*r.r+o*n.r+.5,r.g=255&f*r.g+o*n.g+.5,r.b=255&f*r.b+o*n.b+.5,r.a=s*r.a+(1-s)*n.a,this.rgb=r}return this}interpolate(t,e){return t&&(this._rgb=vdt(this._rgb,t._rgb,e)),this}clone(){return new jw(this.rgb)}alpha(t){return this._rgb.a=wp(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=kS(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return K2(this._rgb,2,t),this}darken(t){return K2(this._rgb,2,-t),this}saturate(t){return K2(this._rgb,1,t),this}desaturate(t){return K2(this._rgb,1,-t),this}rotate(t){return cdt(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function td(){}const ydt=(()=>{let i=0;return()=>i++})();function On(i){return i==null}function Na(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Nn(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function uo(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function $l(i,t){return uo(i)?i:t}function cn(i,t){return typeof i>"u"?t:i}const xdt=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,_X=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function ka(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function _a(i,t,e,r){let n,o,s;if(Na(i))if(o=i.length,r)for(n=o-1;n>=0;n--)t.call(e,i[n],n);else for(n=0;n<o;n++)t.call(e,i[n],n);else if(Nn(i))for(s=Object.keys(i),o=s.length,n=0;n<o;n++)t.call(e,i[s[n]],s[n])}function vC(i,t){let e,r,n,o;if(!i||!t||i.length!==t.length)return!1;for(e=0,r=i.length;e<r;++e)if(n=i[e],o=t[e],n.datasetIndex!==o.datasetIndex||n.index!==o.index)return!1;return!0}function _C(i){if(Na(i))return i.map(_C);if(Nn(i)){const t=Object.create(null),e=Object.keys(i),r=e.length;let n=0;for(;n<r;++n)t[e[n]]=_C(i[e[n]]);return t}return i}function yX(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function bdt(i,t,e,r){if(!yX(i))return;const n=t[i],o=e[i];Nn(n)&&Nn(o)?Ww(n,o,r):t[i]=_C(o)}function Ww(i,t,e){const r=Na(t)?t:[t],n=r.length;if(!Nn(i))return i;e=e||{};const o=e.merger||bdt;let s;for(let a=0;a<n;++a){if(s=r[a],!Nn(s))continue;const c=Object.keys(s);for(let f=0,g=c.length;f<g;++f)o(c[f],i,s,e)}return i}function _w(i,t){return Ww(i,t,{merger:wdt})}function wdt(i,t,e){if(!yX(i))return;const r=t[i],n=e[i];Nn(r)&&Nn(n)?_w(r,n):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=_C(n))}const UG={"":i=>i,x:i=>i.x,y:i=>i.y};function Sdt(i){const t=i.split("."),e=[];let r="";for(const n of t)r+=n,r.endsWith("\\")?r=r.slice(0,-1)+".":(e.push(r),r="");return e}function Tdt(i){const t=Sdt(i);return e=>{for(const r of t){if(r==="")break;e=e&&e[r]}return e}}function Lp(i,t){return(UG[t]||(UG[t]=Tdt(t)))(i)}function nF(i){return i.charAt(0).toUpperCase()+i.slice(1)}const $w=i=>typeof i<"u",Rp=i=>typeof i=="function",GG=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function Adt(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const ea=Math.PI,Va=2*ea,Idt=Va+ea,yC=Number.POSITIVE_INFINITY,Cdt=ea/180,yo=ea/2,Jg=ea/4,HG=ea*2/3,lp=Math.log10,fh=Math.sign;function yw(i,t,e){return Math.abs(i-t)<e}function jG(i){const t=Math.round(i);i=yw(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(lp(i))),r=i/e;return(r<=1?1:r<=2?2:r<=5?5:10)*e}function Mdt(i){const t=[],e=Math.sqrt(i);let r;for(r=1;r<e;r++)i%r===0&&(t.push(r),t.push(i/r));return e===(e|0)&&t.push(e),t.sort((n,o)=>n-o).pop(),t}function Edt(i){return typeof i=="symbol"||typeof i=="object"&&i!==null&&!(Symbol.toPrimitive in i||"toString"in i||"valueOf"in i)}function v0(i){return!Edt(i)&&!isNaN(parseFloat(i))&&isFinite(i)}function Ddt(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function xX(i,t,e){let r,n,o;for(r=0,n=i.length;r<n;r++)o=i[r][e],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function lc(i){return i*(ea/180)}function aF(i){return i*(180/ea)}function WG(i){if(!uo(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function bX(i,t){const e=t.x-i.x,r=t.y-i.y,n=Math.sqrt(e*e+r*r);let o=Math.atan2(r,e);return o<-.5*ea&&(o+=Va),{angle:o,distance:n}}function oO(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function Pdt(i,t){return(i-t+Idt)%Va-ea}function Ps(i){return(i%Va+Va)%Va}function Zw(i,t,e,r){const n=Ps(i),o=Ps(t),s=Ps(e),a=Ps(o-n),c=Ps(s-n),f=Ps(n-o),g=Ps(n-s);return n===o||n===s||r&&o===s||a>c&&f<g}function ns(i,t,e){return Math.max(t,Math.min(e,i))}function Ldt(i){return ns(i,-32768,32767)}function vd(i,t,e,r=1e-6){return i>=Math.min(t,e)-r&&i<=Math.max(t,e)+r}function oF(i,t,e){e=e||(s=>i[s]<t);let r=i.length-1,n=0,o;for(;r-n>1;)o=n+r>>1,e(o)?n=o:r=o;return{lo:n,hi:r}}const _d=(i,t,e,r)=>oF(i,e,r?n=>{const o=i[n][t];return o<e||o===e&&i[n+1][t]===e}:n=>i[n][t]<e),Rdt=(i,t,e)=>oF(i,e,r=>i[r][t]>=e);function kdt(i,t,e){let r=0,n=i.length;for(;r<n&&i[r]<t;)r++;for(;n>r&&i[n-1]>e;)n--;return r>0||n<i.length?i.slice(r,n):i}const wX=["push","pop","shift","splice","unshift"];function Odt(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),wX.forEach(e=>{const r="_onData"+nF(e),n=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...o){const s=n.apply(this,o);return i._chartjs.listeners.forEach(a=>{typeof a[r]=="function"&&a[r](...o)}),s}})})}function $G(i,t){const e=i._chartjs;if(!e)return;const r=e.listeners,n=r.indexOf(t);n!==-1&&r.splice(n,1),!(r.length>0)&&(wX.forEach(o=>{delete i[o]}),delete i._chartjs)}function SX(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const TX=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function AX(i,t){let e=[],r=!1;return function(...n){e=n,r||(r=!0,TX.call(window,()=>{r=!1,i.apply(t,e)}))}}function zdt(i,t){let e;return function(...r){return t?(clearTimeout(e),e=setTimeout(i,t,r)):i.apply(this,r),t}}const sF=i=>i==="start"?"left":i==="end"?"right":"center",Es=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2,Bdt=(i,t,e,r)=>i===(r?"left":"right")?e:i==="center"?(t+e)/2:t;function IX(i,t,e){const r=t.length;let n=0,o=r;if(i._sorted){const{iScale:s,vScale:a,_parsed:c}=i,f=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null,g=s.axis,{min:v,max:y,minDefined:w,maxDefined:I}=s.getUserBounds();if(w){if(n=Math.min(_d(c,g,v).lo,e?r:_d(t,g,s.getPixelForValue(v)).lo),f){const E=c.slice(0,n+1).reverse().findIndex(D=>!On(D[a.axis]));n-=Math.max(0,E)}n=ns(n,0,r-1)}if(I){let E=Math.max(_d(c,s.axis,y,!0).hi+1,e?0:_d(t,g,s.getPixelForValue(y),!0).hi+1);if(f){const D=c.slice(E-1).findIndex(R=>!On(R[a.axis]));E+=Math.max(0,D)}o=ns(E,n,r)-n}else o=r-n}return{start:n,count:o}}function CX(i){const{xScale:t,yScale:e,_scaleRanges:r}=i,n={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!r)return i._scaleRanges=n,!0;const o=r.xmin!==t.min||r.xmax!==t.max||r.ymin!==e.min||r.ymax!==e.max;return Object.assign(r,n),o}const J2=i=>i===0||i===1,ZG=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*Va/e)),qG=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*Va/e)+1,xw={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*yo)+1,easeOutSine:i=>Math.sin(i*yo),easeInOutSine:i=>-.5*(Math.cos(ea*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>J2(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>J2(i)?i:ZG(i,.075,.3),easeOutElastic:i=>J2(i)?i:qG(i,.075,.3),easeInOutElastic(i){return J2(i)?i:i<.5?.5*ZG(i*2,.1125,.45):.5+.5*qG(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-xw.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?xw.easeInBounce(i*2)*.5:xw.easeOutBounce(i*2-1)*.5+.5};function lF(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function XG(i){return lF(i)?i:new jw(i)}function eL(i){return lF(i)?i:new jw(i).saturate(.5).darken(.1).hexString()}const Fdt=["x","y","borderWidth","radius","tension"],Ndt=["color","borderColor","backgroundColor"];function Vdt(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:Ndt},numbers:{type:"number",properties:Fdt}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Udt(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const YG=new Map;function Gdt(i,t){t=t||{};const e=i+JSON.stringify(t);let r=YG.get(e);return r||(r=new Intl.NumberFormat(i,t),YG.set(e,r)),r}function OS(i,t,e){return Gdt(t,e).format(i)}const MX={values(i){return Na(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const r=this.chart.options.locale;let n,o=i;if(e.length>1){const f=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(f<1e-4||f>1e15)&&(n="scientific"),o=Hdt(i,e)}const s=lp(Math.abs(o)),a=isNaN(s)?1:Math.max(Math.min(-1*Math.floor(s),20),0),c={notation:n,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(c,this.options.ticks.format),OS(i,r,c)},logarithmic(i,t,e){if(i===0)return"0";const r=e[t].significand||i/Math.pow(10,Math.floor(lp(i)));return[1,2,3,5,10,15].includes(r)||t>.8*e.length?MX.numeric.call(this,i,t,e):""}};function Hdt(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var jM={formatters:MX};function jdt(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:jM.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const pv=Object.create(null),sO=Object.create(null);function bw(i,t){if(!t)return i;const e=t.split(".");for(let r=0,n=e.length;r<n;++r){const o=e[r];i=i[o]||(i[o]=Object.create(null))}return i}function iL(i,t,e){return typeof t=="string"?Ww(bw(i,t),e):Ww(bw(i,""),t)}class Wdt{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,n)=>eL(n.backgroundColor),this.hoverBorderColor=(r,n)=>eL(n.borderColor),this.hoverColor=(r,n)=>eL(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return iL(this,t,e)}get(t){return bw(this,t)}describe(t,e){return iL(sO,t,e)}override(t,e){return iL(pv,t,e)}route(t,e,r,n){const o=bw(this,t),s=bw(this,r),a="_"+e;Object.defineProperties(o,{[a]:{value:o[e],writable:!0},[e]:{enumerable:!0,get(){const c=this[a],f=s[n];return Nn(c)?Object.assign({},f,c):cn(c,f)},set(c){this[a]=c}}})}apply(t){t.forEach(e=>e(this))}}var $a=new Wdt({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Vdt,Udt,jdt]);function $dt(i){return!i||On(i.size)||On(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function xC(i,t,e,r,n){let o=t[n];return o||(o=t[n]=i.measureText(n).width,e.push(n)),o>r&&(r=o),r}function Zdt(i,t,e,r){r=r||{};let n=r.data=r.data||{},o=r.garbageCollect=r.garbageCollect||[];r.font!==t&&(n=r.data={},o=r.garbageCollect=[],r.font=t),i.save(),i.font=t;let s=0;const a=e.length;let c,f,g,v,y;for(c=0;c<a;c++)if(v=e[c],v!=null&&!Na(v))s=xC(i,n,o,s,v);else if(Na(v))for(f=0,g=v.length;f<g;f++)y=v[f],y!=null&&!Na(y)&&(s=xC(i,n,o,s,y));i.restore();const w=o.length/2;if(w>e.length){for(c=0;c<w;c++)delete n[o[c]];o.splice(0,w)}return s}function Qg(i,t,e){const r=i.currentDevicePixelRatio,n=e!==0?Math.max(e/2,.5):0;return Math.round((t-n)*r)/r+n}function KG(i,t){!t&&!i||(t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore())}function lO(i,t,e,r){EX(i,t,e,r,null)}function EX(i,t,e,r,n){let o,s,a,c,f,g,v,y;const w=t.pointStyle,I=t.rotation,E=t.radius;let D=(I||0)*Cdt;if(w&&typeof w=="object"&&(o=w.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){i.save(),i.translate(e,r),i.rotate(D),i.drawImage(w,-w.width/2,-w.height/2,w.width,w.height),i.restore();return}if(!(isNaN(E)||E<=0)){switch(i.beginPath(),w){default:n?i.ellipse(e,r,n/2,E,0,0,Va):i.arc(e,r,E,0,Va),i.closePath();break;case"triangle":g=n?n/2:E,i.moveTo(e+Math.sin(D)*g,r-Math.cos(D)*E),D+=HG,i.lineTo(e+Math.sin(D)*g,r-Math.cos(D)*E),D+=HG,i.lineTo(e+Math.sin(D)*g,r-Math.cos(D)*E),i.closePath();break;case"rectRounded":f=E*.516,c=E-f,s=Math.cos(D+Jg)*c,v=Math.cos(D+Jg)*(n?n/2-f:c),a=Math.sin(D+Jg)*c,y=Math.sin(D+Jg)*(n?n/2-f:c),i.arc(e-v,r-a,f,D-ea,D-yo),i.arc(e+y,r-s,f,D-yo,D),i.arc(e+v,r+a,f,D,D+yo),i.arc(e-y,r+s,f,D+yo,D+ea),i.closePath();break;case"rect":if(!I){c=Math.SQRT1_2*E,g=n?n/2:c,i.rect(e-g,r-c,2*g,2*c);break}D+=Jg;case"rectRot":v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+y,r-s),i.lineTo(e+v,r+a),i.lineTo(e-y,r+s),i.closePath();break;case"crossRot":D+=Jg;case"cross":v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+v,r+a),i.moveTo(e+y,r-s),i.lineTo(e-y,r+s);break;case"star":v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+v,r+a),i.moveTo(e+y,r-s),i.lineTo(e-y,r+s),D+=Jg,v=Math.cos(D)*(n?n/2:E),s=Math.cos(D)*E,a=Math.sin(D)*E,y=Math.sin(D)*(n?n/2:E),i.moveTo(e-v,r-a),i.lineTo(e+v,r+a),i.moveTo(e+y,r-s),i.lineTo(e-y,r+s);break;case"line":s=n?n/2:Math.cos(D)*E,a=Math.sin(D)*E,i.moveTo(e-s,r-a),i.lineTo(e+s,r+a);break;case"dash":i.moveTo(e,r),i.lineTo(e+Math.cos(D)*(n?n/2:E),r+Math.sin(D)*E);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function yd(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function WM(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function $M(i){i.restore()}function qdt(i,t,e,r,n){if(!t)return i.lineTo(e.x,e.y);if(n==="middle"){const o=(t.x+e.x)/2;i.lineTo(o,t.y),i.lineTo(o,e.y)}else n==="after"!=!!r?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function Xdt(i,t,e,r){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(r?t.cp1x:t.cp2x,r?t.cp1y:t.cp2y,r?e.cp2x:e.cp1x,r?e.cp2y:e.cp1y,e.x,e.y)}function Ydt(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),On(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function Kdt(i,t,e,r,n){if(n.strikethrough||n.underline){const o=i.measureText(r),s=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,c=e-o.actualBoundingBoxAscent,f=e+o.actualBoundingBoxDescent,g=n.strikethrough?(c+f)/2:f;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=n.decorationWidth||2,i.moveTo(s,g),i.lineTo(a,g),i.stroke()}}function Jdt(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function gv(i,t,e,r,n,o={}){const s=Na(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let c,f;for(i.save(),i.font=n.string,Ydt(i,o),c=0;c<s.length;++c)f=s[c],o.backdrop&&Jdt(i,o.backdrop),a&&(o.strokeColor&&(i.strokeStyle=o.strokeColor),On(o.strokeWidth)||(i.lineWidth=o.strokeWidth),i.strokeText(f,e,r,o.maxWidth)),i.fillText(f,e,r,o.maxWidth),Kdt(i,e,r,f,o),r+=Number(n.lineHeight);i.restore()}function qw(i,t){const{x:e,y:r,w:n,h:o,radius:s}=t;i.arc(e+s.topLeft,r+s.topLeft,s.topLeft,1.5*ea,ea,!0),i.lineTo(e,r+o-s.bottomLeft),i.arc(e+s.bottomLeft,r+o-s.bottomLeft,s.bottomLeft,ea,yo,!0),i.lineTo(e+n-s.bottomRight,r+o),i.arc(e+n-s.bottomRight,r+o-s.bottomRight,s.bottomRight,yo,0,!0),i.lineTo(e+n,r+s.topRight),i.arc(e+n-s.topRight,r+s.topRight,s.topRight,0,-yo,!0),i.lineTo(e+s.topLeft,r)}const Qdt=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,tft=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function eft(i,t){const e=(""+i).match(Qdt);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const ift=i=>+i||0;function uF(i,t){const e={},r=Nn(t),n=r?Object.keys(t):t,o=Nn(i)?r?s=>cn(i[s],i[t[s]]):s=>i[s]:()=>i;for(const s of n)e[s]=ift(o(s));return e}function DX(i){return uF(i,{top:"y",right:"x",bottom:"y",left:"x"})}function iv(i){return uF(i,["topLeft","topRight","bottomLeft","bottomRight"])}function Fs(i){const t=DX(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Zo(i,t){i=i||{},t=t||$a.font;let e=cn(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let r=cn(i.style,t.style);r&&!(""+r).match(tft)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const n={family:cn(i.family,t.family),lineHeight:eft(cn(i.lineHeight,t.lineHeight),e),size:e,style:r,weight:cn(i.weight,t.weight),string:""};return n.string=$dt(n),n}function $b(i,t,e,r){let n=!0,o,s,a;for(o=0,s=i.length;o<s;++o)if(a=i[o],a!==void 0&&(t!==void 0&&typeof a=="function"&&(a=a(t),n=!1),e!==void 0&&Na(a)&&(a=a[e%a.length],n=!1),a!==void 0))return r&&!n&&(r.cacheable=!1),a}function rft(i,t,e){const{min:r,max:n}=i,o=_X(t,(n-r)/2),s=(a,c)=>e&&a===0?0:a+c;return{min:s(r,-Math.abs(o)),max:s(n,o)}}function Hp(i,t){return Object.assign(Object.create(i),t)}function cF(i,t=[""],e,r,n=()=>i[0]){const o=e||i;typeof r>"u"&&(r=kX("_fallback",i));const s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:o,_fallback:r,_getTarget:n,override:a=>cF([a,...i],t,o,r)};return new Proxy(s,{deleteProperty(a,c){return delete a[c],delete a._keys,delete i[0][c],!0},get(a,c){return LX(a,c,()=>hft(c,t,i,a))},getOwnPropertyDescriptor(a,c){return Reflect.getOwnPropertyDescriptor(a._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(a,c){return QG(a).includes(c)},ownKeys(a){return QG(a)},set(a,c,f){const g=a._storage||(a._storage=n());return a[c]=g[c]=f,delete a._keys,!0}})}function _0(i,t,e,r){const n={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:PX(i,r),setContext:o=>_0(i,o,e,r),override:o=>_0(i.override(o),t,e,r)};return new Proxy(n,{deleteProperty(o,s){return delete o[s],delete i[s],!0},get(o,s,a){return LX(o,s,()=>aft(o,s,a))},getOwnPropertyDescriptor(o,s){return o._descriptors.allKeys?Reflect.has(i,s)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,s)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(o,s){return Reflect.has(i,s)},ownKeys(){return Reflect.ownKeys(i)},set(o,s,a){return i[s]=a,delete o[s],!0}})}function PX(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:r=t.indexable,_allKeys:n=t.allKeys}=i;return{allKeys:n,scriptable:e,indexable:r,isScriptable:Rp(e)?e:()=>e,isIndexable:Rp(r)?r:()=>r}}const nft=(i,t)=>i?i+nF(t):t,hF=(i,t)=>Nn(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function LX(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t)||t==="constructor")return i[t];const r=e();return i[t]=r,r}function aft(i,t,e){const{_proxy:r,_context:n,_subProxy:o,_descriptors:s}=i;let a=r[t];return Rp(a)&&s.isScriptable(t)&&(a=oft(t,a,i,e)),Na(a)&&a.length&&(a=sft(t,a,i,s.isIndexable)),hF(t,a)&&(a=_0(a,n,o&&o[t],s)),a}function oft(i,t,e,r){const{_proxy:n,_context:o,_subProxy:s,_stack:a}=e;if(a.has(i))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+i);a.add(i);let c=t(o,s||r);return a.delete(i),hF(i,c)&&(c=dF(n._scopes,n,i,c)),c}function sft(i,t,e,r){const{_proxy:n,_context:o,_subProxy:s,_descriptors:a}=e;if(typeof o.index<"u"&&r(i))return t[o.index%t.length];if(Nn(t[0])){const c=t,f=n._scopes.filter(g=>g!==c);t=[];for(const g of c){const v=dF(f,n,i,g);t.push(_0(v,o,s&&s[i],a))}}return t}function RX(i,t,e){return Rp(i)?i(t,e):i}const lft=(i,t)=>i===!0?t:typeof i=="string"?Lp(t,i):void 0;function uft(i,t,e,r,n){for(const o of t){const s=lft(e,o);if(s){i.add(s);const a=RX(s._fallback,e,n);if(typeof a<"u"&&a!==e&&a!==r)return a}else if(s===!1&&typeof r<"u"&&e!==r)return null}return!1}function dF(i,t,e,r){const n=t._rootScopes,o=RX(t._fallback,e,r),s=[...i,...n],a=new Set;a.add(r);let c=JG(a,s,e,o||e,r);return c===null||typeof o<"u"&&o!==e&&(c=JG(a,s,o,c,r),c===null)?!1:cF(Array.from(a),[""],n,o,()=>cft(t,e,r))}function JG(i,t,e,r,n){for(;e;)e=uft(i,t,e,r,n);return e}function cft(i,t,e){const r=i._getTarget();t in r||(r[t]={});const n=r[t];return Na(n)&&Nn(e)?e:n||{}}function hft(i,t,e,r){let n;for(const o of t)if(n=kX(nft(o,i),e),typeof n<"u")return hF(i,n)?dF(e,r,i,n):n}function kX(i,t){for(const e of t){if(!e)continue;const r=e[i];if(typeof r<"u")return r}}function QG(i){let t=i._keys;return t||(t=i._keys=dft(i._scopes)),t}function dft(i){const t=new Set;for(const e of i)for(const r of Object.keys(e).filter(n=>!n.startsWith("_")))t.add(r);return Array.from(t)}function OX(i,t,e,r){const{iScale:n}=i,{key:o="r"}=this._parsing,s=new Array(r);let a,c,f,g;for(a=0,c=r;a<c;++a)f=a+e,g=t[f],s[a]={r:n.parse(Lp(g,o),f)};return s}const fft=Number.EPSILON||1e-14,y0=(i,t)=>t<i.length&&!i[t].skip&&i[t],zX=i=>i==="x"?"y":"x";function pft(i,t,e,r){const n=i.skip?t:i,o=t,s=e.skip?t:e,a=oO(o,n),c=oO(s,o);let f=a/(a+c),g=c/(a+c);f=isNaN(f)?0:f,g=isNaN(g)?0:g;const v=r*f,y=r*g;return{previous:{x:o.x-v*(s.x-n.x),y:o.y-v*(s.y-n.y)},next:{x:o.x+y*(s.x-n.x),y:o.y+y*(s.y-n.y)}}}function gft(i,t,e){const r=i.length;let n,o,s,a,c,f=y0(i,0);for(let g=0;g<r-1;++g)if(c=f,f=y0(i,g+1),!(!c||!f)){if(yw(t[g],0,fft)){e[g]=e[g+1]=0;continue}n=e[g]/t[g],o=e[g+1]/t[g],a=Math.pow(n,2)+Math.pow(o,2),!(a<=9)&&(s=3/Math.sqrt(a),e[g]=n*s*t[g],e[g+1]=o*s*t[g])}}function mft(i,t,e="x"){const r=zX(e),n=i.length;let o,s,a,c=y0(i,0);for(let f=0;f<n;++f){if(s=a,a=c,c=y0(i,f+1),!a)continue;const g=a[e],v=a[r];s&&(o=(g-s[e])/3,a[`cp1${e}`]=g-o,a[`cp1${r}`]=v-o*t[f]),c&&(o=(c[e]-g)/3,a[`cp2${e}`]=g+o,a[`cp2${r}`]=v+o*t[f])}}function vft(i,t="x"){const e=zX(t),r=i.length,n=Array(r).fill(0),o=Array(r);let s,a,c,f=y0(i,0);for(s=0;s<r;++s)if(a=c,c=f,f=y0(i,s+1),!!c){if(f){const g=f[t]-c[t];n[s]=g!==0?(f[e]-c[e])/g:0}o[s]=a?f?fh(n[s-1])!==fh(n[s])?0:(n[s-1]+n[s])/2:n[s-1]:n[s]}gft(i,n,o),mft(i,o,t)}function Q2(i,t,e){return Math.max(Math.min(i,e),t)}function _ft(i,t){let e,r,n,o,s,a=yd(i[0],t);for(e=0,r=i.length;e<r;++e)s=o,o=a,a=e<r-1&&yd(i[e+1],t),o&&(n=i[e],s&&(n.cp1x=Q2(n.cp1x,t.left,t.right),n.cp1y=Q2(n.cp1y,t.top,t.bottom)),a&&(n.cp2x=Q2(n.cp2x,t.left,t.right),n.cp2y=Q2(n.cp2y,t.top,t.bottom)))}function yft(i,t,e,r,n){let o,s,a,c;if(t.spanGaps&&(i=i.filter(f=>!f.skip)),t.cubicInterpolationMode==="monotone")vft(i,n);else{let f=r?i[i.length-1]:i[0];for(o=0,s=i.length;o<s;++o)a=i[o],c=pft(f,a,i[Math.min(o+1,s-(r?0:1))%s],t.tension),a.cp1x=c.previous.x,a.cp1y=c.previous.y,a.cp2x=c.next.x,a.cp2y=c.next.y,f=a}t.capBezierPoints&&_ft(i,e)}function fF(){return typeof window<"u"&&typeof document<"u"}function pF(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function bC(i,t,e){let r;return typeof i=="string"?(r=parseInt(i,10),i.indexOf("%")!==-1&&(r=r/100*t.parentNode[e])):r=i,r}const ZM=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function xft(i,t){return ZM(i).getPropertyValue(t)}const bft=["top","right","bottom","left"];function rv(i,t,e){const r={};e=e?"-"+e:"";for(let n=0;n<4;n++){const o=bft[n];r[o]=parseFloat(i[t+"-"+o+e])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const wft=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function Sft(i,t){const e=i.touches,r=e&&e.length?e[0]:i,{offsetX:n,offsetY:o}=r;let s=!1,a,c;if(wft(n,o,i.target))a=n,c=o;else{const f=t.getBoundingClientRect();a=r.clientX-f.left,c=r.clientY-f.top,s=!0}return{x:a,y:c,box:s}}function Dm(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:r}=t,n=ZM(e),o=n.boxSizing==="border-box",s=rv(n,"padding"),a=rv(n,"border","width"),{x:c,y:f,box:g}=Sft(i,e),v=s.left+(g&&a.left),y=s.top+(g&&a.top);let{width:w,height:I}=t;return o&&(w-=s.width+a.width,I-=s.height+a.height),{x:Math.round((c-v)/w*e.width/r),y:Math.round((f-y)/I*e.height/r)}}function Tft(i,t,e){let r,n;if(t===void 0||e===void 0){const o=i&&pF(i);if(!o)t=i.clientWidth,e=i.clientHeight;else{const s=o.getBoundingClientRect(),a=ZM(o),c=rv(a,"border","width"),f=rv(a,"padding");t=s.width-f.width-c.width,e=s.height-f.height-c.height,r=bC(a.maxWidth,o,"clientWidth"),n=bC(a.maxHeight,o,"clientHeight")}}return{width:t,height:e,maxWidth:r||yC,maxHeight:n||yC}}const up=i=>Math.round(i*10)/10;function Aft(i,t,e,r){const n=ZM(i),o=rv(n,"margin"),s=bC(n.maxWidth,i,"clientWidth")||yC,a=bC(n.maxHeight,i,"clientHeight")||yC,c=Tft(i,t,e);let{width:f,height:g}=c;if(n.boxSizing==="content-box"){const y=rv(n,"border","width"),w=rv(n,"padding");f-=w.width+y.width,g-=w.height+y.height}return f=Math.max(0,f-o.width),g=Math.max(0,r?f/r:g-o.height),f=up(Math.min(f,s,c.maxWidth)),g=up(Math.min(g,a,c.maxHeight)),f&&!g&&(g=up(f/2)),(t!==void 0||e!==void 0)&&r&&c.height&&g>c.height&&(g=c.height,f=up(Math.floor(g*r))),{width:f,height:g}}function t6(i,t,e){const r=t||1,n=up(i.height*r),o=up(i.width*r);i.height=up(i.height),i.width=up(i.width);const s=i.canvas;return s.style&&(e||!s.style.height&&!s.style.width)&&(s.style.height=`${i.height}px`,s.style.width=`${i.width}px`),i.currentDevicePixelRatio!==r||s.height!==n||s.width!==o?(i.currentDevicePixelRatio=r,s.height=n,s.width=o,i.ctx.setTransform(r,0,0,r,0,0),!0):!1}const Ift=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};fF()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return i}();function e6(i,t){const e=xft(i,t),r=e&&e.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function Pm(i,t,e,r){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function Cft(i,t,e,r){return{x:i.x+e*(t.x-i.x),y:r==="middle"?e<.5?i.y:t.y:r==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function Mft(i,t,e,r){const n={x:i.cp2x,y:i.cp2y},o={x:t.cp1x,y:t.cp1y},s=Pm(i,n,e),a=Pm(n,o,e),c=Pm(o,t,e),f=Pm(s,a,e),g=Pm(a,c,e);return Pm(f,g,e)}const Eft=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,r){return e-r},leftForLtr(e,r){return e-r}}},Dft=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function s0(i,t,e){return i?Eft(t,e):Dft()}function BX(i,t){let e,r;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,r=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=r)}function FX(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function NX(i){return i==="angle"?{between:Zw,compare:Pdt,normalize:Ps}:{between:vd,compare:(t,e)=>t-e,normalize:t=>t}}function i6({start:i,end:t,count:e,loop:r,style:n}){return{start:i%e,end:t%e,loop:r&&(t-i+1)%e===0,style:n}}function Pft(i,t,e){const{property:r,start:n,end:o}=e,{between:s,normalize:a}=NX(r),c=t.length;let{start:f,end:g,loop:v}=i,y,w;if(v){for(f+=c,g+=c,y=0,w=c;y<w&&s(a(t[f%c][r]),n,o);++y)f--,g--;f%=c,g%=c}return g<f&&(g+=c),{start:f,end:g,loop:v,style:i.style}}function VX(i,t,e){if(!e)return[i];const{property:r,start:n,end:o}=e,s=t.length,{compare:a,between:c,normalize:f}=NX(r),{start:g,end:v,loop:y,style:w}=Pft(i,t,e),I=[];let E=!1,D=null,R,z,N;const H=()=>c(n,N,R)&&a(n,N)!==0,q=()=>a(o,R)===0||c(o,N,R),Y=()=>E||H(),J=()=>!E||q();for(let it=g,at=g;it<=v;++it)z=t[it%s],!z.skip&&(R=f(z[r]),R!==N&&(E=c(R,n,o),D===null&&Y()&&(D=a(R,n)===0?it:at),D!==null&&J()&&(I.push(i6({start:D,end:it,loop:y,count:s,style:w})),D=null),at=it,N=R));return D!==null&&I.push(i6({start:D,end:v,loop:y,count:s,style:w})),I}function UX(i,t){const e=[],r=i.segments;for(let n=0;n<r.length;n++){const o=VX(r[n],i.points,t);o.length&&e.push(...o)}return e}function Lft(i,t,e,r){let n=0,o=t-1;if(e&&!r)for(;n<t&&!i[n].skip;)n++;for(;n<t&&i[n].skip;)n++;for(n%=t,e&&(o+=n);o>n&&i[o%t].skip;)o--;return o%=t,{start:n,end:o}}function Rft(i,t,e,r){const n=i.length,o=[];let s=t,a=i[t],c;for(c=t+1;c<=e;++c){const f=i[c%n];f.skip||f.stop?a.skip||(r=!1,o.push({start:t%n,end:(c-1)%n,loop:r}),t=s=f.stop?c:null):(s=c,a.skip&&(t=c)),a=f}return s!==null&&o.push({start:t%n,end:s%n,loop:r}),o}function kft(i,t){const e=i.points,r=i.options.spanGaps,n=e.length;if(!n)return[];const o=!!i._loop,{start:s,end:a}=Lft(e,n,o,r);if(r===!0)return r6(i,[{start:s,end:a,loop:o}],e,t);const c=a<s?a+n:a,f=!!i._fullLoop&&s===0&&a===n-1;return r6(i,Rft(e,s,c,f),e,t)}function r6(i,t,e,r){return!r||!r.setContext||!e?t:Oft(i,t,e,r)}function Oft(i,t,e,r){const n=i._chart.getContext(),o=n6(i.options),{_datasetIndex:s,options:{spanGaps:a}}=i,c=e.length,f=[];let g=o,v=t[0].start,y=v;function w(I,E,D,R){const z=a?-1:1;if(I!==E){for(I+=c;e[I%c].skip;)I-=z;for(;e[E%c].skip;)E+=z;I%c!==E%c&&(f.push({start:I%c,end:E%c,loop:D,style:R}),g=R,v=E%c)}}for(const I of t){v=a?v:I.start;let E=e[v%c],D;for(y=v+1;y<=I.end;y++){const R=e[y%c];D=n6(r.setContext(Hp(n,{type:"segment",p0:E,p1:R,p0DataIndex:(y-1)%c,p1DataIndex:y%c,datasetIndex:s}))),zft(D,g)&&w(v,y-1,I.loop,g),E=R,g=D}v<y-1&&w(v,y-1,I.loop,g)}return f}function n6(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function zft(i,t){if(!t)return!1;const e=[],r=function(n,o){return lF(o)?(e.includes(o)||e.push(o),e.indexOf(o)):o};return JSON.stringify(i,r)!==JSON.stringify(t,r)}function tA(i,t,e){return i.options.clip?i[e]:t[e]}function Bft(i,t){const{xScale:e,yScale:r}=i;return e&&r?{left:tA(e,t,"left"),right:tA(e,t,"right"),top:tA(r,t,"top"),bottom:tA(r,t,"bottom")}:t}function GX(i,t){const e=t._clip;if(e.disabled)return!1;const r=Bft(t,i.chartArea);return{left:e.left===!1?0:r.left-(e.left===!0?0:e.left),right:e.right===!1?i.width:r.right+(e.right===!0?0:e.right),top:e.top===!1?0:r.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?i.height:r.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */let Fft=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,r,n){const o=e.listeners[n],s=e.duration;o.forEach(a=>a({chart:t,initial:e.initial,numSteps:s,currentStep:Math.min(r-e.start,s)}))}_refresh(){this._request||(this._running=!0,this._request=TX.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((r,n)=>{if(!r.running||!r.items.length)return;const o=r.items;let s=o.length-1,a=!1,c;for(;s>=0;--s)c=o[s],c._active?(c._total>r.duration&&(r.duration=c._total),c.tick(t),a=!0):(o[s]=o[o.length-1],o.pop());a&&(n.draw(),this._notify(n,r,t,"progress")),o.length||(r.running=!1,this._notify(n,r,t,"complete"),r.initial=!1),e+=o.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let r=e.get(t);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,r)),r}listen(t,e,r){this._getAnims(t).listeners[e].push(r)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((r,n)=>Math.max(r,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const r=e.items;let n=r.length-1;for(;n>=0;--n)r[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};var od=new Fft;const a6="transparent",Nft={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const r=XG(i||a6),n=r.valid&&XG(t||a6);return n&&n.valid?n.mix(r,e).hexString():t},number(i,t,e){return i+(t-i)*e}};let Vft=class{constructor(t,e,r,n){const o=e[r];n=$b([t.to,n,o,t.from]);const s=$b([t.from,o,n]);this._active=!0,this._fn=t.fn||Nft[t.type||typeof s],this._easing=xw[t.easing]||xw.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=r,this._from=s,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,r){if(this._active){this._notify(!1);const n=this._target[this._prop],o=r-this._start,s=this._duration-o;this._start=r,this._duration=Math.floor(Math.max(s,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=$b([t.to,e,n,t.from]),this._from=$b([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,r=this._duration,n=this._prop,o=this._from,s=this._loop,a=this._to;let c;if(this._active=o!==a&&(s||e<r),!this._active){this._target[n]=a,this._notify(!0);return}if(e<0){this._target[n]=o;return}c=e/r%2,c=s&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[n]=this._fn(o,a,c)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,r)=>{t.push({res:e,rej:r})})}_notify(t){const e=t?"res":"rej",r=this._promises||[];for(let n=0;n<r.length;n++)r[n][e]()}};class HX{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!Nn(t))return;const e=Object.keys($a.animation),r=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const o=t[n];if(!Nn(o))return;const s={};for(const a of e)s[a]=o[a];(Na(o.properties)&&o.properties||[n]).forEach(a=>{(a===n||!r.has(a))&&r.set(a,s)})})}_animateOptions(t,e){const r=e.options,n=Gft(t,r);if(!n)return[];const o=this._createAnimations(n,r);return r.$shared&&Uft(t.options.$animations,r).then(()=>{t.options=r},()=>{}),o}_createAnimations(t,e){const r=this._properties,n=[],o=t.$animations||(t.$animations={}),s=Object.keys(e),a=Date.now();let c;for(c=s.length-1;c>=0;--c){const f=s[c];if(f.charAt(0)==="$")continue;if(f==="options"){n.push(...this._animateOptions(t,e));continue}const g=e[f];let v=o[f];const y=r.get(f);if(v)if(y&&v.active()){v.update(y,g,a);continue}else v.cancel();if(!y||!y.duration){t[f]=g;continue}o[f]=v=new Vft(y,t,f,g),n.push(v)}return n}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const r=this._createAnimations(t,e);if(r.length)return od.add(this._chart,r),!0}}function Uft(i,t){const e=[],r=Object.keys(t);for(let n=0;n<r.length;n++){const o=i[r[n]];o&&o.active()&&e.push(o.wait())}return Promise.all(e)}function Gft(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function o6(i,t){const e=i&&i.options||{},r=e.reverse,n=e.min===void 0?t:0,o=e.max===void 0?t:0;return{start:r?o:n,end:r?n:o}}function Hft(i,t,e){if(e===!1)return!1;const r=o6(i,e),n=o6(t,e);return{top:n.end,right:r.end,bottom:n.start,left:r.start}}function jft(i){let t,e,r,n;return Nn(i)?(t=i.top,e=i.right,r=i.bottom,n=i.left):t=e=r=n=i,{top:t,right:e,bottom:r,left:n,disabled:i===!1}}function jX(i,t){const e=[],r=i._getSortedDatasetMetas(t);let n,o;for(n=0,o=r.length;n<o;++n)e.push(r[n].index);return e}function s6(i,t,e,r={}){const n=i.keys,o=r.mode==="single";let s,a,c,f;if(t===null)return;let g=!1;for(s=0,a=n.length;s<a;++s){if(c=+n[s],c===e){if(g=!0,r.all)continue;break}f=i.values[c],uo(f)&&(o||t===0||fh(t)===fh(f))&&(t+=f)}return!g&&!r.all?0:t}function Wft(i,t){const{iScale:e,vScale:r}=t,n=e.axis==="x"?"x":"y",o=r.axis==="x"?"x":"y",s=Object.keys(i),a=new Array(s.length);let c,f,g;for(c=0,f=s.length;c<f;++c)g=s[c],a[c]={[n]:g,[o]:i[g]};return a}function rL(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function $ft(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function Zft(i){const{min:t,max:e,minDefined:r,maxDefined:n}=i.getUserBounds();return{min:r?t:Number.NEGATIVE_INFINITY,max:n?e:Number.POSITIVE_INFINITY}}function qft(i,t,e){const r=i[t]||(i[t]={});return r[e]||(r[e]={})}function l6(i,t,e,r){for(const n of t.getMatchingVisibleMetas(r).reverse()){const o=i[n.index];if(e&&o>0||!e&&o<0)return n.index}return null}function u6(i,t){const{chart:e,_cachedMeta:r}=i,n=e._stacks||(e._stacks={}),{iScale:o,vScale:s,index:a}=r,c=o.axis,f=s.axis,g=$ft(o,s,r),v=t.length;let y;for(let w=0;w<v;++w){const I=t[w],{[c]:E,[f]:D}=I,R=I._stacks||(I._stacks={});y=R[f]=qft(n,g,E),y[a]=D,y._top=l6(y,s,!0,r.type),y._bottom=l6(y,s,!1,r.type);const z=y._visualValues||(y._visualValues={});z[a]=D}}function nL(i,t){const e=i.scales;return Object.keys(e).filter(r=>e[r].axis===t).shift()}function Xft(i,t){return Hp(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Yft(i,t,e){return Hp(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function sb(i,t){const e=i.controller.index,r=i.vScale&&i.vScale.axis;if(r){t=t||i._parsed;for(const n of t){const o=n._stacks;if(!o||o[r]===void 0||o[r][e]===void 0)return;delete o[r][e],o[r]._visualValues!==void 0&&o[r]._visualValues[e]!==void 0&&delete o[r]._visualValues[e]}}}const aL=i=>i==="reset"||i==="none",c6=(i,t)=>t?i:Object.assign({},i),Kft=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:jX(e,!0),values:null};class dc{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=rL(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&sb(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,r=this.getDataset(),n=(v,y,w,I)=>v==="x"?y:v==="r"?I:w,o=e.xAxisID=cn(r.xAxisID,nL(t,"x")),s=e.yAxisID=cn(r.yAxisID,nL(t,"y")),a=e.rAxisID=cn(r.rAxisID,nL(t,"r")),c=e.indexAxis,f=e.iAxisID=n(c,o,s,a),g=e.vAxisID=n(c,s,o,a);e.xScale=this.getScaleForId(o),e.yScale=this.getScaleForId(s),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(f),e.vScale=this.getScaleForId(g)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&$G(this._data,this),t._stacked&&sb(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),r=this._data;if(Nn(e)){const n=this._cachedMeta;this._data=Wft(e,n)}else if(r!==e){if(r){$G(r,this);const n=this._cachedMeta;sb(n),n._parsed=[]}e&&Object.isExtensible(e)&&Odt(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,r=this.getDataset();let n=!1;this._dataCheck();const o=e._stacked;e._stacked=rL(e.vScale,e),e.stack!==r.stack&&(n=!0,sb(e),e.stack=r.stack),this._resyncElements(t),(n||o!==e._stacked)&&(u6(this,e._parsed),e._stacked=rL(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),r=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:r,_data:n}=this,{iScale:o,_stacked:s}=r,a=o.axis;let c=t===0&&e===n.length?!0:r._sorted,f=t>0&&r._parsed[t-1],g,v,y;if(this._parsing===!1)r._parsed=n,r._sorted=!0,y=n;else{Na(n[t])?y=this.parseArrayData(r,n,t,e):Nn(n[t])?y=this.parseObjectData(r,n,t,e):y=this.parsePrimitiveData(r,n,t,e);const w=()=>v[a]===null||f&&v[a]<f[a];for(g=0;g<e;++g)r._parsed[g+t]=v=y[g],c&&(w()&&(c=!1),f=v);r._sorted=c}s&&u6(this,y)}parsePrimitiveData(t,e,r,n){const{iScale:o,vScale:s}=t,a=o.axis,c=s.axis,f=o.getLabels(),g=o===s,v=new Array(n);let y,w,I;for(y=0,w=n;y<w;++y)I=y+r,v[y]={[a]:g||o.parse(f[I],I),[c]:s.parse(e[I],I)};return v}parseArrayData(t,e,r,n){const{xScale:o,yScale:s}=t,a=new Array(n);let c,f,g,v;for(c=0,f=n;c<f;++c)g=c+r,v=e[g],a[c]={x:o.parse(v[0],g),y:s.parse(v[1],g)};return a}parseObjectData(t,e,r,n){const{xScale:o,yScale:s}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,f=new Array(n);let g,v,y,w;for(g=0,v=n;g<v;++g)y=g+r,w=e[y],f[g]={x:o.parse(Lp(w,a),y),y:s.parse(Lp(w,c),y)};return f}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,r){const n=this.chart,o=this._cachedMeta,s=e[t.axis],a={keys:jX(n,!0),values:e._stacks[t.axis]._visualValues};return s6(a,s,o.index,{mode:r})}updateRangeFromParsed(t,e,r,n){const o=r[e.axis];let s=o===null?NaN:o;const a=n&&r._stacks[e.axis];n&&a&&(n.values=a,s=s6(n,o,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,e){const r=this._cachedMeta,n=r._parsed,o=r._sorted&&t===r.iScale,s=n.length,a=this._getOtherScale(t),c=Kft(e,r,this.chart),f={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:g,max:v}=Zft(a);let y,w;function I(){w=n[y];const E=w[a.axis];return!uo(w[t.axis])||g>E||v<E}for(y=0;y<s&&!(!I()&&(this.updateRangeFromParsed(f,t,w,c),o));++y);if(o){for(y=s-1;y>=0;--y)if(!I()){this.updateRangeFromParsed(f,t,w,c);break}}return f}getAllParsedValues(t){const e=this._cachedMeta._parsed,r=[];let n,o,s;for(n=0,o=e.length;n<o;++n)s=e[n][t.axis],uo(s)&&r.push(s);return r}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,r=e.iScale,n=e.vScale,o=this.getParsed(t);return{label:r?""+r.getLabelForValue(o[r.axis]):"",value:n?""+n.getLabelForValue(o[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=jft(cn(this.options.clip,Hft(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,r=this._cachedMeta,n=r.data||[],o=e.chartArea,s=[],a=this._drawStart||0,c=this._drawCount||n.length-a,f=this.options.drawActiveElementsOnTop;let g;for(r.dataset&&r.dataset.draw(t,o,a,c),g=a;g<a+c;++g){const v=n[g];v.hidden||(v.active&&f?s.push(v):v.draw(t,o))}for(g=0;g<s.length;++g)s[g].draw(t,o)}getStyle(t,e){const r=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(t||0,r)}getContext(t,e,r){const n=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const s=this._cachedMeta.data[t];o=s.$context||(s.$context=Yft(this.getContext(),t,s)),o.parsed=this.getParsed(t),o.raw=n.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=Xft(this.chart.getContext(),this.index)),o.dataset=n,o.index=o.datasetIndex=this.index;return o.active=!!e,o.mode=r,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",r){const n=e==="active",o=this._cachedDataOpts,s=t+"-"+e,a=o[s],c=this.enableOptionSharing&&$w(r);if(a)return c6(a,c);const f=this.chart.config,g=f.datasetElementScopeKeys(this._type,t),v=n?[`${t}Hover`,"hover",t,""]:[t,""],y=f.getOptionScopes(this.getDataset(),g),w=Object.keys($a.elements[t]),I=()=>this.getContext(r,n,e),E=f.resolveNamedOptions(y,w,I,v);return E.$shared&&(E.$shared=c,o[s]=Object.freeze(c6(E,c))),E}_resolveAnimations(t,e,r){const n=this.chart,o=this._cachedDataOpts,s=`animation-${e}`,a=o[s];if(a)return a;let c;if(n.options.animation!==!1){const g=this.chart.config,v=g.datasetAnimationScopeKeys(this._type,e),y=g.getOptionScopes(this.getDataset(),v);c=g.createResolver(y,this.getContext(t,r,e))}const f=new HX(n,c&&c.animations);return c&&c._cacheable&&(o[s]=Object.freeze(f)),f}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||aL(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const r=this.resolveDataElementOptions(t,e),n=this._sharedOptions,o=this.getSharedOptions(r),s=this.includeOptions(e,o)||o!==n;return this.updateSharedOptions(o,e,r),{sharedOptions:o,includeOptions:s}}updateElement(t,e,r,n){aL(n)?Object.assign(t,r):this._resolveAnimations(e,n).update(t,r)}updateSharedOptions(t,e,r){t&&!aL(e)&&this._resolveAnimations(void 0,e).update(t,r)}_setStyle(t,e,r,n){t.active=n;const o=this.getStyle(e,n);this._resolveAnimations(e,r,n).update(t,{options:!n&&this.getSharedOptions(o)||o})}removeHoverStyle(t,e,r){this._setStyle(t,r,"active",!1)}setHoverStyle(t,e,r){this._setStyle(t,r,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,r=this._cachedMeta.data;for(const[a,c,f]of this._syncList)this[a](c,f);this._syncList=[];const n=r.length,o=e.length,s=Math.min(o,n);s&&this.parse(0,s),o>n?this._insertElements(n,o-n,t):o<n&&this._removeElements(o,n-o)}_insertElements(t,e,r=!0){const n=this._cachedMeta,o=n.data,s=t+e;let a;const c=f=>{for(f.length+=e,a=f.length-1;a>=s;a--)f[a]=f[a-e]};for(c(o),a=t;a<s;++a)o[a]=new this.dataElementType;this._parsing&&c(n._parsed),this.parse(t,e),r&&this.updateElements(o,t,e,"reset")}updateElements(t,e,r,n){}_removeElements(t,e){const r=this._cachedMeta;if(this._parsing){const n=r._parsed.splice(t,e);r._stacked&&sb(r,n)}r.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,r,n]=t;this[e](r,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const r=arguments.length-2;r&&this._sync(["_insertElements",t,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Wi(dc,"defaults",{}),Wi(dc,"datasetElementType",null),Wi(dc,"dataElementType",null);function Jft(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let r=[];for(let n=0,o=e.length;n<o;n++)r=r.concat(e[n].controller.getAllParsedValues(i));i._cache.$bar=SX(r.sort((n,o)=>n-o))}return i._cache.$bar}function Qft(i){const t=i.iScale,e=Jft(t,i.type);let r=t._length,n,o,s,a;const c=()=>{s===32767||s===-32768||($w(a)&&(r=Math.min(r,Math.abs(s-a)||r)),a=s)};for(n=0,o=e.length;n<o;++n)s=t.getPixelForValue(e[n]),c();for(a=void 0,n=0,o=t.ticks.length;n<o;++n)s=t.getPixelForTick(n),c();return r}function tpt(i,t,e,r){const n=e.barThickness;let o,s;return On(n)?(o=t.min*e.categoryPercentage,s=e.barPercentage):(o=n*r,s=1),{chunk:o/r,ratio:s,start:t.pixels[i]-o/2}}function ept(i,t,e,r){const n=t.pixels,o=n[i];let s=i>0?n[i-1]:null,a=i<n.length-1?n[i+1]:null;const c=e.categoryPercentage;s===null&&(s=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-s);const f=o-(o-Math.min(s,a))/2*c;return{chunk:Math.abs(a-s)/2*c/r,ratio:e.barPercentage,start:f}}function ipt(i,t,e,r){const n=e.parse(i[0],r),o=e.parse(i[1],r),s=Math.min(n,o),a=Math.max(n,o);let c=s,f=a;Math.abs(s)>Math.abs(a)&&(c=a,f=s),t[e.axis]=f,t._custom={barStart:c,barEnd:f,start:n,end:o,min:s,max:a}}function WX(i,t,e,r){return Na(i)?ipt(i,t,e,r):t[e.axis]=e.parse(i,r),t}function h6(i,t,e,r){const n=i.iScale,o=i.vScale,s=n.getLabels(),a=n===o,c=[];let f,g,v,y;for(f=e,g=e+r;f<g;++f)y=t[f],v={},v[n.axis]=a||n.parse(s[f],f),c.push(WX(y,v,o,f));return c}function oL(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function rpt(i,t,e){return i!==0?fh(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function npt(i){let t,e,r,n,o;return i.horizontal?(t=i.base>i.x,e="left",r="right"):(t=i.base<i.y,e="bottom",r="top"),t?(n="end",o="start"):(n="start",o="end"),{start:e,end:r,reverse:t,top:n,bottom:o}}function apt(i,t,e,r){let n=t.borderSkipped;const o={};if(!n){i.borderSkipped=o;return}if(n===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:s,end:a,reverse:c,top:f,bottom:g}=npt(i);n==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===r?n=f:(e._bottom||0)===r?n=g:(o[d6(g,s,a,c)]=!0,n=f)),o[d6(n,s,a,c)]=!0,i.borderSkipped=o}function d6(i,t,e,r){return r?(i=opt(i,t,e),i=f6(i,e,t)):i=f6(i,t,e),i}function opt(i,t,e){return i===t?e:i===e?t:i}function f6(i,t,e){return i==="start"?t:i==="end"?e:i}function spt(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class PI extends dc{parsePrimitiveData(t,e,r,n){return h6(t,e,r,n)}parseArrayData(t,e,r,n){return h6(t,e,r,n)}parseObjectData(t,e,r,n){const{iScale:o,vScale:s}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,f=o.axis==="x"?a:c,g=s.axis==="x"?a:c,v=[];let y,w,I,E;for(y=r,w=r+n;y<w;++y)E=e[y],I={},I[o.axis]=o.parse(Lp(E,f),y),v.push(WX(Lp(E,g),I,s,y));return v}updateRangeFromParsed(t,e,r,n){super.updateRangeFromParsed(t,e,r,n);const o=r._custom;o&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:r,vScale:n}=e,o=this.getParsed(t),s=o._custom,a=oL(s)?"["+s.start+", "+s.end+"]":""+n.getLabelForValue(o[n.axis]);return{label:""+r.getLabelForValue(o[r.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,r,n){const o=n==="reset",{index:s,_cachedMeta:{vScale:a}}=this,c=a.getBasePixel(),f=a.isHorizontal(),g=this._getRuler(),{sharedOptions:v,includeOptions:y}=this._getSharedOptions(e,n);for(let w=e;w<e+r;w++){const I=this.getParsed(w),E=o||On(I[a.axis])?{base:c,head:c}:this._calculateBarValuePixels(w),D=this._calculateBarIndexPixels(w,g),R=(I._stacks||{})[a.axis],z={horizontal:f,base:E.base,enableBorderRadius:!R||oL(I._custom)||s===R._top||s===R._bottom,x:f?E.head:D.center,y:f?D.center:E.head,height:f?D.size:Math.abs(E.size),width:f?Math.abs(E.size):D.size};y&&(z.options=v||this.resolveDataElementOptions(w,t[w].active?"active":n));const N=z.options||t[w].options;apt(z,N,R,s),spt(z,N,g.ratio),this.updateElement(t[w],w,z,n)}}_getStacks(t,e){const{iScale:r}=this._cachedMeta,n=r.getMatchingVisibleMetas(this._type).filter(g=>g.controller.options.grouped),o=r.options.stacked,s=[],a=this._cachedMeta.controller.getParsed(e),c=a&&a[r.axis],f=g=>{const v=g._parsed.find(w=>w[r.axis]===c),y=v&&v[g.vScale.axis];if(On(y)||isNaN(y))return!0};for(const g of n)if(!(e!==void 0&&f(g))&&((o===!1||s.indexOf(g.stack)===-1||o===void 0&&g.stack===void 0)&&s.push(g.stack),g.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(r=>t[r].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const r of this.chart.data.datasets)t[cn(this.chart.options.indexAxis==="x"?r.xAxisID:r.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,r){const n=this._getStacks(t,r),o=e!==void 0?n.indexOf(e):-1;return o===-1?n.length-1:o}_getRuler(){const t=this.options,e=this._cachedMeta,r=e.iScale,n=[];let o,s;for(o=0,s=e.data.length;o<s;++o)n.push(r.getPixelForValue(this.getParsed(o)[r.axis],o));const a=t.barThickness;return{min:a||Qft(e),pixels:n,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:r,index:n},options:{base:o,minBarLength:s}}=this,a=o||0,c=this.getParsed(t),f=c._custom,g=oL(f);let v=c[e.axis],y=0,w=r?this.applyStack(e,c,r):v,I,E;w!==v&&(y=w-v,w=v),g&&(v=f.barStart,w=f.barEnd-f.barStart,v!==0&&fh(v)!==fh(f.barEnd)&&(y=0),y+=v);const D=!On(o)&&!g?o:y;let R=e.getPixelForValue(D);if(this.chart.getDataVisibility(t)?I=e.getPixelForValue(y+w):I=R,E=I-R,Math.abs(E)<s){E=rpt(E,e,a)*s,v===a&&(R-=E/2);const z=e.getPixelForDecimal(0),N=e.getPixelForDecimal(1),H=Math.min(z,N),q=Math.max(z,N);R=Math.max(Math.min(R,q),H),I=R+E,r&&!g&&(c._stacks[e.axis]._visualValues[n]=e.getValueForPixel(I)-e.getValueForPixel(R))}if(R===e.getPixelForValue(a)){const z=fh(E)*e.getLineWidthForValue(a)/2;R+=z,E-=z}return{size:E,base:R,head:I,center:I+E/2}}_calculateBarIndexPixels(t,e){const r=e.scale,n=this.options,o=n.skipNull,s=cn(n.maxBarThickness,1/0);let a,c;const f=this._getAxisCount();if(e.grouped){const g=o?this._getStackCount(t):e.stackCount,v=n.barThickness==="flex"?ept(t,e,n,g*f):tpt(t,e,n,g*f),y=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,w=this._getAxis().indexOf(cn(y,this.getFirstScaleIdForIndexAxis())),I=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+w;a=v.start+v.chunk*I+v.chunk/2,c=Math.min(s,v.chunk*v.ratio)}else a=r.getPixelForValue(this.getParsed(t)[r.axis],t),c=Math.min(s,e.min*e.ratio);return{base:a-c/2,head:a+c/2,center:a,size:c}}draw(){const t=this._cachedMeta,e=t.vScale,r=t.data,n=r.length;let o=0;for(;o<n;++o)this.getParsed(o)[e.axis]!==null&&!r[o].hidden&&r[o].draw(this._ctx)}}Wi(PI,"id","bar"),Wi(PI,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Wi(PI,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class LI extends dc{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,r,n){const o=super.parsePrimitiveData(t,e,r,n);for(let s=0;s<o.length;s++)o[s]._custom=this.resolveDataElementOptions(s+r).radius;return o}parseArrayData(t,e,r,n){const o=super.parseArrayData(t,e,r,n);for(let s=0;s<o.length;s++){const a=e[r+s];o[s]._custom=cn(a[2],this.resolveDataElementOptions(s+r).radius)}return o}parseObjectData(t,e,r,n){const o=super.parseObjectData(t,e,r,n);for(let s=0;s<o.length;s++){const a=e[r+s];o[s]._custom=cn(a&&a.r&&+a.r,this.resolveDataElementOptions(s+r).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let r=t.length-1;r>=0;--r)e=Math.max(e,t[r].size(this.resolveDataElementOptions(r))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,r=this.chart.data.labels||[],{xScale:n,yScale:o}=e,s=this.getParsed(t),a=n.getLabelForValue(s.x),c=o.getLabelForValue(s.y),f=s._custom;return{label:r[t]||"",value:"("+a+", "+c+(f?", "+f:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,r,n){const o=n==="reset",{iScale:s,vScale:a}=this._cachedMeta,{sharedOptions:c,includeOptions:f}=this._getSharedOptions(e,n),g=s.axis,v=a.axis;for(let y=e;y<e+r;y++){const w=t[y],I=!o&&this.getParsed(y),E={},D=E[g]=o?s.getPixelForDecimal(.5):s.getPixelForValue(I[g]),R=E[v]=o?a.getBasePixel():a.getPixelForValue(I[v]);E.skip=isNaN(D)||isNaN(R),f&&(E.options=c||this.resolveDataElementOptions(y,w.active?"active":n),o&&(E.options.radius=0)),this.updateElement(w,y,E,n)}}resolveDataElementOptions(t,e){const r=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const o=n.radius;return e!=="active"&&(n.radius=0),n.radius+=cn(r&&r._custom,o),n}}Wi(LI,"id","bubble"),Wi(LI,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),Wi(LI,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function lpt(i,t,e){let r=1,n=1,o=0,s=0;if(t<Va){const a=i,c=a+t,f=Math.cos(a),g=Math.sin(a),v=Math.cos(c),y=Math.sin(c),w=(N,H,q)=>Zw(N,a,c,!0)?1:Math.max(H,H*e,q,q*e),I=(N,H,q)=>Zw(N,a,c,!0)?-1:Math.min(H,H*e,q,q*e),E=w(0,f,v),D=w(yo,g,y),R=I(ea,f,v),z=I(ea+yo,g,y);r=(E-R)/2,n=(D-z)/2,o=-(E+R)/2,s=-(D+z)/2}return{ratioX:r,ratioY:n,offsetX:o,offsetY:s}}class Hm extends dc{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const r=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=r;else{let o=c=>+r[c];if(Nn(r[t])){const{key:c="value"}=this._parsing;o=f=>+Lp(r[f],c)}let s,a;for(s=t,a=t+e;s<a;++s)n._parsed[s]=o(s)}}_getRotation(){return lc(this.options.rotation-90)}_getCircumference(){return lc(this.options.circumference)}_getRotationExtents(){let t=Va,e=-Va;for(let r=0;r<this.chart.data.datasets.length;++r)if(this.chart.isDatasetVisible(r)&&this.chart.getDatasetMeta(r).type===this._type){const n=this.chart.getDatasetMeta(r).controller,o=n._getRotation(),s=n._getCircumference();t=Math.min(t,o),e=Math.max(e,o+s)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:r}=e,n=this._cachedMeta,o=n.data,s=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(r.width,r.height)-s)/2,0),c=Math.min(xdt(this.options.cutout,a),1),f=this._getRingWeight(this.index),{circumference:g,rotation:v}=this._getRotationExtents(),{ratioX:y,ratioY:w,offsetX:I,offsetY:E}=lpt(v,g,c),D=(r.width-s)/y,R=(r.height-s)/w,z=Math.max(Math.min(D,R)/2,0),N=_X(this.options.radius,z),H=Math.max(N*c,0),q=(N-H)/this._getVisibleDatasetWeightTotal();this.offsetX=I*N,this.offsetY=E*N,n.total=this.calculateTotal(),this.outerRadius=N-q*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-q*f,0),this.updateElements(o,0,o.length,t)}_circumference(t,e){const r=this.options,n=this._cachedMeta,o=this._getCircumference();return e&&r.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*o/Va)}updateElements(t,e,r,n){const o=n==="reset",s=this.chart,a=s.chartArea,f=s.options.animation,g=(a.left+a.right)/2,v=(a.top+a.bottom)/2,y=o&&f.animateScale,w=y?0:this.innerRadius,I=y?0:this.outerRadius,{sharedOptions:E,includeOptions:D}=this._getSharedOptions(e,n);let R=this._getRotation(),z;for(z=0;z<e;++z)R+=this._circumference(z,o);for(z=e;z<e+r;++z){const N=this._circumference(z,o),H=t[z],q={x:g+this.offsetX,y:v+this.offsetY,startAngle:R,endAngle:R+N,circumference:N,outerRadius:I,innerRadius:w};D&&(q.options=E||this.resolveDataElementOptions(z,H.active?"active":n)),R+=N,this.updateElement(H,z,q,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let r=0,n;for(n=0;n<e.length;n++){const o=t._parsed[n];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(n)&&!e[n].hidden&&(r+=Math.abs(o))}return r}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?Va*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,r=this.chart,n=r.data.labels||[],o=OS(e._parsed[t],r.options.locale);return{label:n[t]||"",value:o}}getMaxBorderWidth(t){let e=0;const r=this.chart;let n,o,s,a,c;if(!t){for(n=0,o=r.data.datasets.length;n<o;++n)if(r.isDatasetVisible(n)){s=r.getDatasetMeta(n),t=s.data,a=s.controller;break}}if(!t)return 0;for(n=0,o=t.length;n<o;++n)c=a.resolveDataElementOptions(n),c.borderAlign!=="inner"&&(e=Math.max(e,c.borderWidth||0,c.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let r=0,n=t.length;r<n;++r){const o=this.resolveDataElementOptions(r);e=Math.max(e,o.offset||0,o.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let r=0;r<t;++r)this.chart.isDatasetVisible(r)&&(e+=this._getRingWeight(r));return e}_getRingWeight(t){return Math.max(cn(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Wi(Hm,"id","doughnut"),Wi(Hm,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),Wi(Hm,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),Wi(Hm,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:r,textAlign:n,color:o,useBorderRadius:s,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((c,f)=>{const v=t.getDatasetMeta(0).controller.getStyle(f);return{text:c,fillStyle:v.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(f),lineDash:v.borderDash,lineDashOffset:v.borderDashOffset,lineJoin:v.borderJoinStyle,lineWidth:v.borderWidth,strokeStyle:v.borderColor,textAlign:n,pointStyle:r,borderRadius:s&&(a||v.borderRadius),index:f}}):[]}},onClick(t,e,r){r.chart.toggleDataVisibility(e.index),r.chart.update()}}}});class RI extends dc{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:r,data:n=[],_dataset:o}=e,s=this.chart._animationsDisabled;let{start:a,count:c}=IX(e,n,s);this._drawStart=a,this._drawCount=c,CX(e)&&(a=0,c=n.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!o._decimated,r.points=n;const f=this.resolveDatasetElementOptions(t);this.options.showLine||(f.borderWidth=0),f.segment=this.options.segment,this.updateElement(r,void 0,{animated:!s,options:f},t),this.updateElements(n,a,c,t)}updateElements(t,e,r,n){const o=n==="reset",{iScale:s,vScale:a,_stacked:c,_dataset:f}=this._cachedMeta,{sharedOptions:g,includeOptions:v}=this._getSharedOptions(e,n),y=s.axis,w=a.axis,{spanGaps:I,segment:E}=this.options,D=v0(I)?I:Number.POSITIVE_INFINITY,R=this.chart._animationsDisabled||o||n==="none",z=e+r,N=t.length;let H=e>0&&this.getParsed(e-1);for(let q=0;q<N;++q){const Y=t[q],J=R?Y:{};if(q<e||q>=z){J.skip=!0;continue}const it=this.getParsed(q),at=On(it[w]),ut=J[y]=s.getPixelForValue(it[y],q),ft=J[w]=o||at?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,it,c):it[w],q);J.skip=isNaN(ut)||isNaN(ft)||at,J.stop=q>0&&Math.abs(it[y]-H[y])>D,E&&(J.parsed=it,J.raw=f.data[q]),v&&(J.options=g||this.resolveDataElementOptions(q,Y.active?"active":n)),R||this.updateElement(Y,q,J,n),H=it}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,r=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return r;const o=n[0].size(this.resolveDataElementOptions(0)),s=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(r,o,s)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Wi(RI,"id","line"),Wi(RI,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Wi(RI,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ww extends dc{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,r=this.chart,n=r.data.labels||[],o=OS(e._parsed[t].r,r.options.locale);return{label:n[t]||"",value:o}}parseObjectData(t,e,r,n){return OX.bind(this)(t,e,r,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((r,n)=>{const o=this.getParsed(n).r;!isNaN(o)&&this.chart.getDataVisibility(n)&&(o<e.min&&(e.min=o),o>e.max&&(e.max=o))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,r=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),o=Math.max(n/2,0),s=Math.max(r.cutoutPercentage?o/100*r.cutoutPercentage:1,0),a=(o-s)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,r,n){const o=n==="reset",s=this.chart,c=s.options.animation,f=this._cachedMeta.rScale,g=f.xCenter,v=f.yCenter,y=f.getIndexAngle(0)-.5*ea;let w=y,I;const E=360/this.countVisibleElements();for(I=0;I<e;++I)w+=this._computeAngle(I,n,E);for(I=e;I<e+r;I++){const D=t[I];let R=w,z=w+this._computeAngle(I,n,E),N=s.getDataVisibility(I)?f.getDistanceFromCenterForValue(this.getParsed(I).r):0;w=z,o&&(c.animateScale&&(N=0),c.animateRotate&&(R=z=y));const H={x:g,y:v,innerRadius:0,outerRadius:N,startAngle:R,endAngle:z,options:this.resolveDataElementOptions(I,D.active?"active":n)};this.updateElement(D,I,H,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((r,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,r){return this.chart.getDataVisibility(t)?lc(this.resolveDataElementOptions(t,e).angle||r):0}}Wi(ww,"id","polarArea"),Wi(ww,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),Wi(ww,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:r,color:n}}=t.legend.options;return e.labels.map((o,s)=>{const c=t.getDatasetMeta(0).controller.getStyle(s);return{text:o,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:n,lineWidth:c.borderWidth,pointStyle:r,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,e,r){r.chart.toggleDataVisibility(e.index),r.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class uO extends Hm{}Wi(uO,"id","pie"),Wi(uO,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class kI extends dc{getLabelAndValue(t){const e=this._cachedMeta.vScale,r=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(r[e.axis])}}parseObjectData(t,e,r,n){return OX.bind(this)(t,e,r,n)}update(t){const e=this._cachedMeta,r=e.dataset,n=e.data||[],o=e.iScale.getLabels();if(r.points=n,t!=="resize"){const s=this.resolveDatasetElementOptions(t);this.options.showLine||(s.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===n.length,options:s};this.updateElement(r,void 0,a,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,r,n){const o=this._cachedMeta.rScale,s=n==="reset";for(let a=e;a<e+r;a++){const c=t[a],f=this.resolveDataElementOptions(a,c.active?"active":n),g=o.getPointPositionForValue(a,this.getParsed(a).r),v=s?o.xCenter:g.x,y=s?o.yCenter:g.y,w={x:v,y,angle:g.angle,skip:isNaN(v)||isNaN(y),options:f};this.updateElement(c,a,w,n)}}}Wi(kI,"id","radar"),Wi(kI,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),Wi(kI,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class OI extends dc{getLabelAndValue(t){const e=this._cachedMeta,r=this.chart.data.labels||[],{xScale:n,yScale:o}=e,s=this.getParsed(t),a=n.getLabelForValue(s.x),c=o.getLabelForValue(s.y);return{label:r[t]||"",value:"("+a+", "+c+")"}}update(t){const e=this._cachedMeta,{data:r=[]}=e,n=this.chart._animationsDisabled;let{start:o,count:s}=IX(e,r,n);if(this._drawStart=o,this._drawCount=s,CX(e)&&(o=0,s=r.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:c}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!c._decimated,a.points=r;const f=this.resolveDatasetElementOptions(t);f.segment=this.options.segment,this.updateElement(a,void 0,{animated:!n,options:f},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(r,o,s,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,r,n){const o=n==="reset",{iScale:s,vScale:a,_stacked:c,_dataset:f}=this._cachedMeta,g=this.resolveDataElementOptions(e,n),v=this.getSharedOptions(g),y=this.includeOptions(n,v),w=s.axis,I=a.axis,{spanGaps:E,segment:D}=this.options,R=v0(E)?E:Number.POSITIVE_INFINITY,z=this.chart._animationsDisabled||o||n==="none";let N=e>0&&this.getParsed(e-1);for(let H=e;H<e+r;++H){const q=t[H],Y=this.getParsed(H),J=z?q:{},it=On(Y[I]),at=J[w]=s.getPixelForValue(Y[w],H),ut=J[I]=o||it?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,Y,c):Y[I],H);J.skip=isNaN(at)||isNaN(ut)||it,J.stop=H>0&&Math.abs(Y[w]-N[w])>R,D&&(J.parsed=Y,J.raw=f.data[H]),y&&(J.options=v||this.resolveDataElementOptions(H,q.active?"active":n)),z||this.updateElement(q,H,J,n),N=Y}this.updateSharedOptions(v,n,g)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let c=e.length-1;c>=0;--c)a=Math.max(a,e[c].size(this.resolveDataElementOptions(c))/2);return a>0&&a}const r=t.dataset,n=r.options&&r.options.borderWidth||0;if(!e.length)return n;const o=e[0].size(this.resolveDataElementOptions(0)),s=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,o,s)/2}}Wi(OI,"id","scatter"),Wi(OI,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),Wi(OI,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var upt=Object.freeze({__proto__:null,BarController:PI,BubbleController:LI,DoughnutController:Hm,LineController:RI,PieController:uO,PolarAreaController:ww,RadarController:kI,ScatterController:OI});function tm(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class gF{constructor(t){Wi(this,"options");this.options=t||{}}static override(t){Object.assign(gF.prototype,t)}init(){}formats(){return tm()}parse(){return tm()}format(){return tm()}add(){return tm()}diff(){return tm()}startOf(){return tm()}endOf(){return tm()}}var cpt={_date:gF};function hpt(i,t,e,r){const{controller:n,data:o,_sorted:s}=i,a=n._cachedMeta.iScale,c=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&s&&o.length){const f=a._reversePixels?Rdt:_d;if(r){if(n._sharedOptions){const g=o[0],v=typeof g.getRange=="function"&&g.getRange(t);if(v){const y=f(o,t,e-v),w=f(o,t,e+v);return{lo:y.lo,hi:w.hi}}}}else{const g=f(o,t,e);if(c){const{vScale:v}=n._cachedMeta,{_parsed:y}=i,w=y.slice(0,g.lo+1).reverse().findIndex(E=>!On(E[v.axis]));g.lo-=Math.max(0,w);const I=y.slice(g.hi).findIndex(E=>!On(E[v.axis]));g.hi+=Math.max(0,I)}return g}}return{lo:0,hi:o.length-1}}function zS(i,t,e,r,n){const o=i.getSortedVisibleDatasetMetas(),s=e[t];for(let a=0,c=o.length;a<c;++a){const{index:f,data:g}=o[a],{lo:v,hi:y}=hpt(o[a],t,s,n);for(let w=v;w<=y;++w){const I=g[w];I.skip||r(I,f,w)}}}function dpt(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(r,n){const o=t?Math.abs(r.x-n.x):0,s=e?Math.abs(r.y-n.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(s,2))}}function sL(i,t,e,r,n){const o=[];return!n&&!i.isPointInArea(t)||zS(i,e,t,function(a,c,f){!n&&!yd(a,i.chartArea,0)||a.inRange(t.x,t.y,r)&&o.push({element:a,datasetIndex:c,index:f})},!0),o}function fpt(i,t,e,r){let n=[];function o(s,a,c){const{startAngle:f,endAngle:g}=s.getProps(["startAngle","endAngle"],r),{angle:v}=bX(s,{x:t.x,y:t.y});Zw(v,f,g)&&n.push({element:s,datasetIndex:a,index:c})}return zS(i,e,t,o),n}function ppt(i,t,e,r,n,o){let s=[];const a=dpt(e);let c=Number.POSITIVE_INFINITY;function f(g,v,y){const w=g.inRange(t.x,t.y,n);if(r&&!w)return;const I=g.getCenterPoint(n);if(!(!!o||i.isPointInArea(I))&&!w)return;const D=a(t,I);D<c?(s=[{element:g,datasetIndex:v,index:y}],c=D):D===c&&s.push({element:g,datasetIndex:v,index:y})}return zS(i,e,t,f),s}function lL(i,t,e,r,n,o){return!o&&!i.isPointInArea(t)?[]:e==="r"&&!r?fpt(i,t,e,n):ppt(i,t,e,r,n,o)}function p6(i,t,e,r,n){const o=[],s=e==="x"?"inXRange":"inYRange";let a=!1;return zS(i,e,t,(c,f,g)=>{c[s]&&c[s](t[e],n)&&(o.push({element:c,datasetIndex:f,index:g}),a=a||c.inRange(t.x,t.y,n))}),r&&!a?[]:o}var gpt={evaluateInteractionItems:zS,modes:{index(i,t,e,r){const n=Dm(t,i),o=e.axis||"x",s=e.includeInvisible||!1,a=e.intersect?sL(i,n,o,r,s):lL(i,n,o,!1,r,s),c=[];return a.length?(i.getSortedVisibleDatasetMetas().forEach(f=>{const g=a[0].index,v=f.data[g];v&&!v.skip&&c.push({element:v,datasetIndex:f.index,index:g})}),c):[]},dataset(i,t,e,r){const n=Dm(t,i),o=e.axis||"xy",s=e.includeInvisible||!1;let a=e.intersect?sL(i,n,o,r,s):lL(i,n,o,!1,r,s);if(a.length>0){const c=a[0].datasetIndex,f=i.getDatasetMeta(c).data;a=[];for(let g=0;g<f.length;++g)a.push({element:f[g],datasetIndex:c,index:g})}return a},point(i,t,e,r){const n=Dm(t,i),o=e.axis||"xy",s=e.includeInvisible||!1;return sL(i,n,o,r,s)},nearest(i,t,e,r){const n=Dm(t,i),o=e.axis||"xy",s=e.includeInvisible||!1;return lL(i,n,o,e.intersect,r,s)},x(i,t,e,r){const n=Dm(t,i);return p6(i,n,"x",e.intersect,r)},y(i,t,e,r){const n=Dm(t,i);return p6(i,n,"y",e.intersect,r)}}};const $X=["left","top","right","bottom"];function lb(i,t){return i.filter(e=>e.pos===t)}function g6(i,t){return i.filter(e=>$X.indexOf(e.pos)===-1&&e.box.axis===t)}function ub(i,t){return i.sort((e,r)=>{const n=t?r:e,o=t?e:r;return n.weight===o.weight?n.index-o.index:n.weight-o.weight})}function mpt(i){const t=[];let e,r,n,o,s,a;for(e=0,r=(i||[]).length;e<r;++e)n=i[e],{position:o,options:{stack:s,stackWeight:a=1}}=n,t.push({index:e,box:n,pos:o,horizontal:n.isHorizontal(),weight:n.weight,stack:s&&o+s,stackWeight:a});return t}function vpt(i){const t={};for(const e of i){const{stack:r,pos:n,stackWeight:o}=e;if(!r||!$X.includes(n))continue;const s=t[r]||(t[r]={count:0,placed:0,weight:0,size:0});s.count++,s.weight+=o}return t}function _pt(i,t){const e=vpt(i),{vBoxMaxWidth:r,hBoxMaxHeight:n}=t;let o,s,a;for(o=0,s=i.length;o<s;++o){a=i[o];const{fullSize:c}=a.box,f=e[a.stack],g=f&&a.stackWeight/f.weight;a.horizontal?(a.width=g?g*r:c&&t.availableWidth,a.height=n):(a.width=r,a.height=g?g*n:c&&t.availableHeight)}return e}function ypt(i){const t=mpt(i),e=ub(t.filter(f=>f.box.fullSize),!0),r=ub(lb(t,"left"),!0),n=ub(lb(t,"right")),o=ub(lb(t,"top"),!0),s=ub(lb(t,"bottom")),a=g6(t,"x"),c=g6(t,"y");return{fullSize:e,leftAndTop:r.concat(o),rightAndBottom:n.concat(c).concat(s).concat(a),chartArea:lb(t,"chartArea"),vertical:r.concat(n).concat(c),horizontal:o.concat(s).concat(a)}}function m6(i,t,e,r){return Math.max(i[e],t[e])+Math.max(i[r],t[r])}function ZX(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function xpt(i,t,e,r){const{pos:n,box:o}=e,s=i.maxPadding;if(!Nn(n)){e.size&&(i[n]-=e.size);const v=r[e.stack]||{size:0,count:1};v.size=Math.max(v.size,e.horizontal?o.height:o.width),e.size=v.size/v.count,i[n]+=e.size}o.getPadding&&ZX(s,o.getPadding());const a=Math.max(0,t.outerWidth-m6(s,i,"left","right")),c=Math.max(0,t.outerHeight-m6(s,i,"top","bottom")),f=a!==i.w,g=c!==i.h;return i.w=a,i.h=c,e.horizontal?{same:f,other:g}:{same:g,other:f}}function bpt(i){const t=i.maxPadding;function e(r){const n=Math.max(t[r]-i[r],0);return i[r]+=n,n}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function wpt(i,t){const e=t.maxPadding;function r(n){const o={left:0,top:0,right:0,bottom:0};return n.forEach(s=>{o[s]=Math.max(t[s],e[s])}),o}return r(i?["left","right"]:["top","bottom"])}function Zb(i,t,e,r){const n=[];let o,s,a,c,f,g;for(o=0,s=i.length,f=0;o<s;++o){a=i[o],c=a.box,c.update(a.width||t.w,a.height||t.h,wpt(a.horizontal,t));const{same:v,other:y}=xpt(t,e,a,r);f|=v&&n.length,g=g||y,c.fullSize||n.push(a)}return f&&Zb(n,t,e,r)||g}function eA(i,t,e,r,n){i.top=e,i.left=t,i.right=t+r,i.bottom=e+n,i.width=r,i.height=n}function v6(i,t,e,r){const n=e.padding;let{x:o,y:s}=t;for(const a of i){const c=a.box,f=r[a.stack]||{count:1,placed:0,weight:1},g=a.stackWeight/f.weight||1;if(a.horizontal){const v=t.w*g,y=f.size||c.height;$w(f.start)&&(s=f.start),c.fullSize?eA(c,n.left,s,e.outerWidth-n.right-n.left,y):eA(c,t.left+f.placed,s,v,y),f.start=s,f.placed+=v,s=c.bottom}else{const v=t.h*g,y=f.size||c.width;$w(f.start)&&(o=f.start),c.fullSize?eA(c,o,n.top,y,e.outerHeight-n.bottom-n.top):eA(c,o,t.top+f.placed,y,v),f.start=o,f.placed+=v,o=c.right}}t.x=o,t.y=s}var Os={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,r){if(!i)return;const n=Fs(i.options.layout.padding),o=Math.max(t-n.width,0),s=Math.max(e-n.height,0),a=ypt(i.boxes),c=a.vertical,f=a.horizontal;_a(i.boxes,E=>{typeof E.beforeLayout=="function"&&E.beforeLayout()});const g=c.reduce((E,D)=>D.box.options&&D.box.options.display===!1?E:E+1,0)||1,v=Object.freeze({outerWidth:t,outerHeight:e,padding:n,availableWidth:o,availableHeight:s,vBoxMaxWidth:o/2/g,hBoxMaxHeight:s/2}),y=Object.assign({},n);ZX(y,Fs(r));const w=Object.assign({maxPadding:y,w:o,h:s,x:n.left,y:n.top},n),I=_pt(c.concat(f),v);Zb(a.fullSize,w,v,I),Zb(c,w,v,I),Zb(f,w,v,I)&&Zb(c,w,v,I),bpt(w),v6(a.leftAndTop,w,v,I),w.x+=w.w,w.y+=w.h,v6(a.rightAndBottom,w,v,I),i.chartArea={left:w.left,top:w.top,right:w.left+w.w,bottom:w.top+w.h,height:w.h,width:w.w},_a(a.chartArea,E=>{const D=E.box;Object.assign(D,i.chartArea),D.update(w.w,w.h,{left:0,top:0,right:0,bottom:0})})}};class qX{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,r){}removeEventListener(t,e,r){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,r,n){return e=Math.max(0,e||t.width),r=r||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):r)}}isAttached(t){return!0}updateConfig(t){}}class Spt extends qX{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const zI="$chartjs",Tpt={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},_6=i=>i===null||i==="";function Apt(i,t){const e=i.style,r=i.getAttribute("height"),n=i.getAttribute("width");if(i[zI]={initial:{height:r,width:n,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",_6(n)){const o=e6(i,"width");o!==void 0&&(i.width=o)}if(_6(r))if(i.style.height==="")i.height=i.width/(t||2);else{const o=e6(i,"height");o!==void 0&&(i.height=o)}return i}const XX=Ift?{passive:!0}:!1;function Ipt(i,t,e){i&&i.addEventListener(t,e,XX)}function Cpt(i,t,e){i&&i.canvas&&i.canvas.removeEventListener(t,e,XX)}function Mpt(i,t){const e=Tpt[i.type]||i.type,{x:r,y:n}=Dm(i,t);return{type:e,chart:t,native:i,x:r!==void 0?r:null,y:n!==void 0?n:null}}function wC(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function Ept(i,t,e){const r=i.canvas,n=new MutationObserver(o=>{let s=!1;for(const a of o)s=s||wC(a.addedNodes,r),s=s&&!wC(a.removedNodes,r);s&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}function Dpt(i,t,e){const r=i.canvas,n=new MutationObserver(o=>{let s=!1;for(const a of o)s=s||wC(a.removedNodes,r),s=s&&!wC(a.addedNodes,r);s&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}const Xw=new Map;let y6=0;function YX(){const i=window.devicePixelRatio;i!==y6&&(y6=i,Xw.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function Ppt(i,t){Xw.size||window.addEventListener("resize",YX),Xw.set(i,t)}function Lpt(i){Xw.delete(i),Xw.size||window.removeEventListener("resize",YX)}function Rpt(i,t,e){const r=i.canvas,n=r&&pF(r);if(!n)return;const o=AX((a,c)=>{const f=n.clientWidth;e(a,c),f<n.clientWidth&&e()},window),s=new ResizeObserver(a=>{const c=a[0],f=c.contentRect.width,g=c.contentRect.height;f===0&&g===0||o(f,g)});return s.observe(n),Ppt(i,o),s}function uL(i,t,e){e&&e.disconnect(),t==="resize"&&Lpt(i)}function kpt(i,t,e){const r=i.canvas,n=AX(o=>{i.ctx!==null&&e(Mpt(o,i))},i);return Ipt(r,t,n),n}class Opt extends qX{acquireContext(t,e){const r=t&&t.getContext&&t.getContext("2d");return r&&r.canvas===t?(Apt(t,e),r):null}releaseContext(t){const e=t.canvas;if(!e[zI])return!1;const r=e[zI].initial;["height","width"].forEach(o=>{const s=r[o];On(s)?e.removeAttribute(o):e.setAttribute(o,s)});const n=r.style||{};return Object.keys(n).forEach(o=>{e.style[o]=n[o]}),e.width=e.width,delete e[zI],!0}addEventListener(t,e,r){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),s={attach:Ept,detach:Dpt,resize:Rpt}[e]||kpt;n[e]=s(t,e,r)}removeEventListener(t,e){const r=t.$proxies||(t.$proxies={}),n=r[e];if(!n)return;({attach:uL,detach:uL,resize:uL}[e]||Cpt)(t,e,n),r[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,r,n){return Aft(t,e,r,n)}isAttached(t){const e=t&&pF(t);return!!(e&&e.isConnected)}}function zpt(i){return!fF()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?Spt:Opt}var TI;let Hd=(TI=class{constructor(){Wi(this,"x");Wi(this,"y");Wi(this,"active",!1);Wi(this,"options");Wi(this,"$animations")}tooltipPosition(t){const{x:e,y:r}=this.getProps(["x","y"],t);return{x:e,y:r}}hasValue(){return v0(this.x)&&v0(this.y)}getProps(t,e){const r=this.$animations;if(!e||!r)return this;const n={};return t.forEach(o=>{n[o]=r[o]&&r[o].active()?r[o]._to:this[o]}),n}},Wi(TI,"defaults",{}),Wi(TI,"defaultRoutes"),TI);function Bpt(i,t){const e=i.options.ticks,r=Fpt(i),n=Math.min(e.maxTicksLimit||r,r),o=e.major.enabled?Vpt(t):[],s=o.length,a=o[0],c=o[s-1],f=[];if(s>n)return Upt(t,f,o,s/n),f;const g=Npt(o,t,n);if(s>0){let v,y;const w=s>1?Math.round((c-a)/(s-1)):null;for(iA(t,f,g,On(w)?0:a-w,a),v=0,y=s-1;v<y;v++)iA(t,f,g,o[v],o[v+1]);return iA(t,f,g,c,On(w)?t.length:c+w),f}return iA(t,f,g),f}function Fpt(i){const t=i.options.offset,e=i._tickSize(),r=i._length/e+(t?0:1),n=i._maxLength/e;return Math.floor(Math.min(r,n))}function Npt(i,t,e){const r=Gpt(i),n=t.length/e;if(!r)return Math.max(n,1);const o=Mdt(r);for(let s=0,a=o.length-1;s<a;s++){const c=o[s];if(c>n)return c}return Math.max(n,1)}function Vpt(i){const t=[];let e,r;for(e=0,r=i.length;e<r;e++)i[e].major&&t.push(e);return t}function Upt(i,t,e,r){let n=0,o=e[0],s;for(r=Math.ceil(r),s=0;s<i.length;s++)s===o&&(t.push(i[s]),n++,o=e[n*r])}function iA(i,t,e,r,n){const o=cn(r,0),s=Math.min(cn(n,i.length),i.length);let a=0,c,f,g;for(e=Math.ceil(e),n&&(c=n-r,e=c/Math.floor(c/e)),g=o;g<0;)a++,g=Math.round(o+a*e);for(f=Math.max(o,0);f<s;f++)f===g&&(t.push(i[f]),a++,g=Math.round(o+a*e))}function Gpt(i){const t=i.length;let e,r;if(t<2)return!1;for(r=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==r)return!1;return r}const Hpt=i=>i==="left"?"right":i==="right"?"left":i,x6=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,b6=(i,t)=>Math.min(t||i,i);function w6(i,t){const e=[],r=i.length/t,n=i.length;let o=0;for(;o<n;o+=r)e.push(i[Math.floor(o)]);return e}function jpt(i,t,e){const r=i.ticks.length,n=Math.min(t,r-1),o=i._startPixel,s=i._endPixel,a=1e-6;let c=i.getPixelForTick(n),f;if(!(e&&(r===1?f=Math.max(c-o,s-c):t===0?f=(i.getPixelForTick(1)-c)/2:f=(c-i.getPixelForTick(n-1))/2,c+=n<t?f:-f,c<o-a||c>s+a)))return c}function Wpt(i,t){_a(i,e=>{const r=e.gc,n=r.length/2;let o;if(n>t){for(o=0;o<n;++o)delete e.data[r[o]];r.splice(0,n)}})}function cb(i){return i.drawTicks?i.tickLength:0}function S6(i,t){if(!i.display)return 0;const e=Zo(i.font,t),r=Fs(i.padding);return(Na(i.text)?i.text.length:1)*e.lineHeight+r.height}function $pt(i,t){return Hp(i,{scale:t,type:"scale"})}function Zpt(i,t,e){return Hp(i,{tick:e,index:t,type:"tick"})}function qpt(i,t,e){let r=sF(i);return(e&&t!=="right"||!e&&t==="right")&&(r=Hpt(r)),r}function Xpt(i,t,e,r){const{top:n,left:o,bottom:s,right:a,chart:c}=i,{chartArea:f,scales:g}=c;let v=0,y,w,I;const E=s-n,D=a-o;if(i.isHorizontal()){if(w=Es(r,o,a),Nn(e)){const R=Object.keys(e)[0],z=e[R];I=g[R].getPixelForValue(z)+E-t}else e==="center"?I=(f.bottom+f.top)/2+E-t:I=x6(i,e,t);y=a-o}else{if(Nn(e)){const R=Object.keys(e)[0],z=e[R];w=g[R].getPixelForValue(z)-D+t}else e==="center"?w=(f.left+f.right)/2-D+t:w=x6(i,e,t);I=Es(r,s,n),v=e==="left"?-yo:yo}return{titleX:w,titleY:I,maxWidth:y,rotation:v}}let BS=class KX extends Hd{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:r,_suggestedMax:n}=this;return t=$l(t,Number.POSITIVE_INFINITY),e=$l(e,Number.NEGATIVE_INFINITY),r=$l(r,Number.POSITIVE_INFINITY),n=$l(n,Number.NEGATIVE_INFINITY),{min:$l(t,r),max:$l(e,n),minDefined:uo(t),maxDefined:uo(e)}}getMinMax(t){let{min:e,max:r,minDefined:n,maxDefined:o}=this.getUserBounds(),s;if(n&&o)return{min:e,max:r};const a=this.getMatchingVisibleMetas();for(let c=0,f=a.length;c<f;++c)s=a[c].controller.getMinMax(this,t),n||(e=Math.min(e,s.min)),o||(r=Math.max(r,s.max));return e=o&&e>r?r:e,r=n&&e>r?e:r,{min:$l(e,$l(r,e)),max:$l(r,$l(e,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ka(this.options.beforeUpdate,[this])}update(t,e,r){const{beginAtZero:n,grace:o,ticks:s}=this.options,a=s.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=rft(this,o,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=a<this.ticks.length;this._convertTicksToLabels(c?w6(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),s.display&&(s.autoSkip||s.source==="auto")&&(this.ticks=Bpt(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,r;this.isHorizontal()?(e=this.left,r=this.right):(e=this.top,r=this.bottom,t=!t),this._startPixel=e,this._endPixel=r,this._reversePixels=t,this._length=r-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ka(this.options.afterUpdate,[this])}beforeSetDimensions(){ka(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ka(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),ka(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ka(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let r,n,o;for(r=0,n=t.length;r<n;r++)o=t[r],o.label=ka(e.callback,[o.value,r,t],this)}afterTickToLabelConversion(){ka(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ka(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,r=b6(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,o=e.maxRotation;let s=n,a,c,f;if(!this._isVisible()||!e.display||n>=o||r<=1||!this.isHorizontal()){this.labelRotation=n;return}const g=this._getLabelSizes(),v=g.widest.width,y=g.highest.height,w=ns(this.chart.width-v,0,this.maxWidth);a=t.offset?this.maxWidth/r:w/(r-1),v+6>a&&(a=w/(r-(t.offset?.5:1)),c=this.maxHeight-cb(t.grid)-e.padding-S6(t.title,this.chart.options.font),f=Math.sqrt(v*v+y*y),s=aF(Math.min(Math.asin(ns((g.highest.height+6)/a,-1,1)),Math.asin(ns(c/f,-1,1))-Math.asin(ns(y/f,-1,1)))),s=Math.max(n,Math.min(o,s))),this.labelRotation=s}afterCalculateLabelRotation(){ka(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ka(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:r,title:n,grid:o}}=this,s=this._isVisible(),a=this.isHorizontal();if(s){const c=S6(n,e.options.font);if(a?(t.width=this.maxWidth,t.height=cb(o)+c):(t.height=this.maxHeight,t.width=cb(o)+c),r.display&&this.ticks.length){const{first:f,last:g,widest:v,highest:y}=this._getLabelSizes(),w=r.padding*2,I=lc(this.labelRotation),E=Math.cos(I),D=Math.sin(I);if(a){const R=r.mirror?0:D*v.width+E*y.height;t.height=Math.min(this.maxHeight,t.height+R+w)}else{const R=r.mirror?0:E*v.width+D*y.height;t.width=Math.min(this.maxWidth,t.width+R+w)}this._calculatePadding(f,g,D,E)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,r,n){const{ticks:{align:o,padding:s},position:a}=this.options,c=this.labelRotation!==0,f=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const g=this.getPixelForTick(0)-this.left,v=this.right-this.getPixelForTick(this.ticks.length-1);let y=0,w=0;c?f?(y=n*t.width,w=r*e.height):(y=r*t.height,w=n*e.width):o==="start"?w=e.width:o==="end"?y=t.width:o!=="inner"&&(y=t.width/2,w=e.width/2),this.paddingLeft=Math.max((y-g+s)*this.width/(this.width-g),0),this.paddingRight=Math.max((w-v+s)*this.width/(this.width-v),0)}else{let g=e.height/2,v=t.height/2;o==="start"?(g=0,v=t.height):o==="end"&&(g=e.height,v=0),this.paddingTop=g+s,this.paddingBottom=v+s}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ka(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,r;for(e=0,r=t.length;e<r;e++)On(t[e].label)&&(t.splice(e,1),r--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let r=this.ticks;e<r.length&&(r=w6(r,e)),this._labelSizes=t=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,r){const{ctx:n,_longestTextCache:o}=this,s=[],a=[],c=Math.floor(e/b6(e,r));let f=0,g=0,v,y,w,I,E,D,R,z,N,H,q;for(v=0;v<e;v+=c){if(I=t[v].label,E=this._resolveTickFontOptions(v),n.font=D=E.string,R=o[D]=o[D]||{data:{},gc:[]},z=E.lineHeight,N=H=0,!On(I)&&!Na(I))N=xC(n,R.data,R.gc,N,I),H=z;else if(Na(I))for(y=0,w=I.length;y<w;++y)q=I[y],!On(q)&&!Na(q)&&(N=xC(n,R.data,R.gc,N,q),H+=z);s.push(N),a.push(H),f=Math.max(N,f),g=Math.max(H,g)}Wpt(o,e);const Y=s.indexOf(f),J=a.indexOf(g),it=at=>({width:s[at]||0,height:a[at]||0});return{first:it(0),last:it(e-1),widest:it(Y),highest:it(J),widths:s,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Ldt(this._alignToPixels?Qg(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const r=e[t];return r.$context||(r.$context=Zpt(this.getContext(),t,r))}return this.$context||(this.$context=$pt(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=lc(this.labelRotation),r=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),o=this._getLabelSizes(),s=t.autoSkipPadding||0,a=o?o.widest.width+s:0,c=o?o.highest.height+s:0;return this.isHorizontal()?c*r>a*n?a/r:c/n:c*n<a*r?c/r:a/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,r=this.chart,n=this.options,{grid:o,position:s,border:a}=n,c=o.offset,f=this.isHorizontal(),v=this.ticks.length+(c?1:0),y=cb(o),w=[],I=a.setContext(this.getContext()),E=I.display?I.width:0,D=E/2,R=function(bt){return Qg(r,bt,E)};let z,N,H,q,Y,J,it,at,ut,ft,_t,ct;if(s==="top")z=R(this.bottom),J=this.bottom-y,at=z-D,ft=R(t.top)+D,ct=t.bottom;else if(s==="bottom")z=R(this.top),ft=t.top,ct=R(t.bottom)-D,J=z+D,at=this.top+y;else if(s==="left")z=R(this.right),Y=this.right-y,it=z-D,ut=R(t.left)+D,_t=t.right;else if(s==="right")z=R(this.left),ut=t.left,_t=R(t.right)-D,Y=z+D,it=this.left+y;else if(e==="x"){if(s==="center")z=R((t.top+t.bottom)/2+.5);else if(Nn(s)){const bt=Object.keys(s)[0],Vt=s[bt];z=R(this.chart.scales[bt].getPixelForValue(Vt))}ft=t.top,ct=t.bottom,J=z+D,at=J+y}else if(e==="y"){if(s==="center")z=R((t.left+t.right)/2);else if(Nn(s)){const bt=Object.keys(s)[0],Vt=s[bt];z=R(this.chart.scales[bt].getPixelForValue(Vt))}Y=z-D,it=Y-y,ut=t.left,_t=t.right}const Dt=cn(n.ticks.maxTicksLimit,v),Et=Math.max(1,Math.ceil(v/Dt));for(N=0;N<v;N+=Et){const bt=this.getContext(N),Vt=o.setContext(bt),zt=a.setContext(bt),Jt=Vt.lineWidth,ce=Vt.color,be=zt.dash||[],ve=zt.dashOffset,ke=Vt.tickWidth,ni=Vt.tickColor,bi=Vt.tickBorderDash||[],or=Vt.tickBorderDashOffset;H=jpt(this,N,c),H!==void 0&&(q=Qg(r,H,Jt),f?Y=it=ut=_t=q:J=at=ft=ct=q,w.push({tx1:Y,ty1:J,tx2:it,ty2:at,x1:ut,y1:ft,x2:_t,y2:ct,width:Jt,color:ce,borderDash:be,borderDashOffset:ve,tickWidth:ke,tickColor:ni,tickBorderDash:bi,tickBorderDashOffset:or}))}return this._ticksLength=v,this._borderValue=z,w}_computeLabelItems(t){const e=this.axis,r=this.options,{position:n,ticks:o}=r,s=this.isHorizontal(),a=this.ticks,{align:c,crossAlign:f,padding:g,mirror:v}=o,y=cb(r.grid),w=y+g,I=v?-g:w,E=-lc(this.labelRotation),D=[];let R,z,N,H,q,Y,J,it,at,ut,ft,_t,ct="middle";if(n==="top")Y=this.bottom-I,J=this._getXAxisLabelAlignment();else if(n==="bottom")Y=this.top+I,J=this._getXAxisLabelAlignment();else if(n==="left"){const Et=this._getYAxisLabelAlignment(y);J=Et.textAlign,q=Et.x}else if(n==="right"){const Et=this._getYAxisLabelAlignment(y);J=Et.textAlign,q=Et.x}else if(e==="x"){if(n==="center")Y=(t.top+t.bottom)/2+w;else if(Nn(n)){const Et=Object.keys(n)[0],bt=n[Et];Y=this.chart.scales[Et].getPixelForValue(bt)+w}J=this._getXAxisLabelAlignment()}else if(e==="y"){if(n==="center")q=(t.left+t.right)/2-w;else if(Nn(n)){const Et=Object.keys(n)[0],bt=n[Et];q=this.chart.scales[Et].getPixelForValue(bt)}J=this._getYAxisLabelAlignment(y).textAlign}e==="y"&&(c==="start"?ct="top":c==="end"&&(ct="bottom"));const Dt=this._getLabelSizes();for(R=0,z=a.length;R<z;++R){N=a[R],H=N.label;const Et=o.setContext(this.getContext(R));it=this.getPixelForTick(R)+o.labelOffset,at=this._resolveTickFontOptions(R),ut=at.lineHeight,ft=Na(H)?H.length:1;const bt=ft/2,Vt=Et.color,zt=Et.textStrokeColor,Jt=Et.textStrokeWidth;let ce=J;s?(q=it,J==="inner"&&(R===z-1?ce=this.options.reverse?"left":"right":R===0?ce=this.options.reverse?"right":"left":ce="center"),n==="top"?f==="near"||E!==0?_t=-ft*ut+ut/2:f==="center"?_t=-Dt.highest.height/2-bt*ut+ut:_t=-Dt.highest.height+ut/2:f==="near"||E!==0?_t=ut/2:f==="center"?_t=Dt.highest.height/2-bt*ut:_t=Dt.highest.height-ft*ut,v&&(_t*=-1),E!==0&&!Et.showLabelBackdrop&&(q+=ut/2*Math.sin(E))):(Y=it,_t=(1-ft)*ut/2);let be;if(Et.showLabelBackdrop){const ve=Fs(Et.backdropPadding),ke=Dt.heights[R],ni=Dt.widths[R];let bi=_t-ve.top,or=0-ve.left;switch(ct){case"middle":bi-=ke/2;break;case"bottom":bi-=ke;break}switch(J){case"center":or-=ni/2;break;case"right":or-=ni;break;case"inner":R===z-1?or-=ni:R>0&&(or-=ni/2);break}be={left:or,top:bi,width:ni+ve.width,height:ke+ve.height,color:Et.backdropColor}}D.push({label:H,font:at,textOffset:_t,options:{rotation:E,color:Vt,strokeColor:zt,strokeWidth:Jt,textAlign:ce,textBaseline:ct,translation:[q,Y],backdrop:be}})}return D}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-lc(this.labelRotation))return t==="top"?"left":"right";let n="center";return e.align==="start"?n="left":e.align==="end"?n="right":e.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:r,mirror:n,padding:o}}=this.options,s=this._getLabelSizes(),a=t+o,c=s.widest.width;let f,g;return e==="left"?n?(g=this.right+o,r==="near"?f="left":r==="center"?(f="center",g+=c/2):(f="right",g+=c)):(g=this.right-a,r==="near"?f="right":r==="center"?(f="center",g-=c/2):(f="left",g=this.left)):e==="right"?n?(g=this.left+o,r==="near"?f="right":r==="center"?(f="center",g-=c/2):(f="left",g-=c)):(g=this.left+a,r==="near"?f="left":r==="center"?(f="center",g+=c/2):(f="right",g=this.right)):f="right",{textAlign:f,x:g}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:r,top:n,width:o,height:s}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(r,n,o,s),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(o=>o.value===t);return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,r=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,s;const a=(c,f,g)=>{!g.width||!g.color||(r.save(),r.lineWidth=g.width,r.strokeStyle=g.color,r.setLineDash(g.borderDash||[]),r.lineDashOffset=g.borderDashOffset,r.beginPath(),r.moveTo(c.x,c.y),r.lineTo(f.x,f.y),r.stroke(),r.restore())};if(e.display)for(o=0,s=n.length;o<s;++o){const c=n[o];e.drawOnChartArea&&a({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),e.drawTicks&&a({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:r,grid:n}}=this,o=r.setContext(this.getContext()),s=r.display?o.width:0;if(!s)return;const a=n.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let f,g,v,y;this.isHorizontal()?(f=Qg(t,this.left,s)-s/2,g=Qg(t,this.right,a)+a/2,v=y=c):(v=Qg(t,this.top,s)-s/2,y=Qg(t,this.bottom,a)+a/2,f=g=c),e.save(),e.lineWidth=o.width,e.strokeStyle=o.color,e.beginPath(),e.moveTo(f,v),e.lineTo(g,y),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const r=this.ctx,n=this._computeLabelArea();n&&WM(r,n);const o=this.getLabelItems(t);for(const s of o){const a=s.options,c=s.font,f=s.label,g=s.textOffset;gv(r,f,0,g,c,a)}n&&$M(r)}drawTitle(){const{ctx:t,options:{position:e,title:r,reverse:n}}=this;if(!r.display)return;const o=Zo(r.font),s=Fs(r.padding),a=r.align;let c=o.lineHeight/2;e==="bottom"||e==="center"||Nn(e)?(c+=s.bottom,Na(r.text)&&(c+=o.lineHeight*(r.text.length-1))):c+=s.top;const{titleX:f,titleY:g,maxWidth:v,rotation:y}=Xpt(this,c,e,a);gv(t,r.text,0,0,o,{color:r.color,maxWidth:v,rotation:y,textAlign:qpt(a,e,n),textBaseline:"middle",translation:[f,g]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,r=cn(t.grid&&t.grid.z,-1),n=cn(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==KX.prototype.draw?[{z:e,draw:o=>{this.draw(o)}}]:[{z:r,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",n=[];let o,s;for(o=0,s=e.length;o<s;++o){const a=e[o];a[r]===this.id&&(!t||a.type===t)&&n.push(a)}return n}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Zo(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}};class rA{constructor(t,e,r){this.type=t,this.scope=e,this.override=r,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let r;Jpt(e)&&(r=this.register(e));const n=this.items,o=t.id,s=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in n||(n[o]=t,Ypt(t,s,r),this.override&&$a.override(t.id,t.overrides)),s}get(t){return this.items[t]}unregister(t){const e=this.items,r=t.id,n=this.scope;r in e&&delete e[r],n&&r in $a[n]&&(delete $a[n][r],this.override&&delete pv[r])}}function Ypt(i,t,e){const r=Ww(Object.create(null),[e?$a.get(e):{},$a.get(t),i.defaults]);$a.set(t,r),i.defaultRoutes&&Kpt(t,i.defaultRoutes),i.descriptors&&$a.describe(t,i.descriptors)}function Kpt(i,t){Object.keys(t).forEach(e=>{const r=e.split("."),n=r.pop(),o=[i].concat(r).join("."),s=t[e].split("."),a=s.pop(),c=s.join(".");$a.route(o,n,c,a)})}function Jpt(i){return"id"in i&&"defaults"in i}class Qpt{constructor(){this.controllers=new rA(dc,"datasets",!0),this.elements=new rA(Hd,"elements"),this.plugins=new rA(Object,"plugins"),this.scales=new rA(BS,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,r){[...e].forEach(n=>{const o=r||this._getRegistryForType(n);r||o.isForType(n)||o===this.plugins&&n.id?this._exec(t,o,n):_a(n,s=>{const a=r||this._getRegistryForType(s);this._exec(t,a,s)})})}_exec(t,e,r){const n=nF(t);ka(r["before"+n],[],r),e[t](r),ka(r["after"+n],[],r)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const r=this._typedRegistries[e];if(r.isForType(t))return r}return this.plugins}_get(t,e,r){const n=e.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+r+".");return n}}var eh=new Qpt;class tgt{constructor(){this._init=void 0}notify(t,e,r,n){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=n?this._descriptors(t).filter(n):this._descriptors(t),s=this._notify(o,t,e,r);return e==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),s}_notify(t,e,r,n){n=n||{};for(const o of t){const s=o.plugin,a=s[r],c=[e,n,o.options];if(ka(a,c,s)===!1&&n.cancelable)return!1}return!0}invalidate(){On(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const r=t&&t.config,n=cn(r.options&&r.options.plugins,{}),o=egt(r);return n===!1&&!e?[]:rgt(t,o,n,e)}_notifyStateChanges(t){const e=this._oldCache||[],r=this._cache,n=(o,s)=>o.filter(a=>!s.some(c=>a.plugin.id===c.plugin.id));this._notify(n(e,r),t,"stop"),this._notify(n(r,e),t,"start")}}function egt(i){const t={},e=[],r=Object.keys(eh.plugins.items);for(let o=0;o<r.length;o++)e.push(eh.getPlugin(r[o]));const n=i.plugins||[];for(let o=0;o<n.length;o++){const s=n[o];e.indexOf(s)===-1&&(e.push(s),t[s.id]=!0)}return{plugins:e,localIds:t}}function igt(i,t){return!t&&i===!1?null:i===!0?{}:i}function rgt(i,{plugins:t,localIds:e},r,n){const o=[],s=i.getContext();for(const a of t){const c=a.id,f=igt(r[c],n);f!==null&&o.push({plugin:a,options:ngt(i.config,{plugin:a,local:e[c]},f,s)})}return o}function ngt(i,{plugin:t,local:e},r,n){const o=i.pluginScopeKeys(t),s=i.getOptionScopes(r,o);return e&&t.defaults&&s.push(t.defaults),i.createResolver(s,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function cO(i,t){const e=$a.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function agt(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function ogt(i,t){return i===t?"_index_":"_value_"}function T6(i){if(i==="x"||i==="y"||i==="r")return i}function sgt(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function hO(i,...t){if(T6(i))return i;for(const e of t){const r=e.axis||sgt(e.position)||i.length>1&&T6(i[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function A6(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function lgt(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(r=>r.xAxisID===i||r.yAxisID===i);if(e.length)return A6(i,"x",e[0])||A6(i,"y",e[0])}return{}}function ugt(i,t){const e=pv[i.type]||{scales:{}},r=t.scales||{},n=cO(i.type,t),o=Object.create(null);return Object.keys(r).forEach(s=>{const a=r[s];if(!Nn(a))return console.error(`Invalid scale configuration for scale: ${s}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${s}`);const c=hO(s,a,lgt(s,i),$a.scales[a.type]),f=ogt(c,n),g=e.scales||{};o[s]=_w(Object.create(null),[{axis:c},a,g[c],g[f]])}),i.data.datasets.forEach(s=>{const a=s.type||i.type,c=s.indexAxis||cO(a,t),g=(pv[a]||{}).scales||{};Object.keys(g).forEach(v=>{const y=agt(v,c),w=s[y+"AxisID"]||y;o[w]=o[w]||Object.create(null),_w(o[w],[{axis:y},r[w],g[v]])})}),Object.keys(o).forEach(s=>{const a=o[s];_w(a,[$a.scales[a.type],$a.scale])}),o}function JX(i){const t=i.options||(i.options={});t.plugins=cn(t.plugins,{}),t.scales=ugt(i,t)}function QX(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function cgt(i){return i=i||{},i.data=QX(i.data),JX(i),i}const I6=new Map,tY=new Set;function nA(i,t){let e=I6.get(i);return e||(e=t(),I6.set(i,e),tY.add(e)),e}const hb=(i,t,e)=>{const r=Lp(t,e);r!==void 0&&i.add(r)};class hgt{constructor(t){this._config=cgt(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=QX(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),JX(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return nA(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return nA(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return nA(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,r=this.type;return nA(`${r}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const r=this._scopeCache;let n=r.get(t);return(!n||e)&&(n=new Map,r.set(t,n)),n}getOptionScopes(t,e,r){const{options:n,type:o}=this,s=this._cachedScopes(t,r),a=s.get(e);if(a)return a;const c=new Set;e.forEach(g=>{t&&(c.add(t),g.forEach(v=>hb(c,t,v))),g.forEach(v=>hb(c,n,v)),g.forEach(v=>hb(c,pv[o]||{},v)),g.forEach(v=>hb(c,$a,v)),g.forEach(v=>hb(c,sO,v))});const f=Array.from(c);return f.length===0&&f.push(Object.create(null)),tY.has(e)&&s.set(e,f),f}chartOptionScopes(){const{options:t,type:e}=this;return[t,pv[e]||{},$a.datasets[e]||{},{type:e},$a,sO]}resolveNamedOptions(t,e,r,n=[""]){const o={$shared:!0},{resolver:s,subPrefixes:a}=C6(this._resolverCache,t,n);let c=s;if(fgt(s,e)){o.$shared=!1,r=Rp(r)?r():r;const f=this.createResolver(t,r,a);c=_0(s,r,f)}for(const f of e)o[f]=c[f];return o}createResolver(t,e,r=[""],n){const{resolver:o}=C6(this._resolverCache,t,r);return Nn(e)?_0(o,e,void 0,n):o}}function C6(i,t,e){let r=i.get(t);r||(r=new Map,i.set(t,r));const n=e.join();let o=r.get(n);return o||(o={resolver:cF(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},r.set(n,o)),o}const dgt=i=>Nn(i)&&Object.getOwnPropertyNames(i).some(t=>Rp(i[t]));function fgt(i,t){const{isScriptable:e,isIndexable:r}=PX(i);for(const n of t){const o=e(n),s=r(n),a=(s||o)&&i[n];if(o&&(Rp(a)||dgt(a))||s&&Na(a))return!0}return!1}var pgt="4.5.1";const ggt=["top","bottom","left","right","chartArea"];function M6(i,t){return i==="top"||i==="bottom"||ggt.indexOf(i)===-1&&t==="x"}function E6(i,t){return function(e,r){return e[i]===r[i]?e[t]-r[t]:e[i]-r[i]}}function D6(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),ka(e&&e.onComplete,[i],t)}function mgt(i){const t=i.chart,e=t.options.animation;ka(e&&e.onProgress,[i],t)}function eY(i){return fF()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const BI={},P6=i=>{const t=eY(i);return Object.values(BI).filter(e=>e.canvas===t).pop()};function vgt(i,t,e){const r=Object.keys(i);for(const n of r){const o=+n;if(o>=t){const s=i[n];delete i[n],(e>0||o>t)&&(i[o+e]=s)}}}function _gt(i,t,e,r){return!e||i.type==="mouseout"?null:r?t:i}class dd{static register(...t){eh.add(...t),L6()}static unregister(...t){eh.remove(...t),L6()}constructor(t,e){const r=this.config=new hgt(e),n=eY(t),o=P6(n);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const s=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||zpt(n)),this.platform.updateConfig(r);const a=this.platform.acquireContext(n,s.aspectRatio),c=a&&a.canvas,f=c&&c.height,g=c&&c.width;if(this.id=ydt(),this.ctx=a,this.canvas=c,this.width=g,this.height=f,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new tgt,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=zdt(v=>this.update(v),s.resizeDelay||0),this._dataChanges=[],BI[this.id]=this,!a||!c){console.error("Failed to create chart: can't acquire context from the given item");return}od.listen(this,"complete",D6),od.listen(this,"progress",mgt),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:r,height:n,_aspectRatio:o}=this;return On(t)?e&&o?o:n?r/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return eh}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():t6(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return KG(this.canvas,this.ctx),this}stop(){return od.stop(this),this}resize(t,e){od.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const r=this.options,n=this.canvas,o=r.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(n,t,e,o),a=r.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,t6(this,a,!0)&&(this.notifyPlugins("resize",{size:s}),ka(r.onResize,[this,s],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};_a(e,(r,n)=>{r.id=n})}buildOrUpdateScales(){const t=this.options,e=t.scales,r=this.scales,n=Object.keys(r).reduce((s,a)=>(s[a]=!1,s),{});let o=[];e&&(o=o.concat(Object.keys(e).map(s=>{const a=e[s],c=hO(s,a),f=c==="r",g=c==="x";return{options:a,dposition:f?"chartArea":g?"bottom":"left",dtype:f?"radialLinear":g?"category":"linear"}}))),_a(o,s=>{const a=s.options,c=a.id,f=hO(c,a),g=cn(a.type,s.dtype);(a.position===void 0||M6(a.position,f)!==M6(s.dposition))&&(a.position=s.dposition),n[c]=!0;let v=null;if(c in r&&r[c].type===g)v=r[c];else{const y=eh.getScale(g);v=new y({id:c,type:g,ctx:this.ctx,chart:this}),r[v.id]=v}v.init(a,t)}),_a(n,(s,a)=>{s||delete r[a]}),_a(r,s=>{Os.configure(this,s,s.options),Os.addBox(this,s)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,r=t.length;if(t.sort((n,o)=>n.index-o.index),r>e){for(let n=e;n<r;++n)this._destroyDatasetMeta(n);t.splice(e,r-e)}this._sortedMetasets=t.slice(0).sort(E6("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((r,n)=>{e.filter(o=>o===r._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let r,n;for(this._removeUnreferencedMetasets(),r=0,n=e.length;r<n;r++){const o=e[r];let s=this.getDatasetMeta(r);const a=o.type||this.config.type;if(s.type&&s.type!==a&&(this._destroyDatasetMeta(r),s=this.getDatasetMeta(r)),s.type=a,s.indexAxis=o.indexAxis||cO(a,this.options),s.order=o.order||0,s.index=r,s.label=""+o.label,s.visible=this.isDatasetVisible(r),s.controller)s.controller.updateIndex(r),s.controller.linkScales();else{const c=eh.getController(a),{datasetElementType:f,dataElementType:g}=$a.datasets[a];Object.assign(c,{dataElementType:eh.getElement(g),datasetElementType:f&&eh.getElement(f)}),s.controller=new c(this,r),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){_a(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const r=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let f=0,g=this.data.datasets.length;f<g;f++){const{controller:v}=this.getDatasetMeta(f),y=!n&&o.indexOf(v)===-1;v.buildOrUpdateElements(y),s=Math.max(+v.getMaxOverflow(),s)}s=this._minPadding=r.layout.autoPadding?s:0,this._updateLayout(s),n||_a(o,f=>{f.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(E6("z","_idx"));const{_active:a,_lastEvent:c}=this;c?this._eventHandler(c,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){_a(this.scales,t=>{Os.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),r=new Set(t.events);(!GG(e,r)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:r,start:n,count:o}of e){const s=r==="_removeElements"?-o:o;vgt(t,n,s)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,r=o=>new Set(t.filter(s=>s[0]===o).map((s,a)=>a+","+s.splice(1).join(","))),n=r(0);for(let o=1;o<e;o++)if(!GG(n,r(o)))return;return Array.from(n).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Os.update(this,this.width,this.height,t);const e=this.chartArea,r=e.width<=0||e.height<=0;this._layers=[],_a(this.boxes,n=>{r&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,o)=>{n._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,r=this.data.datasets.length;e<r;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,r=this.data.datasets.length;e<r;++e)this._updateDataset(e,Rp(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const r=this.getDatasetMeta(t),n={meta:r,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(r.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(od.has(this)?this.attached&&!od.running(this)&&od.start(this):(this.draw(),D6({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:r,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,r=[];let n,o;for(n=0,o=e.length;n<o;++n){const s=e[n];(!t||s.visible)&&r.push(s)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,r={meta:t,index:t.index,cancelable:!0},n=GX(this,t);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(n&&WM(e,n),t.controller.draw(),n&&$M(e),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(t){return yd(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,r,n){const o=gpt.modes[e];return typeof o=="function"?o(this,t,r,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],r=this._metasets;let n=r.filter(o=>o&&o._dataset===e).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},r.push(n)),n}getContext(){return this.$context||(this.$context=Hp(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const r=this.getDatasetMeta(t);return typeof r.hidden=="boolean"?!r.hidden:!e.hidden}setDatasetVisibility(t,e){const r=this.getDatasetMeta(t);r.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,r){const n=r?"show":"hide",o=this.getDatasetMeta(t),s=o.controller._resolveAnimations(void 0,n);$w(e)?(o.data[e].hidden=!r,this.update()):(this.setDatasetVisibility(t,r),s.update(o,{visible:r}),this.update(a=>a.datasetIndex===t?n:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),od.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),KG(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete BI[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,r=(o,s)=>{e.addEventListener(this,o,s),t[o]=s},n=(o,s,a)=>{o.offsetX=s,o.offsetY=a,this._eventHandler(o)};_a(this.options.events,o=>r(o,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,r=(c,f)=>{e.addEventListener(this,c,f),t[c]=f},n=(c,f)=>{t[c]&&(e.removeEventListener(this,c,f),delete t[c])},o=(c,f)=>{this.canvas&&this.resize(c,f)};let s;const a=()=>{n("attach",a),this.attached=!0,this.resize(),r("resize",o),r("detach",s)};s=()=>{this.attached=!1,n("resize",o),this._stop(),this._resize(0,0),r("attach",a)},e.isAttached(this.canvas)?a():s()}unbindEvents(){_a(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},_a(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,r){const n=r?"set":"remove";let o,s,a,c;for(e==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+n+"DatasetHoverStyle"]()),a=0,c=t.length;a<c;++a){s=t[a];const f=s&&this.getDatasetMeta(s.datasetIndex).controller;f&&f[n+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],r=t.map(({datasetIndex:o,index:s})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[s],index:s}});!vC(r,e)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,e))}notifyPlugins(t,e,r){return this._plugins.notify(this,t,e,r)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,r){const n=this.options.hover,o=(c,f)=>c.filter(g=>!f.some(v=>g.datasetIndex===v.datasetIndex&&g.index===v.index)),s=o(e,t),a=r?t:o(t,e);s.length&&this.updateHoverStyle(s,n.mode,!1),a.length&&n.mode&&this.updateHoverStyle(a,n.mode,!0)}_eventHandler(t,e){const r={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=s=>(s.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",r,n)===!1)return;const o=this._handleEvent(t,e,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,n),(o||r.changed)&&this.render(),this}_handleEvent(t,e,r){const{_active:n=[],options:o}=this,s=e,a=this._getActiveElements(t,n,r,s),c=Adt(t),f=_gt(t,this._lastEvent,r,c);r&&(this._lastEvent=null,ka(o.onHover,[t,a,this],this),c&&ka(o.onClick,[t,a,this],this));const g=!vC(a,n);return(g||e)&&(this._active=a,this._updateHoverStyles(a,n,e)),this._lastEvent=f,g}_getActiveElements(t,e,r,n){if(t.type==="mouseout")return[];if(!r)return e;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,n)}}Wi(dd,"defaults",$a),Wi(dd,"instances",BI),Wi(dd,"overrides",pv),Wi(dd,"registry",eh),Wi(dd,"version",pgt),Wi(dd,"getChart",P6);function L6(){return _a(dd.instances,i=>i._plugins.invalidate())}function ygt(i,t,e){const{startAngle:r,x:n,y:o,outerRadius:s,innerRadius:a,options:c}=t,{borderWidth:f,borderJoinStyle:g}=c,v=Math.min(f/s,Ps(r-e));if(i.beginPath(),i.arc(n,o,s-f/2,r+v/2,e-v/2),a>0){const y=Math.min(f/a,Ps(r-e));i.arc(n,o,a+f/2,e-y/2,r+y/2,!0)}else{const y=Math.min(f/2,s*Ps(r-e));if(g==="round")i.arc(n,o,y,e-ea/2,r+ea/2,!0);else if(g==="bevel"){const w=2*y*y,I=-w*Math.cos(e+ea/2)+n,E=-w*Math.sin(e+ea/2)+o,D=w*Math.cos(r+ea/2)+n,R=w*Math.sin(r+ea/2)+o;i.lineTo(I,E),i.lineTo(D,R)}}i.closePath(),i.moveTo(0,0),i.rect(0,0,i.canvas.width,i.canvas.height),i.clip("evenodd")}function xgt(i,t,e){const{startAngle:r,pixelMargin:n,x:o,y:s,outerRadius:a,innerRadius:c}=t;let f=n/a;i.beginPath(),i.arc(o,s,a,r-f,e+f),c>n?(f=n/c,i.arc(o,s,c,e+f,r-f,!0)):i.arc(o,s,n,e+yo,r-yo),i.closePath(),i.clip()}function bgt(i){return uF(i,["outerStart","outerEnd","innerStart","innerEnd"])}function wgt(i,t,e,r){const n=bgt(i.options.borderRadius),o=(e-t)/2,s=Math.min(o,r*t/2),a=c=>{const f=(e-Math.min(o,c))*r/2;return ns(c,0,Math.min(o,f))};return{outerStart:a(n.outerStart),outerEnd:a(n.outerEnd),innerStart:ns(n.innerStart,0,s),innerEnd:ns(n.innerEnd,0,s)}}function my(i,t,e,r){return{x:e+i*Math.cos(t),y:r+i*Math.sin(t)}}function SC(i,t,e,r,n,o){const{x:s,y:a,startAngle:c,pixelMargin:f,innerRadius:g}=t,v=Math.max(t.outerRadius+r+e-f,0),y=g>0?g+r+e+f:0;let w=0;const I=n-c;if(r){const Et=g>0?g-r:0,bt=v>0?v-r:0,Vt=(Et+bt)/2,zt=Vt!==0?I*Vt/(Vt+r):I;w=(I-zt)/2}const E=Math.max(.001,I*v-e/ea)/v,D=(I-E)/2,R=c+D+w,z=n-D-w,{outerStart:N,outerEnd:H,innerStart:q,innerEnd:Y}=wgt(t,y,v,z-R),J=v-N,it=v-H,at=R+N/J,ut=z-H/it,ft=y+q,_t=y+Y,ct=R+q/ft,Dt=z-Y/_t;if(i.beginPath(),o){const Et=(at+ut)/2;if(i.arc(s,a,v,at,Et),i.arc(s,a,v,Et,ut),H>0){const Jt=my(it,ut,s,a);i.arc(Jt.x,Jt.y,H,ut,z+yo)}const bt=my(_t,z,s,a);if(i.lineTo(bt.x,bt.y),Y>0){const Jt=my(_t,Dt,s,a);i.arc(Jt.x,Jt.y,Y,z+yo,Dt+Math.PI)}const Vt=(z-Y/y+(R+q/y))/2;if(i.arc(s,a,y,z-Y/y,Vt,!0),i.arc(s,a,y,Vt,R+q/y,!0),q>0){const Jt=my(ft,ct,s,a);i.arc(Jt.x,Jt.y,q,ct+Math.PI,R-yo)}const zt=my(J,R,s,a);if(i.lineTo(zt.x,zt.y),N>0){const Jt=my(J,at,s,a);i.arc(Jt.x,Jt.y,N,R-yo,at)}}else{i.moveTo(s,a);const Et=Math.cos(at)*v+s,bt=Math.sin(at)*v+a;i.lineTo(Et,bt);const Vt=Math.cos(ut)*v+s,zt=Math.sin(ut)*v+a;i.lineTo(Vt,zt)}i.closePath()}function Sgt(i,t,e,r,n){const{fullCircles:o,startAngle:s,circumference:a}=t;let c=t.endAngle;if(o){SC(i,t,e,r,c,n);for(let f=0;f<o;++f)i.fill();isNaN(a)||(c=s+(a%Va||Va))}return SC(i,t,e,r,c,n),i.fill(),c}function Tgt(i,t,e,r,n){const{fullCircles:o,startAngle:s,circumference:a,options:c}=t,{borderWidth:f,borderJoinStyle:g,borderDash:v,borderDashOffset:y,borderRadius:w}=c,I=c.borderAlign==="inner";if(!f)return;i.setLineDash(v||[]),i.lineDashOffset=y,I?(i.lineWidth=f*2,i.lineJoin=g||"round"):(i.lineWidth=f,i.lineJoin=g||"bevel");let E=t.endAngle;if(o){SC(i,t,e,r,E,n);for(let D=0;D<o;++D)i.stroke();isNaN(a)||(E=s+(a%Va||Va))}I&&xgt(i,t,E),c.selfJoin&&E-s>=ea&&w===0&&g!=="miter"&&ygt(i,t,E),o||(SC(i,t,e,r,E,n),i.stroke())}class qb extends Hd{constructor(e){super();Wi(this,"circumference");Wi(this,"endAngle");Wi(this,"fullCircles");Wi(this,"innerRadius");Wi(this,"outerRadius");Wi(this,"pixelMargin");Wi(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,r,n){const o=this.getProps(["x","y"],n),{angle:s,distance:a}=bX(o,{x:e,y:r}),{startAngle:c,endAngle:f,innerRadius:g,outerRadius:v,circumference:y}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),w=(this.options.spacing+this.options.borderWidth)/2,I=cn(y,f-c),E=Zw(s,c,f)&&c!==f,D=I>=Va||E,R=vd(a,g+w,v+w);return D&&R}getCenterPoint(e){const{x:r,y:n,startAngle:o,endAngle:s,innerRadius:a,outerRadius:c}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:f,spacing:g}=this.options,v=(o+s)/2,y=(a+c+g+f)/2;return{x:r+Math.cos(v)*y,y:n+Math.sin(v)*y}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:r,circumference:n}=this,o=(r.offset||0)/4,s=(r.spacing||0)/2,a=r.circular;if(this.pixelMargin=r.borderAlign==="inner"?.33:0,this.fullCircles=n>Va?Math.floor(n/Va):0,n===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const c=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(c)*o,Math.sin(c)*o);const f=1-Math.sin(Math.min(ea,n||0)),g=o*f;e.fillStyle=r.backgroundColor,e.strokeStyle=r.borderColor,Sgt(e,this,g,s,a),Tgt(e,this,g,s,a),e.restore()}}Wi(qb,"id","arc"),Wi(qb,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),Wi(qb,"defaultRoutes",{backgroundColor:"backgroundColor"}),Wi(qb,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function iY(i,t,e=t){i.lineCap=cn(e.borderCapStyle,t.borderCapStyle),i.setLineDash(cn(e.borderDash,t.borderDash)),i.lineDashOffset=cn(e.borderDashOffset,t.borderDashOffset),i.lineJoin=cn(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=cn(e.borderWidth,t.borderWidth),i.strokeStyle=cn(e.borderColor,t.borderColor)}function Agt(i,t,e){i.lineTo(e.x,e.y)}function Igt(i){return i.stepped?qdt:i.tension||i.cubicInterpolationMode==="monotone"?Xdt:Agt}function rY(i,t,e={}){const r=i.length,{start:n=0,end:o=r-1}=e,{start:s,end:a}=t,c=Math.max(n,s),f=Math.min(o,a),g=n<s&&o<s||n>a&&o>a;return{count:r,start:c,loop:t.loop,ilen:f<c&&!g?r+f-c:f-c}}function Cgt(i,t,e,r){const{points:n,options:o}=t,{count:s,start:a,loop:c,ilen:f}=rY(n,e,r),g=Igt(o);let{move:v=!0,reverse:y}=r||{},w,I,E;for(w=0;w<=f;++w)I=n[(a+(y?f-w:w))%s],!I.skip&&(v?(i.moveTo(I.x,I.y),v=!1):g(i,E,I,y,o.stepped),E=I);return c&&(I=n[(a+(y?f:0))%s],g(i,E,I,y,o.stepped)),!!c}function Mgt(i,t,e,r){const n=t.points,{count:o,start:s,ilen:a}=rY(n,e,r),{move:c=!0,reverse:f}=r||{};let g=0,v=0,y,w,I,E,D,R;const z=H=>(s+(f?a-H:H))%o,N=()=>{E!==D&&(i.lineTo(g,D),i.lineTo(g,E),i.lineTo(g,R))};for(c&&(w=n[z(0)],i.moveTo(w.x,w.y)),y=0;y<=a;++y){if(w=n[z(y)],w.skip)continue;const H=w.x,q=w.y,Y=H|0;Y===I?(q<E?E=q:q>D&&(D=q),g=(v*g+H)/++v):(N(),i.lineTo(H,q),I=Y,v=0,E=D=q),R=q}N()}function dO(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Mgt:Cgt}function Egt(i){return i.stepped?Cft:i.tension||i.cubicInterpolationMode==="monotone"?Mft:Pm}function Dgt(i,t,e,r){let n=t._path;n||(n=t._path=new Path2D,t.path(n,e,r)&&n.closePath()),iY(i,t.options),i.stroke(n)}function Pgt(i,t,e,r){const{segments:n,options:o}=t,s=dO(t);for(const a of n)iY(i,o,a.style),i.beginPath(),s(i,t,a,{start:e,end:e+r-1})&&i.closePath(),i.stroke()}const Lgt=typeof Path2D=="function";function Rgt(i,t,e,r){Lgt&&!t.options.segment?Dgt(i,t,e,r):Pgt(i,t,e,r)}class cp extends Hd{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const n=r.spanGaps?this._loop:this._fullLoop;yft(this._points,r,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=kft(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,r=t.length;return r&&e[t[r-1].end]}interpolate(t,e){const r=this.options,n=t[e],o=this.points,s=UX(this,{property:e,start:n,end:n});if(!s.length)return;const a=[],c=Egt(r);let f,g;for(f=0,g=s.length;f<g;++f){const{start:v,end:y}=s[f],w=o[v],I=o[y];if(w===I){a.push(w);continue}const E=Math.abs((n-w[e])/(I[e]-w[e])),D=c(w,I,E,r.stepped);D[e]=t[e],a.push(D)}return a.length===1?a[0]:a}pathSegment(t,e,r){return dO(this)(t,this,e,r)}path(t,e,r){const n=this.segments,o=dO(this);let s=this._loop;e=e||0,r=r||this.points.length-e;for(const a of n)s&=o(t,this,a,{start:e,end:e+r-1});return!!s}draw(t,e,r,n){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),Rgt(t,this,r,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Wi(cp,"id","line"),Wi(cp,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Wi(cp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Wi(cp,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function R6(i,t,e,r){const n=i.options,{[e]:o}=i.getProps([e],r);return Math.abs(t-o)<n.radius+n.hitRadius}class FI extends Hd{constructor(e){super();Wi(this,"parsed");Wi(this,"skip");Wi(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,r,n){const o=this.options,{x:s,y:a}=this.getProps(["x","y"],n);return Math.pow(e-s,2)+Math.pow(r-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(e,r){return R6(this,e,"x",r)}inYRange(e,r){return R6(this,e,"y",r)}getCenterPoint(e){const{x:r,y:n}=this.getProps(["x","y"],e);return{x:r,y:n}}size(e){e=e||this.options||{};let r=e.radius||0;r=Math.max(r,r&&e.hoverRadius||0);const n=r&&e.borderWidth||0;return(r+n)*2}draw(e,r){const n=this.options;this.skip||n.radius<.1||!yd(this,r,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,lO(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}Wi(FI,"id","point"),Wi(FI,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Wi(FI,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function nY(i,t){const{x:e,y:r,base:n,width:o,height:s}=i.getProps(["x","y","base","width","height"],t);let a,c,f,g,v;return i.horizontal?(v=s/2,a=Math.min(e,n),c=Math.max(e,n),f=r-v,g=r+v):(v=o/2,a=e-v,c=e+v,f=Math.min(r,n),g=Math.max(r,n)),{left:a,top:f,right:c,bottom:g}}function hp(i,t,e,r){return i?0:ns(t,e,r)}function kgt(i,t,e){const r=i.options.borderWidth,n=i.borderSkipped,o=DX(r);return{t:hp(n.top,o.top,0,e),r:hp(n.right,o.right,0,t),b:hp(n.bottom,o.bottom,0,e),l:hp(n.left,o.left,0,t)}}function Ogt(i,t,e){const{enableBorderRadius:r}=i.getProps(["enableBorderRadius"]),n=i.options.borderRadius,o=iv(n),s=Math.min(t,e),a=i.borderSkipped,c=r||Nn(n);return{topLeft:hp(!c||a.top||a.left,o.topLeft,0,s),topRight:hp(!c||a.top||a.right,o.topRight,0,s),bottomLeft:hp(!c||a.bottom||a.left,o.bottomLeft,0,s),bottomRight:hp(!c||a.bottom||a.right,o.bottomRight,0,s)}}function zgt(i){const t=nY(i),e=t.right-t.left,r=t.bottom-t.top,n=kgt(i,e/2,r/2),o=Ogt(i,e/2,r/2);return{outer:{x:t.left,y:t.top,w:e,h:r,radius:o},inner:{x:t.left+n.l,y:t.top+n.t,w:e-n.l-n.r,h:r-n.t-n.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,o.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(n.b,n.r))}}}}function cL(i,t,e,r){const n=t===null,o=e===null,a=i&&!(n&&o)&&nY(i,r);return a&&(n||vd(t,a.left,a.right))&&(o||vd(e,a.top,a.bottom))}function Bgt(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function Fgt(i,t){i.rect(t.x,t.y,t.w,t.h)}function hL(i,t,e={}){const r=i.x!==e.x?-t:0,n=i.y!==e.y?-t:0,o=(i.x+i.w!==e.x+e.w?t:0)-r,s=(i.y+i.h!==e.y+e.h?t:0)-n;return{x:i.x+r,y:i.y+n,w:i.w+o,h:i.h+s,radius:i.radius}}class NI extends Hd{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:r,backgroundColor:n}}=this,{inner:o,outer:s}=zgt(this),a=Bgt(s.radius)?qw:Fgt;t.save(),(s.w!==o.w||s.h!==o.h)&&(t.beginPath(),a(t,hL(s,e,o)),t.clip(),a(t,hL(o,-e,s)),t.fillStyle=r,t.fill("evenodd")),t.beginPath(),a(t,hL(o,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,r){return cL(this,t,e,r)}inXRange(t,e){return cL(this,t,null,e)}inYRange(t,e){return cL(this,null,t,e)}getCenterPoint(t){const{x:e,y:r,base:n,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(e+n)/2:e,y:o?r:(r+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}Wi(NI,"id","bar"),Wi(NI,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Wi(NI,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Ngt=Object.freeze({__proto__:null,ArcElement:qb,BarElement:NI,LineElement:cp,PointElement:FI});const fO=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],k6=fO.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function aY(i){return fO[i%fO.length]}function oY(i){return k6[i%k6.length]}function Vgt(i,t){return i.borderColor=aY(t),i.backgroundColor=oY(t),++t}function Ugt(i,t){return i.backgroundColor=i.data.map(()=>aY(t++)),t}function Ggt(i,t){return i.backgroundColor=i.data.map(()=>oY(t++)),t}function Hgt(i){let t=0;return(e,r)=>{const n=i.getDatasetMeta(r).controller;n instanceof Hm?t=Ugt(e,t):n instanceof ww?t=Ggt(e,t):n&&(t=Vgt(e,t))}}function O6(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function jgt(i){return i&&(i.borderColor||i.backgroundColor)}function Wgt(){return $a.borderColor!=="rgba(0,0,0,0.1)"||$a.backgroundColor!=="rgba(0,0,0,0.1)"}var $gt={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:r},options:n}=i.config,{elements:o}=n,s=O6(r)||jgt(n)||o&&O6(o)||Wgt();if(!e.forceOverride&&s)return;const a=Hgt(i);r.forEach(a)}};function Zgt(i,t,e,r,n){const o=n.samples||r;if(o>=e)return i.slice(t,t+e);const s=[],a=(e-2)/(o-2);let c=0;const f=t+e-1;let g=t,v,y,w,I,E;for(s[c++]=i[g],v=0;v<o-2;v++){let D=0,R=0,z;const N=Math.floor((v+1)*a)+1+t,H=Math.min(Math.floor((v+2)*a)+1,e)+t,q=H-N;for(z=N;z<H;z++)D+=i[z].x,R+=i[z].y;D/=q,R/=q;const Y=Math.floor(v*a)+1+t,J=Math.min(Math.floor((v+1)*a)+1,e)+t,{x:it,y:at}=i[g];for(w=I=-1,z=Y;z<J;z++)I=.5*Math.abs((it-D)*(i[z].y-at)-(it-i[z].x)*(R-at)),I>w&&(w=I,y=i[z],E=z);s[c++]=y,g=E}return s[c++]=i[f],s}function qgt(i,t,e,r){let n=0,o=0,s,a,c,f,g,v,y,w,I,E;const D=[],R=t+e-1,z=i[t].x,H=i[R].x-z;for(s=t;s<t+e;++s){a=i[s],c=(a.x-z)/H*r,f=a.y;const q=c|0;if(q===g)f<I?(I=f,v=s):f>E&&(E=f,y=s),n=(o*n+a.x)/++o;else{const Y=s-1;if(!On(v)&&!On(y)){const J=Math.min(v,y),it=Math.max(v,y);J!==w&&J!==Y&&D.push({...i[J],x:n}),it!==w&&it!==Y&&D.push({...i[it],x:n})}s>0&&Y!==w&&D.push(i[Y]),D.push(a),g=q,o=0,I=E=f,v=y=w=s}}return D}function sY(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function z6(i){i.data.datasets.forEach(t=>{sY(t)})}function Xgt(i,t){const e=t.length;let r=0,n;const{iScale:o}=i,{min:s,max:a,minDefined:c,maxDefined:f}=o.getUserBounds();return c&&(r=ns(_d(t,o.axis,s).lo,0,e-1)),f?n=ns(_d(t,o.axis,a).hi+1,r,e)-r:n=e-r,{start:r,count:n}}var Ygt={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){z6(i);return}const r=i.width;i.data.datasets.forEach((n,o)=>{const{_data:s,indexAxis:a}=n,c=i.getDatasetMeta(o),f=s||n.data;if($b([a,i.options.indexAxis])==="y"||!c.controller.supportsDecimation)return;const g=i.scales[c.xAxisID];if(g.type!=="linear"&&g.type!=="time"||i.options.parsing)return;let{start:v,count:y}=Xgt(c,f);const w=e.threshold||4*r;if(y<=w){sY(n);return}On(s)&&(n._data=f,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(E){this._data=E}}));let I;switch(e.algorithm){case"lttb":I=Zgt(f,v,y,r,e);break;case"min-max":I=qgt(f,v,y,r);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}n._decimated=I})},destroy(i){z6(i)}};function Kgt(i,t,e){const r=i.segments,n=i.points,o=t.points,s=[];for(const a of r){let{start:c,end:f}=a;f=qM(c,f,n);const g=pO(e,n[c],n[f],a.loop);if(!t.segments){s.push({source:a,target:g,start:n[c],end:n[f]});continue}const v=UX(t,g);for(const y of v){const w=pO(e,o[y.start],o[y.end],y.loop),I=VX(a,n,w);for(const E of I)s.push({source:E,target:y,start:{[e]:B6(g,w,"start",Math.max)},end:{[e]:B6(g,w,"end",Math.min)}})}}return s}function pO(i,t,e,r){if(r)return;let n=t[i],o=e[i];return i==="angle"&&(n=Ps(n),o=Ps(o)),{property:i,start:n,end:o}}function Jgt(i,t){const{x:e=null,y:r=null}=i||{},n=t.points,o=[];return t.segments.forEach(({start:s,end:a})=>{a=qM(s,a,n);const c=n[s],f=n[a];r!==null?(o.push({x:c.x,y:r}),o.push({x:f.x,y:r})):e!==null&&(o.push({x:e,y:c.y}),o.push({x:e,y:f.y}))}),o}function qM(i,t,e){for(;t>i;t--){const r=e[t];if(!isNaN(r.x)&&!isNaN(r.y))break}return t}function B6(i,t,e,r){return i&&t?r(i[e],t[e]):i?i[e]:t?t[e]:0}function lY(i,t){let e=[],r=!1;return Na(i)?(r=!0,e=i):e=Jgt(i,t),e.length?new cp({points:e,options:{tension:0},_loop:r,_fullLoop:r}):null}function F6(i){return i&&i.fill!==!1}function Qgt(i,t,e){let n=i[t].fill;const o=[t];let s;if(!e)return n;for(;n!==!1&&o.indexOf(n)===-1;){if(!uo(n))return n;if(s=i[n],!s)return!1;if(s.visible)return n;o.push(n),n=s.fill}return!1}function tmt(i,t,e){const r=nmt(i);if(Nn(r))return isNaN(r.value)?!1:r;let n=parseFloat(r);return uo(n)&&Math.floor(n)===n?emt(r[0],t,n,e):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function emt(i,t,e,r){return(i==="-"||i==="+")&&(e=t+e),e===t||e<0||e>=r?!1:e}function imt(i,t){let e=null;return i==="start"?e=t.bottom:i==="end"?e=t.top:Nn(i)?e=t.getPixelForValue(i.value):t.getBasePixel&&(e=t.getBasePixel()),e}function rmt(i,t,e){let r;return i==="start"?r=e:i==="end"?r=t.options.reverse?t.min:t.max:Nn(i)?r=i.value:r=t.getBaseValue(),r}function nmt(i){const t=i.options,e=t.fill;let r=cn(e&&e.target,e);return r===void 0&&(r=!!t.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function amt(i){const{scale:t,index:e,line:r}=i,n=[],o=r.segments,s=r.points,a=omt(t,e);a.push(lY({x:null,y:t.bottom},r));for(let c=0;c<o.length;c++){const f=o[c];for(let g=f.start;g<=f.end;g++)smt(n,s[g],a)}return new cp({points:n,options:{}})}function omt(i,t){const e=[],r=i.getMatchingVisibleMetas("line");for(let n=0;n<r.length;n++){const o=r[n];if(o.index===t)break;o.hidden||e.unshift(o.dataset)}return e}function smt(i,t,e){const r=[];for(let n=0;n<e.length;n++){const o=e[n],{first:s,last:a,point:c}=lmt(o,t,"x");if(!(!c||s&&a)){if(s)r.unshift(c);else if(i.push(c),!a)break}}i.push(...r)}function lmt(i,t,e){const r=i.interpolate(t,e);if(!r)return{};const n=r[e],o=i.segments,s=i.points;let a=!1,c=!1;for(let f=0;f<o.length;f++){const g=o[f],v=s[g.start][e],y=s[g.end][e];if(vd(n,v,y)){a=n===v,c=n===y;break}}return{first:a,last:c,point:r}}class uY{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,r){const{x:n,y:o,radius:s}=this;return e=e||{start:0,end:Va},t.arc(n,o,s,e.end,e.start,!0),!r.bounds}interpolate(t){const{x:e,y:r,radius:n}=this,o=t.angle;return{x:e+Math.cos(o)*n,y:r+Math.sin(o)*n,angle:o}}}function umt(i){const{chart:t,fill:e,line:r}=i;if(uo(e))return cmt(t,e);if(e==="stack")return amt(i);if(e==="shape")return!0;const n=hmt(i);return n instanceof uY?n:lY(n,r)}function cmt(i,t){const e=i.getDatasetMeta(t);return e&&i.isDatasetVisible(t)?e.dataset:null}function hmt(i){return(i.scale||{}).getPointPositionForValue?fmt(i):dmt(i)}function dmt(i){const{scale:t={},fill:e}=i,r=imt(e,t);if(uo(r)){const n=t.isHorizontal();return{x:n?r:null,y:n?null:r}}return null}function fmt(i){const{scale:t,fill:e}=i,r=t.options,n=t.getLabels().length,o=r.reverse?t.max:t.min,s=rmt(e,t,o),a=[];if(r.grid.circular){const c=t.getPointPositionForValue(0,o);return new uY({x:c.x,y:c.y,radius:t.getDistanceFromCenterForValue(s)})}for(let c=0;c<n;++c)a.push(t.getPointPositionForValue(c,s));return a}function dL(i,t,e){const r=umt(t),{chart:n,index:o,line:s,scale:a,axis:c}=t,f=s.options,g=f.fill,v=f.backgroundColor,{above:y=v,below:w=v}=g||{},I=n.getDatasetMeta(o),E=GX(n,I);r&&s.points.length&&(WM(i,e),pmt(i,{line:s,target:r,above:y,below:w,area:e,scale:a,axis:c,clip:E}),$M(i))}function pmt(i,t){const{line:e,target:r,above:n,below:o,area:s,scale:a,clip:c}=t,f=e._loop?"angle":t.axis;i.save();let g=o;o!==n&&(f==="x"?(N6(i,r,s.top),fL(i,{line:e,target:r,color:n,scale:a,property:f,clip:c}),i.restore(),i.save(),N6(i,r,s.bottom)):f==="y"&&(V6(i,r,s.left),fL(i,{line:e,target:r,color:o,scale:a,property:f,clip:c}),i.restore(),i.save(),V6(i,r,s.right),g=n)),fL(i,{line:e,target:r,color:g,scale:a,property:f,clip:c}),i.restore()}function N6(i,t,e){const{segments:r,points:n}=t;let o=!0,s=!1;i.beginPath();for(const a of r){const{start:c,end:f}=a,g=n[c],v=n[qM(c,f,n)];o?(i.moveTo(g.x,g.y),o=!1):(i.lineTo(g.x,e),i.lineTo(g.x,g.y)),s=!!t.pathSegment(i,a,{move:s}),s?i.closePath():i.lineTo(v.x,e)}i.lineTo(t.first().x,e),i.closePath(),i.clip()}function V6(i,t,e){const{segments:r,points:n}=t;let o=!0,s=!1;i.beginPath();for(const a of r){const{start:c,end:f}=a,g=n[c],v=n[qM(c,f,n)];o?(i.moveTo(g.x,g.y),o=!1):(i.lineTo(e,g.y),i.lineTo(g.x,g.y)),s=!!t.pathSegment(i,a,{move:s}),s?i.closePath():i.lineTo(e,v.y)}i.lineTo(e,t.first().y),i.closePath(),i.clip()}function fL(i,t){const{line:e,target:r,property:n,color:o,scale:s,clip:a}=t,c=Kgt(e,r,n);for(const{source:f,target:g,start:v,end:y}of c){const{style:{backgroundColor:w=o}={}}=f,I=r!==!0;i.save(),i.fillStyle=w,gmt(i,s,a,I&&pO(n,v,y)),i.beginPath();const E=!!e.pathSegment(i,f);let D;if(I){E?i.closePath():U6(i,r,y,n);const R=!!r.pathSegment(i,g,{move:E,reverse:!0});D=E&&R,D||U6(i,r,v,n)}i.closePath(),i.fill(D?"evenodd":"nonzero"),i.restore()}}function gmt(i,t,e,r){const n=t.chart.chartArea,{property:o,start:s,end:a}=r||{};if(o==="x"||o==="y"){let c,f,g,v;o==="x"?(c=s,f=n.top,g=a,v=n.bottom):(c=n.left,f=s,g=n.right,v=a),i.beginPath(),e&&(c=Math.max(c,e.left),g=Math.min(g,e.right),f=Math.max(f,e.top),v=Math.min(v,e.bottom)),i.rect(c,f,g-c,v-f),i.clip()}}function U6(i,t,e,r){const n=t.interpolate(e,r);n&&i.lineTo(n.x,n.y)}var mmt={id:"filler",afterDatasetsUpdate(i,t,e){const r=(i.data.datasets||[]).length,n=[];let o,s,a,c;for(s=0;s<r;++s)o=i.getDatasetMeta(s),a=o.dataset,c=null,a&&a.options&&a instanceof cp&&(c={visible:i.isDatasetVisible(s),index:s,fill:tmt(a,s,r),chart:i,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=c,n.push(c);for(s=0;s<r;++s)c=n[s],!(!c||c.fill===!1)&&(c.fill=Qgt(n,s,e.propagate))},beforeDraw(i,t,e){const r=e.drawTime==="beforeDraw",n=i.getSortedVisibleDatasetMetas(),o=i.chartArea;for(let s=n.length-1;s>=0;--s){const a=n[s].$filler;a&&(a.line.updateControlPoints(o,a.axis),r&&a.fill&&dL(i.ctx,a,o))}},beforeDatasetsDraw(i,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const r=i.getSortedVisibleDatasetMetas();for(let n=r.length-1;n>=0;--n){const o=r[n].$filler;F6(o)&&dL(i.ctx,o,i.chartArea)}},beforeDatasetDraw(i,t,e){const r=t.meta.$filler;!F6(r)||e.drawTime!=="beforeDatasetDraw"||dL(i.ctx,r,i.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const G6=(i,t)=>{let{boxHeight:e=t,boxWidth:r=t}=i;return i.usePointStyle&&(e=Math.min(e,t),r=i.pointStyleWidth||Math.min(r,t)),{boxWidth:r,boxHeight:e,itemHeight:Math.max(t,e)}},vmt=(i,t)=>i!==null&&t!==null&&i.datasetIndex===t.datasetIndex&&i.index===t.index;class H6 extends Hd{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,r){this.maxWidth=t,this.maxHeight=e,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=ka(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(r=>t.filter(r,this.chart.data))),t.sort&&(e=e.sort((r,n)=>t.sort(r,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const r=t.labels,n=Zo(r.font),o=n.size,s=this._computeTitleHeight(),{boxWidth:a,itemHeight:c}=G6(r,o);let f,g;e.font=n.string,this.isHorizontal()?(f=this.maxWidth,g=this._fitRows(s,o,a,c)+10):(g=this.maxHeight,f=this._fitCols(s,n,a,c)+10),this.width=Math.min(f,t.maxWidth||this.maxWidth),this.height=Math.min(g,t.maxHeight||this.maxHeight)}_fitRows(t,e,r,n){const{ctx:o,maxWidth:s,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],f=this.lineWidths=[0],g=n+a;let v=t;o.textAlign="left",o.textBaseline="middle";let y=-1,w=-g;return this.legendItems.forEach((I,E)=>{const D=r+e/2+o.measureText(I.text).width;(E===0||f[f.length-1]+D+2*a>s)&&(v+=g,f[f.length-(E>0?0:1)]=0,w+=g,y++),c[E]={left:0,top:w,row:y,width:D,height:n},f[f.length-1]+=D+a}),v}_fitCols(t,e,r,n){const{ctx:o,maxHeight:s,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],f=this.columnSizes=[],g=s-t;let v=a,y=0,w=0,I=0,E=0;return this.legendItems.forEach((D,R)=>{const{itemWidth:z,itemHeight:N}=_mt(r,e,o,D,n);R>0&&w+N+2*a>g&&(v+=y+a,f.push({width:y,height:w}),I+=y+a,E++,y=w=0),c[R]={left:I,top:w,col:E,width:z,height:N},y=Math.max(y,z),w+=N+a}),v+=y,f.push({width:y,height:w}),v}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:r,labels:{padding:n},rtl:o}}=this,s=s0(o,this.left,this.width);if(this.isHorizontal()){let a=0,c=Es(r,this.left+n,this.right-this.lineWidths[a]);for(const f of e)a!==f.row&&(a=f.row,c=Es(r,this.left+n,this.right-this.lineWidths[a])),f.top+=this.top+t+n,f.left=s.leftForLtr(s.x(c),f.width),c+=f.width+n}else{let a=0,c=Es(r,this.top+t+n,this.bottom-this.columnSizes[a].height);for(const f of e)f.col!==a&&(a=f.col,c=Es(r,this.top+t+n,this.bottom-this.columnSizes[a].height)),f.top=c,f.left+=this.left+n,f.left=s.leftForLtr(s.x(f.left),f.width),c+=f.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;WM(t,this),this._draw(),$M(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:r,ctx:n}=this,{align:o,labels:s}=t,a=$a.color,c=s0(t.rtl,this.left,this.width),f=Zo(s.font),{padding:g}=s,v=f.size,y=v/2;let w;this.drawTitle(),n.textAlign=c.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=f.string;const{boxWidth:I,boxHeight:E,itemHeight:D}=G6(s,v),R=function(Y,J,it){if(isNaN(I)||I<=0||isNaN(E)||E<0)return;n.save();const at=cn(it.lineWidth,1);if(n.fillStyle=cn(it.fillStyle,a),n.lineCap=cn(it.lineCap,"butt"),n.lineDashOffset=cn(it.lineDashOffset,0),n.lineJoin=cn(it.lineJoin,"miter"),n.lineWidth=at,n.strokeStyle=cn(it.strokeStyle,a),n.setLineDash(cn(it.lineDash,[])),s.usePointStyle){const ut={radius:E*Math.SQRT2/2,pointStyle:it.pointStyle,rotation:it.rotation,borderWidth:at},ft=c.xPlus(Y,I/2),_t=J+y;EX(n,ut,ft,_t,s.pointStyleWidth&&I)}else{const ut=J+Math.max((v-E)/2,0),ft=c.leftForLtr(Y,I),_t=iv(it.borderRadius);n.beginPath(),Object.values(_t).some(ct=>ct!==0)?qw(n,{x:ft,y:ut,w:I,h:E,radius:_t}):n.rect(ft,ut,I,E),n.fill(),at!==0&&n.stroke()}n.restore()},z=function(Y,J,it){gv(n,it.text,Y,J+D/2,f,{strikethrough:it.hidden,textAlign:c.textAlign(it.textAlign)})},N=this.isHorizontal(),H=this._computeTitleHeight();N?w={x:Es(o,this.left+g,this.right-r[0]),y:this.top+g+H,line:0}:w={x:this.left+g,y:Es(o,this.top+H+g,this.bottom-e[0].height),line:0},BX(this.ctx,t.textDirection);const q=D+g;this.legendItems.forEach((Y,J)=>{n.strokeStyle=Y.fontColor,n.fillStyle=Y.fontColor;const it=n.measureText(Y.text).width,at=c.textAlign(Y.textAlign||(Y.textAlign=s.textAlign)),ut=I+y+it;let ft=w.x,_t=w.y;c.setWidth(this.width),N?J>0&&ft+ut+g>this.right&&(_t=w.y+=q,w.line++,ft=w.x=Es(o,this.left+g,this.right-r[w.line])):J>0&&_t+q>this.bottom&&(ft=w.x=ft+e[w.line].width+g,w.line++,_t=w.y=Es(o,this.top+H+g,this.bottom-e[w.line].height));const ct=c.x(ft);if(R(ct,_t,Y),ft=Bdt(at,ft+I+y,N?ft+ut:this.right,t.rtl),z(c.x(ft),_t,Y),N)w.x+=ut+g;else if(typeof Y.text!="string"){const Dt=f.lineHeight;w.y+=cY(Y,Dt)+g}else w.y+=q}),FX(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,r=Zo(e.font),n=Fs(e.padding);if(!e.display)return;const o=s0(t.rtl,this.left,this.width),s=this.ctx,a=e.position,c=r.size/2,f=n.top+c;let g,v=this.left,y=this.width;if(this.isHorizontal())y=Math.max(...this.lineWidths),g=this.top+f,v=Es(t.align,v,this.right-y);else{const I=this.columnSizes.reduce((E,D)=>Math.max(E,D.height),0);g=f+Es(t.align,this.top,this.bottom-I-t.labels.padding-this._computeTitleHeight())}const w=Es(a,v,v+y);s.textAlign=o.textAlign(sF(a)),s.textBaseline="middle",s.strokeStyle=e.color,s.fillStyle=e.color,s.font=r.string,gv(s,e.text,w,g,r)}_computeTitleHeight(){const t=this.options.title,e=Zo(t.font),r=Fs(t.padding);return t.display?e.lineHeight+r.height:0}_getLegendItemAt(t,e){let r,n,o;if(vd(t,this.left,this.right)&&vd(e,this.top,this.bottom)){for(o=this.legendHitBoxes,r=0;r<o.length;++r)if(n=o[r],vd(t,n.left,n.left+n.width)&&vd(e,n.top,n.top+n.height))return this.legendItems[r]}return null}handleEvent(t){const e=this.options;if(!bmt(t.type,e))return;const r=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,o=vmt(n,r);n&&!o&&ka(e.onLeave,[t,n,this],this),this._hoveredItem=r,r&&!o&&ka(e.onHover,[t,r,this],this)}else r&&ka(e.onClick,[t,r,this],this)}}function _mt(i,t,e,r,n){const o=ymt(r,i,t,e),s=xmt(n,r,t.lineHeight);return{itemWidth:o,itemHeight:s}}function ymt(i,t,e,r){let n=i.text;return n&&typeof n!="string"&&(n=n.reduce((o,s)=>o.length>s.length?o:s)),t+e.size/2+r.measureText(n).width}function xmt(i,t,e){let r=i;return typeof t.text!="string"&&(r=cY(t,e)),r}function cY(i,t){const e=i.text?i.text.length:0;return t*e}function bmt(i,t){return!!((i==="mousemove"||i==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(i==="click"||i==="mouseup"))}var wmt={id:"legend",_element:H6,start(i,t,e){const r=i.legend=new H6({ctx:i.ctx,options:e,chart:i});Os.configure(i,r,e),Os.addBox(i,r)},stop(i){Os.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,t,e){const r=i.legend;Os.configure(i,r,e),r.options=e},afterUpdate(i){const t=i.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(i,t){t.replay||i.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,t,e){const r=t.datasetIndex,n=e.chart;n.isDatasetVisible(r)?(n.hide(r),t.hidden=!0):(n.show(r),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const t=i.data.datasets,{labels:{usePointStyle:e,pointStyle:r,textAlign:n,color:o,useBorderRadius:s,borderRadius:a}}=i.legend.options;return i._getSortedDatasetMetas().map(c=>{const f=c.controller.getStyle(e?0:void 0),g=Fs(f.borderWidth);return{text:t[c.index].label,fillStyle:f.backgroundColor,fontColor:o,hidden:!c.visible,lineCap:f.borderCapStyle,lineDash:f.borderDash,lineDashOffset:f.borderDashOffset,lineJoin:f.borderJoinStyle,lineWidth:(g.width+g.height)/4,strokeStyle:f.borderColor,pointStyle:r||f.pointStyle,rotation:f.rotation,textAlign:n||f.textAlign,borderRadius:s&&(a||f.borderRadius),datasetIndex:c.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};class mF extends Hd{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const r=this.options;if(this.left=0,this.top=0,!r.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const n=Na(r.text)?r.text.length:1;this._padding=Fs(r.padding);const o=n*Zo(r.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:r,bottom:n,right:o,options:s}=this,a=s.align;let c=0,f,g,v;return this.isHorizontal()?(g=Es(a,r,o),v=e+t,f=o-r):(s.position==="left"?(g=r+t,v=Es(a,n,e),c=ea*-.5):(g=o-t,v=Es(a,e,n),c=ea*.5),f=n-e),{titleX:g,titleY:v,maxWidth:f,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const r=Zo(e.font),o=r.lineHeight/2+this._padding.top,{titleX:s,titleY:a,maxWidth:c,rotation:f}=this._drawArgs(o);gv(t,e.text,0,0,r,{color:e.color,maxWidth:c,rotation:f,textAlign:sF(e.align),textBaseline:"middle",translation:[s,a]})}}function Smt(i,t){const e=new mF({ctx:i.ctx,options:t,chart:i});Os.configure(i,e,t),Os.addBox(i,e),i.titleBlock=e}var Tmt={id:"title",_element:mF,start(i,t,e){Smt(i,e)},stop(i){const t=i.titleBlock;Os.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const r=i.titleBlock;Os.configure(i,r,e),r.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const aA=new WeakMap;var Amt={id:"subtitle",start(i,t,e){const r=new mF({ctx:i.ctx,options:e,chart:i});Os.configure(i,r,e),Os.addBox(i,r),aA.set(i,r)},stop(i){Os.removeBox(i,aA.get(i)),aA.delete(i)},beforeUpdate(i,t,e){const r=aA.get(i);Os.configure(i,r,e),r.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Xb={average(i){if(!i.length)return!1;let t,e,r=new Set,n=0,o=0;for(t=0,e=i.length;t<e;++t){const a=i[t].element;if(a&&a.hasValue()){const c=a.tooltipPosition();r.add(c.x),n+=c.y,++o}}return o===0||r.size===0?!1:{x:[...r].reduce((a,c)=>a+c)/r.size,y:n/o}},nearest(i,t){if(!i.length)return!1;let e=t.x,r=t.y,n=Number.POSITIVE_INFINITY,o,s,a;for(o=0,s=i.length;o<s;++o){const c=i[o].element;if(c&&c.hasValue()){const f=c.getCenterPoint(),g=oO(t,f);g<n&&(n=g,a=c)}}if(a){const c=a.tooltipPosition();e=c.x,r=c.y}return{x:e,y:r}}};function Kc(i,t){return t&&(Na(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function sd(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function Imt(i,t){const{element:e,datasetIndex:r,index:n}=t,o=i.getDatasetMeta(r).controller,{label:s,value:a}=o.getLabelAndValue(n);return{chart:i,label:s,parsed:o.getParsed(n),raw:i.data.datasets[r].data[n],formattedValue:a,dataset:o.getDataset(),dataIndex:n,datasetIndex:r,element:e}}function j6(i,t){const e=i.chart.ctx,{body:r,footer:n,title:o}=i,{boxWidth:s,boxHeight:a}=t,c=Zo(t.bodyFont),f=Zo(t.titleFont),g=Zo(t.footerFont),v=o.length,y=n.length,w=r.length,I=Fs(t.padding);let E=I.height,D=0,R=r.reduce((H,q)=>H+q.before.length+q.lines.length+q.after.length,0);if(R+=i.beforeBody.length+i.afterBody.length,v&&(E+=v*f.lineHeight+(v-1)*t.titleSpacing+t.titleMarginBottom),R){const H=t.displayColors?Math.max(a,c.lineHeight):c.lineHeight;E+=w*H+(R-w)*c.lineHeight+(R-1)*t.bodySpacing}y&&(E+=t.footerMarginTop+y*g.lineHeight+(y-1)*t.footerSpacing);let z=0;const N=function(H){D=Math.max(D,e.measureText(H).width+z)};return e.save(),e.font=f.string,_a(i.title,N),e.font=c.string,_a(i.beforeBody.concat(i.afterBody),N),z=t.displayColors?s+2+t.boxPadding:0,_a(r,H=>{_a(H.before,N),_a(H.lines,N),_a(H.after,N)}),z=0,e.font=g.string,_a(i.footer,N),e.restore(),D+=I.width,{width:D,height:E}}function Cmt(i,t){const{y:e,height:r}=t;return e<r/2?"top":e>i.height-r/2?"bottom":"center"}function Mmt(i,t,e,r){const{x:n,width:o}=r,s=e.caretSize+e.caretPadding;if(i==="left"&&n+o+s>t.width||i==="right"&&n-o-s<0)return!0}function Emt(i,t,e,r){const{x:n,width:o}=e,{width:s,chartArea:{left:a,right:c}}=i;let f="center";return r==="center"?f=n<=(a+c)/2?"left":"right":n<=o/2?f="left":n>=s-o/2&&(f="right"),Mmt(f,i,t,e)&&(f="center"),f}function W6(i,t,e){const r=e.yAlign||t.yAlign||Cmt(i,e);return{xAlign:e.xAlign||t.xAlign||Emt(i,t,e,r),yAlign:r}}function Dmt(i,t){let{x:e,width:r}=i;return t==="right"?e-=r:t==="center"&&(e-=r/2),e}function Pmt(i,t,e){let{y:r,height:n}=i;return t==="top"?r+=e:t==="bottom"?r-=n+e:r-=n/2,r}function $6(i,t,e,r){const{caretSize:n,caretPadding:o,cornerRadius:s}=i,{xAlign:a,yAlign:c}=e,f=n+o,{topLeft:g,topRight:v,bottomLeft:y,bottomRight:w}=iv(s);let I=Dmt(t,a);const E=Pmt(t,c,f);return c==="center"?a==="left"?I+=f:a==="right"&&(I-=f):a==="left"?I-=Math.max(g,y)+n:a==="right"&&(I+=Math.max(v,w)+n),{x:ns(I,0,r.width-t.width),y:ns(E,0,r.height-t.height)}}function oA(i,t,e){const r=Fs(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-r.right:i.x+r.left}function Z6(i){return Kc([],sd(i))}function Lmt(i,t,e){return Hp(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function q6(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const hY={beforeTitle:td,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,r=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(r>0&&t.dataIndex<r)return e[t.dataIndex]}return""},afterTitle:td,beforeBody:td,beforeLabel:td,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return On(e)||(t+=e),t},labelColor(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const e=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:td,afterBody:td,beforeFooter:td,footer:td,afterFooter:td};function Ml(i,t,e,r){const n=i[t].call(e,r);return typeof n>"u"?hY[t].call(e,r):n}class gO extends Hd{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,r=this.options.setContext(this.getContext()),n=r.enabled&&e.options.animation&&r.animations,o=new HX(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=Lmt(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:r}=e,n=Ml(r,"beforeTitle",this,t),o=Ml(r,"title",this,t),s=Ml(r,"afterTitle",this,t);let a=[];return a=Kc(a,sd(n)),a=Kc(a,sd(o)),a=Kc(a,sd(s)),a}getBeforeBody(t,e){return Z6(Ml(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:r}=e,n=[];return _a(t,o=>{const s={before:[],lines:[],after:[]},a=q6(r,o);Kc(s.before,sd(Ml(a,"beforeLabel",this,o))),Kc(s.lines,Ml(a,"label",this,o)),Kc(s.after,sd(Ml(a,"afterLabel",this,o))),n.push(s)}),n}getAfterBody(t,e){return Z6(Ml(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:r}=e,n=Ml(r,"beforeFooter",this,t),o=Ml(r,"footer",this,t),s=Ml(r,"afterFooter",this,t);let a=[];return a=Kc(a,sd(n)),a=Kc(a,sd(o)),a=Kc(a,sd(s)),a}_createItems(t){const e=this._active,r=this.chart.data,n=[],o=[],s=[];let a=[],c,f;for(c=0,f=e.length;c<f;++c)a.push(Imt(this.chart,e[c]));return t.filter&&(a=a.filter((g,v,y)=>t.filter(g,v,y,r))),t.itemSort&&(a=a.sort((g,v)=>t.itemSort(g,v,r))),_a(a,g=>{const v=q6(t.callbacks,g);n.push(Ml(v,"labelColor",this,g)),o.push(Ml(v,"labelPointStyle",this,g)),s.push(Ml(v,"labelTextColor",this,g))}),this.labelColors=n,this.labelPointStyles=o,this.labelTextColors=s,this.dataPoints=a,a}update(t,e){const r=this.options.setContext(this.getContext()),n=this._active;let o,s=[];if(!n.length)this.opacity!==0&&(o={opacity:0});else{const a=Xb[r.position].call(this,n,this._eventPosition);s=this._createItems(r),this.title=this.getTitle(s,r),this.beforeBody=this.getBeforeBody(s,r),this.body=this.getBody(s,r),this.afterBody=this.getAfterBody(s,r),this.footer=this.getFooter(s,r);const c=this._size=j6(this,r),f=Object.assign({},a,c),g=W6(this.chart,r,f),v=$6(r,f,g,this.chart);this.xAlign=g.xAlign,this.yAlign=g.yAlign,o={opacity:1,x:v.x,y:v.y,width:c.width,height:c.height,caretX:a.x,caretY:a.y}}this._tooltipItems=s,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,r,n){const o=this.getCaretPosition(t,r,n);e.lineTo(o.x1,o.y1),e.lineTo(o.x2,o.y2),e.lineTo(o.x3,o.y3)}getCaretPosition(t,e,r){const{xAlign:n,yAlign:o}=this,{caretSize:s,cornerRadius:a}=r,{topLeft:c,topRight:f,bottomLeft:g,bottomRight:v}=iv(a),{x:y,y:w}=t,{width:I,height:E}=e;let D,R,z,N,H,q;return o==="center"?(H=w+E/2,n==="left"?(D=y,R=D-s,N=H+s,q=H-s):(D=y+I,R=D+s,N=H-s,q=H+s),z=D):(n==="left"?R=y+Math.max(c,g)+s:n==="right"?R=y+I-Math.max(f,v)-s:R=this.caretX,o==="top"?(N=w,H=N-s,D=R-s,z=R+s):(N=w+E,H=N+s,D=R+s,z=R-s),q=N),{x1:D,x2:R,x3:z,y1:N,y2:H,y3:q}}drawTitle(t,e,r){const n=this.title,o=n.length;let s,a,c;if(o){const f=s0(r.rtl,this.x,this.width);for(t.x=oA(this,r.titleAlign,r),e.textAlign=f.textAlign(r.titleAlign),e.textBaseline="middle",s=Zo(r.titleFont),a=r.titleSpacing,e.fillStyle=r.titleColor,e.font=s.string,c=0;c<o;++c)e.fillText(n[c],f.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+a,c+1===o&&(t.y+=r.titleMarginBottom-a)}}_drawColorBox(t,e,r,n,o){const s=this.labelColors[r],a=this.labelPointStyles[r],{boxHeight:c,boxWidth:f}=o,g=Zo(o.bodyFont),v=oA(this,"left",o),y=n.x(v),w=c<g.lineHeight?(g.lineHeight-c)/2:0,I=e.y+w;if(o.usePointStyle){const E={radius:Math.min(f,c)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},D=n.leftForLtr(y,f)+f/2,R=I+c/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,lO(t,E,D,R),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,lO(t,E,D,R)}else{t.lineWidth=Nn(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;const E=n.leftForLtr(y,f),D=n.leftForLtr(n.xPlus(y,1),f-2),R=iv(s.borderRadius);Object.values(R).some(z=>z!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,qw(t,{x:E,y:I,w:f,h:c,radius:R}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),qw(t,{x:D,y:I+1,w:f-2,h:c-2,radius:R}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(E,I,f,c),t.strokeRect(E,I,f,c),t.fillStyle=s.backgroundColor,t.fillRect(D,I+1,f-2,c-2))}t.fillStyle=this.labelTextColors[r]}drawBody(t,e,r){const{body:n}=this,{bodySpacing:o,bodyAlign:s,displayColors:a,boxHeight:c,boxWidth:f,boxPadding:g}=r,v=Zo(r.bodyFont);let y=v.lineHeight,w=0;const I=s0(r.rtl,this.x,this.width),E=function(it){e.fillText(it,I.x(t.x+w),t.y+y/2),t.y+=y+o},D=I.textAlign(s);let R,z,N,H,q,Y,J;for(e.textAlign=s,e.textBaseline="middle",e.font=v.string,t.x=oA(this,D,r),e.fillStyle=r.bodyColor,_a(this.beforeBody,E),w=a&&D!=="right"?s==="center"?f/2+g:f+2+g:0,H=0,Y=n.length;H<Y;++H){for(R=n[H],z=this.labelTextColors[H],e.fillStyle=z,_a(R.before,E),N=R.lines,a&&N.length&&(this._drawColorBox(e,t,H,I,r),y=Math.max(v.lineHeight,c)),q=0,J=N.length;q<J;++q)E(N[q]),y=v.lineHeight;_a(R.after,E)}w=0,y=v.lineHeight,_a(this.afterBody,E),t.y-=o}drawFooter(t,e,r){const n=this.footer,o=n.length;let s,a;if(o){const c=s0(r.rtl,this.x,this.width);for(t.x=oA(this,r.footerAlign,r),t.y+=r.footerMarginTop,e.textAlign=c.textAlign(r.footerAlign),e.textBaseline="middle",s=Zo(r.footerFont),e.fillStyle=r.footerColor,e.font=s.string,a=0;a<o;++a)e.fillText(n[a],c.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+r.footerSpacing}}drawBackground(t,e,r,n){const{xAlign:o,yAlign:s}=this,{x:a,y:c}=t,{width:f,height:g}=r,{topLeft:v,topRight:y,bottomLeft:w,bottomRight:I}=iv(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(a+v,c),s==="top"&&this.drawCaret(t,e,r,n),e.lineTo(a+f-y,c),e.quadraticCurveTo(a+f,c,a+f,c+y),s==="center"&&o==="right"&&this.drawCaret(t,e,r,n),e.lineTo(a+f,c+g-I),e.quadraticCurveTo(a+f,c+g,a+f-I,c+g),s==="bottom"&&this.drawCaret(t,e,r,n),e.lineTo(a+w,c+g),e.quadraticCurveTo(a,c+g,a,c+g-w),s==="center"&&o==="left"&&this.drawCaret(t,e,r,n),e.lineTo(a,c+v),e.quadraticCurveTo(a,c,a+v,c),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,r=this.$animations,n=r&&r.x,o=r&&r.y;if(n||o){const s=Xb[t.position].call(this,this._active,this._eventPosition);if(!s)return;const a=this._size=j6(this,t),c=Object.assign({},s,this._size),f=W6(e,t,c),g=$6(t,c,f,e);(n._to!==g.x||o._to!==g.y)&&(this.xAlign=f.xAlign,this.yAlign=f.yAlign,this.width=a.width,this.height=a.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,g))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},o={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const s=Fs(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=r,this.drawBackground(o,t,n,e),BX(t,e.textDirection),o.y+=s.top,this.drawTitle(o,t,e),this.drawBody(o,t,e),this.drawFooter(o,t,e),FX(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const r=this._active,n=t.map(({datasetIndex:a,index:c})=>{const f=this.chart.getDatasetMeta(a);if(!f)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:f.data[c],index:c}}),o=!vC(r,n),s=this._positionChanged(n,e);(o||s)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,r=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,o=this._active||[],s=this._getActiveElements(t,o,e,r),a=this._positionChanged(s,t),c=e||!vC(s,o)||a;return c&&(this._active=s,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),c}_getActiveElements(t,e,r,n){const o=this.options;if(t.type==="mouseout")return[];if(!n)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const s=this.chart.getElementsAtEventForMode(t,o.mode,o,r);return o.reverse&&s.reverse(),s}_positionChanged(t,e){const{caretX:r,caretY:n,options:o}=this,s=Xb[o.position].call(this,t,e);return s!==!1&&(r!==s.x||n!==s.y)}}Wi(gO,"positioners",Xb);var Rmt={id:"tooltip",_element:gO,positioners:Xb,afterInit(i,t,e){e&&(i.tooltip=new gO({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:hY},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},kmt=Object.freeze({__proto__:null,Colors:$gt,Decimation:Ygt,Filler:mmt,Legend:wmt,SubTitle:Amt,Title:Tmt,Tooltip:Rmt});const Omt=(i,t,e,r)=>(typeof t=="string"?(e=i.push(t)-1,r.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function zmt(i,t,e,r){const n=i.indexOf(t);if(n===-1)return Omt(i,t,e,r);const o=i.lastIndexOf(t);return n!==o?e:n}const Bmt=(i,t)=>i===null?null:ns(Math.round(i),0,t);function X6(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class mO extends BS{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const r=this.getLabels();for(const{index:n,label:o}of e)r[n]===o&&r.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(On(t))return null;const r=this.getLabels();return e=isFinite(e)&&r[e]===t?e:zmt(r,t,cn(e,t),this._addedLabels),Bmt(e,r.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:r,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(r=0),e||(n=this.getLabels().length-1)),this.min=r,this.max=n}buildTicks(){const t=this.min,e=this.max,r=this.options.offset,n=[];let o=this.getLabels();o=t===0&&e===o.length-1?o:o.slice(t,e+1),this._valueRange=Math.max(o.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let s=t;s<=e;s++)n.push({value:s});return n}getLabelForValue(t){return X6.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}Wi(mO,"id","category"),Wi(mO,"defaults",{ticks:{callback:X6}});function Fmt(i,t){const e=[],{bounds:n,step:o,min:s,max:a,precision:c,count:f,maxTicks:g,maxDigits:v,includeBounds:y}=i,w=o||1,I=g-1,{min:E,max:D}=t,R=!On(s),z=!On(a),N=!On(f),H=(D-E)/(v+1);let q=jG((D-E)/I/w)*w,Y,J,it,at;if(q<1e-14&&!R&&!z)return[{value:E},{value:D}];at=Math.ceil(D/q)-Math.floor(E/q),at>I&&(q=jG(at*q/I/w)*w),On(c)||(Y=Math.pow(10,c),q=Math.ceil(q*Y)/Y),n==="ticks"?(J=Math.floor(E/q)*q,it=Math.ceil(D/q)*q):(J=E,it=D),R&&z&&o&&Ddt((a-s)/o,q/1e3)?(at=Math.round(Math.min((a-s)/q,g)),q=(a-s)/at,J=s,it=a):N?(J=R?s:J,it=z?a:it,at=f-1,q=(it-J)/at):(at=(it-J)/q,yw(at,Math.round(at),q/1e3)?at=Math.round(at):at=Math.ceil(at));const ut=Math.max(WG(q),WG(J));Y=Math.pow(10,On(c)?ut:c),J=Math.round(J*Y)/Y,it=Math.round(it*Y)/Y;let ft=0;for(R&&(y&&J!==s?(e.push({value:s}),J<s&&ft++,yw(Math.round((J+ft*q)*Y)/Y,s,Y6(s,H,i))&&ft++):J<s&&ft++);ft<at;++ft){const _t=Math.round((J+ft*q)*Y)/Y;if(z&&_t>a)break;e.push({value:_t})}return z&&y&&it!==a?e.length&&yw(e[e.length-1].value,a,Y6(a,H,i))?e[e.length-1].value=a:e.push({value:a}):(!z||it===a)&&e.push({value:it}),e}function Y6(i,t,{horizontal:e,minRotation:r}){const n=lc(r),o=(e?Math.sin(n):Math.cos(n))||.001,s=.75*t*(""+i).length;return Math.min(t/o,s)}class TC extends BS{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return On(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:r}=this.getUserBounds();let{min:n,max:o}=this;const s=c=>n=e?n:c,a=c=>o=r?o:c;if(t){const c=fh(n),f=fh(o);c<0&&f<0?a(0):c>0&&f>0&&s(0)}if(n===o){let c=o===0?1:Math.abs(o*.05);a(o+c),t||s(n-c)}this.min=n,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:r}=t,n;return r?(n=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),e=e||11),e&&(n=Math.min(e,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let r=this.getTickLimit();r=Math.max(2,r);const n={maxTicks:r,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},o=this._range||this,s=Fmt(n,o);return t.bounds==="ticks"&&xX(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}configure(){const t=this.ticks;let e=this.min,r=this.max;if(super.configure(),this.options.offset&&t.length){const n=(r-e)/Math.max(t.length-1,1)/2;e-=n,r+=n}this._startValue=e,this._endValue=r,this._valueRange=r-e}getLabelForValue(t){return OS(t,this.chart.options.locale,this.options.ticks.format)}}class vO extends TC{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=uo(t)?t:0,this.max=uo(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,r=lc(this.options.ticks.minRotation),n=(t?Math.sin(r):Math.cos(r))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,o.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}Wi(vO,"id","linear"),Wi(vO,"defaults",{ticks:{callback:jM.formatters.numeric}});const Yw=i=>Math.floor(lp(i)),em=(i,t)=>Math.pow(10,Yw(i)+t);function K6(i){return i/Math.pow(10,Yw(i))===1}function J6(i,t,e){const r=Math.pow(10,e),n=Math.floor(i/r);return Math.ceil(t/r)-n}function Nmt(i,t){const e=t-i;let r=Yw(e);for(;J6(i,t,r)>10;)r++;for(;J6(i,t,r)<10;)r--;return Math.min(r,Yw(i))}function Vmt(i,{min:t,max:e}){t=$l(i.min,t);const r=[],n=Yw(t);let o=Nmt(t,e),s=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),c=n>o?Math.pow(10,n):0,f=Math.round((t-c)*s)/s,g=Math.floor((t-c)/a/10)*a*10;let v=Math.floor((f-g)/Math.pow(10,o)),y=$l(i.min,Math.round((c+g+v*Math.pow(10,o))*s)/s);for(;y<e;)r.push({value:y,major:K6(y),significand:v}),v>=10?v=v<15?15:20:v++,v>=20&&(o++,v=2,s=o>=0?1:s),y=Math.round((c+g+v*Math.pow(10,o))*s)/s;const w=$l(i.max,y);return r.push({value:w,major:K6(w),significand:v}),r}class _O extends BS{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const r=TC.prototype.parse.apply(this,[t,e]);if(r===0){this._zero=!0;return}return uo(r)&&r>0?r:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=uo(t)?Math.max(0,t):null,this.max=uo(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!uo(this._userMin)&&(this.min=t===em(this.min,0)?em(this.min,-1):em(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let r=this.min,n=this.max;const o=a=>r=t?r:a,s=a=>n=e?n:a;r===n&&(r<=0?(o(1),s(10)):(o(em(r,-1)),s(em(n,1)))),r<=0&&o(em(n,-1)),n<=0&&s(em(r,1)),this.min=r,this.max=n}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},r=Vmt(e,this);return t.bounds==="ticks"&&xX(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}getLabelForValue(t){return t===void 0?"0":OS(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=lp(t),this._valueRange=lp(this.max)-lp(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(lp(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}Wi(_O,"id","logarithmic"),Wi(_O,"defaults",{ticks:{callback:jM.formatters.logarithmic,major:{enabled:!0}}});function yO(i){const t=i.ticks;if(t.display&&i.display){const e=Fs(t.backdropPadding);return cn(t.font&&t.font.size,$a.font.size)+e.height}return 0}function Umt(i,t,e){return e=Na(e)?e:[e],{w:Zdt(i,t.string,e),h:e.length*t.lineHeight}}function Q6(i,t,e,r,n){return i===r||i===n?{start:t-e/2,end:t+e/2}:i<r||i>n?{start:t-e,end:t}:{start:t,end:t+e}}function Gmt(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),r=[],n=[],o=i._pointLabels.length,s=i.options.pointLabels,a=s.centerPointLabels?ea/o:0;for(let c=0;c<o;c++){const f=s.setContext(i.getPointLabelContext(c));n[c]=f.padding;const g=i.getPointPosition(c,i.drawingArea+n[c],a),v=Zo(f.font),y=Umt(i.ctx,v,i._pointLabels[c]);r[c]=y;const w=Ps(i.getIndexAngle(c)+a),I=Math.round(aF(w)),E=Q6(I,g.x,y.w,0,180),D=Q6(I,g.y,y.h,90,270);Hmt(e,t,w,E,D)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=$mt(i,r,n)}function Hmt(i,t,e,r,n){const o=Math.abs(Math.sin(e)),s=Math.abs(Math.cos(e));let a=0,c=0;r.start<t.l?(a=(t.l-r.start)/o,i.l=Math.min(i.l,t.l-a)):r.end>t.r&&(a=(r.end-t.r)/o,i.r=Math.max(i.r,t.r+a)),n.start<t.t?(c=(t.t-n.start)/s,i.t=Math.min(i.t,t.t-c)):n.end>t.b&&(c=(n.end-t.b)/s,i.b=Math.max(i.b,t.b+c))}function jmt(i,t,e){const r=i.drawingArea,{extra:n,additionalAngle:o,padding:s,size:a}=e,c=i.getPointPosition(t,r+n+s,o),f=Math.round(aF(Ps(c.angle+yo))),g=Xmt(c.y,a.h,f),v=Zmt(f),y=qmt(c.x,a.w,v);return{visible:!0,x:c.x,y:g,textAlign:v,left:y,top:g,right:y+a.w,bottom:g+a.h}}function Wmt(i,t){if(!t)return!0;const{left:e,top:r,right:n,bottom:o}=i;return!(yd({x:e,y:r},t)||yd({x:e,y:o},t)||yd({x:n,y:r},t)||yd({x:n,y:o},t))}function $mt(i,t,e){const r=[],n=i._pointLabels.length,o=i.options,{centerPointLabels:s,display:a}=o.pointLabels,c={extra:yO(o)/2,additionalAngle:s?ea/n:0};let f;for(let g=0;g<n;g++){c.padding=e[g],c.size=t[g];const v=jmt(i,g,c);r.push(v),a==="auto"&&(v.visible=Wmt(v,f),v.visible&&(f=v))}return r}function Zmt(i){return i===0||i===180?"center":i<180?"left":"right"}function qmt(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function Xmt(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function Ymt(i,t,e){const{left:r,top:n,right:o,bottom:s}=e,{backdropColor:a}=t;if(!On(a)){const c=iv(t.borderRadius),f=Fs(t.backdropPadding);i.fillStyle=a;const g=r-f.left,v=n-f.top,y=o-r+f.width,w=s-n+f.height;Object.values(c).some(I=>I!==0)?(i.beginPath(),qw(i,{x:g,y:v,w:y,h:w,radius:c}),i.fill()):i.fillRect(g,v,y,w)}}function Kmt(i,t){const{ctx:e,options:{pointLabels:r}}=i;for(let n=t-1;n>=0;n--){const o=i._pointLabelItems[n];if(!o.visible)continue;const s=r.setContext(i.getPointLabelContext(n));Ymt(e,s,o);const a=Zo(s.font),{x:c,y:f,textAlign:g}=o;gv(e,i._pointLabels[n],c,f+a.lineHeight/2,a,{color:s.color,textAlign:g,textBaseline:"middle"})}}function dY(i,t,e,r){const{ctx:n}=i;if(e)n.arc(i.xCenter,i.yCenter,t,0,Va);else{let o=i.getPointPosition(0,t);n.moveTo(o.x,o.y);for(let s=1;s<r;s++)o=i.getPointPosition(s,t),n.lineTo(o.x,o.y)}}function Jmt(i,t,e,r,n){const o=i.ctx,s=t.circular,{color:a,lineWidth:c}=t;!s&&!r||!a||!c||e<0||(o.save(),o.strokeStyle=a,o.lineWidth=c,o.setLineDash(n.dash||[]),o.lineDashOffset=n.dashOffset,o.beginPath(),dY(i,e,s,r),o.closePath(),o.stroke(),o.restore())}function Qmt(i,t,e){return Hp(i,{label:e,index:t,type:"pointLabel"})}class Yb extends TC{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Fs(yO(this.options)/2),e=this.width=this.maxWidth-t.width,r=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+r/2+t.top),this.drawingArea=Math.floor(Math.min(e,r)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=uo(t)&&!isNaN(t)?t:0,this.max=uo(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/yO(this.options))}generateTickLabels(t){TC.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,r)=>{const n=ka(this.options.pointLabels.callback,[e,r],this);return n||n===0?n:""}).filter((e,r)=>this.chart.getDataVisibility(r))}fit(){const t=this.options;t.display&&t.pointLabels.display?Gmt(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,r,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((r-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,r,n))}getIndexAngle(t){const e=Va/(this._pointLabels.length||1),r=this.options.startAngle||0;return Ps(t*e+lc(r))}getDistanceFromCenterForValue(t){if(On(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(On(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const r=e[t];return Qmt(this.getContext(),t,r)}}getPointPosition(t,e,r=0){const n=this.getIndexAngle(t)-yo+r;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:r,right:n,bottom:o}=this._pointLabelItems[t];return{left:e,top:r,right:n,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const r=this.ctx;r.save(),r.beginPath(),dY(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),r.closePath(),r.fillStyle=t,r.fill(),r.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:r,grid:n,border:o}=e,s=this._pointLabels.length;let a,c,f;if(e.pointLabels.display&&Kmt(this,s),n.display&&this.ticks.forEach((g,v)=>{if(v!==0||v===0&&this.min<0){c=this.getDistanceFromCenterForValue(g.value);const y=this.getContext(v),w=n.setContext(y),I=o.setContext(y);Jmt(this,w,c,s,I)}}),r.display){for(t.save(),a=s-1;a>=0;a--){const g=r.setContext(this.getPointLabelContext(a)),{color:v,lineWidth:y}=g;!y||!v||(t.lineWidth=y,t.strokeStyle=v,t.setLineDash(g.borderDash),t.lineDashOffset=g.borderDashOffset,c=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),f=this.getPointPosition(a,c),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(f.x,f.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,r=e.ticks;if(!r.display)return;const n=this.getIndexAngle(0);let o,s;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,c)=>{if(c===0&&this.min>=0&&!e.reverse)return;const f=r.setContext(this.getContext(c)),g=Zo(f.font);if(o=this.getDistanceFromCenterForValue(this.ticks[c].value),f.showLabelBackdrop){t.font=g.string,s=t.measureText(a.label).width,t.fillStyle=f.backdropColor;const v=Fs(f.backdropPadding);t.fillRect(-s/2-v.left,-o-g.size/2-v.top,s+v.width,g.size+v.height)}gv(t,a.label,0,-o,g,{color:f.color,strokeColor:f.textStrokeColor,strokeWidth:f.textStrokeWidth})}),t.restore()}drawTitle(){}}Wi(Yb,"id","radialLinear"),Wi(Yb,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:jM.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),Wi(Yb,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Wi(Yb,"descriptors",{angleLines:{_fallback:"grid"}});const XM={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Rl=Object.keys(XM);function tH(i,t){return i-t}function eH(i,t){if(On(t))return null;const e=i._adapter,{parser:r,round:n,isoWeekday:o}=i._parseOpts;let s=t;return typeof r=="function"&&(s=r(s)),uo(s)||(s=typeof r=="string"?e.parse(s,r):e.parse(s)),s===null?null:(n&&(s=n==="week"&&(v0(o)||o===!0)?e.startOf(s,"isoWeek",o):e.startOf(s,n)),+s)}function iH(i,t,e,r){const n=Rl.length;for(let o=Rl.indexOf(i);o<n-1;++o){const s=XM[Rl[o]],a=s.steps?s.steps:Number.MAX_SAFE_INTEGER;if(s.common&&Math.ceil((e-t)/(a*s.size))<=r)return Rl[o]}return Rl[n-1]}function tvt(i,t,e,r,n){for(let o=Rl.length-1;o>=Rl.indexOf(e);o--){const s=Rl[o];if(XM[s].common&&i._adapter.diff(n,r,s)>=t-1)return s}return Rl[e?Rl.indexOf(e):0]}function evt(i){for(let t=Rl.indexOf(i)+1,e=Rl.length;t<e;++t)if(XM[Rl[t]].common)return Rl[t]}function rH(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:r,hi:n}=oF(e,t),o=e[r]>=t?e[r]:e[n];i[o]=!0}}function ivt(i,t,e,r){const n=i._adapter,o=+n.startOf(t[0].value,r),s=t[t.length-1].value;let a,c;for(a=o;a<=s;a=+n.add(a,1,r))c=e[a],c>=0&&(t[c].major=!0);return t}function nH(i,t,e){const r=[],n={},o=t.length;let s,a;for(s=0;s<o;++s)a=t[s],n[a]=s,r.push({value:a,major:!1});return o===0||!e?r:ivt(i,r,n,e)}var AI;let xO=(AI=class extends BS{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const r=t.time||(t.time={}),n=this._adapter=new cpt._date(t.adapters.date);n.init(e),_w(r.displayFormats,n.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:eH(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,r=t.time.unit||"day";let{min:n,max:o,minDefined:s,maxDefined:a}=this.getUserBounds();function c(f){!s&&!isNaN(f.min)&&(n=Math.min(n,f.min)),!a&&!isNaN(f.max)&&(o=Math.max(o,f.max))}(!s||!a)&&(c(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&c(this.getMinMax(!1))),n=uo(n)&&!isNaN(n)?n:+e.startOf(Date.now(),r),o=uo(o)&&!isNaN(o)?o:+e.endOf(Date.now(),r)+1,this.min=Math.min(n,o-1),this.max=Math.max(n+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],r=t[t.length-1]),{min:e,max:r}}buildTicks(){const t=this.options,e=t.time,r=t.ticks,n=r.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const o=this.min,s=this.max,a=kdt(n,o,s);return this._unit=e.unit||(r.autoSkip?iH(e.minUnit,this.min,this.max,this._getLabelCapacity(o)):tvt(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:evt(this._unit),this.initOffsets(n),t.reverse&&a.reverse(),nH(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,r=0,n,o;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?e=1-n:e=(this.getDecimalForValue(t[1])-n)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?r=o:r=(o-this.getDecimalForValue(t[t.length-2]))/2);const s=t.length<3?.5:.25;e=ns(e,0,s),r=ns(r,0,s),this._offsets={start:e,end:r,factor:1/(e+1+r)}}_generate(){const t=this._adapter,e=this.min,r=this.max,n=this.options,o=n.time,s=o.unit||iH(o.minUnit,e,r,this._getLabelCapacity(e)),a=cn(n.ticks.stepSize,1),c=s==="week"?o.isoWeekday:!1,f=v0(c)||c===!0,g={};let v=e,y,w;if(f&&(v=+t.startOf(v,"isoWeek",c)),v=+t.startOf(v,f?"day":s),t.diff(r,e,s)>1e5*a)throw new Error(e+" and "+r+" are too far apart with stepSize of "+a+" "+s);const I=n.ticks.source==="data"&&this.getDataTimestamps();for(y=v,w=0;y<r;y=+t.add(y,a,s),w++)rH(g,y,I);return(y===r||n.bounds==="ticks"||w===1)&&rH(g,y,I),Object.keys(g).sort(tH).map(E=>+E)}getLabelForValue(t){const e=this._adapter,r=this.options.time;return r.tooltipFormat?e.format(t,r.tooltipFormat):e.format(t,r.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,o=this._unit,s=e||n[o];return this._adapter.format(t,s)}_tickFormatFunction(t,e,r,n){const o=this.options,s=o.ticks.callback;if(s)return ka(s,[t,e,r],this);const a=o.time.displayFormats,c=this._unit,f=this._majorUnit,g=c&&a[c],v=f&&a[f],y=r[e],w=f&&v&&y&&y.major;return this._adapter.format(t,n||(w?v:g))}generateTickLabels(t){let e,r,n;for(e=0,r=t.length;e<r;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,r=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+r)*e.factor)}getValueForPixel(t){const e=this._offsets,r=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+r*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,r=this.ctx.measureText(t).width,n=lc(this.isHorizontal()?e.maxRotation:e.minRotation),o=Math.cos(n),s=Math.sin(n),a=this._resolveTickFontOptions(0).size;return{w:r*o+a*s,h:r*s+a*o}}_getLabelCapacity(t){const e=this.options.time,r=e.displayFormats,n=r[e.unit]||r.millisecond,o=this._tickFormatFunction(t,0,nH(this,[t],this._majorUnit),n),s=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,r;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,r=n.length;e<r;++e)t=t.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,r;if(t.length)return t;const n=this.getLabels();for(e=0,r=n.length;e<r;++e)t.push(eH(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return SX(t.sort(tH))}},Wi(AI,"id","time"),Wi(AI,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}}),AI);function sA(i,t,e){let r=0,n=i.length-1,o,s,a,c;e?(t>=i[r].pos&&t<=i[n].pos&&({lo:r,hi:n}=_d(i,"pos",t)),{pos:o,time:a}=i[r],{pos:s,time:c}=i[n]):(t>=i[r].time&&t<=i[n].time&&({lo:r,hi:n}=_d(i,"time",t)),{time:o,pos:a}=i[r],{time:s,pos:c}=i[n]);const f=s-o;return f?a+(c-a)*(t-o)/f:a}class bO extends xO{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=sA(e,this.min),this._tableRange=sA(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:r}=this,n=[],o=[];let s,a,c,f,g;for(s=0,a=t.length;s<a;++s)f=t[s],f>=e&&f<=r&&n.push(f);if(n.length<2)return[{time:e,pos:0},{time:r,pos:1}];for(s=0,a=n.length;s<a;++s)g=n[s+1],c=n[s-1],f=n[s],Math.round((g+c)/2)!==f&&o.push({time:f,pos:s/(a-1)});return o}_generate(){const t=this.min,e=this.max;let r=super.getDataTimestamps();return(!r.includes(t)||!r.length)&&r.splice(0,0,t),(!r.includes(e)||r.length===1)&&r.push(e),r.sort((n,o)=>n-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),r=this.getLabelTimestamps();return e.length&&r.length?t=this.normalize(e.concat(r)):t=e.length?e:r,t=this._cache.all=t,t}getDecimalForValue(t){return(sA(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,r=this.getDecimalForPixel(t)/e.factor-e.end;return sA(this._table,r*this._tableRange+this._minPos,!0)}}Wi(bO,"id","timeseries"),Wi(bO,"defaults",xO.defaults);var rvt=Object.freeze({__proto__:null,CategoryScale:mO,LinearScale:vO,LogarithmicScale:_O,RadialLinearScale:Yb,TimeScale:xO,TimeSeriesScale:bO});const nvt=[upt,Ngt,kmt,rvt];dd.register(...nvt);const avt={class:"bp-card"},ovt={class:"bp-header"},svt={class:"bp-title"},lvt={class:"bp-subtitle"},uvt={class:"bp-metrics"},cvt={class:"bp-metric highlight"},hvt={class:"bp-metric-value"},dvt={class:"bp-metric"},fvt={class:"bp-metric-value"},pvt={class:"bp-metric"},gvt={class:"bp-metric-value"},mvt={class:"bp-metric traffic"},vvt={class:"bp-metric-value"},_vt={class:"bp-chart-wrap"},yvt="http://10.129.111.25:3000",xvt={__name:"BoroughPopup",props:{name:{type:String,required:!0},hour:{type:Number,required:!0},pm25:{type:Number,default:null},co:{type:Number,default:null},co2:{type:Number,default:null},vehicles:{type:Number,default:null},hasBusiestStreet:{type:Boolean,default:!1}},emits:["view-street"],setup(i,{emit:t}){const e=i,r=t,n=vo(null);let o=null;const s=vo(Array(24).fill(null)),a=y=>y==null||Number.isNaN(y)?"N/A":Number(y).toFixed(1),c=y=>y==null||Number.isNaN(y)?"N/A":Math.round(Number(y)).toLocaleString(),f=y=>{const w=y.toLowerCase().trim();return w==="city of london"?"city of london":w.replace(/london borough of /g,"").replace(/royal borough of /g,"").replace(/city of /g,"").replace(/&/g,"and").replace(/\./g,"").replace(/\s+/g," ").trim()},g=async()=>{const y=f(e.name);if(!y)return;const w=[];for(let I=0;I<24;I++){const E=`${y}_${I}`,D=`${yvt}/api/hourly?borough=${encodeURIComponent(E)}`;try{const R=await fetch(D);if(!R.ok){w.push(null);continue}const z=await R.json();w.push(z&&z.pm25_g_per_h!==void 0?Number(z.pm25_g_per_h):null)}catch(R){console.error("Failed to fetch hourly pm25 for",E,R),w.push(null)}}s.value=w},v=()=>{const y=n.value;if(!y)return;const w=Array.isArray(s.value)?s.value:[],I=Array.from({length:24},(D,R)=>R),E=I.map(D=>{const R=w[D];return R==null||Number.isNaN(R)?null:Number(R)});if(!E.some(D=>D!==null)){o&&(o.destroy(),o=null);return}o&&o.destroy(),o=new dd(y,{type:"line",data:{labels:I,datasets:[{data:E,fill:!0,tension:.35,pointRadius:0,borderWidth:1.2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"#050816",borderColor:"#a855f7",borderWidth:1,titleFont:{size:9},bodyFont:{size:9},padding:6,displayColors:!1,callbacks:{title:D=>`Hour ${D[0].label}:00`,label:D=>`PM2.5: ${a(D.parsed.y)} g/hour`}}},scales:{x:{display:!0,grid:{display:!1},ticks:{color:"#6b7280",font:{size:7},maxTicksLimit:8}},y:{display:!0,grid:{color:"rgba(148,163,253,0.12)"},ticks:{color:"#6b7280",font:{size:7},maxTicksLimit:4}}}}})};return Av(async()=>{await g(),v()}),tv(()=>e.name,async()=>{await g(),v()}),LS(()=>{o&&(o.destroy(),o=null)}),(y,w)=>(Ka(),_o("div",avt,[le("div",ovt,[w[1]||(w[1]=le("div",{class:"bp-label"},"AIR QUALITY SNAPSHOT",-1)),le("div",svt,Hn(i.name),1),le("div",lvt,"Hour "+Hn(i.hour)+":00  Backend hourly data",1)]),le("div",uvt,[le("div",cvt,[w[3]||(w[3]=le("div",{class:"bp-metric-label"},"PM2.5",-1)),le("div",hvt,[Dn(Hn(a(i.pm25))+" ",1),w[2]||(w[2]=le("span",{class:"unit"},"g/hour",-1))])]),le("div",dvt,[w[5]||(w[5]=le("div",{class:"bp-metric-label"},"CO",-1)),le("div",fvt,[Dn(Hn(a(i.co))+" ",1),w[4]||(w[4]=le("span",{class:"unit"},"g/hour",-1))])]),le("div",pvt,[w[7]||(w[7]=le("div",{class:"bp-metric-label"},"CO",-1)),le("div",gvt,[Dn(Hn(a(i.co2))+" ",1),w[6]||(w[6]=le("span",{class:"unit"},"kg/hour",-1))])]),le("div",mvt,[w[9]||(w[9]=le("div",{class:"bp-metric-label"},"Traffic Volume",-1)),le("div",vvt,[Dn(Hn(c(i.vehicles))+" ",1),w[8]||(w[8]=le("span",{class:"unit"},"vehicles/hour",-1))])])]),w[10]||(w[10]=le("div",{class:"bp-divider"},null,-1)),i.hasBusiestStreet?(Ka(),_o("button",{key:0,class:"bp-route-btn",onClick:w[0]||(w[0]=I=>r("view-street"))}," View recommended route ")):ev("",!0),w[11]||(w[11]=le("div",{class:"bp-chart-header"},[le("span",null,"24h PM2.5 trend (g/hour)"),le("span",{class:"bp-chart-hint"}," live from backend  lower is better ")],-1)),le("div",_vt,[le("canvas",{ref_key:"chartCanvas",ref:n},null,512)])]))}},bvt=Gd(xvt,[["__scopeId","data-v-8cd95344"]]);const wvt={class:"time-slider-container"},Svt={class:"time-slider-header"},Tvt={class:"time-value"},Avt={class:"tick-row"},Ivt=["onClick"],Cvt={__name:"TimeSlider",props:{modelValue:{type:Number,default:0}},emits:["update:modelValue"],setup(i,{emit:t}){const e=i,r=t,n=vo(e.modelValue),o=Array.from({length:24},(f,g)=>g);tv(()=>e.modelValue,f=>{f!==n.value&&(n.value=f)});const s=f=>String(f).padStart(2,"0"),a=Yl(()=>{const f=n.value,g=n.value+1;return`${s(f)}.00${s(g)}.00`}),c=f=>{f!==n.value&&(n.value=f,r("update:modelValue",n.value))};return(f,g)=>(Ka(),_o("div",wvt,[le("div",Svt,[g[0]||(g[0]=le("span",{class:"time-label"},"TIME SCALE",-1)),le("span",Tvt,Hn(a.value),1)]),g[1]||(g[1]=le("div",{class:"color-bar"},null,-1)),le("div",Avt,[(Ka(!0),_o(Xl,null,qB(wd(o),v=>(Ka(),_o("button",{key:v,class:md(["tick",{"is-major":v%6===0,"is-active":v===n.value}]),onClick:y=>c(v)},Hn(v),11,Ivt))),128))])]))}},Mvt=Gd(Cvt,[["__scopeId","data-v-4ec9d039"]]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wO=function(i,t){return wO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])},wO(i,t)};function Se(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");wO(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Evt=function(){function i(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}return i}(),Dvt=function(){function i(){this.browser=new Evt,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow=typeof window<"u"}return i}(),Kf=new Dvt;typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"?(Kf.wxa=!0,Kf.touchEventsSupported=!0):typeof document>"u"&&typeof self<"u"?Kf.worker=!0:!Kf.hasGlobalWindow||"Deno"in window||typeof navigator<"u"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Node.js")>-1?(Kf.node=!0,Kf.svgSupported=!0):Pvt(navigator.userAgent,Kf);function Pvt(i,t){var e=t.browser,r=i.match(/Firefox\/([\d.]+)/),n=i.match(/MSIE\s([\d.]+)/)||i.match(/Trident\/.+?rv:(([\d.]+))/),o=i.match(/Edge?\/([\d.]+)/),s=/micromessenger/i.test(i);r&&(e.firefox=!0,e.version=r[1]),n&&(e.ie=!0,e.version=n[1]),o&&(e.edge=!0,e.version=o[1],e.newEdge=+o[1].split(".")[0]>18),s&&(e.weChat=!0),t.svgSupported=typeof SVGRect<"u",t.touchEventsSupported="ontouchstart"in window&&!e.ie&&!e.edge,t.pointerEventsSupported="onpointerdown"in window&&(e.edge||e.ie&&+e.version>=11);var a=t.domSupported=typeof document<"u";if(a){var c=document.documentElement.style;t.transform3dSupported=(e.ie&&"transition"in c||e.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in c)&&!("OTransition"in c),t.transformSupported=t.transform3dSupported||e.ie&&+e.version>=9}}const Sn=Kf;var vF=12,fY="sans-serif",Ld=vF+"px "+fY,Lvt=20,Rvt=100,kvt="007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N";function Ovt(i){var t={};if(typeof JSON>"u")return t;for(var e=0;e<i.length;e++){var r=String.fromCharCode(e+32),n=(i.charCodeAt(e)-Lvt)/Rvt;t[r]=n}return t}var zvt=Ovt(kvt),vc={createCanvas:function(){return typeof document<"u"&&document.createElement("canvas")},measureText:function(){var i,t;return function(e,r){if(!i){var n=vc.createCanvas();i=n&&n.getContext("2d")}if(i)return t!==r&&(t=i.font=r||Ld),i.measureText(e);e=e||"",r=r||Ld;var o=/((?:\d+)?\.?\d*)px/.exec(r),s=o&&+o[1]||vF,a=0;if(r.indexOf("mono")>=0)a=s*e.length;else for(var c=0;c<e.length;c++){var f=zvt[e[c]];a+=f==null?s:f*s}return{width:a}}}(),loadImage:function(i,t,e){var r=new Image;return r.onload=t,r.onerror=e,r.src=i,r}},pY=xh(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(i,t){return i["[object "+t+"]"]=!0,i},{}),gY=xh(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(i,t){return i["[object "+t+"Array]"]=!0,i},{}),z0=Object.prototype.toString,YM=Array.prototype,Bvt=YM.forEach,Fvt=YM.filter,_F=YM.slice,Nvt=YM.map,aH=(function(){}).constructor,lA=aH?aH.prototype:null,yF="__proto__",Vvt=2311;function mY(){return Vvt++}function xF(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];typeof console<"u"&&console.error.apply(console,i)}function Yi(i){if(i==null||typeof i!="object")return i;var t=i,e=z0.call(i);if(e==="[object Array]"){if(!Sw(i)){t=[];for(var r=0,n=i.length;r<n;r++)t[r]=Yi(i[r])}}else if(gY[e]){if(!Sw(i)){var o=i.constructor;if(o.from)t=o.from(i);else{t=new o(i.length);for(var r=0,n=i.length;r<n;r++)t[r]=i[r]}}}else if(!pY[e]&&!Sw(i)&&!x0(i)){t={};for(var s in i)i.hasOwnProperty(s)&&s!==yF&&(t[s]=Yi(i[s]))}return t}function Er(i,t,e){if(!nr(t)||!nr(i))return e?Yi(t):i;for(var r in t)if(t.hasOwnProperty(r)&&r!==yF){var n=i[r],o=t[r];nr(o)&&nr(n)&&!Ye(o)&&!Ye(n)&&!x0(o)&&!x0(n)&&!oH(o)&&!oH(n)&&!Sw(o)&&!Sw(n)?Er(n,o,e):(e||!(r in i))&&(i[r]=Yi(t[r]))}return i}function bF(i,t){for(var e=i[0],r=1,n=i.length;r<n;r++)e=Er(e,i[r],t);return e}function Ne(i,t){if(Object.assign)Object.assign(i,t);else for(var e in t)t.hasOwnProperty(e)&&e!==yF&&(i[e]=t[e]);return i}function rr(i,t,e){for(var r=on(t),n=0,o=r.length;n<o;n++){var s=r[n];(e?t[s]!=null:i[s]==null)&&(i[s]=t[s])}return i}function Ar(i,t){if(i){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e}return-1}function Uvt(i,t){var e=i.prototype;function r(){}r.prototype=t.prototype,i.prototype=new r;for(var n in e)e.hasOwnProperty(n)&&(i.prototype[n]=e[n]);i.prototype.constructor=i,i.superClass=t}function Ao(i,t,e){if(i="prototype"in i?i.prototype:i,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames)for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var o=r[n];o!=="constructor"&&(e?t[o]!=null:i[o]==null)&&(i[o]=t[o])}else rr(i,t,e)}function Ns(i){return!i||typeof i=="string"?!1:typeof i.length=="number"}function pt(i,t,e){if(i&&t)if(i.forEach&&i.forEach===Bvt)i.forEach(t,e);else if(i.length===+i.length)for(var r=0,n=i.length;r<n;r++)t.call(e,i[r],r,i);else for(var o in i)i.hasOwnProperty(o)&&t.call(e,i[o],o,i)}function ti(i,t,e){if(!i)return[];if(!t)return wF(i);if(i.map&&i.map===Nvt)return i.map(t,e);for(var r=[],n=0,o=i.length;n<o;n++)r.push(t.call(e,i[n],n,i));return r}function xh(i,t,e,r){if(i&&t){for(var n=0,o=i.length;n<o;n++)e=t.call(r,e,i[n],n,i);return e}}function kn(i,t,e){if(!i)return[];if(!t)return wF(i);if(i.filter&&i.filter===Fvt)return i.filter(t,e);for(var r=[],n=0,o=i.length;n<o;n++)t.call(e,i[n],n,i)&&r.push(i[n]);return r}function Iv(i,t,e){if(i&&t){for(var r=0,n=i.length;r<n;r++)if(t.call(e,i[r],r,i))return i[r]}}function on(i){if(!i)return[];if(Object.keys)return Object.keys(i);var t=[];for(var e in i)i.hasOwnProperty(e)&&t.push(e);return t}function Gvt(i,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];return function(){return i.apply(t,e.concat(_F.call(arguments)))}}var Si=lA&&Xi(lA.bind)?lA.call.bind(lA.bind):Gvt;function br(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){return i.apply(this,t.concat(_F.call(arguments)))}}function Ye(i){return Array.isArray?Array.isArray(i):z0.call(i)==="[object Array]"}function Xi(i){return typeof i=="function"}function wi(i){return typeof i=="string"}function SO(i){return z0.call(i)==="[object String]"}function fn(i){return typeof i=="number"}function nr(i){var t=typeof i;return t==="function"||!!i&&t==="object"}function oH(i){return!!pY[z0.call(i)]}function zl(i){return!!gY[z0.call(i)]}function x0(i){return typeof i=="object"&&typeof i.nodeType=="number"&&typeof i.ownerDocument=="object"}function KM(i){return i.colorStops!=null}function Hvt(i){return i.image!=null}function jvt(i){return z0.call(i)==="[object RegExp]"}function Bs(i){return i!==i}function vs(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];for(var e=0,r=i.length;e<r;e++)if(i[e]!=null)return i[e]}function Ui(i,t){return i??t}function iu(i,t,e){return i??t??e}function wF(i){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return _F.apply(i,t)}function JM(i){if(typeof i=="number")return[i,i,i,i];var t=i.length;return t===2?[i[0],i[1],i[0],i[1]]:t===3?[i[0],i[1],i[2],i[1]]:i}function Vs(i,t){if(!i)throw new Error(t)}function Du(i){return i==null?null:typeof i.trim=="function"?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var vY="__ec_primitive__";function AC(i){i[vY]=!0}function Sw(i){return i[vY]}var Wvt=function(){function i(){this.data={}}return i.prototype.delete=function(t){var e=this.has(t);return e&&delete this.data[t],e},i.prototype.has=function(t){return this.data.hasOwnProperty(t)},i.prototype.get=function(t){return this.data[t]},i.prototype.set=function(t,e){return this.data[t]=e,this},i.prototype.keys=function(){return on(this.data)},i.prototype.forEach=function(t){var e=this.data;for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)},i}(),_Y=typeof Map=="function";function $vt(){return _Y?new Map:new Wvt}var Zvt=function(){function i(t){var e=Ye(t);this.data=$vt();var r=this;t instanceof i?t.each(n):t&&pt(t,n);function n(o,s){e?r.set(o,s):r.set(s,o)}}return i.prototype.hasKey=function(t){return this.data.has(t)},i.prototype.get=function(t){return this.data.get(t)},i.prototype.set=function(t,e){return this.data.set(t,e),e},i.prototype.each=function(t,e){this.data.forEach(function(r,n){t.call(e,r,n)})},i.prototype.keys=function(){var t=this.data.keys();return _Y?Array.from(t):t},i.prototype.removeKey=function(t){this.data.delete(t)},i}();function Fi(i){return new Zvt(i)}function Kw(i,t){for(var e=new i.constructor(i.length+t.length),r=0;r<i.length;r++)e[r]=i[r];for(var n=i.length,r=0;r<t.length;r++)e[r+n]=t[r];return e}function QM(i,t){var e;if(Object.create)e=Object.create(i);else{var r=function(){};r.prototype=i,e=new r}return t&&Ne(e,t),e}function yY(i){var t=i.style;t.webkitUserSelect="none",t.userSelect="none",t.webkitTapHighlightColor="rgba(0,0,0,0)",t["-webkit-touch-callout"]="none"}function Pi(i,t){return i.hasOwnProperty(t)}function ho(){}var VI=180/Math.PI;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var TO=function(i,t){return TO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])},TO(i,t)};function ba(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");TO(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Cv(i,t){return i==null&&(i=0),t==null&&(t=0),[i,t]}function ll(i,t){return i[0]=t[0],i[1]=t[1],i}function Ad(i){return[i[0],i[1]]}function SF(i,t,e){return i[0]=t,i[1]=e,i}function sH(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function AO(i,t,e,r){return i[0]=t[0]+e[0]*r,i[1]=t[1]+e[1]*r,i}function jm(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i}function IO(i){return Math.sqrt(qvt(i))}function qvt(i){return i[0]*i[0]+i[1]*i[1]}function UI(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i}function B0(i,t){var e=IO(t);return e===0?(i[0]=0,i[1]=0):(i[0]=t[0]/e,i[1]=t[1]/e),i}function CO(i,t){return Math.sqrt((i[0]-t[0])*(i[0]-t[0])+(i[1]-t[1])*(i[1]-t[1]))}var dp=CO;function Xvt(i,t){return(i[0]-t[0])*(i[0]-t[0])+(i[1]-t[1])*(i[1]-t[1])}var nv=Xvt;function GI(i,t,e,r){return i[0]=t[0]+r*(e[0]-t[0]),i[1]=t[1]+r*(e[1]-t[1]),i}function fo(i,t,e){var r=t[0],n=t[1];return i[0]=e[0]*r+e[2]*n+e[4],i[1]=e[1]*r+e[3]*n+e[5],i}function fp(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i}function pp(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i}var vy=function(){function i(t,e){this.target=t,this.topTarget=e&&e.topTarget}return i}(),Yvt=function(){function i(t){this.handler=t,t.on("mousedown",this._dragStart,this),t.on("mousemove",this._drag,this),t.on("mouseup",this._dragEnd,this)}return i.prototype._dragStart=function(t){for(var e=t.target;e&&!e.draggable;)e=e.parent||e.__hostTarget;e&&(this._draggingTarget=e,e.dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.handler.dispatchToElement(new vy(e,t),"dragstart",t.event))},i.prototype._drag=function(t){var e=this._draggingTarget;if(e){var r=t.offsetX,n=t.offsetY,o=r-this._x,s=n-this._y;this._x=r,this._y=n,e.drift(o,s,t),this.handler.dispatchToElement(new vy(e,t),"drag",t.event);var a=this.handler.findHover(r,n,e).target,c=this._dropTarget;this._dropTarget=a,e!==a&&(c&&a!==c&&this.handler.dispatchToElement(new vy(c,t),"dragleave",t.event),a&&a!==c&&this.handler.dispatchToElement(new vy(a,t),"dragenter",t.event))}},i.prototype._dragEnd=function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new vy(e,t),"dragend",t.event),this._dropTarget&&this.handler.dispatchToElement(new vy(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null},i}();const Kvt=Yvt;var Jvt=function(){function i(t){t&&(this._$eventProcessor=t)}return i.prototype.on=function(t,e,r,n){this._$handlers||(this._$handlers={});var o=this._$handlers;if(typeof e=="function"&&(n=r,r=e,e=null),!r||!t)return this;var s=this._$eventProcessor;e!=null&&s&&s.normalizeQuery&&(e=s.normalizeQuery(e)),o[t]||(o[t]=[]);for(var a=0;a<o[t].length;a++)if(o[t][a].h===r)return this;var c={h:r,query:e,ctx:n||this,callAtLast:r.zrEventfulCallAtLast},f=o[t].length-1,g=o[t][f];return g&&g.callAtLast?o[t].splice(f,0,c):o[t].push(c),this},i.prototype.isSilent=function(t){var e=this._$handlers;return!e||!e[t]||!e[t].length},i.prototype.off=function(t,e){var r=this._$handlers;if(!r)return this;if(!t)return this._$handlers={},this;if(e){if(r[t]){for(var n=[],o=0,s=r[t].length;o<s;o++)r[t][o].h!==e&&n.push(r[t][o]);r[t]=n}r[t]&&r[t].length===0&&delete r[t]}else delete r[t];return this},i.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!this._$handlers)return this;var n=this._$handlers[t],o=this._$eventProcessor;if(n)for(var s=e.length,a=n.length,c=0;c<a;c++){var f=n[c];if(!(o&&o.filter&&f.query!=null&&!o.filter(t,f.query)))switch(s){case 0:f.h.call(f.ctx);break;case 1:f.h.call(f.ctx,e[0]);break;case 2:f.h.call(f.ctx,e[0],e[1]);break;default:f.h.apply(f.ctx,e);break}}return o&&o.afterTrigger&&o.afterTrigger(t),this},i.prototype.triggerWithContext=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!this._$handlers)return this;var n=this._$handlers[t],o=this._$eventProcessor;if(n)for(var s=e.length,a=e[s-1],c=n.length,f=0;f<c;f++){var g=n[f];if(!(o&&o.filter&&g.query!=null&&!o.filter(t,g.query)))switch(s){case 0:g.h.call(a);break;case 1:g.h.call(a,e[0]);break;case 2:g.h.call(a,e[0],e[1]);break;default:g.h.apply(a,e.slice(1,s-1));break}}return o&&o.afterTrigger&&o.afterTrigger(t),this},i}();const Bu=Jvt;var Qvt=Math.log(2);function MO(i,t,e,r,n,o){var s=r+"-"+n,a=i.length;if(o.hasOwnProperty(s))return o[s];if(t===1){var c=Math.round(Math.log((1<<a)-1&~n)/Qvt);return i[e][c]}for(var f=r|1<<e,g=e+1;r&1<<g;)g++;for(var v=0,y=0,w=0;y<a;y++){var I=1<<y;I&n||(v+=(w%2?-1:1)*i[e][y]*MO(i,t-1,g,f,n|I,o),w++)}return o[s]=v,v}function lH(i,t){var e=[[i[0],i[1],1,0,0,0,-t[0]*i[0],-t[0]*i[1]],[0,0,0,i[0],i[1],1,-t[1]*i[0],-t[1]*i[1]],[i[2],i[3],1,0,0,0,-t[2]*i[2],-t[2]*i[3]],[0,0,0,i[2],i[3],1,-t[3]*i[2],-t[3]*i[3]],[i[4],i[5],1,0,0,0,-t[4]*i[4],-t[4]*i[5]],[0,0,0,i[4],i[5],1,-t[5]*i[4],-t[5]*i[5]],[i[6],i[7],1,0,0,0,-t[6]*i[6],-t[6]*i[7]],[0,0,0,i[6],i[7],1,-t[7]*i[6],-t[7]*i[7]]],r={},n=MO(e,8,0,0,0,r);if(n!==0){for(var o=[],s=0;s<8;s++)for(var a=0;a<8;a++)o[a]==null&&(o[a]=0),o[a]+=((s+a)%2?-1:1)*MO(e,7,s===0?1:0,1<<s,1<<a,r)/n*t[s];return function(c,f,g){var v=f*o[6]+g*o[7]+1;c[0]=(f*o[0]+g*o[1]+o[2])/v,c[1]=(f*o[3]+g*o[4]+o[5])/v}}}var IC="___zrEVENTSAVED",pL=[];function t_t(i,t,e,r,n){return EO(pL,t,r,n,!0)&&EO(i,e,pL[0],pL[1])}function e_t(i,t){i&&e(i),t&&e(t);function e(r){var n=r[IC];n&&(n.clearMarkers&&n.clearMarkers(),delete r[IC])}}function EO(i,t,e,r,n){if(t.getBoundingClientRect&&Sn.domSupported&&!xY(t)){var o=t[IC]||(t[IC]={}),s=i_t(t,o),a=r_t(s,o,n);if(a)return a(i,e,r),!0}return!1}function i_t(i,t){var e=t.markers;if(e)return e;e=t.markers=[];for(var r=["left","right"],n=["top","bottom"],o=0;o<4;o++){var s=document.createElement("div"),a=s.style,c=o%2,f=(o>>1)%2;a.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",r[c]+":0",n[f]+":0",r[1-c]+":auto",n[1-f]+":auto",""].join("!important;"),i.appendChild(s),e.push(s)}return t.clearMarkers=function(){pt(e,function(g){g.parentNode&&g.parentNode.removeChild(g)})},e}function r_t(i,t,e){for(var r=e?"invTrans":"trans",n=t[r],o=t.srcCoords,s=[],a=[],c=!0,f=0;f<4;f++){var g=i[f].getBoundingClientRect(),v=2*f,y=g.left,w=g.top;s.push(y,w),c=c&&o&&y===o[v]&&w===o[v+1],a.push(i[f].offsetLeft,i[f].offsetTop)}return c&&n?n:(t.srcCoords=s,t[r]=e?lH(a,s):lH(s,a))}function xY(i){return i.nodeName.toUpperCase()==="CANVAS"}var n_t=/([&<>"'])/g,a_t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Rs(i){return i==null?"":(i+"").replace(n_t,function(t,e){return a_t[e]})}var o_t=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,gL=[],s_t=Sn.browser.firefox&&+Sn.browser.version.split(".")[0]<39;function DO(i,t,e,r){return e=e||{},r?uH(i,t,e):s_t&&t.layerX!=null&&t.layerX!==t.offsetX?(e.zrX=t.layerX,e.zrY=t.layerY):t.offsetX!=null?(e.zrX=t.offsetX,e.zrY=t.offsetY):uH(i,t,e),e}function uH(i,t,e){if(Sn.domSupported&&i.getBoundingClientRect){var r=t.clientX,n=t.clientY;if(xY(i)){var o=i.getBoundingClientRect();e.zrX=r-o.left,e.zrY=n-o.top;return}else if(EO(gL,i,r,n)){e.zrX=gL[0],e.zrY=gL[1];return}}e.zrX=e.zrY=0}function TF(i){return i||window.event}function wu(i,t,e){if(t=TF(t),t.zrX!=null)return t;var r=t.type,n=r&&r.indexOf("touch")>=0;if(n){var s=r!=="touchend"?t.targetTouches[0]:t.changedTouches[0];s&&DO(i,s,t,e)}else{DO(i,t,t,e);var o=l_t(t);t.zrDelta=o?o/120:-(t.detail||0)/3}var a=t.button;return t.which==null&&a!==void 0&&o_t.test(t.type)&&(t.which=a&1?1:a&2?3:a&4?2:0),t}function l_t(i){var t=i.wheelDelta;if(t)return t;var e=i.deltaX,r=i.deltaY;if(e==null||r==null)return t;var n=Math.abs(r!==0?r:e),o=r>0?-1:r<0?1:e>0?-1:1;return 3*n*o}function PO(i,t,e,r){i.addEventListener(t,e,r)}function u_t(i,t,e,r){i.removeEventListener(t,e,r)}var Rd=function(i){i.preventDefault(),i.stopPropagation(),i.cancelBubble=!0};function cH(i){return i.which===2||i.which===3}var c_t=function(){function i(){this._track=[]}return i.prototype.recognize=function(t,e,r){return this._doTrack(t,e,r),this._recognize(t)},i.prototype.clear=function(){return this._track.length=0,this},i.prototype._doTrack=function(t,e,r){var n=t.touches;if(n){for(var o={points:[],touches:[],target:e,event:t},s=0,a=n.length;s<a;s++){var c=n[s],f=DO(r,c,{});o.points.push([f.zrX,f.zrY]),o.touches.push(c)}this._track.push(o)}},i.prototype._recognize=function(t){for(var e in mL)if(mL.hasOwnProperty(e)){var r=mL[e](this._track,t);if(r)return r}},i}();function hH(i){var t=i[1][0]-i[0][0],e=i[1][1]-i[0][1];return Math.sqrt(t*t+e*e)}function h_t(i){return[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2]}var mL={pinch:function(i,t){var e=i.length;if(e){var r=(i[e-1]||{}).points,n=(i[e-2]||{}).points||r;if(n&&n.length>1&&r&&r.length>1){var o=hH(r)/hH(n);!isFinite(o)&&(o=1),t.pinchScale=o;var s=h_t(r);return t.pinchX=s[0],t.pinchY=s[1],{type:"pinch",target:i[0].target,event:t}}}}};function as(){return[1,0,0,1,0,0]}function tE(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i}function eE(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function ph(i,t,e){var r=t[0]*e[0]+t[2]*e[1],n=t[1]*e[0]+t[3]*e[1],o=t[0]*e[2]+t[2]*e[3],s=t[1]*e[2]+t[3]*e[3],a=t[0]*e[4]+t[2]*e[5]+t[4],c=t[1]*e[4]+t[3]*e[5]+t[5];return i[0]=r,i[1]=n,i[2]=o,i[3]=s,i[4]=a,i[5]=c,i}function bh(i,t,e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4]+e[0],i[5]=t[5]+e[1],i}function jp(i,t,e,r){r===void 0&&(r=[0,0]);var n=t[0],o=t[2],s=t[4],a=t[1],c=t[3],f=t[5],g=Math.sin(e),v=Math.cos(e);return i[0]=n*v+a*g,i[1]=-n*g+a*v,i[2]=o*v+c*g,i[3]=-o*g+v*c,i[4]=v*(s-r[0])+g*(f-r[1])+r[0],i[5]=v*(f-r[1])-g*(s-r[0])+r[1],i}function AF(i,t,e){var r=e[0],n=e[1];return i[0]=t[0]*r,i[1]=t[1]*n,i[2]=t[2]*r,i[3]=t[3]*n,i[4]=t[4]*r,i[5]=t[5]*n,i}function _c(i,t){var e=t[0],r=t[2],n=t[4],o=t[1],s=t[3],a=t[5],c=e*s-o*r;return c?(c=1/c,i[0]=s*c,i[1]=-o*c,i[2]=-r*c,i[3]=e*c,i[4]=(r*a-s*n)*c,i[5]=(o*n-e*a)*c,i):null}function d_t(i){var t=as();return eE(t,i),t}var f_t=function(){function i(t,e){this.x=t||0,this.y=e||0}return i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.equal=function(t){return t.x===this.x&&t.y===this.y},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.scale=function(t){this.x*=t,this.y*=t},i.prototype.scaleAndAdd=function(t,e){this.x+=t.x*e,this.y+=t.y*e},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.len();return this.x/=t,this.y/=t,this},i.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},i.prototype.distanceSquare=function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.transform=function(t){if(t){var e=this.x,r=this.y;return this.x=t[0]*e+t[2]*r+t[4],this.y=t[1]*e+t[3]*r+t[5],this}},i.prototype.toArray=function(t){return t[0]=this.x,t[1]=this.y,t},i.prototype.fromArray=function(t){this.x=t[0],this.y=t[1]},i.set=function(t,e,r){t.x=e,t.y=r},i.copy=function(t,e){t.x=e.x,t.y=e.y},i.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.lenSquare=function(t){return t.x*t.x+t.y*t.y},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.add=function(t,e,r){t.x=e.x+r.x,t.y=e.y+r.y},i.sub=function(t,e,r){t.x=e.x-r.x,t.y=e.y-r.y},i.scale=function(t,e,r){t.x=e.x*r,t.y=e.y*r},i.scaleAndAdd=function(t,e,r,n){t.x=e.x+r.x*n,t.y=e.y+r.y*n},i.lerp=function(t,e,r,n){var o=1-n;t.x=o*e.x+n*r.x,t.y=o*e.y+n*r.y},i}();const er=f_t;var Wm=Math.min,Xy=Math.max,LO=Math.abs,dH=["x","y"],p_t=["width","height"],im=new er,rm=new er,nm=new er,am=new er,ql=bY(),Kb=ql.minTv,RO=ql.maxTv,Tw=[0,0],IF=function(){function i(t,e,r,n){i.set(this,t,e,r,n)}return i.set=function(t,e,r,n,o){return n<0&&(e=e+n,n=-n),o<0&&(r=r+o,o=-o),t.x=e,t.y=r,t.width=n,t.height=o,t},i.prototype.union=function(t){var e=Wm(t.x,this.x),r=Wm(t.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=Xy(t.x+t.width,this.x+this.width)-e:this.width=t.width,isFinite(this.y)&&isFinite(this.height)?this.height=Xy(t.y+t.height,this.y+this.height)-r:this.height=t.height,this.x=e,this.y=r},i.prototype.applyTransform=function(t){i.applyTransform(this,this,t)},i.prototype.calculateTransform=function(t){var e=this,r=t.width/e.width,n=t.height/e.height,o=as();return bh(o,o,[-e.x,-e.y]),AF(o,o,[r,n]),bh(o,o,[t.x,t.y]),o},i.prototype.intersect=function(t,e,r){return i.intersect(this,t,e,r)},i.intersect=function(t,e,r,n){r&&er.set(r,0,0);var o=n&&n.outIntersectRect||null,s=n&&n.clamp;if(o&&(o.x=o.y=o.width=o.height=NaN),!t||!e)return!1;t instanceof i||(t=i.set(g_t,t.x,t.y,t.width,t.height)),e instanceof i||(e=i.set(m_t,e.x,e.y,e.width,e.height));var a=!!r;ql.reset(n,a);var c=ql.touchThreshold,f=t.x+c,g=t.x+t.width-c,v=t.y+c,y=t.y+t.height-c,w=e.x+c,I=e.x+e.width-c,E=e.y+c,D=e.y+e.height-c;if(f>g||v>y||w>I||E>D)return!1;var R=!(g<w||I<f||y<E||D<v);return(a||o)&&(Tw[0]=1/0,Tw[1]=0,fH(f,g,w,I,0,a,o,s),fH(v,y,E,D,1,a,o,s),a&&er.copy(r,R?ql.useDir?ql.dirMinTv:Kb:RO)),R},i.contain=function(t,e,r){return e>=t.x&&e<=t.x+t.width&&r>=t.y&&r<=t.y+t.height},i.prototype.contain=function(t,e){return i.contain(this,t,e)},i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.copy=function(t){i.copy(this,t)},i.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},i.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},i.prototype.isZero=function(){return this.width===0||this.height===0},i.create=function(t){return new i(t.x,t.y,t.width,t.height)},i.copy=function(t,e){return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t},i.applyTransform=function(t,e,r){if(!r){t!==e&&i.copy(t,e);return}if(r[1]<1e-5&&r[1]>-1e-5&&r[2]<1e-5&&r[2]>-1e-5){var n=r[0],o=r[3],s=r[4],a=r[5];t.x=e.x*n+s,t.y=e.y*o+a,t.width=e.width*n,t.height=e.height*o,t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height);return}im.x=nm.x=e.x,im.y=am.y=e.y,rm.x=am.x=e.x+e.width,rm.y=nm.y=e.y+e.height,im.transform(r),am.transform(r),rm.transform(r),nm.transform(r),t.x=Wm(im.x,rm.x,nm.x,am.x),t.y=Wm(im.y,rm.y,nm.y,am.y);var c=Xy(im.x,rm.x,nm.x,am.x),f=Xy(im.y,rm.y,nm.y,am.y);t.width=c-t.x,t.height=f-t.y},i}(),g_t=new IF(0,0,0,0),m_t=new IF(0,0,0,0);function fH(i,t,e,r,n,o,s,a){var c=LO(t-e),f=LO(r-i),g=Wm(c,f),v=dH[n],y=dH[1-n],w=p_t[n];t<e||r<i?c<f?(o&&(RO[v]=-c),a&&(s[v]=t,s[w]=0)):(o&&(RO[v]=f),a&&(s[v]=i,s[w]=0)):(s&&(s[v]=Xy(i,e),s[w]=Wm(t,r)-s[v]),o&&(g<Tw[0]||ql.useDir)&&(Tw[0]=Wm(g,Tw[0]),(c<f||!ql.bidirectional)&&(Kb[v]=c,Kb[y]=0,ql.useDir&&ql.calcDirMTV()),(c>=f||!ql.bidirectional)&&(Kb[v]=-f,Kb[y]=0,ql.useDir&&ql.calcDirMTV())))}function bY(){var i=0,t=new er,e=new er,r={minTv:new er,maxTv:new er,useDir:!1,dirMinTv:new er,touchThreshold:0,bidirectional:!0,negativeSize:!1,reset:function(o,s){r.touchThreshold=0,o&&o.touchThreshold!=null&&(r.touchThreshold=Xy(0,o.touchThreshold)),r.negativeSize=!1,s&&(r.minTv.set(1/0,1/0),r.maxTv.set(0,0),r.useDir=!1,o&&o.direction!=null&&(r.useDir=!0,r.dirMinTv.copy(r.minTv),e.copy(r.minTv),i=o.direction,r.bidirectional=o.bidirectional==null||!!o.bidirectional,r.bidirectional||t.set(Math.cos(i),Math.sin(i))))},calcDirMTV:function(){var o=r.minTv,s=r.dirMinTv,a=o.y*o.y+o.x*o.x,c=Math.sin(i),f=Math.cos(i),g=c*o.y+f*o.x;if(n(g)){n(o.x)&&n(o.y)&&s.set(0,0);return}if(e.x=a*f/g,e.y=a*c/g,n(e.x)&&n(e.y)){s.set(0,0);return}(r.bidirectional||t.dot(e)>0)&&e.len()<s.len()&&s.copy(e)}};function n(o){return LO(o)<1e-10}return r}const sr=IF;var wY="silent";function v_t(i,t,e){return{type:i,event:e,target:t.target,topTarget:t.topTarget,cancelBubble:!1,offsetX:e.zrX,offsetY:e.zrY,gestureEvent:e.gestureEvent,pinchX:e.pinchX,pinchY:e.pinchY,pinchScale:e.pinchScale,wheelDelta:e.zrDelta,zrByTouch:e.zrByTouch,which:e.which,stop:__t}}function __t(){Rd(this.event)}var y_t=function(i){ba(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.handler=null,e}return t.prototype.dispose=function(){},t.prototype.setCursor=function(){},t}(Bu),db=function(){function i(t,e){this.x=t,this.y=e}return i}(),x_t=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],vL=new sr(0,0,0,0),SY=function(i){ba(t,i);function t(e,r,n,o,s){var a=i.call(this)||this;return a._hovered=new db(0,0),a.storage=e,a.painter=r,a.painterRoot=o,a._pointerSize=s,n=n||new y_t,a.proxy=null,a.setHandlerProxy(n),a._draggingMgr=new Kvt(a),a}return t.prototype.setHandlerProxy=function(e){this.proxy&&this.proxy.dispose(),e&&(pt(x_t,function(r){e.on&&e.on(r,this[r],this)},this),e.handler=this),this.proxy=e},t.prototype.mousemove=function(e){var r=e.zrX,n=e.zrY,o=TY(this,r,n),s=this._hovered,a=s.target;a&&!a.__zr&&(s=this.findHover(s.x,s.y),a=s.target);var c=this._hovered=o?new db(r,n):this.findHover(r,n),f=c.target,g=this.proxy;g.setCursor&&g.setCursor(f?f.cursor:"default"),a&&f!==a&&this.dispatchToElement(s,"mouseout",e),this.dispatchToElement(c,"mousemove",e),f&&f!==a&&this.dispatchToElement(c,"mouseover",e)},t.prototype.mouseout=function(e){var r=e.zrEventControl;r!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",e),r!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:e})},t.prototype.resize=function(){this._hovered=new db(0,0)},t.prototype.dispatch=function(e,r){var n=this[e];n&&n.call(this,r)},t.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},t.prototype.setCursorStyle=function(e){var r=this.proxy;r.setCursor&&r.setCursor(e)},t.prototype.dispatchToElement=function(e,r,n){e=e||{};var o=e.target;if(!(o&&o.silent)){for(var s="on"+r,a=v_t(r,e,n);o&&(o[s]&&(a.cancelBubble=!!o[s].call(o,a)),o.trigger(r,a),o=o.__hostTarget?o.__hostTarget:o.parent,!a.cancelBubble););a.cancelBubble||(this.trigger(r,a),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(c){typeof c[s]=="function"&&c[s].call(c,a),c.trigger&&c.trigger(r,a)}))}},t.prototype.findHover=function(e,r,n){var o=this.storage.getDisplayList(),s=new db(e,r);if(pH(o,s,e,r,n),this._pointerSize&&!s.target){for(var a=[],c=this._pointerSize,f=c/2,g=new sr(e-f,r-f,c,c),v=o.length-1;v>=0;v--){var y=o[v];y!==n&&!y.ignore&&!y.ignoreCoarsePointer&&(!y.parent||!y.parent.ignoreCoarsePointer)&&(vL.copy(y.getBoundingRect()),y.transform&&vL.applyTransform(y.transform),vL.intersect(g)&&a.push(y))}if(a.length)for(var w=4,I=Math.PI/12,E=Math.PI*2,D=0;D<f;D+=w)for(var R=0;R<E;R+=I){var z=e+D*Math.cos(R),N=r+D*Math.sin(R);if(pH(a,s,z,N,n),s.target)return s}}return s},t.prototype.processGesture=function(e,r){this._gestureMgr||(this._gestureMgr=new c_t);var n=this._gestureMgr;r==="start"&&n.clear();var o=n.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);if(r==="end"&&n.clear(),o){var s=o.type;e.gestureEvent=s;var a=new db;a.target=o.target,this.dispatchToElement(a,s,o.event)}},t}(Bu);pt(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(i){SY.prototype[i]=function(t){var e=t.zrX,r=t.zrY,n=TY(this,e,r),o,s;if((i!=="mouseup"||!n)&&(o=this.findHover(e,r),s=o.target),i==="mousedown")this._downEl=s,this._downPoint=[t.zrX,t.zrY],this._upEl=s;else if(i==="mouseup")this._upEl=s;else if(i==="click"){if(this._downEl!==this._upEl||!this._downPoint||dp(this._downPoint,[t.zrX,t.zrY])>4)return;this._downPoint=null}this.dispatchToElement(o,i,t)}});function b_t(i,t,e){if(i[i.rectHover?"rectContain":"contain"](t,e)){for(var r=i,n=void 0,o=!1;r;){if(r.ignoreClip&&(o=!0),!o){var s=r.getClipPath();if(s&&!s.contain(t,e))return!1}r.silent&&(n=!0);var a=r.__hostTarget;r=a?r.ignoreHostSilent?null:a:r.parent}return n?wY:!0}return!1}function pH(i,t,e,r,n){for(var o=i.length-1;o>=0;o--){var s=i[o],a=void 0;if(s!==n&&!s.ignore&&(a=b_t(s,e,r))&&(!t.topTarget&&(t.topTarget=s),a!==wY)){t.target=s;break}}}function TY(i,t,e){var r=i.painter;return t<0||t>r.getWidth()||e<0||e>r.getHeight()}const w_t=SY;var AY=32,fb=7;function S_t(i){for(var t=0;i>=AY;)t|=i&1,i>>=1;return i+t}function gH(i,t,e,r){var n=t+1;if(n===e)return 1;if(r(i[n++],i[t])<0){for(;n<e&&r(i[n],i[n-1])<0;)n++;T_t(i,t,n)}else for(;n<e&&r(i[n],i[n-1])>=0;)n++;return n-t}function T_t(i,t,e){for(e--;t<e;){var r=i[t];i[t++]=i[e],i[e--]=r}}function mH(i,t,e,r,n){for(r===t&&r++;r<e;r++){for(var o=i[r],s=t,a=r,c;s<a;)c=s+a>>>1,n(o,i[c])<0?a=c:s=c+1;var f=r-s;switch(f){case 3:i[s+3]=i[s+2];case 2:i[s+2]=i[s+1];case 1:i[s+1]=i[s];break;default:for(;f>0;)i[s+f]=i[s+f-1],f--}i[s]=o}}function _L(i,t,e,r,n,o){var s=0,a=0,c=1;if(o(i,t[e+n])>0){for(a=r-n;c<a&&o(i,t[e+n+c])>0;)s=c,c=(c<<1)+1,c<=0&&(c=a);c>a&&(c=a),s+=n,c+=n}else{for(a=n+1;c<a&&o(i,t[e+n-c])<=0;)s=c,c=(c<<1)+1,c<=0&&(c=a);c>a&&(c=a);var f=s;s=n-c,c=n-f}for(s++;s<c;){var g=s+(c-s>>>1);o(i,t[e+g])>0?s=g+1:c=g}return c}function yL(i,t,e,r,n,o){var s=0,a=0,c=1;if(o(i,t[e+n])<0){for(a=n+1;c<a&&o(i,t[e+n-c])<0;)s=c,c=(c<<1)+1,c<=0&&(c=a);c>a&&(c=a);var f=s;s=n-c,c=n-f}else{for(a=r-n;c<a&&o(i,t[e+n+c])>=0;)s=c,c=(c<<1)+1,c<=0&&(c=a);c>a&&(c=a),s+=n,c+=n}for(s++;s<c;){var g=s+(c-s>>>1);o(i,t[e+g])<0?c=g:s=g+1}return c}function A_t(i,t){var e=fb,r,n,o=0,s=[];r=[],n=[];function a(w,I){r[o]=w,n[o]=I,o+=1}function c(){for(;o>1;){var w=o-2;if(w>=1&&n[w-1]<=n[w]+n[w+1]||w>=2&&n[w-2]<=n[w]+n[w-1])n[w-1]<n[w+1]&&w--;else if(n[w]>n[w+1])break;g(w)}}function f(){for(;o>1;){var w=o-2;w>0&&n[w-1]<n[w+1]&&w--,g(w)}}function g(w){var I=r[w],E=n[w],D=r[w+1],R=n[w+1];n[w]=E+R,w===o-3&&(r[w+1]=r[w+2],n[w+1]=n[w+2]),o--;var z=yL(i[D],i,I,E,0,t);I+=z,E-=z,E!==0&&(R=_L(i[I+E-1],i,D,R,R-1,t),R!==0&&(E<=R?v(I,E,D,R):y(I,E,D,R)))}function v(w,I,E,D){var R=0;for(R=0;R<I;R++)s[R]=i[w+R];var z=0,N=E,H=w;if(i[H++]=i[N++],--D===0){for(R=0;R<I;R++)i[H+R]=s[z+R];return}if(I===1){for(R=0;R<D;R++)i[H+R]=i[N+R];i[H+D]=s[z];return}for(var q=e,Y,J,it;;){Y=0,J=0,it=!1;do if(t(i[N],s[z])<0){if(i[H++]=i[N++],J++,Y=0,--D===0){it=!0;break}}else if(i[H++]=s[z++],Y++,J=0,--I===1){it=!0;break}while((Y|J)<q);if(it)break;do{if(Y=yL(i[N],s,z,I,0,t),Y!==0){for(R=0;R<Y;R++)i[H+R]=s[z+R];if(H+=Y,z+=Y,I-=Y,I<=1){it=!0;break}}if(i[H++]=i[N++],--D===0){it=!0;break}if(J=_L(s[z],i,N,D,0,t),J!==0){for(R=0;R<J;R++)i[H+R]=i[N+R];if(H+=J,N+=J,D-=J,D===0){it=!0;break}}if(i[H++]=s[z++],--I===1){it=!0;break}q--}while(Y>=fb||J>=fb);if(it)break;q<0&&(q=0),q+=2}if(e=q,e<1&&(e=1),I===1){for(R=0;R<D;R++)i[H+R]=i[N+R];i[H+D]=s[z]}else{if(I===0)throw new Error;for(R=0;R<I;R++)i[H+R]=s[z+R]}}function y(w,I,E,D){var R=0;for(R=0;R<D;R++)s[R]=i[E+R];var z=w+I-1,N=D-1,H=E+D-1,q=0,Y=0;if(i[H--]=i[z--],--I===0){for(q=H-(D-1),R=0;R<D;R++)i[q+R]=s[R];return}if(D===1){for(H-=I,z-=I,Y=H+1,q=z+1,R=I-1;R>=0;R--)i[Y+R]=i[q+R];i[H]=s[N];return}for(var J=e;;){var it=0,at=0,ut=!1;do if(t(s[N],i[z])<0){if(i[H--]=i[z--],it++,at=0,--I===0){ut=!0;break}}else if(i[H--]=s[N--],at++,it=0,--D===1){ut=!0;break}while((it|at)<J);if(ut)break;do{if(it=I-yL(s[N],i,w,I,I-1,t),it!==0){for(H-=it,z-=it,I-=it,Y=H+1,q=z+1,R=it-1;R>=0;R--)i[Y+R]=i[q+R];if(I===0){ut=!0;break}}if(i[H--]=s[N--],--D===1){ut=!0;break}if(at=D-_L(i[z],s,0,D,D-1,t),at!==0){for(H-=at,N-=at,D-=at,Y=H+1,q=N+1,R=0;R<at;R++)i[Y+R]=s[q+R];if(D<=1){ut=!0;break}}if(i[H--]=i[z--],--I===0){ut=!0;break}J--}while(it>=fb||at>=fb);if(ut)break;J<0&&(J=0),J+=2}if(e=J,e<1&&(e=1),D===1){for(H-=I,z-=I,Y=H+1,q=z+1,R=I-1;R>=0;R--)i[Y+R]=i[q+R];i[H]=s[N]}else{if(D===0)throw new Error;for(q=H-(D-1),R=0;R<D;R++)i[q+R]=s[R]}}return{mergeRuns:c,forceMergeRuns:f,pushRun:a}}function HI(i,t,e,r){e||(e=0),r||(r=i.length);var n=r-e;if(!(n<2)){var o=0;if(n<AY){o=gH(i,e,r,t),mH(i,e,r,e+o,t);return}var s=A_t(i,t),a=S_t(n);do{if(o=gH(i,e,r,t),o<a){var c=n;c>a&&(c=a),mH(i,e,e+c,e+o,t),o=c}s.pushRun(e,o),s.mergeRuns(),n-=o,e+=o}while(n!==0);s.forceMergeRuns()}}var Kl=1,Jb=2,Wy=4,vH=!1;function xL(){vH||(vH=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function _H(i,t){return i.zlevel===t.zlevel?i.z===t.z?i.z2-t.z2:i.z-t.z:i.zlevel-t.zlevel}var I_t=function(){function i(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=_H}return i.prototype.traverse=function(t,e){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(t,e)},i.prototype.getDisplayList=function(t,e){e=e||!1;var r=this._displayList;return(t||!r.length)&&this.updateDisplayList(e),r},i.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,r=this._displayList,n=0,o=e.length;n<o;n++)this._updateAndAddDisplayable(e[n],null,t);r.length=this._displayListLen,HI(r,_H)},i.prototype._updateAndAddDisplayable=function(t,e,r){if(!(t.ignore&&!r)){t.beforeUpdate(),t.update(),t.afterUpdate();var n=t.getClipPath(),o=e&&e.length,s=0,a=t.__clipPaths;if(!t.ignoreClip&&(o||n)){if(a||(a=t.__clipPaths=[]),o)for(var c=0;c<e.length;c++)a[s++]=e[c];for(var f=n,g=t;f;)f.parent=g,f.updateTransform(),a[s++]=f,g=f,f=f.getClipPath()}if(a&&(a.length=s),t.childrenRef){for(var v=t.childrenRef(),y=0;y<v.length;y++){var w=v[y];t.__dirty&&(w.__dirty|=Kl),this._updateAndAddDisplayable(w,a,r)}t.__dirty=0}else{var I=t;isNaN(I.z)&&(xL(),I.z=0),isNaN(I.z2)&&(xL(),I.z2=0),isNaN(I.zlevel)&&(xL(),I.zlevel=0),this._displayList[this._displayListLen++]=I}var E=t.getDecalElement&&t.getDecalElement();E&&this._updateAndAddDisplayable(E,a,r);var D=t.getTextGuideLine();D&&this._updateAndAddDisplayable(D,a,r);var R=t.getTextContent();R&&this._updateAndAddDisplayable(R,a,r)}},i.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},i.prototype.delRoot=function(t){if(t instanceof Array){for(var e=0,r=t.length;e<r;e++)this.delRoot(t[e]);return}var n=Ar(this._roots,t);n>=0&&this._roots.splice(n,1)},i.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},i.prototype.getRoots=function(){return this._roots},i.prototype.dispose=function(){this._displayList=null,this._roots=null},i}();const C_t=I_t;var IY;IY=Sn.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(i){return setTimeout(i,16)};const kO=IY;var jI={linear:function(i){return i},quadraticIn:function(i){return i*i},quadraticOut:function(i){return i*(2-i)},quadraticInOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)},cubicIn:function(i){return i*i*i},cubicOut:function(i){return--i*i*i+1},cubicInOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)},quarticIn:function(i){return i*i*i*i},quarticOut:function(i){return 1- --i*i*i*i},quarticInOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)},quinticIn:function(i){return i*i*i*i*i},quinticOut:function(i){return--i*i*i*i*i+1},quinticInOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)},sinusoidalIn:function(i){return 1-Math.cos(i*Math.PI/2)},sinusoidalOut:function(i){return Math.sin(i*Math.PI/2)},sinusoidalInOut:function(i){return .5*(1-Math.cos(Math.PI*i))},exponentialIn:function(i){return i===0?0:Math.pow(1024,i-1)},exponentialOut:function(i){return i===1?1:1-Math.pow(2,-10*i)},exponentialInOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)},circularIn:function(i){return 1-Math.sqrt(1-i*i)},circularOut:function(i){return Math.sqrt(1- --i*i)},circularInOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)},elasticIn:function(i){var t,e=.1,r=.4;return i===0?0:i===1?1:(!e||e<1?(e=1,t=r/4):t=r*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(i-=1))*Math.sin((i-t)*(2*Math.PI)/r)))},elasticOut:function(i){var t,e=.1,r=.4;return i===0?0:i===1?1:(!e||e<1?(e=1,t=r/4):t=r*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*i)*Math.sin((i-t)*(2*Math.PI)/r)+1)},elasticInOut:function(i){var t,e=.1,r=.4;return i===0?0:i===1?1:(!e||e<1?(e=1,t=r/4):t=r*Math.asin(1/e)/(2*Math.PI),(i*=2)<1?-.5*(e*Math.pow(2,10*(i-=1))*Math.sin((i-t)*(2*Math.PI)/r)):e*Math.pow(2,-10*(i-=1))*Math.sin((i-t)*(2*Math.PI)/r)*.5+1)},backIn:function(i){var t=1.70158;return i*i*((t+1)*i-t)},backOut:function(i){var t=1.70158;return--i*i*((t+1)*i+t)+1},backInOut:function(i){var t=2.5949095;return(i*=2)<1?.5*(i*i*((t+1)*i-t)):.5*((i-=2)*i*((t+1)*i+t)+2)},bounceIn:function(i){return 1-jI.bounceOut(1-i)},bounceOut:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},bounceInOut:function(i){return i<.5?jI.bounceIn(i*2)*.5:jI.bounceOut(i*2-1)*.5+.5}};const CY=jI;var uA=Math.pow,Sp=Math.sqrt,CC=1e-8,MY=1e-4,yH=Sp(3),cA=1/3,nh=Cv(),Iu=Cv(),l0=Cv();function gp(i){return i>-CC&&i<CC}function EY(i){return i>CC||i<-CC}function Wo(i,t,e,r,n){var o=1-n;return o*o*(o*i+3*n*t)+n*n*(n*r+3*o*e)}function xH(i,t,e,r,n){var o=1-n;return 3*(((t-i)*o+2*(e-t)*n)*o+(r-e)*n*n)}function MC(i,t,e,r,n,o){var s=r+3*(t-e)-i,a=3*(e-t*2+i),c=3*(t-i),f=i-n,g=a*a-3*s*c,v=a*c-9*s*f,y=c*c-3*a*f,w=0;if(gp(g)&&gp(v))if(gp(a))o[0]=0;else{var I=-c/a;I>=0&&I<=1&&(o[w++]=I)}else{var E=v*v-4*g*y;if(gp(E)){var D=v/g,I=-a/s+D,R=-D/2;I>=0&&I<=1&&(o[w++]=I),R>=0&&R<=1&&(o[w++]=R)}else if(E>0){var z=Sp(E),N=g*a+1.5*s*(-v+z),H=g*a+1.5*s*(-v-z);N<0?N=-uA(-N,cA):N=uA(N,cA),H<0?H=-uA(-H,cA):H=uA(H,cA);var I=(-a-(N+H))/(3*s);I>=0&&I<=1&&(o[w++]=I)}else{var q=(2*g*a-3*s*v)/(2*Sp(g*g*g)),Y=Math.acos(q)/3,J=Sp(g),it=Math.cos(Y),I=(-a-2*J*it)/(3*s),R=(-a+J*(it+yH*Math.sin(Y)))/(3*s),at=(-a+J*(it-yH*Math.sin(Y)))/(3*s);I>=0&&I<=1&&(o[w++]=I),R>=0&&R<=1&&(o[w++]=R),at>=0&&at<=1&&(o[w++]=at)}}return w}function DY(i,t,e,r,n){var o=6*e-12*t+6*i,s=9*t+3*r-3*i-9*e,a=3*t-3*i,c=0;if(gp(s)){if(EY(o)){var f=-a/o;f>=0&&f<=1&&(n[c++]=f)}}else{var g=o*o-4*s*a;if(gp(g))n[0]=-o/(2*s);else if(g>0){var v=Sp(g),f=(-o+v)/(2*s),y=(-o-v)/(2*s);f>=0&&f<=1&&(n[c++]=f),y>=0&&y<=1&&(n[c++]=y)}}return c}function kp(i,t,e,r,n,o){var s=(t-i)*n+i,a=(e-t)*n+t,c=(r-e)*n+e,f=(a-s)*n+s,g=(c-a)*n+a,v=(g-f)*n+f;o[0]=i,o[1]=s,o[2]=f,o[3]=v,o[4]=v,o[5]=g,o[6]=c,o[7]=r}function PY(i,t,e,r,n,o,s,a,c,f,g){var v,y=.005,w=1/0,I,E,D,R;nh[0]=c,nh[1]=f;for(var z=0;z<1;z+=.05)Iu[0]=Wo(i,e,n,s,z),Iu[1]=Wo(t,r,o,a,z),D=nv(nh,Iu),D<w&&(v=z,w=D);w=1/0;for(var N=0;N<32&&!(y<MY);N++)I=v-y,E=v+y,Iu[0]=Wo(i,e,n,s,I),Iu[1]=Wo(t,r,o,a,I),D=nv(Iu,nh),I>=0&&D<w?(v=I,w=D):(l0[0]=Wo(i,e,n,s,E),l0[1]=Wo(t,r,o,a,E),R=nv(l0,nh),E<=1&&R<w?(v=E,w=R):y*=.5);return g&&(g[0]=Wo(i,e,n,s,v),g[1]=Wo(t,r,o,a,v)),Sp(w)}function M_t(i,t,e,r,n,o,s,a,c){for(var f=i,g=t,v=0,y=1/c,w=1;w<=c;w++){var I=w*y,E=Wo(i,e,n,s,I),D=Wo(t,r,o,a,I),R=E-f,z=D-g;v+=Math.sqrt(R*R+z*z),f=E,g=D}return v}function rs(i,t,e,r){var n=1-r;return n*(n*i+2*r*t)+r*r*e}function OO(i,t,e,r){return 2*((1-r)*(t-i)+r*(e-t))}function E_t(i,t,e,r,n){var o=i-2*t+e,s=2*(t-i),a=i-r,c=0;if(gp(o)){if(EY(s)){var f=-a/s;f>=0&&f<=1&&(n[c++]=f)}}else{var g=s*s-4*o*a;if(gp(g)){var f=-s/(2*o);f>=0&&f<=1&&(n[c++]=f)}else if(g>0){var v=Sp(g),f=(-s+v)/(2*o),y=(-s-v)/(2*o);f>=0&&f<=1&&(n[c++]=f),y>=0&&y<=1&&(n[c++]=y)}}return c}function LY(i,t,e){var r=i+e-2*t;return r===0?.5:(i-t)/r}function Jw(i,t,e,r,n){var o=(t-i)*r+i,s=(e-t)*r+t,a=(s-o)*r+o;n[0]=i,n[1]=o,n[2]=a,n[3]=a,n[4]=s,n[5]=e}function RY(i,t,e,r,n,o,s,a,c){var f,g=.005,v=1/0;nh[0]=s,nh[1]=a;for(var y=0;y<1;y+=.05){Iu[0]=rs(i,e,n,y),Iu[1]=rs(t,r,o,y);var w=nv(nh,Iu);w<v&&(f=y,v=w)}v=1/0;for(var I=0;I<32&&!(g<MY);I++){var E=f-g,D=f+g;Iu[0]=rs(i,e,n,E),Iu[1]=rs(t,r,o,E);var w=nv(Iu,nh);if(E>=0&&w<v)f=E,v=w;else{l0[0]=rs(i,e,n,D),l0[1]=rs(t,r,o,D);var R=nv(l0,nh);D<=1&&R<v?(f=D,v=R):g*=.5}}return c&&(c[0]=rs(i,e,n,f),c[1]=rs(t,r,o,f)),Sp(v)}function D_t(i,t,e,r,n,o,s){for(var a=i,c=t,f=0,g=1/s,v=1;v<=s;v++){var y=v*g,w=rs(i,e,n,y),I=rs(t,r,o,y),E=w-a,D=I-c;f+=Math.sqrt(E*E+D*D),a=w,c=I}return f}var P_t=/cubic-bezier\(([0-9,\.e ]+)\)/;function CF(i){var t=i&&P_t.exec(i);if(t){var e=t[1].split(","),r=+Du(e[0]),n=+Du(e[1]),o=+Du(e[2]),s=+Du(e[3]);if(isNaN(r+n+o+s))return;var a=[];return function(c){return c<=0?0:c>=1?1:MC(0,r,o,1,c,a)&&Wo(0,n,s,1,a[0])}}}var L_t=function(){function i(t){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=t.life||1e3,this._delay=t.delay||0,this.loop=t.loop||!1,this.onframe=t.onframe||ho,this.ondestroy=t.ondestroy||ho,this.onrestart=t.onrestart||ho,t.easing&&this.setEasing(t.easing)}return i.prototype.step=function(t,e){if(this._inited||(this._startTime=t+this._delay,this._inited=!0),this._paused){this._pausedTime+=e;return}var r=this._life,n=t-this._startTime-this._pausedTime,o=n/r;o<0&&(o=0),o=Math.min(o,1);var s=this.easingFunc,a=s?s(o):o;if(this.onframe(a),o===1)if(this.loop){var c=n%r;this._startTime=t-c,this._pausedTime=0,this.onrestart()}else return!0;return!1},i.prototype.pause=function(){this._paused=!0},i.prototype.resume=function(){this._paused=!1},i.prototype.setEasing=function(t){this.easing=t,this.easingFunc=Xi(t)?t:CY[t]||CF(t)},i}();const R_t=L_t;var kY=function(){function i(t){this.value=t}return i}(),k_t=function(){function i(){this._len=0}return i.prototype.insert=function(t){var e=new kY(t);return this.insertEntry(e),e},i.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},i.prototype.remove=function(t){var e=t.prev,r=t.next;e?e.next=r:this.head=r,r?r.prev=e:this.tail=e,t.next=t.prev=null,this._len--},i.prototype.len=function(){return this._len},i.prototype.clear=function(){this.head=this.tail=null,this._len=0},i}(),O_t=function(){function i(t){this._list=new k_t,this._maxSize=10,this._map={},this._maxSize=t}return i.prototype.put=function(t,e){var r=this._list,n=this._map,o=null;if(n[t]==null){var s=r.len(),a=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var c=r.head;r.remove(c),delete n[c.key],o=c.value,this._lastRemovedEntry=c}a?a.value=e:a=new kY(e),a.key=t,r.insertEntry(a),n[t]=a}return o},i.prototype.get=function(t){var e=this._map[t],r=this._list;if(e!=null)return e!==r.tail&&(r.remove(e),r.insertEntry(e)),e.value},i.prototype.clear=function(){this._list.clear(),this._map={}},i.prototype.len=function(){return this._list.len()},i}();const b0=O_t;var bH={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function fc(i){return i=Math.round(i),i<0?0:i>255?255:i}function z_t(i){return i=Math.round(i),i<0?0:i>360?360:i}function Qw(i){return i<0?0:i>1?1:i}function bL(i){var t=i;return t.length&&t.charAt(t.length-1)==="%"?fc(parseFloat(t)/100*255):fc(parseInt(t,10))}function Tp(i){var t=i;return t.length&&t.charAt(t.length-1)==="%"?Qw(parseFloat(t)/100):Qw(parseFloat(t))}function wL(i,t,e){return e<0?e+=1:e>1&&(e-=1),e*6<1?i+(t-i)*e*6:e*2<1?t:e*3<2?i+(t-i)*(2/3-e)*6:i}function mp(i,t,e){return i+(t-i)*e}function bu(i,t,e,r,n){return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function zO(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}var OY=new b0(20),hA=null;function _y(i,t){hA&&zO(hA,t),hA=OY.put(i,hA||t.slice())}function Ol(i,t){if(i){t=t||[];var e=OY.get(i);if(e)return zO(t,e);i=i+"";var r=i.replace(/ /g,"").toLowerCase();if(r in bH)return zO(t,bH[r]),_y(i,t),t;var n=r.length;if(r.charAt(0)==="#"){if(n===4||n===5){var o=parseInt(r.slice(1,4),16);if(!(o>=0&&o<=4095)){bu(t,0,0,0,1);return}return bu(t,(o&3840)>>4|(o&3840)>>8,o&240|(o&240)>>4,o&15|(o&15)<<4,n===5?parseInt(r.slice(4),16)/15:1),_y(i,t),t}else if(n===7||n===9){var o=parseInt(r.slice(1,7),16);if(!(o>=0&&o<=16777215)){bu(t,0,0,0,1);return}return bu(t,(o&16711680)>>16,(o&65280)>>8,o&255,n===9?parseInt(r.slice(7),16)/255:1),_y(i,t),t}return}var s=r.indexOf("("),a=r.indexOf(")");if(s!==-1&&a+1===n){var c=r.substr(0,s),f=r.substr(s+1,a-(s+1)).split(","),g=1;switch(c){case"rgba":if(f.length!==4)return f.length===3?bu(t,+f[0],+f[1],+f[2],1):bu(t,0,0,0,1);g=Tp(f.pop());case"rgb":if(f.length>=3)return bu(t,bL(f[0]),bL(f[1]),bL(f[2]),f.length===3?g:Tp(f[3])),_y(i,t),t;bu(t,0,0,0,1);return;case"hsla":if(f.length!==4){bu(t,0,0,0,1);return}return f[3]=Tp(f[3]),BO(f,t),_y(i,t),t;case"hsl":if(f.length!==3){bu(t,0,0,0,1);return}return BO(f,t),_y(i,t),t;default:return}}bu(t,0,0,0,1)}}function BO(i,t){var e=(parseFloat(i[0])%360+360)%360/360,r=Tp(i[1]),n=Tp(i[2]),o=n<=.5?n*(r+1):n+r-n*r,s=n*2-o;return t=t||[],bu(t,fc(wL(s,o,e+1/3)*255),fc(wL(s,o,e)*255),fc(wL(s,o,e-1/3)*255),1),i.length===4&&(t[3]=i[3]),t}function B_t(i){if(i){var t=i[0]/255,e=i[1]/255,r=i[2]/255,n=Math.min(t,e,r),o=Math.max(t,e,r),s=o-n,a=(o+n)/2,c,f;if(s===0)c=0,f=0;else{a<.5?f=s/(o+n):f=s/(2-o-n);var g=((o-t)/6+s/2)/s,v=((o-e)/6+s/2)/s,y=((o-r)/6+s/2)/s;t===o?c=y-v:e===o?c=1/3+g-y:r===o&&(c=2/3+v-g),c<0&&(c+=1),c>1&&(c-=1)}var w=[c*360,f,a];return i[3]!=null&&w.push(i[3]),w}}function FO(i,t){var e=Ol(i);if(e){for(var r=0;r<3;r++)t<0?e[r]=e[r]*(1-t)|0:e[r]=(255-e[r])*t+e[r]|0,e[r]>255?e[r]=255:e[r]<0&&(e[r]=0);return gh(e,e.length===4?"rgba":"rgb")}}function SL(i,t,e){if(!(!(t&&t.length)||!(i>=0&&i<=1))){e=e||[];var r=i*(t.length-1),n=Math.floor(r),o=Math.ceil(r),s=t[n],a=t[o],c=r-n;return e[0]=fc(mp(s[0],a[0],c)),e[1]=fc(mp(s[1],a[1],c)),e[2]=fc(mp(s[2],a[2],c)),e[3]=Qw(mp(s[3],a[3],c)),e}}function F_t(i,t,e){if(!(!(t&&t.length)||!(i>=0&&i<=1))){var r=i*(t.length-1),n=Math.floor(r),o=Math.ceil(r),s=Ol(t[n]),a=Ol(t[o]),c=r-n,f=gh([fc(mp(s[0],a[0],c)),fc(mp(s[1],a[1],c)),fc(mp(s[2],a[2],c)),Qw(mp(s[3],a[3],c))],"rgba");return e?{color:f,leftIndex:n,rightIndex:o,value:r}:f}}function Ap(i,t,e,r){var n=Ol(i);if(i)return n=B_t(n),t!=null&&(n[0]=z_t(Xi(t)?t(n[0]):t)),e!=null&&(n[1]=Tp(Xi(e)?e(n[1]):e)),r!=null&&(n[2]=Tp(Xi(r)?r(n[2]):r)),gh(BO(n),"rgba")}function EC(i,t){var e=Ol(i);if(e&&t!=null)return e[3]=Qw(t),gh(e,"rgba")}function gh(i,t){if(!(!i||!i.length)){var e=i[0]+","+i[1]+","+i[2];return(t==="rgba"||t==="hsva"||t==="hsla")&&(e+=","+i[3]),t+"("+e+")"}}function DC(i,t){var e=Ol(i);return e?(.299*e[0]+.587*e[1]+.114*e[2])*e[3]/255+(1-e[3])*t:0}var wH=new b0(100);function NO(i){if(wi(i)){var t=wH.get(i);return t||(t=FO(i,-.1),wH.put(i,t)),t}else if(KM(i)){var e=Ne({},i);return e.colorStops=ti(i.colorStops,function(r){return{offset:r.offset,color:FO(r.color,-.1)}}),e}return i}var PC=Math.round;function tS(i){var t;if(!i||i==="transparent")i="none";else if(typeof i=="string"&&i.indexOf("rgba")>-1){var e=Ol(i);e&&(i="rgb("+e[0]+","+e[1]+","+e[2]+")",t=e[3])}return{color:i,opacity:t??1}}var SH=1e-4;function vp(i){return i<SH&&i>-SH}function dA(i){return PC(i*1e3)/1e3}function VO(i){return PC(i*1e4)/1e4}function N_t(i){return"matrix("+dA(i[0])+","+dA(i[1])+","+dA(i[2])+","+dA(i[3])+","+VO(i[4])+","+VO(i[5])+")"}var V_t={left:"start",right:"end",center:"middle",middle:"middle"};function U_t(i,t,e){return e==="top"?i+=t/2:e==="bottom"&&(i-=t/2),i}function G_t(i){return i&&(i.shadowBlur||i.shadowOffsetX||i.shadowOffsetY)}function H_t(i){var t=i.style,e=i.getGlobalScale();return[t.shadowColor,(t.shadowBlur||0).toFixed(2),(t.shadowOffsetX||0).toFixed(2),(t.shadowOffsetY||0).toFixed(2),e[0],e[1]].join(",")}function zY(i){return i&&!!i.image}function j_t(i){return i&&!!i.svgElement}function MF(i){return zY(i)||j_t(i)}function BY(i){return i.type==="linear"}function FY(i){return i.type==="radial"}function NY(i){return i&&(i.type==="linear"||i.type==="radial")}function iE(i){return"url(#"+i+")"}function VY(i){var t=i.getGlobalScale(),e=Math.max(t[0],t[1]);return Math.max(Math.ceil(Math.log(e)/Math.log(10)),1)}function UY(i){var t=i.x||0,e=i.y||0,r=(i.rotation||0)*VI,n=Ui(i.scaleX,1),o=Ui(i.scaleY,1),s=i.skewX||0,a=i.skewY||0,c=[];return(t||e)&&c.push("translate("+t+"px,"+e+"px)"),r&&c.push("rotate("+r+")"),(n!==1||o!==1)&&c.push("scale("+n+","+o+")"),(s||a)&&c.push("skew("+PC(s*VI)+"deg, "+PC(a*VI)+"deg)"),c.join(" ")}var W_t=function(){return Sn.hasGlobalWindow&&Xi(window.btoa)?function(i){return window.btoa(unescape(encodeURIComponent(i)))}:typeof Buffer<"u"?function(i){return Buffer.from(i).toString("base64")}:function(i){return null}}(),UO=Array.prototype.slice;function ud(i,t,e){return(t-i)*e+i}function TL(i,t,e,r){for(var n=t.length,o=0;o<n;o++)i[o]=ud(t[o],e[o],r);return i}function $_t(i,t,e,r){for(var n=t.length,o=n&&t[0].length,s=0;s<n;s++){i[s]||(i[s]=[]);for(var a=0;a<o;a++)i[s][a]=ud(t[s][a],e[s][a],r)}return i}function fA(i,t,e,r){for(var n=t.length,o=0;o<n;o++)i[o]=t[o]+e[o]*r;return i}function TH(i,t,e,r){for(var n=t.length,o=n&&t[0].length,s=0;s<n;s++){i[s]||(i[s]=[]);for(var a=0;a<o;a++)i[s][a]=t[s][a]+e[s][a]*r}return i}function Z_t(i,t){for(var e=i.length,r=t.length,n=e>r?t:i,o=Math.min(e,r),s=n[o-1]||{color:[0,0,0,0],offset:0},a=o;a<Math.max(e,r);a++)n.push({offset:s.offset,color:s.color.slice()})}function q_t(i,t,e){var r=i,n=t;if(!(!r.push||!n.push)){var o=r.length,s=n.length;if(o!==s){var a=o>s;if(a)r.length=s;else for(var c=o;c<s;c++)r.push(e===1?n[c]:UO.call(n[c]))}for(var f=r[0]&&r[0].length,c=0;c<r.length;c++)if(e===1)isNaN(r[c])&&(r[c]=n[c]);else for(var g=0;g<f;g++)isNaN(r[c][g])&&(r[c][g]=n[c][g])}}function Aw(i){if(Ns(i)){var t=i.length;if(Ns(i[0])){for(var e=[],r=0;r<t;r++)e.push(UO.call(i[r]));return e}return UO.call(i)}return i}function WI(i){return i[0]=Math.floor(i[0])||0,i[1]=Math.floor(i[1])||0,i[2]=Math.floor(i[2])||0,i[3]=i[3]==null?1:i[3],"rgba("+i.join(",")+")"}function X_t(i){return Ns(i&&i[0])?2:1}var pA=0,$I=1,GY=2,Qb=3,GO=4,HO=5,AH=6;function IH(i){return i===GO||i===HO}function gA(i){return i===$I||i===GY}var pb=[0,0,0,0],Y_t=function(){function i(t){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=t}return i.prototype.isFinished=function(){return this._finished},i.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},i.prototype.needsAnimate=function(){return this.keyframes.length>=1},i.prototype.getAdditiveTrack=function(){return this._additiveTrack},i.prototype.addKeyframe=function(t,e,r){this._needsSort=!0;var n=this.keyframes,o=n.length,s=!1,a=AH,c=e;if(Ns(e)){var f=X_t(e);a=f,(f===1&&!fn(e[0])||f===2&&!fn(e[0][0]))&&(s=!0)}else if(fn(e)&&!Bs(e))a=pA;else if(wi(e))if(!isNaN(+e))a=pA;else{var g=Ol(e);g&&(c=g,a=Qb)}else if(KM(e)){var v=Ne({},c);v.colorStops=ti(e.colorStops,function(w){return{offset:w.offset,color:Ol(w.color)}}),BY(e)?a=GO:FY(e)&&(a=HO),c=v}o===0?this.valType=a:(a!==this.valType||a===AH)&&(s=!0),this.discrete=this.discrete||s;var y={time:t,value:c,rawValue:e,percent:0};return r&&(y.easing=r,y.easingFunc=Xi(r)?r:CY[r]||CF(r)),n.push(y),y},i.prototype.prepare=function(t,e){var r=this.keyframes;this._needsSort&&r.sort(function(E,D){return E.time-D.time});for(var n=this.valType,o=r.length,s=r[o-1],a=this.discrete,c=gA(n),f=IH(n),g=0;g<o;g++){var v=r[g],y=v.value,w=s.value;v.percent=v.time/t,a||(c&&g!==o-1?q_t(y,w,n):f&&Z_t(y.colorStops,w.colorStops))}if(!a&&n!==HO&&e&&this.needsAnimate()&&e.needsAnimate()&&n===e.valType&&!e._finished){this._additiveTrack=e;for(var I=r[0].value,g=0;g<o;g++)n===pA?r[g].additiveValue=r[g].value-I:n===Qb?r[g].additiveValue=fA([],r[g].value,I,-1):gA(n)&&(r[g].additiveValue=n===$I?fA([],r[g].value,I,-1):TH([],r[g].value,I,-1))}},i.prototype.step=function(t,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var r=this._additiveTrack!=null,n=r?"additiveValue":"value",o=this.valType,s=this.keyframes,a=s.length,c=this.propName,f=o===Qb,g,v=this._lastFr,y=Math.min,w,I;if(a===1)w=I=s[0];else{if(e<0)g=0;else if(e<this._lastFrP){var E=y(v+1,a-1);for(g=E;g>=0&&!(s[g].percent<=e);g--);g=y(g,a-2)}else{for(g=v;g<a&&!(s[g].percent>e);g++);g=y(g-1,a-2)}I=s[g+1],w=s[g]}if(w&&I){this._lastFr=g,this._lastFrP=e;var D=I.percent-w.percent,R=D===0?1:y((e-w.percent)/D,1);I.easingFunc&&(R=I.easingFunc(R));var z=r?this._additiveValue:f?pb:t[c];if((gA(o)||f)&&!z&&(z=this._additiveValue=[]),this.discrete)t[c]=R<1?w.rawValue:I.rawValue;else if(gA(o))o===$I?TL(z,w[n],I[n],R):$_t(z,w[n],I[n],R);else if(IH(o)){var N=w[n],H=I[n],q=o===GO;t[c]={type:q?"linear":"radial",x:ud(N.x,H.x,R),y:ud(N.y,H.y,R),colorStops:ti(N.colorStops,function(J,it){var at=H.colorStops[it];return{offset:ud(J.offset,at.offset,R),color:WI(TL([],J.color,at.color,R))}}),global:H.global},q?(t[c].x2=ud(N.x2,H.x2,R),t[c].y2=ud(N.y2,H.y2,R)):t[c].r=ud(N.r,H.r,R)}else if(f)TL(z,w[n],I[n],R),r||(t[c]=WI(z));else{var Y=ud(w[n],I[n],R);r?this._additiveValue=Y:t[c]=Y}r&&this._addToTarget(t)}}},i.prototype._addToTarget=function(t){var e=this.valType,r=this.propName,n=this._additiveValue;e===pA?t[r]=t[r]+n:e===Qb?(Ol(t[r],pb),fA(pb,pb,n,1),t[r]=WI(pb)):e===$I?fA(t[r],t[r],n,1):e===GY&&TH(t[r],t[r],n,1)},i}(),EF=function(){function i(t,e,r,n){if(this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=t,this._loop=e,e&&n){xF("Can' use additive animation on looped animation.");return}this._additiveAnimators=n,this._allowDiscrete=r}return i.prototype.getMaxTime=function(){return this._maxTime},i.prototype.getDelay=function(){return this._delay},i.prototype.getLoop=function(){return this._loop},i.prototype.getTarget=function(){return this._target},i.prototype.changeTarget=function(t){this._target=t},i.prototype.when=function(t,e,r){return this.whenWithKeys(t,e,on(e),r)},i.prototype.whenWithKeys=function(t,e,r,n){for(var o=this._tracks,s=0;s<r.length;s++){var a=r[s],c=o[a];if(!c){c=o[a]=new Y_t(a);var f=void 0,g=this._getAdditiveTrack(a);if(g){var v=g.keyframes,y=v[v.length-1];f=y&&y.value,g.valType===Qb&&f&&(f=WI(f))}else f=this._target[a];if(f==null)continue;t>0&&c.addKeyframe(0,Aw(f),n),this._trackKeys.push(a)}c.addKeyframe(t,Aw(e[a]),n)}return this._maxTime=Math.max(this._maxTime,t),this},i.prototype.pause=function(){this._clip.pause(),this._paused=!0},i.prototype.resume=function(){this._clip.resume(),this._paused=!1},i.prototype.isPaused=function(){return!!this._paused},i.prototype.duration=function(t){return this._maxTime=t,this._force=!0,this},i.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var t=this._doneCbs;if(t)for(var e=t.length,r=0;r<e;r++)t[r].call(this)},i.prototype._abortedCallback=function(){this._setTracksFinished();var t=this.animation,e=this._abortedCbs;if(t&&t.removeClip(this._clip),this._clip=null,e)for(var r=0;r<e.length;r++)e[r].call(this)},i.prototype._setTracksFinished=function(){for(var t=this._tracks,e=this._trackKeys,r=0;r<e.length;r++)t[e[r]].setFinished()},i.prototype._getAdditiveTrack=function(t){var e,r=this._additiveAnimators;if(r)for(var n=0;n<r.length;n++){var o=r[n].getTrack(t);o&&(e=o)}return e},i.prototype.start=function(t){if(!(this._started>0)){this._started=1;for(var e=this,r=[],n=this._maxTime||0,o=0;o<this._trackKeys.length;o++){var s=this._trackKeys[o],a=this._tracks[s],c=this._getAdditiveTrack(s),f=a.keyframes,g=f.length;if(a.prepare(n,c),a.needsAnimate())if(!this._allowDiscrete&&a.discrete){var v=f[g-1];v&&(e._target[a.propName]=v.rawValue),a.setFinished()}else r.push(a)}if(r.length||this._force){var y=new R_t({life:n,loop:this._loop,delay:this._delay||0,onframe:function(w){e._started=2;var I=e._additiveAnimators;if(I){for(var E=!1,D=0;D<I.length;D++)if(I[D]._clip){E=!0;break}E||(e._additiveAnimators=null)}for(var D=0;D<r.length;D++)r[D].step(e._target,w);var R=e._onframeCbs;if(R)for(var D=0;D<R.length;D++)R[D](e._target,w)},ondestroy:function(){e._doneCallback()}});this._clip=y,this.animation&&this.animation.addClip(y),t&&y.setEasing(t)}else this._doneCallback();return this}},i.prototype.stop=function(t){if(this._clip){var e=this._clip;t&&e.onframe(1),this._abortedCallback()}},i.prototype.delay=function(t){return this._delay=t,this},i.prototype.during=function(t){return t&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(t)),this},i.prototype.done=function(t){return t&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(t)),this},i.prototype.aborted=function(t){return t&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(t)),this},i.prototype.getClip=function(){return this._clip},i.prototype.getTrack=function(t){return this._tracks[t]},i.prototype.getTracks=function(){var t=this;return ti(this._trackKeys,function(e){return t._tracks[e]})},i.prototype.stopTracks=function(t,e){if(!t.length||!this._clip)return!0;for(var r=this._tracks,n=this._trackKeys,o=0;o<t.length;o++){var s=r[t[o]];s&&!s.isFinished()&&(e?s.step(this._target,1):this._started===1&&s.step(this._target,0),s.setFinished())}for(var a=!0,o=0;o<n.length;o++)if(!r[n[o]].isFinished()){a=!1;break}return a&&this._abortedCallback(),a},i.prototype.saveTo=function(t,e,r){if(t){e=e||this._trackKeys;for(var n=0;n<e.length;n++){var o=e[n],s=this._tracks[o];if(!(!s||s.isFinished())){var a=s.keyframes,c=a[r?0:a.length-1];c&&(t[o]=Aw(c.rawValue))}}}},i.prototype.__changeFinalValue=function(t,e){e=e||on(t);for(var r=0;r<e.length;r++){var n=e[r],o=this._tracks[n];if(o){var s=o.keyframes;if(s.length>1){var a=s.pop();o.addKeyframe(a.time,t[n]),o.prepare(this._maxTime,o.getAdditiveTrack())}}}},i}();function Yy(){return new Date().getTime()}var K_t=function(i){ba(t,i);function t(e){var r=i.call(this)||this;return r._running=!1,r._time=0,r._pausedTime=0,r._pauseStart=0,r._paused=!1,e=e||{},r.stage=e.stage||{},r}return t.prototype.addClip=function(e){e.animation&&this.removeClip(e),this._head?(this._tail.next=e,e.prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this},t.prototype.addAnimator=function(e){e.animation=this;var r=e.getClip();r&&this.addClip(r)},t.prototype.removeClip=function(e){if(e.animation){var r=e.prev,n=e.next;r?r.next=n:this._head=n,n?n.prev=r:this._tail=r,e.next=e.prev=e.animation=null}},t.prototype.removeAnimator=function(e){var r=e.getClip();r&&this.removeClip(r),e.animation=null},t.prototype.update=function(e){for(var r=Yy()-this._pausedTime,n=r-this._time,o=this._head;o;){var s=o.next,a=o.step(r,n);a&&(o.ondestroy(),this.removeClip(o)),o=s}this._time=r,e||(this.trigger("frame",n),this.stage.update&&this.stage.update())},t.prototype._startLoop=function(){var e=this;this._running=!0;function r(){e._running&&(kO(r),!e._paused&&e.update())}kO(r)},t.prototype.start=function(){this._running||(this._time=Yy(),this._pausedTime=0,this._startLoop())},t.prototype.stop=function(){this._running=!1},t.prototype.pause=function(){this._paused||(this._pauseStart=Yy(),this._paused=!0)},t.prototype.resume=function(){this._paused&&(this._pausedTime+=Yy()-this._pauseStart,this._paused=!1)},t.prototype.clear=function(){for(var e=this._head;e;){var r=e.next;e.prev=e.next=e.animation=null,e=r}this._head=this._tail=null},t.prototype.isFinished=function(){return this._head==null},t.prototype.animate=function(e,r){r=r||{},this.start();var n=new EF(e,r.loop);return this.addAnimator(n),n},t}(Bu);const J_t=K_t;var Q_t=300,AL=Sn.domSupported,IL=function(){var i=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],t=["touchstart","touchend","touchmove"],e={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},r=ti(i,function(n){var o=n.replace("mouse","pointer");return e.hasOwnProperty(o)?o:n});return{mouse:i,touch:t,pointer:r}}(),CH={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},MH=!1;function jO(i){var t=i.pointerType;return t==="pen"||t==="touch"}function tyt(i){i.touching=!0,i.touchTimer!=null&&(clearTimeout(i.touchTimer),i.touchTimer=null),i.touchTimer=setTimeout(function(){i.touching=!1,i.touchTimer=null},700)}function CL(i){i&&(i.zrByTouch=!0)}function eyt(i,t){return wu(i.dom,new iyt(i,t),!0)}function HY(i,t){for(var e=t,r=!1;e&&e.nodeType!==9&&!(r=e.domBelongToZr||e!==t&&e===i.painterRoot);)e=e.parentNode;return r}var iyt=function(){function i(t,e){this.stopPropagation=ho,this.stopImmediatePropagation=ho,this.preventDefault=ho,this.type=e.type,this.target=this.currentTarget=t.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY}return i}(),ac={mousedown:function(i){i=wu(this.dom,i),this.__mayPointerCapture=[i.zrX,i.zrY],this.trigger("mousedown",i)},mousemove:function(i){i=wu(this.dom,i);var t=this.__mayPointerCapture;t&&(i.zrX!==t[0]||i.zrY!==t[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",i)},mouseup:function(i){i=wu(this.dom,i),this.__togglePointerCapture(!1),this.trigger("mouseup",i)},mouseout:function(i){i=wu(this.dom,i);var t=i.toElement||i.relatedTarget;HY(this,t)||(this.__pointerCapturing&&(i.zrEventControl="no_globalout"),this.trigger("mouseout",i))},wheel:function(i){MH=!0,i=wu(this.dom,i),this.trigger("mousewheel",i)},mousewheel:function(i){MH||(i=wu(this.dom,i),this.trigger("mousewheel",i))},touchstart:function(i){i=wu(this.dom,i),CL(i),this.__lastTouchMoment=new Date,this.handler.processGesture(i,"start"),ac.mousemove.call(this,i),ac.mousedown.call(this,i)},touchmove:function(i){i=wu(this.dom,i),CL(i),this.handler.processGesture(i,"change"),ac.mousemove.call(this,i)},touchend:function(i){i=wu(this.dom,i),CL(i),this.handler.processGesture(i,"end"),ac.mouseup.call(this,i),+new Date-+this.__lastTouchMoment<Q_t&&ac.click.call(this,i)},pointerdown:function(i){ac.mousedown.call(this,i)},pointermove:function(i){jO(i)||ac.mousemove.call(this,i)},pointerup:function(i){ac.mouseup.call(this,i)},pointerout:function(i){jO(i)||ac.mouseout.call(this,i)}};pt(["click","dblclick","contextmenu"],function(i){ac[i]=function(t){t=wu(this.dom,t),this.trigger(i,t)}});var WO={pointermove:function(i){jO(i)||WO.mousemove.call(this,i)},pointerup:function(i){WO.mouseup.call(this,i)},mousemove:function(i){this.trigger("mousemove",i)},mouseup:function(i){var t=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",i),t&&(i.zrEventControl="only_globalout",this.trigger("mouseout",i))}};function ryt(i,t){var e=t.domHandlers;Sn.pointerEventsSupported?pt(IL.pointer,function(r){ZI(t,r,function(n){e[r].call(i,n)})}):(Sn.touchEventsSupported&&pt(IL.touch,function(r){ZI(t,r,function(n){e[r].call(i,n),tyt(t)})}),pt(IL.mouse,function(r){ZI(t,r,function(n){n=TF(n),t.touching||e[r].call(i,n)})}))}function nyt(i,t){Sn.pointerEventsSupported?pt(CH.pointer,e):Sn.touchEventsSupported||pt(CH.mouse,e);function e(r){function n(o){o=TF(o),HY(i,o.target)||(o=eyt(i,o),t.domHandlers[r].call(i,o))}ZI(t,r,n,{capture:!0})}}function ZI(i,t,e,r){i.mounted[t]=e,i.listenerOpts[t]=r,PO(i.domTarget,t,e,r)}function ML(i){var t=i.mounted;for(var e in t)t.hasOwnProperty(e)&&u_t(i.domTarget,e,t[e],i.listenerOpts[e]);i.mounted={}}var EH=function(){function i(t,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=t,this.domHandlers=e}return i}(),ayt=function(i){ba(t,i);function t(e,r){var n=i.call(this)||this;return n.__pointerCapturing=!1,n.dom=e,n.painterRoot=r,n._localHandlerScope=new EH(e,ac),AL&&(n._globalHandlerScope=new EH(document,WO)),ryt(n,n._localHandlerScope),n}return t.prototype.dispose=function(){ML(this._localHandlerScope),AL&&ML(this._globalHandlerScope)},t.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},t.prototype.__togglePointerCapture=function(e){if(this.__mayPointerCapture=null,AL&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var r=this._globalHandlerScope;e?nyt(this,r):ML(r)}},t}(Bu);const oyt=ayt;var jY=1;Sn.hasGlobalWindow&&(jY=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var LC=jY,$O=.4,ZO="#333",qO="#ccc",syt="#eee",DH=tE,PH=5e-5;function om(i){return i>PH||i<-PH}var sm=[],yy=[],EL=as(),DL=Math.abs,lyt=function(){function i(){}return i.prototype.getLocalTransform=function(t){return i.getLocalTransform(this,t)},i.prototype.setPosition=function(t){this.x=t[0],this.y=t[1]},i.prototype.setScale=function(t){this.scaleX=t[0],this.scaleY=t[1]},i.prototype.setSkew=function(t){this.skewX=t[0],this.skewY=t[1]},i.prototype.setOrigin=function(t){this.originX=t[0],this.originY=t[1]},i.prototype.needLocalTransform=function(){return om(this.rotation)||om(this.x)||om(this.y)||om(this.scaleX-1)||om(this.scaleY-1)||om(this.skewX)||om(this.skewY)},i.prototype.updateTransform=function(){var t=this.parent&&this.parent.transform,e=this.needLocalTransform(),r=this.transform;if(!(e||t)){r&&(DH(r),this.invTransform=null);return}r=r||as(),e?this.getLocalTransform(r):DH(r),t&&(e?ph(r,t,r):eE(r,t)),this.transform=r,this._resolveGlobalScaleRatio(r)},i.prototype._resolveGlobalScaleRatio=function(t){var e=this.globalScaleRatio;if(e!=null&&e!==1){this.getGlobalScale(sm);var r=sm[0]<0?-1:1,n=sm[1]<0?-1:1,o=((sm[0]-r)*e+r)/sm[0]||0,s=((sm[1]-n)*e+n)/sm[1]||0;t[0]*=o,t[1]*=o,t[2]*=s,t[3]*=s}this.invTransform=this.invTransform||as(),_c(this.invTransform,t)},i.prototype.getComputedTransform=function(){for(var t=this,e=[];t;)e.push(t),t=t.parent;for(;t=e.pop();)t.updateTransform();return this.transform},i.prototype.setLocalTransform=function(t){if(t){var e=t[0]*t[0]+t[1]*t[1],r=t[2]*t[2]+t[3]*t[3],n=Math.atan2(t[1],t[0]),o=Math.PI/2+n-Math.atan2(t[3],t[2]);r=Math.sqrt(r)*Math.cos(o),e=Math.sqrt(e),this.skewX=o,this.skewY=0,this.rotation=-n,this.x=+t[4],this.y=+t[5],this.scaleX=e,this.scaleY=r,this.originX=0,this.originY=0}},i.prototype.decomposeTransform=function(){if(this.transform){var t=this.parent,e=this.transform;t&&t.transform&&(t.invTransform=t.invTransform||as(),ph(yy,t.invTransform,e),e=yy);var r=this.originX,n=this.originY;(r||n)&&(EL[4]=r,EL[5]=n,ph(yy,e,EL),yy[4]-=r,yy[5]-=n,e=yy),this.setLocalTransform(e)}},i.prototype.getGlobalScale=function(t){var e=this.transform;return t=t||[],e?(t[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),t[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(t[0]=-t[0]),e[3]<0&&(t[1]=-t[1]),t):(t[0]=1,t[1]=1,t)},i.prototype.transformCoordToLocal=function(t,e){var r=[t,e],n=this.invTransform;return n&&fo(r,r,n),r},i.prototype.transformCoordToGlobal=function(t,e){var r=[t,e],n=this.transform;return n&&fo(r,r,n),r},i.prototype.getLineScale=function(){var t=this.transform;return t&&DL(t[0]-1)>1e-10&&DL(t[3]-1)>1e-10?Math.sqrt(DL(t[0]*t[3]-t[2]*t[1])):1},i.prototype.copyTransform=function(t){RC(this,t)},i.getLocalTransform=function(t,e){e=e||[];var r=t.originX||0,n=t.originY||0,o=t.scaleX,s=t.scaleY,a=t.anchorX,c=t.anchorY,f=t.rotation||0,g=t.x,v=t.y,y=t.skewX?Math.tan(t.skewX):0,w=t.skewY?Math.tan(-t.skewY):0;if(r||n||a||c){var I=r+a,E=n+c;e[4]=-I*o-y*E*s,e[5]=-E*s-w*I*o}else e[4]=e[5]=0;return e[0]=o,e[3]=s,e[1]=w*o,e[2]=y*s,f&&jp(e,e,f),e[4]+=r+g,e[5]+=n+v,e},i.initDefaultProps=function(){var t=i.prototype;t.scaleX=t.scaleY=t.globalScaleRatio=1,t.x=t.y=t.originX=t.originY=t.skewX=t.skewY=t.rotation=t.anchorX=t.anchorY=0}(),i}(),wh=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function RC(i,t){for(var e=0;e<wh.length;e++){var r=wh[e];i[r]=t[r]}}const xd=lyt;function mh(i){mA||(mA=new b0(100)),i=i||Ld;var t=mA.get(i);return t||(t={font:i,strWidthCache:new b0(500),asciiWidthMap:null,asciiWidthMapTried:!1,stWideCharWidth:vc.measureText("",i).width,asciiCharWidth:vc.measureText("a",i).width},mA.put(i,t)),t}var mA;function uyt(i){if(!(PL>=LH)){i=i||Ld;for(var t=[],e=+new Date,r=0;r<=127;r++)t[r]=vc.measureText(String.fromCharCode(r),i).width;var n=+new Date-e;return n>16?PL=LH:n>2&&PL++,t}}var PL=0,LH=5;function WY(i,t){return i.asciiWidthMapTried||(i.asciiWidthMap=uyt(i.font),i.asciiWidthMapTried=!0),0<=t&&t<=127?i.asciiWidthMap!=null?i.asciiWidthMap[t]:i.asciiCharWidth:i.stWideCharWidth}function vh(i,t){var e=i.strWidthCache,r=e.get(t);return r==null&&(r=vc.measureText(t,i.font).width,e.put(t,r)),r}function RH(i,t,e,r){var n=vh(mh(t),i),o=FS(t),s=w0(0,n,e),a=av(0,o,r),c=new sr(s,a,n,o);return c}function rE(i,t,e,r){var n=((i||"")+"").split(`
`),o=n.length;if(o===1)return RH(n[0],t,e,r);for(var s=new sr(0,0,0,0),a=0;a<n.length;a++){var c=RH(n[a],t,e,r);a===0?s.copy(c):s.union(c)}return s}function w0(i,t,e,r){return e==="right"?r?i+=t:i-=t:e==="center"&&(r?i+=t/2:i-=t/2),i}function av(i,t,e,r){return e==="middle"?r?i+=t/2:i-=t/2:e==="bottom"&&(r?i+=t:i-=t),i}function FS(i){return mh(i).stWideCharWidth}function yc(i,t){return typeof i=="string"?i.lastIndexOf("%")>=0?parseFloat(i)/100*t:parseFloat(i):i}function kC(i,t,e){var r=t.position||"inside",n=t.distance!=null?t.distance:5,o=e.height,s=e.width,a=o/2,c=e.x,f=e.y,g="left",v="top";if(r instanceof Array)c+=yc(r[0],e.width),f+=yc(r[1],e.height),g=null,v=null;else switch(r){case"left":c-=n,f+=a,g="right",v="middle";break;case"right":c+=n+s,f+=a,v="middle";break;case"top":c+=s/2,f-=n,g="center",v="bottom";break;case"bottom":c+=s/2,f+=o+n,g="center";break;case"inside":c+=s/2,f+=a,g="center",v="middle";break;case"insideLeft":c+=n,f+=a,v="middle";break;case"insideRight":c+=s-n,f+=a,g="right",v="middle";break;case"insideTop":c+=s/2,f+=n,g="center";break;case"insideBottom":c+=s/2,f+=o-n,g="center",v="bottom";break;case"insideTopLeft":c+=n,f+=n;break;case"insideTopRight":c+=s-n,f+=n,g="right";break;case"insideBottomLeft":c+=n,f+=o-n,v="bottom";break;case"insideBottomRight":c+=s-n,f+=o-n,g="right",v="bottom";break}return i=i||{},i.x=c,i.y=f,i.align=g,i.verticalAlign=v,i}var LL="__zr_normal__",RL=wh.concat(["ignore"]),cyt=xh(wh,function(i,t){return i[t]=!0,i},{ignore:!1}),xy={},hyt=new sr(0,0,0,0),vA=[],DF=function(){function i(t){this.id=mY(),this.animators=[],this.currentStates=[],this.states={},this._init(t)}return i.prototype._init=function(t){this.attr(t)},i.prototype.drift=function(t,e,r){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=t,n[5]+=e,this.decomposeTransform(),this.markRedraw()},i.prototype.beforeUpdate=function(){},i.prototype.afterUpdate=function(){},i.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},i.prototype.updateInnerText=function(t){var e=this._textContent;if(e&&(!e.ignore||t)){this.textConfig||(this.textConfig={});var r=this.textConfig,n=r.local,o=e.innerTransformable,s=void 0,a=void 0,c=!1;o.parent=n?this:null;var f=!1;o.copyTransform(e);var g=r.position!=null,v=r.autoOverflowArea,y=void 0;if((v||g)&&(y=hyt,r.layoutRect?y.copy(r.layoutRect):y.copy(this.getBoundingRect()),n||y.applyTransform(this.transform)),g){this.calculateTextPosition?this.calculateTextPosition(xy,r,y):kC(xy,r,y),o.x=xy.x,o.y=xy.y,s=xy.align,a=xy.verticalAlign;var w=r.origin;if(w&&r.rotation!=null){var I=void 0,E=void 0;w==="center"?(I=y.width*.5,E=y.height*.5):(I=yc(w[0],y.width),E=yc(w[1],y.height)),f=!0,o.originX=-o.x+I+(n?0:y.x),o.originY=-o.y+E+(n?0:y.y)}}r.rotation!=null&&(o.rotation=r.rotation);var D=r.offset;D&&(o.x+=D[0],o.y+=D[1],f||(o.originX=-D[0],o.originY=-D[1]));var R=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={});if(v){var z=R.overflowRect=R.overflowRect||new sr(0,0,0,0);o.getLocalTransform(vA),_c(vA,vA),sr.copy(z,y),z.applyTransform(vA)}else R.overflowRect=null;var N=r.inside==null?typeof r.position=="string"&&r.position.indexOf("inside")>=0:r.inside,H=void 0,q=void 0,Y=void 0;N&&this.canBeInsideText()?(H=r.insideFill,q=r.insideStroke,(H==null||H==="auto")&&(H=this.getInsideTextFill()),(q==null||q==="auto")&&(q=this.getInsideTextStroke(H),Y=!0)):(H=r.outsideFill,q=r.outsideStroke,(H==null||H==="auto")&&(H=this.getOutsideFill()),(q==null||q==="auto")&&(q=this.getOutsideStroke(H),Y=!0)),H=H||"#000",(H!==R.fill||q!==R.stroke||Y!==R.autoStroke||s!==R.align||a!==R.verticalAlign)&&(c=!0,R.fill=H,R.stroke=q,R.autoStroke=Y,R.align=s,R.verticalAlign=a,e.setDefaultTextStyle(R)),e.__dirty|=Kl,c&&e.dirtyStyle(!0)}},i.prototype.canBeInsideText=function(){return!0},i.prototype.getInsideTextFill=function(){return"#fff"},i.prototype.getInsideTextStroke=function(t){return"#000"},i.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?qO:ZO},i.prototype.getOutsideStroke=function(t){var e=this.__zr&&this.__zr.getBackgroundColor(),r=typeof e=="string"&&Ol(e);r||(r=[255,255,255,1]);for(var n=r[3],o=this.__zr.isDarkMode(),s=0;s<3;s++)r[s]=r[s]*n+(o?0:255)*(1-n);return r[3]=1,gh(r,"rgba")},i.prototype.traverse=function(t,e){},i.prototype.attrKV=function(t,e){t==="textConfig"?this.setTextConfig(e):t==="textContent"?this.setTextContent(e):t==="clipPath"?this.setClipPath(e):t==="extra"?(this.extra=this.extra||{},Ne(this.extra,e)):this[t]=e},i.prototype.hide=function(){this.ignore=!0,this.markRedraw()},i.prototype.show=function(){this.ignore=!1,this.markRedraw()},i.prototype.attr=function(t,e){if(typeof t=="string")this.attrKV(t,e);else if(nr(t))for(var r=t,n=on(r),o=0;o<n.length;o++){var s=n[o];this.attrKV(s,t[s])}return this.markRedraw(),this},i.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var e=this._normalState,r=0;r<this.animators.length;r++){var n=this.animators[r],o=n.__fromStateTransition;if(!(n.getLoop()||o&&o!==LL)){var s=n.targetName,a=s?e[s]:e;n.saveTo(a)}}},i.prototype._innerSaveToNormal=function(t){var e=this._normalState;e||(e=this._normalState={}),t.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(t,e,RL)},i.prototype._savePrimaryToNormal=function(t,e,r){for(var n=0;n<r.length;n++){var o=r[n];t[o]!=null&&!(o in e)&&(e[o]=this[o])}},i.prototype.hasState=function(){return this.currentStates.length>0},i.prototype.getState=function(t){return this.states[t]},i.prototype.ensureState=function(t){var e=this.states;return e[t]||(e[t]={}),e[t]},i.prototype.clearStates=function(t){this.useState(LL,!1,t)},i.prototype.useState=function(t,e,r,n){var o=t===LL,s=this.hasState();if(!(!s&&o)){var a=this.currentStates,c=this.stateTransition;if(!(Ar(a,t)>=0&&(e||a.length===1))){var f;if(this.stateProxy&&!o&&(f=this.stateProxy(t)),f||(f=this.states&&this.states[t]),!f&&!o){xF("State "+t+" not exists.");return}o||this.saveCurrentToNormalState(f);var g=!!(f&&f.hoverLayer||n);g&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,f,this._normalState,e,!r&&!this.__inHover&&c&&c.duration>0,c);var v=this._textContent,y=this._textGuide;return v&&v.useState(t,e,r,g),y&&y.useState(t,e,r,g),o?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!g&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Kl),f}}},i.prototype.useStates=function(t,e,r){if(!t.length)this.clearStates();else{var n=[],o=this.currentStates,s=t.length,a=s===o.length;if(a){for(var c=0;c<s;c++)if(t[c]!==o[c]){a=!1;break}}if(a)return;for(var c=0;c<s;c++){var f=t[c],g=void 0;this.stateProxy&&(g=this.stateProxy(f,t)),g||(g=this.states[f]),g&&n.push(g)}var v=n[s-1],y=!!(v&&v.hoverLayer||r);y&&this._toggleHoverLayerFlag(!0);var w=this._mergeStates(n),I=this.stateTransition;this.saveCurrentToNormalState(w),this._applyStateObj(t.join(","),w,this._normalState,!1,!e&&!this.__inHover&&I&&I.duration>0,I);var E=this._textContent,D=this._textGuide;E&&E.useStates(t,e,y),D&&D.useStates(t,e,y),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!y&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Kl)}},i.prototype.isSilent=function(){for(var t=this;t;){if(t.silent)return!0;var e=t.__hostTarget;t=e?t.ignoreHostSilent?null:e:t.parent}return!1},i.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var e=this.animators[t];e.targetName&&e.changeTarget(this[e.targetName])}},i.prototype.removeState=function(t){var e=Ar(this.currentStates,t);if(e>=0){var r=this.currentStates.slice();r.splice(e,1),this.useStates(r)}},i.prototype.replaceState=function(t,e,r){var n=this.currentStates.slice(),o=Ar(n,t),s=Ar(n,e)>=0;o>=0?s?n.splice(o,1):n[o]=e:r&&!s&&n.push(e),this.useStates(n)},i.prototype.toggleState=function(t,e){e?this.useState(t,!0):this.removeState(t)},i.prototype._mergeStates=function(t){for(var e={},r,n=0;n<t.length;n++){var o=t[n];Ne(e,o),o.textConfig&&(r=r||{},Ne(r,o.textConfig))}return r&&(e.textConfig=r),e},i.prototype._applyStateObj=function(t,e,r,n,o,s){var a=!(e&&n);e&&e.textConfig?(this.textConfig=Ne({},n?this.textConfig:r.textConfig),Ne(this.textConfig,e.textConfig)):a&&r.textConfig&&(this.textConfig=r.textConfig);for(var c={},f=!1,g=0;g<RL.length;g++){var v=RL[g],y=o&&cyt[v];e&&e[v]!=null?y?(f=!0,c[v]=e[v]):this[v]=e[v]:a&&r[v]!=null&&(y?(f=!0,c[v]=r[v]):this[v]=r[v])}if(!o)for(var g=0;g<this.animators.length;g++){var w=this.animators[g],I=w.targetName;w.getLoop()||w.__changeFinalValue(I?(e||r)[I]:e||r)}f&&this._transitionState(t,c,s)},i.prototype._attachComponent=function(t){if(!(t.__zr&&!t.__hostTarget)&&t!==this){var e=this.__zr;e&&t.addSelfToZr(e),t.__zr=e,t.__hostTarget=this}},i.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},i.prototype.getClipPath=function(){return this._clipPath},i.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},i.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},i.prototype.getTextContent=function(){return this._textContent},i.prototype.setTextContent=function(t){var e=this._textContent;e!==t&&(e&&e!==t&&this.removeTextContent(),t.innerTransformable=new xd,this._attachComponent(t),this._textContent=t,this.markRedraw())},i.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),Ne(this.textConfig,t),this.markRedraw()},i.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},i.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.innerTransformable=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},i.prototype.getTextGuideLine=function(){return this._textGuide},i.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},i.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},i.prototype.markRedraw=function(){this.__dirty|=Kl;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},i.prototype.dirty=function(){this.markRedraw()},i.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var e=this._textContent,r=this._textGuide;e&&(e.__inHover=t),r&&(r.__inHover=t)},i.prototype.addSelfToZr=function(t){if(this.__zr!==t){this.__zr=t;var e=this.animators;if(e)for(var r=0;r<e.length;r++)t.animation.addAnimator(e[r]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)}},i.prototype.removeSelfFromZr=function(t){if(this.__zr){this.__zr=null;var e=this.animators;if(e)for(var r=0;r<e.length;r++)t.animation.removeAnimator(e[r]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)}},i.prototype.animate=function(t,e,r){var n=t?this[t]:this,o=new EF(n,e,r);return t&&(o.targetName=t),this.addAnimator(o,t),o},i.prototype.addAnimator=function(t,e){var r=this.__zr,n=this;t.during(function(){n.updateDuringAnimation(e)}).done(function(){var o=n.animators,s=Ar(o,t);s>=0&&o.splice(s,1)}),this.animators.push(t),r&&r.animation.addAnimator(t),r&&r.wakeUp()},i.prototype.updateDuringAnimation=function(t){this.markRedraw()},i.prototype.stopAnimation=function(t,e){for(var r=this.animators,n=r.length,o=[],s=0;s<n;s++){var a=r[s];!t||t===a.scope?a.stop(e):o.push(a)}return this.animators=o,this},i.prototype.animateTo=function(t,e,r){kL(this,t,e,r)},i.prototype.animateFrom=function(t,e,r){kL(this,t,e,r,!0)},i.prototype._transitionState=function(t,e,r,n){for(var o=kL(this,e,r,n),s=0;s<o.length;s++)o[s].__fromStateTransition=t},i.prototype.getBoundingRect=function(){return null},i.prototype.getPaintRect=function(){return null},i.initDefaultProps=function(){var t=i.prototype;t.type="element",t.name="",t.ignore=t.silent=t.ignoreHostSilent=t.isGroup=t.draggable=t.dragging=t.ignoreClip=t.__inHover=!1,t.__dirty=Kl;function e(r,n,o,s){Object.defineProperty(t,r,{get:function(){if(!this[n]){var c=this[n]=[];a(this,c)}return this[n]},set:function(c){this[o]=c[0],this[s]=c[1],this[n]=c,a(this,c)}});function a(c,f){Object.defineProperty(f,0,{get:function(){return c[o]},set:function(g){c[o]=g}}),Object.defineProperty(f,1,{get:function(){return c[s]},set:function(g){c[s]=g}})}}Object.defineProperty&&(e("position","_legacyPos","x","y"),e("scale","_legacyScale","scaleX","scaleY"),e("origin","_legacyOrigin","originX","originY"))}(),i}();Ao(DF,Bu);Ao(DF,xd);function kL(i,t,e,r,n){e=e||{};var o=[];$Y(i,"",i,t,e,r,o,n);var s=o.length,a=!1,c=e.done,f=e.aborted,g=function(){a=!0,s--,s<=0&&(a?c&&c():f&&f())},v=function(){s--,s<=0&&(a?c&&c():f&&f())};s||c&&c(),o.length>0&&e.during&&o[0].during(function(I,E){e.during(E)});for(var y=0;y<o.length;y++){var w=o[y];g&&w.done(g),v&&w.aborted(v),e.force&&w.duration(e.duration),w.start(e.easing)}return o}function OL(i,t,e){for(var r=0;r<e;r++)i[r]=t[r]}function dyt(i){return Ns(i[0])}function fyt(i,t,e){if(Ns(t[e]))if(Ns(i[e])||(i[e]=[]),zl(t[e])){var r=t[e].length;i[e].length!==r&&(i[e]=new t[e].constructor(r),OL(i[e],t[e],r))}else{var n=t[e],o=i[e],s=n.length;if(dyt(n))for(var a=n[0].length,c=0;c<s;c++)o[c]?OL(o[c],n[c],a):o[c]=Array.prototype.slice.call(n[c]);else OL(o,n,s);o.length=n.length}else i[e]=t[e]}function pyt(i,t){return i===t||Ns(i)&&Ns(t)&&gyt(i,t)}function gyt(i,t){var e=i.length;if(e!==t.length)return!1;for(var r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function $Y(i,t,e,r,n,o,s,a){for(var c=on(r),f=n.duration,g=n.delay,v=n.additive,y=n.setToFinal,w=!nr(o),I=i.animators,E=[],D=0;D<c.length;D++){var R=c[D],z=r[R];if(z!=null&&e[R]!=null&&(w||o[R]))if(nr(z)&&!Ns(z)&&!KM(z)){if(t){a||(e[R]=z,i.updateDuringAnimation(t));continue}$Y(i,R,e[R],z,n,o&&o[R],s,a)}else E.push(R);else a||(e[R]=z,i.updateDuringAnimation(t),E.push(R))}var N=E.length;if(!v&&N)for(var H=0;H<I.length;H++){var q=I[H];if(q.targetName===t){var Y=q.stopTracks(E);if(Y){var J=Ar(I,q);I.splice(J,1)}}}if(n.force||(E=kn(E,function(ft){return!pyt(r[ft],e[ft])}),N=E.length),N>0||n.force&&!s.length){var it=void 0,at=void 0,ut=void 0;if(a){at={},y&&(it={});for(var H=0;H<N;H++){var R=E[H];at[R]=e[R],y?it[R]=r[R]:e[R]=r[R]}}else if(y){ut={};for(var H=0;H<N;H++){var R=E[H];ut[R]=Aw(e[R]),fyt(e,r,R)}}var q=new EF(e,!1,!1,v?kn(I,function(_t){return _t.targetName===t}):null);q.targetName=t,n.scope&&(q.scope=n.scope),y&&it&&q.whenWithKeys(0,it,E),ut&&q.whenWithKeys(0,ut,E),q.whenWithKeys(f??500,a?at:r,E).delay(g||0),i.addAnimator(q,t),s.push(q)}}const ZY=DF;var qY=function(i){ba(t,i);function t(e){var r=i.call(this)||this;return r.isGroup=!0,r._children=[],r.attr(e),r}return t.prototype.childrenRef=function(){return this._children},t.prototype.children=function(){return this._children.slice()},t.prototype.childAt=function(e){return this._children[e]},t.prototype.childOfName=function(e){for(var r=this._children,n=0;n<r.length;n++)if(r[n].name===e)return r[n]},t.prototype.childCount=function(){return this._children.length},t.prototype.add=function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},t.prototype.addBefore=function(e,r){if(e&&e!==this&&e.parent!==this&&r&&r.parent===this){var n=this._children,o=n.indexOf(r);o>=0&&(n.splice(o,0,e),this._doAdd(e))}return this},t.prototype.replace=function(e,r){var n=Ar(this._children,e);return n>=0&&this.replaceAt(r,n),this},t.prototype.replaceAt=function(e,r){var n=this._children,o=n[r];if(e&&e!==this&&e.parent!==this&&e!==o){n[r]=e,o.parent=null;var s=this.__zr;s&&o.removeSelfFromZr(s),this._doAdd(e)}return this},t.prototype._doAdd=function(e){e.parent&&e.parent.remove(e),e.parent=this;var r=this.__zr;r&&r!==e.__zr&&e.addSelfToZr(r),r&&r.refresh()},t.prototype.remove=function(e){var r=this.__zr,n=this._children,o=Ar(n,e);return o<0?this:(n.splice(o,1),e.parent=null,r&&e.removeSelfFromZr(r),r&&r.refresh(),this)},t.prototype.removeAll=function(){for(var e=this._children,r=this.__zr,n=0;n<e.length;n++){var o=e[n];r&&o.removeSelfFromZr(r),o.parent=null}return e.length=0,this},t.prototype.eachChild=function(e,r){for(var n=this._children,o=0;o<n.length;o++){var s=n[o];e.call(r,s,o)}return this},t.prototype.traverse=function(e,r){for(var n=0;n<this._children.length;n++){var o=this._children[n],s=e.call(r,o);o.isGroup&&!s&&o.traverse(e,r)}return this},t.prototype.addSelfToZr=function(e){i.prototype.addSelfToZr.call(this,e);for(var r=0;r<this._children.length;r++){var n=this._children[r];n.addSelfToZr(e)}},t.prototype.removeSelfFromZr=function(e){i.prototype.removeSelfFromZr.call(this,e);for(var r=0;r<this._children.length;r++){var n=this._children[r];n.removeSelfFromZr(e)}},t.prototype.getBoundingRect=function(e){for(var r=new sr(0,0,0,0),n=e||this._children,o=[],s=null,a=0;a<n.length;a++){var c=n[a];if(!(c.ignore||c.invisible)){var f=c.getBoundingRect(),g=c.getLocalTransform(o);g?(sr.applyTransform(r,f,g),s=s||r.clone(),s.union(r)):(s=s||f.clone(),s.union(f))}}return s||r},t}(ZY);qY.prototype.type="group";const Ki=qY;/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var qI={},XY={};function myt(i){delete XY[i]}function vyt(i){if(!i)return!1;if(typeof i=="string")return DC(i,1)<$O;if(i.colorStops){for(var t=i.colorStops,e=0,r=t.length,n=0;n<r;n++)e+=DC(t[n].color,1);return e/=r,e<$O}return!1}var _yt=function(){function i(t,e,r){var n=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,r=r||{},this.dom=e,this.id=t;var o=new C_t,s=r.renderer||"canvas";qI[s]||(s=on(qI)[0]),r.useDirtyRect=r.useDirtyRect==null?!1:r.useDirtyRect;var a=new qI[s](e,o,r,t),c=r.ssr||a.ssrOnly;this.storage=o,this.painter=a;var f=!Sn.node&&!Sn.worker&&!c?new oyt(a.getViewportRoot(),a.root):null,g=r.useCoarsePointer,v=g==null||g==="auto"?Sn.touchEventsSupported:!!g,y=44,w;v&&(w=Ui(r.pointerSize,y)),this.handler=new w_t(o,a,f,a.root,w),this.animation=new J_t({stage:{update:c?null:function(){return n._flush(!0)}}}),c||this.animation.start()}return i.prototype.add=function(t){this._disposed||!t||(this.storage.addRoot(t),t.addSelfToZr(this),this.refresh())},i.prototype.remove=function(t){this._disposed||!t||(this.storage.delRoot(t),t.removeSelfFromZr(this),this.refresh())},i.prototype.configLayer=function(t,e){this._disposed||(this.painter.configLayer&&this.painter.configLayer(t,e),this.refresh())},i.prototype.setBackgroundColor=function(t){this._disposed||(this.painter.setBackgroundColor&&this.painter.setBackgroundColor(t),this.refresh(),this._backgroundColor=t,this._darkMode=vyt(t))},i.prototype.getBackgroundColor=function(){return this._backgroundColor},i.prototype.setDarkMode=function(t){this._darkMode=t},i.prototype.isDarkMode=function(){return this._darkMode},i.prototype.refreshImmediately=function(t){this._disposed||(t||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1)},i.prototype.refresh=function(){this._disposed||(this._needsRefresh=!0,this.animation.start())},i.prototype.flush=function(){this._disposed||this._flush(!1)},i.prototype._flush=function(t){var e,r=Yy();this._needsRefresh&&(e=!0,this.refreshImmediately(t)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately());var n=Yy();e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-r})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},i.prototype.setSleepAfterStill=function(t){this._sleepAfterStill=t},i.prototype.wakeUp=function(){this._disposed||(this.animation.start(),this._stillFrameAccum=0)},i.prototype.refreshHover=function(){this._needsRefreshHover=!0},i.prototype.refreshHoverImmediately=function(){this._disposed||(this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.getType()==="canvas"&&this.painter.refreshHover())},i.prototype.resize=function(t){this._disposed||(t=t||{},this.painter.resize(t.width,t.height),this.handler.resize())},i.prototype.clearAnimation=function(){this._disposed||this.animation.clear()},i.prototype.getWidth=function(){if(!this._disposed)return this.painter.getWidth()},i.prototype.getHeight=function(){if(!this._disposed)return this.painter.getHeight()},i.prototype.setCursorStyle=function(t){this._disposed||this.handler.setCursorStyle(t)},i.prototype.findHover=function(t,e){if(!this._disposed)return this.handler.findHover(t,e)},i.prototype.on=function(t,e,r){return this._disposed||this.handler.on(t,e,r),this},i.prototype.off=function(t,e){this._disposed||this.handler.off(t,e)},i.prototype.trigger=function(t,e){this._disposed||this.handler.trigger(t,e)},i.prototype.clear=function(){if(!this._disposed){for(var t=this.storage.getRoots(),e=0;e<t.length;e++)t[e]instanceof Ki&&t[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}},i.prototype.dispose=function(){this._disposed||(this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,this._disposed=!0,myt(this.id))},i}();function kH(i,t){var e=new _yt(mY(),i,t);return XY[e.id]=e,e}function yyt(i,t){qI[i]=t}var XO;function xyt(i){if(typeof XO=="function")return XO(i)}function byt(i){XO=i}var OH=1e-4,YY=20;function wyt(i){return i.replace(/^\s+|\s+$/g,"")}var ru=Math.min,co=Math.max,sh=Math.abs;function Rn(i,t,e,r){var n=t[0],o=t[1],s=e[0],a=e[1],c=o-n,f=a-s;if(c===0)return f===0?s:(s+a)/2;if(r)if(c>0){if(i<=n)return s;if(i>=o)return a}else{if(i>=n)return s;if(i<=o)return a}else{if(i===n)return s;if(i===o)return a}return(i-n)/c*f+s}var xi=Syt;function Syt(i,t,e){switch(i){case"center":case"middle":i="50%";break;case"left":case"top":i="0%";break;case"right":case"bottom":i="100%";break}return OC(i,t,e)}function OC(i,t,e){return wi(i)?wyt(i).match(/%$/)?parseFloat(i)/100*t+(e||0):parseFloat(i):i==null?NaN:+i}function xo(i,t,e){return t==null&&(t=10),t=Math.min(Math.max(0,t),YY),i=(+i).toFixed(t),e?i:+i}function Pu(i){return i.sort(function(t,e){return t-e}),i}function lh(i){if(i=+i,isNaN(i))return 0;if(i>1e-14){for(var t=1,e=0;e<15;e++,t*=10)if(Math.round(i*t)/t===i)return e}return Tyt(i)}function Tyt(i){var t=i.toString().toLowerCase(),e=t.indexOf("e"),r=e>0?+t.slice(e+1):0,n=e>0?e:t.length,o=t.indexOf("."),s=o<0?0:n-1-o;return Math.max(0,s-r)}function KY(i,t){var e=Math.log,r=Math.LN10,n=Math.floor(e(i[1]-i[0])/r),o=Math.round(e(sh(t[1]-t[0]))/r),s=Math.min(Math.max(-n+o,0),20);return isFinite(s)?s:20}function Ayt(i,t){var e=xh(i,function(w,I){return w+(isNaN(I)?0:I)},0);if(e===0)return[];for(var r=Math.pow(10,t),n=ti(i,function(w){return(isNaN(w)?0:w)/e*r*100}),o=r*100,s=ti(n,function(w){return Math.floor(w)}),a=xh(s,function(w,I){return w+I},0),c=ti(n,function(w,I){return w-s[I]});a<o;){for(var f=Number.NEGATIVE_INFINITY,g=null,v=0,y=c.length;v<y;++v)c[v]>f&&(f=c[v],g=v);++s[g],c[g]=0,++a}return ti(s,function(w){return w/r})}function Iyt(i,t){var e=Math.max(lh(i),lh(t)),r=i+t;return e>YY?r:xo(r,e)}var zH=9007199254740991;function JY(i){var t=Math.PI*2;return(i%t+t)%t}function eS(i){return i>-OH&&i<OH}var Cyt=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function Mv(i){if(i instanceof Date)return i;if(wi(i)){var t=Cyt.exec(i);if(!t)return new Date(NaN);if(t[8]){var e=+t[4]||0;return t[8].toUpperCase()!=="Z"&&(e-=+t[8].slice(0,3)),new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,e,+(t[5]||0),+t[6]||0,t[7]?+t[7].substring(0,3):0))}else return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,t[7]?+t[7].substring(0,3):0)}else if(i==null)return new Date(NaN);return new Date(Math.round(i))}function Myt(i){return Math.pow(10,PF(i))}function PF(i){if(i===0)return 0;var t=Math.floor(Math.log(i)/Math.LN10);return i/Math.pow(10,t)>=10&&t++,t}function QY(i,t){var e=PF(i),r=Math.pow(10,e),n=i/r,o;return t?n<1.5?o=1:n<2.5?o=2:n<4?o=3:n<7?o=5:o=10:n<1?o=1:n<2?o=2:n<3?o=3:n<5?o=5:o=10,i=o*r,e>=-20?+i.toFixed(e<0?-e:0):i}function zL(i,t){var e=(i.length-1)*t+1,r=Math.floor(e),n=+i[r-1],o=e-r;return o?n+o*(i[r]-n):n}function BH(i){i.sort(function(c,f){return a(c,f,0)?-1:1});for(var t=-1/0,e=1,r=0;r<i.length;){for(var n=i[r].interval,o=i[r].close,s=0;s<2;s++)n[s]<=t&&(n[s]=t,o[s]=s?1:1-e),t=n[s],e=o[s];n[0]===n[1]&&o[0]*o[1]!==1?i.splice(r,1):r++}return i;function a(c,f,g){return c.interval[g]<f.interval[g]||c.interval[g]===f.interval[g]&&(c.close[g]-f.close[g]===(g?-1:1)||!g&&a(c,f,1))}}function kd(i){var t=parseFloat(i);return t==i&&(t!==0||!wi(i)||i.indexOf("x")<=0)?t:NaN}function tK(i){return!isNaN(kd(i))}function eK(){return Math.round(Math.random()*9)}function iK(i,t){return t===0?i:iK(t,i%t)}function FH(i,t){return i==null?t:t==null?i:i*t/iK(i,t)}var Eyt="[ECharts] ",NH={},Dyt=typeof console<"u"&&console.warn&&console.log;function Pyt(i,t,e){if(Dyt){if(e){if(NH[t])return;NH[t]=!0}console[i](Eyt+t)}}function rK(i,t){Pyt("error",i,t)}function Pn(i){throw new Error(i)}function VH(i,t,e){return(t-i)*e+i}var nK="series\0",aK="\0_ec_\0";function aa(i){return i instanceof Array?i:i==null?[]:[i]}function mv(i,t,e){if(i){i[t]=i[t]||{},i.emphasis=i.emphasis||{},i.emphasis[t]=i.emphasis[t]||{};for(var r=0,n=e.length;r<n;r++){var o=e[r];!i.emphasis[t].hasOwnProperty(o)&&i[t].hasOwnProperty(o)&&(i.emphasis[t][o]=i[t][o])}}}var UH=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function F0(i){return nr(i)&&!Ye(i)&&!(i instanceof Date)?i.value:i}function Lyt(i){return nr(i)&&!(i instanceof Array)}function oK(i,t,e){var r=e==="normalMerge",n=e==="replaceMerge",o=e==="replaceAll";i=i||[],t=(t||[]).slice();var s=Fi();pt(t,function(c,f){if(!nr(c)){t[f]=null;return}});var a=Ryt(i,s,e);return(r||n)&&kyt(a,i,s,t),r&&Oyt(a,t),r||n?zyt(a,t,n):o&&Byt(a,t),Fyt(a),a}function Ryt(i,t,e){var r=[];if(e==="replaceAll")return r;for(var n=0;n<i.length;n++){var o=i[n];o&&o.id!=null&&t.set(o.id,n),r.push({existing:e==="replaceMerge"||iS(o)?null:o,newOption:null,keyInfo:null,brandNew:null})}return r}function kyt(i,t,e,r){pt(r,function(n,o){if(!(!n||n.id==null)){var s=Iw(n.id),a=e.get(s);if(a!=null){var c=i[a];Vs(!c.newOption,'Duplicated option on id "'+s+'".'),c.newOption=n,c.existing=t[a],r[o]=null}}})}function Oyt(i,t){pt(t,function(e,r){if(!(!e||e.name==null))for(var n=0;n<i.length;n++){var o=i[n].existing;if(!i[n].newOption&&o&&(o.id==null||e.id==null)&&!iS(e)&&!iS(o)&&sK("name",o,e)){i[n].newOption=e,t[r]=null;return}}})}function zyt(i,t,e){pt(t,function(r){if(r){for(var n,o=0;(n=i[o])&&(n.newOption||iS(n.existing)||n.existing&&r.id!=null&&!sK("id",r,n.existing));)o++;n?(n.newOption=r,n.brandNew=e):i.push({newOption:r,brandNew:e,existing:null,keyInfo:null}),o++}})}function Byt(i,t){pt(t,function(e){i.push({newOption:e,brandNew:!0,existing:null,keyInfo:null})})}function Fyt(i){var t=Fi();pt(i,function(e){var r=e.existing;r&&t.set(r.id,e)}),pt(i,function(e){var r=e.newOption;Vs(!r||r.id==null||!t.get(r.id)||t.get(r.id)===e,"id duplicates: "+(r&&r.id)),r&&r.id!=null&&t.set(r.id,e),!e.keyInfo&&(e.keyInfo={})}),pt(i,function(e,r){var n=e.existing,o=e.newOption,s=e.keyInfo;if(nr(o)){if(s.name=o.name!=null?Iw(o.name):n?n.name:nK+r,n)s.id=Iw(n.id);else if(o.id!=null)s.id=Iw(o.id);else{var a=0;do s.id="\0"+s.name+"\0"+a++;while(t.get(s.id))}t.set(s.id,e)}})}function sK(i,t,e){var r=ko(t[i],null),n=ko(e[i],null);return r!=null&&n!=null&&r===n}function Iw(i){return ko(i,"")}function ko(i,t){return i==null?t:wi(i)?i:fn(i)||SO(i)?i+"":t}function LF(i){var t=i.name;return!!(t&&t.indexOf(nK))}function iS(i){return i&&i.id!=null&&Iw(i.id).indexOf(aK)===0}function Nyt(i){return aK+i}function Vyt(i,t,e){pt(i,function(r){var n=r.newOption;nr(n)&&(r.keyInfo.mainType=t,r.keyInfo.subType=Uyt(t,n,r.existing,e))})}function Uyt(i,t,e,r){var n=t.type?t.type:e?e.subType:r.determineSubType(i,t);return n}function Gyt(i,t){var e={},r={};return n(i||[],e),n(t||[],r,e),[o(e),o(r)];function n(s,a,c){for(var f=0,g=s.length;f<g;f++){var v=ko(s[f].seriesId,null);if(v==null)return;for(var y=aa(s[f].dataIndex),w=c&&c[v],I=0,E=y.length;I<E;I++){var D=y[I];w&&w[D]?w[D]=null:(a[v]||(a[v]={}))[D]=1}}}function o(s,a){var c=[];for(var f in s)if(s.hasOwnProperty(f)&&s[f]!=null)if(a)c.push(+f);else{var g=o(s[f],!0);g.length&&c.push({seriesId:f,dataIndex:g})}return c}}function vv(i,t){if(t.dataIndexInside!=null)return t.dataIndexInside;if(t.dataIndex!=null)return Ye(t.dataIndex)?ti(t.dataIndex,function(e){return i.indexOfRawIndex(e)}):i.indexOfRawIndex(t.dataIndex);if(t.name!=null)return Ye(t.name)?ti(t.name,function(e){return i.indexOfName(e)}):i.indexOfName(t.name)}function Wr(){var i="__ec_inner_"+Hyt++;return function(t){return t[i]||(t[i]={})}}var Hyt=eK();function u0(i,t,e){var r=RF(t,e),n=r.mainTypeSpecified,o=r.queryOptionMap,s=r.others,a=s,c=e?e.defaultMainType:null;return!n&&c&&o.set(c,{}),o.each(function(f,g){var v=N0(i,g,f,{useDefault:c===g,enableAll:e&&e.enableAll!=null?e.enableAll:!0,enableNone:e&&e.enableNone!=null?e.enableNone:!0});a[g+"Models"]=v.models,a[g+"Model"]=v.models[0]}),a}function RF(i,t){var e;if(wi(i)){var r={};r[i+"Index"]=0,e=r}else e=i;var n=Fi(),o={},s=!1;return pt(e,function(a,c){if(c==="dataIndex"||c==="dataIndexInside"){o[c]=a;return}var f=c.match(/^(\w+)(Index|Id|Name)$/)||[],g=f[1],v=(f[2]||"").toLowerCase();if(!(!g||!v||t&&t.includeMainTypes&&Ar(t.includeMainTypes,g)<0)){s=s||!!g;var y=n.get(g)||n.set(g,{});y[v]=a}}),{mainTypeSpecified:s,queryOptionMap:n,others:o}}var Wa={useDefault:!0,enableAll:!1,enableNone:!1},jyt={useDefault:!1,enableAll:!0,enableNone:!0};function N0(i,t,e,r){r=r||Wa;var n=e.index,o=e.id,s=e.name,a={models:null,specified:n!=null||o!=null||s!=null};if(!a.specified){var c=void 0;return a.models=r.useDefault&&(c=i.getComponent(t))?[c]:[],a}if(n==="none"||n===!1){if(r.enableNone)return a.models=[],a;n=-1}return n==="all"&&(r.enableAll?n=o=s=null:n=-1),a.models=i.queryComponents({mainType:t,index:n,id:o,name:s}),a}function lK(i,t,e){i.setAttribute?i.setAttribute(t,e):i[t]=e}function Wyt(i,t){return i.getAttribute?i.getAttribute(t):i[t]}function $yt(i){return i==="auto"?Sn.domSupported?"html":"richText":i||"html"}function YO(i,t){var e=Fi(),r=[];return pt(i,function(n){var o=t(n);(e.get(o)||(r.push(o),e.set(o,[]))).push(n)}),{keys:r,buckets:e}}function uK(i,t,e,r,n){var o=t==null||t==="auto";if(r==null)return r;if(fn(r)){var s=VH(e||0,r,n);return xo(s,o?Math.max(lh(e||0),lh(r)):t)}else{if(wi(r))return n<1?e:r;for(var a=[],c=e,f=r,g=Math.max(c?c.length:0,f.length),v=0;v<g;++v){var y=i.getDimensionInfo(v);if(y&&y.type==="ordinal")a[v]=(n<1&&c?c:f)[v];else{var w=c&&c[v]?c[v]:0,I=f[v],s=VH(w,I,n);a[v]=xo(s,o?Math.max(lh(w),lh(I)):t)}}return a}}var Ip=function(){function i(){}return i.prototype.reset=function(t,e,r,n){return this._list=t,this._step=n=n||1,this._idx=e,this._end=r??(n>0?t.length:0),this.item=null,this.key=NaN,this},i.prototype.next=function(){return(this._step>0?this._idx<this._end:this._idx>=this._end)?(this.item=this._list[this._idx],this.key=this._idx=this._idx+this._step,!0):!1},i}();function BL(i){i.option=i.parentModel=i.ecModel=null}var Zyt=".",lm="___EC__COMPONENT__CONTAINER___",cK="___EC__EXTENDED_CLASS___";function uh(i){var t={main:"",sub:""};if(i){var e=i.split(Zyt);t.main=e[0]||"",t.sub=e[1]||""}return t}function qyt(i){Vs(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(i),'componentType "'+i+'" illegal')}function Xyt(i){return!!(i&&i[cK])}function kF(i,t){i.$constructor=i,i.extend=function(e){var r=this,n;return Yyt(r)?n=function(o){Se(s,o);function s(){return o.apply(this,arguments)||this}return s}(r):(n=function(){(e.$constructor||r).apply(this,arguments)},Uvt(n,this)),Ne(n.prototype,e),n[cK]=!0,n.extend=this.extend,n.superCall=Qyt,n.superApply=t0t,n.superClass=r,n}}function Yyt(i){return Xi(i)&&/^class\s/.test(Function.prototype.toString.call(i))}function hK(i,t){i.extend=t.extend}var Kyt=Math.round(Math.random()*10);function Jyt(i){var t=["__\0is_clz",Kyt++].join("_");i.prototype[t]=!0,i.isInstance=function(e){return!!(e&&e[t])}}function Qyt(i,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];return this.superClass.prototype[t].apply(i,e)}function t0t(i,t,e){return this.superClass.prototype[t].apply(i,e)}function nE(i){var t={};i.registerClass=function(r){var n=r.type||r.prototype.type;if(n){qyt(n),r.prototype.type=n;var o=uh(n);if(!o.sub)t[o.main]=r;else if(o.sub!==lm){var s=e(o);s[o.sub]=r}}return r},i.getClass=function(r,n,o){var s=t[r];if(s&&s[lm]&&(s=n?s[n]:null),o&&!s)throw new Error(n?"Component "+r+"."+(n||"")+" is used but not imported.":r+".type should be specified.");return s},i.getClassesByMainType=function(r){var n=uh(r),o=[],s=t[n.main];return s&&s[lm]?pt(s,function(a,c){c!==lm&&o.push(a)}):o.push(s),o},i.hasClass=function(r){var n=uh(r);return!!t[n.main]},i.getAllClassMainTypes=function(){var r=[];return pt(t,function(n,o){r.push(o)}),r},i.hasSubTypes=function(r){var n=uh(r),o=t[n.main];return o&&o[lm]};function e(r){var n=t[r.main];return(!n||!n[lm])&&(n=t[r.main]={},n[lm]=!0),n}}function _v(i,t){for(var e=0;e<i.length;e++)i[e][1]||(i[e][1]=i[e][0]);return t=t||!1,function(r,n,o){for(var s={},a=0;a<i.length;a++){var c=i[a][1];if(!(n&&Ar(n,c)>=0||o&&Ar(o,c)<0)){var f=r.getShallow(c,t);f!=null&&(s[i[a][0]]=f)}}return s}}var e0t=[["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]],i0t=_v(e0t),r0t=function(){function i(){}return i.prototype.getAreaStyle=function(t,e){return i0t(this,t,e)},i}(),KO=new b0(50);function n0t(i){if(typeof i=="string"){var t=KO.get(i);return t&&t.image}else return i}function OF(i,t,e,r,n){if(i)if(typeof i=="string"){if(t&&t.__zrImageSrc===i||!e)return t;var o=KO.get(i),s={hostEl:e,cb:r,cbPayload:n};return o?(t=o.image,!aE(t)&&o.pending.push(s)):(t=vc.loadImage(i,GH,GH),t.__zrImageSrc=i,KO.put(i,t.__cachedImgObj={image:t,pending:[s]})),t}else return i;else return t}function GH(){var i=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var t=0;t<i.pending.length;t++){var e=i.pending[t],r=e.cb;r&&r(this,e.cbPayload),e.hostEl.dirty()}i.pending.length=0}function aE(i){return i&&i.width&&i.height}var FL=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function a0t(i,t,e,r,n,o){if(!e){i.text="",i.isTruncated=!1;return}var s=(t+"").split(`
`);o=dK(e,r,n,o);for(var a=!1,c={},f=0,g=s.length;f<g;f++)fK(c,s[f],o),s[f]=c.textLine,a=a||c.isTruncated;i.text=s.join(`
`),i.isTruncated=a}function dK(i,t,e,r){r=r||{};var n=Ne({},r);e=Ui(e,"..."),n.maxIterations=Ui(r.maxIterations,2);var o=n.minChar=Ui(r.minChar,0),s=n.fontMeasureInfo=mh(t),a=s.asciiCharWidth;n.placeholder=Ui(r.placeholder,"");for(var c=i=Math.max(0,i-1),f=0;f<o&&c>=a;f++)c-=a;var g=vh(s,e);return g>c&&(e="",g=0),c=i-g,n.ellipsis=e,n.ellipsisWidth=g,n.contentWidth=c,n.containerWidth=i,n}function fK(i,t,e){var r=e.containerWidth,n=e.contentWidth,o=e.fontMeasureInfo;if(!r){i.textLine="",i.isTruncated=!1;return}var s=vh(o,t);if(s<=r){i.textLine=t,i.isTruncated=!1;return}for(var a=0;;a++){if(s<=n||a>=e.maxIterations){t+=e.ellipsis;break}var c=a===0?o0t(t,n,o):s>0?Math.floor(t.length*n/s):0;t=t.substr(0,c),s=vh(o,t)}t===""&&(t=e.placeholder),i.textLine=t,i.isTruncated=!0}function o0t(i,t,e){for(var r=0,n=0,o=i.length;n<o&&r<t;n++)r+=WY(e,i.charCodeAt(n));return n}function s0t(i,t,e,r){var n=zF(i),o=t.overflow,s=t.padding,a=s?s[1]+s[3]:0,c=s?s[0]+s[2]:0,f=t.font,g=o==="truncate",v=FS(f),y=Ui(t.lineHeight,v),w=t.lineOverflow==="truncate",I=!1,E=t.width;E==null&&e!=null&&(E=e-a);var D=t.height;D==null&&r!=null&&(D=r-c);var R;E!=null&&(o==="break"||o==="breakAll")?R=n?pK(n,t.font,E,o==="breakAll",0).lines:[]:R=n?n.split(`
`):[];var z=R.length*y;if(D==null&&(D=z),z>D&&w){var N=Math.floor(D/y);I=I||R.length>N,R=R.slice(0,N),z=R.length*y}if(n&&g&&E!=null)for(var H=dK(E,f,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder}),q={},Y=0;Y<R.length;Y++)fK(q,R[Y],H),R[Y]=q.textLine,I=I||q.isTruncated;for(var J=D,it=0,at=mh(f),Y=0;Y<R.length;Y++)it=Math.max(vh(at,R[Y]),it);E==null&&(E=it);var ut=E;return J+=c,ut+=a,{lines:R,height:D,outerWidth:ut,outerHeight:J,lineHeight:y,calculatedLineHeight:v,contentWidth:it,contentHeight:z,width:E,isTruncated:I}}var l0t=function(){function i(){}return i}(),HH=function(){function i(t){this.tokens=[],t&&(this.tokens=t)}return i}(),u0t=function(){function i(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[],this.isTruncated=!1}return i}();function c0t(i,t,e,r,n){var o=new u0t,s=zF(i);if(!s)return o;var a=t.padding,c=a?a[1]+a[3]:0,f=a?a[0]+a[2]:0,g=t.width;g==null&&e!=null&&(g=e-c);var v=t.height;v==null&&r!=null&&(v=r-f);for(var y=t.overflow,w=(y==="break"||y==="breakAll")&&g!=null?{width:g,accumWidth:0,breakAll:y==="breakAll"}:null,I=FL.lastIndex=0,E;(E=FL.exec(s))!=null;){var D=E.index;D>I&&NL(o,s.substring(I,D),t,w),NL(o,E[2],t,w,E[1]),I=FL.lastIndex}I<s.length&&NL(o,s.substring(I,s.length),t,w);var R=[],z=0,N=0,H=y==="truncate",q=t.lineOverflow==="truncate",Y={};function J(or,Ue,Ze){or.width=Ue,or.lineHeight=Ze,z+=Ze,N=Math.max(N,Ue)}t:for(var it=0;it<o.lines.length;it++){for(var at=o.lines[it],ut=0,ft=0,_t=0;_t<at.tokens.length;_t++){var ct=at.tokens[_t],Dt=ct.styleName&&t.rich[ct.styleName]||{},Et=ct.textPadding=Dt.padding,bt=Et?Et[1]+Et[3]:0,Vt=ct.font=Dt.font||t.font;ct.contentHeight=FS(Vt);var zt=Ui(Dt.height,ct.contentHeight);if(ct.innerHeight=zt,Et&&(zt+=Et[0]+Et[2]),ct.height=zt,ct.lineHeight=iu(Dt.lineHeight,t.lineHeight,zt),ct.align=Dt&&Dt.align||n,ct.verticalAlign=Dt&&Dt.verticalAlign||"middle",q&&v!=null&&z+ct.lineHeight>v){var Jt=o.lines.length;_t>0?(at.tokens=at.tokens.slice(0,_t),J(at,ft,ut),o.lines=o.lines.slice(0,it+1)):o.lines=o.lines.slice(0,it),o.isTruncated=o.isTruncated||o.lines.length<Jt;break t}var ce=Dt.width,be=ce==null||ce==="auto";if(typeof ce=="string"&&ce.charAt(ce.length-1)==="%")ct.percentWidth=ce,R.push(ct),ct.contentWidth=vh(mh(Vt),ct.text);else{if(be){var ve=Dt.backgroundColor,ke=ve&&ve.image;ke&&(ke=n0t(ke),aE(ke)&&(ct.width=Math.max(ct.width,ke.width*zt/ke.height)))}var ni=H&&g!=null?g-ft:null;ni!=null&&ni<ct.width?!be||ni<bt?(ct.text="",ct.width=ct.contentWidth=0):(a0t(Y,ct.text,ni-bt,Vt,t.ellipsis,{minChar:t.truncateMinChar}),ct.text=Y.text,o.isTruncated=o.isTruncated||Y.isTruncated,ct.width=ct.contentWidth=vh(mh(Vt),ct.text)):ct.contentWidth=vh(mh(Vt),ct.text)}ct.width+=bt,ft+=ct.width,Dt&&(ut=Math.max(ut,ct.lineHeight))}J(at,ft,ut)}o.outerWidth=o.width=Ui(g,N),o.outerHeight=o.height=Ui(v,z),o.contentHeight=z,o.contentWidth=N,o.outerWidth+=c,o.outerHeight+=f;for(var it=0;it<R.length;it++){var ct=R[it],bi=ct.percentWidth;ct.width=parseInt(bi,10)/100*o.width}return o}function NL(i,t,e,r,n){var o=t==="",s=n&&e.rich[n]||{},a=i.lines,c=s.font||e.font,f=!1,g,v;if(r){var y=s.padding,w=y?y[1]+y[3]:0;if(s.width!=null&&s.width!=="auto"){var I=yc(s.width,r.width)+w;a.length>0&&I+r.accumWidth>r.width&&(g=t.split(`
`),f=!0),r.accumWidth=I}else{var E=pK(t,c,r.width,r.breakAll,r.accumWidth);r.accumWidth=E.accumWidth+w,v=E.linesWidths,g=E.lines}}g||(g=t.split(`
`));for(var D=mh(c),R=0;R<g.length;R++){var z=g[R],N=new l0t;if(N.styleName=n,N.text=z,N.isLineHolder=!z&&!o,typeof s.width=="number"?N.width=s.width:N.width=v?v[R]:vh(D,z),!R&&!f){var H=(a[a.length-1]||(a[0]=new HH)).tokens,q=H.length;q===1&&H[0].isLineHolder?H[0]=N:(z||!q||o)&&H.push(N)}else a.push(new HH([N]))}}function h0t(i){var t=i.charCodeAt(0);return t>=32&&t<=591||t>=880&&t<=4351||t>=4608&&t<=5119||t>=7680&&t<=8303}var d0t=xh(",&?/;] ".split(""),function(i,t){return i[t]=!0,i},{});function f0t(i){return h0t(i)?!!d0t[i]:!0}function pK(i,t,e,r,n){for(var o=[],s=[],a="",c="",f=0,g=0,v=mh(t),y=0;y<i.length;y++){var w=i.charAt(y);if(w===`
`){c&&(a+=c,g+=f),o.push(a),s.push(g),a="",c="",f=0,g=0;continue}var I=WY(v,w.charCodeAt(0)),E=r?!1:!f0t(w);if(o.length?g+I>e:n+g+I>e){g?(a||c)&&(E?(a||(a=c,c="",f=0,g=f),o.push(a),s.push(g-f),c+=w,f+=I,a="",g=f):(c&&(a+=c,c="",f=0),o.push(a),s.push(g),a=w,g=I)):E?(o.push(c),s.push(f),c=w,f=I):(o.push(w),s.push(I));continue}g+=I,E?(c+=w,f+=I):(c&&(a+=c,c="",f=0),a+=w)}return c&&(a+=c),a&&(o.push(a),s.push(g)),o.length===1&&(g+=n),{accumWidth:g,lines:o,linesWidths:s}}function jH(i,t,e,r,n,o){if(i.baseX=e,i.baseY=r,i.outerWidth=i.outerHeight=null,!!t){var s=t.width*2,a=t.height*2;sr.set(WH,w0(e,s,n),av(r,a,o),s,a),sr.intersect(t,WH,null,$H);var c=$H.outIntersectRect;i.outerWidth=c.width,i.outerHeight=c.height,i.baseX=w0(c.x,c.width,n,!0),i.baseY=av(c.y,c.height,o,!0)}}var WH=new sr(0,0,0,0),$H={outIntersectRect:{},clamp:!0};function zF(i){return i!=null?i+="":i=""}function p0t(i){var t=zF(i.text),e=i.font,r=vh(mh(e),t),n=FS(e);return JO(i,r,n,null)}function JO(i,t,e,r){var n=new sr(w0(i.x||0,t,i.textAlign),av(i.y||0,e,i.textBaseline),t,e),o=r??(gK(i)?i.lineWidth:0);return o>0&&(n.x-=o/2,n.y-=o/2,n.width+=o,n.height+=o),n}function gK(i){var t=i.stroke;return t!=null&&t!=="none"&&i.lineWidth>0}var QO="__zr_style_"+Math.round(Math.random()*10),ov={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},oE={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};ov[QO]=!0;var ZH=["z","z2","invisible"],g0t=["invisible"],m0t=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype._init=function(e){for(var r=on(e),n=0;n<r.length;n++){var o=r[n];o==="style"?this.useStyle(e[o]):i.prototype.attrKV.call(this,o,e[o])}this.style||this.useStyle({})},t.prototype.beforeBrush=function(){},t.prototype.afterBrush=function(){},t.prototype.innerBeforeBrush=function(){},t.prototype.innerAfterBrush=function(){},t.prototype.shouldBePainted=function(e,r,n,o){var s=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&v0t(this,e,r)||s&&!s[0]&&!s[3])return!1;if(n&&this.__clipPaths&&this.__clipPaths.length){for(var a=0;a<this.__clipPaths.length;++a)if(this.__clipPaths[a].isZeroArea())return!1}if(o&&this.parent)for(var c=this.parent;c;){if(c.ignore)return!1;c=c.parent}return!0},t.prototype.contain=function(e,r){return this.rectContain(e,r)},t.prototype.traverse=function(e,r){e.call(r,this)},t.prototype.rectContain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();return o.contain(n[0],n[1])},t.prototype.getPaintRect=function(){var e=this._paintRect;if(!this._paintRect||this.__dirty){var r=this.transform,n=this.getBoundingRect(),o=this.style,s=o.shadowBlur||0,a=o.shadowOffsetX||0,c=o.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new sr(0,0,0,0)),r?sr.applyTransform(e,n,r):e.copy(n),(s||a||c)&&(e.width+=s*2+Math.abs(a),e.height+=s*2+Math.abs(c),e.x=Math.min(e.x,e.x+a-s),e.y=Math.min(e.y,e.y+c-s));var f=this.dirtyRectTolerance;e.isZero()||(e.x=Math.floor(e.x-f),e.y=Math.floor(e.y-f),e.width=Math.ceil(e.width+1+f*2),e.height=Math.ceil(e.height+1+f*2))}return e},t.prototype.setPrevPaintRect=function(e){e?(this._prevPaintRect=this._prevPaintRect||new sr(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null},t.prototype.getPrevPaintRect=function(){return this._prevPaintRect},t.prototype.animateStyle=function(e){return this.animate("style",e)},t.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():this.markRedraw()},t.prototype.attrKV=function(e,r){e!=="style"?i.prototype.attrKV.call(this,e,r):this.style?this.setStyle(r):this.useStyle(r)},t.prototype.setStyle=function(e,r){return typeof e=="string"?this.style[e]=r:Ne(this.style,e),this.dirtyStyle(),this},t.prototype.dirtyStyle=function(e){e||this.markRedraw(),this.__dirty|=Jb,this._rect&&(this._rect=null)},t.prototype.dirty=function(){this.dirtyStyle()},t.prototype.styleChanged=function(){return!!(this.__dirty&Jb)},t.prototype.styleUpdated=function(){this.__dirty&=~Jb},t.prototype.createStyle=function(e){return QM(ov,e)},t.prototype.useStyle=function(e){e[QO]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()},t.prototype.isStyleObject=function(e){return e[QO]},t.prototype._innerSaveToNormal=function(e){i.prototype._innerSaveToNormal.call(this,e);var r=this._normalState;e.style&&!r.style&&(r.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,r,ZH)},t.prototype._applyStateObj=function(e,r,n,o,s,a){i.prototype._applyStateObj.call(this,e,r,n,o,s,a);var c=!(r&&o),f;if(r&&r.style?s?o?f=r.style:(f=this._mergeStyle(this.createStyle(),n.style),this._mergeStyle(f,r.style)):(f=this._mergeStyle(this.createStyle(),o?this.style:n.style),this._mergeStyle(f,r.style)):c&&(f=n.style),f)if(s){var g=this.style;if(this.style=this.createStyle(c?{}:g),c)for(var v=on(g),y=0;y<v.length;y++){var w=v[y];w in f&&(f[w]=f[w],this.style[w]=g[w])}for(var I=on(f),y=0;y<I.length;y++){var w=I[y];this.style[w]=this.style[w]}this._transitionState(e,{style:f},a,this.getAnimationStyleProps())}else this.useStyle(f);for(var E=this.__inHover?g0t:ZH,y=0;y<E.length;y++){var w=E[y];r&&r[w]!=null?this[w]=r[w]:c&&n[w]!=null&&(this[w]=n[w])}},t.prototype._mergeStates=function(e){for(var r=i.prototype._mergeStates.call(this,e),n,o=0;o<e.length;o++){var s=e[o];s.style&&(n=n||{},this._mergeStyle(n,s.style))}return n&&(r.style=n),r},t.prototype._mergeStyle=function(e,r){return Ne(e,r),e},t.prototype.getAnimationStyleProps=function(){return oE},t.initDefaultProps=function(){var e=t.prototype;e.type="displayable",e.invisible=!1,e.z=0,e.z2=0,e.zlevel=0,e.culling=!1,e.cursor="pointer",e.rectHover=!1,e.incremental=!1,e._rect=null,e.dirtyRectTolerance=0,e.__dirty=Kl|Jb}(),t}(ZY),VL=new sr(0,0,0,0),UL=new sr(0,0,0,0);function v0t(i,t,e){return VL.copy(i.getBoundingRect()),i.transform&&VL.applyTransform(i.transform),UL.width=t,UL.height=e,!VL.intersect(UL)}const Ou=m0t;var Pl=Math.min,Ll=Math.max,GL=Math.sin,HL=Math.cos,um=Math.PI*2,_A=Cv(),yA=Cv(),xA=Cv();function sE(i,t,e){if(i.length!==0){for(var r=i[0],n=r[0],o=r[0],s=r[1],a=r[1],c=1;c<i.length;c++)r=i[c],n=Pl(n,r[0]),o=Ll(o,r[0]),s=Pl(s,r[1]),a=Ll(a,r[1]);t[0]=n,t[1]=s,e[0]=o,e[1]=a}}function qH(i,t,e,r,n,o){n[0]=Pl(i,e),n[1]=Pl(t,r),o[0]=Ll(i,e),o[1]=Ll(t,r)}var XH=[],YH=[];function _0t(i,t,e,r,n,o,s,a,c,f){var g=DY,v=Wo,y=g(i,e,n,s,XH);c[0]=1/0,c[1]=1/0,f[0]=-1/0,f[1]=-1/0;for(var w=0;w<y;w++){var I=v(i,e,n,s,XH[w]);c[0]=Pl(I,c[0]),f[0]=Ll(I,f[0])}y=g(t,r,o,a,YH);for(var w=0;w<y;w++){var E=v(t,r,o,a,YH[w]);c[1]=Pl(E,c[1]),f[1]=Ll(E,f[1])}c[0]=Pl(i,c[0]),f[0]=Ll(i,f[0]),c[0]=Pl(s,c[0]),f[0]=Ll(s,f[0]),c[1]=Pl(t,c[1]),f[1]=Ll(t,f[1]),c[1]=Pl(a,c[1]),f[1]=Ll(a,f[1])}function y0t(i,t,e,r,n,o,s,a){var c=LY,f=rs,g=Ll(Pl(c(i,e,n),1),0),v=Ll(Pl(c(t,r,o),1),0),y=f(i,e,n,g),w=f(t,r,o,v);s[0]=Pl(i,n,y),s[1]=Pl(t,o,w),a[0]=Ll(i,n,y),a[1]=Ll(t,o,w)}function x0t(i,t,e,r,n,o,s,a,c){var f=fp,g=pp,v=Math.abs(n-o);if(v%um<1e-4&&v>1e-4){a[0]=i-e,a[1]=t-r,c[0]=i+e,c[1]=t+r;return}if(_A[0]=HL(n)*e+i,_A[1]=GL(n)*r+t,yA[0]=HL(o)*e+i,yA[1]=GL(o)*r+t,f(a,_A,yA),g(c,_A,yA),n=n%um,n<0&&(n=n+um),o=o%um,o<0&&(o=o+um),n>o&&!s?o+=um:n<o&&s&&(n+=um),s){var y=o;o=n,n=y}for(var w=0;w<o;w+=Math.PI/2)w>n&&(xA[0]=HL(w)*e+i,xA[1]=GL(w)*r+t,f(a,xA,a),g(c,xA,c))}var ca={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},cm=[],hm=[],jc=[],Uf=[],Wc=[],$c=[],jL=Math.min,WL=Math.max,dm=Math.cos,fm=Math.sin,ed=Math.abs,tz=Math.PI,Jf=tz*2,$L=typeof Float32Array<"u",gb=[];function ZL(i){var t=Math.round(i/tz*1e8)/1e8;return t%2*tz}function lE(i,t){var e=ZL(i[0]);e<0&&(e+=Jf);var r=e-i[0],n=i[1];n+=r,!t&&n-e>=Jf?n=e+Jf:t&&e-n>=Jf?n=e-Jf:!t&&e>n?n=e+(Jf-ZL(e-n)):t&&e<n&&(n=e-(Jf-ZL(n-e))),i[0]=e,i[1]=n}var Sh=function(){function i(t){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}return i.prototype.increaseVersion=function(){this._version++},i.prototype.getVersion=function(){return this._version},i.prototype.setScale=function(t,e,r){r=r||0,r>0&&(this._ux=ed(r/LC/t)||0,this._uy=ed(r/LC/e)||0)},i.prototype.setDPR=function(t){this.dpr=t},i.prototype.setContext=function(t){this._ctx=t},i.prototype.getContext=function(){return this._ctx},i.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},i.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},i.prototype.moveTo=function(t,e){return this._drawPendingPt(),this.addData(ca.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},i.prototype.lineTo=function(t,e){var r=ed(t-this._xi),n=ed(e-this._yi),o=r>this._ux||n>this._uy;if(this.addData(ca.L,t,e),this._ctx&&o&&this._ctx.lineTo(t,e),o)this._xi=t,this._yi=e,this._pendingPtDist=0;else{var s=r*r+n*n;s>this._pendingPtDist&&(this._pendingPtX=t,this._pendingPtY=e,this._pendingPtDist=s)}return this},i.prototype.bezierCurveTo=function(t,e,r,n,o,s){return this._drawPendingPt(),this.addData(ca.C,t,e,r,n,o,s),this._ctx&&this._ctx.bezierCurveTo(t,e,r,n,o,s),this._xi=o,this._yi=s,this},i.prototype.quadraticCurveTo=function(t,e,r,n){return this._drawPendingPt(),this.addData(ca.Q,t,e,r,n),this._ctx&&this._ctx.quadraticCurveTo(t,e,r,n),this._xi=r,this._yi=n,this},i.prototype.arc=function(t,e,r,n,o,s){this._drawPendingPt(),gb[0]=n,gb[1]=o,lE(gb,s),n=gb[0],o=gb[1];var a=o-n;return this.addData(ca.A,t,e,r,r,n,a,0,s?0:1),this._ctx&&this._ctx.arc(t,e,r,n,o,s),this._xi=dm(o)*r+t,this._yi=fm(o)*r+e,this},i.prototype.arcTo=function(t,e,r,n,o){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(t,e,r,n,o),this},i.prototype.rect=function(t,e,r,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(t,e,r,n),this.addData(ca.R,t,e,r,n),this},i.prototype.closePath=function(){this._drawPendingPt(),this.addData(ca.Z);var t=this._ctx,e=this._x0,r=this._y0;return t&&t.closePath(),this._xi=e,this._yi=r,this},i.prototype.fill=function(t){t&&t.fill(),this.toStatic()},i.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},i.prototype.len=function(){return this._len},i.prototype.setData=function(t){if(this._saveData){var e=t.length;!(this.data&&this.data.length===e)&&$L&&(this.data=new Float32Array(e));for(var r=0;r<e;r++)this.data[r]=t[r];this._len=e}},i.prototype.appendPath=function(t){if(this._saveData){t instanceof Array||(t=[t]);for(var e=t.length,r=0,n=this._len,o=0;o<e;o++)r+=t[o].len();var s=this.data;if($L&&(s instanceof Float32Array||!s)&&(this.data=new Float32Array(n+r),n>0&&s))for(var a=0;a<n;a++)this.data[a]=s[a];for(var o=0;o<e;o++)for(var c=t[o].data,a=0;a<c.length;a++)this.data[n++]=c[a];this._len=n}},i.prototype.addData=function(t,e,r,n,o,s,a,c,f){if(this._saveData){var g=this.data;this._len+arguments.length>g.length&&(this._expandData(),g=this.data);for(var v=0;v<arguments.length;v++)g[this._len++]=arguments[v]}},i.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},i.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},i.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var t=this.data;t instanceof Array&&(t.length=this._len,$L&&this._len>11&&(this.data=new Float32Array(t)))}},i.prototype.getBoundingRect=function(){jc[0]=jc[1]=Wc[0]=Wc[1]=Number.MAX_VALUE,Uf[0]=Uf[1]=$c[0]=$c[1]=-Number.MAX_VALUE;var t=this.data,e=0,r=0,n=0,o=0,s;for(s=0;s<this._len;){var a=t[s++],c=s===1;switch(c&&(e=t[s],r=t[s+1],n=e,o=r),a){case ca.M:e=n=t[s++],r=o=t[s++],Wc[0]=n,Wc[1]=o,$c[0]=n,$c[1]=o;break;case ca.L:qH(e,r,t[s],t[s+1],Wc,$c),e=t[s++],r=t[s++];break;case ca.C:_0t(e,r,t[s++],t[s++],t[s++],t[s++],t[s],t[s+1],Wc,$c),e=t[s++],r=t[s++];break;case ca.Q:y0t(e,r,t[s++],t[s++],t[s],t[s+1],Wc,$c),e=t[s++],r=t[s++];break;case ca.A:var f=t[s++],g=t[s++],v=t[s++],y=t[s++],w=t[s++],I=t[s++]+w;s+=1;var E=!t[s++];c&&(n=dm(w)*v+f,o=fm(w)*y+g),x0t(f,g,v,y,w,I,E,Wc,$c),e=dm(I)*v+f,r=fm(I)*y+g;break;case ca.R:n=e=t[s++],o=r=t[s++];var D=t[s++],R=t[s++];qH(n,o,n+D,o+R,Wc,$c);break;case ca.Z:e=n,r=o;break}fp(jc,jc,Wc),pp(Uf,Uf,$c)}return s===0&&(jc[0]=jc[1]=Uf[0]=Uf[1]=0),new sr(jc[0],jc[1],Uf[0]-jc[0],Uf[1]-jc[1])},i.prototype._calculateLength=function(){var t=this.data,e=this._len,r=this._ux,n=this._uy,o=0,s=0,a=0,c=0;this._pathSegLen||(this._pathSegLen=[]);for(var f=this._pathSegLen,g=0,v=0,y=0;y<e;){var w=t[y++],I=y===1;I&&(o=t[y],s=t[y+1],a=o,c=s);var E=-1;switch(w){case ca.M:o=a=t[y++],s=c=t[y++];break;case ca.L:{var D=t[y++],R=t[y++],z=D-o,N=R-s;(ed(z)>r||ed(N)>n||y===e-1)&&(E=Math.sqrt(z*z+N*N),o=D,s=R);break}case ca.C:{var H=t[y++],q=t[y++],D=t[y++],R=t[y++],Y=t[y++],J=t[y++];E=M_t(o,s,H,q,D,R,Y,J,10),o=Y,s=J;break}case ca.Q:{var H=t[y++],q=t[y++],D=t[y++],R=t[y++];E=D_t(o,s,H,q,D,R,10),o=D,s=R;break}case ca.A:var it=t[y++],at=t[y++],ut=t[y++],ft=t[y++],_t=t[y++],ct=t[y++],Dt=ct+_t;y+=1,I&&(a=dm(_t)*ut+it,c=fm(_t)*ft+at),E=WL(ut,ft)*jL(Jf,Math.abs(ct)),o=dm(Dt)*ut+it,s=fm(Dt)*ft+at;break;case ca.R:{a=o=t[y++],c=s=t[y++];var Et=t[y++],bt=t[y++];E=Et*2+bt*2;break}case ca.Z:{var z=a-o,N=c-s;E=Math.sqrt(z*z+N*N),o=a,s=c;break}}E>=0&&(f[v++]=E,g+=E)}return this._pathLen=g,g},i.prototype.rebuildPath=function(t,e){var r=this.data,n=this._ux,o=this._uy,s=this._len,a,c,f,g,v,y,w=e<1,I,E,D=0,R=0,z,N=0,H,q;if(!(w&&(this._pathSegLen||this._calculateLength(),I=this._pathSegLen,E=this._pathLen,z=e*E,!z)))t:for(var Y=0;Y<s;){var J=r[Y++],it=Y===1;switch(it&&(f=r[Y],g=r[Y+1],a=f,c=g),J!==ca.L&&N>0&&(t.lineTo(H,q),N=0),J){case ca.M:a=f=r[Y++],c=g=r[Y++],t.moveTo(f,g);break;case ca.L:{v=r[Y++],y=r[Y++];var at=ed(v-f),ut=ed(y-g);if(at>n||ut>o){if(w){var ft=I[R++];if(D+ft>z){var _t=(z-D)/ft;t.lineTo(f*(1-_t)+v*_t,g*(1-_t)+y*_t);break t}D+=ft}t.lineTo(v,y),f=v,g=y,N=0}else{var ct=at*at+ut*ut;ct>N&&(H=v,q=y,N=ct)}break}case ca.C:{var Dt=r[Y++],Et=r[Y++],bt=r[Y++],Vt=r[Y++],zt=r[Y++],Jt=r[Y++];if(w){var ft=I[R++];if(D+ft>z){var _t=(z-D)/ft;kp(f,Dt,bt,zt,_t,cm),kp(g,Et,Vt,Jt,_t,hm),t.bezierCurveTo(cm[1],hm[1],cm[2],hm[2],cm[3],hm[3]);break t}D+=ft}t.bezierCurveTo(Dt,Et,bt,Vt,zt,Jt),f=zt,g=Jt;break}case ca.Q:{var Dt=r[Y++],Et=r[Y++],bt=r[Y++],Vt=r[Y++];if(w){var ft=I[R++];if(D+ft>z){var _t=(z-D)/ft;Jw(f,Dt,bt,_t,cm),Jw(g,Et,Vt,_t,hm),t.quadraticCurveTo(cm[1],hm[1],cm[2],hm[2]);break t}D+=ft}t.quadraticCurveTo(Dt,Et,bt,Vt),f=bt,g=Vt;break}case ca.A:var ce=r[Y++],be=r[Y++],ve=r[Y++],ke=r[Y++],ni=r[Y++],bi=r[Y++],or=r[Y++],Ue=!r[Y++],Ze=ve>ke?ve:ke,xe=ed(ve-ke)>.001,Ke=ni+bi,We=!1;if(w){var ft=I[R++];D+ft>z&&(Ke=ni+bi*(z-D)/ft,We=!0),D+=ft}if(xe&&t.ellipse?t.ellipse(ce,be,ve,ke,or,ni,Ke,Ue):t.arc(ce,be,Ze,ni,Ke,Ue),We)break t;it&&(a=dm(ni)*ve+ce,c=fm(ni)*ke+be),f=dm(Ke)*ve+ce,g=fm(Ke)*ke+be;break;case ca.R:a=f=r[Y],c=g=r[Y+1],v=r[Y++],y=r[Y++];var Ti=r[Y++],Bt=r[Y++];if(w){var ft=I[R++];if(D+ft>z){var Zt=z-D;t.moveTo(v,y),t.lineTo(v+jL(Zt,Ti),y),Zt-=Ti,Zt>0&&t.lineTo(v+Ti,y+jL(Zt,Bt)),Zt-=Bt,Zt>0&&t.lineTo(v+WL(Ti-Zt,0),y+Bt),Zt-=Ti,Zt>0&&t.lineTo(v,y+WL(Bt-Zt,0));break t}D+=ft}t.rect(v,y,Ti,Bt);break;case ca.Z:if(w){var ft=I[R++];if(D+ft>z){var _t=(z-D)/ft;t.lineTo(f*(1-_t)+a*_t,g*(1-_t)+c*_t);break t}D+=ft}t.closePath(),f=a,g=c}}},i.prototype.clone=function(){var t=new i,e=this.data;return t.data=e.slice?e.slice():Array.prototype.slice.call(e),t._len=this._len,t},i.prototype.canSave=function(){return!!this._saveData},i.CMD=ca,i.initDefaultProps=function(){var t=i.prototype;t._saveData=!0,t._ux=0,t._uy=0,t._pendingPtDist=0,t._version=0}(),i}();function np(i,t,e,r,n,o,s){if(n===0)return!1;var a=n,c=0,f=i;if(s>t+a&&s>r+a||s<t-a&&s<r-a||o>i+a&&o>e+a||o<i-a&&o<e-a)return!1;if(i!==e)c=(t-r)/(i-e),f=(i*r-e*t)/(i-e);else return Math.abs(o-i)<=a/2;var g=c*o-s+f,v=g*g/(c*c+1);return v<=a/2*a/2}function b0t(i,t,e,r,n,o,s,a,c,f,g){if(c===0)return!1;var v=c;if(g>t+v&&g>r+v&&g>o+v&&g>a+v||g<t-v&&g<r-v&&g<o-v&&g<a-v||f>i+v&&f>e+v&&f>n+v&&f>s+v||f<i-v&&f<e-v&&f<n-v&&f<s-v)return!1;var y=PY(i,t,e,r,n,o,s,a,f,g,null);return y<=v/2}function mK(i,t,e,r,n,o,s,a,c){if(s===0)return!1;var f=s;if(c>t+f&&c>r+f&&c>o+f||c<t-f&&c<r-f&&c<o-f||a>i+f&&a>e+f&&a>n+f||a<i-f&&a<e-f&&a<n-f)return!1;var g=RY(i,t,e,r,n,o,a,c,null);return g<=f/2}var KH=Math.PI*2;function tu(i){return i%=KH,i<0&&(i+=KH),i}var mb=Math.PI*2;function w0t(i,t,e,r,n,o,s,a,c){if(s===0)return!1;var f=s;a-=i,c-=t;var g=Math.sqrt(a*a+c*c);if(g-f>e||g+f<e)return!1;if(Math.abs(r-n)%mb<1e-4)return!0;if(o){var v=r;r=tu(n),n=tu(v)}else r=tu(r),n=tu(n);r>n&&(n+=mb);var y=Math.atan2(c,a);return y<0&&(y+=mb),y>=r&&y<=n||y+mb>=r&&y+mb<=n}function cd(i,t,e,r,n,o){if(o>t&&o>r||o<t&&o<r||r===t)return 0;var s=(o-t)/(r-t),a=r<t?1:-1;(s===1||s===0)&&(a=r<t?.5:-.5);var c=s*(e-i)+i;return c===n?1/0:c>n?a:0}var Gf=Sh.CMD,pm=Math.PI*2,S0t=1e-4;function T0t(i,t){return Math.abs(i-t)<S0t}var ul=[-1,-1,-1],Tu=[-1,-1];function A0t(){var i=Tu[0];Tu[0]=Tu[1],Tu[1]=i}function I0t(i,t,e,r,n,o,s,a,c,f){if(f>t&&f>r&&f>o&&f>a||f<t&&f<r&&f<o&&f<a)return 0;var g=MC(t,r,o,a,f,ul);if(g===0)return 0;for(var v=0,y=-1,w=void 0,I=void 0,E=0;E<g;E++){var D=ul[E],R=D===0||D===1?.5:1,z=Wo(i,e,n,s,D);z<c||(y<0&&(y=DY(t,r,o,a,Tu),Tu[1]<Tu[0]&&y>1&&A0t(),w=Wo(t,r,o,a,Tu[0]),y>1&&(I=Wo(t,r,o,a,Tu[1]))),y===2?D<Tu[0]?v+=w<t?R:-R:D<Tu[1]?v+=I<w?R:-R:v+=a<I?R:-R:D<Tu[0]?v+=w<t?R:-R:v+=a<w?R:-R)}return v}function C0t(i,t,e,r,n,o,s,a){if(a>t&&a>r&&a>o||a<t&&a<r&&a<o)return 0;var c=E_t(t,r,o,a,ul);if(c===0)return 0;var f=LY(t,r,o);if(f>=0&&f<=1){for(var g=0,v=rs(t,r,o,f),y=0;y<c;y++){var w=ul[y]===0||ul[y]===1?.5:1,I=rs(i,e,n,ul[y]);I<s||(ul[y]<f?g+=v<t?w:-w:g+=o<v?w:-w)}return g}else{var w=ul[0]===0||ul[0]===1?.5:1,I=rs(i,e,n,ul[0]);return I<s?0:o<t?w:-w}}function M0t(i,t,e,r,n,o,s,a){if(a-=t,a>e||a<-e)return 0;var c=Math.sqrt(e*e-a*a);ul[0]=-c,ul[1]=c;var f=Math.abs(r-n);if(f<1e-4)return 0;if(f>=pm-1e-4){r=0,n=pm;var g=o?1:-1;return s>=ul[0]+i&&s<=ul[1]+i?g:0}if(r>n){var v=r;r=n,n=v}r<0&&(r+=pm,n+=pm);for(var y=0,w=0;w<2;w++){var I=ul[w];if(I+i>s){var E=Math.atan2(a,I),g=o?1:-1;E<0&&(E=pm+E),(E>=r&&E<=n||E+pm>=r&&E+pm<=n)&&(E>Math.PI/2&&E<Math.PI*1.5&&(g=-g),y+=g)}}return y}function vK(i,t,e,r,n){for(var o=i.data,s=i.len(),a=0,c=0,f=0,g=0,v=0,y,w,I=0;I<s;){var E=o[I++],D=I===1;switch(E===Gf.M&&I>1&&(e||(a+=cd(c,f,g,v,r,n))),D&&(c=o[I],f=o[I+1],g=c,v=f),E){case Gf.M:g=o[I++],v=o[I++],c=g,f=v;break;case Gf.L:if(e){if(np(c,f,o[I],o[I+1],t,r,n))return!0}else a+=cd(c,f,o[I],o[I+1],r,n)||0;c=o[I++],f=o[I++];break;case Gf.C:if(e){if(b0t(c,f,o[I++],o[I++],o[I++],o[I++],o[I],o[I+1],t,r,n))return!0}else a+=I0t(c,f,o[I++],o[I++],o[I++],o[I++],o[I],o[I+1],r,n)||0;c=o[I++],f=o[I++];break;case Gf.Q:if(e){if(mK(c,f,o[I++],o[I++],o[I],o[I+1],t,r,n))return!0}else a+=C0t(c,f,o[I++],o[I++],o[I],o[I+1],r,n)||0;c=o[I++],f=o[I++];break;case Gf.A:var R=o[I++],z=o[I++],N=o[I++],H=o[I++],q=o[I++],Y=o[I++];I+=1;var J=!!(1-o[I++]);y=Math.cos(q)*N+R,w=Math.sin(q)*H+z,D?(g=y,v=w):a+=cd(c,f,y,w,r,n);var it=(r-R)*H/N+R;if(e){if(w0t(R,z,H,q,q+Y,J,t,it,n))return!0}else a+=M0t(R,z,H,q,q+Y,J,it,n);c=Math.cos(q+Y)*N+R,f=Math.sin(q+Y)*H+z;break;case Gf.R:g=c=o[I++],v=f=o[I++];var at=o[I++],ut=o[I++];if(y=g+at,w=v+ut,e){if(np(g,v,y,v,t,r,n)||np(y,v,y,w,t,r,n)||np(y,w,g,w,t,r,n)||np(g,w,g,v,t,r,n))return!0}else a+=cd(y,v,y,w,r,n),a+=cd(g,w,g,v,r,n);break;case Gf.Z:if(e){if(np(c,f,g,v,t,r,n))return!0}else a+=cd(c,f,g,v,r,n);c=g,f=v;break}}return!e&&!T0t(f,v)&&(a+=cd(c,f,g,v,r,n)||0),a!==0}function E0t(i,t,e){return vK(i,0,!1,t,e)}function D0t(i,t,e,r){return vK(i,t,!0,e,r)}var zC=rr({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},ov),P0t={style:rr({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},oE.style)},qL=wh.concat(["invisible","culling","z","z2","zlevel","parent"]),L0t=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.update=function(){var e=this;i.prototype.update.call(this);var r=this.style;if(r.decal){var n=this._decalEl=this._decalEl||new t;n.buildPath===t.prototype.buildPath&&(n.buildPath=function(c){e.buildPath(c,e.shape)}),n.silent=!0;var o=n.style;for(var s in r)o[s]!==r[s]&&(o[s]=r[s]);o.fill=r.fill?r.decal:null,o.decal=null,o.shadowColor=null,r.strokeFirst&&(o.stroke=null);for(var a=0;a<qL.length;++a)n[qL[a]]=this[qL[a]];n.__dirty|=Kl}else this._decalEl&&(this._decalEl=null)},t.prototype.getDecalElement=function(){return this._decalEl},t.prototype._init=function(e){var r=on(e);this.shape=this.getDefaultShape();var n=this.getDefaultStyle();n&&this.useStyle(n);for(var o=0;o<r.length;o++){var s=r[o],a=e[s];s==="style"?this.style?Ne(this.style,a):this.useStyle(a):s==="shape"?Ne(this.shape,a):i.prototype.attrKV.call(this,s,a)}this.style||this.useStyle({})},t.prototype.getDefaultStyle=function(){return null},t.prototype.getDefaultShape=function(){return{}},t.prototype.canBeInsideText=function(){return this.hasFill()},t.prototype.getInsideTextFill=function(){var e=this.style.fill;if(e!=="none"){if(wi(e)){var r=DC(e,0);return r>.5?ZO:r>.2?syt:qO}else if(e)return qO}return ZO},t.prototype.getInsideTextStroke=function(e){var r=this.style.fill;if(wi(r)){var n=this.__zr,o=!!(n&&n.isDarkMode()),s=DC(e,0)<$O;if(o===s)return r}},t.prototype.buildPath=function(e,r,n){},t.prototype.pathUpdated=function(){this.__dirty&=~Wy},t.prototype.getUpdatedPathProxy=function(e){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path},t.prototype.createPathProxy=function(){this.path=new Sh(!1)},t.prototype.hasStroke=function(){var e=this.style,r=e.stroke;return!(r==null||r==="none"||!(e.lineWidth>0))},t.prototype.hasFill=function(){var e=this.style,r=e.fill;return r!=null&&r!=="none"},t.prototype.getBoundingRect=function(){var e=this._rect,r=this.style,n=!e;if(n){var o=!1;this.path||(o=!0,this.createPathProxy());var s=this.path;(o||this.__dirty&Wy)&&(s.beginPath(),this.buildPath(s,this.shape,!1),this.pathUpdated()),e=s.getBoundingRect()}if(this._rect=e,this.hasStroke()&&this.path&&this.path.len()>0){var a=this._rectStroke||(this._rectStroke=e.clone());if(this.__dirty||n){a.copy(e);var c=r.strokeNoScale?this.getLineScale():1,f=r.lineWidth;if(!this.hasFill()){var g=this.strokeContainThreshold;f=Math.max(f,g??4)}c>1e-10&&(a.width+=f/c,a.height+=f/c,a.x-=f/c/2,a.y-=f/c/2)}return a}return e},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect(),s=this.style;if(e=n[0],r=n[1],o.contain(e,r)){var a=this.path;if(this.hasStroke()){var c=s.lineWidth,f=s.strokeNoScale?this.getLineScale():1;if(f>1e-10&&(this.hasFill()||(c=Math.max(c,this.strokeContainThreshold)),D0t(a,c/f,e,r)))return!0}if(this.hasFill())return E0t(a,e,r)}return!1},t.prototype.dirtyShape=function(){this.__dirty|=Wy,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},t.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},t.prototype.animateShape=function(e){return this.animate("shape",e)},t.prototype.updateDuringAnimation=function(e){e==="style"?this.dirtyStyle():e==="shape"?this.dirtyShape():this.markRedraw()},t.prototype.attrKV=function(e,r){e==="shape"?this.setShape(r):i.prototype.attrKV.call(this,e,r)},t.prototype.setShape=function(e,r){var n=this.shape;return n||(n=this.shape={}),typeof e=="string"?n[e]=r:Ne(n,e),this.dirtyShape(),this},t.prototype.shapeChanged=function(){return!!(this.__dirty&Wy)},t.prototype.createStyle=function(e){return QM(zC,e)},t.prototype._innerSaveToNormal=function(e){i.prototype._innerSaveToNormal.call(this,e);var r=this._normalState;e.shape&&!r.shape&&(r.shape=Ne({},this.shape))},t.prototype._applyStateObj=function(e,r,n,o,s,a){i.prototype._applyStateObj.call(this,e,r,n,o,s,a);var c=!(r&&o),f;if(r&&r.shape?s?o?f=r.shape:(f=Ne({},n.shape),Ne(f,r.shape)):(f=Ne({},o?this.shape:n.shape),Ne(f,r.shape)):c&&(f=n.shape),f)if(s){this.shape=Ne({},this.shape);for(var g={},v=on(f),y=0;y<v.length;y++){var w=v[y];typeof f[w]=="object"?this.shape[w]=f[w]:g[w]=f[w]}this._transitionState(e,{shape:g},a)}else this.shape=f,this.dirtyShape()},t.prototype._mergeStates=function(e){for(var r=i.prototype._mergeStates.call(this,e),n,o=0;o<e.length;o++){var s=e[o];s.shape&&(n=n||{},this._mergeStyle(n,s.shape))}return n&&(r.shape=n),r},t.prototype.getAnimationStyleProps=function(){return P0t},t.prototype.isZeroArea=function(){return!1},t.extend=function(e){var r=function(o){ba(s,o);function s(a){var c=o.call(this,a)||this;return e.init&&e.init.call(c,a),c}return s.prototype.getDefaultStyle=function(){return Yi(e.style)},s.prototype.getDefaultShape=function(){return Yi(e.shape)},s}(t);for(var n in e)typeof e[n]=="function"&&(r.prototype[n]=e[n]);return r},t.initDefaultProps=function(){var e=t.prototype;e.type="path",e.strokeContainThreshold=5,e.segmentIgnoreThreshold=0,e.subPixelOptimize=!1,e.autoBatch=!1,e.__dirty=Kl|Jb|Wy}(),t}(Ou);const qr=L0t;var R0t=rr({strokeFirst:!0,font:Ld,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},zC),_K=function(i){ba(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.hasStroke=function(){return gK(this.style)},t.prototype.hasFill=function(){var e=this.style,r=e.fill;return r!=null&&r!=="none"},t.prototype.createStyle=function(e){return QM(R0t,e)},t.prototype.setBoundingRect=function(e){this._rect=e},t.prototype.getBoundingRect=function(){return this._rect||(this._rect=p0t(this.style)),this._rect},t.initDefaultProps=function(){var e=t.prototype;e.dirtyRectTolerance=10}(),t}(Ou);_K.prototype.type="tspan";const rS=_K;var k0t=rr({x:0,y:0},ov),O0t={style:rr({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},oE.style)};function z0t(i){return!!(i&&typeof i!="string"&&i.width&&i.height)}var yK=function(i){ba(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.createStyle=function(e){return QM(k0t,e)},t.prototype._getSize=function(e){var r=this.style,n=r[e];if(n!=null)return n;var o=z0t(r.image)?r.image:this.__image;if(!o)return 0;var s=e==="width"?"height":"width",a=r[s];return a==null?o[e]:o[e]/o[s]*a},t.prototype.getWidth=function(){return this._getSize("width")},t.prototype.getHeight=function(){return this._getSize("height")},t.prototype.getAnimationStyleProps=function(){return O0t},t.prototype.getBoundingRect=function(){var e=this.style;return this._rect||(this._rect=new sr(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect},t}(Ou);yK.prototype.type="image";const ys=yK;function B0t(i,t){var e=t.x,r=t.y,n=t.width,o=t.height,s=t.r,a,c,f,g;n<0&&(e=e+n,n=-n),o<0&&(r=r+o,o=-o),typeof s=="number"?a=c=f=g=s:s instanceof Array?s.length===1?a=c=f=g=s[0]:s.length===2?(a=f=s[0],c=g=s[1]):s.length===3?(a=s[0],c=g=s[1],f=s[2]):(a=s[0],c=s[1],f=s[2],g=s[3]):a=c=f=g=0;var v;a+c>n&&(v=a+c,a*=n/v,c*=n/v),f+g>n&&(v=f+g,f*=n/v,g*=n/v),c+f>o&&(v=c+f,c*=o/v,f*=o/v),a+g>o&&(v=a+g,a*=o/v,g*=o/v),i.moveTo(e+a,r),i.lineTo(e+n-c,r),c!==0&&i.arc(e+n-c,r+c,c,-Math.PI/2,0),i.lineTo(e+n,r+o-f),f!==0&&i.arc(e+n-f,r+o-f,f,0,Math.PI/2),i.lineTo(e+g,r+o),g!==0&&i.arc(e+g,r+o-g,g,Math.PI/2,Math.PI),i.lineTo(e,r+a),a!==0&&i.arc(e+a,r+a,a,Math.PI,Math.PI*1.5)}var Ky=Math.round;function uE(i,t,e){if(t){var r=t.x1,n=t.x2,o=t.y1,s=t.y2;i.x1=r,i.x2=n,i.y1=o,i.y2=s;var a=e&&e.lineWidth;return a&&(Ky(r*2)===Ky(n*2)&&(i.x1=i.x2=eu(r,a,!0)),Ky(o*2)===Ky(s*2)&&(i.y1=i.y2=eu(o,a,!0))),i}}function xK(i,t,e){if(t){var r=t.x,n=t.y,o=t.width,s=t.height;i.x=r,i.y=n,i.width=o,i.height=s;var a=e&&e.lineWidth;return a&&(i.x=eu(r,a,!0),i.y=eu(n,a,!0),i.width=Math.max(eu(r+o,a,!1)-i.x,o===0?0:1),i.height=Math.max(eu(n+s,a,!1)-i.y,s===0?0:1)),i}}function eu(i,t,e){if(!t)return i;var r=Ky(i*2);return(r+Ky(t))%2===0?r/2:(r+(e?1:-1))/2}var F0t=function(){function i(){this.x=0,this.y=0,this.width=0,this.height=0}return i}(),N0t={},bK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new F0t},t.prototype.buildPath=function(e,r){var n,o,s,a;if(this.subPixelOptimize){var c=xK(N0t,r,this.style);n=c.x,o=c.y,s=c.width,a=c.height,c.r=r.r,r=c}else n=r.x,o=r.y,s=r.width,a=r.height;r.r?B0t(e,r):e.rect(n,o,s,a)},t.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},t}(qr);bK.prototype.type="rect";const jr=bK;var JH={fill:"#000"},QH=2,Zc={},V0t={style:rr({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},oE.style)},wK=function(i){ba(t,i);function t(e){var r=i.call(this)||this;return r.type="text",r._children=[],r._defaultStyle=JH,r.attr(e),r}return t.prototype.childrenRef=function(){return this._children},t.prototype.update=function(){i.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var r=this._children[e];r.zlevel=this.zlevel,r.z=this.z,r.z2=this.z2,r.culling=this.culling,r.cursor=this.cursor,r.invisible=this.invisible}},t.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):i.prototype.updateTransform.call(this)},t.prototype.getLocalTransform=function(e){var r=this.innerTransformable;return r?r.getLocalTransform(e):i.prototype.getLocalTransform.call(this,e)},t.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),i.prototype.getComputedTransform.call(this)},t.prototype._updateSubTexts=function(){this._childCursor=0,H0t(this.style),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},t.prototype.addSelfToZr=function(e){i.prototype.addSelfToZr.call(this,e);for(var r=0;r<this._children.length;r++)this._children[r].__zr=e},t.prototype.removeSelfFromZr=function(e){i.prototype.removeSelfFromZr.call(this,e);for(var r=0;r<this._children.length;r++)this._children[r].__zr=null},t.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var e=new sr(0,0,0,0),r=this._children,n=[],o=null,s=0;s<r.length;s++){var a=r[s],c=a.getBoundingRect(),f=a.getLocalTransform(n);f?(e.copy(c),e.applyTransform(f),o=o||e.clone(),o.union(e)):(o=o||c.clone(),o.union(c))}this._rect=o||e}return this._rect},t.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||JH},t.prototype.setTextContent=function(e){},t.prototype._mergeStyle=function(e,r){if(!r)return e;var n=r.rich,o=e.rich||n&&{};return Ne(e,r),n&&o?(this._mergeRich(o,n),e.rich=o):o&&(e.rich=o),e},t.prototype._mergeRich=function(e,r){for(var n=on(r),o=0;o<n.length;o++){var s=n[o];e[s]=e[s]||{},Ne(e[s],r[s])}},t.prototype.getAnimationStyleProps=function(){return V0t},t.prototype._getOrCreateChild=function(e){var r=this._children[this._childCursor];return(!r||!(r instanceof e))&&(r=new e),this._children[this._childCursor++]=r,r.__zr=this.__zr,r.parent=this,r},t.prototype._updatePlainTexts=function(){var e=this.style,r=e.font||Ld,n=e.padding,o=this._defaultStyle,s=e.x||0,a=e.y||0,c=e.align||o.align||"left",f=e.verticalAlign||o.verticalAlign||"top";jH(Zc,o.overflowRect,s,a,c,f),s=Zc.baseX,a=Zc.baseY;var g=oj(e),v=s0t(g,e,Zc.outerWidth,Zc.outerHeight),y=XL(e),w=!!e.backgroundColor,I=v.outerHeight,E=v.outerWidth,D=v.lines,R=v.lineHeight;this.isTruncated=!!v.isTruncated;var z=s,N=av(a,v.contentHeight,f);if(y||n){var H=w0(s,E,c),q=av(a,I,f);y&&this._renderBackground(e,e,H,q,E,I)}N+=R/2,n&&(z=aj(s,c,n),f==="top"?N+=n[0]:f==="bottom"&&(N-=n[2]));for(var Y=0,J=!1,it=!1,at=nj("fill"in e?e.fill:(it=!0,o.fill)),ut=rj("stroke"in e?e.stroke:!w&&(!o.autoStroke||it)?(Y=QH,J=!0,o.stroke):null),ft=e.textShadowBlur>0,_t=0;_t<D.length;_t++){var ct=this._getOrCreateChild(rS),Dt=ct.createStyle();ct.useStyle(Dt),Dt.text=D[_t],Dt.x=z,Dt.y=N,c&&(Dt.textAlign=c),Dt.textBaseline="middle",Dt.opacity=e.opacity,Dt.strokeFirst=!0,ft&&(Dt.shadowBlur=e.textShadowBlur||0,Dt.shadowColor=e.textShadowColor||"transparent",Dt.shadowOffsetX=e.textShadowOffsetX||0,Dt.shadowOffsetY=e.textShadowOffsetY||0),Dt.stroke=ut,Dt.fill=at,ut&&(Dt.lineWidth=e.lineWidth||Y,Dt.lineDash=e.lineDash,Dt.lineDashOffset=e.lineDashOffset||0),Dt.font=r,ej(Dt,e),N+=R,ct.setBoundingRect(JO(Dt,v.contentWidth,v.calculatedLineHeight,J?0:null))}},t.prototype._updateRichTexts=function(){var e=this.style,r=this._defaultStyle,n=e.align||r.align,o=e.verticalAlign||r.verticalAlign,s=e.x||0,a=e.y||0;jH(Zc,r.overflowRect,s,a,n,o),s=Zc.baseX,a=Zc.baseY;var c=oj(e),f=c0t(c,e,Zc.outerWidth,Zc.outerHeight,n),g=f.width,v=f.outerWidth,y=f.outerHeight,w=e.padding;this.isTruncated=!!f.isTruncated;var I=w0(s,v,n),E=av(a,y,o),D=I,R=E;w&&(D+=w[3],R+=w[0]);var z=D+g;XL(e)&&this._renderBackground(e,e,I,E,v,y);for(var N=!!e.backgroundColor,H=0;H<f.lines.length;H++){for(var q=f.lines[H],Y=q.tokens,J=Y.length,it=q.lineHeight,at=q.width,ut=0,ft=D,_t=z,ct=J-1,Dt=void 0;ut<J&&(Dt=Y[ut],!Dt.align||Dt.align==="left");)this._placeToken(Dt,e,it,R,ft,"left",N),at-=Dt.width,ft+=Dt.width,ut++;for(;ct>=0&&(Dt=Y[ct],Dt.align==="right");)this._placeToken(Dt,e,it,R,_t,"right",N),at-=Dt.width,_t-=Dt.width,ct--;for(ft+=(g-(ft-D)-(z-_t)-at)/2;ut<=ct;)Dt=Y[ut],this._placeToken(Dt,e,it,R,ft+Dt.width/2,"center",N),ft+=Dt.width,ut++;R+=it}},t.prototype._placeToken=function(e,r,n,o,s,a,c){var f=r.rich[e.styleName]||{};f.text=e.text;var g=e.verticalAlign,v=o+n/2;g==="top"?v=o+e.height/2:g==="bottom"&&(v=o+n-e.height/2);var y=!e.isLineHolder&&XL(f);y&&this._renderBackground(f,r,a==="right"?s-e.width:a==="center"?s-e.width/2:s,v-e.height/2,e.width,e.height);var w=!!f.backgroundColor,I=e.textPadding;I&&(s=aj(s,a,I),v-=e.height/2-I[0]-e.innerHeight/2);var E=this._getOrCreateChild(rS),D=E.createStyle();E.useStyle(D);var R=this._defaultStyle,z=!1,N=0,H=!1,q=nj("fill"in f?f.fill:"fill"in r?r.fill:(z=!0,R.fill)),Y=rj("stroke"in f?f.stroke:"stroke"in r?r.stroke:!w&&!c&&(!R.autoStroke||z)?(N=QH,H=!0,R.stroke):null),J=f.textShadowBlur>0||r.textShadowBlur>0;D.text=e.text,D.x=s,D.y=v,J&&(D.shadowBlur=f.textShadowBlur||r.textShadowBlur||0,D.shadowColor=f.textShadowColor||r.textShadowColor||"transparent",D.shadowOffsetX=f.textShadowOffsetX||r.textShadowOffsetX||0,D.shadowOffsetY=f.textShadowOffsetY||r.textShadowOffsetY||0),D.textAlign=a,D.textBaseline="middle",D.font=e.font||Ld,D.opacity=iu(f.opacity,r.opacity,1),ej(D,f),Y&&(D.lineWidth=iu(f.lineWidth,r.lineWidth,N),D.lineDash=Ui(f.lineDash,r.lineDash),D.lineDashOffset=r.lineDashOffset||0,D.stroke=Y),q&&(D.fill=q),E.setBoundingRect(JO(D,e.contentWidth,e.contentHeight,H?0:null))},t.prototype._renderBackground=function(e,r,n,o,s,a){var c=e.backgroundColor,f=e.borderWidth,g=e.borderColor,v=c&&c.image,y=c&&!v,w=e.borderRadius,I=this,E,D;if(y||e.lineHeight||f&&g){E=this._getOrCreateChild(jr),E.useStyle(E.createStyle()),E.style.fill=null;var R=E.shape;R.x=n,R.y=o,R.width=s,R.height=a,R.r=w,E.dirtyShape()}if(y){var z=E.style;z.fill=c||null,z.fillOpacity=Ui(e.fillOpacity,1)}else if(v){D=this._getOrCreateChild(ys),D.onload=function(){I.dirtyStyle()};var N=D.style;N.image=c.image,N.x=n,N.y=o,N.width=s,N.height=a}if(f&&g){var z=E.style;z.lineWidth=f,z.stroke=g,z.strokeOpacity=Ui(e.strokeOpacity,1),z.lineDash=e.borderDash,z.lineDashOffset=e.borderDashOffset||0,E.strokeContainThreshold=0,E.hasFill()&&E.hasStroke()&&(z.strokeFirst=!0,z.lineWidth*=2)}var H=(E||D).style;H.shadowBlur=e.shadowBlur||0,H.shadowColor=e.shadowColor||"transparent",H.shadowOffsetX=e.shadowOffsetX||0,H.shadowOffsetY=e.shadowOffsetY||0,H.opacity=iu(e.opacity,r.opacity,1)},t.makeFont=function(e){var r="";return TK(e)&&(r=[e.fontStyle,e.fontWeight,SK(e.fontSize),e.fontFamily||"sans-serif"].join(" ")),r&&Du(r)||e.textFont||e.font},t}(Ou),U0t={left:!0,right:1,center:1},G0t={top:1,bottom:1,middle:1},tj=["fontStyle","fontWeight","fontSize","fontFamily"];function SK(i){return typeof i=="string"&&(i.indexOf("px")!==-1||i.indexOf("rem")!==-1||i.indexOf("em")!==-1)?i:isNaN(+i)?vF+"px":i+"px"}function ej(i,t){for(var e=0;e<tj.length;e++){var r=tj[e],n=t[r];n!=null&&(i[r]=n)}}function TK(i){return i.fontSize!=null||i.fontFamily||i.fontWeight}function H0t(i){return ij(i),pt(i.rich,ij),i}function ij(i){if(i){i.font=wK.makeFont(i);var t=i.align;t==="middle"&&(t="center"),i.align=t==null||U0t[t]?t:"left";var e=i.verticalAlign;e==="center"&&(e="middle"),i.verticalAlign=e==null||G0t[e]?e:"top";var r=i.padding;r&&(i.padding=JM(i.padding))}}function rj(i,t){return i==null||t<=0||i==="transparent"||i==="none"?null:i.image||i.colorStops?"#000":i}function nj(i){return i==null||i==="none"?null:i.image||i.colorStops?"#000":i}function aj(i,t,e){return t==="right"?i-e[1]:t==="center"?i+e[3]/2-e[1]/2:i+e[3]}function oj(i){var t=i.text;return t!=null&&(t+=""),t}function XL(i){return!!(i.backgroundColor||i.lineHeight||i.borderWidth&&i.borderColor)}const _n=wK;var cr=Wr(),ez=function(i,t,e,r){if(r){var n=cr(r);n.dataIndex=e,n.dataType=t,n.seriesIndex=i,n.ssrType="chart",r.type==="group"&&r.traverse(function(o){var s=cr(o);s.seriesIndex=i,s.dataIndex=e,s.dataType=t,s.ssrType="chart"})}},sj=1,lj={},AK=Wr(),BF=Wr(),FF=0,NS=1,cE=2,fl=["emphasis","blur","select"],nS=["normal","emphasis","blur","select"],V0=10,j0t=9,sv="highlight",XI="downplay",BC="select",iz="unselect",FC="toggleSelect",NF="selectchanged";function by(i){return i!=null&&i!=="none"}function hE(i,t,e){i.onHoverStateChange&&(i.hoverState||0)!==e&&i.onHoverStateChange(t),i.hoverState=e}function IK(i){hE(i,"emphasis",cE)}function CK(i){i.hoverState===cE&&hE(i,"normal",FF)}function VF(i){hE(i,"blur",NS)}function MK(i){i.hoverState===NS&&hE(i,"normal",FF)}function W0t(i){i.selected=!0}function $0t(i){i.selected=!1}function uj(i,t,e){t(i,e)}function jd(i,t,e){uj(i,t,e),i.isGroup&&i.traverse(function(r){uj(r,t,e)})}function NC(i,t){switch(t){case"emphasis":i.hoverState=cE;break;case"normal":i.hoverState=FF;break;case"blur":i.hoverState=NS;break;case"select":i.selected=!0}}function Z0t(i,t,e,r){for(var n=i.style,o={},s=0;s<t.length;s++){var a=t[s],c=n[a];o[a]=c??(r&&r[a])}for(var s=0;s<i.animators.length;s++){var f=i.animators[s];f.__fromStateTransition&&f.__fromStateTransition.indexOf(e)<0&&f.targetName==="style"&&f.saveTo(o,t)}return o}function q0t(i,t,e,r){var n=e&&Ar(e,"select")>=0,o=!1;if(i instanceof qr){var s=AK(i),a=n&&s.selectFill||s.normalFill,c=n&&s.selectStroke||s.normalStroke;if(by(a)||by(c)){r=r||{};var f=r.style||{};f.fill==="inherit"?(o=!0,r=Ne({},r),f=Ne({},f),f.fill=a):!by(f.fill)&&by(a)?(o=!0,r=Ne({},r),f=Ne({},f),f.fill=NO(a)):!by(f.stroke)&&by(c)&&(o||(r=Ne({},r),f=Ne({},f)),f.stroke=NO(c)),r.style=f}}if(r&&r.z2==null){o||(r=Ne({},r));var g=i.z2EmphasisLift;r.z2=i.z2+(g??V0)}return r}function X0t(i,t,e){if(e&&e.z2==null){e=Ne({},e);var r=i.z2SelectLift;e.z2=i.z2+(r??j0t)}return e}function Y0t(i,t,e){var r=Ar(i.currentStates,t)>=0,n=i.style.opacity,o=r?null:Z0t(i,["opacity"],t,{opacity:1});e=e||{};var s=e.style||{};return s.opacity==null&&(e=Ne({},e),s=Ne({opacity:r?n:o.opacity*.1},s),e.style=s),e}function YL(i,t){var e=this.states[i];if(this.style){if(i==="emphasis")return q0t(this,i,t,e);if(i==="blur")return Y0t(this,i,e);if(i==="select")return X0t(this,i,e)}return e}function yv(i){i.stateProxy=YL;var t=i.getTextContent(),e=i.getTextGuideLine();t&&(t.stateProxy=YL),e&&(e.stateProxy=YL)}function cj(i,t){!LK(i,t)&&!i.__highByOuter&&jd(i,IK)}function hj(i,t){!LK(i,t)&&!i.__highByOuter&&jd(i,CK)}function Od(i,t){i.__highByOuter|=1<<(t||0),jd(i,IK)}function zd(i,t){!(i.__highByOuter&=~(1<<(t||0)))&&jd(i,CK)}function EK(i){jd(i,VF)}function UF(i){jd(i,MK)}function DK(i){jd(i,W0t)}function PK(i){jd(i,$0t)}function LK(i,t){return i.__highDownSilentOnTouch&&t.zrByTouch}function RK(i){var t=i.getModel(),e=[],r=[];t.eachComponent(function(n,o){var s=BF(o),a=n==="series",c=a?i.getViewOfSeriesModel(o):i.getViewOfComponentModel(o);!a&&r.push(c),s.isBlured&&(c.group.traverse(function(f){MK(f)}),a&&e.push(o)),s.isBlured=!1}),pt(r,function(n){n&&n.toggleBlurSeries&&n.toggleBlurSeries(e,!1,t)})}function rz(i,t,e,r){var n=r.getModel();e=e||"coordinateSystem";function o(f,g){for(var v=0;v<g.length;v++){var y=f.getItemGraphicEl(g[v]);y&&UF(y)}}if(i!=null&&!(!t||t==="none")){var s=n.getSeriesByIndex(i),a=s.coordinateSystem;a&&a.master&&(a=a.master);var c=[];n.eachSeries(function(f){var g=s===f,v=f.coordinateSystem;v&&v.master&&(v=v.master);var y=v&&a?v===a:g;if(!(e==="series"&&!g||e==="coordinateSystem"&&!y||t==="series"&&g)){var w=r.getViewOfSeriesModel(f);if(w.group.traverse(function(D){D.__highByOuter&&g&&t==="self"||VF(D)}),Ns(t))o(f.getData(),t);else if(nr(t))for(var I=on(t),E=0;E<I.length;E++)o(f.getData(I[E]),t[I[E]]);c.push(f),BF(f).isBlured=!0}}),n.eachComponent(function(f,g){if(f!=="series"){var v=r.getViewOfComponentModel(g);v&&v.toggleBlurSeries&&v.toggleBlurSeries(c,!0,n)}})}}function nz(i,t,e){if(!(i==null||t==null)){var r=e.getModel().getComponent(i,t);if(r){BF(r).isBlured=!0;var n=e.getViewOfComponentModel(r);!n||!n.focusBlurEnabled||n.group.traverse(function(o){VF(o)})}}}function K0t(i,t,e){var r=i.seriesIndex,n=i.getData(t.dataType);if(n){var o=vv(n,t);o=(Ye(o)?o[0]:o)||0;var s=n.getItemGraphicEl(o);if(!s)for(var a=n.count(),c=0;!s&&c<a;)s=n.getItemGraphicEl(c++);if(s){var f=cr(s);rz(r,f.focus,f.blurScope,e)}else{var g=i.get(["emphasis","focus"]),v=i.get(["emphasis","blurScope"]);g!=null&&rz(r,g,v,e)}}}function GF(i,t,e,r){var n={focusSelf:!1,dispatchers:null};if(i==null||i==="series"||t==null||e==null)return n;var o=r.getModel().getComponent(i,t);if(!o)return n;var s=r.getViewOfComponentModel(o);if(!s||!s.findHighDownDispatchers)return n;for(var a=s.findHighDownDispatchers(e),c,f=0;f<a.length;f++)if(cr(a[f]).focus==="self"){c=!0;break}return{focusSelf:c,dispatchers:a}}function J0t(i,t,e){var r=cr(i),n=GF(r.componentMainType,r.componentIndex,r.componentHighDownName,e),o=n.dispatchers,s=n.focusSelf;o?(s&&nz(r.componentMainType,r.componentIndex,e),pt(o,function(a){return cj(a,t)})):(rz(r.seriesIndex,r.focus,r.blurScope,e),r.focus==="self"&&nz(r.componentMainType,r.componentIndex,e),cj(i,t))}function Q0t(i,t,e){RK(e);var r=cr(i),n=GF(r.componentMainType,r.componentIndex,r.componentHighDownName,e).dispatchers;n?pt(n,function(o){return hj(o,t)}):hj(i,t)}function txt(i,t,e){if(oz(t)){var r=t.dataType,n=i.getData(r),o=vv(n,t);Ye(o)||(o=[o]),i[t.type===FC?"toggleSelect":t.type===BC?"select":"unselect"](o,r)}}function dj(i){var t=i.getAllData();pt(t,function(e){var r=e.data,n=e.type;r.eachItemGraphicEl(function(o,s){i.isSelected(s,n)?DK(o):PK(o)})})}function ext(i){var t=[];return i.eachSeries(function(e){var r=e.getAllData();pt(r,function(n){n.data;var o=n.type,s=e.getSelectedDataIndices();if(s.length>0){var a={dataIndex:s,seriesIndex:e.seriesIndex};o!=null&&(a.dataType=o),t.push(a)}})}),t}function lv(i,t,e){$m(i,!0),jd(i,yv),az(i,t,e)}function ixt(i){$m(i,!1)}function Ca(i,t,e,r){r?ixt(i):lv(i,t,e)}function az(i,t,e){var r=cr(i);t!=null?(r.focus=t,r.blurScope=e):r.focus&&(r.focus=null)}var fj=["emphasis","blur","select"],rxt={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function Bo(i,t,e,r){e=e||"itemStyle";for(var n=0;n<fj.length;n++){var o=fj[n],s=t.getModel([o,e]),a=i.ensureState(o);a.style=r?r(s):s[rxt[e]]()}}function $m(i,t){var e=t===!1,r=i;i.highDownSilentOnTouch&&(r.__highDownSilentOnTouch=i.highDownSilentOnTouch),(!e||r.__highDownDispatcher)&&(r.__highByOuter=r.__highByOuter||0,r.__highDownDispatcher=!e)}function aS(i){return!!(i&&i.__highDownDispatcher)}function nxt(i,t,e){var r=cr(i);r.componentMainType=t.mainType,r.componentIndex=t.componentIndex,r.componentHighDownName=e}function axt(i){var t=lj[i];return t==null&&sj<=32&&(t=lj[i]=sj++),t}function oz(i){var t=i.type;return t===BC||t===iz||t===FC}function pj(i){var t=i.type;return t===sv||t===XI}function oxt(i){var t=AK(i);t.normalFill=i.style.fill,t.normalStroke=i.style.stroke;var e=i.states.select||{};t.selectFill=e.style&&e.style.fill||null,t.selectStroke=e.style&&e.style.stroke||null}var wy=Sh.CMD,sxt=[[],[],[]],gj=Math.sqrt,lxt=Math.atan2;function kK(i,t){if(t){var e=i.data,r=i.len(),n,o,s,a,c,f,g=wy.M,v=wy.C,y=wy.L,w=wy.R,I=wy.A,E=wy.Q;for(s=0,a=0;s<r;){switch(n=e[s++],a=s,o=0,n){case g:o=1;break;case y:o=1;break;case v:o=3;break;case E:o=2;break;case I:var D=t[4],R=t[5],z=gj(t[0]*t[0]+t[1]*t[1]),N=gj(t[2]*t[2]+t[3]*t[3]),H=lxt(-t[1]/N,t[0]/z);e[s]*=z,e[s++]+=D,e[s]*=N,e[s++]+=R,e[s++]*=z,e[s++]*=N,e[s++]+=H,e[s++]+=H,s+=2,a=s;break;case w:f[0]=e[s++],f[1]=e[s++],fo(f,f,t),e[a++]=f[0],e[a++]=f[1],f[0]+=e[s++],f[1]+=e[s++],fo(f,f,t),e[a++]=f[0],e[a++]=f[1]}for(c=0;c<o;c++){var q=sxt[c];q[0]=e[s++],q[1]=e[s++],fo(q,q,t),e[a++]=q[0],e[a++]=q[1]}}i.increaseVersion()}}var KL=Math.sqrt,bA=Math.sin,wA=Math.cos,vb=Math.PI;function mj(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function sz(i,t){return(i[0]*t[0]+i[1]*t[1])/(mj(i)*mj(t))}function vj(i,t){return(i[0]*t[1]<i[1]*t[0]?-1:1)*Math.acos(sz(i,t))}function _j(i,t,e,r,n,o,s,a,c,f,g){var v=c*(vb/180),y=wA(v)*(i-e)/2+bA(v)*(t-r)/2,w=-1*bA(v)*(i-e)/2+wA(v)*(t-r)/2,I=y*y/(s*s)+w*w/(a*a);I>1&&(s*=KL(I),a*=KL(I));var E=(n===o?-1:1)*KL((s*s*(a*a)-s*s*(w*w)-a*a*(y*y))/(s*s*(w*w)+a*a*(y*y)))||0,D=E*s*w/a,R=E*-a*y/s,z=(i+e)/2+wA(v)*D-bA(v)*R,N=(t+r)/2+bA(v)*D+wA(v)*R,H=vj([1,0],[(y-D)/s,(w-R)/a]),q=[(y-D)/s,(w-R)/a],Y=[(-1*y-D)/s,(-1*w-R)/a],J=vj(q,Y);if(sz(q,Y)<=-1&&(J=vb),sz(q,Y)>=1&&(J=0),J<0){var it=Math.round(J/vb*1e6)/1e6;J=vb*2+it%2*vb}g.addData(f,z,N,s,a,H,J,v,o)}var uxt=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig,cxt=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function hxt(i){var t=new Sh;if(!i)return t;var e=0,r=0,n=e,o=r,s,a=Sh.CMD,c=i.match(uxt);if(!c)return t;for(var f=0;f<c.length;f++){for(var g=c[f],v=g.charAt(0),y=void 0,w=g.match(cxt)||[],I=w.length,E=0;E<I;E++)w[E]=parseFloat(w[E]);for(var D=0;D<I;){var R=void 0,z=void 0,N=void 0,H=void 0,q=void 0,Y=void 0,J=void 0,it=e,at=r,ut=void 0,ft=void 0;switch(v){case"l":e+=w[D++],r+=w[D++],y=a.L,t.addData(y,e,r);break;case"L":e=w[D++],r=w[D++],y=a.L,t.addData(y,e,r);break;case"m":e+=w[D++],r+=w[D++],y=a.M,t.addData(y,e,r),n=e,o=r,v="l";break;case"M":e=w[D++],r=w[D++],y=a.M,t.addData(y,e,r),n=e,o=r,v="L";break;case"h":e+=w[D++],y=a.L,t.addData(y,e,r);break;case"H":e=w[D++],y=a.L,t.addData(y,e,r);break;case"v":r+=w[D++],y=a.L,t.addData(y,e,r);break;case"V":r=w[D++],y=a.L,t.addData(y,e,r);break;case"C":y=a.C,t.addData(y,w[D++],w[D++],w[D++],w[D++],w[D++],w[D++]),e=w[D-2],r=w[D-1];break;case"c":y=a.C,t.addData(y,w[D++]+e,w[D++]+r,w[D++]+e,w[D++]+r,w[D++]+e,w[D++]+r),e+=w[D-2],r+=w[D-1];break;case"S":R=e,z=r,ut=t.len(),ft=t.data,s===a.C&&(R+=e-ft[ut-4],z+=r-ft[ut-3]),y=a.C,it=w[D++],at=w[D++],e=w[D++],r=w[D++],t.addData(y,R,z,it,at,e,r);break;case"s":R=e,z=r,ut=t.len(),ft=t.data,s===a.C&&(R+=e-ft[ut-4],z+=r-ft[ut-3]),y=a.C,it=e+w[D++],at=r+w[D++],e+=w[D++],r+=w[D++],t.addData(y,R,z,it,at,e,r);break;case"Q":it=w[D++],at=w[D++],e=w[D++],r=w[D++],y=a.Q,t.addData(y,it,at,e,r);break;case"q":it=w[D++]+e,at=w[D++]+r,e+=w[D++],r+=w[D++],y=a.Q,t.addData(y,it,at,e,r);break;case"T":R=e,z=r,ut=t.len(),ft=t.data,s===a.Q&&(R+=e-ft[ut-4],z+=r-ft[ut-3]),e=w[D++],r=w[D++],y=a.Q,t.addData(y,R,z,e,r);break;case"t":R=e,z=r,ut=t.len(),ft=t.data,s===a.Q&&(R+=e-ft[ut-4],z+=r-ft[ut-3]),e+=w[D++],r+=w[D++],y=a.Q,t.addData(y,R,z,e,r);break;case"A":N=w[D++],H=w[D++],q=w[D++],Y=w[D++],J=w[D++],it=e,at=r,e=w[D++],r=w[D++],y=a.A,_j(it,at,e,r,Y,J,N,H,q,y,t);break;case"a":N=w[D++],H=w[D++],q=w[D++],Y=w[D++],J=w[D++],it=e,at=r,e+=w[D++],r+=w[D++],y=a.A,_j(it,at,e,r,Y,J,N,H,q,y,t);break}}(v==="z"||v==="Z")&&(y=a.Z,t.addData(y),e=n,r=o),s=y}return t.toStatic(),t}var OK=function(i){ba(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.applyTransform=function(e){},t}(qr);function zK(i){return i.setData!=null}function BK(i,t){var e=hxt(i),r=Ne({},t);return r.buildPath=function(n){var o=zK(n);if(o&&n.canSave()){n.appendPath(e);var s=n.getContext();s&&n.rebuildPath(s,1)}else{var s=o?n.getContext():n;s&&e.rebuildPath(s,1)}},r.applyTransform=function(n){kK(e,n),this.dirtyShape()},r}function FK(i,t){return new OK(BK(i,t))}function dxt(i,t){var e=BK(i,t),r=function(n){ba(o,n);function o(s){var a=n.call(this,s)||this;return a.applyTransform=e.applyTransform,a.buildPath=e.buildPath,a}return o}(OK);return r}function fxt(i,t){for(var e=[],r=i.length,n=0;n<r;n++){var o=i[n];e.push(o.getUpdatedPathProxy(!0))}var s=new qr(t);return s.createPathProxy(),s.buildPath=function(a){if(zK(a)){a.appendPath(e);var c=a.getContext();c&&a.rebuildPath(c,1)}},s}function HF(i,t){t=t||{};var e=new qr;return i.shape&&e.setShape(i.shape),e.setStyle(i.style),t.bakeTransform?kK(e.path,i.getComputedTransform()):t.toLocal?e.setLocalTransform(i.getComputedTransform()):e.copyTransform(i),e.buildPath=i.buildPath,e.applyTransform=e.applyTransform,e.z=i.z,e.z2=i.z2,e.zlevel=i.zlevel,e}var pxt=function(){function i(){this.cx=0,this.cy=0,this.r=0}return i}(),NK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new pxt},t.prototype.buildPath=function(e,r){e.moveTo(r.cx+r.r,r.cy),e.arc(r.cx,r.cy,r.r,0,Math.PI*2)},t}(qr);NK.prototype.type="circle";const Wp=NK;var gxt=function(){function i(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}return i}(),VK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new gxt},t.prototype.buildPath=function(e,r){var n=.5522848,o=r.cx,s=r.cy,a=r.rx,c=r.ry,f=a*n,g=c*n;e.moveTo(o-a,s),e.bezierCurveTo(o-a,s-g,o-f,s-c,o,s-c),e.bezierCurveTo(o+f,s-c,o+a,s-g,o+a,s),e.bezierCurveTo(o+a,s+g,o+f,s+c,o,s+c),e.bezierCurveTo(o-f,s+c,o-a,s+g,o-a,s),e.closePath()},t}(qr);VK.prototype.type="ellipse";const jF=VK;var UK=Math.PI,JL=UK*2,gm=Math.sin,Sy=Math.cos,mxt=Math.acos,Ms=Math.atan2,yj=Math.abs,Cw=Math.sqrt,tw=Math.max,qc=Math.min,nc=1e-4;function vxt(i,t,e,r,n,o,s,a){var c=e-i,f=r-t,g=s-n,v=a-o,y=v*c-g*f;if(!(y*y<nc))return y=(g*(t-o)-v*(i-n))/y,[i+y*c,t+y*f]}function SA(i,t,e,r,n,o,s){var a=i-e,c=t-r,f=(s?o:-o)/Cw(a*a+c*c),g=f*c,v=-f*a,y=i+g,w=t+v,I=e+g,E=r+v,D=(y+I)/2,R=(w+E)/2,z=I-y,N=E-w,H=z*z+N*N,q=n-o,Y=y*E-I*w,J=(N<0?-1:1)*Cw(tw(0,q*q*H-Y*Y)),it=(Y*N-z*J)/H,at=(-Y*z-N*J)/H,ut=(Y*N+z*J)/H,ft=(-Y*z+N*J)/H,_t=it-D,ct=at-R,Dt=ut-D,Et=ft-R;return _t*_t+ct*ct>Dt*Dt+Et*Et&&(it=ut,at=ft),{cx:it,cy:at,x0:-g,y0:-v,x1:it*(n/q-1),y1:at*(n/q-1)}}function _xt(i){var t;if(Ye(i)){var e=i.length;if(!e)return i;e===1?t=[i[0],i[0],0,0]:e===2?t=[i[0],i[0],i[1],i[1]]:e===3?t=i.concat(i[2]):t=i}else t=[i,i,i,i];return t}function yxt(i,t){var e,r=tw(t.r,0),n=tw(t.r0||0,0),o=r>0,s=n>0;if(!(!o&&!s)){if(o||(r=n,n=0),n>r){var a=r;r=n,n=a}var c=t.startAngle,f=t.endAngle;if(!(isNaN(c)||isNaN(f))){var g=t.cx,v=t.cy,y=!!t.clockwise,w=yj(f-c),I=w>JL&&w%JL;if(I>nc&&(w=I),!(r>nc))i.moveTo(g,v);else if(w>JL-nc)i.moveTo(g+r*Sy(c),v+r*gm(c)),i.arc(g,v,r,c,f,!y),n>nc&&(i.moveTo(g+n*Sy(f),v+n*gm(f)),i.arc(g,v,n,f,c,y));else{var E=void 0,D=void 0,R=void 0,z=void 0,N=void 0,H=void 0,q=void 0,Y=void 0,J=void 0,it=void 0,at=void 0,ut=void 0,ft=void 0,_t=void 0,ct=void 0,Dt=void 0,Et=r*Sy(c),bt=r*gm(c),Vt=n*Sy(f),zt=n*gm(f),Jt=w>nc;if(Jt){var ce=t.cornerRadius;ce&&(e=_xt(ce),E=e[0],D=e[1],R=e[2],z=e[3]);var be=yj(r-n)/2;if(N=qc(be,R),H=qc(be,z),q=qc(be,E),Y=qc(be,D),at=J=tw(N,H),ut=it=tw(q,Y),(J>nc||it>nc)&&(ft=r*Sy(f),_t=r*gm(f),ct=n*Sy(c),Dt=n*gm(c),w<UK)){var ve=vxt(Et,bt,ct,Dt,ft,_t,Vt,zt);if(ve){var ke=Et-ve[0],ni=bt-ve[1],bi=ft-ve[0],or=_t-ve[1],Ue=1/gm(mxt((ke*bi+ni*or)/(Cw(ke*ke+ni*ni)*Cw(bi*bi+or*or)))/2),Ze=Cw(ve[0]*ve[0]+ve[1]*ve[1]);at=qc(J,(r-Ze)/(Ue+1)),ut=qc(it,(n-Ze)/(Ue-1))}}}if(!Jt)i.moveTo(g+Et,v+bt);else if(at>nc){var xe=qc(R,at),Ke=qc(z,at),We=SA(ct,Dt,Et,bt,r,xe,y),Ti=SA(ft,_t,Vt,zt,r,Ke,y);i.moveTo(g+We.cx+We.x0,v+We.cy+We.y0),at<J&&xe===Ke?i.arc(g+We.cx,v+We.cy,at,Ms(We.y0,We.x0),Ms(Ti.y0,Ti.x0),!y):(xe>0&&i.arc(g+We.cx,v+We.cy,xe,Ms(We.y0,We.x0),Ms(We.y1,We.x1),!y),i.arc(g,v,r,Ms(We.cy+We.y1,We.cx+We.x1),Ms(Ti.cy+Ti.y1,Ti.cx+Ti.x1),!y),Ke>0&&i.arc(g+Ti.cx,v+Ti.cy,Ke,Ms(Ti.y1,Ti.x1),Ms(Ti.y0,Ti.x0),!y))}else i.moveTo(g+Et,v+bt),i.arc(g,v,r,c,f,!y);if(!(n>nc)||!Jt)i.lineTo(g+Vt,v+zt);else if(ut>nc){var xe=qc(E,ut),Ke=qc(D,ut),We=SA(Vt,zt,ft,_t,n,-Ke,y),Ti=SA(Et,bt,ct,Dt,n,-xe,y);i.lineTo(g+We.cx+We.x0,v+We.cy+We.y0),ut<it&&xe===Ke?i.arc(g+We.cx,v+We.cy,ut,Ms(We.y0,We.x0),Ms(Ti.y0,Ti.x0),!y):(Ke>0&&i.arc(g+We.cx,v+We.cy,Ke,Ms(We.y0,We.x0),Ms(We.y1,We.x1),!y),i.arc(g,v,n,Ms(We.cy+We.y1,We.cx+We.x1),Ms(Ti.cy+Ti.y1,Ti.cx+Ti.x1),y),xe>0&&i.arc(g+Ti.cx,v+Ti.cy,xe,Ms(Ti.y1,Ti.x1),Ms(Ti.y0,Ti.x0),!y))}else i.lineTo(g+Vt,v+zt),i.arc(g,v,n,f,c,y)}i.closePath()}}}var xxt=function(){function i(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0,this.cornerRadius=0}return i}(),GK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new xxt},t.prototype.buildPath=function(e,r){yxt(e,r)},t.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},t}(qr);GK.prototype.type="sector";const pl=GK;var bxt=function(){function i(){this.cx=0,this.cy=0,this.r=0,this.r0=0}return i}(),HK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new bxt},t.prototype.buildPath=function(e,r){var n=r.cx,o=r.cy,s=Math.PI*2;e.moveTo(n+r.r,o),e.arc(n,o,r.r,0,s,!1),e.moveTo(n+r.r0,o),e.arc(n,o,r.r0,0,s,!0)},t}(qr);HK.prototype.type="ring";const dE=HK;function wxt(i,t,e,r){var n=[],o=[],s=[],a=[],c,f,g,v;if(r){g=[1/0,1/0],v=[-1/0,-1/0];for(var y=0,w=i.length;y<w;y++)fp(g,g,i[y]),pp(v,v,i[y]);fp(g,g,r[0]),pp(v,v,r[1])}for(var y=0,w=i.length;y<w;y++){var I=i[y];if(e)c=i[y?y-1:w-1],f=i[(y+1)%w];else if(y===0||y===w-1){n.push(Ad(i[y]));continue}else c=i[y-1],f=i[y+1];jm(o,f,c),UI(o,o,t);var E=CO(I,c),D=CO(I,f),R=E+D;R!==0&&(E/=R,D/=R),UI(s,o,-E),UI(a,o,D);var z=sH([],I,s),N=sH([],I,a);r&&(pp(z,z,g),fp(z,z,v),pp(N,N,g),fp(N,N,v)),n.push(z),n.push(N)}return e&&n.push(n.shift()),n}function jK(i,t,e){var r=t.smooth,n=t.points;if(n&&n.length>=2){if(r){var o=wxt(n,r,e,t.smoothConstraint);i.moveTo(n[0][0],n[0][1]);for(var s=n.length,a=0;a<(e?s:s-1);a++){var c=o[a*2],f=o[a*2+1],g=n[(a+1)%s];i.bezierCurveTo(c[0],c[1],f[0],f[1],g[0],g[1])}}else{i.moveTo(n[0][0],n[0][1]);for(var a=1,v=n.length;a<v;a++)i.lineTo(n[a][0],n[a][1])}e&&i.closePath()}}var Sxt=function(){function i(){this.points=null,this.smooth=0,this.smoothConstraint=null}return i}(),WK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new Sxt},t.prototype.buildPath=function(e,r){jK(e,r,!0)},t}(qr);WK.prototype.type="polygon";const gl=WK;var Txt=function(){function i(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}return i}(),$K=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new Txt},t.prototype.buildPath=function(e,r){jK(e,r,!1)},t}(qr);$K.prototype.type="polyline";const Us=$K;var Axt={},Ixt=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return i}(),ZK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new Ixt},t.prototype.buildPath=function(e,r){var n,o,s,a;if(this.subPixelOptimize){var c=uE(Axt,r,this.style);n=c.x1,o=c.y1,s=c.x2,a=c.y2}else n=r.x1,o=r.y1,s=r.x2,a=r.y2;var f=r.percent;f!==0&&(e.moveTo(n,o),f<1&&(s=n*(1-f)+s*f,a=o*(1-f)+a*f),e.lineTo(s,a))},t.prototype.pointAt=function(e){var r=this.shape;return[r.x1*(1-e)+r.x2*e,r.y1*(1-e)+r.y2*e]},t}(qr);ZK.prototype.type="line";const Oo=ZK;var El=[],Cxt=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}return i}();function xj(i,t,e){var r=i.cpx2,n=i.cpy2;return r!=null||n!=null?[(e?xH:Wo)(i.x1,i.cpx1,i.cpx2,i.x2,t),(e?xH:Wo)(i.y1,i.cpy1,i.cpy2,i.y2,t)]:[(e?OO:rs)(i.x1,i.cpx1,i.x2,t),(e?OO:rs)(i.y1,i.cpy1,i.y2,t)]}var qK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new Cxt},t.prototype.buildPath=function(e,r){var n=r.x1,o=r.y1,s=r.x2,a=r.y2,c=r.cpx1,f=r.cpy1,g=r.cpx2,v=r.cpy2,y=r.percent;y!==0&&(e.moveTo(n,o),g==null||v==null?(y<1&&(Jw(n,c,s,y,El),c=El[1],s=El[2],Jw(o,f,a,y,El),f=El[1],a=El[2]),e.quadraticCurveTo(c,f,s,a)):(y<1&&(kp(n,c,g,s,y,El),c=El[1],g=El[2],s=El[3],kp(o,f,v,a,y,El),f=El[1],v=El[2],a=El[3]),e.bezierCurveTo(c,f,g,v,s,a)))},t.prototype.pointAt=function(e){return xj(this.shape,e,!1)},t.prototype.tangentAt=function(e){var r=xj(this.shape,e,!0);return B0(r,r)},t}(qr);qK.prototype.type="bezier-curve";const fE=qK;var Mxt=function(){function i(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return i}(),XK=function(i){ba(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},t.prototype.getDefaultShape=function(){return new Mxt},t.prototype.buildPath=function(e,r){var n=r.cx,o=r.cy,s=Math.max(r.r,0),a=r.startAngle,c=r.endAngle,f=r.clockwise,g=Math.cos(a),v=Math.sin(a);e.moveTo(g*s+n,v*s+o),e.arc(n,o,s,a,c,!f)},t}(qr);XK.prototype.type="arc";const WF=XK;var Ext=function(i){ba(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="compound",e}return t.prototype._updatePathDirty=function(){for(var e=this.shape.paths,r=this.shapeChanged(),n=0;n<e.length;n++)r=r||e[n].shapeChanged();r&&this.dirtyShape()},t.prototype.beforeBrush=function(){this._updatePathDirty();for(var e=this.shape.paths||[],r=this.getGlobalScale(),n=0;n<e.length;n++)e[n].path||e[n].createPathProxy(),e[n].path.setScale(r[0],r[1],e[n].segmentIgnoreThreshold)},t.prototype.buildPath=function(e,r){for(var n=r.paths||[],o=0;o<n.length;o++)n[o].buildPath(e,n[o].shape,!0)},t.prototype.afterBrush=function(){for(var e=this.shape.paths||[],r=0;r<e.length;r++)e[r].pathUpdated()},t.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),qr.prototype.getBoundingRect.call(this)},t}(qr);const pE=Ext;var Dxt=function(){function i(t){this.colorStops=t||[]}return i.prototype.addColorStop=function(t,e){this.colorStops.push({offset:t,color:e})},i}();const YK=Dxt;var Pxt=function(i){ba(t,i);function t(e,r,n,o,s,a){var c=i.call(this,s)||this;return c.x=e??0,c.y=r??0,c.x2=n??1,c.y2=o??0,c.type="linear",c.global=a||!1,c}return t}(YK);const U0=Pxt;var Lxt=function(i){ba(t,i);function t(e,r,n,o,s){var a=i.call(this,o)||this;return a.x=e??.5,a.y=r??.5,a.r=n??.5,a.type="radial",a.global=s||!1,a}return t}(YK);const KK=Lxt;var QL=Math.min,Rxt=Math.max,TA=Math.abs,mm=[0,0],vm=[0,0],is=bY(),AA=is.minTv,IA=is.maxTv,kxt=function(){function i(t,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var r=0;r<4;r++)this._corners[r]=new er;for(var r=0;r<2;r++)this._axes[r]=new er;t&&this.fromBoundingRect(t,e)}return i.prototype.fromBoundingRect=function(t,e){var r=this._corners,n=this._axes,o=t.x,s=t.y,a=o+t.width,c=s+t.height;if(r[0].set(o,s),r[1].set(a,s),r[2].set(a,c),r[3].set(o,c),e)for(var f=0;f<4;f++)r[f].transform(e);er.sub(n[0],r[1],r[0]),er.sub(n[1],r[3],r[0]),n[0].normalize(),n[1].normalize();for(var f=0;f<2;f++)this._origin[f]=n[f].dot(r[0])},i.prototype.intersect=function(t,e,r){var n=!0,o=!e;return e&&er.set(e,0,0),is.reset(r,!o),!this._intersectCheckOneSide(this,t,o,1)&&(n=!1,o)||!this._intersectCheckOneSide(t,this,o,-1)&&(n=!1,o)||!o&&!is.negativeSize&&er.copy(e,n?is.useDir?is.dirMinTv:AA:IA),n},i.prototype._intersectCheckOneSide=function(t,e,r,n){for(var o=!0,s=0;s<2;s++){var a=t._axes[s];if(t._getProjMinMaxOnAxis(s,t._corners,mm),t._getProjMinMaxOnAxis(s,e._corners,vm),is.negativeSize||mm[1]<vm[0]||mm[0]>vm[1]){if(o=!1,is.negativeSize||r)return o;var c=TA(vm[0]-mm[1]),f=TA(mm[0]-vm[1]);QL(c,f)>IA.len()&&(c<f?er.scale(IA,a,-c*n):er.scale(IA,a,f*n))}else if(!r){var c=TA(vm[0]-mm[1]),f=TA(mm[0]-vm[1]);(is.useDir||QL(c,f)<AA.len())&&((c<f||!is.bidirectional)&&(er.scale(AA,a,c*n),is.useDir&&is.calcDirMTV()),(c>=f||!is.bidirectional)&&(er.scale(AA,a,-f*n),is.useDir&&is.calcDirMTV()))}}return o},i.prototype._getProjMinMaxOnAxis=function(t,e,r){for(var n=this._axes[t],o=this._origin,s=e[0].dot(n)+o[t],a=s,c=s,f=1;f<e.length;f++){var g=e[f].dot(n)+o[t];a=QL(g,a),c=Rxt(g,c)}r[0]=a+is.touchThreshold,r[1]=c-is.touchThreshold,is.negativeSize=r[1]<r[0]},i}();const JK=kxt;var Oxt=[],zxt=function(i){ba(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return t.prototype.traverse=function(e,r){e.call(r,this)},t.prototype.useStyle=function(){this.style={}},t.prototype.getCursor=function(){return this._cursor},t.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},t.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},t.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},t.prototype.addDisplayable=function(e,r){r?this._temporaryDisplayables.push(e):this._displayables.push(e),this.markRedraw()},t.prototype.addDisplayables=function(e,r){r=r||!1;for(var n=0;n<e.length;n++)this.addDisplayable(e[n],r)},t.prototype.getDisplayables=function(){return this._displayables},t.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},t.prototype.eachPendingDisplayable=function(e){for(var r=this._cursor;r<this._displayables.length;r++)e&&e(this._displayables[r]);for(var r=0;r<this._temporaryDisplayables.length;r++)e&&e(this._temporaryDisplayables[r])},t.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var r=this._displayables[e];r.parent=this,r.update(),r.parent=null}for(var e=0;e<this._temporaryDisplayables.length;e++){var r=this._temporaryDisplayables[e];r.parent=this,r.update(),r.parent=null}},t.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new sr(1/0,1/0,-1/0,-1/0),r=0;r<this._displayables.length;r++){var n=this._displayables[r],o=n.getBoundingRect().clone();n.needLocalTransform()&&o.applyTransform(n.getLocalTransform(Oxt)),e.union(o)}this._rect=e}return this._rect},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();if(o.contain(n[0],n[1]))for(var s=0;s<this._displayables.length;s++){var a=this._displayables[s];if(a.contain(e,r))return!0}return!1},t}(Ou);const Bxt=zxt;var QK=Wr();function G0(i,t,e,r,n){var o;if(t&&t.ecModel){var s=t.ecModel.getUpdatePayload();o=s&&s.animation}var a=t&&t.isAnimationEnabled(),c=i==="update";if(a){var f=void 0,g=void 0,v=void 0;r?(f=Ui(r.duration,200),g=Ui(r.easing,"cubicOut"),v=0):(f=t.getShallow(c?"animationDurationUpdate":"animationDuration"),g=t.getShallow(c?"animationEasingUpdate":"animationEasing"),v=t.getShallow(c?"animationDelayUpdate":"animationDelay")),o&&(o.duration!=null&&(f=o.duration),o.easing!=null&&(g=o.easing),o.delay!=null&&(v=o.delay)),Xi(v)&&(v=v(e,n)),Xi(f)&&(f=f(e));var y={duration:f||0,delay:v,easing:g};return y}else return null}function $F(i,t,e,r,n,o,s){var a=!1,c;Xi(n)?(s=o,o=n,n=null):nr(n)&&(o=n.cb,s=n.during,a=n.isFrom,c=n.removeOpt,n=n.dataIndex);var f=i==="leave";f||t.stopAnimation("leave");var g=G0(i,r,n,f?c||{}:null,r&&r.getAnimationDelayParams?r.getAnimationDelayParams(t,n):null);if(g&&g.duration>0){var v=g.duration,y=g.delay,w=g.easing,I={duration:v,delay:y||0,easing:w,done:o,force:!!o||!!s,setToFinal:!f,scope:i,during:s};a?t.animateFrom(e,I):t.animateTo(e,I)}else t.stopAnimation(),!a&&t.attr(e),s&&s(1),o&&o()}function yn(i,t,e,r,n,o){$F("update",i,t,e,r,n,o)}function xa(i,t,e,r,n,o){$F("enter",i,t,e,r,n,o)}function c0(i){if(!i.__zr)return!0;for(var t=0;t<i.animators.length;t++){var e=i.animators[t];if(e.scope==="leave")return!0}return!1}function Op(i,t,e,r,n,o){c0(i)||$F("leave",i,t,e,r,n,o)}function bj(i,t,e,r){i.removeTextContent(),i.removeTextGuideLine(),Op(i,{style:{opacity:0}},t,e,r)}function Id(i,t,e){function r(){i.parent&&i.parent.remove(i)}i.isGroup?i.traverse(function(n){n.isGroup||bj(n,t,e,r)}):bj(i,t,e,r)}function zu(i){QK(i).oldStyle=i.style}function Fxt(i){return QK(i).oldStyle}var lz={},vr=["x","y"],wo=["width","height"];function Nxt(i){return qr.extend(i)}var Vxt=dxt;function Uxt(i,t){return Vxt(i,t)}function bc(i,t){lz[i]=t}function VC(i){if(lz.hasOwnProperty(i))return lz[i]}function oS(i,t,e,r){var n=FK(i,t);return e&&(r==="center"&&(e=eJ(e,n.getBoundingRect())),iJ(n,e)),n}function tJ(i,t,e){var r=new ys({style:{image:i,x:t.x,y:t.y,width:t.width,height:t.height},onload:function(n){if(e==="center"){var o={width:n.width,height:n.height};r.setStyle(eJ(t,o))}}});return r}function eJ(i,t){var e=t.width/t.height,r=i.height*e,n;r<=i.width?n=i.height:(r=i.width,n=r/e);var o=i.x+i.width/2,s=i.y+i.height/2;return{x:o-r/2,y:s-n/2,width:r,height:n}}var Mu=fxt;function iJ(i,t){if(i.applyTransform){var e=i.getBoundingRect(),r=e.calculateTransform(t);i.applyTransform(r)}}function S0(i,t){return uE(i,i,{lineWidth:t}),i}function Gxt(i,t){return xK(i,i,t),i}var YI=eu;function uv(i,t){for(var e=tE([]);i&&i!==t;)ph(e,i.getLocalTransform(),e),i=i.parent;return e}function pc(i,t,e){return t&&!Ns(t)&&(t=xd.getLocalTransform(t)),e&&(t=_c([],t)),fo([],i,t)}function gE(i,t,e){var r=t[4]===0||t[5]===0||t[0]===0?1:sh(2*t[4]/t[0]),n=t[4]===0||t[5]===0||t[2]===0?1:sh(2*t[4]/t[2]),o=[i==="left"?-r:i==="right"?r:0,i==="top"?-n:i==="bottom"?n:0];return o=pc(o,t,e),sh(o[0])>sh(o[1])?o[0]>0?"right":"left":o[1]>0?"bottom":"top"}function wj(i){return!i.isGroup}function Hxt(i){return i.shape!=null}function VS(i,t,e){if(!i||!t)return;function r(s){var a={};return s.traverse(function(c){wj(c)&&c.anid&&(a[c.anid]=c)}),a}function n(s){var a={x:s.x,y:s.y,rotation:s.rotation};return Hxt(s)&&(a.shape=Yi(s.shape)),a}var o=r(i);t.traverse(function(s){if(wj(s)&&s.anid){var a=o[s.anid];if(a){var c=n(s);s.attr(n(a)),yn(s,c,e,cr(s).dataIndex)}}})}function rJ(i,t){return ti(i,function(e){var r=e[0];r=co(r,t.x),r=ru(r,t.x+t.width);var n=e[1];return n=co(n,t.y),n=ru(n,t.y+t.height),[r,n]})}function jxt(i,t){var e=co(i.x,t.x),r=ru(i.x+i.width,t.x+t.width),n=co(i.y,t.y),o=ru(i.y+i.height,t.y+t.height);if(r>=e&&o>=n)return{x:e,y:n,width:r-e,height:o-n}}function US(i,t,e){var r=Ne({rectHover:!0},t),n=r.style={strokeNoScale:!0};if(e=e||{x:-1,y:-1,width:2,height:2},i)return i.indexOf("image://")===0?(n.image=i.slice(8),rr(n,e),new ys(r)):oS(i.replace("path://",""),r,e,"center")}function ew(i,t,e,r,n){for(var o=0,s=n[n.length-1];o<n.length;o++){var a=n[o];if(nJ(i,t,e,r,a[0],a[1],s[0],s[1]))return!0;s=a}}function nJ(i,t,e,r,n,o,s,a){var c=e-i,f=r-t,g=s-n,v=a-o,y=tR(g,v,c,f);if(Wxt(y))return!1;var w=i-n,I=t-o,E=tR(w,I,c,f)/y;if(E<0||E>1)return!1;var D=tR(w,I,g,v)/y;return!(D<0||D>1)}function tR(i,t,e,r){return i*r-e*t}function Wxt(i){return i<=1e-6&&i>=-1e-6}function xv(i,t,e,r,n){return t==null||(fn(t)?La[0]=La[1]=La[2]=La[3]=t:(La[0]=t[0],La[1]=t[1],La[2]=t[2],La[3]=t[3]),r&&(La[0]=co(0,La[0]),La[1]=co(0,La[1]),La[2]=co(0,La[2]),La[3]=co(0,La[3])),e&&(La[0]=-La[0],La[1]=-La[1],La[2]=-La[2],La[3]=-La[3]),Sj(i,La,"x","width",3,1,n&&n[0]||0),Sj(i,La,"y","height",0,2,n&&n[1]||0)),i}var La=[0,0,0,0];function Sj(i,t,e,r,n,o,s){var a=t[o]+t[n],c=i[r];i[r]+=a,s=co(0,ru(s,c)),i[r]<s?(i[r]=s,i[e]+=t[n]>=0?-t[n]:t[o]>=0?c+t[o]:sh(a)>1e-8?(c-s)*t[n]/a:0):i[e]-=t[n]}function Wd(i){var t=i.itemTooltipOption,e=i.componentModel,r=i.itemName,n=wi(t)?{formatter:t}:t,o=e.mainType,s=e.componentIndex,a={componentType:o,name:r,$vars:["name"]};a[o+"Index"]=s;var c=i.formatterParamsExtra;c&&pt(on(c),function(g){Pi(a,g)||(a[g]=c[g],a.$vars.push(g))});var f=cr(i.el);f.componentMainType=o,f.componentIndex=s,f.tooltipConfig={name:r,option:rr({content:r,encodeHTMLContent:!0,formatterParams:a},n)}}function uz(i,t){var e;i.isGroup&&(e=t(i)),e||i.traverse(t)}function $p(i,t){if(i)if(Ye(i))for(var e=0;e<i.length;e++)uz(i[e],t);else uz(i,t)}function ZF(i){return!i||sh(i[1])<CA&&sh(i[2])<CA||sh(i[0])<CA&&sh(i[3])<CA}var CA=1e-5;function sS(i,t){return i?sr.copy(i,t):t.clone()}function qF(i,t){return t?eE(i||as(),t):void 0}function bv(i){return{z:i.get("z")||0,zlevel:i.get("zlevel")||0}}function aJ(i){var t=-1/0,e=1/0;uz(i,function(o){r(o),r(o.getTextContent()),r(o.getTextGuideLine())});function r(o){if(!(!o||o.isGroup)){var s=o.currentStates;if(s.length)for(var a=0;a<s.length;a++)n(o.states[s[a]]);n(o)}}function n(o){if(o){var s=o.z2;s>t&&(t=s),s<e&&(e=s)}}return e>t&&(e=t=0),{min:e,max:t}}function mE(i,t,e){oJ(i,t,e,-1/0)}function oJ(i,t,e,r){if(i.ignoreModelZ)return r;var n=i.getTextContent(),o=i.getTextGuideLine(),s=i.isGroup;if(s)for(var a=i.childrenRef(),c=0;c<a.length;c++)r=co(oJ(a[c],t,e,r),r);else i.z=t,i.zlevel=e,r=co(i.z2||0,r);if(n&&(n.z=t,n.zlevel=e,isFinite(r)&&(n.z2=r+2)),o){var f=i.textGuideLineConfig;o.z=t,o.zlevel=e,isFinite(r)&&(o.z2=r+(f&&f.showAbove?1:-1))}return r}bc("circle",Wp);bc("ellipse",jF);bc("sector",pl);bc("ring",dE);bc("polygon",gl);bc("polyline",Us);bc("rect",jr);bc("line",Oo);bc("bezierCurve",fE);bc("arc",WF);const Ev=Object.freeze(Object.defineProperty({__proto__:null,Arc:WF,BezierCurve:fE,BoundingRect:sr,Circle:Wp,CompoundPath:pE,Ellipse:jF,Group:Ki,Image:ys,IncrementalDisplayable:Bxt,Line:Oo,LinearGradient:U0,OrientedBoundingRect:JK,Path:qr,Point:er,Polygon:gl,Polyline:Us,RadialGradient:KK,Rect:jr,Ring:dE,Sector:pl,Text:_n,WH:wo,XY:vr,applyTransform:pc,calcZ2Range:aJ,clipPointsByRect:rJ,clipRectByRect:jxt,createIcon:US,ensureCopyRect:sS,ensureCopyTransform:qF,expandOrShrinkRect:xv,extendPath:Uxt,extendShape:Nxt,getShapeClass:VC,getTransform:uv,groupTransition:VS,initProps:xa,isBoundingRectAxisAligned:ZF,isElementRemoved:c0,lineLineIntersect:nJ,linePolygonIntersect:ew,makeImage:tJ,makePath:oS,mergePath:Mu,registerShape:bc,removeElement:Op,removeElementWithFadeOut:Id,resizePath:iJ,retrieveZInfo:bv,setTooltipConfig:Wd,subPixelOptimize:YI,subPixelOptimizeLine:S0,subPixelOptimizeRect:Gxt,transformDirection:gE,traverseElements:$p,traverseUpdateZ:mE,updateProps:yn},Symbol.toStringTag,{value:"Module"}));var vE={};function sJ(i,t){for(var e=0;e<fl.length;e++){var r=fl[e],n=t[r],o=i.ensureState(r);o.style=o.style||{},o.style.text=n}var s=i.currentStates.slice();i.clearStates(!0),i.setStyle({text:t.normal}),i.useStates(s,!0)}function cz(i,t,e){var r=i.labelFetcher,n=i.labelDataIndex,o=i.labelDimIndex,s=t.normal,a;r&&(a=r.getFormattedLabel(n,"normal",null,o,s&&s.get("formatter"),e!=null?{interpolatedValue:e}:null)),a==null&&(a=Xi(i.defaultText)?i.defaultText(n,i,e):i.defaultText);for(var c={normal:a},f=0;f<fl.length;f++){var g=fl[f],v=t[g];c[g]=Ui(r?r.getFormattedLabel(n,g,null,o,v&&v.get("formatter")):null,a)}return c}function Xo(i,t,e,r){e=e||vE;for(var n=i instanceof _n,o=!1,s=0;s<nS.length;s++){var a=t[nS[s]];if(a&&a.getShallow("show")){o=!0;break}}var c=n?i:i.getTextContent();if(o){n||(c||(c=new _n,i.setTextContent(c)),i.stateProxy&&(c.stateProxy=i.stateProxy));var f=cz(e,t),g=t.normal,v=!!g.getShallow("show"),y=pa(g,r&&r.normal,e,!1,!n);y.text=f.normal,n||i.setTextConfig(UC(g,e,!1));for(var s=0;s<fl.length;s++){var w=fl[s],a=t[w];if(a){var I=c.ensureState(w),E=!!Ui(a.getShallow("show"),v);if(E!==v&&(I.ignore=!E),I.style=pa(a,r&&r[w],e,!0,!n),I.style.text=f[w],!n){var D=i.ensureState(w);D.textConfig=UC(a,e,!0)}}}c.silent=!!g.getShallow("silent"),c.style.x!=null&&(y.x=c.style.x),c.style.y!=null&&(y.y=c.style.y),c.ignore=!v,c.useStyle(y),c.dirty(),e.enableTextSetter&&(H0(c).setLabelText=function(R){var z=cz(e,t,R);sJ(c,z)})}else c&&(c.ignore=!0);i.dirty()}function Fo(i,t){t=t||"label";for(var e={normal:i.getModel(t)},r=0;r<fl.length;r++){var n=fl[r];e[n]=i.getModel([n,t])}return e}function pa(i,t,e,r,n){var o={};return $xt(o,i,e,r,n),t&&Ne(o,t),o}function UC(i,t,e){t=t||{};var r={},n,o=i.getShallow("rotate"),s=Ui(i.getShallow("distance"),e?null:5),a=i.getShallow("offset");return n=i.getShallow("position")||(e?null:"inside"),n==="outside"&&(n=t.defaultOutsidePosition||"top"),n!=null&&(r.position=n),a!=null&&(r.offset=a),o!=null&&(o*=Math.PI/180,r.rotation=o),s!=null&&(r.distance=s),r.outsideFill=i.get("color")==="inherit"?t.inheritColor||null:"auto",t.autoOverflowArea!=null&&(r.autoOverflowArea=t.autoOverflowArea),t.layoutRect!=null&&(r.layoutRect=t.layoutRect),r}function $xt(i,t,e,r,n){e=e||vE;var o=t.ecModel,s=o&&o.option.textStyle,a=Zxt(t),c;if(a){c={};var f="richInheritPlainLabel",g=Ui(t.get(f),o?o.get(f):void 0);for(var v in a)if(a.hasOwnProperty(v)){var y=t.getModel(["rich",v]);Cj(c[v]={},y,s,t,g,e,r,n,!1,!0)}}c&&(i.rich=c);var w=t.get("overflow");w&&(i.overflow=w);var I=t.get("lineOverflow");I&&(i.lineOverflow=I);var E=i,D=t.get("minMargin");if(D!=null)D=fn(D)?D/2:0,E.margin=[D,D,D,D],E.__marginType=Jy.minMargin;else{var R=t.get("textMargin");R!=null&&(E.margin=JM(R),E.__marginType=Jy.textMargin)}Cj(i,t,s,null,null,e,r,n,!0,!1)}function Zxt(i){for(var t;i&&i!==i.ecModel;){var e=(i.option||vE).rich;if(e){t=t||{};for(var r=on(e),n=0;n<r.length;n++){var o=r[n];t[o]=1}}i=i.parentModel}return t}var Tj=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],Aj=["align","lineHeight","width","height","tag","verticalAlign","ellipsis"],Ij=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function Cj(i,t,e,r,n,o,s,a,c,f){e=!s&&e||vE;var g=o&&o.inheritColor,v=t.getShallow("color"),y=t.getShallow("textBorderColor"),w=Ui(t.getShallow("opacity"),e.opacity);(v==="inherit"||v==="auto")&&(g?v=g:v=null),(y==="inherit"||y==="auto")&&(g?y=g:y=null),a||(v=v||e.color,y=y||e.textBorderColor),v!=null&&(i.fill=v),y!=null&&(i.stroke=y);var I=Ui(t.getShallow("textBorderWidth"),e.textBorderWidth);I!=null&&(i.lineWidth=I);var E=Ui(t.getShallow("textBorderType"),e.textBorderType);E!=null&&(i.lineDash=E);var D=Ui(t.getShallow("textBorderDashOffset"),e.textBorderDashOffset);D!=null&&(i.lineDashOffset=D),!s&&w==null&&!f&&(w=o&&o.defaultOpacity),w!=null&&(i.opacity=w),!s&&!a&&i.fill==null&&o.inheritColor&&(i.fill=o.inheritColor);for(var R=0;R<Tj.length;R++){var z=Tj[R],N=n!==!1&&r?iu(t.getShallow(z),r.getShallow(z),e[z]):Ui(t.getShallow(z),e[z]);N!=null&&(i[z]=N)}for(var R=0;R<Aj.length;R++){var z=Aj[R],N=t.getShallow(z);N!=null&&(i[z]=N)}if(i.verticalAlign==null){var H=t.getShallow("baseline");H!=null&&(i.verticalAlign=H)}if(!c||!o.disableBox){for(var R=0;R<Ij.length;R++){var z=Ij[R],N=t.getShallow(z);N!=null&&(i[z]=N)}var q=t.getShallow("borderType");q!=null&&(i.borderDash=q),(i.backgroundColor==="auto"||i.backgroundColor==="inherit")&&g&&(i.backgroundColor=g),(i.borderColor==="auto"||i.borderColor==="inherit")&&g&&(i.borderColor=g)}}function XF(i,t){var e=t&&t.getModel("textStyle");return Du([i.fontStyle||e&&e.getShallow("fontStyle")||"",i.fontWeight||e&&e.getShallow("fontWeight")||"",(i.fontSize||e&&e.getShallow("fontSize")||12)+"px",i.fontFamily||e&&e.getShallow("fontFamily")||"sans-serif"].join(" "))}var H0=Wr();function lJ(i,t,e,r){if(i){var n=H0(i);n.prevValue=n.value,n.value=e;var o=t.normal;n.valueAnimation=o.get("valueAnimation"),n.valueAnimation&&(n.precision=o.get("precision"),n.defaultInterpolatedText=r,n.statesModels=t)}}function uJ(i,t,e,r,n){var o=H0(i);if(!o.valueAnimation||o.prevValue===o.value)return;var s=o.defaultInterpolatedText,a=Ui(o.interpolatedValue,o.prevValue),c=o.value;function f(g){var v=uK(e,o.precision,a,c,g);o.interpolatedValue=g===1?null:v;var y=cz({labelDataIndex:t,labelFetcher:n,defaultText:s?s(v):v+""},o.statesModels,v);sJ(i,y)}i.percent=0,(o.prevValue==null?xa:yn)(i,{percent:1},r,t,null,f)}var Jy={minMargin:1,textMargin:2},qxt=["textStyle","color"],eR=["fontStyle","fontWeight","fontSize","fontFamily","padding","lineHeight","rich","width","height","overflow"],iR=new _n,Xxt=function(){function i(){}return i.prototype.getTextColor=function(t){var e=this.ecModel;return this.getShallow("color")||(!t&&e?e.get(qxt):null)},i.prototype.getFont=function(){return XF({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},i.prototype.getTextRect=function(t){for(var e={text:t,verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline")},r=0;r<eR.length;r++)e[eR[r]]=this.getShallow(eR[r]);return iR.useStyle(e),iR.update(),iR.getBoundingRect()},i}();const Yxt=Xxt;var cJ=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]],Kxt=_v(cJ),Jxt=function(){function i(){}return i.prototype.getLineStyle=function(t){return Kxt(this,t)},i}(),hJ=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]],Qxt=_v(hJ),t1t=function(){function i(){}return i.prototype.getItemStyle=function(t,e){return Qxt(this,t,e)},i}(),Dv=function(){function i(t,e,r){this.parentModel=e,this.ecModel=r,this.option=t}return i.prototype.init=function(t,e,r){},i.prototype.mergeOption=function(t,e){Er(this.option,t,!0)},i.prototype.get=function(t,e){return t==null?this.option:this._doGet(this.parsePath(t),!e&&this.parentModel)},i.prototype.getShallow=function(t,e){var r=this.option,n=r==null?r:r[t];if(n==null&&!e){var o=this.parentModel;o&&(n=o.getShallow(t))}return n},i.prototype.getModel=function(t,e){var r=t!=null,n=r?this.parsePath(t):null,o=r?this._doGet(n):this.option;return e=e||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(n)),new i(o,e,this.ecModel)},i.prototype.isEmpty=function(){return this.option==null},i.prototype.restoreData=function(){},i.prototype.clone=function(){var t=this.constructor;return new t(Yi(this.option))},i.prototype.parsePath=function(t){return typeof t=="string"?t.split("."):t},i.prototype.resolveParentPath=function(t){return t},i.prototype.isAnimationEnabled=function(){if(!Sn.node&&this.option){if(this.option.animation!=null)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}},i.prototype._doGet=function(t,e){var r=this.option;if(!t)return r;for(var n=0;n<t.length&&!(t[n]&&(r=r&&typeof r=="object"?r[t[n]]:null,r==null));n++);return r==null&&e&&(r=e._doGet(this.resolveParentPath(t),e.parentModel)),r},i}();kF(Dv);Jyt(Dv);Ao(Dv,Jxt);Ao(Dv,t1t);Ao(Dv,r0t);Ao(Dv,Yxt);const bn=Dv;var e1t=Math.round(Math.random()*10);function j0(i){return[i||"",e1t++].join("_")}function i1t(i){var t={};i.registerSubTypeDefaulter=function(e,r){var n=uh(e);t[n.main]=r},i.determineSubType=function(e,r){var n=r.type;if(!n){var o=uh(e).main;i.hasSubTypes(e)&&t[o]&&(n=t[o](r))}return n}}function r1t(i,t){i.topologicalTravel=function(o,s,a,c){if(!o.length)return;var f=e(s),g=f.graph,v=f.noEntryList,y={};for(pt(o,function(z){y[z]=!0});v.length;){var w=v.pop(),I=g[w],E=!!y[w];E&&(a.call(c,w,I.originalDeps.slice()),delete y[w]),pt(I.successor,E?R:D)}pt(y,function(){var z="";throw new Error(z)});function D(z){g[z].entryCount--,g[z].entryCount===0&&v.push(z)}function R(z){y[z]=!0,D(z)}};function e(o){var s={},a=[];return pt(o,function(c){var f=r(s,c),g=f.originalDeps=t(c),v=n(g,o);f.entryCount=v.length,f.entryCount===0&&a.push(c),pt(v,function(y){Ar(f.predecessor,y)<0&&f.predecessor.push(y);var w=r(s,y);Ar(w.successor,y)<0&&w.successor.push(c)})}),{graph:s,noEntryList:a}}function r(o,s){return o[s]||(o[s]={predecessor:[],successor:[]}),o[s]}function n(o,s){var a=[];return pt(o,function(c){Ar(s,c)>=0&&a.push(c)}),a}}function Zp(i,t){return Er(Er({},i,!0),t,!0)}const n1t={time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst",custom:"Custom chart",chart:"Chart"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}},a1t={time:{month:["","","","","","","","","","","",""],monthAbbr:["1","2","3","4","5","6","7","8","9","10","11","12"],dayOfWeek:["","","","","","",""],dayOfWeekAbbr:["","","","","","",""]},legend:{selector:{all:"",inverse:""}},toolbox:{brush:{title:{rect:"",polygon:"",lineX:"",lineY:"",keep:"",clear:""}},dataView:{title:"",lang:["","",""]},dataZoom:{title:{zoom:"",back:""}},magicType:{title:{line:"",bar:"",stack:"",tiled:""}},restore:{title:""},saveAsImage:{title:"",lang:[""]}},series:{typeNames:{pie:"",bar:"",line:"",scatter:"",effectScatter:"",radar:"",tree:"",treemap:"",boxplot:"",candlestick:"K",k:"K",heatmap:"",map:"",parallel:"",lines:"",graph:"",sankey:"",funnel:"",gauge:"",pictorialBar:"",themeRiver:"",sunburst:"",custom:"",chart:""}},aria:{general:{withTitle:"{title}",withoutTitle:""},series:{single:{prefix:"",withName:"{seriesType}{seriesName}",withoutName:"{seriesType}"},multiple:{prefix:"{seriesCount}",withName:"{seriesId}{seriesName}{seriesType}",withoutName:"{seriesId}{seriesType}",separator:{middle:"",end:""}}},data:{allData:"",partialData:"{displayCnt}",withName:"{name}{value}",withoutName:"{value}",separator:{middle:"",end:""}}}};var GC="ZH",YF="EN",h0=YF,KI={},KF={},dJ=Sn.domSupported?function(){var i=(document.documentElement.lang||navigator.language||navigator.browserLanguage||h0).toUpperCase();return i.indexOf(GC)>-1?GC:h0}():h0;function fJ(i,t){i=i.toUpperCase(),KF[i]=new bn(t),KI[i]=t}function o1t(i){if(wi(i)){var t=KI[i.toUpperCase()]||{};return i===GC||i===YF?Yi(t):Er(Yi(t),Yi(KI[h0]),!1)}else return Er(Yi(i),Yi(KI[h0]),!1)}function hz(i){return KF[i]}function s1t(){return KF[h0]}fJ(YF,n1t);fJ(GC,a1t);var dz=null;function l1t(i){dz||(dz=i)}function bo(){return dz}var JF=1e3,QF=JF*60,Mw=QF*60,Eu=Mw*24,Mj=Eu*365,u1t={year:/({yyyy}|{yy})/,month:/({MMMM}|{MMM}|{MM}|{M})/,day:/({dd}|{d})/,hour:/({HH}|{H}|{hh}|{h})/,minute:/({mm}|{m})/,second:/({ss}|{s})/,millisecond:/({SSS}|{S})/},JI={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{HH}:{mm}:{ss} {SSS}"},c1t="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss} {SSS}",MA="{yyyy}-{MM}-{dd}",Ej={year:"{yyyy}",month:"{yyyy}-{MM}",day:MA,hour:MA+" "+JI.hour,minute:MA+" "+JI.minute,second:MA+" "+JI.second,millisecond:c1t},Zl=["year","month","day","hour","minute","second","millisecond"],h1t=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function d1t(i){return!wi(i)&&!Xi(i)?f1t(i):i}function f1t(i){i=i||{};var t={},e=!0;return pt(Zl,function(r){e&&(e=i[r]==null)}),pt(Zl,function(r,n){var o=i[r];t[r]={};for(var s=null,a=n;a>=0;a--){var c=Zl[a],f=nr(o)&&!Ye(o)?o[c]:o,g=void 0;Ye(f)?(g=f.slice(),s=g[0]||""):wi(f)?(s=f,g=[s]):(s==null?s=JI[r]:u1t[c].test(s)||(s=t[c][c][0]+" "+s),g=[s],e&&(g[1]="{primary|"+s+"}")),t[r][c]=g}}),t}function Hf(i,t){return i+="","0000".substr(0,t-i.length)+i}function Ew(i){switch(i){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return i}}function p1t(i){return i===Ew(i)}function g1t(i){switch(i){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}function _E(i,t,e,r){var n=Mv(i),o=n[pJ(e)](),s=n[t3(e)]()+1,a=Math.floor((s-1)/3)+1,c=n[e3(e)](),f=n["get"+(e?"UTC":"")+"Day"](),g=n[i3(e)](),v=(g-1)%12+1,y=n[r3(e)](),w=n[n3(e)](),I=n[a3(e)](),E=g>=12?"pm":"am",D=E.toUpperCase(),R=r instanceof bn?r:hz(r||dJ)||s1t(),z=R.getModel("time"),N=z.get("month"),H=z.get("monthAbbr"),q=z.get("dayOfWeek"),Y=z.get("dayOfWeekAbbr");return(t||"").replace(/{a}/g,E+"").replace(/{A}/g,D+"").replace(/{yyyy}/g,o+"").replace(/{yy}/g,Hf(o%100+"",2)).replace(/{Q}/g,a+"").replace(/{MMMM}/g,N[s-1]).replace(/{MMM}/g,H[s-1]).replace(/{MM}/g,Hf(s,2)).replace(/{M}/g,s+"").replace(/{dd}/g,Hf(c,2)).replace(/{d}/g,c+"").replace(/{eeee}/g,q[f]).replace(/{ee}/g,Y[f]).replace(/{e}/g,f+"").replace(/{HH}/g,Hf(g,2)).replace(/{H}/g,g+"").replace(/{hh}/g,Hf(v+"",2)).replace(/{h}/g,v+"").replace(/{mm}/g,Hf(y,2)).replace(/{m}/g,y+"").replace(/{ss}/g,Hf(w,2)).replace(/{s}/g,w+"").replace(/{SSS}/g,Hf(I,3)).replace(/{S}/g,I+"")}function m1t(i,t,e,r,n){var o=null;if(wi(e))o=e;else if(Xi(e)){var s={time:i.time,level:i.time.level},a=bo();a&&a.makeAxisLabelFormatterParamBreak(s,i.break),o=e(i.value,t,s)}else{var c=i.time;if(c){var f=e[c.lowerTimeUnit][c.upperTimeUnit];o=f[Math.min(c.level,f.length-1)]||""}else{var g=Qy(i.value,n);o=e[g][g][0]}}return _E(new Date(i.value),o,n,r)}function Qy(i,t){var e=Mv(i),r=e[t3(t)]()+1,n=e[e3(t)](),o=e[i3(t)](),s=e[r3(t)](),a=e[n3(t)](),c=e[a3(t)](),f=c===0,g=f&&a===0,v=g&&s===0,y=v&&o===0,w=y&&n===1,I=w&&r===1;return I?"year":w?"month":y?"day":v?"hour":g?"minute":f?"second":"millisecond"}function fz(i,t,e){switch(t){case"year":i[gJ(e)](0);case"month":i[mJ(e)](1);case"day":i[vJ(e)](0);case"hour":i[_J(e)](0);case"minute":i[yJ(e)](0);case"second":i[xJ(e)](0)}return i}function pJ(i){return i?"getUTCFullYear":"getFullYear"}function t3(i){return i?"getUTCMonth":"getMonth"}function e3(i){return i?"getUTCDate":"getDate"}function i3(i){return i?"getUTCHours":"getHours"}function r3(i){return i?"getUTCMinutes":"getMinutes"}function n3(i){return i?"getUTCSeconds":"getSeconds"}function a3(i){return i?"getUTCMilliseconds":"getMilliseconds"}function v1t(i){return i?"setUTCFullYear":"setFullYear"}function gJ(i){return i?"setUTCMonth":"setMonth"}function mJ(i){return i?"setUTCDate":"setDate"}function vJ(i){return i?"setUTCHours":"setHours"}function _J(i){return i?"setUTCMinutes":"setMinutes"}function yJ(i){return i?"setUTCSeconds":"setSeconds"}function xJ(i){return i?"setUTCMilliseconds":"setMilliseconds"}function bJ(i){if(!tK(i))return wi(i)?i:"-";var t=(i+"").split(".");return t[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(t.length>1?"."+t[1]:"")}function wJ(i,t){return i=(i||"").toLowerCase().replace(/-(.)/g,function(e,r){return r.toUpperCase()}),t&&i&&(i=i.charAt(0).toUpperCase()+i.slice(1)),i}var GS=JM;function pz(i,t,e){var r="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}";function n(g){return g&&Du(g)?g:"-"}function o(g){return!!(g!=null&&!isNaN(g)&&isFinite(g))}var s=t==="time",a=i instanceof Date;if(s||a){var c=s?Mv(i):i;if(isNaN(+c)){if(a)return"-"}else return _E(c,r,e)}if(t==="ordinal")return SO(i)?n(i):fn(i)&&o(i)?i+"":"-";var f=kd(i);return o(f)?bJ(f):SO(i)?n(i):typeof i=="boolean"?i+"":"-"}var Dj=["a","b","c","d","e","f","g"],rR=function(i,t){return"{"+i+(t??"")+"}"};function SJ(i,t,e){Ye(t)||(t=[t]);var r=t.length;if(!r)return"";for(var n=t[0].$vars||[],o=0;o<n.length;o++){var s=Dj[o];i=i.replace(rR(s),rR(s,0))}for(var a=0;a<r;a++)for(var c=0;c<n.length;c++){var f=t[a][n[c]];i=i.replace(rR(Dj[c],a),e?Rs(f):f)}return i}function _1t(i,t,e){return pt(t,function(r,n){i=i.replace("{"+n+"}",e?Rs(r):r)}),i}function y1t(i,t){var e=wi(i)?{color:i,extraCssText:t}:i||{},r=e.color,n=e.type;t=e.extraCssText;var o=e.renderMode||"html";if(!r)return"";if(o==="html")return n==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+Rs(r)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+Rs(r)+";"+(t||"")+'"></span>';var s=e.markerId||"markerX";return{renderMode:o,content:"{"+s+"|}  ",style:n==="subItem"?{width:4,height:4,borderRadius:2,backgroundColor:r}:{width:10,height:10,borderRadius:5,backgroundColor:r}}}function wv(i,t){return t=t||"transparent",wi(i)?i:nr(i)&&i.colorStops&&(i.colorStops[0]||{}).color||t}function HC(i,t){if(t==="_blank"||t==="blank"){var e=window.open();e.opener=null,e.location.href=i}else window.open(i,t)}var QI={},nR={},HS=function(){function i(){this._normalMasterList=[],this._nonSeriesBoxMasterList=[]}return i.prototype.create=function(t,e){this._nonSeriesBoxMasterList=r(QI),this._normalMasterList=r(nR);function r(n,o){var s=[];return pt(n,function(a,c){var f=a.create(t,e);s=s.concat(f||[])}),s}},i.prototype.update=function(t,e){pt(this._normalMasterList,function(r){r.update&&r.update(t,e)})},i.prototype.getCoordinateSystems=function(){return this._normalMasterList.concat(this._nonSeriesBoxMasterList)},i.register=function(t,e){if(t==="matrix"||t==="calendar"){QI[t]=e;return}nR[t]=e},i.get=function(t){return nR[t]||QI[t]},i}();function x1t(i){return!!QI[i]}var gz={coord:1,coord2:2};function b1t(i){TJ.set(i.fullType,{getCoord2:void 0}).getCoord2=i.getCoord2}var TJ=Fi();function w1t(i){var t=i.getShallow("coord",!0),e=gz.coord;if(t==null){var r=TJ.get(i.type);r&&r.getCoord2&&(e=gz.coord2,t=r.getCoord2(i))}return{coord:t,from:e}}var ah={none:0,dataCoordSys:1,boxCoordSys:2};function AJ(i,t){var e=i.getShallow("coordinateSystem"),r=i.getShallow("coordinateSystemUsage",!0),n=ah.none;if(e){var o=i.mainType==="series";r==null&&(r=o?"data":"box"),r==="data"?(n=ah.dataCoordSys,o||(n=ah.none)):r==="box"&&(n=ah.boxCoordSys,!o&&!x1t(e)&&(n=ah.none))}return{coordSysType:e,kind:n}}function jS(i){var t=i.targetModel,e=i.coordSysType,r=i.coordSysProvider,n=i.isDefaultDataCoordSys;i.allowNotFound;var o=AJ(t),s=o.kind,a=o.coordSysType;if(n&&s!==ah.dataCoordSys&&(s=ah.dataCoordSys,a=e),s===ah.none||a!==e)return!1;var c=r(e,t);return c?(s===ah.dataCoordSys?t.coordinateSystem=c:t.boxCoordinateSystem=c,!0):!1}var IJ=function(i,t){var e=t.getReferringComponents(i,Wa).models[0];return e&&e.coordinateSystem},tC=pt,CJ=["left","right","top","bottom","width","height"],Zm=[["width","left","right"],["height","top","bottom"]];function o3(i,t,e,r,n){var o=0,s=0;r==null&&(r=1/0),n==null&&(n=1/0);var a=0;t.eachChild(function(c,f){var g=c.getBoundingRect(),v=t.childAt(f+1),y=v&&v.getBoundingRect(),w,I;if(i==="horizontal"){var E=g.width+(y?-y.x+g.x:0);w=o+E,w>r||c.newline?(o=0,w=E,s+=a+e,a=g.height):a=Math.max(a,g.height)}else{var D=g.height+(y?-y.y+g.y:0);I=s+D,I>n||c.newline?(o+=a+e,s=0,I=D,a=g.width):a=Math.max(a,g.width)}c.newline||(c.x=o,c.y=s,c.markRedraw(),i==="horizontal"?o=w+e:s=I+e)})}var cv=o3;br(o3,"vertical");br(o3,"horizontal");function MJ(i,t){return{left:i.getShallow("left",t),top:i.getShallow("top",t),right:i.getShallow("right",t),bottom:i.getShallow("bottom",t),width:i.getShallow("width",t),height:i.getShallow("height",t)}}function S1t(i,t){var e=No(i,t,{enableLayoutOnlyByCenter:!0}),r=i.getBoxLayoutParams(),n,o;if(e.type===iw.point)o=e.refPoint,n=Ma(r,{width:t.getWidth(),height:t.getHeight()});else{var s=i.get("center"),a=Ye(s)?s:[s,s];n=Ma(r,e.refContainer),o=e.boxCoordFrom===gz.coord2?e.refPoint:[xi(a[0],n.width)+n.x,xi(a[1],n.height)+n.y]}return{viewRect:n,center:o}}function EJ(i,t){var e=S1t(i,t),r=e.viewRect,n=e.center,o=i.get("radius");Ye(o)||(o=[0,o]);var s=xi(r.width,t.getWidth()),a=xi(r.height,t.getHeight()),c=Math.min(s,a),f=xi(o[0],c/2),g=xi(o[1],c/2);return{cx:n[0],cy:n[1],r0:f,r:g,viewRect:r}}function Ma(i,t,e){e=GS(e||0);var r=t.width,n=t.height,o=xi(i.left,r),s=xi(i.top,n),a=xi(i.right,r),c=xi(i.bottom,n),f=xi(i.width,r),g=xi(i.height,n),v=e[2]+e[0],y=e[1]+e[3],w=i.aspect;switch(isNaN(f)&&(f=r-a-y-o),isNaN(g)&&(g=n-c-v-s),w!=null&&(isNaN(f)&&isNaN(g)&&(w>r/n?f=r*.8:g=n*.8),isNaN(f)&&(f=w*g),isNaN(g)&&(g=f/w)),isNaN(o)&&(o=r-a-f-y),isNaN(s)&&(s=n-c-g-v),i.left||i.right){case"center":o=r/2-f/2-e[3];break;case"right":o=r-f-y;break}switch(i.top||i.bottom){case"middle":case"center":s=n/2-g/2-e[0];break;case"bottom":s=n-g-v;break}o=o||0,s=s||0,isNaN(f)&&(f=r-y-o-(a||0)),isNaN(g)&&(g=n-v-s-(c||0));var I=new sr((t.x||0)+o+e[3],(t.y||0)+s+e[0],f,g);return I.margin=e,I}function DJ(i,t,e){var r=i.getShallow("preserveAspect",!0);if(!r)return t;var n=t.width/t.height;if(Math.abs(Math.atan(e)-Math.atan(n))<1e-9)return t;var o=i.getShallow("preserveAspectAlign",!0),s=i.getShallow("preserveAspectVerticalAlign",!0),a={width:t.width,height:t.height},c=r==="cover";return n>e&&!c||n<e&&c?(a.width=t.height*e,o==="left"?a.left=0:o==="right"?a.right=0:a.left="center"):(a.height=t.width/e,s==="top"?a.top=0:s==="bottom"?a.bottom=0:a.top="middle"),Ma(a,t)}var iw={rect:1,point:2};function No(i,t,e){var r,n,o,s=i.boxCoordinateSystem,a;if(s){var c=w1t(i),f=c.coord,g=c.from;if(s.dataToLayout){o=iw.rect,a=g;var v=s.dataToLayout(f);r=v.contentRect||v.rect}else e&&e.enableLayoutOnlyByCenter&&s.dataToPoint&&(o=iw.point,a=g,n=s.dataToPoint(f))}return o==null&&(o=iw.rect),o===iw.rect&&(r||(r={x:0,y:0,width:t.getWidth(),height:t.getHeight()}),n=[r.x+r.width/2,r.y+r.height/2]),{type:o,refContainer:r,refPoint:n,boxCoordFrom:a}}function yE(i,t,e,r,n,o){var s=!n||!n.hv||n.hv[0],a=!n||!n.hv||n.hv[1],c=n&&n.boundingMode||"all";if(o=o||i,o.x=i.x,o.y=i.y,!s&&!a)return!1;var f;if(c==="raw")f=i.type==="group"?new sr(0,0,+t.width||0,+t.height||0):i.getBoundingRect();else if(f=i.getBoundingRect(),i.needLocalTransform()){var g=i.getLocalTransform();f=f.clone(),f.applyTransform(g)}var v=Ma(rr({width:f.width,height:f.height},t),e,r),y=s?v.x-f.x:0,w=a?v.y-f.y:0;return c==="raw"?(o.x=y,o.y=w):(o.x+=y,o.y+=w),o===i&&i.markRedraw(),!0}function T1t(i,t){return i[Zm[t][0]]!=null||i[Zm[t][1]]!=null&&i[Zm[t][2]]!=null}function lS(i){var t=i.layoutMode||i.constructor.layoutMode;return nr(t)?t:t?{type:t}:null}function Th(i,t,e){var r=e&&e.ignoreSize;!Ye(r)&&(r=[r,r]);var n=s(Zm[0],0),o=s(Zm[1],1);c(Zm[0],i,n),c(Zm[1],i,o);function s(f,g){var v={},y=0,w={},I=0,E=2;if(tC(f,function(z){w[z]=i[z]}),tC(f,function(z){Pi(t,z)&&(v[z]=w[z]=t[z]),a(v,z)&&y++,a(w,z)&&I++}),r[g])return a(t,f[1])?w[f[2]]=null:a(t,f[2])&&(w[f[1]]=null),w;if(I===E||!y)return w;if(y>=E)return v;for(var D=0;D<f.length;D++){var R=f[D];if(!Pi(v,R)&&Pi(i,R)){v[R]=i[R];break}}return v}function a(f,g){return f[g]!=null&&f[g]!=="auto"}function c(f,g,v){tC(f,function(y){g[y]=v[y]})}}function Pv(i){return PJ({},i)}function PJ(i,t){return t&&i&&tC(CJ,function(e){Pi(t,e)&&(i[e]=t[e])}),i}var A1t=Wr(),W0=function(i){Se(t,i);function t(e,r,n){var o=i.call(this,e,r,n)||this;return o.uid=j0("ec_cpt_model"),o}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n)},t.prototype.mergeDefaultAndTheme=function(e,r){var n=lS(this),o=n?Pv(e):{},s=r.getTheme();Er(e,s.get(this.mainType)),Er(e,this.getDefaultOption()),n&&Th(e,o,n)},t.prototype.mergeOption=function(e,r){Er(this.option,e,!0);var n=lS(this);n&&Th(this.option,e,n)},t.prototype.optionUpdated=function(e,r){},t.prototype.getDefaultOption=function(){var e=this.constructor;if(!Xyt(e))return e.defaultOption;var r=A1t(this);if(!r.defaultOption){for(var n=[],o=e;o;){var s=o.prototype.defaultOption;s&&n.push(s),o=o.superClass}for(var a={},c=n.length-1;c>=0;c--)a=Er(a,n[c],!0);r.defaultOption=a}return r.defaultOption},t.prototype.getReferringComponents=function(e,r){var n=e+"Index",o=e+"Id";return N0(this.ecModel,e,{index:this.get(n,!0),id:this.get(o,!0)},r)},t.prototype.getBoxLayoutParams=function(){return MJ(this,!1)},t.prototype.getZLevelKey=function(){return""},t.prototype.setZLevel=function(e){this.option.zlevel=e},t.protoInitialize=function(){var e=t.prototype;e.type="component",e.id="",e.name="",e.mainType="",e.subType="",e.componentIndex=0}(),t}(bn);hK(W0,bn);nE(W0);i1t(W0);r1t(W0,I1t);function I1t(i){var t=[];return pt(W0.getClassesByMainType(i),function(e){t=t.concat(e.dependencies||e.prototype.dependencies||[])}),t=ti(t,function(e){return uh(e).main}),i!=="dataset"&&Ar(t,"dataset")<=0&&t.unshift("dataset"),t}const gn=W0;var qm={color:{},darkColor:{},size:{}},oo=qm.color={theme:["#5070dd","#b6d634","#505372","#ff994d","#0ca8df","#ffd10a","#fb628b","#785db0","#3fbe95"],neutral00:"#fff",neutral05:"#f4f7fd",neutral10:"#e8ebf0",neutral15:"#dbdee4",neutral20:"#cfd2d7",neutral25:"#c3c5cb",neutral30:"#b7b9be",neutral35:"#aaacb2",neutral40:"#9ea0a5",neutral45:"#929399",neutral50:"#86878c",neutral55:"#797b7f",neutral60:"#6d6e73",neutral65:"#616266",neutral70:"#54555a",neutral75:"#48494d",neutral80:"#3c3c41",neutral85:"#303034",neutral90:"#232328",neutral95:"#17171b",neutral99:"#000",accent05:"#eff1f9",accent10:"#e0e4f2",accent15:"#d0d6ec",accent20:"#c0c9e6",accent25:"#b1bbdf",accent30:"#a1aed9",accent35:"#91a0d3",accent40:"#8292cc",accent45:"#7285c6",accent50:"#6578ba",accent55:"#5c6da9",accent60:"#536298",accent65:"#4a5787",accent70:"#404c76",accent75:"#374165",accent80:"#2e3654",accent85:"#252b43",accent90:"#1b2032",accent95:"#121521",transparent:"rgba(0,0,0,0)",highlight:"rgba(255,231,130,0.8)"};Ne(oo,{primary:oo.neutral80,secondary:oo.neutral70,tertiary:oo.neutral60,quaternary:oo.neutral50,disabled:oo.neutral20,border:oo.neutral30,borderTint:oo.neutral20,borderShade:oo.neutral40,background:oo.neutral05,backgroundTint:"rgba(234,237,245,0.5)",backgroundTransparent:"rgba(255,255,255,0)",backgroundShade:oo.neutral10,shadow:"rgba(0,0,0,0.2)",shadowTint:"rgba(129,130,136,0.2)",axisLine:oo.neutral70,axisLineTint:oo.neutral40,axisTick:oo.neutral70,axisTickMinor:oo.neutral60,axisLabel:oo.neutral70,axisSplitLine:oo.neutral15,axisMinorSplitLine:oo.neutral05});for(var _m in oo)if(oo.hasOwnProperty(_m)){var Pj=oo[_m];_m==="theme"?qm.darkColor.theme=oo.theme.slice():_m==="highlight"?qm.darkColor.highlight="rgba(255,231,130,0.4)":_m.indexOf("accent")===0?qm.darkColor[_m]=Ap(Pj,null,function(i){return i*.5},function(i){return Math.min(1,1.3-i)}):qm.darkColor[_m]=Ap(Pj,null,function(i){return i*.9},function(i){return 1-Math.pow(i,1.5)})}qm.size={xxs:2,xs:5,s:10,m:15,l:20,xl:30,xxl:40,xxxl:50};const ye=qm;var LJ="";typeof navigator<"u"&&(LJ=navigator.platform||"");var Ty="rgba(0, 0, 0, 0.2)",RJ=ye.color.theme[0],C1t=Ap(RJ,null,null,.9);const M1t={darkMode:"auto",colorBy:"series",color:ye.color.theme,gradientColor:[C1t,RJ],aria:{decal:{decals:[{color:Ty,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:Ty,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:Ty,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:Ty,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:Ty,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:Ty,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:LJ.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};var kJ=Fi(["tooltip","label","itemName","itemId","itemGroupId","itemChildGroupId","seriesName"]),nu="original",ss="arrayRows",au="objectRows",wc="keyedColumns",Cp="typedArray",OJ="unknown",gc="column",Lv="row",ps={Must:1,Might:2,Not:3},zJ=Wr();function E1t(i){zJ(i).datasetMap=Fi()}function BJ(i,t,e){var r={},n=l3(t);if(!n||!i)return r;var o=[],s=[],a=t.ecModel,c=zJ(a).datasetMap,f=n.uid+"_"+e.seriesLayoutBy,g,v;i=i.slice(),pt(i,function(E,D){var R=nr(E)?E:i[D]={name:E};R.type==="ordinal"&&g==null&&(g=D,v=I(R)),r[R.name]=[]});var y=c.get(f)||c.set(f,{categoryWayDim:v,valueWayDim:0});pt(i,function(E,D){var R=E.name,z=I(E);if(g==null){var N=y.valueWayDim;w(r[R],N,z),w(s,N,z),y.valueWayDim+=z}else if(g===D)w(r[R],0,z),w(o,0,z);else{var N=y.categoryWayDim;w(r[R],N,z),w(s,N,z),y.categoryWayDim+=z}});function w(E,D,R){for(var z=0;z<R;z++)E.push(D+z)}function I(E){var D=E.dimsDef;return D?D.length:1}return o.length&&(r.itemName=o),s.length&&(r.seriesName=s),r}function s3(i,t,e){var r={},n=l3(i);if(!n)return r;var o=t.sourceFormat,s=t.dimensionsDefine,a;(o===au||o===wc)&&pt(s,function(g,v){(nr(g)?g.name:g)==="name"&&(a=v)});var c=function(){for(var g={},v={},y=[],w=0,I=Math.min(5,e);w<I;w++){var E=NJ(t.data,o,t.seriesLayoutBy,s,t.startIndex,w);y.push(E);var D=E===ps.Not;if(D&&g.v==null&&w!==a&&(g.v=w),(g.n==null||g.n===g.v||!D&&y[g.n]===ps.Not)&&(g.n=w),R(g)&&y[g.n]!==ps.Not)return g;D||(E===ps.Might&&v.v==null&&w!==a&&(v.v=w),(v.n==null||v.n===v.v)&&(v.n=w))}function R(z){return z.v!=null&&z.n!=null}return R(g)?g:R(v)?v:null}();if(c){r.value=[c.v];var f=a??c.n;r.itemName=[f],r.seriesName=[f]}return r}function l3(i){var t=i.get("data",!0);if(!t)return N0(i.ecModel,"dataset",{index:i.get("datasetIndex",!0),id:i.get("datasetId",!0)},Wa).models[0]}function D1t(i){return!i.get("transform",!0)&&!i.get("fromTransformResult",!0)?[]:N0(i.ecModel,"dataset",{index:i.get("fromDatasetIndex",!0),id:i.get("fromDatasetId",!0)},Wa).models}function FJ(i,t){return NJ(i.data,i.sourceFormat,i.seriesLayoutBy,i.dimensionsDefine,i.startIndex,t)}function NJ(i,t,e,r,n,o){var s,a=5;if(zl(i))return ps.Not;var c,f;if(r){var g=r[o];nr(g)?(c=g.name,f=g.type):wi(g)&&(c=g)}if(f!=null)return f==="ordinal"?ps.Must:ps.Not;if(t===ss){var v=i;if(e===Lv){for(var y=v[o],w=0;w<(y||[]).length&&w<a;w++)if((s=H(y[n+w]))!=null)return s}else for(var w=0;w<v.length&&w<a;w++){var I=v[n+w];if(I&&(s=H(I[o]))!=null)return s}}else if(t===au){var E=i;if(!c)return ps.Not;for(var w=0;w<E.length&&w<a;w++){var D=E[w];if(D&&(s=H(D[c]))!=null)return s}}else if(t===wc){var R=i;if(!c)return ps.Not;var y=R[c];if(!y||zl(y))return ps.Not;for(var w=0;w<y.length&&w<a;w++)if((s=H(y[w]))!=null)return s}else if(t===nu)for(var z=i,w=0;w<z.length&&w<a;w++){var D=z[w],N=F0(D);if(!Ye(N))return ps.Not;if((s=H(N[o]))!=null)return s}function H(q){var Y=wi(q);if(q!=null&&Number.isFinite(Number(q))&&q!=="")return Y?ps.Might:ps.Not;if(Y&&q!=="-")return ps.Must}return ps.Not}var mz=Fi();function P1t(i,t){Vs(mz.get(i)==null&&t),mz.set(i,t)}function L1t(i,t,e){var r=mz.get(t);if(!r)return e;var n=r(i);return n?e.concat(n):e}var Lj=Wr(),R1t=Wr(),u3=function(){function i(){}return i.prototype.getColorFromPalette=function(t,e,r){var n=aa(this.get("color",!0)),o=this.get("colorLayer",!0);return VJ(this,Lj,n,o,t,e,r)},i.prototype.clearColorPalette=function(){O1t(this,Lj)},i}();function vz(i,t,e,r){var n=aa(i.get(["aria","decal","decals"]));return VJ(i,R1t,n,null,t,e,r)}function k1t(i,t){for(var e=i.length,r=0;r<e;r++)if(i[r].length>t)return i[r];return i[e-1]}function VJ(i,t,e,r,n,o,s){o=o||i;var a=t(o),c=a.paletteIdx||0,f=a.paletteNameMap=a.paletteNameMap||{};if(f.hasOwnProperty(n))return f[n];var g=s==null||!r?e:k1t(r,s);if(g=g||e,!(!g||!g.length)){var v=g[c];return n&&(f[n]=v),a.paletteIdx=(c+1)%g.length,v}}function O1t(i,t){t(i).paletteIdx=0,t(i).paletteNameMap={}}var EA,_b,Rj,kj="\0_ec_inner",z1t=1,UJ=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.init=function(e,r,n,o,s,a){o=o||{},this.option=null,this._theme=new bn(o),this._locale=new bn(s),this._optionManager=a},t.prototype.setOption=function(e,r,n){var o=Bj(r);this._optionManager.setOption(e,n,o),this._resetOption(null,o)},t.prototype.resetOption=function(e,r){return this._resetOption(e,Bj(r))},t.prototype._resetOption=function(e,r){var n=!1,o=this._optionManager;if(!e||e==="recreate"){var s=o.mountOption(e==="recreate");!this.option||e==="recreate"?Rj(this,s):(this.restoreData(),this._mergeOption(s,r)),n=!0}if((e==="timeline"||e==="media")&&this.restoreData(),!e||e==="recreate"||e==="timeline"){var a=o.getTimelineOption(this);a&&(n=!0,this._mergeOption(a,r))}if(!e||e==="recreate"||e==="media"){var c=o.getMediaOption(this);c.length&&pt(c,function(f){n=!0,this._mergeOption(f,r)},this)}return n},t.prototype.mergeOption=function(e){this._mergeOption(e,null)},t.prototype._mergeOption=function(e,r){var n=this.option,o=this._componentsMap,s=this._componentsCount,a=[],c=Fi(),f=r&&r.replaceMergeMainTypeMap;E1t(this),pt(e,function(v,y){v!=null&&(gn.hasClass(y)?y&&(a.push(y),c.set(y,!0)):n[y]=n[y]==null?Yi(v):Er(n[y],v,!0))}),f&&f.each(function(v,y){gn.hasClass(y)&&!c.get(y)&&(a.push(y),c.set(y,!0))}),gn.topologicalTravel(a,gn.getAllClassMainTypes(),g,this);function g(v){var y=L1t(this,v,aa(e[v])),w=o.get(v),I=w?f&&f.get(v)?"replaceMerge":"normalMerge":"replaceAll",E=oK(w,y,I);Vyt(E,v,gn),n[v]=null,o.set(v,null),s.set(v,0);var D=[],R=[],z=0,N;pt(E,function(H,q){var Y=H.existing,J=H.newOption;if(!J)Y&&(Y.mergeOption({},this),Y.optionUpdated({},!1));else{var it=v==="series",at=gn.getClass(v,H.keyInfo.subType,!it);if(!at)return;if(v==="tooltip"){if(N)return;N=!0}if(Y&&Y.constructor===at)Y.name=H.keyInfo.name,Y.mergeOption(J,this),Y.optionUpdated(J,!1);else{var ut=Ne({componentIndex:q},H.keyInfo);Y=new at(J,this,this,ut),Ne(Y,ut),H.brandNew&&(Y.__requireNewView=!0),Y.init(J,this,this),Y.optionUpdated(null,!0)}}Y?(D.push(Y.option),R.push(Y),z++):(D.push(void 0),R.push(void 0))},this),n[v]=D,o.set(v,R),s.set(v,z),v==="series"&&EA(this)}this._seriesIndices||EA(this)},t.prototype.getOption=function(){var e=Yi(this.option);return pt(e,function(r,n){if(gn.hasClass(n)){for(var o=aa(r),s=o.length,a=!1,c=s-1;c>=0;c--)o[c]&&!iS(o[c])?a=!0:(o[c]=null,!a&&s--);o.length=s,e[n]=o}}),delete e[kj],e},t.prototype.setTheme=function(e){this._theme=new bn(e),this._resetOption("recreate",null)},t.prototype.getTheme=function(){return this._theme},t.prototype.getLocaleModel=function(){return this._locale},t.prototype.setUpdatePayload=function(e){this._payload=e},t.prototype.getUpdatePayload=function(){return this._payload},t.prototype.getComponent=function(e,r){var n=this._componentsMap.get(e);if(n){var o=n[r||0];if(o)return o;if(r==null){for(var s=0;s<n.length;s++)if(n[s])return n[s]}}},t.prototype.queryComponents=function(e){var r=e.mainType;if(!r)return[];var n=e.index,o=e.id,s=e.name,a=this._componentsMap.get(r);if(!a||!a.length)return[];var c;return n!=null?(c=[],pt(aa(n),function(f){a[f]&&c.push(a[f])})):o!=null?c=Oj("id",o,a):s!=null?c=Oj("name",s,a):c=kn(a,function(f){return!!f}),zj(c,e)},t.prototype.findComponents=function(e){var r=e.query,n=e.mainType,o=a(r),s=o?this.queryComponents(o):kn(this._componentsMap.get(n),function(f){return!!f});return c(zj(s,e));function a(f){var g=n+"Index",v=n+"Id",y=n+"Name";return f&&(f[g]!=null||f[v]!=null||f[y]!=null)?{mainType:n,index:f[g],id:f[v],name:f[y]}:null}function c(f){return e.filter?kn(f,e.filter):f}},t.prototype.eachComponent=function(e,r,n){var o=this._componentsMap;if(Xi(e)){var s=r,a=e;o.each(function(v,y){for(var w=0;v&&w<v.length;w++){var I=v[w];I&&a.call(s,y,I,I.componentIndex)}})}else for(var c=wi(e)?o.get(e):nr(e)?this.findComponents(e):null,f=0;c&&f<c.length;f++){var g=c[f];g&&r.call(n,g,g.componentIndex)}},t.prototype.getSeriesByName=function(e){var r=ko(e,null);return kn(this._componentsMap.get("series"),function(n){return!!n&&r!=null&&n.name===r})},t.prototype.getSeriesByIndex=function(e){return this._componentsMap.get("series")[e]},t.prototype.getSeriesByType=function(e){return kn(this._componentsMap.get("series"),function(r){return!!r&&r.subType===e})},t.prototype.getSeries=function(){return kn(this._componentsMap.get("series"),function(e){return!!e})},t.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},t.prototype.eachSeries=function(e,r){_b(this),pt(this._seriesIndices,function(n){var o=this._componentsMap.get("series")[n];e.call(r,o,n)},this)},t.prototype.eachRawSeries=function(e,r){pt(this._componentsMap.get("series"),function(n){n&&e.call(r,n,n.componentIndex)})},t.prototype.eachSeriesByType=function(e,r,n){_b(this),pt(this._seriesIndices,function(o){var s=this._componentsMap.get("series")[o];s.subType===e&&r.call(n,s,o)},this)},t.prototype.eachRawSeriesByType=function(e,r,n){return pt(this.getSeriesByType(e),r,n)},t.prototype.isSeriesFiltered=function(e){return _b(this),this._seriesIndicesMap.get(e.componentIndex)==null},t.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},t.prototype.filterSeries=function(e,r){_b(this);var n=[];pt(this._seriesIndices,function(o){var s=this._componentsMap.get("series")[o];e.call(r,s,o)&&n.push(o)},this),this._seriesIndices=n,this._seriesIndicesMap=Fi(n)},t.prototype.restoreData=function(e){EA(this);var r=this._componentsMap,n=[];r.each(function(o,s){gn.hasClass(s)&&n.push(s)}),gn.topologicalTravel(n,gn.getAllClassMainTypes(),function(o){pt(r.get(o),function(s){s&&(o!=="series"||!B1t(s,e))&&s.restoreData()})})},t.internalField=function(){EA=function(e){var r=e._seriesIndices=[];pt(e._componentsMap.get("series"),function(n){n&&r.push(n.componentIndex)}),e._seriesIndicesMap=Fi(r)},_b=function(e){},Rj=function(e,r){e.option={},e.option[kj]=z1t,e._componentsMap=Fi({series:[]}),e._componentsCount=Fi();var n=r.aria;nr(n)&&n.enabled==null&&(n.enabled=!0),F1t(r,e._theme.option),Er(r,M1t,!1),e._mergeOption(r,null)}}(),t}(bn);function B1t(i,t){if(t){var e=t.seriesIndex,r=t.seriesId,n=t.seriesName;return e!=null&&i.componentIndex!==e||r!=null&&i.id!==r||n!=null&&i.name!==n}}function F1t(i,t){var e=i.color&&!i.colorLayer;pt(t,function(r,n){n==="colorLayer"&&e||n==="color"&&i.color||gn.hasClass(n)||(typeof r=="object"?i[n]=i[n]?Er(i[n],r,!1):Yi(r):i[n]==null&&(i[n]=r))})}function Oj(i,t,e){if(Ye(t)){var r=Fi();return pt(t,function(o){if(o!=null){var s=ko(o,null);s!=null&&r.set(o,!0)}}),kn(e,function(o){return o&&r.get(o[i])})}else{var n=ko(t,null);return kn(e,function(o){return o&&n!=null&&o[i]===n})}}function zj(i,t){return t.hasOwnProperty("subType")?kn(i,function(e){return e&&e.subType===t.subType}):i}function Bj(i){var t=Fi();return i&&pt(aa(i.replaceMerge),function(e){t.set(e,!0)}),{replaceMergeMainTypeMap:t}}Ao(UJ,u3);const GJ=UJ;var N1t=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isSSR","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],V1t=function(){function i(t){pt(N1t,function(e){this[e]=Si(t[e],t)},this)}return i}();const HJ=V1t;var U1t=/^(min|max)?(.+)$/,G1t=function(){function i(t){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=t}return i.prototype.setOption=function(t,e,r){t&&(pt(aa(t.series),function(s){s&&s.data&&zl(s.data)&&AC(s.data)}),pt(aa(t.dataset),function(s){s&&s.source&&zl(s.source)&&AC(s.source)})),t=Yi(t);var n=this._optionBackup,o=H1t(t,e,!n);this._newBaseOption=o.baseOption,n?(o.timelineOptions.length&&(n.timelineOptions=o.timelineOptions),o.mediaList.length&&(n.mediaList=o.mediaList),o.mediaDefault&&(n.mediaDefault=o.mediaDefault)):this._optionBackup=o},i.prototype.mountOption=function(t){var e=this._optionBackup;return this._timelineOptions=e.timelineOptions,this._mediaList=e.mediaList,this._mediaDefault=e.mediaDefault,this._currentMediaIndices=[],Yi(t?e.baseOption:this._newBaseOption)},i.prototype.getTimelineOption=function(t){var e,r=this._timelineOptions;if(r.length){var n=t.getComponent("timeline");n&&(e=Yi(r[n.getCurrentIndex()]))}return e},i.prototype.getMediaOption=function(t){var e=this._api.getWidth(),r=this._api.getHeight(),n=this._mediaList,o=this._mediaDefault,s=[],a=[];if(!n.length&&!o)return a;for(var c=0,f=n.length;c<f;c++)j1t(n[c].query,e,r)&&s.push(c);return!s.length&&o&&(s=[-1]),s.length&&!$1t(s,this._currentMediaIndices)&&(a=ti(s,function(g){return Yi(g===-1?o.option:n[g].option)})),this._currentMediaIndices=s,a},i}();function H1t(i,t,e){var r=[],n,o,s=i.baseOption,a=i.timeline,c=i.options,f=i.media,g=!!i.media,v=!!(c||a||s&&s.timeline);s?(o=s,o.timeline||(o.timeline=a)):((v||g)&&(i.options=i.media=null),o=i),g&&Ye(f)&&pt(f,function(w){w&&w.option&&(w.query?r.push(w):n||(n=w))}),y(o),pt(c,function(w){return y(w)}),pt(r,function(w){return y(w.option)});function y(w){pt(t,function(I){I(w,e)})}return{baseOption:o,timelineOptions:c||[],mediaDefault:n,mediaList:r}}function j1t(i,t,e){var r={width:t,height:e,aspectratio:t/e},n=!0;return pt(i,function(o,s){var a=s.match(U1t);if(!(!a||!a[1]||!a[2])){var c=a[1],f=a[2].toLowerCase();W1t(r[f],o,c)||(n=!1)}}),n}function W1t(i,t,e){return e==="min"?i>=t:e==="max"?i<=t:i===t}function $1t(i,t){return i.join(",")===t.join(",")}const Z1t=G1t;var rc=pt,uS=nr,Fj=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function aR(i){var t=i&&i.itemStyle;if(t)for(var e=0,r=Fj.length;e<r;e++){var n=Fj[e],o=t.normal,s=t.emphasis;o&&o[n]&&(i[n]=i[n]||{},i[n].normal?Er(i[n].normal,o[n]):i[n].normal=o[n],o[n]=null),s&&s[n]&&(i[n]=i[n]||{},i[n].emphasis?Er(i[n].emphasis,s[n]):i[n].emphasis=s[n],s[n]=null)}}function Ds(i,t,e){if(i&&i[t]&&(i[t].normal||i[t].emphasis)){var r=i[t].normal,n=i[t].emphasis;r&&(e?(i[t].normal=i[t].emphasis=null,rr(i[t],r)):i[t]=r),n&&(i.emphasis=i.emphasis||{},i.emphasis[t]=n,n.focus&&(i.emphasis.focus=n.focus),n.blurScope&&(i.emphasis.blurScope=n.blurScope))}}function rw(i){Ds(i,"itemStyle"),Ds(i,"lineStyle"),Ds(i,"areaStyle"),Ds(i,"label"),Ds(i,"labelLine"),Ds(i,"upperLabel"),Ds(i,"edgeLabel")}function mo(i,t){var e=uS(i)&&i[t],r=uS(e)&&e.textStyle;if(r)for(var n=0,o=UH.length;n<o;n++){var s=UH[n];r.hasOwnProperty(s)&&(e[s]=r[s])}}function Su(i){i&&(rw(i),mo(i,"label"),i.emphasis&&mo(i.emphasis,"label"))}function q1t(i){if(uS(i)){aR(i),rw(i),mo(i,"label"),mo(i,"upperLabel"),mo(i,"edgeLabel"),i.emphasis&&(mo(i.emphasis,"label"),mo(i.emphasis,"upperLabel"),mo(i.emphasis,"edgeLabel"));var t=i.markPoint;t&&(aR(t),Su(t));var e=i.markLine;e&&(aR(e),Su(e));var r=i.markArea;r&&Su(r);var n=i.data;if(i.type==="graph"){n=n||i.nodes;var o=i.links||i.edges;if(o&&!zl(o))for(var s=0;s<o.length;s++)Su(o[s]);pt(i.categories,function(f){rw(f)})}if(n&&!zl(n))for(var s=0;s<n.length;s++)Su(n[s]);if(t=i.markPoint,t&&t.data)for(var a=t.data,s=0;s<a.length;s++)Su(a[s]);if(e=i.markLine,e&&e.data)for(var c=e.data,s=0;s<c.length;s++)Ye(c[s])?(Su(c[s][0]),Su(c[s][1])):Su(c[s]);i.type==="gauge"?(mo(i,"axisLabel"),mo(i,"title"),mo(i,"detail")):i.type==="treemap"?(Ds(i.breadcrumb,"itemStyle"),pt(i.levels,function(f){rw(f)})):i.type==="tree"&&rw(i.leaves)}}function id(i){return Ye(i)?i:i?[i]:[]}function Nj(i){return(Ye(i)?i[0]:i)||{}}function X1t(i,t){rc(id(i.series),function(r){uS(r)&&q1t(r)});var e=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];t&&e.push("valueAxis","categoryAxis","logAxis","timeAxis"),rc(e,function(r){rc(id(i[r]),function(n){n&&(mo(n,"axisLabel"),mo(n.axisPointer,"label"))})}),rc(id(i.parallel),function(r){var n=r&&r.parallelAxisDefault;mo(n,"axisLabel"),mo(n&&n.axisPointer,"label")}),rc(id(i.calendar),function(r){Ds(r,"itemStyle"),mo(r,"dayLabel"),mo(r,"monthLabel"),mo(r,"yearLabel")}),rc(id(i.radar),function(r){mo(r,"name"),r.name&&r.axisName==null&&(r.axisName=r.name,delete r.name),r.nameGap!=null&&r.axisNameGap==null&&(r.axisNameGap=r.nameGap,delete r.nameGap)}),rc(id(i.geo),function(r){uS(r)&&(Su(r),rc(id(r.regions),function(n){Su(n)}))}),rc(id(i.timeline),function(r){Su(r),Ds(r,"label"),Ds(r,"itemStyle"),Ds(r,"controlStyle",!0);var n=r.data;Ye(n)&&pt(n,function(o){nr(o)&&(Ds(o,"label"),Ds(o,"itemStyle"))})}),rc(id(i.toolbox),function(r){Ds(r,"iconStyle"),rc(r.feature,function(n){Ds(n,"iconStyle")})}),mo(Nj(i.axisPointer),"label"),mo(Nj(i.tooltip).axisPointer,"label")}function Y1t(i,t){for(var e=t.split(","),r=i,n=0;n<e.length&&(r=r&&r[e[n]],r!=null);n++);return r}function K1t(i,t,e,r){for(var n=t.split(","),o=i,s,a=0;a<n.length-1;a++)s=n[a],o[s]==null&&(o[s]={}),o=o[s];(r||o[n[a]]==null)&&(o[n[a]]=e)}function Vj(i){i&&pt(J1t,function(t){t[0]in i&&!(t[1]in i)&&(i[t[1]]=i[t[0]])})}var J1t=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],Q1t=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],oR=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function yb(i){var t=i&&i.itemStyle;if(t)for(var e=0;e<oR.length;e++){var r=oR[e][1],n=oR[e][0];t[r]!=null&&(t[n]=t[r])}}function Uj(i){i&&i.alignTo==="edge"&&i.margin!=null&&i.edgeDistance==null&&(i.edgeDistance=i.margin)}function Gj(i){i&&i.downplay&&!i.blur&&(i.blur=i.downplay)}function tbt(i){i&&i.focusNodeAdjacency!=null&&(i.emphasis=i.emphasis||{},i.emphasis.focus==null&&(i.emphasis.focus="adjacency"))}function jJ(i,t){if(i)for(var e=0;e<i.length;e++)t(i[e]),i[e]&&jJ(i[e].children,t)}function WJ(i,t){X1t(i,t),i.series=aa(i.series),pt(i.series,function(e){if(nr(e)){var r=e.type;if(r==="line")e.clipOverflow!=null&&(e.clip=e.clipOverflow);else if(r==="pie"||r==="gauge"){e.clockWise!=null&&(e.clockwise=e.clockWise),Uj(e.label);var n=e.data;if(n&&!zl(n))for(var o=0;o<n.length;o++)Uj(n[o]);e.hoverOffset!=null&&(e.emphasis=e.emphasis||{},(e.emphasis.scaleSize=null)&&(e.emphasis.scaleSize=e.hoverOffset))}else if(r==="gauge"){var s=Y1t(e,"pointer.color");s!=null&&K1t(e,"itemStyle.color",s)}else if(r==="bar"){yb(e),yb(e.backgroundStyle),yb(e.emphasis);var n=e.data;if(n&&!zl(n))for(var o=0;o<n.length;o++)typeof n[o]=="object"&&(yb(n[o]),yb(n[o]&&n[o].emphasis))}else if(r==="sunburst"){var a=e.highlightPolicy;a&&(e.emphasis=e.emphasis||{},e.emphasis.focus||(e.emphasis.focus=a)),Gj(e),jJ(e.data,Gj)}else r==="graph"||r==="sankey"?tbt(e):r==="map"&&(e.mapType&&!e.map&&(e.map=e.mapType),e.mapLocation&&rr(e,e.mapLocation));e.hoverAnimation!=null&&(e.emphasis=e.emphasis||{},e.emphasis&&e.emphasis.scale==null&&(e.emphasis.scale=e.hoverAnimation)),Vj(e)}}),i.dataRange&&(i.visualMap=i.dataRange),pt(Q1t,function(e){var r=i[e];r&&(Ye(r)||(r=[r]),pt(r,function(n){Vj(n)}))})}function ebt(i){var t=Fi();i.eachSeries(function(e){var r=e.get("stack");if(r){var n=t.get(r)||t.set(r,[]),o=e.getData(),s={stackResultDimension:o.getCalculationInfo("stackResultDimension"),stackedOverDimension:o.getCalculationInfo("stackedOverDimension"),stackedDimension:o.getCalculationInfo("stackedDimension"),stackedByDimension:o.getCalculationInfo("stackedByDimension"),isStackedByIndex:o.getCalculationInfo("isStackedByIndex"),data:o,seriesModel:e};if(!s.stackedDimension||!(s.isStackedByIndex||s.stackedByDimension))return;n.push(s)}}),t.each(function(e){if(e.length!==0){var r=e[0].seriesModel,n=r.get("stackOrder")||"seriesAsc";n==="seriesDesc"&&e.reverse(),pt(e,function(o,s){o.data.setCalculationInfo("stackedOnSeries",s>0?e[s-1].seriesModel:null)}),ibt(e)}})}function ibt(i){pt(i,function(t,e){var r=[],n=[NaN,NaN],o=[t.stackResultDimension,t.stackedOverDimension],s=t.data,a=t.isStackedByIndex,c=t.seriesModel.get("stackStrategy")||"samesign";s.modify(o,function(f,g,v){var y=s.get(t.stackedDimension,v);if(isNaN(y))return n;var w,I;a?I=s.getRawIndex(v):w=s.get(t.stackedByDimension,v);for(var E=NaN,D=e-1;D>=0;D--){var R=i[D];if(a||(I=R.data.rawIndexOf(R.stackedByDimension,w)),I>=0){var z=R.data.getByRawIndex(R.stackResultDimension,I);if(c==="all"||c==="positive"&&z>0||c==="negative"&&z<0||c==="samesign"&&y>=0&&z>0||c==="samesign"&&y<=0&&z<0){y=Iyt(y,z),E=z;break}}}return r[0]=y,r[1]=E,r})})}var xE=function(){function i(t){this.data=t.data||(t.sourceFormat===wc?{}:[]),this.sourceFormat=t.sourceFormat||OJ,this.seriesLayoutBy=t.seriesLayoutBy||gc,this.startIndex=t.startIndex||0,this.dimensionsDetectedCount=t.dimensionsDetectedCount,this.metaRawOption=t.metaRawOption;var e=this.dimensionsDefine=t.dimensionsDefine;if(e)for(var r=0;r<e.length;r++){var n=e[r];n.type==null&&FJ(this,r)===ps.Must&&(n.type="ordinal")}}return i}();function c3(i){return i instanceof xE}function _z(i,t,e){e=e||$J(i);var r=t.seriesLayoutBy,n=nbt(i,e,r,t.sourceHeader,t.dimensions),o=new xE({data:i,sourceFormat:e,seriesLayoutBy:r,dimensionsDefine:n.dimensionsDefine,startIndex:n.startIndex,dimensionsDetectedCount:n.dimensionsDetectedCount,metaRawOption:Yi(t)});return o}function h3(i){return new xE({data:i,sourceFormat:zl(i)?Cp:nu})}function rbt(i){return new xE({data:i.data,sourceFormat:i.sourceFormat,seriesLayoutBy:i.seriesLayoutBy,dimensionsDefine:Yi(i.dimensionsDefine),startIndex:i.startIndex,dimensionsDetectedCount:i.dimensionsDetectedCount})}function $J(i){var t=OJ;if(zl(i))t=Cp;else if(Ye(i)){i.length===0&&(t=ss);for(var e=0,r=i.length;e<r;e++){var n=i[e];if(n!=null){if(Ye(n)||zl(n)){t=ss;break}else if(nr(n)){t=au;break}}}}else if(nr(i)){for(var o in i)if(Pi(i,o)&&Ns(i[o])){t=wc;break}}return t}function nbt(i,t,e,r,n){var o,s;if(!i)return{dimensionsDefine:Hj(n),startIndex:s,dimensionsDetectedCount:o};if(t===ss){var a=i;r==="auto"||r==null?jj(function(f){f!=null&&f!=="-"&&(wi(f)?s==null&&(s=1):s=0)},e,a,10):s=fn(r)?r:r?1:0,!n&&s===1&&(n=[],jj(function(f,g){n[g]=f!=null?f+"":""},e,a,1/0)),o=n?n.length:e===Lv?a.length:a[0]?a[0].length:null}else if(t===au)n||(n=abt(i));else if(t===wc)n||(n=[],pt(i,function(f,g){n.push(g)}));else if(t===nu){var c=F0(i[0]);o=Ye(c)&&c.length||1}return{startIndex:s,dimensionsDefine:Hj(n),dimensionsDetectedCount:o}}function abt(i){for(var t=0,e;t<i.length&&!(e=i[t++]););if(e)return on(e)}function Hj(i){if(i){var t=Fi();return ti(i,function(e,r){e=nr(e)?e:{name:e};var n={name:e.name,displayName:e.displayName,type:e.type};if(n.name==null)return n;n.name+="",n.displayName==null&&(n.displayName=n.name);var o=t.get(n.name);return o?n.name+="-"+o.count++:t.set(n.name,{count:1}),n})}}function jj(i,t,e,r){if(t===Lv)for(var n=0;n<e.length&&n<r;n++)i(e[n]?e[n][0]:null,n);else for(var o=e[0]||[],n=0;n<o.length&&n<r;n++)i(o[n],n)}function ZJ(i){var t=i.sourceFormat;return t===au||t===wc}var ym,xm,bm,wm,Wj,$j,qJ=function(){function i(t,e){var r=c3(t)?t:h3(t);this._source=r;var n=this._data=r.data,o=r.sourceFormat;r.seriesLayoutBy,o===Cp&&(this._offset=0,this._dimSize=e,this._data=n),$j(this,n,r)}return i.prototype.getSource=function(){return this._source},i.prototype.count=function(){return 0},i.prototype.getItem=function(t,e){},i.prototype.appendData=function(t){},i.prototype.clean=function(){},i.protoInitialize=function(){var t=i.prototype;t.pure=!1,t.persistent=!0}(),i.internalField=function(){var t;$j=function(s,a,c){var f=c.sourceFormat,g=c.seriesLayoutBy,v=c.startIndex,y=c.dimensionsDefine,w=Wj[d3(f,g)];if(Ne(s,w),f===Cp)s.getItem=e,s.count=n,s.fillStorage=r;else{var I=XJ(f,g);s.getItem=Si(I,null,a,v,y);var E=YJ(f,g);s.count=Si(E,null,a,v,y)}};var e=function(s,a){s=s-this._offset,a=a||[];for(var c=this._data,f=this._dimSize,g=f*s,v=0;v<f;v++)a[v]=c[g+v];return a},r=function(s,a,c,f){for(var g=this._data,v=this._dimSize,y=0;y<v;y++){for(var w=f[y],I=w[0]==null?1/0:w[0],E=w[1]==null?-1/0:w[1],D=a-s,R=c[y],z=0;z<D;z++){var N=g[z*v+y];R[s+z]=N,N<I&&(I=N),N>E&&(E=N)}w[0]=I,w[1]=E}},n=function(){return this._data?this._data.length/this._dimSize:0};Wj=(t={},t[ss+"_"+gc]={pure:!0,appendData:o},t[ss+"_"+Lv]={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},t[au]={pure:!0,appendData:o},t[wc]={pure:!0,appendData:function(s){var a=this._data;pt(s,function(c,f){for(var g=a[f]||(a[f]=[]),v=0;v<(c||[]).length;v++)g.push(c[v])})}},t[nu]={appendData:o},t[Cp]={persistent:!1,pure:!0,appendData:function(s){this._data=s},clean:function(){this._offset+=this.count(),this._data=null}},t);function o(s){for(var a=0;a<s.length;a++)this._data.push(s[a])}}(),i}(),DA=function(i){Ye(i)||rK("series.data or dataset.source must be an array.")};ym={},ym[ss+"_"+gc]=DA,ym[ss+"_"+Lv]=DA,ym[au]=DA,ym[wc]=function(i,t){for(var e=0;e<t.length;e++){var r=t[e].name;r==null&&rK("dimension name must not be null/undefined.")}},ym[nu]=DA;var Zj=function(i,t,e,r){return i[r]},obt=(xm={},xm[ss+"_"+gc]=function(i,t,e,r){return i[r+t]},xm[ss+"_"+Lv]=function(i,t,e,r,n){r+=t;for(var o=n||[],s=i,a=0;a<s.length;a++){var c=s[a];o[a]=c?c[r]:null}return o},xm[au]=Zj,xm[wc]=function(i,t,e,r,n){for(var o=n||[],s=0;s<e.length;s++){var a=e[s].name,c=a!=null?i[a]:null;o[s]=c?c[r]:null}return o},xm[nu]=Zj,xm);function XJ(i,t){var e=obt[d3(i,t)];return e}var qj=function(i,t,e){return i.length},sbt=(bm={},bm[ss+"_"+gc]=function(i,t,e){return Math.max(0,i.length-t)},bm[ss+"_"+Lv]=function(i,t,e){var r=i[0];return r?Math.max(0,r.length-t):0},bm[au]=qj,bm[wc]=function(i,t,e){var r=e[0].name,n=r!=null?i[r]:null;return n?n.length:0},bm[nu]=qj,bm);function YJ(i,t){var e=sbt[d3(i,t)];return e}var sR=function(i,t,e){return i[t]},lbt=(wm={},wm[ss]=sR,wm[au]=function(i,t,e){return i[e]},wm[wc]=sR,wm[nu]=function(i,t,e){var r=F0(i);return r instanceof Array?r[t]:r},wm[Cp]=sR,wm);function KJ(i){var t=lbt[i];return t}function d3(i,t){return i===ss?i+"_"+t:i}function T0(i,t,e){if(i){var r=i.getRawDataItem(t);if(r!=null){var n=i.getStore(),o=n.getSource().sourceFormat;if(e!=null){var s=i.getDimensionIndex(e),a=n.getDimensionProperty(s);return KJ(o)(r,s,a)}else{var c=r;return o===nu&&(c=F0(r)),c}}}}var ubt=/\{@(.+?)\}/g,bE=function(){function i(){}return i.prototype.getDataParams=function(t,e){var r=this.getData(e),n=this.getRawValue(t,e),o=r.getRawIndex(t),s=r.getName(t),a=r.getRawDataItem(t),c=r.getItemVisual(t,"style"),f=c&&c[r.getItemVisual(t,"drawType")||"fill"],g=c&&c.stroke,v=this.mainType,y=v==="series",w=r.userOutput&&r.userOutput.get();return{componentType:v,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:y?this.subType:null,seriesIndex:this.seriesIndex,seriesId:y?this.id:null,seriesName:y?this.name:null,name:s,dataIndex:o,data:a,dataType:e,value:n,color:f,borderColor:g,dimensionNames:w?w.fullDimensions:null,encode:w?w.encode:null,$vars:["seriesName","name","value"]}},i.prototype.getFormattedLabel=function(t,e,r,n,o,s){e=e||"normal";var a=this.getData(r),c=this.getDataParams(t,r);if(s&&(c.value=s.interpolatedValue),n!=null&&Ye(c.value)&&(c.value=c.value[n]),!o){var f=a.getItemModel(t);o=f.get(e==="normal"?["label","formatter"]:[e,"label","formatter"])}if(Xi(o))return c.status=e,c.dimensionIndex=n,o(c);if(wi(o)){var g=SJ(o,c);return g.replace(ubt,function(v,y){var w=y.length,I=y;I.charAt(0)==="["&&I.charAt(w-1)==="]"&&(I=+I.slice(1,w-1));var E=T0(a,t,I);if(s&&Ye(s.interpolatedValue)){var D=a.getDimensionIndex(I);D>=0&&(E=s.interpolatedValue[D])}return E!=null?E+"":""})}},i.prototype.getRawValue=function(t,e){return T0(this.getData(e),t)},i.prototype.formatTooltip=function(t,e,r){},i}();function Xj(i){var t,e;return nr(i)?i.type&&(e=i):t=i,{text:t,frag:e}}function Dw(i){return new cbt(i)}var cbt=function(){function i(t){t=t||{},this._reset=t.reset,this._plan=t.plan,this._count=t.count,this._onDirty=t.onDirty,this._dirty=!0}return i.prototype.perform=function(t){var e=this._upstream,r=t&&t.skip;if(this._dirty&&e){var n=this.context;n.data=n.outputData=e.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this);var o;this._plan&&!r&&(o=this._plan(this.context));var s=g(this._modBy),a=this._modDataCount||0,c=g(t&&t.modBy),f=t&&t.modDataCount||0;(s!==c||a!==f)&&(o="reset");function g(z){return!(z>=1)&&(z=1),z}var v;(this._dirty||o==="reset")&&(this._dirty=!1,v=this._doReset(r)),this._modBy=c,this._modDataCount=f;var y=t&&t.step;if(e?this._dueEnd=e._outputDueEnd:this._dueEnd=this._count?this._count(this.context):1/0,this._progress){var w=this._dueIndex,I=Math.min(y!=null?this._dueIndex+y:1/0,this._dueEnd);if(!r&&(v||w<I)){var E=this._progress;if(Ye(E))for(var D=0;D<E.length;D++)this._doProgress(E[D],w,I,c,f);else this._doProgress(E,w,I,c,f)}this._dueIndex=I;var R=this._settedOutputEnd!=null?this._settedOutputEnd:I;this._outputDueEnd=R}else this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd;return this.unfinished()},i.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},i.prototype._doProgress=function(t,e,r,n,o){Yj.reset(e,r,n,o),this._callingProgress=t,this._callingProgress({start:e,end:r,count:r-e,next:Yj.next},this.context)},i.prototype._doReset=function(t){this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null;var e,r;!t&&this._reset&&(e=this._reset(this.context),e&&e.progress&&(r=e.forceFirstProgress,e=e.progress),Ye(e)&&!e.length&&(e=null)),this._progress=e,this._modBy=this._modDataCount=null;var n=this._downstream;return n&&n.dirty(),r},i.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},i.prototype.pipe=function(t){(this._downstream!==t||this._dirty)&&(this._downstream=t,t._upstream=this,t.dirty())},i.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},i.prototype.getUpstream=function(){return this._upstream},i.prototype.getDownstream=function(){return this._downstream},i.prototype.setOutputEnd=function(t){this._outputDueEnd=this._settedOutputEnd=t},i}(),Yj=function(){var i,t,e,r,n,o={reset:function(c,f,g,v){t=c,i=f,e=g,r=v,n=Math.ceil(r/e),o.next=e>1&&r>0?a:s}};return o;function s(){return t<i?t++:null}function a(){var c=t%n*e+Math.ceil(t/n),f=t>=i?null:c<r?c:t;return t++,f}}();function Mp(i,t){var e=t&&t.type;return e==="ordinal"?i:(e==="time"&&!fn(i)&&i!=null&&i!=="-"&&(i=+Mv(i)),i==null||i===""?NaN:Number(i))}var hbt=Fi({number:function(i){return parseFloat(i)},time:function(i){return+Mv(i)},trim:function(i){return wi(i)?Du(i):i}});function JJ(i){return hbt.get(i)}var QJ={lt:function(i,t){return i<t},lte:function(i,t){return i<=t},gt:function(i,t){return i>t},gte:function(i,t){return i>=t}},dbt=function(){function i(t,e){if(!fn(e)){var r="";Pn(r)}this._opFn=QJ[t],this._rvalFloat=kd(e)}return i.prototype.evaluate=function(t){return fn(t)?this._opFn(t,this._rvalFloat):this._opFn(kd(t),this._rvalFloat)},i}(),tQ=function(){function i(t,e){var r=t==="desc";this._resultLT=r?1:-1,e==null&&(e=r?"min":"max"),this._incomparable=e==="min"?-1/0:1/0}return i.prototype.evaluate=function(t,e){var r=fn(t)?t:kd(t),n=fn(e)?e:kd(e),o=isNaN(r),s=isNaN(n);if(o&&(r=this._incomparable),s&&(n=this._incomparable),o&&s){var a=wi(t),c=wi(e);a&&(r=c?t:0),c&&(n=a?e:0)}return r<n?this._resultLT:r>n?-this._resultLT:0},i}(),fbt=function(){function i(t,e){this._rval=e,this._isEQ=t,this._rvalTypeof=typeof e,this._rvalFloat=kd(e)}return i.prototype.evaluate=function(t){var e=t===this._rval;if(!e){var r=typeof t;r!==this._rvalTypeof&&(r==="number"||this._rvalTypeof==="number")&&(e=kd(t)===this._rvalFloat)}return this._isEQ?e:!e},i}();function pbt(i,t){return i==="eq"||i==="ne"?new fbt(i==="eq",t):Pi(QJ,i)?new dbt(i,t):null}var gbt=function(){function i(){}return i.prototype.getRawData=function(){throw new Error("not supported")},i.prototype.getRawDataItem=function(t){throw new Error("not supported")},i.prototype.cloneRawData=function(){},i.prototype.getDimensionInfo=function(t){},i.prototype.cloneAllDimensionInfo=function(){},i.prototype.count=function(){},i.prototype.retrieveValue=function(t,e){},i.prototype.retrieveValueFromItem=function(t,e){},i.prototype.convertValue=function(t,e){return Mp(t,e)},i}();function mbt(i,t){var e=new gbt,r=i.data,n=e.sourceFormat=i.sourceFormat,o=i.startIndex,s="";i.seriesLayoutBy!==gc&&Pn(s);var a=[],c={},f=i.dimensionsDefine;if(f)pt(f,function(E,D){var R=E.name,z={index:D,name:R,displayName:E.displayName};if(a.push(z),R!=null){var N="";Pi(c,R)&&Pn(N),c[R]=z}});else for(var g=0;g<i.dimensionsDetectedCount;g++)a.push({index:g});var v=XJ(n,gc);t.__isBuiltIn&&(e.getRawDataItem=function(E){return v(r,o,a,E)},e.getRawData=Si(vbt,null,i)),e.cloneRawData=Si(_bt,null,i);var y=YJ(n,gc);e.count=Si(y,null,r,o,a);var w=KJ(n);e.retrieveValue=function(E,D){var R=v(r,o,a,E);return I(R,D)};var I=e.retrieveValueFromItem=function(E,D){if(E!=null){var R=a[D];if(R)return w(E,D,R.name)}};return e.getDimensionInfo=Si(ybt,null,a,c),e.cloneAllDimensionInfo=Si(xbt,null,a),e}function vbt(i){var t=i.sourceFormat;if(!f3(t)){var e="";Pn(e)}return i.data}function _bt(i){var t=i.sourceFormat,e=i.data;if(!f3(t)){var r="";Pn(r)}if(t===ss){for(var n=[],o=0,s=e.length;o<s;o++)n.push(e[o].slice());return n}else if(t===au){for(var n=[],o=0,s=e.length;o<s;o++)n.push(Ne({},e[o]));return n}}function ybt(i,t,e){if(e!=null){if(fn(e)||!isNaN(e)&&!Pi(t,e))return i[e];if(Pi(t,e))return t[e]}}function xbt(i){return Yi(i)}var eQ=Fi();function bbt(i){i=Yi(i);var t=i.type,e="";t||Pn(e);var r=t.split(":");r.length!==2&&Pn(e);var n=!1;r[0]==="echarts"&&(t=r[1],n=!0),i.__isBuiltIn=n,eQ.set(t,i)}function wbt(i,t,e){var r=aa(i),n=r.length,o="";n||Pn(o);for(var s=0,a=n;s<a;s++){var c=r[s];t=Sbt(c,t),s!==a-1&&(t.length=Math.max(t.length,1))}return t}function Sbt(i,t,e,r){var n="";t.length||Pn(n),nr(i)||Pn(n);var o=i.type,s=eQ.get(o);s||Pn(n);var a=ti(t,function(f){return mbt(f,s)}),c=aa(s.transform({upstream:a[0],upstreamList:a,config:Yi(i.config)}));return ti(c,function(f,g){var v="";nr(f)||Pn(v),f.data||Pn(v);var y=$J(f.data);f3(y)||Pn(v);var w,I=t[0];if(I&&g===0&&!f.dimensions){var E=I.startIndex;E&&(f.data=I.data.slice(0,E).concat(f.data)),w={seriesLayoutBy:gc,sourceHeader:E,dimensions:I.metaRawOption.dimensions}}else w={seriesLayoutBy:gc,sourceHeader:0,dimensions:f.dimensions};return _z(f.data,w,null)})}function f3(i){return i===ss||i===au}var wE="undefined",Tbt=typeof Uint32Array===wE?Array:Uint32Array,Abt=typeof Uint16Array===wE?Array:Uint16Array,iQ=typeof Int32Array===wE?Array:Int32Array,Kj=typeof Float64Array===wE?Array:Float64Array,rQ={float:Kj,int:iQ,ordinal:Array,number:Array,time:Kj},lR;function Ay(i){return i>65535?Tbt:Abt}function Iy(){return[1/0,-1/0]}function Ibt(i){var t=i.constructor;return t===Array?i.slice():new t(i)}function Jj(i,t,e,r,n){var o=rQ[e||"float"];if(n){var s=i[t],a=s&&s.length;if(a!==r){for(var c=new o(r),f=0;f<a;f++)c[f]=s[f];i[t]=c}}else i[t]=new o(r)}var yz=function(){function i(){this._chunks=[],this._rawExtent=[],this._extent=[],this._count=0,this._rawCount=0,this._calcDimNameToIdx=Fi()}return i.prototype.initData=function(t,e,r){this._provider=t,this._chunks=[],this._indices=null,this.getRawIndex=this._getRawIdxIdentity;var n=t.getSource(),o=this.defaultDimValueGetter=lR[n.sourceFormat];this._dimValueGetter=r||o,this._rawExtent=[],ZJ(n),this._dimensions=ti(e,function(s){return{type:s.type,property:s.property}}),this._initDataFromProvider(0,t.count())},i.prototype.getProvider=function(){return this._provider},i.prototype.getSource=function(){return this._provider.getSource()},i.prototype.ensureCalculationDimension=function(t,e){var r=this._calcDimNameToIdx,n=this._dimensions,o=r.get(t);if(o!=null){if(n[o].type===e)return o}else o=n.length;return n[o]={type:e},r.set(t,o),this._chunks[o]=new rQ[e||"float"](this._rawCount),this._rawExtent[o]=Iy(),o},i.prototype.collectOrdinalMeta=function(t,e){var r=this._chunks[t],n=this._dimensions[t],o=this._rawExtent,s=n.ordinalOffset||0,a=r.length;s===0&&(o[t]=Iy());for(var c=o[t],f=s;f<a;f++){var g=r[f]=e.parseAndCollect(r[f]);isNaN(g)||(c[0]=Math.min(g,c[0]),c[1]=Math.max(g,c[1]))}n.ordinalMeta=e,n.ordinalOffset=a,n.type="ordinal"},i.prototype.getOrdinalMeta=function(t){var e=this._dimensions[t],r=e.ordinalMeta;return r},i.prototype.getDimensionProperty=function(t){var e=this._dimensions[t];return e&&e.property},i.prototype.appendData=function(t){var e=this._provider,r=this.count();e.appendData(t);var n=e.count();return e.persistent||(n+=r),r<n&&this._initDataFromProvider(r,n,!0),[r,n]},i.prototype.appendValues=function(t,e){for(var r=this._chunks,n=this._dimensions,o=n.length,s=this._rawExtent,a=this.count(),c=a+Math.max(t.length,e||0),f=0;f<o;f++){var g=n[f];Jj(r,f,g.type,c,!0)}for(var v=[],y=a;y<c;y++)for(var w=y-a,I=0;I<o;I++){var g=n[I],E=lR.arrayRows.call(this,t[w]||v,g.property,w,I);r[I][y]=E;var D=s[I];E<D[0]&&(D[0]=E),E>D[1]&&(D[1]=E)}return this._rawCount=this._count=c,{start:a,end:c}},i.prototype._initDataFromProvider=function(t,e,r){for(var n=this._provider,o=this._chunks,s=this._dimensions,a=s.length,c=this._rawExtent,f=ti(s,function(z){return z.property}),g=0;g<a;g++){var v=s[g];c[g]||(c[g]=Iy()),Jj(o,g,v.type,e,r)}if(n.fillStorage)n.fillStorage(t,e,o,c);else for(var y=[],w=t;w<e;w++){y=n.getItem(w,y);for(var I=0;I<a;I++){var E=o[I],D=this._dimValueGetter(y,f[I],w,I);E[w]=D;var R=c[I];D<R[0]&&(R[0]=D),D>R[1]&&(R[1]=D)}}!n.persistent&&n.clean&&n.clean(),this._rawCount=this._count=e,this._extent=[]},i.prototype.count=function(){return this._count},i.prototype.get=function(t,e){if(!(e>=0&&e<this._count))return NaN;var r=this._chunks[t];return r?r[this.getRawIndex(e)]:NaN},i.prototype.getValues=function(t,e){var r=[],n=[];if(e==null){e=t,t=[];for(var o=0;o<this._dimensions.length;o++)n.push(o)}else n=t;for(var o=0,s=n.length;o<s;o++)r.push(this.get(n[o],e));return r},i.prototype.getByRawIndex=function(t,e){if(!(e>=0&&e<this._rawCount))return NaN;var r=this._chunks[t];return r?r[e]:NaN},i.prototype.getSum=function(t){var e=this._chunks[t],r=0;if(e)for(var n=0,o=this.count();n<o;n++){var s=this.get(t,n);isNaN(s)||(r+=s)}return r},i.prototype.getMedian=function(t){var e=[];this.each([t],function(o){isNaN(o)||e.push(o)});var r=e.sort(function(o,s){return o-s}),n=this.count();return n===0?0:n%2===1?r[(n-1)/2]:(r[n/2]+r[n/2-1])/2},i.prototype.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var e=this._indices,r=e[t];if(r!=null&&r<this._count&&r===t)return t;for(var n=0,o=this._count-1;n<=o;){var s=(n+o)/2|0;if(e[s]<t)n=s+1;else if(e[s]>t)o=s-1;else return s}return-1},i.prototype.getIndices=function(){var t,e=this._indices;if(e){var r=e.constructor,n=this._count;if(r===Array){t=new r(n);for(var o=0;o<n;o++)t[o]=e[o]}else t=new r(e.buffer,0,n)}else{var r=Ay(this._rawCount);t=new r(this.count());for(var o=0;o<t.length;o++)t[o]=o}return t},i.prototype.filter=function(t,e){if(!this._count)return this;for(var r=this.clone(),n=r.count(),o=Ay(r._rawCount),s=new o(n),a=[],c=t.length,f=0,g=t[0],v=r._chunks,y=0;y<n;y++){var w=void 0,I=r.getRawIndex(y);if(c===0)w=e(y);else if(c===1){var E=v[g][I];w=e(E,y)}else{for(var D=0;D<c;D++)a[D]=v[t[D]][I];a[D]=y,w=e.apply(null,a)}w&&(s[f++]=I)}return f<n&&(r._indices=s),r._count=f,r._extent=[],r._updateGetRawIdx(),r},i.prototype.selectRange=function(t){var e=this.clone(),r=e._count;if(!r)return this;var n=on(t),o=n.length;if(!o)return this;var s=e.count(),a=Ay(e._rawCount),c=new a(s),f=0,g=n[0],v=t[g][0],y=t[g][1],w=e._chunks,I=!1;if(!e._indices){var E=0;if(o===1){for(var D=w[n[0]],R=0;R<r;R++){var z=D[R];(z>=v&&z<=y||isNaN(z))&&(c[f++]=E),E++}I=!0}else if(o===2){for(var D=w[n[0]],N=w[n[1]],H=t[n[1]][0],q=t[n[1]][1],R=0;R<r;R++){var z=D[R],Y=N[R];(z>=v&&z<=y||isNaN(z))&&(Y>=H&&Y<=q||isNaN(Y))&&(c[f++]=E),E++}I=!0}}if(!I)if(o===1)for(var R=0;R<s;R++){var J=e.getRawIndex(R),z=w[n[0]][J];(z>=v&&z<=y||isNaN(z))&&(c[f++]=J)}else for(var R=0;R<s;R++){for(var it=!0,J=e.getRawIndex(R),at=0;at<o;at++){var ut=n[at],z=w[ut][J];(z<t[ut][0]||z>t[ut][1])&&(it=!1)}it&&(c[f++]=e.getRawIndex(R))}return f<s&&(e._indices=c),e._count=f,e._extent=[],e._updateGetRawIdx(),e},i.prototype.map=function(t,e){var r=this.clone(t);return this._updateDims(r,t,e),r},i.prototype.modify=function(t,e){this._updateDims(this,t,e)},i.prototype._updateDims=function(t,e,r){for(var n=t._chunks,o=[],s=e.length,a=t.count(),c=[],f=t._rawExtent,g=0;g<e.length;g++)f[e[g]]=Iy();for(var v=0;v<a;v++){for(var y=t.getRawIndex(v),w=0;w<s;w++)c[w]=n[e[w]][y];c[s]=v;var I=r&&r.apply(null,c);if(I!=null){typeof I!="object"&&(o[0]=I,I=o);for(var g=0;g<I.length;g++){var E=e[g],D=I[g],R=f[E],z=n[E];z&&(z[y]=D),D<R[0]&&(R[0]=D),D>R[1]&&(R[1]=D)}}}},i.prototype.lttbDownSample=function(t,e){var r=this.clone([t],!0),n=r._chunks,o=n[t],s=this.count(),a=0,c=Math.floor(1/e),f=this.getRawIndex(0),g,v,y,w=new(Ay(this._rawCount))(Math.min((Math.ceil(s/c)+2)*2,s));w[a++]=f;for(var I=1;I<s-1;I+=c){for(var E=Math.min(I+c,s-1),D=Math.min(I+c*2,s),R=(D+E)/2,z=0,N=E;N<D;N++){var H=this.getRawIndex(N),q=o[H];isNaN(q)||(z+=q)}z/=D-E;var Y=I,J=Math.min(I+c,s),it=I-1,at=o[f];g=-1,y=Y;for(var ut=-1,ft=0,N=Y;N<J;N++){var H=this.getRawIndex(N),q=o[H];if(isNaN(q)){ft++,ut<0&&(ut=H);continue}v=Math.abs((it-R)*(q-at)-(it-N)*(z-at)),v>g&&(g=v,y=H)}ft>0&&ft<J-Y&&(w[a++]=Math.min(ut,y),y=Math.max(ut,y)),w[a++]=y,f=y}return w[a++]=this.getRawIndex(s-1),r._count=a,r._indices=w,r.getRawIndex=this._getRawIdx,r},i.prototype.minmaxDownSample=function(t,e){for(var r=this.clone([t],!0),n=r._chunks,o=Math.floor(1/e),s=n[t],a=this.count(),c=new(Ay(this._rawCount))(Math.ceil(a/o)*2),f=0,g=0;g<a;g+=o){var v=g,y=s[this.getRawIndex(v)],w=g,I=s[this.getRawIndex(w)],E=o;g+o>a&&(E=a-g);for(var D=0;D<E;D++){var R=this.getRawIndex(g+D),z=s[R];z<y&&(y=z,v=g+D),z>I&&(I=z,w=g+D)}var N=this.getRawIndex(v),H=this.getRawIndex(w);v<w?(c[f++]=N,c[f++]=H):(c[f++]=H,c[f++]=N)}return r._count=f,r._indices=c,r._updateGetRawIdx(),r},i.prototype.downSample=function(t,e,r,n){for(var o=this.clone([t],!0),s=o._chunks,a=[],c=Math.floor(1/e),f=s[t],g=this.count(),v=o._rawExtent[t]=Iy(),y=new(Ay(this._rawCount))(Math.ceil(g/c)),w=0,I=0;I<g;I+=c){c>g-I&&(c=g-I,a.length=c);for(var E=0;E<c;E++){var D=this.getRawIndex(I+E);a[E]=f[D]}var R=r(a),z=this.getRawIndex(Math.min(I+n(a,R)||0,g-1));f[z]=R,R<v[0]&&(v[0]=R),R>v[1]&&(v[1]=R),y[w++]=z}return o._count=w,o._indices=y,o._updateGetRawIdx(),o},i.prototype.each=function(t,e){if(this._count)for(var r=t.length,n=this._chunks,o=0,s=this.count();o<s;o++){var a=this.getRawIndex(o);switch(r){case 0:e(o);break;case 1:e(n[t[0]][a],o);break;case 2:e(n[t[0]][a],n[t[1]][a],o);break;default:for(var c=0,f=[];c<r;c++)f[c]=n[t[c]][a];f[c]=o,e.apply(null,f)}}},i.prototype.getDataExtent=function(t){var e=this._chunks[t],r=Iy();if(!e)return r;var n=this.count(),o=!this._indices,s;if(o)return this._rawExtent[t].slice();if(s=this._extent[t],s)return s.slice();s=r;for(var a=s[0],c=s[1],f=0;f<n;f++){var g=this.getRawIndex(f),v=e[g];v<a&&(a=v),v>c&&(c=v)}return s=[a,c],this._extent[t]=s,s},i.prototype.getRawDataItem=function(t){var e=this.getRawIndex(t);if(this._provider.persistent)return this._provider.getItem(e);for(var r=[],n=this._chunks,o=0;o<n.length;o++)r.push(n[o][e]);return r},i.prototype.clone=function(t,e){var r=new i,n=this._chunks,o=t&&xh(t,function(a,c){return a[c]=!0,a},{});if(o)for(var s=0;s<n.length;s++)r._chunks[s]=o[s]?Ibt(n[s]):n[s];else r._chunks=n;return this._copyCommonProps(r),e||(r._indices=this._cloneIndices()),r._updateGetRawIdx(),r},i.prototype._copyCommonProps=function(t){t._count=this._count,t._rawCount=this._rawCount,t._provider=this._provider,t._dimensions=this._dimensions,t._extent=Yi(this._extent),t._rawExtent=Yi(this._rawExtent)},i.prototype._cloneIndices=function(){if(this._indices){var t=this._indices.constructor,e=void 0;if(t===Array){var r=this._indices.length;e=new t(r);for(var n=0;n<r;n++)e[n]=this._indices[n]}else e=new t(this._indices);return e}return null},i.prototype._getRawIdxIdentity=function(t){return t},i.prototype._getRawIdx=function(t){return t<this._count&&t>=0?this._indices[t]:-1},i.prototype._updateGetRawIdx=function(){this.getRawIndex=this._indices?this._getRawIdx:this._getRawIdxIdentity},i.internalField=function(){function t(e,r,n,o){return Mp(e[o],this._dimensions[o])}lR={arrayRows:t,objectRows:function(e,r,n,o){return Mp(e[r],this._dimensions[o])},keyedColumns:t,original:function(e,r,n,o){var s=e&&(e.value==null?e:e.value);return Mp(s instanceof Array?s[o]:s,this._dimensions[o])},typedArray:function(e,r,n,o){return e[o]}}}(),i}(),nQ=function(){function i(t){this._sourceList=[],this._storeList=[],this._upstreamSignList=[],this._versionSignBase=0,this._dirty=!0,this._sourceHost=t}return i.prototype.dirty=function(){this._setLocalSource([],[]),this._storeList=[],this._dirty=!0},i.prototype._setLocalSource=function(t,e){this._sourceList=t,this._upstreamSignList=e,this._versionSignBase++,this._versionSignBase>9e10&&(this._versionSignBase=0)},i.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},i.prototype.prepareSource=function(){this._isDirty()&&(this._createSource(),this._dirty=!1)},i.prototype._createSource=function(){this._setLocalSource([],[]);var t=this._sourceHost,e=this._getUpstreamSourceManagers(),r=!!e.length,n,o;if(PA(t)){var s=t,a=void 0,c=void 0,f=void 0;if(r){var g=e[0];g.prepareSource(),f=g.getSource(),a=f.data,c=f.sourceFormat,o=[g._getVersionSign()]}else a=s.get("data",!0),c=zl(a)?Cp:nu,o=[];var v=this._getSourceMetaRawOption()||{},y=f&&f.metaRawOption||{},w=Ui(v.seriesLayoutBy,y.seriesLayoutBy)||null,I=Ui(v.sourceHeader,y.sourceHeader),E=Ui(v.dimensions,y.dimensions),D=w!==y.seriesLayoutBy||!!I!=!!y.sourceHeader||E;n=D?[_z(a,{seriesLayoutBy:w,sourceHeader:I,dimensions:E},c)]:[]}else{var R=t;if(r){var z=this._applyTransform(e);n=z.sourceList,o=z.upstreamSignList}else{var N=R.get("source",!0);n=[_z(N,this._getSourceMetaRawOption(),null)],o=[]}}this._setLocalSource(n,o)},i.prototype._applyTransform=function(t){var e=this._sourceHost,r=e.get("transform",!0),n=e.get("fromTransformResult",!0);if(n!=null){var o="";t.length!==1&&t8(o)}var s,a=[],c=[];return pt(t,function(f){f.prepareSource();var g=f.getSource(n||0),v="";n!=null&&!g&&t8(v),a.push(g),c.push(f._getVersionSign())}),r?s=wbt(r,a,{datasetIndex:e.componentIndex}):n!=null&&(s=[rbt(a[0])]),{sourceList:s,upstreamSignList:c}},i.prototype._isDirty=function(){if(this._dirty)return!0;for(var t=this._getUpstreamSourceManagers(),e=0;e<t.length;e++){var r=t[e];if(r._isDirty()||this._upstreamSignList[e]!==r._getVersionSign())return!0}},i.prototype.getSource=function(t){t=t||0;var e=this._sourceList[t];if(!e){var r=this._getUpstreamSourceManagers();return r[0]&&r[0].getSource(t)}return e},i.prototype.getSharedDataStore=function(t){var e=t.makeStoreSchema();return this._innerGetDataStore(e.dimensions,t.source,e.hash)},i.prototype._innerGetDataStore=function(t,e,r){var n=0,o=this._storeList,s=o[n];s||(s=o[n]={});var a=s[r];if(!a){var c=this._getUpstreamSourceManagers()[0];PA(this._sourceHost)&&c?a=c._innerGetDataStore(t,e,r):(a=new yz,a.initData(new qJ(e,t.length),t)),s[r]=a}return a},i.prototype._getUpstreamSourceManagers=function(){var t=this._sourceHost;if(PA(t)){var e=l3(t);return e?[e.getSourceManager()]:[]}else return ti(D1t(t),function(r){return r.getSourceManager()})},i.prototype._getSourceMetaRawOption=function(){var t=this._sourceHost,e,r,n;if(PA(t))e=t.get("seriesLayoutBy",!0),r=t.get("sourceHeader",!0),n=t.get("dimensions",!0);else if(!this._getUpstreamSourceManagers().length){var o=t;e=o.get("seriesLayoutBy",!0),r=o.get("sourceHeader",!0),n=o.get("dimensions",!0)}return{seriesLayoutBy:e,sourceHeader:r,dimensions:n}},i}();function Qj(i){var t=i.option.transform;t&&AC(i.option.transform)}function PA(i){return i.mainType==="series"}function t8(i){throw new Error(i)}var Cbt="line-height:1";function aQ(i){var t=i.lineHeight;return t==null?Cbt:"line-height:"+Rs(t+"")+"px"}function oQ(i,t){var e=i.color||ye.color.tertiary,r=i.fontSize||12,n=i.fontWeight||"400",o=i.color||ye.color.secondary,s=i.fontSize||14,a=i.fontWeight||"900";return t==="html"?{nameStyle:"font-size:"+Rs(r+"")+"px;color:"+Rs(e)+";font-weight:"+Rs(n+""),valueStyle:"font-size:"+Rs(s+"")+"px;color:"+Rs(o)+";font-weight:"+Rs(a+"")}:{nameStyle:{fontSize:r,fill:e,fontWeight:n},valueStyle:{fontSize:s,fill:o,fontWeight:a}}}var Mbt=[0,10,20,30],Ebt=["",`
`,`

`,`


`];function So(i,t){return t.type=i,t}function xz(i){return i.type==="section"}function sQ(i){return xz(i)?Dbt:Pbt}function lQ(i){if(xz(i)){var t=0,e=i.blocks.length,r=e>1||e>0&&!i.noHeader;return pt(i.blocks,function(n){var o=lQ(n);o>=t&&(t=o+ +(r&&(!o||xz(n)&&!n.noHeader)))}),t}return 0}function Dbt(i,t,e,r){var n=t.noHeader,o=Lbt(lQ(t)),s=[],a=t.blocks||[];Vs(!a||Ye(a)),a=a||[];var c=i.orderMode;if(t.sortBlocks&&c){a=a.slice();var f={valueAsc:"asc",valueDesc:"desc"};if(Pi(f,c)){var g=new tQ(f[c],null);a.sort(function(E,D){return g.evaluate(E.sortParam,D.sortParam)})}else c==="seriesDesc"&&a.reverse()}pt(a,function(E,D){var R=t.valueFormatter,z=sQ(E)(R?Ne(Ne({},i),{valueFormatter:R}):i,E,D>0?o.html:0,r);z!=null&&s.push(z)});var v=i.renderMode==="richText"?s.join(o.richText):bz(r,s.join(""),n?e:o.html);if(n)return v;var y=pz(t.header,"ordinal",i.useUTC),w=oQ(r,i.renderMode).nameStyle,I=aQ(r);return i.renderMode==="richText"?uQ(i,y,w)+o.richText+v:bz(r,'<div style="'+w+";"+I+';">'+Rs(y)+"</div>"+v,e)}function Pbt(i,t,e,r){var n=i.renderMode,o=t.noName,s=t.noValue,a=!t.markerType,c=t.name,f=i.useUTC,g=t.valueFormatter||i.valueFormatter||function(H){return H=Ye(H)?H:[H],ti(H,function(q,Y){return pz(q,Ye(w)?w[Y]:w,f)})};if(!(o&&s)){var v=a?"":i.markupStyleCreator.makeTooltipMarker(t.markerType,t.markerColor||ye.color.secondary,n),y=o?"":pz(c,"ordinal",f),w=t.valueType,I=s?[]:g(t.value,t.dataIndex),E=!a||!o,D=!a&&o,R=oQ(r,n),z=R.nameStyle,N=R.valueStyle;return n==="richText"?(a?"":v)+(o?"":uQ(i,y,z))+(s?"":Obt(i,I,E,D,N)):bz(r,(a?"":v)+(o?"":Rbt(y,!a,z))+(s?"":kbt(I,E,D,N)),e)}}function e8(i,t,e,r,n,o){if(i){var s=sQ(i),a={useUTC:n,renderMode:e,orderMode:r,markupStyleCreator:t,valueFormatter:i.valueFormatter};return s(a,i,0,o)}}function Lbt(i){return{html:Mbt[i],richText:Ebt[i]}}function bz(i,t,e){var r='<div style="clear:both"></div>',n="margin: "+e+"px 0 0",o=aQ(i);return'<div style="'+n+";"+o+';">'+t+r+"</div>"}function Rbt(i,t,e){var r=t?"margin-left:2px":"";return'<span style="'+e+";"+r+'">'+Rs(i)+"</span>"}function kbt(i,t,e,r){var n=e?"10px":"20px",o=t?"float:right;margin-left:"+n:"";return i=Ye(i)?i:[i],'<span style="'+o+";"+r+'">'+ti(i,function(s){return Rs(s)}).join("&nbsp;&nbsp;")+"</span>"}function uQ(i,t,e){return i.markupStyleCreator.wrapRichTextStyle(t,e)}function Obt(i,t,e,r,n){var o=[n],s=r?10:20;return e&&o.push({padding:[0,0,0,s],align:"right"}),i.markupStyleCreator.wrapRichTextStyle(Ye(t)?t.join("  "):t,o)}function cQ(i,t){var e=i.getData().getItemVisual(t,"style"),r=e[i.visualDrawType];return wv(r)}function hQ(i,t){var e=i.get("padding");return e??(t==="richText"?[8,10]:10)}var uR=function(){function i(){this.richTextStyles={},this._nextStyleNameId=eK()}return i.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},i.prototype.makeTooltipMarker=function(t,e,r){var n=r==="richText"?this._generateStyleName():null,o=y1t({color:e,type:t,renderMode:r,markerId:n});return wi(o)?o:(this.richTextStyles[n]=o.style,o.content)},i.prototype.wrapRichTextStyle=function(t,e){var r={};Ye(e)?pt(e,function(o){return Ne(r,o)}):Ne(r,e);var n=this._generateStyleName();return this.richTextStyles[n]=r,"{"+n+"|"+t+"}"},i}();function dQ(i){var t=i.series,e=i.dataIndex,r=i.multipleSeries,n=t.getData(),o=n.mapDimensionsAll("defaultedTooltip"),s=o.length,a=t.getRawValue(e),c=Ye(a),f=cQ(t,e),g,v,y,w;if(s>1||c&&!s){var I=zbt(a,t,e,o,f);g=I.inlineValues,v=I.inlineValueTypes,y=I.blocks,w=I.inlineValues[0]}else if(s){var E=n.getDimensionInfo(o[0]);w=g=T0(n,e,o[0]),v=E.type}else w=g=c?a[0]:a;var D=LF(t),R=D&&t.name||"",z=n.getName(e),N=r?R:z;return So("section",{header:R,noHeader:r||!D,sortParam:w,blocks:[So("nameValue",{markerType:"item",markerColor:f,name:N,noName:!Du(N),value:g,valueType:v,dataIndex:e})].concat(y||[])})}function zbt(i,t,e,r,n){var o=t.getData(),s=xh(i,function(v,y,w){var I=o.getDimensionInfo(w);return v=v||I&&I.tooltip!==!1&&I.displayName!=null},!1),a=[],c=[],f=[];r.length?pt(r,function(v){g(T0(o,e,v),v)}):pt(i,g);function g(v,y){var w=o.getDimensionInfo(y);!w||w.otherDims.tooltip===!1||(s?f.push(So("nameValue",{markerType:"subItem",markerColor:n,name:w.displayName,value:v,valueType:w.type})):(a.push(v),c.push(w.type)))}return{inlineValues:a,inlineValueTypes:c,blocks:f}}var jf=Wr();function LA(i,t){return i.getName(t)||i.getId(t)}var eC="__universalTransitionEnabled",SE=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._selectedDataIndicesMap={},e}return t.prototype.init=function(e,r,n){this.seriesIndex=this.componentIndex,this.dataTask=Dw({count:Fbt,reset:Nbt}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(e,n);var o=jf(this).sourceManager=new nQ(this);o.prepareSource();var s=this.getInitialData(e,n);r8(s,this),this.dataTask.context.data=s,jf(this).dataBeforeProcessed=s,i8(this),this._initSelectedMapFromData(s)},t.prototype.mergeDefaultAndTheme=function(e,r){var n=lS(this),o=n?Pv(e):{},s=this.subType;gn.hasClass(s)&&(s+="Series"),Er(e,r.getTheme().get(this.subType)),Er(e,this.getDefaultOption()),mv(e,"label",["show"]),this.fillDataTextStyle(e.data),n&&Th(e,o,n)},t.prototype.mergeOption=function(e,r){e=Er(this.option,e,!0),this.fillDataTextStyle(e.data);var n=lS(this);n&&Th(this.option,e,n);var o=jf(this).sourceManager;o.dirty(),o.prepareSource();var s=this.getInitialData(e,r);r8(s,this),this.dataTask.dirty(),this.dataTask.context.data=s,jf(this).dataBeforeProcessed=s,i8(this),this._initSelectedMapFromData(s)},t.prototype.fillDataTextStyle=function(e){if(e&&!zl(e))for(var r=["show"],n=0;n<e.length;n++)e[n]&&e[n].label&&mv(e[n],"label",r)},t.prototype.getInitialData=function(e,r){},t.prototype.appendData=function(e){var r=this.getRawData();r.appendData(e.data)},t.prototype.getData=function(e){var r=wz(this);if(r){var n=r.context.data;return e==null||!n.getLinkedData?n:n.getLinkedData(e)}else return jf(this).data},t.prototype.getAllData=function(){var e=this.getData();return e&&e.getLinkedDataAll?e.getLinkedDataAll():[{data:e}]},t.prototype.setData=function(e){var r=wz(this);if(r){var n=r.context;n.outputData=e,r!==this.dataTask&&(n.data=e)}jf(this).data=e},t.prototype.getEncode=function(){var e=this.get("encode",!0);if(e)return Fi(e)},t.prototype.getSourceManager=function(){return jf(this).sourceManager},t.prototype.getSource=function(){return this.getSourceManager().getSource()},t.prototype.getRawData=function(){return jf(this).dataBeforeProcessed},t.prototype.getColorBy=function(){var e=this.get("colorBy");return e||"series"},t.prototype.isColorBySeries=function(){return this.getColorBy()==="series"},t.prototype.getBaseAxis=function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()},t.prototype.indicesOfNearest=function(e,r,n,o){var s=this.getData(),a=this.coordinateSystem,c=a&&a.getAxis(e);if(!a||!c)return[];var f=c.dataToCoord(n);o==null&&(o=1/0);var g=[],v=1/0,y=-1,w=0;return s.each(r,function(I,E){var D=c.dataToCoord(I),R=f-D,z=Math.abs(R);z<=o&&((z<v||z===v&&R>=0&&y<0)&&(v=z,y=R,w=0),R===y&&(g[w++]=E))}),g.length=w,g},t.prototype.formatTooltip=function(e,r,n){return dQ({series:this,dataIndex:e,multipleSeries:r})},t.prototype.isAnimationEnabled=function(){var e=this.ecModel;if(Sn.node&&!(e&&e.ssr))return!1;var r=this.getShallow("animation");return r&&this.getData().count()>this.getShallow("animationThreshold")&&(r=!1),!!r},t.prototype.restoreData=function(){this.dataTask.dirty()},t.prototype.getColorFromPalette=function(e,r,n){var o=this.ecModel,s=u3.prototype.getColorFromPalette.call(this,e,r,n);return s||(s=o.getColorFromPalette(e,r,n)),s},t.prototype.coordDimToDataDim=function(e){return this.getRawData().mapDimensionsAll(e)},t.prototype.getProgressive=function(){return this.get("progressive")},t.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},t.prototype.select=function(e,r){this._innerSelect(this.getData(r),e)},t.prototype.unselect=function(e,r){var n=this.option.selectedMap;if(n){var o=this.option.selectedMode,s=this.getData(r);if(o==="series"||n==="all"){this.option.selectedMap={},this._selectedDataIndicesMap={};return}for(var a=0;a<e.length;a++){var c=e[a],f=LA(s,c);n[f]=!1,this._selectedDataIndicesMap[f]=-1}}},t.prototype.toggleSelect=function(e,r){for(var n=[],o=0;o<e.length;o++)n[0]=e[o],this.isSelected(e[o],r)?this.unselect(n,r):this.select(n,r)},t.prototype.getSelectedDataIndices=function(){if(this.option.selectedMap==="all")return[].slice.call(this.getData().getIndices());for(var e=this._selectedDataIndicesMap,r=on(e),n=[],o=0;o<r.length;o++){var s=e[r[o]];s>=0&&n.push(s)}return n},t.prototype.isSelected=function(e,r){var n=this.option.selectedMap;if(!n)return!1;var o=this.getData(r);return(n==="all"||n[LA(o,e)])&&!o.getItemModel(e).get(["select","disabled"])},t.prototype.isUniversalTransitionEnabled=function(){if(this[eC])return!0;var e=this.option.universalTransition;return e?e===!0?!0:e&&e.enabled:!1},t.prototype._innerSelect=function(e,r){var n,o,s=this.option,a=s.selectedMode,c=r.length;if(!(!a||!c)){if(a==="series")s.selectedMap="all";else if(a==="multiple"){nr(s.selectedMap)||(s.selectedMap={});for(var f=s.selectedMap,g=0;g<c;g++){var v=r[g],y=LA(e,v);f[y]=!0,this._selectedDataIndicesMap[y]=e.getRawIndex(v)}}else if(a==="single"||a===!0){var w=r[c-1],y=LA(e,w);s.selectedMap=(n={},n[y]=!0,n),this._selectedDataIndicesMap=(o={},o[y]=e.getRawIndex(w),o)}}},t.prototype._initSelectedMapFromData=function(e){if(!this.option.selectedMap){var r=[];e.hasItemOption&&e.each(function(n){var o=e.getRawDataItem(n);o&&o.selected&&r.push(n)}),r.length>0&&this._innerSelect(e,r)}},t.registerClass=function(e){return gn.registerClass(e)},t.protoInitialize=function(){var e=t.prototype;e.type="series.__base__",e.seriesIndex=0,e.ignoreStyleOnData=!1,e.hasSymbolVisual=!1,e.defaultSymbol="circle",e.visualStyleAccessPath="itemStyle",e.visualDrawType="fill"}(),t}(gn);Ao(SE,bE);Ao(SE,u3);hK(SE,gn);function i8(i){var t=i.name;LF(i)||(i.name=Bbt(i)||t)}function Bbt(i){var t=i.getRawData(),e=t.mapDimensionsAll("seriesName"),r=[];return pt(e,function(n){var o=t.getDimensionInfo(n);o.displayName&&r.push(o.displayName)}),r.join(" ")}function Fbt(i){return i.model.getRawData().count()}function Nbt(i){var t=i.model;return t.setData(t.getRawData().cloneShallow()),Vbt}function Vbt(i,t){t.outputData&&i.end>t.outputData.count()&&t.model.getRawData().cloneShallow(t.outputData)}function r8(i,t){pt(Kw(i.CHANGABLE_METHODS,i.DOWNSAMPLE_METHODS),function(e){i.wrapMethod(e,br(Ubt,t))})}function Ubt(i,t){var e=wz(i);return e&&e.setOutputEnd((t||this).count()),t}function wz(i){var t=(i.ecModel||{}).scheduler,e=t&&t.getPipeline(i.uid);if(e){var r=e.currentTask;if(r){var n=r.agentStubMap;n&&(r=n.get(i.uid))}return r}}const Ea=SE;var p3=function(){function i(){this.group=new Ki,this.uid=j0("viewComponent")}return i.prototype.init=function(t,e){},i.prototype.render=function(t,e,r,n){},i.prototype.dispose=function(t,e){},i.prototype.updateView=function(t,e,r,n){},i.prototype.updateLayout=function(t,e,r,n){},i.prototype.updateVisual=function(t,e,r,n){},i.prototype.toggleBlurSeries=function(t,e,r){},i.prototype.eachRendered=function(t){var e=this.group;e&&e.traverse(t)},i}();kF(p3);nE(p3);const Oa=p3;function $0(){var i=Wr();return function(t){var e=i(t),r=t.pipelineContext,n=!!e.large,o=!!e.progressiveRender,s=e.large=!!(r&&r.large),a=e.progressiveRender=!!(r&&r.progressiveRender);return(n!==s||o!==a)&&"reset"}}var fQ=Wr(),Gbt=$0(),g3=function(){function i(){this.group=new Ki,this.uid=j0("viewChart"),this.renderTask=Dw({plan:Hbt,reset:jbt}),this.renderTask.context={view:this}}return i.prototype.init=function(t,e){},i.prototype.render=function(t,e,r,n){},i.prototype.highlight=function(t,e,r,n){var o=t.getData(n&&n.dataType);o&&a8(o,n,"emphasis")},i.prototype.downplay=function(t,e,r,n){var o=t.getData(n&&n.dataType);o&&a8(o,n,"normal")},i.prototype.remove=function(t,e){this.group.removeAll()},i.prototype.dispose=function(t,e){},i.prototype.updateView=function(t,e,r,n){this.render(t,e,r,n)},i.prototype.updateLayout=function(t,e,r,n){this.render(t,e,r,n)},i.prototype.updateVisual=function(t,e,r,n){this.render(t,e,r,n)},i.prototype.eachRendered=function(t){$p(this.group,t)},i.markUpdateMethod=function(t,e){fQ(t).updateMethod=e},i.protoInitialize=function(){var t=i.prototype;t.type="chart"}(),i}();function n8(i,t,e){i&&aS(i)&&(t==="emphasis"?Od:zd)(i,e)}function a8(i,t,e){var r=vv(i,t),n=t&&t.highlightKey!=null?axt(t.highlightKey):null;r!=null?pt(aa(r),function(o){n8(i.getItemGraphicEl(o),e,n)}):i.eachItemGraphicEl(function(o){n8(o,e,n)})}kF(g3);nE(g3);function Hbt(i){return Gbt(i.model)}function jbt(i){var t=i.model,e=i.ecModel,r=i.api,n=i.payload,o=t.pipelineContext.progressiveRender,s=i.view,a=n&&fQ(n).updateMethod,c=o?"incrementalPrepareRender":a&&s[a]?a:"render";return c!=="render"&&s[c](t,e,r,n),Wbt[c]}var Wbt={incrementalPrepareRender:{progress:function(i,t){t.view.incrementalRender(i,t.model,t.ecModel,t.api,t.payload)}},render:{forceFirstProgress:!0,progress:function(i,t){t.view.render(t.model,t.ecModel,t.api,t.payload)}}};const ga=g3;var jC="\0__throttleOriginMethod",o8="\0__throttleRate",s8="\0__throttleType";function m3(i,t,e){var r,n=0,o=0,s=null,a,c,f,g;t=t||0;function v(){o=new Date().getTime(),s=null,i.apply(c,f||[])}var y=function(){for(var w=[],I=0;I<arguments.length;I++)w[I]=arguments[I];r=new Date().getTime(),c=this,f=w;var E=g||t,D=g||e;g=null,a=r-(D?n:o)-E,clearTimeout(s),D?s=setTimeout(v,E):a>=0?v():s=setTimeout(v,-a),n=r};return y.clear=function(){s&&(clearTimeout(s),s=null)},y.debounceNextCall=function(w){g=w},y}function Z0(i,t,e,r){var n=i[t];if(n){var o=n[jC]||n,s=n[s8],a=n[o8];if(a!==e||s!==r){if(e==null||!r)return i[t]=o;n=i[t]=m3(o,e,r==="debounce"),n[jC]=o,n[s8]=r,n[o8]=e}return n}}function cS(i,t){var e=i[t];e&&e[jC]&&(e.clear&&e.clear(),i[t]=e[jC])}var l8=Wr(),u8={itemStyle:_v(hJ,!0),lineStyle:_v(cJ,!0)},$bt={lineStyle:"stroke",itemStyle:"fill"};function pQ(i,t){var e=i.visualStyleMapper||u8[t];return e||(console.warn("Unknown style type '"+t+"'."),u8.itemStyle)}function gQ(i,t){var e=i.visualDrawType||$bt[t];return e||(console.warn("Unknown style type '"+t+"'."),"fill")}var Zbt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){var e=i.getData(),r=i.visualStyleAccessPath||"itemStyle",n=i.getModel(r),o=pQ(i,r),s=o(n),a=n.getShallow("decal");a&&(e.setVisual("decal",a),a.dirty=!0);var c=gQ(i,r),f=s[c],g=Xi(f)?f:null,v=s.fill==="auto"||s.stroke==="auto";if(!s[c]||g||v){var y=i.getColorFromPalette(i.name,null,t.getSeriesCount());s[c]||(s[c]=y,e.setVisual("colorFromPalette",!0)),s.fill=s.fill==="auto"||Xi(s.fill)?y:s.fill,s.stroke=s.stroke==="auto"||Xi(s.stroke)?y:s.stroke}if(e.setVisual("style",s),e.setVisual("drawType",c),!t.isSeriesFiltered(i)&&g)return e.setVisual("colorFromPalette",!1),{dataEach:function(w,I){var E=i.getDataParams(I),D=Ne({},s);D[c]=g(E),w.setItemVisual(I,"style",D)}}}},xb=new bn,qbt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){if(!(i.ignoreStyleOnData||t.isSeriesFiltered(i))){var e=i.getData(),r=i.visualStyleAccessPath||"itemStyle",n=pQ(i,r),o=e.getVisual("drawType");return{dataEach:e.hasItemOption?function(s,a){var c=s.getRawDataItem(a);if(c&&c[r]){xb.option=c[r];var f=n(xb),g=s.ensureUniqueItemVisual(a,"style");Ne(g,f),xb.option.decal&&(s.setItemVisual(a,"decal",xb.option.decal),xb.option.decal.dirty=!0),o in f&&s.setItemVisual(a,"colorFromPalette",!1)}}:null}}}},Xbt={performRawSeries:!0,overallReset:function(i){var t=Fi();i.eachSeries(function(e){var r=e.getColorBy();if(!e.isColorBySeries()){var n=e.type+"-"+r,o=t.get(n);o||(o={},t.set(n,o)),l8(e).scope=o}}),i.eachSeries(function(e){if(!(e.isColorBySeries()||i.isSeriesFiltered(e))){var r=e.getRawData(),n={},o=e.getData(),s=l8(e).scope,a=e.visualStyleAccessPath||"itemStyle",c=gQ(e,a);o.each(function(f){var g=o.getRawIndex(f);n[g]=f}),r.each(function(f){var g=n[f],v=o.getItemVisual(g,"colorFromPalette");if(v){var y=o.ensureUniqueItemVisual(g,"style"),w=r.getName(f)||f+"",I=r.count();y[c]=e.getColorFromPalette(w,s,I)}})}})}},RA=Math.PI;function Ybt(i,t){t=t||{},rr(t,{text:"loading",textColor:ye.color.primary,fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255,255,255,0.8)",showSpinner:!0,color:ye.color.theme[0],spinnerRadius:10,lineWidth:5,zlevel:0});var e=new Ki,r=new jr({style:{fill:t.maskColor},zlevel:t.zlevel,z:1e4});e.add(r);var n=new _n({style:{text:t.text,fill:t.textColor,fontSize:t.fontSize,fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:t.fontFamily},zlevel:t.zlevel,z:10001}),o=new jr({style:{fill:"none"},textContent:n,textConfig:{position:"right",distance:10},zlevel:t.zlevel,z:10001});e.add(o);var s;return t.showSpinner&&(s=new WF({shape:{startAngle:-RA/2,endAngle:-RA/2+.1,r:t.spinnerRadius},style:{stroke:t.color,lineCap:"round",lineWidth:t.lineWidth},zlevel:t.zlevel,z:10001}),s.animateShape(!0).when(1e3,{endAngle:RA*3/2}).start("circularInOut"),s.animateShape(!0).when(1e3,{startAngle:RA*3/2}).delay(300).start("circularInOut"),e.add(s)),e.resize=function(){var a=n.getBoundingRect().width,c=t.showSpinner?t.spinnerRadius:0,f=(i.getWidth()-c*2-(t.showSpinner&&a?10:0)-a)/2-(t.showSpinner&&a?0:5+a/2)+(t.showSpinner?0:a/2)+(a?0:c),g=i.getHeight()/2;t.showSpinner&&s.setShape({cx:f,cy:g}),o.setShape({x:f-c,y:g-c,width:c*2,height:c*2}),r.setShape({x:0,y:0,width:i.getWidth(),height:i.getHeight()})},e.resize(),e}var Kbt=function(){function i(t,e,r,n){this._stageTaskMap=Fi(),this.ecInstance=t,this.api=e,r=this._dataProcessorHandlers=r.slice(),n=this._visualHandlers=n.slice(),this._allHandlers=r.concat(n)}return i.prototype.restoreData=function(t,e){t.restoreData(e),this._stageTaskMap.each(function(r){var n=r.overallTask;n&&n.dirty()})},i.prototype.getPerformArgs=function(t,e){if(t.__pipeline){var r=this._pipelineMap.get(t.__pipeline.id),n=r.context,o=!e&&r.progressiveEnabled&&(!n||n.progressiveRender)&&t.__idxInPipeline>r.blockIndex,s=o?r.step:null,a=n&&n.modDataCount,c=a!=null?Math.ceil(a/s):null;return{step:s,modBy:c,modDataCount:a}}},i.prototype.getPipeline=function(t){return this._pipelineMap.get(t)},i.prototype.updateStreamModes=function(t,e){var r=this._pipelineMap.get(t.uid),n=t.getData(),o=n.count(),s=r.progressiveEnabled&&e.incrementalPrepareRender&&o>=r.threshold,a=t.get("large")&&o>=t.get("largeThreshold"),c=t.get("progressiveChunkMode")==="mod"?o:null;t.pipelineContext=r.context={progressiveRender:s,modDataCount:c,large:a}},i.prototype.restorePipelines=function(t){var e=this,r=e._pipelineMap=Fi();t.eachSeries(function(n){var o=n.getProgressive(),s=n.uid;r.set(s,{id:s,head:null,tail:null,threshold:n.getProgressiveThreshold(),progressiveEnabled:o&&!(n.preventIncremental&&n.preventIncremental()),blockIndex:-1,step:Math.round(o||700),count:0}),e._pipe(n,n.dataTask)})},i.prototype.prepareStageTasks=function(){var t=this._stageTaskMap,e=this.api.getModel(),r=this.api;pt(this._allHandlers,function(n){var o=t.get(n.uid)||t.set(n.uid,{}),s="";Vs(!(n.reset&&n.overallReset),s),n.reset&&this._createSeriesStageTask(n,o,e,r),n.overallReset&&this._createOverallStageTask(n,o,e,r)},this)},i.prototype.prepareView=function(t,e,r,n){var o=t.renderTask,s=o.context;s.model=e,s.ecModel=r,s.api=n,o.__block=!t.incrementalPrepareRender,this._pipe(e,o)},i.prototype.performDataProcessorTasks=function(t,e){this._performStageTasks(this._dataProcessorHandlers,t,e,{block:!0})},i.prototype.performVisualTasks=function(t,e,r){this._performStageTasks(this._visualHandlers,t,e,r)},i.prototype._performStageTasks=function(t,e,r,n){n=n||{};var o=!1,s=this;pt(t,function(c,f){if(!(n.visualType&&n.visualType!==c.visualType)){var g=s._stageTaskMap.get(c.uid),v=g.seriesTaskMap,y=g.overallTask;if(y){var w,I=y.agentStubMap;I.each(function(D){a(n,D)&&(D.dirty(),w=!0)}),w&&y.dirty(),s.updatePayload(y,r);var E=s.getPerformArgs(y,n.block);I.each(function(D){D.perform(E)}),y.perform(E)&&(o=!0)}else v&&v.each(function(D,R){a(n,D)&&D.dirty();var z=s.getPerformArgs(D,n.block);z.skip=!c.performRawSeries&&e.isSeriesFiltered(D.context.model),s.updatePayload(D,r),D.perform(z)&&(o=!0)})}});function a(c,f){return c.setDirty&&(!c.dirtyMap||c.dirtyMap.get(f.__pipeline.id))}this.unfinished=o||this.unfinished},i.prototype.performSeriesTasks=function(t){var e;t.eachSeries(function(r){e=r.dataTask.perform()||e}),this.unfinished=e||this.unfinished},i.prototype.plan=function(){this._pipelineMap.each(function(t){var e=t.tail;do{if(e.__block){t.blockIndex=e.__idxInPipeline;break}e=e.getUpstream()}while(e)})},i.prototype.updatePayload=function(t,e){e!=="remain"&&(t.context.payload=e)},i.prototype._createSeriesStageTask=function(t,e,r,n){var o=this,s=e.seriesTaskMap,a=e.seriesTaskMap=Fi(),c=t.seriesType,f=t.getTargetSeries;t.createOnAllSeries?r.eachRawSeries(g):c?r.eachRawSeriesByType(c,g):f&&f(r,n).each(g);function g(v){var y=v.uid,w=a.set(y,s&&s.get(y)||Dw({plan:iwt,reset:rwt,count:awt}));w.context={model:v,ecModel:r,api:n,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:o},o._pipe(v,w)}},i.prototype._createOverallStageTask=function(t,e,r,n){var o=this,s=e.overallTask=e.overallTask||Dw({reset:Jbt});s.context={ecModel:r,api:n,overallReset:t.overallReset,scheduler:o};var a=s.agentStubMap,c=s.agentStubMap=Fi(),f=t.seriesType,g=t.getTargetSeries,v=!0,y=!1,w="";Vs(!t.createOnAllSeries,w),f?r.eachRawSeriesByType(f,I):g?g(r,n).each(I):(v=!1,pt(r.getSeries(),I));function I(E){var D=E.uid,R=c.set(D,a&&a.get(D)||(y=!0,Dw({reset:Qbt,onDirty:ewt})));R.context={model:E,overallProgress:v},R.agent=s,R.__block=v,o._pipe(E,R)}y&&s.dirty()},i.prototype._pipe=function(t,e){var r=t.uid,n=this._pipelineMap.get(r);!n.head&&(n.head=e),n.tail&&n.tail.pipe(e),n.tail=e,e.__idxInPipeline=n.count++,e.__pipeline=n},i.wrapStageHandler=function(t,e){return Xi(t)&&(t={overallReset:t,seriesType:owt(t)}),t.uid=j0("stageHandler"),e&&(t.visualType=e),t},i}();function Jbt(i){i.overallReset(i.ecModel,i.api,i.payload)}function Qbt(i){return i.overallProgress&&twt}function twt(){this.agent.dirty(),this.getDownstream().dirty()}function ewt(){this.agent&&this.agent.dirty()}function iwt(i){return i.plan?i.plan(i.model,i.ecModel,i.api,i.payload):null}function rwt(i){i.useClearVisual&&i.data.clearAllVisual();var t=i.resetDefines=aa(i.reset(i.model,i.ecModel,i.api,i.payload));return t.length>1?ti(t,function(e,r){return mQ(r)}):nwt}var nwt=mQ(0);function mQ(i){return function(t,e){var r=e.data,n=e.resetDefines[i];if(n&&n.dataEach)for(var o=t.start;o<t.end;o++)n.dataEach(r,o);else n&&n.progress&&n.progress(t,r)}}function awt(i){return i.data.count()}function owt(i){WC=null;try{i(hS,vQ)}catch{}return WC}var hS={},vQ={},WC;_Q(hS,GJ);_Q(vQ,HJ);hS.eachSeriesByType=hS.eachRawSeriesByType=function(i){WC=i};hS.eachComponent=function(i){i.mainType==="series"&&i.subType&&(WC=i.subType)};function _Q(i,t){for(var e in t.prototype)i[e]=ho}const yQ=Kbt;var tr=ye.darkColor,swt=tr.background,bb=function(){return{axisLine:{lineStyle:{color:tr.axisLine}},splitLine:{lineStyle:{color:tr.axisSplitLine}},splitArea:{areaStyle:{color:[tr.backgroundTint,tr.backgroundTransparent]}},minorSplitLine:{lineStyle:{color:tr.axisMinorSplitLine}},axisLabel:{color:tr.axisLabel},axisName:{}}},c8={label:{color:tr.secondary},itemStyle:{borderColor:tr.borderTint},dividerLineStyle:{color:tr.border}},xQ={darkMode:!0,color:tr.theme,backgroundColor:swt,axisPointer:{lineStyle:{color:tr.border},crossStyle:{color:tr.borderShade},label:{color:tr.tertiary}},legend:{textStyle:{color:tr.secondary},pageTextStyle:{color:tr.tertiary}},textStyle:{color:tr.secondary},title:{textStyle:{color:tr.primary},subtextStyle:{color:tr.quaternary}},toolbox:{iconStyle:{borderColor:tr.accent50}},tooltip:{backgroundColor:tr.neutral20,defaultBorderColor:tr.border,textStyle:{color:tr.tertiary}},dataZoom:{borderColor:tr.accent10,textStyle:{color:tr.tertiary},brushStyle:{color:tr.backgroundTint},handleStyle:{color:tr.neutral00,borderColor:tr.accent20},moveHandleStyle:{color:tr.accent40},emphasis:{handleStyle:{borderColor:tr.accent50}},dataBackground:{lineStyle:{color:tr.accent30},areaStyle:{color:tr.accent20}},selectedDataBackground:{lineStyle:{color:tr.accent50},areaStyle:{color:tr.accent30}}},visualMap:{textStyle:{color:tr.secondary},handleStyle:{borderColor:tr.neutral30}},timeline:{lineStyle:{color:tr.accent10},label:{color:tr.tertiary},controlStyle:{color:tr.accent30,borderColor:tr.accent30}},calendar:{itemStyle:{color:tr.neutral00,borderColor:tr.neutral20},dayLabel:{color:tr.tertiary},monthLabel:{color:tr.secondary},yearLabel:{color:tr.secondary}},matrix:{x:c8,y:c8,backgroundColor:{borderColor:tr.axisLine},body:{itemStyle:{borderColor:tr.borderTint}}},timeAxis:bb(),logAxis:bb(),valueAxis:bb(),categoryAxis:bb(),line:{symbol:"circle"},graph:{color:tr.theme},gauge:{title:{color:tr.secondary},axisLine:{lineStyle:{color:[[1,tr.neutral05]]}},axisLabel:{color:tr.axisLabel},detail:{color:tr.primary}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}},funnel:{itemStyle:{borderColor:tr.background}},radar:function(){var i=bb();return i.axisName={color:tr.axisLabel},i.axisLine.lineStyle.color=tr.neutral20,i}(),treemap:{breadcrumb:{itemStyle:{color:tr.neutral20,textStyle:{color:tr.secondary}},emphasis:{itemStyle:{color:tr.neutral30}}}},sunburst:{itemStyle:{borderColor:tr.background}},map:{itemStyle:{borderColor:tr.border,areaColor:tr.neutral10},label:{color:tr.tertiary},emphasis:{label:{color:tr.primary},itemStyle:{areaColor:tr.highlight}},select:{label:{color:tr.primary},itemStyle:{areaColor:tr.highlight}}},geo:{itemStyle:{borderColor:tr.border,areaColor:tr.neutral10},emphasis:{label:{color:tr.primary},itemStyle:{areaColor:tr.highlight}},select:{label:{color:tr.primary},itemStyle:{color:tr.highlight}}}};xQ.categoryAxis.splitLine.show=!1;const lwt=xQ;var uwt=function(){function i(){}return i.prototype.normalizeQuery=function(t){var e={},r={},n={};if(wi(t)){var o=uh(t);e.mainType=o.main||null,e.subType=o.sub||null}else{var s=["Index","Name","Id"],a={name:1,dataIndex:1,dataType:1};pt(t,function(c,f){for(var g=!1,v=0;v<s.length;v++){var y=s[v],w=f.lastIndexOf(y);if(w>0&&w===f.length-y.length){var I=f.slice(0,w);I!=="data"&&(e.mainType=I,e[y.toLowerCase()]=c,g=!0)}}a.hasOwnProperty(f)&&(r[f]=c,g=!0),g||(n[f]=c)})}return{cptQuery:e,dataQuery:r,otherQuery:n}},i.prototype.filter=function(t,e){var r=this.eventInfo;if(!r)return!0;var n=r.targetEl,o=r.packedEvent,s=r.model,a=r.view;if(!s||!a)return!0;var c=e.cptQuery,f=e.dataQuery;return g(c,s,"mainType")&&g(c,s,"subType")&&g(c,s,"index","componentIndex")&&g(c,s,"name")&&g(c,s,"id")&&g(f,o,"name")&&g(f,o,"dataIndex")&&g(f,o,"dataType")&&(!a.filterForExposedEvent||a.filterForExposedEvent(t,e.otherQuery,n,o));function g(v,y,w,I){return v[w]==null||y[I||w]===v[w]}},i.prototype.afterTrigger=function(){this.eventInfo=null},i}(),Sz=["symbol","symbolSize","symbolRotate","symbolOffset"],h8=Sz.concat(["symbolKeepAspect"]),cwt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){var e=i.getData();if(i.legendIcon&&e.setVisual("legendIcon",i.legendIcon),!i.hasSymbolVisual)return;for(var r={},n={},o=!1,s=0;s<Sz.length;s++){var a=Sz[s],c=i.get(a);Xi(c)?(o=!0,n[a]=c):r[a]=c}if(r.symbol=r.symbol||i.defaultSymbol,e.setVisual(Ne({legendIcon:i.legendIcon||r.symbol,symbolKeepAspect:i.get("symbolKeepAspect")},r)),t.isSeriesFiltered(i))return;var f=on(n);function g(v,y){for(var w=i.getRawValue(y),I=i.getDataParams(y),E=0;E<f.length;E++){var D=f[E];v.setItemVisual(y,D,n[D](w,I))}}return{dataEach:o?g:null}}},hwt={createOnAllSeries:!0,performRawSeries:!0,reset:function(i,t){if(!i.hasSymbolVisual||t.isSeriesFiltered(i))return;var e=i.getData();function r(n,o){for(var s=n.getItemModel(o),a=0;a<h8.length;a++){var c=h8[a],f=s.getShallow(c,!0);f!=null&&n.setItemVisual(o,c,f)}}return{dataEach:e.hasItemOption?r:null}}};function v3(i,t,e){switch(e){case"color":var r=i.getItemVisual(t,"style");return r[i.getVisual("drawType")];case"opacity":return i.getItemVisual(t,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return i.getItemVisual(t,e)}}function WS(i,t){switch(t){case"color":var e=i.getVisual("style");return e[i.getVisual("drawType")];case"opacity":return i.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return i.getVisual(t)}}function bQ(i,t,e,r){switch(e){case"color":var n=i.ensureUniqueItemVisual(t,"style");n[i.getVisual("drawType")]=r,i.setItemVisual(t,"colorFromPalette",!1);break;case"opacity":i.ensureUniqueItemVisual(t,"style").opacity=r;break;case"symbol":case"symbolSize":case"liftZ":i.setItemVisual(t,e,r);break}}function wQ(i,t){function e(r,n){var o=[];return r.eachComponent({mainType:"series",subType:i,query:n},function(s){o.push(s.seriesIndex)}),o}pt([[i+"ToggleSelect","toggleSelect"],[i+"Select","select"],[i+"UnSelect","unselect"]],function(r){t(r[0],function(n,o,s){n=Ne({},n),s.dispatchAction(Ne(n,{type:r[1],seriesIndex:e(o,n)}))})})}function Cy(i,t,e,r,n){var o=i+t;e.isSilent(o)||r.eachComponent({mainType:"series",subType:"pie"},function(s){for(var a=s.seriesIndex,c=s.option.selectedMap,f=n.selected,g=0;g<f.length;g++)if(f[g].seriesIndex===a){var v=s.getData(),y=vv(v,n.fromActionPayload);e.trigger(o,{type:o,seriesId:s.id,name:Ye(y)?v.getName(y[0]):v.getName(y),selected:wi(c)?c:Ne({},c)})}})}function dwt(i,t,e){i.on("selectchanged",function(r){var n=e.getModel();r.isFromClick?(Cy("map","selectchanged",t,n,r),Cy("pie","selectchanged",t,n,r)):r.fromAction==="select"?(Cy("map","selected",t,n,r),Cy("pie","selected",t,n,r)):r.fromAction==="unselect"&&(Cy("map","unselected",t,n,r),Cy("pie","unselected",t,n,r))})}function Xm(i,t,e){for(var r;i&&!(t(i)&&(r=i,e));)i=i.__hostTarget||i.parent;return r}var fwt=Math.round(Math.random()*9),pwt=typeof Object.defineProperty=="function",gwt=function(){function i(){this._id="__ec_inner_"+fwt++}return i.prototype.get=function(t){return this._guard(t)[this._id]},i.prototype.set=function(t,e){var r=this._guard(t);return pwt?Object.defineProperty(r,this._id,{value:e,enumerable:!1,configurable:!0}):r[this._id]=e,this},i.prototype.delete=function(t){return this.has(t)?(delete this._guard(t)[this._id],!0):!1},i.prototype.has=function(t){return!!this._guard(t)[this._id]},i.prototype._guard=function(t){if(t!==Object(t))throw TypeError("Value of WeakMap is not a non-null object.");return t},i}();const mwt=gwt;var vwt=qr.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(i,t){var e=t.cx,r=t.cy,n=t.width/2,o=t.height/2;i.moveTo(e,r-o),i.lineTo(e+n,r+o),i.lineTo(e-n,r+o),i.closePath()}}),_wt=qr.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(i,t){var e=t.cx,r=t.cy,n=t.width/2,o=t.height/2;i.moveTo(e,r-o),i.lineTo(e+n,r),i.lineTo(e,r+o),i.lineTo(e-n,r),i.closePath()}}),ywt=qr.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(i,t){var e=t.x,r=t.y,n=t.width/5*3,o=Math.max(n,t.height),s=n/2,a=s*s/(o-s),c=r-o+s+a,f=Math.asin(a/s),g=Math.cos(f)*s,v=Math.sin(f),y=Math.cos(f),w=s*.6,I=s*.7;i.moveTo(e-g,c+a),i.arc(e,c,s,Math.PI-f,Math.PI*2+f),i.bezierCurveTo(e+g-v*w,c+a+y*w,e,r-I,e,r),i.bezierCurveTo(e,r-I,e-g+v*w,c+a+y*w,e-g,c+a),i.closePath()}}),xwt=qr.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(i,t){var e=t.height,r=t.width,n=t.x,o=t.y,s=r/3*2;i.moveTo(n,o),i.lineTo(n+s,o+e),i.lineTo(n,o+e/4*3),i.lineTo(n-s,o+e),i.lineTo(n,o),i.closePath()}}),bwt={line:Oo,rect:jr,roundRect:jr,square:jr,circle:Wp,diamond:_wt,pin:ywt,arrow:xwt,triangle:vwt},wwt={line:function(i,t,e,r,n){n.x1=i,n.y1=t+r/2,n.x2=i+e,n.y2=t+r/2},rect:function(i,t,e,r,n){n.x=i,n.y=t,n.width=e,n.height=r},roundRect:function(i,t,e,r,n){n.x=i,n.y=t,n.width=e,n.height=r,n.r=Math.min(e,r)/4},square:function(i,t,e,r,n){var o=Math.min(e,r);n.x=i,n.y=t,n.width=o,n.height=o},circle:function(i,t,e,r,n){n.cx=i+e/2,n.cy=t+r/2,n.r=Math.min(e,r)/2},diamond:function(i,t,e,r,n){n.cx=i+e/2,n.cy=t+r/2,n.width=e,n.height=r},pin:function(i,t,e,r,n){n.x=i+e/2,n.y=t+r/2,n.width=e,n.height=r},arrow:function(i,t,e,r,n){n.x=i+e/2,n.y=t+r/2,n.width=e,n.height=r},triangle:function(i,t,e,r,n){n.cx=i+e/2,n.cy=t+r/2,n.width=e,n.height=r}},$C={};pt(bwt,function(i,t){$C[t]=new i});var Swt=qr.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(i,t,e){var r=kC(i,t,e),n=this.shape;return n&&n.symbolType==="pin"&&t.position==="inside"&&(r.y=e.y+e.height*.4),r},buildPath:function(i,t,e){var r=t.symbolType;if(r!=="none"){var n=$C[r];n||(r="rect",n=$C[r]),wwt[r](t.x,t.y,t.width,t.height,n.shape),n.buildPath(i,n.shape,e)}}});function Twt(i,t){if(this.type!=="image"){var e=this.style;this.__isEmptyBrush?(e.stroke=i,e.fill=t||ye.color.neutral00,e.lineWidth=2):this.shape.symbolType==="line"?e.stroke=i:e.fill=i,this.markRedraw()}}function To(i,t,e,r,n,o,s){var a=i.indexOf("empty")===0;a&&(i=i.substr(5,1).toLowerCase()+i.substr(6));var c;return i.indexOf("image://")===0?c=tJ(i.slice(8),new sr(t,e,r,n),s?"center":"cover"):i.indexOf("path://")===0?c=oS(i.slice(7),{},new sr(t,e,r,n),s?"center":"cover"):c=new Swt({shape:{symbolType:i,x:t,y:e,width:r,height:n}}),c.__isEmptyBrush=a,c.setColor=Twt,o&&c.setColor(o),c}function q0(i){return Ye(i)||(i=[+i,+i]),[i[0]||0,i[1]||0]}function Rv(i,t){if(i!=null)return Ye(i)||(i=[i,i]),[xi(i[0],t[0])||0,xi(Ui(i[1],i[0]),t[1])||0]}function Ym(i){return isFinite(i)}function Awt(i,t,e){var r=t.x==null?0:t.x,n=t.x2==null?1:t.x2,o=t.y==null?0:t.y,s=t.y2==null?0:t.y2;t.global||(r=r*e.width+e.x,n=n*e.width+e.x,o=o*e.height+e.y,s=s*e.height+e.y),r=Ym(r)?r:0,n=Ym(n)?n:1,o=Ym(o)?o:0,s=Ym(s)?s:0;var a=i.createLinearGradient(r,o,n,s);return a}function Iwt(i,t,e){var r=e.width,n=e.height,o=Math.min(r,n),s=t.x==null?.5:t.x,a=t.y==null?.5:t.y,c=t.r==null?.5:t.r;t.global||(s=s*r+e.x,a=a*n+e.y,c=c*o),s=Ym(s)?s:.5,a=Ym(a)?a:.5,c=c>=0&&Ym(c)?c:.5;var f=i.createRadialGradient(s,a,0,s,a,c);return f}function Tz(i,t,e){for(var r=t.type==="radial"?Iwt(i,t,e):Awt(i,t,e),n=t.colorStops,o=0;o<n.length;o++)r.addColorStop(n[o].offset,n[o].color);return r}function Cwt(i,t){if(i===t||!i&&!t)return!1;if(!i||!t||i.length!==t.length)return!0;for(var e=0;e<i.length;e++)if(i[e]!==t[e])return!0;return!1}function kA(i){return parseInt(i,10)}function t0(i,t,e){var r=["width","height"][t],n=["clientWidth","clientHeight"][t],o=["paddingLeft","paddingTop"][t],s=["paddingRight","paddingBottom"][t];if(e[r]!=null&&e[r]!=="auto")return parseFloat(e[r]);var a=document.defaultView.getComputedStyle(i);return(i[n]||kA(a[r])||kA(i.style[r]))-(kA(a[o])||0)-(kA(a[s])||0)|0}function Mwt(i,t){return!i||i==="solid"||!(t>0)?null:i==="dashed"?[4*t,2*t]:i==="dotted"?[t]:fn(i)?[i]:Ye(i)?i:null}function _3(i){var t=i.style,e=t.lineDash&&t.lineWidth>0&&Mwt(t.lineDash,t.lineWidth),r=t.lineDashOffset;if(e){var n=t.strokeNoScale&&i.getLineScale?i.getLineScale():1;n&&n!==1&&(e=ti(e,function(o){return o/n}),r/=n)}return[e,r]}var Ewt=new Sh(!0);function ZC(i){var t=i.stroke;return!(t==null||t==="none"||!(i.lineWidth>0))}function d8(i){return typeof i=="string"&&i!=="none"}function qC(i){var t=i.fill;return t!=null&&t!=="none"}function f8(i,t){if(t.fillOpacity!=null&&t.fillOpacity!==1){var e=i.globalAlpha;i.globalAlpha=t.fillOpacity*t.opacity,i.fill(),i.globalAlpha=e}else i.fill()}function p8(i,t){if(t.strokeOpacity!=null&&t.strokeOpacity!==1){var e=i.globalAlpha;i.globalAlpha=t.strokeOpacity*t.opacity,i.stroke(),i.globalAlpha=e}else i.stroke()}function Az(i,t,e){var r=OF(t.image,t.__image,e);if(aE(r)){var n=i.createPattern(r,t.repeat||"repeat");if(typeof DOMMatrix=="function"&&n&&n.setTransform){var o=new DOMMatrix;o.translateSelf(t.x||0,t.y||0),o.rotateSelf(0,0,(t.rotation||0)*VI),o.scaleSelf(t.scaleX||1,t.scaleY||1),n.setTransform(o)}return n}}function Dwt(i,t,e,r){var n,o=ZC(e),s=qC(e),a=e.strokePercent,c=a<1,f=!t.path;(!t.silent||c)&&f&&t.createPathProxy();var g=t.path||Ewt,v=t.__dirty;if(!r){var y=e.fill,w=e.stroke,I=s&&!!y.colorStops,E=o&&!!w.colorStops,D=s&&!!y.image,R=o&&!!w.image,z=void 0,N=void 0,H=void 0,q=void 0,Y=void 0;(I||E)&&(Y=t.getBoundingRect()),I&&(z=v?Tz(i,y,Y):t.__canvasFillGradient,t.__canvasFillGradient=z),E&&(N=v?Tz(i,w,Y):t.__canvasStrokeGradient,t.__canvasStrokeGradient=N),D&&(H=v||!t.__canvasFillPattern?Az(i,y,t):t.__canvasFillPattern,t.__canvasFillPattern=H),R&&(q=v||!t.__canvasStrokePattern?Az(i,w,t):t.__canvasStrokePattern,t.__canvasStrokePattern=q),I?i.fillStyle=z:D&&(H?i.fillStyle=H:s=!1),E?i.strokeStyle=N:R&&(q?i.strokeStyle=q:o=!1)}var J=t.getGlobalScale();g.setScale(J[0],J[1],t.segmentIgnoreThreshold);var it,at;i.setLineDash&&e.lineDash&&(n=_3(t),it=n[0],at=n[1]);var ut=!0;(f||v&Wy)&&(g.setDPR(i.dpr),c?g.setContext(null):(g.setContext(i),ut=!1),g.reset(),t.buildPath(g,t.shape,r),g.toStatic(),t.pathUpdated()),ut&&g.rebuildPath(i,c?a:1),it&&(i.setLineDash(it),i.lineDashOffset=at),r||(e.strokeFirst?(o&&p8(i,e),s&&f8(i,e)):(s&&f8(i,e),o&&p8(i,e))),it&&i.setLineDash([])}function Pwt(i,t,e){var r=t.__image=OF(e.image,t.__image,t,t.onload);if(!(!r||!aE(r))){var n=e.x||0,o=e.y||0,s=t.getWidth(),a=t.getHeight(),c=r.width/r.height;if(s==null&&a!=null?s=a*c:a==null&&s!=null?a=s/c:s==null&&a==null&&(s=r.width,a=r.height),e.sWidth&&e.sHeight){var f=e.sx||0,g=e.sy||0;i.drawImage(r,f,g,e.sWidth,e.sHeight,n,o,s,a)}else if(e.sx&&e.sy){var f=e.sx,g=e.sy,v=s-f,y=a-g;i.drawImage(r,f,g,v,y,n,o,s,a)}else i.drawImage(r,n,o,s,a)}}function Lwt(i,t,e){var r,n=e.text;if(n!=null&&(n+=""),n){i.font=e.font||Ld,i.textAlign=e.textAlign,i.textBaseline=e.textBaseline;var o=void 0,s=void 0;i.setLineDash&&e.lineDash&&(r=_3(t),o=r[0],s=r[1]),o&&(i.setLineDash(o),i.lineDashOffset=s),e.strokeFirst?(ZC(e)&&i.strokeText(n,e.x,e.y),qC(e)&&i.fillText(n,e.x,e.y)):(qC(e)&&i.fillText(n,e.x,e.y),ZC(e)&&i.strokeText(n,e.x,e.y)),o&&i.setLineDash([])}}var g8=["shadowBlur","shadowOffsetX","shadowOffsetY"],m8=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function SQ(i,t,e,r,n){var o=!1;if(!r&&(e=e||{},t===e))return!1;if(r||t.opacity!==e.opacity){kl(i,n),o=!0;var s=Math.max(Math.min(t.opacity,1),0);i.globalAlpha=isNaN(s)?ov.opacity:s}(r||t.blend!==e.blend)&&(o||(kl(i,n),o=!0),i.globalCompositeOperation=t.blend||ov.blend);for(var a=0;a<g8.length;a++){var c=g8[a];(r||t[c]!==e[c])&&(o||(kl(i,n),o=!0),i[c]=i.dpr*(t[c]||0))}return(r||t.shadowColor!==e.shadowColor)&&(o||(kl(i,n),o=!0),i.shadowColor=t.shadowColor||ov.shadowColor),o}function v8(i,t,e,r,n){var o=dS(t,n.inHover),s=r?null:e&&dS(e,n.inHover)||{};if(o===s)return!1;var a=SQ(i,o,s,r,n);if((r||o.fill!==s.fill)&&(a||(kl(i,n),a=!0),d8(o.fill)&&(i.fillStyle=o.fill)),(r||o.stroke!==s.stroke)&&(a||(kl(i,n),a=!0),d8(o.stroke)&&(i.strokeStyle=o.stroke)),(r||o.opacity!==s.opacity)&&(a||(kl(i,n),a=!0),i.globalAlpha=o.opacity==null?1:o.opacity),t.hasStroke()){var c=o.lineWidth,f=c/(o.strokeNoScale&&t.getLineScale?t.getLineScale():1);i.lineWidth!==f&&(a||(kl(i,n),a=!0),i.lineWidth=f)}for(var g=0;g<m8.length;g++){var v=m8[g],y=v[0];(r||o[y]!==s[y])&&(a||(kl(i,n),a=!0),i[y]=o[y]||v[1])}return a}function Rwt(i,t,e,r,n){return SQ(i,dS(t,n.inHover),e&&dS(e,n.inHover),r,n)}function TQ(i,t){var e=t.transform,r=i.dpr||1;e?i.setTransform(r*e[0],r*e[1],r*e[2],r*e[3],r*e[4],r*e[5]):i.setTransform(r,0,0,r,0,0)}function kwt(i,t,e){for(var r=!1,n=0;n<i.length;n++){var o=i[n];r=r||o.isZeroArea(),TQ(t,o),t.beginPath(),o.buildPath(t,o.shape),t.clip()}e.allClipped=r}function Owt(i,t){return i&&t?i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]||i[3]!==t[3]||i[4]!==t[4]||i[5]!==t[5]:!(!i&&!t)}var _8=1,y8=2,x8=3,b8=4;function zwt(i){var t=qC(i),e=ZC(i);return!(i.lineDash||!(+t^+e)||t&&typeof i.fill!="string"||e&&typeof i.stroke!="string"||i.strokePercent<1||i.strokeOpacity<1||i.fillOpacity<1)}function kl(i,t){t.batchFill&&i.fill(),t.batchStroke&&i.stroke(),t.batchFill="",t.batchStroke=""}function dS(i,t){return t&&i.__hoverStyle||i.style}function AQ(i,t){Km(i,t,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function Km(i,t,e,r){var n=t.transform;if(!t.shouldBePainted(e.viewWidth,e.viewHeight,!1,!1)){t.__dirty&=~Kl,t.__isRendered=!1;return}var o=t.__clipPaths,s=e.prevElClipPaths,a=!1,c=!1;if((!s||Cwt(o,s))&&(s&&s.length&&(kl(i,e),i.restore(),c=a=!0,e.prevElClipPaths=null,e.allClipped=!1,e.prevEl=null),o&&o.length&&(kl(i,e),i.save(),kwt(o,i,e),a=!0),e.prevElClipPaths=o),e.allClipped){t.__isRendered=!1;return}t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush();var f=e.prevEl;f||(c=a=!0);var g=t instanceof qr&&t.autoBatch&&zwt(t.style);a||Owt(n,f.transform)?(kl(i,e),TQ(i,t)):g||kl(i,e);var v=dS(t,e.inHover);t instanceof qr?(e.lastDrawType!==_8&&(c=!0,e.lastDrawType=_8),v8(i,t,f,c,e),(!g||!e.batchFill&&!e.batchStroke)&&i.beginPath(),Dwt(i,t,v,g),g&&(e.batchFill=v.fill||"",e.batchStroke=v.stroke||"")):t instanceof rS?(e.lastDrawType!==x8&&(c=!0,e.lastDrawType=x8),v8(i,t,f,c,e),Lwt(i,t,v)):t instanceof ys?(e.lastDrawType!==y8&&(c=!0,e.lastDrawType=y8),Rwt(i,t,f,c,e),Pwt(i,t,v)):t.getTemporalDisplayables&&(e.lastDrawType!==b8&&(c=!0,e.lastDrawType=b8),Bwt(i,t,e)),g&&r&&kl(i,e),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),e.prevEl=t,t.__dirty=0,t.__isRendered=!0}function Bwt(i,t,e){var r=t.getDisplayables(),n=t.getTemporalDisplayables();i.save();var o={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:e.viewWidth,viewHeight:e.viewHeight,inHover:e.inHover},s,a;for(s=t.getCursor(),a=r.length;s<a;s++){var c=r[s];c.beforeBrush&&c.beforeBrush(),c.innerBeforeBrush(),Km(i,c,o,s===a-1),c.innerAfterBrush(),c.afterBrush&&c.afterBrush(),o.prevEl=c}for(var f=0,g=n.length;f<g;f++){var c=n[f];c.beforeBrush&&c.beforeBrush(),c.innerBeforeBrush(),Km(i,c,o,f===g-1),c.innerAfterBrush(),c.afterBrush&&c.afterBrush(),o.prevEl=c}t.clearTemporalDisplayables(),t.notClear=!0,i.restore()}var cR=new mwt,w8=new b0(100),S8=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function A0(i,t){if(i==="none")return null;var e=t.getDevicePixelRatio(),r=t.getZr(),n=r.painter.type==="svg";i.dirty&&cR.delete(i);var o=cR.get(i);if(o)return o;var s=rr(i,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});s.backgroundColor==="none"&&(s.backgroundColor=null);var a={repeat:"repeat"};return c(a),a.rotation=s.rotation,a.scaleX=a.scaleY=n?1:1/e,cR.set(i,a),i.dirty=!1,a;function c(f){for(var g=[e],v=!0,y=0;y<S8.length;++y){var w=s[S8[y]];if(w!=null&&!Ye(w)&&!wi(w)&&!fn(w)&&typeof w!="boolean"){v=!1;break}g.push(w)}var I;if(v){I=g.join(",")+(n?"-svg":"");var E=w8.get(I);E&&(n?f.svgElement=E:f.image=E)}var D=CQ(s.dashArrayX),R=Fwt(s.dashArrayY),z=IQ(s.symbol),N=Nwt(D),H=MQ(R),q=!n&&vc.createCanvas(),Y=n&&{tag:"g",attrs:{},key:"dcl",children:[]},J=at(),it;q&&(q.width=J.width*e,q.height=J.height*e,it=q.getContext("2d")),ut(),v&&w8.put(I,q||Y),f.image=q,f.svgElement=Y,f.svgWidth=J.width,f.svgHeight=J.height;function at(){for(var ft=1,_t=0,ct=N.length;_t<ct;++_t)ft=FH(ft,N[_t]);for(var Dt=1,_t=0,ct=z.length;_t<ct;++_t)Dt=FH(Dt,z[_t].length);ft*=Dt;var Et=H*N.length*z.length;return{width:Math.max(1,Math.min(ft,s.maxTileWidth)),height:Math.max(1,Math.min(Et,s.maxTileHeight))}}function ut(){it&&(it.clearRect(0,0,q.width,q.height),s.backgroundColor&&(it.fillStyle=s.backgroundColor,it.fillRect(0,0,q.width,q.height)));for(var ft=0,_t=0;_t<R.length;++_t)ft+=R[_t];if(ft<=0)return;for(var ct=-H,Dt=0,Et=0,bt=0;ct<J.height;){if(Dt%2===0){for(var Vt=Et/2%z.length,zt=0,Jt=0,ce=0;zt<J.width*2;){for(var be=0,_t=0;_t<D[bt].length;++_t)be+=D[bt][_t];if(be<=0)break;if(Jt%2===0){var ve=(1-s.symbolSize)*.5,ke=zt+D[bt][Jt]*ve,ni=ct+R[Dt]*ve,bi=D[bt][Jt]*s.symbolSize,or=R[Dt]*s.symbolSize,Ue=ce/2%z[Vt].length;Ze(ke,ni,bi,or,z[Vt][Ue])}zt+=D[bt][Jt],++ce,++Jt,Jt===D[bt].length&&(Jt=0)}++bt,bt===D.length&&(bt=0)}ct+=R[Dt],++Et,++Dt,Dt===R.length&&(Dt=0)}function Ze(xe,Ke,We,Ti,Bt){var Zt=n?1:e,ge=To(Bt,xe*Zt,Ke*Zt,We*Zt,Ti*Zt,s.color,s.symbolKeepAspect);if(n){var $e=r.painter.renderOneToVNode(ge);$e&&Y.children.push($e)}else AQ(it,ge)}}}}function IQ(i){if(!i||i.length===0)return[["rect"]];if(wi(i))return[[i]];for(var t=!0,e=0;e<i.length;++e)if(!wi(i[e])){t=!1;break}if(t)return IQ([i]);for(var r=[],e=0;e<i.length;++e)wi(i[e])?r.push([i[e]]):r.push(i[e]);return r}function CQ(i){if(!i||i.length===0)return[[0,0]];if(fn(i)){var t=Math.ceil(i);return[[t,t]]}for(var e=!0,r=0;r<i.length;++r)if(!fn(i[r])){e=!1;break}if(e)return CQ([i]);for(var n=[],r=0;r<i.length;++r)if(fn(i[r])){var t=Math.ceil(i[r]);n.push([t,t])}else{var t=ti(i[r],function(a){return Math.ceil(a)});t.length%2===1?n.push(t.concat(t)):n.push(t)}return n}function Fwt(i){if(!i||typeof i=="object"&&i.length===0)return[0,0];if(fn(i)){var t=Math.ceil(i);return[t,t]}var e=ti(i,function(r){return Math.ceil(r)});return i.length%2?e.concat(e):e}function Nwt(i){return ti(i,function(t){return MQ(t)})}function MQ(i){for(var t=0,e=0;e<i.length;++e)t+=i[e];return i.length%2===1?t*2:t}function Vwt(i,t){i.eachRawSeries(function(e){if(!i.isSeriesFiltered(e)){var r=e.getData();r.hasItemVisual()&&r.each(function(s){var a=r.getItemVisual(s,"decal");if(a){var c=r.ensureUniqueItemVisual(s,"style");c.decal=A0(a,t)}});var n=r.getVisual("decal");if(n){var o=r.getVisual("style");o.decal=A0(n,t)}}})}var Uwt=new Bu;const oc=Uwt;var EQ={};function Gwt(i,t){EQ[i]=t}function Hwt(i){return EQ[i]}var DQ={};function jwt(i,t){DQ[i]=t}function Wwt(i){return DQ[i]}var $wt=1,Zwt=800,qwt=900,Xwt=1e3,Ywt=2e3,Kwt=5e3,PQ=1e3,Jwt=1100,y3=2e3,LQ=3e3,Qwt=4e3,TE=4500,tSt=4600,eSt=5e3,iSt=6e3,RQ=7e3,rSt={PROCESSOR:{FILTER:Xwt,SERIES_FILTER:Zwt,STATISTIC:Kwt},VISUAL:{LAYOUT:PQ,PROGRESSIVE_LAYOUT:Jwt,GLOBAL:y3,CHART:LQ,POST_CHART_LAYOUT:tSt,COMPONENT:Qwt,BRUSH:eSt,CHART_ITEM:TE,ARIA:iSt,DECAL:RQ}},Ro="__flagInMainProcess",OA="__mainProcessVersion",es="__pendingUpdate",hR="__needsUpdateStatus",T8=/^[a-zA-Z0-9_]+$/,dR="__connectUpdateStatus",A8=0,nSt=1,aSt=2;function kQ(i){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.isDisposed()){this.id;return}return zQ(this,i,t)}}function OQ(i){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return zQ(this,i,t)}}function zQ(i,t,e){return e[0]=e[0]&&e[0].toLowerCase(),Bu.prototype[t].apply(i,e)}var BQ=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Bu),FQ=BQ.prototype;FQ.on=OQ("on");FQ.off=OQ("off");var Sm,fR,zA,rd,BA,pR,gR,My,Ey,I8,C8,mR,M8,FA,E8,NQ,vu,D8,Dy,VQ=function(i){Se(t,i);function t(e,r,n){var o=i.call(this,new uwt)||this;o._chartsViews=[],o._chartsMap={},o._componentsViews=[],o._componentsMap={},o._pendingActions=[],n=n||{},o._dom=e;var s="canvas",a="auto",c=!1;o[OA]=1,n.ssr&&byt(function(y){var w=cr(y),I=w.dataIndex;if(I!=null){var E=Fi();return E.set("series_index",w.seriesIndex),E.set("data_index",I),w.ssrType&&E.set("ssr_type",w.ssrType),E}});var f=o._zr=kH(e,{renderer:n.renderer||s,devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height,ssr:n.ssr,useDirtyRect:Ui(n.useDirtyRect,c),useCoarsePointer:Ui(n.useCoarsePointer,a),pointerSize:n.pointerSize});o._ssr=n.ssr,o._throttledZrFlush=m3(Si(f.flush,f),17),o._updateTheme(r),o._locale=o1t(n.locale||dJ),o._coordSysMgr=new HS;var g=o._api=E8(o);function v(y,w){return y.__prio-w.__prio}return HI(YC,v),HI(Mz,v),o._scheduler=new yQ(o,g,Mz,YC),o._messageCenter=new BQ,o._initEvents(),o.resize=Si(o.resize,o),f.animation.on("frame",o._onframe,o),I8(f,o),C8(f,o),AC(o),o}return t.prototype._onframe=function(){if(!this._disposed){D8(this);var e=this._scheduler;if(this[es]){var r=this[es].silent;this[Ro]=!0,Dy(this);try{Sm(this),rd.update.call(this,null,this[es].updateParams)}catch(c){throw this[Ro]=!1,this[es]=null,c}this._zr.flush(),this[Ro]=!1,this[es]=null,My.call(this,r),Ey.call(this,r)}else if(e.unfinished){var n=$wt,o=this._model,s=this._api;e.unfinished=!1;do{var a=+new Date;e.performSeriesTasks(o),e.performDataProcessorTasks(o),pR(this,o),e.performVisualTasks(o),FA(this,this._model,s,"remain",{}),n-=+new Date-a}while(n>0&&e.unfinished);e.unfinished||this._zr.flush()}}},t.prototype.getDom=function(){return this._dom},t.prototype.getId=function(){return this.id},t.prototype.getZr=function(){return this._zr},t.prototype.isSSR=function(){return this._ssr},t.prototype.setOption=function(e,r,n){if(!this[Ro]){if(this._disposed){this.id;return}var o,s,a;if(nr(r)&&(n=r.lazyUpdate,o=r.silent,s=r.replaceMerge,a=r.transition,r=r.notMerge),this[Ro]=!0,Dy(this),!this._model||r){var c=new Z1t(this._api),f=this._theme,g=this._model=new GJ;g.scheduler=this._scheduler,g.ssr=this._ssr,g.init(null,null,null,f,this._locale,c)}this._model.setOption(e,{replaceMerge:s},Ez);var v={seriesTransition:a,optionChanged:!0};if(n)this[es]={silent:o,updateParams:v},this[Ro]=!1,this.getZr().wakeUp();else{try{Sm(this),rd.update.call(this,null,v)}catch(y){throw this[es]=null,this[Ro]=!1,y}this._ssr||this._zr.flush(),this[es]=null,this[Ro]=!1,My.call(this,o),Ey.call(this,o)}}},t.prototype.setTheme=function(e,r){if(!this[Ro]){if(this._disposed){this.id;return}var n=this._model;if(n){var o=r&&r.silent,s=null;this[es]&&(o==null&&(o=this[es].silent),s=this[es].updateParams,this[es]=null),this[Ro]=!0,Dy(this);try{this._updateTheme(e),n.setTheme(this._theme),Sm(this),rd.update.call(this,{type:"setTheme"},s)}catch(a){throw this[Ro]=!1,a}this[Ro]=!1,My.call(this,o),Ey.call(this,o)}}},t.prototype._updateTheme=function(e){wi(e)&&(e=UQ[e]),e&&(e=Yi(e),e&&WJ(e,!0),this._theme=e)},t.prototype.getModel=function(){return this._model},t.prototype.getOption=function(){return this._model&&this._model.getOption()},t.prototype.getWidth=function(){return this._zr.getWidth()},t.prototype.getHeight=function(){return this._zr.getHeight()},t.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||Sn.hasGlobalWindow&&window.devicePixelRatio||1},t.prototype.getRenderedCanvas=function(e){return this.renderToCanvas(e)},t.prototype.renderToCanvas=function(e){e=e||{};var r=this._zr.painter;return r.getRenderedCanvas({backgroundColor:e.backgroundColor||this._model.get("backgroundColor"),pixelRatio:e.pixelRatio||this.getDevicePixelRatio()})},t.prototype.renderToSVGString=function(e){e=e||{};var r=this._zr.painter;return r.renderToString({useViewBox:e.useViewBox})},t.prototype.getSvgDataURL=function(){var e=this._zr,r=e.storage.getDisplayList();return pt(r,function(n){n.stopAnimation(null,!0)}),e.painter.toDataURL()},t.prototype.getDataURL=function(e){if(this._disposed){this.id;return}e=e||{};var r=e.excludeComponents,n=this._model,o=[],s=this;pt(r,function(c){n.eachComponent({mainType:c},function(f){var g=s._componentsMap[f.__viewId];g.group.ignore||(o.push(g),g.group.ignore=!0)})});var a=this._zr.painter.getType()==="svg"?this.getSvgDataURL():this.renderToCanvas(e).toDataURL("image/"+(e&&e.type||"png"));return pt(o,function(c){c.group.ignore=!1}),a},t.prototype.getConnectedDataURL=function(e){if(this._disposed){this.id;return}var r=e.type==="svg",n=this.group,o=Math.min,s=Math.max,a=1/0;if(P8[n]){var c=a,f=a,g=-a,v=-a,y=[],w=e&&e.pixelRatio||this.getDevicePixelRatio();pt(Pw,function(N,H){if(N.group===n){var q=r?N.getZr().painter.getSvgDom().innerHTML:N.renderToCanvas(Yi(e)),Y=N.getDom().getBoundingClientRect();c=o(Y.left,c),f=o(Y.top,f),g=s(Y.right,g),v=s(Y.bottom,v),y.push({dom:q,left:Y.left,top:Y.top})}}),c*=w,f*=w,g*=w,v*=w;var I=g-c,E=v-f,D=vc.createCanvas(),R=kH(D,{renderer:r?"svg":"canvas"});if(R.resize({width:I,height:E}),r){var z="";return pt(y,function(N){var H=N.left-c,q=N.top-f;z+='<g transform="translate('+H+","+q+')">'+N.dom+"</g>"}),R.painter.getSvgRoot().innerHTML=z,e.connectedBackgroundColor&&R.painter.setBackgroundColor(e.connectedBackgroundColor),R.refreshImmediately(),R.painter.toDataURL()}else return e.connectedBackgroundColor&&R.add(new jr({shape:{x:0,y:0,width:I,height:E},style:{fill:e.connectedBackgroundColor}})),pt(y,function(N){var H=new ys({style:{x:N.left*w-c,y:N.top*w-f,image:N.dom}});R.add(H)}),R.refreshImmediately(),D.toDataURL("image/"+(e&&e.type||"png"))}else return this.getDataURL(e)},t.prototype.convertToPixel=function(e,r,n){return BA(this,"convertToPixel",e,r,n)},t.prototype.convertToLayout=function(e,r,n){return BA(this,"convertToLayout",e,r,n)},t.prototype.convertFromPixel=function(e,r,n){return BA(this,"convertFromPixel",e,r,n)},t.prototype.containPixel=function(e,r){if(this._disposed){this.id;return}var n=this._model,o,s=u0(n,e);return pt(s,function(a,c){c.indexOf("Models")>=0&&pt(a,function(f){var g=f.coordinateSystem;if(g&&g.containPoint)o=o||!!g.containPoint(r);else if(c==="seriesModels"){var v=this._chartsMap[f.__viewId];v&&v.containPoint&&(o=o||v.containPoint(r,f))}},this)},this),!!o},t.prototype.getVisual=function(e,r){var n=this._model,o=u0(n,e,{defaultMainType:"series"}),s=o.seriesModel,a=s.getData(),c=o.hasOwnProperty("dataIndexInside")?o.dataIndexInside:o.hasOwnProperty("dataIndex")?a.indexOfRawIndex(o.dataIndex):null;return c!=null?v3(a,c,r):WS(a,r)},t.prototype.getViewOfComponentModel=function(e){return this._componentsMap[e.__viewId]},t.prototype.getViewOfSeriesModel=function(e){return this._chartsMap[e.__viewId]},t.prototype._initEvents=function(){var e=this;pt(oSt,function(n){var o=function(s){var a=e.getModel(),c=s.target,f,g=n==="globalout";if(g?f={}:c&&Xm(c,function(E){var D=cr(E);if(D&&D.dataIndex!=null){var R=D.dataModel||a.getSeriesByIndex(D.seriesIndex);return f=R&&R.getDataParams(D.dataIndex,D.dataType,c)||{},!0}else if(D.eventData)return f=Ne({},D.eventData),!0},!0),f){var v=f.componentType,y=f.componentIndex;(v==="markLine"||v==="markPoint"||v==="markArea")&&(v="series",y=f.seriesIndex);var w=v&&y!=null&&a.getComponent(v,y),I=w&&e[w.mainType==="series"?"_chartsMap":"_componentsMap"][w.__viewId];f.event=s,f.type=n,e._$eventProcessor.eventInfo={targetEl:c,packedEvent:f,model:w,view:I},e.trigger(n,f)}};o.zrEventfulCallAtLast=!0,e._zr.on(n,o,e)});var r=this._messageCenter;pt(Cz,function(n,o){r.on(o,function(s){e.trigger(o,s)})}),dwt(r,this,this._api)},t.prototype.isDisposed=function(){return this._disposed},t.prototype.clear=function(){if(this._disposed){this.id;return}this.setOption({series:[]},!0)},t.prototype.dispose=function(){if(this._disposed){this.id;return}this._disposed=!0;var e=this.getDom();e&&lK(this.getDom(),b3,"");var r=this,n=r._api,o=r._model;pt(r._componentsViews,function(s){s.dispose(o,n)}),pt(r._chartsViews,function(s){s.dispose(o,n)}),r._zr.dispose(),r._dom=r._model=r._chartsMap=r._componentsMap=r._chartsViews=r._componentsViews=r._scheduler=r._api=r._zr=r._throttledZrFlush=r._theme=r._coordSysMgr=r._messageCenter=null,delete Pw[r.id]},t.prototype.resize=function(e){if(!this[Ro]){if(this._disposed){this.id;return}this._zr.resize(e);var r=this._model;if(this._loadingFX&&this._loadingFX.resize(),!!r){var n=r.resetOption("media"),o=e&&e.silent;this[es]&&(o==null&&(o=this[es].silent),n=!0,this[es]=null),this[Ro]=!0,Dy(this);try{n&&Sm(this),rd.update.call(this,{type:"resize",animation:Ne({duration:0},e&&e.animation)})}catch(s){throw this[Ro]=!1,s}this[Ro]=!1,My.call(this,o),Ey.call(this,o)}}},t.prototype.showLoading=function(e,r){if(this._disposed){this.id;return}if(nr(e)&&(r=e,e=""),e=e||"default",this.hideLoading(),!!Dz[e]){var n=Dz[e](this._api,r),o=this._zr;this._loadingFX=n,o.add(n)}},t.prototype.hideLoading=function(){if(this._disposed){this.id;return}this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},t.prototype.makeActionFromEvent=function(e){var r=Ne({},e);return r.type=Iz[e.type],r},t.prototype.dispatchAction=function(e,r){if(this._disposed){this.id;return}if(nr(r)||(r={silent:!!r}),!!XC[e.type]&&this._model){if(this[Ro]){this._pendingActions.push(e);return}var n=r.silent;gR.call(this,e,n);var o=r.flush;o?this._zr.flush():o!==!1&&Sn.browser.weChat&&this._throttledZrFlush(),My.call(this,n),Ey.call(this,n)}},t.prototype.updateLabelLayout=function(){oc.trigger("series:layoutlabels",this._model,this._api,{updatedSeries:[]})},t.prototype.appendData=function(e){if(this._disposed){this.id;return}var r=e.seriesIndex,n=this.getModel(),o=n.getSeriesByIndex(r);o.appendData(e),this._scheduler.unfinished=!0,this.getZr().wakeUp()},t.internalField=function(){Sm=function(v){var y=v._scheduler;y.restorePipelines(v._model),y.prepareStageTasks(),fR(v,!0),fR(v,!1),y.plan()},fR=function(v,y){for(var w=v._model,I=v._scheduler,E=y?v._componentsViews:v._chartsViews,D=y?v._componentsMap:v._chartsMap,R=v._zr,z=v._api,N=0;N<E.length;N++)E[N].__alive=!1;y?w.eachComponent(function(Y,J){Y!=="series"&&H(J)}):w.eachSeries(H);function H(Y){var J=Y.__requireNewView;Y.__requireNewView=!1;var it="_ec_"+Y.id+"_"+Y.type,at=!J&&D[it];if(!at){var ut=uh(Y.type),ft=y?Oa.getClass(ut.main,ut.sub):ga.getClass(ut.sub);at=new ft,at.init(w,z),D[it]=at,E.push(at),R.add(at.group)}Y.__viewId=at.__id=it,at.__alive=!0,at.__model=Y,at.group.__ecComponentInfo={mainType:Y.mainType,index:Y.componentIndex},!y&&I.prepareView(at,Y,w,z)}for(var N=0;N<E.length;){var q=E[N];q.__alive?N++:(!y&&q.renderTask.dispose(),R.remove(q.group),q.dispose(w,z),E.splice(N,1),D[q.__id]===q&&delete D[q.__id],q.__id=q.group.__ecComponentInfo=null)}},zA=function(v,y,w,I,E){var D=v._model;if(D.setUpdatePayload(w),!I){pt([].concat(v._componentsViews).concat(v._chartsViews),q);return}var R={};R[I+"Id"]=w[I+"Id"],R[I+"Index"]=w[I+"Index"],R[I+"Name"]=w[I+"Name"];var z={mainType:I,query:R};E&&(z.subType=E);var N=w.excludeSeriesId,H;N!=null&&(H=Fi(),pt(aa(N),function(Y){var J=ko(Y,null);J!=null&&H.set(J,!0)})),D&&D.eachComponent(z,function(Y){var J=H&&H.get(Y.id)!=null;if(!J)if(pj(w))if(Y instanceof Ea)w.type===sv&&!w.notBlur&&!Y.get(["emphasis","disabled"])&&K0t(Y,w,v._api);else{var it=GF(Y.mainType,Y.componentIndex,w.name,v._api),at=it.focusSelf,ut=it.dispatchers;w.type===sv&&at&&!w.notBlur&&nz(Y.mainType,Y.componentIndex,v._api),ut&&pt(ut,function(ft){w.type===sv?Od(ft):zd(ft)})}else oz(w)&&Y instanceof Ea&&(txt(Y,w,v._api),dj(Y),vu(v))},v),D&&D.eachComponent(z,function(Y){var J=H&&H.get(Y.id)!=null;J||q(v[I==="series"?"_chartsMap":"_componentsMap"][Y.__viewId])},v);function q(Y){Y&&Y.__alive&&Y[y]&&Y[y](Y.__model,D,v._api,w)}},rd={prepareAndUpdate:function(v){Sm(this),rd.update.call(this,v,v&&{optionChanged:v.newOption!=null})},update:function(v,y){var w=this._model,I=this._api,E=this._zr,D=this._coordSysMgr,R=this._scheduler;if(w){w.setUpdatePayload(v),R.restoreData(w,v),R.performSeriesTasks(w),D.create(w,I),R.performDataProcessorTasks(w,v),pR(this,w),D.update(w,I),r(w),R.performVisualTasks(w,v);var z=w.get("backgroundColor")||"transparent";E.setBackgroundColor(z);var N=w.get("darkMode");N!=null&&N!=="auto"&&E.setDarkMode(N),mR(this,w,I,v,y),oc.trigger("afterupdate",w,I)}},updateTransform:function(v){var y=this,w=this._model,I=this._api;if(w){w.setUpdatePayload(v);var E=[];w.eachComponent(function(R,z){if(R!=="series"){var N=y.getViewOfComponentModel(z);if(N&&N.__alive)if(N.updateTransform){var H=N.updateTransform(z,w,I,v);H&&H.update&&E.push(N)}else E.push(N)}});var D=Fi();w.eachSeries(function(R){var z=y._chartsMap[R.__viewId];if(z.updateTransform){var N=z.updateTransform(R,w,I,v);N&&N.update&&D.set(R.uid,1)}else D.set(R.uid,1)}),r(w),this._scheduler.performVisualTasks(w,v,{setDirty:!0,dirtyMap:D}),FA(this,w,I,v,{},D),oc.trigger("afterupdate",w,I)}},updateView:function(v){var y=this._model;y&&(y.setUpdatePayload(v),ga.markUpdateMethod(v,"updateView"),r(y),this._scheduler.performVisualTasks(y,v,{setDirty:!0}),mR(this,y,this._api,v,{}),oc.trigger("afterupdate",y,this._api))},updateVisual:function(v){var y=this,w=this._model;w&&(w.setUpdatePayload(v),w.eachSeries(function(I){I.getData().clearAllVisual()}),ga.markUpdateMethod(v,"updateVisual"),r(w),this._scheduler.performVisualTasks(w,v,{visualType:"visual",setDirty:!0}),w.eachComponent(function(I,E){if(I!=="series"){var D=y.getViewOfComponentModel(E);D&&D.__alive&&D.updateVisual(E,w,y._api,v)}}),w.eachSeries(function(I){var E=y._chartsMap[I.__viewId];E.updateVisual(I,w,y._api,v)}),oc.trigger("afterupdate",w,this._api))},updateLayout:function(v){rd.update.call(this,v)}};function e(v,y,w,I,E){if(v._disposed){v.id;return}for(var D=v._model,R=v._coordSysMgr.getCoordinateSystems(),z,N=u0(D,w),H=0;H<R.length;H++){var q=R[H];if(q[y]&&(z=q[y](D,N,I,E))!=null)return z}}BA=e,pR=function(v,y){var w=v._chartsMap,I=v._scheduler;y.eachSeries(function(E){I.updateStreamModes(E,w[E.__viewId])})},gR=function(v,y){var w=this,I=this.getModel(),E=v.type,D=v.escapeConnect,R=XC[E],z=(R.update||"update").split(":"),N=z.pop(),H=z[0]!=null&&uh(z[0]);this[Ro]=!0,Dy(this);var q=[v],Y=!1;v.batch&&(Y=!0,q=ti(v.batch,function(bt){return bt=rr(Ne({},bt),v),bt.batch=null,bt}));var J=[],it,at=[],ut=R.nonRefinedEventType,ft=oz(v),_t=pj(v);if(_t&&RK(this._api),pt(q,function(bt){var Vt=R.action(bt,I,w._api);if(R.refineEvent?at.push(Vt):it=Vt,it=it||Ne({},bt),it.type=ut,J.push(it),_t){var zt=RF(v),Jt=zt.queryOptionMap,ce=zt.mainTypeSpecified,be=ce?Jt.keys()[0]:"series";zA(w,N,bt,be),vu(w)}else ft?(zA(w,N,bt,"series"),vu(w)):H&&zA(w,N,bt,H.main,H.sub)}),N!=="none"&&!_t&&!ft&&!H)try{this[es]?(Sm(this),rd.update.call(this,v),this[es]=null):rd[N].call(this,v)}catch(bt){throw this[Ro]=!1,bt}if(Y?it={type:ut,escapeConnect:D,batch:J}:it=J[0],this[Ro]=!1,!y){var ct=void 0;if(R.refineEvent){var Dt=R.refineEvent(at,v,I,this._api).eventContent;Vs(nr(Dt)),ct=rr({type:R.refinedEventType},Dt),ct.fromAction=v.type,ct.fromActionPayload=v,ct.escapeConnect=!0}var Et=this._messageCenter;Et.trigger(it.type,it),ct&&Et.trigger(ct.type,ct)}},My=function(v){for(var y=this._pendingActions;y.length;){var w=y.shift();gR.call(this,w,v)}},Ey=function(v){!v&&this.trigger("updated")},I8=function(v,y){v.on("rendered",function(w){y.trigger("rendered",w),v.animation.isFinished()&&!y[es]&&!y._scheduler.unfinished&&!y._pendingActions.length&&y.trigger("finished")})},C8=function(v,y){v.on("mouseover",function(w){var I=w.target,E=Xm(I,aS);E&&(J0t(E,w,y._api),vu(y))}).on("mouseout",function(w){var I=w.target,E=Xm(I,aS);E&&(Q0t(E,w,y._api),vu(y))}).on("click",function(w){var I=w.target,E=Xm(I,function(z){return cr(z).dataIndex!=null},!0);if(E){var D=E.selected?"unselect":"select",R=cr(E);y._api.dispatchAction({type:D,dataType:R.dataType,dataIndexInside:R.dataIndex,seriesIndex:R.seriesIndex,isFromClick:!0})}})};function r(v){v.clearColorPalette(),v.eachSeries(function(y){y.clearColorPalette()})}function n(v){var y=[],w=[],I=!1;if(v.eachComponent(function(z,N){var H=N.get("zlevel")||0,q=N.get("z")||0,Y=N.getZLevelKey();I=I||!!Y,(z==="series"?w:y).push({zlevel:H,z:q,idx:N.componentIndex,type:z,key:Y})}),I){var E=y.concat(w),D,R;HI(E,function(z,N){return z.zlevel===N.zlevel?z.z-N.z:z.zlevel-N.zlevel}),pt(E,function(z){var N=v.getComponent(z.type,z.idx),H=z.zlevel,q=z.key;D!=null&&(H=Math.max(D,H)),q?(H===D&&q!==R&&H++,R=q):R&&(H===D&&H++,R=""),D=H,N.setZLevel(H)})}}mR=function(v,y,w,I,E){n(y),M8(v,y,w,I,E),pt(v._chartsViews,function(D){D.__alive=!1}),FA(v,y,w,I,E),pt(v._chartsViews,function(D){D.__alive||D.remove(y,w)})},M8=function(v,y,w,I,E,D){pt(D||v._componentsViews,function(R){var z=R.__model;f(z,R),R.render(z,y,w,I),c(z,R),g(z,R)})},FA=function(v,y,w,I,E,D){var R=v._scheduler;E=Ne(E||{},{updatedSeries:y.getSeries()}),oc.trigger("series:beforeupdate",y,w,E);var z=!1;y.eachSeries(function(N){var H=v._chartsMap[N.__viewId];H.__alive=!0;var q=H.renderTask;R.updatePayload(q,I),f(N,H),D&&D.get(N.uid)&&q.dirty(),q.perform(R.getPerformArgs(q))&&(z=!0),H.group.silent=!!N.get("silent"),a(N,H),dj(N)}),R.unfinished=z||R.unfinished,oc.trigger("series:layoutlabels",y,w,E),oc.trigger("series:transition",y,w,E),y.eachSeries(function(N){var H=v._chartsMap[N.__viewId];c(N,H),g(N,H)}),s(v,y),oc.trigger("series:afterupdate",y,w,E)},vu=function(v){v[hR]=!0,v.getZr().wakeUp()},Dy=function(v){v[OA]=(v[OA]+1)%1e3},D8=function(v){v[hR]&&(v.getZr().storage.traverse(function(y){c0(y)||o(y)}),v[hR]=!1)};function o(v){for(var y=[],w=v.currentStates,I=0;I<w.length;I++){var E=w[I];E==="emphasis"||E==="blur"||E==="select"||y.push(E)}v.selected&&v.states.select&&y.push("select"),v.hoverState===cE&&v.states.emphasis?y.push("emphasis"):v.hoverState===NS&&v.states.blur&&y.push("blur"),v.useStates(y)}function s(v,y){var w=v._zr,I=w.storage,E=0;I.traverse(function(D){D.isGroup||E++}),E>y.get("hoverLayerThreshold")&&!Sn.node&&!Sn.worker&&y.eachSeries(function(D){if(!D.preventUsingHoverLayer){var R=v._chartsMap[D.__viewId];R.__alive&&R.eachRendered(function(z){z.states.emphasis&&(z.states.emphasis.hoverLayer=!0)})}})}function a(v,y){var w=v.get("blendMode")||null;y.eachRendered(function(I){I.isGroup||(I.style.blend=w)})}function c(v,y){if(!v.preventAutoZ){var w=bv(v);y.eachRendered(function(I){return mE(I,w.z,w.zlevel),!0})}}function f(v,y){y.eachRendered(function(w){if(!c0(w)){var I=w.getTextContent(),E=w.getTextGuideLine();w.stateTransition&&(w.stateTransition=null),I&&I.stateTransition&&(I.stateTransition=null),E&&E.stateTransition&&(E.stateTransition=null),w.hasState()?(w.prevStates=w.currentStates,w.clearStates()):w.prevStates&&(w.prevStates=null)}})}function g(v,y){var w=v.getModel("stateAnimation"),I=v.isAnimationEnabled(),E=w.get("duration"),D=E>0?{duration:E,delay:w.get("delay"),easing:w.get("easing")}:null;y.eachRendered(function(R){if(R.states&&R.states.emphasis){if(c0(R))return;if(R instanceof qr&&oxt(R),R.__dirty){var z=R.prevStates;z&&R.useStates(z)}if(I){R.stateTransition=D;var N=R.getTextContent(),H=R.getTextGuideLine();N&&(N.stateTransition=D),H&&(H.stateTransition=D)}R.__dirty&&o(R)}})}E8=function(v){return new(function(y){Se(w,y);function w(){return y!==null&&y.apply(this,arguments)||this}return w.prototype.getCoordinateSystems=function(){return v._coordSysMgr.getCoordinateSystems()},w.prototype.getComponentByElement=function(I){for(;I;){var E=I.__ecComponentInfo;if(E!=null)return v._model.getComponent(E.mainType,E.index);I=I.parent}},w.prototype.enterEmphasis=function(I,E){Od(I,E),vu(v)},w.prototype.leaveEmphasis=function(I,E){zd(I,E),vu(v)},w.prototype.enterBlur=function(I){EK(I),vu(v)},w.prototype.leaveBlur=function(I){UF(I),vu(v)},w.prototype.enterSelect=function(I){DK(I),vu(v)},w.prototype.leaveSelect=function(I){PK(I),vu(v)},w.prototype.getModel=function(){return v.getModel()},w.prototype.getViewOfComponentModel=function(I){return v.getViewOfComponentModel(I)},w.prototype.getViewOfSeriesModel=function(I){return v.getViewOfSeriesModel(I)},w.prototype.getMainProcessVersion=function(){return v[OA]},w}(HJ))(v)},NQ=function(v){function y(w,I){for(var E=0;E<w.length;E++){var D=w[E];D[dR]=I}}pt(Iz,function(w,I){v._messageCenter.on(I,function(E){if(P8[v.group]&&v[dR]!==A8){if(E&&E.escapeConnect)return;var D=v.makeActionFromEvent(E),R=[];pt(Pw,function(z){z!==v&&z.group===v.group&&R.push(z)}),y(R,A8),pt(R,function(z){z[dR]!==nSt&&z.dispatchAction(D)}),y(R,aSt)}})})}}(),t}(Bu),x3=VQ.prototype;x3.on=kQ("on");x3.off=kQ("off");x3.one=function(i,t,e){var r=this;function n(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];t&&t.apply&&t.apply(this,o),r.off(i,n)}this.on.call(this,i,n,e)};var oSt=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];var XC={},Iz={},Cz={},Mz=[],Ez=[],YC=[],UQ={},Dz={},Pw={},P8={},sSt=+new Date-0,b3="_echarts_instance_";function lSt(i,t,e){var r=!(e&&e.ssr);if(r){var n=uSt(i);if(n)return n}var o=new VQ(i,t,e);return o.id="ec_"+sSt++,Pw[o.id]=o,r&&lK(i,b3,o.id),NQ(o),oc.trigger("afterinit",o),o}function uSt(i){return Pw[Wyt(i,b3)]}function GQ(i,t){UQ[i]=t}function HQ(i){Ar(Ez,i)<0&&Ez.push(i)}function jQ(i,t){S3(Mz,i,t,Ywt)}function cSt(i){w3("afterinit",i)}function hSt(i){w3("afterupdate",i)}function w3(i,t){oc.on(i,t)}function Ih(i,t,e){var r,n,o,s,a;Xi(t)&&(e=t,t=""),nr(i)?(r=i.type,n=i.event,s=i.update,a=i.publishNonRefinedEvent,e||(e=i.action),o=i.refineEvent):(r=i,n=t);function c(g){return g.toLowerCase()}n=c(n||r);var f=o?c(r):n;XC[r]||(Vs(T8.test(r)&&T8.test(n)),o&&Vs(n!==r),XC[r]={actionType:r,refinedEventType:n,nonRefinedEventType:f,update:s,action:e,refineEvent:o},Cz[n]=1,o&&a&&(Cz[f]=1),Iz[f]=r)}function dSt(i,t){HS.register(i,t)}function fSt(i,t){S3(YC,i,t,PQ,"layout")}function kv(i,t){S3(YC,i,t,LQ,"visual")}var L8=[];function S3(i,t,e,r,n){if((Xi(t)||nr(t))&&(e=t,t=r),!(Ar(L8,e)>=0)){L8.push(e);var o=yQ.wrapStageHandler(e,n);o.__prio=t,o.__raw=e,i.push(o)}}function WQ(i,t){Dz[i]=t}function pSt(i,t,e){var r=Hwt("registerMap");r&&r(i,t,e)}var gSt=bbt;kv(y3,Zbt);kv(TE,qbt);kv(TE,Xbt);kv(y3,cwt);kv(TE,hwt);kv(RQ,Vwt);HQ(WJ);jQ(qwt,ebt);WQ("default",Ybt);Ih({type:sv,event:sv,update:sv},ho);Ih({type:XI,event:XI,update:XI},ho);Ih({type:BC,event:NF,update:BC,action:ho,refineEvent:T3,publishNonRefinedEvent:!0});Ih({type:iz,event:NF,update:iz,action:ho,refineEvent:T3,publishNonRefinedEvent:!0});Ih({type:FC,event:NF,update:FC,action:ho,refineEvent:T3,publishNonRefinedEvent:!0});function T3(i,t,e,r){return{eventContent:{selected:ext(e),isFromClick:t.isFromClick||!1}}}GQ("default",{});GQ("dark",lwt);var R8=[],mSt={registerPreprocessor:HQ,registerProcessor:jQ,registerPostInit:cSt,registerPostUpdate:hSt,registerUpdateLifecycle:w3,registerAction:Ih,registerCoordinateSystem:dSt,registerLayout:fSt,registerVisual:kv,registerTransform:gSt,registerLoading:WQ,registerMap:pSt,registerImpl:Gwt,PRIORITY:rSt,ComponentModel:gn,ComponentView:Oa,SeriesModel:Ea,ChartView:ga,registerComponentModel:function(i){gn.registerClass(i)},registerComponentView:function(i){Oa.registerClass(i)},registerSeriesModel:function(i){Ea.registerClass(i)},registerChartView:function(i){ga.registerClass(i)},registerCustomSeries:function(i,t){jwt(i,t)},registerSubTypeDefaulter:function(i,t){gn.registerSubTypeDefaulter(i,t)},registerPainter:function(i,t){yyt(i,t)}};function Rr(i){if(Ye(i)){pt(i,function(t){Rr(t)});return}Ar(R8,i)>=0||(R8.push(i),Xi(i)&&(i={install:i}),i.install(mSt))}function wb(i){return i==null?0:i.length||1}function k8(i){return i}var vSt=function(){function i(t,e,r,n,o,s){this._old=t,this._new=e,this._oldKeyGetter=r||k8,this._newKeyGetter=n||k8,this.context=o,this._diffModeMultiple=s==="multiple"}return i.prototype.add=function(t){return this._add=t,this},i.prototype.update=function(t){return this._update=t,this},i.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},i.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},i.prototype.updateManyToMany=function(t){return this._updateManyToMany=t,this},i.prototype.remove=function(t){return this._remove=t,this},i.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},i.prototype._executeOneToOne=function(){var t=this._old,e=this._new,r={},n=new Array(t.length),o=new Array(e.length);this._initIndexMap(t,null,n,"_oldKeyGetter"),this._initIndexMap(e,r,o,"_newKeyGetter");for(var s=0;s<t.length;s++){var a=n[s],c=r[a],f=wb(c);if(f>1){var g=c.shift();c.length===1&&(r[a]=c[0]),this._update&&this._update(g,s)}else f===1?(r[a]=null,this._update&&this._update(c,s)):this._remove&&this._remove(s)}this._performRestAdd(o,r)},i.prototype._executeMultiple=function(){var t=this._old,e=this._new,r={},n={},o=[],s=[];this._initIndexMap(t,r,o,"_oldKeyGetter"),this._initIndexMap(e,n,s,"_newKeyGetter");for(var a=0;a<o.length;a++){var c=o[a],f=r[c],g=n[c],v=wb(f),y=wb(g);if(v>1&&y===1)this._updateManyToOne&&this._updateManyToOne(g,f),n[c]=null;else if(v===1&&y>1)this._updateOneToMany&&this._updateOneToMany(g,f),n[c]=null;else if(v===1&&y===1)this._update&&this._update(g,f),n[c]=null;else if(v>1&&y>1)this._updateManyToMany&&this._updateManyToMany(g,f),n[c]=null;else if(v>1)for(var w=0;w<v;w++)this._remove&&this._remove(f[w]);else this._remove&&this._remove(f)}this._performRestAdd(s,n)},i.prototype._performRestAdd=function(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=e[n],s=wb(o);if(s>1)for(var a=0;a<s;a++)this._add&&this._add(o[a]);else s===1&&this._add&&this._add(o);e[n]=null}},i.prototype._initIndexMap=function(t,e,r,n){for(var o=this._diffModeMultiple,s=0;s<t.length;s++){var a="_ec_"+this[n](t[s],s);if(o||(r[s]=a),!!e){var c=e[a],f=wb(c);f===0?(e[a]=s,o&&r.push(a)):f===1?e[a]=[c,s]:c.push(s)}}},i}();const Bd=vSt;var _St=function(){function i(t,e){this._encode=t,this._schema=e}return i.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},i.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},i}();function ySt(i,t){var e={},r=e.encode={},n=Fi(),o=[],s=[],a={};pt(i.dimensions,function(y){var w=i.getDimensionInfo(y),I=w.coordDim;if(I){var E=w.coordDimIndex;vR(r,I)[E]=y,w.isExtraCoord||(n.set(I,1),xSt(w.type)&&(o[0]=y),vR(a,I)[E]=i.getDimensionIndex(w.name)),w.defaultTooltip&&s.push(y)}kJ.each(function(D,R){var z=vR(r,R),N=w.otherDims[R];N!=null&&N!==!1&&(z[N]=w.name)})});var c=[],f={};n.each(function(y,w){var I=r[w];f[w]=I[0],c=c.concat(I)}),e.dataDimsOnCoord=c,e.dataDimIndicesOnCoord=ti(c,function(y){return i.getDimensionInfo(y).storeDimIndex}),e.encodeFirstDimNotExtra=f;var g=r.label;g&&g.length&&(o=g.slice());var v=r.tooltip;return v&&v.length?s=v.slice():s.length||(s=o.slice()),r.defaultedLabel=o,r.defaultedTooltip=s,e.userOutput=new _St(a,t),e}function vR(i,t){return i.hasOwnProperty(t)||(i[t]=[]),i[t]}function KC(i){return i==="category"?"ordinal":i==="time"?"time":"float"}function xSt(i){return!(i==="ordinal"||i==="time")}var bSt=function(){function i(t){this.otherDims={},t!=null&&Ne(this,t)}return i}();const iC=bSt;var wSt=Wr(),SSt={float:"f",int:"i",ordinal:"o",number:"n",time:"t"},$Q=function(){function i(t){this.dimensions=t.dimensions,this._dimOmitted=t.dimensionOmitted,this.source=t.source,this._fullDimCount=t.fullDimensionCount,this._updateDimOmitted(t.dimensionOmitted)}return i.prototype.isDimensionOmitted=function(){return this._dimOmitted},i.prototype._updateDimOmitted=function(t){this._dimOmitted=t,t&&(this._dimNameMap||(this._dimNameMap=XQ(this.source)))},i.prototype.getSourceDimensionIndex=function(t){return Ui(this._dimNameMap.get(t),-1)},i.prototype.getSourceDimension=function(t){var e=this.source.dimensionsDefine;if(e)return e[t]},i.prototype.makeStoreSchema=function(){for(var t=this._fullDimCount,e=ZJ(this.source),r=!YQ(t),n="",o=[],s=0,a=0;s<t;s++){var c=void 0,f=void 0,g=void 0,v=this.dimensions[a];if(v&&v.storeDimIndex===s)c=e?v.name:null,f=v.type,g=v.ordinalMeta,a++;else{var y=this.getSourceDimension(s);y&&(c=e?y.name:null,f=y.type)}o.push({property:c,type:f,ordinalMeta:g}),e&&c!=null&&(!v||!v.isCalculationCoord)&&(n+=r?c.replace(/\`/g,"`1").replace(/\$/g,"`2"):c),n+="$",n+=SSt[f]||"f",g&&(n+=g.uid),n+="$"}var w=this.source,I=[w.seriesLayoutBy,w.startIndex,n].join("$$");return{dimensions:o,hash:I}},i.prototype.makeOutputDimensionNames=function(){for(var t=[],e=0,r=0;e<this._fullDimCount;e++){var n=void 0,o=this.dimensions[r];if(o&&o.storeDimIndex===e)o.isCalculationCoord||(n=o.name),r++;else{var s=this.getSourceDimension(e);s&&(n=s.name)}t.push(n)}return t},i.prototype.appendCalculationDimension=function(t){this.dimensions.push(t),t.isCalculationCoord=!0,this._fullDimCount++,this._updateDimOmitted(!0)},i}();function ZQ(i){return i instanceof $Q}function qQ(i){for(var t=Fi(),e=0;e<(i||[]).length;e++){var r=i[e],n=nr(r)?r.name:r;n!=null&&t.get(n)==null&&t.set(n,e)}return t}function XQ(i){var t=wSt(i);return t.dimNameMap||(t.dimNameMap=qQ(i.dimensionsDefine))}function YQ(i){return i>30}var Sb=nr,Wf=ti,TSt=typeof Int32Array>"u"?Array:Int32Array,ASt="e\0\0",O8=-1,ISt=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],CSt=["_approximateExtent"],z8,NA,Tb,Ab,_R,Ib,yR,MSt=function(){function i(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","minmaxDownSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","minmaxDownSample","lttbDownSample"];var r,n=!1;ZQ(t)?(r=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(n=!0,r=t),r=r||["x","y"];for(var o={},s=[],a={},c=!1,f={},g=0;g<r.length;g++){var v=r[g],y=wi(v)?new iC({name:v}):v instanceof iC?v:new iC(v),w=y.name;y.type=y.type||"float",y.coordDim||(y.coordDim=w,y.coordDimIndex=0);var I=y.otherDims=y.otherDims||{};s.push(w),o[w]=y,f[w]!=null&&(c=!0),y.createInvertedIndices&&(a[w]=[]);var E=g;fn(y.storeDimIndex)&&(E=y.storeDimIndex),I.itemName===0&&(this._nameDimIdx=E),I.itemId===0&&(this._idDimIdx=E),n&&(y.storeDimIndex=g)}if(this.dimensions=s,this._dimInfos=o,this._initGetDimensionInfo(c),this.hostModel=e,this._invertedIndicesMap=a,this._dimOmitted){var D=this._dimIdxToName=Fi();pt(s,function(R){D.set(o[R].storeDimIndex,R)})}}return i.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var r=this._dimIdxToName.get(e);if(r!=null)return r;var n=this._schema.getSourceDimension(e);if(n)return n.name},i.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var r=this._getDimInfo(t);return r?r.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},i.prototype._recognizeDimIndex=function(t){if(fn(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},i.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);return e},i.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},i.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(r){return e.hasOwnProperty(r)?e[r]:void 0}:function(r){return e[r]}},i.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},i.prototype.mapDimension=function(t,e){var r=this._dimSummary;if(e==null)return r.encodeFirstDimNotExtra[t];var n=r.encode[t];return n?n[e]:null},i.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,r=e.encode[t];return(r||[]).slice()},i.prototype.getStore=function(){return this._store},i.prototype.initData=function(t,e,r){var n=this,o;if(t instanceof yz&&(o=t),!o){var s=this.dimensions,a=c3(t)||Ns(t)?new qJ(t,s.length):t;o=new yz;var c=Wf(s,function(f){return{type:n._dimInfos[f].type,property:f}});o.initData(a,c,r)}this._store=o,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,o.count()),this._dimSummary=ySt(this,this._schema),this.userOutput=this._dimSummary.userOutput},i.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},i.prototype.appendValues=function(t,e){var r=this._store.appendValues(t,e&&e.length),n=r.start,o=r.end,s=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var a=n;a<o;a++){var c=a-n;this._nameList[a]=e[c],s&&yR(this,a)}},i.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,r=0;r<e.length;r++){var n=this._dimInfos[e[r]];n.ordinalMeta&&t.collectOrdinalMeta(n.storeDimIndex,n.ordinalMeta)}},i.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==Cp&&!t.fillStorage},i.prototype._doInit=function(t,e){if(!(t>=e)){var r=this._store,n=r.getProvider();this._updateOrdinalMeta();var o=this._nameList,s=this._idList,a=n.getSource().sourceFormat,c=a===nu;if(c&&!n.pure)for(var f=[],g=t;g<e;g++){var v=n.getItem(g,f);if(!this.hasItemOption&&Lyt(v)&&(this.hasItemOption=!0),v){var y=v.name;o[g]==null&&y!=null&&(o[g]=ko(y,null));var w=v.id;s[g]==null&&w!=null&&(s[g]=ko(w,null))}}if(this._shouldMakeIdFromName())for(var g=t;g<e;g++)yR(this,g);z8(this)}},i.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},i.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},i.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},i.prototype.setCalculationInfo=function(t,e){Sb(t)?Ne(this._calculationInfo,t):this._calculationInfo[t]=e},i.prototype.getName=function(t){var e=this.getRawIndex(t),r=this._nameList[e];return r==null&&this._nameDimIdx!=null&&(r=Tb(this,this._nameDimIdx,e)),r==null&&(r=""),r},i.prototype._getCategory=function(t,e){var r=this._store.get(t,e),n=this._store.getOrdinalMeta(t);return n?n.categories[r]:r},i.prototype.getId=function(t){return NA(this,this.getRawIndex(t))},i.prototype.count=function(){return this._store.count()},i.prototype.get=function(t,e){var r=this._store,n=this._dimInfos[t];if(n)return r.get(n.storeDimIndex,e)},i.prototype.getByRawIndex=function(t,e){var r=this._store,n=this._dimInfos[t];if(n)return r.getByRawIndex(n.storeDimIndex,e)},i.prototype.getIndices=function(){return this._store.getIndices()},i.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},i.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},i.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},i.prototype.getValues=function(t,e){var r=this,n=this._store;return Ye(t)?n.getValues(Wf(t,function(o){return r._getStoreDimIndex(o)}),e):n.getValues(t)},i.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,r=0,n=e.length;r<n;r++)if(isNaN(this._store.get(e[r],t)))return!1;return!0},i.prototype.indexOfName=function(t){for(var e=0,r=this._store.count();e<r;e++)if(this.getName(e)===t)return e;return-1},i.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},i.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},i.prototype.rawIndexOf=function(t,e){var r=t&&this._invertedIndicesMap[t],n=r&&r[e];return n==null||isNaN(n)?O8:n},i.prototype.each=function(t,e,r){Xi(t)&&(r=e,e=t,t=[]);var n=r||this,o=Wf(Ab(t),this._getStoreDimIndex,this);this._store.each(o,n?Si(e,n):e)},i.prototype.filterSelf=function(t,e,r){Xi(t)&&(r=e,e=t,t=[]);var n=r||this,o=Wf(Ab(t),this._getStoreDimIndex,this);return this._store=this._store.filter(o,n?Si(e,n):e),this},i.prototype.selectRange=function(t){var e=this,r={},n=on(t);return pt(n,function(o){var s=e._getStoreDimIndex(o);r[s]=t[o]}),this._store=this._store.selectRange(r),this},i.prototype.mapArray=function(t,e,r){Xi(t)&&(r=e,e=t,t=[]),r=r||this;var n=[];return this.each(t,function(){n.push(e&&e.apply(this,arguments))},r),n},i.prototype.map=function(t,e,r,n){var o=r||n||this,s=Wf(Ab(t),this._getStoreDimIndex,this),a=Ib(this);return a._store=this._store.map(s,o?Si(e,o):e),a},i.prototype.modify=function(t,e,r,n){var o=r||n||this,s=Wf(Ab(t),this._getStoreDimIndex,this);this._store.modify(s,o?Si(e,o):e)},i.prototype.downSample=function(t,e,r,n){var o=Ib(this);return o._store=this._store.downSample(this._getStoreDimIndex(t),e,r,n),o},i.prototype.minmaxDownSample=function(t,e){var r=Ib(this);return r._store=this._store.minmaxDownSample(this._getStoreDimIndex(t),e),r},i.prototype.lttbDownSample=function(t,e){var r=Ib(this);return r._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),r},i.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},i.prototype.getItemModel=function(t){var e=this.hostModel,r=this.getRawDataItem(t);return new bn(r,e,e&&e.ecModel)},i.prototype.diff=function(t){var e=this;return new Bd(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(r){return NA(t,r)},function(r){return NA(e,r)})},i.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},i.prototype.setVisual=function(t,e){this._visual=this._visual||{},Sb(t)?Ne(this._visual,t):this._visual[t]=e},i.prototype.getItemVisual=function(t,e){var r=this._itemVisuals[t],n=r&&r[e];return n??this.getVisual(e)},i.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},i.prototype.ensureUniqueItemVisual=function(t,e){var r=this._itemVisuals,n=r[t];n||(n=r[t]={});var o=n[e];return o==null&&(o=this.getVisual(e),Ye(o)?o=o.slice():Sb(o)&&(o=Ne({},o)),n[e]=o),o},i.prototype.setItemVisual=function(t,e,r){var n=this._itemVisuals[t]||{};this._itemVisuals[t]=n,Sb(e)?Ne(n,e):n[e]=r},i.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},i.prototype.setLayout=function(t,e){Sb(t)?Ne(this._layout,t):this._layout[t]=e},i.prototype.getLayout=function(t){return this._layout[t]},i.prototype.getItemLayout=function(t){return this._itemLayouts[t]},i.prototype.setItemLayout=function(t,e,r){this._itemLayouts[t]=r?Ne(this._itemLayouts[t]||{},e):e},i.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},i.prototype.setItemGraphicEl=function(t,e){var r=this.hostModel&&this.hostModel.seriesIndex;ez(r,this.dataType,t,e),this._graphicEls[t]=e},i.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},i.prototype.eachItemGraphicEl=function(t,e){pt(this._graphicEls,function(r,n){r&&t&&t.call(e,r,n)})},i.prototype.cloneShallow=function(t){return t||(t=new i(this._schema?this._schema:Wf(this.dimensions,this._getDimInfo,this),this.hostModel)),_R(t,this),t._store=this._store,t},i.prototype.wrapMethod=function(t,e){var r=this[t];Xi(r)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var n=r.apply(this,arguments);return e.apply(this,[n].concat(wF(arguments)))})},i.internalField=function(){z8=function(t){var e=t._invertedIndicesMap;pt(e,function(r,n){var o=t._dimInfos[n],s=o.ordinalMeta,a=t._store;if(s){r=e[n]=new TSt(s.categories.length);for(var c=0;c<r.length;c++)r[c]=O8;for(var c=0;c<a.count();c++)r[a.get(o.storeDimIndex,c)]=c}})},Tb=function(t,e,r){return ko(t._getCategory(e,r),null)},NA=function(t,e){var r=t._idList[e];return r==null&&t._idDimIdx!=null&&(r=Tb(t,t._idDimIdx,e)),r==null&&(r=ASt+e),r},Ab=function(t){return Ye(t)||(t=t!=null?[t]:[]),t},Ib=function(t){var e=new i(t._schema?t._schema:Wf(t.dimensions,t._getDimInfo,t),t.hostModel);return _R(e,t),e},_R=function(t,e){pt(ISt.concat(e.__wrappedMethods||[]),function(r){e.hasOwnProperty(r)&&(t[r]=e[r])}),t.__wrappedMethods=e.__wrappedMethods,pt(CSt,function(r){t[r]=Yi(e[r])}),t._calculationInfo=Ne({},e._calculationInfo)},yR=function(t,e){var r=t._nameList,n=t._idList,o=t._nameDimIdx,s=t._idDimIdx,a=r[e],c=n[e];if(a==null&&o!=null&&(r[e]=a=Tb(t,o,e)),c==null&&s!=null&&(n[e]=c=Tb(t,s,e)),c==null&&a!=null){var f=t._nameRepeatCount,g=f[a]=(f[a]||0)+1;c=a,g>1&&(c+="__ec__"+g),n[e]=c}}}(),i}();const dl=MSt;function $S(i,t){c3(i)||(i=h3(i)),t=t||{};var e=t.coordDimensions||[],r=t.dimensionsDefine||i.dimensionsDefine||[],n=Fi(),o=[],s=DSt(i,e,r,t.dimensionsCount),a=t.canOmitUnusedDimensions&&YQ(s),c=r===i.dimensionsDefine,f=c?XQ(i):qQ(r),g=t.encodeDefine;!g&&t.encodeDefaulter&&(g=t.encodeDefaulter(i,s));for(var v=Fi(g),y=new iQ(s),w=0;w<y.length;w++)y[w]=-1;function I(at){var ut=y[at];if(ut<0){var ft=r[at],_t=nr(ft)?ft:{name:ft},ct=new iC,Dt=_t.name;Dt!=null&&f.get(Dt)!=null&&(ct.name=ct.displayName=Dt),_t.type!=null&&(ct.type=_t.type),_t.displayName!=null&&(ct.displayName=_t.displayName);var Et=o.length;return y[at]=Et,ct.storeDimIndex=at,o.push(ct),ct}return o[ut]}if(!a)for(var w=0;w<s;w++)I(w);v.each(function(at,ut){var ft=aa(at).slice();if(ft.length===1&&!wi(ft[0])&&ft[0]<0){v.set(ut,!1);return}var _t=v.set(ut,[]);pt(ft,function(ct,Dt){var Et=wi(ct)?f.get(ct):ct;Et!=null&&Et<s&&(_t[Dt]=Et,D(I(Et),ut,Dt))})});var E=0;pt(e,function(at){var ut,ft,_t,ct;if(wi(at))ut=at,ct={};else{ct=at,ut=ct.name;var Dt=ct.ordinalMeta;ct.ordinalMeta=null,ct=Ne({},ct),ct.ordinalMeta=Dt,ft=ct.dimsDef,_t=ct.otherDims,ct.name=ct.coordDim=ct.coordDimIndex=ct.dimsDef=ct.otherDims=null}var Et=v.get(ut);if(Et!==!1){if(Et=aa(Et),!Et.length)for(var bt=0;bt<(ft&&ft.length||1);bt++){for(;E<s&&I(E).coordDim!=null;)E++;E<s&&Et.push(E++)}pt(Et,function(Vt,zt){var Jt=I(Vt);if(c&&ct.type!=null&&(Jt.type=ct.type),D(rr(Jt,ct),ut,zt),Jt.name==null&&ft){var ce=ft[zt];!nr(ce)&&(ce={name:ce}),Jt.name=Jt.displayName=ce.name,Jt.defaultTooltip=ce.defaultTooltip}_t&&rr(Jt.otherDims,_t)})}});function D(at,ut,ft){kJ.get(ut)!=null?at.otherDims[ut]=ft:(at.coordDim=ut,at.coordDimIndex=ft,n.set(ut,!0))}var R=t.generateCoord,z=t.generateCoordCount,N=z!=null;z=R?z||1:0;var H=R||"value";function q(at){at.name==null&&(at.name=at.coordDim)}if(a)pt(o,function(at){q(at)}),o.sort(function(at,ut){return at.storeDimIndex-ut.storeDimIndex});else for(var Y=0;Y<s;Y++){var J=I(Y),it=J.coordDim;it==null&&(J.coordDim=PSt(H,n,N),J.coordDimIndex=0,(!R||z<=0)&&(J.isExtraCoord=!0),z--),q(J),J.type==null&&(FJ(i,Y)===ps.Must||J.isExtraCoord&&(J.otherDims.itemName!=null||J.otherDims.seriesName!=null))&&(J.type="ordinal")}return ESt(o),new $Q({source:i,dimensions:o,fullDimensionCount:s,dimensionOmitted:a})}function ESt(i){for(var t=Fi(),e=0;e<i.length;e++){var r=i[e],n=r.name,o=t.get(n)||0;o>0&&(r.name=n+(o-1)),o++,t.set(n,o)}}function DSt(i,t,e,r){var n=Math.max(i.dimensionsDetectedCount||1,t.length,e.length,r||0);return pt(t,function(o){var s;nr(o)&&(s=o.dimsDef)&&(n=Math.max(n,s.length))}),n}function PSt(i,t,e){if(e||t.hasKey(i)){for(var r=0;t.hasKey(i+r);)r++;i+=r}return t.set(i,!0),i}var LSt=function(){function i(t){this.coordSysDims=[],this.axisMap=Fi(),this.categoryAxisMap=Fi(),this.coordSysName=t}return i}();function RSt(i){var t=i.get("coordinateSystem"),e=new LSt(t),r=kSt[t];if(r)return r(i,e,e.axisMap,e.categoryAxisMap),e}var kSt={cartesian2d:function(i,t,e,r){var n=i.getReferringComponents("xAxis",Wa).models[0],o=i.getReferringComponents("yAxis",Wa).models[0];t.coordSysDims=["x","y"],e.set("x",n),e.set("y",o),Py(n)&&(r.set("x",n),t.firstCategoryDimIndex=0),Py(o)&&(r.set("y",o),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1))},singleAxis:function(i,t,e,r){var n=i.getReferringComponents("singleAxis",Wa).models[0];t.coordSysDims=["single"],e.set("single",n),Py(n)&&(r.set("single",n),t.firstCategoryDimIndex=0)},polar:function(i,t,e,r){var n=i.getReferringComponents("polar",Wa).models[0],o=n.findAxisModel("radiusAxis"),s=n.findAxisModel("angleAxis");t.coordSysDims=["radius","angle"],e.set("radius",o),e.set("angle",s),Py(o)&&(r.set("radius",o),t.firstCategoryDimIndex=0),Py(s)&&(r.set("angle",s),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=1))},geo:function(i,t,e,r){t.coordSysDims=["lng","lat"]},parallel:function(i,t,e,r){var n=i.ecModel,o=n.getComponent("parallel",i.get("parallelIndex")),s=t.coordSysDims=o.dimensions.slice();pt(o.parallelAxisIndex,function(a,c){var f=n.getComponent("parallelAxis",a),g=s[c];e.set(g,f),Py(f)&&(r.set(g,f),t.firstCategoryDimIndex==null&&(t.firstCategoryDimIndex=c))})},matrix:function(i,t,e,r){var n=i.getReferringComponents("matrix",Wa).models[0];t.coordSysDims=["x","y"];var o=n.getDimensionModel("x"),s=n.getDimensionModel("y");e.set("x",o),e.set("y",s),r.set("x",o),r.set("y",s)}};function Py(i){return i.get("type")==="category"}function OSt(i,t,e){e=e||{};var r=e.byIndex,n=e.stackedCoordDimension,o,s,a;zSt(t)?o=t:(s=t.schema,o=s.dimensions,a=t.store);var c=!!(i&&i.get("stack")),f,g,v,y;if(pt(o,function(z,N){wi(z)&&(o[N]=z={name:z}),c&&!z.isExtraCoord&&(!r&&!f&&z.ordinalMeta&&(f=z),!g&&z.type!=="ordinal"&&z.type!=="time"&&(!n||n===z.coordDim)&&(g=z))}),g&&!r&&!f&&(r=!0),g){v="__\0ecstackresult_"+i.id,y="__\0ecstackedover_"+i.id,f&&(f.createInvertedIndices=!0);var w=g.coordDim,I=g.type,E=0;pt(o,function(z){z.coordDim===w&&E++});var D={name:v,coordDim:w,coordDimIndex:E,type:I,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:o.length},R={name:y,coordDim:y,coordDimIndex:E+1,type:I,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:o.length+1};s?(a&&(D.storeDimIndex=a.ensureCalculationDimension(y,I),R.storeDimIndex=a.ensureCalculationDimension(v,I)),s.appendCalculationDimension(D),s.appendCalculationDimension(R)):(o.push(D),o.push(R))}return{stackedDimension:g&&g.name,stackedByDimension:f&&f.name,isStackedByIndex:r,stackedOverDimension:y,stackResultDimension:v}}function zSt(i){return!ZQ(i.schema)}function zp(i,t){return!!t&&t===i.getCalculationInfo("stackedDimension")}function KQ(i,t){return zp(i,t)?i.getCalculationInfo("stackResultDimension"):t}function BSt(i,t){var e=i.get("coordinateSystem"),r=HS.get(e),n;return t&&t.coordSysDims&&(n=ti(t.coordSysDims,function(o){var s={name:o},a=t.axisMap.get(o);if(a){var c=a.get("type");s.type=KC(c)}return s})),n||(n=r&&(r.getDimensionsInfo?r.getDimensionsInfo():r.dimensions.slice())||["x","y"]),n}function FSt(i,t,e){var r,n;return e&&pt(i,function(o,s){var a=o.coordDim,c=e.categoryAxisMap.get(a);c&&(r==null&&(r=s),o.ordinalMeta=c.getOrdinalMeta(),t&&(o.createInvertedIndices=!0)),o.otherDims.itemName!=null&&(n=!0)}),!n&&r!=null&&(i[r].otherDims.itemName=0),r}function $d(i,t,e){e=e||{};var r=t.getSourceManager(),n,o=!1;i?(o=!0,n=h3(i)):(n=r.getSource(),o=n.sourceFormat===nu);var s=RSt(t),a=BSt(t,s),c=e.useEncodeDefaulter,f=Xi(c)?c:c?br(BJ,a,t):null,g={coordDimensions:a,generateCoord:e.generateCoord,encodeDefine:t.getEncode(),encodeDefaulter:f,canOmitUnusedDimensions:!o},v=$S(n,g),y=FSt(v.dimensions,e.createInvertedIndices,s),w=o?null:r.getSharedDataStore(v),I=OSt(t,{schema:v,store:w}),E=new dl(v,t);E.setCalculationInfo(I);var D=y!=null&&NSt(n)?function(R,z,N,H){return H===y?N:this.defaultDimValueGetter(R,z,N,H)}:null;return E.hasItemOption=!1,E.initData(o?n:w,null,D),E}function NSt(i){if(i.sourceFormat===nu){var t=VSt(i.data||[]);return!Ye(F0(t))}}function VSt(i){for(var t=0;t<i.length&&i[t]==null;)t++;return i[t]}function Pz(i){return i.type==="interval"||i.type==="log"}function USt(i,t,e,r,n){var o={},s=o.interval=QY(t/e,!0);r!=null&&s<r&&(s=o.interval=r),n!=null&&s>n&&(s=o.interval=n);var a=o.intervalPrecision=fS(s),c=o.niceTickExtent=[xo(Math.ceil(i[0]/s)*s,a),xo(Math.floor(i[1]/s)*s,a)];return GSt(c,i),o}function xR(i){var t=Math.pow(10,PF(i)),e=i/t;return e?e===2?e=3:e===3?e=5:e*=2:e=1,xo(e*t)}function fS(i){return lh(i)+2}function B8(i,t,e){i[t]=Math.max(Math.min(i[t],e[1]),e[0])}function GSt(i,t){!isFinite(i[0])&&(i[0]=t[0]),!isFinite(i[1])&&(i[1]=t[1]),B8(i,0,t),B8(i,1,t),i[0]>i[1]&&(i[0]=i[1])}function A3(i,t){return i>=t[0]&&i<=t[1]}var HSt=function(){function i(){this.normalize=F8,this.scale=N8}return i.prototype.updateMethods=function(t){t.hasBreaks()?(this.normalize=Si(t.normalize,t),this.scale=Si(t.scale,t)):(this.normalize=F8,this.scale=N8)},i}();function F8(i,t){return t[1]===t[0]?.5:(i-t[0])/(t[1]-t[0])}function N8(i,t){return i*(t[1]-t[0])+t[0]}function Lz(i,t,e){var r=Math.log(i);return[Math.log(e?t[0]:Math.max(0,t[0]))/r,Math.log(e?t[1]:Math.max(0,t[1]))/r]}var JQ=function(){function i(t){this._calculator=new HSt,this._setting=t||{},this._extent=[1/0,-1/0];var e=bo();e&&(this._brkCtx=e.createScaleBreakContext(),this._brkCtx.update(this._extent))}return i.prototype.getSetting=function(t){return this._setting[t]},i.prototype._innerUnionExtent=function(t){var e=this._extent;this._innerSetExtent(t[0]<e[0]?t[0]:e[0],t[1]>e[1]?t[1]:e[1])},i.prototype.unionExtentFromData=function(t,e){this._innerUnionExtent(t.getApproximateExtent(e))},i.prototype.getExtent=function(){return this._extent.slice()},i.prototype.setExtent=function(t,e){this._innerSetExtent(t,e)},i.prototype._innerSetExtent=function(t,e){var r=this._extent;isNaN(t)||(r[0]=t),isNaN(e)||(r[1]=e),this._brkCtx&&this._brkCtx.update(r)},i.prototype.setBreaksFromOption=function(t){var e=bo();e&&this._innerSetBreak(e.parseAxisBreakOption(t,Si(this.parse,this)))},i.prototype._innerSetBreak=function(t){this._brkCtx&&(this._brkCtx.setBreaks(t),this._calculator.updateMethods(this._brkCtx),this._brkCtx.update(this._extent))},i.prototype._innerGetBreaks=function(){return this._brkCtx?this._brkCtx.breaks:[]},i.prototype.hasBreaks=function(){return this._brkCtx?this._brkCtx.hasBreaks():!1},i.prototype._getExtentSpanWithBreaks=function(){return this._brkCtx&&this._brkCtx.hasBreaks()?this._brkCtx.getExtentSpan():this._extent[1]-this._extent[0]},i.prototype.isInExtentRange=function(t){return this._extent[0]<=t&&this._extent[1]>=t},i.prototype.isBlank=function(){return this._isBlank},i.prototype.setBlank=function(t){this._isBlank=t},i}();nE(JQ);const Ov=JQ;var jSt=0,WSt=function(){function i(t){this.categories=t.categories||[],this._needCollect=t.needCollect,this._deduplication=t.deduplication,this.uid=++jSt,this._onCollect=t.onCollect}return i.createByAxisModel=function(t){var e=t.option,r=e.data,n=r&&ti(r,$St);return new i({categories:n,needCollect:!n,deduplication:e.dedplication!==!1})},i.prototype.getOrdinal=function(t){return this._getOrCreateMap().get(t)},i.prototype.parseAndCollect=function(t){var e,r=this._needCollect;if(!wi(t)&&!r)return t;if(r&&!this._deduplication)return e=this.categories.length,this.categories[e]=t,this._onCollect&&this._onCollect(t,e),e;var n=this._getOrCreateMap();return e=n.get(t),e==null&&(r?(e=this.categories.length,this.categories[e]=t,n.set(t,e),this._onCollect&&this._onCollect(t,e)):e=NaN),e},i.prototype._getOrCreateMap=function(){return this._map||(this._map=Fi(this.categories))},i}();function $St(i){return nr(i)&&i.value!=null?i.value:i+""}const pS=WSt;var QQ=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;r.type="ordinal";var n=r.getSetting("ordinalMeta");return n||(n=new pS({})),Ye(n)&&(n=new pS({categories:ti(n,function(o){return nr(o)?o.value:o})})),r._ordinalMeta=n,r._extent=r.getSetting("extent")||[0,n.categories.length-1],r}return t.prototype.parse=function(e){return e==null?NaN:wi(e)?this._ordinalMeta.getOrdinal(e):Math.round(e)},t.prototype.contain=function(e){return A3(e,this._extent)&&e>=0&&e<this._ordinalMeta.categories.length},t.prototype.normalize=function(e){return e=this._getTickNumber(e),this._calculator.normalize(e,this._extent)},t.prototype.scale=function(e){return e=Math.round(this._calculator.scale(e,this._extent)),this.getRawOrdinalNumber(e)},t.prototype.getTicks=function(){for(var e=[],r=this._extent,n=r[0];n<=r[1];)e.push({value:n}),n++;return e},t.prototype.getMinorTicks=function(e){},t.prototype.setSortInfo=function(e){if(e==null){this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null;return}for(var r=e.ordinalNumbers,n=this._ordinalNumbersByTick=[],o=this._ticksByOrdinalNumber=[],s=0,a=this._ordinalMeta.categories.length,c=Math.min(a,r.length);s<c;++s){var f=r[s];n[s]=f,o[f]=s}for(var g=0;s<a;++s){for(;o[g]!=null;)g++;n.push(g),o[g]=s}},t.prototype._getTickNumber=function(e){var r=this._ticksByOrdinalNumber;return r&&e>=0&&e<r.length?r[e]:e},t.prototype.getRawOrdinalNumber=function(e){var r=this._ordinalNumbersByTick;return r&&e>=0&&e<r.length?r[e]:e},t.prototype.getLabel=function(e){if(!this.isBlank()){var r=this.getRawOrdinalNumber(e.value),n=this._ordinalMeta.categories[r];return n==null?"":n+""}},t.prototype.count=function(){return this._extent[1]-this._extent[0]+1},t.prototype.isInExtentRange=function(e){return e=this._getTickNumber(e),this._extent[0]<=e&&this._extent[1]>=e},t.prototype.getOrdinalMeta=function(){return this._ordinalMeta},t.prototype.calcNiceTicks=function(){},t.prototype.calcNiceExtent=function(){},t.type="ordinal",t}(Ov);Ov.registerClass(QQ);const gS=QQ;var $f=xo,ttt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="interval",e._interval=0,e._intervalPrecision=2,e}return t.prototype.parse=function(e){return e==null||e===""?NaN:Number(e)},t.prototype.contain=function(e){return A3(e,this._extent)},t.prototype.normalize=function(e){return this._calculator.normalize(e,this._extent)},t.prototype.scale=function(e){return this._calculator.scale(e,this._extent)},t.prototype.getInterval=function(){return this._interval},t.prototype.setInterval=function(e){this._interval=e,this._niceExtent=this._extent.slice(),this._intervalPrecision=fS(e)},t.prototype.getTicks=function(e){e=e||{};var r=this._interval,n=this._extent,o=this._niceExtent,s=this._intervalPrecision,a=bo(),c=[];if(!r)return c;if(e.breakTicks==="only_break"&&a)return a.addBreaksToTicks(c,this._brkCtx.breaks,this._extent),c;var f=1e4;n[0]<o[0]&&(e.expandToNicedExtent?c.push({value:$f(o[0]-r,s)}):c.push({value:n[0]}));for(var g=function(I,E){return Math.round((E-I)/r)},v=o[0];v<=o[1];){if(c.push({value:v}),v=$f(v+r,s),this._brkCtx){var y=this._brkCtx.calcNiceTickMultiple(v,g);y>=0&&(v=$f(v+y*r,s))}if(c.length>0&&v===c[c.length-1].value)break;if(c.length>f)return[]}var w=c.length?c[c.length-1].value:o[1];return n[1]>w&&(e.expandToNicedExtent?c.push({value:$f(w+r,s)}):c.push({value:n[1]})),a&&a.pruneTicksByBreak(e.pruneByBreak,c,this._brkCtx.breaks,function(I){return I.value},this._interval,this._extent),e.breakTicks!=="none"&&a&&a.addBreaksToTicks(c,this._brkCtx.breaks,this._extent),c},t.prototype.getMinorTicks=function(e){for(var r=this.getTicks({expandToNicedExtent:!0}),n=[],o=this.getExtent(),s=1;s<r.length;s++){var a=r[s],c=r[s-1];if(!(c.break||a.break)){for(var f=0,g=[],v=a.value-c.value,y=v/e,w=fS(y);f<e-1;){var I=$f(c.value+(f+1)*y,w);I>o[0]&&I<o[1]&&g.push(I),f++}var E=bo();E&&E.pruneTicksByBreak("auto",g,this._getNonTransBreaks(),function(D){return D},this._interval,o),n.push(g)}}return n},t.prototype._getNonTransBreaks=function(){return this._brkCtx?this._brkCtx.breaks:[]},t.prototype.getLabel=function(e,r){if(e==null)return"";var n=r&&r.precision;n==null?n=lh(e.value)||0:n==="auto"&&(n=this._intervalPrecision);var o=$f(e.value,n,!0);return bJ(o)},t.prototype.calcNiceTicks=function(e,r,n){e=e||5;var o=this._extent.slice(),s=this._getExtentSpanWithBreaks();if(isFinite(s)){s<0&&(s=-s,o.reverse(),this._innerSetExtent(o[0],o[1]),o=this._extent.slice());var a=USt(o,s,e,r,n);this._intervalPrecision=a.intervalPrecision,this._interval=a.interval,this._niceExtent=a.niceTickExtent}},t.prototype.calcNiceExtent=function(e){var r=this._extent.slice();if(r[0]===r[1])if(r[0]!==0){var n=Math.abs(r[0]);e.fixMax||(r[1]+=n/2),r[0]-=n/2}else r[1]=1;var o=r[1]-r[0];isFinite(o)||(r[0]=0,r[1]=1),this._innerSetExtent(r[0],r[1]),r=this._extent.slice(),this.calcNiceTicks(e.splitNumber,e.minInterval,e.maxInterval);var s=this._interval,a=this._intervalPrecision;e.fixMin||(r[0]=$f(Math.floor(r[0]/s)*s,a)),e.fixMax||(r[1]=$f(Math.ceil(r[1]/s)*s,a)),this._innerSetExtent(r[0],r[1])},t.prototype.setNiceExtent=function(e,r){this._niceExtent=[e,r]},t.type="interval",t}(Ov);Ov.registerClass(ttt);const Bp=ttt;var ett=typeof Float32Array<"u",ZSt=ett?Float32Array:Array;function ch(i){return Ye(i)?ett?new Float32Array(i):i:new ZSt(i)}var Rz="__ec_stack_";function I3(i){return i.get("stack")||Rz+i.seriesIndex}function C3(i){return i.dim+i.index}function qSt(i){var t=[],e=i.axis,r="axis0";if(e.type==="category"){for(var n=e.getBandWidth(),o=0;o<i.count;o++)t.push(rr({bandWidth:n,axisKey:r,stackId:Rz+o},i));for(var s=ntt(t),a=[],o=0;o<i.count;o++){var c=s[r][Rz+o];c.offsetCenter=c.offset+c.width/2,a.push(c)}return a}}function itt(i,t){var e=[];return t.eachSeriesByType(i,function(r){stt(r)&&e.push(r)}),e}function XSt(i){var t={};pt(i,function(c){var f=c.coordinateSystem,g=f.getBaseAxis();if(!(g.type!=="time"&&g.type!=="value"))for(var v=c.getData(),y=g.dim+"_"+g.index,w=v.getDimensionIndex(v.mapDimension(g.dim)),I=v.getStore(),E=0,D=I.count();E<D;++E){var R=I.get(w,E);t[y]?t[y].push(R):t[y]=[R]}});var e={};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];if(n){n.sort(function(c,f){return c-f});for(var o=null,s=1;s<n.length;++s){var a=n[s]-n[s-1];a>0&&(o=o===null?a:Math.min(o,a))}e[r]=o}}return e}function rtt(i){var t=XSt(i),e=[];return pt(i,function(r){var n=r.coordinateSystem,o=n.getBaseAxis(),s=o.getExtent(),a;if(o.type==="category")a=o.getBandWidth();else if(o.type==="value"||o.type==="time"){var c=o.dim+"_"+o.index,f=t[c],g=Math.abs(s[1]-s[0]),v=o.scale.getExtent(),y=Math.abs(v[1]-v[0]);a=f?g/y*f:g}else{var w=r.getData();a=Math.abs(s[1]-s[0])/w.count()}var I=xi(r.get("barWidth"),a),E=xi(r.get("barMaxWidth"),a),D=xi(r.get("barMinWidth")||(ltt(r)?.5:1),a),R=r.get("barGap"),z=r.get("barCategoryGap"),N=r.get("defaultBarGap");e.push({bandWidth:a,barWidth:I,barMaxWidth:E,barMinWidth:D,barGap:R,barCategoryGap:z,defaultBarGap:N,axisKey:C3(o),stackId:I3(r)})}),ntt(e)}function ntt(i){var t={};pt(i,function(r,n){var o=r.axisKey,s=r.bandWidth,a=t[o]||{bandWidth:s,remainedWidth:s,autoWidthCount:0,categoryGap:null,gap:r.defaultBarGap||0,stacks:{}},c=a.stacks;t[o]=a;var f=r.stackId;c[f]||a.autoWidthCount++,c[f]=c[f]||{width:0,maxWidth:0};var g=r.barWidth;g&&!c[f].width&&(c[f].width=g,g=Math.min(a.remainedWidth,g),a.remainedWidth-=g);var v=r.barMaxWidth;v&&(c[f].maxWidth=v);var y=r.barMinWidth;y&&(c[f].minWidth=y);var w=r.barGap;w!=null&&(a.gap=w);var I=r.barCategoryGap;I!=null&&(a.categoryGap=I)});var e={};return pt(t,function(r,n){e[n]={};var o=r.stacks,s=r.bandWidth,a=r.categoryGap;if(a==null){var c=on(o).length;a=Math.max(35-c*4,15)+"%"}var f=xi(a,s),g=xi(r.gap,1),v=r.remainedWidth,y=r.autoWidthCount,w=(v-f)/(y+(y-1)*g);w=Math.max(w,0),pt(o,function(R){var z=R.maxWidth,N=R.minWidth;if(R.width){var H=R.width;z&&(H=Math.min(H,z)),N&&(H=Math.max(H,N)),R.width=H,v-=H+g*H,y--}else{var H=w;z&&z<H&&(H=Math.min(z,v)),N&&N>H&&(H=N),H!==w&&(R.width=H,v-=H+g*H,y--)}}),w=(v-f)/(y+(y-1)*g),w=Math.max(w,0);var I=0,E;pt(o,function(R,z){R.width||(R.width=w),E=R,I+=R.width*(1+g)}),E&&(I-=E.width*g);var D=-I/2;pt(o,function(R,z){e[n][z]=e[n][z]||{bandWidth:s,offset:D,width:R.width},D+=R.width*(1+g)})}),e}function YSt(i,t,e){if(i&&t){var r=i[C3(t)];return r!=null&&e!=null?r[I3(e)]:r}}function att(i,t){var e=itt(i,t),r=rtt(e);pt(e,function(n){var o=n.getData(),s=n.coordinateSystem,a=s.getBaseAxis(),c=I3(n),f=r[C3(a)][c],g=f.offset,v=f.width;o.setLayout({bandWidth:f.bandWidth,offset:g,size:v})})}function ott(i){return{seriesType:i,plan:$0(),reset:function(t){if(stt(t)){var e=t.getData(),r=t.coordinateSystem,n=r.getBaseAxis(),o=r.getOtherAxis(n),s=e.getDimensionIndex(e.mapDimension(o.dim)),a=e.getDimensionIndex(e.mapDimension(n.dim)),c=t.get("showBackground",!0),f=e.mapDimension(o.dim),g=e.getCalculationInfo("stackResultDimension"),v=zp(e,f)&&!!e.getCalculationInfo("stackedOnSeries"),y=o.isHorizontal(),w=KSt(n,o),I=ltt(t),E=t.get("barMinHeight")||0,D=g&&e.getDimensionIndex(g),R=e.getLayout("size"),z=e.getLayout("offset");return{progress:function(N,H){for(var q=N.count,Y=I&&ch(q*3),J=I&&c&&ch(q*3),it=I&&ch(q),at=r.master.getRect(),ut=y?at.width:at.height,ft,_t=H.getStore(),ct=0;(ft=N.next())!=null;){var Dt=_t.get(v?D:s,ft),Et=_t.get(a,ft),bt=w,Vt=void 0;v&&(Vt=+Dt-_t.get(s,ft));var zt=void 0,Jt=void 0,ce=void 0,be=void 0;if(y){var ve=r.dataToPoint([Dt,Et]);if(v){var ke=r.dataToPoint([Vt,Et]);bt=ke[0]}zt=bt,Jt=ve[1]+z,ce=ve[0]-bt,be=R,Math.abs(ce)<E&&(ce=(ce<0?-1:1)*E)}else{var ve=r.dataToPoint([Et,Dt]);if(v){var ke=r.dataToPoint([Et,Vt]);bt=ke[1]}zt=ve[0]+z,Jt=bt,ce=R,be=ve[1]-bt,Math.abs(be)<E&&(be=(be<=0?-1:1)*E)}I?(Y[ct]=zt,Y[ct+1]=Jt,Y[ct+2]=y?ce:be,J&&(J[ct]=y?at.x:zt,J[ct+1]=y?Jt:at.y,J[ct+2]=ut),it[ft]=ft):H.setItemLayout(ft,{x:zt,y:Jt,width:ce,height:be}),ct+=3}I&&H.setLayout({largePoints:Y,largeDataIndices:it,largeBackgroundPoints:J,valueAxisHorizontal:y})}}}}}}function stt(i){return i.coordinateSystem&&i.coordinateSystem.type==="cartesian2d"}function ltt(i){return i.pipelineContext&&i.pipelineContext.large}function KSt(i,t){var e=t.model.get("startValue");return e||(e=0),t.toGlobalCoord(t.dataToCoord(t.type==="log"?e>0?e:1:e))}var JSt=function(i,t,e,r){for(;e<r;){var n=e+r>>>1;i[n][1]<t?e=n+1:r=n}return e},utt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="time",r}return t.prototype.getLabel=function(e){var r=this.getSetting("useUTC");return _E(e.value,Ej[g1t(Ew(this._minLevelUnit))]||Ej.second,r,this.getSetting("locale"))},t.prototype.getFormattedLabel=function(e,r,n){var o=this.getSetting("useUTC"),s=this.getSetting("locale");return m1t(e,r,n,s,o)},t.prototype.getTicks=function(e){e=e||{};var r=this._interval,n=this._extent,o=bo(),s=[];if(!r)return s;var a=this.getSetting("useUTC");if(o&&e.breakTicks==="only_break")return bo().addBreaksToTicks(s,this._brkCtx.breaks,this._extent),s;var c=Qy(n[1],a);s.push({value:n[0],time:{level:0,upperTimeUnit:c,lowerTimeUnit:c}});var f=aTt(this._minLevelUnit,this._approxInterval,a,n,this._getExtentSpanWithBreaks(),this._brkCtx);s=s.concat(f);var g=Qy(n[1],a);s.push({value:n[1],time:{level:0,upperTimeUnit:g,lowerTimeUnit:g}});var v=this.getSetting("useUTC"),y=Zl.length-1,w=0;return pt(s,function(I){y=Math.min(y,Ar(Zl,I.time.upperTimeUnit)),w=Math.max(w,I.time.level)}),o&&bo().pruneTicksByBreak(e.pruneByBreak,s,this._brkCtx.breaks,function(I){return I.value},this._approxInterval,this._extent),o&&e.breakTicks!=="none"&&bo().addBreaksToTicks(s,this._brkCtx.breaks,this._extent,function(I){for(var E=Math.max(Ar(Zl,Qy(I.vmin,v)),Ar(Zl,Qy(I.vmax,v))),D=0,R=0;R<Zl.length;R++)if(!ctt(Zl[R],I.vmin,I.vmax,v)){D=R;break}var z=Math.min(D,y),N=Math.max(z,E);return{level:w,lowerTimeUnit:Zl[N],upperTimeUnit:Zl[z]}}),s},t.prototype.calcNiceExtent=function(e){var r=this.getExtent();if(r[0]===r[1]&&(r[0]-=Eu,r[1]+=Eu),r[1]===-1/0&&r[0]===1/0){var n=new Date;r[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),r[0]=r[1]-Eu}this._innerSetExtent(r[0],r[1]),this.calcNiceTicks(e.splitNumber,e.minInterval,e.maxInterval)},t.prototype.calcNiceTicks=function(e,r,n){e=e||10;var o=this._getExtentSpanWithBreaks();this._approxInterval=o/e,r!=null&&this._approxInterval<r&&(this._approxInterval=r),n!=null&&this._approxInterval>n&&(this._approxInterval=n);var s=VA.length,a=Math.min(JSt(VA,this._approxInterval,0,s),s-1);this._interval=VA[a][1],this._intervalPrecision=fS(this._interval),this._minLevelUnit=VA[Math.max(a-1,0)][0]},t.prototype.parse=function(e){return fn(e)?e:+Mv(e)},t.prototype.contain=function(e){return A3(e,this._extent)},t.prototype.normalize=function(e){return this._calculator.normalize(e,this._extent)},t.prototype.scale=function(e){return this._calculator.scale(e,this._extent)},t.type="time",t}(Bp),VA=[["second",JF],["minute",QF],["hour",Mw],["quarter-day",Mw*6],["half-day",Mw*12],["day",Eu*1.2],["half-week",Eu*3.5],["week",Eu*7],["month",Eu*31],["quarter",Eu*95],["half-year",Mj/2],["year",Mj]];function ctt(i,t,e,r){return fz(new Date(t),i,r).getTime()===fz(new Date(e),i,r).getTime()}function QSt(i,t){return i/=Eu,i>16?16:i>7.5?7:i>3.5?4:i>1.5?2:1}function tTt(i){var t=30*Eu;return i/=t,i>6?6:i>3?3:i>2?2:1}function eTt(i){return i/=Mw,i>12?12:i>6?6:i>3.5?4:i>2?2:1}function V8(i,t){return i/=t?QF:JF,i>30?30:i>20?20:i>15?15:i>10?10:i>5?5:i>2?2:1}function iTt(i){return QY(i,!0)}function rTt(i,t,e){var r=Math.max(0,Ar(Zl,t)-1);return fz(new Date(i),Zl[r],e).getTime()}function nTt(i,t){var e=new Date(0);e[i](1);var r=e.getTime();e[i](1+t);var n=e.getTime()-r;return function(o,s){return Math.max(0,Math.round((s-o)/n))}}function aTt(i,t,e,r,n,o){var s=1e4,a=h1t,c=0;function f(ct,Dt,Et,bt,Vt,zt,Jt){for(var ce=nTt(Vt,ct),be=Dt,ve=new Date(be);be<Et&&be<=r[1]&&(Jt.push({value:be}),!(c++>s));)if(ve[Vt](ve[bt]()+ct),be=ve.getTime(),o){var ke=o.calcNiceTickMultiple(be,ce);ke>0&&(ve[Vt](ve[bt]()+ke*ct),be=ve.getTime())}Jt.push({value:be,notAdd:!0})}function g(ct,Dt,Et){var bt=[],Vt=!Dt.length;if(!ctt(Ew(ct),r[0],r[1],e)){Vt&&(Dt=[{value:rTt(r[0],ct,e)},{value:r[1]}]);for(var zt=0;zt<Dt.length-1;zt++){var Jt=Dt[zt].value,ce=Dt[zt+1].value;if(Jt!==ce){var be=void 0,ve=void 0,ke=void 0,ni=!1;switch(ct){case"year":be=Math.max(1,Math.round(t/Eu/365)),ve=pJ(e),ke=v1t(e);break;case"half-year":case"quarter":case"month":be=tTt(t),ve=t3(e),ke=gJ(e);break;case"week":case"half-week":case"day":be=QSt(t),ve=e3(e),ke=mJ(e),ni=!0;break;case"half-day":case"quarter-day":case"hour":be=eTt(t),ve=i3(e),ke=vJ(e);break;case"minute":be=V8(t,!0),ve=r3(e),ke=_J(e);break;case"second":be=V8(t,!1),ve=n3(e),ke=yJ(e);break;case"millisecond":be=iTt(t),ve=a3(e),ke=xJ(e);break}ce>=r[0]&&Jt<=r[1]&&f(be,Jt,ce,ve,ke,ni,bt),ct==="year"&&Et.length>1&&zt===0&&Et.unshift({value:Et[0].value-be})}}for(var zt=0;zt<bt.length;zt++)Et.push(bt[zt])}}for(var v=[],y=[],w=0,I=0,E=0;E<a.length;++E){var D=Ew(a[E]);if(p1t(a[E])){g(a[E],v[v.length-1]||[],y);var R=a[E+1]?Ew(a[E+1]):null;if(D!==R){if(y.length){I=w,y.sort(function(ct,Dt){return ct.value-Dt.value});for(var z=[],N=0;N<y.length;++N){var H=y[N].value;(N===0||y[N-1].value!==H)&&(z.push(y[N]),H>=r[0]&&H<=r[1]&&w++)}var q=n/t;if(w>q*1.5&&I>q/1.5||(v.push(z),w>q||i===a[E]))break}y=[]}}}for(var Y=kn(ti(v,function(ct){return kn(ct,function(Dt){return Dt.value>=r[0]&&Dt.value<=r[1]&&!Dt.notAdd})}),function(ct){return ct.length>0}),J=[],it=Y.length-1,E=0;E<Y.length;++E)for(var at=Y[E],ut=0;ut<at.length;++ut){var ft=Qy(at[ut].value,e);J.push({value:at[ut].value,time:{level:it-E,upperTimeUnit:ft,lowerTimeUnit:ft}})}J.sort(function(ct,Dt){return ct.value-Dt.value});for(var _t=[],E=0;E<J.length;++E)(E===0||J[E].value!==J[E-1].value)&&_t.push(J[E]);return _t}Ov.registerClass(utt);const htt=utt;var kz=xo,oTt=Math.floor,sTt=Math.ceil,UA=Math.pow,GA=Math.log,dtt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="log",e.base=10,e._originalScale=new Bp,e}return t.prototype.getTicks=function(e){e=e||{};var r=this._extent.slice(),n=this._originalScale.getExtent(),o=i.prototype.getTicks.call(this,e),s=this.base,a=this._originalScale._innerGetBreaks(),c=bo();return ti(o,function(f){var g=f.value,v=null,y=UA(s,g);g===r[0]&&this._fixMin?v=n[0]:g===r[1]&&this._fixMax&&(v=n[1]);var w;if(c){var I=c.getTicksLogTransformBreak(f,s,a,HA);w=I.vBreak,v==null&&(v=I.brkRoundingCriterion)}return v!=null&&(y=HA(y,v)),{value:y,break:w}},this)},t.prototype._getNonTransBreaks=function(){return this._originalScale._innerGetBreaks()},t.prototype.setExtent=function(e,r){this._originalScale.setExtent(e,r);var n=Lz(this.base,[e,r]);i.prototype.setExtent.call(this,n[0],n[1])},t.prototype.getExtent=function(){var e=this.base,r=i.prototype.getExtent.call(this);r[0]=UA(e,r[0]),r[1]=UA(e,r[1]);var n=this._originalScale.getExtent();return this._fixMin&&(r[0]=HA(r[0],n[0])),this._fixMax&&(r[1]=HA(r[1],n[1])),r},t.prototype.unionExtentFromData=function(e,r){this._originalScale.unionExtentFromData(e,r);var n=Lz(this.base,e.getApproximateExtent(r),!0);this._innerUnionExtent(n)},t.prototype.calcNiceTicks=function(e){e=e||10;var r=this._extent.slice(),n=this._getExtentSpanWithBreaks();if(!(!isFinite(n)||n<=0)){var o=Myt(n),s=e/n*o;for(s<=.5&&(o*=10);!isNaN(o)&&Math.abs(o)<1&&Math.abs(o)>0;)o*=10;var a=[kz(sTt(r[0]/o)*o),kz(oTt(r[1]/o)*o)];this._interval=o,this._intervalPrecision=fS(o),this._niceExtent=a}},t.prototype.calcNiceExtent=function(e){i.prototype.calcNiceExtent.call(this,e),this._fixMin=e.fixMin,this._fixMax=e.fixMax},t.prototype.contain=function(e){return e=GA(e)/GA(this.base),i.prototype.contain.call(this,e)},t.prototype.normalize=function(e){return e=GA(e)/GA(this.base),i.prototype.normalize.call(this,e)},t.prototype.scale=function(e){return e=i.prototype.scale.call(this,e),UA(this.base,e)},t.prototype.setBreaksFromOption=function(e){var r=bo();if(r){var n=r.logarithmicParseBreaksFromOption(e,this.base,Si(this.parse,this)),o=n.parsedOriginal,s=n.parsedLogged;this._originalScale._innerSetBreak(o),this._innerSetBreak(s)}},t.type="log",t}(Bp);function HA(i,t){return kz(i,lh(t))}Ov.registerClass(dtt);const lTt=dtt;var uTt=function(){function i(t,e,r){this._prepareParams(t,e,r)}return i.prototype._prepareParams=function(t,e,r){r[1]<r[0]&&(r=[NaN,NaN]),this._dataMin=r[0],this._dataMax=r[1];var n=this._isOrdinal=t.type==="ordinal";this._needCrossZero=t.type==="interval"&&e.getNeedCrossZero&&e.getNeedCrossZero();var o=e.get("min",!0);o==null&&(o=e.get("startValue",!0));var s=this._modelMinRaw=o;Xi(s)?this._modelMinNum=jA(t,s({min:r[0],max:r[1]})):s!=="dataMin"&&(this._modelMinNum=jA(t,s));var a=this._modelMaxRaw=e.get("max",!0);if(Xi(a)?this._modelMaxNum=jA(t,a({min:r[0],max:r[1]})):a!=="dataMax"&&(this._modelMaxNum=jA(t,a)),n)this._axisDataLen=e.getCategories().length;else{var c=e.get("boundaryGap"),f=Ye(c)?c:[c||0,c||0];typeof f[0]=="boolean"||typeof f[1]=="boolean"?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[yc(f[0],1),yc(f[1],1)]}},i.prototype.calculate=function(){var t=this._isOrdinal,e=this._dataMin,r=this._dataMax,n=this._axisDataLen,o=this._boundaryGapInner,s=t?null:r-e||Math.abs(e),a=this._modelMinRaw==="dataMin"?e:this._modelMinNum,c=this._modelMaxRaw==="dataMax"?r:this._modelMaxNum,f=a!=null,g=c!=null;a==null&&(a=t?n?0:NaN:e-o[0]*s),c==null&&(c=t?n?n-1:NaN:r+o[1]*s),(a==null||!isFinite(a))&&(a=NaN),(c==null||!isFinite(c))&&(c=NaN);var v=Bs(a)||Bs(c)||t&&!n;this._needCrossZero&&(a>0&&c>0&&!f&&(a=0),a<0&&c<0&&!g&&(c=0));var y=this._determinedMin,w=this._determinedMax;return y!=null&&(a=y,f=!0),w!=null&&(c=w,g=!0),{min:a,max:c,minFixed:f,maxFixed:g,isBlank:v}},i.prototype.modifyDataMinMax=function(t,e){this[hTt[t]]=e},i.prototype.setDeterminedMinMax=function(t,e){var r=cTt[t];this[r]=e},i.prototype.freeze=function(){this.frozen=!0},i}(),cTt={min:"_determinedMin",max:"_determinedMax"},hTt={min:"_dataMin",max:"_dataMax"};function ftt(i,t,e){var r=i.rawExtentInfo;return r||(r=new uTt(i,t,e),i.rawExtentInfo=r,r)}function jA(i,t){return t==null?null:Bs(t)?NaN:i.parse(t)}function ptt(i,t){var e=i.type,r=ftt(i,t,i.getExtent()).calculate();i.setBlank(r.isBlank);var n=r.min,o=r.max,s=t.ecModel;if(s&&e==="time"){var a=itt("bar",s),c=!1;if(pt(a,function(v){c=c||v.getBaseAxis()===t.axis}),c){var f=rtt(a),g=dTt(n,o,t,f);n=g.min,o=g.max}}return{extent:[n,o],fixMin:r.minFixed,fixMax:r.maxFixed}}function dTt(i,t,e,r){var n=e.axis.getExtent(),o=Math.abs(n[1]-n[0]),s=YSt(r,e.axis);if(s===void 0)return{min:i,max:t};var a=1/0;pt(s,function(w){a=Math.min(w.offset,a)});var c=-1/0;pt(s,function(w){c=Math.max(w.offset+w.width,c)}),a=Math.abs(a),c=Math.abs(c);var f=a+c,g=t-i,v=1-(a+c)/o,y=g/v-g;return t+=y*(c/f),i-=y*(a/f),{min:i,max:t}}function I0(i,t){var e=t,r=ptt(i,e),n=r.extent,o=e.get("splitNumber");i instanceof lTt&&(i.base=e.get("logBase"));var s=i.type,a=e.get("interval"),c=s==="interval"||s==="time";i.setBreaksFromOption(mtt(e)),i.setExtent(n[0],n[1]),i.calcNiceExtent({splitNumber:o,fixMin:r.fixMin,fixMax:r.fixMax,minInterval:c?e.get("minInterval"):null,maxInterval:c?e.get("maxInterval"):null}),a!=null&&i.setInterval&&i.setInterval(a)}function AE(i,t){if(t=t||i.get("type"),t)switch(t){case"category":return new gS({ordinalMeta:i.getOrdinalMeta?i.getOrdinalMeta():i.getCategories(),extent:[1/0,-1/0]});case"time":return new htt({locale:i.ecModel.getLocaleModel(),useUTC:i.ecModel.get("useUTC")});default:return new(Ov.getClass(t)||Bp)}}function fTt(i){var t=i.scale.getExtent(),e=t[0],r=t[1];return!(e>0&&r>0||e<0&&r<0)}function X0(i){var t=i.getLabelModel().get("formatter");if(i.type==="time"){var e=d1t(t);return function(n,o){return i.scale.getFormattedLabel(n,o,e)}}else{if(wi(t))return function(n){var o=i.scale.getLabel(n),s=t.replace("{value}",o??"");return s};if(Xi(t)){if(i.type==="category")return function(n,o){return t(JC(i,n),n.value-i.scale.getExtent()[0],null)};var r=bo();return function(n,o){var s=null;return r&&(s=r.makeAxisLabelFormatterParamBreak(s,n.break)),t(JC(i,n),o,s)}}else return function(n){return i.scale.getLabel(n)}}}function JC(i,t){return i.type==="category"?i.scale.getLabel(t):t.value}function M3(i){var t=i.get("interval");return t??"auto"}function gtt(i){return i.type==="category"&&M3(i.getLabelModel())===0}function QC(i,t){var e={};return pt(i.mapDimensionsAll(t),function(r){e[KQ(i,r)]=!0}),on(e)}function pTt(i,t,e){t&&pt(QC(t,e),function(r){var n=t.getApproximateExtent(r);n[0]<i[0]&&(i[0]=n[0]),n[1]>i[1]&&(i[1]=n[1])})}function C0(i){return i==="middle"||i==="center"}function mS(i){return i.getShallow("show")}function mtt(i){var t=i.get("breaks",!0);if(t!=null)return!bo()||!gTt(i.axis)?void 0:t}function gTt(i){return(i.dim==="x"||i.dim==="y"||i.dim==="z"||i.dim==="single")&&i.type!=="category"}var ZS=function(){function i(){}return i.prototype.getNeedCrossZero=function(){var t=this.option;return!t.scale},i.prototype.getCoordSysModel=function(){},i}(),mTt=1e-8;function U8(i,t){return Math.abs(i-t)<mTt}function Fm(i,t,e){var r=0,n=i[0];if(!n)return!1;for(var o=1;o<i.length;o++){var s=i[o];r+=cd(n[0],n[1],s[0],s[1],t,e),n=s}var a=i[0];return(!U8(n[0],a[0])||!U8(n[1],a[1]))&&(r+=cd(n[0],n[1],a[0],a[1],t,e)),r!==0}var vTt=[];function bR(i,t){for(var e=0;e<i.length;e++)fo(i[e],i[e],t)}function G8(i,t,e,r){for(var n=0;n<i.length;n++){var o=i[n];r&&(o=r.project(o)),o&&isFinite(o[0])&&isFinite(o[1])&&(fp(t,t,o),pp(e,e,o))}}function _Tt(i){for(var t=0,e=0,r=0,n=i.length,o=i[n-1][0],s=i[n-1][1],a=0;a<n;a++){var c=i[a][0],f=i[a][1],g=o*f-c*s;t+=g,e+=(o+c)*g,r+=(s+f)*g,o=c,s=f}return t?[e/t/3,r/t/3,t]:[i[0][0]||0,i[0][1]||0]}var vtt=function(){function i(t){this.name=t}return i.prototype.setCenter=function(t){this._center=t},i.prototype.getCenter=function(){var t=this._center;return t||(t=this._center=this.calcCenter()),t},i}(),H8=function(){function i(t,e){this.type="polygon",this.exterior=t,this.interiors=e}return i}(),j8=function(){function i(t){this.type="linestring",this.points=t}return i}(),_tt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this,e)||this;return o.type="geoJSON",o.geometries=r,o._center=n&&[n[0],n[1]],o}return t.prototype.calcCenter=function(){for(var e=this.geometries,r,n=0,o=0;o<e.length;o++){var s=e[o],a=s.exterior,c=a&&a.length;c>n&&(r=s,n=c)}if(r)return _Tt(r.exterior);var f=this.getBoundingRect();return[f.x+f.width/2,f.y+f.height/2]},t.prototype.getBoundingRect=function(e){var r=this._rect;if(r&&!e)return r;var n=[1/0,1/0],o=[-1/0,-1/0],s=this.geometries;return pt(s,function(a){a.type==="polygon"?G8(a.exterior,n,o,e):pt(a.points,function(c){G8(c,n,o,e)})}),isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])||(n[0]=n[1]=o[0]=o[1]=0),r=new sr(n[0],n[1],o[0]-n[0],o[1]-n[1]),e||(this._rect=r),r},t.prototype.contain=function(e){var r=this.getBoundingRect(),n=this.geometries;if(!r.contain(e[0],e[1]))return!1;t:for(var o=0,s=n.length;o<s;o++){var a=n[o];if(a.type==="polygon"){var c=a.exterior,f=a.interiors;if(Fm(c,e[0],e[1])){for(var g=0;g<(f?f.length:0);g++)if(Fm(f[g],e[0],e[1]))continue t;return!0}}}return!1},t.prototype.transformTo=function(e,r,n,o){var s=this.getBoundingRect(),a=s.width/s.height;n?o||(o=n/a):n=a*o;for(var c=new sr(e,r,n,o),f=s.calculateTransform(c),g=this.geometries,v=0;v<g.length;v++){var y=g[v];y.type==="polygon"?(bR(y.exterior,f),pt(y.interiors,function(w){bR(w,f)})):pt(y.points,function(w){bR(w,f)})}s=this._rect,s.copy(c),this._center=[s.x+s.width/2,s.y+s.height/2]},t.prototype.cloneShallow=function(e){e==null&&(e=this.name);var r=new t(e,this.geometries,this._center);return r._rect=this._rect,r.transformTo=null,r},t}(vtt),yTt=function(i){Se(t,i);function t(e,r){var n=i.call(this,e)||this;return n.type="geoSVG",n._elOnlyForCalculate=r,n}return t.prototype.calcCenter=function(){for(var e=this._elOnlyForCalculate,r=e.getBoundingRect(),n=[r.x+r.width/2,r.y+r.height/2],o=tE(vTt),s=e;s&&!s.isGeoSVGGraphicRoot;)ph(o,s.getLocalTransform(),o),s=s.parent;return _c(o,o),fo(n,n,o),n},t}(vtt);function xTt(i){if(!i.UTF8Encoding)return i;var t=i,e=t.UTF8Scale;e==null&&(e=1024);var r=t.features;return pt(r,function(n){var o=n.geometry,s=o.encodeOffsets,a=o.coordinates;if(s)switch(o.type){case"LineString":o.coordinates=ytt(a,s,e);break;case"Polygon":wR(a,s,e);break;case"MultiLineString":wR(a,s,e);break;case"MultiPolygon":pt(a,function(c,f){return wR(c,s[f],e)})}}),t.UTF8Encoding=!1,t}function wR(i,t,e){for(var r=0;r<i.length;r++)i[r]=ytt(i[r],t[r],e)}function ytt(i,t,e){for(var r=[],n=t[0],o=t[1],s=0;s<i.length;s+=2){var a=i.charCodeAt(s)-64,c=i.charCodeAt(s+1)-64;a=a>>1^-(a&1),c=c>>1^-(c&1),a+=n,c+=o,n=a,o=c,r.push([a/e,c/e])}return r}function bTt(i,t){return i=xTt(i),ti(kn(i.features,function(e){return e.geometry&&e.properties&&e.geometry.coordinates.length>0}),function(e){var r=e.properties,n=e.geometry,o=[];switch(n.type){case"Polygon":var s=n.coordinates;o.push(new H8(s[0],s.slice(1)));break;case"MultiPolygon":pt(n.coordinates,function(c){c[0]&&o.push(new H8(c[0],c.slice(1)))});break;case"LineString":o.push(new j8([n.coordinates]));break;case"MultiLineString":o.push(new j8(n.coordinates))}var a=new _tt(r[t||"name"],o,r.cp);return a.properties=r,a})}var wTt=Wr(),Lw=Wr(),xc={estimate:1,determine:2};function tM(i){return{out:{noPxChangeTryDetermine:[]},kind:i}}function xtt(i,t){var e=ti(t,function(r){return i.scale.parse(r)});return i.type==="time"&&e.length>0&&(e.sort(),e.unshift(e[0]),e.push(e[e.length-1])),e}function STt(i,t){var e=i.getLabelModel().get("customValues");if(e){var r=X0(i),n=i.scale.getExtent(),o=xtt(i,e),s=kn(o,function(a){return a>=n[0]&&a<=n[1]});return{labels:ti(s,function(a){var c={value:a};return{formattedLabel:r(c),rawLabel:i.scale.getLabel(c),tickValue:a,time:void 0,break:void 0}})}}return i.type==="category"?ATt(i,t):CTt(i)}function TTt(i,t,e){var r=i.getTickModel().get("customValues");if(r){var n=i.scale.getExtent(),o=xtt(i,r);return{ticks:kn(o,function(s){return s>=n[0]&&s<=n[1]})}}return i.type==="category"?ITt(i,t):{ticks:ti(i.scale.getTicks(e),function(s){return s.value})}}function ATt(i,t){var e=i.getLabelModel(),r=btt(i,e,t);return!e.get("show")||i.scale.isBlank()?{labels:[]}:r}function btt(i,t,e){var r=ETt(i),n=M3(t),o=e.kind===xc.estimate;if(!o){var s=Stt(r,n);if(s)return s}var a,c;Xi(n)?a=Itt(i,n):(c=n==="auto"?DTt(i,e):n,a=Att(i,c));var f={labels:a,labelCategoryInterval:c};return o?e.out.noPxChangeTryDetermine.push(function(){return Oz(r,n,f),!0}):Oz(r,n,f),f}function ITt(i,t){var e=MTt(i),r=M3(t),n=Stt(e,r);if(n)return n;var o,s;if((!t.get("show")||i.scale.isBlank())&&(o=[]),Xi(r))o=Itt(i,r,!0);else if(r==="auto"){var a=btt(i,i.getLabelModel(),tM(xc.determine));s=a.labelCategoryInterval,o=ti(a.labels,function(c){return c.tickValue})}else s=r,o=Att(i,s,!0);return Oz(e,r,{ticks:o,tickCategoryInterval:s})}function CTt(i){var t=i.scale.getTicks(),e=X0(i);return{labels:ti(t,function(r,n){return{formattedLabel:e(r,n),rawLabel:i.scale.getLabel(r),tickValue:r.value,time:r.time,break:r.break}})}}var MTt=wtt("axisTick"),ETt=wtt("axisLabel");function wtt(i){return function(e){return Lw(e)[i]||(Lw(e)[i]={list:[]})}}function Stt(i,t){for(var e=0;e<i.list.length;e++)if(i.list[e].key===t)return i.list[e].value}function Oz(i,t,e){return i.list.push({key:t,value:e}),e}function DTt(i,t){if(t.kind===xc.estimate){var e=i.calculateCategoryInterval(t);return t.out.noPxChangeTryDetermine.push(function(){return Lw(i).autoInterval=e,!0}),e}var r=Lw(i).autoInterval;return r??(Lw(i).autoInterval=i.calculateCategoryInterval(t))}function PTt(i,t){var e=t.kind,r=RTt(i),n=X0(i),o=(r.axisRotate-r.labelRotate)/180*Math.PI,s=i.scale,a=s.getExtent(),c=s.count();if(a[1]-a[0]<1)return 0;var f=1,g=40;c>g&&(f=Math.max(1,Math.floor(c/g)));for(var v=a[0],y=i.dataToCoord(v+1)-i.dataToCoord(v),w=Math.abs(y*Math.cos(o)),I=Math.abs(y*Math.sin(o)),E=0,D=0;v<=a[1];v+=f){var R=0,z=0,N=rE(n({value:v}),r.font,"center","top");R=N.width*1.3,z=N.height*1.3,E=Math.max(E,R,7),D=Math.max(D,z,7)}var H=E/w,q=D/I;isNaN(H)&&(H=1/0),isNaN(q)&&(q=1/0);var Y=Math.max(0,Math.floor(Math.min(H,q)));if(e===xc.estimate)return t.out.noPxChangeTryDetermine.push(Si(LTt,null,i,Y,c)),Y;var J=Ttt(i,Y,c);return J??Y}function LTt(i,t,e){return Ttt(i,t,e)==null}function Ttt(i,t,e){var r=wTt(i.model),n=i.getExtent(),o=r.lastAutoInterval,s=r.lastTickCount;if(o!=null&&s!=null&&Math.abs(o-t)<=1&&Math.abs(s-e)<=1&&o>t&&r.axisExtent0===n[0]&&r.axisExtent1===n[1])return o;r.lastTickCount=e,r.lastAutoInterval=t,r.axisExtent0=n[0],r.axisExtent1=n[1]}function RTt(i){var t=i.getLabelModel();return{axisRotate:i.getRotate?i.getRotate():i.isHorizontal&&!i.isHorizontal()?90:0,labelRotate:t.get("rotate")||0,font:t.getFont()}}function Att(i,t,e){var r=X0(i),n=i.scale,o=n.getExtent(),s=i.getLabelModel(),a=[],c=Math.max((t||0)+1,1),f=o[0],g=n.count();f!==0&&c>1&&g/c>2&&(f=Math.round(Math.ceil(f/c)*c));var v=gtt(i),y=s.get("showMinLabel")||v,w=s.get("showMaxLabel")||v;y&&f!==o[0]&&E(o[0]);for(var I=f;I<=o[1];I+=c)E(I);w&&I-c!==o[1]&&E(o[1]);function E(D){var R={value:D};a.push(e?D:{formattedLabel:r(R),rawLabel:n.getLabel(R),tickValue:D,time:void 0,break:void 0})}return a}function Itt(i,t,e){var r=i.scale,n=X0(i),o=[];return pt(r.getTicks(),function(s){var a=r.getLabel(s),c=s.value;t(s.value,a)&&o.push(e?c:{formattedLabel:n(s),rawLabel:a,tickValue:c,time:void 0,break:void 0})}),o}var W8=[0,1],kTt=function(){function i(t,e,r){this.onBand=!1,this.inverse=!1,this.dim=t,this.scale=e,this._extent=r||[0,0]}return i.prototype.contain=function(t){var e=this._extent,r=Math.min(e[0],e[1]),n=Math.max(e[0],e[1]);return t>=r&&t<=n},i.prototype.containData=function(t){return this.scale.contain(this.scale.parse(t))},i.prototype.getExtent=function(){return this._extent.slice()},i.prototype.getPixelPrecision=function(t){return KY(t||this.scale.getExtent(),this._extent)},i.prototype.setExtent=function(t,e){var r=this._extent;r[0]=t,r[1]=e},i.prototype.dataToCoord=function(t,e){var r=this._extent,n=this.scale;return t=n.normalize(n.parse(t)),this.onBand&&n.type==="ordinal"&&(r=r.slice(),$8(r,n.count())),Rn(t,W8,r,e)},i.prototype.coordToData=function(t,e){var r=this._extent,n=this.scale;this.onBand&&n.type==="ordinal"&&(r=r.slice(),$8(r,n.count()));var o=Rn(t,r,W8,e);return this.scale.scale(o)},i.prototype.pointToData=function(t,e){},i.prototype.getTicksCoords=function(t){t=t||{};var e=t.tickModel||this.getTickModel(),r=TTt(this,e,{breakTicks:t.breakTicks,pruneByBreak:t.pruneByBreak}),n=r.ticks,o=ti(n,function(a){return{coord:this.dataToCoord(this.scale.type==="ordinal"?this.scale.getRawOrdinalNumber(a):a),tickValue:a}},this),s=e.get("alignWithLabel");return OTt(this,o,s,t.clamp),o},i.prototype.getMinorTicksCoords=function(){if(this.scale.type==="ordinal")return[];var t=this.model.getModel("minorTick"),e=t.get("splitNumber");e>0&&e<100||(e=5);var r=this.scale.getMinorTicks(e),n=ti(r,function(o){return ti(o,function(s){return{coord:this.dataToCoord(s),tickValue:s}},this)},this);return n},i.prototype.getViewLabels=function(t){return t=t||tM(xc.determine),STt(this,t).labels},i.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},i.prototype.getTickModel=function(){return this.model.getModel("axisTick")},i.prototype.getBandWidth=function(){var t=this._extent,e=this.scale.getExtent(),r=e[1]-e[0]+(this.onBand?1:0);r===0&&(r=1);var n=Math.abs(t[1]-t[0]);return Math.abs(n)/r},i.prototype.calculateCategoryInterval=function(t){return t=t||tM(xc.determine),PTt(this,t)},i}();function $8(i,t){var e=i[1]-i[0],r=t,n=e/r/2;i[0]+=n,i[1]-=n}function OTt(i,t,e,r){var n=t.length;if(!i.onBand||e||!n)return;var o=i.getExtent(),s,a;if(n===1)t[0].coord=o[0],t[0].onBand=!0,s=t[1]={coord:o[1],tickValue:t[0].tickValue,onBand:!0};else{var c=t[n-1].tickValue-t[0].tickValue,f=(t[n-1].coord-t[0].coord)/c;pt(t,function(w){w.coord-=f/2,w.onBand=!0});var g=i.scale.getExtent();a=1+g[1]-t[n-1].tickValue,s={coord:t[n-1].coord+f*a,tickValue:g[1]+1,onBand:!0},t.push(s)}var v=o[0]>o[1];y(t[0].coord,o[0])&&(r?t[0].coord=o[0]:t.shift()),r&&y(o[0],t[0].coord)&&t.unshift({coord:o[0],onBand:!0}),y(o[1],s.coord)&&(r?s.coord=o[1]:t.pop()),r&&y(s.coord,o[1])&&t.push({coord:o[1],onBand:!0});function y(w,I){return w=xo(w),I=xo(I),v?w>I:w<I}}const Sc=kTt;var Cb=Math.PI*2,Tm=Sh.CMD,zTt=["top","right","bottom","left"];function BTt(i,t,e,r,n){var o=e.width,s=e.height;switch(i){case"top":r.set(e.x+o/2,e.y-t),n.set(0,-1);break;case"bottom":r.set(e.x+o/2,e.y+s+t),n.set(0,1);break;case"left":r.set(e.x-t,e.y+s/2),n.set(-1,0);break;case"right":r.set(e.x+o+t,e.y+s/2),n.set(1,0);break}}function FTt(i,t,e,r,n,o,s,a,c){s-=i,a-=t;var f=Math.sqrt(s*s+a*a);s/=f,a/=f;var g=s*e+i,v=a*e+t;if(Math.abs(r-n)%Cb<1e-4)return c[0]=g,c[1]=v,f-e;if(o){var y=r;r=tu(n),n=tu(y)}else r=tu(r),n=tu(n);r>n&&(n+=Cb);var w=Math.atan2(a,s);if(w<0&&(w+=Cb),w>=r&&w<=n||w+Cb>=r&&w+Cb<=n)return c[0]=g,c[1]=v,f-e;var I=e*Math.cos(r)+i,E=e*Math.sin(r)+t,D=e*Math.cos(n)+i,R=e*Math.sin(n)+t,z=(I-s)*(I-s)+(E-a)*(E-a),N=(D-s)*(D-s)+(R-a)*(R-a);return z<N?(c[0]=I,c[1]=E,Math.sqrt(z)):(c[0]=D,c[1]=R,Math.sqrt(N))}function eM(i,t,e,r,n,o,s,a){var c=n-i,f=o-t,g=e-i,v=r-t,y=Math.sqrt(g*g+v*v);g/=y,v/=y;var w=c*g+f*v,I=w/y;a&&(I=Math.min(Math.max(I,0),1)),I*=y;var E=s[0]=i+I*g,D=s[1]=t+I*v;return Math.sqrt((E-n)*(E-n)+(D-o)*(D-o))}function Ctt(i,t,e,r,n,o,s){e<0&&(i=i+e,e=-e),r<0&&(t=t+r,r=-r);var a=i+e,c=t+r,f=s[0]=Math.min(Math.max(n,i),a),g=s[1]=Math.min(Math.max(o,t),c);return Math.sqrt((f-n)*(f-n)+(g-o)*(g-o))}var sc=[];function NTt(i,t,e){var r=Ctt(t.x,t.y,t.width,t.height,i.x,i.y,sc);return e.set(sc[0],sc[1]),r}function VTt(i,t,e){for(var r=0,n=0,o=0,s=0,a,c,f=1/0,g=t.data,v=i.x,y=i.y,w=0;w<g.length;){var I=g[w++];w===1&&(r=g[w],n=g[w+1],o=r,s=n);var E=f;switch(I){case Tm.M:o=g[w++],s=g[w++],r=o,n=s;break;case Tm.L:E=eM(r,n,g[w],g[w+1],v,y,sc,!0),r=g[w++],n=g[w++];break;case Tm.C:E=PY(r,n,g[w++],g[w++],g[w++],g[w++],g[w],g[w+1],v,y,sc),r=g[w++],n=g[w++];break;case Tm.Q:E=RY(r,n,g[w++],g[w++],g[w],g[w+1],v,y,sc),r=g[w++],n=g[w++];break;case Tm.A:var D=g[w++],R=g[w++],z=g[w++],N=g[w++],H=g[w++],q=g[w++];w+=1;var Y=!!(1-g[w++]);a=Math.cos(H)*z+D,c=Math.sin(H)*N+R,w<=1&&(o=a,s=c);var J=(v-D)*N/z+D;E=FTt(D,R,N,H,H+q,Y,J,y,sc),r=Math.cos(H+q)*z+D,n=Math.sin(H+q)*N+R;break;case Tm.R:o=r=g[w++],s=n=g[w++];var it=g[w++],at=g[w++];E=Ctt(o,s,it,at,v,y,sc);break;case Tm.Z:E=eM(r,n,o,s,v,y,sc,!0),r=o,n=s;break}E<f&&(f=E,e.set(sc[0],sc[1]))}return f}var uc=new er,ya=new er,lo=new er,hh=new er,oh=new er;function Z8(i,t){if(i){var e=i.getTextGuideLine(),r=i.getTextContent();if(r&&e){var n=i.textGuideLineConfig||{},o=[[0,0],[0,0],[0,0]],s=n.candidates||zTt,a=r.getBoundingRect().clone();a.applyTransform(r.getComputedTransform());var c=1/0,f=n.anchor,g=i.getComputedTransform(),v=g&&_c([],g),y=t.get("length2")||0;f&&lo.copy(f);for(var w=0;w<s.length;w++){var I=s[w];BTt(I,0,a,uc,hh),er.scaleAndAdd(ya,uc,hh,y),ya.transform(v);var E=i.getBoundingRect(),D=f?f.distance(ya):i instanceof qr?VTt(ya,i.path,lo):NTt(ya,E,lo);D<c&&(c=D,ya.transform(g),lo.transform(g),lo.toArray(o[0]),ya.toArray(o[1]),uc.toArray(o[2]))}Mtt(o,t.get("minTurnAngle")),e.setShape({points:o})}}}var iM=[],cl=new er;function Mtt(i,t){if(t<=180&&t>0){t=t/180*Math.PI,uc.fromArray(i[0]),ya.fromArray(i[1]),lo.fromArray(i[2]),er.sub(hh,uc,ya),er.sub(oh,lo,ya);var e=hh.len(),r=oh.len();if(!(e<.001||r<.001)){hh.scale(1/e),oh.scale(1/r);var n=hh.dot(oh),o=Math.cos(t);if(o<n){var s=eM(ya.x,ya.y,lo.x,lo.y,uc.x,uc.y,iM,!1);cl.fromArray(iM),cl.scaleAndAdd(oh,s/Math.tan(Math.PI-t));var a=lo.x!==ya.x?(cl.x-ya.x)/(lo.x-ya.x):(cl.y-ya.y)/(lo.y-ya.y);if(isNaN(a))return;a<0?er.copy(cl,ya):a>1&&er.copy(cl,lo),cl.toArray(i[1])}}}}function UTt(i,t,e){if(e<=180&&e>0){e=e/180*Math.PI,uc.fromArray(i[0]),ya.fromArray(i[1]),lo.fromArray(i[2]),er.sub(hh,ya,uc),er.sub(oh,lo,ya);var r=hh.len(),n=oh.len();if(!(r<.001||n<.001)){hh.scale(1/r),oh.scale(1/n);var o=hh.dot(t),s=Math.cos(e);if(o<s){var a=eM(ya.x,ya.y,lo.x,lo.y,uc.x,uc.y,iM,!1);cl.fromArray(iM);var c=Math.PI/2,f=Math.acos(oh.dot(t)),g=c+f-e;if(g>=c)er.copy(cl,lo);else{cl.scaleAndAdd(oh,a/Math.tan(Math.PI/2-g));var v=lo.x!==ya.x?(cl.x-ya.x)/(lo.x-ya.x):(cl.y-ya.y)/(lo.y-ya.y);if(isNaN(v))return;v<0?er.copy(cl,ya):v>1&&er.copy(cl,lo)}cl.toArray(i[1])}}}}function SR(i,t,e,r){var n=e==="normal",o=n?i:i.ensureState(e);o.ignore=t;var s=r.get("smooth");s&&s===!0&&(s=.3),o.shape=o.shape||{},s>0&&(o.shape.smooth=s);var a=r.getModel("lineStyle").getLineStyle();n?i.useStyle(a):o.style=a}function GTt(i,t){var e=t.smooth,r=t.points;if(r)if(i.moveTo(r[0][0],r[0][1]),e>0&&r.length>=3){var n=dp(r[0],r[1]),o=dp(r[1],r[2]);if(!n||!o){i.lineTo(r[1][0],r[1][1]),i.lineTo(r[2][0],r[2][1]);return}var s=Math.min(n,o)*e,a=GI([],r[1],r[0],s/n),c=GI([],r[1],r[2],s/o),f=GI([],a,c,.5);i.bezierCurveTo(a[0],a[1],a[0],a[1],f[0],f[1]),i.bezierCurveTo(c[0],c[1],c[0],c[1],r[2][0],r[2][1])}else for(var g=1;g<r.length;g++)i.lineTo(r[g][0],r[g][1])}function E3(i,t,e){var r=i.getTextGuideLine(),n=i.getTextContent();if(!n){r&&i.removeTextGuideLine();return}for(var o=t.normal,s=o.get("show"),a=n.ignore,c=0;c<nS.length;c++){var f=nS[c],g=t[f],v=f==="normal";if(g){var y=g.get("show"),w=v?a:Ui(n.states[f]&&n.states[f].ignore,a);if(w||!Ui(y,s)){var I=v?r:r&&r.states[f];I&&(I.ignore=!0),r&&SR(r,!0,f,g);continue}r||(r=new Us,i.setTextGuideLine(r),!v&&(a||!s)&&SR(r,!0,"normal",t.normal),i.stateProxy&&(r.stateProxy=i.stateProxy)),SR(r,!1,f,g)}}if(r){rr(r.style,e),r.style.fill=null;var E=o.get("showAbove"),D=i.textGuideLineConfig=i.textGuideLineConfig||{};D.showAbove=E||!1,r.buildPath=GTt}}function D3(i,t){t=t||"labelLine";for(var e={normal:i.getModel(t)},r=0;r<fl.length;r++){var n=fl[r];e[n]=i.getModel([n,t])}return e}var q8=["label","labelLine","layoutOption","priority","defaultAttr","marginForce","minMarginForce","marginDefault","suggestIgnore"],HTt=1,rM=2,Ett=HTt|rM;function nM(i,t,e){e=e||Ett,t?i.dirty|=e:i.dirty&=~e}function Dtt(i,t){return t=t||Ett,i.dirty==null||!!(i.dirty&t)}function Ah(i){if(i)return Dtt(i)&&Ptt(i,i.label,i),i}function Ptt(i,t,e){var r=t.getComputedTransform();i.transform=qF(i.transform,r);var n=i.localRect=sS(i.localRect,t.getBoundingRect()),o=t.style,s=o.margin,a=e&&e.marginForce,c=e&&e.minMarginForce,f=e&&e.marginDefault,g=o.__marginType;g==null&&f&&(s=f,g=Jy.textMargin);for(var v=0;v<4;v++)TR[v]=g===Jy.minMargin&&c&&c[v]!=null?c[v]:a&&a[v]!=null?a[v]:s?s[v]:0;g===Jy.textMargin&&xv(n,TR,!1,!1);var y=i.rect=sS(i.rect,n);return r&&y.applyTransform(r),g===Jy.minMargin&&xv(y,TR,!1,!1),i.axisAligned=ZF(r),(i.label=i.label||{}).ignore=t.ignore,nM(i,!1),nM(i,!0,rM),i}var TR=[0,0,0,0];function jTt(i,t,e){return i.transform=qF(i.transform,e),i.localRect=sS(i.localRect,t),i.rect=sS(i.rect,t),e&&i.rect.applyTransform(e),i.axisAligned=ZF(e),i.obb=void 0,(i.label=i.label||{}).ignore=!1,i}function zz(i,t){if(i){i.label.x+=t.x,i.label.y+=t.y,i.label.markRedraw();var e=i.transform;e&&(e[4]+=t.x,e[5]+=t.y);var r=i.rect;r&&(r.x+=t.x,r.y+=t.y);var n=i.obb;n&&n.fromBoundingRect(i.localRect,e)}}function Bz(i,t){for(var e=0;e<q8.length;e++){var r=q8[e];i[r]==null&&(i[r]=t[r])}return Ah(i)}function X8(i){var t=i.obb;return(!t||Dtt(i,rM))&&(i.obb=t=t||new JK,t.fromBoundingRect(i.localRect,i.transform),nM(i,!1,rM)),t}function Fz(i,t,e,r,n){var o=i.length,s=vr[t],a=wo[t];if(o<2)return!1;i.sort(function(at,ut){return at.rect[s]-ut.rect[s]});for(var c=0,f,g=!1,v=0,y=0;y<o;y++){var w=i[y],I=w.rect;f=I[s]-c,f<0&&(I[s]-=f,w.label[s]-=f,g=!0);var E=Math.max(-f,0);v+=E,c=I[s]+I[a]}v>0&&n&&Y(-v/o,0,o);var D=i[0],R=i[o-1],z,N;H(),z<0&&J(-z,.8),N<0&&J(N,.8),H(),q(z,N,1),q(N,z,-1),H(),z<0&&it(-z),N<0&&it(N);function H(){z=D.rect[s]-e,N=r-R.rect[s]-R.rect[a]}function q(at,ut,ft){if(at<0){var _t=Math.min(ut,-at);if(_t>0){Y(_t*ft,0,o);var ct=_t+at;ct<0&&J(-ct*ft,1)}else J(-at*ft,1)}}function Y(at,ut,ft){at!==0&&(g=!0);for(var _t=ut;_t<ft;_t++){var ct=i[_t],Dt=ct.rect;Dt[s]+=at,ct.label[s]+=at}}function J(at,ut){for(var ft=[],_t=0,ct=1;ct<o;ct++){var Dt=i[ct-1].rect,Et=Math.max(i[ct].rect[s]-Dt[s]-Dt[a],0);ft.push(Et),_t+=Et}if(_t){var bt=Math.min(Math.abs(at)/_t,ut);if(at>0)for(var ct=0;ct<o-1;ct++){var Vt=ft[ct]*bt;Y(Vt,0,ct+1)}else for(var ct=o-1;ct>0;ct--){var Vt=ft[ct-1]*bt;Y(-Vt,ct,o)}}}function it(at){var ut=at<0?-1:1;at=Math.abs(at);for(var ft=Math.ceil(at/(o-1)),_t=0;_t<o-1;_t++)if(ut>0?Y(ft,0,_t+1):Y(-ft,o-_t-1,o),at-=ft,at<=0)return}return g}function WTt(i){for(var t=0;t<i.length;t++){var e=i[t],r=e.defaultAttr,n=e.labelLine;e.label.attr("ignore",r.ignore),n&&n.attr("ignore",r.labelGuideIgnore)}}function Ltt(i){var t=[];i.sort(function(f,g){return(g.suggestIgnore?1:0)-(f.suggestIgnore?1:0)||g.priority-f.priority});function e(f){if(!f.ignore){var g=f.ensureState("emphasis");g.ignore==null&&(g.ignore=!1)}f.ignore=!0}for(var r=0;r<i.length;r++){var n=Ah(i[r]);if(!n.label.ignore){for(var o=n.label,s=n.labelLine,a=!1,c=0;c<t.length;c++)if(IE(n,t[c],null,{touchThreshold:.05})){a=!0;break}a?(e(o),s&&e(s)):t.push(n)}}}function IE(i,t,e,r){return!i||!t||i.label&&i.label.ignore||t.label&&t.label.ignore||!i.rect.intersect(t.rect,e,r)?!1:i.axisAligned&&t.axisAligned?!0:X8(i).intersect(X8(t),e,r)}function $Tt(i){if(i){for(var t=[],e=0;e<i.length;e++)t.push(i[e].slice());return t}}function ZTt(i,t){var e=i.label,r=t&&t.getTextGuideLine();return{dataIndex:i.dataIndex,dataType:i.dataType,seriesIndex:i.seriesModel.seriesIndex,text:i.label.style.text,rect:i.hostRect,labelRect:i.rect,align:e.style.align,verticalAlign:e.style.verticalAlign,labelLinePoints:$Tt(r&&r.shape.points)}}var Y8=["align","verticalAlign","width","height","fontSize"],al=new xd,AR=Wr(),qTt=Wr();function WA(i,t,e){for(var r=0;r<e.length;r++){var n=e[r];t[n]!=null&&(i[n]=t[n])}}var $A=["x","y","rotation"],XTt=function(){function i(){this._labelList=[],this._chartViewList=[]}return i.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},i.prototype._addLabel=function(t,e,r,n,o){var s=n.style,a=n.__hostTarget,c=a.textConfig||{},f=n.getComputedTransform(),g=n.getBoundingRect().plain();sr.applyTransform(g,g,f),f?al.setLocalTransform(f):(al.x=al.y=al.rotation=al.originX=al.originY=0,al.scaleX=al.scaleY=1),al.rotation=tu(al.rotation);var v=n.__hostTarget,y;if(v){y=v.getBoundingRect().plain();var w=v.getComputedTransform();sr.applyTransform(y,y,w)}var I=y&&v.getTextGuideLine();this._labelList.push({label:n,labelLine:I,seriesModel:r,dataIndex:t,dataType:e,layoutOptionOrCb:o,layoutOption:null,rect:g,hostRect:y,priority:y?y.width*y.height:0,defaultAttr:{ignore:n.ignore,labelGuideIgnore:I&&I.ignore,x:al.x,y:al.y,scaleX:al.scaleX,scaleY:al.scaleY,rotation:al.rotation,style:{x:s.x,y:s.y,align:s.align,verticalAlign:s.verticalAlign,width:s.width,height:s.height,fontSize:s.fontSize},cursor:n.cursor,attachedPos:c.position,attachedRot:c.rotation}})},i.prototype.addLabelsOfSeries=function(t){var e=this;this._chartViewList.push(t);var r=t.__model,n=r.get("labelLayout");(Xi(n)||on(n).length)&&t.group.traverse(function(o){if(o.ignore)return!0;var s=o.getTextContent(),a=cr(o);s&&!s.disableLabelLayout&&e._addLabel(a.dataIndex,a.dataType,r,s,n)})},i.prototype.updateLayoutConfig=function(t){var e=t.getWidth(),r=t.getHeight();function n(N,H){return function(){Z8(N,H)}}for(var o=0;o<this._labelList.length;o++){var s=this._labelList[o],a=s.label,c=a.__hostTarget,f=s.defaultAttr,g=void 0;Xi(s.layoutOptionOrCb)?g=s.layoutOptionOrCb(ZTt(s,c)):g=s.layoutOptionOrCb,g=g||{},s.layoutOption=g;var v=Math.PI/180;c&&c.setTextConfig({local:!1,position:g.x!=null||g.y!=null?null:f.attachedPos,rotation:g.rotate!=null?g.rotate*v:f.attachedRot,offset:[g.dx||0,g.dy||0]});var y=!1;if(g.x!=null?(a.x=xi(g.x,e),a.setStyle("x",0),y=!0):(a.x=f.x,a.setStyle("x",f.style.x)),g.y!=null?(a.y=xi(g.y,r),a.setStyle("y",0),y=!0):(a.y=f.y,a.setStyle("y",f.style.y)),g.labelLinePoints){var w=c.getTextGuideLine();w&&(w.setShape({points:g.labelLinePoints}),y=!1)}var I=AR(a);I.needsUpdateLabelLine=y,a.rotation=g.rotate!=null?g.rotate*v:f.rotation,a.scaleX=f.scaleX,a.scaleY=f.scaleY;for(var E=0;E<Y8.length;E++){var D=Y8[E];a.setStyle(D,g[D]!=null?g[D]:f.style[D])}if(g.draggable){if(a.draggable=!0,a.cursor="move",c){var R=s.seriesModel;if(s.dataIndex!=null){var z=s.seriesModel.getData(s.dataType);R=z.getItemModel(s.dataIndex)}a.on("drag",n(c,R.getModel("labelLine")))}}else a.off("drag"),a.cursor=f.cursor}},i.prototype.layout=function(t){var e=t.getWidth(),r=t.getHeight(),n=[];pt(this._labelList,function(c){c.defaultAttr.ignore||n.push(Bz({},c))});var o=kn(n,function(c){return c.layoutOption.moveOverlap==="shiftX"}),s=kn(n,function(c){return c.layoutOption.moveOverlap==="shiftY"});Fz(o,0,0,e),Fz(s,1,0,r);var a=kn(n,function(c){return c.layoutOption.hideOverlap});WTt(a),Ltt(a)},i.prototype.processLabelsOverall=function(){var t=this;pt(this._chartViewList,function(e){var r=e.__model,n=e.ignoreLabelLineUpdate,o=r.isAnimationEnabled();e.group.traverse(function(s){if(s.ignore&&!s.forceLabelAnimation)return!0;var a=!n,c=s.getTextContent();!a&&c&&(a=AR(c).needsUpdateLabelLine),a&&t._updateLabelLine(s,r),o&&t._animateLabels(s,r)})})},i.prototype._updateLabelLine=function(t,e){var r=t.getTextContent(),n=cr(t),o=n.dataIndex;if(r&&o!=null){var s=e.getData(n.dataType),a=s.getItemModel(o),c={},f=s.getItemVisual(o,"style");if(f){var g=s.getVisual("drawType");c.stroke=f[g]}var v=a.getModel("labelLine");E3(t,D3(a),c),Z8(t,v)}},i.prototype._animateLabels=function(t,e){var r=t.getTextContent(),n=t.getTextGuideLine();if(r&&(t.forceLabelAnimation||!r.ignore&&!r.invisible&&!t.disableLabelAnimation&&!c0(t))){var o=AR(r),s=o.oldLayout,a=cr(t),c=a.dataIndex,f={x:r.x,y:r.y,rotation:r.rotation},g=e.getData(a.dataType);if(s){r.attr(s);var y=t.prevStates;y&&(Ar(y,"select")>=0&&r.attr(o.oldLayoutSelect),Ar(y,"emphasis")>=0&&r.attr(o.oldLayoutEmphasis)),yn(r,f,e,c)}else if(r.attr(f),!H0(r).valueAnimation){var v=Ui(r.style.opacity,1);r.style.opacity=0,xa(r,{style:{opacity:v}},e,c)}if(o.oldLayout=f,r.states.select){var w=o.oldLayoutSelect={};WA(w,f,$A),WA(w,r.states.select,$A)}if(r.states.emphasis){var I=o.oldLayoutEmphasis={};WA(I,f,$A),WA(I,r.states.emphasis,$A)}uJ(r,c,g,e,e)}if(n&&!n.ignore&&!n.invisible){var o=qTt(n),s=o.oldLayout,E={points:n.shape.points};s?(n.attr({shape:s}),yn(n,{shape:E},e)):(n.setShape(E),n.style.strokePercent=0,xa(n,{style:{strokePercent:1}},e)),o.oldLayout=E}},i}();const YTt=XTt;var IR=Wr();function KTt(i){i.registerUpdateLifecycle("series:beforeupdate",function(t,e,r){var n=IR(e).labelManager;n||(n=IR(e).labelManager=new YTt),n.clearLabels()}),i.registerUpdateLifecycle("series:layoutlabels",function(t,e,r){var n=IR(e).labelManager;r.updatedSeries.forEach(function(o){n.addLabelsOfSeries(e.getViewOfSeriesModel(o))}),n.updateLayoutConfig(e),n.layout(e),n.processLabelsOverall()})}var CR=Math.sin,MR=Math.cos,Rtt=Math.PI,Am=Math.PI*2,JTt=180/Rtt,QTt=function(){function i(){}return i.prototype.reset=function(t){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,t||4)},i.prototype.moveTo=function(t,e){this._add("M",t,e)},i.prototype.lineTo=function(t,e){this._add("L",t,e)},i.prototype.bezierCurveTo=function(t,e,r,n,o,s){this._add("C",t,e,r,n,o,s)},i.prototype.quadraticCurveTo=function(t,e,r,n){this._add("Q",t,e,r,n)},i.prototype.arc=function(t,e,r,n,o,s){this.ellipse(t,e,r,r,0,n,o,s)},i.prototype.ellipse=function(t,e,r,n,o,s,a,c){var f=a-s,g=!c,v=Math.abs(f),y=vp(v-Am)||(g?f>=Am:-f>=Am),w=f>0?f%Am:f%Am+Am,I=!1;y?I=!0:vp(v)?I=!1:I=w>=Rtt==!!g;var E=t+r*MR(s),D=e+n*CR(s);this._start&&this._add("M",E,D);var R=Math.round(o*JTt);if(y){var z=1/this._p,N=(g?1:-1)*(Am-z);this._add("A",r,n,R,1,+g,t+r*MR(s+N),e+n*CR(s+N)),z>.01&&this._add("A",r,n,R,0,+g,E,D)}else{var H=t+r*MR(a),q=e+n*CR(a);this._add("A",r,n,R,+I,+g,H,q)}},i.prototype.rect=function(t,e,r,n){this._add("M",t,e),this._add("l",r,0),this._add("l",0,n),this._add("l",-r,0),this._add("Z")},i.prototype.closePath=function(){this._d.length>0&&this._add("Z")},i.prototype._add=function(t,e,r,n,o,s,a,c,f){for(var g=[],v=this._p,y=1;y<arguments.length;y++){var w=arguments[y];if(isNaN(w)){this._invalid=!0;return}g.push(Math.round(w*v)/v)}this._d.push(t+g.join(" ")),this._start=t==="Z"},i.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},i.prototype.getStr=function(){return this._str},i}();const ktt=QTt;var Rw="none",t2t=Math.round;function e2t(i){var t=i.fill;return t!=null&&t!==Rw}function i2t(i){var t=i.stroke;return t!=null&&t!==Rw}var Nz=["lineCap","miterLimit","lineJoin"],r2t=ti(Nz,function(i){return"stroke-"+i.toLowerCase()});function n2t(i,t,e,r){var n=t.opacity==null?1:t.opacity;if(e instanceof ys){i("opacity",n);return}if(e2t(t)){var o=tS(t.fill);i("fill",o.color);var s=t.fillOpacity!=null?t.fillOpacity*o.opacity*n:o.opacity*n;(r||s<1)&&i("fill-opacity",s)}else i("fill",Rw);if(i2t(t)){var a=tS(t.stroke);i("stroke",a.color);var c=t.strokeNoScale?e.getLineScale():1,f=c?(t.lineWidth||0)/c:0,g=t.strokeOpacity!=null?t.strokeOpacity*a.opacity*n:a.opacity*n,v=t.strokeFirst;if((r||f!==1)&&i("stroke-width",f),(r||v)&&i("paint-order",v?"stroke":"fill"),(r||g<1)&&i("stroke-opacity",g),t.lineDash){var y=_3(e),w=y[0],I=y[1];w&&(I=t2t(I||0),i("stroke-dasharray",w.join(",")),(I||r)&&i("stroke-dashoffset",I))}else r&&i("stroke-dasharray",Rw);for(var E=0;E<Nz.length;E++){var D=Nz[E];if(r||t[D]!==zC[D]){var R=t[D]||zC[D];R&&i(r2t[E],R)}}}else r&&i("stroke",Rw)}var Ott="http://www.w3.org/2000/svg",ztt="http://www.w3.org/1999/xlink",a2t="http://www.w3.org/2000/xmlns/",o2t="http://www.w3.org/XML/1998/namespace",K8="ecmeta_";function Btt(i){return document.createElementNS(Ott,i)}function qo(i,t,e,r,n){return{tag:i,attrs:e||{},children:r,text:n,key:t}}function s2t(i,t){var e=[];if(t)for(var r in t){var n=t[r],o=r;n!==!1&&(n!==!0&&n!=null&&(o+='="'+n+'"'),e.push(o))}return"<"+i+" "+e.join(" ")+">"}function l2t(i){return"</"+i+">"}function P3(i,t){t=t||{};var e=t.newline?`
`:"";function r(n){var o=n.children,s=n.tag,a=n.attrs,c=n.text;return s2t(s,a)+(s!=="style"?Rs(c):c||"")+(o?""+e+ti(o,function(f){return r(f)}).join(e)+e:"")+l2t(s)}return r(i)}function u2t(i,t,e){e=e||{};var r=e.newline?`
`:"",n=" {"+r,o=r+"}",s=ti(on(i),function(c){return c+n+ti(on(i[c]),function(f){return f+":"+i[c][f]+";"}).join(r)+o}).join(r),a=ti(on(t),function(c){return"@keyframes "+c+n+ti(on(t[c]),function(f){return f+n+ti(on(t[c][f]),function(g){var v=t[c][f][g];return g==="d"&&(v='path("'+v+'")'),g+":"+v+";"}).join(r)+o}).join(r)+o}).join(r);return!s&&!a?"":["<![CDATA[",s,a,"]]>"].join(r)}function Vz(i){return{zrId:i,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssStyleCache:{},cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function J8(i,t,e,r){return qo("svg","root",{width:i,height:t,xmlns:Ott,"xmlns:xlink":ztt,version:"1.1",baseProfile:"full",viewBox:r?"0 0 "+i+" "+t:!1},e)}var c2t=0;function Ftt(){return c2t++}var Q8={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Lm="transform-origin";function h2t(i,t,e){var r=Ne({},i.shape);Ne(r,t),i.buildPath(e,r);var n=new ktt;return n.reset(VY(i)),e.rebuildPath(n,1),n.generateStr(),n.getStr()}function d2t(i,t){var e=t.originX,r=t.originY;(e||r)&&(i[Lm]=e+"px "+r+"px")}var f2t={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function Ntt(i,t){var e=t.zrId+"-ani-"+t.cssAnimIdx++;return t.cssAnims[e]=i,e}function p2t(i,t,e){var r=i.shape.paths,n={},o,s;if(pt(r,function(c){var f=Vz(e.zrId);f.animation=!0,CE(c,{},f,!0);var g=f.cssAnims,v=f.cssNodes,y=on(g),w=y.length;if(w){s=y[w-1];var I=g[s];for(var E in I){var D=I[E];n[E]=n[E]||{d:""},n[E].d+=D.d||""}for(var R in v){var z=v[R].animation;z.indexOf(s)>=0&&(o=z)}}}),!!o){t.d=!1;var a=Ntt(n,e);return o.replace(s,a)}}function tW(i){return wi(i)?Q8[i]?"cubic-bezier("+Q8[i]+")":CF(i)?i:"":""}function CE(i,t,e,r){var n=i.animators,o=n.length,s=[];if(i instanceof pE){var a=p2t(i,t,e);if(a)s.push(a);else if(!o)return}else if(!o)return;for(var c={},f=0;f<o;f++){var g=n[f],v=[g.getMaxTime()/1e3+"s"],y=tW(g.getClip().easing),w=g.getDelay();y?v.push(y):v.push("linear"),w&&v.push(w/1e3+"s"),g.getLoop()&&v.push("infinite");var I=v.join(" ");c[I]=c[I]||[I,[]],c[I][1].push(g)}function E(z){var N=z[1],H=N.length,q={},Y={},J={},it="animation-timing-function";function at(Ze,xe,Ke){for(var We=Ze.getTracks(),Ti=Ze.getMaxTime(),Bt=0;Bt<We.length;Bt++){var Zt=We[Bt];if(Zt.needsAnimate()){var ge=Zt.keyframes,$e=Zt.propName;if(Ke&&($e=Ke($e)),$e)for(var He=0;He<ge.length;He++){var qe=ge[He],Ai=Math.round(qe.time/Ti*100)+"%",Ii=tW(qe.easing),_i=qe.rawValue;(wi(_i)||fn(_i))&&(xe[Ai]=xe[Ai]||{},xe[Ai][$e]=qe.rawValue,Ii&&(xe[Ai][it]=Ii))}}}}for(var ut=0;ut<H;ut++){var ft=N[ut],_t=ft.targetName;_t?_t==="shape"&&at(ft,Y):!r&&at(ft,q)}for(var ct in q){var Dt={};RC(Dt,i),Ne(Dt,q[ct]);var Et=UY(Dt),bt=q[ct][it];J[ct]=Et?{transform:Et}:{},d2t(J[ct],Dt),bt&&(J[ct][it]=bt)}var Vt,zt=!0;for(var ct in Y){J[ct]=J[ct]||{};var Jt=!Vt,bt=Y[ct][it];Jt&&(Vt=new Sh);var ce=Vt.len();Vt.reset(),J[ct].d=h2t(i,Y[ct],Vt);var be=Vt.len();if(!Jt&&ce!==be){zt=!1;break}bt&&(J[ct][it]=bt)}if(!zt)for(var ct in J)delete J[ct].d;if(!r)for(var ut=0;ut<H;ut++){var ft=N[ut],_t=ft.targetName;_t==="style"&&at(ft,J,function(We){return f2t[We]})}for(var ve=on(J),ke=!0,ni,ut=1;ut<ve.length;ut++){var bi=ve[ut-1],or=ve[ut];if(J[bi][Lm]!==J[or][Lm]){ke=!1;break}ni=J[bi][Lm]}if(ke&&ni){for(var ct in J)J[ct][Lm]&&delete J[ct][Lm];t[Lm]=ni}if(kn(ve,function(Ze){return on(J[Ze]).length>0}).length){var Ue=Ntt(J,e);return Ue+" "+z[0]+" both"}}for(var D in c){var a=E(c[D]);a&&s.push(a)}if(s.length){var R=e.zrId+"-cls-"+Ftt();e.cssNodes["."+R]={animation:s.join(",")},t.class=R}}function g2t(i,t,e){if(!i.ignore)if(i.isSilent()){var r={"pointer-events":"none"};eW(r,t,e,!0)}else{var n=i.states.emphasis&&i.states.emphasis.style?i.states.emphasis.style:{},o=n.fill;if(!o){var s=i.style&&i.style.fill,a=i.states.select&&i.states.select.style&&i.states.select.style.fill,c=i.currentStates.indexOf("select")>=0&&a||s;c&&(o=NO(c))}var f=n.lineWidth;if(f){var g=!n.strokeNoScale&&i.transform?i.transform[0]:1;f=f/g}var r={cursor:"pointer"};o&&(r.fill=o),n.stroke&&(r.stroke=n.stroke),f&&(r["stroke-width"]=f),eW(r,t,e,!0)}}function eW(i,t,e,r){var n=JSON.stringify(i),o=e.cssStyleCache[n];o||(o=e.zrId+"-cls-"+Ftt(),e.cssStyleCache[n]=o,e.cssNodes["."+o+(r?":hover":"")]=i),t.class=t.class?t.class+" "+o:o}var vS=Math.round;function Vtt(i){return i&&wi(i.src)}function Utt(i){return i&&Xi(i.toDataURL)}function L3(i,t,e,r){n2t(function(n,o){var s=n==="fill"||n==="stroke";s&&NY(o)?Htt(t,i,n,r):s&&MF(o)?jtt(e,i,n,r):i[n]=o,s&&r.ssr&&o==="none"&&(i["pointer-events"]="visible")},t,e,!1),w2t(e,i,r)}function R3(i,t){var e=xyt(t);e&&(e.each(function(r,n){r!=null&&(i[(K8+n).toLowerCase()]=r+"")}),t.isSilent()&&(i[K8+"silent"]="true"))}function iW(i){return vp(i[0]-1)&&vp(i[1])&&vp(i[2])&&vp(i[3]-1)}function m2t(i){return vp(i[4])&&vp(i[5])}function k3(i,t,e){if(t&&!(m2t(t)&&iW(t))){var r=e?10:1e4;i.transform=iW(t)?"translate("+vS(t[4]*r)/r+" "+vS(t[5]*r)/r+")":N_t(t)}}function rW(i,t,e){for(var r=i.points,n=[],o=0;o<r.length;o++)n.push(vS(r[o][0]*e)/e),n.push(vS(r[o][1]*e)/e);t.points=n.join(" ")}function nW(i){return!i.smooth}function v2t(i){var t=ti(i,function(e){return typeof e=="string"?[e,e]:e});return function(e,r,n){for(var o=0;o<t.length;o++){var s=t[o],a=e[s[0]];a!=null&&(r[s[1]]=vS(a*n)/n)}}}var _2t={circle:[v2t(["cx","cy","r"])],polyline:[rW,nW],polygon:[rW,nW]};function y2t(i){for(var t=i.animators,e=0;e<t.length;e++)if(t[e].targetName==="shape")return!0;return!1}function Gtt(i,t){var e=i.style,r=i.shape,n=_2t[i.type],o={},s=t.animation,a="path",c=i.style.strokePercent,f=t.compress&&VY(i)||4;if(n&&!t.willUpdate&&!(n[1]&&!n[1](r))&&!(s&&y2t(i))&&!(c<1)){a=i.type;var g=Math.pow(10,f);n[0](r,o,g)}else{var v=!i.path||i.shapeChanged();i.path||i.createPathProxy();var y=i.path;v&&(y.beginPath(),i.buildPath(y,i.shape),i.pathUpdated());var w=y.getVersion(),I=i,E=I.__svgPathBuilder;(I.__svgPathVersion!==w||!E||c!==I.__svgPathStrokePercent)&&(E||(E=I.__svgPathBuilder=new ktt),E.reset(f),y.rebuildPath(E,c),E.generateStr(),I.__svgPathVersion=w,I.__svgPathStrokePercent=c),o.d=E.getStr()}return k3(o,i.transform),L3(o,e,i,t),R3(o,i),t.animation&&CE(i,o,t),t.emphasis&&g2t(i,o,t),qo(a,i.id+"",o)}function x2t(i,t){var e=i.style,r=e.image;if(r&&!wi(r)&&(Vtt(r)?r=r.src:Utt(r)&&(r=r.toDataURL())),!!r){var n=e.x||0,o=e.y||0,s=e.width,a=e.height,c={href:r,width:s,height:a};return n&&(c.x=n),o&&(c.y=o),k3(c,i.transform),L3(c,e,i,t),R3(c,i),t.animation&&CE(i,c,t),qo("image",i.id+"",c)}}function b2t(i,t){var e=i.style,r=e.text;if(r!=null&&(r+=""),!(!r||isNaN(e.x)||isNaN(e.y))){var n=e.font||Ld,o=e.x||0,s=U_t(e.y||0,FS(n),e.textBaseline),a=V_t[e.textAlign]||e.textAlign,c={"dominant-baseline":"central","text-anchor":a};if(TK(e)){var f="",g=e.fontStyle,v=SK(e.fontSize);if(!parseFloat(v))return;var y=e.fontFamily||fY,w=e.fontWeight;f+="font-size:"+v+";font-family:"+y+";",g&&g!=="normal"&&(f+="font-style:"+g+";"),w&&w!=="normal"&&(f+="font-weight:"+w+";"),c.style=f}else c.style="font: "+n;return r.match(/\s/)&&(c["xml:space"]="preserve"),o&&(c.x=o),s&&(c.y=s),k3(c,i.transform),L3(c,e,i,t),R3(c,i),t.animation&&CE(i,c,t),qo("text",i.id+"",c,void 0,r)}}function aW(i,t){if(i instanceof qr)return Gtt(i,t);if(i instanceof ys)return x2t(i,t);if(i instanceof rS)return b2t(i,t)}function w2t(i,t,e){var r=i.style;if(G_t(r)){var n=H_t(i),o=e.shadowCache,s=o[n];if(!s){var a=i.getGlobalScale(),c=a[0],f=a[1];if(!c||!f)return;var g=r.shadowOffsetX||0,v=r.shadowOffsetY||0,y=r.shadowBlur,w=tS(r.shadowColor),I=w.opacity,E=w.color,D=y/2/c,R=y/2/f,z=D+" "+R;s=e.zrId+"-s"+e.shadowIdx++,e.defs[s]=qo("filter",s,{id:s,x:"-100%",y:"-100%",width:"300%",height:"300%"},[qo("feDropShadow","",{dx:g/c,dy:v/f,stdDeviation:z,"flood-color":E,"flood-opacity":I})]),o[n]=s}t.filter=iE(s)}}function Htt(i,t,e,r){var n=i[e],o,s={gradientUnits:n.global?"userSpaceOnUse":"objectBoundingBox"};if(BY(n))o="linearGradient",s.x1=n.x,s.y1=n.y,s.x2=n.x2,s.y2=n.y2;else if(FY(n))o="radialGradient",s.cx=Ui(n.x,.5),s.cy=Ui(n.y,.5),s.r=Ui(n.r,.5);else return;for(var a=n.colorStops,c=[],f=0,g=a.length;f<g;++f){var v=VO(a[f].offset)*100+"%",y=a[f].color,w=tS(y),I=w.color,E=w.opacity,D={offset:v};D["stop-color"]=I,E<1&&(D["stop-opacity"]=E),c.push(qo("stop",f+"",D))}var R=qo(o,"",s,c),z=P3(R),N=r.gradientCache,H=N[z];H||(H=r.zrId+"-g"+r.gradientIdx++,N[z]=H,s.id=H,r.defs[H]=qo(o,H,s,c)),t[e]=iE(H)}function jtt(i,t,e,r){var n=i.style[e],o=i.getBoundingRect(),s={},a=n.repeat,c=a==="no-repeat",f=a==="repeat-x",g=a==="repeat-y",v;if(zY(n)){var y=n.imageWidth,w=n.imageHeight,I=void 0,E=n.image;if(wi(E)?I=E:Vtt(E)?I=E.src:Utt(E)&&(I=E.toDataURL()),typeof Image>"u"){var D="Image width/height must been given explictly in svg-ssr renderer.";Vs(y,D),Vs(w,D)}else if(y==null||w==null){var R=function(ut,ft){if(ut){var _t=ut.elm,ct=y||ft.width,Dt=w||ft.height;ut.tag==="pattern"&&(f?(Dt=1,ct/=o.width):g&&(ct=1,Dt/=o.height)),ut.attrs.width=ct,ut.attrs.height=Dt,_t&&(_t.setAttribute("width",ct),_t.setAttribute("height",Dt))}},z=OF(I,null,i,function(ut){c||R(Y,ut),R(v,ut)});z&&z.width&&z.height&&(y=y||z.width,w=w||z.height)}v=qo("image","img",{href:I,width:y,height:w}),s.width=y,s.height=w}else n.svgElement&&(v=Yi(n.svgElement),s.width=n.svgWidth,s.height=n.svgHeight);if(v){var N,H;c?N=H=1:f?(H=1,N=s.width/o.width):g?(N=1,H=s.height/o.height):s.patternUnits="userSpaceOnUse",N!=null&&!isNaN(N)&&(s.width=N),H!=null&&!isNaN(H)&&(s.height=H);var q=UY(n);q&&(s.patternTransform=q);var Y=qo("pattern","",s,[v]),J=P3(Y),it=r.patternCache,at=it[J];at||(at=r.zrId+"-p"+r.patternIdx++,it[J]=at,s.id=at,Y=r.defs[at]=qo("pattern",at,s,[v])),t[e]=iE(at)}}function S2t(i,t,e){var r=e.clipPathCache,n=e.defs,o=r[i.id];if(!o){o=e.zrId+"-c"+e.clipPathIdx++;var s={id:o};r[i.id]=o,n[o]=qo("clipPath",o,s,[Gtt(i,e)])}t["clip-path"]=iE(o)}function oW(i){return document.createTextNode(i)}function Nm(i,t,e){i.insertBefore(t,e)}function sW(i,t){i.removeChild(t)}function lW(i,t){i.appendChild(t)}function Wtt(i){return i.parentNode}function $tt(i){return i.nextSibling}function ER(i,t){i.textContent=t}var uW=58,T2t=120,A2t=qo("","");function Uz(i){return i===void 0}function ih(i){return i!==void 0}function I2t(i,t,e){for(var r={},n=t;n<=e;++n){var o=i[n].key;o!==void 0&&(r[o]=n)}return r}function nw(i,t){var e=i.key===t.key,r=i.tag===t.tag;return r&&e}function _S(i){var t,e=i.children,r=i.tag;if(ih(r)){var n=i.elm=Btt(r);if(O3(A2t,i),Ye(e))for(t=0;t<e.length;++t){var o=e[t];o!=null&&lW(n,_S(o))}else ih(i.text)&&!nr(i.text)&&lW(n,oW(i.text))}else i.elm=oW(i.text);return i.elm}function Ztt(i,t,e,r,n){for(;r<=n;++r){var o=e[r];o!=null&&Nm(i,_S(o),t)}}function aM(i,t,e,r){for(;e<=r;++e){var n=t[e];if(n!=null)if(ih(n.tag)){var o=Wtt(n.elm);sW(o,n.elm)}else sW(i,n.elm)}}function O3(i,t){var e,r=t.elm,n=i&&i.attrs||{},o=t.attrs||{};if(n!==o){for(e in o){var s=o[e],a=n[e];a!==s&&(s===!0?r.setAttribute(e,""):s===!1?r.removeAttribute(e):e==="style"?r.style.cssText=s:e.charCodeAt(0)!==T2t?r.setAttribute(e,s):e==="xmlns:xlink"||e==="xmlns"?r.setAttributeNS(a2t,e,s):e.charCodeAt(3)===uW?r.setAttributeNS(o2t,e,s):e.charCodeAt(5)===uW?r.setAttributeNS(ztt,e,s):r.setAttribute(e,s))}for(e in n)e in o||r.removeAttribute(e)}}function C2t(i,t,e){for(var r=0,n=0,o=t.length-1,s=t[0],a=t[o],c=e.length-1,f=e[0],g=e[c],v,y,w,I;r<=o&&n<=c;)s==null?s=t[++r]:a==null?a=t[--o]:f==null?f=e[++n]:g==null?g=e[--c]:nw(s,f)?($y(s,f),s=t[++r],f=e[++n]):nw(a,g)?($y(a,g),a=t[--o],g=e[--c]):nw(s,g)?($y(s,g),Nm(i,s.elm,$tt(a.elm)),s=t[++r],g=e[--c]):nw(a,f)?($y(a,f),Nm(i,a.elm,s.elm),a=t[--o],f=e[++n]):(Uz(v)&&(v=I2t(t,r,o)),y=v[f.key],Uz(y)?Nm(i,_S(f),s.elm):(w=t[y],w.tag!==f.tag?Nm(i,_S(f),s.elm):($y(w,f),t[y]=void 0,Nm(i,w.elm,s.elm))),f=e[++n]);(r<=o||n<=c)&&(r>o?(I=e[c+1]==null?null:e[c+1].elm,Ztt(i,I,e,n,c)):aM(i,t,r,o))}function $y(i,t){var e=t.elm=i.elm,r=i.children,n=t.children;i!==t&&(O3(i,t),Uz(t.text)?ih(r)&&ih(n)?r!==n&&C2t(e,r,n):ih(n)?(ih(i.text)&&ER(e,""),Ztt(e,null,n,0,n.length-1)):ih(r)?aM(e,r,0,r.length-1):ih(i.text)&&ER(e,""):i.text!==t.text&&(ih(r)&&aM(e,r,0,r.length-1),ER(e,t.text)))}function M2t(i,t){if(nw(i,t))$y(i,t);else{var e=i.elm,r=Wtt(e);_S(t),r!==null&&(Nm(r,t.elm,$tt(e)),aM(r,[i],0,0))}return t}var E2t=0,D2t=function(){function i(t,e,r){if(this.type="svg",this.refreshHover=cW(),this.configLayer=cW(),this.storage=e,this._opts=r=Ne({},r),this.root=t,this._id="zr"+E2t++,this._oldVNode=J8(r.width,r.height),t&&!r.ssr){var n=this._viewport=document.createElement("div");n.style.cssText="position:relative;overflow:hidden";var o=this._svgDom=this._oldVNode.elm=Btt("svg");O3(null,this._oldVNode),n.appendChild(o),t.appendChild(n)}this.resize(r.width,r.height)}return i.prototype.getType=function(){return this.type},i.prototype.getViewportRoot=function(){return this._viewport},i.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},i.prototype.getSvgDom=function(){return this._svgDom},i.prototype.refresh=function(){if(this.root){var t=this.renderToVNode({willUpdate:!0});t.attrs.style="position:absolute;left:0;top:0;user-select:none",M2t(this._oldVNode,t),this._oldVNode=t}},i.prototype.renderOneToVNode=function(t){return aW(t,Vz(this._id))},i.prototype.renderToVNode=function(t){t=t||{};var e=this.storage.getDisplayList(!0),r=this._width,n=this._height,o=Vz(this._id);o.animation=t.animation,o.willUpdate=t.willUpdate,o.compress=t.compress,o.emphasis=t.emphasis,o.ssr=this._opts.ssr;var s=[],a=this._bgVNode=P2t(r,n,this._backgroundColor,o);a&&s.push(a);var c=t.compress?null:this._mainVNode=qo("g","main",{},[]);this._paintList(e,o,c?c.children:s),c&&s.push(c);var f=ti(on(o.defs),function(y){return o.defs[y]});if(f.length&&s.push(qo("defs","defs",{},f)),t.animation){var g=u2t(o.cssNodes,o.cssAnims,{newline:!0});if(g){var v=qo("style","stl",{},[],g);s.push(v)}}return J8(r,n,s,t.useViewBox)},i.prototype.renderToString=function(t){return t=t||{},P3(this.renderToVNode({animation:Ui(t.cssAnimation,!0),emphasis:Ui(t.cssEmphasis,!0),willUpdate:!1,compress:!0,useViewBox:Ui(t.useViewBox,!0)}),{newline:!0})},i.prototype.setBackgroundColor=function(t){this._backgroundColor=t},i.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},i.prototype._paintList=function(t,e,r){for(var n=t.length,o=[],s=0,a,c,f=0,g=0;g<n;g++){var v=t[g];if(!v.invisible){var y=v.__clipPaths,w=y&&y.length||0,I=c&&c.length||0,E=void 0;for(E=Math.max(w-1,I-1);E>=0&&!(y&&c&&y[E]===c[E]);E--);for(var D=I-1;D>E;D--)s--,a=o[s-1];for(var R=E+1;R<w;R++){var z={};S2t(y[R],z,e);var N=qo("g","clip-g-"+f++,z,[]);(a?a.children:r).push(N),o[s++]=N,a=N}c=y;var H=aW(v,e);H&&(a?a.children:r).push(H)}}},i.prototype.resize=function(t,e){var r=this._opts,n=this.root,o=this._viewport;if(t!=null&&(r.width=t),e!=null&&(r.height=e),n&&o&&(o.style.display="none",t=t0(n,0,r),e=t0(n,1,r),o.style.display=""),this._width!==t||this._height!==e){if(this._width=t,this._height=e,o){var s=o.style;s.width=t+"px",s.height=e+"px"}if(MF(this._backgroundColor))this.refresh();else{var a=this._svgDom;a&&(a.setAttribute("width",t),a.setAttribute("height",e));var c=this._bgVNode&&this._bgVNode.elm;c&&(c.setAttribute("width",t),c.setAttribute("height",e))}}},i.prototype.getWidth=function(){return this._width},i.prototype.getHeight=function(){return this._height},i.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},i.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},i.prototype.toDataURL=function(t){var e=this.renderToString(),r="data:image/svg+xml;";return t?(e=W_t(e),e&&r+"base64,"+e):r+"charset=UTF-8,"+encodeURIComponent(e)},i}();function cW(i){return function(){}}function P2t(i,t,e,r){var n;if(e&&e!=="none")if(n=qo("rect","bg",{width:i,height:t,x:"0",y:"0"}),NY(e))Htt({fill:e},n.attrs,"fill",r);else if(MF(e))jtt({style:{fill:e},dirty:ho,getBoundingRect:function(){return{width:i,height:t}}},n.attrs,"fill",r);else{var o=tS(e),s=o.color,a=o.opacity;n.attrs.fill=s,a<1&&(n.attrs["fill-opacity"]=a)}return n}const L2t=D2t;function R2t(i){i.registerPainter("svg",L2t)}function hW(i,t,e){var r=vc.createCanvas(),n=t.getWidth(),o=t.getHeight(),s=r.style;return s&&(s.position="absolute",s.left="0",s.top="0",s.width=n+"px",s.height=o+"px",r.setAttribute("data-zr-dom-id",i)),r.width=n*e,r.height=o*e,r}var k2t=function(i){ba(t,i);function t(e,r,n){var o=i.call(this)||this;o.motionBlur=!1,o.lastFrameAlpha=.7,o.dpr=1,o.virtual=!1,o.config={},o.incremental=!1,o.zlevel=0,o.maxRepaintRectCount=5,o.__dirty=!0,o.__firstTimePaint=!0,o.__used=!1,o.__drawIndex=0,o.__startIndex=0,o.__endIndex=0,o.__prevStartIndex=null,o.__prevEndIndex=null;var s;n=n||LC,typeof e=="string"?s=hW(e,r,n):nr(e)&&(s=e,e=s.id),o.id=e,o.dom=s;var a=s.style;return a&&(yY(s),s.onselectstart=function(){return!1},a.padding="0",a.margin="0",a.borderWidth="0"),o.painter=r,o.dpr=n,o}return t.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},t.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},t.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},t.prototype.setUnpainted=function(){this.__firstTimePaint=!0},t.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=hW("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),e!==1&&this.ctxBack.scale(e,e)},t.prototype.createRepaintRects=function(e,r,n,o){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var s=[],a=this.maxRepaintRectCount,c=!1,f=new sr(0,0,0,0);function g(z){if(!(!z.isFinite()||z.isZero()))if(s.length===0){var N=new sr(0,0,0,0);N.copy(z),s.push(N)}else{for(var H=!1,q=1/0,Y=0,J=0;J<s.length;++J){var it=s[J];if(it.intersect(z)){var at=new sr(0,0,0,0);at.copy(it),at.union(z),s[J]=at,H=!0;break}else if(c){f.copy(z),f.union(it);var ut=z.width*z.height,ft=it.width*it.height,_t=f.width*f.height,ct=_t-ut-ft;ct<q&&(q=ct,Y=J)}}if(c&&(s[Y].union(z),H=!0),!H){var N=new sr(0,0,0,0);N.copy(z),s.push(N)}c||(c=s.length>=a)}}for(var v=this.__startIndex;v<this.__endIndex;++v){var y=e[v];if(y){var w=y.shouldBePainted(n,o,!0,!0),I=y.__isRendered&&(y.__dirty&Kl||!w)?y.getPrevPaintRect():null;I&&g(I);var E=w&&(y.__dirty&Kl||!y.__isRendered)?y.getPaintRect():null;E&&g(E)}}for(var v=this.__prevStartIndex;v<this.__prevEndIndex;++v){var y=r[v],w=y&&y.shouldBePainted(n,o,!0,!0);if(y&&(!w||!y.__zr)&&y.__isRendered){var I=y.getPrevPaintRect();I&&g(I)}}var D;do{D=!1;for(var v=0;v<s.length;){if(s[v].isZero()){s.splice(v,1);continue}for(var R=v+1;R<s.length;)s[v].intersect(s[R])?(D=!0,s[v].union(s[R]),s.splice(R,1)):R++;v++}}while(D);return this._paintRects=s,s},t.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},t.prototype.resize=function(e,r){var n=this.dpr,o=this.dom,s=o.style,a=this.domBack;s&&(s.width=e+"px",s.height=r+"px"),o.width=e*n,o.height=r*n,a&&(a.width=e*n,a.height=r*n,n!==1&&this.ctxBack.scale(n,n))},t.prototype.clear=function(e,r,n){var o=this.dom,s=this.ctx,a=o.width,c=o.height;r=r||this.clearColor;var f=this.motionBlur&&!e,g=this.lastFrameAlpha,v=this.dpr,y=this;f&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(o,0,0,a/v,c/v));var w=this.domBack;function I(E,D,R,z){if(s.clearRect(E,D,R,z),r&&r!=="transparent"){var N=void 0;if(KM(r)){var H=r.global||r.__width===R&&r.__height===z;N=H&&r.__canvasGradient||Tz(s,r,{x:0,y:0,width:R,height:z}),r.__canvasGradient=N,r.__width=R,r.__height=z}else Hvt(r)&&(r.scaleX=r.scaleX||v,r.scaleY=r.scaleY||v,N=Az(s,r,{dirty:function(){y.setUnpainted(),y.painter.refresh()}}));s.save(),s.fillStyle=N||r,s.fillRect(E,D,R,z),s.restore()}f&&(s.save(),s.globalAlpha=g,s.drawImage(w,E,D,R,z),s.restore())}!n||f?I(0,0,a,c):n.length&&pt(n,function(E){I(E.x*v,E.y*v,E.width*v,E.height*v)})},t}(Bu);const DR=k2t;var dW=1e5,Im=314159,ZA=.01,O2t=.001;function z2t(i){return i?i.__builtin__?!0:!(typeof i.resize!="function"||typeof i.refresh!="function"):!1}function B2t(i,t){var e=document.createElement("div");return e.style.cssText=["position:relative","width:"+i+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";",e}var F2t=function(){function i(t,e,r,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var o=!t.nodeName||t.nodeName.toUpperCase()==="CANVAS";this._opts=r=Ne({},r||{}),this.dpr=r.devicePixelRatio||LC,this._singleCanvas=o,this.root=t;var s=t.style;s&&(yY(t),t.innerHTML=""),this.storage=e;var a=this._zlevelList;this._prevDisplayList=[];var c=this._layers;if(o){var g=t,v=g.width,y=g.height;r.width!=null&&(v=r.width),r.height!=null&&(y=r.height),this.dpr=r.devicePixelRatio||1,g.width=v*this.dpr,g.height=y*this.dpr,this._width=v,this._height=y;var w=new DR(g,this,this.dpr);w.__builtin__=!0,w.initContext(),c[Im]=w,w.zlevel=Im,a.push(Im),this._domRoot=t}else{this._width=t0(t,0,r),this._height=t0(t,1,r);var f=this._domRoot=B2t(this._width,this._height);t.appendChild(f)}}return i.prototype.getType=function(){return"canvas"},i.prototype.isSingleCanvas=function(){return this._singleCanvas},i.prototype.getViewportRoot=function(){return this._domRoot},i.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},i.prototype.refresh=function(t){var e=this.storage.getDisplayList(!0),r=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,r,t,this._redrawId);for(var o=0;o<n.length;o++){var s=n[o],a=this._layers[s];if(!a.__builtin__&&a.refresh){var c=o===0?this._backgroundColor:null;a.refresh(c)}}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},i.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},i.prototype._paintHoverList=function(t){var e=t.length,r=this._hoverlayer;if(r&&r.clear(),!!e){for(var n={inHover:!0,viewWidth:this._width,viewHeight:this._height},o,s=0;s<e;s++){var a=t[s];a.__inHover&&(r||(r=this._hoverlayer=this.getLayer(dW)),o||(o=r.ctx,o.save()),Km(o,a,n,s===e-1))}o&&o.restore()}},i.prototype.getHoverLayer=function(){return this.getLayer(dW)},i.prototype.paintOne=function(t,e){AQ(t,e)},i.prototype._paintList=function(t,e,r,n){if(this._redrawId===n){r=r||!1,this._updateLayerStatus(t);var o=this._doPaintList(t,e,r),s=o.finished,a=o.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),a&&this._paintHoverList(t),s)this.eachLayer(function(f){f.afterBrush&&f.afterBrush()});else{var c=this;kO(function(){c._paintList(t,e,r,n)})}}},i.prototype._compositeManually=function(){var t=this.getLayer(Im).ctx,e=this._domRoot.width,r=this._domRoot.height;t.clearRect(0,0,e,r),this.eachBuiltinLayer(function(n){n.virtual&&t.drawImage(n.dom,0,0,e,r)})},i.prototype._doPaintList=function(t,e,r){for(var n=this,o=[],s=this._opts.useDirtyRect,a=0;a<this._zlevelList.length;a++){var c=this._zlevelList[a],f=this._layers[c];f.__builtin__&&f!==this._hoverlayer&&(f.__dirty||r)&&o.push(f)}for(var g=!0,v=!1,y=function(E){var D=o[E],R=D.ctx,z=s&&D.createRepaintRects(t,e,w._width,w._height),N=r?D.__startIndex:D.__drawIndex,H=!r&&D.incremental&&Date.now,q=H&&Date.now(),Y=D.zlevel===w._zlevelList[0]?w._backgroundColor:null;if(D.__startIndex===D.__endIndex)D.clear(!1,Y,z);else if(N===D.__startIndex){var J=t[N];(!J.incremental||!J.notClear||r)&&D.clear(!1,Y,z)}N===-1&&(console.error("For some unknown reason. drawIndex is -1"),N=D.__startIndex);var it,at=function(ct){var Dt={inHover:!1,allClipped:!1,prevEl:null,viewWidth:n._width,viewHeight:n._height};for(it=N;it<D.__endIndex;it++){var Et=t[it];if(Et.__inHover&&(v=!0),n._doPaintEl(Et,D,s,ct,Dt,it===D.__endIndex-1),H){var bt=Date.now()-q;if(bt>15)break}}Dt.prevElClipPaths&&R.restore()};if(z)if(z.length===0)it=D.__endIndex;else for(var ut=w.dpr,ft=0;ft<z.length;++ft){var _t=z[ft];R.save(),R.beginPath(),R.rect(_t.x*ut,_t.y*ut,_t.width*ut,_t.height*ut),R.clip(),at(_t),R.restore()}else R.save(),at(),R.restore();D.__drawIndex=it,D.__drawIndex<D.__endIndex&&(g=!1)},w=this,I=0;I<o.length;I++)y(I);return Sn.wxa&&pt(this._layers,function(E){E&&E.ctx&&E.ctx.draw&&E.ctx.draw()}),{finished:g,needsRefreshHover:v}},i.prototype._doPaintEl=function(t,e,r,n,o,s){var a=e.ctx;if(r){var c=t.getPaintRect();(!n||c&&c.intersect(n))&&(Km(a,t,o,s),t.setPrevPaintRect(c))}else Km(a,t,o,s)},i.prototype.getLayer=function(t,e){this._singleCanvas&&!this._needsManuallyCompositing&&(t=Im);var r=this._layers[t];return r||(r=new DR("zr_"+t,this,this.dpr),r.zlevel=t,r.__builtin__=!0,this._layerConfig[t]?Er(r,this._layerConfig[t],!0):this._layerConfig[t-ZA]&&Er(r,this._layerConfig[t-ZA],!0),e&&(r.virtual=e),this.insertLayer(t,r),r.initContext()),r},i.prototype.insertLayer=function(t,e){var r=this._layers,n=this._zlevelList,o=n.length,s=this._domRoot,a=null,c=-1;if(!r[t]&&z2t(e)){if(o>0&&t>n[0]){for(c=0;c<o-1&&!(n[c]<t&&n[c+1]>t);c++);a=r[n[c]]}if(n.splice(c+1,0,t),r[t]=e,!e.virtual)if(a){var f=a.dom;f.nextSibling?s.insertBefore(e.dom,f.nextSibling):s.appendChild(e.dom)}else s.firstChild?s.insertBefore(e.dom,s.firstChild):s.appendChild(e.dom);e.painter||(e.painter=this)}},i.prototype.eachLayer=function(t,e){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n];t.call(e,this._layers[o],o)}},i.prototype.eachBuiltinLayer=function(t,e){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],s=this._layers[o];s.__builtin__&&t.call(e,s,o)}},i.prototype.eachOtherLayer=function(t,e){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],s=this._layers[o];s.__builtin__||t.call(e,s,o)}},i.prototype.getLayers=function(){return this._layers},i.prototype._updateLayerStatus=function(t){this.eachBuiltinLayer(function(v,y){v.__dirty=v.__used=!1});function e(v){o&&(o.__endIndex!==v&&(o.__dirty=!0),o.__endIndex=v)}if(this._singleCanvas)for(var r=1;r<t.length;r++){var n=t[r];if(n.zlevel!==t[r-1].zlevel||n.incremental){this._needsManuallyCompositing=!0;break}}var o=null,s=0,a,c;for(c=0;c<t.length;c++){var n=t[c],f=n.zlevel,g=void 0;a!==f&&(a=f,s=0),n.incremental?(g=this.getLayer(f+O2t,this._needsManuallyCompositing),g.incremental=!0,s=1):g=this.getLayer(f+(s>0?ZA:0),this._needsManuallyCompositing),g.__builtin__||xF("ZLevel "+f+" has been used by unkown layer "+g.id),g!==o&&(g.__used=!0,g.__startIndex!==c&&(g.__dirty=!0),g.__startIndex=c,g.incremental?g.__drawIndex=-1:g.__drawIndex=c,e(c),o=g),n.__dirty&Kl&&!n.__inHover&&(g.__dirty=!0,g.incremental&&g.__drawIndex<0&&(g.__drawIndex=c))}e(c),this.eachBuiltinLayer(function(v,y){!v.__used&&v.getElementCount()>0&&(v.__dirty=!0,v.__startIndex=v.__endIndex=v.__drawIndex=0),v.__dirty&&v.__drawIndex<0&&(v.__drawIndex=v.__startIndex)})},i.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},i.prototype._clearLayer=function(t){t.clear()},i.prototype.setBackgroundColor=function(t){this._backgroundColor=t,pt(this._layers,function(e){e.setUnpainted()})},i.prototype.configLayer=function(t,e){if(e){var r=this._layerConfig;r[t]?Er(r[t],e,!0):r[t]=e;for(var n=0;n<this._zlevelList.length;n++){var o=this._zlevelList[n];if(o===t||o===t+ZA){var s=this._layers[o];Er(s,r[t],!0)}}}},i.prototype.delLayer=function(t){var e=this._layers,r=this._zlevelList,n=e[t];n&&(n.dom.parentNode.removeChild(n.dom),delete e[t],r.splice(Ar(r,t),1))},i.prototype.resize=function(t,e){if(this._domRoot.style){var r=this._domRoot;r.style.display="none";var n=this._opts,o=this.root;if(t!=null&&(n.width=t),e!=null&&(n.height=e),t=t0(o,0,n),e=t0(o,1,n),r.style.display="",this._width!==t||e!==this._height){r.style.width=t+"px",r.style.height=e+"px";for(var s in this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].resize(t,e);this.refresh(!0)}this._width=t,this._height=e}else{if(t==null||e==null)return;this._width=t,this._height=e,this.getLayer(Im).resize(t,e)}return this},i.prototype.clearLayer=function(t){var e=this._layers[t];e&&e.clear()},i.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},i.prototype.getRenderedCanvas=function(t){if(t=t||{},this._singleCanvas&&!this._compositeManually)return this._layers[Im].dom;var e=new DR("image",this,t.pixelRatio||this.dpr);e.initContext(),e.clear(!1,t.backgroundColor||this._backgroundColor);var r=e.ctx;if(t.pixelRatio<=this.dpr){this.refresh();var n=e.dom.width,o=e.dom.height;this.eachLayer(function(v){v.__builtin__?r.drawImage(v.dom,0,0,n,o):v.renderToCanvas&&(r.save(),v.renderToCanvas(r),r.restore())})}else for(var s={inHover:!1,viewWidth:this._width,viewHeight:this._height},a=this.storage.getDisplayList(!0),c=0,f=a.length;c<f;c++){var g=a[c];Km(r,g,s,c===f-1)}return e.dom},i.prototype.getWidth=function(){return this._width},i.prototype.getHeight=function(){return this._height},i}();const N2t=F2t;function V2t(i){i.registerPainter("canvas",N2t)}var U2t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e){return $d(null,this,{useEncodeDefaulter:!0})},t.prototype.getLegendIcon=function(e){var r=new Ki,n=To("line",0,e.itemHeight/2,e.itemWidth,0,e.lineStyle.stroke,!1);r.add(n),n.setStyle(e.lineStyle);var o=this.getData().getVisual("symbol"),s=this.getData().getVisual("symbolRotate"),a=o==="none"?"circle":o,c=e.itemHeight*.8,f=To(a,(e.itemWidth-c)/2,(e.itemHeight-c)/2,c,c,e.itemStyle.fill);r.add(f),f.setStyle(e.itemStyle);var g=e.iconRotate==="inherit"?s:e.iconRotate||0;return f.rotation=g*Math.PI/180,f.setOrigin([e.itemWidth/2,e.itemHeight/2]),a.indexOf("empty")>-1&&(f.style.stroke=f.style.fill,f.style.fill=ye.color.neutral00,f.style.lineWidth=2),r},t.type="series.line",t.dependencies=["grid","polar"],t.defaultOption={z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:6,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0,universalTransition:{divideShape:"clone"},triggerLineEvent:!1},t}(Ea);const G2t=U2t;function M0(i,t){var e=i.mapDimensionsAll("defaultedLabel"),r=e.length;if(r===1){var n=T0(i,t,e[0]);return n!=null?n+"":null}else if(r){for(var o=[],s=0;s<e.length;s++)o.push(T0(i,t,e[s]));return o.join(" ")}}function qtt(i,t){var e=i.mapDimensionsAll("defaultedLabel");if(!Ye(t))return t+"";for(var r=[],n=0;n<e.length;n++){var o=i.getDimensionIndex(e[n]);o>=0&&r.push(t[o])}return r.join(" ")}var H2t=function(i){Se(t,i);function t(e,r,n,o){var s=i.call(this)||this;return s.updateData(e,r,n,o),s}return t.prototype._createSymbol=function(e,r,n,o,s,a){this.removeAll();var c=To(e,-1,-1,2,2,null,a);c.attr({z2:Ui(s,100),culling:!0,scaleX:o[0]/2,scaleY:o[1]/2}),c.drift=j2t,this._symbolType=e,this.add(c)},t.prototype.stopSymbolAnimation=function(e){this.childAt(0).stopAnimation(null,e)},t.prototype.getSymbolType=function(){return this._symbolType},t.prototype.getSymbolPath=function(){return this.childAt(0)},t.prototype.highlight=function(){Od(this.childAt(0))},t.prototype.downplay=function(){zd(this.childAt(0))},t.prototype.setZ=function(e,r){var n=this.childAt(0);n.zlevel=e,n.z=r},t.prototype.setDraggable=function(e,r){var n=this.childAt(0);n.draggable=e,n.cursor=!r&&e?"move":n.cursor},t.prototype.updateData=function(e,r,n,o){this.silent=!1;var s=e.getItemVisual(r,"symbol")||"circle",a=e.hostModel,c=t.getSymbolSize(e,r),f=t.getSymbolZ2(e,r),g=s!==this._symbolType,v=o&&o.disableAnimation;if(g){var y=e.getItemVisual(r,"symbolKeepAspect");this._createSymbol(s,e,r,c,f,y)}else{var w=this.childAt(0);w.silent=!1;var I={scaleX:c[0]/2,scaleY:c[1]/2};v?w.attr(I):yn(w,I,a,r),zu(w)}if(this._updateCommon(e,r,c,n,o),g){var w=this.childAt(0);if(!v){var I={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:w.style.opacity}};w.scaleX=w.scaleY=0,w.style.opacity=0,xa(w,I,a,r)}}v&&this.childAt(0).stopAnimation("leave")},t.prototype._updateCommon=function(e,r,n,o,s){var a=this.childAt(0),c=e.hostModel,f,g,v,y,w,I,E,D,R;if(o&&(f=o.emphasisItemStyle,g=o.blurItemStyle,v=o.selectItemStyle,y=o.focus,w=o.blurScope,E=o.labelStatesModels,D=o.hoverScale,R=o.cursorStyle,I=o.emphasisDisabled),!o||e.hasItemOption){var z=o&&o.itemModel?o.itemModel:e.getItemModel(r),N=z.getModel("emphasis");f=N.getModel("itemStyle").getItemStyle(),v=z.getModel(["select","itemStyle"]).getItemStyle(),g=z.getModel(["blur","itemStyle"]).getItemStyle(),y=N.get("focus"),w=N.get("blurScope"),I=N.get("disabled"),E=Fo(z),D=N.getShallow("scale"),R=z.getShallow("cursor")}var H=e.getItemVisual(r,"symbolRotate");a.attr("rotation",(H||0)*Math.PI/180||0);var q=Rv(e.getItemVisual(r,"symbolOffset"),n);q&&(a.x=q[0],a.y=q[1]),R&&a.attr("cursor",R);var Y=e.getItemVisual(r,"style"),J=Y.fill;if(a instanceof ys){var it=a.style;a.useStyle(Ne({image:it.image,x:it.x,y:it.y,width:it.width,height:it.height},Y))}else a.__isEmptyBrush?a.useStyle(Ne({},Y)):a.useStyle(Y),a.style.decal=null,a.setColor(J,s&&s.symbolInnerColor),a.style.strokeNoScale=!0;var at=e.getItemVisual(r,"liftZ"),ut=this._z2;at!=null?ut==null&&(this._z2=a.z2,a.z2+=at):ut!=null&&(a.z2=ut,this._z2=null);var ft=s&&s.useNameLabel;Xo(a,E,{labelFetcher:c,labelDataIndex:r,defaultText:_t,inheritColor:J,defaultOpacity:Y.opacity});function _t(Et){return ft?e.getName(Et):M0(e,Et)}this._sizeX=n[0]/2,this._sizeY=n[1]/2;var ct=a.ensureState("emphasis");ct.style=f,a.ensureState("select").style=v,a.ensureState("blur").style=g;var Dt=D==null||D===!0?Math.max(1.1,3/this._sizeY):isFinite(D)&&D>0?+D:1;ct.scaleX=this._sizeX*Dt,ct.scaleY=this._sizeY*Dt,this.setSymbolScale(1),Ca(this,y,w,I)},t.prototype.setSymbolScale=function(e){this.scaleX=this.scaleY=e},t.prototype.fadeOut=function(e,r,n){var o=this.childAt(0),s=cr(this).dataIndex,a=n&&n.animation;if(this.silent=o.silent=!0,n&&n.fadeLabel){var c=o.getTextContent();c&&Op(c,{style:{opacity:0}},r,{dataIndex:s,removeOpt:a,cb:function(){o.removeTextContent()}})}else o.removeTextContent();Op(o,{style:{opacity:0},scaleX:0,scaleY:0},r,{dataIndex:s,cb:e,removeOpt:a})},t.getSymbolSize=function(e,r){return q0(e.getItemVisual(r,"symbolSize"))},t.getSymbolZ2=function(e,r){return e.getItemVisual(r,"z2")},t}(Ki);function j2t(i,t){this.parent.drift(i,t)}const qS=H2t;function PR(i,t,e,r){return t&&!isNaN(t[0])&&!isNaN(t[1])&&!(r.isIgnore&&r.isIgnore(e))&&!(r.clipShape&&!r.clipShape.contain(t[0],t[1]))&&i.getItemVisual(e,"symbol")!=="none"}function fW(i){return i!=null&&!nr(i)&&(i={isIgnore:i}),i||{}}function pW(i){var t=i.hostModel,e=t.getModel("emphasis");return{emphasisItemStyle:e.getModel("itemStyle").getItemStyle(),blurItemStyle:t.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:t.getModel(["select","itemStyle"]).getItemStyle(),focus:e.get("focus"),blurScope:e.get("blurScope"),emphasisDisabled:e.get("disabled"),hoverScale:e.get("scale"),labelStatesModels:Fo(t),cursorStyle:t.get("cursor")}}var W2t=function(){function i(t){this.group=new Ki,this._SymbolCtor=t||qS}return i.prototype.updateData=function(t,e){this._progressiveEls=null,e=fW(e);var r=this.group,n=t.hostModel,o=this._data,s=this._SymbolCtor,a=e.disableAnimation,c=pW(t),f={disableAnimation:a},g=e.getSymbolPoint||function(v){return t.getItemLayout(v)};o||r.removeAll(),t.diff(o).add(function(v){var y=g(v);if(PR(t,y,v,e)){var w=new s(t,v,c,f);w.setPosition(y),t.setItemGraphicEl(v,w),r.add(w)}}).update(function(v,y){var w=o.getItemGraphicEl(y),I=g(v);if(!PR(t,I,v,e)){r.remove(w);return}var E=t.getItemVisual(v,"symbol")||"circle",D=w&&w.getSymbolType&&w.getSymbolType();if(!w||D&&D!==E)r.remove(w),w=new s(t,v,c,f),w.setPosition(I);else{w.updateData(t,v,c,f);var R={x:I[0],y:I[1]};a?w.attr(R):yn(w,R,n)}r.add(w),t.setItemGraphicEl(v,w)}).remove(function(v){var y=o.getItemGraphicEl(v);y&&y.fadeOut(function(){r.remove(y)},n)}).execute(),this._getSymbolPoint=g,this._data=t},i.prototype.updateLayout=function(){var t=this,e=this._data;e&&e.eachItemGraphicEl(function(r,n){var o=t._getSymbolPoint(n);r.setPosition(o),r.markRedraw()})},i.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=pW(t),this._data=null,this.group.removeAll()},i.prototype.incrementalUpdate=function(t,e,r){this._progressiveEls=[],r=fW(r);function n(c){c.isGroup||(c.incremental=!0,c.ensureState("emphasis").hoverLayer=!0)}for(var o=t.start;o<t.end;o++){var s=e.getItemLayout(o);if(PR(e,s,o,r)){var a=new this._SymbolCtor(e,o,this._seriesScope);a.traverse(n),a.setPosition(s),this.group.add(a),e.setItemGraphicEl(o,a),this._progressiveEls.push(a)}}},i.prototype.eachRendered=function(t){$p(this._progressiveEls||this.group,t)},i.prototype.remove=function(t){var e=this.group,r=this._data;r&&t?r.eachItemGraphicEl(function(n){n.fadeOut(function(){e.remove(n)},r.hostModel)}):e.removeAll()},i}();const XS=W2t;function Xtt(i,t,e){var r=i.getBaseAxis(),n=i.getOtherAxis(r),o=$2t(n,e),s=r.dim,a=n.dim,c=t.mapDimension(a),f=t.mapDimension(s),g=a==="x"||a==="radius"?1:0,v=ti(i.dimensions,function(I){return t.mapDimension(I)}),y=!1,w=t.getCalculationInfo("stackResultDimension");return zp(t,v[0])&&(y=!0,v[0]=w),zp(t,v[1])&&(y=!0,v[1]=w),{dataDimsForPoint:v,valueStart:o,valueAxisDim:a,baseAxisDim:s,stacked:!!y,valueDim:c,baseDim:f,baseDataOffset:g,stackedOverDimension:t.getCalculationInfo("stackedOverDimension")}}function $2t(i,t){var e=0,r=i.scale.getExtent();return t==="start"?e=r[0]:t==="end"?e=r[1]:fn(t)&&!isNaN(t)?e=t:r[0]>0?e=r[0]:r[1]<0&&(e=r[1]),e}function Ytt(i,t,e,r){var n=NaN;i.stacked&&(n=e.get(e.getCalculationInfo("stackedOverDimension"),r)),isNaN(n)&&(n=i.valueStart);var o=i.baseDataOffset,s=[];return s[o]=e.get(i.baseDim,r),s[1-o]=n,t.dataToPoint(s)}function Z2t(i,t){var e=[];return t.diff(i).add(function(r){e.push({cmd:"+",idx:r})}).update(function(r,n){e.push({cmd:"=",idx:n,idx1:r})}).remove(function(r){e.push({cmd:"-",idx:r})}).execute(),e}function q2t(i,t,e,r,n,o,s,a){for(var c=Z2t(i,t),f=[],g=[],v=[],y=[],w=[],I=[],E=[],D=Xtt(n,t,s),R=i.getLayout("points")||[],z=t.getLayout("points")||[],N=0;N<c.length;N++){var H=c[N],q=!0,Y=void 0,J=void 0;switch(H.cmd){case"=":Y=H.idx*2,J=H.idx1*2;var it=R[Y],at=R[Y+1],ut=z[J],ft=z[J+1];(isNaN(it)||isNaN(at))&&(it=ut,at=ft),f.push(it,at),g.push(ut,ft),v.push(e[Y],e[Y+1]),y.push(r[J],r[J+1]),E.push(t.getRawIndex(H.idx1));break;case"+":var _t=H.idx,ct=D.dataDimsForPoint,Dt=n.dataToPoint([t.get(ct[0],_t),t.get(ct[1],_t)]);J=_t*2,f.push(Dt[0],Dt[1]),g.push(z[J],z[J+1]);var Et=Ytt(D,n,t,_t);v.push(Et[0],Et[1]),y.push(r[J],r[J+1]),E.push(t.getRawIndex(_t));break;case"-":q=!1}q&&(w.push(H),I.push(I.length))}I.sort(function(bi,or){return E[bi]-E[or]});for(var bt=f.length,Vt=ch(bt),zt=ch(bt),Jt=ch(bt),ce=ch(bt),be=[],N=0;N<I.length;N++){var ve=I[N],ke=N*2,ni=ve*2;Vt[ke]=f[ni],Vt[ke+1]=f[ni+1],zt[ke]=g[ni],zt[ke+1]=g[ni+1],Jt[ke]=v[ni],Jt[ke+1]=v[ni+1],ce[ke]=y[ni],ce[ke+1]=y[ni+1],be[N]=w[ve]}return{current:Vt,next:zt,stackedOnCurrent:Jt,stackedOnNext:ce,status:be}}var Zf=Math.min,qf=Math.max;function hv(i,t){return isNaN(i)||isNaN(t)}function Gz(i,t,e,r,n,o,s,a,c){for(var f,g,v,y,w,I,E=e,D=0;D<r;D++){var R=t[E*2],z=t[E*2+1];if(E>=n||E<0)break;if(hv(R,z)){if(c){E+=o;continue}break}if(E===e)i[o>0?"moveTo":"lineTo"](R,z),v=R,y=z;else{var N=R-f,H=z-g;if(N*N+H*H<.5){E+=o;continue}if(s>0){for(var q=E+o,Y=t[q*2],J=t[q*2+1];Y===R&&J===z&&D<r;)D++,q+=o,E+=o,Y=t[q*2],J=t[q*2+1],R=t[E*2],z=t[E*2+1],N=R-f,H=z-g;var it=D+1;if(c)for(;hv(Y,J)&&it<r;)it++,q+=o,Y=t[q*2],J=t[q*2+1];var at=.5,ut=0,ft=0,_t=void 0,ct=void 0;if(it>=r||hv(Y,J))w=R,I=z;else{ut=Y-f,ft=J-g;var Dt=R-f,Et=Y-R,bt=z-g,Vt=J-z,zt=void 0,Jt=void 0;if(a==="x"){zt=Math.abs(Dt),Jt=Math.abs(Et);var ce=ut>0?1:-1;w=R-ce*zt*s,I=z,_t=R+ce*Jt*s,ct=z}else if(a==="y"){zt=Math.abs(bt),Jt=Math.abs(Vt);var be=ft>0?1:-1;w=R,I=z-be*zt*s,_t=R,ct=z+be*Jt*s}else zt=Math.sqrt(Dt*Dt+bt*bt),Jt=Math.sqrt(Et*Et+Vt*Vt),at=Jt/(Jt+zt),w=R-ut*s*(1-at),I=z-ft*s*(1-at),_t=R+ut*s*at,ct=z+ft*s*at,_t=Zf(_t,qf(Y,R)),ct=Zf(ct,qf(J,z)),_t=qf(_t,Zf(Y,R)),ct=qf(ct,Zf(J,z)),ut=_t-R,ft=ct-z,w=R-ut*zt/Jt,I=z-ft*zt/Jt,w=Zf(w,qf(f,R)),I=Zf(I,qf(g,z)),w=qf(w,Zf(f,R)),I=qf(I,Zf(g,z)),ut=R-w,ft=z-I,_t=R+ut*Jt/zt,ct=z+ft*Jt/zt}i.bezierCurveTo(v,y,w,I,R,z),v=_t,y=ct}else i.lineTo(R,z)}f=R,g=z,E+=o}return D}var Ktt=function(){function i(){this.smooth=0,this.smoothConstraint=!0}return i}(),X2t=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="ec-polyline",r}return t.prototype.getDefaultStyle=function(){return{stroke:ye.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new Ktt},t.prototype.buildPath=function(e,r){var n=r.points,o=0,s=n.length/2;if(r.connectNulls){for(;s>0&&hv(n[s*2-2],n[s*2-1]);s--);for(;o<s&&hv(n[o*2],n[o*2+1]);o++);}for(;o<s;)o+=Gz(e,n,o,s,s,1,r.smooth,r.smoothMonotone,r.connectNulls)+1},t.prototype.getPointOn=function(e,r){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var n=this.path,o=n.data,s=Sh.CMD,a,c,f=r==="x",g=[],v=0;v<o.length;){var y=o[v++],w=void 0,I=void 0,E=void 0,D=void 0,R=void 0,z=void 0,N=void 0;switch(y){case s.M:a=o[v++],c=o[v++];break;case s.L:if(w=o[v++],I=o[v++],N=f?(e-a)/(w-a):(e-c)/(I-c),N<=1&&N>=0){var H=f?(I-c)*N+c:(w-a)*N+a;return f?[e,H]:[H,e]}a=w,c=I;break;case s.C:w=o[v++],I=o[v++],E=o[v++],D=o[v++],R=o[v++],z=o[v++];var q=f?MC(a,w,E,R,e,g):MC(c,I,D,z,e,g);if(q>0)for(var Y=0;Y<q;Y++){var J=g[Y];if(J<=1&&J>=0){var H=f?Wo(c,I,D,z,J):Wo(a,w,E,R,J);return f?[e,H]:[H,e]}}a=R,c=z;break}}},t}(qr),Y2t=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Ktt),Jtt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="ec-polygon",r}return t.prototype.getDefaultShape=function(){return new Y2t},t.prototype.buildPath=function(e,r){var n=r.points,o=r.stackedOnPoints,s=0,a=n.length/2,c=r.smoothMonotone;if(r.connectNulls){for(;a>0&&hv(n[a*2-2],n[a*2-1]);a--);for(;s<a&&hv(n[s*2],n[s*2+1]);s++);}for(;s<a;){var f=Gz(e,n,s,a,a,1,r.smooth,c,r.connectNulls);Gz(e,o,s+f-1,f,a,-1,r.stackedOnSmooth,c,r.connectNulls),s+=f+1,e.closePath()}},t}(qr);function Qtt(i,t,e,r,n){var o=i.getArea(),s=o.x,a=o.y,c=o.width,f=o.height,g=e.get(["lineStyle","width"])||0;s-=g/2,a-=g/2,c+=g,f+=g,c=Math.ceil(c),s!==Math.floor(s)&&(s=Math.floor(s),c++);var v=new jr({shape:{x:s,y:a,width:c,height:f}});if(t){var y=i.getBaseAxis(),w=y.isHorizontal(),I=y.inverse;w?(I&&(v.shape.x+=c),v.shape.width=0):(I||(v.shape.y+=f),v.shape.height=0);var E=Xi(n)?function(D){n(D,v)}:null;xa(v,{shape:{width:c,height:f,x:s,y:a}},e,null,r,E)}return v}function tet(i,t,e){var r=i.getArea(),n=xo(r.r0,1),o=xo(r.r,1),s=new pl({shape:{cx:xo(i.cx,1),cy:xo(i.cy,1),r0:n,r:o,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}});if(t){var a=i.getBaseAxis().dim==="angle";a?s.shape.endAngle=r.startAngle:s.shape.r=n,xa(s,{shape:{endAngle:r.endAngle,r:o}},e)}return s}function YS(i,t,e,r,n){if(i){if(i.type==="polar")return tet(i,t,e);if(i.type==="cartesian2d")return Qtt(i,t,e,r,n)}else return null;return null}function Fp(i,t){return i.type===t}function gW(i,t){if(i.length===t.length){for(var e=0;e<i.length;e++)if(i[e]!==t[e])return;return!0}}function mW(i){for(var t=1/0,e=1/0,r=-1/0,n=-1/0,o=0;o<i.length;){var s=i[o++],a=i[o++];isNaN(s)||(t=Math.min(s,t),r=Math.max(s,r)),isNaN(a)||(e=Math.min(a,e),n=Math.max(a,n))}return[[t,e],[r,n]]}function vW(i,t){var e=mW(i),r=e[0],n=e[1],o=mW(t),s=o[0],a=o[1];return Math.max(Math.abs(r[0]-s[0]),Math.abs(r[1]-s[1]),Math.abs(n[0]-a[0]),Math.abs(n[1]-a[1]))}function _W(i){return fn(i)?i:i?.5:0}function K2t(i,t,e){if(!e.valueDim)return[];for(var r=t.count(),n=ch(r*2),o=0;o<r;o++){var s=Ytt(e,i,t,o);n[o*2]=s[0],n[o*2+1]=s[1]}return n}function Xf(i,t,e,r,n){var o=e.getBaseAxis(),s=o.dim==="x"||o.dim==="radius"?0:1,a=[],c=0,f=[],g=[],v=[],y=[];if(n){for(c=0;c<i.length;c+=2){var w=t||i;!isNaN(w[c])&&!isNaN(w[c+1])&&y.push(i[c],i[c+1])}i=y}for(c=0;c<i.length-2;c+=2)switch(v[0]=i[c+2],v[1]=i[c+3],g[0]=i[c],g[1]=i[c+1],a.push(g[0],g[1]),r){case"end":f[s]=v[s],f[1-s]=g[1-s],a.push(f[0],f[1]);break;case"middle":var I=(g[s]+v[s])/2,E=[];f[s]=E[s]=I,f[1-s]=g[1-s],E[1-s]=v[1-s],a.push(f[0],f[1]),a.push(E[0],E[1]);break;default:f[s]=g[s],f[1-s]=v[1-s],a.push(f[0],f[1])}return a.push(i[c++],i[c++]),a}function J2t(i,t){var e=[],r=i.length,n,o;function s(g,v,y){var w=g.coord,I=(y-w)/(v.coord-w),E=F_t(I,[g.color,v.color]);return{coord:y,color:E}}for(var a=0;a<r;a++){var c=i[a],f=c.coord;if(f<0)n=c;else if(f>t){o?e.push(s(o,c,t)):n&&e.push(s(n,c,0),s(n,c,t));break}else n&&(e.push(s(n,c,0)),n=null),e.push(c),o=c}return e}function Q2t(i,t,e){var r=i.getVisual("visualMeta");if(!(!r||!r.length||!i.count())&&t.type==="cartesian2d"){for(var n,o,s=r.length-1;s>=0;s--){var a=i.getDimensionInfo(r[s].dimension);if(n=a&&a.coordDim,n==="x"||n==="y"){o=r[s];break}}if(o){var c=t.getAxis(n),f=ti(o.stops,function(N){return{coord:c.toGlobalCoord(c.dataToCoord(N.value)),color:N.color}}),g=f.length,v=o.outerColors.slice();g&&f[0].coord>f[g-1].coord&&(f.reverse(),v.reverse());var y=J2t(f,n==="x"?e.getWidth():e.getHeight()),w=y.length;if(!w&&g)return f[0].coord<0?v[1]?v[1]:f[g-1].color:v[0]?v[0]:f[0].color;var I=10,E=y[0].coord-I,D=y[w-1].coord+I,R=D-E;if(R<.001)return"transparent";pt(y,function(N){N.offset=(N.coord-E)/R}),y.push({offset:w?y[w-1].offset:.5,color:v[1]||"transparent"}),y.unshift({offset:w?y[0].offset:.5,color:v[0]||"transparent"});var z=new U0(0,0,0,0,y,!0);return z[n]=E,z[n+"2"]=D,z}}}function tAt(i,t,e){var r=i.get("showAllSymbol"),n=r==="auto";if(!(r&&!n)){var o=e.getAxesByScale("ordinal")[0];if(o&&!(n&&eAt(o,t))){var s=t.mapDimension(o.dim),a={};return pt(o.getViewLabels(),function(c){var f=o.scale.getRawOrdinalNumber(c.tickValue);a[f]=1}),function(c){return!a.hasOwnProperty(t.get(s,c))}}}}function eAt(i,t){var e=i.getExtent(),r=Math.abs(e[1]-e[0])/i.scale.count();isNaN(r)&&(r=0);for(var n=t.count(),o=Math.max(1,Math.round(n/5)),s=0;s<n;s+=o)if(qS.getSymbolSize(t,s)[i.isHorizontal()?1:0]*1.5>r)return!1;return!0}function iAt(i,t){return isNaN(i)||isNaN(t)}function rAt(i){for(var t=i.length/2;t>0&&iAt(i[t*2-2],i[t*2-1]);t--);return t-1}function yW(i,t){return[i[t*2],i[t*2+1]]}function nAt(i,t,e){for(var r=i.length/2,n=e==="x"?0:1,o,s,a=0,c=-1,f=0;f<r;f++)if(s=i[f*2+n],!(isNaN(s)||isNaN(i[f*2+1-n]))){if(f===0){o=s;continue}if(o<=t&&s>=t||o>=t&&s<=t){c=f;break}a=f,o=s}return{range:[a,c],t:(t-o)/(s-o)}}function eet(i){if(i.get(["endLabel","show"]))return!0;for(var t=0;t<fl.length;t++)if(i.get([fl[t],"endLabel","show"]))return!0;return!1}function LR(i,t,e,r){if(Fp(t,"cartesian2d")){var n=r.getModel("endLabel"),o=n.get("valueAnimation"),s=r.getData(),a={lastFrameIndex:0},c=eet(r)?function(w,I){i._endLabelOnDuring(w,I,s,a,o,n,t)}:null,f=t.getBaseAxis().isHorizontal(),g=Qtt(t,e,r,function(){var w=i._endLabel;w&&e&&a.originalX!=null&&w.attr({x:a.originalX,y:a.originalY})},c);if(!r.get("clip",!0)){var v=g.shape,y=Math.max(v.width,v.height);f?(v.y-=y,v.height+=y*2):(v.x-=y,v.width+=y*2)}return c&&c(1,g),g}else return tet(t,e,r)}function aAt(i,t){var e=t.getBaseAxis(),r=e.isHorizontal(),n=e.inverse,o=r?n?"right":"left":"center",s=r?"middle":n?"top":"bottom";return{normal:{align:i.get("align")||o,verticalAlign:i.get("verticalAlign")||s}}}var oAt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.init=function(){var e=new Ki,r=new XS;this.group.add(r.group),this._symbolDraw=r,this._lineGroup=e,this._changePolyState=Si(this._changePolyState,this)},t.prototype.render=function(e,r,n){var o=e.coordinateSystem,s=this.group,a=e.getData(),c=e.getModel("lineStyle"),f=e.getModel("areaStyle"),g=a.getLayout("points")||[],v=o.type==="polar",y=this._coordSys,w=this._symbolDraw,I=this._polyline,E=this._polygon,D=this._lineGroup,R=!r.ssr&&e.get("animation"),z=!f.isEmpty(),N=f.get("origin"),H=Xtt(o,a,N),q=z&&K2t(o,a,H),Y=e.get("showSymbol"),J=e.get("connectNulls"),it=Y&&!v&&tAt(e,a,o),at=this._data;at&&at.eachItemGraphicEl(function(bi,or){bi.__temp&&(s.remove(bi),at.setItemGraphicEl(or,null))}),Y||w.remove(),s.add(D);var ut=v?!1:e.get("step"),ft;o&&o.getArea&&e.get("clip",!0)&&(ft=o.getArea(),ft.width!=null?(ft.x-=.1,ft.y-=.1,ft.width+=.2,ft.height+=.2):ft.r0&&(ft.r0-=.5,ft.r+=.5)),this._clipShapeForSymbol=ft;var _t=Q2t(a,o,n)||a.getVisual("style")[a.getVisual("drawType")];if(!(I&&y.type===o.type&&ut===this._step))Y&&w.updateData(a,{isIgnore:it,clipShape:ft,disableAnimation:!0,getSymbolPoint:function(bi){return[g[bi*2],g[bi*2+1]]}}),R&&this._initSymbolLabelAnimation(a,o,ft),ut&&(q&&(q=Xf(q,g,o,ut,J)),g=Xf(g,null,o,ut,J)),I=this._newPolyline(g),z?E=this._newPolygon(g,q):E&&(D.remove(E),E=this._polygon=null),v||this._initOrUpdateEndLabel(e,o,wv(_t)),D.setClipPath(LR(this,o,!0,e));else{z&&!E?E=this._newPolygon(g,q):E&&!z&&(D.remove(E),E=this._polygon=null),v||this._initOrUpdateEndLabel(e,o,wv(_t));var ct=D.getClipPath();if(ct){var Dt=LR(this,o,!1,e);xa(ct,{shape:Dt.shape},e)}else D.setClipPath(LR(this,o,!0,e));Y&&w.updateData(a,{isIgnore:it,clipShape:ft,disableAnimation:!0,getSymbolPoint:function(bi){return[g[bi*2],g[bi*2+1]]}}),(!gW(this._stackedOnPoints,q)||!gW(this._points,g))&&(R?this._doUpdateAnimation(a,q,o,n,ut,N,J):(ut&&(q&&(q=Xf(q,g,o,ut,J)),g=Xf(g,null,o,ut,J)),I.setShape({points:g}),E&&E.setShape({points:g,stackedOnPoints:q})))}var Et=e.getModel("emphasis"),bt=Et.get("focus"),Vt=Et.get("blurScope"),zt=Et.get("disabled");if(I.useStyle(rr(c.getLineStyle(),{fill:"none",stroke:_t,lineJoin:"bevel"})),Bo(I,e,"lineStyle"),I.style.lineWidth>0&&e.get(["emphasis","lineStyle","width"])==="bolder"){var Jt=I.getState("emphasis").style;Jt.lineWidth=+I.style.lineWidth+1}cr(I).seriesIndex=e.seriesIndex,Ca(I,bt,Vt,zt);var ce=_W(e.get("smooth")),be=e.get("smoothMonotone");if(I.setShape({smooth:ce,smoothMonotone:be,connectNulls:J}),E){var ve=a.getCalculationInfo("stackedOnSeries"),ke=0;E.useStyle(rr(f.getAreaStyle(),{fill:_t,opacity:.7,lineJoin:"bevel",decal:a.getVisual("style").decal})),ve&&(ke=_W(ve.get("smooth"))),E.setShape({smooth:ce,stackedOnSmooth:ke,smoothMonotone:be,connectNulls:J}),Bo(E,e,"areaStyle"),cr(E).seriesIndex=e.seriesIndex,Ca(E,bt,Vt,zt)}var ni=this._changePolyState;a.eachItemGraphicEl(function(bi){bi&&(bi.onHoverStateChange=ni)}),this._polyline.onHoverStateChange=ni,this._data=a,this._coordSys=o,this._stackedOnPoints=q,this._points=g,this._step=ut,this._valueOrigin=N,e.get("triggerLineEvent")&&(this.packEventData(e,I),E&&this.packEventData(e,E))},t.prototype.packEventData=function(e,r){cr(r).eventData={componentType:"series",componentSubType:"line",componentIndex:e.componentIndex,seriesIndex:e.seriesIndex,seriesName:e.name,seriesType:"line"}},t.prototype.highlight=function(e,r,n,o){var s=e.getData(),a=vv(s,o);if(this._changePolyState("emphasis"),!(a instanceof Array)&&a!=null&&a>=0){var c=s.getLayout("points"),f=s.getItemGraphicEl(a);if(!f){var g=c[a*2],v=c[a*2+1];if(isNaN(g)||isNaN(v)||this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(g,v))return;var y=e.get("zlevel")||0,w=e.get("z")||0;f=new qS(s,a),f.x=g,f.y=v,f.setZ(y,w);var I=f.getSymbolPath().getTextContent();I&&(I.zlevel=y,I.z=w,I.z2=this._polyline.z2+1),f.__temp=!0,s.setItemGraphicEl(a,f),f.stopSymbolAnimation(!0),this.group.add(f)}f.highlight()}else ga.prototype.highlight.call(this,e,r,n,o)},t.prototype.downplay=function(e,r,n,o){var s=e.getData(),a=vv(s,o);if(this._changePolyState("normal"),a!=null&&a>=0){var c=s.getItemGraphicEl(a);c&&(c.__temp?(s.setItemGraphicEl(a,null),this.group.remove(c)):c.downplay())}else ga.prototype.downplay.call(this,e,r,n,o)},t.prototype._changePolyState=function(e){var r=this._polygon;NC(this._polyline,e),r&&NC(r,e)},t.prototype._newPolyline=function(e){var r=this._polyline;return r&&this._lineGroup.remove(r),r=new X2t({shape:{points:e},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(r),this._polyline=r,r},t.prototype._newPolygon=function(e,r){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new Jtt({shape:{points:e,stackedOnPoints:r},segmentIgnoreThreshold:2}),this._lineGroup.add(n),this._polygon=n,n},t.prototype._initSymbolLabelAnimation=function(e,r,n){var o,s,a=r.getBaseAxis(),c=a.inverse;r.type==="cartesian2d"?(o=a.isHorizontal(),s=!1):r.type==="polar"&&(o=a.dim==="angle",s=!0);var f=e.hostModel,g=f.get("animationDuration");Xi(g)&&(g=g(null));var v=f.get("animationDelay")||0,y=Xi(v)?v(null):v;e.eachItemGraphicEl(function(w,I){var E=w;if(E){var D=[w.x,w.y],R=void 0,z=void 0,N=void 0;if(n)if(s){var H=n,q=r.pointToCoord(D);o?(R=H.startAngle,z=H.endAngle,N=-q[1]/180*Math.PI):(R=H.r0,z=H.r,N=q[0])}else{var Y=n;o?(R=Y.x,z=Y.x+Y.width,N=w.x):(R=Y.y+Y.height,z=Y.y,N=w.y)}var J=z===R?0:(N-R)/(z-R);c&&(J=1-J);var it=Xi(v)?v(I):g*J+y,at=E.getSymbolPath(),ut=at.getTextContent();E.attr({scaleX:0,scaleY:0}),E.animateTo({scaleX:1,scaleY:1},{duration:200,setToFinal:!0,delay:it}),ut&&ut.animateFrom({style:{opacity:0}},{duration:300,delay:it}),at.disableLabelAnimation=!0}})},t.prototype._initOrUpdateEndLabel=function(e,r,n){var o=e.getModel("endLabel");if(eet(e)){var s=e.getData(),a=this._polyline,c=s.getLayout("points");if(!c){a.removeTextContent(),this._endLabel=null;return}var f=this._endLabel;f||(f=this._endLabel=new _n({z2:200}),f.ignoreClip=!0,a.setTextContent(this._endLabel),a.disableLabelAnimation=!0);var g=rAt(c);g>=0&&(Xo(a,Fo(e,"endLabel"),{inheritColor:n,labelFetcher:e,labelDataIndex:g,defaultText:function(v,y,w){return w!=null?qtt(s,w):M0(s,v)},enableTextSetter:!0},aAt(o,r)),a.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},t.prototype._endLabelOnDuring=function(e,r,n,o,s,a,c){var f=this._endLabel,g=this._polyline;if(f){e<1&&o.originalX==null&&(o.originalX=f.x,o.originalY=f.y);var v=n.getLayout("points"),y=n.hostModel,w=y.get("connectNulls"),I=a.get("precision"),E=a.get("distance")||0,D=c.getBaseAxis(),R=D.isHorizontal(),z=D.inverse,N=r.shape,H=z?R?N.x:N.y+N.height:R?N.x+N.width:N.y,q=(R?E:0)*(z?-1:1),Y=(R?0:-E)*(z?-1:1),J=R?"x":"y",it=nAt(v,H,J),at=it.range,ut=at[1]-at[0],ft=void 0;if(ut>=1){if(ut>1&&!w){var _t=yW(v,at[0]);f.attr({x:_t[0]+q,y:_t[1]+Y}),s&&(ft=y.getRawValue(at[0]))}else{var _t=g.getPointOn(H,J);_t&&f.attr({x:_t[0]+q,y:_t[1]+Y});var ct=y.getRawValue(at[0]),Dt=y.getRawValue(at[1]);s&&(ft=uK(n,I,ct,Dt,it.t))}o.lastFrameIndex=at[0]}else{var Et=e===1||o.lastFrameIndex>0?at[0]:0,_t=yW(v,Et);s&&(ft=y.getRawValue(Et)),f.attr({x:_t[0]+q,y:_t[1]+Y})}if(s){var bt=H0(f);typeof bt.setLabelText=="function"&&bt.setLabelText(ft)}}},t.prototype._doUpdateAnimation=function(e,r,n,o,s,a,c){var f=this._polyline,g=this._polygon,v=e.hostModel,y=q2t(this._data,e,this._stackedOnPoints,r,this._coordSys,n,this._valueOrigin),w=y.current,I=y.stackedOnCurrent,E=y.next,D=y.stackedOnNext;if(s&&(I=Xf(y.stackedOnCurrent,y.current,n,s,c),w=Xf(y.current,null,n,s,c),D=Xf(y.stackedOnNext,y.next,n,s,c),E=Xf(y.next,null,n,s,c)),vW(w,E)>3e3||g&&vW(I,D)>3e3){f.stopAnimation(),f.setShape({points:E}),g&&(g.stopAnimation(),g.setShape({points:E,stackedOnPoints:D}));return}f.shape.__points=y.current,f.shape.points=w;var R={shape:{points:E}};y.current!==w&&(R.shape.__points=y.next),f.stopAnimation(),yn(f,R,v),g&&(g.setShape({points:w,stackedOnPoints:I}),g.stopAnimation(),yn(g,{shape:{stackedOnPoints:D}},v),f.shape.points!==g.shape.points&&(g.shape.points=f.shape.points));for(var z=[],N=y.status,H=0;H<N.length;H++){var q=N[H].cmd;if(q==="="){var Y=e.getItemGraphicEl(N[H].idx1);Y&&z.push({el:Y,ptIdx:H})}}f.animators&&f.animators.length&&f.animators[0].during(function(){g&&g.dirtyShape();for(var J=f.shape.__points,it=0;it<z.length;it++){var at=z[it].el,ut=z[it].ptIdx*2;at.x=J[ut],at.y=J[ut+1],at.markRedraw()}})},t.prototype.remove=function(e){var r=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(o,s){o.__temp&&(r.remove(o),n.setItemGraphicEl(s,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},t.type="line",t}(ga);const sAt=oAt;function KS(i,t){return{seriesType:i,plan:$0(),reset:function(e){var r=e.getData(),n=e.coordinateSystem,o=e.pipelineContext,s=t||o.large;if(n){var a=ti(n.dimensions,function(w){return r.mapDimension(w)}).slice(0,2),c=a.length,f=r.getCalculationInfo("stackResultDimension");zp(r,a[0])&&(a[0]=f),zp(r,a[1])&&(a[1]=f);var g=r.getStore(),v=r.getDimensionIndex(a[0]),y=r.getDimensionIndex(a[1]);return c&&{progress:function(w,I){for(var E=w.end-w.start,D=s&&ch(E*c),R=[],z=[],N=w.start,H=0;N<w.end;N++){var q=void 0;if(c===1){var Y=g.get(v,N);q=n.dataToPoint(Y,null,z)}else R[0]=g.get(v,N),R[1]=g.get(y,N),q=n.dataToPoint(R,null,z);s?(D[H++]=q[0],D[H++]=q[1]):I.setItemLayout(N,q.slice())}s&&I.setLayout("points",D)}}}}}}var lAt={average:function(i){for(var t=0,e=0,r=0;r<i.length;r++)isNaN(i[r])||(t+=i[r],e++);return e===0?NaN:t/e},sum:function(i){for(var t=0,e=0;e<i.length;e++)t+=i[e]||0;return t},max:function(i){for(var t=-1/0,e=0;e<i.length;e++)i[e]>t&&(t=i[e]);return isFinite(t)?t:NaN},min:function(i){for(var t=1/0,e=0;e<i.length;e++)i[e]<t&&(t=i[e]);return isFinite(t)?t:NaN},nearest:function(i){return i[0]}},uAt=function(i){return Math.round(i.length/2)};function iet(i){return{seriesType:i,reset:function(t,e,r){var n=t.getData(),o=t.get("sampling"),s=t.coordinateSystem,a=n.count();if(a>10&&s.type==="cartesian2d"&&o){var c=s.getBaseAxis(),f=s.getOtherAxis(c),g=c.getExtent(),v=r.getDevicePixelRatio(),y=Math.abs(g[1]-g[0])*(v||1),w=Math.round(a/y);if(isFinite(w)&&w>1){o==="lttb"?t.setData(n.lttbDownSample(n.mapDimension(f.dim),1/w)):o==="minmax"&&t.setData(n.minmaxDownSample(n.mapDimension(f.dim),1/w));var I=void 0;wi(o)?I=lAt[o]:Xi(o)&&(I=o),I&&t.setData(n.downSample(n.mapDimension(f.dim),1/w,I,uAt))}}}}}function cAt(i){i.registerChartView(sAt),i.registerSeriesModel(G2t),i.registerLayout(KS("line",!0)),i.registerVisual({seriesType:"line",reset:function(t){var e=t.getData(),r=t.getModel("lineStyle").getLineStyle();r&&!r.stroke&&(r.stroke=e.getVisual("style").fill),e.setVisual("legendLineStyle",r)}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,iet("line"))}var ret=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,r){return $d(null,this,{useEncodeDefaulter:!0})},t.prototype.getMarkerPosition=function(e,r,n){var o=this.coordinateSystem;if(o&&o.clampData){var s=o.clampData(e),a=o.dataToPoint(s);if(n)pt(o.getAxes(),function(y,w){if(y.type==="category"&&r!=null){var I=y.getTicksCoords(),E=y.getTickModel().get("alignWithLabel"),D=s[w],R=r[w]==="x1"||r[w]==="y1";if(R&&!E&&(D+=1),I.length<2)return;if(I.length===2){a[w]=y.toGlobalCoord(y.getExtent()[R?1:0]);return}for(var z=void 0,N=void 0,H=1,q=0;q<I.length;q++){var Y=I[q].coord,J=q===I.length-1?I[q-1].tickValue+H:I[q].tickValue;if(J===D){N=Y;break}else if(J<D)z=Y;else if(z!=null&&J>D){N=(Y+z)/2;break}q===1&&(H=J-I[0].tickValue)}N==null&&(z?z&&(N=I[I.length-1].coord):N=I[0].coord),a[w]=y.toGlobalCoord(N)}});else{var c=this.getData(),f=c.getLayout("offset"),g=c.getLayout("size"),v=o.getBaseAxis().isHorizontal()?0:1;a[v]+=f+g/2}return a}return[NaN,NaN]},t.type="series.__base_bar__",t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod",defaultBarGap:"10%"},t}(Ea);Ea.registerClass(ret);const oM=ret;var hAt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(){return $d(null,this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},t.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):!1},t.prototype.getProgressiveThreshold=function(){var e=this.get("progressiveThreshold"),r=this.get("largeThreshold");return r>e&&(e=r),e},t.prototype.brushSelector=function(e,r,n){return n.rect(r.getItemLayout(e))},t.type="series.bar",t.dependencies=["grid","polar"],t.defaultOption=Zp(oM.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:ye.color.primary,borderWidth:2}},realtimeSort:!1}),t}(oM);const dAt=hAt;var fAt=function(){function i(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return i}(),pAt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="sausage",r}return t.prototype.getDefaultShape=function(){return new fAt},t.prototype.buildPath=function(e,r){var n=r.cx,o=r.cy,s=Math.max(r.r0||0,0),a=Math.max(r.r,0),c=(a-s)*.5,f=s+c,g=r.startAngle,v=r.endAngle,y=r.clockwise,w=Math.PI*2,I=y?v-g<w:g-v<w;I||(g=v-(y?w:-w));var E=Math.cos(g),D=Math.sin(g),R=Math.cos(v),z=Math.sin(v);I?(e.moveTo(E*s+n,D*s+o),e.arc(E*f+n,D*f+o,c,-Math.PI+g,g,!y)):e.moveTo(E*a+n,D*a+o),e.arc(n,o,a,g,v,!y),e.arc(R*f+n,z*f+o,c,v-Math.PI*2,v-Math.PI,!y),s!==0&&e.arc(n,o,s,v,g,y)},t}(qr);const sM=pAt;function gAt(i,t){t=t||{};var e=t.isRoundCap;return function(r,n,o){var s=n.position;if(!s||s instanceof Array)return kC(r,n,o);var a=i(s),c=n.distance!=null?n.distance:5,f=this.shape,g=f.cx,v=f.cy,y=f.r,w=f.r0,I=(y+w)/2,E=f.startAngle,D=f.endAngle,R=(E+D)/2,z=e?Math.abs(y-w)/2:0,N=Math.cos,H=Math.sin,q=g+y*N(E),Y=v+y*H(E),J="left",it="top";switch(a){case"startArc":q=g+(w-c)*N(R),Y=v+(w-c)*H(R),J="center",it="top";break;case"insideStartArc":q=g+(w+c)*N(R),Y=v+(w+c)*H(R),J="center",it="bottom";break;case"startAngle":q=g+I*N(E)+qA(E,c+z,!1),Y=v+I*H(E)+XA(E,c+z,!1),J="right",it="middle";break;case"insideStartAngle":q=g+I*N(E)+qA(E,-c+z,!1),Y=v+I*H(E)+XA(E,-c+z,!1),J="left",it="middle";break;case"middle":q=g+I*N(R),Y=v+I*H(R),J="center",it="middle";break;case"endArc":q=g+(y+c)*N(R),Y=v+(y+c)*H(R),J="center",it="bottom";break;case"insideEndArc":q=g+(y-c)*N(R),Y=v+(y-c)*H(R),J="center",it="top";break;case"endAngle":q=g+I*N(D)+qA(D,c+z,!0),Y=v+I*H(D)+XA(D,c+z,!0),J="left",it="middle";break;case"insideEndAngle":q=g+I*N(D)+qA(D,-c+z,!0),Y=v+I*H(D)+XA(D,-c+z,!0),J="right",it="middle";break;default:return kC(r,n,o)}return r=r||{},r.x=q,r.y=Y,r.align=J,r.verticalAlign=it,r}}function mAt(i,t,e,r){if(fn(r)){i.setTextConfig({rotation:r});return}else if(Ye(t)){i.setTextConfig({rotation:0});return}var n=i.shape,o=n.clockwise?n.startAngle:n.endAngle,s=n.clockwise?n.endAngle:n.startAngle,a=(o+s)/2,c,f=e(t);switch(f){case"startArc":case"insideStartArc":case"middle":case"insideEndArc":case"endArc":c=a;break;case"startAngle":case"insideStartAngle":c=o;break;case"endAngle":case"insideEndAngle":c=s;break;default:i.setTextConfig({rotation:0});return}var g=Math.PI*1.5-c;f==="middle"&&g>Math.PI/2&&g<Math.PI*1.5&&(g-=Math.PI),i.setTextConfig({rotation:g})}function qA(i,t,e){return t*Math.sin(i)*(e?-1:1)}function XA(i,t,e){return t*Math.cos(i)*(e?1:-1)}function dh(i,t,e){var r=i.get("borderRadius");if(r==null)return e?{cornerRadius:0}:null;Ye(r)||(r=[r,r,r,r]);var n=Math.abs(t.r||0-t.r0||0);return{cornerRadius:ti(r,function(o){return yc(o,n)})}}var RR=Math.max,kR=Math.min;function vAt(i,t){var e=i.getArea&&i.getArea();if(Fp(i,"cartesian2d")){var r=i.getBaseAxis();if(r.type!=="category"||!r.onBand){var n=t.getLayout("bandWidth");r.isHorizontal()?(e.x-=n,e.width+=n*2):(e.y-=n,e.height+=n*2)}}return e}var _At=function(i){Se(t,i);function t(){var e=i.call(this)||this;return e.type=t.type,e._isFirstFrame=!0,e}return t.prototype.render=function(e,r,n,o){this._model=e,this._removeOnRenderedListener(n),this._updateDrawMode(e);var s=e.get("coordinateSystem");(s==="cartesian2d"||s==="polar")&&(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(e,r,n):this._renderNormal(e,r,n,o))},t.prototype.incrementalPrepareRender=function(e){this._clear(),this._updateDrawMode(e),this._updateLargeClip(e)},t.prototype.incrementalRender=function(e,r){this._progressiveEls=[],this._incrementalRenderLarge(e,r)},t.prototype.eachRendered=function(e){$p(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var r=e.pipelineContext.large;(this._isLargeDraw==null||r!==this._isLargeDraw)&&(this._isLargeDraw=r,this._clear())},t.prototype._renderNormal=function(e,r,n,o){var s=this.group,a=e.getData(),c=this._data,f=e.coordinateSystem,g=f.getBaseAxis(),v;f.type==="cartesian2d"?v=g.isHorizontal():f.type==="polar"&&(v=g.dim==="angle");var y=e.isAnimationEnabled()?e:null,w=yAt(e,f);w&&this._enableRealtimeSort(w,a,n);var I=e.get("clip",!0)||w,E=vAt(f,a);s.removeClipPath();var D=e.get("roundCap",!0),R=e.get("showBackground",!0),z=e.getModel("backgroundStyle"),N=z.get("borderRadius")||0,H=[],q=this._backgroundEls,Y=o&&o.isInitSort,J=o&&o.type==="changeAxisOrder";function it(ft){var _t=YA[f.type](a,ft);if(!_t)return null;var ct=IAt(f,v,_t);return ct.useStyle(z.getItemStyle()),f.type==="cartesian2d"?ct.setShape("r",N):ct.setShape("cornerRadius",N),H[ft]=ct,ct}a.diff(c).add(function(ft){var _t=a.getItemModel(ft),ct=YA[f.type](a,ft,_t);if(ct&&(R&&it(ft),!(!a.hasValue(ft)||!TW[f.type](ct)))){var Dt=!1;I&&(Dt=xW[f.type](E,ct));var Et=bW[f.type](e,a,ft,ct,v,y,g.model,!1,D);w&&(Et.forceLabelAnimation=!0),AW(Et,a,ft,_t,ct,e,v,f.type==="polar"),Y?Et.attr({shape:ct}):w?wW(w,y,Et,ct,ft,v,!1,!1):xa(Et,{shape:ct},e,ft),a.setItemGraphicEl(ft,Et),s.add(Et),Et.ignore=Dt}}).update(function(ft,_t){var ct=a.getItemModel(ft),Dt=YA[f.type](a,ft,ct);if(Dt){if(R){var Et=void 0;q.length===0?Et=it(_t):(Et=q[_t],Et.useStyle(z.getItemStyle()),f.type==="cartesian2d"?Et.setShape("r",N):Et.setShape("cornerRadius",N),H[ft]=Et);var bt=YA[f.type](a,ft),Vt=aet(v,bt,f);yn(Et,{shape:Vt},y,ft)}var zt=c.getItemGraphicEl(_t);if(!a.hasValue(ft)||!TW[f.type](Dt)){s.remove(zt);return}var Jt=!1;I&&(Jt=xW[f.type](E,Dt),Jt&&s.remove(zt));var ce=zt&&(zt.type==="sector"&&D||zt.type==="sausage"&&!D);if(ce&&(zt&&Id(zt,e,_t),zt=null),zt?zu(zt):zt=bW[f.type](e,a,ft,Dt,v,y,g.model,!0,D),w&&(zt.forceLabelAnimation=!0),J){var be=zt.getTextContent();if(be){var ve=H0(be);ve.prevValue!=null&&(ve.prevValue=ve.value)}}else AW(zt,a,ft,ct,Dt,e,v,f.type==="polar");Y?zt.attr({shape:Dt}):w?wW(w,y,zt,Dt,ft,v,!0,J):yn(zt,{shape:Dt},e,ft,null),a.setItemGraphicEl(ft,zt),zt.ignore=Jt,s.add(zt)}}).remove(function(ft){var _t=c.getItemGraphicEl(ft);_t&&Id(_t,e,ft)}).execute();var at=this._backgroundGroup||(this._backgroundGroup=new Ki);at.removeAll();for(var ut=0;ut<H.length;++ut)at.add(H[ut]);s.add(at),this._backgroundEls=H,this._data=a},t.prototype._renderLarge=function(e,r,n){this._clear(),CW(e,this.group),this._updateLargeClip(e)},t.prototype._incrementalRenderLarge=function(e,r){this._removeBackground(),CW(r,this.group,this._progressiveEls,!0)},t.prototype._updateLargeClip=function(e){var r=e.get("clip",!0)&&YS(e.coordinateSystem,!1,e),n=this.group;r?n.setClipPath(r):n.removeClipPath()},t.prototype._enableRealtimeSort=function(e,r,n){var o=this;if(r.count()){var s=e.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(r,e,n),this._isFirstFrame=!1;else{var a=function(c){var f=r.getItemGraphicEl(c),g=f&&f.shape;return g&&Math.abs(s.isHorizontal()?g.height:g.width)||0};this._onRendered=function(){o._updateSortWithinSameData(r,a,s,n)},n.getZr().on("rendered",this._onRendered)}}},t.prototype._dataSort=function(e,r,n){var o=[];return e.each(e.mapDimension(r.dim),function(s,a){var c=n(a);c=c??NaN,o.push({dataIndex:a,mappedValue:c,ordinalNumber:s})}),o.sort(function(s,a){return a.mappedValue-s.mappedValue}),{ordinalNumbers:ti(o,function(s){return s.ordinalNumber})}},t.prototype._isOrderChangedWithinSameData=function(e,r,n){for(var o=n.scale,s=e.mapDimension(n.dim),a=Number.MAX_VALUE,c=0,f=o.getOrdinalMeta().categories.length;c<f;++c){var g=e.rawIndexOf(s,o.getRawOrdinalNumber(c)),v=g<0?Number.MIN_VALUE:r(e.indexOfRawIndex(g));if(v>a)return!0;a=v}return!1},t.prototype._isOrderDifferentInView=function(e,r){for(var n=r.scale,o=n.getExtent(),s=Math.max(0,o[0]),a=Math.min(o[1],n.getOrdinalMeta().categories.length-1);s<=a;++s)if(e.ordinalNumbers[s]!==n.getRawOrdinalNumber(s))return!0},t.prototype._updateSortWithinSameData=function(e,r,n,o){if(this._isOrderChangedWithinSameData(e,r,n)){var s=this._dataSort(e,n,r);this._isOrderDifferentInView(s,n)&&(this._removeOnRenderedListener(o),o.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:s}))}},t.prototype._dispatchInitSort=function(e,r,n){var o=r.baseAxis,s=this._dataSort(e,o,function(a){return e.get(e.mapDimension(r.otherAxis.dim),a)});n.dispatchAction({type:"changeAxisOrder",componentType:o.dim+"Axis",isInitSort:!0,axisId:o.index,sortInfo:s})},t.prototype.remove=function(e,r){this._clear(this._model),this._removeOnRenderedListener(r)},t.prototype.dispose=function(e,r){this._removeOnRenderedListener(r)},t.prototype._removeOnRenderedListener=function(e){this._onRendered&&(e.getZr().off("rendered",this._onRendered),this._onRendered=null)},t.prototype._clear=function(e){var r=this.group,n=this._data;e&&e.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl(function(o){Id(o,e,cr(o).dataIndex)})):r.removeAll(),this._data=null,this._isFirstFrame=!0},t.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},t.type="bar",t}(ga),xW={cartesian2d:function(i,t){var e=t.width<0?-1:1,r=t.height<0?-1:1;e<0&&(t.x+=t.width,t.width=-t.width),r<0&&(t.y+=t.height,t.height=-t.height);var n=i.x+i.width,o=i.y+i.height,s=RR(t.x,i.x),a=kR(t.x+t.width,n),c=RR(t.y,i.y),f=kR(t.y+t.height,o),g=a<s,v=f<c;return t.x=g&&s>n?a:s,t.y=v&&c>o?f:c,t.width=g?0:a-s,t.height=v?0:f-c,e<0&&(t.x+=t.width,t.width=-t.width),r<0&&(t.y+=t.height,t.height=-t.height),g||v},polar:function(i,t){var e=t.r0<=t.r?1:-1;if(e<0){var r=t.r;t.r=t.r0,t.r0=r}var n=kR(t.r,i.r),o=RR(t.r0,i.r0);t.r=n,t.r0=o;var s=n-o<0;if(e<0){var r=t.r;t.r=t.r0,t.r0=r}return s}},bW={cartesian2d:function(i,t,e,r,n,o,s,a,c){var f=new jr({shape:Ne({},r),z2:1});if(f.__dataIndex=e,f.name="item",o){var g=f.shape,v=n?"height":"width";g[v]=0}return f},polar:function(i,t,e,r,n,o,s,a,c){var f=!n&&c?sM:pl,g=new f({shape:r,z2:1});g.name="item";var v=net(n);if(g.calculateTextPosition=gAt(v,{isRoundCap:f===sM}),o){var y=g.shape,w=n?"r":"endAngle",I={};y[w]=n?r.r0:r.startAngle,I[w]=r[w],(a?yn:xa)(g,{shape:I},o)}return g}};function yAt(i,t){var e=i.get("realtimeSort",!0),r=t.getBaseAxis();if(e&&r.type==="category"&&t.type==="cartesian2d")return{baseAxis:r,otherAxis:t.getOtherAxis(r)}}function wW(i,t,e,r,n,o,s,a){var c,f;o?(f={x:r.x,width:r.width},c={y:r.y,height:r.height}):(f={y:r.y,height:r.height},c={x:r.x,width:r.width}),a||(s?yn:xa)(e,{shape:c},t,n,null);var g=t?i.baseAxis.model:null;(s?yn:xa)(e,{shape:f},g,n)}function SW(i,t){for(var e=0;e<t.length;e++)if(!isFinite(i[t[e]]))return!0;return!1}var xAt=["x","y","width","height"],bAt=["cx","cy","r","startAngle","endAngle"],TW={cartesian2d:function(i){return!SW(i,xAt)},polar:function(i){return!SW(i,bAt)}},YA={cartesian2d:function(i,t,e){var r=i.getItemLayout(t);if(!r)return null;var n=e?SAt(e,r):0,o=r.width>0?1:-1,s=r.height>0?1:-1;return{x:r.x+o*n/2,y:r.y+s*n/2,width:r.width-o*n,height:r.height-s*n}},polar:function(i,t,e){var r=i.getItemLayout(t);return{cx:r.cx,cy:r.cy,r0:r.r0,r:r.r,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}}};function wAt(i){return i.startAngle!=null&&i.endAngle!=null&&i.startAngle===i.endAngle}function net(i){return function(t){var e=t?"Arc":"Angle";return function(r){switch(r){case"start":case"insideStart":case"end":case"insideEnd":return r+e;default:return r}}}(i)}function AW(i,t,e,r,n,o,s,a){var c=t.getItemVisual(e,"style");if(a){if(!o.get("roundCap")){var g=i.shape,v=dh(r.getModel("itemStyle"),g,!0);Ne(g,v),i.setShape(g)}}else{var f=r.get(["itemStyle","borderRadius"])||0;i.setShape("r",f)}i.useStyle(c);var y=r.getShallow("cursor");y&&i.attr("cursor",y);var w=a?s?n.r>=n.r0?"endArc":"startArc":n.endAngle>=n.startAngle?"endAngle":"startAngle":s?n.height>=0?"bottom":"top":n.width>=0?"right":"left",I=Fo(r);Xo(i,I,{labelFetcher:o,labelDataIndex:e,defaultText:M0(o.getData(),e),inheritColor:c.fill,defaultOpacity:c.opacity,defaultOutsidePosition:w});var E=i.getTextContent();if(a&&E){var D=r.get(["label","position"]);i.textConfig.inside=D==="middle"?!0:null,mAt(i,D==="outside"?w:D,net(s),r.get(["label","rotate"]))}lJ(E,I,o.getRawValue(e),function(z){return qtt(t,z)});var R=r.getModel(["emphasis"]);Ca(i,R.get("focus"),R.get("blurScope"),R.get("disabled")),Bo(i,r),wAt(n)&&(i.style.fill="none",i.style.stroke="none",pt(i.states,function(z){z.style&&(z.style.fill=z.style.stroke="none")}))}function SAt(i,t){var e=i.get(["itemStyle","borderColor"]);if(!e||e==="none")return 0;var r=i.get(["itemStyle","borderWidth"])||0,n=isNaN(t.width)?Number.MAX_VALUE:Math.abs(t.width),o=isNaN(t.height)?Number.MAX_VALUE:Math.abs(t.height);return Math.min(r,n,o)}var TAt=function(){function i(){}return i}(),IW=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="largeBar",r}return t.prototype.getDefaultShape=function(){return new TAt},t.prototype.buildPath=function(e,r){for(var n=r.points,o=this.baseDimIdx,s=1-this.baseDimIdx,a=[],c=[],f=this.barWidth,g=0;g<n.length;g+=3)c[o]=f,c[s]=n[g+2],a[o]=n[g+o],a[s]=n[g+s],e.rect(a[0],a[1],c[0],c[1])},t}(qr);function CW(i,t,e,r){var n=i.getData(),o=n.getLayout("valueAxisHorizontal")?1:0,s=n.getLayout("largeDataIndices"),a=n.getLayout("size"),c=i.getModel("backgroundStyle"),f=n.getLayout("largeBackgroundPoints");if(f){var g=new IW({shape:{points:f},incremental:!!r,silent:!0,z2:0});g.baseDimIdx=o,g.largeDataIndices=s,g.barWidth=a,g.useStyle(c.getItemStyle()),t.add(g),e&&e.push(g)}var v=new IW({shape:{points:n.getLayout("largePoints")},incremental:!!r,ignoreCoarsePointer:!0,z2:1});v.baseDimIdx=o,v.largeDataIndices=s,v.barWidth=a,t.add(v),v.useStyle(n.getVisual("style")),v.style.stroke=null,cr(v).seriesIndex=i.seriesIndex,i.get("silent")||(v.on("mousedown",MW),v.on("mousemove",MW)),e&&e.push(v)}var MW=m3(function(i){var t=this,e=AAt(t,i.offsetX,i.offsetY);cr(t).dataIndex=e>=0?e:null},30,!1);function AAt(i,t,e){for(var r=i.baseDimIdx,n=1-r,o=i.shape.points,s=i.largeDataIndices,a=[],c=[],f=i.barWidth,g=0,v=o.length/3;g<v;g++){var y=g*3;if(c[r]=f,c[n]=o[y+2],a[r]=o[y+r],a[n]=o[y+n],c[n]<0&&(a[n]+=c[n],c[n]=-c[n]),t>=a[0]&&t<=a[0]+c[0]&&e>=a[1]&&e<=a[1]+c[1])return s[g]}return-1}function aet(i,t,e){if(Fp(e,"cartesian2d")){var r=t,n=e.getArea();return{x:i?r.x:n.x,y:i?n.y:r.y,width:i?r.width:n.width,height:i?n.height:r.height}}else{var n=e.getArea(),o=t;return{cx:n.cx,cy:n.cy,r0:i?n.r0:o.r0,r:i?n.r:o.r,startAngle:i?o.startAngle:0,endAngle:i?o.endAngle:Math.PI*2}}}function IAt(i,t,e){var r=i.type==="polar"?pl:jr;return new r({shape:aet(t,e,i),silent:!0,z2:0})}const CAt=_At;function MAt(i){i.registerChartView(CAt),i.registerSeriesModel(dAt),i.registerLayout(i.PRIORITY.VISUAL.LAYOUT,br(att,"bar")),i.registerLayout(i.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,ott("bar")),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,iet("bar")),i.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(t,e){var r=t.componentType||"series";e.eachComponent({mainType:r,query:t},function(n){t.sortInfo&&n.axis.setCategorySortInfo(t.sortInfo)})})}var EW=Math.PI*2,KA=Math.PI/180;function EAt(i,t,e){t.eachSeriesByType(i,function(r){var n=r.getData(),o=n.mapDimension("value"),s=EJ(r,e),a=s.cx,c=s.cy,f=s.r,g=s.r0,v=s.viewRect,y=-r.get("startAngle")*KA,w=r.get("endAngle"),I=r.get("padAngle")*KA;w=w==="auto"?y-EW:-w*KA;var E=r.get("minAngle")*KA,D=E+I,R=0;n.each(o,function(Vt){!isNaN(Vt)&&R++});var z=n.getSum(o),N=Math.PI/(z||R)*2,H=r.get("clockwise"),q=r.get("roseType"),Y=r.get("stillShowZeroSum"),J=n.getDataExtent(o);J[0]=0;var it=H?1:-1,at=[y,w],ut=it*I/2;lE(at,!H),y=at[0],w=at[1];var ft=oet(r);ft.startAngle=y,ft.endAngle=w,ft.clockwise=H,ft.cx=a,ft.cy=c,ft.r=f,ft.r0=g;var _t=Math.abs(w-y),ct=_t,Dt=0,Et=y;if(n.setLayout({viewRect:v,r:f}),n.each(o,function(Vt,zt){var Jt;if(isNaN(Vt)){n.setItemLayout(zt,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:H,cx:a,cy:c,r0:g,r:q?NaN:f});return}q!=="area"?Jt=z===0&&Y?N:Vt*N:Jt=_t/R,Jt<D?(Jt=D,ct-=D):Dt+=Vt;var ce=Et+it*Jt,be=0,ve=0;I>Jt?(be=Et+it*Jt/2,ve=be):(be=Et+ut,ve=ce-ut),n.setItemLayout(zt,{angle:Jt,startAngle:be,endAngle:ve,clockwise:H,cx:a,cy:c,r0:g,r:q?Rn(Vt,J,[g,f]):f}),Et=ce}),ct<EW&&R)if(ct<=.001){var bt=_t/R;n.each(o,function(Vt,zt){if(!isNaN(Vt)){var Jt=n.getItemLayout(zt);Jt.angle=bt;var ce=0,be=0;bt<I?(ce=y+it*(zt+1/2)*bt,be=ce):(ce=y+it*zt*bt+ut,be=y+it*(zt+1)*bt-ut),Jt.startAngle=ce,Jt.endAngle=be}})}else N=ct/Dt,Et=y,n.each(o,function(Vt,zt){if(!isNaN(Vt)){var Jt=n.getItemLayout(zt),ce=Jt.angle===D?D:Vt*N,be=0,ve=0;ce<I?(be=Et+it*ce/2,ve=be):(be=Et+ut,ve=Et+it*ce-ut),Jt.startAngle=be,Jt.endAngle=ve,Et+=it*ce}})})}var oet=Wr();function Y0(i){return{seriesType:i,reset:function(t,e){var r=e.findComponents({mainType:"legend"});if(!(!r||!r.length)){var n=t.getData();n.filterSelf(function(o){for(var s=n.getName(o),a=0;a<r.length;a++)if(!r[a].isSelected(s))return!1;return!0})}}}}var DAt=Math.PI/180;function DW(i,t,e,r,n,o,s,a,c,f){if(i.length<2)return;function g(E){for(var D=E.rB,R=D*D,z=0;z<E.list.length;z++){var N=E.list[z],H=Math.abs(N.label.y-e),q=r+N.len,Y=q*q,J=Math.sqrt(Math.abs((1-H*H/R)*Y)),it=t+(J+N.len2)*n,at=it-N.label.x,ut=N.targetTextWidth-at*n;set(N,ut,!0),N.label.x=it}}function v(E){for(var D={list:[],maxY:0},R={list:[],maxY:0},z=0;z<E.length;z++)if(E[z].labelAlignTo==="none"){var N=E[z],H=N.label.y>e?R:D,q=Math.abs(N.label.y-e);if(q>=H.maxY){var Y=N.label.x-t-N.len2*n,J=r+N.len,it=Math.abs(Y)<J?Math.sqrt(q*q/(1-Y*Y/J/J)):J;H.rB=it,H.maxY=q}H.list.push(N)}g(D),g(R)}for(var y=i.length,w=0;w<y;w++)if(i[w].position==="outer"&&i[w].labelAlignTo==="labelLine"){var I=i[w].label.x-f;i[w].linePoints[1][0]+=I,i[w].label.x=f}Fz(i,1,c,c+s)&&v(i)}function PAt(i,t,e,r,n,o,s,a){for(var c=[],f=[],g=Number.MAX_VALUE,v=-Number.MAX_VALUE,y=0;y<i.length;y++){var w=i[y].label;OR(i[y])||(w.x<t?(g=Math.min(g,w.x),c.push(i[y])):(v=Math.max(v,w.x),f.push(i[y])))}for(var y=0;y<i.length;y++){var I=i[y];if(!OR(I)&&I.linePoints){if(I.labelStyleWidth!=null)continue;var w=I.label,E=I.linePoints,D=void 0;I.labelAlignTo==="edge"?w.x<t?D=E[2][0]-I.labelDistance-s-I.edgeDistance:D=s+n-I.edgeDistance-E[2][0]-I.labelDistance:I.labelAlignTo==="labelLine"?w.x<t?D=g-s-I.bleedMargin:D=s+n-v-I.bleedMargin:w.x<t?D=w.x-s-I.bleedMargin:D=s+n-w.x-I.bleedMargin,I.targetTextWidth=D,set(I,D,!1)}}DW(f,t,e,r,1,n,o,s,a,v),DW(c,t,e,r,-1,n,o,s,a,g);for(var y=0;y<i.length;y++){var I=i[y];if(!OR(I)&&I.linePoints){var w=I.label,E=I.linePoints,R=I.labelAlignTo==="edge",z=w.style.padding,N=z?z[1]+z[3]:0,H=w.style.backgroundColor?0:N,q=I.rect.width+H,Y=E[1][0]-E[2][0];R?w.x<t?E[2][0]=s+I.edgeDistance+q+I.labelDistance:E[2][0]=s+n-I.edgeDistance-q-I.labelDistance:(w.x<t?E[2][0]=w.x+I.labelDistance:E[2][0]=w.x-I.labelDistance,E[1][0]=E[2][0]+Y),E[1][1]=E[2][1]=w.y}}}function set(i,t,e){if(i.labelStyleWidth==null){var r=i.label,n=r.style,o=i.rect,s=n.backgroundColor,a=n.padding,c=a?a[1]+a[3]:0,f=n.overflow,g=o.width+(s?0:c);if(t<g||e){if(f&&f.match("break")){r.setStyle("backgroundColor",null),r.setStyle("width",t-c);var v=r.getBoundingRect();r.setStyle("width",Math.ceil(v.width)),r.setStyle("backgroundColor",s)}else{var y=t-c,w=t<g?y:e?y>i.unconstrainedWidth?null:y:null;r.setStyle("width",w)}uet(o,r)}}}function uet(i,t){PW.rect=i,Ptt(PW,t,LAt)}var LAt={minMarginForce:[null,0,null,0],marginDefault:[1,0,1,0]},PW={};function OR(i){return i.position==="center"}function RAt(i){var t=i.getData(),e=[],r,n,o=!1,s=(i.get("minShowLabelAngle")||0)*DAt,a=t.getLayout("viewRect"),c=t.getLayout("r"),f=a.width,g=a.x,v=a.y,y=a.height;function w(Y){Y.ignore=!0}function I(Y){if(!Y.ignore)return!0;for(var J in Y.states)if(Y.states[J].ignore===!1)return!0;return!1}t.each(function(Y){var J=t.getItemGraphicEl(Y),it=J.shape,at=J.getTextContent(),ut=J.getTextGuideLine(),ft=t.getItemModel(Y),_t=ft.getModel("label"),ct=_t.get("position")||ft.get(["emphasis","label","position"]),Dt=_t.get("distanceToLabelLine"),Et=_t.get("alignTo"),bt=xi(_t.get("edgeDistance"),f),Vt=_t.get("bleedMargin");Vt==null&&(Vt=Math.min(f,y)>200?10:2);var zt=ft.getModel("labelLine"),Jt=zt.get("length");Jt=xi(Jt,f);var ce=zt.get("length2");if(ce=xi(ce,f),Math.abs(it.endAngle-it.startAngle)<s){pt(at.states,w),at.ignore=!0,ut&&(pt(ut.states,w),ut.ignore=!0);return}if(I(at)){var be=(it.startAngle+it.endAngle)/2,ve=Math.cos(be),ke=Math.sin(be),ni,bi,or,Ue;r=it.cx,n=it.cy;var Ze=ct==="inside"||ct==="inner";if(ct==="center")ni=it.cx,bi=it.cy,Ue="center";else{var xe=(Ze?(it.r+it.r0)/2*ve:it.r*ve)+r,Ke=(Ze?(it.r+it.r0)/2*ke:it.r*ke)+n;if(ni=xe+ve*3,bi=Ke+ke*3,!Ze){var We=xe+ve*(Jt+c-it.r),Ti=Ke+ke*(Jt+c-it.r),Bt=We+(ve<0?-1:1)*ce,Zt=Ti;Et==="edge"?ni=ve<0?g+bt:g+f-bt:ni=Bt+(ve<0?-Dt:Dt),bi=Zt,or=[[xe,Ke],[We,Ti],[Bt,Zt]]}Ue=Ze?"center":Et==="edge"?ve>0?"right":"left":ve>0?"left":"right"}var ge=Math.PI,$e=0,He=_t.get("rotate");if(fn(He))$e=He*(ge/180);else if(ct==="center")$e=0;else if(He==="radial"||He===!0){var qe=ve<0?-be+ge:-be;$e=qe}else if(He==="tangential"&&ct!=="outside"&&ct!=="outer"){var Ai=Math.atan2(ve,ke);Ai<0&&(Ai=ge*2+Ai);var Ii=ke>0;Ii&&(Ai=ge+Ai),$e=Ai-ge}if(o=!!$e,at.x=ni,at.y=bi,at.rotation=$e,at.setStyle({verticalAlign:"middle"}),Ze){at.setStyle({align:Ue});var pi=at.states.select;pi&&(pi.x+=at.x,pi.y+=at.y)}else{var _i=new sr(0,0,0,0);uet(_i,at),e.push({label:at,labelLine:ut,position:ct,len:Jt,len2:ce,minTurnAngle:zt.get("minTurnAngle"),maxSurfaceAngle:zt.get("maxSurfaceAngle"),surfaceNormal:new er(ve,ke),linePoints:or,textAlign:Ue,labelDistance:Dt,labelAlignTo:Et,edgeDistance:bt,bleedMargin:Vt,rect:_i,unconstrainedWidth:_i.width,labelStyleWidth:at.style.width})}J.setTextConfig({inside:Ze})}}),!o&&i.get("avoidLabelOverlap")&&PAt(e,r,n,c,f,y,g,v);for(var E=0;E<e.length;E++){var D=e[E],R=D.label,z=D.labelLine,N=isNaN(R.x)||isNaN(R.y);if(R){R.setStyle({align:D.textAlign}),N&&(pt(R.states,w),R.ignore=!0);var H=R.states.select;H&&(H.x+=R.x,H.y+=R.y)}if(z){var q=D.linePoints;N||!q?(pt(z.states,w),z.ignore=!0):(Mtt(q,D.minTurnAngle),UTt(q,D.surfaceNormal,D.maxSurfaceAngle),z.setShape({points:q}),R.__hostTarget.textGuideLineConfig={anchor:new er(q[0][0],q[0][1])})}}}var kAt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this)||this;o.z2=2;var s=new _n;return o.setTextContent(s),o.updateData(e,r,n,!0),o}return t.prototype.updateData=function(e,r,n,o){var s=this,a=e.hostModel,c=e.getItemModel(r),f=c.getModel("emphasis"),g=e.getItemLayout(r),v=Ne(dh(c.getModel("itemStyle"),g,!0),g);if(isNaN(v.startAngle)){s.setShape(v);return}if(o){s.setShape(v);var y=a.getShallow("animationType");a.ecModel.ssr?(xa(s,{scaleX:0,scaleY:0},a,{dataIndex:r,isFrom:!0}),s.originX=v.cx,s.originY=v.cy):y==="scale"?(s.shape.r=g.r0,xa(s,{shape:{r:g.r}},a,r)):n!=null?(s.setShape({startAngle:n,endAngle:n}),xa(s,{shape:{startAngle:g.startAngle,endAngle:g.endAngle}},a,r)):(s.shape.endAngle=g.startAngle,yn(s,{shape:{endAngle:g.endAngle}},a,r))}else zu(s),yn(s,{shape:v},a,r);s.useStyle(e.getItemVisual(r,"style")),Bo(s,c);var w=(g.startAngle+g.endAngle)/2,I=a.get("selectedOffset"),E=Math.cos(w)*I,D=Math.sin(w)*I,R=c.getShallow("cursor");R&&s.attr("cursor",R),this._updateLabel(a,e,r),s.ensureState("emphasis").shape=Ne({r:g.r+(f.get("scale")&&f.get("scaleSize")||0)},dh(f.getModel("itemStyle"),g)),Ne(s.ensureState("select"),{x:E,y:D,shape:dh(c.getModel(["select","itemStyle"]),g)}),Ne(s.ensureState("blur"),{shape:dh(c.getModel(["blur","itemStyle"]),g)});var z=s.getTextGuideLine(),N=s.getTextContent();z&&Ne(z.ensureState("select"),{x:E,y:D}),Ne(N.ensureState("select"),{x:E,y:D}),Ca(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},t.prototype._updateLabel=function(e,r,n){var o=this,s=r.getItemModel(n),a=s.getModel("labelLine"),c=r.getItemVisual(n,"style"),f=c&&c.fill,g=c&&c.opacity;Xo(o,Fo(s),{labelFetcher:r.hostModel,labelDataIndex:n,inheritColor:f,defaultOpacity:g,defaultText:e.getFormattedLabel(n,"normal")||r.getName(n)});var v=o.getTextContent();o.setTextConfig({position:null,rotation:null}),v.attr({z2:10});var y=s.get(["label","position"]);if(y!=="outside"&&y!=="outer")o.removeTextGuideLine();else{var w=this.getTextGuideLine();w||(w=new Us,this.setTextGuideLine(w)),E3(this,D3(s),{stroke:f,opacity:iu(a.get(["lineStyle","opacity"]),g,1)})}},t}(pl),OAt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.ignoreLabelLineUpdate=!0,e}return t.prototype.render=function(e,r,n,o){var s=e.getData(),a=this._data,c=this.group,f;if(!a&&s.count()>0){for(var g=s.getItemLayout(0),v=1;isNaN(g&&g.startAngle)&&v<s.count();++v)g=s.getItemLayout(v);g&&(f=g.startAngle)}if(this._emptyCircleSector&&c.remove(this._emptyCircleSector),s.count()===0&&e.get("showEmptyCircle")){var y=oet(e),w=new pl({shape:Yi(y)});w.useStyle(e.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=w,c.add(w)}s.diff(a).add(function(I){var E=new kAt(s,I,f);s.setItemGraphicEl(I,E),c.add(E)}).update(function(I,E){var D=a.getItemGraphicEl(E);D.updateData(s,I,f),D.off("click"),c.add(D),s.setItemGraphicEl(I,D)}).remove(function(I){var E=a.getItemGraphicEl(I);Id(E,e,I)}).execute(),RAt(e),e.get("animationTypeUpdate")!=="expansion"&&(this._data=s)},t.prototype.dispose=function(){},t.prototype.containPoint=function(e,r){var n=r.getData(),o=n.getItemLayout(0);if(o){var s=e[0]-o.cx,a=e[1]-o.cy,c=Math.sqrt(s*s+a*a);return c<=o.r&&c>=o.r0}},t.type="pie",t}(ga);const zAt=OAt;function K0(i,t,e){t=Ye(t)&&{coordDimensions:t}||Ne({encodeDefine:i.getEncode()},t);var r=i.getSource(),n=$S(r,t).dimensions,o=new dl(n,i);return o.initData(r,e),o}var BAt=function(){function i(t,e){this._getDataWithEncodedVisual=t,this._getRawData=e}return i.prototype.getAllNames=function(){var t=this._getRawData();return t.mapArray(t.getName)},i.prototype.containName=function(t){var e=this._getRawData();return e.indexOfName(t)>=0},i.prototype.indexOfName=function(t){var e=this._getDataWithEncodedVisual();return e.indexOfName(t)},i.prototype.getItemVisual=function(t,e){var r=this._getDataWithEncodedVisual();return r.getItemVisual(t,e)},i}();const J0=BAt;var FAt=Wr(),cet=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new J0(Si(this.getData,this),Si(this.getRawData,this)),this._defaultLabelLine(e)},t.prototype.mergeOption=function(){i.prototype.mergeOption.apply(this,arguments)},t.prototype.getInitialData=function(){return K0(this,{coordDimensions:["value"],encodeDefaulter:br(s3,this)})},t.prototype.getDataParams=function(e){var r=this.getData(),n=FAt(r),o=n.seats;if(!o){var s=[];r.each(r.mapDimension("value"),function(c){s.push(c)}),o=n.seats=Ayt(s,r.hostModel.get("percentPrecision"))}var a=i.prototype.getDataParams.call(this,e);return a.percent=o[e]||0,a.$vars.push("percent"),a},t.prototype._defaultLabelLine=function(e){mv(e,"labelLine",["show"]);var r=e.labelLine,n=e.emphasis.labelLine;r.show=r.show&&e.label.show,n.show=n.show&&e.emphasis.label.show},t.type="series.pie",t.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"50%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,coordinateSystemUsage:"box",left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:30,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},t}(Ea);b1t({fullType:cet.type,getCoord2:function(i){return i.getShallow("center")}});const NAt=cet;function VAt(i){return{seriesType:i,reset:function(t,e){var r=t.getData();r.filterSelf(function(n){var o=r.mapDimension("value"),s=r.get(o,n);return!(fn(s)&&!isNaN(s)&&s<0)})}}}function UAt(i){i.registerChartView(zAt),i.registerSeriesModel(NAt),wQ("pie",i.registerAction),i.registerLayout(br(EAt,"pie")),i.registerProcessor(Y0("pie")),i.registerProcessor(VAt("pie"))}var GAt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e,r){return $d(null,this,{useEncodeDefaulter:!0})},t.prototype.getProgressive=function(){var e=this.option.progressive;return e??(this.option.large?5e3:this.get("progressive"))},t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;return e??(this.option.large?1e4:this.get("progressiveThreshold"))},t.prototype.brushSelector=function(e,r,n){return n.point(r.getItemLayout(e))},t.prototype.getZLevelKey=function(){return this.getData().count()>this.getProgressiveThreshold()?this.id:""},t.type="series.scatter",t.dependencies=["grid","polar","geo","singleAxis","calendar","matrix"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:ye.color.primary}},universalTransition:{divideShape:"clone"}},t}(Ea);const HAt=GAt;var het=4,jAt=function(){function i(){}return i}(),WAt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r._off=0,r.hoverDataIdx=-1,r}return t.prototype.getDefaultShape=function(){return new jAt},t.prototype.reset=function(){this.notClear=!1,this._off=0},t.prototype.buildPath=function(e,r){var n=r.points,o=r.size,s=this.symbolProxy,a=s.shape,c=e.getContext?e.getContext():e,f=c&&o[0]<het,g=this.softClipShape,v;if(f){this._ctx=c;return}for(this._ctx=null,v=this._off;v<n.length;){var y=n[v++],w=n[v++];isNaN(y)||isNaN(w)||g&&!g.contain(y,w)||(a.x=y-o[0]/2,a.y=w-o[1]/2,a.width=o[0],a.height=o[1],s.buildPath(e,a,!0))}this.incremental&&(this._off=v,this.notClear=!0)},t.prototype.afterBrush=function(){var e=this.shape,r=e.points,n=e.size,o=this._ctx,s=this.softClipShape,a;if(o){for(a=this._off;a<r.length;){var c=r[a++],f=r[a++];isNaN(c)||isNaN(f)||s&&!s.contain(c,f)||o.fillRect(c-n[0]/2,f-n[1]/2,n[0],n[1])}this.incremental&&(this._off=a,this.notClear=!0)}},t.prototype.findDataIndex=function(e,r){for(var n=this.shape,o=n.points,s=n.size,a=Math.max(s[0],4),c=Math.max(s[1],4),f=o.length/2-1;f>=0;f--){var g=f*2,v=o[g]-a/2,y=o[g+1]-c/2;if(e>=v&&r>=y&&e<=v+a&&r<=y+c)return f}return-1},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();if(e=n[0],r=n[1],o.contain(e,r)){var s=this.hoverDataIdx=this.findDataIndex(e,r);return s>=0}return this.hoverDataIdx=-1,!1},t.prototype.getBoundingRect=function(){var e=this._rect;if(!e){for(var r=this.shape,n=r.points,o=r.size,s=o[0],a=o[1],c=1/0,f=1/0,g=-1/0,v=-1/0,y=0;y<n.length;){var w=n[y++],I=n[y++];c=Math.min(w,c),g=Math.max(w,g),f=Math.min(I,f),v=Math.max(I,v)}e=this._rect=new sr(c-s/2,f-a/2,g-c+s,v-f+a)}return e},t}(qr),$At=function(){function i(){this.group=new Ki}return i.prototype.updateData=function(t,e){this._clear();var r=this._create();r.setShape({points:t.getLayout("points")}),this._setCommon(r,t,e)},i.prototype.updateLayout=function(t){var e=t.getLayout("points");this.group.eachChild(function(r){if(r.startIndex!=null){var n=(r.endIndex-r.startIndex)*2,o=r.startIndex*4*2;e=new Float32Array(e.buffer,o,n)}r.setShape("points",e),r.reset()})},i.prototype.incrementalPrepareUpdate=function(t){this._clear()},i.prototype.incrementalUpdate=function(t,e,r){var n=this._newAdded[0],o=e.getLayout("points"),s=n&&n.shape.points;if(s&&s.length<2e4){var a=s.length,c=new Float32Array(a+o.length);c.set(s),c.set(o,a),n.endIndex=t.end,n.setShape({points:c})}else{this._newAdded=[];var f=this._create();f.startIndex=t.start,f.endIndex=t.end,f.incremental=!0,f.setShape({points:o}),this._setCommon(f,e,r)}},i.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},i.prototype._create=function(){var t=new WAt({cursor:"default"});return t.ignoreCoarsePointer=!0,this.group.add(t),this._newAdded.push(t),t},i.prototype._setCommon=function(t,e,r){var n=e.hostModel;r=r||{};var o=e.getVisual("symbolSize");t.setShape("size",o instanceof Array?o:[o,o]),t.softClipShape=r.clipShape||null,t.symbolProxy=To(e.getVisual("symbol"),0,0,0,0),t.setColor=t.symbolProxy.setColor;var s=t.shape.size[0]<het;t.useStyle(n.getModel("itemStyle").getItemStyle(s?["color","shadowBlur","shadowColor"]:["color"]));var a=e.getVisual("style"),c=a&&a.fill;c&&t.setColor(c);var f=cr(t);f.seriesIndex=n.seriesIndex,t.on("mousemove",function(g){f.dataIndex=null;var v=t.hoverDataIdx;v>=0&&(f.dataIndex=v+(t.startIndex||0))})},i.prototype.remove=function(){this._clear()},i.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},i}();const ZAt=$At;var qAt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this._updateSymbolDraw(o,e);s.updateData(o,{clipShape:this._getClipShape(e)}),this._finished=!0},t.prototype.incrementalPrepareRender=function(e,r,n){var o=e.getData(),s=this._updateSymbolDraw(o,e);s.incrementalPrepareUpdate(o),this._finished=!1},t.prototype.incrementalRender=function(e,r,n){this._symbolDraw.incrementalUpdate(e,r.getData(),{clipShape:this._getClipShape(r)}),this._finished=e.end===r.getData().count()},t.prototype.updateTransform=function(e,r,n){var o=e.getData();if(this.group.dirty(),!this._finished||o.count()>1e4)return{update:!0};var s=KS("").reset(e,r,n);s.progress&&s.progress({start:0,end:o.count(),count:o.count()},o),this._symbolDraw.updateLayout(o)},t.prototype.eachRendered=function(e){this._symbolDraw&&this._symbolDraw.eachRendered(e)},t.prototype._getClipShape=function(e){if(e.get("clip",!0)){var r=e.coordinateSystem;return r&&r.getArea&&r.getArea(.1)}},t.prototype._updateSymbolDraw=function(e,r){var n=this._symbolDraw,o=r.pipelineContext,s=o.large;return(!n||s!==this._isLargeDraw)&&(n&&n.remove(),n=this._symbolDraw=s?new ZAt:new XS,this._isLargeDraw=s,this.group.removeAll()),this.group.add(n.group),n},t.prototype.remove=function(e,r){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},t.prototype.dispose=function(){},t.type="scatter",t}(ga);const XAt=qAt;var det={left:0,right:0,top:0,bottom:0},lM=["25%","25%"],YAt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.mergeDefaultAndTheme=function(e,r){var n=Pv(e.outerBounds);i.prototype.mergeDefaultAndTheme.apply(this,arguments),n&&e.outerBounds&&Th(e.outerBounds,n)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.apply(this,arguments),this.option.outerBounds&&e.outerBounds&&Th(this.option.outerBounds,e.outerBounds)},t.type="grid",t.dependencies=["xAxis","yAxis"],t.layoutMode="box",t.defaultOption={show:!1,z:0,left:"15%",top:65,right:"10%",bottom:80,containLabel:!1,outerBoundsMode:"auto",outerBounds:det,outerBoundsContain:"all",outerBoundsClampWidth:lM[0],outerBoundsClampHeight:lM[1],backgroundColor:ye.color.transparent,borderWidth:1,borderColor:ye.color.neutral30},t}(gn);const KAt=YAt;var Hz=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",Wa).models[0]},t.type="cartesian2dAxis",t}(gn);Ao(Hz,ZS);var fet={show:!0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:ye.color.axisLine,width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15],breakLine:!0},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12,color:ye.color.axisLabel,textMargin:[0,3]},splitLine:{show:!0,showMinLine:!0,showMaxLine:!0,lineStyle:{color:ye.color.axisSplitLine,width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:[ye.color.backgroundTint,ye.color.backgroundTransparent]}},breakArea:{show:!0,itemStyle:{color:ye.color.neutral00,borderColor:ye.color.border,borderWidth:1,borderType:[3,3],opacity:.6},zigzagAmplitude:4,zigzagMinSpan:4,zigzagMaxSpan:20,zigzagZ:100,expandOnClick:!0},breakLabelLayout:{moveOverlap:"auto"}},JAt=Er({boundaryGap:!0,deduplication:null,jitter:0,jitterOverlap:!0,jitterMargin:2,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto",show:"auto"},axisLabel:{interval:"auto"}},fet),z3=Er({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:ye.color.axisMinorSplitLine,width:1}}},fet),QAt=Er({splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},z3),tIt=rr({logBase:10},z3);const pet={category:JAt,value:z3,time:QAt,log:tIt};var eIt={value:1,category:1,time:1,log:1},jz=null;function iIt(i){jz||(jz=i)}function JS(){return jz}function E0(i,t,e,r){pt(eIt,function(n,o){var s=Er(Er({},pet[o],!0),r,!0),a=function(c){Se(f,c);function f(){var g=c!==null&&c.apply(this,arguments)||this;return g.type=t+"Axis."+o,g}return f.prototype.mergeDefaultAndTheme=function(g,v){var y=lS(this),w=y?Pv(g):{},I=v.getTheme();Er(g,I.get(o+"Axis")),Er(g,this.getDefaultOption()),g.type=LW(g),y&&Th(g,w,y)},f.prototype.optionUpdated=function(){var g=this.option;g.type==="category"&&(this.__ordinalMeta=pS.createByAxisModel(this))},f.prototype.getCategories=function(g){var v=this.option;if(v.type==="category")return g?v.data:this.__ordinalMeta.categories},f.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},f.prototype.updateAxisBreaks=function(g){var v=JS();return v?v.updateModelAxisBreak(this,g):{breaks:[]}},f.type=t+"Axis."+o,f.defaultOption=s,f}(e);i.registerComponentModel(a)}),i.registerSubTypeDefaulter(t+"Axis",LW)}function LW(i){return i.type||(i.data?"category":"value")}var rIt=function(){function i(t){this.type="cartesian",this._dimList=[],this._axes={},this.name=t||""}return i.prototype.getAxis=function(t){return this._axes[t]},i.prototype.getAxes=function(){return ti(this._dimList,function(t){return this._axes[t]},this)},i.prototype.getAxesByScale=function(t){return t=t.toLowerCase(),kn(this.getAxes(),function(e){return e.scale.type===t})},i.prototype.addAxis=function(t){var e=t.dim;this._axes[e]=t,this._dimList.push(e)},i}();const nIt=rIt;var Wz=["x","y"];function RW(i){return(i.type==="interval"||i.type==="time")&&!i.hasBreaks()}var aIt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="cartesian2d",e.dimensions=Wz,e}return t.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var e=this.getAxis("x").scale,r=this.getAxis("y").scale;if(!(!RW(e)||!RW(r))){var n=e.getExtent(),o=r.getExtent(),s=this.dataToPoint([n[0],o[0]]),a=this.dataToPoint([n[1],o[1]]),c=n[1]-n[0],f=o[1]-o[0];if(!(!c||!f)){var g=(a[0]-s[0])/c,v=(a[1]-s[1])/f,y=s[0]-n[0]*g,w=s[1]-o[0]*v,I=this._transform=[g,0,0,v,y,w];this._invTransform=_c([],I)}}},t.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},t.prototype.containPoint=function(e){var r=this.getAxis("x"),n=this.getAxis("y");return r.contain(r.toLocalCoord(e[0]))&&n.contain(n.toLocalCoord(e[1]))},t.prototype.containData=function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])},t.prototype.containZone=function(e,r){var n=this.dataToPoint(e),o=this.dataToPoint(r),s=this.getArea(),a=new sr(n[0],n[1],o[0]-n[0],o[1]-n[1]);return s.intersect(a)},t.prototype.dataToPoint=function(e,r,n){n=n||[];var o=e[0],s=e[1];if(this._transform&&o!=null&&isFinite(o)&&s!=null&&isFinite(s))return fo(n,e,this._transform);var a=this.getAxis("x"),c=this.getAxis("y");return n[0]=a.toGlobalCoord(a.dataToCoord(o,r)),n[1]=c.toGlobalCoord(c.dataToCoord(s,r)),n},t.prototype.clampData=function(e,r){var n=this.getAxis("x").scale,o=this.getAxis("y").scale,s=n.getExtent(),a=o.getExtent(),c=n.parse(e[0]),f=o.parse(e[1]);return r=r||[],r[0]=Math.min(Math.max(Math.min(s[0],s[1]),c),Math.max(s[0],s[1])),r[1]=Math.min(Math.max(Math.min(a[0],a[1]),f),Math.max(a[0],a[1])),r},t.prototype.pointToData=function(e,r,n){if(n=n||[],this._invTransform)return fo(n,e,this._invTransform);var o=this.getAxis("x"),s=this.getAxis("y");return n[0]=o.coordToData(o.toLocalCoord(e[0]),r),n[1]=s.coordToData(s.toLocalCoord(e[1]),r),n},t.prototype.getOtherAxis=function(e){return this.getAxis(e.dim==="x"?"y":"x")},t.prototype.getArea=function(e){e=e||0;var r=this.getAxis("x").getGlobalExtent(),n=this.getAxis("y").getGlobalExtent(),o=Math.min(r[0],r[1])-e,s=Math.min(n[0],n[1])-e,a=Math.max(r[0],r[1])-o+e,c=Math.max(n[0],n[1])-s+e;return new sr(o,s,a,c)},t}(nIt),oIt=function(i){Se(t,i);function t(e,r,n,o,s){var a=i.call(this,e,r,n)||this;return a.index=0,a.type=o||"value",a.position=s||"bottom",a}return t.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"},t.prototype.getGlobalExtent=function(e){var r=this.getExtent();return r[0]=this.toGlobalCoord(r[0]),r[1]=this.toGlobalCoord(r[1]),e&&r[0]>r[1]&&r.reverse(),r},t.prototype.pointToData=function(e,r){return this.coordToData(this.toLocalCoord(e[this.dim==="x"?0:1]),r)},t.prototype.setCategorySortInfo=function(e){if(this.type!=="category")return!1;this.model.option.categorySortInfo=e,this.scale.setSortInfo(e)},t}(Sc);const get=oIt;var ME="expandAxisBreak",met="collapseAxisBreak",vet="toggleAxisBreak",B3="axisbreakchanged",sIt={type:ME,event:B3,update:"update",refineEvent:F3},lIt={type:met,event:B3,update:"update",refineEvent:F3},uIt={type:vet,event:B3,update:"update",refineEvent:F3};function F3(i,t,e,r){var n=[];return pt(i,function(o){n=n.concat(o.eventBreaks)}),{eventContent:{breaks:n}}}function cIt(i){i.registerAction(sIt,t),i.registerAction(lIt,t),i.registerAction(uIt,t);function t(e,r){var n=[],o=u0(r,e);function s(a,c){pt(o[a],function(f){var g=f.updateAxisBreaks(e);pt(g.breaks,function(v){var y;n.push(rr((y={},y[c]=f.componentIndex,y),v))})})}return s("xAxisModels","xAxisIndex"),s("yAxisModels","yAxisIndex"),s("singleAxisModels","singleAxisIndex"),{eventBreaks:n}}}var _p=Math.PI,hIt=[[1,2,1,2],[5,3,5,3],[8,3,8,3]],dIt=[[0,1,0,1],[0,3,0,3],[0,3,0,3]],D0=Wr(),_et=Wr(),yet=function(){function i(t){this.recordMap={},this.resolveAxisNameOverlap=t}return i.prototype.ensureRecord=function(t){var e=t.axis.dim,r=t.componentIndex,n=this.recordMap,o=n[e]||(n[e]=[]);return o[r]||(o[r]={ready:{}})},i}();function fIt(i,t,e,r){var n=e.axis,o=t.ensureRecord(e),s=[],a,c=N3(i.axisName)&&C0(i.nameLocation);pt(r,function(I){var E=Ah(I);if(!(!E||E.label.ignore)){s.push(E);var D=o.transGroup;c&&(D.transform?_c(Mb,D.transform):tE(Mb),E.transform&&ph(Mb,Mb,E.transform),sr.copy(JA,E.localRect),JA.applyTransform(Mb),a?a.union(JA):sr.copy(a=new sr(0,0,0,0),JA))}});var f=Math.abs(o.dirVec.x)>.1?"x":"y",g=o.transGroup[f];if(s.sort(function(I,E){return Math.abs(I.label[f]-g)-Math.abs(E.label[f]-g)}),c&&a){var v=n.getExtent(),y=Math.min(v[0],v[1]),w=Math.max(v[0],v[1])-y;a.union(new sr(y,0,w,1))}o.stOccupiedRect=a,o.labelInfoList=s}var Mb=as(),JA=new sr(0,0,0,0),xet=function(i,t,e,r,n,o){if(C0(i.nameLocation)){var s=o.stOccupiedRect;s&&bet(jTt({},s,o.transGroup.transform),r,n)}else wet(o.labelInfoList,o.dirVec,r,n)};function bet(i,t,e){var r=new er;IE(i,t,r,{direction:Math.atan2(e.y,e.x),bidirectional:!1,touchThreshold:.05})&&zz(t,r)}function wet(i,t,e,r){for(var n=er.dot(r,t)>=0,o=0,s=i.length;o<s;o++){var a=i[n?o:s-1-o];a.label.ignore||bet(a,e,r)}}var dv=function(){function i(t,e,r,n){this.group=new Ki,this._axisModel=t,this._api=e,this._local={},this._shared=n||new yet(xet),this._resetCfgDetermined(r)}return i.prototype.updateCfg=function(t){var e=this._cfg.raw;e.position=t.position,e.labelOffset=t.labelOffset,this._resetCfgDetermined(e)},i.prototype.__getRawCfg=function(){return this._cfg.raw},i.prototype._resetCfgDetermined=function(t){var e=this._axisModel,r=e.getDefaultOption?e.getDefaultOption():{},n=Ui(t.axisName,e.get("name")),o=e.get("nameMoveOverlap");(o==null||o==="auto")&&(o=Ui(t.defaultNameMoveOverlap,!0));var s={raw:t,position:t.position,rotation:t.rotation,nameDirection:Ui(t.nameDirection,1),tickDirection:Ui(t.tickDirection,1),labelDirection:Ui(t.labelDirection,1),labelOffset:Ui(t.labelOffset,0),silent:Ui(t.silent,!0),axisName:n,nameLocation:iu(e.get("nameLocation"),r.nameLocation,"end"),shouldNameMoveOverlap:N3(n)&&o,optionHideOverlap:e.get(["axisLabel","hideOverlap"]),showMinorTicks:e.get(["minorTick","show"])};this._cfg=s;var a=new Ki({x:s.position[0],y:s.position[1],rotation:s.rotation});a.updateTransform(),this._transformGroup=a;var c=this._shared.ensureRecord(e);c.transGroup=this._transformGroup,c.dirVec=new er(Math.cos(-s.rotation),Math.sin(-s.rotation))},i.prototype.build=function(t,e){var r=this;return t||(t={axisLine:!0,axisTickLabelEstimate:!1,axisTickLabelDetermine:!0,axisName:!0}),pt(pIt,function(n){t[n]&&gIt[n](r._cfg,r._local,r._shared,r._axisModel,r.group,r._transformGroup,r._api,e||{})}),this},i.innerTextLayout=function(t,e,r){var n=JY(e-t),o,s;return eS(n)?(s=r>0?"top":"bottom",o="center"):eS(n-_p)?(s=r>0?"bottom":"top",o="center"):(s="middle",n>0&&n<_p?o=r>0?"right":"left":o=r>0?"left":"right"),{rotation:n,textAlign:o,textVerticalAlign:s}},i.makeAxisEventDataBase=function(t){var e={componentType:t.mainType,componentIndex:t.componentIndex};return e[t.mainType+"Index"]=t.componentIndex,e},i.isLabelSilent=function(t){var e=t.get("tooltip");return t.get("silent")||!(t.get("triggerEvent")||e&&e.show)},i}(),pIt=["axisLine","axisTickLabelEstimate","axisTickLabelDetermine","axisName"],gIt={axisLine:function(i,t,e,r,n,o,s){var a=r.get(["axisLine","show"]);if(a==="auto"&&(a=!0,i.raw.axisLineAutoShow!=null&&(a=!!i.raw.axisLineAutoShow)),!!a){var c=r.axis.getExtent(),f=o.transform,g=[c[0],0],v=[c[1],0],y=g[0]>v[0];f&&(fo(g,g,f),fo(v,v,f));var w=Ne({lineCap:"round"},r.getModel(["axisLine","lineStyle"]).getLineStyle()),I={strokeContainThreshold:i.raw.strokeContainThreshold||5,silent:!0,z2:1,style:w};if(r.get(["axisLine","breakLine"])&&r.axis.scale.hasBreaks())JS().buildAxisBreakLine(r,n,o,I);else{var E=new Oo(Ne({shape:{x1:g[0],y1:g[1],x2:v[0],y2:v[1]}},I));S0(E.shape,E.style.lineWidth),E.anid="line",n.add(E)}var D=r.get(["axisLine","symbol"]);if(D!=null){var R=r.get(["axisLine","symbolSize"]);wi(D)&&(D=[D,D]),(wi(R)||fn(R))&&(R=[R,R]);var z=Rv(r.get(["axisLine","symbolOffset"])||0,R),N=R[0],H=R[1];pt([{rotate:i.rotation+Math.PI/2,offset:z[0],r:0},{rotate:i.rotation-Math.PI/2,offset:z[1],r:Math.sqrt((g[0]-v[0])*(g[0]-v[0])+(g[1]-v[1])*(g[1]-v[1]))}],function(q,Y){if(D[Y]!=="none"&&D[Y]!=null){var J=To(D[Y],-N/2,-H/2,N,H,w.stroke,!0),it=q.r+q.offset,at=y?v:g;J.attr({rotation:q.rotate,x:at[0]+it*Math.cos(i.rotation),y:at[1]-it*Math.sin(i.rotation),silent:!0,z2:11}),n.add(J)}})}}},axisTickLabelEstimate:function(i,t,e,r,n,o,s,a){var c=OW(t,n,a);c&&kW(i,t,e,r,n,o,s,xc.estimate)},axisTickLabelDetermine:function(i,t,e,r,n,o,s,a){var c=OW(t,n,a);c&&kW(i,t,e,r,n,o,s,xc.determine);var f=yIt(i,n,o,r);_It(i,t.labelLayoutList,f),xIt(i,n,o,r,i.tickDirection)},axisName:function(i,t,e,r,n,o,s,a){var c=e.ensureRecord(r);t.nameEl&&(n.remove(t.nameEl),t.nameEl=c.nameLayout=c.nameLocation=null);var f=i.axisName;if(N3(f)){var g=i.nameLocation,v=i.nameDirection,y=r.getModel("nameTextStyle"),w=r.get("nameGap")||0,I=r.axis.getExtent(),E=r.axis.inverse?-1:1,D=new er(0,0),R=new er(0,0);g==="start"?(D.x=I[0]-E*w,R.x=-E):g==="end"?(D.x=I[1]+E*w,R.x=E):(D.x=(I[0]+I[1])/2,D.y=i.labelOffset+v*w,R.y=v);var z=as();R.transform(jp(z,z,i.rotation));var N=r.get("nameRotate");N!=null&&(N=N*_p/180);var H,q;C0(g)?H=dv.innerTextLayout(i.rotation,N??i.rotation,v):(H=mIt(i.rotation,g,N||0,I),q=i.raw.axisNameAvailableWidth,q!=null&&(q=Math.abs(q/Math.sin(H.rotation)),!isFinite(q)&&(q=null)));var Y=y.getFont(),J=r.get("nameTruncate",!0)||{},it=J.ellipsis,at=vs(i.raw.nameTruncateMaxWidth,J.maxWidth,q),ut=a.nameMarginLevel||0,ft=new _n({x:D.x,y:D.y,rotation:H.rotation,silent:dv.isLabelSilent(r),style:pa(y,{text:f,font:Y,overflow:"truncate",width:at,ellipsis:it,fill:y.getTextColor()||r.get(["axisLine","lineStyle","color"]),align:y.get("align")||H.textAlign,verticalAlign:y.get("verticalAlign")||H.textVerticalAlign}),z2:1});if(Wd({el:ft,componentModel:r,itemName:f}),ft.__fullText=f,ft.anid="name",r.get("triggerEvent")){var _t=dv.makeAxisEventDataBase(r);_t.targetType="axisName",_t.name=f,cr(ft).eventData=_t}o.add(ft),ft.updateTransform(),t.nameEl=ft;var ct=c.nameLayout=Ah({label:ft,priority:ft.z2,defaultAttr:{ignore:ft.ignore},marginDefault:C0(g)?hIt[ut]:dIt[ut]});if(c.nameLocation=g,n.add(ft),ft.decomposeTransform(),i.shouldNameMoveOverlap&&ct){var Dt=e.ensureRecord(r);e.resolveAxisNameOverlap(i,e,r,ct,R,Dt)}}}};function kW(i,t,e,r,n,o,s,a){Aet(t)||bIt(i,t,n,a,r,s);var c=t.labelLayoutList;wIt(i,r,c,o),AIt(r,i.rotation,c);var f=i.optionHideOverlap;vIt(r,c,f),f&&Ltt(kn(c,function(g){return g&&!g.label.ignore})),fIt(i,e,r,c)}function mIt(i,t,e,r){var n=JY(e-i),o,s,a=r[0]>r[1],c=t==="start"&&!a||t!=="start"&&a;return eS(n-_p/2)?(s=c?"bottom":"top",o="center"):eS(n-_p*1.5)?(s=c?"top":"bottom",o="center"):(s="middle",n<_p*1.5&&n>_p/2?o=c?"left":"right":o=c?"right":"left"),{rotation:n,textAlign:o,textVerticalAlign:s}}function vIt(i,t,e){if(gtt(i.axis))return;function r(a,c,f){var g=Ah(t[c]),v=Ah(t[f]);if(!(!g||!v)){if(a===!1||g.suggestIgnore){aw(g.label);return}if(v.suggestIgnore){aw(v.label);return}var y=.1;if(!e){var w=[0,0,0,0];g=Bz({marginForce:w},g),v=Bz({marginForce:w},v)}IE(g,v,null,{touchThreshold:y})&&aw(a?v.label:g.label)}}var n=i.get(["axisLabel","showMinLabel"]),o=i.get(["axisLabel","showMaxLabel"]),s=t.length;r(n,0,1),r(o,s-1,s-2)}function _It(i,t,e){i.showMinorTicks||pt(t,function(r){if(r&&r.label.ignore)for(var n=0;n<e.length;n++){var o=e[n],s=_et(o),a=D0(r.label);if(s.tickValue!=null&&!s.onBand&&s.tickValue===a.tickValue){aw(o);return}}})}function aw(i){i&&(i.ignore=!0)}function Tet(i,t,e,r,n){for(var o=[],s=[],a=[],c=0;c<i.length;c++){var f=i[c].coord;s[0]=f,s[1]=0,a[0]=f,a[1]=e,t&&(fo(s,s,t),fo(a,a,t));var g=new Oo({shape:{x1:s[0],y1:s[1],x2:a[0],y2:a[1]},style:r,z2:2,autoBatch:!0,silent:!0});S0(g.shape,g.style.lineWidth),g.anid=n+"_"+i[c].tickValue,o.push(g);var v=_et(g);v.onBand=!!i[c].onBand,v.tickValue=i[c].tickValue}return o}function yIt(i,t,e,r){var n=r.axis,o=r.getModel("axisTick"),s=o.get("show");if(s==="auto"&&(s=!0,i.raw.axisTickAutoShow!=null&&(s=!!i.raw.axisTickAutoShow)),!s||n.scale.isBlank())return[];for(var a=o.getModel("lineStyle"),c=i.tickDirection*o.get("length"),f=n.getTicksCoords(),g=Tet(f,e.transform,c,rr(a.getLineStyle(),{stroke:r.get(["axisLine","lineStyle","color"])}),"ticks"),v=0;v<g.length;v++)t.add(g[v]);return g}function xIt(i,t,e,r,n){var o=r.axis,s=r.getModel("minorTick");if(!(!i.showMinorTicks||o.scale.isBlank())){var a=o.getMinorTicksCoords();if(a.length)for(var c=s.getModel("lineStyle"),f=n*s.get("length"),g=rr(c.getLineStyle(),rr(r.getModel("axisTick").getLineStyle(),{stroke:r.get(["axisLine","lineStyle","color"])})),v=0;v<a.length;v++)for(var y=Tet(a[v],e.transform,f,g,"minorticks_"+v),w=0;w<y.length;w++)t.add(y[w])}}function OW(i,t,e){if(Aet(i)){var r=i.axisLabelsCreationContext,n=r.out.noPxChangeTryDetermine;if(e.noPxChange){for(var o=!0,s=0;s<n.length;s++)o=o&&n[s]();if(o)return!1}n.length&&(t.remove(i.labelGroup),$z(i,null,null,null))}return!0}function bIt(i,t,e,r,n,o){var s=n.axis,a=vs(i.raw.axisLabelShow,n.get(["axisLabel","show"])),c=new Ki;e.add(c);var f=tM(r);if(!a||s.scale.isBlank()){$z(t,[],c,f);return}var g=n.getModel("axisLabel"),v=s.getViewLabels(f),y=(vs(i.raw.labelRotate,g.get("rotate"))||0)*_p/180,w=dv.innerTextLayout(i.rotation,y,i.labelDirection),I=n.getCategories&&n.getCategories(!0),E=[],D=n.get("triggerEvent"),R=1/0,z=-1/0;pt(v,function(H,q){var Y,J=s.scale.type==="ordinal"?s.scale.getRawOrdinalNumber(H.tickValue):H.tickValue,it=H.formattedLabel,at=H.rawLabel,ut=g;if(I&&I[J]){var ft=I[J];nr(ft)&&ft.textStyle&&(ut=new bn(ft.textStyle,g,n.ecModel))}var _t=ut.getTextColor()||n.get(["axisLine","lineStyle","color"]),ct=ut.getShallow("align",!0)||w.textAlign,Dt=Ui(ut.getShallow("alignMinLabel",!0),ct),Et=Ui(ut.getShallow("alignMaxLabel",!0),ct),bt=ut.getShallow("verticalAlign",!0)||ut.getShallow("baseline",!0)||w.textVerticalAlign,Vt=Ui(ut.getShallow("verticalAlignMinLabel",!0),bt),zt=Ui(ut.getShallow("verticalAlignMaxLabel",!0),bt),Jt=10+(((Y=H.time)===null||Y===void 0?void 0:Y.level)||0);R=Math.min(R,Jt),z=Math.max(z,Jt);var ce=new _n({x:0,y:0,rotation:0,silent:dv.isLabelSilent(n),z2:Jt,style:pa(ut,{text:it,align:q===0?Dt:q===v.length-1?Et:ct,verticalAlign:q===0?Vt:q===v.length-1?zt:bt,fill:Xi(_t)?_t(s.type==="category"?at:s.type==="value"?J+"":J,q):_t})});ce.anid="label_"+J;var be=D0(ce);if(be.break=H.break,be.tickValue=J,be.layoutRotation=w.rotation,Wd({el:ce,componentModel:n,itemName:it,formatterParamsExtra:{isTruncated:function(){return ce.isTruncated},value:at,tickIndex:q}}),D){var ve=dv.makeAxisEventDataBase(n);ve.targetType="axisLabel",ve.value=at,ve.tickIndex=q,H.break&&(ve.break={start:H.break.parsedBreak.vmin,end:H.break.parsedBreak.vmax}),s.type==="category"&&(ve.dataIndex=J),cr(ce).eventData=ve,H.break&&TIt(n,o,ce,H.break)}E.push(ce),c.add(ce)});var N=ti(E,function(H){return{label:H,priority:D0(H).break?H.z2+(z-R+1):H.z2,defaultAttr:{ignore:H.ignore}}});$z(t,N,c,f)}function Aet(i){return!!i.labelLayoutList}function $z(i,t,e,r){i.labelLayoutList=t,i.labelGroup=e,i.axisLabelsCreationContext=r}function wIt(i,t,e,r){var n=t.get(["axisLabel","margin"]);pt(e,function(o,s){var a=Ah(o);if(a){var c=a.label,f=D0(c);a.suggestIgnore=c.ignore,c.ignore=!1,RC(nd,SIt),nd.x=t.axis.dataToCoord(f.tickValue),nd.y=i.labelOffset+i.labelDirection*n,nd.rotation=f.layoutRotation,r.add(nd),nd.updateTransform(),r.remove(nd),nd.decomposeTransform(),RC(c,nd),c.markRedraw(),nM(a,!0),Ah(a)}})}var nd=new jr,SIt=new jr;function N3(i){return!!i}function TIt(i,t,e,r){e.on("click",function(n){var o={type:ME,breaks:[{start:r.parsedBreak.breakOption.start,end:r.parsedBreak.breakOption.end}]};o[i.axis.dim+"AxisIndex"]=i.componentIndex,t.dispatchAction(o)})}function AIt(i,t,e){var r=bo();if(r){var n=r.retrieveAxisBreakPairs(e,function(s){return s&&D0(s.label).break},!0),o=i.get(["breakLabelLayout","moveOverlap"],!0);(o===!0||o==="auto")&&pt(n,function(s){JS().adjustBreakLabelPair(i.axis.inverse,t,[Ah(e[s[0]]),Ah(e[s[1]])])})}}const Fd=dv;function uM(i,t,e){e=e||{};var r=t.axis,n={},o=r.getAxesOnZeroOf()[0],s=r.position,a=o?"onZero":s,c=r.dim,f=[i.x,i.x+i.width,i.y,i.y+i.height],g={left:0,right:1,top:0,bottom:1,onZero:2},v=t.get("offset")||0,y=c==="x"?[f[2]-v,f[3]+v]:[f[0]-v,f[1]+v];if(o){var w=o.toGlobalCoord(o.dataToCoord(0));y[g.onZero]=Math.max(Math.min(w,y[1]),y[0])}n.position=[c==="y"?y[g[a]]:f[0],c==="x"?y[g[a]]:f[3]],n.rotation=Math.PI/2*(c==="x"?0:1);var I={top:-1,bottom:1,left:-1,right:1};n.labelDirection=n.tickDirection=n.nameDirection=I[s],n.labelOffset=o?y[g[s]]-y[g.onZero]:0,t.get(["axisTick","inside"])&&(n.tickDirection=-n.tickDirection),vs(e.labelInside,t.get(["axisLabel","inside"]))&&(n.labelDirection=-n.labelDirection);var E=t.get(["axisLabel","rotate"]);return n.labelRotate=a==="top"?-E:E,n.z2=1,n}function IIt(i){return i.coordinateSystem&&i.coordinateSystem.type==="cartesian2d"}function zW(i){var t={xAxisModel:null,yAxisModel:null};return pt(t,function(e,r){var n=r.replace(/Model$/,""),o=i.getReferringComponents(n,Wa).models[0];t[r]=o}),t}function CIt(i,t,e,r,n,o){for(var s=uM(i,e),a=!1,c=!1,f=0;f<t.length;f++)Pz(t[f].getOtherAxis(e.axis).scale)&&(a=c=!0,e.axis.type==="category"&&e.axis.onBand&&(c=!1));return s.axisLineAutoShow=a,s.axisTickAutoShow=c,s.defaultNameMoveOverlap=o,new Fd(e,r,s,n)}function MIt(i,t,e){var r=uM(t,e);i.updateCfg(r)}function Iet(i,t,e){var r=Bp.prototype,n=r.getTicks.call(e),o=r.getTicks.call(e,{expandToNicedExtent:!0}),s=n.length-1,a=r.getInterval.call(e),c=ptt(i,t),f=c.extent,g=c.fixMin,v=c.fixMax;i.type==="log"&&(f=Lz(i.base,f,!0)),i.setBreaksFromOption(mtt(t)),i.setExtent(f[0],f[1]),i.calcNiceExtent({splitNumber:s,fixMin:g,fixMax:v});var y=r.getExtent.call(i);g&&(f[0]=y[0]),v&&(f[1]=y[1]);var w=r.getInterval.call(i),I=f[0],E=f[1];if(g&&v)w=(E-I)/s;else if(g)for(E=f[0]+w*s;E<f[1]&&isFinite(E)&&isFinite(f[1]);)w=xR(w),E=f[0]+w*s;else if(v)for(I=f[1]-w*s;I>f[0]&&isFinite(I)&&isFinite(f[0]);)w=xR(w),I=f[1]-w*s;else{var D=i.getTicks().length-1;D>s&&(w=xR(w));var R=w*s;E=Math.ceil(f[1]/w)*w,I=xo(E-R),I<0&&f[0]>=0?(I=0,E=xo(R)):E>0&&f[1]<=0&&(E=0,I=-xo(R))}var z=(n[0].value-o[0].value)/a,N=(n[s].value-o[s].value)/a;r.setExtent.call(i,I+w*z,E+w*N),r.setInterval.call(i,w),(z||N)&&r.setNiceExtent.call(i,I+w,E-w)}var BW=[[3,1],[0,2]],EIt=function(){function i(t,e,r){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=Wz,this._initCartesian(t,e,r),this.model=t}return i.prototype.getRect=function(){return this._rect},i.prototype.update=function(t,e){var r=this._axesMap;this._updateScale(t,this.model);function n(s){var a,c=on(s),f=c.length;if(f){for(var g=[],v=f-1;v>=0;v--){var y=+c[v],w=s[y],I=w.model,E=w.scale;Pz(E)&&I.get("alignTicks")&&I.get("interval")==null?g.push(w):(I0(E,I),Pz(E)&&(a=w))}g.length&&(a||(a=g.pop(),I0(a.scale,a.model)),pt(g,function(D){Iet(D.scale,D.model,a.scale)}))}}n(r.x),n(r.y);var o={};pt(r.x,function(s){FW(r,"y",s,o)}),pt(r.y,function(s){FW(r,"x",s,o)}),this.resize(this.model,e)},i.prototype.resize=function(t,e,r){var n=No(t,e),o=this._rect=Ma(t.getBoxLayoutParams(),n.refContainer),s=this._axesMap,a=this._coordsList,c=t.get("containLabel");if(Zz(s,o),!r){var f=LIt(o,a,s,c,e),g=void 0;if(c)qz?(qz(this._axesList,o),Zz(s,o)):g=UW(o.clone(),"axisLabel",null,o,s,f,n);else{var v=RIt(t,o,n),y=v.outerBoundsRect,w=v.parsedOuterBoundsContain,I=v.outerBoundsClamp;y&&(g=UW(y,w,I,o,s,f,n))}Cet(o,s,xc.determine,null,g,n)}pt(this._coordsList,function(E){E.calcAffineTransform()})},i.prototype.getAxis=function(t,e){var r=this._axesMap[t];if(r!=null)return r[e||0]},i.prototype.getAxes=function(){return this._axesList.slice()},i.prototype.getCartesian=function(t,e){if(t!=null&&e!=null){var r="x"+t+"y"+e;return this._coordsMap[r]}nr(t)&&(e=t.yAxisIndex,t=t.xAxisIndex);for(var n=0,o=this._coordsList;n<o.length;n++)if(o[n].getAxis("x").index===t||o[n].getAxis("y").index===e)return o[n]},i.prototype.getCartesians=function(){return this._coordsList.slice()},i.prototype.convertToPixel=function(t,e,r){var n=this._findConvertTarget(e);return n.cartesian?n.cartesian.dataToPoint(r):n.axis?n.axis.toGlobalCoord(n.axis.dataToCoord(r)):null},i.prototype.convertFromPixel=function(t,e,r){var n=this._findConvertTarget(e);return n.cartesian?n.cartesian.pointToData(r):n.axis?n.axis.coordToData(n.axis.toLocalCoord(r)):null},i.prototype._findConvertTarget=function(t){var e=t.seriesModel,r=t.xAxisModel||e&&e.getReferringComponents("xAxis",Wa).models[0],n=t.yAxisModel||e&&e.getReferringComponents("yAxis",Wa).models[0],o=t.gridModel,s=this._coordsList,a,c;if(e)a=e.coordinateSystem,Ar(s,a)<0&&(a=null);else if(r&&n)a=this.getCartesian(r.componentIndex,n.componentIndex);else if(r)c=this.getAxis("x",r.componentIndex);else if(n)c=this.getAxis("y",n.componentIndex);else if(o){var f=o.coordinateSystem;f===this&&(a=this._coordsList[0])}return{cartesian:a,axis:c}},i.prototype.containPoint=function(t){var e=this._coordsList[0];if(e)return e.containPoint(t)},i.prototype._initCartesian=function(t,e,r){var n=this,o=this,s={left:!1,right:!1,top:!1,bottom:!1},a={x:{},y:{}},c={x:0,y:0};if(e.eachComponent("xAxis",f("x"),this),e.eachComponent("yAxis",f("y"),this),!c.x||!c.y){this._axesMap={},this._axesList=[];return}this._axesMap=a,pt(a.x,function(g,v){pt(a.y,function(y,w){var I="x"+v+"y"+w,E=new aIt(I);E.master=n,E.model=t,n._coordsMap[I]=E,n._coordsList.push(E),E.addAxis(g),E.addAxis(y)})});function f(g){return function(v,y){if(zR(v,t)){var w=v.get("position");g==="x"?w!=="top"&&w!=="bottom"&&(w=s.bottom?"top":"bottom"):w!=="left"&&w!=="right"&&(w=s.left?"right":"left"),s[w]=!0;var I=new get(g,AE(v),[0,0],v.get("type"),w),E=I.type==="category";I.onBand=E&&v.get("boundaryGap"),I.inverse=v.get("inverse"),v.axis=I,I.model=v,I.grid=o,I.index=y,o._axesList.push(I),a[g][y]=I,c[g]++}}}},i.prototype._updateScale=function(t,e){pt(this._axesList,function(n){if(n.scale.setExtent(1/0,-1/0),n.type==="category"){var o=n.model.get("categorySortInfo");n.scale.setSortInfo(o)}}),t.eachSeries(function(n){if(IIt(n)){var o=zW(n),s=o.xAxisModel,a=o.yAxisModel;if(!zR(s,e)||!zR(a,e))return;var c=this.getCartesian(s.componentIndex,a.componentIndex),f=n.getData(),g=c.getAxis("x"),v=c.getAxis("y");r(f,g),r(f,v)}},this);function r(n,o){pt(QC(n,o.dim),function(s){o.scale.unionExtentFromData(n,s)})}},i.prototype.getTooltipAxes=function(t){var e=[],r=[];return pt(this.getCartesians(),function(n){var o=t!=null&&t!=="auto"?n.getAxis(t):n.getBaseAxis(),s=n.getOtherAxis(o);Ar(e,o)<0&&e.push(o),Ar(r,s)<0&&r.push(s)}),{baseAxes:e,otherAxes:r}},i.create=function(t,e){var r=[];return t.eachComponent("grid",function(n,o){var s=new i(n,t,e);s.name="grid_"+o,s.resize(n,e,!0),n.coordinateSystem=s,r.push(s)}),t.eachSeries(function(n){jS({targetModel:n,coordSysType:"cartesian2d",coordSysProvider:o});function o(){var s=zW(n),a=s.xAxisModel,c=s.yAxisModel,f=a.getCoordSysModel(),g=f.coordinateSystem;return g.getCartesian(a.componentIndex,c.componentIndex)}}),r},i.dimensions=Wz,i}();function zR(i,t){return i.getCoordSysModel()===t}function FW(i,t,e,r){e.getAxesOnZeroOf=function(){return o?[o]:[]};var n=i[t],o,s=e.model,a=s.get(["axisLine","onZero"]),c=s.get(["axisLine","onZeroAxisIndex"]);if(!a)return;if(c!=null)NW(n[c])&&(o=n[c]);else for(var f in n)if(n.hasOwnProperty(f)&&NW(n[f])&&!r[g(n[f])]){o=n[f];break}o&&(r[g(o)]=!0);function g(v){return v.dim+"_"+v.index}}function NW(i){return i&&i.type!=="category"&&i.type!=="time"&&fTt(i)}function DIt(i,t){var e=i.getExtent(),r=e[0]+e[1];i.toGlobalCoord=i.dim==="x"?function(n){return n+t}:function(n){return r-n+t},i.toLocalCoord=i.dim==="x"?function(n){return n-t}:function(n){return r-n+t}}function Zz(i,t){pt(i.x,function(e){return VW(e,t.x,t.width)}),pt(i.y,function(e){return VW(e,t.y,t.height)})}function VW(i,t,e){var r=[0,e],n=i.inverse?1:0;i.setExtent(r[n],r[1-n]),DIt(i,t)}var qz;function PIt(i){qz=i}function UW(i,t,e,r,n,o,s){Cet(r,n,xc.estimate,t,!1,s);var a=[0,0,0,0];f(0),f(1),g(r,0,NaN),g(r,1,NaN);var c=Iv(a,function(y){return y>0})==null;return xv(r,a,!0,!0,e),Zz(n,r),c;function f(y){pt(n[vr[y]],function(w){if(mS(w.model)){var I=o.ensureRecord(w.model),E=I.labelInfoList;if(E)for(var D=0;D<E.length;D++){var R=E[D],z=w.scale.normalize(D0(R.label).tickValue);z=y===1?1-z:z,g(R.rect,y,z),g(R.rect,1-y,NaN)}var N=I.nameLayout;if(N){var z=C0(I.nameLocation)?.5:NaN;g(N.rect,y,z),g(N.rect,1-y,NaN)}}})}function g(y,w,I){var E=i[vr[w]]-y[vr[w]],D=y[wo[w]]+y[vr[w]]-(i[wo[w]]+i[vr[w]]);E=v(E,1-I),D=v(D,I);var R=BW[w][0],z=BW[w][1];a[R]=co(a[R],E),a[z]=co(a[z],D)}function v(y,w){return y>0&&!Bs(w)&&w>1e-4&&(y/=w),y}}function LIt(i,t,e,r,n){var o=new yet(kIt);return pt(e,function(s){return pt(s,function(a){if(mS(a.model)){var c=!r;a.axisBuilder=CIt(i,t,a.model,n,o,c)}})}),o}function Cet(i,t,e,r,n,o){var s=e===xc.determine;pt(t,function(f){return pt(f,function(g){mS(g.model)&&(MIt(g.axisBuilder,i,g.model),g.axisBuilder.build(s?{axisTickLabelDetermine:!0}:{axisTickLabelEstimate:!0},{noPxChange:n}))})});var a={x:0,y:0};c(0),c(1);function c(f){a[vr[1-f]]=i[wo[f]]<=o.refContainer[wo[f]]*.5?0:1-f===1?2:1}pt(t,function(f,g){return pt(f,function(v){mS(v.model)&&((r==="all"||s)&&v.axisBuilder.build({axisName:!0},{nameMarginLevel:a[g]}),s&&v.axisBuilder.build({axisLine:!0}))})})}function RIt(i,t,e){var r,n=i.get("outerBoundsMode",!0);n==="same"?r=t.clone():(n==null||n==="auto")&&(r=Ma(i.get("outerBounds",!0)||det,e.refContainer));var o=i.get("outerBoundsContain",!0),s;o==null||o==="auto"||Ar(["all","axisLabel"],o)<0?s="all":s=o;var a=[OC(Ui(i.get("outerBoundsClampWidth",!0),lM[0]),t.width),OC(Ui(i.get("outerBoundsClampHeight",!0),lM[1]),t.height)];return{outerBoundsRect:r,parsedOuterBoundsContain:s,outerBoundsClamp:a}}var kIt=function(i,t,e,r,n,o){var s=e.axis.dim==="x"?"y":"x";xet(i,t,e,r,n,o),C0(i.nameLocation)||pt(t.recordMap[s],function(a){a&&a.labelInfoList&&a.dirVec&&wet(a.labelInfoList,a.dirVec,r,n)})};const OIt=EIt;function zIt(i,t){var e={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return BIt(e,i,t),e.seriesInvolved&&NIt(e,i),e}function BIt(i,t,e){var r=t.getComponent("tooltip"),n=t.getComponent("axisPointer"),o=n.get("link",!0)||[],s=[];pt(e.getCoordinateSystems(),function(a){if(!a.axisPointerEnabled)return;var c=yS(a.model),f=i.coordSysAxesInfo[c]={};i.coordSysMap[c]=a;var g=a.model,v=g.getModel("tooltip",r);if(pt(a.getAxes(),br(E,!1,null)),a.getTooltipAxes&&r&&v.get("show")){var y=v.get("trigger")==="axis",w=v.get(["axisPointer","type"])==="cross",I=a.getTooltipAxes(v.get(["axisPointer","axis"]));(y||w)&&pt(I.baseAxes,br(E,w?"cross":!0,y)),w&&pt(I.otherAxes,br(E,"cross",!1))}function E(D,R,z){var N=z.model.getModel("axisPointer",n),H=N.get("show");if(!(!H||H==="auto"&&!D&&!Xz(N))){R==null&&(R=N.get("triggerTooltip")),N=D?FIt(z,v,n,t,D,R):N;var q=N.get("snap"),Y=N.get("triggerEmphasis"),J=yS(z.model),it=R||q||z.type==="category",at=i.axesInfo[J]={key:J,axis:z,coordSys:a,axisPointerModel:N,triggerTooltip:R,triggerEmphasis:Y,involveSeries:it,snap:q,useHandle:Xz(N),seriesModels:[],linkGroup:null};f[J]=at,i.seriesInvolved=i.seriesInvolved||it;var ut=VIt(o,z);if(ut!=null){var ft=s[ut]||(s[ut]={axesInfo:{}});ft.axesInfo[J]=at,ft.mapper=o[ut].mapper,at.linkGroup=ft}}}})}function FIt(i,t,e,r,n,o){var s=t.getModel("axisPointer"),a=["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],c={};pt(a,function(y){c[y]=Yi(s.get(y))}),c.snap=i.type!=="category"&&!!o,s.get("type")==="cross"&&(c.type="line");var f=c.label||(c.label={});if(f.show==null&&(f.show=!1),n==="cross"){var g=s.get(["label","show"]);if(f.show=g??!0,!o){var v=c.lineStyle=s.get("crossStyle");v&&rr(f,v.textStyle)}}return i.model.getModel("axisPointer",new bn(c,e,r))}function NIt(i,t){t.eachSeries(function(e){var r=e.coordinateSystem,n=e.get(["tooltip","trigger"],!0),o=e.get(["tooltip","show"],!0);!r||!r.model||n==="none"||n===!1||n==="item"||o===!1||e.get(["axisPointer","show"],!0)===!1||pt(i.coordSysAxesInfo[yS(r.model)],function(s){var a=s.axis;r.getAxis(a.dim)===a&&(s.seriesModels.push(e),s.seriesDataCount==null&&(s.seriesDataCount=0),s.seriesDataCount+=e.getData().count())})})}function VIt(i,t){for(var e=t.model,r=t.dim,n=0;n<i.length;n++){var o=i[n]||{};if(BR(o[r+"AxisId"],e.id)||BR(o[r+"AxisIndex"],e.componentIndex)||BR(o[r+"AxisName"],e.name))return n}}function BR(i,t){return i==="all"||Ye(i)&&Ar(i,t)>=0||i===t}function UIt(i){var t=V3(i);if(t){var e=t.axisPointerModel,r=t.axis.scale,n=e.option,o=e.get("status"),s=e.get("value");s!=null&&(s=r.parse(s));var a=Xz(e);o==null&&(n.status=a?"show":"hide");var c=r.getExtent().slice();c[0]>c[1]&&c.reverse(),(s==null||s>c[1])&&(s=c[1]),s<c[0]&&(s=c[0]),n.value=s,a&&(n.status=t.axis.scale.isBlank()?"hide":"show")}}function V3(i){var t=(i.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return t&&t.axesInfo[yS(i)]}function GIt(i){var t=V3(i);return t&&t.axisPointerModel}function Xz(i){return!!i.get(["handle","show"])}function yS(i){return i.type+"||"+i.id}var GW={},HIt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){this.axisPointerClass&&UIt(e),i.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(e,n,!0)},t.prototype.updateAxisPointer=function(e,r,n,o){this._doUpdateAxisPointerClass(e,n,!1)},t.prototype.remove=function(e,r){var n=this._axisPointer;n&&n.remove(r)},t.prototype.dispose=function(e,r){this._disposeAxisPointer(r),i.prototype.dispose.apply(this,arguments)},t.prototype._doUpdateAxisPointerClass=function(e,r,n){var o=t.getAxisPointerClass(this.axisPointerClass);if(o){var s=GIt(e);s?(this._axisPointer||(this._axisPointer=new o)).render(e,s,r,n):this._disposeAxisPointer(r)}},t.prototype._disposeAxisPointer=function(e){this._axisPointer&&this._axisPointer.dispose(e),this._axisPointer=null},t.registerAxisPointerClass=function(e,r){GW[e]=r},t.getAxisPointerClass=function(e){return e&&GW[e]},t.type="axis",t}(Oa);const zv=HIt;var Yz=Wr();function Met(i,t,e,r){var n=e.axis;if(!n.scale.isBlank()){var o=e.getModel("splitArea"),s=o.getModel("areaStyle"),a=s.get("color"),c=r.coordinateSystem.getRect(),f=n.getTicksCoords({tickModel:o,clamp:!0,breakTicks:"none",pruneByBreak:"preserve_extent_bound"});if(f.length){var g=a.length,v=Yz(i).splitAreaColors,y=Fi(),w=0;if(v)for(var I=0;I<f.length;I++){var E=v.get(f[I].tickValue);if(E!=null){w=(E+(g-1)*I)%g;break}}var D=n.toGlobalCoord(f[0].coord),R=s.getAreaStyle();a=Ye(a)?a:[a];for(var I=1;I<f.length;I++){var z=n.toGlobalCoord(f[I].coord),N=void 0,H=void 0,q=void 0,Y=void 0;n.isHorizontal()?(N=D,H=c.y,q=z-N,Y=c.height,D=N+q):(N=c.x,H=D,q=c.width,Y=z-H,D=H+Y);var J=f[I-1].tickValue;J!=null&&y.set(J,w),t.add(new jr({anid:J!=null?"area_"+J:null,shape:{x:N,y:H,width:q,height:Y},style:rr({fill:a[w]},R),autoBatch:!0,silent:!0})),w=(w+1)%g}Yz(i).splitAreaColors=y}}}function Eet(i){Yz(i).splitAreaColors=null}var jIt=["splitArea","splitLine","minorSplitLine","breakArea"],Det=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="CartesianAxisPointer",e}return t.prototype.render=function(e,r,n,o){this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new Ki,this.group.add(this._axisGroup),!!mS(e)){this._axisGroup.add(e.axis.axisBuilder.group),pt(jIt,function(c){e.get([c,"show"])&&WIt[c](this,this._axisGroup,e,e.getCoordSysModel(),n)},this);var a=o&&o.type==="changeAxisOrder"&&o.isInitSort;a||VS(s,this._axisGroup,e),i.prototype.render.call(this,e,r,n,o)}},t.prototype.remove=function(){Eet(this)},t.type="cartesianAxis",t}(zv),WIt={splitLine:function(i,t,e,r,n){var o=e.axis;if(!o.scale.isBlank()){var s=e.getModel("splitLine"),a=s.getModel("lineStyle"),c=a.get("color"),f=s.get("showMinLine")!==!1,g=s.get("showMaxLine")!==!1;c=Ye(c)?c:[c];for(var v=r.coordinateSystem.getRect(),y=o.isHorizontal(),w=0,I=o.getTicksCoords({tickModel:s,breakTicks:"none",pruneByBreak:"preserve_extent_bound"}),E=[],D=[],R=a.getLineStyle(),z=0;z<I.length;z++){var N=o.toGlobalCoord(I[z].coord);if(!(z===0&&!f||z===I.length-1&&!g)){var H=I[z].tickValue;y?(E[0]=N,E[1]=v.y,D[0]=N,D[1]=v.y+v.height):(E[0]=v.x,E[1]=N,D[0]=v.x+v.width,D[1]=N);var q=w++%c.length,Y=new Oo({anid:H!=null?"line_"+H:null,autoBatch:!0,shape:{x1:E[0],y1:E[1],x2:D[0],y2:D[1]},style:rr({stroke:c[q]},R),silent:!0});S0(Y.shape,R.lineWidth),t.add(Y)}}}},minorSplitLine:function(i,t,e,r,n){var o=e.axis,s=e.getModel("minorSplitLine"),a=s.getModel("lineStyle"),c=r.coordinateSystem.getRect(),f=o.isHorizontal(),g=o.getMinorTicksCoords();if(g.length)for(var v=[],y=[],w=a.getLineStyle(),I=0;I<g.length;I++)for(var E=0;E<g[I].length;E++){var D=o.toGlobalCoord(g[I][E].coord);f?(v[0]=D,v[1]=c.y,y[0]=D,y[1]=c.y+c.height):(v[0]=c.x,v[1]=D,y[0]=c.x+c.width,y[1]=D);var R=new Oo({anid:"minor_line_"+g[I][E].tickValue,autoBatch:!0,shape:{x1:v[0],y1:v[1],x2:y[0],y2:y[1]},style:w,silent:!0});S0(R.shape,w.lineWidth),t.add(R)}},splitArea:function(i,t,e,r,n){Met(i,t,e,r)},breakArea:function(i,t,e,r,n){var o=JS(),s=e.axis.scale;o&&s.type!=="ordinal"&&o.rectCoordBuildBreakAxis(t,i,e,r.coordinateSystem.getRect(),n)}},Pet=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="xAxis",t}(Det),$It=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=Pet.type,e}return t.type="yAxis",t}(Det),ZIt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="grid",e}return t.prototype.render=function(e,r){this.group.removeAll(),e.get("show")&&this.group.add(new jr({shape:e.coordinateSystem.getRect(),style:rr({fill:e.get("backgroundColor")},e.getItemStyle()),silent:!0,z2:-1}))},t.type="grid",t}(Oa),HW={offset:0};function Let(i){i.registerComponentView(ZIt),i.registerComponentModel(KAt),i.registerCoordinateSystem("cartesian2d",OIt),E0(i,"x",Hz,HW),E0(i,"y",Hz,HW),i.registerComponentView(Pet),i.registerComponentView($It),i.registerPreprocessor(function(t){t.xAxis&&t.yAxis&&!t.grid&&(t.grid={})})}function qIt(i,t){var e=i.coordinateSystem,r=e&&e.type,n=e&&e.getBaseAxis&&e.getBaseAxis(),o=n&&n.scale&&n.scale.type,s=r==="cartesian2d"&&o==="ordinal"||r==="single",a=t.model.get("jitter")>0;return s&&a}var XIt=Wr();function jW(i,t,e,r){if(i instanceof get){var n=i.scale.type;if(n!=="category"&&n!=="ordinal")return e}var o=i.model,s=o.get("jitter"),a=o.get("jitterOverlap"),c=o.get("jitterMargin")||0,f=i.scale.type==="ordinal"?i.getBandWidth():null;return s>0?a?Ret(e,s,f,r):YIt(i,t,e,r,s,c):e}function Ret(i,t,e,r){if(e===null)return i+(Math.random()-.5)*t;var n=e-r*2,o=Math.min(Math.max(0,t),n);return i+(Math.random()-.5)*o}function YIt(i,t,e,r,n,o){var s=XIt(i);s.items||(s.items=[]);var a=s.items,c=WW(a,t,e,r,n,o,1),f=WW(a,t,e,r,n,o,-1),g=Math.abs(c-e)<Math.abs(f-e)?c:f,v=i.scale.type==="ordinal"?i.getBandWidth():null,y=Math.abs(g-e);return y>n/2||v&&y>v/2-r?Ret(e,n,v,r):(a.push({fixedCoord:t,floatCoord:g,r}),g)}function WW(i,t,e,r,n,o,s){for(var a=e,c=0;c<i.length;c++){var f=i[c],g=t-f.fixedCoord,v=a-f.floatCoord,y=g*g+v*v,w=r+f.r+o;if(y<w*w){var I=f.floatCoord+Math.sqrt(w*w-g*g)*s;if(Math.abs(I-e)>n/2)return Number.MAX_VALUE;if(s===1&&I>a||s===-1&&I<a){a=I,c=-1;continue}}}return a}function KIt(i){i.eachSeriesByType("scatter",function(t){var e=t.coordinateSystem;if(e&&(e.type==="cartesian2d"||e.type==="single")){var r=e.getBaseAxis?e.getBaseAxis():null,n=r&&qIt(t,r);if(n){var o=t.getData();o.each(function(s){var a=r.dim,c=r.orient,f=c==="horizontal"&&r.type!=="category"||c==="vertical"&&r.type==="category",g=o.getItemLayout(s),v=o.getItemVisual(s,"symbolSize"),y=v instanceof Array?(v[1]+v[0])/2:v;if(a==="y"||a==="single"&&f){var w=jW(r,g[0],g[1],y/2);o.setItemLayout(s,[g[0],w])}else if(a==="x"||a==="single"&&!f){var w=jW(r,g[1],g[0],y/2);o.setItemLayout(s,[w,g[1]])}})}}})}function JIt(i){Rr(Let),i.registerSeriesModel(HAt),i.registerChartView(XAt),i.registerLayout(KS("scatter"))}function QIt(i){i.registerLayout(i.PRIORITY.VISUAL.POST_CHART_LAYOUT,KIt)}function tCt(i){i.eachSeriesByType("radar",function(t){var e=t.getData(),r=[],n=t.coordinateSystem;if(n){var o=n.getIndicatorAxes();pt(o,function(s,a){e.each(e.mapDimension(o[a].dim),function(c,f){r[f]=r[f]||[];var g=n.dataToPoint(c,a);r[f][a]=$W(g)?g:ZW(n)})}),e.each(function(s){var a=Iv(r[s],function(c){return $W(c)})||ZW(n);r[s].push(a.slice()),e.setItemLayout(s,r[s])})}})}function $W(i){return!isNaN(i[0])&&!isNaN(i[1])}function ZW(i){return[i.cx,i.cy]}function eCt(i){var t=i.polar;if(t){Ye(t)||(t=[t]);var e=[];pt(t,function(r,n){r.indicator?(r.type&&!r.shape&&(r.shape=r.type),i.radar=i.radar||[],Ye(i.radar)||(i.radar=[i.radar]),i.radar.push(r)):e.push(r)}),i.polar=e}pt(i.series,function(r){r&&r.type==="radar"&&r.polarIndex&&(r.radarIndex=r.polarIndex)})}var iCt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.coordinateSystem,s=this.group,a=e.getData(),c=this._data;function f(y,w){var I=y.getItemVisual(w,"symbol")||"circle";if(I!=="none"){var E=q0(y.getItemVisual(w,"symbolSize")),D=To(I,-1,-1,2,2),R=y.getItemVisual(w,"symbolRotate")||0;return D.attr({style:{strokeNoScale:!0},z2:100,scaleX:E[0]/2,scaleY:E[1]/2,rotation:R*Math.PI/180||0}),D}}function g(y,w,I,E,D,R){I.removeAll();for(var z=0;z<w.length-1;z++){var N=f(E,D);N&&(N.__dimIdx=z,y[z]?(N.setPosition(y[z]),Ev[R?"initProps":"updateProps"](N,{x:w[z][0],y:w[z][1]},e,D)):N.setPosition(w[z]),I.add(N))}}function v(y){return ti(y,function(w){return[o.cx,o.cy]})}a.diff(c).add(function(y){var w=a.getItemLayout(y);if(w){var I=new gl,E=new Us,D={shape:{points:w}};I.shape.points=v(w),E.shape.points=v(w),xa(I,D,e,y),xa(E,D,e,y);var R=new Ki,z=new Ki;R.add(E),R.add(I),R.add(z),g(E.shape.points,w,z,a,y,!0),a.setItemGraphicEl(y,R)}}).update(function(y,w){var I=c.getItemGraphicEl(w),E=I.childAt(0),D=I.childAt(1),R=I.childAt(2),z={shape:{points:a.getItemLayout(y)}};z.shape.points&&(g(E.shape.points,z.shape.points,R,a,y,!1),zu(D),zu(E),yn(E,z,e),yn(D,z,e),a.setItemGraphicEl(y,I))}).remove(function(y){s.remove(c.getItemGraphicEl(y))}).execute(),a.eachItemGraphicEl(function(y,w){var I=a.getItemModel(w),E=y.childAt(0),D=y.childAt(1),R=y.childAt(2),z=a.getItemVisual(w,"style"),N=z.fill;s.add(y),E.useStyle(rr(I.getModel("lineStyle").getLineStyle(),{fill:"none",stroke:N})),Bo(E,I,"lineStyle"),Bo(D,I,"areaStyle");var H=I.getModel("areaStyle"),q=H.isEmpty()&&H.parentModel.isEmpty();D.ignore=q,pt(["emphasis","select","blur"],function(J){var it=I.getModel([J,"areaStyle"]),at=it.isEmpty()&&it.parentModel.isEmpty();D.ensureState(J).ignore=at&&q;var ut=I.getModel([J,"lineStyle"]).getLineStyle();E.ensureState(J).style=ut;var ft=it.getAreaStyle();D.ensureState(J).style=ft;var _t=I.getModel([J,"itemStyle"]).getItemStyle();R.eachChild(function(ct){ct.ensureState(J).style=Yi(_t)})}),D.useStyle(rr(I.getModel("areaStyle").getAreaStyle(),{fill:N,opacity:.7,decal:z.decal}));var Y=I.getModel("emphasis");R.eachChild(function(J){if(J instanceof ys){var it=J.style;J.useStyle(Ne({image:it.image,x:it.x,y:it.y,width:it.width,height:it.height},z))}else J.useStyle(z),J.setColor(N),J.style.strokeNoScale=!0;var at=a.getStore().get(a.getDimensionIndex(J.__dimIdx),w);(at==null||isNaN(at))&&(at=""),Xo(J,Fo(I),{labelFetcher:a.hostModel,labelDataIndex:w,labelDimIndex:J.__dimIdx,defaultText:at,inheritColor:N,defaultOpacity:z.opacity})}),Ca(y,Y.get("focus"),Y.get("blurScope"),Y.get("disabled"))}),this._data=a},t.prototype.remove=function(){this.group.removeAll(),this._data=null},t.type="radar",t}(ga);const rCt=iCt;var nCt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new J0(Si(this.getData,this),Si(this.getRawData,this))},t.prototype.getInitialData=function(e,r){return K0(this,{generateCoord:"indicator_",generateCoordCount:1/0})},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=this.coordinateSystem,a=s.getIndicatorAxes(),c=this.getData().getName(e),f=c===""?this.name:c,g=cQ(this,e);return So("section",{header:f,sortBlocks:!0,blocks:ti(a,function(v){var y=o.get(o.mapDimension(v.dim),e);return So("nameValue",{markerType:"subItem",markerColor:g,name:v.name,value:y,sortParam:y})})})},t.prototype.getTooltipPosition=function(e){if(e!=null){for(var r=this.getData(),n=this.coordinateSystem,o=r.getValues(ti(n.dimensions,function(f){return r.mapDimension(f)}),e),s=0,a=o.length;s<a;s++)if(!isNaN(o[s])){var c=n.getIndicatorAxes();return n.coordToPoint(c[s].dataToCoord(o[s]),s)}}},t.type="series.radar",t.dependencies=["radar"],t.defaultOption={z:2,colorBy:"data",coordinateSystem:"radar",legendHoverLink:!0,radarIndex:0,lineStyle:{width:2,type:"solid",join:"round"},label:{position:"top"},symbolSize:8},t}(Ea);const aCt=nCt;var Eb=pet.value;function QA(i,t){return rr({show:t},i)}var oCt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){var e=this.get("boundaryGap"),r=this.get("splitNumber"),n=this.get("scale"),o=this.get("axisLine"),s=this.get("axisTick"),a=this.get("axisLabel"),c=this.get("axisName"),f=this.get(["axisName","show"]),g=this.get(["axisName","formatter"]),v=this.get("axisNameGap"),y=this.get("triggerEvent"),w=ti(this.get("indicator")||[],function(I){I.max!=null&&I.max>0&&!I.min?I.min=0:I.min!=null&&I.min<0&&!I.max&&(I.max=0);var E=c;I.color!=null&&(E=rr({color:I.color},c));var D=Er(Yi(I),{boundaryGap:e,splitNumber:r,scale:n,axisLine:o,axisTick:s,axisLabel:a,name:I.text,showName:f,nameLocation:"end",nameGap:v,nameTextStyle:E,triggerEvent:y},!1);if(wi(g)){var R=D.name;D.name=g.replace("{value}",R??"")}else Xi(g)&&(D.name=g(D.name,D));var z=new bn(D,null,this.ecModel);return Ao(z,ZS.prototype),z.mainType="radar",z.componentIndex=this.componentIndex,z},this);this._indicatorModels=w},t.prototype.getIndicatorModels=function(){return this._indicatorModels},t.type="radar",t.defaultOption={z:0,center:["50%","50%"],radius:"50%",startAngle:90,axisName:{show:!0,color:ye.color.axisLabel},boundaryGap:[0,0],splitNumber:5,axisNameGap:15,scale:!1,shape:"polygon",axisLine:Er({lineStyle:{color:ye.color.neutral20}},Eb.axisLine),axisLabel:QA(Eb.axisLabel,!1),axisTick:QA(Eb.axisTick,!1),splitLine:QA(Eb.splitLine,!0),splitArea:QA(Eb.splitArea,!0),indicator:[]},t}(gn);const sCt=oCt;var lCt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=this.group;o.removeAll(),this._buildAxes(e,n),this._buildSplitLineAndArea(e)},t.prototype._buildAxes=function(e,r){var n=e.coordinateSystem,o=n.getIndicatorAxes(),s=ti(o,function(a){var c=a.model.get("showName")?a.name:"",f=new Fd(a.model,r,{axisName:c,position:[n.cx,n.cy],rotation:a.angle,labelDirection:-1,tickDirection:-1,nameDirection:1});return f});pt(s,function(a){a.build(),this.group.add(a.group)},this)},t.prototype._buildSplitLineAndArea=function(e){var r=e.coordinateSystem,n=r.getIndicatorAxes();if(!n.length)return;var o=e.get("shape"),s=e.getModel("splitLine"),a=e.getModel("splitArea"),c=s.getModel("lineStyle"),f=a.getModel("areaStyle"),g=s.get("show"),v=a.get("show"),y=c.get("color"),w=f.get("color"),I=Ye(y)?y:[y],E=Ye(w)?w:[w],D=[],R=[];function z(Et,bt,Vt){var zt=Vt%bt.length;return Et[zt]=Et[zt]||[],zt}if(o==="circle")for(var N=n[0].getTicksCoords(),H=r.cx,q=r.cy,Y=0;Y<N.length;Y++){if(g){var J=z(D,I,Y);D[J].push(new Wp({shape:{cx:H,cy:q,r:N[Y].coord}}))}if(v&&Y<N.length-1){var J=z(R,E,Y);R[J].push(new dE({shape:{cx:H,cy:q,r0:N[Y].coord,r:N[Y+1].coord}}))}}else for(var it,at=ti(n,function(Et,bt){var Vt=Et.getTicksCoords();return it=it==null?Vt.length-1:Math.min(Vt.length-1,it),ti(Vt,function(zt){return r.coordToPoint(zt.coord,bt)})}),ut=[],Y=0;Y<=it;Y++){for(var ft=[],_t=0;_t<n.length;_t++)ft.push(at[_t][Y]);if(ft[0]&&ft.push(ft[0].slice()),g){var J=z(D,I,Y);D[J].push(new Us({shape:{points:ft}}))}if(v&&ut){var J=z(R,E,Y-1);R[J].push(new gl({shape:{points:ft.concat(ut)}}))}ut=ft.slice().reverse()}var ct=c.getLineStyle(),Dt=f.getAreaStyle();pt(R,function(Et,bt){this.group.add(Mu(Et,{style:rr({stroke:"none",fill:E[bt%E.length]},Dt),silent:!0}))},this),pt(D,function(Et,bt){this.group.add(Mu(Et,{style:rr({fill:"none",stroke:I[bt%I.length]},ct),silent:!0}))},this)},t.type="radar",t}(Oa);const uCt=lCt;var cCt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this,e,r,n)||this;return o.type="value",o.angle=0,o.name="",o}return t}(Sc);const hCt=cCt;var dCt=function(){function i(t,e,r){this.dimensions=[],this._model=t,this._indicatorAxes=ti(t.getIndicatorModels(),function(n,o){var s="indicator_"+o,a=new hCt(s,new Bp);return a.name=n.get("name"),a.model=n,n.axis=a,this.dimensions.push(s),a},this),this.resize(t,r)}return i.prototype.getIndicatorAxes=function(){return this._indicatorAxes},i.prototype.dataToPoint=function(t,e){var r=this._indicatorAxes[e];return this.coordToPoint(r.dataToCoord(t),e)},i.prototype.coordToPoint=function(t,e){var r=this._indicatorAxes[e],n=r.angle,o=this.cx+t*Math.cos(n),s=this.cy-t*Math.sin(n);return[o,s]},i.prototype.pointToData=function(t){var e=t[0]-this.cx,r=t[1]-this.cy,n=Math.sqrt(e*e+r*r);e/=n,r/=n;for(var o=Math.atan2(-r,e),s=1/0,a,c=-1,f=0;f<this._indicatorAxes.length;f++){var g=this._indicatorAxes[f],v=Math.abs(o-g.angle);v<s&&(a=g,c=f,s=v)}return[c,+(a&&a.coordToData(n))]},i.prototype.resize=function(t,e){var r=No(t,e).refContainer,n=t.get("center"),o=Math.min(r.width,r.height)/2;this.cx=xi(n[0],r.width)+r.x,this.cy=xi(n[1],r.height)+r.y,this.startAngle=t.get("startAngle")*Math.PI/180;var s=t.get("radius");(wi(s)||fn(s))&&(s=[0,s]),this.r0=xi(s[0],o),this.r=xi(s[1],o),pt(this._indicatorAxes,function(a,c){a.setExtent(this.r0,this.r);var f=this.startAngle+c*Math.PI*2/this._indicatorAxes.length;f=Math.atan2(Math.sin(f),Math.cos(f)),a.angle=f},this)},i.prototype.update=function(t,e){var r=this._indicatorAxes,n=this._model;pt(r,function(a){a.scale.setExtent(1/0,-1/0)}),t.eachSeriesByType("radar",function(a,c){if(!(a.get("coordinateSystem")!=="radar"||t.getComponent("radar",a.get("radarIndex"))!==n)){var f=a.getData();pt(r,function(g){g.scale.unionExtentFromData(f,f.mapDimension(g.dim))})}},this);var o=n.get("splitNumber"),s=new Bp;s.setExtent(0,o),s.setInterval(1),pt(r,function(a,c){Iet(a.scale,a.model,s)})},i.prototype.convertToPixel=function(t,e,r){return console.warn("Not implemented."),null},i.prototype.convertFromPixel=function(t,e,r){return console.warn("Not implemented."),null},i.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},i.create=function(t,e){var r=[];return t.eachComponent("radar",function(n){var o=new i(n,t,e);r.push(o),n.coordinateSystem=o}),t.eachSeriesByType("radar",function(n){n.get("coordinateSystem")==="radar"&&(n.coordinateSystem=r[n.get("radarIndex")||0])}),r},i.dimensions=[],i}();const fCt=dCt;function pCt(i){i.registerCoordinateSystem("radar",fCt),i.registerComponentModel(sCt),i.registerComponentView(uCt),i.registerVisual({seriesType:"radar",reset:function(t){var e=t.getData();e.each(function(r){e.setItemVisual(r,"legendIcon","roundRect")}),e.setVisual("legendIcon","roundRect")}})}function gCt(i){Rr(pCt),i.registerChartView(rCt),i.registerSeriesModel(aCt),i.registerLayout(tCt),i.registerProcessor(Y0("radar")),i.registerPreprocessor(eCt)}var U3=Wr();function mCt(i,t,e){U3(i)[t]=e}function vCt(i,t,e){var r=U3(i),n=r[t];n===e&&(r[t]=null)}function qW(i,t){return!!U3(i)[t]}Ih({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},ho);var _Ct={axisPointer:1,tooltip:1,brush:1};function ket(i,t,e){var r=t.getComponentByElement(i.topTarget);if(!r||r===e||_Ct.hasOwnProperty(r.mainType))return!1;var n=r.coordinateSystem;if(!n||n.model===e)return!1;var o=bv(r),s=bv(e);return!((o.zlevel-s.zlevel||o.z-s.z)<=0)}var yCt=function(i){Se(t,i);function t(e){var r=i.call(this)||this;r._zr=e;var n=Si(r._mousedownHandler,r),o=Si(r._mousemoveHandler,r),s=Si(r._mouseupHandler,r),a=Si(r._mousewheelHandler,r),c=Si(r._pinchHandler,r);return r.enable=function(f,g){var v=g.zInfo,y=bv(v.component),w=y.z,I=y.zlevel,E={component:v.component,z:w,zlevel:I,z2:Ui(v.z2,-1/0)},D=Ne({},g.triggerInfo);this._opt=rr(Ne({},g),{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0,zInfoParsed:E,triggerInfo:D}),f==null&&(f=!0),(!this._enabled||this._controlType!==f)&&(this._enabled=!0,this.disable(),(f===!0||f==="move"||f==="pan")&&(Pb(e,"mousedown",n,E),Pb(e,"mousemove",o,E),Pb(e,"mouseup",s,E)),(f===!0||f==="scale"||f==="zoom")&&(Pb(e,"mousewheel",a,E),Pb(e,"pinch",c,E)))},r.disable=function(){this._enabled=!1,Lb(e,"mousedown",n),Lb(e,"mousemove",o),Lb(e,"mouseup",s),Lb(e,"mousewheel",a),Lb(e,"pinch",c)},r}return t.prototype.isDragging=function(){return this._dragging},t.prototype.isPinching=function(){return this._pinching},t.prototype._checkPointer=function(e,r,n){var o=this._opt,s=o.zInfoParsed;if(ket(e,o.api,s.component))return!1;var a=o.triggerInfo,c=a.roamTrigger,f=!1;return c==="global"&&(f=!0),f||(f=a.isInSelf(e,r,n)),f&&a.isInClip&&!a.isInClip(e,r,n)&&(f=!1),f},t.prototype._decideCursorStyle=function(e,r,n,o){var s=e.target;if(!s&&this._checkPointer(e,r,n))return"grab";if(o)return s&&s.cursor||"default"},t.prototype.dispose=function(){this.disable()},t.prototype._mousedownHandler=function(e){if(!(cH(e)||Db(e))){for(var r=e.target;r;){if(r.draggable)return;r=r.__hostTarget||r.parent}var n=e.offsetX,o=e.offsetY;this._checkPointer(e,n,o)&&(this._x=n,this._y=o,this._dragging=!0)}},t.prototype._mousemoveHandler=function(e){var r=this._zr;if(!(e.gestureEvent==="pinch"||qW(r,"globalPan")||Db(e))){var n=e.offsetX,o=e.offsetY;if(!this._dragging||!rC("moveOnMouseMove",e,this._opt)){var s=this._decideCursorStyle(e,n,o,!1);s&&r.setCursorStyle(s);return}r.setCursorStyle("grabbing");var a=this._x,c=this._y,f=n-a,g=o-c;this._x=n,this._y=o,this._opt.preventDefaultMouseMove&&Rd(e.event),e.__ecRoamConsumed=!0,XW(this,"pan","moveOnMouseMove",e,{dx:f,dy:g,oldX:a,oldY:c,newX:n,newY:o,isAvailableBehavior:null})}},t.prototype._mouseupHandler=function(e){if(!Db(e)){var r=this._zr;if(!cH(e)){this._dragging=!1;var n=this._decideCursorStyle(e,e.offsetX,e.offsetY,!0);n&&r.setCursorStyle(n)}}},t.prototype._mousewheelHandler=function(e){if(!Db(e)){var r=rC("zoomOnMouseWheel",e,this._opt),n=rC("moveOnMouseWheel",e,this._opt),o=e.wheelDelta,s=Math.abs(o),a=e.offsetX,c=e.offsetY;if(!(o===0||!r&&!n)){if(r){var f=s>3?1.4:s>1?1.2:1.1,g=o>0?f:1/f;this._checkTriggerMoveZoom(this,"zoom","zoomOnMouseWheel",e,{scale:g,originX:a,originY:c,isAvailableBehavior:null})}if(n){var v=Math.abs(o),y=(o>0?1:-1)*(v>3?.4:v>1?.15:.05);this._checkTriggerMoveZoom(this,"scrollMove","moveOnMouseWheel",e,{scrollDelta:y,originX:a,originY:c,isAvailableBehavior:null})}}}},t.prototype._pinchHandler=function(e){if(!(qW(this._zr,"globalPan")||Db(e))){var r=e.pinchScale>1?1.1:1/1.1;this._checkTriggerMoveZoom(this,"zoom",null,e,{scale:r,originX:e.pinchX,originY:e.pinchY,isAvailableBehavior:null})}},t.prototype._checkTriggerMoveZoom=function(e,r,n,o,s){e._checkPointer(o,s.originX,s.originY)&&(Rd(o.event),o.__ecRoamConsumed=!0,XW(e,r,n,o,s))},t}(Bu);function Db(i){return i.__ecRoamConsumed}var xCt=Wr();function EE(i){var t=xCt(i);return t.roam=t.roam||{},t.uniform=t.uniform||{},t}function Pb(i,t,e,r){for(var n=EE(i),o=n.roam,s=o[t]=o[t]||[],a=0;a<s.length;a++){var c=s[a].zInfoParsed;if((c.zlevel-r.zlevel||c.z-r.z||c.z2-r.z2)<=0)break}s.splice(a,0,{listener:e,zInfoParsed:r}),bCt(i,t)}function Lb(i,t,e){for(var r=EE(i),n=r.roam[t]||[],o=0;o<n.length;o++)if(n[o].listener===e){n.splice(o,1),n.length||wCt(i,t);return}}function bCt(i,t){var e=EE(i);e.uniform[t]||i.on(t,e.uniform[t]=function(r){var n=e.roam[t];if(n)for(var o=0;o<n.length;o++)n[o].listener(r)})}function wCt(i,t){var e=EE(i),r=e.uniform;r[t]&&(i.off(t,r[t]),r[t]=null)}function XW(i,t,e,r,n){n.isAvailableBehavior=Si(rC,null,e,r),i.trigger(t,n)}function rC(i,t,e){var r=e[i];return!i||r&&(!wi(r)||t.event[r+"Key"])}const Bv=yCt;function G3(i,t,e){var r=i.target;r.x+=t,r.y+=e,r.dirty()}function H3(i,t,e,r){var n=i.target,o=i.zoomLimit,s=i.zoom=i.zoom||1;s*=t,s=j3(s,o);var a=s/i.zoom;i.zoom=s,zet(n,e,r,a),n.dirty()}function Oet(i,t,e,r,n,o){var s=new sr(0,0,0,0);r.enable(i.get("roam"),{api:t,zInfo:{component:i},triggerInfo:{roamTrigger:i.get("roamTrigger"),isInSelf:function(f,g,v){return s.copy(e.getBoundingRect()),s.applyTransform(e.getComputedTransform()),s.contain(g,v)},isInClip:function(f,g,v){return!o||o.contain(g,v)}}}),n.zoomLimit=i.get("scaleLimit");var a=i.coordinateSystem;n.zoom=a?a.getZoom():1;var c=i.subType+"Roam";r.off("pan").off("zoom").on("pan",function(f){G3(n,f.dx,f.dy),t.dispatchAction({seriesId:i.id,type:c,dx:f.dx,dy:f.dy})}).on("zoom",function(f){H3(n,f.scale,f.originX,f.originY),t.dispatchAction({seriesId:i.id,type:c,zoom:f.scale,originX:f.originX,originY:f.originY}),t.updateLabelLayout()})}function YW(i,t){return i.pointToProjected?i.pointToProjected(t):i.pointToData(t)}function DE(i,t,e){var r=i.getZoom(),n=i.getCenter(),o=t.zoom,s=i.projectedToPoint?i.projectedToPoint(n):i.dataToPoint(n);return t.dx!=null&&t.dy!=null&&(s[0]-=t.dx,s[1]-=t.dy,i.setCenter(YW(i,s))),o!=null&&(o=j3(r*o,e)/r,zet(i,t.originX,t.originY,o),i.updateTransform(),i.setCenter(YW(i,s)),i.setZoom(o*r)),{center:i.getCenter(),zoom:i.getZoom()}}function zet(i,t,e,r){i.x-=(t-i.x)*(r-1),i.y-=(e-i.y)*(r-1),i.scaleX*=r,i.scaleY*=r}function j3(i,t){if(t){var e=t.min||0,r=t.max||1/0;i=Math.max(Math.min(r,i),e)}return i}function Bet(i){if(wi(i)){var t=new DOMParser;i=t.parseFromString(i,"text/xml")}var e=i;for(e.nodeType===9&&(e=e.firstChild);e.nodeName.toLowerCase()!=="svg"||e.nodeType!==1;)e=e.nextSibling;return e}var FR,cM={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},KW=on(cM),hM={"alignment-baseline":"textBaseline","stop-color":"stopColor"},JW=on(hM),SCt=function(){function i(){this._defs={},this._root=null}return i.prototype.parse=function(t,e){e=e||{};var r=Bet(t);this._defsUsePending=[];var n=new Ki;this._root=n;var o=[],s=r.getAttribute("viewBox")||"",a=parseFloat(r.getAttribute("width")||e.width),c=parseFloat(r.getAttribute("height")||e.height);isNaN(a)&&(a=null),isNaN(c)&&(c=null),jl(r,n,null,!0,!1);for(var f=r.firstChild;f;)this._parseNode(f,n,o,null,!1,!1),f=f.nextSibling;ICt(this._defs,this._defsUsePending),this._defsUsePending=[];var g,v;if(s){var y=PE(s);y.length>=4&&(g={x:parseFloat(y[0]||0),y:parseFloat(y[1]||0),width:parseFloat(y[2]),height:parseFloat(y[3])})}if(g&&a!=null&&c!=null&&(v=Net(g,{x:0,y:0,width:a,height:c}),!e.ignoreViewBox)){var w=n;n=new Ki,n.add(w),w.scaleX=w.scaleY=v.scale,w.x=v.x,w.y=v.y}return!e.ignoreRootClip&&a!=null&&c!=null&&n.setClipPath(new jr({shape:{x:0,y:0,width:a,height:c}})),{root:n,width:a,height:c,viewBoxRect:g,viewBoxTransform:v,named:o}},i.prototype._parseNode=function(t,e,r,n,o,s){var a=t.nodeName.toLowerCase(),c,f=n;if(a==="defs"&&(o=!0),a==="text"&&(s=!0),a==="defs"||a==="switch")c=e;else{if(!o){var g=FR[a];if(g&&Pi(FR,a)){c=g.call(this,t,e);var v=t.getAttribute("name");if(v){var y={name:v,namedFrom:null,svgNodeTagLower:a,el:c};r.push(y),a==="g"&&(f=y)}else n&&r.push({name:n.name,namedFrom:n,svgNodeTagLower:a,el:c});e.add(c)}}var w=QW[a];if(w&&Pi(QW,a)){var I=w.call(this,t),E=t.getAttribute("id");E&&(this._defs[E]=I)}}if(c&&c.isGroup)for(var D=t.firstChild;D;)D.nodeType===1?this._parseNode(D,c,r,f,o,s):D.nodeType===3&&s&&this._parseText(D,c),D=D.nextSibling},i.prototype._parseText=function(t,e){var r=new rS({style:{text:t.textContent},silent:!0,x:this._textX||0,y:this._textY||0});_u(e,r),jl(t,r,this._defsUsePending,!1,!1),TCt(r,e);var n=r.style,o=n.fontSize;o&&o<9&&(n.fontSize=9,r.scaleX*=o/9,r.scaleY*=o/9);var s=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=s;var a=r.getBoundingRect();return this._textX+=a.width,e.add(r),r},i.internalField=function(){FR={g:function(t,e){var r=new Ki;return _u(e,r),jl(t,r,this._defsUsePending,!1,!1),r},rect:function(t,e){var r=new jr;return _u(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({x:parseFloat(t.getAttribute("x")||"0"),y:parseFloat(t.getAttribute("y")||"0"),width:parseFloat(t.getAttribute("width")||"0"),height:parseFloat(t.getAttribute("height")||"0")}),r.silent=!0,r},circle:function(t,e){var r=new Wp;return _u(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),r:parseFloat(t.getAttribute("r")||"0")}),r.silent=!0,r},line:function(t,e){var r=new Oo;return _u(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({x1:parseFloat(t.getAttribute("x1")||"0"),y1:parseFloat(t.getAttribute("y1")||"0"),x2:parseFloat(t.getAttribute("x2")||"0"),y2:parseFloat(t.getAttribute("y2")||"0")}),r.silent=!0,r},ellipse:function(t,e){var r=new jF;return _u(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),rx:parseFloat(t.getAttribute("rx")||"0"),ry:parseFloat(t.getAttribute("ry")||"0")}),r.silent=!0,r},polygon:function(t,e){var r=t.getAttribute("points"),n;r&&(n=i$(r));var o=new gl({shape:{points:n||[]},silent:!0});return _u(e,o),jl(t,o,this._defsUsePending,!1,!1),o},polyline:function(t,e){var r=t.getAttribute("points"),n;r&&(n=i$(r));var o=new Us({shape:{points:n||[]},silent:!0});return _u(e,o),jl(t,o,this._defsUsePending,!1,!1),o},image:function(t,e){var r=new ys;return _u(e,r),jl(t,r,this._defsUsePending,!1,!1),r.setStyle({image:t.getAttribute("xlink:href")||t.getAttribute("href"),x:+t.getAttribute("x"),y:+t.getAttribute("y"),width:+t.getAttribute("width"),height:+t.getAttribute("height")}),r.silent=!0,r},text:function(t,e){var r=t.getAttribute("x")||"0",n=t.getAttribute("y")||"0",o=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0";this._textX=parseFloat(r)+parseFloat(o),this._textY=parseFloat(n)+parseFloat(s);var a=new Ki;return _u(e,a),jl(t,a,this._defsUsePending,!1,!0),a},tspan:function(t,e){var r=t.getAttribute("x"),n=t.getAttribute("y");r!=null&&(this._textX=parseFloat(r)),n!=null&&(this._textY=parseFloat(n));var o=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0",a=new Ki;return _u(e,a),jl(t,a,this._defsUsePending,!1,!0),this._textX+=parseFloat(o),this._textY+=parseFloat(s),a},path:function(t,e){var r=t.getAttribute("d")||"",n=FK(r);return _u(e,n),jl(t,n,this._defsUsePending,!1,!1),n.silent=!0,n}}}(),i}(),QW={lineargradient:function(i){var t=parseInt(i.getAttribute("x1")||"0",10),e=parseInt(i.getAttribute("y1")||"0",10),r=parseInt(i.getAttribute("x2")||"10",10),n=parseInt(i.getAttribute("y2")||"0",10),o=new U0(t,e,r,n);return t$(i,o),e$(i,o),o},radialgradient:function(i){var t=parseInt(i.getAttribute("cx")||"0",10),e=parseInt(i.getAttribute("cy")||"0",10),r=parseInt(i.getAttribute("r")||"0",10),n=new KK(t,e,r);return t$(i,n),e$(i,n),n}};function t$(i,t){var e=i.getAttribute("gradientUnits");e==="userSpaceOnUse"&&(t.global=!0)}function e$(i,t){for(var e=i.firstChild;e;){if(e.nodeType===1&&e.nodeName.toLocaleLowerCase()==="stop"){var r=e.getAttribute("offset"),n=void 0;r&&r.indexOf("%")>0?n=parseInt(r,10)/100:r?n=parseFloat(r):n=0;var o={};Fet(e,o,o);var s=o.stopColor||e.getAttribute("stop-color")||"#000000",a=o.stopOpacity||e.getAttribute("stop-opacity");if(a){var c=Ol(s),f=c&&c[3];f&&(c[3]*=Tp(a),s=gh(c,"rgba"))}t.colorStops.push({offset:n,color:s})}e=e.nextSibling}}function _u(i,t){i&&i.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),rr(t.__inheritedStyle,i.__inheritedStyle))}function i$(i){for(var t=PE(i),e=[],r=0;r<t.length;r+=2){var n=parseFloat(t[r]),o=parseFloat(t[r+1]);e.push([n,o])}return e}function jl(i,t,e,r,n){var o=t,s=o.__inheritedStyle=o.__inheritedStyle||{},a={};i.nodeType===1&&(ECt(i,t),Fet(i,s,a),r||DCt(i,s,a)),o.style=o.style||{},s.fill!=null&&(o.style.fill=r$(o,"fill",s.fill,e)),s.stroke!=null&&(o.style.stroke=r$(o,"stroke",s.stroke,e)),pt(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(c){s[c]!=null&&(o.style[c]=parseFloat(s[c]))}),pt(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(c){s[c]!=null&&(o.style[c]=s[c])}),n&&(o.__selfStyle=a),s.lineDash&&(o.style.lineDash=ti(PE(s.lineDash),function(c){return parseFloat(c)})),(s.visibility==="hidden"||s.visibility==="collapse")&&(o.invisible=!0),s.display==="none"&&(o.ignore=!0)}function TCt(i,t){var e=t.__selfStyle;if(e){var r=e.textBaseline,n=r;!r||r==="auto"||r==="baseline"?n="alphabetic":r==="before-edge"||r==="text-before-edge"?n="top":r==="after-edge"||r==="text-after-edge"?n="bottom":(r==="central"||r==="mathematical")&&(n="middle"),i.style.textBaseline=n}var o=t.__inheritedStyle;if(o){var s=o.textAlign,a=s;s&&(s==="middle"&&(a="center"),i.style.textAlign=a)}}var ACt=/^url\(\s*#(.*?)\)/;function r$(i,t,e,r){var n=e&&e.match(ACt);if(n){var o=Du(n[1]);r.push([i,t,o]);return}return e==="none"&&(e=null),e}function ICt(i,t){for(var e=0;e<t.length;e++){var r=t[e];r[0].style[r[1]]=i[r[2]]}}var CCt=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function PE(i){return i.match(CCt)||[]}var MCt=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,NR=Math.PI/180;function ECt(i,t){var e=i.getAttribute("transform");if(e){e=e.replace(/,/g," ");var r=[],n=null;e.replace(MCt,function(v,y,w){return r.push(y,w),""});for(var o=r.length-1;o>0;o-=2){var s=r[o],a=r[o-1],c=PE(s);switch(n=n||as(),a){case"translate":bh(n,n,[parseFloat(c[0]),parseFloat(c[1]||"0")]);break;case"scale":AF(n,n,[parseFloat(c[0]),parseFloat(c[1]||c[0])]);break;case"rotate":jp(n,n,-parseFloat(c[0])*NR,[parseFloat(c[1]||"0"),parseFloat(c[2]||"0")]);break;case"skewX":var f=Math.tan(parseFloat(c[0])*NR);ph(n,[1,0,f,1,0,0],n);break;case"skewY":var g=Math.tan(parseFloat(c[0])*NR);ph(n,[1,g,0,1,0,0],n);break;case"matrix":n[0]=parseFloat(c[0]),n[1]=parseFloat(c[1]),n[2]=parseFloat(c[2]),n[3]=parseFloat(c[3]),n[4]=parseFloat(c[4]),n[5]=parseFloat(c[5]);break}}t.setLocalTransform(n)}}var n$=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Fet(i,t,e){var r=i.getAttribute("style");if(r){n$.lastIndex=0;for(var n;(n=n$.exec(r))!=null;){var o=n[1],s=Pi(cM,o)?cM[o]:null;s&&(t[s]=n[2]);var a=Pi(hM,o)?hM[o]:null;a&&(e[a]=n[2])}}}function DCt(i,t,e){for(var r=0;r<KW.length;r++){var n=KW[r],o=i.getAttribute(n);o!=null&&(t[cM[n]]=o)}for(var r=0;r<JW.length;r++){var n=JW[r],o=i.getAttribute(n);o!=null&&(e[hM[n]]=o)}}function Net(i,t){var e=t.width/i.width,r=t.height/i.height,n=Math.min(e,r);return{scale:n,x:-(i.x+i.width/2)*n+(t.x+t.width/2),y:-(i.y+i.height/2)*n+(t.y+t.height/2)}}function PCt(i,t){var e=new SCt;return e.parse(i,t)}var LCt=Fi(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),RCt=function(){function i(t,e){this.type="geoSVG",this._usedGraphicMap=Fi(),this._freedGraphics=[],this._mapName=t,this._parsedXML=Bet(e)}return i.prototype.load=function(){var t=this._firstGraphic;if(!t){t=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(t),this._boundingRect=this._firstGraphic.boundingRect.clone();var e=OCt(t.named),r=e.regions,n=e.regionsMap;this._regions=r,this._regionsMap=n}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},i.prototype._buildGraphic=function(t){var e,r;try{e=t&&PCt(t,{ignoreViewBox:!0,ignoreRootClip:!0})||{},r=e.root,Vs(r!=null)}catch(D){throw new Error(`Invalid svg format
`+D.message)}var n=new Ki;n.add(r),n.isGeoSVGGraphicRoot=!0;var o=e.width,s=e.height,a=e.viewBoxRect,c=this._boundingRect;if(!c){var f=void 0,g=void 0,v=void 0,y=void 0;if(o!=null?(f=0,v=o):a&&(f=a.x,v=a.width),s!=null?(g=0,y=s):a&&(g=a.y,y=a.height),f==null||g==null){var w=r.getBoundingRect();f==null&&(f=w.x,v=w.width),g==null&&(g=w.y,y=w.height)}c=this._boundingRect=new sr(f,g,v,y)}if(a){var I=Net(a,c);r.scaleX=r.scaleY=I.scale,r.x=I.x,r.y=I.y}n.setClipPath(new jr({shape:c.plain()}));var E=[];return pt(e.named,function(D){LCt.get(D.svgNodeTagLower)!=null&&(E.push(D),kCt(D.el))}),{root:n,boundingRect:c,named:E}},i.prototype.useGraphic=function(t){var e=this._usedGraphicMap,r=e.get(t);return r||(r=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),e.set(t,r),r)},i.prototype.freeGraphic=function(t){var e=this._usedGraphicMap,r=e.get(t);r&&(e.removeKey(t),this._freedGraphics.push(r))},i}();function kCt(i){i.silent=!1,i.isGroup&&i.traverse(function(t){t.silent=!1})}function OCt(i){var t=[],e=Fi();return pt(i,function(r){if(r.namedFrom==null){var n=new yTt(r.name,r.el);t.push(n),e.set(r.name,n)}}),{regions:t,regionsMap:e}}var Kz=[126,25],a$="",Rm=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]];for(var Cm=0;Cm<Rm.length;Cm++)for(var Ly=0;Ly<Rm[Cm].length;Ly++)Rm[Cm][Ly][0]/=10.5,Rm[Cm][Ly][1]/=-10.5/.75,Rm[Cm][Ly][0]+=Kz[0],Rm[Cm][Ly][1]+=Kz[1];function zCt(i,t){if(i==="china"){for(var e=0;e<t.length;e++)if(t[e].name===a$)return;t.push(new _tt(a$,ti(Rm,function(r){return{type:"polygon",exterior:r}}),Kz))}}var BCt={:[32,80],:[0,-10],:[10,5],:[-10,10],:[5,5]};function FCt(i,t){if(i==="china"){var e=BCt[t.name];if(e){var r=t.getCenter();r[0]+=e[0]/10.5,r[1]+=-e[1]/(10.5/.75),t.setCenter(r)}}}var NCt=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];function VCt(i,t){i==="china"&&t.name===""&&t.geometries.push({type:"polygon",exterior:NCt[0]})}var UCt="name",GCt=function(){function i(t,e,r){this.type="geoJSON",this._parsedMap=Fi(),this._mapName=t,this._specialAreas=r,this._geoJSON=jCt(e)}return i.prototype.load=function(t,e){e=e||UCt;var r=this._parsedMap.get(e);if(!r){var n=this._parseToRegions(e);r=this._parsedMap.set(e,{regions:n,boundingRect:HCt(n)})}var o=Fi(),s=[];return pt(r.regions,function(a){var c=a.name;t&&Pi(t,c)&&(a=a.cloneShallow(c=t[c])),s.push(a),o.set(c,a)}),{regions:s,boundingRect:r.boundingRect||new sr(0,0,0,0),regionsMap:o}},i.prototype._parseToRegions=function(t){var e=this._mapName,r=this._geoJSON,n;try{n=r?bTt(r,t):[]}catch(o){throw new Error(`Invalid geoJson format
`+o.message)}return zCt(e,n),pt(n,function(o){var s=o.name;FCt(e,o),VCt(e,o);var a=this._specialAreas&&this._specialAreas[s];a&&o.transformTo(a.left,a.top,a.width,a.height)},this),n},i.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},i}();function HCt(i){for(var t,e=0;e<i.length;e++){var r=i[e].getBoundingRect();t=t||r.clone(),t.union(r)}return t}function jCt(i){return wi(i)?typeof JSON<"u"&&JSON.parse?JSON.parse(i):new Function("return ("+i+");")():i}var Rb=Fi();const Nd={registerMap:function(i,t,e){if(t.svg){var r=new RCt(i,t.svg);Rb.set(i,r)}else{var n=t.geoJson||t.geoJSON;n&&!t.features?e=t.specialAreas:n=t;var r=new GCt(i,n,e);Rb.set(i,r)}},getGeoResource:function(i){return Rb.get(i)},getMapForUser:function(i){var t=Rb.get(i);return t&&t.type==="geoJSON"&&t.getMapForUser()},load:function(i,t,e){var r=Rb.get(i);if(r)return r.load(t,e)}};var W3=["rect","circle","line","ellipse","polygon","polyline","path"],WCt=Fi(W3),$Ct=Fi(W3.concat(["g"])),ZCt=Fi(W3.concat(["g"])),Vet=Wr();function tI(i){var t=i.getItemStyle(),e=i.get("areaColor");return e!=null&&(t.fill=e),t}function o$(i){var t=i.style;t&&(t.stroke=t.stroke||t.fill,t.fill=null)}var qCt=function(){function i(t){var e=this.group=new Ki,r=this._transformGroup=new Ki;e.add(r),this.uid=j0("ec_map_draw"),this._controller=new Bv(t.getZr()),this._controllerHost={target:r},r.add(this._regionsGroup=new Ki),r.add(this._svgGroup=new Ki)}return i.prototype.draw=function(t,e,r,n,o){var s=t.mainType==="geo",a=t.getData&&t.getData();s&&e.eachComponent({mainType:"series",subType:"map"},function(N){!a&&N.getHostGeoModel()===t&&(a=N.getData())});var c=t.coordinateSystem,f=this._regionsGroup,g=this._transformGroup,v=c.getTransformInfo(),y=v.raw,w=v.roam,I=!f.childAt(0)||o,E=t.getShallow("clip",!0),D;E?(D=c.getViewRect().clone(),this.group.setClipPath(new jr({shape:D.clone()}))):this.group.removeClipPath(),I?(g.x=w.x,g.y=w.y,g.scaleX=w.scaleX,g.scaleY=w.scaleY,g.dirty()):yn(g,w,t);var R=a&&a.getVisual("visualMeta")&&a.getVisual("visualMeta").length>0,z={api:r,geo:c,mapOrGeoModel:t,data:a,isVisualEncodedByVisualMap:R,isGeo:s,transformInfoRaw:y};c.resourceType==="geoJSON"?this._buildGeoJSON(z):c.resourceType==="geoSVG"&&this._buildSVG(z),this._updateController(t,D,e,r),this._updateMapSelectHandler(t,f,r,n)},i.prototype._buildGeoJSON=function(t){var e=this._regionsGroupByName=Fi(),r=Fi(),n=this._regionsGroup,o=t.transformInfoRaw,s=t.mapOrGeoModel,a=t.data,c=t.geo.projection,f=c&&c.stream;function g(w,I){return I&&(w=I(w)),w&&[w[0]*o.scaleX+o.x,w[1]*o.scaleY+o.y]}function v(w){for(var I=[],E=!f&&c&&c.project,D=0;D<w.length;++D){var R=g(w[D],E);R&&I.push(R)}return I}function y(w){return{shape:{points:v(w)}}}n.removeAll(),pt(t.geo.regions,function(w){var I=w.name,E=e.get(I),D=r.get(I)||{},R=D.dataIdx,z=D.regionModel;if(!E){E=e.set(I,new Ki),n.add(E),R=a?a.indexOfName(I):null,z=t.isGeo?s.getRegionModel(I):a?a.getItemModel(R):null;var N=z.get("silent",!0);N!=null&&(E.silent=N),r.set(I,{dataIdx:R,regionModel:z})}var H=[],q=[];pt(w.geometries,function(it){if(it.type==="polygon"){var at=[it.exterior].concat(it.interiors||[]);f&&(at=d$(at,f)),pt(at,function(ft){H.push(new gl(y(ft)))})}else{var ut=it.points;f&&(ut=d$(ut,f,!0)),pt(ut,function(ft){q.push(new Us(y(ft)))})}});var Y=g(w.getCenter(),c&&c.project);function J(it,at){if(it.length){var ut=new pE({culling:!0,segmentIgnoreThreshold:1,shape:{paths:it}});E.add(ut),s$(t,ut,R,z),l$(t,ut,I,z,s,R,Y),at&&(o$(ut),pt(ut.states,o$))}}J(H),J(q,!0)}),e.each(function(w,I){var E=r.get(I),D=E.dataIdx,R=E.regionModel;u$(t,w,I,R,s,D),c$(t,w,I,R,s),h$(t,w,I,R,s)},this)},i.prototype._buildSVG=function(t){var e=t.geo.map,r=t.transformInfoRaw;this._svgGroup.x=r.x,this._svgGroup.y=r.y,this._svgGroup.scaleX=r.scaleX,this._svgGroup.scaleY=r.scaleY,this._svgResourceChanged(e)&&(this._freeSVG(),this._useSVG(e));var n=this._svgDispatcherMap=Fi(),o=!1;pt(this._svgGraphicRecord.named,function(s){var a=s.name,c=t.mapOrGeoModel,f=t.data,g=s.svgNodeTagLower,v=s.el,y=f?f.indexOfName(a):null,w=c.getRegionModel(a);WCt.get(g)!=null&&v instanceof Ou&&s$(t,v,y,w),v instanceof Ou&&(v.culling=!0);var I=w.get("silent",!0);if(I!=null&&(v.silent=I),v.z2EmphasisLift=0,!s.namedFrom&&(ZCt.get(g)!=null&&l$(t,v,a,w,c,y,null),u$(t,v,a,w,c,y),c$(t,v,a,w,c),$Ct.get(g)!=null)){var E=h$(t,v,a,w,c);E==="self"&&(o=!0);var D=n.get(a)||n.set(a,[]);D.push(v)}},this),this._enableBlurEntireSVG(o,t)},i.prototype._enableBlurEntireSVG=function(t,e){if(t&&e.isGeo){var r=e.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle(),n=r.opacity;this._svgGraphicRecord.root.traverse(function(o){if(!o.isGroup){yv(o);var s=o.ensureState("blur").style||{};s.opacity==null&&n!=null&&(s.opacity=n),o.ensureState("emphasis")}})}},i.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},i.prototype.findHighDownDispatchers=function(t,e){if(t==null)return[];var r=e.coordinateSystem;if(r.resourceType==="geoJSON"){var n=this._regionsGroupByName;if(n){var o=n.get(t);return o?[o]:[]}}else if(r.resourceType==="geoSVG")return this._svgDispatcherMap&&this._svgDispatcherMap.get(t)||[]},i.prototype._svgResourceChanged=function(t){return this._svgMapName!==t},i.prototype._useSVG=function(t){var e=Nd.getGeoResource(t);if(e&&e.type==="geoSVG"){var r=e.useGraphic(this.uid);this._svgGroup.add(r.root),this._svgGraphicRecord=r,this._svgMapName=t}},i.prototype._freeSVG=function(){var t=this._svgMapName;if(t!=null){var e=Nd.getGeoResource(t);e&&e.type==="geoSVG"&&e.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},i.prototype._updateController=function(t,e,r,n){var o=t.coordinateSystem,s=this._controller,a=this._controllerHost;a.zoomLimit=t.get("scaleLimit"),a.zoom=o.getZoom(),s.enable(t.get("roam")||!1,{api:n,zInfo:{component:t},triggerInfo:{roamTrigger:t.get("roamTrigger"),isInSelf:function(g,v,y){return o.containPoint([v,y])},isInClip:function(g,v,y){return!e||e.contain(v,y)}}});var c=t.mainType;function f(){var g={type:"geoRoam",componentType:c};return g[c+"Id"]=t.id,g}s.off("pan").on("pan",function(g){this._mouseDownFlag=!1,G3(a,g.dx,g.dy),n.dispatchAction(Ne(f(),{dx:g.dx,dy:g.dy,animation:{duration:0}}))},this),s.off("zoom").on("zoom",function(g){this._mouseDownFlag=!1,H3(a,g.scale,g.originX,g.originY),n.dispatchAction(Ne(f(),{totalZoom:a.zoom,zoom:g.scale,originX:g.originX,originY:g.originY,animation:{duration:0}}))},this)},i.prototype.resetForLabelLayout=function(){this.group.traverse(function(t){var e=t.getTextContent();e&&(e.ignore=Vet(e).ignore)})},i.prototype._updateMapSelectHandler=function(t,e,r,n){var o=this;e.off("mousedown"),e.off("click"),t.get("selectedMode")&&(e.on("mousedown",function(){o._mouseDownFlag=!0}),e.on("click",function(s){o._mouseDownFlag&&(o._mouseDownFlag=!1)}))},i}();function s$(i,t,e,r){var n=r.getModel("itemStyle"),o=r.getModel(["emphasis","itemStyle"]),s=r.getModel(["blur","itemStyle"]),a=r.getModel(["select","itemStyle"]),c=tI(n),f=tI(o),g=tI(a),v=tI(s),y=i.data;if(y){var w=y.getItemVisual(e,"style"),I=y.getItemVisual(e,"decal");i.isVisualEncodedByVisualMap&&w.fill&&(c.fill=w.fill),I&&(c.decal=A0(I,i.api))}t.setStyle(c),t.style.strokeNoScale=!0,t.ensureState("emphasis").style=f,t.ensureState("select").style=g,t.ensureState("blur").style=v,yv(t)}function l$(i,t,e,r,n,o,s){var a=i.data,c=i.isGeo,f=a&&isNaN(a.get(a.mapDimension("value"),o)),g=a&&a.getItemLayout(o);if(c||f||g&&g.showLabel){var v=c?e:o,y=void 0;(!a||o>=0)&&(y=n);var w=s?{normal:{align:"center",verticalAlign:"middle"}}:null;Xo(t,Fo(r),{labelFetcher:y,labelDataIndex:v,defaultText:e},w);var I=t.getTextContent();if(I&&(Vet(I).ignore=I.ignore,t.textConfig&&s)){var E=t.getBoundingRect().clone();t.textConfig.layoutRect=E,t.textConfig.position=[(s[0]-E.x)/E.width*100+"%",(s[1]-E.y)/E.height*100+"%"]}t.disableLabelAnimation=!0}else t.removeTextContent(),t.removeTextConfig(),t.disableLabelAnimation=null}function u$(i,t,e,r,n,o){i.data?i.data.setItemGraphicEl(o,t):cr(t).eventData={componentType:"geo",componentIndex:n.componentIndex,geoIndex:n.componentIndex,name:e,region:r&&r.option||{}}}function c$(i,t,e,r,n){i.data||Wd({el:t,componentModel:n,itemName:e,itemTooltipOption:r.get("tooltip")})}function h$(i,t,e,r,n){t.highDownSilentOnTouch=!!n.get("selectedMode");var o=r.getModel("emphasis"),s=o.get("focus");return Ca(t,s,o.get("blurScope"),o.get("disabled")),i.isGeo&&nxt(t,n,e),s}function d$(i,t,e){var r=[],n;function o(){n=[]}function s(){n.length&&(r.push(n),n=[])}var a=t({polygonStart:o,polygonEnd:s,lineStart:o,lineEnd:s,point:function(c,f){isFinite(c)&&isFinite(f)&&n.push([c,f])},sphere:function(){}});return!e&&a.polygonStart(),pt(i,function(c){a.lineStart();for(var f=0;f<c.length;f++)a.point(c[f][0],c[f][1]);a.lineEnd()}),!e&&a.polygonEnd(),r}const Uet=qCt;var XCt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){if(!(o&&o.type==="mapToggleSelect"&&o.from===this.uid)){var s=this.group;if(s.removeAll(),!e.getHostGeoModel()){if(this._mapDraw&&o&&o.type==="geoRoam"&&this._mapDraw.resetForLabelLayout(),o&&o.type==="geoRoam"&&o.componentType==="series"&&o.seriesId===e.id){var a=this._mapDraw;a&&s.add(a.group)}else if(e.needsDrawMap){var a=this._mapDraw||new Uet(n);s.add(a.group),a.draw(e,r,n,this,o),this._mapDraw=a}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;e.get("showLegendSymbol")&&r.getComponent("legend")&&this._renderSymbols(e,r,n)}}},t.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},t.prototype._renderSymbols=function(e,r,n){var o=e.originalData,s=this.group;o.each(o.mapDimension("value"),function(a,c){if(!isNaN(a)){var f=o.getItemLayout(c);if(!(!f||!f.point)){var g=f.point,v=f.offset,y=new Wp({style:{fill:e.getData().getVisual("style").fill},shape:{cx:g[0]+v*9,cy:g[1],r:3},silent:!0,z2:8+(v?0:V0+1)});if(!v){var w=e.mainSeries.getData(),I=o.getName(c),E=w.indexOfName(I),D=o.getItemModel(c),R=D.getModel("label"),z=w.getItemGraphicEl(E);Xo(y,Fo(D),{labelFetcher:{getFormattedLabel:function(N,H){return e.getFormattedLabel(E,H)}},defaultText:I}),y.disableLabelAnimation=!0,R.get("position")||y.setTextConfig({position:"bottom"}),z.onHoverStateChange=function(N){NC(y,N)}}s.add(y)}}})},t.type="map",t}(ga);const YCt=XCt;var KCt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.needsDrawMap=!1,e.seriesGroup=[],e.getTooltipPosition=function(r){if(r!=null){var n=this.getData().getName(r),o=this.coordinateSystem,s=o.getRegion(n);return s&&o.dataToPoint(s.getCenter())}},e}return t.prototype.getInitialData=function(e){for(var r=K0(this,{coordDimensions:["value"],encodeDefaulter:br(s3,this)}),n=Fi(),o=[],s=0,a=r.count();s<a;s++){var c=r.getName(s);n.set(c,s)}var f=Nd.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);return pt(f.regions,function(g){var v=g.name,y=n.get(v),w=g.properties&&g.properties.echartsStyle,I;y==null?(I={name:v},o.push(I)):I=r.getRawDataItem(y),w&&Er(I,w)}),r.appendData(o),r},t.prototype.getHostGeoModel=function(){if(AJ(this).kind!==ah.boxCoordSys)return this.getReferringComponents("geo",{useDefault:!1,enableAll:!1,enableNone:!1}).models[0]},t.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},t.prototype.getRawValue=function(e){var r=this.getData();return r.get(r.mapDimension("value"),e)},t.prototype.getRegionModel=function(e){var r=this.getData();return r.getItemModel(r.indexOfName(e))},t.prototype.formatTooltip=function(e,r,n){for(var o=this.getData(),s=this.getRawValue(e),a=o.getName(e),c=this.seriesGroup,f=[],g=0;g<c.length;g++){var v=c[g].originalData.indexOfName(a),y=o.mapDimension("value");isNaN(c[g].originalData.get(y,v))||f.push(c[g].name)}return So("section",{header:f.join(", "),noHeader:!f.length,blocks:[So("nameValue",{name:a,value:s})]})},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.getLegendIcon=function(e){var r=e.icon||"roundRect",n=To(r,0,0,e.itemWidth,e.itemHeight,e.itemStyle.fill);return n.setStyle(e.itemStyle),n.style.stroke="none",r.indexOf("empty")>-1&&(n.style.stroke=n.style.fill,n.style.fill=ye.color.neutral00,n.style.lineWidth=2),n},t.type="series.map",t.dependencies=["geo"],t.layoutMode="box",t.defaultOption={z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:ye.color.tertiary},itemStyle:{borderWidth:.5,borderColor:ye.color.border,areaColor:ye.color.background},emphasis:{label:{show:!0,color:ye.color.primary},itemStyle:{areaColor:ye.color.highlight}},select:{label:{show:!0,color:ye.color.primary},itemStyle:{color:ye.color.highlight}},nameProperty:"name"},t}(Ea);const JCt=KCt;function QCt(i,t){var e={};return pt(i,function(r){r.each(r.mapDimension("value"),function(n,o){var s="ec-"+r.getName(o);e[s]=e[s]||[],isNaN(n)||e[s].push(n)})}),i[0].map(i[0].mapDimension("value"),function(r,n){for(var o="ec-"+i[0].getName(n),s=0,a=1/0,c=-1/0,f=e[o].length,g=0;g<f;g++)a=Math.min(a,e[o][g]),c=Math.max(c,e[o][g]),s+=e[o][g];var v;return t==="min"?v=a:t==="max"?v=c:t==="average"?v=s/f:v=s,f===0?NaN:v})}function tMt(i){var t={};i.eachSeriesByType("map",function(e){var r=e.getHostGeoModel(),n=r?"o"+r.id:"i"+e.getMapType();(t[n]=t[n]||[]).push(e)}),pt(t,function(e,r){for(var n=QCt(ti(e,function(s){return s.getData()}),e[0].get("mapValueCalculation")),o=0;o<e.length;o++)e[o].originalData=e[o].getData();for(var o=0;o<e.length;o++)e[o].seriesGroup=e,e[o].needsDrawMap=o===0&&!e[o].getHostGeoModel(),e[o].setData(n.cloneShallow()),e[o].mainSeries=e[0]})}function eMt(i){var t={};i.eachSeriesByType("map",function(e){var r=e.getMapType();if(!(e.getHostGeoModel()||t[r])){var n={};pt(e.seriesGroup,function(s){var a=s.coordinateSystem,c=s.originalData;s.get("showLegendSymbol")&&i.getComponent("legend")&&c.each(c.mapDimension("value"),function(f,g){var v=c.getName(g),y=a.getRegion(v);if(!(!y||isNaN(f))){var w=n[v]||0,I=a.dataToPoint(y.getCenter());n[v]=w+1,c.setItemLayout(g,{point:I,offset:w})}})});var o=e.getData();o.each(function(s){var a=o.getName(s),c=o.getItemLayout(s)||{};c.showLabel=!n[a],o.setItemLayout(s,c)}),t[r]=!0}})}var f$=fo,iMt=function(i){Se(t,i);function t(e,r){var n=i.call(this)||this;return n.type="view",n.dimensions=["x","y"],n._roamTransformable=new xd,n._rawTransformable=new xd,n.name=e,n._opt=r,n}return t.prototype.setBoundingRect=function(e,r,n,o){return this._rect=new sr(e,r,n,o),this._updateCenterAndZoom(),this._rect},t.prototype.getBoundingRect=function(){return this._rect},t.prototype.setViewRect=function(e,r,n,o){this._transformTo(e,r,n,o),this._viewRect=new sr(e,r,n,o)},t.prototype._transformTo=function(e,r,n,o){var s=this.getBoundingRect(),a=this._rawTransformable;a.transform=s.calculateTransform(new sr(e,r,n,o));var c=a.parent;a.parent=null,a.decomposeTransform(),a.parent=c,this._updateTransform()},t.prototype.setCenter=function(e){var r=this._opt;r&&r.api&&r.ecModel&&r.ecModel.getShallow("legacyViewCoordSysCenterBase")&&e&&(e=[xi(e[0],r.api.getWidth()),xi(e[1],r.api.getWidth())]),this._centerOption=Yi(e),this._updateCenterAndZoom()},t.prototype.setZoom=function(e){this._zoom=j3(e||1,this.zoomLimit),this._updateCenterAndZoom()},t.prototype.getDefaultCenter=function(){var e=this.getBoundingRect(),r=e.x+e.width/2,n=e.y+e.height/2;return[r,n]},t.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},t.prototype.getZoom=function(){return this._zoom||1},t.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},t.prototype._updateCenterAndZoom=function(){var e=this._centerOption,r=this._rect;e&&r&&(this._center=[xi(e[0],r.width,r.x),xi(e[1],r.height,r.y)]);var n=this._rawTransformable.getLocalTransform(),o=this._roamTransformable,s=this.getDefaultCenter(),a=this.getCenter(),c=this.getZoom();a=fo([],a,n),s=fo([],s,n),o.originX=a[0],o.originY=a[1],o.x=s[0]-a[0],o.y=s[1]-a[1],o.scaleX=o.scaleY=c,this._updateTransform()},t.prototype._updateTransform=function(){var e=this._roamTransformable,r=this._rawTransformable;r.parent=e,e.updateTransform(),r.updateTransform(),eE(this.transform||(this.transform=[]),r.transform||as()),this._rawTransform=r.getLocalTransform(),this.invTransform=this.invTransform||[],_c(this.invTransform,this.transform),this.decomposeTransform()},t.prototype.getTransformInfo=function(){var e=this._rawTransformable,r=this._roamTransformable,n=new xd;return n.transform=r.transform,n.decomposeTransform(),{roam:{x:n.x,y:n.y,scaleX:n.scaleX,scaleY:n.scaleY},raw:{x:e.x,y:e.y,scaleX:e.scaleX,scaleY:e.scaleY}}},t.prototype.getViewRect=function(){return this._viewRect},t.prototype.getViewRectAfterRoam=function(){var e=this.getBoundingRect().clone();return e.applyTransform(this.transform),e},t.prototype.dataToPoint=function(e,r,n){var o=r?this._rawTransform:this.transform;return n=n||[],o?f$(n,e,o):ll(n,e)},t.prototype.pointToData=function(e,r,n){n=n||[];var o=this.invTransform;return o?f$(n,e,o):(n[0]=e[0],n[1]=e[1],n)},t.prototype.convertToPixel=function(e,r,n){var o=p$(r);return o===this?o.dataToPoint(n):null},t.prototype.convertFromPixel=function(e,r,n){var o=p$(r);return o===this?o.pointToData(n):null},t.prototype.containPoint=function(e){return this.getViewRectAfterRoam().contain(e[0],e[1])},t.dimensions=["x","y"],t}(xd);function p$(i){var t=i.seriesModel;return t?t.coordinateSystem:null}const Fv=iMt;var rMt={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},Get=["lng","lat"],Het=function(i){Se(t,i);function t(e,r,n){var o=i.call(this,e,{api:n.api,ecModel:n.ecModel})||this;o.dimensions=Get,o.type="geo",o._nameCoordMap=Fi(),o.map=r;var s=n.projection,a=Nd.load(r,n.nameMap,n.nameProperty),c=Nd.getGeoResource(r);o.resourceType=c?c.type:null;var f=o.regions=a.regions,g=rMt[c.type];o._regionsMap=a.regionsMap,o.regions=a.regions,o.projection=s;var v;if(s)for(var y=0;y<f.length;y++){var w=f[y].getBoundingRect(s);v=v||w.clone(),v.union(w)}else v=a.boundingRect;return o.setBoundingRect(v.x,v.y,v.width,v.height),o.aspectScale=s?1:Ui(n.aspectScale,g.aspectScale),o._invertLongitute=s?!1:g.invertLongitute,o}return t.prototype._transformTo=function(e,r,n,o){var s=this.getBoundingRect(),a=this._invertLongitute;s=s.clone(),a&&(s.y=-s.y-s.height);var c=this._rawTransformable;c.transform=s.calculateTransform(new sr(e,r,n,o));var f=c.parent;c.parent=null,c.decomposeTransform(),c.parent=f,a&&(c.scaleY=-c.scaleY),this._updateTransform()},t.prototype.getRegion=function(e){return this._regionsMap.get(e)},t.prototype.getRegionByCoord=function(e){for(var r=this.regions,n=0;n<r.length;n++){var o=r[n];if(o.type==="geoJSON"&&o.contain(e))return r[n]}},t.prototype.addGeoCoord=function(e,r){this._nameCoordMap.set(e,r)},t.prototype.getGeoCoord=function(e){var r=this._regionsMap.get(e);return this._nameCoordMap.get(e)||r&&r.getCenter()},t.prototype.dataToPoint=function(e,r,n){if(wi(e)&&(e=this.getGeoCoord(e)),e){var o=this.projection;return o&&(e=o.project(e)),e&&this.projectedToPoint(e,r,n)}},t.prototype.pointToData=function(e,r,n){var o=this.projection;return o&&(e=o.unproject(e)),e&&this.pointToProjected(e,n)},t.prototype.pointToProjected=function(e,r){return i.prototype.pointToData.call(this,e,0,r)},t.prototype.projectedToPoint=function(e,r,n){return i.prototype.dataToPoint.call(this,e,r,n)},t.prototype.convertToPixel=function(e,r,n){var o=g$(r);return o===this?o.dataToPoint(n):null},t.prototype.convertFromPixel=function(e,r,n){var o=g$(r);return o===this?o.pointToData(n):null},t}(Fv);Ao(Het,Fv);function g$(i){var t=i.geoModel,e=i.seriesModel;return t?t.coordinateSystem:e?e.coordinateSystem||(e.getReferringComponents("geo",Wa).models[0]||{}).coordinateSystem:null}const m$=Het;function v$(i,t){var e=i.get("boundingCoords");if(e!=null){var r=e[0],n=e[1];if(isFinite(r[0])&&isFinite(r[1])&&isFinite(n[0])&&isFinite(n[1])){var o=this.projection;if(o){var s=r[0],a=r[1],c=n[0],f=n[1];r=[1/0,1/0],n=[-1/0,-1/0];var g=function(q,Y,J,it){for(var at=J-q,ut=it-Y,ft=0;ft<=100;ft++){var _t=ft/100,ct=o.project([q+at*_t,Y+ut*_t]);fp(r,r,ct),pp(n,n,ct)}};g(s,a,c,a),g(c,a,c,f),g(c,f,s,f),g(s,f,c,a)}this.setBoundingRect(r[0],r[1],n[0]-r[0],n[1]-r[1])}}var v=this.getBoundingRect(),y=i.get("layoutCenter"),w=i.get("layoutSize"),I=No(i,t).refContainer,E=v.width/v.height*this.aspectScale,D=!1,R,z;y&&w&&(R=[xi(y[0],I.width)+I.x,xi(y[1],I.height)+I.y],z=xi(w,Math.min(I.width,I.height)),!isNaN(R[0])&&!isNaN(R[1])&&!isNaN(z)&&(D=!0));var N;if(D)N={},E>1?(N.width=z,N.height=z/E):(N.height=z,N.width=z*E),N.y=R[1]-N.height/2,N.x=R[0]-N.width/2;else{var H=i.getBoxLayoutParams();H.aspect=E,N=Ma(H,I),N=DJ(i,N,E)}this.setViewRect(N.x,N.y,N.width,N.height),this.setCenter(i.get("center")),this.setZoom(i.get("zoom"))}function nMt(i,t){pt(t.get("geoCoord"),function(e,r){i.addGeoCoord(r,e)})}var aMt=function(){function i(){this.dimensions=Get}return i.prototype.create=function(t,e){var r=[];function n(s){return{nameProperty:s.get("nameProperty"),aspectScale:s.get("aspectScale"),projection:s.get("projection")}}t.eachComponent("geo",function(s,a){var c=s.get("map"),f=new m$(c+a,c,Ne({nameMap:s.get("nameMap"),api:e,ecModel:t},n(s)));f.zoomLimit=s.get("scaleLimit"),r.push(f),s.coordinateSystem=f,f.model=s,f.resize=v$,f.resize(s,e)}),t.eachSeries(function(s){jS({targetModel:s,coordSysType:"geo",coordSysProvider:function(){var a=s.subType==="map"?s.getHostGeoModel():s.getReferringComponents("geo",Wa).models[0];return a&&a.coordinateSystem},allowNotFound:!0})});var o={};return t.eachSeriesByType("map",function(s){if(!s.getHostGeoModel()){var a=s.getMapType();o[a]=o[a]||[],o[a].push(s)}}),pt(o,function(s,a){var c=ti(s,function(g){return g.get("nameMap")}),f=new m$(a,a,Ne({nameMap:bF(c),api:e,ecModel:t},n(s[0])));f.zoomLimit=vs.apply(null,ti(s,function(g){return g.get("scaleLimit")})),r.push(f),f.resize=v$,f.resize(s[0],e),pt(s,function(g){g.coordinateSystem=f,nMt(f,g)})}),r},i.prototype.getFilledRegions=function(t,e,r,n){for(var o=(t||[]).slice(),s=Fi(),a=0;a<o.length;a++)s.set(o[a].name,o[a]);var c=Nd.load(e,r,n);return pt(c.regions,function(f){var g=f.name,v=s.get(g),y=f.properties&&f.properties.echartsStyle;v||(v={name:g},o.push(v)),y&&Er(v,y)}),o},i}(),oMt=new aMt;const jet=oMt;var sMt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n);var o=Nd.getGeoResource(e.map);if(o&&o.type==="geoJSON"){var s=e.itemStyle=e.itemStyle||{};"color"in s||(s.color=e.defaultItemStyleColor||ye.color.backgroundTint)}mv(e,"label",["show"])},t.prototype.optionUpdated=function(){var e=this,r=this.option;r.regions=jet.getFilledRegions(r.regions,r.map,r.nameMap,r.nameProperty);var n={};this._optionModelMap=xh(r.regions||[],function(o,s){var a=s.name;return a&&(o.set(a,new bn(s,e,e.ecModel)),s.selected&&(n[a]=!0)),o},Fi()),r.selectedMap||(r.selectedMap=n)},t.prototype.getRegionModel=function(e){return this._optionModelMap.get(e)||new bn(null,this,this.ecModel)},t.prototype.getFormattedLabel=function(e,r){var n=this.getRegionModel(e),o=r==="normal"?n.get(["label","formatter"]):n.get(["emphasis","label","formatter"]),s={name:e};if(Xi(o))return s.status=r,o(s);if(wi(o))return o.replace("{a}",e??"")},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.select=function(e){var r=this.option,n=r.selectedMode;if(n){n!=="multiple"&&(r.selectedMap=null);var o=r.selectedMap||(r.selectedMap={});o[e]=!0}},t.prototype.unSelect=function(e){var r=this.option.selectedMap;r&&(r[e]=!1)},t.prototype.toggleSelected=function(e){this[this.isSelected(e)?"unSelect":"select"](e)},t.prototype.isSelected=function(e){var r=this.option.selectedMap;return!!(r&&r[e])},t.type="geo",t.layoutMode="box",t.defaultOption={z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:ye.color.tertiary},itemStyle:{borderWidth:.5,borderColor:ye.color.border},emphasis:{label:{show:!0,color:ye.color.primary},itemStyle:{color:ye.color.highlight}},select:{label:{show:!0,color:ye.color.primary},itemStyle:{color:ye.color.highlight}},regions:[]},t}(gn);const lMt=sMt;var uMt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.focusBlurEnabled=!0,e}return t.prototype.init=function(e,r){this._api=r},t.prototype.render=function(e,r,n,o){if(this._model=e,!e.get("show")){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;return}this._mapDraw||(this._mapDraw=new Uet(n));var s=this._mapDraw;s.draw(e,r,n,this,o),s.group.on("click",this._handleRegionClick,this),s.group.silent=e.get("silent"),this.group.add(s.group),this.updateSelectStatus(e,r,n)},t.prototype._handleRegionClick=function(e){var r;Xm(e.target,function(n){return(r=cr(n).eventData)!=null},!0),r&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:r.name})},t.prototype.updateSelectStatus=function(e,r,n){var o=this;this._mapDraw.group.traverse(function(s){var a=cr(s).eventData;if(a)return o._model.isSelected(a.name)?n.enterSelect(s):n.leaveSelect(s),!0})},t.prototype.findHighDownDispatchers=function(e){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(e,this._model)},t.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},t.type="geo",t}(Oa);const cMt=uMt;function hMt(i,t,e){Nd.registerMap(i,t,e)}function Wet(i){i.registerCoordinateSystem("geo",jet),i.registerComponentModel(lMt),i.registerComponentView(cMt),i.registerImpl("registerMap",hMt),i.registerImpl("getMap",function(e){return Nd.getMapForUser(e)});function t(e,r){r.update="geo:updateSelectStatus",i.registerAction(r,function(n,o){var s={},a=[];return o.eachComponent({mainType:"geo",query:n},function(c){c[e](n.name);var f=c.coordinateSystem;pt(f.regions,function(v){s[v.name]=c.isSelected(v.name)||!1});var g=[];pt(s,function(v,y){s[y]&&g.push(y)}),a.push({geoIndex:c.componentIndex,name:g})}),{selected:s,allSelected:a,name:n.name}})}t("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),t("select",{type:"geoSelect",event:"geoselected"}),t("unSelect",{type:"geoUnSelect",event:"geounselected"}),i.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},function(e,r,n){var o=e.componentType;o||(e.geoId!=null?o="geo":e.seriesId!=null&&(o="series")),o||(o="series"),r.eachComponent({mainType:o,query:e},function(s){var a=s.coordinateSystem;if(a.type==="geo"){var c=DE(a,e,s.get("scaleLimit"));s.setCenter&&s.setCenter(c.center),s.setZoom&&s.setZoom(c.zoom),o==="series"&&pt(s.seriesGroup,function(f){f.setCenter(c.center),f.setZoom(c.zoom)})}})})}function dMt(i){Rr(Wet),i.registerChartView(YCt),i.registerSeriesModel(JCt),i.registerLayout(eMt),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,tMt),wQ("map",i.registerAction)}function fMt(i){var t=i;t.hierNode={defaultAncestor:null,ancestor:t,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var e=[t],r,n;r=e.pop();)if(n=r.children,r.isExpand&&n.length)for(var o=n.length,s=o-1;s>=0;s--){var a=n[s];a.hierNode={defaultAncestor:null,ancestor:a,prelim:0,modifier:0,change:0,shift:0,i:s,thread:null},e.push(a)}}function pMt(i,t){var e=i.isExpand?i.children:[],r=i.parentNode.children,n=i.hierNode.i?r[i.hierNode.i-1]:null;if(e.length){mMt(i);var o=(e[0].hierNode.prelim+e[e.length-1].hierNode.prelim)/2;n?(i.hierNode.prelim=n.hierNode.prelim+t(i,n),i.hierNode.modifier=i.hierNode.prelim-o):i.hierNode.prelim=o}else n&&(i.hierNode.prelim=n.hierNode.prelim+t(i,n));i.parentNode.hierNode.defaultAncestor=vMt(i,n,i.parentNode.hierNode.defaultAncestor||r[0],t)}function gMt(i){var t=i.hierNode.prelim+i.parentNode.hierNode.modifier;i.setLayout({x:t},!0),i.hierNode.modifier+=i.parentNode.hierNode.modifier}function _$(i){return arguments.length?i:xMt}function ow(i,t){return i-=Math.PI/2,{x:t*Math.cos(i),y:t*Math.sin(i)}}function mMt(i){for(var t=i.children,e=t.length,r=0,n=0;--e>=0;){var o=t[e];o.hierNode.prelim+=r,o.hierNode.modifier+=r,n+=o.hierNode.change,r+=o.hierNode.shift+n}}function vMt(i,t,e,r){if(t){for(var n=i,o=i,s=o.parentNode.children[0],a=t,c=n.hierNode.modifier,f=o.hierNode.modifier,g=s.hierNode.modifier,v=a.hierNode.modifier;a=VR(a),o=UR(o),a&&o;){n=VR(n),s=UR(s),n.hierNode.ancestor=i;var y=a.hierNode.prelim+v-o.hierNode.prelim-f+r(a,o);y>0&&(yMt(_Mt(a,i,e),i,y),f+=y,c+=y),v+=a.hierNode.modifier,f+=o.hierNode.modifier,c+=n.hierNode.modifier,g+=s.hierNode.modifier}a&&!VR(n)&&(n.hierNode.thread=a,n.hierNode.modifier+=v-c),o&&!UR(s)&&(s.hierNode.thread=o,s.hierNode.modifier+=f-g,e=i)}return e}function VR(i){var t=i.children;return t.length&&i.isExpand?t[t.length-1]:i.hierNode.thread}function UR(i){var t=i.children;return t.length&&i.isExpand?t[0]:i.hierNode.thread}function _Mt(i,t,e){return i.hierNode.ancestor.parentNode===t.parentNode?i.hierNode.ancestor:e}function yMt(i,t,e){var r=e/(t.hierNode.i-i.hierNode.i);t.hierNode.change-=r,t.hierNode.shift+=e,t.hierNode.modifier+=e,t.hierNode.prelim+=e,i.hierNode.change+=r}function xMt(i,t){return i.parentNode===t.parentNode?1:2}var bMt=function(){function i(){this.parentPoint=[],this.childPoints=[]}return i}(),wMt=function(i){Se(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultStyle=function(){return{stroke:ye.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new bMt},t.prototype.buildPath=function(e,r){var n=r.childPoints,o=n.length,s=r.parentPoint,a=n[0],c=n[o-1];if(o===1){e.moveTo(s[0],s[1]),e.lineTo(a[0],a[1]);return}var f=r.orient,g=f==="TB"||f==="BT"?0:1,v=1-g,y=xi(r.forkPosition,1),w=[];w[g]=s[g],w[v]=s[v]+(c[v]-s[v])*y,e.moveTo(s[0],s[1]),e.lineTo(w[0],w[1]),e.moveTo(a[0],a[1]),w[g]=a[g],e.lineTo(w[0],w[1]),w[g]=c[g],e.lineTo(w[0],w[1]),e.lineTo(c[0],c[1]);for(var I=1;I<o-1;I++){var E=n[I];e.moveTo(E[0],E[1]),w[g]=E[g],e.lineTo(w[0],w[1])}},t}(qr),SMt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._mainGroup=new Ki,e}return t.prototype.init=function(e,r){this._controller=new Bv(r.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},t.prototype.render=function(e,r,n){var o=e.getData(),s=e.layoutInfo,a=this._mainGroup,c=e.get("layout");c==="radial"?(a.x=s.x+s.width/2,a.y=s.y+s.height/2):(a.x=s.x,a.y=s.y),this._updateViewCoordSys(e,n),this._updateController(e,null,r,n);var f=this._data;o.diff(f).add(function(g){y$(o,g)&&x$(o,g,null,a,e)}).update(function(g,v){var y=f.getItemGraphicEl(v);if(!y$(o,g)){y&&w$(f,v,y,a,e);return}x$(o,g,y,a,e)}).remove(function(g){var v=f.getItemGraphicEl(g);v&&w$(f,g,v,a,e)}).execute(),this._nodeScaleRatio=e.get("nodeScaleRatio"),this._updateNodeAndLinkScale(e),e.get("expandAndCollapse")===!0&&o.eachItemGraphicEl(function(g,v){g.off("click").on("click",function(){n.dispatchAction({type:"treeExpandAndCollapse",seriesId:e.id,dataIndex:v})})}),this._data=o},t.prototype._updateViewCoordSys=function(e,r){var n=e.getData(),o=[];n.each(function(v){var y=n.getItemLayout(v);y&&!isNaN(y.x)&&!isNaN(y.y)&&o.push([+y.x,+y.y])});var s=[],a=[];sE(o,s,a);var c=this._min,f=this._max;a[0]-s[0]===0&&(s[0]=c?c[0]:s[0]-1,a[0]=f?f[0]:a[0]+1),a[1]-s[1]===0&&(s[1]=c?c[1]:s[1]-1,a[1]=f?f[1]:a[1]+1);var g=e.coordinateSystem=new Fv(null,{api:r,ecModel:e.ecModel});g.zoomLimit=e.get("scaleLimit"),g.setBoundingRect(s[0],s[1],a[0]-s[0],a[1]-s[1]),g.setCenter(e.get("center")),g.setZoom(e.get("zoom")),this.group.attr({x:g.x,y:g.y,scaleX:g.scaleX,scaleY:g.scaleY}),this._min=s,this._max=a},t.prototype._updateController=function(e,r,n,o){var s=this;Oet(e,o,this.group,this._controller,this._controllerHost,r),this._controller.on("zoom",function(a){s._updateNodeAndLinkScale(e)})},t.prototype._updateNodeAndLinkScale=function(e){var r=e.getData(),n=this._getNodeGlobalScale(e);r.eachItemGraphicEl(function(o,s){o.setSymbolScale(n)})},t.prototype._getNodeGlobalScale=function(e){var r=e.coordinateSystem;if(r.type!=="view")return 1;var n=this._nodeScaleRatio,o=r.scaleX||1,s=r.getZoom(),a=(s-1)*n+1;return a/o},t.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype.remove=function(){this._mainGroup.removeAll(),this._data=null},t.type="tree",t}(ga);function y$(i,t){var e=i.getItemLayout(t);return e&&!isNaN(e.x)&&!isNaN(e.y)}function x$(i,t,e,r,n){var o=!e,s=i.tree.getNodeByDataIndex(t),a=s.getModel(),c=s.getVisual("style").fill,f=s.isExpand===!1&&s.children.length!==0?c:ye.color.neutral00,g=i.tree.root,v=s.parentNode===g?s:s.parentNode||s,y=i.getItemGraphicEl(v.dataIndex),w=v.getLayout(),I=y?{x:y.__oldX,y:y.__oldY,rawX:y.__radialOldRawX,rawY:y.__radialOldRawY}:w,E=s.getLayout();o?(e=new qS(i,t,null,{symbolInnerColor:f,useNameLabel:!0}),e.x=I.x,e.y=I.y):e.updateData(i,t,null,{symbolInnerColor:f,useNameLabel:!0}),e.__radialOldRawX=e.__radialRawX,e.__radialOldRawY=e.__radialRawY,e.__radialRawX=E.rawX,e.__radialRawY=E.rawY,r.add(e),i.setItemGraphicEl(t,e),e.__oldX=e.x,e.__oldY=e.y,yn(e,{x:E.x,y:E.y},n);var D=e.getSymbolPath();if(n.get("layout")==="radial"){var R=g.children[0],z=R.getLayout(),N=R.children.length,H=void 0,q=void 0;if(E.x===z.x&&s.isExpand===!0&&R.children.length){var Y={x:(R.children[0].getLayout().x+R.children[N-1].getLayout().x)/2,y:(R.children[0].getLayout().y+R.children[N-1].getLayout().y)/2};H=Math.atan2(Y.y-z.y,Y.x-z.x),H<0&&(H=Math.PI*2+H),q=Y.x<z.x,q&&(H=H-Math.PI)}else H=Math.atan2(E.y-z.y,E.x-z.x),H<0&&(H=Math.PI*2+H),s.children.length===0||s.children.length!==0&&s.isExpand===!1?(q=E.x<z.x,q&&(H=H-Math.PI)):(q=E.x>z.x,q||(H=H-Math.PI));var J=q?"left":"right",it=a.getModel("label"),at=it.get("rotate"),ut=at*(Math.PI/180),ft=D.getTextContent();ft&&(D.setTextConfig({position:it.get("position")||J,rotation:at==null?-H:ut,origin:"center"}),ft.setStyle("verticalAlign","middle"))}var _t=a.get(["emphasis","focus"]),ct=_t==="relative"?Kw(s.getAncestorsIndices(),s.getDescendantIndices()):_t==="ancestor"?s.getAncestorsIndices():_t==="descendant"?s.getDescendantIndices():null;ct&&(cr(e).focus=ct),TMt(n,s,g,e,I,w,E,r),e.__edge&&(e.onHoverStateChange=function(Dt){if(Dt!=="blur"){var Et=s.parentNode&&i.getItemGraphicEl(s.parentNode.dataIndex);Et&&Et.hoverState===NS||NC(e.__edge,Dt)}})}function TMt(i,t,e,r,n,o,s,a){var c=t.getModel(),f=i.get("edgeShape"),g=i.get("layout"),v=i.getOrient(),y=i.get(["lineStyle","curveness"]),w=i.get("edgeForkPosition"),I=c.getModel("lineStyle").getLineStyle(),E=r.__edge;if(f==="curve")t.parentNode&&t.parentNode!==e&&(E||(E=r.__edge=new fE({shape:Jz(g,v,y,n,n)})),yn(E,{shape:Jz(g,v,y,o,s)},i));else if(f==="polyline"&&g==="orthogonal"&&t!==e&&t.children&&t.children.length!==0&&t.isExpand===!0){for(var D=t.children,R=[],z=0;z<D.length;z++){var N=D[z].getLayout();R.push([N.x,N.y])}E||(E=r.__edge=new wMt({shape:{parentPoint:[s.x,s.y],childPoints:[[s.x,s.y]],orient:v,forkPosition:w}})),yn(E,{shape:{parentPoint:[s.x,s.y],childPoints:R}},i)}E&&!(f==="polyline"&&!t.isExpand)&&(E.useStyle(rr({strokeNoScale:!0,fill:null},I)),Bo(E,c,"lineStyle"),yv(E),a.add(E))}function b$(i,t,e,r,n){var o=t.tree.root,s=$et(o,i),a=s.source,c=s.sourceLayout,f=t.getItemGraphicEl(i.dataIndex);if(f){var g=t.getItemGraphicEl(a.dataIndex),v=g.__edge,y=f.__edge||(a.isExpand===!1||a.children.length===1?v:void 0),w=r.get("edgeShape"),I=r.get("layout"),E=r.get("orient"),D=r.get(["lineStyle","curveness"]);y&&(w==="curve"?Op(y,{shape:Jz(I,E,D,c,c),style:{opacity:0}},r,{cb:function(){e.remove(y)},removeOpt:n}):w==="polyline"&&r.get("layout")==="orthogonal"&&Op(y,{shape:{parentPoint:[c.x,c.y],childPoints:[[c.x,c.y]]},style:{opacity:0}},r,{cb:function(){e.remove(y)},removeOpt:n}))}}function $et(i,t){for(var e=t.parentNode===i?t:t.parentNode||t,r;r=e.getLayout(),r==null;)e=e.parentNode===i?e:e.parentNode||e;return{source:e,sourceLayout:r}}function w$(i,t,e,r,n){var o=i.tree.getNodeByDataIndex(t),s=i.tree.root,a=$et(s,o).sourceLayout,c={duration:n.get("animationDurationUpdate"),easing:n.get("animationEasingUpdate")};Op(e,{x:a.x+1,y:a.y+1},n,{cb:function(){r.remove(e),i.setItemGraphicEl(t,null)},removeOpt:c}),e.fadeOut(null,i.hostModel,{fadeLabel:!0,animation:c}),o.children.forEach(function(f){b$(f,i,r,n,c)}),b$(o,i,r,n,c)}function Jz(i,t,e,r,n){var o,s,a,c,f,g,v,y;if(i==="radial"){f=r.rawX,v=r.rawY,g=n.rawX,y=n.rawY;var w=ow(f,v),I=ow(f,v+(y-v)*e),E=ow(g,y+(v-y)*e),D=ow(g,y);return{x1:w.x||0,y1:w.y||0,x2:D.x||0,y2:D.y||0,cpx1:I.x||0,cpy1:I.y||0,cpx2:E.x||0,cpy2:E.y||0}}else f=r.x,v=r.y,g=n.x,y=n.y,(t==="LR"||t==="RL")&&(o=f+(g-f)*e,s=v,a=g+(f-g)*e,c=y),(t==="TB"||t==="BT")&&(o=f,s=v+(y-v)*e,a=g,c=y+(v-y)*e);return{x1:f,y1:v,x2:g,y2:y,cpx1:o,cpy1:s,cpx2:a,cpy2:c}}const AMt=SMt;var Ru=Wr();function Zet(i){var t=i.mainData,e=i.datas;e||(e={main:t},i.datasAttr={main:"data"}),i.datas=i.mainData=null,qet(t,e,i),pt(e,function(r){pt(t.TRANSFERABLE_METHODS,function(n){r.wrapMethod(n,br(IMt,i))})}),t.wrapMethod("cloneShallow",br(MMt,i)),pt(t.CHANGABLE_METHODS,function(r){t.wrapMethod(r,br(CMt,i))}),Vs(e[t.dataType]===t)}function IMt(i,t){if(PMt(this)){var e=Ne({},Ru(this).datas);e[this.dataType]=t,qet(t,e,i)}else $3(t,this.dataType,Ru(this).mainData,i);return t}function CMt(i,t){return i.struct&&i.struct.update(),t}function MMt(i,t){return pt(Ru(t).datas,function(e,r){e!==t&&$3(e.cloneShallow(),r,t,i)}),t}function EMt(i){var t=Ru(this).mainData;return i==null||t==null?t:Ru(t).datas[i]}function DMt(){var i=Ru(this).mainData;return i==null?[{data:i}]:ti(on(Ru(i).datas),function(t){return{type:t,data:Ru(i).datas[t]}})}function PMt(i){return Ru(i).mainData===i}function qet(i,t,e){Ru(i).datas={},pt(t,function(r,n){$3(r,n,i,e)})}function $3(i,t,e,r){Ru(e).datas[t]=i,Ru(i).mainData=e,i.dataType=t,r.struct&&(i[r.structAttr]=r.struct,r.struct[r.datasAttr[t]]=i),i.getLinkedData=EMt,i.getLinkedDataAll=DMt}var LMt=function(){function i(t,e){this.depth=0,this.height=0,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.isExpand=!1,this.name=t||"",this.hostTree=e}return i.prototype.isRemoved=function(){return this.dataIndex<0},i.prototype.eachNode=function(t,e,r){Xi(t)&&(r=e,e=t,t=null),t=t||{},wi(t)&&(t={order:t});var n=t.order||"preorder",o=this[t.attr||"children"],s;n==="preorder"&&(s=e.call(r,this));for(var a=0;!s&&a<o.length;a++)o[a].eachNode(t,e,r);n==="postorder"&&e.call(r,this)},i.prototype.updateDepthAndHeight=function(t){var e=0;this.depth=t;for(var r=0;r<this.children.length;r++){var n=this.children[r];n.updateDepthAndHeight(t+1),n.height>e&&(e=n.height)}this.height=e+1},i.prototype.getNodeById=function(t){if(this.getId()===t)return this;for(var e=0,r=this.children,n=r.length;e<n;e++){var o=r[e].getNodeById(t);if(o)return o}},i.prototype.contains=function(t){if(t===this)return!0;for(var e=0,r=this.children,n=r.length;e<n;e++){var o=r[e].contains(t);if(o)return o}},i.prototype.getAncestors=function(t){for(var e=[],r=t?this:this.parentNode;r;)e.push(r),r=r.parentNode;return e.reverse(),e},i.prototype.getAncestorsIndices=function(){for(var t=[],e=this;e;)t.push(e.dataIndex),e=e.parentNode;return t.reverse(),t},i.prototype.getDescendantIndices=function(){var t=[];return this.eachNode(function(e){t.push(e.dataIndex)}),t},i.prototype.getValue=function(t){var e=this.hostTree.data;return e.getStore().get(e.getDimensionIndex(t||"value"),this.dataIndex)},i.prototype.setLayout=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,t,e)},i.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)},i.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostTree,r=e.data.getItemModel(this.dataIndex);return r.getModel(t)}},i.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]},i.prototype.setVisual=function(t,e){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,t,e)},i.prototype.getVisual=function(t){return this.hostTree.data.getItemVisual(this.dataIndex,t)},i.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)},i.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)},i.prototype.getChildIndex=function(){if(this.parentNode){for(var t=this.parentNode.children,e=0;e<t.length;++e)if(t[e]===this)return e;return-1}return-1},i.prototype.isAncestorOf=function(t){for(var e=t.parentNode;e;){if(e===this)return!0;e=e.parentNode}return!1},i.prototype.isDescendantOf=function(t){return t!==this&&t.isAncestorOf(this)},i}(),RMt=function(){function i(t){this.type="tree",this._nodes=[],this.hostModel=t}return i.prototype.eachNode=function(t,e,r){this.root.eachNode(t,e,r)},i.prototype.getNodeByDataIndex=function(t){var e=this.data.getRawIndex(t);return this._nodes[e]},i.prototype.getNodeById=function(t){return this.root.getNodeById(t)},i.prototype.update=function(){for(var t=this.data,e=this._nodes,r=0,n=e.length;r<n;r++)e[r].dataIndex=-1;for(var r=0,n=t.count();r<n;r++)e[t.getRawIndex(r)].dataIndex=r},i.prototype.clearLayouts=function(){this.data.clearItemLayouts()},i.createTree=function(t,e,r){var n=new i(e),o=[],s=1;a(t);function a(g,v){var y=g.value;s=Math.max(s,Ye(y)?y.length:1),o.push(g);var w=new LMt(ko(g.name,""),n);v?kMt(w,v):n.root=w,n._nodes.push(w);var I=g.children;if(I)for(var E=0;E<I.length;E++)a(I[E],w)}n.root.updateDepthAndHeight(0);var c=$S(o,{coordDimensions:["value"],dimensionsCount:s}).dimensions,f=new dl(c,e);return f.initData(o),r&&r(f),Zet({mainData:f,struct:n,structAttr:"tree"}),n.update(),n},i}();function kMt(i,t){var e=t.children;i.parentNode!==t&&(e.push(i),i.parentNode=t)}const Z3=RMt;function xS(i,t,e){if(i&&Ar(t,i.type)>=0){var r=e.getData().tree.root,n=i.targetNode;if(wi(n)&&(n=r.getNodeById(n)),n&&r.contains(n))return{node:n};var o=i.targetNodeId;if(o!=null&&(n=r.getNodeById(o)))return{node:n}}}function Xet(i){for(var t=[];i;)i=i.parentNode,i&&t.push(i);return t.reverse()}function q3(i,t){var e=Xet(i);return Ar(e,t)>=0}function LE(i,t){for(var e=[];i;){var r=i.dataIndex;e.push({name:i.name,dataIndex:r,value:t.getRawValue(r)}),i=i.parentNode}return e.reverse(),e}var OMt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.hasSymbolVisual=!0,e.ignoreStyleOnData=!0,e}return t.prototype.getInitialData=function(e){var r={name:e.name,children:e.data},n=e.leaves||{},o=new bn(n,this,this.ecModel),s=Z3.createTree(r,this,a);function a(v){v.wrapMethod("getItemModel",function(y,w){var I=s.getNodeByDataIndex(w);return I&&I.children.length&&I.isExpand||(y.parentModel=o),y})}var c=0;s.eachNode("preorder",function(v){v.depth>c&&(c=v.depth)});var f=e.expandAndCollapse,g=f&&e.initialTreeDepth>=0?e.initialTreeDepth:c;return s.root.eachNode("preorder",function(v){var y=v.hostTree.data.getRawDataItem(v.dataIndex);v.isExpand=y&&y.collapsed!=null?!y.collapsed:v.depth<=g}),s.data},t.prototype.getOrient=function(){var e=this.get("orient");return e==="horizontal"?e="LR":e==="vertical"&&(e="TB"),e},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.formatTooltip=function(e,r,n){for(var o=this.getData().tree,s=o.root.children[0],a=o.getNodeByDataIndex(e),c=a.getValue(),f=a.name;a&&a!==s;)f=a.parentNode.name+"."+f,a=a.parentNode;return So("nameValue",{name:f,value:c,noValue:isNaN(c)||c==null})},t.prototype.getDataParams=function(e){var r=i.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return r.treeAncestors=LE(n,this),r.collapsed=!n.isExpand,r},t.type="series.tree",t.layoutMode="box",t.defaultOption={z:2,coordinateSystemUsage:"box",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:!1,roamTrigger:"global",nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{color:ye.color.borderTint,width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:!0},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500},t}(Ea);const zMt=OMt;function BMt(i,t,e){for(var r=[i],n=[],o;o=r.pop();)if(n.push(o),o.isExpand){var s=o.children;if(s.length)for(var a=0;a<s.length;a++)r.push(s[a])}for(;o=n.pop();)t(o,e)}function kb(i,t){for(var e=[i],r;r=e.pop();)if(t(r),r.isExpand){var n=r.children;if(n.length)for(var o=n.length-1;o>=0;o--)e.push(n[o])}}function FMt(i,t){i.eachSeriesByType("tree",function(e){NMt(e,t)})}function NMt(i,t){var e=No(i,t).refContainer,r=Ma(i.getBoxLayoutParams(),e);i.layoutInfo=r;var n=i.get("layout"),o=0,s=0,a=null;n==="radial"?(o=2*Math.PI,s=Math.min(r.height,r.width)/2,a=_$(function(H,q){return(H.parentNode===q.parentNode?1:2)/H.depth})):(o=r.width,s=r.height,a=_$());var c=i.getData().tree.root,f=c.children[0];if(f){fMt(c),BMt(f,pMt,a),c.hierNode.modifier=-f.hierNode.prelim,kb(f,gMt);var g=f,v=f,y=f;kb(f,function(H){var q=H.getLayout().x;q<g.getLayout().x&&(g=H),q>v.getLayout().x&&(v=H),H.depth>y.depth&&(y=H)});var w=g===v?1:a(g,v)/2,I=w-g.getLayout().x,E=0,D=0,R=0,z=0;if(n==="radial")E=o/(v.getLayout().x+w+I),D=s/(y.depth-1||1),kb(f,function(H){R=(H.getLayout().x+I)*E,z=(H.depth-1)*D;var q=ow(R,z);H.setLayout({x:q.x,y:q.y,rawX:R,rawY:z},!0)});else{var N=i.getOrient();N==="RL"||N==="LR"?(D=s/(v.getLayout().x+w+I),E=o/(y.depth-1||1),kb(f,function(H){z=(H.getLayout().x+I)*D,R=N==="LR"?(H.depth-1)*E:o-(H.depth-1)*E,H.setLayout({x:R,y:z},!0)})):(N==="TB"||N==="BT")&&(E=o/(v.getLayout().x+w+I),D=s/(y.depth-1||1),kb(f,function(H){R=(H.getLayout().x+I)*E,z=N==="TB"?(H.depth-1)*D:s-(H.depth-1)*D,H.setLayout({x:R,y:z},!0)}))}}}function VMt(i){i.eachSeriesByType("tree",function(t){var e=t.getData(),r=e.tree;r.eachNode(function(n){var o=n.getModel(),s=o.getModel("itemStyle").getItemStyle(),a=e.ensureUniqueItemVisual(n.dataIndex,"style");Ne(a,s)})})}function UMt(i){i.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"tree",query:t},function(r){var n=t.dataIndex,o=r.getData().tree,s=o.getNodeByDataIndex(n);s.isExpand=!s.isExpand})}),i.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},function(t,e,r){e.eachComponent({mainType:"series",subType:"tree",query:t},function(n){var o=n.coordinateSystem,s=DE(o,t,n.get("scaleLimit"));n.setCenter(s.center),n.setZoom(s.zoom)})})}function GMt(i){i.registerChartView(AMt),i.registerSeriesModel(zMt),i.registerLayout(FMt),i.registerVisual(VMt),UMt(i)}var S$=["treemapZoomToNode","treemapRender","treemapMove"];function HMt(i){for(var t=0;t<S$.length;t++)i.registerAction({type:S$[t],update:"updateView"},ho);i.registerAction({type:"treemapRootToNode",update:"updateView"},function(e,r){r.eachComponent({mainType:"series",subType:"treemap",query:e},n);function n(o,s){var a=["treemapZoomToNode","treemapRootToNode"],c=xS(e,a,o);if(c){var f=o.getViewRoot();f&&(e.direction=q3(f,c.node)?"rollUp":"drillDown"),o.resetViewRoot(c.node)}}})}function Yet(i){var t=i.getData(),e=t.tree,r={};e.eachNode(function(n){for(var o=n;o&&o.depth>1;)o=o.parentNode;var s=vz(i.ecModel,o.name||o.dataIndex+"",r);n.setVisual("decal",s)})}var jMt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventUsingHoverLayer=!0,e}return t.prototype.getInitialData=function(e,r){var n={name:e.name,children:e.data};Ket(n);var o=e.levels||[],s=this.designatedVisualItemStyle={},a=new bn({itemStyle:s},this,r);o=e.levels=WMt(o,r);var c=ti(o||[],function(v){return new bn(v,a,r)},this),f=Z3.createTree(n,this,g);function g(v){v.wrapMethod("getItemModel",function(y,w){var I=f.getNodeByDataIndex(w),E=I?c[I.depth]:null;return y.parentModel=E||a,y})}return f.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=this.getRawValue(e),a=o.getName(e);return So("nameValue",{name:a,value:s})},t.prototype.getDataParams=function(e){var r=i.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return r.treeAncestors=LE(n,this),r.treePathInfo=r.treeAncestors,r},t.prototype.setLayoutInfo=function(e){this.layoutInfo=this.layoutInfo||{},Ne(this.layoutInfo,e)},t.prototype.mapIdToIndex=function(e){var r=this._idIndexMap;r||(r=this._idIndexMap=Fi(),this._idIndexMapCount=0);var n=r.get(e);return n==null&&r.set(e,n=this._idIndexMapCount++),n},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var r=this.getRawData().tree.root;(!e||e!==r&&!r.contains(e))&&(this._viewRoot=r)},t.prototype.enableAriaDecal=function(){Yet(this)},t.type="series.treemap",t.layoutMode="box",t.defaultOption={progressive:0,coordinateSystemUsage:"box",left:ye.size.l,top:ye.size.xxxl,right:ye.size.l,bottom:ye.size.xxxl,sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"",zoomToNodeRatio:.32*.32,scaleLimit:{max:5,min:.2},roam:!0,roamTrigger:"global",nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",bottom:ye.size.m,emptyItemWidth:25,itemStyle:{color:ye.color.backgroundShade,textStyle:{color:ye.color.secondary}},emphasis:{itemStyle:{color:ye.color.background}}},label:{show:!0,distance:0,padding:5,position:"inside",color:ye.color.neutral00,overflow:"truncate"},upperLabel:{show:!1,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:ye.color.neutral00,borderColorSaturation:null},emphasis:{upperLabel:{show:!0,position:[0,"50%"],overflow:"truncate",verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},t}(Ea);function Ket(i){var t=0;pt(i.children,function(r){Ket(r);var n=r.value;Ye(n)&&(n=n[0]),t+=n});var e=i.value;Ye(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),Ye(i.value)?i.value[0]=e:i.value=e}function WMt(i,t){var e=aa(t.get("color")),r=aa(t.get(["aria","decal","decals"]));if(e){i=i||[];var n,o;pt(i,function(a){var c=new bn(a),f=c.get("color"),g=c.get("decal");(c.get(["itemStyle","color"])||f&&f!=="none")&&(n=!0),(c.get(["itemStyle","decal"])||g&&g!=="none")&&(o=!0)});var s=i[0]||(i[0]={});return n||(s.color=e.slice()),!o&&r&&(s.decal=r.slice()),i}}const $Mt=jMt;var ZMt=8,T$=8,GR=5,qMt=function(){function i(t){this.group=new Ki,t.add(this.group)}return i.prototype.render=function(t,e,r,n){var o=t.getModel("breadcrumb"),s=this.group;if(s.removeAll(),!(!o.get("show")||!r)){var a=o.getModel("itemStyle"),c=o.getModel("emphasis"),f=a.getModel("textStyle"),g=c.getModel(["itemStyle","textStyle"]),v=No(t,e).refContainer,y={left:o.get("left"),right:o.get("right"),top:o.get("top"),bottom:o.get("bottom")},w={emptyItemWidth:o.get("emptyItemWidth"),totalWidth:0,renderList:[]},I=Ma(y,v);this._prepare(r,w,f),this._renderContent(t,w,I,a,c,f,g,n),yE(s,y,v)}},i.prototype._prepare=function(t,e,r){for(var n=t;n;n=n.parentNode){var o=ko(n.getModel().get("name"),""),s=r.getTextRect(o),a=Math.max(s.width+ZMt*2,e.emptyItemWidth);e.totalWidth+=a+T$,e.renderList.push({node:n,text:o,width:a})}},i.prototype._renderContent=function(t,e,r,n,o,s,a,c){for(var f=0,g=e.emptyItemWidth,v=t.get(["breadcrumb","height"]),y=e.totalWidth,w=e.renderList,I=o.getModel("itemStyle").getItemStyle(),E=w.length-1;E>=0;E--){var D=w[E],R=D.node,z=D.width,N=D.text;y>r.width&&(y-=z-g,z=g,N=null);var H=new gl({shape:{points:XMt(f,0,z,v,E===w.length-1,E===0)},style:rr(n.getItemStyle(),{lineJoin:"bevel"}),textContent:new _n({style:pa(s,{text:N})}),textConfig:{position:"inside"},z2:V0*1e4,onclick:br(c,R)});H.disableLabelAnimation=!0,H.getTextContent().ensureState("emphasis").style=pa(a,{text:N}),H.ensureState("emphasis").style=I,Ca(H,o.get("focus"),o.get("blurScope"),o.get("disabled")),this.group.add(H),YMt(H,t,R),f+=z+T$}},i.prototype.remove=function(){this.group.removeAll()},i}();function XMt(i,t,e,r,n,o){var s=[[n?i:i-GR,t],[i+e,t],[i+e,t+r],[n?i:i-GR,t+r]];return!o&&s.splice(2,0,[i+e+GR,t+r/2]),!n&&s.push([i,t+r/2]),s}function YMt(i,t,e){cr(i).eventData={componentType:"series",componentSubType:"treemap",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:e&&e.dataIndex,name:e&&e.name},treePathInfo:e&&LE(e,t)}}const KMt=qMt;var JMt=function(){function i(){this._storage=[],this._elExistsMap={}}return i.prototype.add=function(t,e,r,n,o){return this._elExistsMap[t.id]?!1:(this._elExistsMap[t.id]=!0,this._storage.push({el:t,target:e,duration:r,delay:n,easing:o}),!0)},i.prototype.finished=function(t){return this._finishedCallback=t,this},i.prototype.start=function(){for(var t=this,e=this._storage.length,r=function(){e--,e<=0&&(t._storage.length=0,t._elExistsMap={},t._finishedCallback&&t._finishedCallback())},n=0,o=this._storage.length;n<o;n++){var s=this._storage[n];s.el.animateTo(s.target,{duration:s.duration,delay:s.delay,easing:s.easing,setToFinal:!0,done:r,aborted:r})}return this},i}();function QMt(){return new JMt}var Qz=Ki,A$=jr,I$=3,C$="label",M$="upperLabel",tEt=V0*10,eEt=V0*2,iEt=V0*3,km=_v([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),E$=function(i){var t=km(i);return t.stroke=t.fill=t.lineWidth=null,t},dM=Wr(),rEt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._state="ready",e._storage=Ob(),e}return t.prototype.render=function(e,r,n,o){var s=r.findComponents({mainType:"series",subType:"treemap",query:o});if(!(Ar(s,e)<0)){this.seriesModel=e,this.api=n,this.ecModel=r;var a=["treemapZoomToNode","treemapRootToNode"],c=xS(o,a,e),f=o&&o.type,g=e.layoutInfo,v=!this._oldTree,y=this._storage,w=f==="treemapRootToNode"&&c&&y?{rootNodeGroup:y.nodeGroup[c.node.getRawIndex()],direction:o.direction}:null,I=this._giveContainerGroup(g),E=e.get("animation"),D=this._doRender(I,e,w);E&&!v&&(!f||f==="treemapZoomToNode"||f==="treemapRootToNode")?this._doAnimation(I,D,e,w):D.renderFinally(),this._resetController(n),this._renderBreadcrumb(e,n,c)}},t.prototype._giveContainerGroup=function(e){var r=this._containerGroup;return r||(r=this._containerGroup=new Qz,this._initEvents(r),this.group.add(r)),r.x=e.x,r.y=e.y,r},t.prototype._doRender=function(e,r,n){var o=r.getData().tree,s=this._oldTree,a=Ob(),c=Ob(),f=this._storage,g=[];function v(z,N,H,q){return nEt(r,c,f,n,a,g,z,N,H,q)}E(o.root?[o.root]:[],s&&s.root?[s.root]:[],e,o===s||!s,0);var y=D(f);if(this._oldTree=o,this._storage=c,this._controllerHost){var w=this.seriesModel.layoutInfo,I=o.root.getLayout();I.width===w.width&&I.height===w.height&&(this._controllerHost.zoom=1)}return{lastsForAnimation:a,willDeleteEls:y,renderFinally:R};function E(z,N,H,q,Y){q?(N=z,pt(z,function(at,ut){!at.isRemoved()&&it(ut,ut)})):new Bd(N,z,J,J).add(it).update(it).remove(br(it,null)).execute();function J(at){return at.getId()}function it(at,ut){var ft=at!=null?z[at]:null,_t=ut!=null?N[ut]:null,ct=v(ft,_t,H,Y);ct&&E(ft&&ft.viewChildren||[],_t&&_t.viewChildren||[],ct,q,Y+1)}}function D(z){var N=Ob();return z&&pt(z,function(H,q){var Y=N[q];pt(H,function(J){J&&(Y.push(J),dM(J).willDelete=!0)})}),N}function R(){pt(y,function(z){pt(z,function(N){N.parent&&N.parent.remove(N)})}),pt(g,function(z){z.invisible=!0,z.dirty()})}},t.prototype._doAnimation=function(e,r,n,o){var s=n.get("animationDurationUpdate"),a=n.get("animationEasing"),c=(Xi(s)?0:s)||0,f=(Xi(a)?null:a)||"cubicOut",g=QMt();pt(r.willDeleteEls,function(v,y){pt(v,function(w,I){if(!w.invisible){var E=w.parent,D,R=dM(E);if(o&&o.direction==="drillDown")D=E===o.rootNodeGroup?{shape:{x:0,y:0,width:R.nodeWidth,height:R.nodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var z=0,N=0;R.willDelete||(z=R.nodeWidth/2,N=R.nodeHeight/2),D=y==="nodeGroup"?{x:z,y:N,style:{opacity:0}}:{shape:{x:z,y:N,width:0,height:0},style:{opacity:0}}}D&&g.add(w,D,c,0,f)}})}),pt(this._storage,function(v,y){pt(v,function(w,I){var E=r.lastsForAnimation[y][I],D={};E&&(w instanceof Ki?E.oldX!=null&&(D.x=w.x,D.y=w.y,w.x=E.oldX,w.y=E.oldY):(E.oldShape&&(D.shape=Ne({},w.shape),w.setShape(E.oldShape)),E.fadein?(w.setStyle("opacity",0),D.style={opacity:1}):w.style.opacity!==1&&(D.style={opacity:1})),g.add(w,D,c,0,f))})},this),this._state="animating",g.finished(Si(function(){this._state="ready",r.renderFinally()},this)).start()},t.prototype._resetController=function(e){var r=this,n=this._controller,o=this._controllerHost;o||(this._controllerHost={target:this.group},o=this._controllerHost);var s=this.seriesModel;n||(n=this._controller=new Bv(e.getZr()),n.on("pan",Si(this._onPan,this)),n.on("zoom",Si(this._onZoom,this))),n.enable(s.get("roam"),{api:e,zInfo:{component:s},triggerInfo:{roamTrigger:s.get("roamTrigger"),isInSelf:function(a,c,f){var g=r._containerGroup;return g?g.getBoundingRect().contain(c-g.x,f-g.y):!1}}}),o.zoomLimit=s.get("scaleLimit"),o.zoom=s.get("zoom")},t.prototype._clearController=function(){var e=this._controller;this._controllerHost=null,e&&(e.dispose(),e=null)},t.prototype._onPan=function(e){if(this._state!=="animating"&&(Math.abs(e.dx)>I$||Math.abs(e.dy)>I$)){var r=this.seriesModel.getData().tree.root;if(!r)return;var n=r.getLayout();if(!n)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:n.x+e.dx,y:n.y+e.dy,width:n.width,height:n.height}})}},t.prototype._onZoom=function(e){var r=e.originX,n=e.originY,o=e.scale;if(this._state!=="animating"){var s=this.seriesModel.getData().tree.root;if(!s)return;var a=s.getLayout();if(!a)return;var c=new sr(a.x,a.y,a.width,a.height),f=null,g=this._controllerHost;f=g.zoomLimit;var v=g.zoom=g.zoom||1;if(v*=o,f){var y=f.min||0,w=f.max||1/0;v=Math.max(Math.min(w,v),y)}var I=v/g.zoom;g.zoom=v;var E=this.seriesModel.layoutInfo;r-=E.x,n-=E.y;var D=as();bh(D,D,[-r,-n]),AF(D,D,[I,I]),bh(D,D,[r,n]),c.applyTransform(D),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:c.x,y:c.y,width:c.width,height:c.height}})}},t.prototype._initEvents=function(e){var r=this;e.on("click",function(n){if(r._state==="ready"){var o=r.seriesModel.get("nodeClick",!0);if(o){var s=r.findTarget(n.offsetX,n.offsetY);if(s){var a=s.node;if(a.getLayout().isLeafRoot)r._rootToNode(s);else if(o==="zoomToNode")r._zoomToNode(s);else if(o==="link"){var c=a.hostTree.data.getItemModel(a.dataIndex),f=c.get("link",!0),g=c.get("target",!0)||"blank";f&&HC(f,g)}}}}},this)},t.prototype._renderBreadcrumb=function(e,r,n){var o=this;n||(n=e.get("leafDepth",!0)!=null?{node:e.getViewRoot()}:this.findTarget(r.getWidth()/2,r.getHeight()/2),n||(n={node:e.getData().tree.root})),(this._breadcrumb||(this._breadcrumb=new KMt(this.group))).render(e,r,n.node,function(s){o._state!=="animating"&&(q3(e.getViewRoot(),s)?o._rootToNode({node:s}):o._zoomToNode({node:s}))})},t.prototype.remove=function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage=Ob(),this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},t.prototype.dispose=function(){this._clearController()},t.prototype._zoomToNode=function(e){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype._rootToNode=function(e){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:e.node})},t.prototype.findTarget=function(e,r){var n,o=this.seriesModel.getViewRoot();return o.eachNode({attr:"viewChildren",order:"preorder"},function(s){var a=this._storage.background[s.getRawIndex()];if(a){var c=a.transformCoordToLocal(e,r),f=a.shape;if(f.x<=c[0]&&c[0]<=f.x+f.width&&f.y<=c[1]&&c[1]<=f.y+f.height)n={node:s,offsetX:c[0],offsetY:c[1]};else return!1}},this),n},t.type="treemap",t}(ga);function Ob(){return{nodeGroup:[],background:[],content:[]}}function nEt(i,t,e,r,n,o,s,a,c,f){if(!s)return;var g=s.getLayout(),v=i.getData(),y=s.getModel();if(v.setItemGraphicEl(s.dataIndex,null),!g||!g.isInView)return;var w=g.width,I=g.height,E=g.borderWidth,D=g.invisible,R=s.getRawIndex(),z=a&&a.getRawIndex(),N=s.viewChildren,H=g.upperHeight,q=N&&N.length,Y=y.getModel("itemStyle"),J=y.getModel(["emphasis","itemStyle"]),it=y.getModel(["blur","itemStyle"]),at=y.getModel(["select","itemStyle"]),ut=Y.get("borderRadius")||0,ft=bi("nodeGroup",Qz);if(!ft)return;if(c.add(ft),ft.x=g.x||0,ft.y=g.y||0,ft.markRedraw(),dM(ft).nodeWidth=w,dM(ft).nodeHeight=I,g.isAboveViewRoot)return ft;var _t=bi("background",A$,f,eEt);_t&&ce(ft,_t,q&&g.upperLabelHeight);var ct=y.getModel("emphasis"),Dt=ct.get("focus"),Et=ct.get("blurScope"),bt=ct.get("disabled"),Vt=Dt==="ancestor"?s.getAncestorsIndices():Dt==="descendant"?s.getDescendantIndices():Dt;if(q)aS(ft)&&$m(ft,!1),_t&&($m(_t,!bt),v.setItemGraphicEl(s.dataIndex,_t),az(_t,Vt,Et));else{var zt=bi("content",A$,f,iEt);zt&&be(ft,zt),_t.disableMorphing=!0,_t&&aS(_t)&&$m(_t,!1),$m(ft,!bt),v.setItemGraphicEl(s.dataIndex,ft);var Jt=y.getShallow("cursor");Jt&&zt.attr("cursor",Jt),az(ft,Vt,Et)}return ft;function ce(Ze,xe,Ke){var We=cr(xe);if(We.dataIndex=s.dataIndex,We.seriesIndex=i.seriesIndex,xe.setShape({x:0,y:0,width:w,height:I,r:ut}),D)ve(xe);else{xe.invisible=!1;var Ti=s.getVisual("style"),Bt=Ti.stroke,Zt=E$(Y);Zt.fill=Bt;var ge=km(J);ge.fill=J.get("borderColor");var $e=km(it);$e.fill=it.get("borderColor");var He=km(at);if(He.fill=at.get("borderColor"),Ke){var qe=w-2*E;ke(xe,Bt,Ti.opacity,{x:E,y:0,width:qe,height:H})}else xe.removeTextContent();xe.setStyle(Zt),xe.ensureState("emphasis").style=ge,xe.ensureState("blur").style=$e,xe.ensureState("select").style=He,yv(xe)}Ze.add(xe)}function be(Ze,xe){var Ke=cr(xe);Ke.dataIndex=s.dataIndex,Ke.seriesIndex=i.seriesIndex;var We=Math.max(w-2*E,0),Ti=Math.max(I-2*E,0);if(xe.culling=!0,xe.setShape({x:E,y:E,width:We,height:Ti,r:ut}),D)ve(xe);else{xe.invisible=!1;var Bt=s.getVisual("style"),Zt=Bt.fill,ge=E$(Y);ge.fill=Zt,ge.decal=Bt.decal;var $e=km(J),He=km(it),qe=km(at);ke(xe,Zt,Bt.opacity,null),xe.setStyle(ge),xe.ensureState("emphasis").style=$e,xe.ensureState("blur").style=He,xe.ensureState("select").style=qe,yv(xe)}Ze.add(xe)}function ve(Ze){!Ze.invisible&&o.push(Ze)}function ke(Ze,xe,Ke,We){var Ti=y.getModel(We?M$:C$),Bt=ko(y.get("name"),null),Zt=Ti.getShallow("show");Xo(Ze,Fo(y,We?M$:C$),{defaultText:Zt?Bt:null,inheritColor:xe,defaultOpacity:Ke,labelFetcher:i,labelDataIndex:s.dataIndex});var ge=Ze.getTextContent();if(ge){var $e=ge.style,He=JM($e.padding||0);We&&(Ze.setTextConfig({layoutRect:We}),ge.disableLabelLayout=!0),ge.beforeUpdate=function(){var Ai=Math.max((We?We.width:Ze.shape.width)-He[1]-He[3],0),Ii=Math.max((We?We.height:Ze.shape.height)-He[0]-He[2],0);($e.width!==Ai||$e.height!==Ii)&&ge.setStyle({width:Ai,height:Ii})},$e.truncateMinChar=2,$e.lineOverflow="truncate",ni($e,We,g);var qe=ge.getState("emphasis");ni(qe?qe.style:null,We,g)}}function ni(Ze,xe,Ke){var We=Ze?Ze.text:null;if(!xe&&Ke.isLeafRoot&&We!=null){var Ti=i.get("drillDownIcon",!0);Ze.text=Ti?Ti+" "+We:We}}function bi(Ze,xe,Ke,We){var Ti=z!=null&&e[Ze][z],Bt=n[Ze];return Ti?(e[Ze][z]=null,or(Bt,Ti)):D||(Ti=new xe,Ti instanceof Ou&&(Ti.z2=aEt(Ke,We)),Ue(Bt,Ti)),t[Ze][R]=Ti}function or(Ze,xe){var Ke=Ze[R]={};xe instanceof Qz?(Ke.oldX=xe.x,Ke.oldY=xe.y):Ke.oldShape=Ne({},xe.shape)}function Ue(Ze,xe){var Ke=Ze[R]={},We=s.parentNode,Ti=xe instanceof Ki;if(We&&(!r||r.direction==="drillDown")){var Bt=0,Zt=0,ge=n.background[We.getRawIndex()];!r&&ge&&ge.oldShape&&(Bt=ge.oldShape.width,Zt=ge.oldShape.height),Ti?(Ke.oldX=0,Ke.oldY=Zt):Ke.oldShape={x:Bt,y:Zt,width:0,height:0}}Ke.fadein=!Ti}}function aEt(i,t){return i*tEt+t}const oEt=rEt;var bS=pt,sEt=nr,fM=-1,X3=function(){function i(t){var e=t.mappingMethod,r=t.type,n=this.option=Yi(t);this.type=r,this.mappingMethod=e,this._normalizeData=cEt[e];var o=i.visualHandlers[r];this.applyVisual=o.applyVisual,this.getColorMapper=o.getColorMapper,this._normalizedToVisual=o._normalizedToVisual[e],e==="piecewise"?(HR(n),lEt(n)):e==="category"?n.categories?uEt(n):HR(n,!0):(Vs(e!=="linear"||n.dataExtent),HR(n))}return i.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},i.prototype.getNormalizer=function(){return Si(this._normalizeData,this)},i.listVisualTypes=function(){return on(i.visualHandlers)},i.isValidType=function(t){return i.visualHandlers.hasOwnProperty(t)},i.eachVisual=function(t,e,r){nr(t)?pt(t,e,r):e.call(r,t)},i.mapVisual=function(t,e,r){var n,o=Ye(t)?[]:nr(t)?{}:(n=!0,null);return i.eachVisual(t,function(s,a){var c=e.call(r,s,a);n?o=c:o[a]=c}),o},i.retrieveVisuals=function(t){var e={},r;return t&&bS(i.visualHandlers,function(n,o){t.hasOwnProperty(o)&&(e[o]=t[o],r=!0)}),r?e:null},i.prepareVisualTypes=function(t){if(Ye(t))t=t.slice();else if(sEt(t)){var e=[];bS(t,function(r,n){e.push(n)}),t=e}else return[];return t.sort(function(r,n){return n==="color"&&r!=="color"&&r.indexOf("color")===0?1:-1}),t},i.dependsOn=function(t,e){return e==="color"?!!(t&&t.indexOf(e)===0):t===e},i.findPieceIndex=function(t,e,r){for(var n,o=1/0,s=0,a=e.length;s<a;s++){var c=e[s].value;if(c!=null){if(c===t||wi(c)&&c===t+"")return s;r&&y(c,s)}}for(var s=0,a=e.length;s<a;s++){var f=e[s],g=f.interval,v=f.close;if(g){if(g[0]===-1/0){if(iI(v[1],t,g[1]))return s}else if(g[1]===1/0){if(iI(v[0],g[0],t))return s}else if(iI(v[0],g[0],t)&&iI(v[1],t,g[1]))return s;r&&y(g[0],s),r&&y(g[1],s)}}if(r)return t===1/0?e.length-1:t===-1/0?0:n;function y(w,I){var E=Math.abs(w-t);E<o&&(o=E,n=I)}},i.visualHandlers={color:{applyVisual:zb("color"),getColorMapper:function(){var t=this.option;return Si(t.mappingMethod==="category"?function(e,r){return!r&&(e=this._normalizeData(e)),sw.call(this,e)}:function(e,r,n){var o=!!n;return!r&&(e=this._normalizeData(e)),n=SL(e,t.parsedVisual,n),o?n:gh(n,"rgba")},this)},_normalizedToVisual:{linear:function(t){return gh(SL(t,this.option.parsedVisual),"rgba")},category:sw,piecewise:function(t,e){var r=eB.call(this,e);return r==null&&(r=gh(SL(t,this.option.parsedVisual),"rgba")),r},fixed:Om}},colorHue:eI(function(t,e){return Ap(t,e)}),colorSaturation:eI(function(t,e){return Ap(t,null,e)}),colorLightness:eI(function(t,e){return Ap(t,null,null,e)}),colorAlpha:eI(function(t,e){return EC(t,e)}),decal:{applyVisual:zb("decal"),_normalizedToVisual:{linear:null,category:sw,piecewise:null,fixed:null}},opacity:{applyVisual:zb("opacity"),_normalizedToVisual:tB([0,1])},liftZ:{applyVisual:zb("liftZ"),_normalizedToVisual:{linear:Om,category:Om,piecewise:Om,fixed:Om}},symbol:{applyVisual:function(t,e,r){var n=this.mapValueToVisual(t);r("symbol",n)},_normalizedToVisual:{linear:D$,category:sw,piecewise:function(t,e){var r=eB.call(this,e);return r==null&&(r=D$.call(this,t)),r},fixed:Om}},symbolSize:{applyVisual:zb("symbolSize"),_normalizedToVisual:tB([0,1])}},i}();function lEt(i){var t=i.pieceList;i.hasSpecialVisual=!1,pt(t,function(e,r){e.originIndex=r,e.visual!=null&&(i.hasSpecialVisual=!0)})}function uEt(i){var t=i.categories,e=i.categoryMap={},r=i.visual;if(bS(t,function(s,a){e[s]=a}),!Ye(r)){var n=[];nr(r)?bS(r,function(s,a){var c=e[a];n[c??fM]=s}):n[fM]=r,r=Jet(i,n)}for(var o=t.length-1;o>=0;o--)r[o]==null&&(delete e[t[o]],t.pop())}function HR(i,t){var e=i.visual,r=[];nr(e)?bS(e,function(o){r.push(o)}):e!=null&&r.push(e);var n={color:1,symbol:1};!t&&r.length===1&&!n.hasOwnProperty(i.type)&&(r[1]=r[0]),Jet(i,r)}function eI(i){return{applyVisual:function(t,e,r){var n=this.mapValueToVisual(t);r("color",i(e("color"),n))},_normalizedToVisual:tB([0,1])}}function D$(i){var t=this.option.visual;return t[Math.round(Rn(i,[0,1],[0,t.length-1],!0))]||{}}function zb(i){return function(t,e,r){r(i,this.mapValueToVisual(t))}}function sw(i){var t=this.option.visual;return t[this.option.loop&&i!==fM?i%t.length:i]}function Om(){return this.option.visual[0]}function tB(i){return{linear:function(t){return Rn(t,i,this.option.visual,!0)},category:sw,piecewise:function(t,e){var r=eB.call(this,e);return r==null&&(r=Rn(t,i,this.option.visual,!0)),r},fixed:Om}}function eB(i){var t=this.option,e=t.pieceList;if(t.hasSpecialVisual){var r=X3.findPieceIndex(i,e),n=e[r];if(n&&n.visual)return n.visual[this.type]}}function Jet(i,t){return i.visual=t,i.type==="color"&&(i.parsedVisual=ti(t,function(e){var r=Ol(e);return r||[0,0,0,1]})),t}var cEt={linear:function(i){return Rn(i,this.option.dataExtent,[0,1],!0)},piecewise:function(i){var t=this.option.pieceList,e=X3.findPieceIndex(i,t,!0);if(e!=null)return Rn(e,[0,t.length-1],[0,1],!0)},category:function(i){var t=this.option.categories?this.option.categoryMap[i]:i;return t??fM},fixed:ho};function iI(i,t,e){return i?t<=e:t<e}const _s=X3;var hEt="itemStyle",Qet=Wr();const dEt={seriesType:"treemap",reset:function(i){var t=i.getData().tree,e=t.root;e.isRemoved()||tit(e,{},i.getViewRoot().getAncestors(),i)}};function tit(i,t,e,r){var n=i.getModel(),o=i.getLayout(),s=i.hostTree.data;if(!(!o||o.invisible||!o.isInView)){var a=n.getModel(hEt),c=fEt(a,t,r),f=s.ensureUniqueItemVisual(i.dataIndex,"style"),g=a.get("borderColor"),v=a.get("borderColorSaturation"),y;v!=null&&(y=P$(c),g=pEt(v,y)),f.stroke=g;var w=i.viewChildren;if(!w||!w.length)y=P$(c),f.fill=y;else{var I=gEt(i,n,o,a,c,w);pt(w,function(E,D){if(E.depth>=e.length||E===e[E.depth]){var R=mEt(n,c,E,D,I,r);tit(E,R,e,r)}})}}}function fEt(i,t,e){var r=Ne({},t),n=e.designatedVisualItemStyle;return pt(["color","colorAlpha","colorSaturation"],function(o){n[o]=t[o];var s=i.get(o);n[o]=null,s!=null&&(r[o]=s)}),r}function P$(i){var t=jR(i,"color");if(t){var e=jR(i,"colorAlpha"),r=jR(i,"colorSaturation");return r&&(t=Ap(t,null,null,r)),e&&(t=EC(t,e)),t}}function pEt(i,t){return t!=null?Ap(t,null,null,i):null}function jR(i,t){var e=i[t];if(e!=null&&e!=="none")return e}function gEt(i,t,e,r,n,o){if(!(!o||!o.length)){var s=WR(t,"color")||n.color!=null&&n.color!=="none"&&(WR(t,"colorAlpha")||WR(t,"colorSaturation"));if(s){var a=t.get("visualMin"),c=t.get("visualMax"),f=e.dataExtent.slice();a!=null&&a<f[0]&&(f[0]=a),c!=null&&c>f[1]&&(f[1]=c);var g=t.get("colorMappingBy"),v={type:s.name,dataExtent:f,visual:s.range};v.type==="color"&&(g==="index"||g==="id")?(v.mappingMethod="category",v.loop=!0):v.mappingMethod="linear";var y=new _s(v);return Qet(y).drColorMappingBy=g,y}}}function WR(i,t){var e=i.get(t);return Ye(e)&&e.length?{name:t,range:e}:null}function mEt(i,t,e,r,n,o){var s=Ne({},t);if(n){var a=n.type,c=a==="color"&&Qet(n).drColorMappingBy,f=c==="index"?r:c==="id"?o.mapIdToIndex(e.getId()):e.getValue(i.get("visualDimension"));s[a]=n.mapValueToVisual(f)}return s}var wS=Math.max,pM=Math.min,L$=vs,Y3=pt,eit=["itemStyle","borderWidth"],vEt=["itemStyle","gapWidth"],_Et=["upperLabel","show"],yEt=["upperLabel","height"];const xEt={seriesType:"treemap",reset:function(i,t,e,r){var n=i.option,o=No(i,e).refContainer,s=Ma(i.getBoxLayoutParams(),o),a=n.size||[],c=xi(L$(s.width,a[0]),o.width),f=xi(L$(s.height,a[1]),o.height),g=r&&r.type,v=["treemapZoomToNode","treemapRootToNode"],y=xS(r,v,i),w=g==="treemapRender"||g==="treemapMove"?r.rootRect:null,I=i.getViewRoot(),E=Xet(I);if(g!=="treemapMove"){var D=g==="treemapZoomToNode"?IEt(i,y,I,c,f):w?[w.width,w.height]:[c,f],R=n.sort;R&&R!=="asc"&&R!=="desc"&&(R="desc");var z={squareRatio:n.squareRatio,sort:R,leafDepth:n.leafDepth};I.hostTree.clearLayouts();var N={x:0,y:0,width:D[0],height:D[1],area:D[0]*D[1]};I.setLayout(N),iit(I,z,!1,0),N=I.getLayout(),Y3(E,function(q,Y){var J=(E[Y+1]||I).getValue();q.setLayout(Ne({dataExtent:[J,J],borderWidth:0,upperHeight:0},N))})}var H=i.getData().tree.root;H.setLayout(CEt(s,w,y),!0),i.setLayoutInfo(s),rit(H,new sr(-s.x,-s.y,e.getWidth(),e.getHeight()),E,I,0)}};function iit(i,t,e,r){var n,o;if(!i.isRemoved()){var s=i.getLayout();n=s.width,o=s.height;var a=i.getModel(),c=a.get(eit),f=a.get(vEt)/2,g=nit(a),v=Math.max(c,g),y=c-f,w=v-f;i.setLayout({borderWidth:c,upperHeight:v,upperLabelHeight:g},!0),n=wS(n-2*y,0),o=wS(o-y-w,0);var I=n*o,E=bEt(i,a,I,t,e,r);if(E.length){var D={x:y,y:w,width:n,height:o},R=pM(n,o),z=1/0,N=[];N.area=0;for(var H=0,q=E.length;H<q;){var Y=E[H];N.push(Y),N.area+=Y.getLayout().area;var J=AEt(N,R,t.squareRatio);J<=z?(H++,z=J):(N.area-=N.pop().getLayout().area,R$(N,R,D,f,!1),R=pM(D.width,D.height),N.length=N.area=0,z=1/0)}if(N.length&&R$(N,R,D,f,!0),!e){var it=a.get("childrenVisibleMin");it!=null&&I<it&&(e=!0)}for(var H=0,q=E.length;H<q;H++)iit(E[H],t,e,r+1)}}}function bEt(i,t,e,r,n,o){var s=i.children||[],a=r.sort;a!=="asc"&&a!=="desc"&&(a=null);var c=r.leafDepth!=null&&r.leafDepth<=o;if(n&&!c)return i.viewChildren=[];s=kn(s,function(w){return!w.isRemoved()}),SEt(s,a);var f=TEt(t,s,a);if(f.sum===0)return i.viewChildren=[];if(f.sum=wEt(t,e,f.sum,a,s),f.sum===0)return i.viewChildren=[];for(var g=0,v=s.length;g<v;g++){var y=s[g].getValue()/f.sum*e;s[g].setLayout({area:y})}return c&&(s.length&&i.setLayout({isLeafRoot:!0},!0),s.length=0),i.viewChildren=s,i.setLayout({dataExtent:f.dataExtent},!0),s}function wEt(i,t,e,r,n){if(!r)return e;for(var o=i.get("visibleMin"),s=n.length,a=s,c=s-1;c>=0;c--){var f=n[r==="asc"?s-c-1:c].getValue();f/e*t<o&&(a=c,e-=f)}return r==="asc"?n.splice(0,s-a):n.splice(a,s-a),e}function SEt(i,t){return t&&i.sort(function(e,r){var n=t==="asc"?e.getValue()-r.getValue():r.getValue()-e.getValue();return n===0?t==="asc"?e.dataIndex-r.dataIndex:r.dataIndex-e.dataIndex:n}),i}function TEt(i,t,e){for(var r=0,n=0,o=t.length;n<o;n++)r+=t[n].getValue();var s=i.get("visualDimension"),a;return!t||!t.length?a=[NaN,NaN]:s==="value"&&e?(a=[t[t.length-1].getValue(),t[0].getValue()],e==="asc"&&a.reverse()):(a=[1/0,-1/0],Y3(t,function(c){var f=c.getValue(s);f<a[0]&&(a[0]=f),f>a[1]&&(a[1]=f)})),{sum:r,dataExtent:a}}function AEt(i,t,e){for(var r=0,n=1/0,o=0,s=void 0,a=i.length;o<a;o++)s=i[o].getLayout().area,s&&(s<n&&(n=s),s>r&&(r=s));var c=i.area*i.area,f=t*t*e;return c?wS(f*r/c,c/(f*n)):1/0}function R$(i,t,e,r,n){var o=t===e.width?0:1,s=1-o,a=["x","y"],c=["width","height"],f=e[a[o]],g=t?i.area/t:0;(n||g>e[c[s]])&&(g=e[c[s]]);for(var v=0,y=i.length;v<y;v++){var w=i[v],I={},E=g?w.getLayout().area/g:0,D=I[c[s]]=wS(g-2*r,0),R=e[a[o]]+e[c[o]]-f,z=v===y-1||R<E?R:E,N=I[c[o]]=wS(z-2*r,0);I[a[s]]=e[a[s]]+pM(r,D/2),I[a[o]]=f+pM(r,N/2),f+=z,w.setLayout(I,!0)}e[a[s]]+=g,e[c[s]]-=g}function IEt(i,t,e,r,n){var o=(t||{}).node,s=[r,n];if(!o||o===e)return s;for(var a,c=r*n,f=c*i.option.zoomToNodeRatio;a=o.parentNode;){for(var g=0,v=a.children,y=0,w=v.length;y<w;y++)g+=v[y].getValue();var I=o.getValue();if(I===0)return s;f*=g/I;var E=a.getModel(),D=E.get(eit),R=Math.max(D,nit(E));f+=4*D*D+(3*D+R)*Math.pow(f,.5),f>zH&&(f=zH),o=a}f<c&&(f=c);var z=Math.pow(f/c,.5);return[r*z,n*z]}function CEt(i,t,e){if(t)return{x:t.x,y:t.y};var r={x:0,y:0};if(!e)return r;var n=e.node,o=n.getLayout();if(!o)return r;for(var s=[o.width/2,o.height/2],a=n;a;){var c=a.getLayout();s[0]+=c.x,s[1]+=c.y,a=a.parentNode}return{x:i.width/2-s[0],y:i.height/2-s[1]}}function rit(i,t,e,r,n){var o=i.getLayout(),s=e[n],a=s&&s===i;if(!(s&&!a||n===e.length&&i!==r)){i.setLayout({isInView:!0,invisible:!a&&!t.intersect(o),isAboveViewRoot:a},!0);var c=new sr(t.x-o.x,t.y-o.y,t.width,t.height);Y3(i.viewChildren||[],function(f){rit(f,c,e,r,n+1)})}}function nit(i){return i.get(_Et)?i.get(yEt):0}function MEt(i){i.registerSeriesModel($Mt),i.registerChartView(oEt),i.registerVisual(dEt),i.registerLayout(xEt),HMt(i)}function EEt(i){var t=i.findComponents({mainType:"legend"});!t||!t.length||i.eachSeriesByType("graph",function(e){var r=e.getCategoriesData(),n=e.getGraph(),o=n.data,s=r.mapArray(r.getName);o.filterSelf(function(a){var c=o.getItemModel(a),f=c.getShallow("category");if(f!=null){fn(f)&&(f=s[f]);for(var g=0;g<t.length;g++)if(!t[g].isSelected(f))return!1}return!0})})}function DEt(i){var t={};i.eachSeriesByType("graph",function(e){var r=e.getCategoriesData(),n=e.getData(),o={};r.each(function(s){var a=r.getName(s);o["ec-"+a]=s;var c=r.getItemModel(s),f=c.getModel("itemStyle").getItemStyle();f.fill||(f.fill=e.getColorFromPalette(a,t)),r.setItemVisual(s,"style",f);for(var g=["symbol","symbolSize","symbolKeepAspect"],v=0;v<g.length;v++){var y=c.getShallow(g[v],!0);y!=null&&r.setItemVisual(s,g[v],y)}}),r.count()&&n.each(function(s){var a=n.getItemModel(s),c=a.getShallow("category");if(c!=null){wi(c)&&(c=o["ec-"+c]);var f=r.getItemVisual(c,"style"),g=n.ensureUniqueItemVisual(s,"style");Ne(g,f);for(var v=["symbol","symbolSize","symbolKeepAspect"],y=0;y<v.length;y++)n.setItemVisual(s,v[y],r.getItemVisual(c,v[y]))}})})}function rI(i){return i instanceof Array||(i=[i,i]),i}function PEt(i){i.eachSeriesByType("graph",function(t){var e=t.getGraph(),r=t.getEdgeData(),n=rI(t.get("edgeSymbol")),o=rI(t.get("edgeSymbolSize"));r.setVisual("fromSymbol",n&&n[0]),r.setVisual("toSymbol",n&&n[1]),r.setVisual("fromSymbolSize",o&&o[0]),r.setVisual("toSymbolSize",o&&o[1]),r.setVisual("style",t.getModel("lineStyle").getLineStyle()),r.each(function(s){var a=r.getItemModel(s),c=e.getEdgeByIndex(s),f=rI(a.getShallow("symbol",!0)),g=rI(a.getShallow("symbolSize",!0)),v=a.getModel("lineStyle").getLineStyle(),y=r.ensureUniqueItemVisual(s,"style");switch(Ne(y,v),y.stroke){case"source":{var w=c.node1.getVisual("style");y.stroke=w&&w.fill;break}case"target":{var w=c.node2.getVisual("style");y.stroke=w&&w.fill;break}}f[0]&&c.setVisual("fromSymbol",f[0]),f[1]&&c.setVisual("toSymbol",f[1]),g[0]&&c.setVisual("fromSymbolSize",g[0]),g[1]&&c.setVisual("toSymbolSize",g[1])})})}var iB="-->",RE=function(i){return i.get("autoCurveness")||null},ait=function(i,t){var e=RE(i),r=20,n=[];if(fn(e))r=e;else if(Ye(e)){i.__curvenessList=e;return}t>r&&(r=t);var o=r%2?r+2:r+3;n=[];for(var s=0;s<o;s++)n.push((s%2?s+1:s)/10*(s%2?-1:1));i.__curvenessList=n},SS=function(i,t,e){var r=[i.id,i.dataIndex].join("."),n=[t.id,t.dataIndex].join(".");return[e.uid,r,n].join(iB)},oit=function(i){var t=i.split(iB);return[t[0],t[2],t[1]].join(iB)},LEt=function(i,t){var e=SS(i.node1,i.node2,t);return t.__edgeMap[e]},REt=function(i,t){var e=rB(SS(i.node1,i.node2,t),t),r=rB(SS(i.node2,i.node1,t),t);return e+r},rB=function(i,t){var e=t.__edgeMap;return e[i]?e[i].length:0};function kEt(i){RE(i)&&(i.__curvenessList=[],i.__edgeMap={},ait(i))}function OEt(i,t,e,r){if(RE(e)){var n=SS(i,t,e),o=e.__edgeMap,s=o[oit(n)];o[n]&&!s?o[n].isForward=!0:s&&o[n]&&(s.isForward=!0,o[n].isForward=!1),o[n]=o[n]||[],o[n].push(r)}}function K3(i,t,e,r){var n=RE(t),o=Ye(n);if(!n)return null;var s=LEt(i,t);if(!s)return null;for(var a=-1,c=0;c<s.length;c++)if(s[c]===e){a=c;break}var f=REt(i,t);ait(t,f),i.lineStyle=i.lineStyle||{};var g=SS(i.node1,i.node2,t),v=t.__curvenessList,y=o||f%2?0:1;if(s.isForward)return v[y+a];var w=oit(g),I=rB(w,t),E=v[a+I+y];return r?o?n&&n[0]===0?(I+y)%2?E:-E:((I%2?0:1)+y)%2?E:-E:(I+y)%2?E:-E:v[a+I+y]}function sit(i){var t=i.coordinateSystem;if(!(t&&t.type!=="view")){var e=i.getGraph();e.eachNode(function(r){var n=r.getModel();r.setLayout([+n.get("x"),+n.get("y")])}),J3(e,i)}}function J3(i,t){i.eachEdge(function(e,r){var n=iu(e.getModel().get(["lineStyle","curveness"]),-K3(e,t,r,!0),0),o=Ad(e.node1.getLayout()),s=Ad(e.node2.getLayout()),a=[o,s];+n&&a.push([(o[0]+s[0])/2-(o[1]-s[1])*n,(o[1]+s[1])/2-(s[0]-o[0])*n]),e.setLayout(a)})}function zEt(i,t){i.eachSeriesByType("graph",function(e){var r=e.get("layout"),n=e.coordinateSystem;if(n&&n.type!=="view"){var o=e.getData(),s=[];pt(n.dimensions,function(y){s=s.concat(o.mapDimensionsAll(y))});for(var a=0;a<o.count();a++){for(var c=[],f=!1,g=0;g<s.length;g++){var v=o.get(s[g],a);isNaN(v)||(f=!0),c.push(v)}f?o.setItemLayout(a,n.dataToPoint(c)):o.setItemLayout(a,[NaN,NaN])}J3(o.graph,e)}else(!r||r==="none")&&sit(e)})}function lw(i){var t=i.coordinateSystem;if(t.type!=="view")return 1;var e=i.option.nodeScaleRatio,r=t.scaleX,n=t.getZoom(),o=(n-1)*e+1;return o/r}function uw(i){var t=i.getVisual("symbolSize");return t instanceof Array&&(t=(t[0]+t[1])/2),+t}var k$=Math.PI,$R=[];function Q3(i,t,e,r){var n=i.coordinateSystem;if(!(n&&n.type!=="view")){var o=n.getBoundingRect(),s=i.getData(),a=s.graph,c=o.width/2+o.x,f=o.height/2+o.y,g=Math.min(o.width,o.height)/2,v=s.count();if(s.setLayout({cx:c,cy:f}),!!v){if(e){var y=n.pointToData(r),w=y[0],I=y[1],E=[w-c,I-f];B0(E,E),UI(E,E,g),e.setLayout([c+E[0],f+E[1]],!0);var D=i.get(["circular","rotateLabel"]);lit(e,D,c,f)}BEt[t](i,a,s,g,c,f,v),a.eachEdge(function(R,z){var N=iu(R.getModel().get(["lineStyle","curveness"]),K3(R,i,z),0),H=Ad(R.node1.getLayout()),q=Ad(R.node2.getLayout()),Y,J=(H[0]+q[0])/2,it=(H[1]+q[1])/2;+N&&(N*=3,Y=[c*N+J*(1-N),f*N+it*(1-N)]),R.setLayout([H,q,Y])})}}}var BEt={value:function(i,t,e,r,n,o,s){var a=0,c=e.getSum("value"),f=Math.PI*2/(c||s);t.eachNode(function(g){var v=g.getValue("value"),y=f*(c?v:1)/2;a+=y,g.setLayout([r*Math.cos(a)+n,r*Math.sin(a)+o]),a+=y})},symbolSize:function(i,t,e,r,n,o,s){var a=0;$R.length=s;var c=lw(i);t.eachNode(function(v){var y=uw(v);isNaN(y)&&(y=2),y<0&&(y=0),y*=c;var w=Math.asin(y/2/r);isNaN(w)&&(w=k$/2),$R[v.dataIndex]=w,a+=w*2});var f=(2*k$-a)/s/2,g=0;t.eachNode(function(v){var y=f+$R[v.dataIndex];g+=y,(!v.getLayout()||!v.getLayout().fixed)&&v.setLayout([r*Math.cos(g)+n,r*Math.sin(g)+o]),g+=y})}};function lit(i,t,e,r){var n=i.getGraphicEl();if(n){var o=i.getModel(),s=o.get(["label","rotate"])||0,a=n.getSymbolPath();if(t){var c=i.getLayout(),f=Math.atan2(c[1]-r,c[0]-e);f<0&&(f=Math.PI*2+f);var g=c[0]<e;g&&(f=f-Math.PI);var v=g?"left":"right";a.setTextConfig({rotation:-f,position:v,origin:"center"});var y=a.ensureState("emphasis");Ne(y.textConfig||(y.textConfig={}),{position:v})}else a.setTextConfig({rotation:s*=Math.PI/180})}}function FEt(i){i.eachSeriesByType("graph",function(t){t.get("layout")==="circular"&&Q3(t,"symbolSize")})}var Ry=AO;function NEt(i,t,e){for(var r=i,n=t,o=e.rect,s=o.width,a=o.height,c=[o.x+s/2,o.y+a/2],f=e.gravity==null?.1:e.gravity,g=0;g<r.length;g++){var v=r[g];v.p||(v.p=Cv(s*(Math.random()-.5)+c[0],a*(Math.random()-.5)+c[1])),v.pp=Ad(v.p),v.edges=null}var y=e.friction==null?.6:e.friction,w=y,I,E;return{warmUp:function(){w=y*.8},setFixed:function(D){r[D].fixed=!0},setUnfixed:function(D){r[D].fixed=!1},beforeStep:function(D){I=D},afterStep:function(D){E=D},step:function(D){I&&I(r,n);for(var R=[],z=r.length,N=0;N<n.length;N++){var H=n[N];if(!H.ignoreForceLayout){var q=H.n1,Y=H.n2;jm(R,Y.p,q.p);var J=IO(R)-H.d,it=Y.w/(q.w+Y.w);isNaN(it)&&(it=0),B0(R,R),!q.fixed&&Ry(q.p,q.p,R,it*J*w),!Y.fixed&&Ry(Y.p,Y.p,R,-(1-it)*J*w)}}for(var N=0;N<z;N++){var at=r[N];at.fixed||(jm(R,c,at.p),Ry(at.p,at.p,R,f*w))}for(var N=0;N<z;N++)for(var q=r[N],ut=N+1;ut<z;ut++){var Y=r[ut];jm(R,Y.p,q.p);var J=IO(R);J===0&&(SF(R,Math.random()-.5,Math.random()-.5),J=1);var ft=(q.rep+Y.rep)/J/J;!q.fixed&&Ry(q.pp,q.pp,R,ft),!Y.fixed&&Ry(Y.pp,Y.pp,R,-ft)}for(var _t=[],N=0;N<z;N++){var at=r[N];at.fixed||(jm(_t,at.p,at.pp),Ry(at.p,at.p,_t,w),ll(at.pp,at.p))}w=w*.992;var ct=w<.01;E&&E(r,n,ct),D&&D(ct)}}}function VEt(i){i.eachSeriesByType("graph",function(t){var e=t.coordinateSystem;if(!(e&&e.type!=="view"))if(t.get("layout")==="force"){var r=t.preservedPoints||{},n=t.getGraph(),o=n.data,s=n.edgeData,a=t.getModel("force"),c=a.get("initLayout");t.preservedPoints?o.each(function(N){var H=o.getId(N);o.setItemLayout(N,r[H]||[NaN,NaN])}):!c||c==="none"?sit(t):c==="circular"&&Q3(t,"value");var f=o.getDataExtent("value"),g=s.getDataExtent("value"),v=a.get("repulsion"),y=a.get("edgeLength"),w=Ye(v)?v:[v,v],I=Ye(y)?y:[y,y];I=[I[1],I[0]];var E=o.mapArray("value",function(N,H){var q=o.getItemLayout(H),Y=Rn(N,f,w);return isNaN(Y)&&(Y=(w[0]+w[1])/2),{w:Y,rep:Y,fixed:o.getItemModel(H).get("fixed"),p:!q||isNaN(q[0])||isNaN(q[1])?null:q}}),D=s.mapArray("value",function(N,H){var q=n.getEdgeByIndex(H),Y=Rn(N,g,I);isNaN(Y)&&(Y=(I[0]+I[1])/2);var J=q.getModel(),it=iu(q.getModel().get(["lineStyle","curveness"]),-K3(q,t,H,!0),0);return{n1:E[q.node1.dataIndex],n2:E[q.node2.dataIndex],d:Y,curveness:it,ignoreForceLayout:J.get("ignoreForceLayout")}}),R=e.getBoundingRect(),z=NEt(E,D,{rect:R,gravity:a.get("gravity"),friction:a.get("friction")});z.beforeStep(function(N,H){for(var q=0,Y=N.length;q<Y;q++)N[q].fixed&&ll(N[q].p,n.getNodeByIndex(q).getLayout())}),z.afterStep(function(N,H,q){for(var Y=0,J=N.length;Y<J;Y++)N[Y].fixed||n.getNodeByIndex(Y).setLayout(N[Y].p),r[o.getId(Y)]=N[Y].p;for(var Y=0,J=H.length;Y<J;Y++){var it=H[Y],at=n.getEdgeByIndex(Y),ut=it.n1.p,ft=it.n2.p,_t=at.getLayout();_t=_t?_t.slice():[],_t[0]=_t[0]||[],_t[1]=_t[1]||[],ll(_t[0],ut),ll(_t[1],ft),+it.curveness&&(_t[2]=[(ut[0]+ft[0])/2-(ut[1]-ft[1])*it.curveness,(ut[1]+ft[1])/2-(ft[0]-ut[0])*it.curveness]),at.setLayout(_t)}}),t.forceLayout=z,t.preservedPoints=r,z.step()}else t.forceLayout=null})}function UEt(i,t,e){var r=No(i,t),n=Ne(i.getBoxLayoutParams(),{aspect:e}),o=Ma(n,r.refContainer);return DJ(i,o,e)}function GEt(i,t){var e=[];return i.eachSeriesByType("graph",function(r){jS({targetModel:r,coordSysType:"view",coordSysProvider:n,isDefaultDataCoordSys:!0});function n(){var o=r.getData(),s=o.mapArray(function(I){var E=o.getItemModel(I);return[+E.get("x"),+E.get("y")]}),a=[],c=[];sE(s,a,c),c[0]-a[0]===0&&(c[0]+=1,a[0]-=1),c[1]-a[1]===0&&(c[1]+=1,a[1]-=1);var f=(c[0]-a[0])/(c[1]-a[1]),g=UEt(r,t,f);isNaN(f)&&(a=[g.x,g.y],c=[g.x+g.width,g.y+g.height]);var v=c[0]-a[0],y=c[1]-a[1],w=new Fv(null,{api:t,ecModel:i});return w.zoomLimit=r.get("scaleLimit"),w.setBoundingRect(a[0],a[1],v,y),w.setViewRect(g.x,g.y,g.width,g.height),w.setCenter(r.get("center")),w.setZoom(r.get("zoom")),e.push(w),w}}),e}var O$=Oo.prototype,ZR=fE.prototype,uit=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return i}();(function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t})(uit);function qR(i){return isNaN(+i.cpx1)||isNaN(+i.cpy1)}var HEt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="ec-line",r}return t.prototype.getDefaultStyle=function(){return{stroke:ye.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new uit},t.prototype.buildPath=function(e,r){qR(r)?O$.buildPath.call(this,e,r):ZR.buildPath.call(this,e,r)},t.prototype.pointAt=function(e){return qR(this.shape)?O$.pointAt.call(this,e):ZR.pointAt.call(this,e)},t.prototype.tangentAt=function(e){var r=this.shape,n=qR(r)?[r.x2-r.x1,r.y2-r.y1]:ZR.tangentAt.call(this,e);return B0(n,n)},t}(qr);const cit=HEt;var XR=["fromSymbol","toSymbol"];function z$(i){return"_"+i+"Type"}function B$(i,t,e){var r=t.getItemVisual(e,i);if(!r||r==="none")return r;var n=t.getItemVisual(e,i+"Size"),o=t.getItemVisual(e,i+"Rotate"),s=t.getItemVisual(e,i+"Offset"),a=t.getItemVisual(e,i+"KeepAspect"),c=q0(n),f=Rv(s||0,c);return r+c+f+(o||"")+(a||"")}function F$(i,t,e){var r=t.getItemVisual(e,i);if(!(!r||r==="none")){var n=t.getItemVisual(e,i+"Size"),o=t.getItemVisual(e,i+"Rotate"),s=t.getItemVisual(e,i+"Offset"),a=t.getItemVisual(e,i+"KeepAspect"),c=q0(n),f=Rv(s||0,c),g=To(r,-c[0]/2+f[0],-c[1]/2+f[1],c[0],c[1],null,a);return g.__specifiedRotation=o==null||isNaN(o)?void 0:+o*Math.PI/180||0,g.name=i,g}}function jEt(i){var t=new cit({name:"line",subPixelOptimize:!0});return nB(t.shape,i),t}function nB(i,t){i.x1=t[0][0],i.y1=t[0][1],i.x2=t[1][0],i.y2=t[1][1],i.percent=1;var e=t[2];e?(i.cpx1=e[0],i.cpy1=e[1]):(i.cpx1=NaN,i.cpy1=NaN)}var WEt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this)||this;return o._createLine(e,r,n),o}return t.prototype._createLine=function(e,r,n){var o=e.hostModel,s=e.getItemLayout(r),a=e.getItemVisual(r,"z2"),c=jEt(s);c.shape.percent=0,xa(c,{z2:Ui(a,0),shape:{percent:1}},o,r),this.add(c),pt(XR,function(f){var g=F$(f,e,r);this.add(g),this[z$(f)]=B$(f,e,r)},this),this._updateCommonStl(e,r,n)},t.prototype.updateData=function(e,r,n){var o=e.hostModel,s=this.childOfName("line"),a=e.getItemLayout(r),c={shape:{}};nB(c.shape,a),yn(s,c,o,r),pt(XR,function(f){var g=B$(f,e,r),v=z$(f);if(this[v]!==g){this.remove(this.childOfName(f));var y=F$(f,e,r);this.add(y)}this[v]=g},this),this._updateCommonStl(e,r,n)},t.prototype.getLinePath=function(){return this.childAt(0)},t.prototype._updateCommonStl=function(e,r,n){var o=e.hostModel,s=this.childOfName("line"),a=n&&n.emphasisLineStyle,c=n&&n.blurLineStyle,f=n&&n.selectLineStyle,g=n&&n.labelStatesModels,v=n&&n.emphasisDisabled,y=n&&n.focus,w=n&&n.blurScope;if(!n||e.hasItemOption){var I=e.getItemModel(r),E=I.getModel("emphasis");a=E.getModel("lineStyle").getLineStyle(),c=I.getModel(["blur","lineStyle"]).getLineStyle(),f=I.getModel(["select","lineStyle"]).getLineStyle(),v=E.get("disabled"),y=E.get("focus"),w=E.get("blurScope"),g=Fo(I)}var D=e.getItemVisual(r,"style"),R=D.stroke;s.useStyle(D),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=a,s.ensureState("blur").style=c,s.ensureState("select").style=f,pt(XR,function(Y){var J=this.childOfName(Y);if(J){J.setColor(R),J.style.opacity=D.opacity;for(var it=0;it<fl.length;it++){var at=fl[it],ut=s.getState(at);if(ut){var ft=ut.style||{},_t=J.ensureState(at),ct=_t.style||(_t.style={});ft.stroke!=null&&(ct[J.__isEmptyBrush?"stroke":"fill"]=ft.stroke),ft.opacity!=null&&(ct.opacity=ft.opacity)}}J.markRedraw()}},this);var z=o.getRawValue(r);Xo(this,g,{labelDataIndex:r,labelFetcher:{getFormattedLabel:function(Y,J){return o.getFormattedLabel(Y,J,e.dataType)}},inheritColor:R||ye.color.neutral99,defaultOpacity:D.opacity,defaultText:(z==null?e.getName(r):isFinite(z)?xo(z):z)+""});var N=this.getTextContent();if(N){var H=g.normal;N.__align=N.style.align,N.__verticalAlign=N.style.verticalAlign,N.__position=H.get("position")||"middle";var q=H.get("distance");Ye(q)||(q=[q,q]),N.__labelDistance=q}this.setTextConfig({position:null,local:!0,inside:!1}),Ca(this,y,w,v)},t.prototype.highlight=function(){Od(this)},t.prototype.downplay=function(){zd(this)},t.prototype.updateLayout=function(e,r){this.setLinePoints(e.getItemLayout(r))},t.prototype.setLinePoints=function(e){var r=this.childOfName("line");nB(r.shape,e),r.dirty()},t.prototype.beforeUpdate=function(){var e=this,r=e.childOfName("fromSymbol"),n=e.childOfName("toSymbol"),o=e.getTextContent();if(!r&&!n&&(!o||o.ignore))return;for(var s=1,a=this.parent;a;)a.scaleX&&(s/=a.scaleX),a=a.parent;var c=e.childOfName("line");if(!this.__dirty&&!c.__dirty)return;var f=c.shape.percent,g=c.pointAt(0),v=c.pointAt(f),y=jm([],v,g);B0(y,y);function w(ut,ft){var _t=ut.__specifiedRotation;if(_t==null){var ct=c.tangentAt(ft);ut.attr("rotation",(ft===1?-1:1)*Math.PI/2-Math.atan2(ct[1],ct[0]))}else ut.attr("rotation",_t)}if(r&&(r.setPosition(g),w(r,0),r.scaleX=r.scaleY=s*f,r.markRedraw()),n&&(n.setPosition(v),w(n,1),n.scaleX=n.scaleY=s*f,n.markRedraw()),o&&!o.ignore){o.x=o.y=0,o.originX=o.originY=0;var I=void 0,E=void 0,D=o.__labelDistance,R=D[0]*s,z=D[1]*s,N=f/2,H=c.tangentAt(N),q=[H[1],-H[0]],Y=c.pointAt(N);q[1]>0&&(q[0]=-q[0],q[1]=-q[1]);var J=H[0]<0?-1:1;if(o.__position!=="start"&&o.__position!=="end"){var it=-Math.atan2(H[1],H[0]);v[0]<g[0]&&(it=Math.PI+it),o.rotation=it}var at=void 0;switch(o.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":at=-z,E="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":at=z,E="top";break;default:at=0,E="middle"}switch(o.__position){case"end":o.x=y[0]*R+v[0],o.y=y[1]*z+v[1],I=y[0]>.8?"left":y[0]<-.8?"right":"center",E=y[1]>.8?"top":y[1]<-.8?"bottom":"middle";break;case"start":o.x=-y[0]*R+g[0],o.y=-y[1]*z+g[1],I=y[0]>.8?"right":y[0]<-.8?"left":"center",E=y[1]>.8?"bottom":y[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":o.x=R*J+g[0],o.y=g[1]+at,I=H[0]<0?"right":"left",o.originX=-R*J,o.originY=-at;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":o.x=Y[0],o.y=Y[1]+at,I="center",o.originY=-at;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":o.x=-R*J+v[0],o.y=v[1]+at,I=H[0]>=0?"right":"left",o.originX=R*J,o.originY=-at;break}o.scaleX=o.scaleY=s,o.setStyle({verticalAlign:o.__verticalAlign||E,align:o.__align||I})}},t}(Ki);const tN=WEt;var $Et=function(){function i(t){this.group=new Ki,this._LineCtor=t||tN}return i.prototype.updateData=function(t){var e=this;this._progressiveEls=null;var r=this,n=r.group,o=r._lineData;r._lineData=t,o||n.removeAll();var s=N$(t);t.diff(o).add(function(a){e._doAdd(t,a,s)}).update(function(a,c){e._doUpdate(o,t,c,a,s)}).remove(function(a){n.remove(o.getItemGraphicEl(a))}).execute()},i.prototype.updateLayout=function(){var t=this._lineData;t&&t.eachItemGraphicEl(function(e,r){e.updateLayout(t,r)},this)},i.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=N$(t),this._lineData=null,this.group.removeAll()},i.prototype.incrementalUpdate=function(t,e){this._progressiveEls=[];function r(a){!a.isGroup&&!ZEt(a)&&(a.incremental=!0,a.ensureState("emphasis").hoverLayer=!0)}for(var n=t.start;n<t.end;n++){var o=e.getItemLayout(n);if(YR(o)){var s=new this._LineCtor(e,n,this._seriesScope);s.traverse(r),this.group.add(s),e.setItemGraphicEl(n,s),this._progressiveEls.push(s)}}},i.prototype.remove=function(){this.group.removeAll()},i.prototype.eachRendered=function(t){$p(this._progressiveEls||this.group,t)},i.prototype._doAdd=function(t,e,r){var n=t.getItemLayout(e);if(YR(n)){var o=new this._LineCtor(t,e,r);t.setItemGraphicEl(e,o),this.group.add(o)}},i.prototype._doUpdate=function(t,e,r,n,o){var s=t.getItemGraphicEl(r);if(!YR(e.getItemLayout(n))){this.group.remove(s);return}s?s.updateData(e,n,o):s=new this._LineCtor(e,n,o),e.setItemGraphicEl(n,s),this.group.add(s)},i}();function ZEt(i){return i.animators&&i.animators.length>0}function N$(i){var t=i.hostModel,e=t.getModel("emphasis");return{lineStyle:t.getModel("lineStyle").getLineStyle(),emphasisLineStyle:e.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:t.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:t.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:e.get("disabled"),blurScope:e.get("blurScope"),focus:e.get("focus"),labelStatesModels:Fo(t)}}function V$(i){return isNaN(i[0])||isNaN(i[1])}function YR(i){return i&&!V$(i[0])&&!V$(i[1])}const eN=$Et;var KR=[],JR=[],QR=[],ky=rs,tk=nv,U$=Math.abs;function G$(i,t,e){for(var r=i[0],n=i[1],o=i[2],s=1/0,a,c=e*e,f=.1,g=.1;g<=.9;g+=.1){KR[0]=ky(r[0],n[0],o[0],g),KR[1]=ky(r[1],n[1],o[1],g);var v=U$(tk(KR,t)-c);v<s&&(s=v,a=g)}for(var y=0;y<32;y++){var w=a+f;JR[0]=ky(r[0],n[0],o[0],a),JR[1]=ky(r[1],n[1],o[1],a),QR[0]=ky(r[0],n[0],o[0],w),QR[1]=ky(r[1],n[1],o[1],w);var v=tk(JR,t)-c;if(U$(v)<.01)break;var I=tk(QR,t)-c;f/=2,v<0?I>=0?a=a+f:a=a-f:I>=0?a=a-f:a=a+f}return a}function ek(i,t){var e=[],r=Jw,n=[[],[],[]],o=[[],[]],s=[];t/=2,i.eachEdge(function(a,c){var f=a.getLayout(),g=a.getVisual("fromSymbol"),v=a.getVisual("toSymbol");f.__original||(f.__original=[Ad(f[0]),Ad(f[1])],f[2]&&f.__original.push(Ad(f[2])));var y=f.__original;if(f[2]!=null){if(ll(n[0],y[0]),ll(n[1],y[2]),ll(n[2],y[1]),g&&g!=="none"){var w=uw(a.node1),I=G$(n,y[0],w*t);r(n[0][0],n[1][0],n[2][0],I,e),n[0][0]=e[3],n[1][0]=e[4],r(n[0][1],n[1][1],n[2][1],I,e),n[0][1]=e[3],n[1][1]=e[4]}if(v&&v!=="none"){var w=uw(a.node2),I=G$(n,y[1],w*t);r(n[0][0],n[1][0],n[2][0],I,e),n[1][0]=e[1],n[2][0]=e[2],r(n[0][1],n[1][1],n[2][1],I,e),n[1][1]=e[1],n[2][1]=e[2]}ll(f[0],n[0]),ll(f[1],n[2]),ll(f[2],n[1])}else{if(ll(o[0],y[0]),ll(o[1],y[1]),jm(s,o[1],o[0]),B0(s,s),g&&g!=="none"){var w=uw(a.node1);AO(o[0],o[0],s,w*t)}if(v&&v!=="none"){var w=uw(a.node2);AO(o[1],o[1],s,-w*t)}ll(f[0],o[0]),ll(f[1],o[1])}})}var hit=Wr();function qEt(i){if(i)return hit(i).bridge}function H$(i,t){i&&(hit(i).bridge=t)}function j$(i){return i.type==="view"}var XEt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){var n=new XS,o=new eN,s=this.group,a=new Ki;this._controller=new Bv(r.getZr()),this._controllerHost={target:a},a.add(n.group),a.add(o.group),s.add(a),this._symbolDraw=n,this._lineDraw=o,this._mainGroup=a,this._firstRender=!0},t.prototype.render=function(e,r,n){var o=this,s=e.coordinateSystem,a=!1;this._model=e,this._api=n,this._active=!0;var c=this._getThumbnailInfo();c&&c.bridge.reset(n);var f=this._symbolDraw,g=this._lineDraw;if(j$(s)){var v={x:s.x,y:s.y,scaleX:s.scaleX,scaleY:s.scaleY};this._firstRender?this._mainGroup.attr(v):yn(this._mainGroup,v,e)}ek(e.getGraph(),lw(e));var y=e.getData();f.updateData(y);var w=e.getEdgeData();g.updateData(w),this._updateNodeAndLinkScale(),this._updateController(null,e,n),clearTimeout(this._layoutTimeout);var I=e.forceLayout,E=e.get(["force","layoutAnimation"]);I&&(a=!0,this._startForceLayoutIteration(I,n,E));var D=e.get("layout");y.graph.eachNode(function(H){var q=H.dataIndex,Y=H.getGraphicEl(),J=H.getModel();if(Y){Y.off("drag").off("dragend");var it=J.get("draggable");it&&Y.on("drag",function(ut){switch(D){case"force":I.warmUp(),!o._layouting&&o._startForceLayoutIteration(I,n,E),I.setFixed(q),y.setItemLayout(q,[Y.x,Y.y]);break;case"circular":y.setItemLayout(q,[Y.x,Y.y]),H.setLayout({fixed:!0},!0),Q3(e,"symbolSize",H,[ut.offsetX,ut.offsetY]),o.updateLayout(e);break;case"none":default:y.setItemLayout(q,[Y.x,Y.y]),J3(e.getGraph(),e),o.updateLayout(e);break}}).on("dragend",function(){I&&I.setUnfixed(q)}),Y.setDraggable(it,!!J.get("cursor"));var at=J.get(["emphasis","focus"]);at==="adjacency"&&(cr(Y).focus=H.getAdjacentDataIndices())}}),y.graph.eachEdge(function(H){var q=H.getGraphicEl(),Y=H.getModel().get(["emphasis","focus"]);q&&Y==="adjacency"&&(cr(q).focus={edge:[H.dataIndex],node:[H.node1.dataIndex,H.node2.dataIndex]})});var R=e.get("layout")==="circular"&&e.get(["circular","rotateLabel"]),z=y.getLayout("cx"),N=y.getLayout("cy");y.graph.eachNode(function(H){lit(H,R,z,N)}),this._firstRender=!1,a||this._renderThumbnail(e,n,this._symbolDraw,this._lineDraw)},t.prototype.dispose=function(){this.remove(),this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype._startForceLayoutIteration=function(e,r,n){var o=this,s=!1;(function a(){e.step(function(c){o.updateLayout(o._model),(c||!s)&&(s=!0,o._renderThumbnail(o._model,r,o._symbolDraw,o._lineDraw)),(o._layouting=!c)&&(n?o._layoutTimeout=setTimeout(a,16):a())})})()},t.prototype._updateController=function(e,r,n){var o=this._controller,s=this._controllerHost,a=r.coordinateSystem;if(!j$(a)){o.disable();return}o.enable(r.get("roam"),{api:n,zInfo:{component:r},triggerInfo:{roamTrigger:r.get("roamTrigger"),isInSelf:function(c,f,g){return a.containPoint([f,g])},isInClip:function(c,f,g){return!e||e.contain(f,g)}}}),s.zoomLimit=r.get("scaleLimit"),s.zoom=a.getZoom(),o.off("pan").off("zoom").on("pan",function(c){n.dispatchAction({seriesId:r.id,type:"graphRoam",dx:c.dx,dy:c.dy})}).on("zoom",function(c){n.dispatchAction({seriesId:r.id,type:"graphRoam",zoom:c.scale,originX:c.originX,originY:c.originY})})},t.prototype.updateViewOnPan=function(e,r,n){this._active&&(G3(this._controllerHost,n.dx,n.dy),this._updateThumbnailWindow())},t.prototype.updateViewOnZoom=function(e,r,n){this._active&&(H3(this._controllerHost,n.zoom,n.originX,n.originY),this._updateNodeAndLinkScale(),ek(e.getGraph(),lw(e)),this._lineDraw.updateLayout(),r.updateLabelLayout(),this._updateThumbnailWindow())},t.prototype._updateNodeAndLinkScale=function(){var e=this._model,r=e.getData(),n=lw(e);r.eachItemGraphicEl(function(o,s){o&&o.setSymbolScale(n)})},t.prototype.updateLayout=function(e){this._active&&(ek(e.getGraph(),lw(e)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout())},t.prototype.remove=function(){this._active=!1,clearTimeout(this._layoutTimeout),this._layouting=!1,this._layoutTimeout=null,this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove(),this._controller&&this._controller.disable()},t.prototype._getThumbnailInfo=function(){var e=this._model,r=e.coordinateSystem;if(r.type==="view"){var n=qEt(e);if(n)return{bridge:n,coordSys:r}}},t.prototype._updateThumbnailWindow=function(){var e=this._getThumbnailInfo();e&&e.bridge.updateWindow(e.coordSys.transform,this._api)},t.prototype._renderThumbnail=function(e,r,n,o){var s=this._getThumbnailInfo();if(s){var a=new Ki,c=n.group.children(),f=o.group.children(),g=new Ki,v=new Ki;a.add(v),a.add(g);for(var y=0;y<c.length;y++){var w=c[y],I=w.children()[0],E=w.x,D=w.y,R=Yi(I.shape),z=Ne(R,{width:I.scaleX,height:I.scaleY,x:E-I.scaleX/2,y:D-I.scaleY/2}),N=Yi(I.style),H=new I.constructor({shape:z,style:N,z2:151});v.add(H)}for(var y=0;y<f.length;y++){var w=f[y],q=w.children()[0],N=Yi(q.style),z=Yi(q.shape),Y=new cit({style:N,shape:z,z2:151});g.add(Y)}s.bridge.renderContent({api:r,roamType:e.get("roam"),viewportRect:null,group:a,targetTrans:s.coordSys.transform})}},t.type="graph",t}(ga);const YEt=XEt;function Oy(i){return"_EC_"+i}var KEt=function(){function i(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return i.prototype.isDirected=function(){return this._directed},i.prototype.addNode=function(t,e){t=t==null?""+e:""+t;var r=this._nodesMap;if(!r[Oy(t)]){var n=new zm(t,e);return n.hostGraph=this,this.nodes.push(n),r[Oy(t)]=n,n}},i.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},i.prototype.getNodeById=function(t){return this._nodesMap[Oy(t)]},i.prototype.addEdge=function(t,e,r){var n=this._nodesMap,o=this._edgesMap;if(fn(t)&&(t=this.nodes[t]),fn(e)&&(e=this.nodes[e]),t instanceof zm||(t=n[Oy(t)]),e instanceof zm||(e=n[Oy(e)]),!(!t||!e)){var s=t.id+"-"+e.id,a=new dit(t,e,r);return a.hostGraph=this,this._directed&&(t.outEdges.push(a),e.inEdges.push(a)),t.edges.push(a),t!==e&&e.edges.push(a),this.edges.push(a),o[s]=a,a}},i.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},i.prototype.getEdge=function(t,e){t instanceof zm&&(t=t.id),e instanceof zm&&(e=e.id);var r=this._edgesMap;return this._directed?r[t+"-"+e]:r[t+"-"+e]||r[e+"-"+t]},i.prototype.eachNode=function(t,e){for(var r=this.nodes,n=r.length,o=0;o<n;o++)r[o].dataIndex>=0&&t.call(e,r[o],o)},i.prototype.eachEdge=function(t,e){for(var r=this.edges,n=r.length,o=0;o<n;o++)r[o].dataIndex>=0&&r[o].node1.dataIndex>=0&&r[o].node2.dataIndex>=0&&t.call(e,r[o],o)},i.prototype.breadthFirstTraverse=function(t,e,r,n){if(e instanceof zm||(e=this._nodesMap[Oy(e)]),!!e){for(var o=r==="out"?"outEdges":r==="in"?"inEdges":"edges",s=0;s<this.nodes.length;s++)this.nodes[s].__visited=!1;if(!t.call(n,e,null))for(var a=[e];a.length;)for(var c=a.shift(),f=c[o],s=0;s<f.length;s++){var g=f[s],v=g.node1===c?g.node2:g.node1;if(!v.__visited){if(t.call(n,v,c))return;a.push(v),v.__visited=!0}}}},i.prototype.update=function(){for(var t=this.data,e=this.edgeData,r=this.nodes,n=this.edges,o=0,s=r.length;o<s;o++)r[o].dataIndex=-1;for(var o=0,s=t.count();o<s;o++)r[t.getRawIndex(o)].dataIndex=o;e.filterSelf(function(a){var c=n[e.getRawIndex(a)];return c.node1.dataIndex>=0&&c.node2.dataIndex>=0});for(var o=0,s=n.length;o<s;o++)n[o].dataIndex=-1;for(var o=0,s=e.count();o<s;o++)n[e.getRawIndex(o)].dataIndex=o},i.prototype.clone=function(){for(var t=new i(this._directed),e=this.nodes,r=this.edges,n=0;n<e.length;n++)t.addNode(e[n].id,e[n].dataIndex);for(var n=0;n<r.length;n++){var o=r[n];t.addEdge(o.node1.id,o.node2.id,o.dataIndex)}return t},i}(),zm=function(){function i(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=t??"",this.dataIndex=e??-1}return i.prototype.degree=function(){return this.edges.length},i.prototype.inDegree=function(){return this.inEdges.length},i.prototype.outDegree=function(){return this.outEdges.length},i.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,r=e.data.getItemModel(this.dataIndex);return r.getModel(t)}},i.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var r=this.edges[e];r.dataIndex<0||(t.edge.push(r.dataIndex),t.node.push(r.node1.dataIndex,r.node2.dataIndex))}return t},i.prototype.getTrajectoryDataIndices=function(){for(var t=Fi(),e=Fi(),r=0,n=this.edges.length;r<n;r++){var o=this.edges[r];if(!(o.dataIndex<0)){t.set(o.dataIndex,!0);for(var s=[o.node1],a=[o.node2],c=0;c<s.length;){var f=s[c];c++,e.set(f.dataIndex,!0);for(var g=f.inEdges,v=0,y=g.length,w=void 0,I=void 0;v<y;v++)w=g[v],I=w.dataIndex,I>=0&&!t.hasKey(I)&&(t.set(I,!0),s.push(w.node1))}for(c=0;c<a.length;){var E=a[c];c++,e.set(E.dataIndex,!0);for(var D=E.outEdges,v=0,R=D.length,z=void 0,N=void 0;v<R;v++)z=D[v],N=z.dataIndex,N>=0&&!t.hasKey(N)&&(t.set(N,!0),a.push(z.node2))}}}return{edge:t.keys(),node:e.keys()}},i}(),dit=function(){function i(t,e,r){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=r??-1}return i.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,r=e.edgeData.getItemModel(this.dataIndex);return r.getModel(t)}},i.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},i.prototype.getTrajectoryDataIndices=function(){var t=Fi(),e=Fi();t.set(this.dataIndex,!0);for(var r=[this.node1],n=[this.node2],o=0;o<r.length;){var s=r[o];o++,e.set(s.dataIndex,!0);for(var a=s.inEdges,c=0,f=a.length,g=void 0,v=void 0;c<f;c++)g=s.inEdges[c],v=g.dataIndex,v>=0&&!t.hasKey(v)&&(t.set(v,!0),r.push(g.node1))}for(o=0;o<n.length;){var y=n[o];o++,e.set(y.dataIndex,!0);for(var w=y.outEdges,c=0,f=w.length,I=void 0,E=void 0;c<f;c++)I=y.outEdges[c],E=I.dataIndex,E>=0&&!t.hasKey(E)&&(t.set(E,!0),n.push(I.node2))}return{edge:t.keys(),node:e.keys()}},i}();function fit(i,t){return{getValue:function(e){var r=this[i][t];return r.getStore().get(r.getDimensionIndex(e||"value"),this.dataIndex)},setVisual:function(e,r){this.dataIndex>=0&&this[i][t].setItemVisual(this.dataIndex,e,r)},getVisual:function(e){return this[i][t].getItemVisual(this.dataIndex,e)},setLayout:function(e,r){this.dataIndex>=0&&this[i][t].setItemLayout(this.dataIndex,e,r)},getLayout:function(){return this[i][t].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[i][t].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[i][t].getRawIndex(this.dataIndex)}}}Ao(zm,fit("hostGraph","data"));Ao(dit,fit("hostGraph","edgeData"));const JEt=KEt;function iN(i,t,e,r,n){for(var o=new JEt(r),s=0;s<i.length;s++)o.addNode(vs(i[s].id,i[s].name,s),s);for(var a=[],c=[],f=0,s=0;s<t.length;s++){var g=t[s],v=g.source,y=g.target;o.addEdge(v,y,f)&&(c.push(g),a.push(vs(ko(g.id,null),v+" > "+y)),f++)}var w=e.get("coordinateSystem"),I;if(w==="cartesian2d"||w==="polar"||w==="matrix")I=$d(i,e);else{var E=HS.get(w),D=E?E.dimensions||[]:[];Ar(D,"value")<0&&D.concat(["value"]);var R=$S(i,{coordDimensions:D,encodeDefine:e.getEncode()}).dimensions;I=new dl(R,e),I.initData(i)}var z=new dl(["value"],e);return z.initData(c,a),n&&n(I,z),Zet({mainData:I,struct:o,structAttr:"graph",datas:{node:I,edge:z},datasAttr:{node:"data",edge:"edgeData"}}),o.update(),o}var QEt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments);var r=this;function n(){return r._categoriesData}this.legendVisualProvider=new J0(n,n),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links),this._updateCategoriesData()},t.prototype.mergeDefaultAndTheme=function(e){i.prototype.mergeDefaultAndTheme.apply(this,arguments),mv(e,"edgeLabel",["show"])},t.prototype.getInitialData=function(e,r){var n=e.edges||e.links||[],o=e.data||e.nodes||[],s=this;if(o&&n){kEt(this);var a=iN(o,n,this,!0,c);return pt(a.edges,function(f){OEt(f.node1,f.node2,this,f.dataIndex)},this),a.data}function c(f,g){f.wrapMethod("getItemModel",function(I){var E=s._categoriesModels,D=I.getShallow("category"),R=E[D];return R&&(R.parentModel=I.parentModel,I.parentModel=R),I});var v=bn.prototype.getModel;function y(I,E){var D=v.call(this,I,E);return D.resolveParentPath=w,D}g.wrapMethod("getItemModel",function(I){return I.resolveParentPath=w,I.getModel=y,I});function w(I){if(I&&(I[0]==="label"||I[1]==="label")){var E=I.slice();return I[0]==="label"?E[0]="edgeLabel":I[1]==="label"&&(E[1]="edgeLabel"),E}return I}}},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.getCategoriesData=function(){return this._categoriesData},t.prototype.formatTooltip=function(e,r,n){if(n==="edge"){var o=this.getData(),s=this.getDataParams(e,n),a=o.graph.getEdgeByIndex(e),c=o.getName(a.node1.dataIndex),f=o.getName(a.node2.dataIndex),g=[];return c!=null&&g.push(c),f!=null&&g.push(f),So("nameValue",{name:g.join(" > "),value:s.value,noValue:s.value==null})}var v=dQ({series:this,dataIndex:e,multipleSeries:r});return v},t.prototype._updateCategoriesData=function(){var e=ti(this.option.categories||[],function(n){return n.value!=null?n:Ne({value:0},n)}),r=new dl(["value"],this);r.initData(e),this._categoriesData=r,this._categoriesModels=r.mapArray(function(n){return r.getItemModel(n)})},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.isAnimationEnabled=function(){return i.prototype.isAnimationEnabled.call(this)&&!(this.get("layout")==="force"&&this.get(["force","layoutAnimation"]))},t.type="series.graph",t.dependencies=["grid","polar","geo","singleAxis","calendar"],t.defaultOption={z:2,coordinateSystem:"view",legendHoverLink:!0,layout:null,circular:{rotateLabel:!1},force:{initLayout:null,repulsion:[0,50],gravity:.1,friction:.6,edgeLength:30,layoutAnimation:!0},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{position:"middle",distance:5},draggable:!1,roam:!1,center:null,zoom:1,nodeScaleRatio:.6,label:{show:!1,formatter:"{b}"},itemStyle:{},lineStyle:{color:ye.color.neutral50,width:1,opacity:.5},emphasis:{scale:!0,label:{show:!0}},select:{itemStyle:{borderColor:ye.color.primary}}},t}(Ea);const tDt=QEt;function eDt(i){i.registerChartView(YEt),i.registerSeriesModel(tDt),i.registerProcessor(EEt),i.registerVisual(DEt),i.registerVisual(PEt),i.registerLayout(zEt),i.registerLayout(i.PRIORITY.VISUAL.POST_CHART_LAYOUT,FEt),i.registerLayout(VEt),i.registerCoordinateSystem("graphView",{dimensions:Fv.dimensions,create:GEt}),i.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series:focusNodeAdjacency"},ho),i.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series:unfocusNodeAdjacency"},ho),i.registerAction({type:"graphRoam",event:"graphRoam",update:"none"},function(t,e,r){e.eachComponent({mainType:"series",query:t},function(n){var o=r.getViewOfSeriesModel(n);o&&(t.dx!=null&&t.dy!=null&&o.updateViewOnPan(n,r,t),t.zoom!=null&&t.originX!=null&&t.originY!=null&&o.updateViewOnZoom(n,r,t));var s=n.coordinateSystem,a=DE(s,t,n.get("scaleLimit"));n.setCenter&&n.setCenter(a.center),n.setZoom&&n.setZoom(a.zoom)})})}var iDt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this)||this;cr(o).dataType="node",o.z2=2;var s=new _n;return o.setTextContent(s),o.updateData(e,r,n,!0),o}return t.prototype.updateData=function(e,r,n,o){var s=this,a=e.graph.getNodeByIndex(r),c=e.hostModel,f=a.getModel(),g=f.getModel("emphasis"),v=e.getItemLayout(r),y=Ne(dh(f.getModel("itemStyle"),v,!0),v),w=this;if(isNaN(y.startAngle)){w.setShape(y);return}o?w.setShape(y):yn(w,{shape:y},c,r);var I=Ne(dh(f.getModel("itemStyle"),v,!0),v);s.setShape(I),s.useStyle(e.getItemVisual(r,"style")),Bo(s,f),this._updateLabel(c,f,a),e.setItemGraphicEl(r,w),Bo(w,f,"itemStyle");var E=g.get("focus");Ca(this,E==="adjacency"?a.getAdjacentDataIndices():E,g.get("blurScope"),g.get("disabled"))},t.prototype._updateLabel=function(e,r,n){var o=this.getTextContent(),s=n.getLayout(),a=(s.startAngle+s.endAngle)/2,c=Math.cos(a),f=Math.sin(a),g=r.getModel("label");o.ignore=!g.get("show");var v=Fo(r),y=n.getVisual("style");Xo(o,v,{labelFetcher:{getFormattedLabel:function(z,N,H,q,Y,J){return e.getFormattedLabel(z,N,"node",q,iu(Y,v.normal&&v.normal.get("formatter"),r.get("name")),J)}},labelDataIndex:n.dataIndex,defaultText:n.dataIndex+"",inheritColor:y.fill,defaultOpacity:y.opacity,defaultOutsidePosition:"startArc"});var w=g.get("position")||"outside",I=g.get("distance")||0,E;w==="outside"?E=s.r+I:E=(s.r+s.r0)/2,this.textConfig={inside:w!=="outside"};var D=w!=="outside"?g.get("align")||"center":c>0?"left":"right",R=w!=="outside"?g.get("verticalAlign")||"middle":f>0?"top":"bottom";o.attr({x:c*E+s.cx,y:f*E+s.cy,rotation:0,style:{align:D,verticalAlign:R}})},t}(pl);const W$=iDt;var rDt=function(i){Se(t,i);function t(e,r,n,o){var s=i.call(this)||this;return cr(s).dataType="edge",s.updateData(e,r,n,o,!0),s}return t.prototype.buildPath=function(e,r){e.moveTo(r.s1[0],r.s1[1]);var n=.7,o=r.clockwise;e.arc(r.cx,r.cy,r.r,r.sStartAngle,r.sEndAngle,!o),e.bezierCurveTo((r.cx-r.s2[0])*n+r.s2[0],(r.cy-r.s2[1])*n+r.s2[1],(r.cx-r.t1[0])*n+r.t1[0],(r.cy-r.t1[1])*n+r.t1[1],r.t1[0],r.t1[1]),e.arc(r.cx,r.cy,r.r,r.tStartAngle,r.tEndAngle,!o),e.bezierCurveTo((r.cx-r.t2[0])*n+r.t2[0],(r.cy-r.t2[1])*n+r.t2[1],(r.cx-r.s1[0])*n+r.s1[0],(r.cy-r.s1[1])*n+r.s1[1],r.s1[0],r.s1[1]),e.closePath()},t.prototype.updateData=function(e,r,n,o,s){var a=e.hostModel,c=r.graph.getEdgeByIndex(n),f=c.getLayout(),g=c.node1.getModel(),v=r.getItemModel(c.dataIndex),y=v.getModel("lineStyle"),w=v.getModel("emphasis"),I=w.get("focus"),E=Ne(dh(g.getModel("itemStyle"),f,!0),f),D=this;if(isNaN(E.sStartAngle)||isNaN(E.tStartAngle)){D.setShape(E);return}s?(D.setShape(E),$$(D,c,e,y)):(zu(D),$$(D,c,e,y),yn(D,{shape:E},a,n)),Ca(this,I==="adjacency"?c.getAdjacentDataIndices():I,w.get("blurScope"),w.get("disabled")),Bo(D,v,"lineStyle"),r.setItemGraphicEl(c.dataIndex,D)},t}(qr);function $$(i,t,e,r){var n=t.node1,o=t.node2,s=i.style;i.setStyle(r.getLineStyle());var a=r.get("color");switch(a){case"source":s.fill=e.getItemVisual(n.dataIndex,"style").fill,s.decal=n.getVisual("style").decal;break;case"target":s.fill=e.getItemVisual(o.dataIndex,"style").fill,s.decal=o.getVisual("style").decal;break;case"gradient":var c=e.getItemVisual(n.dataIndex,"style").fill,f=e.getItemVisual(o.dataIndex,"style").fill;if(wi(c)&&wi(f)){var g=i.shape,v=(g.s1[0]+g.s2[0])/2,y=(g.s1[1]+g.s2[1])/2,w=(g.t1[0]+g.t2[0])/2,I=(g.t1[1]+g.t2[1])/2;s.fill=new U0(v,y,w,I,[{offset:0,color:c},{offset:1,color:f}],!0)}break}}var nDt=Math.PI/180,aDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){},t.prototype.render=function(e,r,n){var o=e.getData(),s=this._data,a=this.group,c=-e.get("startAngle")*nDt;if(o.diff(s).add(function(g){var v=o.getItemLayout(g);if(v){var y=new W$(o,g,c);cr(y).dataIndex=g,a.add(y)}}).update(function(g,v){var y=s.getItemGraphicEl(v),w=o.getItemLayout(g);if(!w){y&&Id(y,e,v);return}y?y.updateData(o,g,c):y=new W$(o,g,c),a.add(y)}).remove(function(g){var v=s.getItemGraphicEl(g);v&&Id(v,e,g)}).execute(),!s){var f=e.get("center");this.group.scaleX=.01,this.group.scaleY=.01,this.group.originX=xi(f[0],n.getWidth()),this.group.originY=xi(f[1],n.getHeight()),xa(this.group,{scaleX:1,scaleY:1},e)}this._data=o,this.renderEdges(e,c)},t.prototype.renderEdges=function(e,r){var n=e.getData(),o=e.getEdgeData(),s=this._edgeData,a=this.group;o.diff(s).add(function(c){var f=new rDt(n,o,c,r);cr(f).dataIndex=c,a.add(f)}).update(function(c,f){var g=s.getItemGraphicEl(f);g.updateData(n,o,c,r),a.add(g)}).remove(function(c){var f=s.getItemGraphicEl(c);f&&Id(f,e,c)}).execute(),this._edgeData=o},t.prototype.dispose=function(){},t.type="chord",t}(ga);const oDt=aDt;var sDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links),this.legendVisualProvider=new J0(Si(this.getData,this),Si(this.getRawData,this))},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(e.edges||e.links)},t.prototype.getInitialData=function(e,r){var n=e.edges||e.links||[],o=e.data||e.nodes||[];if(o&&n){var s=iN(o,n,this,!0,a);return s.data}function a(c,f){var g=bn.prototype.getModel;function v(w,I){var E=g.call(this,w,I);return E.resolveParentPath=y,E}f.wrapMethod("getItemModel",function(w){return w.resolveParentPath=y,w.getModel=v,w});function y(w){if(w&&(w[0]==="label"||w[1]==="label")){var I=w.slice();return w[0]==="label"?I[0]="edgeLabel":w[1]==="label"&&(I[1]="edgeLabel"),I}return w}}},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,r,n){var o=this.getDataParams(e,n);if(n==="edge"){var s=this.getData(),a=s.graph.getEdgeByIndex(e),c=s.getName(a.node1.dataIndex),f=s.getName(a.node2.dataIndex),g=[];return c!=null&&g.push(c),f!=null&&g.push(f),So("nameValue",{name:g.join(" > "),value:o.value,noValue:o.value==null})}return So("nameValue",{name:o.name,value:o.value,noValue:o.value==null})},t.prototype.getDataParams=function(e,r){var n=i.prototype.getDataParams.call(this,e,r);if(r==="node"){var o=this.getData(),s=this.getGraph().getNodeByIndex(e);if(n.name==null&&(n.name=o.getName(e)),n.value==null){var a=s.getLayout().value;n.value=a}}return n},t.type="series.chord",t.defaultOption={z:2,coordinateSystem:"none",legendHoverLink:!0,colorBy:"data",left:0,top:0,right:0,bottom:0,width:null,height:null,center:["50%","50%"],radius:["70%","80%"],clockwise:!0,startAngle:90,endAngle:"auto",minAngle:0,padAngle:3,itemStyle:{borderRadius:[0,0,5,5]},lineStyle:{width:0,color:"source",opacity:.2},label:{show:!0,position:"outside",distance:5},emphasis:{focus:"adjacency",lineStyle:{opacity:.5}}},t}(Ea);const lDt=sDt;var ik=Math.PI/180;function uDt(i,t){i.eachSeriesByType("chord",function(e){cDt(e,t)})}function cDt(i,t){var e=i.getData(),r=e.graph,n=i.getEdgeData(),o=n.count();if(o){var s=EJ(i,t),a=s.cx,c=s.cy,f=s.r,g=s.r0,v=Math.max((i.get("padAngle")||0)*ik,0),y=Math.max((i.get("minAngle")||0)*ik,0),w=-i.get("startAngle")*ik,I=w+Math.PI*2,E=i.get("clockwise"),D=E?1:-1,R=[w,I];lE(R,!E);var z=R[0],N=R[1],H=N-z,q=e.getSum("value")===0&&n.getSum("value")===0,Y=[],J=0;r.eachEdge(function(zt){var Jt=q?1:zt.getValue("value");q&&(Jt>0||y)&&(J+=2);var ce=zt.node1.dataIndex,be=zt.node2.dataIndex;Y[ce]=(Y[ce]||0)+Jt,Y[be]=(Y[be]||0)+Jt});var it=0;if(r.eachNode(function(zt){var Jt=zt.getValue("value");isNaN(Jt)||(Y[zt.dataIndex]=Math.max(Jt,Y[zt.dataIndex]||0)),!q&&(Y[zt.dataIndex]>0||y)&&J++,it+=Y[zt.dataIndex]||0}),!(J===0||it===0)){v*J>=Math.abs(H)&&(v=Math.max(0,(Math.abs(H)-y*J)/J)),(v+y)*J>=Math.abs(H)&&(y=(Math.abs(H)-v*J)/J);var at=(H-v*J*D)/it,ut=0,ft=0,_t=0;r.eachNode(function(zt){var Jt=Y[zt.dataIndex]||0,ce=at*(it?Jt:1)*D;Math.abs(ce)<y?ut+=y-Math.abs(ce):(ft+=Math.abs(ce)-y,_t+=Math.abs(ce)),zt.setLayout({angle:ce,value:Jt})});var ct=!1;if(ut>ft){var Dt=ut/ft;r.eachNode(function(zt){var Jt=zt.getLayout().angle;Math.abs(Jt)>=y?zt.setLayout({angle:Jt*Dt,ratio:Dt},!0):zt.setLayout({angle:y,ratio:y===0?1:Jt/y},!0)})}else r.eachNode(function(zt){if(!ct){var Jt=zt.getLayout().angle,ce=Math.min(Jt/_t,1),be=ce*ut;Jt-be<y&&(ct=!0)}});var Et=ut;r.eachNode(function(zt){if(!(Et<=0)){var Jt=zt.getLayout().angle;if(Jt>y&&y>0){var ce=ct?1:Math.min(Jt/_t,1),be=Jt-y,ve=Math.min(be,Math.min(Et,ut*ce));Et-=ve,zt.setLayout({angle:Jt-ve,ratio:(Jt-ve)/Jt},!0)}else y>0&&zt.setLayout({angle:y,ratio:Jt===0?1:y/Jt},!0)}});var bt=z,Vt=[];r.eachNode(function(zt){var Jt=Math.max(zt.getLayout().angle,y);zt.setLayout({cx:a,cy:c,r0:g,r:f,startAngle:bt,endAngle:bt+Jt*D,clockwise:E},!0),Vt[zt.dataIndex]=bt,bt+=(Jt+v)*D}),r.eachEdge(function(zt){var Jt=q?1:zt.getValue("value"),ce=at*(it?Jt:1)*D,be=zt.node1.dataIndex,ve=Vt[be]||0,ke=Math.abs((zt.node1.getLayout().ratio||1)*ce),ni=ve+ke*D,bi=[a+g*Math.cos(ve),c+g*Math.sin(ve)],or=[a+g*Math.cos(ni),c+g*Math.sin(ni)],Ue=zt.node2.dataIndex,Ze=Vt[Ue]||0,xe=Math.abs((zt.node2.getLayout().ratio||1)*ce),Ke=Ze+xe*D,We=[a+g*Math.cos(Ze),c+g*Math.sin(Ze)],Ti=[a+g*Math.cos(Ke),c+g*Math.sin(Ke)];zt.setLayout({s1:bi,s2:or,sStartAngle:ve,sEndAngle:ni,t1:We,t2:Ti,tStartAngle:Ze,tEndAngle:Ke,cx:a,cy:c,r:g,value:Jt,clockwise:E}),Vt[be]=ni,Vt[Ue]=Ke})}}}function hDt(i){i.registerChartView(oDt),i.registerSeriesModel(lDt),i.registerLayout(i.PRIORITY.VISUAL.POST_CHART_LAYOUT,uDt),i.registerProcessor(Y0("chord"))}var dDt=function(){function i(){this.angle=0,this.width=10,this.r=10,this.x=0,this.y=0}return i}(),fDt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="pointer",r}return t.prototype.getDefaultShape=function(){return new dDt},t.prototype.buildPath=function(e,r){var n=Math.cos,o=Math.sin,s=r.r,a=r.width,c=r.angle,f=r.x-n(c)*a*(a>=s/3?1:2),g=r.y-o(c)*a*(a>=s/3?1:2);c=r.angle-Math.PI/2,e.moveTo(f,g),e.lineTo(r.x+n(c)*a,r.y+o(c)*a),e.lineTo(r.x+n(r.angle)*s,r.y+o(r.angle)*s),e.lineTo(r.x-n(c)*a,r.y-o(c)*a),e.lineTo(f,g)},t}(qr);const pDt=fDt;function gDt(i,t){var e=i.get("center"),r=t.getWidth(),n=t.getHeight(),o=Math.min(r,n),s=xi(e[0],t.getWidth()),a=xi(e[1],t.getHeight()),c=xi(i.get("radius"),o/2);return{cx:s,cy:a,r:c}}function nI(i,t){var e=i==null?"":i+"";return t&&(wi(t)?e=t.replace("{value}",e):Xi(t)&&(e=t(i))),e}var mDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){this.group.removeAll();var o=e.get(["axisLine","lineStyle","color"]),s=gDt(e,n);this._renderMain(e,r,n,o,s),this._data=e.getData()},t.prototype.dispose=function(){},t.prototype._renderMain=function(e,r,n,o,s){var a=this.group,c=e.get("clockwise"),f=-e.get("startAngle")/180*Math.PI,g=-e.get("endAngle")/180*Math.PI,v=e.getModel("axisLine"),y=v.get("roundCap"),w=y?sM:pl,I=v.get("show"),E=v.getModel("lineStyle"),D=E.get("width"),R=[f,g];lE(R,!c),f=R[0],g=R[1];for(var z=g-f,N=f,H=[],q=0;I&&q<o.length;q++){var Y=Math.min(Math.max(o[q][0],0),1);g=f+z*Y;var J=new w({shape:{startAngle:N,endAngle:g,cx:s.cx,cy:s.cy,clockwise:c,r0:s.r-D,r:s.r},silent:!0});J.setStyle({fill:o[q][1]}),J.setStyle(E.getLineStyle(["color","width"])),H.push(J),N=g}H.reverse(),pt(H,function(at){return a.add(at)});var it=function(at){if(at<=0)return o[0][1];var ut;for(ut=0;ut<o.length;ut++)if(o[ut][0]>=at&&(ut===0?0:o[ut-1][0])<at)return o[ut][1];return o[ut-1][1]};this._renderTicks(e,r,n,it,s,f,g,c,D),this._renderTitleAndDetail(e,r,n,it,s),this._renderAnchor(e,s),this._renderPointer(e,r,n,it,s,f,g,c,D)},t.prototype._renderTicks=function(e,r,n,o,s,a,c,f,g){for(var v=this.group,y=s.cx,w=s.cy,I=s.r,E=+e.get("min"),D=+e.get("max"),R=e.getModel("splitLine"),z=e.getModel("axisTick"),N=e.getModel("axisLabel"),H=e.get("splitNumber"),q=z.get("splitNumber"),Y=xi(R.get("length"),I),J=xi(z.get("length"),I),it=a,at=(c-a)/H,ut=at/q,ft=R.getModel("lineStyle").getLineStyle(),_t=z.getModel("lineStyle").getLineStyle(),ct=R.get("distance"),Dt,Et,bt=0;bt<=H;bt++){if(Dt=Math.cos(it),Et=Math.sin(it),R.get("show")){var Vt=ct?ct+g:g,zt=new Oo({shape:{x1:Dt*(I-Vt)+y,y1:Et*(I-Vt)+w,x2:Dt*(I-Y-Vt)+y,y2:Et*(I-Y-Vt)+w},style:ft,silent:!0});ft.stroke==="auto"&&zt.setStyle({stroke:o(bt/H)}),v.add(zt)}if(N.get("show")){var Vt=N.get("distance")+ct,Jt=nI(xo(bt/H*(D-E)+E),N.get("formatter")),ce=o(bt/H),be=Dt*(I-Y-Vt)+y,ve=Et*(I-Y-Vt)+w,ke=N.get("rotate"),ni=0;ke==="radial"?(ni=-it+2*Math.PI,ni>Math.PI/2&&(ni+=Math.PI)):ke==="tangential"?ni=-it-Math.PI/2:fn(ke)&&(ni=ke*Math.PI/180),ni===0?v.add(new _n({style:pa(N,{text:Jt,x:be,y:ve,verticalAlign:Et<-.8?"top":Et>.8?"bottom":"middle",align:Dt<-.4?"left":Dt>.4?"right":"center"},{inheritColor:ce}),silent:!0})):v.add(new _n({style:pa(N,{text:Jt,x:be,y:ve,verticalAlign:"middle",align:"center"},{inheritColor:ce}),silent:!0,originX:be,originY:ve,rotation:ni}))}if(z.get("show")&&bt!==H){var Vt=z.get("distance");Vt=Vt?Vt+g:g;for(var bi=0;bi<=q;bi++){Dt=Math.cos(it),Et=Math.sin(it);var or=new Oo({shape:{x1:Dt*(I-Vt)+y,y1:Et*(I-Vt)+w,x2:Dt*(I-J-Vt)+y,y2:Et*(I-J-Vt)+w},silent:!0,style:_t});_t.stroke==="auto"&&or.setStyle({stroke:o((bt+bi/q)/H)}),v.add(or),it+=ut}it-=ut}else it+=at}},t.prototype._renderPointer=function(e,r,n,o,s,a,c,f,g){var v=this.group,y=this._data,w=this._progressEls,I=[],E=e.get(["pointer","show"]),D=e.getModel("progress"),R=D.get("show"),z=e.getData(),N=z.mapDimension("value"),H=+e.get("min"),q=+e.get("max"),Y=[H,q],J=[a,c];function it(ut,ft){var _t=z.getItemModel(ut),ct=_t.getModel("pointer"),Dt=xi(ct.get("width"),s.r),Et=xi(ct.get("length"),s.r),bt=e.get(["pointer","icon"]),Vt=ct.get("offsetCenter"),zt=xi(Vt[0],s.r),Jt=xi(Vt[1],s.r),ce=ct.get("keepAspect"),be;return bt?be=To(bt,zt-Dt/2,Jt-Et,Dt,Et,null,ce):be=new pDt({shape:{angle:-Math.PI/2,width:Dt,r:Et,x:zt,y:Jt}}),be.rotation=-(ft+Math.PI/2),be.x=s.cx,be.y=s.cy,be}function at(ut,ft){var _t=D.get("roundCap"),ct=_t?sM:pl,Dt=D.get("overlap"),Et=Dt?D.get("width"):g/z.count(),bt=Dt?s.r-Et:s.r-(ut+1)*Et,Vt=Dt?s.r:s.r-ut*Et,zt=new ct({shape:{startAngle:a,endAngle:ft,cx:s.cx,cy:s.cy,clockwise:f,r0:bt,r:Vt}});return Dt&&(zt.z2=Rn(z.get(N,ut),[H,q],[100,0],!0)),zt}(R||E)&&(z.diff(y).add(function(ut){var ft=z.get(N,ut);if(E){var _t=it(ut,a);xa(_t,{rotation:-((isNaN(+ft)?J[0]:Rn(ft,Y,J,!0))+Math.PI/2)},e),v.add(_t),z.setItemGraphicEl(ut,_t)}if(R){var ct=at(ut,a),Dt=D.get("clip");xa(ct,{shape:{endAngle:Rn(ft,Y,J,Dt)}},e),v.add(ct),ez(e.seriesIndex,z.dataType,ut,ct),I[ut]=ct}}).update(function(ut,ft){var _t=z.get(N,ut);if(E){var ct=y.getItemGraphicEl(ft),Dt=ct?ct.rotation:a,Et=it(ut,Dt);Et.rotation=Dt,yn(Et,{rotation:-((isNaN(+_t)?J[0]:Rn(_t,Y,J,!0))+Math.PI/2)},e),v.add(Et),z.setItemGraphicEl(ut,Et)}if(R){var bt=w[ft],Vt=bt?bt.shape.endAngle:a,zt=at(ut,Vt),Jt=D.get("clip");yn(zt,{shape:{endAngle:Rn(_t,Y,J,Jt)}},e),v.add(zt),ez(e.seriesIndex,z.dataType,ut,zt),I[ut]=zt}}).execute(),z.each(function(ut){var ft=z.getItemModel(ut),_t=ft.getModel("emphasis"),ct=_t.get("focus"),Dt=_t.get("blurScope"),Et=_t.get("disabled");if(E){var bt=z.getItemGraphicEl(ut),Vt=z.getItemVisual(ut,"style"),zt=Vt.fill;if(bt instanceof ys){var Jt=bt.style;bt.useStyle(Ne({image:Jt.image,x:Jt.x,y:Jt.y,width:Jt.width,height:Jt.height},Vt))}else bt.useStyle(Vt),bt.type!=="pointer"&&bt.setColor(zt);bt.setStyle(ft.getModel(["pointer","itemStyle"]).getItemStyle()),bt.style.fill==="auto"&&bt.setStyle("fill",o(Rn(z.get(N,ut),Y,[0,1],!0))),bt.z2EmphasisLift=0,Bo(bt,ft),Ca(bt,ct,Dt,Et)}if(R){var ce=I[ut];ce.useStyle(z.getItemVisual(ut,"style")),ce.setStyle(ft.getModel(["progress","itemStyle"]).getItemStyle()),ce.z2EmphasisLift=0,Bo(ce,ft),Ca(ce,ct,Dt,Et)}}),this._progressEls=I)},t.prototype._renderAnchor=function(e,r){var n=e.getModel("anchor"),o=n.get("show");if(o){var s=n.get("size"),a=n.get("icon"),c=n.get("offsetCenter"),f=n.get("keepAspect"),g=To(a,r.cx-s/2+xi(c[0],r.r),r.cy-s/2+xi(c[1],r.r),s,s,null,f);g.z2=n.get("showAbove")?1:0,g.setStyle(n.getModel("itemStyle").getItemStyle()),this.group.add(g)}},t.prototype._renderTitleAndDetail=function(e,r,n,o,s){var a=this,c=e.getData(),f=c.mapDimension("value"),g=+e.get("min"),v=+e.get("max"),y=new Ki,w=[],I=[],E=e.isAnimationEnabled(),D=e.get(["pointer","showAbove"]);c.diff(this._data).add(function(R){w[R]=new _n({silent:!0}),I[R]=new _n({silent:!0})}).update(function(R,z){w[R]=a._titleEls[z],I[R]=a._detailEls[z]}).execute(),c.each(function(R){var z=c.getItemModel(R),N=c.get(f,R),H=new Ki,q=o(Rn(N,[g,v],[0,1],!0)),Y=z.getModel("title");if(Y.get("show")){var J=Y.get("offsetCenter"),it=s.cx+xi(J[0],s.r),at=s.cy+xi(J[1],s.r),ut=w[R];ut.attr({z2:D?0:2,style:pa(Y,{x:it,y:at,text:c.getName(R),align:"center",verticalAlign:"middle"},{inheritColor:q})}),H.add(ut)}var ft=z.getModel("detail");if(ft.get("show")){var _t=ft.get("offsetCenter"),ct=s.cx+xi(_t[0],s.r),Dt=s.cy+xi(_t[1],s.r),Et=xi(ft.get("width"),s.r),bt=xi(ft.get("height"),s.r),Vt=e.get(["progress","show"])?c.getItemVisual(R,"style").fill:q,ut=I[R],zt=ft.get("formatter");ut.attr({z2:D?0:2,style:pa(ft,{x:ct,y:Dt,text:nI(N,zt),width:isNaN(Et)?null:Et,height:isNaN(bt)?null:bt,align:"center",verticalAlign:"middle"},{inheritColor:Vt})}),lJ(ut,{normal:ft},N,function(ce){return nI(ce,zt)}),E&&uJ(ut,R,c,e,{getFormattedLabel:function(ce,be,ve,ke,ni,bi){return nI(bi?bi.interpolatedValue:N,zt)}}),H.add(ut)}y.add(H)}),this.group.add(y),this._titleEls=w,this._detailEls=I},t.type="gauge",t}(ga);const vDt=mDt;var _Dt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="itemStyle",e}return t.prototype.getInitialData=function(e,r){return K0(this,["value"])},t.type="series.gauge",t.defaultOption={z:2,colorBy:"data",center:["50%","50%"],legendHoverLink:!0,radius:"75%",startAngle:225,endAngle:-45,clockwise:!0,min:0,max:100,splitNumber:10,axisLine:{show:!0,roundCap:!1,lineStyle:{color:[[1,ye.color.neutral10]],width:10}},progress:{show:!1,overlap:!0,width:10,roundCap:!1,clip:!0},splitLine:{show:!0,length:10,distance:10,lineStyle:{color:ye.color.axisTick,width:3,type:"solid"}},axisTick:{show:!0,splitNumber:5,length:6,distance:10,lineStyle:{color:ye.color.axisTickMinor,width:1,type:"solid"}},axisLabel:{show:!0,distance:15,color:ye.color.axisLabel,fontSize:12,rotate:0},pointer:{icon:null,offsetCenter:[0,0],show:!0,showAbove:!0,length:"60%",width:6,keepAspect:!1},anchor:{show:!1,showAbove:!1,size:6,icon:"circle",offsetCenter:[0,0],keepAspect:!1,itemStyle:{color:ye.color.neutral00,borderWidth:0,borderColor:ye.color.theme[0]}},title:{show:!0,offsetCenter:[0,"20%"],color:ye.color.secondary,fontSize:16,valueAnimation:!1},detail:{show:!0,backgroundColor:ye.color.transparent,borderWidth:0,borderColor:ye.color.neutral40,width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:ye.color.primary,fontSize:30,fontWeight:"bold",lineHeight:30,valueAnimation:!1}},t}(Ea);const yDt=_Dt;function xDt(i){i.registerChartView(vDt),i.registerSeriesModel(yDt)}var bDt=["itemStyle","opacity"],wDt=function(i){Se(t,i);function t(e,r){var n=i.call(this)||this,o=n,s=new Us,a=new _n;return o.setTextContent(a),n.setTextGuideLine(s),n.updateData(e,r,!0),n}return t.prototype.updateData=function(e,r,n){var o=this,s=e.hostModel,a=e.getItemModel(r),c=e.getItemLayout(r),f=a.getModel("emphasis"),g=a.get(bDt);g=g??1,n||zu(o),o.useStyle(e.getItemVisual(r,"style")),o.style.lineJoin="round",n?(o.setShape({points:c.points}),o.style.opacity=0,xa(o,{style:{opacity:g}},s,r)):yn(o,{style:{opacity:g},shape:{points:c.points}},s,r),Bo(o,a),this._updateLabel(e,r),Ca(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},t.prototype._updateLabel=function(e,r){var n=this,o=this.getTextGuideLine(),s=n.getTextContent(),a=e.hostModel,c=e.getItemModel(r),f=e.getItemLayout(r),g=f.label,v=e.getItemVisual(r,"style"),y=v.fill;Xo(s,Fo(c),{labelFetcher:e.hostModel,labelDataIndex:r,defaultOpacity:v.opacity,defaultText:e.getName(r)},{normal:{align:g.textAlign,verticalAlign:g.verticalAlign}});var w=c.getModel("label"),I=w.get("color"),E=I==="inherit"?y:null;n.setTextConfig({local:!0,inside:!!g.inside,insideStroke:E,outsideFill:E});var D=g.linePoints;o.setShape({points:D}),n.textGuideLineConfig={anchor:D?new er(D[0][0],D[0][1]):null},yn(s,{style:{x:g.x,y:g.y}},a,r),s.attr({rotation:g.rotation,originX:g.x,originY:g.y,z2:10}),E3(n,D3(c),{stroke:y})},t}(gl),SDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.ignoreLabelLineUpdate=!0,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this._data,a=this.group;o.diff(s).add(function(c){var f=new wDt(o,c);o.setItemGraphicEl(c,f),a.add(f)}).update(function(c,f){var g=s.getItemGraphicEl(f);g.updateData(o,c),a.add(g),o.setItemGraphicEl(c,g)}).remove(function(c){var f=s.getItemGraphicEl(c);Id(f,e,c)}).execute(),this._data=o},t.prototype.remove=function(){this.group.removeAll(),this._data=null},t.prototype.dispose=function(){},t.type="funnel",t}(ga);const TDt=SDt;var ADt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new J0(Si(this.getData,this),Si(this.getRawData,this)),this._defaultLabelLine(e)},t.prototype.getInitialData=function(e,r){return K0(this,{coordDimensions:["value"],encodeDefaulter:br(s3,this)})},t.prototype._defaultLabelLine=function(e){mv(e,"labelLine",["show"]);var r=e.labelLine,n=e.emphasis.labelLine;r.show=r.show&&e.label.show,n.show=n.show&&e.emphasis.label.show},t.prototype.getDataParams=function(e){var r=this.getData(),n=i.prototype.getDataParams.call(this,e),o=r.mapDimension("value"),s=r.getSum(o);return n.percent=s?+(r.get(o,e)/s*100).toFixed(2):0,n.$vars.push("percent"),n},t.type="series.funnel",t.defaultOption={coordinateSystemUsage:"box",z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:65,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:ye.color.neutral00,borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:ye.color.primary}}},t}(Ea);const IDt=ADt;function CDt(i,t){for(var e=i.mapDimension("value"),r=i.mapArray(e,function(c){return c}),n=[],o=t==="ascending",s=0,a=i.count();s<a;s++)n[s]=s;return Xi(t)?n.sort(t):t!=="none"&&n.sort(function(c,f){return o?r[c]-r[f]:r[f]-r[c]}),n}function MDt(i){var t=i.hostModel,e=t.get("orient");i.each(function(r){var n=i.getItemModel(r),o=n.getModel("label"),s=o.get("position"),a=n.getModel("labelLine"),c=i.getItemLayout(r),f=c.points,g=s==="inner"||s==="inside"||s==="center"||s==="insideLeft"||s==="insideRight",v,y,w,I;if(g)s==="insideLeft"?(y=(f[0][0]+f[3][0])/2+5,w=(f[0][1]+f[3][1])/2,v="left"):s==="insideRight"?(y=(f[1][0]+f[2][0])/2-5,w=(f[1][1]+f[2][1])/2,v="right"):(y=(f[0][0]+f[1][0]+f[2][0]+f[3][0])/4,w=(f[0][1]+f[1][1]+f[2][1]+f[3][1])/4,v="center"),I=[[y,w],[y,w]];else{var E=void 0,D=void 0,R=void 0,z=void 0,N=a.get("length");s==="left"?(E=(f[3][0]+f[0][0])/2,D=(f[3][1]+f[0][1])/2,R=E-N,y=R-5,v="right"):s==="right"?(E=(f[1][0]+f[2][0])/2,D=(f[1][1]+f[2][1])/2,R=E+N,y=R+5,v="left"):s==="top"?(E=(f[3][0]+f[0][0])/2,D=(f[3][1]+f[0][1])/2,z=D-N,w=z-5,v="center"):s==="bottom"?(E=(f[1][0]+f[2][0])/2,D=(f[1][1]+f[2][1])/2,z=D+N,w=z+5,v="center"):s==="rightTop"?(E=e==="horizontal"?f[3][0]:f[1][0],D=e==="horizontal"?f[3][1]:f[1][1],e==="horizontal"?(z=D-N,w=z-5,v="center"):(R=E+N,y=R+5,v="top")):s==="rightBottom"?(E=f[2][0],D=f[2][1],e==="horizontal"?(z=D+N,w=z+5,v="center"):(R=E+N,y=R+5,v="bottom")):s==="leftTop"?(E=f[0][0],D=e==="horizontal"?f[0][1]:f[1][1],e==="horizontal"?(z=D-N,w=z-5,v="center"):(R=E-N,y=R-5,v="right")):s==="leftBottom"?(E=e==="horizontal"?f[1][0]:f[3][0],D=e==="horizontal"?f[1][1]:f[2][1],e==="horizontal"?(z=D+N,w=z+5,v="center"):(R=E-N,y=R-5,v="right")):(E=(f[1][0]+f[2][0])/2,D=(f[1][1]+f[2][1])/2,e==="horizontal"?(z=D+N,w=z+5,v="center"):(R=E+N,y=R+5,v="left")),e==="horizontal"?(R=E,y=R):(z=D,w=z),I=[[E,D],[R,z]]}c.label={linePoints:I,x:y,y:w,verticalAlign:"middle",textAlign:v,inside:g}})}function EDt(i,t){i.eachSeriesByType("funnel",function(e){var r=e.getData(),n=r.mapDimension("value"),o=e.get("sort"),s=No(e,t),a=Ma(e.getBoxLayoutParams(),s.refContainer),c=e.get("orient"),f=a.width,g=a.height,v=CDt(r,o),y=a.x,w=a.y,I=c==="horizontal"?[xi(e.get("minSize"),g),xi(e.get("maxSize"),g)]:[xi(e.get("minSize"),f),xi(e.get("maxSize"),f)],E=r.getDataExtent(n),D=e.get("min"),R=e.get("max");D==null&&(D=Math.min(E[0],0)),R==null&&(R=E[1]);var z=e.get("funnelAlign"),N=e.get("gap"),H=c==="horizontal"?f:g,q=(H-N*(r.count()-1))/r.count(),Y=function(Et,bt){if(c==="horizontal"){var Vt=r.get(n,Et)||0,zt=Rn(Vt,[D,R],I,!0),Jt=void 0;switch(z){case"top":Jt=w;break;case"center":Jt=w+(g-zt)/2;break;case"bottom":Jt=w+(g-zt);break}return[[bt,Jt],[bt,Jt+zt]]}var ce=r.get(n,Et)||0,be=Rn(ce,[D,R],I,!0),ve;switch(z){case"left":ve=y;break;case"center":ve=y+(f-be)/2;break;case"right":ve=y+f-be;break}return[[ve,bt],[ve+be,bt]]};o==="ascending"&&(q=-q,N=-N,c==="horizontal"?y+=f:w+=g,v=v.reverse());for(var J=0;J<v.length;J++){var it=v[J],at=v[J+1],ut=r.getItemModel(it);if(c==="horizontal"){var ft=ut.get(["itemStyle","width"]);ft==null?ft=q:(ft=xi(ft,f),o==="ascending"&&(ft=-ft));var _t=Y(it,y),ct=Y(at,y+ft);y+=ft+N,r.setItemLayout(it,{points:_t.concat(ct.slice().reverse())})}else{var Dt=ut.get(["itemStyle","height"]);Dt==null?Dt=q:(Dt=xi(Dt,g),o==="ascending"&&(Dt=-Dt));var _t=Y(it,w),ct=Y(at,w+Dt);w+=Dt+N,r.setItemLayout(it,{points:_t.concat(ct.slice().reverse())})}}MDt(r)})}function DDt(i){i.registerChartView(TDt),i.registerSeriesModel(IDt),i.registerLayout(EDt),i.registerProcessor(Y0("funnel"))}var PDt=.3,LDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._dataGroup=new Ki,e._initialized=!1,e}return t.prototype.init=function(){this.group.add(this._dataGroup)},t.prototype.render=function(e,r,n,o){this._progressiveEls=null;var s=this._dataGroup,a=e.getData(),c=this._data,f=e.coordinateSystem,g=f.dimensions,v=q$(e);a.diff(c).add(y).update(w).remove(I).execute();function y(D){var R=Z$(a,s,D,g,f);rk(R,a,D,v)}function w(D,R){var z=c.getItemGraphicEl(R),N=pit(a,D,g,f);a.setItemGraphicEl(D,z),yn(z,{shape:{points:N}},e,D),zu(z),rk(z,a,D,v)}function I(D){var R=c.getItemGraphicEl(D);s.remove(R)}if(!this._initialized){this._initialized=!0;var E=RDt(f,e,function(){setTimeout(function(){s.removeClipPath()})});s.setClipPath(E)}this._data=a},t.prototype.incrementalPrepareRender=function(e,r,n){this._initialized=!0,this._data=null,this._dataGroup.removeAll()},t.prototype.incrementalRender=function(e,r,n){for(var o=r.getData(),s=r.coordinateSystem,a=s.dimensions,c=q$(r),f=this._progressiveEls=[],g=e.start;g<e.end;g++){var v=Z$(o,this._dataGroup,g,a,s);v.incremental=!0,rk(v,o,g,c),f.push(v)}},t.prototype.remove=function(){this._dataGroup&&this._dataGroup.removeAll(),this._data=null},t.type="parallel",t}(ga);function RDt(i,t,e){var r=i.model,n=i.getRect(),o=new jr({shape:{x:n.x,y:n.y,width:n.width,height:n.height}}),s=r.get("layout")==="horizontal"?"width":"height";return o.setShape(s,0),xa(o,{shape:{width:n.width,height:n.height}},t,e),o}function pit(i,t,e,r){for(var n=[],o=0;o<e.length;o++){var s=e[o],a=i.get(i.mapDimension(s),t);kDt(a,r.getAxis(s).type)||n.push(r.dataToPoint(a,s))}return n}function Z$(i,t,e,r,n){var o=pit(i,e,r,n),s=new Us({shape:{points:o},z2:10});return t.add(s),i.setItemGraphicEl(e,s),s}function q$(i){var t=i.get("smooth",!0);return t===!0&&(t=PDt),t=kd(t),Bs(t)&&(t=0),{smooth:t}}function rk(i,t,e,r){i.useStyle(t.getItemVisual(e,"style")),i.style.fill=null,i.setShape("smooth",r.smooth);var n=t.getItemModel(e),o=n.getModel("emphasis");Bo(i,n,"lineStyle"),Ca(i,o.get("focus"),o.get("blurScope"),o.get("disabled"))}function kDt(i,t){return t==="category"?i==null:i==null||isNaN(i)}const ODt=LDt;var zDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="lineStyle",e.visualDrawType="stroke",e}return t.prototype.getInitialData=function(e,r){return $d(null,this,{useEncodeDefaulter:Si(BDt,null,this)})},t.prototype.getRawIndicesByActiveState=function(e){var r=this.coordinateSystem,n=this.getData(),o=[];return r.eachActiveState(n,function(s,a){e===s&&o.push(n.getRawIndex(a))}),o},t.type="series.parallel",t.dependencies=["parallel"],t.defaultOption={z:2,coordinateSystem:"parallel",parallelIndex:0,label:{show:!1},inactiveOpacity:.05,activeOpacity:1,lineStyle:{width:1,opacity:.45,type:"solid"},emphasis:{label:{show:!1}},progressive:500,smooth:!1,animationEasing:"linear"},t}(Ea);function BDt(i){var t=i.ecModel.getComponent("parallel",i.get("parallelIndex"));if(t){var e={};return pt(t.dimensions,function(r){var n=FDt(r);e[r]=n}),e}}function FDt(i){return+i.replace("dim","")}const NDt=zDt;var VDt=["lineStyle","opacity"],UDt={seriesType:"parallel",reset:function(i,t){var e=i.coordinateSystem,r={normal:i.get(["lineStyle","opacity"]),active:i.get("activeOpacity"),inactive:i.get("inactiveOpacity")};return{progress:function(n,o){e.eachActiveState(o,function(s,a){var c=r[s];if(s==="normal"&&o.hasItemOption){var f=o.getItemModel(a).get(VDt,!0);f!=null&&(c=f)}var g=o.ensureUniqueItemVisual(a,"style");g.opacity=c},n.start,n.end)}}}};const GDt=UDt;function HDt(i){jDt(i),WDt(i)}function jDt(i){if(!i.parallel){var t=!1;pt(i.series,function(e){e&&e.type==="parallel"&&(t=!0)}),t&&(i.parallel=[{}])}}function WDt(i){var t=aa(i.parallelAxis);pt(t,function(e){if(nr(e)){var r=e.parallelIndex||0,n=aa(i.parallel)[r];n&&n.parallelAxisDefault&&Er(e,n.parallelAxisDefault,!1)}})}var $Dt=5,ZDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){this._model=e,this._api=n,this._handlers||(this._handlers={},pt(qDt,function(o,s){n.getZr().on(s,this._handlers[s]=Si(o,this))},this)),Z0(this,"_throttledDispatchExpand",e.get("axisExpandRate"),"fixRate")},t.prototype.dispose=function(e,r){cS(this,"_throttledDispatchExpand"),pt(this._handlers,function(n,o){r.getZr().off(o,n)}),this._handlers=null},t.prototype._throttledDispatchExpand=function(e){this._dispatchExpand(e)},t.prototype._dispatchExpand=function(e){e&&this._api.dispatchAction(Ne({type:"parallelAxisExpand"},e))},t.type="parallel",t}(Oa),qDt={mousedown:function(i){nk(this,"click")&&(this._mouseDownPoint=[i.offsetX,i.offsetY])},mouseup:function(i){var t=this._mouseDownPoint;if(nk(this,"click")&&t){var e=[i.offsetX,i.offsetY],r=Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2);if(r>$Dt)return;var n=this._model.coordinateSystem.getSlidedAxisExpandWindow([i.offsetX,i.offsetY]);n.behavior!=="none"&&this._dispatchExpand({axisExpandWindow:n.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(i){if(!(this._mouseDownPoint||!nk(this,"mousemove"))){var t=this._model,e=t.coordinateSystem.getSlidedAxisExpandWindow([i.offsetX,i.offsetY]),r=e.behavior;r==="jump"&&this._throttledDispatchExpand.debounceNextCall(t.get("axisExpandDebounce")),this._throttledDispatchExpand(r==="none"?null:{axisExpandWindow:e.axisExpandWindow,animation:r==="jump"?null:{duration:0}})}}};function nk(i,t){var e=i._model;return e.get("axisExpandable")&&e.get("axisExpandTriggerOn")===t}const XDt=ZDt;var YDt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){i.prototype.init.apply(this,arguments),this.mergeOption({})},t.prototype.mergeOption=function(e){var r=this.option;e&&Er(r,e,!0),this._initDimensions()},t.prototype.contains=function(e,r){var n=e.get("parallelIndex");return n!=null&&r.getComponent("parallel",n)===this},t.prototype.setAxisExpand=function(e){pt(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(r){e.hasOwnProperty(r)&&(this.option[r]=e[r])},this)},t.prototype._initDimensions=function(){var e=this.dimensions=[],r=this.parallelAxisIndex=[],n=kn(this.ecModel.queryComponents({mainType:"parallelAxis"}),function(o){return(o.get("parallelIndex")||0)===this.componentIndex},this);pt(n,function(o){e.push("dim"+o.get("dim")),r.push(o.componentIndex)})},t.type="parallel",t.dependencies=["parallelAxis"],t.layoutMode="box",t.defaultOption={z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},t}(gn);const KDt=YDt;var JDt=function(i){Se(t,i);function t(e,r,n,o,s){var a=i.call(this,e,r,n)||this;return a.type=o||"value",a.axisIndex=s,a}return t.prototype.isHorizontal=function(){return this.coordinateSystem.getModel().get("layout")!=="horizontal"},t}(Sc);const QDt=JDt;function Np(i,t,e,r,n,o){i=i||0;var s=e[1]-e[0];if(n!=null&&(n=zy(n,[0,s])),o!=null&&(o=Math.max(o,n??0)),r==="all"){var a=Math.abs(t[1]-t[0]);a=zy(a,[0,s]),n=o=zy(a,[n,o]),r=0}t[0]=zy(t[0],e),t[1]=zy(t[1],e);var c=ak(t,r);t[r]+=i;var f=n||0,g=e.slice();c.sign<0?g[0]+=f:g[1]-=f,t[r]=zy(t[r],g);var v;return v=ak(t,r),n!=null&&(v.sign!==c.sign||v.span<n)&&(t[1-r]=t[r]+c.sign*n),v=ak(t,r),o!=null&&v.span>o&&(t[1-r]=t[r]+v.sign*o),t}function ak(i,t){var e=i[t]-i[1-t];return{span:Math.abs(e),sign:e>0?-1:e<0?1:t?-1:1}}function zy(i,t){return Math.min(t[1]!=null?t[1]:1/0,Math.max(t[0]!=null?t[0]:-1/0,i))}var ok=pt,git=Math.min,mit=Math.max,X$=Math.floor,tPt=Math.ceil,Y$=xo,ePt=Math.PI,iPt=function(){function i(t,e,r){this.type="parallel",this._axesMap=Fi(),this._axesLayout={},this.dimensions=t.dimensions,this._model=t,this._init(t,e,r)}return i.prototype._init=function(t,e,r){var n=t.dimensions,o=t.parallelAxisIndex;ok(n,function(s,a){var c=o[a],f=e.getComponent("parallelAxis",c),g=this._axesMap.set(s,new QDt(s,AE(f),[0,0],f.get("type"),c)),v=g.type==="category";g.onBand=v&&f.get("boundaryGap"),g.inverse=f.get("inverse"),f.axis=g,g.model=f,g.coordinateSystem=f.coordinateSystem=this},this)},i.prototype.update=function(t,e){this._updateAxesFromSeries(this._model,t)},i.prototype.containPoint=function(t){var e=this._makeLayoutInfo(),r=e.axisBase,n=e.layoutBase,o=e.pixelDimIndex,s=t[1-o],a=t[o];return s>=r&&s<=r+e.axisLength&&a>=n&&a<=n+e.layoutLength},i.prototype.getModel=function(){return this._model},i.prototype._updateAxesFromSeries=function(t,e){e.eachSeries(function(r){if(t.contains(r,e)){var n=r.getData();ok(this.dimensions,function(o){var s=this._axesMap.get(o);s.scale.unionExtentFromData(n,n.mapDimension(o)),I0(s.scale,s.model)},this)}},this)},i.prototype.resize=function(t,e){var r=No(t,e).refContainer;this._rect=Ma(t.getBoxLayoutParams(),r),this._layoutAxes()},i.prototype.getRect=function(){return this._rect},i.prototype._makeLayoutInfo=function(){var t=this._model,e=this._rect,r=["x","y"],n=["width","height"],o=t.get("layout"),s=o==="horizontal"?0:1,a=e[n[s]],c=[0,a],f=this.dimensions.length,g=aI(t.get("axisExpandWidth"),c),v=aI(t.get("axisExpandCount")||0,[0,f]),y=t.get("axisExpandable")&&f>3&&f>v&&v>1&&g>0&&a>0,w=t.get("axisExpandWindow"),I;if(w)I=aI(w[1]-w[0],c),w[1]=w[0]+I;else{I=aI(g*(v-1),c);var E=t.get("axisExpandCenter")||X$(f/2);w=[g*E-I/2],w[1]=w[0]+I}var D=(a-I)/(f-v);D<3&&(D=0);var R=[X$(Y$(w[0]/g,1))+1,tPt(Y$(w[1]/g,1))-1],z=D/g*w[0];return{layout:o,pixelDimIndex:s,layoutBase:e[r[s]],layoutLength:a,axisBase:e[r[1-s]],axisLength:e[n[1-s]],axisExpandable:y,axisExpandWidth:g,axisCollapseWidth:D,axisExpandWindow:w,axisCount:f,winInnerIndices:R,axisExpandWindow0Pos:z}},i.prototype._layoutAxes=function(){var t=this._rect,e=this._axesMap,r=this.dimensions,n=this._makeLayoutInfo(),o=n.layout;e.each(function(s){var a=[0,n.axisLength],c=s.inverse?1:0;s.setExtent(a[c],a[1-c])}),ok(r,function(s,a){var c=(n.axisExpandable?nPt:rPt)(a,n),f={horizontal:{x:c.position,y:n.axisLength},vertical:{x:0,y:c.position}},g={horizontal:ePt/2,vertical:0},v=[f[o].x+t.x,f[o].y+t.y],y=g[o],w=as();jp(w,w,y),bh(w,w,v),this._axesLayout[s]={position:v,rotation:y,transform:w,axisNameAvailableWidth:c.axisNameAvailableWidth,axisLabelShow:c.axisLabelShow,nameTruncateMaxWidth:c.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}},this)},i.prototype.getAxis=function(t){return this._axesMap.get(t)},i.prototype.dataToPoint=function(t,e){return this.axisCoordToPoint(this._axesMap.get(e).dataToCoord(t),e)},i.prototype.eachActiveState=function(t,e,r,n){r==null&&(r=0),n==null&&(n=t.count());var o=this._axesMap,s=this.dimensions,a=[],c=[];pt(s,function(D){a.push(t.mapDimension(D)),c.push(o.get(D).model)});for(var f=this.hasAxisBrushed(),g=r;g<n;g++){var v=void 0;if(!f)v="normal";else{v="active";for(var y=t.getValues(a,g),w=0,I=s.length;w<I;w++){var E=c[w].getActiveState(y[w]);if(E==="inactive"){v="inactive";break}}}e(v,g)}},i.prototype.hasAxisBrushed=function(){for(var t=this.dimensions,e=this._axesMap,r=!1,n=0,o=t.length;n<o;n++)e.get(t[n]).model.getActiveState()!=="normal"&&(r=!0);return r},i.prototype.axisCoordToPoint=function(t,e){var r=this._axesLayout[e];return pc([t,0],r.transform)},i.prototype.getAxisLayout=function(t){return Yi(this._axesLayout[t])},i.prototype.getSlidedAxisExpandWindow=function(t){var e=this._makeLayoutInfo(),r=e.pixelDimIndex,n=e.axisExpandWindow.slice(),o=n[1]-n[0],s=[0,e.axisExpandWidth*(e.axisCount-1)];if(!this.containPoint(t))return{behavior:"none",axisExpandWindow:n};var a=t[r]-e.layoutBase-e.axisExpandWindow0Pos,c,f="slide",g=e.axisCollapseWidth,v=this._model.get("axisExpandSlideTriggerArea"),y=v[0]!=null;if(g)y&&g&&a<o*v[0]?(f="jump",c=a-o*v[2]):y&&g&&a>o*(1-v[0])?(f="jump",c=a-o*(1-v[2])):(c=a-o*v[1])>=0&&(c=a-o*(1-v[1]))<=0&&(c=0),c*=e.axisExpandWidth/g,c?Np(c,n,s,"all"):f="none";else{var w=n[1]-n[0],I=s[1]*a/w;n=[mit(0,I-w/2)],n[1]=git(s[1],n[0]+w),n[0]=n[1]-w}return{axisExpandWindow:n,behavior:f}},i}();function aI(i,t){return git(mit(i,t[0]),t[1])}function rPt(i,t){var e=t.layoutLength/(t.axisCount-1);return{position:e*i,axisNameAvailableWidth:e,axisLabelShow:!0}}function nPt(i,t){var e=t.layoutLength,r=t.axisExpandWidth,n=t.axisCount,o=t.axisCollapseWidth,s=t.winInnerIndices,a,c=o,f=!1,g;return i<s[0]?(a=i*o,g=o):i<=s[1]?(a=t.axisExpandWindow0Pos+i*r-t.axisExpandWindow[0],c=r,f=!0):(a=e-(n-1-i)*o,g=o),{position:a,axisNameAvailableWidth:c,axisLabelShow:f,nameTruncateMaxWidth:g}}const aPt=iPt;function oPt(i,t){var e=[];return i.eachComponent("parallel",function(r,n){var o=new aPt(r,i,t);o.name="parallel_"+n,o.resize(r,t),r.coordinateSystem=o,o.model=r,e.push(o)}),i.eachSeries(function(r){if(r.get("coordinateSystem")==="parallel"){var n=r.getReferringComponents("parallel",Wa).models[0];r.coordinateSystem=n.coordinateSystem}}),e}var sPt={create:oPt};const lPt=sPt;var vit=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.activeIntervals=[],e}return t.prototype.getAreaSelectStyle=function(){return _v([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},t.prototype.setActiveIntervals=function(e){var r=this.activeIntervals=Yi(e);if(r)for(var n=r.length-1;n>=0;n--)Pu(r[n])},t.prototype.getActiveState=function(e){var r=this.activeIntervals;if(!r.length)return"normal";if(e==null||isNaN(+e))return"inactive";if(r.length===1){var n=r[0];if(n[0]<=e&&e<=n[1])return"active"}else for(var o=0,s=r.length;o<s;o++)if(r[o][0]<=e&&e<=r[o][1])return"active";return"inactive"},t}(gn);Ao(vit,ZS);const K$=vit;var Sv=!0,TS=Math.min,P0=Math.max,uPt=Math.pow,cPt=1e4,hPt=6,dPt=6,J$="globalPan",fPt={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},pPt={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},Q$={brushStyle:{lineWidth:2,stroke:ye.color.backgroundTint,fill:ye.color.borderTint},transformable:!0,brushMode:"single",removeOnClick:!1},gPt=0,mPt=function(i){Se(t,i);function t(e){var r=i.call(this)||this;return r._track=[],r._covers=[],r._handlers={},r._zr=e,r.group=new Ki,r._uid="brushController_"+gPt++,pt(SPt,function(n,o){this._handlers[o]=Si(n,this)},r),r}return t.prototype.enableBrush=function(e){return this._brushType&&this._doDisableBrush(),e.brushType&&this._doEnableBrush(e),this},t.prototype._doEnableBrush=function(e){var r=this._zr;this._enableGlobalPan||mCt(r,J$,this._uid),pt(this._handlers,function(n,o){r.on(o,n)}),this._brushType=e.brushType,this._brushOption=Er(Yi(Q$),e,!0)},t.prototype._doDisableBrush=function(){var e=this._zr;vCt(e,J$,this._uid),pt(this._handlers,function(r,n){e.off(n,r)}),this._brushType=this._brushOption=null},t.prototype.setPanels=function(e){if(e&&e.length){var r=this._panels={};pt(e,function(n){r[n.panelId]=Yi(n)})}else this._panels=null;return this},t.prototype.mount=function(e){e=e||{},this._enableGlobalPan=e.enableGlobalPan;var r=this.group;return this._zr.add(r),r.attr({x:e.x||0,y:e.y||0,rotation:e.rotation||0,scaleX:e.scaleX||1,scaleY:e.scaleY||1}),this._transform=r.getLocalTransform(),this},t.prototype.updateCovers=function(e){e=ti(e,function(y){return Er(Yi(Q$),y,!0)});var r="\0-brush-index-",n=this._covers,o=this._covers=[],s=this,a=this._creatingCover;return new Bd(n,e,f,c).add(g).update(g).remove(v).execute(),this;function c(y,w){return(y.id!=null?y.id:r+w)+"-"+y.brushType}function f(y,w){return c(y.__brushOption,w)}function g(y,w){var I=e[y];if(w!=null&&n[w]===a)o[y]=n[w];else{var E=o[y]=w!=null?(n[w].__brushOption=I,n[w]):yit(s,_it(s,I));rN(s,E)}}function v(y){n[y]!==a&&s.group.remove(n[y])}},t.prototype.unmount=function(){return this.enableBrush(!1),aB(this),this._zr.remove(this.group),this},t.prototype.dispose=function(){this.unmount(),this.off()},t}(Bu);function _it(i,t){var e=kE[t.brushType].createCover(i,t);return e.__brushOption=t,bit(e,t),i.group.add(e),e}function yit(i,t){var e=nN(t);return e.endCreating&&(e.endCreating(i,t),bit(t,t.__brushOption)),t}function xit(i,t){var e=t.__brushOption;nN(t).updateCoverShape(i,t,e.range,e)}function bit(i,t){var e=t.z;e==null&&(e=cPt),i.traverse(function(r){r.z=e,r.z2=e})}function rN(i,t){nN(t).updateCommon(i,t),xit(i,t)}function nN(i){return kE[i.__brushOption.brushType]}function aN(i,t,e){var r=i._panels;if(!r)return Sv;var n,o=i._transform;return pt(r,function(s){s.isTargetByCursor(t,e,o)&&(n=s)}),n}function wit(i,t){var e=i._panels;if(!e)return Sv;var r=t.__brushOption.panelId;return r!=null?e[r]:Sv}function aB(i){var t=i._covers,e=t.length;return pt(t,function(r){i.group.remove(r)},i),t.length=0,!!e}function Tv(i,t){var e=ti(i._covers,function(r){var n=r.__brushOption,o=Yi(n.range);return{brushType:n.brushType,panelId:n.panelId,range:o}});i.trigger("brush",{areas:e,isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function vPt(i){var t=i._track;if(!t.length)return!1;var e=t[t.length-1],r=t[0],n=e[0]-r[0],o=e[1]-r[1],s=uPt(n*n+o*o,.5);return s>hPt}function Sit(i){var t=i.length-1;return t<0&&(t=0),[i[0],i[t]]}function Tit(i,t,e,r){var n=new Ki;return n.add(new jr({name:"main",style:oN(e),silent:!0,draggable:!0,cursor:"move",drift:br(tZ,i,t,n,["n","s","w","e"]),ondragend:br(Tv,t,{isEnd:!0})})),pt(r,function(o){n.add(new jr({name:o.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:br(tZ,i,t,n,o),ondragend:br(Tv,t,{isEnd:!0})}))}),n}function Ait(i,t,e,r){var n=r.brushStyle.lineWidth||0,o=P0(n,dPt),s=e[0][0],a=e[1][0],c=s-n/2,f=a-n/2,g=e[0][1],v=e[1][1],y=g-o+n/2,w=v-o+n/2,I=g-s,E=v-a,D=I+n,R=E+n;ad(i,t,"main",s,a,I,E),r.transformable&&(ad(i,t,"w",c,f,o,R),ad(i,t,"e",y,f,o,R),ad(i,t,"n",c,f,D,o),ad(i,t,"s",c,w,D,o),ad(i,t,"nw",c,f,o,o),ad(i,t,"ne",y,f,o,o),ad(i,t,"sw",c,w,o,o),ad(i,t,"se",y,w,o,o))}function oB(i,t){var e=t.__brushOption,r=e.transformable,n=t.childAt(0);n.useStyle(oN(e)),n.attr({silent:!r,cursor:r?"move":"default"}),pt([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(o){var s=t.childOfName(o.join("")),a=o.length===1?sB(i,o[0]):yPt(i,o);s&&s.attr({silent:!r,invisible:!r,cursor:r?pPt[a]+"-resize":null})})}function ad(i,t,e,r,n,o,s){var a=t.childOfName(e);a&&a.setShape(bPt(sN(i,t,[[r,n],[r+o,n+s]])))}function oN(i){return rr({strokeNoScale:!0},i.brushStyle)}function Iit(i,t,e,r){var n=[TS(i,e),TS(t,r)],o=[P0(i,e),P0(t,r)];return[[n[0],o[0]],[n[1],o[1]]]}function _Pt(i){return uv(i.group)}function sB(i,t){var e={w:"left",e:"right",n:"top",s:"bottom"},r={left:"w",right:"e",top:"n",bottom:"s"},n=gE(e[t],_Pt(i));return r[n]}function yPt(i,t){var e=[sB(i,t[0]),sB(i,t[1])];return(e[0]==="e"||e[0]==="w")&&e.reverse(),e.join("")}function tZ(i,t,e,r,n,o){var s=e.__brushOption,a=i.toRectRange(s.range),c=Cit(t,n,o);pt(r,function(f){var g=fPt[f];a[g[0]][g[1]]+=c[g[0]]}),s.range=i.fromRectRange(Iit(a[0][0],a[1][0],a[0][1],a[1][1])),rN(t,e),Tv(t,{isEnd:!1})}function xPt(i,t,e,r){var n=t.__brushOption.range,o=Cit(i,e,r);pt(n,function(s){s[0]+=o[0],s[1]+=o[1]}),rN(i,t),Tv(i,{isEnd:!1})}function Cit(i,t,e){var r=i.group,n=r.transformCoordToLocal(t,e),o=r.transformCoordToLocal(0,0);return[n[0]-o[0],n[1]-o[1]]}function sN(i,t,e){var r=wit(i,t);return r&&r!==Sv?r.clipPath(e,i._transform):Yi(e)}function bPt(i){var t=TS(i[0][0],i[1][0]),e=TS(i[0][1],i[1][1]),r=P0(i[0][0],i[1][0]),n=P0(i[0][1],i[1][1]);return{x:t,y:e,width:r-t,height:n-e}}function wPt(i,t,e){if(!(!i._brushType||TPt(i,t.offsetX,t.offsetY))){var r=i._zr,n=i._covers,o=aN(i,t,e);if(!i._dragging)for(var s=0;s<n.length;s++){var a=n[s].__brushOption;if(o&&(o===Sv||a.panelId===o.panelId)&&kE[a.brushType].contain(n[s],e[0],e[1]))return}o&&r.setCursorStyle("crosshair")}}function lB(i){var t=i.event;t.preventDefault&&t.preventDefault()}function uB(i,t,e){return i.childOfName("main").contain(t,e)}function Mit(i,t,e,r){var n=i._creatingCover,o=i._creatingPanel,s=i._brushOption,a;if(i._track.push(e.slice()),vPt(i)||n){if(o&&!n){s.brushMode==="single"&&aB(i);var c=Yi(s);c.brushType=eZ(c.brushType,o),c.panelId=o===Sv?null:o.panelId,n=i._creatingCover=_it(i,c),i._covers.push(n)}if(n){var f=kE[eZ(i._brushType,o)],g=n.__brushOption;g.range=f.getCreatingRange(sN(i,n,i._track)),r&&(yit(i,n),f.updateCommon(i,n)),xit(i,n),a={isEnd:r}}}else r&&s.brushMode==="single"&&s.removeOnClick&&aN(i,t,e)&&aB(i)&&(a={isEnd:r,removeOnClick:!0});return a}function eZ(i,t){return i==="auto"?t.defaultBrushType:i}var SPt={mousedown:function(i){if(this._dragging)iZ(this,i);else if(!i.target||!i.target.draggable){lB(i);var t=this.group.transformCoordToLocal(i.offsetX,i.offsetY);this._creatingCover=null;var e=this._creatingPanel=aN(this,i,t);e&&(this._dragging=!0,this._track=[t.slice()])}},mousemove:function(i){var t=i.offsetX,e=i.offsetY,r=this.group.transformCoordToLocal(t,e);if(wPt(this,i,r),this._dragging){lB(i);var n=Mit(this,i,r,!1);n&&Tv(this,n)}},mouseup:function(i){iZ(this,i)}};function iZ(i,t){if(i._dragging){lB(t);var e=t.offsetX,r=t.offsetY,n=i.group.transformCoordToLocal(e,r),o=Mit(i,t,n,!0);i._dragging=!1,i._track=[],i._creatingCover=null,o&&Tv(i,o)}}function TPt(i,t,e){var r=i._zr;return t<0||t>r.getWidth()||e<0||e>r.getHeight()}var kE={lineX:rZ(0),lineY:rZ(1),rect:{createCover:function(i,t){function e(r){return r}return Tit({toRectRange:e,fromRectRange:e},i,t,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(i){var t=Sit(i);return Iit(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(i,t,e,r){Ait(i,t,e,r)},updateCommon:oB,contain:uB},polygon:{createCover:function(i,t){var e=new Ki;return e.add(new Us({name:"main",style:oN(t),silent:!0})),e},getCreatingRange:function(i){return i},endCreating:function(i,t){t.remove(t.childAt(0)),t.add(new gl({name:"main",draggable:!0,drift:br(xPt,i,t),ondragend:br(Tv,i,{isEnd:!0})}))},updateCoverShape:function(i,t,e,r){t.childAt(0).setShape({points:sN(i,t,e)})},updateCommon:oB,contain:uB}};function rZ(i){return{createCover:function(t,e){return Tit({toRectRange:function(r){var n=[r,[0,100]];return i&&n.reverse(),n},fromRectRange:function(r){return r[i]}},t,e,[[["w"],["e"]],[["n"],["s"]]][i])},getCreatingRange:function(t){var e=Sit(t),r=TS(e[0][i],e[1][i]),n=P0(e[0][i],e[1][i]);return[r,n]},updateCoverShape:function(t,e,r,n){var o,s=wit(t,e);if(s!==Sv&&s.getLinearBrushOtherExtent)o=s.getLinearBrushOtherExtent(i);else{var a=t._zr;o=[0,[a.getWidth(),a.getHeight()][1-i]]}var c=[r,o];i&&c.reverse(),Ait(t,e,c,n)},updateCommon:oB,contain:uB}}const lN=mPt;function Eit(i){return i=uN(i),function(t){return rJ(t,i)}}function Dit(i,t){return i=uN(i),function(e){var r=t??e,n=r?i.width:i.height,o=r?i.x:i.y;return[o,o+(n||0)]}}function Pit(i,t,e){var r=uN(i);return function(n,o){return r.contain(o[0],o[1])&&!ket(n,t,e)}}function uN(i){return sr.create(i)}var APt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){i.prototype.init.apply(this,arguments),(this._brushController=new lN(r.getZr())).on("brush",Si(this._onBrush,this))},t.prototype.render=function(e,r,n,o){if(!IPt(e,r,o)){this.axisModel=e,this.api=n,this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new Ki,this.group.add(this._axisGroup),!!e.get("show")){var a=MPt(e,r),c=a.coordinateSystem,f=e.getAreaSelectStyle(),g=f.width,v=e.axis.dim,y=c.getAxisLayout(v),w=Ne({strokeContainThreshold:g},y),I=new Fd(e,n,w);I.build(),this._axisGroup.add(I.group),this._refreshBrushController(w,f,e,a,g,n),VS(s,this._axisGroup,e)}}},t.prototype._refreshBrushController=function(e,r,n,o,s,a){var c=n.axis.getExtent(),f=c[1]-c[0],g=Math.min(30,Math.abs(f)*.1),v=sr.create({x:c[0],y:-s/2,width:f,height:s});v.x-=g,v.width+=2*g,this._brushController.mount({enableGlobalPan:!0,rotation:e.rotation,x:e.position[0],y:e.position[1]}).setPanels([{panelId:"pl",clipPath:Eit(v),isTargetByCursor:Pit(v,a,o),getLinearBrushOtherExtent:Dit(v,0)}]).enableBrush({brushType:"lineX",brushStyle:r,removeOnClick:!0}).updateCovers(CPt(n))},t.prototype._onBrush=function(e){var r=e.areas,n=this.axisModel,o=n.axis,s=ti(r,function(a){return[o.coordToData(a.range[0],!0),o.coordToData(a.range[1],!0)]});(!n.option.realtime===e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:n.id,intervals:s})},t.prototype.dispose=function(){this._brushController.dispose()},t.type="parallelAxis",t}(Oa);function IPt(i,t,e){return e&&e.type==="axisAreaSelect"&&t.findComponents({mainType:"parallelAxis",query:e})[0]===i}function CPt(i){var t=i.axis;return ti(i.activeIntervals,function(e){return{brushType:"lineX",panelId:"pl",range:[t.dataToCoord(e[0],!0),t.dataToCoord(e[1],!0)]}})}function MPt(i,t){return t.getComponent("parallel",i.get("parallelIndex"))}const EPt=APt;var DPt={type:"axisAreaSelect",event:"axisAreaSelected"};function PPt(i){i.registerAction(DPt,function(t,e){e.eachComponent({mainType:"parallelAxis",query:t},function(r){r.axis.model.setActiveIntervals(t.intervals)})}),i.registerAction("parallelAxisExpand",function(t,e){e.eachComponent({mainType:"parallel",query:t},function(r){r.setAxisExpand(t)})})}var LPt={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10};function Lit(i){i.registerComponentView(XDt),i.registerComponentModel(KDt),i.registerCoordinateSystem("parallel",lPt),i.registerPreprocessor(HDt),i.registerComponentModel(K$),i.registerComponentView(EPt),E0(i,"parallel",K$,LPt),PPt(i)}function RPt(i){Rr(Lit),i.registerChartView(ODt),i.registerSeriesModel(NDt),i.registerVisual(i.PRIORITY.VISUAL.BRUSH,GDt)}var kPt=function(){function i(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0}return i}(),OPt=function(i){Se(t,i);function t(e){return i.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new kPt},t.prototype.buildPath=function(e,r){var n=r.extent;e.moveTo(r.x1,r.y1),e.bezierCurveTo(r.cpx1,r.cpy1,r.cpx2,r.cpy2,r.x2,r.y2),r.orient==="vertical"?(e.lineTo(r.x2+n,r.y2),e.bezierCurveTo(r.cpx2+n,r.cpy2,r.cpx1+n,r.cpy1,r.x1+n,r.y1)):(e.lineTo(r.x2,r.y2+n),e.bezierCurveTo(r.cpx2,r.cpy2+n,r.cpx1,r.cpy1+n,r.x1,r.y1+n)),e.closePath()},t.prototype.highlight=function(){Od(this)},t.prototype.downplay=function(){zd(this)},t}(qr),zPt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._mainGroup=new Ki,e._focusAdjacencyDisabled=!1,e}return t.prototype.init=function(e,r){this._controller=new Bv(r.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},t.prototype.render=function(e,r,n){var o=this,s=e.getGraph(),a=this._mainGroup,c=e.layoutInfo,f=c.width,g=c.height,v=e.getData(),y=e.getData("edge"),w=e.get("orient");this._model=e,a.removeAll(),a.x=c.x,a.y=c.y,this._updateViewCoordSys(e,n),Oet(e,n,a,this._controller,this._controllerHost,null),s.eachEdge(function(I){var E=new OPt,D=cr(E);D.dataIndex=I.dataIndex,D.seriesIndex=e.seriesIndex,D.dataType="edge";var R=I.getModel(),z=R.getModel("lineStyle"),N=z.get("curveness"),H=I.node1.getLayout(),q=I.node1.getModel(),Y=q.get("localX"),J=q.get("localY"),it=I.node2.getLayout(),at=I.node2.getModel(),ut=at.get("localX"),ft=at.get("localY"),_t=I.getLayout(),ct,Dt,Et,bt,Vt,zt,Jt,ce;E.shape.extent=Math.max(1,_t.dy),E.shape.orient=w,w==="vertical"?(ct=(Y!=null?Y*f:H.x)+_t.sy,Dt=(J!=null?J*g:H.y)+H.dy,Et=(ut!=null?ut*f:it.x)+_t.ty,bt=ft!=null?ft*g:it.y,Vt=ct,zt=Dt*(1-N)+bt*N,Jt=Et,ce=Dt*N+bt*(1-N)):(ct=(Y!=null?Y*f:H.x)+H.dx,Dt=(J!=null?J*g:H.y)+_t.sy,Et=ut!=null?ut*f:it.x,bt=(ft!=null?ft*g:it.y)+_t.ty,Vt=ct*(1-N)+Et*N,zt=Dt,Jt=ct*N+Et*(1-N),ce=bt),E.setShape({x1:ct,y1:Dt,x2:Et,y2:bt,cpx1:Vt,cpy1:zt,cpx2:Jt,cpy2:ce}),E.useStyle(z.getItemStyle()),nZ(E.style,w,I);var be=""+R.get("value"),ve=Fo(R,"edgeLabel");Xo(E,ve,{labelFetcher:{getFormattedLabel:function(bi,or,Ue,Ze,xe,Ke){return e.getFormattedLabel(bi,or,"edge",Ze,iu(xe,ve.normal&&ve.normal.get("formatter"),be),Ke)}},labelDataIndex:I.dataIndex,defaultText:be}),E.setTextConfig({position:"inside"});var ke=R.getModel("emphasis");Bo(E,R,"lineStyle",function(bi){var or=bi.getItemStyle();return nZ(or,w,I),or}),a.add(E),y.setItemGraphicEl(I.dataIndex,E);var ni=ke.get("focus");Ca(E,ni==="adjacency"?I.getAdjacentDataIndices():ni==="trajectory"?I.getTrajectoryDataIndices():ni,ke.get("blurScope"),ke.get("disabled"))}),s.eachNode(function(I){var E=I.getLayout(),D=I.getModel(),R=D.get("localX"),z=D.get("localY"),N=D.getModel("emphasis"),H=D.get(["itemStyle","borderRadius"])||0,q=new jr({shape:{x:R!=null?R*f:E.x,y:z!=null?z*g:E.y,width:E.dx,height:E.dy,r:H},style:D.getModel("itemStyle").getItemStyle(),z2:10});Xo(q,Fo(D),{labelFetcher:{getFormattedLabel:function(J,it){return e.getFormattedLabel(J,it,"node")}},labelDataIndex:I.dataIndex,defaultText:I.id}),q.disableLabelAnimation=!0,q.setStyle("fill",I.getVisual("color")),q.setStyle("decal",I.getVisual("style").decal),Bo(q,D),a.add(q),v.setItemGraphicEl(I.dataIndex,q),cr(q).dataType="node";var Y=N.get("focus");Ca(q,Y==="adjacency"?I.getAdjacentDataIndices():Y==="trajectory"?I.getTrajectoryDataIndices():Y,N.get("blurScope"),N.get("disabled"))}),v.eachItemGraphicEl(function(I,E){var D=v.getItemModel(E);D.get("draggable")&&(I.drift=function(R,z){o._focusAdjacencyDisabled=!0,this.shape.x+=R,this.shape.y+=z,this.dirty(),n.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:v.getRawIndex(E),localX:this.shape.x/f,localY:this.shape.y/g})},I.ondragend=function(){o._focusAdjacencyDisabled=!1},I.draggable=!0,I.cursor="move")}),!this._data&&e.isAnimationEnabled()&&a.setClipPath(BPt(a.getBoundingRect(),e,function(){a.removeClipPath()})),this._data=e.getData()},t.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},t.prototype._updateViewCoordSys=function(e,r){var n=e.layoutInfo,o=n.width,s=n.height,a=e.coordinateSystem=new Fv(null,{api:r,ecModel:e.ecModel});a.zoomLimit=e.get("scaleLimit"),a.setBoundingRect(0,0,o,s),a.setCenter(e.get("center")),a.setZoom(e.get("zoom")),this._controllerHost.target.attr({x:a.x,y:a.y,scaleX:a.scaleX,scaleY:a.scaleY})},t.type="sankey",t}(ga);function nZ(i,t,e){switch(i.fill){case"source":i.fill=e.node1.getVisual("color"),i.decal=e.node1.getVisual("style").decal;break;case"target":i.fill=e.node2.getVisual("color"),i.decal=e.node2.getVisual("style").decal;break;case"gradient":var r=e.node1.getVisual("color"),n=e.node2.getVisual("color");wi(r)&&wi(n)&&(i.fill=new U0(0,0,+(t==="horizontal"),+(t==="vertical"),[{color:r,offset:0},{color:n,offset:1}]))}}function BPt(i,t,e){var r=new jr({shape:{x:i.x-10,y:i.y-10,width:0,height:i.height+20}});return xa(r,{shape:{width:i.width+20}},t,e),r}const FPt=zPt;var NPt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,r){var n=e.edges||e.links||[],o=e.data||e.nodes||[],s=e.levels||[];this.levelModels=[];for(var a=this.levelModels,c=0;c<s.length;c++)s[c].depth!=null&&s[c].depth>=0&&(a[s[c].depth]=new bn(s[c],this,r));var f=iN(o,n,this,!0,g);return f.data;function g(v,y){v.wrapMethod("getItemModel",function(w,I){var E=w.parentModel,D=E.getData().getItemLayout(I);if(D){var R=D.depth,z=E.levelModels[R];z&&(w.parentModel=z)}return w}),y.wrapMethod("getItemModel",function(w,I){var E=w.parentModel,D=E.getGraph().getEdgeByIndex(I),R=D.node1.getLayout();if(R){var z=R.depth,N=E.levelModels[z];N&&(w.parentModel=N)}return w})}},t.prototype.setNodePosition=function(e,r){var n=this.option.data||this.option.nodes,o=n[e];o.localX=r[0],o.localY=r[1]},t.prototype.setCenter=function(e){this.option.center=e},t.prototype.setZoom=function(e){this.option.zoom=e},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,r,n){function o(w){return isNaN(w)||w==null}if(n==="edge"){var s=this.getDataParams(e,n),a=s.data,c=s.value,f=a.source+" -- "+a.target;return So("nameValue",{name:f,value:c,noValue:o(c)})}else{var g=this.getGraph().getNodeByIndex(e),v=g.getLayout().value,y=this.getDataParams(e,n).data.name;return So("nameValue",{name:y!=null?y+"":null,value:v,noValue:o(v)})}},t.prototype.optionUpdated=function(){},t.prototype.getDataParams=function(e,r){var n=i.prototype.getDataParams.call(this,e,r);if(n.value==null&&r==="node"){var o=this.getGraph().getNodeByIndex(e),s=o.getLayout().value;n.value=s}return n},t.type="series.sankey",t.layoutMode="box",t.defaultOption={z:2,coordinateSystemUsage:"box",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,roam:!1,roamTrigger:"global",center:null,zoom:1,label:{show:!0,position:"right",fontSize:12},edgeLabel:{show:!1,fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:ye.color.neutral50,opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:ye.color.primary}},animationEasing:"linear",animationDuration:1e3},t}(Ea);const VPt=NPt;function UPt(i,t){i.eachSeriesByType("sankey",function(e){var r=e.get("nodeWidth"),n=e.get("nodeGap"),o=No(e,t).refContainer,s=Ma(e.getBoxLayoutParams(),o);e.layoutInfo=s;var a=s.width,c=s.height,f=e.getGraph(),g=f.nodes,v=f.edges;HPt(g);var y=kn(g,function(D){return D.getLayout().value===0}),w=y.length!==0?0:e.get("layoutIterations"),I=e.get("orient"),E=e.get("nodeAlign");GPt(g,v,r,n,a,c,w,I,E)})}function GPt(i,t,e,r,n,o,s,a,c){jPt(i,t,e,n,o,a,c),qPt(i,t,o,n,r,s,a),rLt(i,a)}function HPt(i){pt(i,function(t){var e=Ep(t.outEdges,gM),r=Ep(t.inEdges,gM),n=t.getValue()||0,o=Math.max(e,r,n);t.setLayout({value:o},!0)})}function jPt(i,t,e,r,n,o,s){for(var a=[],c=[],f=[],g=[],v=0,y=0;y<t.length;y++)a[y]=1;for(var y=0;y<i.length;y++)c[y]=i[y].inEdges.length,c[y]===0&&f.push(i[y]);for(var w=-1;f.length;){for(var I=0;I<f.length;I++){var E=f[I],D=E.hostGraph.data.getRawDataItem(E.dataIndex),R=D.depth!=null&&D.depth>=0;R&&D.depth>w&&(w=D.depth),E.setLayout({depth:R?D.depth:v},!0),o==="vertical"?E.setLayout({dy:e},!0):E.setLayout({dx:e},!0);for(var z=0;z<E.outEdges.length;z++){var N=E.outEdges[z],H=t.indexOf(N);a[H]=0;var q=N.node2,Y=i.indexOf(q);--c[Y]===0&&g.indexOf(q)<0&&g.push(q)}}++v,f=g,g=[]}for(var y=0;y<a.length;y++)if(a[y]===1)throw new Error("Sankey is a DAG, the original data has cycle!");var J=w>v-1?w:v-1;s&&s!=="left"&&WPt(i,s,o,J);var it=o==="vertical"?(n-e)/J:(r-e)/J;ZPt(i,it,o)}function Rit(i){var t=i.hostGraph.data.getRawDataItem(i.dataIndex);return t.depth!=null&&t.depth>=0}function WPt(i,t,e,r){if(t==="right"){for(var n=[],o=i,s=0;o.length;){for(var a=0;a<o.length;a++){var c=o[a];c.setLayout({skNodeHeight:s},!0);for(var f=0;f<c.inEdges.length;f++){var g=c.inEdges[f];n.indexOf(g.node1)<0&&n.push(g.node1)}}o=n,n=[],++s}pt(i,function(v){Rit(v)||v.setLayout({depth:Math.max(0,r-v.getLayout().skNodeHeight)},!0)})}else t==="justify"&&$Pt(i,r)}function $Pt(i,t){pt(i,function(e){!Rit(e)&&!e.outEdges.length&&e.setLayout({depth:t},!0)})}function ZPt(i,t,e){pt(i,function(r){var n=r.getLayout().depth*t;e==="vertical"?r.setLayout({y:n},!0):r.setLayout({x:n},!0)})}function qPt(i,t,e,r,n,o,s){var a=XPt(i,s);YPt(a,t,e,r,n,s),sk(a,n,e,r,s);for(var c=1;o>0;o--)c*=.99,KPt(a,c,s),sk(a,n,e,r,s),iLt(a,c,s),sk(a,n,e,r,s)}function XPt(i,t){var e=[],r=t==="vertical"?"y":"x",n=YO(i,function(o){return o.getLayout()[r]});return n.keys.sort(function(o,s){return o-s}),pt(n.keys,function(o){e.push(n.buckets.get(o))}),e}function YPt(i,t,e,r,n,o){var s=1/0;pt(i,function(a){var c=a.length,f=0;pt(a,function(v){f+=v.getLayout().value});var g=o==="vertical"?(r-(c-1)*n)/f:(e-(c-1)*n)/f;g<s&&(s=g)}),pt(i,function(a){pt(a,function(c,f){var g=c.getLayout().value*s;o==="vertical"?(c.setLayout({x:f},!0),c.setLayout({dx:g},!0)):(c.setLayout({y:f},!0),c.setLayout({dy:g},!0))})}),pt(t,function(a){var c=+a.getValue()*s;a.setLayout({dy:c},!0)})}function sk(i,t,e,r,n){var o=n==="vertical"?"x":"y";pt(i,function(s){s.sort(function(E,D){return E.getLayout()[o]-D.getLayout()[o]});for(var a,c,f,g=0,v=s.length,y=n==="vertical"?"dx":"dy",w=0;w<v;w++)c=s[w],f=g-c.getLayout()[o],f>0&&(a=c.getLayout()[o]+f,n==="vertical"?c.setLayout({x:a},!0):c.setLayout({y:a},!0)),g=c.getLayout()[o]+c.getLayout()[y]+t;var I=n==="vertical"?r:e;if(f=g-t-I,f>0){a=c.getLayout()[o]-f,n==="vertical"?c.setLayout({x:a},!0):c.setLayout({y:a},!0),g=a;for(var w=v-2;w>=0;--w)c=s[w],f=c.getLayout()[o]+c.getLayout()[y]+t-g,f>0&&(a=c.getLayout()[o]-f,n==="vertical"?c.setLayout({x:a},!0):c.setLayout({y:a},!0)),g=c.getLayout()[o]}})}function KPt(i,t,e){pt(i.slice().reverse(),function(r){pt(r,function(n){if(n.outEdges.length){var o=Ep(n.outEdges,JPt,e)/Ep(n.outEdges,gM);if(isNaN(o)){var s=n.outEdges.length;o=s?Ep(n.outEdges,QPt,e)/s:0}if(e==="vertical"){var a=n.getLayout().x+(o-Vp(n,e))*t;n.setLayout({x:a},!0)}else{var c=n.getLayout().y+(o-Vp(n,e))*t;n.setLayout({y:c},!0)}}})})}function JPt(i,t){return Vp(i.node2,t)*i.getValue()}function QPt(i,t){return Vp(i.node2,t)}function tLt(i,t){return Vp(i.node1,t)*i.getValue()}function eLt(i,t){return Vp(i.node1,t)}function Vp(i,t){return t==="vertical"?i.getLayout().x+i.getLayout().dx/2:i.getLayout().y+i.getLayout().dy/2}function gM(i){return i.getValue()}function Ep(i,t,e){for(var r=0,n=i.length,o=-1;++o<n;){var s=+t(i[o],e);isNaN(s)||(r+=s)}return r}function iLt(i,t,e){pt(i,function(r){pt(r,function(n){if(n.inEdges.length){var o=Ep(n.inEdges,tLt,e)/Ep(n.inEdges,gM);if(isNaN(o)){var s=n.inEdges.length;o=s?Ep(n.inEdges,eLt,e)/s:0}if(e==="vertical"){var a=n.getLayout().x+(o-Vp(n,e))*t;n.setLayout({x:a},!0)}else{var c=n.getLayout().y+(o-Vp(n,e))*t;n.setLayout({y:c},!0)}}})})}function rLt(i,t){var e=t==="vertical"?"x":"y";pt(i,function(r){r.outEdges.sort(function(n,o){return n.node2.getLayout()[e]-o.node2.getLayout()[e]}),r.inEdges.sort(function(n,o){return n.node1.getLayout()[e]-o.node1.getLayout()[e]})}),pt(i,function(r){var n=0,o=0;pt(r.outEdges,function(s){s.setLayout({sy:n},!0),n+=s.getLayout().dy}),pt(r.inEdges,function(s){s.setLayout({ty:o},!0),o+=s.getLayout().dy})})}function nLt(i){i.eachSeriesByType("sankey",function(t){var e=t.getGraph(),r=e.nodes,n=e.edges;if(r.length){var o=1/0,s=-1/0;pt(r,function(a){var c=a.getLayout().value;c<o&&(o=c),c>s&&(s=c)}),pt(r,function(a){var c=new _s({type:"color",mappingMethod:"linear",dataExtent:[o,s],visual:t.get("color")}),f=c.mapValueToVisual(a.getLayout().value),g=a.getModel().get(["itemStyle","color"]);g!=null?(a.setVisual("color",g),a.setVisual("style",{fill:g})):(a.setVisual("color",f),a.setVisual("style",{fill:f}))})}n.length&&pt(n,function(a){var c=a.getModel().get("lineStyle");a.setVisual("style",c)})})}function aLt(i){i.registerChartView(FPt),i.registerSeriesModel(VPt),i.registerLayout(UPt),i.registerVisual(nLt),i.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(r){r.setNodePosition(t.dataIndex,[t.localX,t.localY])})}),i.registerAction({type:"sankeyRoam",event:"sankeyRoam",update:"none"},function(t,e,r){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(n){var o=n.coordinateSystem,s=DE(o,t,n.get("scaleLimit"));n.setCenter(s.center),n.setZoom(s.zoom)})})}var kit=function(){function i(){}return i.prototype._hasEncodeRule=function(t){var e=this.getEncode();return e&&e.get(t)!=null},i.prototype.getInitialData=function(t,e){var r,n=e.getComponent("xAxis",this.get("xAxisIndex")),o=e.getComponent("yAxis",this.get("yAxisIndex")),s=n.get("type"),a=o.get("type"),c;s==="category"?(t.layout="horizontal",r=n.getOrdinalMeta(),c=!this._hasEncodeRule("x")):a==="category"?(t.layout="vertical",r=o.getOrdinalMeta(),c=!this._hasEncodeRule("y")):t.layout=t.layout||"horizontal";var f=["x","y"],g=t.layout==="horizontal"?0:1,v=this._baseAxisDim=f[g],y=f[1-g],w=[n,o],I=w[g].get("type"),E=w[1-g].get("type"),D=t.data;if(D&&c){var R=[];pt(D,function(H,q){var Y;Ye(H)?(Y=H.slice(),H.unshift(q)):Ye(H.value)?(Y=Ne({},H),Y.value=Y.value.slice(),H.value.unshift(q)):Y=H,R.push(Y)}),t.data=R}var z=this.defaultValueDimensions,N=[{name:v,type:KC(I),ordinalMeta:r,otherDims:{tooltip:!1,itemName:0},dimsDef:["base"]},{name:y,type:KC(E),dimsDef:z.slice()}];return K0(this,{coordDimensions:N,dimensionsCount:z.length+1,encodeDefaulter:br(BJ,N,this)})},i.prototype.getBaseAxis=function(){var t=this._baseAxisDim;return this.ecModel.getComponent(t+"Axis",this.get(t+"AxisIndex")).axis},i}(),Oit=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"min",defaultTooltip:!0},{name:"Q1",defaultTooltip:!0},{name:"median",defaultTooltip:!0},{name:"Q3",defaultTooltip:!0},{name:"max",defaultTooltip:!0}],e.visualDrawType="stroke",e}return t.type="series.boxplot",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,boxWidth:[7,50],itemStyle:{color:ye.color.neutral00,borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2,shadowBlur:5,shadowOffsetX:1,shadowOffsetY:1,shadowColor:ye.color.shadow}},animationDuration:800},t}(Ea);Ao(Oit,kit,!0);const oLt=Oit;var sLt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this.group,a=this._data;this._data||s.removeAll();var c=e.get("layout")==="horizontal"?1:0;o.diff(a).add(function(f){if(o.hasValue(f)){var g=o.getItemLayout(f),v=aZ(g,o,f,c,!0);o.setItemGraphicEl(f,v),s.add(v)}}).update(function(f,g){var v=a.getItemGraphicEl(g);if(!o.hasValue(f)){s.remove(v);return}var y=o.getItemLayout(f);v?(zu(v),zit(y,v,o,f)):v=aZ(y,o,f,c),s.add(v),o.setItemGraphicEl(f,v)}).remove(function(f){var g=a.getItemGraphicEl(f);g&&s.remove(g)}).execute(),this._data=o},t.prototype.remove=function(e){var r=this.group,n=this._data;this._data=null,n&&n.eachItemGraphicEl(function(o){o&&r.remove(o)})},t.type="boxplot",t}(ga),lLt=function(){function i(){}return i}(),uLt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="boxplotBoxPath",r}return t.prototype.getDefaultShape=function(){return new lLt},t.prototype.buildPath=function(e,r){var n=r.points,o=0;for(e.moveTo(n[o][0],n[o][1]),o++;o<4;o++)e.lineTo(n[o][0],n[o][1]);for(e.closePath();o<n.length;o++)e.moveTo(n[o][0],n[o][1]),o++,e.lineTo(n[o][0],n[o][1])},t}(qr);function aZ(i,t,e,r,n){var o=i.ends,s=new uLt({shape:{points:n?cLt(o,r,i):o}});return zit(i,s,t,e,n),s}function zit(i,t,e,r,n){var o=e.hostModel,s=Ev[n?"initProps":"updateProps"];s(t,{shape:{points:i.ends}},o,r),t.useStyle(e.getItemVisual(r,"style")),t.style.strokeNoScale=!0,t.z2=100;var a=e.getItemModel(r),c=a.getModel("emphasis");Bo(t,a),Ca(t,c.get("focus"),c.get("blurScope"),c.get("disabled"))}function cLt(i,t,e){return ti(i,function(r){return r=r.slice(),r[t]=e.initBaseline,r})}const hLt=sLt;var kw=pt;function dLt(i){var t=fLt(i);kw(t,function(e){var r=e.seriesModels;r.length&&(pLt(e),kw(r,function(n,o){gLt(n,e.boxOffsetList[o],e.boxWidthList[o])}))})}function fLt(i){var t=[],e=[];return i.eachSeriesByType("boxplot",function(r){var n=r.getBaseAxis(),o=Ar(e,n);o<0&&(o=e.length,e[o]=n,t[o]={axis:n,seriesModels:[]}),t[o].seriesModels.push(r)}),t}function pLt(i){var t=i.axis,e=i.seriesModels,r=e.length,n=i.boxWidthList=[],o=i.boxOffsetList=[],s=[],a;if(t.type==="category")a=t.getBandWidth();else{var c=0;kw(e,function(I){c=Math.max(c,I.getData().count())});var f=t.getExtent();a=Math.abs(f[1]-f[0])/c}kw(e,function(I){var E=I.get("boxWidth");Ye(E)||(E=[E,E]),s.push([xi(E[0],a)||0,xi(E[1],a)||0])});var g=a*.8-2,v=g/r*.3,y=(g-v*(r-1))/r,w=y/2-g/2;kw(e,function(I,E){o.push(w),w+=v+y,n.push(Math.min(Math.max(y,s[E][0]),s[E][1]))})}function gLt(i,t,e){var r=i.coordinateSystem,n=i.getData(),o=e/2,s=i.get("layout")==="horizontal"?0:1,a=1-s,c=["x","y"],f=n.mapDimension(c[s]),g=n.mapDimensionsAll(c[a]);if(f==null||g.length<5)return;for(var v=0;v<n.count();v++){var y=n.get(f,v),w=N(y,g[2],v),I=N(y,g[0],v),E=N(y,g[1],v),D=N(y,g[3],v),R=N(y,g[4],v),z=[];H(z,E,!1),H(z,D,!0),z.push(I,E,R,D),q(z,I),q(z,R),q(z,w),n.setItemLayout(v,{initBaseline:w[a],ends:z})}function N(Y,J,it){var at=n.get(J,it),ut=[];ut[s]=Y,ut[a]=at;var ft;return isNaN(Y)||isNaN(at)?ft=[NaN,NaN]:(ft=r.dataToPoint(ut),ft[s]+=t),ft}function H(Y,J,it){var at=J.slice(),ut=J.slice();at[s]+=o,ut[s]-=o,it?Y.push(at,ut):Y.push(ut,at)}function q(Y,J){var it=J.slice(),at=J.slice();it[s]-=o,at[s]+=o,Y.push(it,at)}}function mLt(i,t){t=t||{};for(var e=[],r=[],n=t.boundIQR,o=n==="none"||n===0,s=0;s<i.length;s++){var a=Pu(i[s].slice()),c=zL(a,.25),f=zL(a,.5),g=zL(a,.75),v=a[0],y=a[a.length-1],w=(n??1.5)*(g-c),I=o?v:Math.max(v,c-w),E=o?y:Math.min(y,g+w),D=t.itemNameFormatter,R=Xi(D)?D({value:s}):wi(D)?D.replace("{value}",s+""):s+"";e.push([R,I,c,f,g,E]);for(var z=0;z<a.length;z++){var N=a[z];if(N<I||N>E){var H=[R,N];r.push(H)}}}return{boxData:e,outliers:r}}var vLt={type:"echarts:boxplot",transform:function(t){var e=t.upstream;if(e.sourceFormat!==ss){var r="";Pn(r)}var n=mLt(e.getRawData(),t.config);return[{dimensions:["ItemName","Low","Q1","Q2","Q3","High"],data:n.boxData},{data:n.outliers}]}};function _Lt(i){i.registerSeriesModel(oLt),i.registerChartView(hLt),i.registerLayout(dLt),i.registerTransform(vLt)}var yLt=["itemStyle","borderColor"],xLt=["itemStyle","borderColor0"],bLt=["itemStyle","borderColorDoji"],wLt=["itemStyle","color"],SLt=["itemStyle","color0"];function cN(i,t){return t.get(i>0?wLt:SLt)}function hN(i,t){return t.get(i===0?bLt:i>0?yLt:xLt)}var TLt={seriesType:"candlestick",plan:$0(),performRawSeries:!0,reset:function(i,t){if(!t.isSeriesFiltered(i)){var e=i.pipelineContext.large;return!e&&{progress:function(r,n){for(var o;(o=r.next())!=null;){var s=n.getItemModel(o),a=n.getItemLayout(o).sign,c=s.getItemStyle();c.fill=cN(a,s),c.stroke=hN(a,s)||c.fill;var f=n.ensureUniqueItemVisual(o,"style");Ne(f,c)}}}}}};const ALt=TLt;var ILt=["color","borderColor"],CLt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){this.group.removeClipPath(),this._progressiveEls=null,this._updateDrawMode(e),this._isLargeDraw?this._renderLarge(e):this._renderNormal(e)},t.prototype.incrementalPrepareRender=function(e,r,n){this._clear(),this._updateDrawMode(e)},t.prototype.incrementalRender=function(e,r,n,o){this._progressiveEls=[],this._isLargeDraw?this._incrementalRenderLarge(e,r):this._incrementalRenderNormal(e,r)},t.prototype.eachRendered=function(e){$p(this._progressiveEls||this.group,e)},t.prototype._updateDrawMode=function(e){var r=e.pipelineContext.large;(this._isLargeDraw==null||r!==this._isLargeDraw)&&(this._isLargeDraw=r,this._clear())},t.prototype._renderNormal=function(e){var r=e.getData(),n=this._data,o=this.group,s=r.getLayout("isSimpleBox"),a=e.get("clip",!0),c=e.coordinateSystem,f=c.getArea&&c.getArea();this._data||o.removeAll(),r.diff(n).add(function(g){if(r.hasValue(g)){var v=r.getItemLayout(g);if(a&&oZ(f,v))return;var y=lk(v,g,!0);xa(y,{shape:{points:v.ends}},e,g),uk(y,r,g,s),o.add(y),r.setItemGraphicEl(g,y)}}).update(function(g,v){var y=n.getItemGraphicEl(v);if(!r.hasValue(g)){o.remove(y);return}var w=r.getItemLayout(g);if(a&&oZ(f,w)){o.remove(y);return}y?(yn(y,{shape:{points:w.ends}},e,g),zu(y)):y=lk(w),uk(y,r,g,s),o.add(y),r.setItemGraphicEl(g,y)}).remove(function(g){var v=n.getItemGraphicEl(g);v&&o.remove(v)}).execute(),this._data=r},t.prototype._renderLarge=function(e){this._clear(),sZ(e,this.group);var r=e.get("clip",!0)?YS(e.coordinateSystem,!1,e):null;r?this.group.setClipPath(r):this.group.removeClipPath()},t.prototype._incrementalRenderNormal=function(e,r){for(var n=r.getData(),o=n.getLayout("isSimpleBox"),s;(s=e.next())!=null;){var a=n.getItemLayout(s),c=lk(a);uk(c,n,s,o),c.incremental=!0,this.group.add(c),this._progressiveEls.push(c)}},t.prototype._incrementalRenderLarge=function(e,r){sZ(r,this.group,this._progressiveEls,!0)},t.prototype.remove=function(e){this._clear()},t.prototype._clear=function(){this.group.removeAll(),this._data=null},t.type="candlestick",t}(ga),MLt=function(){function i(){}return i}(),ELt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="normalCandlestickBox",r}return t.prototype.getDefaultShape=function(){return new MLt},t.prototype.buildPath=function(e,r){var n=r.points;this.__simpleBox?(e.moveTo(n[4][0],n[4][1]),e.lineTo(n[6][0],n[6][1])):(e.moveTo(n[0][0],n[0][1]),e.lineTo(n[1][0],n[1][1]),e.lineTo(n[2][0],n[2][1]),e.lineTo(n[3][0],n[3][1]),e.closePath(),e.moveTo(n[4][0],n[4][1]),e.lineTo(n[5][0],n[5][1]),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[7][0],n[7][1]))},t}(qr);function lk(i,t,e){var r=i.ends;return new ELt({shape:{points:e?DLt(r,i):r},z2:100})}function oZ(i,t){for(var e=!0,r=0;r<t.ends.length;r++)if(i.contain(t.ends[r][0],t.ends[r][1])){e=!1;break}return e}function uk(i,t,e,r){var n=t.getItemModel(e);i.useStyle(t.getItemVisual(e,"style")),i.style.strokeNoScale=!0,i.__simpleBox=r,Bo(i,n);var o=t.getItemLayout(e).sign;pt(i.states,function(a,c){var f=n.getModel(c),g=cN(o,f),v=hN(o,f)||g,y=a.style||(a.style={});g&&(y.fill=g),v&&(y.stroke=v)});var s=n.getModel("emphasis");Ca(i,s.get("focus"),s.get("blurScope"),s.get("disabled"))}function DLt(i,t){return ti(i,function(e){return e=e.slice(),e[1]=t.initBaseline,e})}var PLt=function(){function i(){}return i}(),ck=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r.type="largeCandlestickBox",r}return t.prototype.getDefaultShape=function(){return new PLt},t.prototype.buildPath=function(e,r){for(var n=r.points,o=0;o<n.length;)if(this.__sign===n[o++]){var s=n[o++];e.moveTo(s,n[o++]),e.lineTo(s,n[o++])}else o+=3},t}(qr);function sZ(i,t,e,r){var n=i.getData(),o=n.getLayout("largePoints"),s=new ck({shape:{points:o},__sign:1,ignoreCoarsePointer:!0});t.add(s);var a=new ck({shape:{points:o},__sign:-1,ignoreCoarsePointer:!0});t.add(a);var c=new ck({shape:{points:o},__sign:0,ignoreCoarsePointer:!0});t.add(c),hk(1,s,i),hk(-1,a,i),hk(0,c,i),r&&(s.incremental=!0,a.incremental=!0),e&&e.push(s,a)}function hk(i,t,e,r){var n=hN(i,e)||cN(i,e),o=e.getModel("itemStyle").getItemStyle(ILt);t.useStyle(o),t.style.fill=null,t.style.stroke=n}const LLt=CLt;var Bit=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],e}return t.prototype.getShadowDim=function(){return"open"},t.prototype.brushSelector=function(e,r,n){var o=r.getItemLayout(e);return o&&n.rect(o.brushRect)},t.type="series.candlestick",t.dependencies=["xAxis","yAxis","grid"],t.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderColorDoji:null,borderWidth:1},emphasis:{itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},t}(Ea);Ao(Bit,kit,!0);const RLt=Bit;function kLt(i){!i||!Ye(i.series)||pt(i.series,function(t){nr(t)&&t.type==="k"&&(t.type="candlestick")})}var OLt={seriesType:"candlestick",plan:$0(),reset:function(i){var t=i.coordinateSystem,e=i.getData(),r=zLt(i,e),n=0,o=1,s=["x","y"],a=e.getDimensionIndex(e.mapDimension(s[n])),c=ti(e.mapDimensionsAll(s[o]),e.getDimensionIndex,e),f=c[0],g=c[1],v=c[2],y=c[3];if(e.setLayout({candleWidth:r,isSimpleBox:r<=1.3}),a<0||c.length<4)return;return{progress:i.pipelineContext.large?I:w};function w(E,D){for(var R,z=D.getStore();(R=E.next())!=null;){var N=z.get(a,R),H=z.get(f,R),q=z.get(g,R),Y=z.get(v,R),J=z.get(y,R),it=Math.min(H,q),at=Math.max(H,q),ut=Vt(it,N),ft=Vt(at,N),_t=Vt(Y,N),ct=Vt(J,N),Dt=[];zt(Dt,ft,0),zt(Dt,ut,1),Dt.push(ce(ct),ce(ft),ce(_t),ce(ut));var Et=D.getItemModel(R),bt=!!Et.get(["itemStyle","borderColorDoji"]);D.setItemLayout(R,{sign:lZ(z,R,H,q,g,bt),initBaseline:H>q?ft[o]:ut[o],ends:Dt,brushRect:Jt(Y,J,N)})}function Vt(be,ve){var ke=[];return ke[n]=ve,ke[o]=be,isNaN(ve)||isNaN(be)?[NaN,NaN]:t.dataToPoint(ke)}function zt(be,ve,ke){var ni=ve.slice(),bi=ve.slice();ni[n]=YI(ni[n]+r/2,1,!1),bi[n]=YI(bi[n]-r/2,1,!0),ke?be.push(ni,bi):be.push(bi,ni)}function Jt(be,ve,ke){var ni=Vt(be,ke),bi=Vt(ve,ke);return ni[n]-=r/2,bi[n]-=r/2,{x:ni[0],y:ni[1],width:r,height:bi[1]-ni[1]}}function ce(be){return be[n]=YI(be[n],1),be}}function I(E,D){for(var R=ch(E.count*4),z=0,N,H=[],q=[],Y,J=D.getStore(),it=!!i.get(["itemStyle","borderColorDoji"]);(Y=E.next())!=null;){var at=J.get(a,Y),ut=J.get(f,Y),ft=J.get(g,Y),_t=J.get(v,Y),ct=J.get(y,Y);if(isNaN(at)||isNaN(_t)||isNaN(ct)){R[z++]=NaN,z+=3;continue}R[z++]=lZ(J,Y,ut,ft,g,it),H[n]=at,H[o]=_t,N=t.dataToPoint(H,null,q),R[z++]=N?N[0]:NaN,R[z++]=N?N[1]:NaN,H[o]=ct,N=t.dataToPoint(H,null,q),R[z++]=N?N[1]:NaN}D.setLayout("largePoints",R)}}};function lZ(i,t,e,r,n,o){var s;return e>r?s=-1:e<r?s=1:s=o?0:t>0?i.get(n,t-1)<=r?1:-1:1,s}function zLt(i,t){var e=i.getBaseAxis(),r,n=e.type==="category"?e.getBandWidth():(r=e.getExtent(),Math.abs(r[1]-r[0])/t.count()),o=xi(Ui(i.get("barMaxWidth"),n),n),s=xi(Ui(i.get("barMinWidth"),1),n),a=i.get("barWidth");return a!=null?xi(a,n):Math.max(Math.min(n/2,o),s)}const BLt=OLt;function FLt(i){i.registerChartView(LLt),i.registerSeriesModel(RLt),i.registerPreprocessor(kLt),i.registerVisual(ALt),i.registerLayout(BLt)}function uZ(i,t){var e=t.rippleEffectColor||t.color;i.eachChild(function(r){r.attr({z:t.z,zlevel:t.zlevel,style:{stroke:t.brushType==="stroke"?e:null,fill:t.brushType==="fill"?e:null}})})}var NLt=function(i){Se(t,i);function t(e,r){var n=i.call(this)||this,o=new qS(e,r),s=new Ki;return n.add(o),n.add(s),n.updateData(e,r),n}return t.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},t.prototype.startEffectAnimation=function(e){for(var r=e.symbolType,n=e.color,o=e.rippleNumber,s=this.childAt(1),a=0;a<o;a++){var c=To(r,-1,-1,2,2,n);c.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var f=-a/o*e.period+e.effectOffset;c.animate("",!0).when(e.period,{scaleX:e.rippleScale/2,scaleY:e.rippleScale/2}).delay(f).start(),c.animateStyle(!0).when(e.period,{opacity:0}).delay(f).start(),s.add(c)}uZ(s,e)},t.prototype.updateEffectAnimation=function(e){for(var r=this._effectCfg,n=this.childAt(1),o=["symbolType","period","rippleScale","rippleNumber"],s=0;s<o.length;s++){var a=o[s];if(r[a]!==e[a]){this.stopEffectAnimation(),this.startEffectAnimation(e);return}}uZ(n,e)},t.prototype.highlight=function(){Od(this)},t.prototype.downplay=function(){zd(this)},t.prototype.getSymbolType=function(){var e=this.childAt(0);return e&&e.getSymbolType()},t.prototype.updateData=function(e,r){var n=this,o=e.hostModel;this.childAt(0).updateData(e,r);var s=this.childAt(1),a=e.getItemModel(r),c=e.getItemVisual(r,"symbol"),f=q0(e.getItemVisual(r,"symbolSize")),g=e.getItemVisual(r,"style"),v=g&&g.fill,y=a.getModel("emphasis");s.setScale(f),s.traverse(function(D){D.setStyle("fill",v)});var w=Rv(e.getItemVisual(r,"symbolOffset"),f);w&&(s.x=w[0],s.y=w[1]);var I=e.getItemVisual(r,"symbolRotate");s.rotation=(I||0)*Math.PI/180||0;var E={};E.showEffectOn=o.get("showEffectOn"),E.rippleScale=a.get(["rippleEffect","scale"]),E.brushType=a.get(["rippleEffect","brushType"]),E.period=a.get(["rippleEffect","period"])*1e3,E.effectOffset=r/e.count(),E.z=o.getShallow("z")||0,E.zlevel=o.getShallow("zlevel")||0,E.symbolType=c,E.color=v,E.rippleEffectColor=a.get(["rippleEffect","color"]),E.rippleNumber=a.get(["rippleEffect","number"]),E.showEffectOn==="render"?(this._effectCfg?this.updateEffectAnimation(E):this.startEffectAnimation(E),this._effectCfg=E):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(D){D==="emphasis"?E.showEffectOn!=="render"&&n.startEffectAnimation(E):D==="normal"&&E.showEffectOn!=="render"&&n.stopEffectAnimation()}),this._effectCfg=E,Ca(this,y.get("focus"),y.get("blurScope"),y.get("disabled"))},t.prototype.fadeOut=function(e){e&&e()},t}(Ki);const VLt=NLt;var ULt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this._symbolDraw=new XS(VLt)},t.prototype.render=function(e,r,n){var o=e.getData(),s=this._symbolDraw;s.updateData(o,{clipShape:this._getClipShape(e)}),this.group.add(s.group)},t.prototype._getClipShape=function(e){var r=e.coordinateSystem,n=r&&r.getArea&&r.getArea();return e.get("clip",!0)?n:null},t.prototype.updateTransform=function(e,r,n){var o=e.getData();this.group.dirty();var s=KS("").reset(e,r,n);s.progress&&s.progress({start:0,end:o.count(),count:o.count()},o),this._symbolDraw.updateLayout()},t.prototype._updateGroupTransform=function(e){var r=e.coordinateSystem;r&&r.getRoamTransform&&(this.group.transform=d_t(r.getRoamTransform()),this.group.decomposeTransform())},t.prototype.remove=function(e,r){this._symbolDraw&&this._symbolDraw.remove(!0)},t.type="effectScatter",t}(ga);const GLt=ULt;var HLt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e}return t.prototype.getInitialData=function(e,r){return $d(null,this,{useEncodeDefaulter:!0})},t.prototype.brushSelector=function(e,r,n){return n.point(r.getItemLayout(e))},t.type="series.effectScatter",t.dependencies=["grid","polar"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill",number:3},universalTransition:{divideShape:"clone"},symbolSize:10},t}(Ea);const jLt=HLt;function WLt(i){i.registerChartView(GLt),i.registerSeriesModel(jLt),i.registerLayout(KS("effectScatter"))}var $Lt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this)||this;return o.add(o.createLine(e,r,n)),o._updateEffectSymbol(e,r),o}return t.prototype.createLine=function(e,r,n){return new tN(e,r,n)},t.prototype._updateEffectSymbol=function(e,r){var n=e.getItemModel(r),o=n.getModel("effect"),s=o.get("symbolSize"),a=o.get("symbol");Ye(s)||(s=[s,s]);var c=e.getItemVisual(r,"style"),f=o.get("color")||c&&c.stroke,g=this.childAt(1);this._symbolType!==a&&(this.remove(g),g=To(a,-.5,-.5,1,1,f),g.z2=100,g.culling=!0,this.add(g)),g&&(g.setStyle("shadowColor",f),g.setStyle(o.getItemStyle(["color"])),g.scaleX=s[0],g.scaleY=s[1],g.setColor(f),this._symbolType=a,this._symbolScale=s,this._updateEffectAnimation(e,o,r))},t.prototype._updateEffectAnimation=function(e,r,n){var o=this.childAt(1);if(o){var s=e.getItemLayout(n),a=r.get("period")*1e3,c=r.get("loop"),f=r.get("roundTrip"),g=r.get("constantSpeed"),v=vs(r.get("delay"),function(w){return w/e.count()*a/3});if(o.ignore=!0,this._updateAnimationPoints(o,s),g>0&&(a=this._getLineLength(o)/g*1e3),a!==this._period||c!==this._loop||f!==this._roundTrip){o.stopAnimation();var y=void 0;Xi(v)?y=v(n):y=v,o.__t>0&&(y=-a*o.__t),this._animateSymbol(o,a,y,c,f)}this._period=a,this._loop=c,this._roundTrip=f}},t.prototype._animateSymbol=function(e,r,n,o,s){if(r>0){e.__t=0;var a=this,c=e.animate("",o).when(s?r*2:r,{__t:s?2:1}).delay(n).during(function(){a._updateSymbolPosition(e)});o||c.done(function(){a.remove(e)}),c.start()}},t.prototype._getLineLength=function(e){return dp(e.__p1,e.__cp1)+dp(e.__cp1,e.__p2)},t.prototype._updateAnimationPoints=function(e,r){e.__p1=r[0],e.__p2=r[1],e.__cp1=r[2]||[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2]},t.prototype.updateData=function(e,r,n){this.childAt(0).updateData(e,r,n),this._updateEffectSymbol(e,r)},t.prototype._updateSymbolPosition=function(e){var r=e.__p1,n=e.__p2,o=e.__cp1,s=e.__t<1?e.__t:2-e.__t,a=[e.x,e.y],c=a.slice(),f=rs,g=OO;a[0]=f(r[0],o[0],n[0],s),a[1]=f(r[1],o[1],n[1],s);var v=e.__t<1?g(r[0],o[0],n[0],s):g(n[0],o[0],r[0],1-s),y=e.__t<1?g(r[1],o[1],n[1],s):g(n[1],o[1],r[1],1-s);e.rotation=-Math.atan2(y,v)-Math.PI/2,(this._symbolType==="line"||this._symbolType==="rect"||this._symbolType==="roundRect")&&(e.__lastT!==void 0&&e.__lastT<e.__t?(e.scaleY=dp(c,a)*1.05,s===1&&(a[0]=c[0]+(a[0]-c[0])/2,a[1]=c[1]+(a[1]-c[1])/2)):e.__lastT===1?e.scaleY=2*dp(r,a):e.scaleY=this._symbolScale[1]),e.__lastT=e.__t,e.ignore=!1,e.x=a[0],e.y=a[1]},t.prototype.updateLayout=function(e,r){this.childAt(0).updateLayout(e,r);var n=e.getItemModel(r).getModel("effect");this._updateEffectAnimation(e,n,r)},t}(Ki);const Fit=$Lt;var ZLt=function(i){Se(t,i);function t(e,r,n){var o=i.call(this)||this;return o._createPolyline(e,r,n),o}return t.prototype._createPolyline=function(e,r,n){var o=e.getItemLayout(r),s=new Us({shape:{points:o}});this.add(s),this._updateCommonStl(e,r,n)},t.prototype.updateData=function(e,r,n){var o=e.hostModel,s=this.childAt(0),a={shape:{points:e.getItemLayout(r)}};yn(s,a,o,r),this._updateCommonStl(e,r,n)},t.prototype._updateCommonStl=function(e,r,n){var o=this.childAt(0),s=e.getItemModel(r),a=n&&n.emphasisLineStyle,c=n&&n.focus,f=n&&n.blurScope,g=n&&n.emphasisDisabled;if(!n||e.hasItemOption){var v=s.getModel("emphasis");a=v.getModel("lineStyle").getLineStyle(),g=v.get("disabled"),c=v.get("focus"),f=v.get("blurScope")}o.useStyle(e.getItemVisual(r,"style")),o.style.fill=null,o.style.strokeNoScale=!0;var y=o.ensureState("emphasis");y.style=a,Ca(this,c,f,g)},t.prototype.updateLayout=function(e,r){var n=this.childAt(0);n.setShape("points",e.getItemLayout(r))},t}(Ki);const Nit=ZLt;var qLt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._lastFrame=0,e._lastFramePercent=0,e}return t.prototype.createLine=function(e,r,n){return new Nit(e,r,n)},t.prototype._updateAnimationPoints=function(e,r){this._points=r;for(var n=[0],o=0,s=1;s<r.length;s++){var a=r[s-1],c=r[s];o+=dp(a,c),n.push(o)}if(o===0){this._length=0;return}for(var s=0;s<n.length;s++)n[s]/=o;this._offsets=n,this._length=o},t.prototype._getLineLength=function(){return this._length},t.prototype._updateSymbolPosition=function(e){var r=e.__t<1?e.__t:2-e.__t,n=this._points,o=this._offsets,s=n.length;if(o){var a=this._lastFrame,c;if(r<this._lastFramePercent){var f=Math.min(a+1,s-1);for(c=f;c>=0&&!(o[c]<=r);c--);c=Math.min(c,s-2)}else{for(c=a;c<s&&!(o[c]>r);c++);c=Math.min(c-1,s-2)}var g=(r-o[c])/(o[c+1]-o[c]),v=n[c],y=n[c+1];e.x=v[0]*(1-g)+g*y[0],e.y=v[1]*(1-g)+g*y[1];var w=e.__t<1?y[0]-v[0]:v[0]-y[0],I=e.__t<1?y[1]-v[1]:v[1]-y[1];e.rotation=-Math.atan2(I,w)-Math.PI/2,this._lastFrame=c,this._lastFramePercent=r,e.ignore=!1}},t}(Fit);const XLt=qLt;var YLt=function(){function i(){this.polyline=!1,this.curveness=0,this.segs=[]}return i}(),KLt=function(i){Se(t,i);function t(e){var r=i.call(this,e)||this;return r._off=0,r.hoverDataIdx=-1,r}return t.prototype.reset=function(){this.notClear=!1,this._off=0},t.prototype.getDefaultStyle=function(){return{stroke:ye.color.neutral99,fill:null}},t.prototype.getDefaultShape=function(){return new YLt},t.prototype.buildPath=function(e,r){var n=r.segs,o=r.curveness,s;if(r.polyline)for(s=this._off;s<n.length;){var a=n[s++];if(a>0){e.moveTo(n[s++],n[s++]);for(var c=1;c<a;c++)e.lineTo(n[s++],n[s++])}}else for(s=this._off;s<n.length;){var f=n[s++],g=n[s++],v=n[s++],y=n[s++];if(e.moveTo(f,g),o>0){var w=(f+v)/2-(g-y)*o,I=(g+y)/2-(v-f)*o;e.quadraticCurveTo(w,I,v,y)}else e.lineTo(v,y)}this.incremental&&(this._off=s,this.notClear=!0)},t.prototype.findDataIndex=function(e,r){var n=this.shape,o=n.segs,s=n.curveness,a=this.style.lineWidth;if(n.polyline)for(var c=0,f=0;f<o.length;){var g=o[f++];if(g>0)for(var v=o[f++],y=o[f++],w=1;w<g;w++){var I=o[f++],E=o[f++];if(np(v,y,I,E,a,e,r))return c}c++}else for(var c=0,f=0;f<o.length;){var v=o[f++],y=o[f++],I=o[f++],E=o[f++];if(s>0){var D=(v+I)/2-(y-E)*s,R=(y+E)/2-(I-v)*s;if(mK(v,y,D,R,I,E,a,e,r))return c}else if(np(v,y,I,E,a,e,r))return c;c++}return-1},t.prototype.contain=function(e,r){var n=this.transformCoordToLocal(e,r),o=this.getBoundingRect();if(e=n[0],r=n[1],o.contain(e,r)){var s=this.hoverDataIdx=this.findDataIndex(e,r);return s>=0}return this.hoverDataIdx=-1,!1},t.prototype.getBoundingRect=function(){var e=this._rect;if(!e){for(var r=this.shape,n=r.segs,o=1/0,s=1/0,a=-1/0,c=-1/0,f=0;f<n.length;){var g=n[f++],v=n[f++];o=Math.min(g,o),a=Math.max(g,a),s=Math.min(v,s),c=Math.max(v,c)}e=this._rect=new sr(o,s,a,c)}return e},t}(qr),JLt=function(){function i(){this.group=new Ki}return i.prototype.updateData=function(t){this._clear();var e=this._create();e.setShape({segs:t.getLayout("linesPoints")}),this._setCommon(e,t)},i.prototype.incrementalPrepareUpdate=function(t){this.group.removeAll(),this._clear()},i.prototype.incrementalUpdate=function(t,e){var r=this._newAdded[0],n=e.getLayout("linesPoints"),o=r&&r.shape.segs;if(o&&o.length<2e4){var s=o.length,a=new Float32Array(s+n.length);a.set(o),a.set(n,s),r.setShape({segs:a})}else{this._newAdded=[];var c=this._create();c.incremental=!0,c.setShape({segs:n}),this._setCommon(c,e),c.__startIndex=t.start}},i.prototype.remove=function(){this._clear()},i.prototype.eachRendered=function(t){this._newAdded[0]&&t(this._newAdded[0])},i.prototype._create=function(){var t=new KLt({cursor:"default",ignoreCoarsePointer:!0});return this._newAdded.push(t),this.group.add(t),t},i.prototype._setCommon=function(t,e,r){var n=e.hostModel;t.setShape({polyline:n.get("polyline"),curveness:n.get(["lineStyle","curveness"])}),t.useStyle(n.getModel("lineStyle").getLineStyle()),t.style.strokeNoScale=!0;var o=e.getVisual("style");o&&o.stroke&&t.setStyle("stroke",o.stroke),t.setStyle("fill",null);var s=cr(t);s.seriesIndex=n.seriesIndex,t.on("mousemove",function(a){s.dataIndex=null;var c=t.hoverDataIdx;c>0&&(s.dataIndex=c+t.__startIndex)})},i.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},i}();const QLt=JLt;var tRt={seriesType:"lines",plan:$0(),reset:function(i){var t=i.coordinateSystem;if(t){var e=i.get("polyline"),r=i.pipelineContext.large;return{progress:function(n,o){var s=[];if(r){var a=void 0,c=n.end-n.start;if(e){for(var f=0,g=n.start;g<n.end;g++)f+=i.getLineCoordsCount(g);a=new Float32Array(c+f*2)}else a=new Float32Array(c*4);for(var v=0,y=[],g=n.start;g<n.end;g++){var w=i.getLineCoords(g,s);e&&(a[v++]=w);for(var I=0;I<w;I++)y=t.dataToPoint(s[I],!1,y),a[v++]=y[0],a[v++]=y[1]}o.setLayout("linesPoints",a)}else for(var g=n.start;g<n.end;g++){var E=o.getItemModel(g),w=i.getLineCoords(g,s),D=[];if(e)for(var R=0;R<w;R++)D.push(t.dataToPoint(s[R]));else{D[0]=t.dataToPoint(s[0]),D[1]=t.dataToPoint(s[1]);var z=E.get(["lineStyle","curveness"]);+z&&(D[2]=[(D[0][0]+D[1][0])/2-(D[0][1]-D[1][1])*z,(D[0][1]+D[1][1])/2-(D[1][0]-D[0][0])*z])}o.setItemLayout(g,D)}}}}}};const Vit=tRt;var eRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this._updateLineDraw(o,e),a=e.get("zlevel"),c=e.get(["effect","trailLength"]),f=n.getZr(),g=f.painter.getType()==="svg";g||f.painter.getLayer(a).clear(!0),this._lastZlevel!=null&&!g&&f.configLayer(this._lastZlevel,{motionBlur:!1}),this._showEffect(e)&&c>0&&(g||f.configLayer(a,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(c/10+.9,1),0)})),s.updateData(o);var v=e.get("clip",!0)&&YS(e.coordinateSystem,!1,e);v?this.group.setClipPath(v):this.group.removeClipPath(),this._lastZlevel=a,this._finished=!0},t.prototype.incrementalPrepareRender=function(e,r,n){var o=e.getData(),s=this._updateLineDraw(o,e);s.incrementalPrepareUpdate(o),this._clearLayer(n),this._finished=!1},t.prototype.incrementalRender=function(e,r,n){this._lineDraw.incrementalUpdate(e,r.getData()),this._finished=e.end===r.getData().count()},t.prototype.eachRendered=function(e){this._lineDraw&&this._lineDraw.eachRendered(e)},t.prototype.updateTransform=function(e,r,n){var o=e.getData(),s=e.pipelineContext;if(!this._finished||s.large||s.progressiveRender)return{update:!0};var a=Vit.reset(e,r,n);a.progress&&a.progress({start:0,end:o.count(),count:o.count()},o),this._lineDraw.updateLayout(),this._clearLayer(n)},t.prototype._updateLineDraw=function(e,r){var n=this._lineDraw,o=this._showEffect(r),s=!!r.get("polyline"),a=r.pipelineContext,c=a.large;return(!n||o!==this._hasEffet||s!==this._isPolyline||c!==this._isLargeDraw)&&(n&&n.remove(),n=this._lineDraw=c?new QLt:new eN(s?o?XLt:Nit:o?Fit:tN),this._hasEffet=o,this._isPolyline=s,this._isLargeDraw=c),this.group.add(n.group),n},t.prototype._showEffect=function(e){return!!e.get(["effect","show"])},t.prototype._clearLayer=function(e){var r=e.getZr(),n=r.painter.getType()==="svg";!n&&this._lastZlevel!=null&&r.painter.getLayer(this._lastZlevel).clear(!0)},t.prototype.remove=function(e,r){this._lineDraw&&this._lineDraw.remove(),this._lineDraw=null,this._clearLayer(r)},t.prototype.dispose=function(e,r){this.remove(e,r)},t.type="lines",t}(ga);const iRt=eRt;var rRt=typeof Uint32Array>"u"?Array:Uint32Array,nRt=typeof Float64Array>"u"?Array:Float64Array;function cZ(i){var t=i.data;t&&t[0]&&t[0][0]&&t[0][0].coord&&(i.data=ti(t,function(e){var r=[e[0].coord,e[1].coord],n={coords:r};return e[0].name&&(n.fromName=e[0].name),e[1].name&&(n.toName=e[1].name),bF([n,e[0],e[1]])}))}var aRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.visualStyleAccessPath="lineStyle",e.visualDrawType="stroke",e}return t.prototype.init=function(e){e.data=e.data||[],cZ(e);var r=this._processFlatCoordsArray(e.data);this._flatCoords=r.flatCoords,this._flatCoordsOffset=r.flatCoordsOffset,r.flatCoords&&(e.data=new Float32Array(r.count)),i.prototype.init.apply(this,arguments)},t.prototype.mergeOption=function(e){if(cZ(e),e.data){var r=this._processFlatCoordsArray(e.data);this._flatCoords=r.flatCoords,this._flatCoordsOffset=r.flatCoordsOffset,r.flatCoords&&(e.data=new Float32Array(r.count))}i.prototype.mergeOption.apply(this,arguments)},t.prototype.appendData=function(e){var r=this._processFlatCoordsArray(e.data);r.flatCoords&&(this._flatCoords?(this._flatCoords=Kw(this._flatCoords,r.flatCoords),this._flatCoordsOffset=Kw(this._flatCoordsOffset,r.flatCoordsOffset)):(this._flatCoords=r.flatCoords,this._flatCoordsOffset=r.flatCoordsOffset),e.data=new Float32Array(r.count)),this.getRawData().appendData(e.data)},t.prototype._getCoordsFromItemModel=function(e){var r=this.getData().getItemModel(e),n=r.option instanceof Array?r.option:r.getShallow("coords");return n},t.prototype.getLineCoordsCount=function(e){return this._flatCoordsOffset?this._flatCoordsOffset[e*2+1]:this._getCoordsFromItemModel(e).length},t.prototype.getLineCoords=function(e,r){if(this._flatCoordsOffset){for(var n=this._flatCoordsOffset[e*2],o=this._flatCoordsOffset[e*2+1],s=0;s<o;s++)r[s]=r[s]||[],r[s][0]=this._flatCoords[n+s*2],r[s][1]=this._flatCoords[n+s*2+1];return o}else{for(var a=this._getCoordsFromItemModel(e),s=0;s<a.length;s++)r[s]=r[s]||[],r[s][0]=a[s][0],r[s][1]=a[s][1];return a.length}},t.prototype._processFlatCoordsArray=function(e){var r=0;if(this._flatCoords&&(r=this._flatCoords.length),fn(e[0])){for(var n=e.length,o=new rRt(n),s=new nRt(n),a=0,c=0,f=0,g=0;g<n;){f++;var v=e[g++];o[c++]=a+r,o[c++]=v;for(var y=0;y<v;y++){var w=e[g++],I=e[g++];s[a++]=w,s[a++]=I}}return{flatCoordsOffset:new Uint32Array(o.buffer,0,c),flatCoords:s,count:f}}return{flatCoordsOffset:null,flatCoords:null,count:e.length}},t.prototype.getInitialData=function(e,r){var n=new dl(["value"],this);return n.hasItemOption=!1,n.initData(e.data,[],function(o,s,a,c){if(o instanceof Array)return NaN;n.hasItemOption=!0;var f=o.value;if(f!=null)return f instanceof Array?f[c]:f}),n},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=o.getItemModel(e),a=s.get("name");if(a)return a;var c=s.get("fromName"),f=s.get("toName"),g=[];return c!=null&&g.push(c),f!=null&&g.push(f),So("nameValue",{name:g.join(" > ")})},t.prototype.preventIncremental=function(){return!!this.get(["effect","show"])},t.prototype.getProgressive=function(){var e=this.option.progressive;return e??(this.option.large?1e4:this.get("progressive"))},t.prototype.getProgressiveThreshold=function(){var e=this.option.progressiveThreshold;return e??(this.option.large?2e4:this.get("progressiveThreshold"))},t.prototype.getZLevelKey=function(){var e=this.getModel("effect"),r=e.get("trailLength");return this.getData().count()>this.getProgressiveThreshold()?this.id:e.get("show")&&r>0?r+"":""},t.type="series.lines",t.dependencies=["grid","polar","geo","calendar"],t.defaultOption={coordinateSystem:"geo",z:2,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,clip:!0,label:{show:!1,position:"end"},lineStyle:{opacity:.5}},t}(Ea);const oRt=aRt;function oI(i){return i instanceof Array||(i=[i,i]),i}var sRt={seriesType:"lines",reset:function(i){var t=oI(i.get("symbol")),e=oI(i.get("symbolSize")),r=i.getData();r.setVisual("fromSymbol",t&&t[0]),r.setVisual("toSymbol",t&&t[1]),r.setVisual("fromSymbolSize",e&&e[0]),r.setVisual("toSymbolSize",e&&e[1]);function n(o,s){var a=o.getItemModel(s),c=oI(a.getShallow("symbol",!0)),f=oI(a.getShallow("symbolSize",!0));c[0]&&o.setItemVisual(s,"fromSymbol",c[0]),c[1]&&o.setItemVisual(s,"toSymbol",c[1]),f[0]&&o.setItemVisual(s,"fromSymbolSize",f[0]),f[1]&&o.setItemVisual(s,"toSymbolSize",f[1])}return{dataEach:r.hasItemOption?n:null}}};const lRt=sRt;function uRt(i){i.registerChartView(iRt),i.registerSeriesModel(oRt),i.registerLayout(Vit),i.registerVisual(lRt)}var cRt=256,hRt=function(){function i(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var t=vc.createCanvas();this.canvas=t}return i.prototype.update=function(t,e,r,n,o,s){var a=this._getBrush(),c=this._getGradient(o,"inRange"),f=this._getGradient(o,"outOfRange"),g=this.pointSize+this.blurSize,v=this.canvas,y=v.getContext("2d"),w=t.length;v.width=e,v.height=r;for(var I=0;I<w;++I){var E=t[I],D=E[0],R=E[1],z=E[2],N=n(z);y.globalAlpha=N,y.drawImage(a,D-g,R-g)}if(!v.width||!v.height)return v;for(var H=y.getImageData(0,0,v.width,v.height),q=H.data,Y=0,J=q.length,it=this.minOpacity,at=this.maxOpacity,ut=at-it;Y<J;){var N=q[Y+3]/256,ft=Math.floor(N*(cRt-1))*4;if(N>0){var _t=s(N)?c:f;N>0&&(N=N*ut+it),q[Y++]=_t[ft],q[Y++]=_t[ft+1],q[Y++]=_t[ft+2],q[Y++]=_t[ft+3]*N*256}else Y+=4}return y.putImageData(H,0,0),v},i.prototype._getBrush=function(){var t=this._brushCanvas||(this._brushCanvas=vc.createCanvas()),e=this.pointSize+this.blurSize,r=e*2;t.width=r,t.height=r;var n=t.getContext("2d");return n.clearRect(0,0,r,r),n.shadowOffsetX=r,n.shadowBlur=this.blurSize,n.shadowColor=ye.color.neutral99,n.beginPath(),n.arc(-e,e,this.pointSize,0,Math.PI*2,!0),n.closePath(),n.fill(),t},i.prototype._getGradient=function(t,e){for(var r=this._gradientPixels,n=r[e]||(r[e]=new Uint8ClampedArray(256*4)),o=[0,0,0,0],s=0,a=0;a<256;a++)t[e](a/255,!0,o),n[s++]=o[0],n[s++]=o[1],n[s++]=o[2],n[s++]=o[3];return n},i}();const dRt=hRt;function fRt(i,t,e){var r=i[1]-i[0];t=ti(t,function(s){return{interval:[(s.interval[0]-i[0])/r,(s.interval[1]-i[0])/r]}});var n=t.length,o=0;return function(s){var a;for(a=o;a<n;a++){var c=t[a].interval;if(c[0]<=s&&s<=c[1]){o=a;break}}if(a===n)for(a=o-1;a>=0;a--){var c=t[a].interval;if(c[0]<=s&&s<=c[1]){o=a;break}}return a>=0&&a<n&&e[a]}}function pRt(i,t){var e=i[1]-i[0];return t=[(t[0]-i[0])/e,(t[1]-i[0])/e],function(r){return r>=t[0]&&r<=t[1]}}function hZ(i){var t=i.dimensions;return t[0]==="lng"&&t[1]==="lat"}var gRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o;r.eachComponent("visualMap",function(a){a.eachTargetSeries(function(c){c===e&&(o=a)})}),this._progressiveEls=null,this.group.removeAll();var s=e.coordinateSystem;s.type==="cartesian2d"||s.type==="calendar"||s.type==="matrix"?this._renderOnGridLike(e,n,0,e.getData().count()):hZ(s)&&this._renderOnGeo(s,e,o,n)},t.prototype.incrementalPrepareRender=function(e,r,n){this.group.removeAll()},t.prototype.incrementalRender=function(e,r,n,o){var s=r.coordinateSystem;s&&(hZ(s)?this.render(r,n,o):(this._progressiveEls=[],this._renderOnGridLike(r,o,e.start,e.end,!0)))},t.prototype.eachRendered=function(e){$p(this._progressiveEls||this.group,e)},t.prototype._renderOnGridLike=function(e,r,n,o,s){var a=e.coordinateSystem,c=Fp(a,"cartesian2d"),f=Fp(a,"matrix"),g,v,y,w;if(c){var I=a.getAxis("x"),E=a.getAxis("y");g=I.getBandWidth()+.5,v=E.getBandWidth()+.5,y=I.scale.getExtent(),w=E.scale.getExtent()}for(var D=this.group,R=e.getData(),z=e.getModel(["emphasis","itemStyle"]).getItemStyle(),N=e.getModel(["blur","itemStyle"]).getItemStyle(),H=e.getModel(["select","itemStyle"]).getItemStyle(),q=e.get(["itemStyle","borderRadius"]),Y=Fo(e),J=e.getModel("emphasis"),it=J.get("focus"),at=J.get("blurScope"),ut=J.get("disabled"),ft=c||f?[R.mapDimension("x"),R.mapDimension("y"),R.mapDimension("value")]:[R.mapDimension("time"),R.mapDimension("value")],_t=n;_t<o;_t++){var ct=void 0,Dt=R.getItemVisual(_t,"style");if(c){var Et=R.get(ft[0],_t),bt=R.get(ft[1],_t);if(isNaN(R.get(ft[2],_t))||isNaN(Et)||isNaN(bt)||Et<y[0]||Et>y[1]||bt<w[0]||bt>w[1])continue;var Vt=a.dataToPoint([Et,bt]);ct=new jr({shape:{x:Vt[0]-g/2,y:Vt[1]-v/2,width:g,height:v},style:Dt})}else if(f){var zt=a.dataToLayout([R.get(ft[0],_t),R.get(ft[1],_t)]).rect;if(Bs(zt.x))continue;ct=new jr({z2:1,shape:zt,style:Dt})}else{if(isNaN(R.get(ft[1],_t)))continue;var Jt=a.dataToLayout([R.get(ft[0],_t)]),zt=Jt.contentRect||Jt.rect;if(Bs(zt.x)||Bs(zt.y))continue;ct=new jr({z2:1,shape:zt,style:Dt})}if(R.hasItemOption){var ce=R.getItemModel(_t),be=ce.getModel("emphasis");z=be.getModel("itemStyle").getItemStyle(),N=ce.getModel(["blur","itemStyle"]).getItemStyle(),H=ce.getModel(["select","itemStyle"]).getItemStyle(),q=ce.get(["itemStyle","borderRadius"]),it=be.get("focus"),at=be.get("blurScope"),ut=be.get("disabled"),Y=Fo(ce)}ct.shape.r=q;var ve=e.getRawValue(_t),ke="-";ve&&ve[2]!=null&&(ke=ve[2]+""),Xo(ct,Y,{labelFetcher:e,labelDataIndex:_t,defaultOpacity:Dt.opacity,defaultText:ke}),ct.ensureState("emphasis").style=z,ct.ensureState("blur").style=N,ct.ensureState("select").style=H,Ca(ct,it,at,ut),ct.incremental=s,s&&(ct.states.emphasis.hoverLayer=!0),D.add(ct),R.setItemGraphicEl(_t,ct),this._progressiveEls&&this._progressiveEls.push(ct)}},t.prototype._renderOnGeo=function(e,r,n,o){var s=n.targetVisuals.inRange,a=n.targetVisuals.outOfRange,c=r.getData(),f=this._hmLayer||this._hmLayer||new dRt;f.blurSize=r.get("blurSize"),f.pointSize=r.get("pointSize"),f.minOpacity=r.get("minOpacity"),f.maxOpacity=r.get("maxOpacity");var g=e.getViewRect().clone(),v=e.getRoamTransform();g.applyTransform(v);var y=Math.max(g.x,0),w=Math.max(g.y,0),I=Math.min(g.width+g.x,o.getWidth()),E=Math.min(g.height+g.y,o.getHeight()),D=I-y,R=E-w,z=[c.mapDimension("lng"),c.mapDimension("lat"),c.mapDimension("value")],N=c.mapArray(z,function(J,it,at){var ut=e.dataToPoint([J,it]);return ut[0]-=y,ut[1]-=w,ut.push(at),ut}),H=n.getExtent(),q=n.type==="visualMap.continuous"?pRt(H,n.option.range):fRt(H,n.getPieceList(),n.option.selected);f.update(N,D,R,s.color.getNormalizer(),{inRange:s.color.getColorMapper(),outOfRange:a.color.getColorMapper()},q);var Y=new ys({style:{width:D,height:R,x:y,y:w,image:f.canvas},silent:!0});this.group.add(Y)},t.type="heatmap",t}(ga);const mRt=gRt;var vRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,r){return $d(null,this,{generateCoord:"value"})},t.prototype.preventIncremental=function(){var e=HS.get(this.get("coordinateSystem"));if(e&&e.dimensions)return e.dimensions[0]==="lng"&&e.dimensions[1]==="lat"},t.type="series.heatmap",t.dependencies=["grid","geo","calendar","matrix"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:ye.color.primary}}},t}(Ea);const _Rt=vRt;function yRt(i){i.registerChartView(mRt),i.registerSeriesModel(_Rt)}var xRt=["itemStyle","borderWidth"],dZ=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],dk=new Wp,bRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=this.group,s=e.getData(),a=this._data,c=e.coordinateSystem,f=c.getBaseAxis(),g=f.isHorizontal(),v=c.master.getRect(),y={ecSize:{width:n.getWidth(),height:n.getHeight()},seriesModel:e,coordSys:c,coordSysExtent:[[v.x,v.x+v.width],[v.y,v.y+v.height]],isHorizontal:g,valueDim:dZ[+g],categoryDim:dZ[1-+g]};s.diff(a).add(function(I){if(s.hasValue(I)){var E=pZ(s,I),D=fZ(s,I,E,y),R=gZ(s,y,D);s.setItemGraphicEl(I,R),o.add(R),vZ(R,y,D)}}).update(function(I,E){var D=a.getItemGraphicEl(E);if(!s.hasValue(I)){o.remove(D);return}var R=pZ(s,I),z=fZ(s,I,R,y),N=$it(s,z);D&&N!==D.__pictorialShapeStr&&(o.remove(D),s.setItemGraphicEl(I,null),D=null),D?MRt(D,y,z):D=gZ(s,y,z,!0),s.setItemGraphicEl(I,D),D.__pictorialSymbolMeta=z,o.add(D),vZ(D,y,z)}).remove(function(I){var E=a.getItemGraphicEl(I);E&&mZ(a,I,E.__pictorialSymbolMeta.animationModel,E)}).execute();var w=e.get("clip",!0)?YS(e.coordinateSystem,!1,e):null;return w?o.setClipPath(w):o.removeClipPath(),this._data=s,this.group},t.prototype.remove=function(e,r){var n=this.group,o=this._data;e.get("animation")?o&&o.eachItemGraphicEl(function(s){mZ(o,cr(s).dataIndex,e,s)}):n.removeAll()},t.type="pictorialBar",t}(ga);function fZ(i,t,e,r){var n=i.getItemLayout(t),o=e.get("symbolRepeat"),s=e.get("symbolClip"),a=e.get("symbolPosition")||"start",c=e.get("symbolRotate"),f=(c||0)*Math.PI/180||0,g=e.get("symbolPatternSize")||2,v=e.isAnimationEnabled(),y={dataIndex:t,layout:n,itemModel:e,symbolType:i.getItemVisual(t,"symbol")||"circle",style:i.getItemVisual(t,"style"),symbolClip:s,symbolRepeat:o,symbolRepeatDirection:e.get("symbolRepeatDirection"),symbolPatternSize:g,rotation:f,animationModel:v?e:null,hoverScale:v&&e.get(["emphasis","scale"]),z2:e.getShallow("z",!0)||0};wRt(e,o,n,r,y),SRt(i,t,n,o,s,y.boundingLength,y.pxSign,g,r,y),TRt(e,y.symbolScale,f,r,y);var w=y.symbolSize,I=Rv(e.get("symbolOffset"),w);return ARt(e,w,n,o,s,I,a,y.valueLineWidth,y.boundingLength,y.repeatCutLength,r,y),y}function wRt(i,t,e,r,n){var o=r.valueDim,s=i.get("symbolBoundingData"),a=r.coordSys.getOtherAxis(r.coordSys.getBaseAxis()),c=a.toGlobalCoord(a.dataToCoord(0)),f=1-+(e[o.wh]<=0),g;if(Ye(s)){var v=[fk(a,s[0])-c,fk(a,s[1])-c];v[1]<v[0]&&v.reverse(),g=v[f]}else s!=null?g=fk(a,s)-c:t?g=r.coordSysExtent[o.index][f]-c:g=e[o.wh];n.boundingLength=g,t&&(n.repeatCutLength=e[o.wh]);var y=o.xy==="x",w=a.inverse;n.pxSign=y&&!w||!y&&w?g>=0?1:-1:g>0?1:-1}function fk(i,t){return i.toGlobalCoord(i.dataToCoord(i.scale.parse(t)))}function SRt(i,t,e,r,n,o,s,a,c,f){var g=c.valueDim,v=c.categoryDim,y=Math.abs(e[v.wh]),w=i.getItemVisual(t,"symbolSize"),I;Ye(w)?I=w.slice():w==null?I=["100%","100%"]:I=[w,w],I[v.index]=xi(I[v.index],y),I[g.index]=xi(I[g.index],r?y:Math.abs(o)),f.symbolSize=I;var E=f.symbolScale=[I[0]/a,I[1]/a];E[g.index]*=(c.isHorizontal?-1:1)*s}function TRt(i,t,e,r,n){var o=i.get(xRt)||0;o&&(dk.attr({scaleX:t[0],scaleY:t[1],rotation:e}),dk.updateTransform(),o/=dk.getLineScale(),o*=t[r.valueDim.index]),n.valueLineWidth=o||0}function ARt(i,t,e,r,n,o,s,a,c,f,g,v){var y=g.categoryDim,w=g.valueDim,I=v.pxSign,E=Math.max(t[w.index]+a,0),D=E;if(r){var R=Math.abs(c),z=vs(i.get("symbolMargin"),"15%")+"",N=!1;z.lastIndexOf("!")===z.length-1&&(N=!0,z=z.slice(0,z.length-1));var H=xi(z,t[w.index]),q=Math.max(E+H*2,0),Y=N?0:H*2,J=tK(r),it=J?r:_Z((R+Y)/q),at=R-it*E;H=at/2/(N?it:Math.max(it-1,1)),q=E+H*2,Y=N?0:H*2,!J&&r!=="fixed"&&(it=f?_Z((Math.abs(f)+Y)/q):0),D=it*q-Y,v.repeatTimes=it,v.symbolMargin=H}var ut=I*(D/2),ft=v.pathPosition=[];ft[y.index]=e[y.wh]/2,ft[w.index]=s==="start"?ut:s==="end"?c-ut:c/2,o&&(ft[0]+=o[0],ft[1]+=o[1]);var _t=v.bundlePosition=[];_t[y.index]=e[y.xy],_t[w.index]=e[w.xy];var ct=v.barRectShape=Ne({},e);ct[w.wh]=I*Math.max(Math.abs(e[w.wh]),Math.abs(ft[w.index]+ut)),ct[y.wh]=e[y.wh];var Dt=v.clipShape={};Dt[y.xy]=-e[y.xy],Dt[y.wh]=g.ecSize[y.wh],Dt[w.xy]=0,Dt[w.wh]=e[w.wh]}function Uit(i){var t=i.symbolPatternSize,e=To(i.symbolType,-t/2,-t/2,t,t);return e.attr({culling:!0}),e.type!=="image"&&e.setStyle({strokeNoScale:!0}),e}function Git(i,t,e,r){var n=i.__pictorialBundle,o=e.symbolSize,s=e.valueLineWidth,a=e.pathPosition,c=t.valueDim,f=e.repeatTimes||0,g=0,v=o[t.valueDim.index]+s+e.symbolMargin*2;for(dN(i,function(E){E.__pictorialAnimationIndex=g,E.__pictorialRepeatTimes=f,g<f?d0(E,null,I(g),e,r):d0(E,null,{scaleX:0,scaleY:0},e,r,function(){n.remove(E)}),g++});g<f;g++){var y=Uit(e);y.__pictorialAnimationIndex=g,y.__pictorialRepeatTimes=f,n.add(y);var w=I(g);d0(y,{x:w.x,y:w.y,scaleX:0,scaleY:0},{scaleX:w.scaleX,scaleY:w.scaleY,rotation:w.rotation},e,r)}function I(E){var D=a.slice(),R=e.pxSign,z=E;return(e.symbolRepeatDirection==="start"?R>0:R<0)&&(z=f-1-E),D[c.index]=v*(z-f/2+.5)+a[c.index],{x:D[0],y:D[1],scaleX:e.symbolScale[0],scaleY:e.symbolScale[1],rotation:e.rotation}}}function Hit(i,t,e,r){var n=i.__pictorialBundle,o=i.__pictorialMainPath;o?d0(o,null,{x:e.pathPosition[0],y:e.pathPosition[1],scaleX:e.symbolScale[0],scaleY:e.symbolScale[1],rotation:e.rotation},e,r):(o=i.__pictorialMainPath=Uit(e),n.add(o),d0(o,{x:e.pathPosition[0],y:e.pathPosition[1],scaleX:0,scaleY:0,rotation:e.rotation},{scaleX:e.symbolScale[0],scaleY:e.symbolScale[1]},e,r))}function jit(i,t,e){var r=Ne({},t.barRectShape),n=i.__pictorialBarRect;n?d0(n,null,{shape:r},t,e):(n=i.__pictorialBarRect=new jr({z2:2,shape:r,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),n.disableMorphing=!0,i.add(n))}function Wit(i,t,e,r){if(e.symbolClip){var n=i.__pictorialClipPath,o=Ne({},e.clipShape),s=t.valueDim,a=e.animationModel,c=e.dataIndex;if(n)yn(n,{shape:o},a,c);else{o[s.wh]=0,n=new jr({shape:o}),i.__pictorialBundle.setClipPath(n),i.__pictorialClipPath=n;var f={};f[s.wh]=e.clipShape[s.wh],Ev[r?"updateProps":"initProps"](n,{shape:f},a,c)}}}function pZ(i,t){var e=i.getItemModel(t);return e.getAnimationDelayParams=IRt,e.isAnimationEnabled=CRt,e}function IRt(i){return{index:i.__pictorialAnimationIndex,count:i.__pictorialRepeatTimes}}function CRt(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function gZ(i,t,e,r){var n=new Ki,o=new Ki;return n.add(o),n.__pictorialBundle=o,o.x=e.bundlePosition[0],o.y=e.bundlePosition[1],e.symbolRepeat?Git(n,t,e):Hit(n,t,e),jit(n,e,r),Wit(n,t,e,r),n.__pictorialShapeStr=$it(i,e),n.__pictorialSymbolMeta=e,n}function MRt(i,t,e){var r=e.animationModel,n=e.dataIndex,o=i.__pictorialBundle;yn(o,{x:e.bundlePosition[0],y:e.bundlePosition[1]},r,n),e.symbolRepeat?Git(i,t,e,!0):Hit(i,t,e,!0),jit(i,e,!0),Wit(i,t,e,!0)}function mZ(i,t,e,r){var n=r.__pictorialBarRect;n&&n.removeTextContent();var o=[];dN(r,function(s){o.push(s)}),r.__pictorialMainPath&&o.push(r.__pictorialMainPath),r.__pictorialClipPath&&(e=null),pt(o,function(s){Op(s,{scaleX:0,scaleY:0},e,t,function(){r.parent&&r.parent.remove(r)})}),i.setItemGraphicEl(t,null)}function $it(i,t){return[i.getItemVisual(t.dataIndex,"symbol")||"none",!!t.symbolRepeat,!!t.symbolClip].join(":")}function dN(i,t,e){pt(i.__pictorialBundle.children(),function(r){r!==i.__pictorialBarRect&&t.call(e,r)})}function d0(i,t,e,r,n,o){t&&i.attr(t),r.symbolClip&&!n?e&&i.attr(e):e&&Ev[n?"updateProps":"initProps"](i,e,r.animationModel,r.dataIndex,o)}function vZ(i,t,e){var r=e.dataIndex,n=e.itemModel,o=n.getModel("emphasis"),s=o.getModel("itemStyle").getItemStyle(),a=n.getModel(["blur","itemStyle"]).getItemStyle(),c=n.getModel(["select","itemStyle"]).getItemStyle(),f=n.getShallow("cursor"),g=o.get("focus"),v=o.get("blurScope"),y=o.get("scale");dN(i,function(E){if(E instanceof ys){var D=E.style;E.useStyle(Ne({image:D.image,x:D.x,y:D.y,width:D.width,height:D.height},e.style))}else E.useStyle(e.style);var R=E.ensureState("emphasis");R.style=s,y&&(R.scaleX=E.scaleX*1.1,R.scaleY=E.scaleY*1.1),E.ensureState("blur").style=a,E.ensureState("select").style=c,f&&(E.cursor=f),E.z2=e.z2});var w=t.valueDim.posDesc[+(e.boundingLength>0)],I=i.__pictorialBarRect;I.ignoreClip=!0,Xo(I,Fo(n),{labelFetcher:t.seriesModel,labelDataIndex:r,defaultText:M0(t.seriesModel.getData(),r),inheritColor:e.style.fill,defaultOpacity:e.style.opacity,defaultOutsidePosition:w}),Ca(i,g,v,o.get("disabled"))}function _Z(i){var t=Math.round(i);return Math.abs(i-t)<1e-4?t:Math.ceil(i)}const ERt=bRt;var DRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.hasSymbolVisual=!0,e.defaultSymbol="roundRect",e}return t.prototype.getInitialData=function(e){return e.stack=null,i.prototype.getInitialData.apply(this,arguments)},t.type="series.pictorialBar",t.dependencies=["grid"],t.defaultOption=Zp(oM.defaultOption,{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:!1,symbolRepeatDirection:"end",symbolClip:!1,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",clip:!1,progressive:0,emphasis:{scale:!1},select:{itemStyle:{borderColor:ye.color.primary}}}),t}(oM);const PRt=DRt;function LRt(i){i.registerChartView(ERt),i.registerSeriesModel(PRt),i.registerLayout(i.PRIORITY.VISUAL.LAYOUT,br(att,"pictorialBar")),i.registerLayout(i.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,ott("pictorialBar"))}var RRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._layers=[],e}return t.prototype.render=function(e,r,n){var o=e.getData(),s=this,a=this.group,c=e.getLayerSeries(),f=o.getLayout("layoutInfo"),g=f.rect,v=f.boundaryGap;a.x=0,a.y=g.y+v[0];function y(D){return D.name}var w=new Bd(this._layersSeries||[],c,y,y),I=[];w.add(Si(E,this,"add")).update(Si(E,this,"update")).remove(Si(E,this,"remove")).execute();function E(D,R,z){var N=s._layers;if(D==="remove"){a.remove(N[R]);return}for(var H=[],q=[],Y,J=c[R].indices,it=0;it<J.length;it++){var at=o.getItemLayout(J[it]),ut=at.x,ft=at.y0,_t=at.y;H.push(ut,ft),q.push(ut,ft+_t),Y=o.getItemVisual(J[it],"style")}var ct,Dt=o.getItemLayout(J[0]),Et=e.getModel("label"),bt=Et.get("margin"),Vt=e.getModel("emphasis");if(D==="add"){var zt=I[R]=new Ki;ct=new Jtt({shape:{points:H,stackedOnPoints:q,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),zt.add(ct),a.add(zt),e.isAnimationEnabled()&&ct.setClipPath(kRt(ct.getBoundingRect(),e,function(){ct.removeClipPath()}))}else{var zt=N[z];ct=zt.childAt(0),a.add(zt),I[R]=zt,yn(ct,{shape:{points:H,stackedOnPoints:q}},e),zu(ct)}Xo(ct,Fo(e),{labelDataIndex:J[it-1],defaultText:o.getName(J[it-1]),inheritColor:Y.fill},{normal:{verticalAlign:"middle"}}),ct.setTextConfig({position:null,local:!0});var Jt=ct.getTextContent();Jt&&(Jt.x=Dt.x-bt,Jt.y=Dt.y0+Dt.y/2),ct.useStyle(Y),o.setItemGraphicEl(R,ct),Bo(ct,e),Ca(ct,Vt.get("focus"),Vt.get("blurScope"),Vt.get("disabled"))}this._layersSeries=c,this._layers=I},t.type="themeRiver",t}(ga);function kRt(i,t,e){var r=new jr({shape:{x:i.x-10,y:i.y-10,width:0,height:i.height+20}});return xa(r,{shape:{x:i.x-50,width:i.width+100,height:i.height+20}},t,e),r}const ORt=RRt;var pk=2,zRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e){i.prototype.init.apply(this,arguments),this.legendVisualProvider=new J0(Si(this.getData,this),Si(this.getRawData,this))},t.prototype.fixData=function(e){var r=e.length,n={},o=YO(e,function(y){return n.hasOwnProperty(y[0]+"")||(n[y[0]+""]=-1),y[2]}),s=[];o.buckets.each(function(y,w){s.push({name:w,dataList:y})});for(var a=s.length,c=0;c<a;++c){for(var f=s[c].name,g=0;g<s[c].dataList.length;++g){var v=s[c].dataList[g][0]+"";n[v]=c}for(var v in n)n.hasOwnProperty(v)&&n[v]!==c&&(n[v]=c,e[r]=[v,0,f],r++)}return e},t.prototype.getInitialData=function(e,r){for(var n=this.getReferringComponents("singleAxis",Wa).models[0],o=n.get("type"),s=kn(e.data,function(I){return I[2]!==void 0}),a=this.fixData(s||[]),c=[],f=this.nameMap=Fi(),g=0,v=0;v<a.length;++v)c.push(a[v][pk]),f.get(a[v][pk])||(f.set(a[v][pk],g),g++);var y=$S(a,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:KC(o)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,w=new dl(y,this);return w.initData(a),w},t.prototype.getLayerSeries=function(){for(var e=this.getData(),r=e.count(),n=[],o=0;o<r;++o)n[o]=o;var s=e.mapDimension("single"),a=YO(n,function(f){return e.get("name",f)}),c=[];return a.buckets.each(function(f,g){f.sort(function(v,y){return e.get(s,v)-e.get(s,y)}),c.push({name:g,indices:f})}),c},t.prototype.getAxisTooltipData=function(e,r,n){Ye(e)||(e=e?[e]:[]);for(var o=this.getData(),s=this.getLayerSeries(),a=[],c=s.length,f,g=0;g<c;++g){for(var v=Number.MAX_VALUE,y=-1,w=s[g].indices.length,I=0;I<w;++I){var E=o.get(e[0],s[g].indices[I]),D=Math.abs(E-r);D<=v&&(f=E,v=D,y=s[g].indices[I])}a.push(y)}return{dataIndices:a,nestestValue:f}},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=o.getName(e),a=o.get(o.mapDimension("value"),e);return So("nameValue",{name:s,value:a})},t.type="series.themeRiver",t.dependencies=["singleAxis"],t.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},t}(Ea);const BRt=zRt;function FRt(i,t){i.eachSeriesByType("themeRiver",function(e){var r=e.getData(),n=e.coordinateSystem,o={},s=n.getRect();o.rect=s;var a=e.get("boundaryGap"),c=n.getAxis();if(o.boundaryGap=a,c.orient==="horizontal"){a[0]=xi(a[0],s.height),a[1]=xi(a[1],s.height);var f=s.height-a[0]-a[1];yZ(r,e,f)}else{a[0]=xi(a[0],s.width),a[1]=xi(a[1],s.width);var g=s.width-a[0]-a[1];yZ(r,e,g)}r.setLayout("layoutInfo",o)})}function yZ(i,t,e){if(i.count())for(var r=t.coordinateSystem,n=t.getLayerSeries(),o=i.mapDimension("single"),s=i.mapDimension("value"),a=ti(n,function(D){return ti(D.indices,function(R){var z=r.dataToPoint(i.get(o,R));return z[1]=i.get(s,R),z})}),c=NRt(a),f=c.y0,g=e/c.max,v=n.length,y=n[0].indices.length,w,I=0;I<y;++I){w=f[I]*g,i.setItemLayout(n[0].indices[I],{layerIndex:0,x:a[0][I][0],y0:w,y:a[0][I][1]*g});for(var E=1;E<v;++E)w+=a[E-1][I][1]*g,i.setItemLayout(n[E].indices[I],{layerIndex:E,x:a[E][I][0],y0:w,y:a[E][I][1]*g})}}function NRt(i){for(var t=i.length,e=i[0].length,r=[],n=[],o=0,s=0;s<e;++s){for(var a=0,c=0;c<t;++c)a+=i[c][s][1];a>o&&(o=a),r.push(a)}for(var f=0;f<e;++f)n[f]=(o-r[f])/2;o=0;for(var g=0;g<e;++g){var v=r[g]+n[g];v>o&&(o=v)}return{y0:n,max:o}}function VRt(i){i.registerChartView(ORt),i.registerSeriesModel(BRt),i.registerLayout(FRt),i.registerProcessor(Y0("themeRiver"))}var URt=2,GRt=4,HRt=function(i){Se(t,i);function t(e,r,n,o){var s=i.call(this)||this;s.z2=URt,s.textConfig={inside:!0},cr(s).seriesIndex=r.seriesIndex;var a=new _n({z2:GRt,silent:e.getModel().get(["label","silent"])});return s.setTextContent(a),s.updateData(!0,e,r,n,o),s}return t.prototype.updateData=function(e,r,n,o,s){this.node=r,r.piece=this,n=n||this._seriesModel,o=o||this._ecModel;var a=this;cr(a).dataIndex=r.dataIndex;var c=r.getModel(),f=c.getModel("emphasis"),g=r.getLayout(),v=Ne({},g);v.label=null;var y=r.getVisual("style");y.lineJoin="bevel";var w=r.getVisual("decal");w&&(y.decal=A0(w,s));var I=dh(c.getModel("itemStyle"),v,!0);Ne(v,I),pt(fl,function(z){var N=a.ensureState(z),H=c.getModel([z,"itemStyle"]);N.style=H.getItemStyle();var q=dh(H,v);q&&(N.shape=q)}),e?(a.setShape(v),a.shape.r=g.r0,xa(a,{shape:{r:g.r}},n,r.dataIndex)):(yn(a,{shape:v},n),zu(a)),a.useStyle(y),this._updateLabel(n);var E=c.getShallow("cursor");E&&a.attr("cursor",E),this._seriesModel=n||this._seriesModel,this._ecModel=o||this._ecModel;var D=f.get("focus"),R=D==="relative"?Kw(r.getAncestorsIndices(),r.getDescendantIndices()):D==="ancestor"?r.getAncestorsIndices():D==="descendant"?r.getDescendantIndices():D;Ca(this,R,f.get("blurScope"),f.get("disabled"))},t.prototype._updateLabel=function(e){var r=this,n=this.node.getModel(),o=n.getModel("label"),s=this.node.getLayout(),a=s.endAngle-s.startAngle,c=(s.startAngle+s.endAngle)/2,f=Math.cos(c),g=Math.sin(c),v=this,y=v.getTextContent(),w=this.node.dataIndex,I=o.get("minAngle")/180*Math.PI,E=o.get("show")&&!(I!=null&&Math.abs(a)<I);y.ignore=!E,pt(nS,function(R){var z=R==="normal"?n.getModel("label"):n.getModel([R,"label"]),N=R==="normal",H=N?y:y.ensureState(R),q=e.getFormattedLabel(w,R);N&&(q=q||r.node.name),H.style=pa(z,{},null,R!=="normal",!0),q&&(H.style.text=q);var Y=z.get("show");Y!=null&&!N&&(H.ignore=!Y);var J=D(z,"position"),it=N?v:v.states[R],at=it.style.fill;it.textConfig={outsideFill:z.get("color")==="inherit"?at:null,inside:J!=="outside"};var ut,ft=D(z,"distance")||0,_t=D(z,"align"),ct=D(z,"rotate"),Dt=Math.PI*.5,Et=Math.PI*1.5,bt=tu(ct==="tangential"?Math.PI/2-c:c),Vt=bt>Dt&&!eS(bt-Dt)&&bt<Et;J==="outside"?(ut=s.r+ft,_t=Vt?"right":"left"):!_t||_t==="center"?(a===2*Math.PI&&s.r0===0?ut=0:ut=(s.r+s.r0)/2,_t="center"):_t==="left"?(ut=s.r0+ft,_t=Vt?"right":"left"):_t==="right"&&(ut=s.r-ft,_t=Vt?"left":"right"),H.style.align=_t,H.style.verticalAlign=D(z,"verticalAlign")||"middle",H.x=ut*f+s.cx,H.y=ut*g+s.cy;var zt=0;ct==="radial"?zt=tu(-c)+(Vt?Math.PI:0):ct==="tangential"?zt=tu(Math.PI/2-c)+(Vt?Math.PI:0):fn(ct)&&(zt=ct*Math.PI/180),H.rotation=tu(zt)});function D(R,z){var N=R.get(z);return N??o.get(z)}y.dirtyStyle()},t}(pl);const xZ=HRt;var cB="sunburstRootToNode",bZ="sunburstHighlight",jRt="sunburstUnhighlight";function WRt(i){i.registerAction({type:cB,update:"updateView"},function(t,e){e.eachComponent({mainType:"series",subType:"sunburst",query:t},r);function r(n,o){var s=xS(t,[cB],n);if(s){var a=n.getViewRoot();a&&(t.direction=q3(a,s.node)?"rollUp":"drillDown"),n.resetViewRoot(s.node)}}}),i.registerAction({type:bZ,update:"none"},function(t,e,r){t=Ne({},t),e.eachComponent({mainType:"series",subType:"sunburst",query:t},n);function n(o){var s=xS(t,[bZ],o);s&&(t.dataIndex=s.node.dataIndex)}r.dispatchAction(Ne(t,{type:"highlight"}))}),i.registerAction({type:jRt,update:"updateView"},function(t,e,r){t=Ne({},t),r.dispatchAction(Ne(t,{type:"downplay"}))})}var $Rt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){var s=this;this.seriesModel=e,this.api=n,this.ecModel=r;var a=e.getData(),c=a.tree.root,f=e.getViewRoot(),g=this.group,v=e.get("renderLabelForZeroData"),y=[];f.eachNode(function(z){y.push(z)});var w=this._oldChildren||[];I(y,w),R(c,f),this._initEvents(),this._oldChildren=y;function I(z,N){if(z.length===0&&N.length===0)return;new Bd(N,z,H,H).add(q).update(q).remove(br(q,null)).execute();function H(Y){return Y.getId()}function q(Y,J){var it=Y==null?null:z[Y],at=J==null?null:N[J];E(it,at)}}function E(z,N){if(!v&&z&&!z.getValue()&&(z=null),z!==c&&N!==c){if(N&&N.piece)z?(N.piece.updateData(!1,z,e,r,n),a.setItemGraphicEl(z.dataIndex,N.piece)):D(N);else if(z){var H=new xZ(z,e,r,n);g.add(H),a.setItemGraphicEl(z.dataIndex,H)}}}function D(z){z&&z.piece&&(g.remove(z.piece),z.piece=null)}function R(z,N){N.depth>0?(s.virtualPiece?s.virtualPiece.updateData(!1,z,e,r,n):(s.virtualPiece=new xZ(z,e,r,n),g.add(s.virtualPiece)),N.piece.off("click"),s.virtualPiece.on("click",function(H){s._rootToNode(N.parentNode)})):s.virtualPiece&&(g.remove(s.virtualPiece),s.virtualPiece=null)}},t.prototype._initEvents=function(){var e=this;this.group.off("click"),this.group.on("click",function(r){var n=!1,o=e.seriesModel.getViewRoot();o.eachNode(function(s){if(!n&&s.piece&&s.piece===r.target){var a=s.getModel().get("nodeClick");if(a==="rootToNode")e._rootToNode(s);else if(a==="link"){var c=s.getModel(),f=c.get("link");if(f){var g=c.get("target",!0)||"_blank";HC(f,g)}}n=!0}})})},t.prototype._rootToNode=function(e){e!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:cB,from:this.uid,seriesId:this.seriesModel.id,targetNode:e})},t.prototype.containPoint=function(e,r){var n=r.getData(),o=n.getItemLayout(0);if(o){var s=e[0]-o.cx,a=e[1]-o.cy,c=Math.sqrt(s*s+a*a);return c<=o.r&&c>=o.r0}},t.type="sunburst",t}(ga);const ZRt=$Rt;var qRt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.ignoreStyleOnData=!0,e}return t.prototype.getInitialData=function(e,r){var n={name:e.name,children:e.data};Zit(n);var o=this._levelModels=ti(e.levels||[],function(c){return new bn(c,this,r)},this),s=Z3.createTree(n,this,a);function a(c){c.wrapMethod("getItemModel",function(f,g){var v=s.getNodeByDataIndex(g),y=o[v.depth];return y&&(f.parentModel=y),f})}return s.data},t.prototype.optionUpdated=function(){this.resetViewRoot()},t.prototype.getDataParams=function(e){var r=i.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(e);return r.treePathInfo=LE(n,this),r},t.prototype.getLevelModel=function(e){return this._levelModels&&this._levelModels[e.depth]},t.prototype.getViewRoot=function(){return this._viewRoot},t.prototype.resetViewRoot=function(e){e?this._viewRoot=e:e=this._viewRoot;var r=this.getRawData().tree.root;(!e||e!==r&&!r.contains(e))&&(this._viewRoot=r)},t.prototype.enableAriaDecal=function(){Yet(this)},t.type="series.sunburst",t.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},t}(Ea);function Zit(i){var t=0;pt(i.children,function(r){Zit(r);var n=r.value;Ye(n)&&(n=n[0]),t+=n});var e=i.value;Ye(e)&&(e=e[0]),(e==null||isNaN(e))&&(e=t),e<0&&(e=0),Ye(i.value)?i.value[0]=e:i.value=e}const XRt=qRt;var wZ=Math.PI/180;function YRt(i,t,e){t.eachSeriesByType(i,function(r){var n=r.get("center"),o=r.get("radius");Ye(o)||(o=[0,o]),Ye(n)||(n=[n,n]);var s=e.getWidth(),a=e.getHeight(),c=Math.min(s,a),f=xi(n[0],s),g=xi(n[1],a),v=xi(o[0],c/2),y=xi(o[1],c/2),w=-r.get("startAngle")*wZ,I=r.get("minAngle")*wZ,E=r.getData().tree.root,D=r.getViewRoot(),R=D.depth,z=r.get("sort");z!=null&&qit(D,z);var N=0;pt(D.children,function(bt){!isNaN(bt.getValue())&&N++});var H=D.getValue(),q=Math.PI/(H||N)*2,Y=D.depth>0,J=D.height-(Y?-1:1),it=(y-v)/(J||1),at=r.get("clockwise"),ut=r.get("stillShowZeroSum"),ft=at?1:-1,_t=function(bt,Vt){if(bt){var zt=Vt;if(bt!==E){var Jt=bt.getValue(),ce=H===0&&ut?q:Jt*q;ce<I&&(ce=I),zt=Vt+ft*ce;var be=bt.depth-R-(Y?-1:1),ve=v+it*be,ke=v+it*(be+1),ni=r.getLevelModel(bt);if(ni){var bi=ni.get("r0",!0),or=ni.get("r",!0),Ue=ni.get("radius",!0);Ue!=null&&(bi=Ue[0],or=Ue[1]),bi!=null&&(ve=xi(bi,c/2)),or!=null&&(ke=xi(or,c/2))}bt.setLayout({angle:ce,startAngle:Vt,endAngle:zt,clockwise:at,cx:f,cy:g,r0:ve,r:ke})}if(bt.children&&bt.children.length){var Ze=0;pt(bt.children,function(xe){Ze+=_t(xe,Vt+Ze)})}return zt-Vt}};if(Y){var ct=v,Dt=v+it,Et=Math.PI*2;E.setLayout({angle:Et,startAngle:w,endAngle:w+Et,clockwise:at,cx:f,cy:g,r0:ct,r:Dt})}_t(D,w)})}function qit(i,t){var e=i.children||[];i.children=KRt(e,t),e.length&&pt(i.children,function(r){qit(r,t)})}function KRt(i,t){if(Xi(t)){var e=ti(i,function(n,o){var s=n.getValue();return{params:{depth:n.depth,height:n.height,dataIndex:n.dataIndex,getValue:function(){return s}},index:o}});return e.sort(function(n,o){return t(n.params,o.params)}),ti(e,function(n){return i[n.index]})}else{var r=t==="asc";return i.sort(function(n,o){var s=(n.getValue()-o.getValue())*(r?1:-1);return s===0?(n.dataIndex-o.dataIndex)*(r?-1:1):s})}}function JRt(i){var t={};function e(r,n,o){if(r.depth===0)return ye.color.neutral50;for(var s=r;s&&s.depth>1;)s=s.parentNode;var a=n.getColorFromPalette(s.name||s.dataIndex+"",t);return r.depth>1&&wi(a)&&(a=FO(a,(r.depth-1)/(o-1)*.5)),a}i.eachSeriesByType("sunburst",function(r){var n=r.getData(),o=n.tree;o.eachNode(function(s){var a=s.getModel(),c=a.getModel("itemStyle").getItemStyle();c.fill||(c.fill=e(s,r,o.root.height));var f=n.ensureUniqueItemVisual(s.dataIndex,"style");Ne(f,c)})})}function QRt(i){i.registerChartView(ZRt),i.registerSeriesModel(XRt),i.registerLayout(br(YRt,"sunburst")),i.registerProcessor(br(Y0,"sunburst")),i.registerVisual(JRt),WRt(i)}var SZ={color:"fill",borderColor:"stroke"},tkt={symbol:1,symbolSize:1,symbolKeepAspect:1,legendIcon:1,visualMeta:1,liftZ:1,decal:1},Cd=Wr(),ekt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){this.currentZLevel=this.get("zlevel",!0),this.currentZ=this.get("z",!0)},t.prototype.getInitialData=function(e,r){return $d(null,this)},t.prototype.getDataParams=function(e,r,n){var o=i.prototype.getDataParams.call(this,e,r);return n&&(o.info=Cd(n).info),o},t.type="series.custom",t.dependencies=["grid","polar","geo","singleAxis","calendar","matrix"],t.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,clip:!1},t}(Ea);const ikt=ekt;function rkt(i,t){return t=t||[0,0],ti(["x","y"],function(e,r){var n=this.getAxis(e),o=t[r],s=i[r]/2;return n.type==="category"?n.getBandWidth():Math.abs(n.dataToCoord(o-s)-n.dataToCoord(o+s))},this)}function nkt(i){var t=i.master.getRect();return{coordSys:{type:"cartesian2d",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e){return i.dataToPoint(e)},size:Si(rkt,i)}}}function akt(i,t){return t=t||[0,0],ti([0,1],function(e){var r=t[e],n=i[e]/2,o=[],s=[];return o[e]=r-n,s[e]=r+n,o[1-e]=s[1-e]=t[1-e],Math.abs(this.dataToPoint(o)[e]-this.dataToPoint(s)[e])},this)}function okt(i){var t=i.getBoundingRect();return{coordSys:{type:"geo",x:t.x,y:t.y,width:t.width,height:t.height,zoom:i.getZoom()},api:{coord:function(e){return i.dataToPoint(e)},size:Si(akt,i)}}}function skt(i,t){var e=this.getAxis(),r=t instanceof Array?t[0]:t,n=(i instanceof Array?i[0]:i)/2;return e.type==="category"?e.getBandWidth():Math.abs(e.dataToCoord(r-n)-e.dataToCoord(r+n))}function lkt(i){var t=i.getRect();return{coordSys:{type:"singleAxis",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e){return i.dataToPoint(e)},size:Si(skt,i)}}}function ukt(i,t){return t=t||[0,0],ti(["Radius","Angle"],function(e,r){var n="get"+e+"Axis",o=this[n](),s=t[r],a=i[r]/2,c=o.type==="category"?o.getBandWidth():Math.abs(o.dataToCoord(s-a)-o.dataToCoord(s+a));return e==="Angle"&&(c=c*Math.PI/180),c},this)}function ckt(i){var t=i.getRadiusAxis(),e=i.getAngleAxis(),r=t.getExtent();return r[0]>r[1]&&r.reverse(),{coordSys:{type:"polar",cx:i.cx,cy:i.cy,r:r[1],r0:r[0]},api:{coord:function(n){var o=t.dataToRadius(n[0]),s=e.dataToAngle(n[1]),a=i.coordToPoint([o,s]);return a.push(o,s*Math.PI/180),a},size:Si(ukt,i)}}}function hkt(i){var t=i.getRect(),e=i.getRangeInfo();return{coordSys:{type:"calendar",x:t.x,y:t.y,width:t.width,height:t.height,cellWidth:i.getCellWidth(),cellHeight:i.getCellHeight(),rangeInfo:{start:e.start,end:e.end,weeks:e.weeks,dayCount:e.allDay}},api:{coord:function(r,n){return i.dataToPoint(r,n)},layout:function(r,n){return i.dataToLayout(r,n)}}}}function dkt(i){var t=i.getRect();return{coordSys:{type:"matrix",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:function(e,r){return i.dataToPoint(e,r)},layout:function(e,r){return i.dataToLayout(e,r)}}}}function Xit(i,t,e,r){return i&&(i.legacy||i.legacy!==!1&&!e&&!r&&t!=="tspan"&&(t==="text"||Pi(i,"text")))}function Yit(i,t,e){var r=i,n,o,s;if(t==="text")s=r;else{s={},Pi(r,"text")&&(s.text=r.text),Pi(r,"rich")&&(s.rich=r.rich),Pi(r,"textFill")&&(s.fill=r.textFill),Pi(r,"textStroke")&&(s.stroke=r.textStroke),Pi(r,"fontFamily")&&(s.fontFamily=r.fontFamily),Pi(r,"fontSize")&&(s.fontSize=r.fontSize),Pi(r,"fontStyle")&&(s.fontStyle=r.fontStyle),Pi(r,"fontWeight")&&(s.fontWeight=r.fontWeight),o={type:"text",style:s,silent:!0},n={};var a=Pi(r,"textPosition");e?n.position=a?r.textPosition:"inside":a&&(n.position=r.textPosition),Pi(r,"textPosition")&&(n.position=r.textPosition),Pi(r,"textOffset")&&(n.offset=r.textOffset),Pi(r,"textRotation")&&(n.rotation=r.textRotation),Pi(r,"textDistance")&&(n.distance=r.textDistance)}return TZ(s,i),pt(s.rich,function(c){TZ(c,c)}),{textConfig:n,textContent:o}}function TZ(i,t){t&&(t.font=t.textFont||t.font,Pi(t,"textStrokeWidth")&&(i.lineWidth=t.textStrokeWidth),Pi(t,"textAlign")&&(i.align=t.textAlign),Pi(t,"textVerticalAlign")&&(i.verticalAlign=t.textVerticalAlign),Pi(t,"textLineHeight")&&(i.lineHeight=t.textLineHeight),Pi(t,"textWidth")&&(i.width=t.textWidth),Pi(t,"textHeight")&&(i.height=t.textHeight),Pi(t,"textBackgroundColor")&&(i.backgroundColor=t.textBackgroundColor),Pi(t,"textPadding")&&(i.padding=t.textPadding),Pi(t,"textBorderColor")&&(i.borderColor=t.textBorderColor),Pi(t,"textBorderWidth")&&(i.borderWidth=t.textBorderWidth),Pi(t,"textBorderRadius")&&(i.borderRadius=t.textBorderRadius),Pi(t,"textBoxShadowColor")&&(i.shadowColor=t.textBoxShadowColor),Pi(t,"textBoxShadowBlur")&&(i.shadowBlur=t.textBoxShadowBlur),Pi(t,"textBoxShadowOffsetX")&&(i.shadowOffsetX=t.textBoxShadowOffsetX),Pi(t,"textBoxShadowOffsetY")&&(i.shadowOffsetY=t.textBoxShadowOffsetY))}function AZ(i,t,e){var r=i;r.textPosition=r.textPosition||e.position||"inside",e.offset!=null&&(r.textOffset=e.offset),e.rotation!=null&&(r.textRotation=e.rotation),e.distance!=null&&(r.textDistance=e.distance);var n=r.textPosition.indexOf("inside")>=0,o=i.fill||ye.color.neutral99;IZ(r,t);var s=r.textFill==null;return n?s&&(r.textFill=e.insideFill||ye.color.neutral00,!r.textStroke&&e.insideStroke&&(r.textStroke=e.insideStroke),!r.textStroke&&(r.textStroke=o),r.textStrokeWidth==null&&(r.textStrokeWidth=2)):(s&&(r.textFill=i.fill||e.outsideFill||ye.color.neutral00),!r.textStroke&&e.outsideStroke&&(r.textStroke=e.outsideStroke)),r.text=t.text,r.rich=t.rich,pt(t.rich,function(a){IZ(a,a)}),r}function IZ(i,t){t&&(Pi(t,"fill")&&(i.textFill=t.fill),Pi(t,"stroke")&&(i.textStroke=t.fill),Pi(t,"lineWidth")&&(i.textStrokeWidth=t.lineWidth),Pi(t,"font")&&(i.font=t.font),Pi(t,"fontStyle")&&(i.fontStyle=t.fontStyle),Pi(t,"fontWeight")&&(i.fontWeight=t.fontWeight),Pi(t,"fontSize")&&(i.fontSize=t.fontSize),Pi(t,"fontFamily")&&(i.fontFamily=t.fontFamily),Pi(t,"align")&&(i.textAlign=t.align),Pi(t,"verticalAlign")&&(i.textVerticalAlign=t.verticalAlign),Pi(t,"lineHeight")&&(i.textLineHeight=t.lineHeight),Pi(t,"width")&&(i.textWidth=t.width),Pi(t,"height")&&(i.textHeight=t.height),Pi(t,"backgroundColor")&&(i.textBackgroundColor=t.backgroundColor),Pi(t,"padding")&&(i.textPadding=t.padding),Pi(t,"borderColor")&&(i.textBorderColor=t.borderColor),Pi(t,"borderWidth")&&(i.textBorderWidth=t.borderWidth),Pi(t,"borderRadius")&&(i.textBorderRadius=t.borderRadius),Pi(t,"shadowColor")&&(i.textBoxShadowColor=t.shadowColor),Pi(t,"shadowBlur")&&(i.textBoxShadowBlur=t.shadowBlur),Pi(t,"shadowOffsetX")&&(i.textBoxShadowOffsetX=t.shadowOffsetX),Pi(t,"shadowOffsetY")&&(i.textBoxShadowOffsetY=t.shadowOffsetY),Pi(t,"textShadowColor")&&(i.textShadowColor=t.textShadowColor),Pi(t,"textShadowBlur")&&(i.textShadowBlur=t.textShadowBlur),Pi(t,"textShadowOffsetX")&&(i.textShadowOffsetX=t.textShadowOffsetX),Pi(t,"textShadowOffsetY")&&(i.textShadowOffsetY=t.textShadowOffsetY))}var Kit={position:["x","y"],scale:["scaleX","scaleY"],origin:["originX","originY"]},CZ=on(Kit);xh(wh,function(i,t){return i[t]=1,i},{});wh.join(", ");var mM=["","style","shape","extra"],L0=Wr();function fN(i,t,e,r,n){var o=i+"Animation",s=G0(i,r,n)||{},a=L0(t).userDuring;return s.duration>0&&(s.during=a?Si(vkt,{el:t,userDuring:a}):null,s.setToFinal=!0,s.scope=i),Ne(s,e[o]),s}function nC(i,t,e,r){r=r||{};var n=r.dataIndex,o=r.isInit,s=r.clearStyle,a=e.isAnimationEnabled(),c=L0(i),f=t.style;c.userDuring=t.during;var g={},v={};if(ykt(i,t,v),i.type==="compound")for(var y=i.shape.paths,w=t.shape.paths,I=0;I<w.length;I++){var E=w[I];gk("shape",E,y[I])}else gk("shape",t,v),gk("extra",t,v);if(!o&&a&&(_kt(i,t,g),MZ("shape",i,t,g),MZ("extra",i,t,g),xkt(i,t,f,g)),v.style=f,fkt(i,v,s),gkt(i,t),a)if(o){var D={};pt(mM,function(z){var N=z?t[z]:t;N&&N.enterFrom&&(z&&(D[z]=D[z]||{}),Ne(z?D[z]:D,N.enterFrom))});var R=fN("enter",i,t,e,n);R.duration>0&&i.animateFrom(D,R)}else pkt(i,t,n||0,e,g);Jit(i,t),f?i.dirty():i.markRedraw()}function Jit(i,t){for(var e=L0(i).leaveToProps,r=0;r<mM.length;r++){var n=mM[r],o=n?t[n]:t;o&&o.leaveTo&&(e||(e=L0(i).leaveToProps={}),n&&(e[n]=e[n]||{}),Ne(n?e[n]:e,o.leaveTo))}}function OE(i,t,e,r){if(i){var n=i.parent,o=L0(i).leaveToProps;if(o){var s=fN("update",i,t,e,0);s.done=function(){n&&n.remove(i),r&&r()},i.animateTo(o,s)}else n&&n.remove(i),r&&r()}}function fv(i){return i==="all"}function fkt(i,t,e){var r=t.style;if(!i.isGroup&&r){if(e){i.useStyle({});for(var n=i.animators,o=0;o<n.length;o++){var s=n[o];s.targetName==="style"&&s.changeTarget(i.style)}}i.setStyle(r)}t&&(t.style=null,t&&i.attr(t),t.style=r)}function pkt(i,t,e,r,n){if(n){var o=fN("update",i,t,r,e);o.duration>0&&i.animateFrom(n,o)}}function gkt(i,t){Pi(t,"silent")&&(i.silent=t.silent),Pi(t,"ignore")&&(i.ignore=t.ignore),i instanceof Ou&&Pi(t,"invisible")&&(i.invisible=t.invisible),i instanceof qr&&Pi(t,"autoBatch")&&(i.autoBatch=t.autoBatch)}var Jc={},mkt={setTransform:function(i,t){return Jc.el[i]=t,this},getTransform:function(i){return Jc.el[i]},setShape:function(i,t){var e=Jc.el,r=e.shape||(e.shape={});return r[i]=t,e.dirtyShape&&e.dirtyShape(),this},getShape:function(i){var t=Jc.el.shape;if(t)return t[i]},setStyle:function(i,t){var e=Jc.el,r=e.style;return r&&(r[i]=t,e.dirtyStyle&&e.dirtyStyle()),this},getStyle:function(i){var t=Jc.el.style;if(t)return t[i]},setExtra:function(i,t){var e=Jc.el.extra||(Jc.el.extra={});return e[i]=t,this},getExtra:function(i){var t=Jc.el.extra;if(t)return t[i]}};function vkt(){var i=this,t=i.el;if(t){var e=L0(t).userDuring,r=i.userDuring;if(e!==r){i.el=i.userDuring=null;return}Jc.el=t,r(mkt)}}function MZ(i,t,e,r){var n=e[i];if(n){var o=t[i],s;if(o){var a=e.transition,c=n.transition;if(c)if(!s&&(s=r[i]={}),fv(c))Ne(s,o);else for(var f=aa(c),g=0;g<f.length;g++){var v=f[g],y=o[v];s[v]=y}else if(fv(a)||Ar(a,i)>=0){!s&&(s=r[i]={});for(var w=on(o),g=0;g<w.length;g++){var v=w[g],y=o[v];bkt(n[v],y)&&(s[v]=y)}}}}}function gk(i,t,e){var r=t[i];if(r)for(var n=e[i]={},o=on(r),s=0;s<o.length;s++){var a=o[s];n[a]=Aw(r[a])}}function _kt(i,t,e){for(var r=t.transition,n=fv(r)?wh:aa(r||[]),o=0;o<n.length;o++){var s=n[o];if(!(s==="style"||s==="shape"||s==="extra")){var a=i[s];e[s]=a}}}function ykt(i,t,e){for(var r=0;r<CZ.length;r++){var n=CZ[r],o=Kit[n],s=t[n];s&&(e[o[0]]=s[0],e[o[1]]=s[1])}for(var r=0;r<wh.length;r++){var a=wh[r];t[a]!=null&&(e[a]=t[a])}}function xkt(i,t,e,r){if(e){var n=i.style,o;if(n){var s=e.transition,a=t.transition;if(s&&!fv(s)){var c=aa(s);!o&&(o=r.style={});for(var f=0;f<c.length;f++){var g=c[f],v=n[g];o[g]=v}}else if(i.getAnimationStyleProps&&(fv(a)||fv(s)||Ar(a,"style")>=0)){var y=i.getAnimationStyleProps(),w=y?y.style:null;if(w){!o&&(o=r.style={});for(var I=on(e),f=0;f<I.length;f++){var g=I[f];if(w[g]){var v=n[g];o[g]=v}}}}}}}function bkt(i,t){return Ns(i)?i!==t:i!=null&&isFinite(i)}var Qit=Wr(),wkt=["percent","easing","shape","style","extra"];function trt(i){i.stopAnimation("keyframe"),i.attr(Qit(i))}function vM(i,t,e){if(!(!e.isAnimationEnabled()||!t)){if(Ye(t)){pt(t,function(a){vM(i,a,e)});return}var r=t.keyframes,n=t.duration;if(e&&n==null){var o=G0("enter",e,0);n=o&&o.duration}if(!(!r||!n)){var s=Qit(i);pt(mM,function(a){if(!(a&&!i[a])){var c;r.sort(function(f,g){return f.percent-g.percent}),pt(r,function(f){var g=i.animators,v=a?f[a]:f;if(v){var y=on(v);if(a||(y=kn(y,function(E){return Ar(wkt,E)<0})),!!y.length){c||(c=i.animate(a,t.loop,!0),c.scope="keyframe");for(var w=0;w<g.length;w++)g[w]!==c&&g[w].targetName===c.targetName&&g[w].stopTracks(y);a&&(s[a]=s[a]||{});var I=a?s[a]:s;pt(y,function(E){I[E]=((a?i[a]:i)||{})[E]}),c.whenWithKeys(n*f.percent,v,y,f.easing)}}}),c&&c.delay(t.delay||0).duration(n).start(t.easing)}})}}}var Md="emphasis",yp="normal",pN="blur",gN="select",Up=[yp,Md,pN,gN],mk={normal:["itemStyle"],emphasis:[Md,"itemStyle"],blur:[pN,"itemStyle"],select:[gN,"itemStyle"]},vk={normal:["label"],emphasis:[Md,"label"],blur:[pN,"label"],select:[gN,"label"]},Skt=["x","y"],Tkt="e\0\0",yu={normal:{},emphasis:{},blur:{},select:{}},Akt={cartesian2d:nkt,geo:okt,single:lkt,polar:ckt,calendar:hkt,matrix:dkt};function hB(i){return i instanceof qr}function dB(i){return i instanceof Ou}function Ikt(i,t){t.copyTransform(i),dB(t)&&dB(i)&&(t.setStyle(i.style),t.z=i.z,t.z2=i.z2,t.zlevel=i.zlevel,t.invisible=i.invisible,t.ignore=i.ignore,hB(t)&&hB(i)&&t.setShape(i.shape))}var Ckt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){this._progressiveEls=null;var s=this._data,a=e.getData(),c=this.group,f=EZ(e,a,r,n);s||c.removeAll(),a.diff(s).add(function(v){_k(n,null,v,f(v,o),e,c,a)}).remove(function(v){var y=s.getItemGraphicEl(v);y&&OE(y,Cd(y).option,e)}).update(function(v,y){var w=s.getItemGraphicEl(y);_k(n,w,v,f(v,o),e,c,a)}).execute();var g=e.get("clip",!0)?YS(e.coordinateSystem,!1,e):null;g?c.setClipPath(g):c.removeClipPath(),this._data=a},t.prototype.incrementalPrepareRender=function(e,r,n){this.group.removeAll(),this._data=null},t.prototype.incrementalRender=function(e,r,n,o,s){var a=r.getData(),c=EZ(r,a,n,o),f=this._progressiveEls=[];function g(w){w.isGroup||(w.incremental=!0,w.ensureState("emphasis").hoverLayer=!0)}for(var v=e.start;v<e.end;v++){var y=_k(null,null,v,c(v,s),r,this.group,a);y&&(y.traverse(g),f.push(y))}},t.prototype.eachRendered=function(e){$p(this._progressiveEls||this.group,e)},t.prototype.filterForExposedEvent=function(e,r,n,o){var s=r.element;if(s==null||n.name===s)return!0;for(;(n=n.__hostTarget||n.parent)&&n!==this.group;)if(n.name===s)return!0;return!1},t.type="custom",t}(ga);const Mkt=Ckt;function mN(i){var t=i.type,e;if(t==="path"){var r=i.shape,n=r.width!=null&&r.height!=null?{x:r.x||0,y:r.y||0,width:r.width,height:r.height}:null,o=rrt(r);e=oS(o,null,n,r.layout||"center"),Cd(e).customPathData=o}else if(t==="image")e=new ys({}),Cd(e).customImagePath=i.style.image;else if(t==="text")e=new _n({});else if(t==="group")e=new Ki;else if(t==="compoundPath"){var r=i.shape;if(!r||!r.paths){var s="";Pn(s)}var a=ti(r.paths,function(g){if(g.type==="path")return oS(g.shape.pathData,g,null);var v=VC(g.type);if(!v){var y="";Pn(y)}return new v});e=new pE({shape:{paths:a}})}else{var c=VC(t);if(!c){var s="";Pn(s)}e=new c}return Cd(e).customGraphicType=t,e.name=i.name,e.z2EmphasisLift=1,e.z2SelectLift=1,e}function vN(i,t,e,r,n,o,s){trt(t);var a=n&&n.normal.cfg;a&&t.setTextConfig(a),r&&r.transition==null&&(r.transition=Skt);var c=r&&r.style;if(c){if(t.type==="text"){var f=c;Pi(f,"textFill")&&(f.fill=f.textFill),Pi(f,"textStroke")&&(f.stroke=f.textStroke)}var g=void 0,v=hB(t)?c.decal:null;i&&v&&(v.dirty=!0,g=A0(v,i)),c.__decalPattern=g}if(dB(t)&&c){var g=c.__decalPattern;g&&(c.decal=g)}nC(t,r,o,{dataIndex:e,isInit:s,clearStyle:!0}),vM(t,r.keyframeAnimation,o)}function ert(i,t,e,r,n){var o=t.isGroup?null:t,s=n&&n[i].cfg;if(o){var a=o.ensureState(i);if(r===!1){var c=o.getState(i);c&&(c.style=null)}else a.style=r||null;s&&(a.textConfig=s),yv(o)}}function Ekt(i,t,e){if(!i.isGroup){var r=i,n=e.currentZ,o=e.currentZLevel;r.z=n,r.zlevel=o;var s=t.z2;s!=null&&(r.z2=s||0);for(var a=0;a<Up.length;a++)Dkt(r,t,Up[a])}}function Dkt(i,t,e){var r=e===yp,n=r?t:_M(t,e),o=n?n.z2:null,s;o!=null&&(s=r?i:i.ensureState(e),s.z2=o||0)}function EZ(i,t,e,r){var n=i.get("renderItem");if(typeof n=="string"){var o=Wwt(n);o&&(n=o)}var s=i.coordinateSystem,a={};s&&(a=s.prepareCustoms?s.prepareCustoms(s):Akt[s.type](s));for(var c=rr({getWidth:r.getWidth,getHeight:r.getHeight,getZr:r.getZr,getDevicePixelRatio:r.getDevicePixelRatio,value:q,style:J,ordinalRawValue:Y,styleEmphasis:it,visual:ft,barLayout:_t,currentSeriesIndices:ct,font:Dt},a.api||{}),f={context:{},seriesId:i.id,seriesName:i.name,seriesIndex:i.seriesIndex,coordSys:a.coordSys,dataInsideLength:t.count(),encode:Pkt(i.getData()),itemPayload:i.get("itemPayload")||{}},g,v,y={},w={},I={},E={},D=0;D<Up.length;D++){var R=Up[D];I[R]=i.getModel(mk[R]),E[R]=i.getModel(vk[R])}function z(Et){return Et===g?v||(v=t.getItemModel(Et)):t.getItemModel(Et)}function N(Et,bt){return t.hasItemOption?Et===g?y[bt]||(y[bt]=z(Et).getModel(mk[bt])):z(Et).getModel(mk[bt]):I[bt]}function H(Et,bt){return t.hasItemOption?Et===g?w[bt]||(w[bt]=z(Et).getModel(vk[bt])):z(Et).getModel(vk[bt]):E[bt]}return function(Et,bt){return g=Et,v=null,y={},w={},n&&n(rr({dataIndexInside:Et,dataIndex:t.getRawIndex(Et),actionType:bt?bt.type:null},f),c)};function q(Et,bt){return bt==null&&(bt=g),t.getStore().get(t.getDimensionIndex(Et||0),bt)}function Y(Et,bt){bt==null&&(bt=g),Et=Et||0;var Vt=t.getDimensionInfo(Et);if(!Vt){var zt=t.getDimensionIndex(Et);return zt>=0?t.getStore().get(zt,bt):void 0}var Jt=t.get(Vt.name,bt),ce=Vt&&Vt.ordinalMeta;return ce?ce.categories[Jt]:Jt}function J(Et,bt){bt==null&&(bt=g);var Vt=t.getItemVisual(bt,"style"),zt=Vt&&Vt.fill,Jt=Vt&&Vt.opacity,ce=N(bt,yp).getItemStyle();zt!=null&&(ce.fill=zt),Jt!=null&&(ce.opacity=Jt);var be={inheritColor:wi(zt)?zt:ye.color.neutral99},ve=H(bt,yp),ke=pa(ve,null,be,!1,!0);ke.text=ve.getShallow("show")?Ui(i.getFormattedLabel(bt,yp),M0(t,bt)):null;var ni=UC(ve,be,!1);return ut(Et,ce),ce=AZ(ce,ke,ni),Et&&at(ce,Et),ce.legacy=!0,ce}function it(Et,bt){bt==null&&(bt=g);var Vt=N(bt,Md).getItemStyle(),zt=H(bt,Md),Jt=pa(zt,null,null,!0,!0);Jt.text=zt.getShallow("show")?iu(i.getFormattedLabel(bt,Md),i.getFormattedLabel(bt,yp),M0(t,bt)):null;var ce=UC(zt,null,!0);return ut(Et,Vt),Vt=AZ(Vt,Jt,ce),Et&&at(Vt,Et),Vt.legacy=!0,Vt}function at(Et,bt){for(var Vt in bt)Pi(bt,Vt)&&(Et[Vt]=bt[Vt])}function ut(Et,bt){Et&&(Et.textFill&&(bt.textFill=Et.textFill),Et.textPosition&&(bt.textPosition=Et.textPosition))}function ft(Et,bt){if(bt==null&&(bt=g),Pi(SZ,Et)){var Vt=t.getItemVisual(bt,"style");return Vt?Vt[SZ[Et]]:null}if(Pi(tkt,Et))return t.getItemVisual(bt,Et)}function _t(Et){if(s.type==="cartesian2d"){var bt=s.getBaseAxis();return qSt(rr({axis:bt},Et))}}function ct(){return e.getCurrentSeriesIndices()}function Dt(Et){return XF(Et,e)}}function Pkt(i){var t={};return pt(i.dimensions,function(e){var r=i.getDimensionInfo(e);if(!r.isExtraCoord){var n=r.coordDim,o=t[n]=t[n]||[];o[r.coordDimIndex]=i.getDimensionIndex(e)}}),t}function _k(i,t,e,r,n,o,s){if(!r){o.remove(t);return}var a=_N(i,t,e,r,n,o);return a&&s.setItemGraphicEl(e,a),a&&Ca(a,r.focus,r.blurScope,r.emphasisDisabled),a}function _N(i,t,e,r,n,o){var s=-1,a=t;t&&irt(t,r,n)&&(s=Ar(o.childrenRef(),t),t=null);var c=!t,f=t;f?f.clearStates():(f=mN(r),a&&Ikt(a,f)),r.morph===!1?f.disableMorphing=!0:f.disableMorphing&&(f.disableMorphing=!1),r.tooltipDisabled&&(f.tooltipDisabled=!0),yu.normal.cfg=yu.normal.conOpt=yu.emphasis.cfg=yu.emphasis.conOpt=yu.blur.cfg=yu.blur.conOpt=yu.select.cfg=yu.select.conOpt=null,yu.isLegacy=!1,Rkt(f,e,r,n,c,yu),Lkt(f,e,r,n,c),vN(i,f,e,r,yu,n,c),Pi(r,"info")&&(Cd(f).info=r.info);for(var g=0;g<Up.length;g++){var v=Up[g];if(v!==yp){var y=_M(r,v),w=yN(r,y,v);ert(v,f,y,w,yu)}}return Ekt(f,r,n),r.type==="group"&&kkt(i,f,e,r,n),s>=0?o.replaceAt(f,s):o.add(f),f}function irt(i,t,e){var r=Cd(i),n=t.type,o=t.shape,s=t.style;return e.isUniversalTransitionEnabled()||n!=null&&n!==r.customGraphicType||n==="path"&&Fkt(o)&&rrt(o)!==r.customPathData||n==="image"&&Pi(s,"image")&&s.image!==r.customImagePath}function Lkt(i,t,e,r,n){var o=e.clipPath;if(o===!1)i&&i.getClipPath()&&i.removeClipPath();else if(o){var s=i.getClipPath();s&&irt(s,o,r)&&(s=null),s||(s=mN(o),i.setClipPath(s)),vN(null,s,t,o,null,r,n)}}function Rkt(i,t,e,r,n,o){if(!(i.isGroup||i.type==="compoundPath")){DZ(e,null,o),DZ(e,Md,o);var s=o.normal.conOpt,a=o.emphasis.conOpt,c=o.blur.conOpt,f=o.select.conOpt;if(s!=null||a!=null||f!=null||c!=null){var g=i.getTextContent();if(s===!1)g&&i.removeTextContent();else{s=o.normal.conOpt=s||{type:"text"},g?g.clearStates():(g=mN(s),i.setTextContent(g)),vN(null,g,t,s,null,r,n);for(var v=s&&s.style,y=0;y<Up.length;y++){var w=Up[y];if(w!==yp){var I=o[w].conOpt;ert(w,g,I,yN(s,I,w),null)}}v?g.dirty():g.markRedraw()}}}}function DZ(i,t,e){var r=t?_M(i,t):i,n=t?yN(i,r,Md):i.style,o=i.type,s=r?r.textConfig:null,a=i.textContent,c=a?t?_M(a,t):a:null;if(n&&(e.isLegacy||Xit(n,o,!!s,!!c))){e.isLegacy=!0;var f=Yit(n,o,!t);!s&&f.textConfig&&(s=f.textConfig),!c&&f.textContent&&(c=f.textContent)}if(!t&&c){var g=c;!g.type&&(g.type="text")}var v=t?e[t]:e.normal;v.cfg=s,v.conOpt=c}function _M(i,t){return t?i?i[t]:null:i}function yN(i,t,e){var r=t&&t.style;return r==null&&e===Md&&i&&(r=i.styleEmphasis),r}function kkt(i,t,e,r,n){var o=r.children,s=o?o.length:0,a=r.$mergeChildren,c=a==="byName"||r.diffChildrenByName,f=a===!1;if(!(!s&&!c&&!f)){if(c){zkt({api:i,oldChildren:t.children()||[],newChildren:o||[],dataIndex:e,seriesModel:n,group:t});return}f&&t.removeAll();for(var g=0;g<s;g++){var v=o[g],y=t.childAt(g);v?(v.ignore==null&&(v.ignore=!1),_N(i,y,e,v,n,t)):y.ignore=!0}for(var w=t.childCount()-1;w>=g;w--){var I=t.childAt(w);Okt(t,I,n)}}}function Okt(i,t,e){t&&OE(t,Cd(i).option,e)}function zkt(i){new Bd(i.oldChildren,i.newChildren,PZ,PZ,i).add(LZ).update(LZ).remove(Bkt).execute()}function PZ(i,t){var e=i&&i.name;return e??Tkt+t}function LZ(i,t){var e=this.context,r=i!=null?e.newChildren[i]:null,n=t!=null?e.oldChildren[t]:null;_N(e.api,n,e.dataIndex,r,e.seriesModel,e.group)}function Bkt(i){var t=this.context,e=t.oldChildren[i];e&&OE(e,Cd(e).option,t.seriesModel)}function rrt(i){return i&&(i.pathData||i.d)}function Fkt(i){return i&&(Pi(i,"pathData")||Pi(i,"d"))}function Nkt(i){i.registerChartView(Mkt),i.registerSeriesModel(ikt)}var Vm=Wr(),RZ=Yi,yk=Si,Vkt=function(){function i(){this._dragging=!1,this.animationThreshold=15}return i.prototype.render=function(t,e,r,n){var o=e.get("value"),s=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=r,!(!n&&this._lastValue===o&&this._lastStatus===s)){this._lastValue=o,this._lastStatus=s;var a=this._group,c=this._handle;if(!s||s==="hide"){a&&a.hide(),c&&c.hide();return}a&&a.show(),c&&c.show();var f={};this.makeElOption(f,o,t,e,r);var g=f.graphicKey;g!==this._lastGraphicKey&&this.clear(r),this._lastGraphicKey=g;var v=this._moveAnimation=this.determineAnimation(t,e);if(!a)a=this._group=new Ki,this.createPointerEl(a,f,t,e),this.createLabelEl(a,f,t,e),r.getZr().add(a);else{var y=br(kZ,e,v);this.updatePointerEl(a,f,y),this.updateLabelEl(a,f,y,e)}zZ(a,e,!0),this._renderHandle(o)}},i.prototype.remove=function(t){this.clear(t)},i.prototype.dispose=function(t){this.clear(t)},i.prototype.determineAnimation=function(t,e){var r=e.get("animation"),n=t.axis,o=n.type==="category",s=e.get("snap");if(!s&&!o)return!1;if(r==="auto"||r==null){var a=this.animationThreshold;if(o&&n.getBandWidth()>a)return!0;if(s){var c=V3(t).seriesDataCount,f=n.getExtent();return Math.abs(f[0]-f[1])/c>a}return!1}return r===!0},i.prototype.makeElOption=function(t,e,r,n,o){},i.prototype.createPointerEl=function(t,e,r,n){var o=e.pointer;if(o){var s=Vm(t).pointerEl=new Ev[o.type](RZ(e.pointer));t.add(s)}},i.prototype.createLabelEl=function(t,e,r,n){if(e.label){var o=Vm(t).labelEl=new _n(RZ(e.label));t.add(o),OZ(o,n)}},i.prototype.updatePointerEl=function(t,e,r){var n=Vm(t).pointerEl;n&&e.pointer&&(n.setStyle(e.pointer.style),r(n,{shape:e.pointer.shape}))},i.prototype.updateLabelEl=function(t,e,r,n){var o=Vm(t).labelEl;o&&(o.setStyle(e.label.style),r(o,{x:e.label.x,y:e.label.y}),OZ(o,n))},i.prototype._renderHandle=function(t){if(!(this._dragging||!this.updateHandleTransform)){var e=this._axisPointerModel,r=this._api.getZr(),n=this._handle,o=e.getModel("handle"),s=e.get("status");if(!o.get("show")||!s||s==="hide"){n&&r.remove(n),this._handle=null;return}var a;this._handle||(a=!0,n=this._handle=US(o.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(f){Rd(f.event)},onmousedown:yk(this._onHandleDragMove,this,0,0),drift:yk(this._onHandleDragMove,this),ondragend:yk(this._onHandleDragEnd,this)}),r.add(n)),zZ(n,e,!1),n.setStyle(o.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var c=o.get("size");Ye(c)||(c=[c,c]),n.scaleX=c[0]/2,n.scaleY=c[1]/2,Z0(this,"_doDispatchAxisPointer",o.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,a)}},i.prototype._moveHandleToValue=function(t,e){kZ(this._axisPointerModel,!e&&this._moveAnimation,this._handle,xk(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},i.prototype._onHandleDragMove=function(t,e){var r=this._handle;if(r){this._dragging=!0;var n=this.updateHandleTransform(xk(r),[t,e],this._axisModel,this._axisPointerModel);this._payloadInfo=n,r.stopAnimation(),r.attr(xk(n)),Vm(r).lastProp=null,this._doDispatchAxisPointer()}},i.prototype._doDispatchAxisPointer=function(){var t=this._handle;if(t){var e=this._payloadInfo,r=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:e.cursorPoint[0],y:e.cursorPoint[1],tooltipOption:e.tooltipOption,axesInfo:[{axisDim:r.axis.dim,axisIndex:r.componentIndex}]})}},i.prototype._onHandleDragEnd=function(){this._dragging=!1;var t=this._handle;if(t){var e=this._axisPointerModel.get("value");this._moveHandleToValue(e),this._api.dispatchAction({type:"hideTip"})}},i.prototype.clear=function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),r=this._group,n=this._handle;e&&r&&(this._lastGraphicKey=null,r&&e.remove(r),n&&e.remove(n),this._group=null,this._handle=null,this._payloadInfo=null),cS(this,"_doDispatchAxisPointer")},i.prototype.doClear=function(){},i.prototype.buildLabel=function(t,e,r){return r=r||0,{x:t[r],y:t[1-r],width:e[r],height:e[1-r]}},i}();function kZ(i,t,e,r){nrt(Vm(e).lastProp,r)||(Vm(e).lastProp=r,t?yn(e,r,i):(e.stopAnimation(),e.attr(r)))}function nrt(i,t){if(nr(i)&&nr(t)){var e=!0;return pt(t,function(r,n){e=e&&nrt(i[n],r)}),!!e}else return i===t}function OZ(i,t){i[t.get(["label","show"])?"show":"hide"]()}function xk(i){return{x:i.x||0,y:i.y||0,rotation:i.rotation||0}}function zZ(i,t,e){var r=t.get("z"),n=t.get("zlevel");i&&i.traverse(function(o){o.type!=="group"&&(r!=null&&(o.z=r),n!=null&&(o.zlevel=n),o.silent=e)})}const xN=Vkt;function bN(i){var t=i.get("type"),e=i.getModel(t+"Style"),r;return t==="line"?(r=e.getLineStyle(),r.fill=null):t==="shadow"&&(r=e.getAreaStyle(),r.stroke=null),r}function art(i,t,e,r,n){var o=e.get("value"),s=ort(o,t.axis,t.ecModel,e.get("seriesDataIndices"),{precision:e.get(["label","precision"]),formatter:e.get(["label","formatter"])}),a=e.getModel("label"),c=GS(a.get("padding")||0),f=a.getFont(),g=rE(s,f),v=n.position,y=g.width+c[1]+c[3],w=g.height+c[0]+c[2],I=n.align;I==="right"&&(v[0]-=y),I==="center"&&(v[0]-=y/2);var E=n.verticalAlign;E==="bottom"&&(v[1]-=w),E==="middle"&&(v[1]-=w/2),Ukt(v,y,w,r);var D=a.get("backgroundColor");(!D||D==="auto")&&(D=t.get(["axisLine","lineStyle","color"])),i.label={x:v[0],y:v[1],style:pa(a,{text:s,font:f,fill:a.getTextColor(),padding:c,backgroundColor:D}),z2:10}}function Ukt(i,t,e,r){var n=r.getWidth(),o=r.getHeight();i[0]=Math.min(i[0]+t,n)-t,i[1]=Math.min(i[1]+e,o)-e,i[0]=Math.max(i[0],0),i[1]=Math.max(i[1],0)}function ort(i,t,e,r,n){i=t.scale.parse(i);var o=t.scale.getLabel({value:i},{precision:n.precision}),s=n.formatter;if(s){var a={value:JC(t,{value:i}),axisDimension:t.dim,axisIndex:t.index,seriesData:[]};pt(r,function(c){var f=e.getSeriesByIndex(c.seriesIndex),g=c.dataIndexInside,v=f&&f.getDataParams(g);v&&a.seriesData.push(v)}),wi(s)?o=s.replace("{value}",o):Xi(s)&&(o=s(a))}return o}function wN(i,t,e){var r=as();return jp(r,r,e.rotation),bh(r,r,e.position),pc([i.dataToCoord(t),(e.labelOffset||0)+(e.labelDirection||1)*(e.labelMargin||0)],r)}function srt(i,t,e,r,n,o){var s=Fd.innerTextLayout(e.rotation,0,e.labelDirection);e.labelMargin=n.get(["label","margin"]),art(t,r,n,o,{position:wN(r.axis,i,e),align:s.textAlign,verticalAlign:s.textVerticalAlign})}function SN(i,t,e){return e=e||0,{x1:i[e],y1:i[1-e],x2:t[e],y2:t[1-e]}}function lrt(i,t,e){return e=e||0,{x:i[e],y:i[1-e],width:t[e],height:t[1-e]}}function BZ(i,t,e,r,n,o){return{cx:i,cy:t,r0:e,r,startAngle:n,endAngle:o,clockwise:!0}}var Gkt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,r,n,o,s){var a=n.axis,c=a.grid,f=o.get("type"),g=FZ(c,a).getOtherAxis(a).getGlobalExtent(),v=a.toGlobalCoord(a.dataToCoord(r,!0));if(f&&f!=="none"){var y=bN(o),w=Hkt[f](a,v,g);w.style=y,e.graphicKey=w.type,e.pointer=w}var I=uM(c.getRect(),n);srt(r,e,I,n,o,s)},t.prototype.getHandleTransform=function(e,r,n){var o=uM(r.axis.grid.getRect(),r,{labelInside:!1});o.labelMargin=n.get(["handle","margin"]);var s=wN(r.axis,e,o);return{x:s[0],y:s[1],rotation:o.rotation+(o.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,r,n,o){var s=n.axis,a=s.grid,c=s.getGlobalExtent(!0),f=FZ(a,s).getOtherAxis(s).getGlobalExtent(),g=s.dim==="x"?0:1,v=[e.x,e.y];v[g]+=r[g],v[g]=Math.min(c[1],v[g]),v[g]=Math.max(c[0],v[g]);var y=(f[1]+f[0])/2,w=[y,y];w[g]=v[g];var I=[{verticalAlign:"middle"},{align:"center"}];return{x:v[0],y:v[1],rotation:e.rotation,cursorPoint:w,tooltipOption:I[g]}},t}(xN);function FZ(i,t){var e={};return e[t.dim+"AxisIndex"]=t.index,i.getCartesian(e)}var Hkt={line:function(i,t,e){var r=SN([t,e[0]],[t,e[1]],NZ(i));return{type:"Line",subPixelOptimize:!0,shape:r}},shadow:function(i,t,e){var r=Math.max(1,i.getBandWidth()),n=e[1]-e[0];return{type:"Rect",shape:lrt([t-r/2,e[0]],[r,n],NZ(i))}}};function NZ(i){return i.dim==="x"?0:1}const jkt=Gkt;var Wkt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="axisPointer",t.defaultOption={show:"auto",z:50,type:"line",snap:!1,triggerTooltip:!0,triggerEmphasis:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:ye.color.border,width:1,type:"dashed"},shadowStyle:{color:ye.color.shadowTint},label:{show:!0,formatter:null,precision:"auto",margin:3,color:ye.color.neutral00,padding:[5,7,5,7],backgroundColor:ye.color.accent60,borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:ye.color.accent40,throttle:40}},t}(gn);const $kt=Wkt;var bd=Wr(),Zkt=pt;function urt(i,t,e){if(!Sn.node){var r=t.getZr();bd(r).records||(bd(r).records={}),qkt(r,t);var n=bd(r).records[i]||(bd(r).records[i]={});n.handler=e}}function qkt(i,t){if(bd(i).initialized)return;bd(i).initialized=!0,e("click",br(VZ,"click")),e("mousemove",br(VZ,"mousemove")),e("globalout",Ykt);function e(r,n){i.on(r,function(o){var s=Kkt(t);Zkt(bd(i).records,function(a){a&&n(a,o,s.dispatchAction)}),Xkt(s.pendings,t)})}}function Xkt(i,t){var e=i.showTip.length,r=i.hideTip.length,n;e?n=i.showTip[e-1]:r&&(n=i.hideTip[r-1]),n&&(n.dispatchAction=null,t.dispatchAction(n))}function Ykt(i,t,e){i.handler("leave",null,e)}function VZ(i,t,e,r){t.handler(i,e,r)}function Kkt(i){var t={showTip:[],hideTip:[]},e=function(r){var n=t[r.type];n?n.push(r):(r.dispatchAction=e,i.dispatchAction(r))};return{dispatchAction:e,pendings:t}}function fB(i,t){if(!Sn.node){var e=t.getZr(),r=(bd(e).records||{})[i];r&&(bd(e).records[i]=null)}}var Jkt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=r.getComponent("tooltip"),s=e.get("triggerOn")||o&&o.get("triggerOn")||"mousemove|click";urt("axisPointer",n,function(a,c,f){s!=="none"&&(a==="leave"||s.indexOf(a)>=0)&&f({type:"updateAxisPointer",currTrigger:a,x:c&&c.offsetX,y:c&&c.offsetY})})},t.prototype.remove=function(e,r){fB("axisPointer",r)},t.prototype.dispose=function(e,r){fB("axisPointer",r)},t.type="axisPointer",t}(Oa);const Qkt=Jkt;function crt(i,t){var e=[],r=i.seriesIndex,n;if(r==null||!(n=t.getSeriesByIndex(r)))return{point:[]};var o=n.getData(),s=vv(o,i);if(s==null||s<0||Ye(s))return{point:[]};var a=o.getItemGraphicEl(s),c=n.coordinateSystem;if(n.getTooltipPosition)e=n.getTooltipPosition(s)||[];else if(c&&c.dataToPoint)if(i.isStacked){var f=c.getBaseAxis(),g=c.getOtherAxis(f),v=g.dim,y=f.dim,w=v==="x"||v==="radius"?1:0,I=o.mapDimension(y),E=[];E[w]=o.get(I,s),E[1-w]=o.get(o.getCalculationInfo("stackResultDimension"),s),e=c.dataToPoint(E)||[]}else e=c.dataToPoint(o.getValues(ti(c.dimensions,function(R){return o.mapDimension(R)}),s))||[];else if(a){var D=a.getBoundingRect().clone();D.applyTransform(a.transform),e=[D.x+D.width/2,D.y+D.height/2]}return{point:e,el:a}}var UZ=Wr();function tOt(i,t,e){var r=i.currTrigger,n=[i.x,i.y],o=i,s=i.dispatchAction||Si(e.dispatchAction,e),a=t.getComponent("axisPointer").coordSysAxesInfo;if(a){aC(n)&&(n=crt({seriesIndex:o.seriesIndex,dataIndex:o.dataIndex},t).point);var c=aC(n),f=o.axesInfo,g=a.axesInfo,v=r==="leave"||aC(n),y={},w={},I={list:[],map:{}},E={showPointer:br(iOt,w),showTooltip:br(rOt,I)};pt(a.coordSysMap,function(R,z){var N=c||R.containPoint(n);pt(a.coordSysAxesInfo[z],function(H,q){var Y=H.axis,J=sOt(f,H);if(!v&&N&&(!f||J)){var it=J&&J.value;it==null&&!c&&(it=Y.pointToData(n)),it!=null&&GZ(H,it,E,!1,y)}})});var D={};return pt(g,function(R,z){var N=R.linkGroup;N&&!w[z]&&pt(N.axesInfo,function(H,q){var Y=w[q];if(H!==R&&Y){var J=Y.value;N.mapper&&(J=R.axis.scale.parse(N.mapper(J,HZ(H),HZ(R)))),D[R.key]=J}})}),pt(D,function(R,z){GZ(g[z],R,E,!0,y)}),nOt(w,g,y),aOt(I,n,i,s),oOt(g,s,e),y}}function GZ(i,t,e,r,n){var o=i.axis;if(!(o.scale.isBlank()||!o.containData(t))){if(!i.involveSeries){e.showPointer(i,t);return}var s=eOt(t,i),a=s.payloadBatch,c=s.snapToValue;a[0]&&n.seriesIndex==null&&Ne(n,a[0]),!r&&i.snap&&o.containData(c)&&c!=null&&(t=c),e.showPointer(i,t,a),e.showTooltip(i,s,c)}}function eOt(i,t){var e=t.axis,r=e.dim,n=i,o=[],s=Number.MAX_VALUE,a=-1;return pt(t.seriesModels,function(c,f){var g=c.getData().mapDimensionsAll(r),v,y;if(c.getAxisTooltipData){var w=c.getAxisTooltipData(g,i,e);y=w.dataIndices,v=w.nestestValue}else{if(y=c.indicesOfNearest(r,g[0],i,e.type==="category"?.5:null),!y.length)return;v=c.getData().get(g[0],y[0])}if(!(v==null||!isFinite(v))){var I=i-v,E=Math.abs(I);E<=s&&((E<s||I>=0&&a<0)&&(s=E,a=I,n=v,o.length=0),pt(y,function(D){o.push({seriesIndex:c.seriesIndex,dataIndexInside:D,dataIndex:c.getData().getRawIndex(D)})}))}}),{payloadBatch:o,snapToValue:n}}function iOt(i,t,e,r){i[t.key]={value:e,payloadBatch:r}}function rOt(i,t,e,r){var n=e.payloadBatch,o=t.axis,s=o.model,a=t.axisPointerModel;if(!(!t.triggerTooltip||!n.length)){var c=t.coordSys.model,f=yS(c),g=i.map[f];g||(g=i.map[f]={coordSysId:c.id,coordSysIndex:c.componentIndex,coordSysType:c.type,coordSysMainType:c.mainType,dataByAxis:[]},i.list.push(g)),g.dataByAxis.push({axisDim:o.dim,axisIndex:s.componentIndex,axisType:s.type,axisId:s.id,value:r,valueLabelOpt:{precision:a.get(["label","precision"]),formatter:a.get(["label","formatter"])},seriesDataIndices:n.slice()})}}function nOt(i,t,e){var r=e.axesInfo=[];pt(t,function(n,o){var s=n.axisPointerModel.option,a=i[o];a?(!n.useHandle&&(s.status="show"),s.value=a.value,s.seriesDataIndices=(a.payloadBatch||[]).slice()):!n.useHandle&&(s.status="hide"),s.status==="show"&&r.push({axisDim:n.axis.dim,axisIndex:n.axis.model.componentIndex,value:s.value})})}function aOt(i,t,e,r){if(aC(t)||!i.list.length){r({type:"hideTip"});return}var n=((i.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};r({type:"showTip",escapeConnect:!0,x:t[0],y:t[1],tooltipOption:e.tooltipOption,position:e.position,dataIndexInside:n.dataIndexInside,dataIndex:n.dataIndex,seriesIndex:n.seriesIndex,dataByCoordSys:i.list})}function oOt(i,t,e){var r=e.getZr(),n="axisPointerLastHighlights",o=UZ(r)[n]||{},s=UZ(r)[n]={};pt(i,function(f,g){var v=f.axisPointerModel.option;v.status==="show"&&f.triggerEmphasis&&pt(v.seriesDataIndices,function(y){var w=y.seriesIndex+" | "+y.dataIndex;s[w]=y})});var a=[],c=[];pt(o,function(f,g){!s[g]&&c.push(f)}),pt(s,function(f,g){!o[g]&&a.push(f)}),c.length&&e.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:c}),a.length&&e.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:a})}function sOt(i,t){for(var e=0;e<(i||[]).length;e++){var r=i[e];if(t.axis.dim===r.axisDim&&t.axis.model.componentIndex===r.axisIndex)return r}}function HZ(i){var t=i.axis.model,e={},r=e.axisDim=i.axis.dim;return e.axisIndex=e[r+"AxisIndex"]=t.componentIndex,e.axisName=e[r+"AxisName"]=t.name,e.axisId=e[r+"AxisId"]=t.id,e}function aC(i){return!i||i[0]==null||isNaN(i[0])||i[1]==null||isNaN(i[1])}function QS(i){zv.registerAxisPointerClass("CartesianAxisPointer",jkt),i.registerComponentModel($kt),i.registerComponentView(Qkt),i.registerPreprocessor(function(t){if(t){(!t.axisPointer||t.axisPointer.length===0)&&(t.axisPointer={});var e=t.axisPointer.link;e&&!Ye(e)&&(t.axisPointer.link=[e])}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=zIt(t,e)}),i.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},tOt)}function lOt(i){Rr(Let),Rr(QS)}var uOt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,r,n,o,s){var a=n.axis;a.dim==="angle"&&(this.animationThreshold=Math.PI/18);var c=a.polar,f=c.getOtherAxis(a),g=f.getExtent(),v=a.dataToCoord(r),y=o.get("type");if(y&&y!=="none"){var w=bN(o),I=hOt[y](a,c,v,g);I.style=w,e.graphicKey=I.type,e.pointer=I}var E=o.get(["label","margin"]),D=cOt(r,n,o,c,E);art(e,n,o,s,D)},t}(xN);function cOt(i,t,e,r,n){var o=t.axis,s=o.dataToCoord(i),a=r.getAngleAxis().getExtent()[0];a=a/180*Math.PI;var c=r.getRadiusAxis().getExtent(),f,g,v;if(o.dim==="radius"){var y=as();jp(y,y,a),bh(y,y,[r.cx,r.cy]),f=pc([s,-n],y);var w=t.getModel("axisLabel").get("rotate")||0,I=Fd.innerTextLayout(a,w*Math.PI/180,-1);g=I.textAlign,v=I.textVerticalAlign}else{var E=c[1];f=r.coordToPoint([E+n,s]);var D=r.cx,R=r.cy;g=Math.abs(f[0]-D)/E<.3?"center":f[0]>D?"left":"right",v=Math.abs(f[1]-R)/E<.3?"middle":f[1]>R?"top":"bottom"}return{position:f,align:g,verticalAlign:v}}var hOt={line:function(i,t,e,r){return i.dim==="angle"?{type:"Line",shape:SN(t.coordToPoint([r[0],e]),t.coordToPoint([r[1],e]))}:{type:"Circle",shape:{cx:t.cx,cy:t.cy,r:e}}},shadow:function(i,t,e,r){var n=Math.max(1,i.getBandWidth()),o=Math.PI/180;return i.dim==="angle"?{type:"Sector",shape:BZ(t.cx,t.cy,r[0],r[1],(-e-n/2)*o,(-e+n/2)*o)}:{type:"Sector",shape:BZ(t.cx,t.cy,e-n/2,e+n/2,0,Math.PI*2)}}};const dOt=uOt;var fOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.findAxisModel=function(e){var r,n=this.ecModel;return n.eachComponent(e,function(o){o.getCoordSysModel()===this&&(r=o)},this),r},t.type="polar",t.dependencies=["radiusAxis","angleAxis"],t.defaultOption={z:0,center:["50%","50%"],radius:"80%"},t}(gn);const pOt=fOt;var TN=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",Wa).models[0]},t.type="polarAxis",t}(gn);Ao(TN,ZS);var gOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="angleAxis",t}(TN),mOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="radiusAxis",t}(TN),AN=function(i){Se(t,i);function t(e,r){return i.call(this,"radius",e,r)||this}return t.prototype.pointToData=function(e,r){return this.polar.pointToData(e,r)[this.dim==="radius"?0:1]},t}(Sc);AN.prototype.dataToRadius=Sc.prototype.dataToCoord;AN.prototype.radiusToData=Sc.prototype.coordToData;const vOt=AN;var _Ot=Wr(),IN=function(i){Se(t,i);function t(e,r){return i.call(this,"angle",e,r||[0,360])||this}return t.prototype.pointToData=function(e,r){return this.polar.pointToData(e,r)[this.dim==="radius"?0:1]},t.prototype.calculateCategoryInterval=function(){var e=this,r=e.getLabelModel(),n=e.scale,o=n.getExtent(),s=n.count();if(o[1]-o[0]<1)return 0;var a=o[0],c=e.dataToCoord(a+1)-e.dataToCoord(a),f=Math.abs(c),g=rE(a==null?"":a+"",r.getFont(),"center","top"),v=Math.max(g.height,7),y=v/f;isNaN(y)&&(y=1/0);var w=Math.max(0,Math.floor(y)),I=_Ot(e.model),E=I.lastAutoInterval,D=I.lastTickCount;return E!=null&&D!=null&&Math.abs(E-w)<=1&&Math.abs(D-s)<=1&&E>w?w=E:(I.lastTickCount=s,I.lastAutoInterval=w),w},t}(Sc);IN.prototype.dataToAngle=Sc.prototype.dataToCoord;IN.prototype.angleToData=Sc.prototype.coordToData;const yOt=IN;var hrt=["radius","angle"],xOt=function(){function i(t){this.dimensions=hrt,this.type="polar",this.cx=0,this.cy=0,this._radiusAxis=new vOt,this._angleAxis=new yOt,this.axisPointerEnabled=!0,this.name=t||"",this._radiusAxis.polar=this._angleAxis.polar=this}return i.prototype.containPoint=function(t){var e=this.pointToCoord(t);return this._radiusAxis.contain(e[0])&&this._angleAxis.contain(e[1])},i.prototype.containData=function(t){return this._radiusAxis.containData(t[0])&&this._angleAxis.containData(t[1])},i.prototype.getAxis=function(t){var e="_"+t+"Axis";return this[e]},i.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]},i.prototype.getAxesByScale=function(t){var e=[],r=this._angleAxis,n=this._radiusAxis;return r.scale.type===t&&e.push(r),n.scale.type===t&&e.push(n),e},i.prototype.getAngleAxis=function(){return this._angleAxis},i.prototype.getRadiusAxis=function(){return this._radiusAxis},i.prototype.getOtherAxis=function(t){var e=this._angleAxis;return t===e?this._radiusAxis:e},i.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},i.prototype.getTooltipAxes=function(t){var e=t!=null&&t!=="auto"?this.getAxis(t):this.getBaseAxis();return{baseAxes:[e],otherAxes:[this.getOtherAxis(e)]}},i.prototype.dataToPoint=function(t,e,r){return this.coordToPoint([this._radiusAxis.dataToRadius(t[0],e),this._angleAxis.dataToAngle(t[1],e)],r)},i.prototype.pointToData=function(t,e,r){r=r||[];var n=this.pointToCoord(t);return r[0]=this._radiusAxis.radiusToData(n[0],e),r[1]=this._angleAxis.angleToData(n[1],e),r},i.prototype.pointToCoord=function(t){var e=t[0]-this.cx,r=t[1]-this.cy,n=this.getAngleAxis(),o=n.getExtent(),s=Math.min(o[0],o[1]),a=Math.max(o[0],o[1]);n.inverse?s=a-360:a=s+360;var c=Math.sqrt(e*e+r*r);e/=c,r/=c;for(var f=Math.atan2(-r,e)/Math.PI*180,g=f<s?1:-1;f<s||f>a;)f+=g*360;return[c,f]},i.prototype.coordToPoint=function(t,e){e=e||[];var r=t[0],n=t[1]/180*Math.PI;return e[0]=Math.cos(n)*r+this.cx,e[1]=-Math.sin(n)*r+this.cy,e},i.prototype.getArea=function(){var t=this.getAngleAxis(),e=this.getRadiusAxis(),r=e.getExtent().slice();r[0]>r[1]&&r.reverse();var n=t.getExtent(),o=Math.PI/180,s=1e-4;return{cx:this.cx,cy:this.cy,r0:r[0],r:r[1],startAngle:-n[0]*o,endAngle:-n[1]*o,clockwise:t.inverse,contain:function(a,c){var f=a-this.cx,g=c-this.cy,v=f*f+g*g,y=this.r,w=this.r0;return y!==w&&v-s<=y*y&&v+s>=w*w},x:this.cx-r[1],y:this.cy-r[1],width:r[1]*2,height:r[1]*2}},i.prototype.convertToPixel=function(t,e,r){var n=jZ(e);return n===this?this.dataToPoint(r):null},i.prototype.convertFromPixel=function(t,e,r){var n=jZ(e);return n===this?this.pointToData(r):null},i}();function jZ(i){var t=i.seriesModel,e=i.polarModel;return e&&e.coordinateSystem||t&&t.coordinateSystem}const bOt=xOt;function wOt(i,t,e){var r=t.get("center"),n=No(t,e).refContainer;i.cx=xi(r[0],n.width)+n.x,i.cy=xi(r[1],n.height)+n.y;var o=i.getRadiusAxis(),s=Math.min(n.width,n.height)/2,a=t.get("radius");a==null?a=[0,"100%"]:Ye(a)||(a=[0,a]);var c=[xi(a[0],s),xi(a[1],s)];o.inverse?o.setExtent(c[1],c[0]):o.setExtent(c[0],c[1])}function SOt(i,t){var e=this,r=e.getAngleAxis(),n=e.getRadiusAxis();if(r.scale.setExtent(1/0,-1/0),n.scale.setExtent(1/0,-1/0),i.eachSeries(function(a){if(a.coordinateSystem===e){var c=a.getData();pt(QC(c,"radius"),function(f){n.scale.unionExtentFromData(c,f)}),pt(QC(c,"angle"),function(f){r.scale.unionExtentFromData(c,f)})}}),I0(r.scale,r.model),I0(n.scale,n.model),r.type==="category"&&!r.onBand){var o=r.getExtent(),s=360/r.scale.count();r.inverse?o[1]+=s:o[1]-=s,r.setExtent(o[0],o[1])}}function TOt(i){return i.mainType==="angleAxis"}function WZ(i,t){var e;if(i.type=t.get("type"),i.scale=AE(t),i.onBand=t.get("boundaryGap")&&i.type==="category",i.inverse=t.get("inverse"),TOt(t)){i.inverse=i.inverse!==t.get("clockwise");var r=t.get("startAngle"),n=(e=t.get("endAngle"))!==null&&e!==void 0?e:r+(i.inverse?-360:360);i.setExtent(r,n)}t.axis=i,i.model=t}var AOt={dimensions:hrt,create:function(i,t){var e=[];return i.eachComponent("polar",function(r,n){var o=new bOt(n+"");o.update=SOt;var s=o.getRadiusAxis(),a=o.getAngleAxis(),c=r.findAxisModel("radiusAxis"),f=r.findAxisModel("angleAxis");WZ(s,c),WZ(a,f),wOt(o,r,t),e.push(o),r.coordinateSystem=o,o.model=r}),i.eachSeries(function(r){if(r.get("coordinateSystem")==="polar"){var n=r.getReferringComponents("polar",Wa).models[0];r.coordinateSystem=n.coordinateSystem}}),e}};const IOt=AOt;var COt=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function sI(i,t,e){t[1]>t[0]&&(t=t.slice().reverse());var r=i.coordToPoint([t[0],e]),n=i.coordToPoint([t[1],e]);return{x1:r[0],y1:r[1],x2:n[0],y2:n[1]}}function lI(i){var t=i.getRadiusAxis();return t.inverse?0:1}function $Z(i){var t=i[0],e=i[i.length-1];t&&e&&Math.abs(Math.abs(t.coord-e.coord)-360)<1e-4&&i.pop()}var MOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="PolarAxisPointer",e}return t.prototype.render=function(e,r){if(this.group.removeAll(),!!e.get("show")){var n=e.axis,o=n.polar,s=o.getRadiusAxis().getExtent(),a=n.getTicksCoords({breakTicks:"none"}),c=n.getMinorTicksCoords(),f=ti(n.getViewLabels(),function(g){g=Yi(g);var v=n.scale,y=v.type==="ordinal"?v.getRawOrdinalNumber(g.tickValue):g.tickValue;return g.coord=n.dataToCoord(y),g});$Z(f),$Z(a),pt(COt,function(g){e.get([g,"show"])&&(!n.scale.isBlank()||g==="axisLine")&&EOt[g](this.group,e,o,a,c,s,f)},this)}},t.type="angleAxis",t}(zv),EOt={axisLine:function(i,t,e,r,n,o){var s=t.getModel(["axisLine","lineStyle"]),a=e.getAngleAxis(),c=Math.PI/180,f=a.getExtent(),g=lI(e),v=g?0:1,y,w=Math.abs(f[1]-f[0])===360?"Circle":"Arc";o[v]===0?y=new Ev[w]({shape:{cx:e.cx,cy:e.cy,r:o[g],startAngle:-f[0]*c,endAngle:-f[1]*c,clockwise:a.inverse},style:s.getLineStyle(),z2:1,silent:!0}):y=new dE({shape:{cx:e.cx,cy:e.cy,r:o[g],r0:o[v]},style:s.getLineStyle(),z2:1,silent:!0}),y.style.fill=null,i.add(y)},axisTick:function(i,t,e,r,n,o){var s=t.getModel("axisTick"),a=(s.get("inside")?-1:1)*s.get("length"),c=o[lI(e)],f=ti(r,function(g){return new Oo({shape:sI(e,[c,c+a],g.coord)})});i.add(Mu(f,{style:rr(s.getModel("lineStyle").getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])})}))},minorTick:function(i,t,e,r,n,o){if(n.length){for(var s=t.getModel("axisTick"),a=t.getModel("minorTick"),c=(s.get("inside")?-1:1)*a.get("length"),f=o[lI(e)],g=[],v=0;v<n.length;v++)for(var y=0;y<n[v].length;y++)g.push(new Oo({shape:sI(e,[f,f+c],n[v][y].coord)}));i.add(Mu(g,{style:rr(a.getModel("lineStyle").getLineStyle(),rr(s.getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])}))}))}},axisLabel:function(i,t,e,r,n,o,s){var a=t.getCategories(!0),c=t.getModel("axisLabel"),f=c.get("margin"),g=t.get("triggerEvent");pt(s,function(v,y){var w=c,I=v.tickValue,E=o[lI(e)],D=e.coordToPoint([E+f,v.coord]),R=e.cx,z=e.cy,N=Math.abs(D[0]-R)/E<.3?"center":D[0]>R?"left":"right",H=Math.abs(D[1]-z)/E<.3?"middle":D[1]>z?"top":"bottom";if(a&&a[I]){var q=a[I];nr(q)&&q.textStyle&&(w=new bn(q.textStyle,c,c.ecModel))}var Y=new _n({silent:Fd.isLabelSilent(t),style:pa(w,{x:D[0],y:D[1],fill:w.getTextColor()||t.get(["axisLine","lineStyle","color"]),text:v.formattedLabel,align:N,verticalAlign:H})});if(i.add(Y),Wd({el:Y,componentModel:t,itemName:v.formattedLabel,formatterParamsExtra:{isTruncated:function(){return Y.isTruncated},value:v.rawLabel,tickIndex:y}}),g){var J=Fd.makeAxisEventDataBase(t);J.targetType="axisLabel",J.value=v.rawLabel,cr(Y).eventData=J}},this)},splitLine:function(i,t,e,r,n,o){var s=t.getModel("splitLine"),a=s.getModel("lineStyle"),c=a.get("color"),f=0;c=c instanceof Array?c:[c];for(var g=[],v=0;v<r.length;v++){var y=f++%c.length;g[y]=g[y]||[],g[y].push(new Oo({shape:sI(e,o,r[v].coord)}))}for(var v=0;v<g.length;v++)i.add(Mu(g[v],{style:rr({stroke:c[v%c.length]},a.getLineStyle()),silent:!0,z:t.get("z")}))},minorSplitLine:function(i,t,e,r,n,o){if(n.length){for(var s=t.getModel("minorSplitLine"),a=s.getModel("lineStyle"),c=[],f=0;f<n.length;f++)for(var g=0;g<n[f].length;g++)c.push(new Oo({shape:sI(e,o,n[f][g].coord)}));i.add(Mu(c,{style:a.getLineStyle(),silent:!0,z:t.get("z")}))}},splitArea:function(i,t,e,r,n,o){if(r.length){var s=t.getModel("splitArea"),a=s.getModel("areaStyle"),c=a.get("color"),f=0;c=c instanceof Array?c:[c];for(var g=[],v=Math.PI/180,y=-r[0].coord*v,w=Math.min(o[0],o[1]),I=Math.max(o[0],o[1]),E=t.get("clockwise"),D=1,R=r.length;D<=R;D++){var z=D===R?r[0].coord:r[D].coord,N=f++%c.length;g[N]=g[N]||[],g[N].push(new pl({shape:{cx:e.cx,cy:e.cy,r0:w,r:I,startAngle:y,endAngle:-z*v,clockwise:E},silent:!0})),y=-z*v}for(var D=0;D<g.length;D++)i.add(Mu(g[D],{style:rr({fill:c[D%c.length]},a.getAreaStyle()),silent:!0}))}}};const DOt=MOt;var POt=["splitLine","splitArea","minorSplitLine"],LOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="PolarAxisPointer",e}return t.prototype.render=function(e,r,n){if(this.group.removeAll(),!!e.get("show")){var o=this._axisGroup,s=this._axisGroup=new Ki;this.group.add(s);var a=e.axis,c=a.polar,f=c.getAngleAxis(),g=a.getTicksCoords(),v=a.getMinorTicksCoords(),y=f.getExtent()[0],w=a.getExtent(),I=kOt(c,e,y),E=new Fd(e,n,I);E.build(),s.add(E.group),VS(o,s,e),pt(POt,function(D){e.get([D,"show"])&&!a.scale.isBlank()&&ROt[D](this.group,e,c,y,w,g,v)},this)}},t.type="radiusAxis",t}(zv),ROt={splitLine:function(i,t,e,r,n,o){var s=t.getModel("splitLine"),a=s.getModel("lineStyle"),c=a.get("color"),f=0,g=e.getAngleAxis(),v=Math.PI/180,y=g.getExtent(),w=Math.abs(y[1]-y[0])===360?"Circle":"Arc";c=c instanceof Array?c:[c];for(var I=[],E=0;E<o.length;E++){var D=f++%c.length;I[D]=I[D]||[],I[D].push(new Ev[w]({shape:{cx:e.cx,cy:e.cy,r:Math.max(o[E].coord,0),startAngle:-y[0]*v,endAngle:-y[1]*v,clockwise:g.inverse}}))}for(var E=0;E<I.length;E++)i.add(Mu(I[E],{style:rr({stroke:c[E%c.length],fill:null},a.getLineStyle()),silent:!0}))},minorSplitLine:function(i,t,e,r,n,o,s){if(s.length){for(var a=t.getModel("minorSplitLine"),c=a.getModel("lineStyle"),f=[],g=0;g<s.length;g++)for(var v=0;v<s[g].length;v++)f.push(new Wp({shape:{cx:e.cx,cy:e.cy,r:s[g][v].coord}}));i.add(Mu(f,{style:rr({fill:null},c.getLineStyle()),silent:!0}))}},splitArea:function(i,t,e,r,n,o){if(o.length){var s=t.getModel("splitArea"),a=s.getModel("areaStyle"),c=a.get("color"),f=0;c=c instanceof Array?c:[c];for(var g=[],v=o[0].coord,y=1;y<o.length;y++){var w=f++%c.length;g[w]=g[w]||[],g[w].push(new pl({shape:{cx:e.cx,cy:e.cy,r0:v,r:o[y].coord,startAngle:0,endAngle:Math.PI*2},silent:!0})),v=o[y].coord}for(var y=0;y<g.length;y++)i.add(Mu(g[y],{style:rr({fill:c[y%c.length]},a.getAreaStyle()),silent:!0}))}}};function kOt(i,t,e){return{position:[i.cx,i.cy],rotation:e/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:t.getModel("axisLabel").get("rotate"),z2:1}}const OOt=LOt;function drt(i){return i.get("stack")||"__ec_stack_"+i.seriesIndex}function frt(i,t){return t.dim+i.model.componentIndex}function zOt(i,t,e){var r={},n=BOt(kn(t.getSeriesByType(i),function(o){return!t.isSeriesFiltered(o)&&o.coordinateSystem&&o.coordinateSystem.type==="polar"}));t.eachSeriesByType(i,function(o){if(o.coordinateSystem.type==="polar"){var s=o.getData(),a=o.coordinateSystem,c=a.getBaseAxis(),f=frt(a,c),g=drt(o),v=n[f][g],y=v.offset,w=v.width,I=a.getOtherAxis(c),E=o.coordinateSystem.cx,D=o.coordinateSystem.cy,R=o.get("barMinHeight")||0,z=o.get("barMinAngle")||0;r[g]=r[g]||[];for(var N=s.mapDimension(I.dim),H=s.mapDimension(c.dim),q=zp(s,N),Y=c.dim!=="radius"||!o.get("roundCap",!0),J=I.model,it=J.get("startValue"),at=I.dataToCoord(it||0),ut=0,ft=s.count();ut<ft;ut++){var _t=s.get(N,ut),ct=s.get(H,ut),Dt=_t>=0?"p":"n",Et=at;q&&(r[g][ct]||(r[g][ct]={p:at,n:at}),Et=r[g][ct][Dt]);var bt=void 0,Vt=void 0,zt=void 0,Jt=void 0;if(I.dim==="radius"){var ce=I.dataToCoord(_t)-at,be=c.dataToCoord(ct);Math.abs(ce)<R&&(ce=(ce<0?-1:1)*R),bt=Et,Vt=Et+ce,zt=be-y,Jt=zt-w,q&&(r[g][ct][Dt]=Vt)}else{var ve=I.dataToCoord(_t,Y)-at,ke=c.dataToCoord(ct);Math.abs(ve)<z&&(ve=(ve<0?-1:1)*z),bt=ke+y,Vt=bt+w,zt=Et,Jt=Et+ve,q&&(r[g][ct][Dt]=Jt)}s.setItemLayout(ut,{cx:E,cy:D,r0:bt,r:Vt,startAngle:-zt*Math.PI/180,endAngle:-Jt*Math.PI/180,clockwise:zt>=Jt})}}})}function BOt(i){var t={};pt(i,function(r,n){var o=r.getData(),s=r.coordinateSystem,a=s.getBaseAxis(),c=frt(s,a),f=a.getExtent(),g=a.type==="category"?a.getBandWidth():Math.abs(f[1]-f[0])/o.count(),v=t[c]||{bandWidth:g,remainedWidth:g,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},y=v.stacks;t[c]=v;var w=drt(r);y[w]||v.autoWidthCount++,y[w]=y[w]||{width:0,maxWidth:0};var I=xi(r.get("barWidth"),g),E=xi(r.get("barMaxWidth"),g),D=r.get("barGap"),R=r.get("barCategoryGap");I&&!y[w].width&&(I=Math.min(v.remainedWidth,I),y[w].width=I,v.remainedWidth-=I),E&&(y[w].maxWidth=E),D!=null&&(v.gap=D),R!=null&&(v.categoryGap=R)});var e={};return pt(t,function(r,n){e[n]={};var o=r.stacks,s=r.bandWidth,a=xi(r.categoryGap,s),c=xi(r.gap,1),f=r.remainedWidth,g=r.autoWidthCount,v=(f-a)/(g+(g-1)*c);v=Math.max(v,0),pt(o,function(E,D){var R=E.maxWidth;R&&R<v&&(R=Math.min(R,f),E.width&&(R=Math.min(R,E.width)),f-=R,E.width=R,g--)}),v=(f-a)/(g+(g-1)*c),v=Math.max(v,0);var y=0,w;pt(o,function(E,D){E.width||(E.width=v),w=E,y+=E.width*(1+c)}),w&&(y-=w.width*c);var I=-y/2;pt(o,function(E,D){e[n][D]=e[n][D]||{offset:I,width:E.width},I+=E.width*(1+c)})}),e}var FOt={startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:0}},NOt={splitNumber:5},VOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="polar",t}(Oa);function UOt(i){Rr(QS),zv.registerAxisPointerClass("PolarAxisPointer",dOt),i.registerCoordinateSystem("polar",IOt),i.registerComponentModel(pOt),i.registerComponentView(VOt),E0(i,"angle",gOt,FOt),E0(i,"radius",mOt,NOt),i.registerComponentView(DOt),i.registerComponentView(OOt),i.registerLayout(br(zOt,"bar"))}function pB(i,t){t=t||{};var e=i.coordinateSystem,r=i.axis,n={},o=r.position,s=r.orient,a=e.getRect(),c=[a.x,a.x+a.width,a.y,a.y+a.height],f={horizontal:{top:c[2],bottom:c[3]},vertical:{left:c[0],right:c[1]}};n.position=[s==="vertical"?f.vertical[o]:c[0],s==="horizontal"?f.horizontal[o]:c[3]];var g={horizontal:0,vertical:1};n.rotation=Math.PI/2*g[s];var v={top:-1,bottom:1,right:1,left:-1};n.labelDirection=n.tickDirection=n.nameDirection=v[o],i.get(["axisTick","inside"])&&(n.tickDirection=-n.tickDirection),vs(t.labelInside,i.get(["axisLabel","inside"]))&&(n.labelDirection=-n.labelDirection);var y=i.get(["axisLabel","rotate"]);return n.labelRotate=o==="top"?-y:y,n.z2=1,n}var GOt=["splitArea","splitLine","breakArea"],HOt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.axisPointerClass="SingleAxisPointer",e}return t.prototype.render=function(e,r,n,o){var s=this.group;s.removeAll();var a=this._axisGroup;this._axisGroup=new Ki;var c=pB(e),f=new Fd(e,n,c);f.build(),s.add(this._axisGroup),s.add(f.group),pt(GOt,function(g){e.get([g,"show"])&&jOt[g](this,this.group,this._axisGroup,e,n)},this),VS(a,this._axisGroup,e),i.prototype.render.call(this,e,r,n,o)},t.prototype.remove=function(){Eet(this)},t.type="singleAxis",t}(zv),jOt={splitLine:function(i,t,e,r,n){var o=r.axis;if(!o.scale.isBlank()){var s=r.getModel("splitLine"),a=s.getModel("lineStyle"),c=a.get("color");c=c instanceof Array?c:[c];for(var f=a.get("width"),g=r.coordinateSystem.getRect(),v=o.isHorizontal(),y=[],w=0,I=o.getTicksCoords({tickModel:s,breakTicks:"none",pruneByBreak:"preserve_extent_bound"}),E=[],D=[],R=0;R<I.length;++R){var z=o.toGlobalCoord(I[R].coord);v?(E[0]=z,E[1]=g.y,D[0]=z,D[1]=g.y+g.height):(E[0]=g.x,E[1]=z,D[0]=g.x+g.width,D[1]=z);var N=new Oo({shape:{x1:E[0],y1:E[1],x2:D[0],y2:D[1]},silent:!0});S0(N.shape,f);var H=w++%c.length;y[H]=y[H]||[],y[H].push(N)}for(var q=a.getLineStyle(["color"]),R=0;R<y.length;++R)t.add(Mu(y[R],{style:rr({stroke:c[R%c.length]},q),silent:!0}))}},splitArea:function(i,t,e,r,n){Met(i,e,r,r)},breakArea:function(i,t,e,r,n){var o=JS(),s=r.axis.scale;o&&s.type!=="ordinal"&&o.rectCoordBuildBreakAxis(t,i,r,r.coordinateSystem.getRect(),n)}};const WOt=HOt;var prt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getCoordSysModel=function(){return this},t.type="singleAxis",t.layoutMode="box",t.defaultOption={left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:!0,lineStyle:{width:1,type:"solid"}},tooltip:{show:!0},axisTick:{show:!0,length:6,lineStyle:{width:1}},axisLabel:{show:!0,interval:"auto"},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}},jitter:0,jitterOverlap:!0,jitterMargin:2},t}(gn);Ao(prt,ZS.prototype);const bk=prt;var $Ot=function(i){Se(t,i);function t(e,r,n,o,s){var a=i.call(this,e,r,n)||this;return a.type=o||"value",a.position=s||"bottom",a}return t.prototype.isHorizontal=function(){var e=this.position;return e==="top"||e==="bottom"},t.prototype.pointToData=function(e,r){return this.coordinateSystem.pointToData(e)[0]},t}(Sc);const ZOt=$Ot;var grt=["single"],qOt=function(){function i(t,e,r){this.type="single",this.dimension="single",this.dimensions=grt,this.axisPointerEnabled=!0,this.model=t,this._init(t,e,r)}return i.prototype._init=function(t,e,r){var n=this.dimension,o=new ZOt(n,AE(t),[0,0],t.get("type"),t.get("position")),s=o.type==="category";o.onBand=s&&t.get("boundaryGap"),o.inverse=t.get("inverse"),o.orient=t.get("orient"),t.axis=o,o.model=t,o.coordinateSystem=this,this._axis=o},i.prototype.update=function(t,e){t.eachSeries(function(r){if(r.coordinateSystem===this){var n=r.getData();pt(n.mapDimensionsAll(this.dimension),function(o){this._axis.scale.unionExtentFromData(n,o)},this),I0(this._axis.scale,this._axis.model)}},this)},i.prototype.resize=function(t,e){var r=No(t,e).refContainer;this._rect=Ma(t.getBoxLayoutParams(),r),this._adjustAxis()},i.prototype.getRect=function(){return this._rect},i.prototype._adjustAxis=function(){var t=this._rect,e=this._axis,r=e.isHorizontal(),n=r?[0,t.width]:[0,t.height],o=e.inverse?1:0;e.setExtent(n[o],n[1-o]),this._updateAxisTransform(e,r?t.x:t.y)},i.prototype._updateAxisTransform=function(t,e){var r=t.getExtent(),n=r[0]+r[1],o=t.isHorizontal();t.toGlobalCoord=o?function(s){return s+e}:function(s){return n-s+e},t.toLocalCoord=o?function(s){return s-e}:function(s){return n-s+e}},i.prototype.getAxis=function(){return this._axis},i.prototype.getBaseAxis=function(){return this._axis},i.prototype.getAxes=function(){return[this._axis]},i.prototype.getTooltipAxes=function(){return{baseAxes:[this.getAxis()],otherAxes:[]}},i.prototype.containPoint=function(t){var e=this.getRect(),r=this.getAxis(),n=r.orient;return n==="horizontal"?r.contain(r.toLocalCoord(t[0]))&&t[1]>=e.y&&t[1]<=e.y+e.height:r.contain(r.toLocalCoord(t[1]))&&t[0]>=e.y&&t[0]<=e.y+e.height},i.prototype.pointToData=function(t,e,r){r=r||[];var n=this.getAxis();return r[0]=n.coordToData(n.toLocalCoord(t[n.orient==="horizontal"?0:1])),r},i.prototype.dataToPoint=function(t,e,r){var n=this.getAxis(),o=this.getRect();r=r||[];var s=n.orient==="horizontal"?0:1;return t instanceof Array&&(t=t[0]),r[s]=n.toGlobalCoord(n.dataToCoord(+t)),r[1-s]=s===0?o.y+o.height/2:o.x+o.width/2,r},i.prototype.convertToPixel=function(t,e,r){var n=ZZ(e);return n===this?this.dataToPoint(r):null},i.prototype.convertFromPixel=function(t,e,r){var n=ZZ(e);return n===this?this.pointToData(r):null},i}();function ZZ(i){var t=i.seriesModel,e=i.singleAxisModel;return e&&e.coordinateSystem||t&&t.coordinateSystem}function XOt(i,t){var e=[];return i.eachComponent("singleAxis",function(r,n){var o=new qOt(r,i,t);o.name="single_"+n,o.resize(r,t),r.coordinateSystem=o,e.push(o)}),i.eachSeries(function(r){if(r.get("coordinateSystem")==="singleAxis"){var n=r.getReferringComponents("singleAxis",Wa).models[0];r.coordinateSystem=n&&n.coordinateSystem}}),e}var YOt={create:XOt,dimensions:grt};const KOt=YOt;var qZ=["x","y"],JOt=["width","height"],QOt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.makeElOption=function(e,r,n,o,s){var a=n.axis,c=a.coordinateSystem,f=wk(c,1-yM(a)),g=c.dataToPoint(r)[0],v=o.get("type");if(v&&v!=="none"){var y=bN(o),w=tzt[v](a,g,f);w.style=y,e.graphicKey=w.type,e.pointer=w}var I=pB(n);srt(r,e,I,n,o,s)},t.prototype.getHandleTransform=function(e,r,n){var o=pB(r,{labelInside:!1});o.labelMargin=n.get(["handle","margin"]);var s=wN(r.axis,e,o);return{x:s[0],y:s[1],rotation:o.rotation+(o.labelDirection<0?Math.PI:0)}},t.prototype.updateHandleTransform=function(e,r,n,o){var s=n.axis,a=s.coordinateSystem,c=yM(s),f=wk(a,c),g=[e.x,e.y];g[c]+=r[c],g[c]=Math.min(f[1],g[c]),g[c]=Math.max(f[0],g[c]);var v=wk(a,1-c),y=(v[1]+v[0])/2,w=[y,y];return w[c]=g[c],{x:g[0],y:g[1],rotation:e.rotation,cursorPoint:w,tooltipOption:{verticalAlign:"middle"}}},t}(xN),tzt={line:function(i,t,e){var r=SN([t,e[0]],[t,e[1]],yM(i));return{type:"Line",subPixelOptimize:!0,shape:r}},shadow:function(i,t,e){var r=i.getBandWidth(),n=e[1]-e[0];return{type:"Rect",shape:lrt([t-r/2,e[0]],[r,n],yM(i))}}};function yM(i){return i.isHorizontal()?0:1}function wk(i,t){var e=i.getRect();return[e[qZ[t]],e[qZ[t]]+e[JOt[t]]]}const ezt=QOt;var izt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="single",t}(Oa);function rzt(i){Rr(QS),zv.registerAxisPointerClass("SingleAxisPointer",ezt),i.registerComponentView(izt),i.registerComponentView(WOt),i.registerComponentModel(bk),E0(i,"single",bk,bk.defaultOption),i.registerCoordinateSystem("single",KOt)}var nzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r,n){var o=Pv(e);i.prototype.init.apply(this,arguments),XZ(e,o)},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),XZ(this.option,e)},t.prototype.getCellSize=function(){return this.option.cellSize},t.type="calendar",t.layoutMode="box",t.defaultOption={z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:ye.color.axisLine,width:1,type:"solid"}},itemStyle:{color:ye.color.neutral00,borderWidth:1,borderColor:ye.color.neutral10},dayLabel:{show:!0,firstDay:0,position:"start",margin:ye.size.s,color:ye.color.secondary},monthLabel:{show:!0,position:"start",margin:ye.size.s,align:"center",formatter:null,color:ye.color.secondary},yearLabel:{show:!0,position:null,margin:ye.size.xl,formatter:null,color:ye.color.quaternary,fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},t}(gn);function XZ(i,t){var e=i.cellSize,r;Ye(e)?r=e:r=i.cellSize=[e,e],r.length===1&&(r[1]=r[0]);var n=ti([0,1],function(o){return T1t(t,o)&&(r[o]="auto"),r[o]!=null&&r[o]!=="auto"});Th(i,t,{type:"box",ignoreSize:n})}const azt=nzt;var ozt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){var o=this.group;o.removeAll();var s=e.coordinateSystem,a=s.getRangeInfo(),c=s.getOrient(),f=r.getLocaleModel();this._renderDayRect(e,a,o),this._renderLines(e,a,c,o),this._renderYearText(e,a,c,o),this._renderMonthText(e,f,c,o),this._renderWeekText(e,f,a,c,o)},t.prototype._renderDayRect=function(e,r,n){for(var o=e.coordinateSystem,s=e.getModel("itemStyle").getItemStyle(),a=o.getCellWidth(),c=o.getCellHeight(),f=r.start.time;f<=r.end.time;f=o.getNextNDay(f,1).time){var g=o.dataToCalendarLayout([f],!1).tl,v=new jr({shape:{x:g[0],y:g[1],width:a,height:c},cursor:"default",style:s});n.add(v)}},t.prototype._renderLines=function(e,r,n,o){var s=this,a=e.coordinateSystem,c=e.getModel(["splitLine","lineStyle"]).getLineStyle(),f=e.get(["splitLine","show"]),g=c.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var v=r.start,y=0;v.time<=r.end.time;y++){I(v.formatedDate),y===0&&(v=a.getDateInfo(r.start.y+"-"+r.start.m));var w=v.date;w.setMonth(w.getMonth()+1),v=a.getDateInfo(w)}I(a.getNextNDay(r.end.time,1).formatedDate);function I(E){s._firstDayOfMonth.push(a.getDateInfo(E)),s._firstDayPoints.push(a.dataToCalendarLayout([E],!1).tl);var D=s._getLinePointsOfOneWeek(e,E,n);s._tlpoints.push(D[0]),s._blpoints.push(D[D.length-1]),f&&s._drawSplitline(D,c,o)}f&&this._drawSplitline(s._getEdgesPoints(s._tlpoints,g,n),c,o),f&&this._drawSplitline(s._getEdgesPoints(s._blpoints,g,n),c,o)},t.prototype._getEdgesPoints=function(e,r,n){var o=[e[0].slice(),e[e.length-1].slice()],s=n==="horizontal"?0:1;return o[0][s]=o[0][s]-r/2,o[1][s]=o[1][s]+r/2,o},t.prototype._drawSplitline=function(e,r,n){var o=new Us({z2:20,shape:{points:e},style:r});n.add(o)},t.prototype._getLinePointsOfOneWeek=function(e,r,n){for(var o=e.coordinateSystem,s=o.getDateInfo(r),a=[],c=0;c<7;c++){var f=o.getNextNDay(s.time,c),g=o.dataToCalendarLayout([f.time],!1);a[2*f.day]=g.tl,a[2*f.day+1]=g[n==="horizontal"?"bl":"tr"]}return a},t.prototype._formatterLabel=function(e,r){return wi(e)&&e?_1t(e,r):Xi(e)?e(r):r.nameMap},t.prototype._yearTextPositionControl=function(e,r,n,o,s){var a=r[0],c=r[1],f=["center","bottom"];o==="bottom"?(c+=s,f=["center","top"]):o==="left"?a-=s:o==="right"?(a+=s,f=["center","top"]):c-=s;var g=0;return(o==="left"||o==="right")&&(g=Math.PI/2),{rotation:g,x:a,y:c,style:{align:f[0],verticalAlign:f[1]}}},t.prototype._renderYearText=function(e,r,n,o){var s=e.getModel("yearLabel");if(s.get("show")){var a=s.get("margin"),c=s.get("position");c||(c=n!=="horizontal"?"top":"left");var f=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],g=(f[0][0]+f[1][0])/2,v=(f[0][1]+f[1][1])/2,y=n==="horizontal"?0:1,w={top:[g,f[y][1]],bottom:[g,f[1-y][1]],left:[f[1-y][0],v],right:[f[y][0],v]},I=r.start.y;+r.end.y>+r.start.y&&(I=I+"-"+r.end.y);var E=s.get("formatter"),D={start:r.start.y,end:r.end.y,nameMap:I},R=this._formatterLabel(E,D),z=new _n({z2:30,style:pa(s,{text:R}),silent:s.get("silent")});z.attr(this._yearTextPositionControl(z,w[c],n,c,a)),o.add(z)}},t.prototype._monthTextPositionControl=function(e,r,n,o,s){var a="left",c="top",f=e[0],g=e[1];return n==="horizontal"?(g=g+s,r&&(a="center"),o==="start"&&(c="bottom")):(f=f+s,r&&(c="middle"),o==="start"&&(a="right")),{x:f,y:g,align:a,verticalAlign:c}},t.prototype._renderMonthText=function(e,r,n,o){var s=e.getModel("monthLabel");if(s.get("show")){var a=s.get("nameMap"),c=s.get("margin"),f=s.get("position"),g=s.get("align"),v=[this._tlpoints,this._blpoints];(!a||wi(a))&&(a&&(r=hz(a)||r),a=r.get(["time","monthAbbr"])||[]);var y=f==="start"?0:1,w=n==="horizontal"?0:1;c=f==="start"?-c:c;for(var I=g==="center",E=s.get("silent"),D=0;D<v[y].length-1;D++){var R=v[y][D].slice(),z=this._firstDayOfMonth[D];if(I){var N=this._firstDayPoints[D];R[w]=(N[w]+v[0][D+1][w])/2}var H=s.get("formatter"),q=a[+z.m-1],Y={yyyy:z.y,yy:(z.y+"").slice(2),MM:z.m,M:+z.m,nameMap:q},J=this._formatterLabel(H,Y),it=new _n({z2:30,style:Ne(pa(s,{text:J}),this._monthTextPositionControl(R,I,n,f,c)),silent:E});o.add(it)}}},t.prototype._weekTextPositionControl=function(e,r,n,o,s){var a="center",c="middle",f=e[0],g=e[1],v=n==="start";return r==="horizontal"?(f=f+o+(v?1:-1)*s[0]/2,a=v?"right":"left"):(g=g+o+(v?1:-1)*s[1]/2,c=v?"bottom":"top"),{x:f,y:g,align:a,verticalAlign:c}},t.prototype._renderWeekText=function(e,r,n,o,s){var a=e.getModel("dayLabel");if(a.get("show")){var c=e.coordinateSystem,f=a.get("position"),g=a.get("nameMap"),v=a.get("margin"),y=c.getFirstDayOfWeek();if(!g||wi(g)){g&&(r=hz(g)||r);var w=r.get(["time","dayOfWeekShort"]);g=w||ti(r.get(["time","dayOfWeekAbbr"]),function(Y){return Y[0]})}var I=c.getNextNDay(n.end.time,7-n.lweek).time,E=[c.getCellWidth(),c.getCellHeight()];v=xi(v,Math.min(E[1],E[0])),f==="start"&&(I=c.getNextNDay(n.start.time,-(7+n.fweek)).time,v=-v);for(var D=a.get("silent"),R=0;R<7;R++){var z=c.getNextNDay(I,R),N=c.dataToCalendarLayout([z.time],!1).center,H=R;H=Math.abs((R+y)%7);var q=new _n({z2:30,style:Ne(pa(a,{text:g[H]}),this._weekTextPositionControl(N,o,f,v,E)),silent:D});s.add(q)}}},t.type="calendar",t}(Oa);const szt=ozt;var Sk=864e5,lzt=function(){function i(t,e,r){this.type="calendar",this.dimensions=i.dimensions,this.getDimensionsInfo=i.getDimensionsInfo,this._model=t,this._update(e,r)}return i.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]},i.prototype.getRangeInfo=function(){return this._rangeInfo},i.prototype.getModel=function(){return this._model},i.prototype.getRect=function(){return this._rect},i.prototype.getCellWidth=function(){return this._sw},i.prototype.getCellHeight=function(){return this._sh},i.prototype.getOrient=function(){return this._orient},i.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek},i.prototype.getDateInfo=function(t){t=Mv(t);var e=t.getFullYear(),r=t.getMonth()+1,n=r<10?"0"+r:""+r,o=t.getDate(),s=o<10?"0"+o:""+o,a=t.getDay();return a=Math.abs((a+7-this.getFirstDayOfWeek())%7),{y:e+"",m:n,d:s,day:a,time:t.getTime(),formatedDate:e+"-"+n+"-"+s,date:t}},i.prototype.getNextNDay=function(t,e){return e=e||0,e===0?this.getDateInfo(t):(t=new Date(this.getDateInfo(t).time),t.setDate(t.getDate()+e),this.getDateInfo(t))},i.prototype._update=function(t,e){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var r=this._rangeInfo.weeks||1,n=["width","height"],o=this._model.getCellSize().slice(),s=this._model.getBoxLayoutParams(),a=this._orient==="horizontal"?[r,7]:[7,r];pt([0,1],function(v){g(o,v)&&(s[n[v]]=o[v]*a[v])});var c={width:e.getWidth(),height:e.getHeight()},f=this._rect=Ma(s,c);pt([0,1],function(v){g(o,v)||(o[v]=f[n[v]]/a[v])});function g(v,y){return v[y]!=null&&v[y]!=="auto"}this._sw=o[0],this._sh=o[1]},i.prototype.dataToPoint=function(t,e,r){r=r||[],Ye(t)&&(t=t[0]),e==null&&(e=!0);var n=this.getDateInfo(t),o=this._rangeInfo,s=n.formatedDate;if(e&&!(n.time>=o.start.time&&n.time<o.end.time+Sk))return r[0]=r[1]=NaN,r;var a=n.day,c=this._getRangeInfo([o.start.time,s]).nthWeek;return this._orient==="vertical"?(r[0]=this._rect.x+a*this._sw+this._sw/2,r[1]=this._rect.y+c*this._sh+this._sh/2):(r[0]=this._rect.x+c*this._sw+this._sw/2,r[1]=this._rect.y+a*this._sh+this._sh/2),r},i.prototype.pointToData=function(t){var e=this.pointToDate(t);return e&&e.time},i.prototype.dataToLayout=function(t,e,r){r=r||{};var n=r.rect=r.rect||{},o=r.contentRect=r.contentRect||{},s=this.dataToPoint(t,e);return n.x=s[0]-this._sw/2,n.y=s[1]-this._sh/2,n.width=this._sw,n.height=this._sh,sr.copy(o,n),xv(o,this._lineWidth/2,!0,!0),r},i.prototype.dataToCalendarLayout=function(t,e){var r=this.dataToPoint(t,e);return{center:r,tl:[r[0]-this._sw/2,r[1]-this._sh/2],tr:[r[0]+this._sw/2,r[1]-this._sh/2],br:[r[0]+this._sw/2,r[1]+this._sh/2],bl:[r[0]-this._sw/2,r[1]+this._sh/2]}},i.prototype.pointToDate=function(t){var e=Math.floor((t[0]-this._rect.x)/this._sw)+1,r=Math.floor((t[1]-this._rect.y)/this._sh)+1,n=this._rangeInfo.range;return this._orient==="vertical"?this._getDateByWeeksAndDay(r,e-1,n):this._getDateByWeeksAndDay(e,r-1,n)},i.prototype.convertToPixel=function(t,e,r){var n=Tk(e);return n===this?n.dataToPoint(r):null},i.prototype.convertToLayout=function(t,e,r){var n=Tk(e);return n===this?n.dataToLayout(r):null},i.prototype.convertFromPixel=function(t,e,r){var n=Tk(e);return n===this?n.pointToData(r):null},i.prototype.containPoint=function(t){return console.warn("Not implemented."),!1},i.prototype._initRangeOption=function(){var t=this._model.get("range"),e;if(Ye(t)&&t.length===1&&(t=t[0]),Ye(t))e=t;else{var r=t.toString();if(/^\d{4}$/.test(r)&&(e=[r+"-01-01",r+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(r)){var n=this.getDateInfo(r),o=n.date;o.setMonth(o.getMonth()+1);var s=this.getNextNDay(o,-1);e=[n.formatedDate,s.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(r)&&(e=[r,r])}if(!e)return t;var a=this._getRangeInfo(e);return a.start.time>a.end.time&&e.reverse(),e},i.prototype._getRangeInfo=function(t){var e=[this.getDateInfo(t[0]),this.getDateInfo(t[1])],r;e[0].time>e[1].time&&(r=!0,e.reverse());var n=Math.floor(e[1].time/Sk)-Math.floor(e[0].time/Sk)+1,o=new Date(e[0].time),s=o.getDate(),a=e[1].date.getDate();o.setDate(s+n-1);var c=o.getDate();if(c!==a)for(var f=o.getTime()-e[1].time>0?1:-1;(c=o.getDate())!==a&&(o.getTime()-e[1].time)*f>0;)n-=f,o.setDate(c-f);var g=Math.floor((n+e[0].day+6)/7),v=r?-g+1:g-1;return r&&e.reverse(),{range:[e[0].formatedDate,e[1].formatedDate],start:e[0],end:e[1],allDay:n,weeks:g,nthWeek:v,fweek:e[0].day,lweek:e[1].day}},i.prototype._getDateByWeeksAndDay=function(t,e,r){var n=this._getRangeInfo(r);if(t>n.weeks||t===0&&e<n.fweek||t===n.weeks&&e>n.lweek)return null;var o=(t-1)*7-n.fweek+e,s=new Date(n.start.time);return s.setDate(+n.start.d+o),this.getDateInfo(s)},i.create=function(t,e){var r=[];return t.eachComponent("calendar",function(n){var o=new i(n,t,e);r.push(o),n.coordinateSystem=o}),t.eachComponent(function(n,o){jS({targetModel:o,coordSysType:"calendar",coordSysProvider:IJ})}),r},i.dimensions=["time","value"],i}();function Tk(i){var t=i.calendarModel,e=i.seriesModel,r=t?t.coordinateSystem:e?e.coordinateSystem:null;return r}const uzt=lzt;function czt(i){i.registerComponentModel(azt),i.registerComponentView(szt),i.registerCoordinateSystem("calendar",uzt)}var gd={level:1,leaf:2,nonLeaf:3},Ed={none:0,all:1,body:2,corner:3};function gB(i,t,e){var r=t[vr[e]].getCell(i);return!r&&fn(i)&&i<0&&(r=t[vr[1-e]].getUnitLayoutInfo(e,Math.round(i))),r}function mrt(i){var t=i||[];return t[0]=t[0]||[],t[1]=t[1]||[],t[0][0]=t[0][1]=t[1][0]=t[1][1]=NaN,t}function vrt(i,t,e,r,n){YZ(i[0],t,n,e,r,0),YZ(i[1],t,n,e,r,1)}function YZ(i,t,e,r,n,o){i[0]=1/0,i[1]=-1/0;var s=r[o],a=Ye(s)?s:[s],c=a.length,f=!!e;if(c>=1?(KZ(i,t,a,f,n,o,0),c>1&&KZ(i,t,a,f,n,o,c-1)):i[0]=i[1]=NaN,f){var g=-n[vr[1-o]].getLocatorCount(o),v=n[vr[o]].getLocatorCount(o)-1;e===Ed.body?g=co(0,g):e===Ed.corner&&(v=ru(-1,v)),v<g&&(g=v=NaN),Bs(i[0])&&(i[0]=g),Bs(i[1])&&(i[1]=v),i[0]=co(ru(i[0],v),g),i[1]=co(ru(i[1],v),g)}}function KZ(i,t,e,r,n,o,s){var a=gB(e[s],n,o);if(!a){i[0]=i[1]=NaN;return}var c=a.id[vr[o]],f=c,g=pzt(a);g&&(f+=g.span[vr[o]]-1),i[0]=ru(i[0],c,f),i[1]=co(i[1],c,f)}function uI(i,t){return Bs(i[t][0])||Bs(i[t][1])}function JZ(i,t,e,r){t=t||hzt;for(var n=0;n<r;n++)t[n]=!1;for(;;){for(var o=!1,n=0;n<r;n++){var s=e[n];!t[n]&&s.cellMergeOwner&&dzt(i,s.locatorRange)&&(t[n]=!0,o=!0)}if(!o)break}}var hzt=[];function dzt(i,t){return!QZ(i[0],t[0])||!QZ(i[1],t[1])?!1:(i[0][0]=ru(i[0][0],t[0][0]),i[0][1]=co(i[0][1],t[0][1]),i[1][0]=ru(i[1][0],t[1][0]),i[1][1]=co(i[1][1],t[1][1]),!0)}function QZ(i,t){return i[1]>=t[0]&&i[0]<=t[1]}function tq(i,t){i.id.set(t[0][0],t[1][0]),i.span.set(t[0][1]-i.id.x+1,t[1][1]-i.id.y+1)}function fzt(i,t){i[0][0]=t[0][0],i[0][1]=t[0][1],i[1][0]=t[1][0],i[1][1]=t[1][1]}function eq(i,t,e,r){var n=gB(t[r][0],e,r),o=gB(t[r][1],e,r);i[vr[r]]=i[wo[r]]=NaN,n&&o&&(i[vr[r]]=n.xy,i[wo[r]]=o.xy+o.wh-n.xy)}function Bb(i,t,e,r){return i[vr[t]]=e,i[vr[1-t]]=r,i}function pzt(i){return i&&(i.type===gd.leaf||i.type===gd.nonLeaf)?i:null}function xM(){return{x:NaN,y:NaN,width:NaN,height:NaN}}var iq=function(){function i(t,e){this._cells=[],this._levels=[],this.dim=t,this.dimIdx=t==="x"?0:1,this._model=e,this._uniqueValueGen=gzt(t);var r=e.get("data",!0);r!=null&&!Ye(r)&&(r=[]),r?this._initByDimModelData(r):this._initBySeriesData()}return i.prototype._initByDimModelData=function(t){var e=this,r=e._cells,n=e._levels,o=[],s=0;e._leavesCount=a(t,0,0),c();return;function a(f,g,v){var y=0;return f&&pt(f,function(w,I){var E;wi(w)?E={value:w}:nr(w)?(E=w,w.value!=null&&!wi(w.value)&&(E={value:null})):E={value:null};var D={type:gd.nonLeaf,ordinal:NaN,level:v,firstLeafLocator:g,id:new er,span:Bb(new er,e.dimIdx,1,1),option:E,xy:NaN,wh:NaN,dim:e,rect:xM()};s++,(o[g]||(o[g]=[])).push(D),n[v]||(n[v]={type:gd.level,xy:NaN,wh:NaN,option:null,id:new er,dim:e});var R=a(E.children,g,v+1),z=Math.max(1,R);D.span[vr[e.dimIdx]]=z,y+=z,g+=z}),y}function c(){for(var f=[];r.length<s;)for(var g=0;g<o.length;g++){var v=o[g].pop();if(v){v.ordinal=f.length;var y=v.option.value;f.push(y),r.push(v),e._uniqueValueGen.calcDupBase(y)}}e._uniqueValueGen.ensureValueUnique(f,r);var w=e._ordinalMeta=new pS({categories:f,needCollect:!1,deduplication:!1});e._scale=new gS({ordinalMeta:w});for(var I=0;I<e._leavesCount;I++){var E=e._cells[I];E.type=gd.leaf,E.span[vr[1-e.dimIdx]]=e._levels.length-E.level}e._initCellsId(),e._initLevelIdOptions()}},i.prototype._initBySeriesData=function(){var t=this;t._leavesCount=0,t._levels=[{type:gd.level,xy:NaN,wh:NaN,option:null,id:new er,dim:t}],t._initLevelIdOptions();var e=t._ordinalMeta=new pS({needCollect:!0,deduplication:!0,onCollect:function(r,n){var o=t._cells[n]={type:gd.leaf,ordinal:n,level:0,firstLeafLocator:n,id:new er,span:Bb(new er,t.dimIdx,1,1),option:{value:r+""},xy:NaN,wh:NaN,dim:t,rect:xM()};t._leavesCount++,t._setCellId(o)}});t._scale=new gS({ordinalMeta:e})},i.prototype._setCellId=function(t){var e=this._levels.length,r=this.dimIdx;Bb(t.id,r,t.firstLeafLocator,t.level-e)},i.prototype._initCellsId=function(){var t=this._levels.length,e=this.dimIdx;pt(this._cells,function(r){Bb(r.id,e,r.firstLeafLocator,r.level-t)})},i.prototype._initLevelIdOptions=function(){var t=this._levels.length,e=this.dimIdx,r=this._model.get("levels",!0);r=Ye(r)?r:[],pt(this._levels,function(n,o){Bb(n.id,e,0,o-t),n.option=r[o]})},i.prototype.shouldShow=function(){return!!this._model.getShallow("show",!0)},i.prototype.resetLayoutIterator=function(t,e,r,n){if(t=t||new Ip,e===this.dimIdx){var o=this._leavesCount,s=r!=null?Math.max(0,r):0;n=n!=null?Math.min(n,o):o,t.reset(this._cells,s,s+n)}else{var o=this._levels.length,s=r!=null?Math.max(0,r+o):0;n=n!=null?Math.min(n,o):o,t.reset(this._levels,s,s+n)}return t},i.prototype.resetCellIterator=function(t){return(t||new Ip).reset(this._cells,0)},i.prototype.resetLevelIterator=function(t){return(t||new Ip).reset(this._levels,0)},i.prototype.getLayout=function(t,e,r){var n=this.getUnitLayoutInfo(e,r);t[vr[e]]=n?n.xy:NaN,t[wo[e]]=n?n.wh:NaN},i.prototype.getUnitLayoutInfo=function(t,e){return t===this.dimIdx?e<this._leavesCount?this._cells[e]:void 0:this._levels[e+this._levels.length]},i.prototype.getCell=function(t){var e=this._scale.parse(t);return Bs(e)?void 0:this._cells[e]},i.prototype.getLocatorCount=function(t){return t===this.dimIdx?this._leavesCount:this._levels.length},i.prototype.getOrdinalMeta=function(){return this._ordinalMeta},i}();function gzt(i){var t=i.toUpperCase(),e=new RegExp("^"+t+"([0-9]+)$"),r=0;function n(a){var c;a!=null&&(c=a.match(e))&&(r=co(r,+c[1]+1))}function o(){return""+t+r++}function s(a,c){for(var f=Fi(),g=0;g<a.length;g++){var v=a[g];(v==null||f.get(v)!=null)&&(a[g]=v=o(),c[g].option=rr({value:v},c[g].option)),f.set(v,!0)}}return{calcDupBase:n,ensureValueUnique:s}}var rq=function(){function i(t,e,r){this._model=e,this._dims=r,this._kind=t,this._cellMergeOwnerList=[]}return i.prototype._ensureCellMap=function(){var t=this,e=t._cellMap;return e||(e=t._cellMap=Fi(),r()),e;function r(){var o=[],s=t._model.getShallow("data");s&&!Ye(s)&&(s=null),pt(s,function(I,E){if(!(!nr(I)||!Ye(I.coord))){var D=mrt([]),R=null;if(vrt(D,R,I.coord,t._dims,I.coordClamp?Ed[t._kind]:Ed.none),!(uI(D,0)||uI(D,1))){var z=I&&I.mergeCells,N={id:new er,span:new er,locatorRange:D,option:I,cellMergeOwner:z};tq(N,D),o.push(N)}}});for(var a=[],c=0;c<o.length;c++){var f=o[c];if(f.cellMergeOwner){var g=f.locatorRange;JZ(g,a,o,c);for(var v=0;v<c;v++)a[v]&&(o[v].cellMergeOwner=!1);if(g[0][0]!==f.id.x||g[1][0]!==f.id.y){f.cellMergeOwner=!1;var y=Ne({},f.option);y.coord=null;var w={id:new er,span:new er,locatorRange:g,option:y,cellMergeOwner:!0};tq(w,g),o.push(w)}}}pt(o,function(I){var E=n(I.id.x,I.id.y);if(I.cellMergeOwner&&(E.cellMergeOwner=!0,E.span=I.span,E.locatorRange=I.locatorRange,E.spanRect=xM(),t._cellMergeOwnerList.push(E)),!(!I.cellMergeOwner&&!I.option))for(var D=0;D<I.span.y;D++)for(var R=0;R<I.span.x;R++){var z=n(I.id.x+R,I.id.y+D);z.option=I.option,I.cellMergeOwner&&(z.inSpanOf=E)}})}function n(o,s){var a=nq(o,s),c=e.get(a);return c||(c=e.set(a,{id:new er(o,s),option:null,inSpanOf:null,span:null,spanRect:null,locatorRange:null,cellMergeOwner:!1})),c}},i.prototype.getCell=function(t){return this._ensureCellMap().get(nq(t[0],t[1]))},i.prototype.travelExistingCells=function(t){this._ensureCellMap().each(t)},i.prototype.expandRangeByCellMerge=function(t){if(!uI(t,0)&&!uI(t,1)&&t[0][0]===t[0][1]&&t[1][0]===t[1][1]){Ak[0]=t[0][0],Ak[1]=t[1][0];var e=this.getCell(Ak),r=e&&e.inSpanOf;if(r){fzt(t,r.locatorRange);return}}var n=this._cellMergeOwnerList;JZ(t,null,n,n.length)},i}(),Ak=[];function nq(i,t){return i+"|"+t}var CN={show:!0,color:ye.color.secondary,overflow:"break",lineOverflow:"truncate",padding:[2,3,2,3],distance:0};function MN(i){return{color:"none",borderWidth:1,borderColor:i?"none":ye.color.borderTint}}var aq={show:!0,label:CN,itemStyle:MN(!1),silent:void 0,dividerLineStyle:{width:1,color:ye.color.border}},mzt={label:CN,itemStyle:MN(!1),silent:void 0},vzt={label:CN,itemStyle:MN(!0),silent:void 0},_zt={z:-50,left:"10%",top:"10%",right:"10%",bottom:"10%",x:aq,y:aq,body:mzt,corner:vzt,backgroundStyle:{color:"none",borderColor:ye.color.axisLine,borderWidth:1}},yzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){var e=this._dimModels={x:new oq(this.get("x",!0)||{}),y:new oq(this.get("y",!0)||{})};e.x.option.type=e.y.option.type="category";var r=e.x.dim=new iq("x",e.x),n=e.y.dim=new iq("y",e.y),o={x:r,y:n};this._body=new rq("body",new bn(this.getShallow("body")),o),this._corner=new rq("corner",new bn(this.getShallow("corner")),o)},t.prototype.getDimensionModel=function(e){return this._dimModels[e]},t.prototype.getBody=function(){return this._body},t.prototype.getCorner=function(){return this._corner},t.type="matrix",t.layoutMode="box",t.defaultOption=_zt,t}(gn),oq=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getOrdinalMeta=function(){return this.dim.getOrdinalMeta()},t}(bn);const xzt=yzt;var cI=Math.round,bzt=0,wzt=99,Szt={normal:25,special:100},Tzt={normal:50,special:125},Azt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r){this.group.removeAll();var n=this.group,o=e.coordinateSystem,s=o.getRect(),a=e.getDimensionModel("x"),c=e.getDimensionModel("y"),f=a.dim,g=c.dim;Izt(n,e,r),Czt(n,e,f,g,r);var v=e.getShallow("borderZ2",!0),y=Ui(v,wzt),w=y-1,I=e.getModel("backgroundStyle").getItemStyle(["borderWidth"]);I.lineWidth=0;var E=e.getModel("backgroundStyle").getItemStyle(["color","decal","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]);E.fill="none";var D=mB(s.clone(),I,bzt),R=mB(s.clone(),E,y);D.silent=!0,R.silent=!0,n.add(D),n.add(R);var z=f.getUnitLayoutInfo(0,0),N=g.getUnitLayoutInfo(1,0);z&&N&&(f.shouldShow()&&n.add(sq({x1:s.x,y1:N.xy,x2:s.x+s.width,y2:N.xy},a.getModel("dividerLineStyle").getLineStyle(),w)),g.shouldShow()&&n.add(sq({x1:z.xy,y1:s.y,x2:z.xy,y2:s.y+s.height},c.getModel("dividerLineStyle").getLineStyle(),w)))},t.type="matrix",t}(Oa);function Izt(i,t,e){r(0),r(1);function r(n){var o=t.getDimensionModel(vr[n]),s=o.dim;if(s.shouldShow())for(var a=o.getModel("itemStyle"),c=o.getModel("label"),f=t.getShallow("tooltip",!0),g=[],v=s.resetCellIterator();v.next();){var y=v.item,w={};sr.copy(w,y.rect),SF(g,y.id.x,y.id.y),_rt(g,t,i,e,y.option,a,c,o,w,y.option.value,Tzt,f)}}}function Czt(i,t,e,r,n){o("body",t.getBody(),e,r),e.shouldShow()&&r.shouldShow()&&o("corner",t.getCorner(),r,e);function o(s,a,c,f){var g=new bn(t.getShallow(s,!0)),v=g.getModel("itemStyle"),y=g.getModel("label"),w=new Ip,I=new Ip,E=[],D=t.getShallow("tooltip",!0);for(f.resetLayoutIterator(I,1);I.next();)for(c.resetLayoutIterator(w,0);w.next();){var R=w.item,z=I.item;SF(E,R.id.x,z.id.y);var N=a.getCell(E);if(!(N&&N.inSpanOf&&N.inSpanOf!==N)){var H={};N&&N.span?sr.copy(H,N.spanRect):(R.dim.getLayout(H,0,E[0]),z.dim.getLayout(H,1,E[1]));var q=N?N.option:null;_rt(E,t,i,n,q,v,y,g,H,q?q.value:null,Szt,D)}}}}function _rt(i,t,e,r,n,o,s,a,c,f,g,v){var y;hI.option=n?n.itemStyle:null,hI.parentModel=o,By.option=n,By.parentModel=a;var w=Ui(By.getShallow("z2"),n&&n.itemStyle?g.special:g.normal),I=v&&v.show,E=mB(c,hI.getItemStyle(),w);e.add(E);var D=By.get("cursor");D!=null&&E.attr("cursor",D);var R;if(f!=null){var z=f+"";if(Fy.option=n?n.label:null,Fy.parentModel=s,Fy.ecModel=r,Xo(E,{normal:Fy},{defaultText:z,autoOverflowArea:!0,layoutRect:Yi(E.shape)}),R=E.getTextContent(),R){R.z2=w+1;var N=R.style;if(N&&N.overflow&&N.overflow!=="none"&&N.lineOverflow){var H={};sr.copy(H,c),xv(H,(((y=E.style)===null||y===void 0?void 0:y.lineWidth)||0)/2,!0,!0),E.updateInnerText(),R.getLocalTransform(dI),_c(dI,dI),sr.applyTransform(H,H,dI),R.setClipPath(new jr({shape:H}))}}Wd({el:E,componentModel:t,itemName:z,itemTooltipOption:v,formatterParamsExtra:{xyLocator:i.slice()}})}if(R){var q=Fy.get("silent");q==null&&(q=!I),R.silent=q,R.ignoreHostSilent=!0}var Y=By.get("silent");Y==null&&(Y=!E.style||E.style.fill==="none"||!E.style.fill),E.silent=Y,BL(By),BL(hI),BL(Fy)}var By=new bn,hI=new bn,Fy=new bn,dI=[];function mB(i,t,e){var r=t.lineWidth;if(r){var n=i.x+i.width,o=i.y+i.height;i.x=eu(i.x,r,!0),i.y=eu(i.y,r,!0),i.width=eu(n,r,!0)-i.x,i.height=eu(o,r,!0)-i.y}return new jr({shape:i,style:t,z2:e})}function sq(i,t,e){var r=t.lineWidth;return r&&(cI(i.x1*2)===cI(i.x2*2)&&(i.x1=i.x2=eu(i.x1,r,!0)),cI(i.y1*2)===cI(i.y2*2)&&(i.y1=i.y2=eu(i.y1,r,!0))),new Oo({shape:i,style:t,silent:!0,z2:e})}const Mzt=Azt;var Ezt=function(){function i(t,e,r){this.dimensions=i.dimensions,this.type="matrix",this._model=t;var n=this._dimModels={x:t.getDimensionModel("x"),y:t.getDimensionModel("y")};this._dims={x:n.x.dim,y:n.y.dim},this._resize(t,r)}return i.getDimensionsInfo=function(){return[{name:"x",type:"ordinal"},{name:"y",type:"ordinal"},{name:"value"}]},i.create=function(t,e){var r=[];return t.eachComponent("matrix",function(n){var o=new i(n,t,e);r.push(o),n.coordinateSystem=o}),t.eachComponent(function(n,o){jS({targetModel:o,coordSysType:"matrix",coordSysProvider:IJ})}),r},i.prototype.getRect=function(){return this._rect},i.prototype._resize=function(t,e){var r=this._dims,n=this._dimModels,o=this._rect=Ma(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()});lq(n,r,o,0),lq(n,r,o,1),uq(0,r),uq(1,r),cq(this._model.getBody(),r),cq(this._model.getCorner(),r)},i.prototype.dataToPoint=function(t,e,r){return r=r||[],this.dataToLayout(t,e,Fb),r[0]=Fb.rect.x+Fb.rect.width/2,r[1]=Fb.rect.y+Fb.rect.height/2,r},i.prototype.dataToLayout=function(t,e,r){var n=this._dims;r=r||{};var o=r.rect=r.rect||{};o.x=o.y=o.width=o.height=NaN;var s=r.matrixXYLocatorRange=mrt(r.matrixXYLocatorRange);return Ye(t)&&(vrt(s,null,t,n,Ui(e&&e.clamp,Ed.none)),(!e||!e.ignoreMergeCells)&&((!e||e.clamp!==Ed.corner)&&this._model.getBody().expandRangeByCellMerge(s),(!e||e.clamp!==Ed.body)&&this._model.getCorner().expandRangeByCellMerge(s)),eq(o,s,n,0),eq(o,s,n,1)),r},i.prototype.pointToData=function(t,e,r){var n=this._dims;return hq(Xc,0,n,t,e&&e.clamp),hq(Xc,1,n,t,e&&e.clamp),r=r||[],r[0]=r[1]=NaN,Xc.y===gs.inCorner&&Xc.x===gs.inBody?dq(Xc,r,0,n):Xc.x===gs.inCorner&&Xc.y===gs.inBody?dq(Xc,r,1,n):(fq(Xc,r,0,n),fq(Xc,r,1,n)),r},i.prototype.convertToPixel=function(t,e,r,n){var o=Ck(e);return o===this?o.dataToPoint(r,n):void 0},i.prototype.convertToLayout=function(t,e,r,n){var o=Ck(e);return o===this?o.dataToLayout(r,n):void 0},i.prototype.convertFromPixel=function(t,e,r,n){var o=Ck(e);return o===this?o.pointToData(r,n):void 0},i.prototype.containPoint=function(t){return this._rect.contain(t[0],t[1])},i.dimensions=["x","y","value"],i}(),Fb={rect:xM()},fI=new Ip,Ik=new Ip;function lq(i,t,e,r){for(var n=1-r,o=t[vr[r]],s=t[vr[n]],a=s.shouldShow(),c=o.resetCellIterator();c.next();)c.item.wh=c.item.xy=NaN;for(var f=s.resetLayoutIterator(null,r);f.next();)f.item.wh=f.item.xy=NaN;for(var g=e[wo[r]],v=o.getLocatorCount(r)+s.getLocatorCount(r),y=new bn,w=s.resetLevelIterator();w.next();)y.option=w.item.option,y.parentModel=i[vr[n]],D(w.item,a?y.get("levelSize"):0);for(var I=new bn,E=o.resetCellIterator();E.next();)E.item.type===gd.leaf&&(I.option=E.item.option,I.parentModel=void 0,D(E.item,I.get("size")));function D(J,it){var at=Dzt(it,r,e);Bs(at)||(J.wh=vB(at,g),g=vB(g-J.wh),v--)}var R=v?g/v:0,z=!v&&g>=1,N=e[vr[r]],H=o.getLocatorCount(r)-1,q=new Ip;for(s.resetLayoutIterator(q,r);q.next();)Y(q.item);for(o.resetLayoutIterator(q,r);q.next();)Y(q.item);function Y(J){Bs(J.wh)&&(J.wh=R),J.xy=N,J.id[vr[r]]===H&&!z&&(J.wh=e[vr[r]]+e[wo[r]]-J.xy),N+=J.wh}}function uq(i,t){for(var e=t[vr[i]].resetCellIterator();e.next();){var r=e.item;bM(r.rect,i,r.id,r.span,t),bM(r.rect,1-i,r.id,r.span,t),r.type===gd.nonLeaf&&(r.xy=r.rect[vr[i]],r.wh=r.rect[wo[i]])}}function cq(i,t){i.travelExistingCells(function(e){var r=e.span;if(r){var n=e.spanRect,o=e.id;bM(n,0,o,r,t),bM(n,1,o,r,t)}})}function bM(i,t,e,r,n){i[wo[t]]=0;var o=e[vr[t]],s=o<0?n[vr[1-t]]:n[vr[t]],a=s.getUnitLayoutInfo(t,e[vr[t]]);if(i[vr[t]]=a.xy,i[wo[t]]=a.wh,r[vr[t]]>1){var c=s.getUnitLayoutInfo(t,e[vr[t]]+r[vr[t]]-1);i[wo[t]]=c.xy+c.wh-a.xy}}function Dzt(i,t,e){var r=OC(i,e[wo[t]]);return vB(r,e[wo[t]])}function vB(i,t){return Math.max(Math.min(i,Ui(t,1/0)),0)}function Ck(i){var t=i.matrixModel,e=i.seriesModel,r=t?t.coordinateSystem:e?e.coordinateSystem:null;return r}var gs={inBody:1,inCorner:2,outside:3},Xc={x:null,y:null,point:[]};function hq(i,t,e,r,n){var o=e[vr[t]],s=e[vr[1-t]],a=o.getUnitLayoutInfo(t,o.getLocatorCount(t)-1),c=o.getUnitLayoutInfo(t,0),f=s.getUnitLayoutInfo(t,-s.getLocatorCount(t)),g=s.shouldShow()?s.getUnitLayoutInfo(t,-1):null,v=i.point[t]=r[t];if(!c&&!g){i[vr[t]]=gs.outside;return}if(n===Ed.body){c?(i[vr[t]]=gs.inBody,v=ru(a.xy+a.wh,co(c.xy,v)),i.point[t]=v):i[vr[t]]=gs.outside;return}else if(n===Ed.corner){g?(i[vr[t]]=gs.inCorner,v=ru(g.xy+g.wh,co(f.xy,v)),i.point[t]=v):i[vr[t]]=gs.outside;return}var y=c?c.xy:g?g.xy+g.wh:NaN,w=f?f.xy:y,I=a?a.xy+a.wh:y;if(v<w){if(!n){i[vr[t]]=gs.outside;return}v=w}else if(v>I){if(!n){i[vr[t]]=gs.outside;return}v=I}i.point[t]=v,i[vr[t]]=y<=v&&v<=I?gs.inBody:w<=v&&v<=y?gs.inCorner:gs.outside}function dq(i,t,e,r){var n=1-e;if(i[vr[e]]!==gs.outside)for(r[vr[e]].resetCellIterator(Ik);Ik.next();){var o=Ik.item;if(pq(i.point[e],o.rect,e)&&pq(i.point[n],o.rect,n)){t[e]=o.ordinal,t[n]=o.id[vr[n]];return}}}function fq(i,t,e,r){if(i[vr[e]]!==gs.outside){var n=i[vr[e]]===gs.inCorner?r[vr[1-e]]:r[vr[e]];for(n.resetLayoutIterator(fI,e);fI.next();)if(Pzt(i.point[e],fI.item)){t[e]=fI.item.id[vr[e]];return}}}function Pzt(i,t){return t.xy<=i&&i<=t.xy+t.wh}function pq(i,t,e){return t[vr[e]]<=i&&i<=t[vr[e]]+t[wo[e]]}const Lzt=Ezt;function Rzt(i){i.registerComponentModel(xzt),i.registerComponentView(Mzt),i.registerCoordinateSystem("matrix",Lzt)}function kzt(i,t){var e=i.existing;if(t.id=i.keyInfo.id,!t.type&&e&&(t.type=e.type),t.parentId==null){var r=t.parentOption;r?t.parentId=r.id:e&&(t.parentId=e.parentId)}t.parentOption=null}function gq(i,t){var e;return pt(t,function(r){i[r]!=null&&i[r]!=="auto"&&(e=!0)}),e}function Ozt(i,t,e){var r=Ne({},e),n=i[t],o=e.$action||"merge";o==="merge"?n?(Er(n,r,!0),Th(n,r,{ignoreSize:!0}),PJ(e,n),pI(e,n),pI(e,n,"shape"),pI(e,n,"style"),pI(e,n,"extra"),e.clipPath=n.clipPath):i[t]=r:o==="replace"?i[t]=r:o==="remove"&&n&&(i[t]=null)}var yrt=["transition","enterFrom","leaveTo"],zzt=yrt.concat(["enterAnimation","updateAnimation","leaveAnimation"]);function pI(i,t,e){if(e&&(!i[e]&&t[e]&&(i[e]={}),i=i[e],t=t[e]),!(!i||!t))for(var r=e?yrt:zzt,n=0;n<r.length;n++){var o=r[n];i[o]==null&&t[o]!=null&&(i[o]=t[o])}}function Bzt(i,t){if(i&&(i.hv=t.hv=[gq(t,["left","right"]),gq(t,["top","bottom"])],i.type==="group")){var e=i,r=t;e.width==null&&(e.width=r.width=0),e.height==null&&(e.height=r.height=0)}}var Fzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventAutoZ=!0,e}return t.prototype.mergeOption=function(e,r){var n=this.option.elements;this.option.elements=null,i.prototype.mergeOption.call(this,e,r),this.option.elements=n},t.prototype.optionUpdated=function(e,r){var n=this.option,o=(r?n:e).elements,s=n.elements=r?[]:n.elements,a=[];this._flatten(o,a,null);var c=oK(s,a,"normalMerge"),f=this._elOptionsToUpdate=[];pt(c,function(g,v){var y=g.newOption;y&&(f.push(y),kzt(g,y),Ozt(s,v,y),Bzt(s[v],y))},this),n.elements=kn(s,function(g){return g&&delete g.$action,g!=null})},t.prototype._flatten=function(e,r,n){pt(e,function(o){if(o){n&&(o.parentOption=n),r.push(o);var s=o.children;s&&s.length&&this._flatten(s,r,o),delete o.children}},this)},t.prototype.useElOptionsToUpdate=function(){var e=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,e},t.type="graphic",t.defaultOption={elements:[]},t}(gn),mq={path:null,compoundPath:null,group:Ki,image:ys,text:_n},Au=Wr(),Nzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this._elMap=Fi()},t.prototype.render=function(e,r,n){e!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=e,this._updateElements(e),this._relocate(e,n)},t.prototype._updateElements=function(e){var r=e.useElOptionsToUpdate();if(r){var n=this._elMap,o=this.group,s=e.get("z"),a=e.get("zlevel");pt(r,function(c){var f=ko(c.id,null),g=f!=null?n.get(f):null,v=ko(c.parentId,null),y=v!=null?n.get(v):o,w=c.type,I=c.style;w==="text"&&I&&c.hv&&c.hv[1]&&(I.textVerticalAlign=I.textBaseline=I.verticalAlign=I.align=null);var E=c.textContent,D=c.textConfig;if(I&&Xit(I,w,!!D,!!E)){var R=Yit(I,w,!0);!D&&R.textConfig&&(D=c.textConfig=R.textConfig),!E&&R.textContent&&(E=R.textContent)}var z=Vzt(c),N=c.$action||"merge",H=N==="merge",q=N==="replace";if(H){var Y=!g,J=g;Y?J=vq(f,y,c.type,n):(J&&(Au(J).isNew=!1),trt(J)),J&&(nC(J,z,e,{isInit:Y}),_q(J,c,s,a))}else if(q){oC(g,c,n,e);var it=vq(f,y,c.type,n);it&&(nC(it,z,e,{isInit:!0}),_q(it,c,s,a))}else N==="remove"&&(Jit(g,c),oC(g,c,n,e));var at=n.get(f);if(at&&E)if(H){var ut=at.getTextContent();ut?ut.attr(E):at.setTextContent(new _n(E))}else q&&at.setTextContent(new _n(E));if(at){var ft=c.clipPath;if(ft){var _t=ft.type,ct=void 0,Y=!1;if(H){var Dt=at.getClipPath();Y=!Dt||Au(Dt).type!==_t,ct=Y?_B(_t):Dt}else q&&(Y=!0,ct=_B(_t));at.setClipPath(ct),nC(ct,ft,e,{isInit:Y}),vM(ct,ft.keyframeAnimation,e)}var Et=Au(at);at.setTextConfig(D),Et.option=c,Uzt(at,e,c),Wd({el:at,componentModel:e,itemName:at.name,itemTooltipOption:c.tooltip}),vM(at,c.keyframeAnimation,e)}})}},t.prototype._relocate=function(e,r){for(var n=e.option.elements,o=this.group,s=this._elMap,a=r.getWidth(),c=r.getHeight(),f=["x","y"],g=0;g<n.length;g++){var v=n[g],y=ko(v.id,null),w=y!=null?s.get(y):null;if(!(!w||!w.isGroup)){var I=w.parent,E=I===o,D=Au(w),R=Au(I);D.width=xi(D.option.width,E?a:R.width)||0,D.height=xi(D.option.height,E?c:R.height)||0}}for(var g=n.length-1;g>=0;g--){var v=n[g],y=ko(v.id,null),w=y!=null?s.get(y):null;if(w){var I=w.parent,R=Au(I),z=I===o?{width:a,height:c}:{width:R.width,height:R.height},N={},H=yE(w,v,z,null,{hv:v.hv,boundingMode:v.bounding},N);if(!Au(w).isNew&&H){for(var q=v.transition,Y={},J=0;J<f.length;J++){var it=f[J],at=N[it];q&&(fv(q)||Ar(q,it)>=0)?Y[it]=at:w[it]=at}yn(w,Y,e,0)}else w.attr(N)}}},t.prototype._clear=function(){var e=this,r=this._elMap;r.each(function(n){oC(n,Au(n).option,r,e._lastGraphicModel)}),this._elMap=Fi()},t.prototype.dispose=function(){this._clear()},t.type="graphic",t}(Oa);function _B(i){var t=Pi(mq,i)?mq[i]:VC(i),e=new t({});return Au(e).type=i,e}function vq(i,t,e,r){var n=_B(e);return t.add(n),r.set(i,n),Au(n).id=i,Au(n).isNew=!0,n}function oC(i,t,e,r){var n=i&&i.parent;n&&(i.type==="group"&&i.traverse(function(o){oC(o,t,e,r)}),OE(i,t,r),e.removeKey(Au(i).id))}function _q(i,t,e,r){i.isGroup||pt([["cursor",Ou.prototype.cursor],["zlevel",r||0],["z",e||0],["z2",0]],function(n){var o=n[0];Pi(t,o)?i[o]=Ui(t[o],n[1]):i[o]==null&&(i[o]=n[1])}),pt(on(t),function(n){if(n.indexOf("on")===0){var o=t[n];i[n]=Xi(o)?o:null}}),Pi(t,"draggable")&&(i.draggable=t.draggable),t.name!=null&&(i.name=t.name),t.id!=null&&(i.id=t.id)}function Vzt(i){return i=Ne({},i),pt(["id","parentId","$action","hv","bounding","textContent","clipPath"].concat(CJ),function(t){delete i[t]}),i}function Uzt(i,t,e){var r=cr(i).eventData;!i.silent&&!i.ignore&&!r&&(r=cr(i).eventData={componentType:"graphic",componentIndex:t.componentIndex,name:i.name}),r&&(r.info=e.info)}function Gzt(i){i.registerComponentModel(Fzt),i.registerComponentView(Nzt),i.registerPreprocessor(function(t){var e=t.graphic;Ye(e)?!e[0]||!e[0].elements?t.graphic=[{elements:e}]:t.graphic=[t.graphic[0]]:e&&!e.elements&&(t.graphic=[{elements:[e]}])})}var yq=["x","y","radius","angle","single"],Hzt=["cartesian2d","polar","singleAxis"];function jzt(i){var t=i.get("coordinateSystem");return Ar(Hzt,t)>=0}function xp(i){return i+"Axis"}function Wzt(i,t){var e=Fi(),r=[],n=Fi();i.eachComponent({mainType:"dataZoom",query:t},function(g){n.get(g.uid)||a(g)});var o;do o=!1,i.eachComponent("dataZoom",s);while(o);function s(g){!n.get(g.uid)&&c(g)&&(a(g),o=!0)}function a(g){n.set(g.uid,!0),r.push(g),f(g)}function c(g){var v=!1;return g.eachTargetAxis(function(y,w){var I=e.get(y);I&&I[w]&&(v=!0)}),v}function f(g){g.eachTargetAxis(function(v,y){(e.get(v)||e.set(v,[]))[y]=!0})}return r}function xrt(i){var t=i.ecModel,e={infoList:[],infoMap:Fi()};return i.eachTargetAxis(function(r,n){var o=t.getComponent(xp(r),n);if(o){var s=o.getCoordSysModel();if(s){var a=s.uid,c=e.infoMap.get(a);c||(c={model:s,axisModels:[]},e.infoList.push(c),e.infoMap.set(a,c)),c.axisModels.push(o)}}}),e}var Mk=function(){function i(){this.indexList=[],this.indexMap=[]}return i.prototype.add=function(t){this.indexMap[t]||(this.indexList.push(t),this.indexMap[t]=!0)},i}(),$zt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._autoThrottle=!0,e._noTarget=!0,e._rangePropMode=["percent","percent"],e}return t.prototype.init=function(e,r,n){var o=xq(e);this.settledOption=o,this.mergeDefaultAndTheme(e,n),this._doInit(o)},t.prototype.mergeOption=function(e){var r=xq(e);Er(this.option,e,!0),Er(this.settledOption,r,!0),this._doInit(r)},t.prototype._doInit=function(e){var r=this.option;this._setDefaultThrottle(e),this._updateRangeUse(e);var n=this.settledOption;pt([["start","startValue"],["end","endValue"]],function(o,s){this._rangePropMode[s]==="value"&&(r[o[0]]=n[o[0]]=null)},this),this._resetTarget()},t.prototype._resetTarget=function(){var e=this.get("orient",!0),r=this._targetAxisInfoMap=Fi(),n=this._fillSpecifiedTargetAxis(r);n?this._orient=e||this._makeAutoOrientByTargetAxis():(this._orient=e||"horizontal",this._fillAutoTargetAxisByOrient(r,this._orient)),this._noTarget=!0,r.each(function(o){o.indexList.length&&(this._noTarget=!1)},this)},t.prototype._fillSpecifiedTargetAxis=function(e){var r=!1;return pt(yq,function(n){var o=this.getReferringComponents(xp(n),jyt);if(o.specified){r=!0;var s=new Mk;pt(o.models,function(a){s.add(a.componentIndex)}),e.set(n,s)}},this),r},t.prototype._fillAutoTargetAxisByOrient=function(e,r){var n=this.ecModel,o=!0;if(o){var s=r==="vertical"?"y":"x",a=n.findComponents({mainType:s+"Axis"});c(a,s)}if(o){var a=n.findComponents({mainType:"singleAxis",filter:function(g){return g.get("orient",!0)===r}});c(a,"single")}function c(f,g){var v=f[0];if(v){var y=new Mk;if(y.add(v.componentIndex),e.set(g,y),o=!1,g==="x"||g==="y"){var w=v.getReferringComponents("grid",Wa).models[0];w&&pt(f,function(I){v.componentIndex!==I.componentIndex&&w===I.getReferringComponents("grid",Wa).models[0]&&y.add(I.componentIndex)})}}}o&&pt(yq,function(f){if(o){var g=n.findComponents({mainType:xp(f),filter:function(y){return y.get("type",!0)==="category"}});if(g[0]){var v=new Mk;v.add(g[0].componentIndex),e.set(f,v),o=!1}}},this)},t.prototype._makeAutoOrientByTargetAxis=function(){var e;return this.eachTargetAxis(function(r){!e&&(e=r)},this),e==="y"?"vertical":"horizontal"},t.prototype._setDefaultThrottle=function(e){if(e.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var r=this.ecModel.option;this.option.throttle=r.animation&&r.animationDurationUpdate>0?100:20}},t.prototype._updateRangeUse=function(e){var r=this._rangePropMode,n=this.get("rangeMode");pt([["start","startValue"],["end","endValue"]],function(o,s){var a=e[o[0]]!=null,c=e[o[1]]!=null;a&&!c?r[s]="percent":!a&&c?r[s]="value":n?r[s]=n[s]:a&&(r[s]="percent")})},t.prototype.noTarget=function(){return this._noTarget},t.prototype.getFirstTargetAxisModel=function(){var e;return this.eachTargetAxis(function(r,n){e==null&&(e=this.ecModel.getComponent(xp(r),n))},this),e},t.prototype.eachTargetAxis=function(e,r){this._targetAxisInfoMap.each(function(n,o){pt(n.indexList,function(s){e.call(r,o,s)})})},t.prototype.getAxisProxy=function(e,r){var n=this.getAxisModel(e,r);if(n)return n.__dzAxisProxy},t.prototype.getAxisModel=function(e,r){var n=this._targetAxisInfoMap.get(e);if(n&&n.indexMap[r])return this.ecModel.getComponent(xp(e),r)},t.prototype.setRawRange=function(e){var r=this.option,n=this.settledOption;pt([["start","startValue"],["end","endValue"]],function(o){(e[o[0]]!=null||e[o[1]]!=null)&&(r[o[0]]=n[o[0]]=e[o[0]],r[o[1]]=n[o[1]]=e[o[1]])},this),this._updateRangeUse(e)},t.prototype.setCalculatedRange=function(e){var r=this.option;pt(["start","startValue","end","endValue"],function(n){r[n]=e[n]})},t.prototype.getPercentRange=function(){var e=this.findRepresentativeAxisProxy();if(e)return e.getDataPercentWindow()},t.prototype.getValueRange=function(e,r){if(e==null&&r==null){var n=this.findRepresentativeAxisProxy();if(n)return n.getDataValueWindow()}else return this.getAxisProxy(e,r).getDataValueWindow()},t.prototype.findRepresentativeAxisProxy=function(e){if(e)return e.__dzAxisProxy;for(var r,n=this._targetAxisInfoMap.keys(),o=0;o<n.length;o++)for(var s=n[o],a=this._targetAxisInfoMap.get(s),c=0;c<a.indexList.length;c++){var f=this.getAxisProxy(s,a.indexList[c]);if(f.hostedBy(this))return f;r||(r=f)}return r},t.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},t.prototype.getOrient=function(){return this._orient},t.type="dataZoom",t.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],t.defaultOption={z:4,filterMode:"filter",start:0,end:100},t}(gn);function xq(i){var t={};return pt(["start","end","startValue","endValue","throttle"],function(e){i.hasOwnProperty(e)&&(t[e]=i[e])}),t}const AS=$zt;var Zzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.select",t}(AS);const qzt=Zzt;var Xzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n,o){this.dataZoomModel=e,this.ecModel=r,this.api=n},t.type="dataZoom",t}(Oa);const EN=Xzt;var Yzt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.select",t}(EN);const Kzt=Yzt;var Zy=pt,bq=Pu,Jzt=function(){function i(t,e,r,n){this._dimName=t,this._axisIndex=e,this.ecModel=n,this._dataZoomModel=r}return i.prototype.hostedBy=function(t){return this._dataZoomModel===t},i.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},i.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},i.prototype.getTargetSeriesModels=function(){var t=[];return this.ecModel.eachSeries(function(e){if(jzt(e)){var r=xp(this._dimName),n=e.getReferringComponents(r,Wa).models[0];n&&this._axisIndex===n.componentIndex&&t.push(e)}},this),t},i.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},i.prototype.getMinMaxSpan=function(){return Yi(this._minMaxSpan)},i.prototype.calculateDataWindow=function(t){var e=this._dataExtent,r=this.getAxisModel(),n=r.axis.scale,o=this._dataZoomModel.getRangePropMode(),s=[0,100],a=[],c=[],f;Zy(["start","end"],function(y,w){var I=t[y],E=t[y+"Value"];o[w]==="percent"?(I==null&&(I=s[w]),E=n.parse(Rn(I,s,e))):(f=!0,E=E==null?e[w]:n.parse(E),I=Rn(E,e,s)),c[w]=E==null||isNaN(E)?e[w]:E,a[w]=I==null||isNaN(I)?s[w]:I}),bq(c),bq(a);var g=this._minMaxSpan;f?v(c,a,e,s,!1):v(a,c,s,e,!0);function v(y,w,I,E,D){var R=D?"Span":"ValueSpan";Np(0,y,I,"all",g["min"+R],g["max"+R]);for(var z=0;z<2;z++)w[z]=Rn(y[z],I,E,!0),D&&(w[z]=n.parse(w[z]))}return{valueWindow:c,percentWindow:a}},i.prototype.reset=function(t){if(t===this._dataZoomModel){var e=this.getTargetSeriesModels();this._dataExtent=Qzt(this,this._dimName,e),this._updateMinMaxSpan();var r=this.calculateDataWindow(t.settledOption);this._valueWindow=r.valueWindow,this._percentWindow=r.percentWindow,this._setAxisModel()}},i.prototype.filterData=function(t,e){if(t!==this._dataZoomModel)return;var r=this._dimName,n=this.getTargetSeriesModels(),o=t.get("filterMode"),s=this._valueWindow;if(o==="none")return;Zy(n,function(c){var f=c.getData(),g=f.mapDimensionsAll(r);if(g.length){if(o==="weakFilter"){var v=f.getStore(),y=ti(g,function(w){return f.getDimensionIndex(w)},f);f.filterSelf(function(w){for(var I,E,D,R=0;R<g.length;R++){var z=v.get(y[R],w),N=!isNaN(z),H=z<s[0],q=z>s[1];if(N&&!H&&!q)return!0;N&&(D=!0),H&&(I=!0),q&&(E=!0)}return D&&I&&E})}else Zy(g,function(w){if(o==="empty")c.setData(f=f.map(w,function(E){return a(E)?E:NaN}));else{var I={};I[w]=s,f.selectRange(I)}});Zy(g,function(w){f.setApproximateExtent(s,w)})}});function a(c){return c>=s[0]&&c<=s[1]}},i.prototype._updateMinMaxSpan=function(){var t=this._minMaxSpan={},e=this._dataZoomModel,r=this._dataExtent;Zy(["min","max"],function(n){var o=e.get(n+"Span"),s=e.get(n+"ValueSpan");s!=null&&(s=this.getAxisModel().axis.scale.parse(s)),s!=null?o=Rn(r[0]+s,r,[0,100],!0):o!=null&&(s=Rn(o,[0,100],r,!0)-r[0]),t[n+"Span"]=o,t[n+"ValueSpan"]=s},this)},i.prototype._setAxisModel=function(){var t=this.getAxisModel(),e=this._percentWindow,r=this._valueWindow;if(e){var n=KY(r,[0,500]);n=Math.min(n,20);var o=t.axis.scale.rawExtentInfo;e[0]!==0&&o.setDeterminedMinMax("min",+r[0].toFixed(n)),e[1]!==100&&o.setDeterminedMinMax("max",+r[1].toFixed(n)),o.freeze()}},i}();function Qzt(i,t,e){var r=[1/0,-1/0];Zy(e,function(s){pTt(r,s.getData(),t)});var n=i.getAxisModel(),o=ftt(n.axis.scale,n,r).calculate();return[o.min,o.max]}const tBt=Jzt;var eBt={getTargetSeries:function(i){function t(n){i.eachComponent("dataZoom",function(o){o.eachTargetAxis(function(s,a){var c=i.getComponent(xp(s),a);n(s,a,c,o)})})}t(function(n,o,s,a){s.__dzAxisProxy=null});var e=[];t(function(n,o,s,a){s.__dzAxisProxy||(s.__dzAxisProxy=new tBt(n,o,a,i),e.push(s.__dzAxisProxy))});var r=Fi();return pt(e,function(n){pt(n.getTargetSeriesModels(),function(o){r.set(o.uid,o)})}),r},overallReset:function(i,t){i.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(r,n){e.getAxisProxy(r,n).reset(e)}),e.eachTargetAxis(function(r,n){e.getAxisProxy(r,n).filterData(e,t)})}),i.eachComponent("dataZoom",function(e){var r=e.findRepresentativeAxisProxy();if(r){var n=r.getDataPercentWindow(),o=r.getDataValueWindow();e.setCalculatedRange({start:n[0],end:n[1],startValue:o[0],endValue:o[1]})}})}};const iBt=eBt;function rBt(i){i.registerAction("dataZoom",function(t,e){var r=Wzt(e,t);pt(r,function(n){n.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})})})}var wq=!1;function DN(i){wq||(wq=!0,i.registerProcessor(i.PRIORITY.PROCESSOR.FILTER,iBt),rBt(i),i.registerSubTypeDefaulter("dataZoom",function(){return"slider"}))}function nBt(i){i.registerComponentModel(qzt),i.registerComponentView(Kzt),DN(i)}var Cu=function(){function i(){}return i}(),brt={};function qy(i,t){brt[i]=t}function wrt(i){return brt[i]}var aBt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(){i.prototype.optionUpdated.apply(this,arguments);var e=this.ecModel;pt(this.option.feature,function(r,n){var o=wrt(n);o&&(o.getDefaultOption&&(o.defaultOption=o.getDefaultOption(e)),Er(r,o.defaultOption))})},t.type="toolbox",t.layoutMode={type:"box",ignoreSize:!0},t.defaultOption={show:!0,z:6,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:ye.color.border,borderRadius:0,borderWidth:0,padding:ye.size.m,itemSize:15,itemGap:ye.size.s,showTitle:!0,iconStyle:{borderColor:ye.color.accent50,color:"none"},emphasis:{iconStyle:{borderColor:ye.color.accent50}},tooltip:{show:!1,position:"bottom"}},t}(gn);const oBt=aBt;function Srt(i,t){var e=GS(t.get("padding")),r=t.getItemStyle(["color","opacity"]);r.fill=t.get("backgroundColor");var n=new jr({shape:{x:i.x-e[3],y:i.y-e[0],width:i.width+e[1]+e[3],height:i.height+e[0]+e[2],r:t.get("borderRadius")},style:r,silent:!0,z2:-1});return n}var sBt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.render=function(e,r,n,o){var s=this.group;if(s.removeAll(),!e.get("show"))return;var a=+e.get("itemSize"),c=e.get("orient")==="vertical",f=e.get("feature")||{},g=this._features||(this._features={}),v=[];pt(f,function(z,N){v.push(N)}),new Bd(this._featureNames||[],v).add(y).update(y).remove(br(y,null)).execute(),this._featureNames=v;function y(z,N){var H=v[z],q=v[N],Y=f[H],J=new bn(Y,e,e.ecModel),it;if(o&&o.newTitle!=null&&o.featureName===H&&(Y.title=o.newTitle),H&&!q){if(lBt(H))it={onclick:J.option.onclick,featureName:H};else{var at=wrt(H);if(!at)return;it=new at}g[H]=it}else if(it=g[q],!it)return;it.uid=j0("toolbox-feature"),it.model=J,it.ecModel=r,it.api=n;var ut=it instanceof Cu;if(!H&&q){ut&&it.dispose&&it.dispose(r,n);return}if(!J.get("show")||ut&&it.unusable){ut&&it.remove&&it.remove(r,n);return}w(J,it,H),J.setIconStatus=function(ft,_t){var ct=this.option,Dt=this.iconPaths;ct.iconStatus=ct.iconStatus||{},ct.iconStatus[ft]=_t,Dt[ft]&&(_t==="emphasis"?Od:zd)(Dt[ft])},it instanceof Cu&&it.render&&it.render(J,r,n,o)}function w(z,N,H){var q=z.getModel("iconStyle"),Y=z.getModel(["emphasis","iconStyle"]),J=N instanceof Cu&&N.getIcons?N.getIcons():z.get("icon"),it=z.get("title")||{},at,ut;wi(J)?(at={},at[H]=J):at=J,wi(it)?(ut={},ut[H]=it):ut=it;var ft=z.iconPaths={};pt(at,function(_t,ct){var Dt=US(_t,{},{x:-a/2,y:-a/2,width:a,height:a});Dt.setStyle(q.getItemStyle());var Et=Dt.ensureState("emphasis");Et.style=Y.getItemStyle();var bt=new _n({style:{text:ut[ct],align:Y.get("textAlign"),borderRadius:Y.get("textBorderRadius"),padding:Y.get("textPadding"),fill:null,font:XF({fontStyle:Y.get("textFontStyle"),fontFamily:Y.get("textFontFamily"),fontSize:Y.get("textFontSize"),fontWeight:Y.get("textFontWeight")},r)},ignore:!0});Dt.setTextContent(bt),Wd({el:Dt,componentModel:e,itemName:ct,formatterParamsExtra:{title:ut[ct]}}),Dt.__title=ut[ct],Dt.on("mouseover",function(){var Vt=Y.getItemStyle(),zt=c?e.get("right")==null&&e.get("left")!=="right"?"right":"left":e.get("bottom")==null&&e.get("top")!=="bottom"?"bottom":"top";bt.setStyle({fill:Y.get("textFill")||Vt.fill||Vt.stroke||ye.color.neutral99,backgroundColor:Y.get("textBackgroundColor")}),Dt.setTextConfig({position:Y.get("textPosition")||zt}),bt.ignore=!e.get("showTitle"),n.enterEmphasis(this)}).on("mouseout",function(){z.get(["iconStatus",ct])!=="emphasis"&&n.leaveEmphasis(this),bt.hide()}),(z.get(["iconStatus",ct])==="emphasis"?Od:zd)(Dt),s.add(Dt),Dt.on("click",Si(N.onclick,N,r,n,ct)),ft[ct]=Dt})}var I=No(e,n).refContainer,E=e.getBoxLayoutParams(),D=e.get("padding"),R=Ma(E,I,D);cv(e.get("orient"),s,e.get("itemGap"),R.width,R.height),yE(s,E,I,D),s.add(Srt(s.getBoundingRect(),e)),c||s.eachChild(function(z){var N=z.__title,H=z.ensureState("emphasis"),q=H.textConfig||(H.textConfig={}),Y=z.getTextContent(),J=Y&&Y.ensureState("emphasis");if(J&&!Xi(J)&&N){var it=J.style||(J.style={}),at=rE(N,_n.makeFont(it)),ut=z.x+s.x,ft=z.y+s.y+a,_t=!1;ft+at.height>n.getHeight()&&(q.position="top",_t=!0);var ct=_t?-5-at.height:a+10;ut+at.width/2>n.getWidth()?(q.position=["100%",ct],it.align="right"):ut-at.width/2<0&&(q.position=[0,ct],it.align="left")}})},t.prototype.updateView=function(e,r,n,o){pt(this._features,function(s){s instanceof Cu&&s.updateView&&s.updateView(s.model,r,n,o)})},t.prototype.remove=function(e,r){pt(this._features,function(n){n instanceof Cu&&n.remove&&n.remove(e,r)}),this.group.removeAll()},t.prototype.dispose=function(e,r){pt(this._features,function(n){n instanceof Cu&&n.dispose&&n.dispose(e,r)})},t.type="toolbox",t}(Oa);function lBt(i){return i.indexOf("my")===0}const uBt=sBt;var cBt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.onclick=function(e,r){var n=this.model,o=n.get("name")||e.get("title.0.text")||"echarts",s=r.getZr().painter.getType()==="svg",a=s?"svg":n.get("type",!0)||"png",c=r.getConnectedDataURL({type:a,backgroundColor:n.get("backgroundColor",!0)||e.get("backgroundColor")||ye.color.neutral00,connectedBackgroundColor:n.get("connectedBackgroundColor"),excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")}),f=Sn.browser;if(typeof MouseEvent=="function"&&(f.newEdge||!f.ie&&!f.edge)){var g=document.createElement("a");g.download=o+"."+a,g.target="_blank",g.href=c;var v=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1});g.dispatchEvent(v)}else if(window.navigator.msSaveOrOpenBlob||s){var y=c.split(","),w=y[0].indexOf("base64")>-1,I=s?decodeURIComponent(y[1]):y[1];w&&(I=window.atob(I));var E=o+"."+a;if(window.navigator.msSaveOrOpenBlob){for(var D=I.length,R=new Uint8Array(D);D--;)R[D]=I.charCodeAt(D);var z=new Blob([R]);window.navigator.msSaveOrOpenBlob(z,E)}else{var N=document.createElement("iframe");document.body.appendChild(N);var H=N.contentWindow,q=H.document;q.open("image/svg+xml","replace"),q.write(I),q.close(),H.focus(),q.execCommand("SaveAs",!0,E),document.body.removeChild(N)}}else{var Y=n.get("lang"),J='<body style="margin:0;"><img src="'+c+'" style="max-width:100%;" title="'+(Y&&Y[0]||"")+'" /></body>',it=window.open();it.document.write(J),it.document.title=o}},t.getDefaultOption=function(e){var r={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:e.getLocaleModel().get(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:ye.color.neutral00,name:"",excludeComponents:["toolbox"],lang:e.getLocaleModel().get(["toolbox","saveAsImage","lang"])};return r},t}(Cu);const hBt=cBt;var Sq="__ec_magicType_stack__",dBt=[["line","bar"],["stack"]],fBt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getIcons=function(){var e=this.model,r=e.get("icon"),n={};return pt(e.get("type"),function(o){r[o]&&(n[o]=r[o])}),n},t.getDefaultOption=function(e){var r={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:e.getLocaleModel().get(["toolbox","magicType","title"]),option:{},seriesIndex:{}};return r},t.prototype.onclick=function(e,r,n){var o=this.model,s=o.get(["seriesIndex",n]);if(Tq[n]){var a={series:[]},c=function(v){var y=v.subType,w=v.id,I=Tq[n](y,w,v,o);I&&(rr(I,v.option),a.series.push(I));var E=v.coordinateSystem;if(E&&E.type==="cartesian2d"&&(n==="line"||n==="bar")){var D=E.getAxesByScale("ordinal")[0];if(D){var R=D.dim,z=R+"Axis",N=v.getReferringComponents(z,Wa).models[0],H=N.componentIndex;a[z]=a[z]||[];for(var q=0;q<=H;q++)a[z][H]=a[z][H]||{};a[z][H].boundaryGap=n==="bar"}}};pt(dBt,function(v){Ar(v,n)>=0&&pt(v,function(y){o.setIconStatus(y,"normal")})}),o.setIconStatus(n,"emphasis"),e.eachComponent({mainType:"series",query:s==null?null:{seriesIndex:s}},c);var f,g=n;n==="stack"&&(f=Er({stack:o.option.title.tiled,tiled:o.option.title.stack},o.option.title),o.get(["iconStatus",n])!=="emphasis"&&(g="tiled")),r.dispatchAction({type:"changeMagicType",currentType:g,newOption:a,newTitle:f,featureName:"magicType"})}},t}(Cu),Tq={line:function(i,t,e,r){if(i==="bar")return Er({id:t,type:"line",data:e.get("data"),stack:e.get("stack"),markPoint:e.get("markPoint"),markLine:e.get("markLine")},r.get(["option","line"])||{},!0)},bar:function(i,t,e,r){if(i==="line")return Er({id:t,type:"bar",data:e.get("data"),stack:e.get("stack"),markPoint:e.get("markPoint"),markLine:e.get("markLine")},r.get(["option","bar"])||{},!0)},stack:function(i,t,e,r){var n=e.get("stack")===Sq;if(i==="line"||i==="bar")return r.setIconStatus("stack",n?"normal":"emphasis"),Er({id:t,stack:n?"":Sq},r.get(["option","stack"])||{},!0)}};Ih({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(i,t){t.mergeOption(i.newOption)});const pBt=fBt;var zE=new Array(60).join("-"),R0="	";function gBt(i){var t={},e=[],r=[];return i.eachRawSeries(function(n){var o=n.coordinateSystem;if(o&&(o.type==="cartesian2d"||o.type==="polar")){var s=o.getBaseAxis();if(s.type==="category"){var a=s.dim+"_"+s.index;t[a]||(t[a]={categoryAxis:s,valueAxis:o.getOtherAxis(s),series:[]},r.push({axisDim:s.dim,axisIndex:s.index})),t[a].series.push(n)}else e.push(n)}else e.push(n)}),{seriesGroupByCategoryAxis:t,other:e,meta:r}}function mBt(i){var t=[];return pt(i,function(e,r){var n=e.categoryAxis,o=e.valueAxis,s=o.dim,a=[" "].concat(ti(e.series,function(w){return w.name})),c=[n.model.getCategories()];pt(e.series,function(w){var I=w.getRawData();c.push(w.getRawData().mapArray(I.mapDimension(s),function(E){return E}))});for(var f=[a.join(R0)],g=0;g<c[0].length;g++){for(var v=[],y=0;y<c.length;y++)v.push(c[y][g]);f.push(v.join(R0))}t.push(f.join(`
`))}),t.join(`

`+zE+`

`)}function vBt(i){return ti(i,function(t){var e=t.getRawData(),r=[t.name],n=[];return e.each(e.dimensions,function(){for(var o=arguments.length,s=arguments[o-1],a=e.getName(s),c=0;c<o-1;c++)n[c]=arguments[c];r.push((a?a+R0:"")+n.join(R0))}),r.join(`
`)}).join(`

`+zE+`

`)}function _Bt(i){var t=gBt(i);return{value:kn([mBt(t.seriesGroupByCategoryAxis),vBt(t.other)],function(e){return!!e.replace(/[\n\t\s]/g,"")}).join(`

`+zE+`

`),meta:t.meta}}function wM(i){return i.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function yBt(i){var t=i.slice(0,i.indexOf(`
`));if(t.indexOf(R0)>=0)return!0}var yB=new RegExp("["+R0+"]+","g");function xBt(i){for(var t=i.split(/\n+/g),e=wM(t.shift()).split(yB),r=[],n=ti(e,function(c){return{name:c,data:[]}}),o=0;o<t.length;o++){var s=wM(t[o]).split(yB);r.push(s.shift());for(var a=0;a<s.length;a++)n[a]&&(n[a].data[o]=s[a])}return{series:n,categories:r}}function bBt(i){for(var t=i.split(/\n+/g),e=wM(t.shift()),r=[],n=0;n<t.length;n++){var o=wM(t[n]);if(o){var s=o.split(yB),a="",c=void 0,f=!1;isNaN(s[0])?(f=!0,a=s[0],s=s.slice(1),r[n]={name:a,value:[]},c=r[n].value):c=r[n]=[];for(var g=0;g<s.length;g++)c.push(+s[g]);c.length===1&&(f?r[n].value=c[0]:r[n]=c[0])}}return{name:e,data:r}}function wBt(i,t){var e=i.split(new RegExp(`
*`+zE+`
*`,"g")),r={series:[]};return pt(e,function(n,o){if(yBt(n)){var s=xBt(n),a=t[o],c=a.axisDim+"Axis";a&&(r[c]=r[c]||[],r[c][a.axisIndex]={data:s.categories},r.series=r.series.concat(s.series))}else{var s=bBt(n);r.series.push(s)}}),r}var SBt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.onclick=function(e,r){setTimeout(function(){r.dispatchAction({type:"hideTip"})});var n=r.getDom(),o=this.model;this._dom&&n.removeChild(this._dom);var s=document.createElement("div");s.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;padding:5px",s.style.backgroundColor=o.get("backgroundColor")||ye.color.neutral00;var a=document.createElement("h4"),c=o.get("lang")||[];a.innerHTML=c[0]||o.get("title"),a.style.cssText="margin:10px 20px",a.style.color=o.get("textColor");var f=document.createElement("div"),g=document.createElement("textarea");f.style.cssText="overflow:auto";var v=o.get("optionToContent"),y=o.get("contentToOption"),w=_Bt(e);if(Xi(v)){var I=v(r.getOption());wi(I)?f.innerHTML=I:x0(I)&&f.appendChild(I)}else{g.readOnly=o.get("readOnly");var E=g.style;E.cssText="display:block;width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;resize:none;box-sizing:border-box;outline:none",E.color=o.get("textColor"),E.borderColor=o.get("textareaBorderColor"),E.backgroundColor=o.get("textareaColor"),g.value=w.value,f.appendChild(g)}var D=w.meta,R=document.createElement("div");R.style.cssText="position:absolute;bottom:5px;left:0;right:0";var z="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",N=document.createElement("div"),H=document.createElement("div");z+=";background-color:"+o.get("buttonColor"),z+=";color:"+o.get("buttonTextColor");var q=this;function Y(){n.removeChild(s),q._dom=null}PO(N,"click",Y),PO(H,"click",function(){if(y==null&&v!=null||y!=null&&v==null){Y();return}var J;try{Xi(y)?J=y(f,r.getOption()):J=wBt(g.value,D)}catch(it){throw Y(),new Error("Data view format error "+it)}J&&r.dispatchAction({type:"changeDataView",newOption:J}),Y()}),N.innerHTML=c[1],H.innerHTML=c[2],H.style.cssText=N.style.cssText=z,!o.get("readOnly")&&R.appendChild(H),R.appendChild(N),s.appendChild(a),s.appendChild(f),s.appendChild(R),f.style.height=n.clientHeight-80+"px",n.appendChild(s),this._dom=s},t.prototype.remove=function(e,r){this._dom&&r.getDom().removeChild(this._dom)},t.prototype.dispose=function(e,r){this.remove(e,r)},t.getDefaultOption=function(e){var r={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:e.getLocaleModel().get(["toolbox","dataView","title"]),lang:e.getLocaleModel().get(["toolbox","dataView","lang"]),backgroundColor:ye.color.background,textColor:ye.color.primary,textareaColor:ye.color.background,textareaBorderColor:ye.color.border,buttonColor:ye.color.accent50,buttonTextColor:ye.color.neutral00};return r},t}(Cu);function TBt(i,t){return ti(i,function(e,r){var n=t&&t[r];if(nr(n)&&!Ye(n)){var o=nr(e)&&!Ye(e);o||(e={value:e});var s=n.name!=null&&e.name==null;return e=rr(e,n),s&&delete e.name,e}else return e})}Ih({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(i,t){var e=[];pt(i.newOption.series,function(r){var n=t.getSeriesByName(r.name)[0];if(!n)e.push(Ne({type:"scatter"},r));else{var o=n.get("data");e.push({name:r.name,data:TBt(r.data,o)})}}),t.mergeOption(rr({series:e},i.newOption))});const ABt=SBt;var Trt=pt,Art=Wr();function IBt(i,t){var e=PN(i);Trt(t,function(r,n){for(var o=e.length-1;o>=0;o--){var s=e[o];if(s[n])break}if(o<0){var a=i.queryComponents({mainType:"dataZoom",subType:"select",id:n})[0];if(a){var c=a.getPercentRange();e[0][n]={dataZoomId:n,start:c[0],end:c[1]}}}}),e.push(t)}function CBt(i){var t=PN(i),e=t[t.length-1];t.length>1&&t.pop();var r={};return Trt(e,function(n,o){for(var s=t.length-1;s>=0;s--)if(n=t[s][o],n){r[o]=n;break}}),r}function MBt(i){Art(i).snapshots=null}function EBt(i){return PN(i).length}function PN(i){var t=Art(i);return t.snapshots||(t.snapshots=[{}]),t.snapshots}var DBt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.onclick=function(e,r){MBt(e),r.dispatchAction({type:"restore",from:this.uid})},t.getDefaultOption=function(e){var r={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:e.getLocaleModel().get(["toolbox","restore","title"])};return r},t}(Cu);Ih({type:"restore",event:"restore",update:"prepareAndUpdate"},function(i,t){t.resetOption("recreate")});const PBt=DBt;var LBt=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"],RBt=function(){function i(t,e,r){var n=this;this._targetInfoList=[];var o=Aq(e,t);pt(kBt,function(s,a){(!r||!r.include||Ar(r.include,a)>=0)&&s(o,n._targetInfoList)})}return i.prototype.setOutputRanges=function(t,e){return this.matchOutputRanges(t,e,function(r,n,o){if((r.coordRanges||(r.coordRanges=[])).push(n),!r.coordRange){r.coordRange=n;var s=Ek[r.brushType](0,o,n);r.__rangeOffset={offset:Eq[r.brushType](s.values,r.range,[1,1]),xyMinMax:s.xyMinMax}}}),t},i.prototype.matchOutputRanges=function(t,e,r){pt(t,function(n){var o=this.findTargetInfo(n,e);o&&o!==!0&&pt(o.coordSyses,function(s){var a=Ek[n.brushType](1,s,n.range,!0);r(n,a.values,s,e)})},this)},i.prototype.setInputRanges=function(t,e){pt(t,function(r){var n=this.findTargetInfo(r,e);if(r.range=r.range||[],n&&n!==!0){r.panelId=n.panelId;var o=Ek[r.brushType](0,n.coordSys,r.coordRange),s=r.__rangeOffset;r.range=s?Eq[r.brushType](o.values,s.offset,OBt(o.xyMinMax,s.xyMinMax)):o.values}},this)},i.prototype.makePanelOpts=function(t,e){return ti(this._targetInfoList,function(r){var n=r.getPanelRect();return{panelId:r.panelId,defaultBrushType:e?e(r):null,clipPath:Eit(n),isTargetByCursor:Pit(n,t,r.coordSysModel),getLinearBrushOtherExtent:Dit(n)}})},i.prototype.controlSeries=function(t,e,r){var n=this.findTargetInfo(t,r);return n===!0||n&&Ar(n.coordSyses,e.coordinateSystem)>=0},i.prototype.findTargetInfo=function(t,e){for(var r=this._targetInfoList,n=Aq(e,t),o=0;o<r.length;o++){var s=r[o],a=t.panelId;if(a){if(s.panelId===a)return s}else for(var c=0;c<Iq.length;c++)if(Iq[c](n,s))return s}return!0},i}();function xB(i){return i[0]>i[1]&&i.reverse(),i}function Aq(i,t){return u0(i,t,{includeMainTypes:LBt})}var kBt={grid:function(i,t){var e=i.xAxisModels,r=i.yAxisModels,n=i.gridModels,o=Fi(),s={},a={};!e&&!r&&!n||(pt(e,function(c){var f=c.axis.grid.model;o.set(f.id,f),s[f.id]=!0}),pt(r,function(c){var f=c.axis.grid.model;o.set(f.id,f),a[f.id]=!0}),pt(n,function(c){o.set(c.id,c),s[c.id]=!0,a[c.id]=!0}),o.each(function(c){var f=c.coordinateSystem,g=[];pt(f.getCartesians(),function(v,y){(Ar(e,v.getAxis("x").model)>=0||Ar(r,v.getAxis("y").model)>=0)&&g.push(v)}),t.push({panelId:"grid--"+c.id,gridModel:c,coordSysModel:c,coordSys:g[0],coordSyses:g,getPanelRect:Cq.grid,xAxisDeclared:s[c.id],yAxisDeclared:a[c.id]})}))},geo:function(i,t){pt(i.geoModels,function(e){var r=e.coordinateSystem;t.push({panelId:"geo--"+e.id,geoModel:e,coordSysModel:e,coordSys:r,coordSyses:[r],getPanelRect:Cq.geo})})}},Iq=[function(i,t){var e=i.xAxisModel,r=i.yAxisModel,n=i.gridModel;return!n&&e&&(n=e.axis.grid.model),!n&&r&&(n=r.axis.grid.model),n&&n===t.gridModel},function(i,t){var e=i.geoModel;return e&&e===t.geoModel}],Cq={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var i=this.coordSys,t=i.getBoundingRect().clone();return t.applyTransform(uv(i)),t}},Ek={lineX:br(Mq,0),lineY:br(Mq,1),rect:function(i,t,e,r){var n=i?t.pointToData([e[0][0],e[1][0]],r):t.dataToPoint([e[0][0],e[1][0]],r),o=i?t.pointToData([e[0][1],e[1][1]],r):t.dataToPoint([e[0][1],e[1][1]],r),s=[xB([n[0],o[0]]),xB([n[1],o[1]])];return{values:s,xyMinMax:s}},polygon:function(i,t,e,r){var n=[[1/0,-1/0],[1/0,-1/0]],o=ti(e,function(s){var a=i?t.pointToData(s,r):t.dataToPoint(s,r);return n[0][0]=Math.min(n[0][0],a[0]),n[1][0]=Math.min(n[1][0],a[1]),n[0][1]=Math.max(n[0][1],a[0]),n[1][1]=Math.max(n[1][1],a[1]),a});return{values:o,xyMinMax:n}}};function Mq(i,t,e,r){var n=e.getAxis(["x","y"][i]),o=xB(ti([0,1],function(a){return t?n.coordToData(n.toLocalCoord(r[a]),!0):n.toGlobalCoord(n.dataToCoord(r[a]))})),s=[];return s[i]=o,s[1-i]=[NaN,NaN],{values:o,xyMinMax:s}}var Eq={lineX:br(Dq,0),lineY:br(Dq,1),rect:function(i,t,e){return[[i[0][0]-e[0]*t[0][0],i[0][1]-e[0]*t[0][1]],[i[1][0]-e[1]*t[1][0],i[1][1]-e[1]*t[1][1]]]},polygon:function(i,t,e){return ti(i,function(r,n){return[r[0]-e[0]*t[n][0],r[1]-e[1]*t[n][1]]})}};function Dq(i,t,e,r){return[t[0]-r[i]*e[0],t[1]-r[i]*e[1]]}function OBt(i,t){var e=Pq(i),r=Pq(t),n=[e[0]/r[0],e[1]/r[1]];return isNaN(n[0])&&(n[0]=1),isNaN(n[1])&&(n[1]=1),n}function Pq(i){return i?[i[0][1]-i[0][0],i[1][1]-i[1][0]]:[NaN,NaN]}const LN=RBt;var bB=pt,zBt=Nyt("toolbox-dataZoom_"),BBt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.render=function(e,r,n,o){this._brushController||(this._brushController=new lN(n.getZr()),this._brushController.on("brush",Si(this._onBrush,this)).mount()),VBt(e,r,this,o,n),NBt(e,r)},t.prototype.onclick=function(e,r,n){FBt[n].call(this)},t.prototype.remove=function(e,r){this._brushController&&this._brushController.unmount()},t.prototype.dispose=function(e,r){this._brushController&&this._brushController.dispose()},t.prototype._onBrush=function(e){var r=e.areas;if(!e.isEnd||!r.length)return;var n={},o=this.ecModel;this._brushController.updateCovers([]);var s=new LN(RN(this.model),o,{include:["grid"]});s.matchOutputRanges(r,o,function(f,g,v){if(v.type==="cartesian2d"){var y=f.brushType;y==="rect"?(a("x",v,g[0]),a("y",v,g[1])):a({lineX:"x",lineY:"y"}[y],v,g)}}),IBt(o,n),this._dispatchZoomAction(n);function a(f,g,v){var y=g.getAxis(f),w=y.model,I=c(f,w,o),E=I.findRepresentativeAxisProxy(w).getMinMaxSpan();(E.minValueSpan!=null||E.maxValueSpan!=null)&&(v=Np(0,v.slice(),y.scale.getExtent(),0,E.minValueSpan,E.maxValueSpan)),I&&(n[I.id]={dataZoomId:I.id,startValue:v[0],endValue:v[1]})}function c(f,g,v){var y;return v.eachComponent({mainType:"dataZoom",subType:"select"},function(w){var I=w.getAxisModel(f,g.componentIndex);I&&(y=w)}),y}},t.prototype._dispatchZoomAction=function(e){var r=[];bB(e,function(n,o){r.push(Yi(n))}),r.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:r})},t.getDefaultOption=function(e){var r={show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:e.getLocaleModel().get(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:ye.color.backgroundTint}};return r},t}(Cu),FBt={zoom:function(){var i=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:i})},back:function(){this._dispatchZoomAction(CBt(this.ecModel))}};function RN(i){var t={xAxisIndex:i.get("xAxisIndex",!0),yAxisIndex:i.get("yAxisIndex",!0),xAxisId:i.get("xAxisId",!0),yAxisId:i.get("yAxisId",!0)};return t.xAxisIndex==null&&t.xAxisId==null&&(t.xAxisIndex="all"),t.yAxisIndex==null&&t.yAxisId==null&&(t.yAxisIndex="all"),t}function NBt(i,t){i.setIconStatus("back",EBt(t)>1?"emphasis":"normal")}function VBt(i,t,e,r,n){var o=e._isZoomActive;r&&r.type==="takeGlobalCursor"&&(o=r.key==="dataZoomSelect"?r.dataZoomSelectActive:!1),e._isZoomActive=o,i.setIconStatus("zoom",o?"emphasis":"normal");var s=new LN(RN(i),t,{include:["grid"]}),a=s.makePanelOpts(n,function(c){return c.xAxisDeclared&&!c.yAxisDeclared?"lineX":!c.xAxisDeclared&&c.yAxisDeclared?"lineY":"rect"});e._brushController.setPanels(a).enableBrush(o&&a.length?{brushType:"auto",brushStyle:i.getModel("brushStyle").getItemStyle()}:!1)}P1t("dataZoom",function(i){var t=i.getComponent("toolbox",0),e=["feature","dataZoom"];if(!t||t.get(e)==null)return;var r=t.getModel(e),n=[],o=RN(r),s=u0(i,o);bB(s.xAxisModels,function(c){return a(c,"xAxis","xAxisIndex")}),bB(s.yAxisModels,function(c){return a(c,"yAxis","yAxisIndex")});function a(c,f,g){var v=c.componentIndex,y={type:"select",$fromToolbox:!0,filterMode:r.get("filterMode",!0)||"filter",id:zBt+f+v};y[g]=v,n.push(y)}return n});const UBt=BBt;function GBt(i){i.registerComponentModel(oBt),i.registerComponentView(uBt),qy("saveAsImage",hBt),qy("magicType",pBt),qy("dataView",ABt),qy("dataZoom",UBt),qy("restore",PBt),Rr(nBt)}var HBt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="tooltip",t.dependencies=["axisPointer"],t.defaultOption={z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,displayTransition:!0,enterable:!1,backgroundColor:ye.color.neutral00,shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,defaultBorderColor:ye.color.border,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:ye.color.borderShade,width:1,type:"dashed",textStyle:{}}},textStyle:{color:ye.color.tertiary,fontSize:14}},t}(gn);const jBt=HBt;function Irt(i){var t=i.get("confine");return t!=null?!!t:i.get("renderMode")==="richText"}function Crt(i){if(Sn.domSupported){for(var t=document.documentElement.style,e=0,r=i.length;e<r;e++)if(i[e]in t)return i[e]}}var Mrt=Crt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),WBt=Crt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);function Ert(i,t){if(!i)return t;t=wJ(t,!0);var e=i.indexOf(t);return i=e===-1?t:"-"+i.slice(0,e)+"-"+t,i.toLowerCase()}function $Bt(i,t){var e=i.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(i);return e?t?e[t]:e:null}var ZBt=Ert(WBt,"transition"),kN=Ert(Mrt,"transform"),qBt="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(Sn.transform3dSupported?"will-change:transform;":"");function XBt(i){return i=i==="left"?"right":i==="right"?"left":i==="top"?"bottom":"top",i}function YBt(i,t,e){if(!wi(e)||e==="inside")return"";var r=i.get("backgroundColor"),n=i.get("borderWidth");t=wv(t);var o=XBt(e),s=Math.max(Math.round(n)*1.5,6),a="",c=kN+":",f;Ar(["left","right"],o)>-1?(a+="top:50%",c+="translateY(-50%) rotate("+(f=o==="left"?-225:-45)+"deg)"):(a+="left:50%",c+="translateX(-50%) rotate("+(f=o==="top"?225:45)+"deg)");var g=f*Math.PI/180,v=s+n,y=v*Math.abs(Math.cos(g))+v*Math.abs(Math.sin(g)),w=Math.round(((y-Math.SQRT2*n)/2+Math.SQRT2*n-(y-v)/2)*100)/100;a+=";"+o+":-"+w+"px";var I=t+" solid "+n+"px;",E=["position:absolute;width:"+s+"px;height:"+s+"px;z-index:-1;",a+";"+c+";","border-bottom:"+I,"border-right:"+I,"background-color:"+r+";"];return'<div style="'+E.join("")+'"></div>'}function KBt(i,t,e){var r="cubic-bezier(0.23,1,0.32,1)",n="",o="";return e&&(n=" "+i/2+"s "+r,o="opacity"+n+",visibility"+n),t||(n=" "+i+"s "+r,o+=(o.length?",":"")+(Sn.transformSupported?""+kN+n:",left"+n+",top"+n)),ZBt+":"+o}function Lq(i,t,e){var r=i.toFixed(0)+"px",n=t.toFixed(0)+"px";if(!Sn.transformSupported)return e?"top:"+n+";left:"+r+";":[["top",n],["left",r]];var o=Sn.transform3dSupported,s="translate"+(o?"3d":"")+"("+r+","+n+(o?",0":"")+")";return e?"top:0;left:0;"+kN+":"+s+";":[["top",0],["left",0],[Mrt,s]]}function JBt(i){var t=[],e=i.get("fontSize"),r=i.getTextColor();r&&t.push("color:"+r),t.push("font:"+i.getFont());var n=Ui(i.get("lineHeight"),Math.round(e*3/2));e&&t.push("line-height:"+n+"px");var o=i.get("textShadowColor"),s=i.get("textShadowBlur")||0,a=i.get("textShadowOffsetX")||0,c=i.get("textShadowOffsetY")||0;return o&&s&&t.push("text-shadow:"+a+"px "+c+"px "+s+"px "+o),pt(["decoration","align"],function(f){var g=i.get(f);g&&t.push("text-"+f+":"+g)}),t.join(";")}function QBt(i,t,e,r){var n=[],o=i.get("transitionDuration"),s=i.get("backgroundColor"),a=i.get("shadowBlur"),c=i.get("shadowColor"),f=i.get("shadowOffsetX"),g=i.get("shadowOffsetY"),v=i.getModel("textStyle"),y=hQ(i,"html"),w=f+"px "+g+"px "+a+"px "+c;return n.push("box-shadow:"+w),t&&o>0&&n.push(KBt(o,e,r)),s&&n.push("background-color:"+s),pt(["width","color","radius"],function(I){var E="border-"+I,D=wJ(E),R=i.get(D);R!=null&&n.push(E+":"+R+(I==="color"?"":"px"))}),n.push(JBt(v)),y!=null&&n.push("padding:"+GS(y).join("px ")+"px"),n.join(";")+";"}function Rq(i,t,e,r,n){var o=t&&t.painter;if(e){var s=o&&o.getViewportRoot();s&&t_t(i,s,e,r,n)}else{i[0]=r,i[1]=n;var a=o&&o.getViewportRootOffset();a&&(i[0]+=a.offsetLeft,i[1]+=a.offsetTop)}i[2]=i[0]/t.getWidth(),i[3]=i[1]/t.getHeight()}var tFt=function(){function i(t,e){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._alwaysShowContent=!1,this._firstShow=!0,this._longHide=!0,Sn.wxa)return null;var r=document.createElement("div");r.domBelongToZr=!0,this.el=r;var n=this._zr=t.getZr(),o=e.appendTo,s=o&&(wi(o)?document.querySelector(o):x0(o)?o:Xi(o)&&o(t.getDom()));Rq(this._styleCoord,n,s,t.getWidth()/2,t.getHeight()/2),(s||t.getDom()).appendChild(r),this._api=t,this._container=s;var a=this;r.onmouseenter=function(){a._enterable&&(clearTimeout(a._hideTimeout),a._show=!0),a._inContent=!0},r.onmousemove=function(c){if(c=c||window.event,!a._enterable){var f=n.handler,g=n.painter.getViewportRoot();wu(g,c,!0),f.dispatch("mousemove",c)}},r.onmouseleave=function(){a._inContent=!1,a._enterable&&a._show&&a.hideLater(a._hideDelay)}}return i.prototype.update=function(t){if(!this._container){var e=this._api.getDom(),r=$Bt(e,"position"),n=e.style;n.position!=="absolute"&&r!=="absolute"&&(n.position="relative")}var o=t.get("alwaysShowContent");o&&this._moveIfResized(),this._alwaysShowContent=o,this._enableDisplayTransition=t.get("displayTransition")&&t.get("transitionDuration")>0,this.el.className=t.get("className")||""},i.prototype.show=function(t,e){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var r=this.el,n=r.style,o=this._styleCoord;r.innerHTML?n.cssText=qBt+QBt(t,!this._firstShow,this._longHide,this._enableDisplayTransition)+Lq(o[0],o[1],!0)+("border-color:"+wv(e)+";")+(t.get("extraCssText")||"")+(";pointer-events:"+(this._enterable?"auto":"none")):n.display="none",this._show=!0,this._firstShow=!1,this._longHide=!1},i.prototype.setContent=function(t,e,r,n,o){var s=this.el;if(t==null){s.innerHTML="";return}var a="";if(wi(o)&&r.get("trigger")==="item"&&!Irt(r)&&(a=YBt(r,n,o)),wi(t))s.innerHTML=t+a;else if(t){s.innerHTML="",Ye(t)||(t=[t]);for(var c=0;c<t.length;c++)x0(t[c])&&t[c].parentNode!==s&&s.appendChild(t[c]);if(a&&s.childNodes.length){var f=document.createElement("div");f.innerHTML=a,s.appendChild(f)}}},i.prototype.setEnterable=function(t){this._enterable=t},i.prototype.getSize=function(){var t=this.el;return t?[t.offsetWidth,t.offsetHeight]:[0,0]},i.prototype.moveTo=function(t,e){if(this.el){var r=this._styleCoord;if(Rq(r,this._zr,this._container,t,e),r[0]!=null&&r[1]!=null){var n=this.el.style,o=Lq(r[0],r[1]);pt(o,function(s){n[s[0]]=s[1]})}}},i.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},i.prototype.hide=function(){var t=this,e=this.el.style;this._enableDisplayTransition?(e.visibility="hidden",e.opacity="0"):e.display="none",Sn.transform3dSupported&&(e.willChange=""),this._show=!1,this._longHideTimeout=setTimeout(function(){return t._longHide=!0},500)},i.prototype.hideLater=function(t){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(Si(this.hide,this),t)):this.hide())},i.prototype.isShow=function(){return this._show},i.prototype.dispose=function(){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var t=this._zr;e_t(t&&t.painter&&t.painter.getViewportRoot(),this._container);var e=this.el;if(e){e.onmouseenter=e.onmousemove=e.onmouseleave=null;var r=e.parentNode;r&&r.removeChild(e)}this.el=this._container=null},i}();const eFt=tFt;var iFt=function(){function i(t){this._show=!1,this._styleCoord=[0,0,0,0],this._alwaysShowContent=!1,this._enterable=!0,this._zr=t.getZr(),Oq(this._styleCoord,this._zr,t.getWidth()/2,t.getHeight()/2)}return i.prototype.update=function(t){var e=t.get("alwaysShowContent");e&&this._moveIfResized(),this._alwaysShowContent=e},i.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},i.prototype.setContent=function(t,e,r,n,o){var s=this;nr(t)&&Pn(""),this.el&&this._zr.remove(this.el);var a=r.getModel("textStyle");this.el=new _n({style:{rich:e.richTextStyles,text:t,lineHeight:22,borderWidth:1,borderColor:n,textShadowColor:a.get("textShadowColor"),fill:r.get(["textStyle","color"]),padding:hQ(r,"richText"),verticalAlign:"top",align:"left"},z:r.get("z")}),pt(["backgroundColor","borderRadius","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"],function(f){s.el.style[f]=r.get(f)}),pt(["textShadowBlur","textShadowOffsetX","textShadowOffsetY"],function(f){s.el.style[f]=a.get(f)||0}),this._zr.add(this.el);var c=this;this.el.on("mouseover",function(){c._enterable&&(clearTimeout(c._hideTimeout),c._show=!0),c._inContent=!0}),this.el.on("mouseout",function(){c._enterable&&c._show&&c.hideLater(c._hideDelay),c._inContent=!1})},i.prototype.setEnterable=function(t){this._enterable=t},i.prototype.getSize=function(){var t=this.el,e=this.el.getBoundingRect(),r=kq(t.style);return[e.width+r.left+r.right,e.height+r.top+r.bottom]},i.prototype.moveTo=function(t,e){var r=this.el;if(r){var n=this._styleCoord;Oq(n,this._zr,t,e),t=n[0],e=n[1];var o=r.style,s=Qf(o.borderWidth||0),a=kq(o);r.x=t+s+a.left,r.y=e+s+a.top,r.markRedraw()}},i.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},i.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},i.prototype.hideLater=function(t){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(Si(this.hide,this),t)):this.hide())},i.prototype.isShow=function(){return this._show},i.prototype.dispose=function(){this._zr.remove(this.el)},i}();function Qf(i){return Math.max(0,i)}function kq(i){var t=Qf(i.shadowBlur||0),e=Qf(i.shadowOffsetX||0),r=Qf(i.shadowOffsetY||0);return{left:Qf(t-e),right:Qf(t+e),top:Qf(t-r),bottom:Qf(t+r)}}function Oq(i,t,e,r){i[0]=e,i[1]=r,i[2]=i[0]/t.getWidth(),i[3]=i[1]/t.getHeight()}const rFt=iFt;var nFt=new jr({shape:{x:-1,y:-1,width:2,height:2}}),aFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){if(!(Sn.node||!r.getDom())){var n=e.getComponent("tooltip"),o=this._renderMode=$yt(n.get("renderMode"));this._tooltipContent=o==="richText"?new rFt(r):new eFt(r,{appendTo:n.get("appendToBody",!0)?"body":n.get("appendTo",!0)})}},t.prototype.render=function(e,r,n){if(!(Sn.node||!n.getDom())){this.group.removeAll(),this._tooltipModel=e,this._ecModel=r,this._api=n;var o=this._tooltipContent;o.update(e),o.setEnterable(e.get("enterable")),this._initGlobalListener(),this._keepShow(),this._renderMode!=="richText"&&e.get("transitionDuration")?Z0(this,"_updatePosition",50,"fixRate"):cS(this,"_updatePosition")}},t.prototype._initGlobalListener=function(){var e=this._tooltipModel,r=e.get("triggerOn");urt("itemTooltip",this._api,Si(function(n,o,s){r!=="none"&&(r.indexOf(n)>=0?this._tryShow(o,s):n==="leave"&&this._hide(s))},this))},t.prototype._keepShow=function(){var e=this._tooltipModel,r=this._ecModel,n=this._api,o=e.get("triggerOn");if(this._lastX!=null&&this._lastY!=null&&o!=="none"&&o!=="click"){var s=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){!n.isDisposed()&&s.manuallyShowTip(e,r,n,{x:s._lastX,y:s._lastY,dataByCoordSys:s._lastDataByCoordSys})})}},t.prototype.manuallyShowTip=function(e,r,n,o){if(!(o.from===this.uid||Sn.node||!n.getDom())){var s=zq(o,n);this._ticket="";var a=o.dataByCoordSys,c=uFt(o,r,n);if(c){var f=c.el.getBoundingRect().clone();f.applyTransform(c.el.transform),this._tryShow({offsetX:f.x+f.width/2,offsetY:f.y+f.height/2,target:c.el,position:o.position,positionDefault:"bottom"},s)}else if(o.tooltip&&o.x!=null&&o.y!=null){var g=nFt;g.x=o.x,g.y=o.y,g.update(),cr(g).tooltipConfig={name:null,option:o.tooltip},this._tryShow({offsetX:o.x,offsetY:o.y,target:g},s)}else if(a)this._tryShow({offsetX:o.x,offsetY:o.y,position:o.position,dataByCoordSys:a,tooltipOption:o.tooltipOption},s);else if(o.seriesIndex!=null){if(this._manuallyAxisShowTip(e,r,n,o))return;var v=crt(o,r),y=v.point[0],w=v.point[1];y!=null&&w!=null&&this._tryShow({offsetX:y,offsetY:w,target:v.el,position:o.position,positionDefault:"bottom"},s)}else o.x!=null&&o.y!=null&&(n.dispatchAction({type:"updateAxisPointer",x:o.x,y:o.y}),this._tryShow({offsetX:o.x,offsetY:o.y,position:o.position,target:n.getZr().findHover(o.x,o.y).target},s))}},t.prototype.manuallyHideTip=function(e,r,n,o){var s=this._tooltipContent;this._tooltipModel&&s.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,o.from!==this.uid&&this._hide(zq(o,n))},t.prototype._manuallyAxisShowTip=function(e,r,n,o){var s=o.seriesIndex,a=o.dataIndex,c=r.getComponent("axisPointer").coordSysAxesInfo;if(!(s==null||a==null||c==null)){var f=r.getSeriesByIndex(s);if(f){var g=f.getData(),v=Nb([g.getItemModel(a),f,(f.coordinateSystem||{}).model],this._tooltipModel);if(v.get("trigger")==="axis")return n.dispatchAction({type:"updateAxisPointer",seriesIndex:s,dataIndex:a,position:o.position}),!0}}},t.prototype._tryShow=function(e,r){var n=e.target,o=this._tooltipModel;if(o){this._lastX=e.offsetX,this._lastY=e.offsetY;var s=e.dataByCoordSys;if(s&&s.length)this._showAxisTooltip(s,e);else if(n){var a=cr(n);if(a.ssrType==="legend")return;this._lastDataByCoordSys=null;var c,f;Xm(n,function(g){if(g.tooltipDisabled)return c=f=null,!0;c||f||(cr(g).dataIndex!=null?c=g:cr(g).tooltipConfig!=null&&(f=g))},!0),c?this._showSeriesItemTooltip(e,c,r):f?this._showComponentItemTooltip(e,f,r):this._hide(r)}else this._lastDataByCoordSys=null,this._hide(r)}},t.prototype._showOrMove=function(e,r){var n=e.get("showDelay");r=Si(r,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(r,n):r()},t.prototype._showAxisTooltip=function(e,r){var n=this._ecModel,o=this._tooltipModel,s=[r.offsetX,r.offsetY],a=Nb([r.tooltipOption],o),c=this._renderMode,f=[],g=So("section",{blocks:[],noHeader:!0}),v=[],y=new uR;pt(e,function(z){pt(z.dataByAxis,function(N){var H=n.getComponent(N.axisDim+"Axis",N.axisIndex),q=N.value;if(!(!H||q==null)){var Y=ort(q,H.axis,n,N.seriesDataIndices,N.valueLabelOpt),J=So("section",{header:Y,noHeader:!Du(Y),sortBlocks:!0,blocks:[]});g.blocks.push(J),pt(N.seriesDataIndices,function(it){var at=n.getSeriesByIndex(it.seriesIndex),ut=it.dataIndexInside,ft=at.getDataParams(ut);if(!(ft.dataIndex<0)){ft.axisDim=N.axisDim,ft.axisIndex=N.axisIndex,ft.axisType=N.axisType,ft.axisId=N.axisId,ft.axisValue=JC(H.axis,{value:q}),ft.axisValueLabel=Y,ft.marker=y.makeTooltipMarker("item",wv(ft.color),c);var _t=Xj(at.formatTooltip(ut,!0,null)),ct=_t.frag;if(ct){var Dt=Nb([at],o).get("valueFormatter");J.blocks.push(Dt?Ne({valueFormatter:Dt},ct):ct)}_t.text&&v.push(_t.text),f.push(ft)}})}})}),g.blocks.reverse(),v.reverse();var w=r.position,I=a.get("order"),E=e8(g,y,c,I,n.get("useUTC"),a.get("textStyle"));E&&v.unshift(E);var D=c==="richText"?`

`:"<br/>",R=v.join(D);this._showOrMove(a,function(){this._updateContentNotChangedOnAxis(e,f)?this._updatePosition(a,w,s[0],s[1],this._tooltipContent,f):this._showTooltipContent(a,R,f,Math.random()+"",s[0],s[1],w,null,y)})},t.prototype._showSeriesItemTooltip=function(e,r,n){var o=this._ecModel,s=cr(r),a=s.seriesIndex,c=o.getSeriesByIndex(a),f=s.dataModel||c,g=s.dataIndex,v=s.dataType,y=f.getData(v),w=this._renderMode,I=e.positionDefault,E=Nb([y.getItemModel(g),f,c&&(c.coordinateSystem||{}).model],this._tooltipModel,I?{position:I}:null),D=E.get("trigger");if(!(D!=null&&D!=="item")){var R=f.getDataParams(g,v),z=new uR;R.marker=z.makeTooltipMarker("item",wv(R.color),w);var N=Xj(f.formatTooltip(g,!1,v)),H=E.get("order"),q=E.get("valueFormatter"),Y=N.frag,J=Y?e8(q?Ne({valueFormatter:q},Y):Y,z,w,H,o.get("useUTC"),E.get("textStyle")):N.text,it="item_"+f.name+"_"+g;this._showOrMove(E,function(){this._showTooltipContent(E,J,R,it,e.offsetX,e.offsetY,e.position,e.target,z)}),n({type:"showTip",dataIndexInside:g,dataIndex:y.getRawIndex(g),seriesIndex:a,from:this.uid})}},t.prototype._showComponentItemTooltip=function(e,r,n){var o=this._renderMode==="html",s=cr(r),a=s.tooltipConfig,c=a.option||{},f=c.encodeHTMLContent;if(wi(c)){var g=c;c={content:g,formatter:g},f=!0}f&&o&&c.content&&(c=Yi(c),c.content=Rs(c.content));var v=[c],y=this._ecModel.getComponent(s.componentMainType,s.componentIndex);y&&v.push(y),v.push({formatter:c.content});var w=e.positionDefault,I=Nb(v,this._tooltipModel,w?{position:w}:null),E=I.get("content"),D=Math.random()+"",R=new uR;this._showOrMove(I,function(){var z=Yi(I.get("formatterParams")||{});this._showTooltipContent(I,E,z,D,e.offsetX,e.offsetY,e.position,r,R)}),n({type:"showTip",from:this.uid})},t.prototype._showTooltipContent=function(e,r,n,o,s,a,c,f,g){if(this._ticket="",!(!e.get("showContent")||!e.get("show"))){var v=this._tooltipContent;v.setEnterable(e.get("enterable"));var y=e.get("formatter");c=c||e.get("position");var w=r,I=this._getNearestPoint([s,a],n,e.get("trigger"),e.get("borderColor"),e.get("defaultBorderColor",!0)),E=I.color;if(y)if(wi(y)){var D=e.ecModel.get("useUTC"),R=Ye(n)?n[0]:n,z=R&&R.axisType&&R.axisType.indexOf("time")>=0;w=y,z&&(w=_E(R.axisValue,w,D)),w=SJ(w,n,!0)}else if(Xi(y)){var N=Si(function(H,q){H===this._ticket&&(v.setContent(q,g,e,E,c),this._updatePosition(e,c,s,a,v,n,f))},this);this._ticket=o,w=y(n,o,N)}else w=y;v.setContent(w,g,e,E,c),v.show(e,E),this._updatePosition(e,c,s,a,v,n,f)}},t.prototype._getNearestPoint=function(e,r,n,o,s){if(n==="axis"||Ye(r))return{color:o||s};if(!Ye(r))return{color:o||r.color||r.borderColor}},t.prototype._updatePosition=function(e,r,n,o,s,a,c){var f=this._api.getWidth(),g=this._api.getHeight();r=r||e.get("position");var v=s.getSize(),y=e.get("align"),w=e.get("verticalAlign"),I=c&&c.getBoundingRect().clone();if(c&&I.applyTransform(c.transform),Xi(r)&&(r=r([n,o],a,s.el,I,{viewSize:[f,g],contentSize:v.slice()})),Ye(r))n=xi(r[0],f),o=xi(r[1],g);else if(nr(r)){var E=r;E.width=v[0],E.height=v[1];var D=Ma(E,{width:f,height:g});n=D.x,o=D.y,y=null,w=null}else if(wi(r)&&c){var R=lFt(r,I,v,e.get("borderWidth"));n=R[0],o=R[1]}else{var R=oFt(n,o,s,f,g,y?null:20,w?null:20);n=R[0],o=R[1]}if(y&&(n-=Bq(y)?v[0]/2:y==="right"?v[0]:0),w&&(o-=Bq(w)?v[1]/2:w==="bottom"?v[1]:0),Irt(e)){var R=sFt(n,o,s,f,g);n=R[0],o=R[1]}s.moveTo(n,o)},t.prototype._updateContentNotChangedOnAxis=function(e,r){var n=this._lastDataByCoordSys,o=this._cbParamsList,s=!!n&&n.length===e.length;return s&&pt(n,function(a,c){var f=a.dataByAxis||[],g=e[c]||{},v=g.dataByAxis||[];s=s&&f.length===v.length,s&&pt(f,function(y,w){var I=v[w]||{},E=y.seriesDataIndices||[],D=I.seriesDataIndices||[];s=s&&y.value===I.value&&y.axisType===I.axisType&&y.axisId===I.axisId&&E.length===D.length,s&&pt(E,function(R,z){var N=D[z];s=s&&R.seriesIndex===N.seriesIndex&&R.dataIndex===N.dataIndex}),o&&pt(y.seriesDataIndices,function(R){var z=R.seriesIndex,N=r[z],H=o[z];N&&H&&H.data!==N.data&&(s=!1)})})}),this._lastDataByCoordSys=e,this._cbParamsList=r,!!s},t.prototype._hide=function(e){this._lastDataByCoordSys=null,e({type:"hideTip",from:this.uid})},t.prototype.dispose=function(e,r){Sn.node||!r.getDom()||(cS(this,"_updatePosition"),this._tooltipContent.dispose(),fB("itemTooltip",r))},t.type="tooltip",t}(Oa);function Nb(i,t,e){var r=t.ecModel,n;e?(n=new bn(e,r,r),n=new bn(t.option,n,r)):n=t;for(var o=i.length-1;o>=0;o--){var s=i[o];s&&(s instanceof bn&&(s=s.get("tooltip",!0)),wi(s)&&(s={formatter:s}),s&&(n=new bn(s,n,r)))}return n}function zq(i,t){return i.dispatchAction||Si(t.dispatchAction,t)}function oFt(i,t,e,r,n,o,s){var a=e.getSize(),c=a[0],f=a[1];return o!=null&&(i+c+o+2>r?i-=c+o:i+=o),s!=null&&(t+f+s>n?t-=f+s:t+=s),[i,t]}function sFt(i,t,e,r,n){var o=e.getSize(),s=o[0],a=o[1];return i=Math.min(i+s,r)-s,t=Math.min(t+a,n)-a,i=Math.max(i,0),t=Math.max(t,0),[i,t]}function lFt(i,t,e,r){var n=e[0],o=e[1],s=Math.ceil(Math.SQRT2*r)+8,a=0,c=0,f=t.width,g=t.height;switch(i){case"inside":a=t.x+f/2-n/2,c=t.y+g/2-o/2;break;case"top":a=t.x+f/2-n/2,c=t.y-o-s;break;case"bottom":a=t.x+f/2-n/2,c=t.y+g+s;break;case"left":a=t.x-n-s,c=t.y+g/2-o/2;break;case"right":a=t.x+f+s,c=t.y+g/2-o/2}return[a,c]}function Bq(i){return i==="center"||i==="middle"}function uFt(i,t,e){var r=RF(i).queryOptionMap,n=r.keys()[0];if(!(!n||n==="series")){var o=N0(t,n,r.get(n),{useDefault:!1,enableAll:!1,enableNone:!1}),s=o.models[0];if(s){var a=e.getViewOfComponentModel(s),c;if(a.group.traverse(function(f){var g=cr(f).tooltipConfig;if(g&&g.name===i.name)return c=f,!0}),c)return{componentMainType:n,componentIndex:s.componentIndex,el:c}}}}const cFt=aFt;function hFt(i){Rr(QS),i.registerComponentModel(jBt),i.registerComponentView(cFt),i.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},ho),i.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},ho)}var dFt=["rect","polygon","keep","clear"];function fFt(i,t){var e=aa(i?i.brush:[]);if(e.length){var r=[];pt(e,function(c){var f=c.hasOwnProperty("toolbox")?c.toolbox:[];f instanceof Array&&(r=r.concat(f))});var n=i&&i.toolbox;Ye(n)&&(n=n[0]),n||(n={feature:{}},i.toolbox=[n]);var o=n.feature||(n.feature={}),s=o.brush||(o.brush={}),a=s.type||(s.type=[]);a.push.apply(a,r),pFt(a),t&&!a.length&&a.push.apply(a,dFt)}}function pFt(i){var t={};pt(i,function(e){t[e]=1}),i.length=0,pt(t,function(e,r){i.push(r)})}var Fq=pt;function Nq(i){if(i){for(var t in i)if(i.hasOwnProperty(t))return!0}}function wB(i,t,e){var r={};return Fq(t,function(o){var s=r[o]=n();Fq(i[o],function(a,c){if(_s.isValidType(c)){var f={type:c,visual:a};e&&e(f,o),s[c]=new _s(f),c==="opacity"&&(f=Yi(f),f.type="colorAlpha",s.__hidden.__alphaForOpacity=new _s(f))}})}),r;function n(){var o=function(){};o.prototype.__hidden=o.prototype;var s=new o;return s}}function Drt(i,t,e){var r;pt(e,function(n){t.hasOwnProperty(n)&&Nq(t[n])&&(r=!0)}),r&&pt(e,function(n){t.hasOwnProperty(n)&&Nq(t[n])?i[n]=Yi(t[n]):delete i[n]})}function gFt(i,t,e,r,n,o){var s={};pt(i,function(v){var y=_s.prepareVisualTypes(t[v]);s[v]=y});var a;function c(v){return v3(e,a,v)}function f(v,y){bQ(e,a,v,y)}o==null?e.each(g):e.each([o],g);function g(v,y){a=o==null?v:y;var w=e.getRawDataItem(a);if(!(w&&w.visualMap===!1))for(var I=r.call(n,v),E=t[I],D=s[I],R=0,z=D.length;R<z;R++){var N=D[R];E[N]&&E[N].applyVisual(v,c,f)}}}function mFt(i,t,e,r){var n={};return pt(i,function(o){var s=_s.prepareVisualTypes(t[o]);n[o]=s}),{progress:function(s,a){var c;r!=null&&(c=a.getDimensionIndex(r));function f(q){return v3(a,v,q)}function g(q,Y){bQ(a,v,q,Y)}for(var v,y=a.getStore();(v=s.next())!=null;){var w=a.getRawDataItem(v);if(!(w&&w.visualMap===!1))for(var I=r!=null?y.get(c,v):v,E=e(I),D=t[E],R=n[E],z=0,N=R.length;z<N;z++){var H=R[z];D[H]&&D[H].applyVisual(I,f,g)}}}}}function vFt(i){var t=i.brushType,e={point:function(r){return Vq[t].point(r,e,i)},rect:function(r){return Vq[t].rect(r,e,i)}};return e}var Vq={lineX:Uq(0),lineY:Uq(1),rect:{point:function(i,t,e){return i&&e.boundingRect.contain(i[0],i[1])},rect:function(i,t,e){return i&&e.boundingRect.intersect(i)}},polygon:{point:function(i,t,e){return i&&e.boundingRect.contain(i[0],i[1])&&Fm(e.range,i[0],i[1])},rect:function(i,t,e){var r=e.range;if(!i||r.length<=1)return!1;var n=i.x,o=i.y,s=i.width,a=i.height,c=r[0];if(Fm(r,n,o)||Fm(r,n+s,o)||Fm(r,n,o+a)||Fm(r,n+s,o+a)||sr.create(i).contain(c[0],c[1])||ew(n,o,n+s,o,r)||ew(n,o,n,o+a,r)||ew(n+s,o,n+s,o+a,r)||ew(n,o+a,n+s,o+a,r))return!0}}};function Uq(i){var t=["x","y"],e=["width","height"];return{point:function(r,n,o){if(r){var s=o.range,a=r[i];return Vb(a,s)}},rect:function(r,n,o){if(r){var s=o.range,a=[r[t[i]],r[t[i]]+r[e[i]]];return a[1]<a[0]&&a.reverse(),Vb(a[0],s)||Vb(a[1],s)||Vb(s[0],a)||Vb(s[1],a)}}}}function Vb(i,t){return t[0]<=i&&i<=t[1]}var Gq=["inBrush","outOfBrush"],Dk="__ecBrushSelect",SB="__ecInBrushSelectEvent";function Prt(i){i.eachComponent({mainType:"brush"},function(t){var e=t.brushTargetManager=new LN(t.option,i);e.setInputRanges(t.areas,i)})}function _Ft(i,t,e){var r=[],n,o;i.eachComponent({mainType:"brush"},function(s){e&&e.type==="takeGlobalCursor"&&s.setBrushOption(e.key==="brush"?e.brushOption:{brushType:!1})}),Prt(i),i.eachComponent({mainType:"brush"},function(s,a){var c={brushId:s.id,brushIndex:a,brushName:s.name,areas:Yi(s.areas),selected:[]};r.push(c);var f=s.option,g=f.brushLink,v=[],y=[],w=[],I=!1;a||(n=f.throttleType,o=f.throttleDelay);var E=ti(s.areas,function(q){var Y=wFt[q.brushType],J=rr({boundingRect:Y?Y(q):void 0},q);return J.selectors=vFt(J),J}),D=wB(s.option,Gq,function(q){q.mappingMethod="fixed"});Ye(g)&&pt(g,function(q){v[q]=1});function R(q){return g==="all"||!!v[q]}function z(q){return!!q.length}i.eachSeries(function(q,Y){var J=w[Y]=[];q.subType==="parallel"?N(q,Y):H(q,Y,J)});function N(q,Y){var J=q.coordinateSystem;I=I||J.hasAxisBrushed(),R(Y)&&J.eachActiveState(q.getData(),function(it,at){it==="active"&&(y[at]=1)})}function H(q,Y,J){if(!(!q.brushSelector||bFt(s,Y))&&(pt(E,function(at){s.brushTargetManager.controlSeries(at,q,i)&&J.push(at),I=I||z(J)}),R(Y)&&z(J))){var it=q.getData();it.each(function(at){Hq(q,J,it,at)&&(y[at]=1)})}}i.eachSeries(function(q,Y){var J={seriesId:q.id,seriesIndex:Y,seriesName:q.name,dataIndex:[]};c.selected.push(J);var it=w[Y],at=q.getData(),ut=R(Y)?function(ft){return y[ft]?(J.dataIndex.push(at.getRawIndex(ft)),"inBrush"):"outOfBrush"}:function(ft){return Hq(q,it,at,ft)?(J.dataIndex.push(at.getRawIndex(ft)),"inBrush"):"outOfBrush"};(R(Y)?I:z(it))&&gFt(Gq,D,at,ut)})}),yFt(t,n,o,r,e)}function yFt(i,t,e,r,n){if(n){var o=i.getZr();if(!o[SB]){o[Dk]||(o[Dk]=xFt);var s=Z0(o,Dk,e,t);s(i,r)}}}function xFt(i,t){if(!i.isDisposed()){var e=i.getZr();e[SB]=!0,i.dispatchAction({type:"brushSelect",batch:t}),e[SB]=!1}}function Hq(i,t,e,r){for(var n=0,o=t.length;n<o;n++){var s=t[n];if(i.brushSelector(r,e,s.selectors,s))return!0}}function bFt(i,t){var e=i.option.seriesIndex;return e!=null&&e!=="all"&&(Ye(e)?Ar(e,t)<0:t!==e)}var wFt={rect:function(i){return jq(i.range)},polygon:function(i){for(var t,e=i.range,r=0,n=e.length;r<n;r++){t=t||[[1/0,-1/0],[1/0,-1/0]];var o=e[r];o[0]<t[0][0]&&(t[0][0]=o[0]),o[0]>t[0][1]&&(t[0][1]=o[0]),o[1]<t[1][0]&&(t[1][0]=o[1]),o[1]>t[1][1]&&(t[1][1]=o[1])}return t&&jq(t)}};function jq(i){return new sr(i[0][0],i[1][0],i[0][1]-i[0][0],i[1][1]-i[1][0])}var SFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){this.ecModel=e,this.api=r,this.model,(this._brushController=new lN(r.getZr())).on("brush",Si(this._onBrush,this)).mount()},t.prototype.render=function(e,r,n,o){this.model=e,this._updateController(e,r,n,o)},t.prototype.updateTransform=function(e,r,n,o){Prt(r),this._updateController(e,r,n,o)},t.prototype.updateVisual=function(e,r,n,o){this.updateTransform(e,r,n,o)},t.prototype.updateView=function(e,r,n,o){this._updateController(e,r,n,o)},t.prototype._updateController=function(e,r,n,o){(!o||o.$from!==e.id)&&this._brushController.setPanels(e.brushTargetManager.makePanelOpts(n)).enableBrush(e.brushOption).updateCovers(e.areas.slice())},t.prototype.dispose=function(){this._brushController.dispose()},t.prototype._onBrush=function(e){var r=this.model.id,n=this.model.brushTargetManager.setOutputRanges(e.areas,this.ecModel);(!e.isEnd||e.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:r,areas:Yi(n),$from:r}),e.isEnd&&this.api.dispatchAction({type:"brushEnd",brushId:r,areas:Yi(n),$from:r})},t.type="brush",t}(Oa);const TFt=SFt;var AFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.areas=[],e.brushOption={},e}return t.prototype.optionUpdated=function(e,r){var n=this.option;!r&&Drt(n,e,["inBrush","outOfBrush"]);var o=n.inBrush=n.inBrush||{};n.outOfBrush=n.outOfBrush||{color:this.option.defaultOutOfBrushColor},o.hasOwnProperty("liftZ")||(o.liftZ=5)},t.prototype.setAreas=function(e){e&&(this.areas=ti(e,function(r){return Wq(this.option,r)},this))},t.prototype.setBrushOption=function(e){this.brushOption=Wq(this.option,e),this.brushType=this.brushOption.brushType},t.type="brush",t.dependencies=["geo","grid","xAxis","yAxis","parallel","series"],t.defaultOption={seriesIndex:"all",brushType:"rect",brushMode:"single",transformable:!0,brushStyle:{borderWidth:1,color:ye.color.backgroundTint,borderColor:ye.color.borderTint},throttleType:"fixRate",throttleDelay:0,removeOnClick:!0,z:1e4,defaultOutOfBrushColor:ye.color.disabled},t}(gn);function Wq(i,t){return Er({brushType:i.brushType,brushMode:i.brushMode,transformable:i.transformable,brushStyle:new bn(i.brushStyle).getItemStyle(),removeOnClick:i.removeOnClick,z:i.z},t,!0)}const IFt=AFt;var CFt=["rect","polygon","lineX","lineY","keep","clear"],MFt=function(i){Se(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.render=function(e,r,n){var o,s,a;r.eachComponent({mainType:"brush"},function(c){o=c.brushType,s=c.brushOption.brushMode||"single",a=a||!!c.areas.length}),this._brushType=o,this._brushMode=s,pt(e.get("type",!0),function(c){e.setIconStatus(c,(c==="keep"?s==="multiple":c==="clear"?a:c===o)?"emphasis":"normal")})},t.prototype.updateView=function(e,r,n){this.render(e,r,n)},t.prototype.getIcons=function(){var e=this.model,r=e.get("icon",!0),n={};return pt(e.get("type",!0),function(o){r[o]&&(n[o]=r[o])}),n},t.prototype.onclick=function(e,r,n){var o=this._brushType,s=this._brushMode;n==="clear"?(r.dispatchAction({type:"axisAreaSelect",intervals:[]}),r.dispatchAction({type:"brush",command:"clear",areas:[]})):r.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:n==="keep"?o:o===n?!1:n,brushMode:n==="keep"?s==="multiple"?"single":"multiple":s}})},t.getDefaultOption=function(e){var r={show:!0,type:CFt.slice(),icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:e.getLocaleModel().get(["toolbox","brush","title"])};return r},t}(Cu);const EFt=MFt;function DFt(i){i.registerComponentView(TFt),i.registerComponentModel(IFt),i.registerPreprocessor(fFt),i.registerVisual(i.PRIORITY.VISUAL.BRUSH,_Ft),i.registerAction({type:"brush",event:"brush",update:"updateVisual"},function(t,e){e.eachComponent({mainType:"brush",query:t},function(r){r.setAreas(t.areas)})}),i.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},ho),i.registerAction({type:"brushEnd",event:"brushEnd",update:"none"},ho),qy("brush",EFt)}var PFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.layoutMode={type:"box",ignoreSize:!0},e}return t.type="title",t.defaultOption={z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:"center",top:ye.size.m,backgroundColor:ye.color.transparent,borderColor:ye.color.primary,borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:ye.color.primary},subtextStyle:{fontSize:12,color:ye.color.quaternary}},t}(gn),LFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){if(this.group.removeAll(),!!e.get("show")){var o=this.group,s=e.getModel("textStyle"),a=e.getModel("subtextStyle"),c=e.get("textAlign"),f=Ui(e.get("textBaseline"),e.get("textVerticalAlign")),g=new _n({style:pa(s,{text:e.get("text"),fill:s.getTextColor()},{disableBox:!0}),z2:10}),v=g.getBoundingRect(),y=e.get("subtext"),w=new _n({style:pa(a,{text:y,fill:a.getTextColor(),y:v.height+e.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),I=e.get("link"),E=e.get("sublink"),D=e.get("triggerEvent",!0);g.silent=!I&&!D,w.silent=!E&&!D,I&&g.on("click",function(){HC(I,"_"+e.get("target"))}),E&&w.on("click",function(){HC(E,"_"+e.get("subtarget"))}),cr(g).eventData=cr(w).eventData=D?{componentType:"title",componentIndex:e.componentIndex}:null,o.add(g),y&&o.add(w);var R=o.getBoundingRect(),z=e.getBoxLayoutParams();z.width=R.width,z.height=R.height;var N=No(e,n),H=Ma(z,N.refContainer,e.get("padding"));c||(c=e.get("left")||e.get("right"),c==="middle"&&(c="center"),c==="right"?H.x+=H.width:c==="center"&&(H.x+=H.width/2)),f||(f=e.get("top")||e.get("bottom"),f==="center"&&(f="middle"),f==="bottom"?H.y+=H.height:f==="middle"&&(H.y+=H.height/2),f=f||"top"),o.x=H.x,o.y=H.y,o.markRedraw();var q={align:c,verticalAlign:f};g.setStyle(q),w.setStyle(q),R=o.getBoundingRect();var Y=H.margin,J=e.getItemStyle(["color","opacity"]);J.fill=e.get("backgroundColor");var it=new jr({shape:{x:R.x-Y[3],y:R.y-Y[0],width:R.width+Y[1]+Y[3],height:R.height+Y[0]+Y[2],r:e.get("borderRadius")},style:J,subPixelOptimize:!0,silent:!0});o.add(it)}},t.type="title",t}(Oa);function RFt(i){i.registerComponentModel(PFt),i.registerComponentView(LFt)}var kFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.layoutMode="box",e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n),this._initData()},t.prototype.mergeOption=function(e){i.prototype.mergeOption.apply(this,arguments),this._initData()},t.prototype.setCurrentIndex=function(e){e==null&&(e=this.option.currentIndex);var r=this._data.count();this.option.loop?e=(e%r+r)%r:(e>=r&&(e=r-1),e<0&&(e=0)),this.option.currentIndex=e},t.prototype.getCurrentIndex=function(){return this.option.currentIndex},t.prototype.isIndexMax=function(){return this.getCurrentIndex()>=this._data.count()-1},t.prototype.setPlayState=function(e){this.option.autoPlay=!!e},t.prototype.getPlayState=function(){return!!this.option.autoPlay},t.prototype._initData=function(){var e=this.option,r=e.data||[],n=e.axisType,o=this._names=[],s;n==="category"?(s=[],pt(r,function(f,g){var v=ko(F0(f),""),y;nr(f)?(y=Yi(f),y.value=g):y=g,s.push(y),o.push(v)})):s=r;var a={category:"ordinal",time:"time",value:"number"}[n]||"number",c=this._data=new dl([{name:"value",type:a}],this);c.initData(s,o)},t.prototype.getData=function(){return this._data},t.prototype.getCategories=function(){if(this.get("axisType")==="category")return this._names.slice()},t.type="timeline",t.defaultOption={z:4,show:!0,axisType:"time",realtime:!0,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:ye.size.m,controlPosition:"left",autoPlay:!1,rewind:!1,loop:!0,playInterval:2e3,currentIndex:0,itemStyle:{},label:{color:ye.color.secondary},data:[]},t}(gn);const $q=kFt;var Lrt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="timeline.slider",t.defaultOption=Zp($q.defaultOption,{backgroundColor:"rgba(0,0,0,0)",borderColor:ye.color.border,borderWidth:0,orient:"horizontal",inverse:!1,tooltip:{trigger:"item"},symbol:"circle",symbolSize:12,lineStyle:{show:!0,width:2,color:ye.color.accent10},label:{position:"auto",show:!0,interval:"auto",rotate:0,color:ye.color.tertiary},itemStyle:{color:ye.color.accent20,borderWidth:0},checkpointStyle:{symbol:"circle",symbolSize:15,color:ye.color.accent50,borderColor:ye.color.accent50,borderWidth:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0)",animation:!0,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:!0,showPlayBtn:!0,showPrevBtn:!0,showNextBtn:!0,itemSize:24,itemGap:12,position:"left",playIcon:"path://M15 0C23.2843 0 30 6.71573 30 15C30 23.2843 23.2843 30 15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0ZM15 3C8.37258 3 3 8.37258 3 15C3 21.6274 8.37258 27 15 27C21.6274 27 27 21.6274 27 15C27 8.37258 21.6274 3 15 3ZM11.5 10.6699C11.5 9.90014 12.3333 9.41887 13 9.80371L20.5 14.1338C21.1667 14.5187 21.1667 15.4813 20.5 15.8662L13 20.1963C12.3333 20.5811 11.5 20.0999 11.5 19.3301V10.6699Z",stopIcon:"path://M15 0C23.2843 0 30 6.71573 30 15C30 23.2843 23.2843 30 15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0ZM15 3C8.37258 3 3 8.37258 3 15C3 21.6274 8.37258 27 15 27C21.6274 27 27 21.6274 27 15C27 8.37258 21.6274 3 15 3ZM11.5 10C12.3284 10 13 10.6716 13 11.5V18.5C13 19.3284 12.3284 20 11.5 20C10.6716 20 10 19.3284 10 18.5V11.5C10 10.6716 10.6716 10 11.5 10ZM18.5 10C19.3284 10 20 10.6716 20 11.5V18.5C20 19.3284 19.3284 20 18.5 20C17.6716 20 17 19.3284 17 18.5V11.5C17 10.6716 17.6716 10 18.5 10Z",nextIcon:"path://M0.838834 18.7383C0.253048 18.1525 0.253048 17.2028 0.838834 16.617L7.55635 9.89949L0.838834 3.18198C0.253048 2.59619 0.253048 1.64645 0.838834 1.06066C1.42462 0.474874 2.37437 0.474874 2.96015 1.06066L10.7383 8.83883L10.8412 8.95277C11.2897 9.50267 11.2897 10.2963 10.8412 10.8462L10.7383 10.9602L2.96015 18.7383C2.37437 19.3241 1.42462 19.3241 0.838834 18.7383Z",prevIcon:"path://M10.9602 1.06066C11.5459 1.64645 11.5459 2.59619 10.9602 3.18198L4.24264 9.89949L10.9602 16.617C11.5459 17.2028 11.5459 18.1525 10.9602 18.7383C10.3744 19.3241 9.42462 19.3241 8.83883 18.7383L1.06066 10.9602L0.957771 10.8462C0.509245 10.2963 0.509245 9.50267 0.957771 8.95277L1.06066 8.83883L8.83883 1.06066C9.42462 0.474874 10.3744 0.474874 10.9602 1.06066Z",prevBtnSize:18,nextBtnSize:18,color:ye.color.accent50,borderColor:ye.color.accent50,borderWidth:0},emphasis:{label:{show:!0,color:ye.color.accent60},itemStyle:{color:ye.color.accent60,borderColor:ye.color.accent60},controlStyle:{color:ye.color.accent70,borderColor:ye.color.accent70}},progress:{lineStyle:{color:ye.color.accent30},itemStyle:{color:ye.color.accent40}},data:[]}),t}($q);Ao(Lrt,bE.prototype);const OFt=Lrt;var zFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="timeline",t}(Oa);const BFt=zFt;var FFt=function(i){Se(t,i);function t(e,r,n,o){var s=i.call(this,e,r,n)||this;return s.type=o||"value",s}return t.prototype.getLabelModel=function(){return this.model.getModel("label")},t.prototype.isHorizontal=function(){return this.model.get("orient")==="horizontal"},t}(Sc);const NFt=FFt;var Pk=Math.PI,Zq=Wr(),VFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(e,r){this.api=r},t.prototype.render=function(e,r,n){if(this.model=e,this.api=n,this.ecModel=r,this.group.removeAll(),e.get("show",!0)){var o=this._layout(e,n),s=this._createGroup("_mainGroup"),a=this._createGroup("_labelGroup"),c=this._axis=this._createAxis(o,e);e.formatTooltip=function(f){var g=c.scale.getLabel({value:f});return So("nameValue",{noName:!0,value:g})},pt(["AxisLine","AxisTick","Control","CurrentPointer"],function(f){this["_render"+f](o,s,c,e)},this),this._renderAxisLabel(o,a,c,e),this._position(o,e)}this._doPlayStop(),this._updateTicksStatus()},t.prototype.remove=function(){this._clearTimer(),this.group.removeAll()},t.prototype.dispose=function(){this._clearTimer()},t.prototype._layout=function(e,r){var n=e.get(["label","position"]),o=e.get("orient"),s=GFt(e,r),a;n==null||n==="auto"?a=o==="horizontal"?s.y+s.height/2<r.getHeight()/2?"-":"+":s.x+s.width/2<r.getWidth()/2?"+":"-":wi(n)?a={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[o][n]:a=n;var c={horizontal:"center",vertical:a>=0||a==="+"?"left":"right"},f={horizontal:a>=0||a==="+"?"top":"bottom",vertical:"middle"},g={horizontal:0,vertical:Pk/2},v=o==="vertical"?s.height:s.width,y=e.getModel("controlStyle"),w=y.get("show",!0),I=w?y.get("itemSize"):0,E=w?y.get("itemGap"):0,D=I+E,R=e.get(["label","rotate"])||0;R=R*Pk/180;var z,N,H,q=y.get("position",!0),Y=w&&y.get("showPlayBtn",!0),J=w&&y.get("showPrevBtn",!0),it=w&&y.get("showNextBtn",!0),at=0,ut=v;q==="left"||q==="bottom"?(Y&&(z=[0,0],at+=D),J&&(N=[at,0],at+=D),it&&(H=[ut-I,0],ut-=D)):(Y&&(z=[ut-I,0],ut-=D),J&&(N=[0,0],at+=D),it&&(H=[ut-I,0],ut-=D));var ft=[at,ut];return e.get("inverse")&&ft.reverse(),{viewRect:s,mainLength:v,orient:o,rotation:g[o],labelRotation:R,labelPosOpt:a,labelAlign:e.get(["label","align"])||c[o],labelBaseline:e.get(["label","verticalAlign"])||e.get(["label","baseline"])||f[o],playPosition:z,prevBtnPosition:N,nextBtnPosition:H,axisExtent:ft,controlSize:I,controlGap:E}},t.prototype._position=function(e,r){var n=this._mainGroup,o=this._labelGroup,s=e.viewRect;if(e.orient==="vertical"){var a=as(),c=s.x,f=s.y+s.height;bh(a,a,[-c,-f]),jp(a,a,-Pk/2),bh(a,a,[c,f]),s=s.clone(),s.applyTransform(a)}var g=z(s),v=z(n.getBoundingRect()),y=z(o.getBoundingRect()),w=[n.x,n.y],I=[o.x,o.y];I[0]=w[0]=g[0][0];var E=e.labelPosOpt;if(E==null||wi(E)){var D=E==="+"?0:1;N(w,v,g,1,D),N(I,y,g,1,1-D)}else{var D=E>=0?0:1;N(w,v,g,1,D),I[1]=w[1]+E}n.setPosition(w),o.setPosition(I),n.rotation=o.rotation=e.rotation,R(n),R(o);function R(H){H.originX=g[0][0]-H.x,H.originY=g[1][0]-H.y}function z(H){return[[H.x,H.x+H.width],[H.y,H.y+H.height]]}function N(H,q,Y,J,it){H[J]+=Y[J][it]-q[J][it]}},t.prototype._createAxis=function(e,r){var n=r.getData(),o=r.get("axisType"),s=UFt(r,o);s.getTicks=function(){return n.mapArray(["value"],function(f){return{value:f}})};var a=n.getDataExtent("value");s.setExtent(a[0],a[1]),s.calcNiceTicks();var c=new NFt("value",s,e.axisExtent,o);return c.model=r,c},t.prototype._createGroup=function(e){var r=this[e]=new Ki;return this.group.add(r),r},t.prototype._renderAxisLine=function(e,r,n,o){var s=n.getExtent();if(o.get(["lineStyle","show"])){var a=new Oo({shape:{x1:s[0],y1:0,x2:s[1],y2:0},style:Ne({lineCap:"round"},o.getModel("lineStyle").getLineStyle()),silent:!0,z2:1});r.add(a);var c=this._progressLine=new Oo({shape:{x1:s[0],x2:this._currentPointer?this._currentPointer.x:s[0],y1:0,y2:0},style:rr({lineCap:"round",lineWidth:a.style.lineWidth},o.getModel(["progress","lineStyle"]).getLineStyle()),silent:!0,z2:1});r.add(c)}},t.prototype._renderAxisTick=function(e,r,n,o){var s=this,a=o.getData(),c=n.scale.getTicks();this._tickSymbols=[],pt(c,function(f){var g=n.dataToCoord(f.value),v=a.getItemModel(f.value),y=v.getModel("itemStyle"),w=v.getModel(["emphasis","itemStyle"]),I=v.getModel(["progress","itemStyle"]),E={x:g,y:0,onclick:Si(s._changeTimeline,s,f.value)},D=qq(v,y,r,E);D.ensureState("emphasis").style=w.getItemStyle(),D.ensureState("progress").style=I.getItemStyle(),lv(D);var R=cr(D);v.get("tooltip")?(R.dataIndex=f.value,R.dataModel=o):R.dataIndex=R.dataModel=null,s._tickSymbols.push(D)})},t.prototype._renderAxisLabel=function(e,r,n,o){var s=this,a=n.getLabelModel();if(a.get("show")){var c=o.getData(),f=n.getViewLabels();this._tickLabels=[],pt(f,function(g){var v=g.tickValue,y=c.getItemModel(v),w=y.getModel("label"),I=y.getModel(["emphasis","label"]),E=y.getModel(["progress","label"]),D=n.dataToCoord(g.tickValue),R=new _n({x:D,y:0,rotation:e.labelRotation-e.rotation,onclick:Si(s._changeTimeline,s,v),silent:!1,style:pa(w,{text:g.formattedLabel,align:e.labelAlign,verticalAlign:e.labelBaseline})});R.ensureState("emphasis").style=pa(I),R.ensureState("progress").style=pa(E),r.add(R),lv(R),Zq(R).dataIndex=v,s._tickLabels.push(R)})}},t.prototype._renderControl=function(e,r,n,o){var s=e.controlSize,a=e.rotation,c=o.getModel("controlStyle").getItemStyle(),f=o.getModel(["emphasis","controlStyle"]).getItemStyle(),g=o.getPlayState(),v=o.get("inverse",!0);y(e.nextBtnPosition,"next",Si(this._changeTimeline,this,v?"-":"+")),y(e.prevBtnPosition,"prev",Si(this._changeTimeline,this,v?"+":"-")),y(e.playPosition,g?"stop":"play",Si(this._handlePlayClick,this,!g),!0);function y(w,I,E,D){if(w){var R=yc(Ui(o.get(["controlStyle",I+"BtnSize"]),s),s),z=[0,-R/2,R,R],N=HFt(o,I+"Icon",z,{x:w[0],y:w[1],originX:s/2,originY:0,rotation:D?-a:0,rectHover:!0,style:c,onclick:E});N.ensureState("emphasis").style=f,r.add(N),lv(N)}}},t.prototype._renderCurrentPointer=function(e,r,n,o){var s=o.getData(),a=o.getCurrentIndex(),c=s.getItemModel(a).getModel("checkpointStyle"),f=this,g={onCreate:function(v){v.draggable=!0,v.drift=Si(f._handlePointerDrag,f),v.ondragend=Si(f._handlePointerDragend,f),Xq(v,f._progressLine,a,n,o,!0)},onUpdate:function(v){Xq(v,f._progressLine,a,n,o)}};this._currentPointer=qq(c,c,this._mainGroup,{},this._currentPointer,g)},t.prototype._handlePlayClick=function(e){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:e,from:this.uid})},t.prototype._handlePointerDrag=function(e,r,n){this._clearTimer(),this._pointerChangeTimeline([n.offsetX,n.offsetY])},t.prototype._handlePointerDragend=function(e){this._pointerChangeTimeline([e.offsetX,e.offsetY],!0)},t.prototype._pointerChangeTimeline=function(e,r){var n=this._toAxisCoord(e)[0],o=this._axis,s=Pu(o.getExtent().slice());n>s[1]&&(n=s[1]),n<s[0]&&(n=s[0]),this._currentPointer.x=n,this._currentPointer.markRedraw();var a=this._progressLine;a&&(a.shape.x2=n,a.dirty());var c=this._findNearestTick(n),f=this.model;(r||c!==f.getCurrentIndex()&&f.get("realtime"))&&this._changeTimeline(c)},t.prototype._doPlayStop=function(){var e=this;this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(function(){var r=e.model;e._changeTimeline(r.getCurrentIndex()+(r.get("rewind",!0)?-1:1))},this.model.get("playInterval")))},t.prototype._toAxisCoord=function(e){var r=this._mainGroup.getLocalTransform();return pc(e,r,!0)},t.prototype._findNearestTick=function(e){var r=this.model.getData(),n=1/0,o,s=this._axis;return r.each(["value"],function(a,c){var f=s.dataToCoord(a),g=Math.abs(f-e);g<n&&(n=g,o=c)}),o},t.prototype._clearTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._changeTimeline=function(e){var r=this.model.getCurrentIndex();e==="+"?e=r+1:e==="-"&&(e=r-1),this.api.dispatchAction({type:"timelineChange",currentIndex:e,from:this.uid})},t.prototype._updateTicksStatus=function(){var e=this.model.getCurrentIndex(),r=this._tickSymbols,n=this._tickLabels;if(r)for(var o=0;o<r.length;o++)r&&r[o]&&r[o].toggleState("progress",o<e);if(n)for(var o=0;o<n.length;o++)n&&n[o]&&n[o].toggleState("progress",Zq(n[o]).dataIndex<=e)},t.type="timeline.slider",t}(BFt);function UFt(i,t){if(t=t||i.get("type"),t)switch(t){case"category":return new gS({ordinalMeta:i.getCategories(),extent:[1/0,-1/0]});case"time":return new htt({locale:i.ecModel.getLocaleModel(),useUTC:i.ecModel.get("useUTC")});default:return new Bp}}function GFt(i,t){return Ma(i.getBoxLayoutParams(),No(i,t).refContainer,i.get("padding"))}function HFt(i,t,e,r){var n=r.style,o=US(i.get(["controlStyle",t]),r||{},new sr(e[0],e[1],e[2],e[3]));return n&&o.setStyle(n),o}function qq(i,t,e,r,n,o){var s=t.get("color");if(n)n.setColor(s),e.add(n),o&&o.onUpdate(n);else{var a=i.get("symbol");n=To(a,-1,-1,2,2,s),n.setStyle("strokeNoScale",!0),e.add(n),o&&o.onCreate(n)}var c=t.getItemStyle(["color"]);n.setStyle(c),r=Er({rectHover:!0,z2:100},r,!0);var f=q0(i.get("symbolSize"));r.scaleX=f[0]/2,r.scaleY=f[1]/2;var g=Rv(i.get("symbolOffset"),f);g&&(r.x=(r.x||0)+g[0],r.y=(r.y||0)+g[1]);var v=i.get("symbolRotate");return r.rotation=(v||0)*Math.PI/180||0,n.attr(r),n.updateTransform(),n}function Xq(i,t,e,r,n,o){if(!i.dragging){var s=n.getModel("checkpointStyle"),a=r.dataToCoord(n.getData().get("value",e));if(o||!s.get("animation",!0))i.attr({x:a,y:0}),t&&t.attr({shape:{x2:a}});else{var c={duration:s.get("animationDuration",!0),easing:s.get("animationEasing",!0)};i.stopAnimation(null,!0),i.animateTo({x:a,y:0},c),t&&t.animateTo({shape:{x2:a}},c)}}}const jFt=VFt;function WFt(i){i.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},function(t,e,r){var n=e.getComponent("timeline");return n&&t.currentIndex!=null&&(n.setCurrentIndex(t.currentIndex),!n.get("loop",!0)&&n.isIndexMax()&&n.getPlayState()&&(n.setPlayState(!1),r.dispatchAction({type:"timelinePlayChange",playState:!1,from:t.from}))),e.resetOption("timeline",{replaceMerge:n.get("replaceMerge",!0)}),rr({currentIndex:n.option.currentIndex},t)}),i.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},function(t,e){var r=e.getComponent("timeline");r&&t.playState!=null&&r.setPlayState(t.playState)})}function $Ft(i){var t=i&&i.timeline;Ye(t)||(t=t?[t]:[]),pt(t,function(e){e&&ZFt(e)})}function ZFt(i){var t=i.type,e={number:"value",time:"time"};if(e[t]&&(i.axisType=e[t],delete i.type),Yq(i),Um(i,"controlPosition")){var r=i.controlStyle||(i.controlStyle={});Um(r,"position")||(r.position=i.controlPosition),r.position==="none"&&!Um(r,"show")&&(r.show=!1,delete r.position),delete i.controlPosition}pt(i.data||[],function(n){nr(n)&&!Ye(n)&&(!Um(n,"value")&&Um(n,"name")&&(n.value=n.name),Yq(n))})}function Yq(i){var t=i.itemStyle||(i.itemStyle={}),e=t.emphasis||(t.emphasis={}),r=i.label||i.label||{},n=r.normal||(r.normal={}),o={normal:1,emphasis:1};pt(r,function(s,a){!o[a]&&!Um(n,a)&&(n[a]=s)}),e.label&&!Um(r,"emphasis")&&(r.emphasis=e.label,delete e.label)}function Um(i,t){return i.hasOwnProperty(t)}function qFt(i){i.registerComponentModel(OFt),i.registerComponentView(jFt),i.registerSubTypeDefaulter("timeline",function(){return"slider"}),WFt(i),i.registerPreprocessor($Ft)}function ON(i,t){if(!i)return!1;for(var e=Ye(i)?i:[i],r=0;r<e.length;r++)if(e[r]&&e[r][t])return!0;return!1}function gI(i){mv(i,"label",["show"])}var mI=Wr(),Rrt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.createdBySelf=!1,e.preventAutoZ=!0,e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n),this._mergeOption(e,n,!1,!0)},t.prototype.isAnimationEnabled=function(){if(Sn.node)return!1;var e=this.__hostSeries;return this.getShallow("animation")&&e&&e.isAnimationEnabled()},t.prototype.mergeOption=function(e,r){this._mergeOption(e,r,!1,!1)},t.prototype._mergeOption=function(e,r,n,o){var s=this.mainType;n||r.eachSeries(function(a){var c=a.get(this.mainType,!0),f=mI(a)[s];if(!c||!c.data){mI(a)[s]=null;return}f?f._mergeOption(c,r,!0):(o&&gI(c),pt(c.data,function(g){g instanceof Array?(gI(g[0]),gI(g[1])):gI(g)}),f=this.createMarkerModelFromSeries(c,this,r),Ne(f,{mainType:this.mainType,seriesIndex:a.seriesIndex,name:a.name,createdBySelf:!0}),f.__hostSeries=a),mI(a)[s]=f},this)},t.prototype.formatTooltip=function(e,r,n){var o=this.getData(),s=this.getRawValue(e),a=o.getName(e);return So("section",{header:this.name,blocks:[So("nameValue",{name:a,value:s,noName:!a,noValue:s==null})]})},t.prototype.getData=function(){return this._data},t.prototype.setData=function(e){this._data=e},t.prototype.getDataParams=function(e,r){var n=bE.prototype.getDataParams.call(this,e,r),o=this.__hostSeries;return o&&(n.seriesId=o.id,n.seriesName=o.name,n.seriesType=o.subType),n},t.getMarkerModelFromSeries=function(e,r){return mI(e)[r]},t.type="marker",t.dependencies=["series","grid","polar","geo"],t}(gn);Ao(Rrt,bE.prototype);const Vd=Rrt;var XFt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,r,n){return new t(e,r,n)},t.type="markPoint",t.defaultOption={z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:!0,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:!0}}},t}(Vd);const YFt=XFt;function TB(i){return!(isNaN(parseFloat(i.x))&&isNaN(parseFloat(i.y)))}function KFt(i){return!isNaN(parseFloat(i.x))&&!isNaN(parseFloat(i.y))}function vI(i,t,e,r,n,o,s){var a=[],c=zp(t,n),f=c?t.getCalculationInfo("stackResultDimension"):n,g=SM(t,f,i),v=t.hostModel,y=v.indicesOfNearest(e,f,g)[0];a[o]=t.get(r,y),a[s]=t.get(f,y);var w=t.get(n,y),I=lh(t.get(n,y));return I=Math.min(I,20),I>=0&&(a[s]=+a[s].toFixed(I)),[a,w]}var _I={min:br(vI,"min"),max:br(vI,"max"),average:br(vI,"average"),median:br(vI,"median")};function IS(i,t){if(t){var e=i.getData(),r=i.coordinateSystem,n=r&&r.dimensions;if(!KFt(t)&&!Ye(t.coord)&&Ye(n)){var o=krt(t,e,r,i);if(t=Yi(t),t.type&&_I[t.type]&&o.baseAxis&&o.valueAxis){var s=Ar(n,o.baseAxis.dim),a=Ar(n,o.valueAxis.dim),c=_I[t.type](e,o.valueAxis.dim,o.baseDataDim,o.valueDataDim,s,a);t.coord=c[0],t.value=c[1]}else t.coord=[t.xAxis!=null?t.xAxis:t.radiusAxis,t.yAxis!=null?t.yAxis:t.angleAxis]}if(t.coord==null||!Ye(n)){t.coord=[];var f=i.getBaseAxis();if(f&&t.type&&_I[t.type]){var g=r.getOtherAxis(f);g&&(t.value=SM(e,e.mapDimension(g.dim),t.type))}}else for(var v=t.coord,y=0;y<2;y++)_I[v[y]]&&(v[y]=SM(e,e.mapDimension(n[y]),v[y]));return t}}function krt(i,t,e,r){var n={};return i.valueIndex!=null||i.valueDim!=null?(n.valueDataDim=i.valueIndex!=null?t.getDimension(i.valueIndex):i.valueDim,n.valueAxis=e.getAxis(JFt(r,n.valueDataDim)),n.baseAxis=e.getOtherAxis(n.valueAxis),n.baseDataDim=t.mapDimension(n.baseAxis.dim)):(n.baseAxis=r.getBaseAxis(),n.valueAxis=e.getOtherAxis(n.baseAxis),n.baseDataDim=t.mapDimension(n.baseAxis.dim),n.valueDataDim=t.mapDimension(n.valueAxis.dim)),n}function JFt(i,t){var e=i.getData().getDimensionInfo(t);return e&&e.coordDim}function CS(i,t){return i&&i.containData&&t.coord&&!TB(t)?i.containData(t.coord):!0}function QFt(i,t,e){return i&&i.containZone&&t.coord&&e.coord&&!TB(t)&&!TB(e)?i.containZone(t.coord,e.coord):!0}function Ort(i,t){return i?function(e,r,n,o){var s=o<2?e.coord&&e.coord[o]:e.value;return Mp(s,t[o])}:function(e,r,n,o){return Mp(e.value,t[o])}}function SM(i,t,e){if(e==="average"){var r=0,n=0;return i.each(t,function(o,s){isNaN(o)||(r+=o,n++)}),r/n}else return e==="median"?i.getMedian(t):i.getDataExtent(t)[e==="max"?1:0]}var Lk=Wr(),t3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.init=function(){this.markerGroupMap=Fi()},t.prototype.render=function(e,r,n){var o=this,s=this.markerGroupMap;s.each(function(a){Lk(a).keep=!1}),r.eachSeries(function(a){var c=Vd.getMarkerModelFromSeries(a,o.type);c&&o.renderSeries(a,c,r,n)}),s.each(function(a){!Lk(a).keep&&o.group.remove(a.group)}),e3t(r,s,this.type)},t.prototype.markKeep=function(e){Lk(e).keep=!0},t.prototype.toggleBlurSeries=function(e,r){var n=this;pt(e,function(o){var s=Vd.getMarkerModelFromSeries(o,n.type);if(s){var a=s.getData();a.eachItemGraphicEl(function(c){c&&(r?EK(c):UF(c))})}})},t.type="marker",t}(Oa);function e3t(i,t,e){i.eachSeries(function(r){var n=Vd.getMarkerModelFromSeries(r,e),o=t.get(r.id);if(n&&o&&o.group){var s=bv(n),a=s.z,c=s.zlevel;mE(o.group,a,c)}})}const zN=t3t;function Kq(i,t,e){var r=t.coordinateSystem,n=e.getWidth(),o=e.getHeight(),s=r&&r.getArea&&r.getArea();i.each(function(a){var c=i.getItemModel(a),f=c.get("relativeTo")==="coordinate",g=f?s?s.width:0:n,v=f?s?s.height:0:o,y=f&&s?s.x:0,w=f&&s?s.y:0,I,E=xi(c.get("x"),g)+y,D=xi(c.get("y"),v)+w;if(!isNaN(E)&&!isNaN(D))I=[E,D];else if(t.getMarkerPosition)I=t.getMarkerPosition(i.getValues(i.dimensions,a));else if(r){var R=i.get(r.dimensions[0],a),z=i.get(r.dimensions[1],a);I=r.dataToPoint([R,z])}isNaN(E)||(I[0]=E),isNaN(D)||(I[1]=D),i.setItemLayout(a,I)})}var i3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,r,n){r.eachSeries(function(o){var s=Vd.getMarkerModelFromSeries(o,"markPoint");s&&(Kq(s.getData(),o,n),this.markerGroupMap.get(o.id).updateLayout())},this)},t.prototype.renderSeries=function(e,r,n,o){var s=e.coordinateSystem,a=e.id,c=e.getData(),f=this.markerGroupMap,g=f.get(a)||f.set(a,new XS),v=r3t(s,e,r);r.setData(v),Kq(r.getData(),e,o),v.each(function(y){var w=v.getItemModel(y),I=w.getShallow("symbol"),E=w.getShallow("symbolSize"),D=w.getShallow("symbolRotate"),R=w.getShallow("symbolOffset"),z=w.getShallow("symbolKeepAspect");if(Xi(I)||Xi(E)||Xi(D)||Xi(R)){var N=r.getRawValue(y),H=r.getDataParams(y);Xi(I)&&(I=I(N,H)),Xi(E)&&(E=E(N,H)),Xi(D)&&(D=D(N,H)),Xi(R)&&(R=R(N,H))}var q=w.getModel("itemStyle").getItemStyle(),Y=w.get("z2"),J=WS(c,"color");q.fill||(q.fill=J),v.setItemVisual(y,{z2:Ui(Y,0),symbol:I,symbolSize:E,symbolRotate:D,symbolOffset:R,symbolKeepAspect:z,style:q})}),g.updateData(v),this.group.add(g.group),v.eachItemGraphicEl(function(y){y.traverse(function(w){cr(w).dataModel=r})}),this.markKeep(g),g.group.silent=r.get("silent")||e.get("silent")},t.type="markPoint",t}(zN);function r3t(i,t,e){var r;i?r=ti(i&&i.dimensions,function(a){var c=t.getData().getDimensionInfo(t.getData().mapDimension(a))||{};return Ne(Ne({},c),{name:a,ordinalMeta:null})}):r=[{name:"value",type:"float"}];var n=new dl(r,e),o=ti(e.get("data"),br(IS,t));i&&(o=kn(o,br(CS,i)));var s=Ort(!!i,r);return n.initData(o,null,s),n}const n3t=i3t;function a3t(i){i.registerComponentModel(YFt),i.registerComponentView(n3t),i.registerPreprocessor(function(t){ON(t.series,"markPoint")&&(t.markPoint=t.markPoint||{})})}var o3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,r,n){return new t(e,r,n)},t.type="markLine",t.defaultOption={z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},t}(Vd);const s3t=o3t;var yI=Wr(),l3t=function(i,t,e,r){var n=i.getData(),o;if(Ye(r))o=r;else{var s=r.type;if(s==="min"||s==="max"||s==="average"||s==="median"||r.xAxis!=null||r.yAxis!=null){var a=void 0,c=void 0;if(r.yAxis!=null||r.xAxis!=null)a=t.getAxis(r.yAxis!=null?"y":"x"),c=vs(r.yAxis,r.xAxis);else{var f=krt(r,n,t,i);a=f.valueAxis;var g=KQ(n,f.valueDataDim);c=SM(n,g,s)}var v=a.dim==="x"?0:1,y=1-v,w=Yi(r),I={coord:[]};w.type=null,w.coord=[],w.coord[y]=-1/0,I.coord[y]=1/0;var E=e.get("precision");E>=0&&fn(c)&&(c=+c.toFixed(Math.min(E,20))),w.coord[v]=I.coord[v]=c,o=[w,I,{type:s,valueIndex:r.valueIndex,value:c}]}else o=[]}var D=[IS(i,o[0]),IS(i,o[1]),Ne({},o[2])];return D[2].type=D[2].type||null,Er(D[2],D[0]),Er(D[2],D[1]),D};function TM(i){return!isNaN(i)&&!isFinite(i)}function Jq(i,t,e,r){var n=1-i,o=r.dimensions[i];return TM(t[n])&&TM(e[n])&&t[i]===e[i]&&r.getAxis(o).containData(t[i])}function u3t(i,t){if(i.type==="cartesian2d"){var e=t[0].coord,r=t[1].coord;if(e&&r&&(Jq(1,e,r,i)||Jq(0,e,r,i)))return!0}return CS(i,t[0])&&CS(i,t[1])}function Rk(i,t,e,r,n){var o=r.coordinateSystem,s=i.getItemModel(t),a,c=xi(s.get("x"),n.getWidth()),f=xi(s.get("y"),n.getHeight());if(!isNaN(c)&&!isNaN(f))a=[c,f];else{if(r.getMarkerPosition)a=r.getMarkerPosition(i.getValues(i.dimensions,t));else{var g=o.dimensions,v=i.get(g[0],t),y=i.get(g[1],t);a=o.dataToPoint([v,y])}if(Fp(o,"cartesian2d")){var w=o.getAxis("x"),I=o.getAxis("y"),g=o.dimensions;TM(i.get(g[0],t))?a[0]=w.toGlobalCoord(w.getExtent()[e?0:1]):TM(i.get(g[1],t))&&(a[1]=I.toGlobalCoord(I.getExtent()[e?0:1]))}isNaN(c)||(a[0]=c),isNaN(f)||(a[1]=f)}i.setItemLayout(t,a)}var c3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,r,n){r.eachSeries(function(o){var s=Vd.getMarkerModelFromSeries(o,"markLine");if(s){var a=s.getData(),c=yI(s).from,f=yI(s).to;c.each(function(g){Rk(c,g,!0,o,n),Rk(f,g,!1,o,n)}),a.each(function(g){a.setItemLayout(g,[c.getItemLayout(g),f.getItemLayout(g)])}),this.markerGroupMap.get(o.id).updateLayout()}},this)},t.prototype.renderSeries=function(e,r,n,o){var s=e.coordinateSystem,a=e.id,c=e.getData(),f=this.markerGroupMap,g=f.get(a)||f.set(a,new eN);this.group.add(g.group);var v=h3t(s,e,r),y=v.from,w=v.to,I=v.line;yI(r).from=y,yI(r).to=w,r.setData(I);var E=r.get("symbol"),D=r.get("symbolSize"),R=r.get("symbolRotate"),z=r.get("symbolOffset");Ye(E)||(E=[E,E]),Ye(D)||(D=[D,D]),Ye(R)||(R=[R,R]),Ye(z)||(z=[z,z]),v.from.each(function(H){N(y,H,!0),N(w,H,!1)}),I.each(function(H){var q=I.getItemModel(H),Y=q.getModel("lineStyle").getLineStyle();I.setItemLayout(H,[y.getItemLayout(H),w.getItemLayout(H)]);var J=q.get("z2");Y.stroke==null&&(Y.stroke=y.getItemVisual(H,"style").fill),I.setItemVisual(H,{z2:Ui(J,0),fromSymbolKeepAspect:y.getItemVisual(H,"symbolKeepAspect"),fromSymbolOffset:y.getItemVisual(H,"symbolOffset"),fromSymbolRotate:y.getItemVisual(H,"symbolRotate"),fromSymbolSize:y.getItemVisual(H,"symbolSize"),fromSymbol:y.getItemVisual(H,"symbol"),toSymbolKeepAspect:w.getItemVisual(H,"symbolKeepAspect"),toSymbolOffset:w.getItemVisual(H,"symbolOffset"),toSymbolRotate:w.getItemVisual(H,"symbolRotate"),toSymbolSize:w.getItemVisual(H,"symbolSize"),toSymbol:w.getItemVisual(H,"symbol"),style:Y})}),g.updateData(I),v.line.eachItemGraphicEl(function(H){cr(H).dataModel=r,H.traverse(function(q){cr(q).dataModel=r})});function N(H,q,Y){var J=H.getItemModel(q);Rk(H,q,Y,e,o);var it=J.getModel("itemStyle").getItemStyle();it.fill==null&&(it.fill=WS(c,"color")),H.setItemVisual(q,{symbolKeepAspect:J.get("symbolKeepAspect"),symbolOffset:Ui(J.get("symbolOffset",!0),z[Y?0:1]),symbolRotate:Ui(J.get("symbolRotate",!0),R[Y?0:1]),symbolSize:Ui(J.get("symbolSize"),D[Y?0:1]),symbol:Ui(J.get("symbol",!0),E[Y?0:1]),style:it})}this.markKeep(g),g.group.silent=r.get("silent")||e.get("silent")},t.type="markLine",t}(zN);function h3t(i,t,e){var r;i?r=ti(i&&i.dimensions,function(f){var g=t.getData().getDimensionInfo(t.getData().mapDimension(f))||{};return Ne(Ne({},g),{name:f,ordinalMeta:null})}):r=[{name:"value",type:"float"}];var n=new dl(r,e),o=new dl(r,e),s=new dl([],e),a=ti(e.get("data"),br(l3t,t,i,e));i&&(a=kn(a,br(u3t,i)));var c=Ort(!!i,r);return n.initData(ti(a,function(f){return f[0]}),null,c),o.initData(ti(a,function(f){return f[1]}),null,c),s.initData(ti(a,function(f){return f[2]})),s.hasItemOption=!0,{from:n,to:o,line:s}}const d3t=c3t;function f3t(i){i.registerComponentModel(s3t),i.registerComponentView(d3t),i.registerPreprocessor(function(t){ON(t.series,"markLine")&&(t.markLine=t.markLine||{})})}var p3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.createMarkerModelFromSeries=function(e,r,n){return new t(e,r,n)},t.type="markArea",t.defaultOption={z:1,tooltip:{trigger:"item"},animation:!1,label:{show:!0,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:!0,position:"top"}}},t}(Vd);const g3t=p3t;var xI=Wr(),m3t=function(i,t,e,r){var n=r[0],o=r[1];if(!(!n||!o)){var s=IS(i,n),a=IS(i,o),c=s.coord,f=a.coord;c[0]=vs(c[0],-1/0),c[1]=vs(c[1],-1/0),f[0]=vs(f[0],1/0),f[1]=vs(f[1],1/0);var g=bF([{},s,a]);return g.coord=[s.coord,a.coord],g.x0=s.x,g.y0=s.y,g.x1=a.x,g.y1=a.y,g}};function AM(i){return!isNaN(i)&&!isFinite(i)}function Qq(i,t,e,r){var n=1-i;return AM(t[n])&&AM(e[n])}function v3t(i,t){var e=t.coord[0],r=t.coord[1],n={coord:e,x:t.x0,y:t.y0},o={coord:r,x:t.x1,y:t.y1};return Fp(i,"cartesian2d")?e&&r&&(Qq(1,e,r)||Qq(0,e,r))?!0:QFt(i,n,o):CS(i,n)||CS(i,o)}function t7(i,t,e,r,n){var o=r.coordinateSystem,s=i.getItemModel(t),a,c=xi(s.get(e[0]),n.getWidth()),f=xi(s.get(e[1]),n.getHeight());if(!isNaN(c)&&!isNaN(f))a=[c,f];else{if(r.getMarkerPosition){var g=i.getValues(["x0","y0"],t),v=i.getValues(["x1","y1"],t),y=o.clampData(g),w=o.clampData(v),I=[];e[0]==="x0"?I[0]=y[0]>w[0]?v[0]:g[0]:I[0]=y[0]>w[0]?g[0]:v[0],e[1]==="y0"?I[1]=y[1]>w[1]?v[1]:g[1]:I[1]=y[1]>w[1]?g[1]:v[1],a=r.getMarkerPosition(I,e,!0)}else{var E=i.get(e[0],t),D=i.get(e[1],t),R=[E,D];o.clampData&&o.clampData(R,R),a=o.dataToPoint(R,!0)}if(Fp(o,"cartesian2d")){var z=o.getAxis("x"),N=o.getAxis("y"),E=i.get(e[0],t),D=i.get(e[1],t);AM(E)?a[0]=z.toGlobalCoord(z.getExtent()[e[0]==="x0"?0:1]):AM(D)&&(a[1]=N.toGlobalCoord(N.getExtent()[e[1]==="y0"?0:1]))}isNaN(c)||(a[0]=c),isNaN(f)||(a[1]=f)}return a}var e7=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]],_3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.updateTransform=function(e,r,n){r.eachSeries(function(o){var s=Vd.getMarkerModelFromSeries(o,"markArea");if(s){var a=s.getData();a.each(function(c){var f=ti(e7,function(v){return t7(a,c,v,o,n)});a.setItemLayout(c,f);var g=a.getItemGraphicEl(c);g.setShape("points",f)})}},this)},t.prototype.renderSeries=function(e,r,n,o){var s=e.coordinateSystem,a=e.id,c=e.getData(),f=this.markerGroupMap,g=f.get(a)||f.set(a,{group:new Ki});this.group.add(g.group),this.markKeep(g);var v=y3t(s,e,r);r.setData(v),v.each(function(y){var w=ti(e7,function(ut){return t7(v,y,ut,e,o)}),I=s.getAxis("x").scale,E=s.getAxis("y").scale,D=I.getExtent(),R=E.getExtent(),z=[I.parse(v.get("x0",y)),I.parse(v.get("x1",y))],N=[E.parse(v.get("y0",y)),E.parse(v.get("y1",y))];Pu(z),Pu(N);var H=!(D[0]>z[1]||D[1]<z[0]||R[0]>N[1]||R[1]<N[0]),q=!H;v.setItemLayout(y,{points:w,allClipped:q});var Y=v.getItemModel(y),J=Y.getModel("itemStyle").getItemStyle(),it=Y.get("z2"),at=WS(c,"color");J.fill||(J.fill=at,wi(J.fill)&&(J.fill=EC(J.fill,.4))),J.stroke||(J.stroke=at),v.setItemVisual(y,"style",J),v.setItemVisual(y,"z2",Ui(it,0))}),v.diff(xI(g).data).add(function(y){var w=v.getItemLayout(y),I=v.getItemVisual(y,"z2");if(!w.allClipped){var E=new gl({z2:Ui(I,0),shape:{points:w.points}});v.setItemGraphicEl(y,E),g.group.add(E)}}).update(function(y,w){var I=xI(g).data.getItemGraphicEl(w),E=v.getItemLayout(y),D=v.getItemVisual(y,"z2");E.allClipped?I&&g.group.remove(I):(I?yn(I,{z2:Ui(D,0),shape:{points:E.points}},r,y):I=new gl({shape:{points:E.points}}),v.setItemGraphicEl(y,I),g.group.add(I))}).remove(function(y){var w=xI(g).data.getItemGraphicEl(y);g.group.remove(w)}).execute(),v.eachItemGraphicEl(function(y,w){var I=v.getItemModel(w),E=v.getItemVisual(w,"style");y.useStyle(v.getItemVisual(w,"style")),Xo(y,Fo(I),{labelFetcher:r,labelDataIndex:w,defaultText:v.getName(w)||"",inheritColor:wi(E.fill)?EC(E.fill,1):ye.color.neutral99}),Bo(y,I),Ca(y,null,null,I.get(["emphasis","disabled"])),cr(y).dataModel=r}),xI(g).data=v,g.group.silent=r.get("silent")||e.get("silent")},t.type="markArea",t}(zN);function y3t(i,t,e){var r,n,o=["x0","y0","x1","y1"];if(i){var s=ti(i&&i.dimensions,function(f){var g=t.getData(),v=g.getDimensionInfo(g.mapDimension(f))||{};return Ne(Ne({},v),{name:f,ordinalMeta:null})});n=ti(o,function(f,g){return{name:f,type:s[g%2].type}}),r=new dl(n,e)}else n=[{name:"value",type:"float"}],r=new dl(n,e);var a=ti(e.get("data"),br(m3t,t,i,e));i&&(a=kn(a,br(v3t,i)));var c=i?function(f,g,v,y){var w=f.coord[Math.floor(y/2)][y%2];return Mp(w,n[y])}:function(f,g,v,y){return Mp(f.value,n[y])};return r.initData(a,null,c),r.hasItemOption=!0,r}const x3t=_3t;function b3t(i){i.registerComponentModel(g3t),i.registerComponentView(x3t),i.registerPreprocessor(function(t){ON(t.series,"markArea")&&(t.markArea=t.markArea||{})})}var w3t=function(i,t){if(t==="all")return{type:"all",title:i.getLocaleModel().get(["legend","selector","all"])};if(t==="inverse")return{type:"inverse",title:i.getLocaleModel().get(["legend","selector","inverse"])}},S3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.layoutMode={type:"box",ignoreSize:!0},e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n),e.selected=e.selected||{},this._updateSelector(e)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.call(this,e,r),this._updateSelector(e)},t.prototype._updateSelector=function(e){var r=e.selector,n=this.ecModel;r===!0&&(r=e.selector=["all","inverse"]),Ye(r)&&pt(r,function(o,s){wi(o)&&(o={type:o}),r[s]=Er(o,w3t(n,o.type))})},t.prototype.optionUpdated=function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&this.get("selectedMode")==="single"){for(var r=!1,n=0;n<e.length;n++){var o=e[n].get("name");if(this.isSelected(o)){this.select(o),r=!0;break}}!r&&this.select(e[0].get("name"))}},t.prototype._updateData=function(e){var r=[],n=[];e.eachRawSeries(function(c){var f=c.name;n.push(f);var g;if(c.legendVisualProvider){var v=c.legendVisualProvider,y=v.getAllNames();e.isSeriesFiltered(c)||(n=n.concat(y)),y.length?r=r.concat(y):g=!0}else g=!0;g&&LF(c)&&r.push(c.name)}),this._availableNames=n;var o=this.get("data")||r,s=Fi(),a=ti(o,function(c){return(wi(c)||fn(c))&&(c={name:c}),s.get(c.name)?null:(s.set(c.name,!0),new bn(c,this,this.ecModel))},this);this._data=kn(a,function(c){return!!c})},t.prototype.getData=function(){return this._data},t.prototype.select=function(e){var r=this.option.selected,n=this.get("selectedMode");if(n==="single"){var o=this._data;pt(o,function(s){r[s.get("name")]=!1})}r[e]=!0},t.prototype.unSelect=function(e){this.get("selectedMode")!=="single"&&(this.option.selected[e]=!1)},t.prototype.toggleSelected=function(e){var r=this.option.selected;r.hasOwnProperty(e)||(r[e]=!0),this[r[e]?"unSelect":"select"](e)},t.prototype.allSelect=function(){var e=this._data,r=this.option.selected;pt(e,function(n){r[n.get("name",!0)]=!0})},t.prototype.inverseSelect=function(){var e=this._data,r=this.option.selected;pt(e,function(n){var o=n.get("name",!0);r.hasOwnProperty(o)||(r[o]=!0),r[o]=!r[o]})},t.prototype.isSelected=function(e){var r=this.option.selected;return!(r.hasOwnProperty(e)&&!r[e])&&Ar(this._availableNames,e)>=0},t.prototype.getOrient=function(){return this.get("orient")==="vertical"?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},t.type="legend.plain",t.dependencies=["series"],t.defaultOption={z:4,show:!0,orient:"horizontal",left:"center",bottom:ye.size.m,align:"auto",backgroundColor:ye.color.transparent,borderColor:ye.color.border,borderRadius:0,borderWidth:0,padding:5,itemGap:8,itemWidth:25,itemHeight:14,symbolRotate:"inherit",symbolKeepAspect:!0,inactiveColor:ye.color.disabled,inactiveBorderColor:ye.color.disabled,inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:ye.color.disabled,inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit"},textStyle:{color:ye.color.secondary},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:"sans-serif",color:ye.color.tertiary,borderWidth:1,borderColor:ye.color.border},emphasis:{selectorLabel:{show:!0,color:ye.color.quaternary}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1},triggerEvent:!1},t}(gn);const AB=S3t;var Ny=br,IB=pt,bI=Ki,T3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.newlineDisabled=!1,e}return t.prototype.init=function(){this.group.add(this._contentGroup=new bI),this.group.add(this._selectorGroup=new bI),this._isFirstRender=!0},t.prototype.getContentGroup=function(){return this._contentGroup},t.prototype.getSelectorGroup=function(){return this._selectorGroup},t.prototype.render=function(e,r,n){var o=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),!!e.get("show",!0)){var s=e.get("align"),a=e.get("orient");(!s||s==="auto")&&(s=e.get("left")==="right"&&a==="vertical"?"right":"left");var c=e.get("selector",!0),f=e.get("selectorPosition",!0);c&&(!f||f==="auto")&&(f=a==="horizontal"?"end":"start"),this.renderInner(s,e,r,n,c,a,f);var g=No(e,n).refContainer,v=e.getBoxLayoutParams(),y=e.get("padding"),w=Ma(v,g,y),I=this.layoutInner(e,s,w,o,c,f),E=Ma(rr({width:I.width,height:I.height},v),g,y);this.group.x=E.x-I.x,this.group.y=E.y-I.y,this.group.markRedraw(),this.group.add(this._backgroundEl=Srt(I,e))}},t.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},t.prototype.renderInner=function(e,r,n,o,s,a,c){var f=this.getContentGroup(),g=Fi(),v=r.get("selectedMode"),y=r.get("triggerEvent"),w=[];n.eachRawSeries(function(I){!I.get("legendHoverLink")&&w.push(I.id)}),IB(r.getData(),function(I,E){var D=this,R=I.get("name");if(!this.newlineDisabled&&(R===""||R===`
`)){var z=new bI;z.newline=!0,f.add(z);return}var N=n.getSeriesByName(R)[0];if(!g.get(R))if(N){var H=N.getData(),q=H.getVisual("legendLineStyle")||{},Y=H.getVisual("legendIcon"),J=H.getVisual("style"),it=this._createItem(N,R,E,I,r,e,q,J,Y,v,o);it.on("click",Ny(i7,R,null,o,w)).on("mouseover",Ny(CB,N.name,null,o,w)).on("mouseout",Ny(MB,N.name,null,o,w)),n.ssr&&it.eachChild(function(at){var ut=cr(at);ut.seriesIndex=N.seriesIndex,ut.dataIndex=E,ut.ssrType="legend"}),y&&it.eachChild(function(at){D.packEventData(at,r,N,E,R)}),g.set(R,!0)}else n.eachRawSeries(function(at){var ut=this;if(!g.get(R)&&at.legendVisualProvider){var ft=at.legendVisualProvider;if(!ft.containName(R))return;var _t=ft.indexOfName(R),ct=ft.getItemVisual(_t,"style"),Dt=ft.getItemVisual(_t,"legendIcon"),Et=Ol(ct.fill);Et&&Et[3]===0&&(Et[3]=.2,ct=Ne(Ne({},ct),{fill:gh(Et,"rgba")}));var bt=this._createItem(at,R,E,I,r,e,{},ct,Dt,v,o);bt.on("click",Ny(i7,null,R,o,w)).on("mouseover",Ny(CB,null,R,o,w)).on("mouseout",Ny(MB,null,R,o,w)),n.ssr&&bt.eachChild(function(Vt){var zt=cr(Vt);zt.seriesIndex=at.seriesIndex,zt.dataIndex=E,zt.ssrType="legend"}),y&&bt.eachChild(function(Vt){ut.packEventData(Vt,r,at,E,R)}),g.set(R,!0)}},this)},this),s&&this._createSelector(s,r,o,a,c)},t.prototype.packEventData=function(e,r,n,o,s){var a={componentType:"legend",componentIndex:r.componentIndex,dataIndex:o,value:s,seriesIndex:n.seriesIndex};cr(e).eventData=a},t.prototype._createSelector=function(e,r,n,o,s){var a=this.getSelectorGroup();IB(e,function(f){var g=f.type,v=new _n({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){n.dispatchAction({type:g==="all"?"legendAllSelect":"legendInverseSelect",legendId:r.id})}});a.add(v);var y=r.getModel("selectorLabel"),w=r.getModel(["emphasis","selectorLabel"]);Xo(v,{normal:y,emphasis:w},{defaultText:f.title}),lv(v)})},t.prototype._createItem=function(e,r,n,o,s,a,c,f,g,v,y){var w=e.visualDrawType,I=s.get("itemWidth"),E=s.get("itemHeight"),D=s.isSelected(r),R=o.get("symbolRotate"),z=o.get("symbolKeepAspect"),N=o.get("icon");g=N||g||"roundRect";var H=A3t(g,o,c,f,w,D,y),q=new bI,Y=o.getModel("textStyle");if(Xi(e.getLegendIcon)&&(!N||N==="inherit"))q.add(e.getLegendIcon({itemWidth:I,itemHeight:E,icon:g,iconRotate:R,itemStyle:H.itemStyle,lineStyle:H.lineStyle,symbolKeepAspect:z}));else{var J=N==="inherit"&&e.getData().getVisual("symbol")?R==="inherit"?e.getData().getVisual("symbolRotate"):R:0;q.add(I3t({itemWidth:I,itemHeight:E,icon:g,iconRotate:J,itemStyle:H.itemStyle,lineStyle:H.lineStyle,symbolKeepAspect:z}))}var it=a==="left"?I+5:-5,at=a,ut=s.get("formatter"),ft=r;wi(ut)&&ut?ft=ut.replace("{name}",r??""):Xi(ut)&&(ft=ut(r));var _t=D?Y.getTextColor():o.get("inactiveColor");q.add(new _n({style:pa(Y,{text:ft,x:it,y:E/2,fill:_t,align:at,verticalAlign:"middle"},{inheritColor:_t})}));var ct=new jr({shape:q.getBoundingRect(),style:{fill:"transparent"}}),Dt=o.getModel("tooltip");return Dt.get("show")&&Wd({el:ct,componentModel:s,itemName:r,itemTooltipOption:Dt.option}),q.add(ct),q.eachChild(function(Et){Et.silent=!0}),ct.silent=!v,this.getContentGroup().add(q),lv(q),q.__legendDataIndex=n,q},t.prototype.layoutInner=function(e,r,n,o,s,a){var c=this.getContentGroup(),f=this.getSelectorGroup();cv(e.get("orient"),c,e.get("itemGap"),n.width,n.height);var g=c.getBoundingRect(),v=[-g.x,-g.y];if(f.markRedraw(),c.markRedraw(),s){cv("horizontal",f,e.get("selectorItemGap",!0));var y=f.getBoundingRect(),w=[-y.x,-y.y],I=e.get("selectorButtonGap",!0),E=e.getOrient().index,D=E===0?"width":"height",R=E===0?"height":"width",z=E===0?"y":"x";a==="end"?w[E]+=g[D]+I:v[E]+=y[D]+I,w[1-E]+=g[R]/2-y[R]/2,f.x=w[0],f.y=w[1],c.x=v[0],c.y=v[1];var N={x:0,y:0};return N[D]=g[D]+I+y[D],N[R]=Math.max(g[R],y[R]),N[z]=Math.min(0,y[z]+w[1-E]),N}else return c.x=v[0],c.y=v[1],this.group.getBoundingRect()},t.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},t.type="legend.plain",t}(Oa);function A3t(i,t,e,r,n,o,s){function a(D,R){D.lineWidth==="auto"&&(D.lineWidth=R.lineWidth>0?2:0),IB(D,function(z,N){D[N]==="inherit"&&(D[N]=R[N])})}var c=t.getModel("itemStyle"),f=c.getItemStyle(),g=i.lastIndexOf("empty",0)===0?"fill":"stroke",v=c.getShallow("decal");f.decal=!v||v==="inherit"?r.decal:A0(v,s),f.fill==="inherit"&&(f.fill=r[n]),f.stroke==="inherit"&&(f.stroke=r[g]),f.opacity==="inherit"&&(f.opacity=(n==="fill"?r:e).opacity),a(f,r);var y=t.getModel("lineStyle"),w=y.getLineStyle();if(a(w,e),f.fill==="auto"&&(f.fill=r.fill),f.stroke==="auto"&&(f.stroke=r.fill),w.stroke==="auto"&&(w.stroke=r.fill),!o){var I=t.get("inactiveBorderWidth"),E=f[g];f.lineWidth=I==="auto"?r.lineWidth>0&&E?2:0:f.lineWidth,f.fill=t.get("inactiveColor"),f.stroke=t.get("inactiveBorderColor"),w.stroke=y.get("inactiveColor"),w.lineWidth=y.get("inactiveWidth")}return{itemStyle:f,lineStyle:w}}function I3t(i){var t=i.icon||"roundRect",e=To(t,0,0,i.itemWidth,i.itemHeight,i.itemStyle.fill,i.symbolKeepAspect);return e.setStyle(i.itemStyle),e.rotation=(i.iconRotate||0)*Math.PI/180,e.setOrigin([i.itemWidth/2,i.itemHeight/2]),t.indexOf("empty")>-1&&(e.style.stroke=e.style.fill,e.style.fill=ye.color.neutral00,e.style.lineWidth=2),e}function i7(i,t,e,r){MB(i,t,e,r),e.dispatchAction({type:"legendToggleSelect",name:i??t}),CB(i,t,e,r)}function zrt(i){for(var t=i.getZr().storage.getDisplayList(),e,r=0,n=t.length;r<n&&!(e=t[r].states.emphasis);)r++;return e&&e.hoverLayer}function CB(i,t,e,r){zrt(e)||e.dispatchAction({type:"highlight",seriesName:i,name:t,excludeSeriesId:r})}function MB(i,t,e,r){zrt(e)||e.dispatchAction({type:"downplay",seriesName:i,name:t,excludeSeriesId:r})}const Brt=T3t;function C3t(i){var t=i.findComponents({mainType:"legend"});t&&t.length&&i.filterSeries(function(e){for(var r=0;r<t.length;r++)if(!t[r].isSelected(e.name))return!1;return!0})}function Ub(i,t,e){var r=i==="allSelect"||i==="inverseSelect",n={},o=[];e.eachComponent({mainType:"legend",query:t},function(a){r?a[i]():a[i](t.name),r7(a,n),o.push(a.componentIndex)});var s={};return e.eachComponent("legend",function(a){pt(n,function(c,f){a[c?"select":"unSelect"](f)}),r7(a,s)}),r?{selected:s,legendIndex:o}:{name:t.name,selected:s}}function r7(i,t){var e=t||{};return pt(i.getData(),function(r){var n=r.get("name");if(!(n===`
`||n==="")){var o=i.isSelected(n);Pi(e,n)?e[n]=e[n]&&o:e[n]=o}}),e}function M3t(i){i.registerAction("legendToggleSelect","legendselectchanged",br(Ub,"toggleSelected")),i.registerAction("legendAllSelect","legendselectall",br(Ub,"allSelect")),i.registerAction("legendInverseSelect","legendinverseselect",br(Ub,"inverseSelect")),i.registerAction("legendSelect","legendselected",br(Ub,"select")),i.registerAction("legendUnSelect","legendunselected",br(Ub,"unSelect"))}function Frt(i){i.registerComponentModel(AB),i.registerComponentView(Brt),i.registerProcessor(i.PRIORITY.PROCESSOR.SERIES_FILTER,C3t),i.registerSubTypeDefaulter("legend",function(){return"plain"}),M3t(i)}var E3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.setScrollDataIndex=function(e){this.option.scrollDataIndex=e},t.prototype.init=function(e,r,n){var o=Pv(e);i.prototype.init.call(this,e,r,n),n7(this,e,o)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.call(this,e,r),n7(this,this.option,e)},t.type="legend.scroll",t.defaultOption=Zp(AB.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:ye.color.accent50,pageIconInactiveColor:ye.color.accent10,pageIconSize:15,pageTextStyle:{color:ye.color.tertiary},animationDurationUpdate:800}),t}(AB);function n7(i,t,e){var r=i.getOrient(),n=[1,1];n[r.index]=0,Th(t,e,{type:"box",ignoreSize:!!n})}const D3t=E3t;var a7=Ki,kk=["width","height"],Ok=["x","y"],P3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.newlineDisabled=!0,e._currentIndex=0,e}return t.prototype.init=function(){i.prototype.init.call(this),this.group.add(this._containerGroup=new a7),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new a7)},t.prototype.resetInner=function(){i.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},t.prototype.renderInner=function(e,r,n,o,s,a,c){var f=this;i.prototype.renderInner.call(this,e,r,n,o,s,a,c);var g=this._controllerGroup,v=r.get("pageIconSize",!0),y=Ye(v)?v:[v,v];I("pagePrev",0);var w=r.getModel("pageTextStyle");g.add(new _n({name:"pageText",style:{text:"xx/xx",fill:w.getTextColor(),font:w.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),I("pageNext",1);function I(E,D){var R=E+"DataIndex",z=US(r.get("pageIcons",!0)[r.getOrient().name][D],{onclick:Si(f._pageGo,f,R,r,o)},{x:-y[0]/2,y:-y[1]/2,width:y[0],height:y[1]});z.name=E,g.add(z)}},t.prototype.layoutInner=function(e,r,n,o,s,a){var c=this.getSelectorGroup(),f=e.getOrient().index,g=kk[f],v=Ok[f],y=kk[1-f],w=Ok[1-f];s&&cv("horizontal",c,e.get("selectorItemGap",!0));var I=e.get("selectorButtonGap",!0),E=c.getBoundingRect(),D=[-E.x,-E.y],R=Yi(n);s&&(R[g]=n[g]-E[g]-I);var z=this._layoutContentAndController(e,o,R,f,g,y,w,v);if(s){if(a==="end")D[f]+=z[g]+I;else{var N=E[g]+I;D[f]-=N,z[v]-=N}z[g]+=E[g]+I,D[1-f]+=z[w]+z[y]/2-E[y]/2,z[y]=Math.max(z[y],E[y]),z[w]=Math.min(z[w],E[w]+D[1-f]),c.x=D[0],c.y=D[1],c.markRedraw()}return z},t.prototype._layoutContentAndController=function(e,r,n,o,s,a,c,f){var g=this.getContentGroup(),v=this._containerGroup,y=this._controllerGroup;cv(e.get("orient"),g,e.get("itemGap"),o?n.width:null,o?null:n.height),cv("horizontal",y,e.get("pageButtonItemGap",!0));var w=g.getBoundingRect(),I=y.getBoundingRect(),E=this._showController=w[s]>n[s],D=[-w.x,-w.y];r||(D[o]=g[f]);var R=[0,0],z=[-I.x,-I.y],N=Ui(e.get("pageButtonGap",!0),e.get("itemGap",!0));if(E){var H=e.get("pageButtonPosition",!0);H==="end"?z[o]+=n[s]-I[s]:R[o]+=I[s]+N}z[1-o]+=w[a]/2-I[a]/2,g.setPosition(D),v.setPosition(R),y.setPosition(z);var q={x:0,y:0};if(q[s]=E?n[s]:w[s],q[a]=Math.max(w[a],I[a]),q[c]=Math.min(0,I[c]+z[1-o]),v.__rectSize=n[s],E){var Y={x:0,y:0};Y[s]=Math.max(n[s]-I[s]-N,0),Y[a]=q[a],v.setClipPath(new jr({shape:Y})),v.__rectSize=Y[s]}else y.eachChild(function(it){it.attr({invisible:!0,silent:!0})});var J=this._getPageInfo(e);return J.pageIndex!=null&&yn(g,{x:J.contentPosition[0],y:J.contentPosition[1]},E?e:null),this._updatePageInfoView(e,J),q},t.prototype._pageGo=function(e,r,n){var o=this._getPageInfo(r)[e];o!=null&&n.dispatchAction({type:"legendScroll",scrollDataIndex:o,legendId:r.id})},t.prototype._updatePageInfoView=function(e,r){var n=this._controllerGroup;pt(["pagePrev","pageNext"],function(g){var v=g+"DataIndex",y=r[v]!=null,w=n.childOfName(g);w&&(w.setStyle("fill",y?e.get("pageIconColor",!0):e.get("pageIconInactiveColor",!0)),w.cursor=y?"pointer":"default")});var o=n.childOfName("pageText"),s=e.get("pageFormatter"),a=r.pageIndex,c=a!=null?a+1:0,f=r.pageCount;o&&s&&o.setStyle("text",wi(s)?s.replace("{current}",c==null?"":c+"").replace("{total}",f==null?"":f+""):s({current:c,total:f}))},t.prototype._getPageInfo=function(e){var r=e.get("scrollDataIndex",!0),n=this.getContentGroup(),o=this._containerGroup.__rectSize,s=e.getOrient().index,a=kk[s],c=Ok[s],f=this._findTargetItemIndex(r),g=n.children(),v=g[f],y=g.length,w=y?1:0,I={contentPosition:[n.x,n.y],pageCount:w,pageIndex:w-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!v)return I;var E=H(v);I.contentPosition[s]=-E.s;for(var D=f+1,R=E,z=E,N=null;D<=y;++D)N=H(g[D]),(!N&&z.e>R.s+o||N&&!q(N,R.s))&&(z.i>R.i?R=z:R=N,R&&(I.pageNextDataIndex==null&&(I.pageNextDataIndex=R.i),++I.pageCount)),z=N;for(var D=f-1,R=E,z=E,N=null;D>=-1;--D)N=H(g[D]),(!N||!q(z,N.s))&&R.i<z.i&&(z=R,I.pagePrevDataIndex==null&&(I.pagePrevDataIndex=R.i),++I.pageCount,++I.pageIndex),R=N;return I;function H(Y){if(Y){var J=Y.getBoundingRect(),it=J[c]+Y[c];return{s:it,e:it+J[a],i:Y.__legendDataIndex}}}function q(Y,J){return Y.e>=J&&Y.s<=J+o}},t.prototype._findTargetItemIndex=function(e){if(!this._showController)return 0;var r,n=this.getContentGroup(),o;return n.eachChild(function(s,a){var c=s.__legendDataIndex;o==null&&c!=null&&(o=a),c===e&&(r=a)}),r??o},t.type="legend.scroll",t}(Brt);const L3t=P3t;function R3t(i){i.registerAction("legendScroll","legendscroll",function(t,e){var r=t.scrollDataIndex;r!=null&&e.eachComponent({mainType:"legend",subType:"scroll",query:t},function(n){n.setScrollDataIndex(r)})})}function k3t(i){Rr(Frt),i.registerComponentModel(D3t),i.registerComponentView(L3t),R3t(i)}function O3t(i){Rr(Frt),Rr(k3t)}var z3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.inside",t.defaultOption=Zp(AS.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),t}(AS);const B3t=z3t;var BN=Wr();function F3t(i,t,e){BN(i).coordSysRecordMap.each(function(r){var n=r.dataZoomInfoMap.get(t.uid);n&&(n.getRange=e)})}function N3t(i,t){for(var e=BN(i).coordSysRecordMap,r=e.keys(),n=0;n<r.length;n++){var o=r[n],s=e.get(o),a=s.dataZoomInfoMap;if(a){var c=t.uid,f=a.get(c);f&&(a.removeKey(c),a.keys().length||Nrt(e,s))}}}function Nrt(i,t){if(t){i.removeKey(t.model.uid);var e=t.controller;e&&e.dispose()}}function V3t(i,t){var e={model:t,containsPoint:br(G3t,t),dispatchAction:br(U3t,i),dataZoomInfoMap:null,controller:null},r=e.controller=new Bv(i.getZr());return pt(["pan","zoom","scrollMove"],function(n){r.on(n,function(o){var s=[];e.dataZoomInfoMap.each(function(a){if(o.isAvailableBehavior(a.model.option)){var c=(a.getRange||{})[n],f=c&&c(a.dzReferCoordSysInfo,e.model.mainType,e.controller,o);!a.model.get("disabled",!0)&&f&&s.push({dataZoomId:a.model.id,start:f[0],end:f[1]})}}),s.length&&e.dispatchAction(s)})}),e}function U3t(i,t){i.isDisposed()||i.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:t})}function G3t(i,t,e,r){return i.coordinateSystem.containPoint([e,r])}function H3t(i,t,e){var r,n="type_",o={type_true:2,type_move:1,type_false:0,type_undefined:-1},s=!0;return i.each(function(a){var c=a.model,f=c.get("disabled",!0)?!1:c.get("zoomLock",!0)?"move":!0;o[n+f]>o[n+r]&&(r=f),s=s&&c.get("preventDefaultMouseMove",!0)}),{controlType:r,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!s,api:e,zInfo:{component:t.model},triggerInfo:{roamTrigger:null,isInSelf:t.containsPoint}}}}function j3t(i){i.registerProcessor(i.PRIORITY.PROCESSOR.FILTER,function(t,e){var r=BN(e),n=r.coordSysRecordMap||(r.coordSysRecordMap=Fi());n.each(function(o){o.dataZoomInfoMap=null}),t.eachComponent({mainType:"dataZoom",subType:"inside"},function(o){var s=xrt(o);pt(s.infoList,function(a){var c=a.model.uid,f=n.get(c)||n.set(c,V3t(e,a.model)),g=f.dataZoomInfoMap||(f.dataZoomInfoMap=Fi());g.set(o.uid,{dzReferCoordSysInfo:a,model:o,getRange:null})})}),n.each(function(o){var s=o.controller,a,c=o.dataZoomInfoMap;if(c){var f=c.keys()[0];f!=null&&(a=c.get(f))}if(!a){Nrt(n,o);return}var g=H3t(c,o,e);s.enable(g.controlType,g.opt),Z0(o,"dispatchAction",a.model.get("throttle",!0),"fixRate")})})}var W3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="dataZoom.inside",e}return t.prototype.render=function(e,r,n){if(i.prototype.render.apply(this,arguments),e.noTarget()){this._clear();return}this.range=e.getPercentRange(),F3t(n,e,{pan:Si(zk.pan,this),zoom:Si(zk.zoom,this),scrollMove:Si(zk.scrollMove,this)})},t.prototype.dispose=function(){this._clear(),i.prototype.dispose.apply(this,arguments)},t.prototype._clear=function(){N3t(this.api,this.dataZoomModel),this.range=null},t.type="dataZoom.inside",t}(EN),zk={zoom:function(i,t,e,r){var n=this.range,o=n.slice(),s=i.axisModels[0];if(s){var a=Bk[t](null,[r.originX,r.originY],s,e,i),c=(a.signal>0?a.pixelStart+a.pixelLength-a.pixel:a.pixel-a.pixelStart)/a.pixelLength*(o[1]-o[0])+o[0],f=Math.max(1/r.scale,0);o[0]=(o[0]-c)*f+c,o[1]=(o[1]-c)*f+c;var g=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();if(Np(0,o,[0,100],0,g.minSpan,g.maxSpan),this.range=o,n[0]!==o[0]||n[1]!==o[1])return o}},pan:o7(function(i,t,e,r,n,o){var s=Bk[r]([o.oldX,o.oldY],[o.newX,o.newY],t,n,e);return s.signal*(i[1]-i[0])*s.pixel/s.pixelLength}),scrollMove:o7(function(i,t,e,r,n,o){var s=Bk[r]([0,0],[o.scrollDelta,o.scrollDelta],t,n,e);return s.signal*(i[1]-i[0])*o.scrollDelta})};function o7(i){return function(t,e,r,n){var o=this.range,s=o.slice(),a=t.axisModels[0];if(a){var c=i(s,a,t,e,r,n);if(Np(c,s,[0,100],"all"),this.range=s,o[0]!==s[0]||o[1]!==s[1])return s}}}var Bk={grid:function(i,t,e,r,n){var o=e.axis,s={},a=n.model.coordinateSystem.getRect();return i=i||[0,0],o.dim==="x"?(s.pixel=t[0]-i[0],s.pixelLength=a.width,s.pixelStart=a.x,s.signal=o.inverse?1:-1):(s.pixel=t[1]-i[1],s.pixelLength=a.height,s.pixelStart=a.y,s.signal=o.inverse?-1:1),s},polar:function(i,t,e,r,n){var o=e.axis,s={},a=n.model.coordinateSystem,c=a.getRadiusAxis().getExtent(),f=a.getAngleAxis().getExtent();return i=i?a.pointToCoord(i):[0,0],t=a.pointToCoord(t),e.mainType==="radiusAxis"?(s.pixel=t[0]-i[0],s.pixelLength=c[1]-c[0],s.pixelStart=c[0],s.signal=o.inverse?1:-1):(s.pixel=t[1]-i[1],s.pixelLength=f[1]-f[0],s.pixelStart=f[0],s.signal=o.inverse?-1:1),s},singleAxis:function(i,t,e,r,n){var o=e.axis,s=n.model.coordinateSystem.getRect(),a={};return i=i||[0,0],o.orient==="horizontal"?(a.pixel=t[0]-i[0],a.pixelLength=s.width,a.pixelStart=s.x,a.signal=o.inverse?1:-1):(a.pixel=t[1]-i[1],a.pixelLength=s.height,a.pixelStart=s.y,a.signal=o.inverse?-1:1),a}};const $3t=W3t;function Vrt(i){DN(i),i.registerComponentModel(B3t),i.registerComponentView($3t),j3t(i)}var Z3t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.type="dataZoom.slider",t.layoutMode="box",t.defaultOption=Zp(AS.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:ye.color.accent10,borderRadius:0,backgroundColor:ye.color.transparent,dataBackground:{lineStyle:{color:ye.color.accent30,width:.5},areaStyle:{color:ye.color.accent20,opacity:.2}},selectedDataBackground:{lineStyle:{color:ye.color.accent40,width:.5},areaStyle:{color:ye.color.accent20,opacity:.3}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:ye.color.neutral00,borderColor:ye.color.accent20},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:ye.color.accent40,opacity:.5},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:ye.color.tertiary},brushSelect:!0,brushStyle:{color:ye.color.accent30,opacity:.3},emphasis:{handleLabel:{show:!0},handleStyle:{borderColor:ye.color.accent40},moveHandleStyle:{opacity:.8}},defaultLocationEdgeGap:15}),t}(AS);const q3t=Z3t;var Gb=jr,X3t=1,Fk=30,Y3t=7,Hb="horizontal",s7="vertical",K3t=5,J3t=["line","bar","candlestick","scatter"],Q3t={easing:"cubicOut",duration:100,delay:0},tNt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._displayables={},e}return t.prototype.init=function(e,r){this.api=r,this._onBrush=Si(this._onBrush,this),this._onBrushEnd=Si(this._onBrushEnd,this)},t.prototype.render=function(e,r,n,o){if(i.prototype.render.apply(this,arguments),Z0(this,"_dispatchZoomAction",e.get("throttle"),"fixRate"),this._orient=e.getOrient(),e.get("show")===!1){this.group.removeAll();return}if(e.noTarget()){this._clear(),this.group.removeAll();return}(!o||o.type!=="dataZoom"||o.from!==this.uid)&&this._buildView(),this._updateView()},t.prototype.dispose=function(){this._clear(),i.prototype.dispose.apply(this,arguments)},t.prototype._clear=function(){cS(this,"_dispatchZoomAction");var e=this.api.getZr();e.off("mousemove",this._onBrush),e.off("mouseup",this._onBrushEnd)},t.prototype._buildView=function(){var e=this.group;e.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var r=this._displayables.sliderGroup=new Ki;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),e.add(r),this._positionGroup()},t.prototype._resetLocation=function(){var e=this.dataZoomModel,r=this.api,n=e.get("brushSelect"),o=n?Y3t:0,s=No(e,r).refContainer,a=this._findCoordRect(),c=e.get("defaultLocationEdgeGap",!0)||0,f=this._orient===Hb?{right:s.width-a.x-a.width,top:s.height-Fk-c-o,width:a.width,height:Fk}:{right:c,top:a.y,width:Fk,height:a.height},g=Pv(e.option);pt(["right","top","width","height"],function(y){g[y]==="ph"&&(g[y]=f[y])});var v=Ma(g,s);this._location={x:v.x,y:v.y},this._size=[v.width,v.height],this._orient===s7&&this._size.reverse()},t.prototype._positionGroup=function(){var e=this.group,r=this._location,n=this._orient,o=this.dataZoomModel.getFirstTargetAxisModel(),s=o&&o.get("inverse"),a=this._displayables.sliderGroup,c=(this._dataShadowInfo||{}).otherAxisInverse;a.attr(n===Hb&&!s?{scaleY:c?1:-1,scaleX:1}:n===Hb&&s?{scaleY:c?1:-1,scaleX:-1}:n===s7&&!s?{scaleY:c?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:c?-1:1,scaleX:-1,rotation:Math.PI/2});var f=e.getBoundingRect([a]);e.x=r.x-f.x,e.y=r.y-f.y,e.markRedraw()},t.prototype._getViewExtent=function(){return[0,this._size[0]]},t.prototype._renderBackground=function(){var e=this.dataZoomModel,r=this._size,n=this._displayables.sliderGroup,o=e.get("brushSelect");n.add(new Gb({silent:!0,shape:{x:0,y:0,width:r[0],height:r[1]},style:{fill:e.get("backgroundColor")},z2:-40}));var s=new Gb({shape:{x:0,y:0,width:r[0],height:r[1]},style:{fill:"transparent"},z2:0,onclick:Si(this._onClickPanel,this)}),a=this.api.getZr();o?(s.on("mousedown",this._onBrushStart,this),s.cursor="crosshair",a.on("mousemove",this._onBrush),a.on("mouseup",this._onBrushEnd)):(a.off("mousemove",this._onBrush),a.off("mouseup",this._onBrushEnd)),n.add(s)},t.prototype._renderDataShadow=function(){var e=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],!e)return;var r=this._size,n=this._shadowSize||[],o=e.series,s=o.getRawData(),a=o.getShadowDim&&o.getShadowDim(),c=a&&s.getDimensionInfo(a)?o.getShadowDim():e.otherDim;if(c==null)return;var f=this._shadowPolygonPts,g=this._shadowPolylinePts;if(s!==this._shadowData||c!==this._shadowDim||r[0]!==n[0]||r[1]!==n[1]){var v=s.getDataExtent(e.thisDim),y=s.getDataExtent(c),w=(y[1]-y[0])*.3;y=[y[0]-w,y[1]+w];var I=[0,r[1]],E=[0,r[0]],D=[[r[0],0],[0,0]],R=[],z=E[1]/Math.max(1,s.count()-1),N=r[0]/(v[1]-v[0]),H=e.thisAxis.type==="time",q=-z,Y=Math.round(s.count()/r[0]),J;s.each([e.thisDim,c],function(_t,ct,Dt){if(Y>0&&Dt%Y){H||(q+=z);return}q=H?(+_t-v[0])*N:q+z;var Et=ct==null||isNaN(ct)||ct==="",bt=Et?0:Rn(ct,y,I,!0);Et&&!J&&Dt?(D.push([D[D.length-1][0],0]),R.push([R[R.length-1][0],0])):!Et&&J&&(D.push([q,0]),R.push([q,0])),Et||(D.push([q,bt]),R.push([q,bt])),J=Et}),f=this._shadowPolygonPts=D,g=this._shadowPolylinePts=R}this._shadowData=s,this._shadowDim=c,this._shadowSize=[r[0],r[1]];var it=this.dataZoomModel;function at(_t){var ct=it.getModel(_t?"selectedDataBackground":"dataBackground"),Dt=new Ki,Et=new gl({shape:{points:f},segmentIgnoreThreshold:1,style:ct.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),bt=new Us({shape:{points:g},segmentIgnoreThreshold:1,style:ct.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19});return Dt.add(Et),Dt.add(bt),Dt}for(var ut=0;ut<3;ut++){var ft=at(ut===1);this._displayables.sliderGroup.add(ft),this._displayables.dataShadowSegs.push(ft)}},t.prototype._prepareDataShadowInfo=function(){var e=this.dataZoomModel,r=e.get("showDataShadow");if(r!==!1){var n,o=this.ecModel;return e.eachTargetAxis(function(s,a){var c=e.getAxisProxy(s,a).getTargetSeriesModels();pt(c,function(f){if(!n&&!(r!==!0&&Ar(J3t,f.get("type"))<0)){var g=o.getComponent(xp(s),a).axis,v=eNt(s),y,w=f.coordinateSystem;v!=null&&w.getOtherAxis&&(y=w.getOtherAxis(g).inverse),v=f.getData().mapDimension(v);var I=f.getData().mapDimension(s);n={thisAxis:g,series:f,thisDim:I,otherDim:v,otherAxisInverse:y}}},this)},this),n}},t.prototype._renderHandle=function(){var e=this.group,r=this._displayables,n=r.handles=[null,null],o=r.handleLabels=[null,null],s=this._displayables.sliderGroup,a=this._size,c=this.dataZoomModel,f=this.api,g=c.get("borderRadius")||0,v=c.get("brushSelect"),y=r.filler=new Gb({silent:v,style:{fill:c.get("fillerColor")},textConfig:{position:"inside"}});s.add(y),s.add(new Gb({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:a[0],height:a[1],r:g},style:{stroke:c.get("dataBackgroundColor")||c.get("borderColor"),lineWidth:X3t,fill:ye.color.transparent}})),pt([0,1],function(N){var H=c.get("handleIcon");!$C[H]&&H.indexOf("path://")<0&&H.indexOf("image://")<0&&(H="path://"+H);var q=To(H,-1,0,2,2,null,!0);q.attr({cursor:iNt(this._orient),draggable:!0,drift:Si(this._onDragMove,this,N),ondragend:Si(this._onDragEnd,this),onmouseover:Si(this._showDataInfo,this,!0),onmouseout:Si(this._showDataInfo,this,!1),z2:5});var Y=q.getBoundingRect(),J=c.get("handleSize");this._handleHeight=xi(J,this._size[1]),this._handleWidth=Y.width/Y.height*this._handleHeight,q.setStyle(c.getModel("handleStyle").getItemStyle()),q.style.strokeNoScale=!0,q.rectHover=!0,q.ensureState("emphasis").style=c.getModel(["emphasis","handleStyle"]).getItemStyle(),lv(q);var it=c.get("handleColor");it!=null&&(q.style.fill=it),s.add(n[N]=q);var at=c.getModel("textStyle"),ut=c.get("handleLabel")||{},ft=ut.show||!1;e.add(o[N]=new _n({silent:!0,invisible:!ft,style:pa(at,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:at.getTextColor(),font:at.getFont()}),z2:10}))},this);var w=y;if(v){var I=xi(c.get("moveHandleSize"),a[1]),E=r.moveHandle=new jr({style:c.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:a[1]-.5,height:I}}),D=I*.8,R=r.moveHandleIcon=To(c.get("moveHandleIcon"),-D/2,-D/2,D,D,ye.color.neutral00,!0);R.silent=!0,R.y=a[1]+I/2-.5,E.ensureState("emphasis").style=c.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var z=Math.min(a[1]/2,Math.max(I,10));w=r.moveZone=new jr({invisible:!0,shape:{y:a[1]-z,height:I+z}}),w.on("mouseover",function(){f.enterEmphasis(E)}).on("mouseout",function(){f.leaveEmphasis(E)}),s.add(E),s.add(R),s.add(w)}w.attr({draggable:!0,cursor:"default",drift:Si(this._onDragMove,this,"all"),ondragstart:Si(this._showDataInfo,this,!0),ondragend:Si(this._onDragEnd,this),onmouseover:Si(this._showDataInfo,this,!0),onmouseout:Si(this._showDataInfo,this,!1)})},t.prototype._resetInterval=function(){var e=this._range=this.dataZoomModel.getPercentRange(),r=this._getViewExtent();this._handleEnds=[Rn(e[0],[0,100],r,!0),Rn(e[1],[0,100],r,!0)]},t.prototype._updateInterval=function(e,r){var n=this.dataZoomModel,o=this._handleEnds,s=this._getViewExtent(),a=n.findRepresentativeAxisProxy().getMinMaxSpan(),c=[0,100];Np(r,o,s,n.get("zoomLock")?"all":e,a.minSpan!=null?Rn(a.minSpan,c,s,!0):null,a.maxSpan!=null?Rn(a.maxSpan,c,s,!0):null);var f=this._range,g=this._range=Pu([Rn(o[0],s,c,!0),Rn(o[1],s,c,!0)]);return!f||f[0]!==g[0]||f[1]!==g[1]},t.prototype._updateView=function(e){var r=this._displayables,n=this._handleEnds,o=Pu(n.slice()),s=this._size;pt([0,1],function(w){var I=r.handles[w],E=this._handleHeight;I.attr({scaleX:E/2,scaleY:E/2,x:n[w]+(w?-1:1),y:s[1]/2-E/2})},this),r.filler.setShape({x:o[0],y:0,width:o[1]-o[0],height:s[1]});var a={x:o[0],width:o[1]-o[0]};r.moveHandle&&(r.moveHandle.setShape(a),r.moveZone.setShape(a),r.moveZone.getBoundingRect(),r.moveHandleIcon&&r.moveHandleIcon.attr("x",a.x+a.width/2));for(var c=r.dataShadowSegs,f=[0,o[0],o[1],s[0]],g=0;g<c.length;g++){var v=c[g],y=v.getClipPath();y||(y=new jr,v.setClipPath(y)),y.setShape({x:f[g],y:0,width:f[g+1]-f[g],height:s[1]})}this._updateDataInfo(e)},t.prototype._updateDataInfo=function(e){var r=this.dataZoomModel,n=this._displayables,o=n.handleLabels,s=this._orient,a=["",""];if(r.get("showDetail")){var c=r.findRepresentativeAxisProxy();if(c){var f=c.getAxisModel().axis,g=this._range,v=e?c.calculateDataWindow({start:g[0],end:g[1]}).valueWindow:c.getDataValueWindow();a=[this._formatLabel(v[0],f),this._formatLabel(v[1],f)]}}var y=Pu(this._handleEnds.slice());w.call(this,0),w.call(this,1);function w(I){var E=uv(n.handles[I].parent,this.group),D=gE(I===0?"right":"left",E),R=this._handleWidth/2+K3t,z=pc([y[I]+(I===0?-R:R),this._size[1]/2],E);o[I].setStyle({x:z[0],y:z[1],verticalAlign:s===Hb?"middle":D,align:s===Hb?D:"center",text:a[I]})}},t.prototype._formatLabel=function(e,r){var n=this.dataZoomModel,o=n.get("labelFormatter"),s=n.get("labelPrecision");(s==null||s==="auto")&&(s=r.getPixelPrecision());var a=e==null||isNaN(e)?"":r.type==="category"||r.type==="time"?r.scale.getLabel({value:Math.round(e)}):e.toFixed(Math.min(s,20));return Xi(o)?o(e,a):wi(o)?o.replace("{value}",a):a},t.prototype._showDataInfo=function(e){var r=this.dataZoomModel.get("handleLabel")||{},n=r.show||!1,o=this.dataZoomModel.getModel(["emphasis","handleLabel"]),s=o.get("show")||!1,a=e||this._dragging?s:n,c=this._displayables,f=c.handleLabels;f[0].attr("invisible",!a),f[1].attr("invisible",!a),c.moveHandle&&this.api[a?"enterEmphasis":"leaveEmphasis"](c.moveHandle,1)},t.prototype._onDragMove=function(e,r,n,o){this._dragging=!0,Rd(o.event);var s=this._displayables.sliderGroup.getLocalTransform(),a=pc([r,n],s,!0),c=this._updateInterval(e,a[0]),f=this.dataZoomModel.get("realtime");this._updateView(!f),c&&f&&this._dispatchZoomAction(!0)},t.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1);var e=this.dataZoomModel.get("realtime");!e&&this._dispatchZoomAction(!1)},t.prototype._onClickPanel=function(e){var r=this._size,n=this._displayables.sliderGroup.transformCoordToLocal(e.offsetX,e.offsetY);if(!(n[0]<0||n[0]>r[0]||n[1]<0||n[1]>r[1])){var o=this._handleEnds,s=(o[0]+o[1])/2,a=this._updateInterval("all",n[0]-s);this._updateView(),a&&this._dispatchZoomAction(!1)}},t.prototype._onBrushStart=function(e){var r=e.offsetX,n=e.offsetY;this._brushStart=new er(r,n),this._brushing=!0,this._brushStartTime=+new Date},t.prototype._onBrushEnd=function(e){if(this._brushing){var r=this._displayables.brushRect;if(this._brushing=!1,!!r){r.attr("ignore",!0);var n=r.shape,o=+new Date;if(!(o-this._brushStartTime<200&&Math.abs(n.width)<5)){var s=this._getViewExtent(),a=[0,100],c=this._handleEnds=[n.x,n.x+n.width],f=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();Np(0,c,s,0,f.minSpan!=null?Rn(f.minSpan,a,s,!0):null,f.maxSpan!=null?Rn(f.maxSpan,a,s,!0):null),this._range=Pu([Rn(c[0],s,a,!0),Rn(c[1],s,a,!0)]),this._updateView(),this._dispatchZoomAction(!1)}}}},t.prototype._onBrush=function(e){this._brushing&&(Rd(e.event),this._updateBrushRect(e.offsetX,e.offsetY))},t.prototype._updateBrushRect=function(e,r){var n=this._displayables,o=this.dataZoomModel,s=n.brushRect;s||(s=n.brushRect=new Gb({silent:!0,style:o.getModel("brushStyle").getItemStyle()}),n.sliderGroup.add(s)),s.attr("ignore",!1);var a=this._brushStart,c=this._displayables.sliderGroup,f=c.transformCoordToLocal(e,r),g=c.transformCoordToLocal(a.x,a.y),v=this._size;f[0]=Math.max(Math.min(v[0],f[0]),0),s.setShape({x:g[0],y:0,width:f[0]-g[0],height:v[1]})},t.prototype._dispatchZoomAction=function(e){var r=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:e?Q3t:null,start:r[0],end:r[1]})},t.prototype._findCoordRect=function(){var e,r=xrt(this.dataZoomModel).infoList;if(!e&&r.length){var n=r[0].model.coordinateSystem;e=n.getRect&&n.getRect()}if(!e){var o=this.api.getWidth(),s=this.api.getHeight();e={x:o*.2,y:s*.2,width:o*.6,height:s*.6}}return e},t.type="dataZoom.slider",t}(EN);function eNt(i){var t={x:"y",y:"x",radius:"angle",angle:"radius"};return t[i]}function iNt(i){return i==="vertical"?"ns-resize":"ew-resize"}const rNt=tNt;function Urt(i){i.registerComponentModel(q3t),i.registerComponentView(rNt),DN(i)}function nNt(i){Rr(Vrt),Rr(Urt)}var aNt={get:function(i,t,e){var r=Yi((oNt[i]||{})[t]);return e&&Ye(r)?r[r.length-1]:r}},oNt={color:{active:["#006edd","#e0ffff"],inactive:[ye.color.transparent]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}};const Grt=aNt;var l7=_s.mapVisual,sNt=_s.eachVisual,lNt=Ye,u7=pt,uNt=Pu,cNt=Rn,hNt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.stateList=["inRange","outOfRange"],e.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],e.layoutMode={type:"box",ignoreSize:!0},e.dataBound=[-1/0,1/0],e.targetVisuals={},e.controllerVisuals={},e}return t.prototype.init=function(e,r,n){this.mergeDefaultAndTheme(e,n)},t.prototype.optionUpdated=function(e,r){var n=this.option;!r&&Drt(n,e,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},t.prototype.resetVisual=function(e){var r=this.stateList;e=Si(e,this),this.controllerVisuals=wB(this.option.controller,r,e),this.targetVisuals=wB(this.option.target,r,e)},t.prototype.getItemSymbol=function(){return null},t.prototype.getTargetSeriesIndices=function(){var e=this.option.seriesId,r=this.option.seriesIndex;r==null&&e==null&&(r="all");var n=N0(this.ecModel,"series",{index:r,id:e},{useDefault:!1,enableAll:!0,enableNone:!1}).models;return ti(n,function(o){return o.componentIndex})},t.prototype.eachTargetSeries=function(e,r){pt(this.getTargetSeriesIndices(),function(n){var o=this.ecModel.getSeriesByIndex(n);o&&e.call(r,o)},this)},t.prototype.isTargetSeries=function(e){var r=!1;return this.eachTargetSeries(function(n){n===e&&(r=!0)}),r},t.prototype.formatValueText=function(e,r,n){var o=this.option,s=o.precision,a=this.dataBound,c=o.formatter,f;n=n||["<",">"],Ye(e)&&(e=e.slice(),f=!0);var g=r?e:f?[v(e[0]),v(e[1])]:v(e);if(wi(c))return c.replace("{value}",f?g[0]:g).replace("{value2}",f?g[1]:g);if(Xi(c))return f?c(e[0],e[1]):c(e);if(f)return e[0]===a[0]?n[0]+" "+g[1]:e[1]===a[1]?n[1]+" "+g[0]:g[0]+" - "+g[1];return g;function v(y){return y===a[0]?"min":y===a[1]?"max":(+y).toFixed(Math.min(s,20))}},t.prototype.resetExtent=function(){var e=this.option,r=uNt([e.min,e.max]);this._dataExtent=r},t.prototype.getDataDimensionIndex=function(e){var r=this.option.dimension;if(r!=null)return e.getDimensionIndex(r);for(var n=e.dimensions,o=n.length-1;o>=0;o--){var s=n[o],a=e.getDimensionInfo(s);if(!a.isCalculationCoord)return a.storeDimIndex}},t.prototype.getExtent=function(){return this._dataExtent.slice()},t.prototype.completeVisualOption=function(){var e=this.ecModel,r=this.option,n={inRange:r.inRange,outOfRange:r.outOfRange},o=r.target||(r.target={}),s=r.controller||(r.controller={});Er(o,n),Er(s,n);var a=this.isCategory();c.call(this,o),c.call(this,s),f.call(this,o,"inRange","outOfRange"),g.call(this,s);function c(v){lNt(r.color)&&!v.inRange&&(v.inRange={color:r.color.slice().reverse()}),v.inRange=v.inRange||{color:e.get("gradientColor")}}function f(v,y,w){var I=v[y],E=v[w];I&&!E&&(E=v[w]={},u7(I,function(D,R){if(_s.isValidType(R)){var z=Grt.get(R,"inactive",a);z!=null&&(E[R]=z,R==="color"&&!E.hasOwnProperty("opacity")&&!E.hasOwnProperty("colorAlpha")&&(E.opacity=[0,0]))}}))}function g(v){var y=(v.inRange||{}).symbol||(v.outOfRange||{}).symbol,w=(v.inRange||{}).symbolSize||(v.outOfRange||{}).symbolSize,I=this.get("inactiveColor"),E=this.getItemSymbol(),D=E||"roundRect";u7(this.stateList,function(R){var z=this.itemSize,N=v[R];N||(N=v[R]={color:a?I:[I]}),N.symbol==null&&(N.symbol=y&&Yi(y)||(a?D:[D])),N.symbolSize==null&&(N.symbolSize=w&&Yi(w)||(a?z[0]:[z[0],z[0]])),N.symbol=l7(N.symbol,function(Y){return Y==="none"?D:Y});var H=N.symbolSize;if(H!=null){var q=-1/0;sNt(H,function(Y){Y>q&&(q=Y)}),N.symbolSize=l7(H,function(Y){return cNt(Y,[0,q],[0,z[0]],!0)})}},this)}},t.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},t.prototype.isCategory=function(){return!!this.option.categories},t.prototype.setSelected=function(e){},t.prototype.getSelected=function(){return null},t.prototype.getValueState=function(e){return null},t.prototype.getVisualMeta=function(e){return null},t.type="visualMap",t.dependencies=["series"],t.defaultOption={show:!0,z:4,min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:ye.color.transparent,borderColor:ye.color.borderTint,contentColor:ye.color.theme[0],inactiveColor:ye.color.disabled,borderWidth:0,padding:ye.size.m,textGap:10,precision:0,textStyle:{color:ye.color.secondary}},t}(gn);const IM=hNt;var c7=[20,140],dNt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.optionUpdated=function(e,r){i.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual(function(n){n.mappingMethod="linear",n.dataExtent=this.getExtent()}),this._resetRange()},t.prototype.resetItemSize=function(){i.prototype.resetItemSize.apply(this,arguments);var e=this.itemSize;(e[0]==null||isNaN(e[0]))&&(e[0]=c7[0]),(e[1]==null||isNaN(e[1]))&&(e[1]=c7[1])},t.prototype._resetRange=function(){var e=this.getExtent(),r=this.option.range;!r||r.auto?(e.auto=1,this.option.range=e):Ye(r)&&(r[0]>r[1]&&r.reverse(),r[0]=Math.max(r[0],e[0]),r[1]=Math.min(r[1],e[1]))},t.prototype.completeVisualOption=function(){i.prototype.completeVisualOption.apply(this,arguments),pt(this.stateList,function(e){var r=this.option.controller[e].symbolSize;r&&r[0]!==r[1]&&(r[0]=r[1]/3)},this)},t.prototype.setSelected=function(e){this.option.range=e.slice(),this._resetRange()},t.prototype.getSelected=function(){var e=this.getExtent(),r=Pu((this.get("range")||[]).slice());return r[0]>e[1]&&(r[0]=e[1]),r[1]>e[1]&&(r[1]=e[1]),r[0]<e[0]&&(r[0]=e[0]),r[1]<e[0]&&(r[1]=e[0]),r},t.prototype.getValueState=function(e){var r=this.option.range,n=this.getExtent(),o=Ui(this.option.unboundedRange,!0);return(o&&r[0]<=n[0]||r[0]<=e)&&(o&&r[1]>=n[1]||e<=r[1])?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var r=[];return this.eachTargetSeries(function(n){var o=[],s=n.getData();s.each(this.getDataDimensionIndex(s),function(a,c){e[0]<=a&&a<=e[1]&&o.push(c)},this),r.push({seriesId:n.id,dataIndex:o})},this),r},t.prototype.getVisualMeta=function(e){var r=h7(this,"outOfRange",this.getExtent()),n=h7(this,"inRange",this.option.range.slice()),o=[];function s(w,I){o.push({value:w,color:e(w,I)})}for(var a=0,c=0,f=n.length,g=r.length;c<g&&(!n.length||r[c]<=n[0]);c++)r[c]<n[a]&&s(r[c],"outOfRange");for(var v=1;a<f;a++,v=0)v&&o.length&&s(n[a],"outOfRange"),s(n[a],"inRange");for(var v=1;c<g;c++)(!n.length||n[n.length-1]<r[c])&&(v&&(o.length&&s(o[o.length-1].value,"outOfRange"),v=0),s(r[c],"outOfRange"));var y=o.length;return{stops:o,outerColors:[y?o[0].color:"transparent",y?o[y-1].color:"transparent"]}},t.type="visualMap.continuous",t.defaultOption=Zp(IM.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:ye.color.neutral00,borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:ye.color.neutral00,borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:ye.color.shadow}}),t}(IM);function h7(i,t,e){if(e[0]===e[1])return e.slice();for(var r=200,n=(e[1]-e[0])/r,o=e[0],s=[],a=0;a<=r&&o<e[1];a++)s.push(o),o+=n;return s.push(e[1]),s}const fNt=dNt;var pNt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.autoPositionValues={left:1,right:1,top:1,bottom:1},e}return t.prototype.init=function(e,r){this.ecModel=e,this.api=r},t.prototype.render=function(e,r,n,o){if(this.visualMapModel=e,e.get("show")===!1){this.group.removeAll();return}this.doRender(e,r,n,o)},t.prototype.renderBackground=function(e){var r=this.visualMapModel,n=GS(r.get("padding")||0),o=e.getBoundingRect();e.add(new jr({z2:-1,silent:!0,shape:{x:o.x-n[3],y:o.y-n[0],width:o.width+n[3]+n[1],height:o.height+n[0]+n[2]},style:{fill:r.get("backgroundColor"),stroke:r.get("borderColor"),lineWidth:r.get("borderWidth")}}))},t.prototype.getControllerVisual=function(e,r,n){n=n||{};var o=n.forceState,s=this.visualMapModel,a={};if(r==="color"){var c=s.get("contentColor");a.color=c}function f(w){return a[w]}function g(w,I){a[w]=I}var v=s.controllerVisuals[o||s.getValueState(e)],y=_s.prepareVisualTypes(v);return pt(y,function(w){var I=v[w];n.convertOpacityToAlpha&&w==="opacity"&&(w="colorAlpha",I=v.__alphaForOpacity),_s.dependsOn(w,r)&&I&&I.applyVisual(e,f,g)}),a[r]},t.prototype.positionGroup=function(e){var r=this.visualMapModel,n=this.api,o=No(r,n).refContainer;yE(e,r.getBoxLayoutParams(),o)},t.prototype.doRender=function(e,r,n,o){},t.type="visualMap",t}(Oa);const Hrt=pNt;var d7=[["left","right","width"],["top","bottom","height"]];function jrt(i,t,e){var r=i.option,n=r.align;if(n!=null&&n!=="auto")return n;for(var o={width:t.getWidth(),height:t.getHeight()},s=r.orient==="horizontal"?1:0,a=d7[s],c=[0,null,10],f={},g=0;g<3;g++)f[d7[1-s][g]]=c[g],f[a[g]]=g===2?e[0]:r[a[g]];var v=[["x","width",3],["y","height",0]][s],y=Ma(f,o,r.padding);return a[(y.margin[v[2]]||0)+y[v[0]]+y[v[1]]*.5<o[v[1]]*.5?0:1]}function sC(i,t){return pt(i||[],function(e){e.dataIndex!=null&&(e.dataIndexInside=e.dataIndex,e.dataIndex=null),e.highlightKey="visualMap"+(t?t.componentIndex:"")}),i}var Qc=Rn,gNt=pt,f7=Math.min,Nk=Math.max,mNt=12,vNt=6,_Nt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._shapes={},e._dataInterval=[],e._handleEnds=[],e._hoverLinkDataIndices=[],e}return t.prototype.init=function(e,r){i.prototype.init.call(this,e,r),this._hoverLinkFromSeriesMouseOver=Si(this._hoverLinkFromSeriesMouseOver,this),this._hideIndicator=Si(this._hideIndicator,this)},t.prototype.doRender=function(e,r,n,o){(!o||o.type!=="selectDataRange"||o.from!==this.uid)&&this._buildView()},t.prototype._buildView=function(){this.group.removeAll();var e=this.visualMapModel,r=this.group;this._orient=e.get("orient"),this._useHandle=e.get("calculable"),this._resetInterval(),this._renderBar(r);var n=e.get("text");this._renderEndsText(r,n,0),this._renderEndsText(r,n,1),this._updateView(!0),this.renderBackground(r),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(r)},t.prototype._renderEndsText=function(e,r,n){if(r){var o=r[1-n];o=o!=null?o+"":"";var s=this.visualMapModel,a=s.get("textGap"),c=s.itemSize,f=this._shapes.mainGroup,g=this._applyTransform([c[0]/2,n===0?-a:c[1]+a],f),v=this._applyTransform(n===0?"bottom":"top",f),y=this._orient,w=this.visualMapModel.textStyleModel;this.group.add(new _n({style:pa(w,{x:g[0],y:g[1],verticalAlign:w.get("verticalAlign")||(y==="horizontal"?"middle":v),align:w.get("align")||(y==="horizontal"?v:"center"),text:o})}))}},t.prototype._renderBar=function(e){var r=this.visualMapModel,n=this._shapes,o=r.itemSize,s=this._orient,a=this._useHandle,c=jrt(r,this.api,o),f=n.mainGroup=this._createBarGroup(c),g=new Ki;f.add(g),g.add(n.outOfRange=p7()),g.add(n.inRange=p7(null,a?m7(this._orient):null,Si(this._dragHandle,this,"all",!1),Si(this._dragHandle,this,"all",!0))),g.setClipPath(new jr({shape:{x:0,y:0,width:o[0],height:o[1],r:3}}));var v=r.textStyleModel.getTextRect(""),y=Nk(v.width,v.height);a&&(n.handleThumbs=[],n.handleLabels=[],n.handleLabelPoints=[],this._createHandle(r,f,0,o,y,s),this._createHandle(r,f,1,o,y,s)),this._createIndicator(r,f,o,y,s),e.add(f)},t.prototype._createHandle=function(e,r,n,o,s,a){var c=Si(this._dragHandle,this,n,!1),f=Si(this._dragHandle,this,n,!0),g=yc(e.get("handleSize"),o[0]),v=To(e.get("handleIcon"),-g/2,-g/2,g,g,null,!0),y=m7(this._orient);v.attr({cursor:y,draggable:!0,drift:c,ondragend:f,onmousemove:function(R){Rd(R.event)}}),v.x=o[0]/2,v.useStyle(e.getModel("handleStyle").getItemStyle()),v.setStyle({strokeNoScale:!0,strokeFirst:!0}),v.style.lineWidth*=2,v.ensureState("emphasis").style=e.getModel(["emphasis","handleStyle"]).getItemStyle(),$m(v,!0),r.add(v);var w=this.visualMapModel.textStyleModel,I=new _n({cursor:y,draggable:!0,drift:c,onmousemove:function(R){Rd(R.event)},ondragend:f,style:pa(w,{x:0,y:0,text:""})});I.ensureState("blur").style={opacity:.1},I.stateTransition={duration:200},this.group.add(I);var E=[g,0],D=this._shapes;D.handleThumbs[n]=v,D.handleLabelPoints[n]=E,D.handleLabels[n]=I},t.prototype._createIndicator=function(e,r,n,o,s){var a=yc(e.get("indicatorSize"),n[0]),c=To(e.get("indicatorIcon"),-a/2,-a/2,a,a,null,!0);c.attr({cursor:"move",invisible:!0,silent:!0,x:n[0]/2});var f=e.getModel("indicatorStyle").getItemStyle();if(c instanceof ys){var g=c.style;c.useStyle(Ne({image:g.image,x:g.x,y:g.y,width:g.width,height:g.height},f))}else c.useStyle(f);r.add(c);var v=this.visualMapModel.textStyleModel,y=new _n({silent:!0,invisible:!0,style:pa(v,{x:0,y:0,text:""})});this.group.add(y);var w=[(s==="horizontal"?o/2:vNt)+n[0]/2,0],I=this._shapes;I.indicator=c,I.indicatorLabel=y,I.indicatorLabelPoint=w,this._firstShowIndicator=!0},t.prototype._dragHandle=function(e,r,n,o){if(this._useHandle){if(this._dragging=!r,!r){var s=this._applyTransform([n,o],this._shapes.mainGroup,!0);this._updateInterval(e,s[1]),this._hideIndicator(),this._updateView()}r===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),r?!this._hovering&&this._clearHoverLinkToSeries():g7(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[e],!1)}},t.prototype._resetInterval=function(){var e=this.visualMapModel,r=this._dataInterval=e.getSelected(),n=e.getExtent(),o=[0,e.itemSize[1]];this._handleEnds=[Qc(r[0],n,o,!0),Qc(r[1],n,o,!0)]},t.prototype._updateInterval=function(e,r){r=r||0;var n=this.visualMapModel,o=this._handleEnds,s=[0,n.itemSize[1]];Np(r,o,s,e,0);var a=n.getExtent();this._dataInterval=[Qc(o[0],s,a,!0),Qc(o[1],s,a,!0)]},t.prototype._updateView=function(e){var r=this.visualMapModel,n=r.getExtent(),o=this._shapes,s=[0,r.itemSize[1]],a=e?s:this._handleEnds,c=this._createBarVisual(this._dataInterval,n,a,"inRange"),f=this._createBarVisual(n,n,s,"outOfRange");o.inRange.setStyle({fill:c.barColor}).setShape("points",c.barPoints),o.outOfRange.setStyle({fill:f.barColor}).setShape("points",f.barPoints),this._updateHandle(a,c)},t.prototype._createBarVisual=function(e,r,n,o){var s={forceState:o,convertOpacityToAlpha:!0},a=this._makeColorGradient(e,s),c=[this.getControllerVisual(e[0],"symbolSize",s),this.getControllerVisual(e[1],"symbolSize",s)],f=this._createBarPoints(n,c);return{barColor:new U0(0,0,0,1,a),barPoints:f,handlesColor:[a[0].color,a[a.length-1].color]}},t.prototype._makeColorGradient=function(e,r){var n=100,o=[],s=(e[1]-e[0])/n;o.push({color:this.getControllerVisual(e[0],"color",r),offset:0});for(var a=1;a<n;a++){var c=e[0]+s*a;if(c>e[1])break;o.push({color:this.getControllerVisual(c,"color",r),offset:a/n})}return o.push({color:this.getControllerVisual(e[1],"color",r),offset:1}),o},t.prototype._createBarPoints=function(e,r){var n=this.visualMapModel.itemSize;return[[n[0]-r[0],e[0]],[n[0],e[0]],[n[0],e[1]],[n[0]-r[1],e[1]]]},t.prototype._createBarGroup=function(e){var r=this._orient,n=this.visualMapModel.get("inverse");return new Ki(r==="horizontal"&&!n?{scaleX:e==="bottom"?1:-1,rotation:Math.PI/2}:r==="horizontal"&&n?{scaleX:e==="bottom"?-1:1,rotation:-Math.PI/2}:r==="vertical"&&!n?{scaleX:e==="left"?1:-1,scaleY:-1}:{scaleX:e==="left"?1:-1})},t.prototype._updateHandle=function(e,r){if(this._useHandle){var n=this._shapes,o=this.visualMapModel,s=n.handleThumbs,a=n.handleLabels,c=o.itemSize,f=o.getExtent(),g=this._applyTransform("left",n.mainGroup);gNt([0,1],function(v){var y=s[v];y.setStyle("fill",r.handlesColor[v]),y.y=e[v];var w=Qc(e[v],[0,c[1]],f,!0),I=this.getControllerVisual(w,"symbolSize");y.scaleX=y.scaleY=I/c[0],y.x=c[0]-I/2;var E=pc(n.handleLabelPoints[v],uv(y,this.group));if(this._orient==="horizontal"){var D=g==="left"||g==="top"?(c[0]-I)/2:(c[0]-I)/-2;E[1]+=D}a[v].setStyle({x:E[0],y:E[1],text:o.formatValueText(this._dataInterval[v]),verticalAlign:"middle",align:this._orient==="vertical"?this._applyTransform("left",n.mainGroup):"center"})},this)}},t.prototype._showIndicator=function(e,r,n,o){var s=this.visualMapModel,a=s.getExtent(),c=s.itemSize,f=[0,c[1]],g=this._shapes,v=g.indicator;if(v){v.attr("invisible",!1);var y={convertOpacityToAlpha:!0},w=this.getControllerVisual(e,"color",y),I=this.getControllerVisual(e,"symbolSize"),E=Qc(e,a,f,!0),D=c[0]-I/2,R={x:v.x,y:v.y};v.y=E,v.x=D;var z=pc(g.indicatorLabelPoint,uv(v,this.group)),N=g.indicatorLabel;N.attr("invisible",!1);var H=this._applyTransform("left",g.mainGroup),q=this._orient,Y=q==="horizontal";N.setStyle({text:(n||"")+s.formatValueText(r),verticalAlign:Y?H:"middle",align:Y?"center":H});var J={x:D,y:E,style:{fill:w}},it={style:{x:z[0],y:z[1]}};if(s.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var at={duration:100,easing:"cubicInOut",additive:!0};v.x=R.x,v.y=R.y,v.animateTo(J,at),N.animateTo(it,at)}else v.attr(J),N.attr(it);this._firstShowIndicator=!1;var ut=this._shapes.handleLabels;if(ut)for(var ft=0;ft<ut.length;ft++)this.api.enterBlur(ut[ft])}},t.prototype._enableHoverLinkToSeries=function(){var e=this;this._shapes.mainGroup.on("mousemove",function(r){if(e._hovering=!0,!e._dragging){var n=e.visualMapModel.itemSize,o=e._applyTransform([r.offsetX,r.offsetY],e._shapes.mainGroup,!0,!0);o[1]=f7(Nk(0,o[1]),n[1]),e._doHoverLinkToSeries(o[1],0<=o[0]&&o[0]<=n[0])}}).on("mouseout",function(){e._hovering=!1,!e._dragging&&e._clearHoverLinkToSeries()})},t.prototype._enableHoverLinkFromSeries=function(){var e=this.api.getZr();this.visualMapModel.option.hoverLink?(e.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),e.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},t.prototype._doHoverLinkToSeries=function(e,r){var n=this.visualMapModel,o=n.itemSize;if(n.option.hoverLink){var s=[0,o[1]],a=n.getExtent();e=f7(Nk(s[0],e),s[1]);var c=yNt(n,a,s),f=[e-c,e+c],g=Qc(e,s,a,!0),v=[Qc(f[0],s,a,!0),Qc(f[1],s,a,!0)];f[0]<s[0]&&(v[0]=-1/0),f[1]>s[1]&&(v[1]=1/0),r&&(v[0]===-1/0?this._showIndicator(g,v[1],"< ",c):v[1]===1/0?this._showIndicator(g,v[0],"> ",c):this._showIndicator(g,g," ",c));var y=this._hoverLinkDataIndices,w=[];(r||g7(n))&&(w=this._hoverLinkDataIndices=n.findTargetDataIndices(v));var I=Gyt(y,w);this._dispatchHighDown("downplay",sC(I[0],n)),this._dispatchHighDown("highlight",sC(I[1],n))}},t.prototype._hoverLinkFromSeriesMouseOver=function(e){var r;if(Xm(e.target,function(c){var f=cr(c);if(f.dataIndex!=null)return r=f,!0},!0),!!r){var n=this.ecModel.getSeriesByIndex(r.seriesIndex),o=this.visualMapModel;if(o.isTargetSeries(n)){var s=n.getData(r.dataType),a=s.getStore().get(o.getDataDimensionIndex(s),r.dataIndex);isNaN(a)||this._showIndicator(a,a)}}},t.prototype._hideIndicator=function(){var e=this._shapes;e.indicator&&e.indicator.attr("invisible",!0),e.indicatorLabel&&e.indicatorLabel.attr("invisible",!0);var r=this._shapes.handleLabels;if(r)for(var n=0;n<r.length;n++)this.api.leaveBlur(r[n])},t.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var e=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",sC(e,this.visualMapModel)),e.length=0},t.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var e=this.api.getZr();e.off("mouseover",this._hoverLinkFromSeriesMouseOver),e.off("mouseout",this._hideIndicator)},t.prototype._applyTransform=function(e,r,n,o){var s=uv(r,o?null:this.group);return Ye(e)?pc(e,s,n):gE(e,s,n)},t.prototype._dispatchHighDown=function(e,r){r&&r.length&&this.api.dispatchAction({type:e,batch:r})},t.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},t.type="visualMap.continuous",t}(Hrt);function p7(i,t,e,r){return new gl({shape:{points:i},draggable:!!e,cursor:t,drift:e,onmousemove:function(n){Rd(n.event)},ondragend:r})}function yNt(i,t,e){var r=mNt/2,n=i.get("hoverLinkDataSize");return n&&(r=Qc(n,t,e,!0)/2),r}function g7(i){var t=i.get("hoverLinkOnHandle");return!!(t??i.get("realtime"))}function m7(i){return i==="vertical"?"ns-resize":"ew-resize"}const xNt=_Nt;var bNt={type:"selectDataRange",event:"dataRangeSelected",update:"update"},wNt=function(i,t){t.eachComponent({mainType:"visualMap",query:i},function(e){e.setSelected(i.selected)})},SNt=[{createOnAllSeries:!0,reset:function(i,t){var e=[];return t.eachComponent("visualMap",function(r){var n=i.pipelineContext;!r.isTargetSeries(i)||n&&n.large||e.push(mFt(r.stateList,r.targetVisuals,Si(r.getValueState,r),r.getDataDimensionIndex(i.getData())))}),e}},{createOnAllSeries:!0,reset:function(i,t){var e=i.getData(),r=[];t.eachComponent("visualMap",function(n){if(n.isTargetSeries(i)){var o=n.getVisualMeta(Si(TNt,null,i,n))||{stops:[],outerColors:[]},s=n.getDataDimensionIndex(e);s>=0&&(o.dimension=s,r.push(o))}}),i.getData().setVisual("visualMeta",r)}}];function TNt(i,t,e,r){for(var n=t.targetVisuals[r],o=_s.prepareVisualTypes(n),s={color:WS(i.getData(),"color")},a=0,c=o.length;a<c;a++){var f=o[a],g=n[f==="opacity"?"__alphaForOpacity":f];g&&g.applyVisual(e,v,y)}return s.color;function v(w){return s[w]}function y(w,I){s[w]=I}}var v7=pt;function ANt(i){var t=i&&i.visualMap;Ye(t)||(t=t?[t]:[]),v7(t,function(e){if(e){Vy(e,"splitList")&&!Vy(e,"pieces")&&(e.pieces=e.splitList,delete e.splitList);var r=e.pieces;r&&Ye(r)&&v7(r,function(n){nr(n)&&(Vy(n,"start")&&!Vy(n,"min")&&(n.min=n.start),Vy(n,"end")&&!Vy(n,"max")&&(n.max=n.end))})}})}function Vy(i,t){return i&&i.hasOwnProperty&&i.hasOwnProperty(t)}var _7=!1;function Wrt(i){_7||(_7=!0,i.registerSubTypeDefaulter("visualMap",function(t){return!t.categories&&(!(t.pieces?t.pieces.length>0:t.splitNumber>0)||t.calculable)?"continuous":"piecewise"}),i.registerAction(bNt,wNt),pt(SNt,function(t){i.registerVisual(i.PRIORITY.VISUAL.COMPONENT,t)}),i.registerPreprocessor(ANt))}function $rt(i){i.registerComponentModel(fNt),i.registerComponentView(xNt),Wrt(i)}var INt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e._pieceList=[],e}return t.prototype.optionUpdated=function(e,r){i.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var n=this._mode=this._determineMode();this._pieceList=[],CNt[this._mode].call(this,this._pieceList),this._resetSelected(e,r);var o=this.option.categories;this.resetVisual(function(s,a){n==="categories"?(s.mappingMethod="category",s.categories=Yi(o)):(s.dataExtent=this.getExtent(),s.mappingMethod="piecewise",s.pieceList=ti(this._pieceList,function(c){return c=Yi(c),a!=="inRange"&&(c.visual=null),c}))})},t.prototype.completeVisualOption=function(){var e=this.option,r={},n=_s.listVisualTypes(),o=this.isCategory();pt(e.pieces,function(a){pt(n,function(c){a.hasOwnProperty(c)&&(r[c]=1)})}),pt(r,function(a,c){var f=!1;pt(this.stateList,function(g){f=f||s(e,g,c)||s(e.target,g,c)},this),!f&&pt(this.stateList,function(g){(e[g]||(e[g]={}))[c]=Grt.get(c,g==="inRange"?"active":"inactive",o)})},this);function s(a,c,f){return a&&a[c]&&a[c].hasOwnProperty(f)}i.prototype.completeVisualOption.apply(this,arguments)},t.prototype._resetSelected=function(e,r){var n=this.option,o=this._pieceList,s=(r?n:e).selected||{};if(n.selected=s,pt(o,function(c,f){var g=this.getSelectedMapKey(c);s.hasOwnProperty(g)||(s[g]=!0)},this),n.selectedMode==="single"){var a=!1;pt(o,function(c,f){var g=this.getSelectedMapKey(c);s[g]&&(a?s[g]=!1:a=!0)},this)}},t.prototype.getItemSymbol=function(){return this.get("itemSymbol")},t.prototype.getSelectedMapKey=function(e){return this._mode==="categories"?e.value+"":e.index+""},t.prototype.getPieceList=function(){return this._pieceList},t.prototype._determineMode=function(){var e=this.option;return e.pieces&&e.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},t.prototype.setSelected=function(e){this.option.selected=Yi(e)},t.prototype.getValueState=function(e){var r=_s.findPieceIndex(e,this._pieceList);return r!=null&&this.option.selected[this.getSelectedMapKey(this._pieceList[r])]?"inRange":"outOfRange"},t.prototype.findTargetDataIndices=function(e){var r=[],n=this._pieceList;return this.eachTargetSeries(function(o){var s=[],a=o.getData();a.each(this.getDataDimensionIndex(a),function(c,f){var g=_s.findPieceIndex(c,n);g===e&&s.push(f)},this),r.push({seriesId:o.id,dataIndex:s})},this),r},t.prototype.getRepresentValue=function(e){var r;if(this.isCategory())r=e.value;else if(e.value!=null)r=e.value;else{var n=e.interval||[];r=n[0]===-1/0&&n[1]===1/0?0:(n[0]+n[1])/2}return r},t.prototype.getVisualMeta=function(e){if(this.isCategory())return;var r=[],n=["",""],o=this;function s(g,v){var y=o.getRepresentValue({interval:g});v||(v=o.getValueState(y));var w=e(y,v);g[0]===-1/0?n[0]=w:g[1]===1/0?n[1]=w:r.push({value:g[0],color:w},{value:g[1],color:w})}var a=this._pieceList.slice();if(!a.length)a.push({interval:[-1/0,1/0]});else{var c=a[0].interval[0];c!==-1/0&&a.unshift({interval:[-1/0,c]}),c=a[a.length-1].interval[1],c!==1/0&&a.push({interval:[c,1/0]})}var f=-1/0;return pt(a,function(g){var v=g.interval;v&&(v[0]>f&&s([f,v[0]],"outOfRange"),s(v.slice()),f=v[1])},this),{stops:r,outerColors:n}},t.type="visualMap.piecewise",t.defaultOption=Zp(IM.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),t}(IM),CNt={splitNumber:function(i){var t=this.option,e=Math.min(t.precision,20),r=this.getExtent(),n=t.splitNumber;n=Math.max(parseInt(n,10),1),t.splitNumber=n;for(var o=(r[1]-r[0])/n;+o.toFixed(e)!==o&&e<5;)e++;t.precision=e,o=+o.toFixed(e),t.minOpen&&i.push({interval:[-1/0,r[0]],close:[0,0]});for(var s=0,a=r[0];s<n;a+=o,s++){var c=s===n-1?r[1]:a+o;i.push({interval:[a,c],close:[1,1]})}t.maxOpen&&i.push({interval:[r[1],1/0],close:[0,0]}),BH(i),pt(i,function(f,g){f.index=g,f.text=this.formatValueText(f.interval)},this)},categories:function(i){var t=this.option;pt(t.categories,function(e){i.push({text:this.formatValueText(e,!0),value:e})},this),y7(t,i)},pieces:function(i){var t=this.option;pt(t.pieces,function(e,r){nr(e)||(e={value:e});var n={text:"",index:r};if(e.label!=null&&(n.text=e.label),e.hasOwnProperty("value")){var o=n.value=e.value;n.interval=[o,o],n.close=[1,1]}else{for(var s=n.interval=[],a=n.close=[0,0],c=[1,0,1],f=[-1/0,1/0],g=[],v=0;v<2;v++){for(var y=[["gte","gt","min"],["lte","lt","max"]][v],w=0;w<3&&s[v]==null;w++)s[v]=e[y[w]],a[v]=c[w],g[v]=w===2;s[v]==null&&(s[v]=f[v])}g[0]&&s[1]===1/0&&(a[0]=0),g[1]&&s[0]===-1/0&&(a[1]=0),s[0]===s[1]&&a[0]&&a[1]&&(n.value=s[0])}n.visual=_s.retrieveVisuals(e),i.push(n)},this),y7(t,i),BH(i),pt(i,function(e){var r=e.close,n=[["<",""][r[1]],[">",""][r[0]]];e.text=e.text||this.formatValueText(e.value!=null?e.value:e.interval,!1,n)},this)}};function y7(i,t){var e=i.inverse;(i.orient==="vertical"?!e:e)&&t.reverse()}const MNt=INt;var ENt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.doRender=function(){var e=this.group;e.removeAll();var r=this.visualMapModel,n=r.get("textGap"),o=r.textStyleModel,s=this._getItemAlign(),a=r.itemSize,c=this._getViewData(),f=c.endsText,g=vs(r.get("showLabel",!0),!f),v=!r.get("selectedMode");f&&this._renderEndsText(e,f[0],a,g,s),pt(c.viewPieceList,function(y){var w=y.piece,I=new Ki;I.onclick=Si(this._onItemClick,this,w),this._enableHoverLink(I,y.indexInModelPieceList);var E=r.getRepresentValue(w);if(this._createItemSymbol(I,E,[0,0,a[0],a[1]],v),g){var D=this.visualMapModel.getValueState(E),R=o.get("align")||s;I.add(new _n({style:pa(o,{x:R==="right"?-n:a[0]+n,y:a[1]/2,text:w.text,verticalAlign:o.get("verticalAlign")||"middle",align:R,opacity:Ui(o.get("opacity"),D==="outOfRange"?.5:1)}),silent:v}))}e.add(I)},this),f&&this._renderEndsText(e,f[1],a,g,s),cv(r.get("orient"),e,r.get("itemGap")),this.renderBackground(e),this.positionGroup(e)},t.prototype._enableHoverLink=function(e,r){var n=this;e.on("mouseover",function(){return o("highlight")}).on("mouseout",function(){return o("downplay")});var o=function(s){var a=n.visualMapModel;a.option.hoverLink&&n.api.dispatchAction({type:s,batch:sC(a.findTargetDataIndices(r),a)})}},t.prototype._getItemAlign=function(){var e=this.visualMapModel,r=e.option;if(r.orient==="vertical")return jrt(e,this.api,e.itemSize);var n=r.align;return(!n||n==="auto")&&(n="left"),n},t.prototype._renderEndsText=function(e,r,n,o,s){if(r){var a=new Ki,c=this.visualMapModel.textStyleModel;a.add(new _n({style:pa(c,{x:o?s==="right"?n[0]:0:n[0]/2,y:n[1]/2,verticalAlign:"middle",align:o?s:"center",text:r})})),e.add(a)}},t.prototype._getViewData=function(){var e=this.visualMapModel,r=ti(e.getPieceList(),function(a,c){return{piece:a,indexInModelPieceList:c}}),n=e.get("text"),o=e.get("orient"),s=e.get("inverse");return(o==="horizontal"?s:!s)?r.reverse():n&&(n=n.slice().reverse()),{viewPieceList:r,endsText:n}},t.prototype._createItemSymbol=function(e,r,n,o){var s=To(this.getControllerVisual(r,"symbol"),n[0],n[1],n[2],n[3],this.getControllerVisual(r,"color"));s.silent=o,e.add(s)},t.prototype._onItemClick=function(e){var r=this.visualMapModel,n=r.option,o=n.selectedMode;if(o){var s=Yi(n.selected),a=r.getSelectedMapKey(e);o==="single"||o===!0?(s[a]=!0,pt(s,function(c,f){s[f]=f===a})):s[a]=!s[a],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:s})}},t.type="visualMap.piecewise",t}(Hrt);const DNt=ENt;function Zrt(i){i.registerComponentModel(MNt),i.registerComponentView(DNt),Wrt(i)}function PNt(i){Rr($rt),Rr(Zrt)}var LNt=function(){function i(t){this._thumbnailModel=t}return i.prototype.reset=function(t){this._renderVersion=t.getMainProcessVersion()},i.prototype.renderContent=function(t){var e=t.api.getViewOfComponentModel(this._thumbnailModel);e&&(t.group.silent=!0,e.renderContent({group:t.group,targetTrans:t.targetTrans,z2Range:aJ(t.group),roamType:t.roamType,viewportRect:t.viewportRect,renderVersion:this._renderVersion}))},i.prototype.updateWindow=function(t,e){var r=e.getViewOfComponentModel(this._thumbnailModel);r&&r.updateWindow({targetTrans:t,renderVersion:this._renderVersion})},i}(),RNt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e.preventAutoZ=!0,e}return t.prototype.optionUpdated=function(e,r){this._updateBridge()},t.prototype._updateBridge=function(){var e=this._birdge=this._birdge||new LNt(this);if(this._target=null,this.ecModel.eachSeries(function(n){H$(n,null)}),this.shouldShow()){var r=this.getTarget();H$(r.baseMapProvider,e)}},t.prototype.shouldShow=function(){return this.getShallow("show",!0)},t.prototype.getBridge=function(){return this._birdge},t.prototype.getTarget=function(){if(this._target)return this._target;var e=this.getReferringComponents("series",{useDefault:!1,enableAll:!1,enableNone:!1}).models[0];return e?e.subType!=="graph"&&(e=null):e=this.ecModel.queryComponents({mainType:"series",subType:"graph"})[0],this._target={baseMapProvider:e},this._target},t.type="thumbnail",t.layoutMode="box",t.dependencies=["series","geo"],t.defaultOption={show:!0,right:1,bottom:1,height:"25%",width:"25%",itemStyle:{borderColor:ye.color.border,borderWidth:2},windowStyle:{borderWidth:1,color:ye.color.neutral30,borderColor:ye.color.neutral40,opacity:.3},z:10},t}(gn),kNt=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.render=function(e,r,n){if(this._api=n,this._model=e,this._coordSys||(this._coordSys=new Fv),!this._isEnabled()){this._clear();return}this._renderVersion=n.getMainProcessVersion();var o=this.group;o.removeAll();var s=e.getModel("itemStyle"),a=s.getItemStyle();a.fill==null&&(a.fill=r.get("backgroundColor")||ye.color.neutral00);var c=No(e,n).refContainer,f=Ma(MJ(e,!0),c),g=a.lineWidth||0,v=this._contentRect=xv(f.clone(),g/2,!0,!0),y=new Ki;o.add(y),y.setClipPath(new jr({shape:v.plain()}));var w=this._targetGroup=new Ki;y.add(w);var I=f.plain();I.r=s.getShallow("borderRadius",!0),o.add(this._bgRect=new jr({style:a,shape:I,silent:!1,cursor:"grab"}));var E=e.getModel("windowStyle"),D=E.getShallow("borderRadius",!0);y.add(this._windowRect=new jr({shape:{x:0,y:0,width:0,height:0,r:D},style:E.getItemStyle(),silent:!1,cursor:"grab"})),this._dealRenderContent(),this._dealUpdateWindow(),b7(e,this)},t.prototype.renderContent=function(e){this._bridgeRendered=e,this._isEnabled()&&(this._dealRenderContent(),this._dealUpdateWindow(),b7(this._model,this))},t.prototype._dealRenderContent=function(){var e=this._bridgeRendered;if(!(!e||e.renderVersion!==this._renderVersion)){var r=this._targetGroup,n=this._coordSys,o=this._contentRect;if(r.removeAll(),!!e){var s=e.group,a=s.getBoundingRect();r.add(s),this._bgRect.z2=e.z2Range.min-10,n.setBoundingRect(a.x,a.y,a.width,a.height);var c=Ma({left:"center",top:"center",aspect:a.width/a.height},o);n.setViewRect(c.x,c.y,c.width,c.height),s.attr(n.getTransformInfo().raw),this._windowRect.z2=e.z2Range.max+10,this._resetRoamController(e.roamType)}}},t.prototype.updateWindow=function(e){var r=this._bridgeRendered;r&&r.renderVersion===e.renderVersion&&(r.targetTrans=e.targetTrans),this._isEnabled()&&this._dealUpdateWindow()},t.prototype._dealUpdateWindow=function(){var e=this._bridgeRendered;if(!(!e||e.renderVersion!==this._renderVersion)){var r=_c([],e.targetTrans),n=ph([],this._coordSys.transform,r);this._transThisToTarget=_c([],n);var o=e.viewportRect;o?o=o.clone():o=new sr(0,0,this._api.getWidth(),this._api.getHeight()),o.applyTransform(n);var s=this._windowRect,a=s.shape.r;s.setShape(rr({r:a},o))}},t.prototype._resetRoamController=function(e){var r=this,n=this._api,o=this._roamController;if(o||(o=this._roamController=new Bv(n.getZr())),!e||!this._isEnabled()){o.disable();return}o.enable(e,{api:n,zInfo:{component:this._model},triggerInfo:{roamTrigger:null,isInSelf:function(s,a,c){return r._contentRect.contain(a,c)}}}),o.off("pan").off("zoom").on("pan",Si(this._onPan,this)).on("zoom",Si(this._onZoom,this))},t.prototype._onPan=function(e){var r=this._transThisToTarget;if(!(!this._isEnabled()||!r)){var n=fo([],[e.oldX,e.oldY],r),o=fo([],[e.oldX-e.dx,e.oldY-e.dy],r);this._api.dispatchAction(x7(this._model.getTarget().baseMapProvider,{dx:o[0]-n[0],dy:o[1]-n[1]}))}},t.prototype._onZoom=function(e){var r=this._transThisToTarget;if(!(!this._isEnabled()||!r)){var n=fo([],[e.originX,e.originY],r);this._api.dispatchAction(x7(this._model.getTarget().baseMapProvider,{zoom:1/e.scale,originX:n[0],originY:n[1]}))}},t.prototype._isEnabled=function(){var e=this._model;if(!e||!e.shouldShow())return!1;var r=e.getTarget().baseMapProvider;return!!r},t.prototype._clear=function(){this.group.removeAll(),this._bridgeRendered=null,this._roamController&&this._roamController.disable()},t.prototype.remove=function(){this._clear()},t.prototype.dispose=function(){this._clear()},t.type="thumbnail",t}(Oa);function x7(i,t){var e=i.mainType==="series"?i.subType+"Roam":i.mainType+"Roam",r={type:e};return r[i.mainType+"Id"]=i.id,Ne(r,t),r}function b7(i,t){var e=bv(i);mE(t.group,e.z,e.zlevel)}function ONt(i){i.registerComponentModel(RNt),i.registerComponentView(kNt)}var zNt={label:{enabled:!0},decal:{show:!1}},w7=Wr(),BNt={};function FNt(i,t){var e=i.getModel("aria");if(!e.get("enabled"))return;var r=Yi(zNt);Er(r.label,i.getLocaleModel().get("aria"),!1),Er(e.option,r,!1),n(),o();function n(){var f=e.getModel("decal"),g=f.get("show");if(g){var v=Fi();i.eachSeries(function(y){if(!y.isColorBySeries()){var w=v.get(y.type);w||(w={},v.set(y.type,w)),w7(y).scope=w}}),i.eachRawSeries(function(y){if(i.isSeriesFiltered(y))return;if(Xi(y.enableAriaDecal)){y.enableAriaDecal();return}var w=y.getData();if(y.isColorBySeries()){var z=vz(y.ecModel,y.name,BNt,i.getSeriesCount()),N=w.getVisual("decal");w.setVisual("decal",H(N,z))}else{var I=y.getRawData(),E={},D=w7(y).scope;w.each(function(q){var Y=w.getRawIndex(q);E[Y]=q});var R=I.count();I.each(function(q){var Y=E[q],J=I.getName(q)||q+"",it=vz(y.ecModel,J,D,R),at=w.getItemVisual(Y,"decal");w.setItemVisual(Y,"decal",H(at,it))})}function H(q,Y){var J=q?Ne(Ne({},Y),q):Y;return J.dirty=!0,J}})}}function o(){var f=t.getZr().dom;if(f){var g=i.getLocaleModel().get("aria"),v=e.getModel("label");if(v.option=rr(v.option,g),!!v.get("enabled")){if(f.setAttribute("role","img"),v.get("description")){f.setAttribute("aria-label",v.get("description"));return}var y=i.getSeriesCount(),w=v.get(["data","maxCount"])||10,I=v.get(["series","maxCount"])||10,E=Math.min(y,I),D;if(!(y<1)){var R=a();if(R){var z=v.get(["general","withTitle"]);D=s(z,{title:R})}else D=v.get(["general","withoutTitle"]);var N=[],H=y>1?v.get(["series","multiple","prefix"]):v.get(["series","single","prefix"]);D+=s(H,{seriesCount:y}),i.eachSeries(function(it,at){if(at<E){var ut=void 0,ft=it.get("name"),_t=ft?"withName":"withoutName";ut=y>1?v.get(["series","multiple",_t]):v.get(["series","single",_t]),ut=s(ut,{seriesId:it.seriesIndex,seriesName:it.get("name"),seriesType:c(it.subType)});var ct=it.getData();if(ct.count()>w){var Dt=v.get(["data","partialData"]);ut+=s(Dt,{displayCnt:w})}else ut+=v.get(["data","allData"]);for(var Et=v.get(["data","separator","middle"]),bt=v.get(["data","separator","end"]),Vt=v.get(["data","excludeDimensionId"]),zt=[],Jt=0;Jt<ct.count();Jt++)if(Jt<w){var ce=ct.getName(Jt),be=Vt?kn(ct.getValues(Jt),function(ke,ni){return Ar(Vt,ni)===-1}):ct.getValues(Jt),ve=v.get(["data",ce?"withName":"withoutName"]);zt.push(s(ve,{name:ce,value:be.join(Et)}))}ut+=zt.join(Et)+bt,N.push(ut)}});var q=v.getModel(["series","multiple","separator"]),Y=q.get("middle"),J=q.get("end");D+=N.join(Y)+J,f.setAttribute("aria-label",D)}}}}function s(f,g){if(!wi(f))return f;var v=f;return pt(g,function(y,w){v=v.replace(new RegExp("\\{\\s*"+w+"\\s*\\}","g"),y)}),v}function a(){var f=i.get("title");return f&&f.length&&(f=f[0]),f&&f.text}function c(f){var g=i.getLocaleModel().get(["series","typeNames"]);return g[f]||g.chart}}function NNt(i){if(!(!i||!i.aria)){var t=i.aria;t.show!=null&&(t.enabled=t.show),t.label=t.label||{},pt(["description","general","series","data"],function(e){t[e]!=null&&(t.label[e]=t[e])})}}function VNt(i){i.registerPreprocessor(NNt),i.registerVisual(i.PRIORITY.VISUAL.ARIA,FNt)}var S7={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},UNt=function(){function i(t){var e=this._condVal=wi(t)?new RegExp(t):jvt(t)?t:null;if(e==null){var r="";Pn(r)}}return i.prototype.evaluate=function(t){var e=typeof t;return wi(e)?this._condVal.test(t):fn(e)?this._condVal.test(t+""):!1},i}(),GNt=function(){function i(){}return i.prototype.evaluate=function(){return this.value},i}(),HNt=function(){function i(){}return i.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(!t[e].evaluate())return!1;return!0},i}(),jNt=function(){function i(){}return i.prototype.evaluate=function(){for(var t=this.children,e=0;e<t.length;e++)if(t[e].evaluate())return!0;return!1},i}(),WNt=function(){function i(){}return i.prototype.evaluate=function(){return!this.child.evaluate()},i}(),$Nt=function(){function i(){}return i.prototype.evaluate=function(){for(var t=!!this.valueParser,e=this.getValue,r=e(this.valueGetterParam),n=t?this.valueParser(r):null,o=0;o<this.subCondList.length;o++)if(!this.subCondList[o].evaluate(t?n:r))return!1;return!0},i}();function FN(i,t){if(i===!0||i===!1){var e=new GNt;return e.value=i,e}var r="";return qrt(i)||Pn(r),i.and?T7("and",i,t):i.or?T7("or",i,t):i.not?ZNt(i,t):qNt(i,t)}function T7(i,t,e){var r=t[i],n="";Ye(r)||Pn(n),r.length||Pn(n);var o=i==="and"?new HNt:new jNt;return o.children=ti(r,function(s){return FN(s,e)}),o.children.length||Pn(n),o}function ZNt(i,t){var e=i.not,r="";qrt(e)||Pn(r);var n=new WNt;return n.child=FN(e,t),n.child||Pn(r),n}function qNt(i,t){for(var e="",r=t.prepareGetValue(i),n=[],o=on(i),s=i.parser,a=s?JJ(s):null,c=0;c<o.length;c++){var f=o[c];if(!(f==="parser"||t.valueGetterAttrMap.get(f))){var g=Pi(S7,f)?S7[f]:f,v=i[f],y=a?a(v):v,w=pbt(g,y)||g==="reg"&&new UNt(y);w||Pn(e),n.push(w)}}n.length||Pn(e);var I=new $Nt;return I.valueGetterParam=r,I.valueParser=a,I.getValue=t.getValue,I.subCondList=n,I}function qrt(i){return nr(i)&&!Ns(i)}var XNt=function(){function i(t,e){this._cond=FN(t,e)}return i.prototype.evaluate=function(){return this._cond.evaluate()},i}();function YNt(i,t){return new XNt(i,t)}var KNt={type:"echarts:filter",transform:function(i){for(var t=i.upstream,e,r=YNt(i.config,{valueGetterAttrMap:Fi({dimension:!0}),prepareGetValue:function(a){var c="",f=a.dimension;Pi(a,"dimension")||Pn(c);var g=t.getDimensionInfo(f);return g||Pn(c),{dimIdx:g.index}},getValue:function(a){return t.retrieveValueFromItem(e,a.dimIdx)}}),n=[],o=0,s=t.count();o<s;o++)e=t.getRawDataItem(o),r.evaluate()&&n.push(e);return{data:n}}},JNt={type:"echarts:sort",transform:function(i){var t=i.upstream,e=i.config,r="",n=aa(e);n.length||Pn(r);var o=[];pt(n,function(g){var v=g.dimension,y=g.order,w=g.parser,I=g.incomparable;if(v==null&&Pn(r),y!=="asc"&&y!=="desc"&&Pn(r),I&&I!=="min"&&I!=="max"){var E="";Pn(E)}if(y!=="asc"&&y!=="desc"){var D="";Pn(D)}var R=t.getDimensionInfo(v);R||Pn(r);var z=w?JJ(w):null;w&&!z&&Pn(r),o.push({dimIdx:R.index,parser:z,comparator:new tQ(y,I)})});var s=t.sourceFormat;s!==ss&&s!==au&&Pn(r);for(var a=[],c=0,f=t.count();c<f;c++)a.push(t.getRawDataItem(c));return a.sort(function(g,v){for(var y=0;y<o.length;y++){var w=o[y],I=t.retrieveValueFromItem(g,w.dimIdx),E=t.retrieveValueFromItem(v,w.dimIdx);w.parser&&(I=w.parser(I),E=w.parser(E));var D=w.comparator.evaluate(I,E);if(D!==0)return D}return 0}),{data:a}}};function QNt(i){i.registerTransform(KNt),i.registerTransform(JNt)}var t5t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="dataset",e}return t.prototype.init=function(e,r,n){i.prototype.init.call(this,e,r,n),this._sourceManager=new nQ(this),Qj(this)},t.prototype.mergeOption=function(e,r){i.prototype.mergeOption.call(this,e,r),Qj(this)},t.prototype.optionUpdated=function(){this._sourceManager.dirty()},t.prototype.getSourceManager=function(){return this._sourceManager},t.type="dataset",t.defaultOption={seriesLayoutBy:gc},t}(gn),e5t=function(i){Se(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.type="dataset",e}return t.type="dataset",t}(Oa);function i5t(i){i.registerComponentModel(t5t),i.registerComponentView(e5t)}var Yc=Sh.CMD;function e0(i,t){return Math.abs(i-t)<1e-5}function EB(i){var t=i.data,e=i.len(),r=[],n,o=0,s=0,a=0,c=0;function f(ct,Dt){n&&n.length>2&&r.push(n),n=[ct,Dt]}function g(ct,Dt,Et,bt){e0(ct,Et)&&e0(Dt,bt)||n.push(ct,Dt,Et,bt,Et,bt)}function v(ct,Dt,Et,bt,Vt,zt){var Jt=Math.abs(Dt-ct),ce=Math.tan(Jt/4)*4/3,be=Dt<ct?-1:1,ve=Math.cos(ct),ke=Math.sin(ct),ni=Math.cos(Dt),bi=Math.sin(Dt),or=ve*Vt+Et,Ue=ke*zt+bt,Ze=ni*Vt+Et,xe=bi*zt+bt,Ke=Vt*ce*be,We=zt*ce*be;n.push(or-Ke*ke,Ue+We*ve,Ze+Ke*bi,xe-We*ni,Ze,xe)}for(var y,w,I,E,D=0;D<e;){var R=t[D++],z=D===1;switch(z&&(o=t[D],s=t[D+1],a=o,c=s,(R===Yc.L||R===Yc.C||R===Yc.Q)&&(n=[a,c])),R){case Yc.M:o=a=t[D++],s=c=t[D++],f(a,c);break;case Yc.L:y=t[D++],w=t[D++],g(o,s,y,w),o=y,s=w;break;case Yc.C:n.push(t[D++],t[D++],t[D++],t[D++],o=t[D++],s=t[D++]);break;case Yc.Q:y=t[D++],w=t[D++],I=t[D++],E=t[D++],n.push(o+2/3*(y-o),s+2/3*(w-s),I+2/3*(y-I),E+2/3*(w-E),I,E),o=I,s=E;break;case Yc.A:var N=t[D++],H=t[D++],q=t[D++],Y=t[D++],J=t[D++],it=t[D++]+J;D+=1;var at=!t[D++];y=Math.cos(J)*q+N,w=Math.sin(J)*Y+H,z?(a=y,c=w,f(a,c)):g(o,s,y,w),o=Math.cos(it)*q+N,s=Math.sin(it)*Y+H;for(var ut=(at?-1:1)*Math.PI/2,ft=J;at?ft>it:ft<it;ft+=ut){var _t=at?Math.max(ft+ut,it):Math.min(ft+ut,it);v(ft,_t,N,H,q,Y)}break;case Yc.R:a=o=t[D++],c=s=t[D++],y=a+t[D++],w=c+t[D++],f(y,c),g(y,c,y,w),g(y,w,a,w),g(a,w,a,c),g(a,c,y,c);break;case Yc.Z:n&&g(o,s,a,c),o=a,s=c;break}}return n&&n.length>2&&r.push(n),r}function DB(i,t,e,r,n,o,s,a,c,f){if(e0(i,e)&&e0(t,r)&&e0(n,s)&&e0(o,a)){c.push(s,a);return}var g=2/f,v=g*g,y=s-i,w=a-t,I=Math.sqrt(y*y+w*w);y/=I,w/=I;var E=e-i,D=r-t,R=n-s,z=o-a,N=E*E+D*D,H=R*R+z*z;if(N<v&&H<v){c.push(s,a);return}var q=y*E+w*D,Y=-y*R-w*z,J=N-q*q,it=H-Y*Y;if(J<v&&q>=0&&it<v&&Y>=0){c.push(s,a);return}var at=[],ut=[];kp(i,e,n,s,.5,at),kp(t,r,o,a,.5,ut),DB(at[0],ut[0],at[1],ut[1],at[2],ut[2],at[3],ut[3],c,f),DB(at[4],ut[4],at[5],ut[5],at[6],ut[6],at[7],ut[7],c,f)}function r5t(i,t){var e=EB(i),r=[];t=t||1;for(var n=0;n<e.length;n++){var o=e[n],s=[],a=o[0],c=o[1];s.push(a,c);for(var f=2;f<o.length;){var g=o[f++],v=o[f++],y=o[f++],w=o[f++],I=o[f++],E=o[f++];DB(a,c,g,v,y,w,I,E,s,t),a=I,c=E}r.push(s)}return r}function Xrt(i,t,e){var r=i[t],n=i[1-t],o=Math.abs(r/n),s=Math.ceil(Math.sqrt(o*e)),a=Math.floor(e/s);a===0&&(a=1,s=e);for(var c=[],f=0;f<s;f++)c.push(a);var g=s*a,v=e-g;if(v>0)for(var f=0;f<v;f++)c[f%s]+=1;return c}function A7(i,t,e){for(var r=i.r0,n=i.r,o=i.startAngle,s=i.endAngle,a=Math.abs(s-o),c=a*n,f=n-r,g=c>Math.abs(f),v=Xrt([c,f],g?0:1,t),y=(g?a:f)/v.length,w=0;w<v.length;w++)for(var I=(g?f:a)/v[w],E=0;E<v[w];E++){var D={};g?(D.startAngle=o+y*w,D.endAngle=o+y*(w+1),D.r0=r+I*E,D.r=r+I*(E+1)):(D.startAngle=o+I*E,D.endAngle=o+I*(E+1),D.r0=r+y*w,D.r=r+y*(w+1)),D.clockwise=i.clockwise,D.cx=i.cx,D.cy=i.cy,e.push(D)}}function n5t(i,t,e){for(var r=i.width,n=i.height,o=r>n,s=Xrt([r,n],o?0:1,t),a=o?"width":"height",c=o?"height":"width",f=o?"x":"y",g=o?"y":"x",v=i[a]/s.length,y=0;y<s.length;y++)for(var w=i[c]/s[y],I=0;I<s[y];I++){var E={};E[f]=y*v,E[g]=I*w,E[a]=v,E[c]=w,E.x+=i.x,E.y+=i.y,e.push(E)}}function I7(i,t,e,r){return i*r-e*t}function a5t(i,t,e,r,n,o,s,a){var c=e-i,f=r-t,g=s-n,v=a-o,y=I7(g,v,c,f);if(Math.abs(y)<1e-6)return null;var w=i-n,I=t-o,E=I7(w,I,g,v)/y;return E<0||E>1?null:new er(E*c+i,E*f+t)}function o5t(i,t,e){var r=new er;er.sub(r,e,t),r.normalize();var n=new er;er.sub(n,i,t);var o=n.dot(r);return o}function Uy(i,t){var e=i[i.length-1];e&&e[0]===t[0]&&e[1]===t[1]||i.push(t)}function s5t(i,t,e){for(var r=i.length,n=[],o=0;o<r;o++){var s=i[o],a=i[(o+1)%r],c=a5t(s[0],s[1],a[0],a[1],t.x,t.y,e.x,e.y);c&&n.push({projPt:o5t(c,t,e),pt:c,idx:o})}if(n.length<2)return[{points:i},{points:i}];n.sort(function(D,R){return D.projPt-R.projPt});var f=n[0],g=n[n.length-1];if(g.idx<f.idx){var v=f;f=g,g=v}for(var y=[f.pt.x,f.pt.y],w=[g.pt.x,g.pt.y],I=[y],E=[w],o=f.idx+1;o<=g.idx;o++)Uy(I,i[o].slice());Uy(I,w),Uy(I,y);for(var o=g.idx+1;o<=f.idx+r;o++)Uy(E,i[o%r].slice());return Uy(E,y),Uy(E,w),[{points:I},{points:E}]}function C7(i){var t=i.points,e=[],r=[];sE(t,e,r);var n=new sr(e[0],e[1],r[0]-e[0],r[1]-e[1]),o=n.width,s=n.height,a=n.x,c=n.y,f=new er,g=new er;return o>s?(f.x=g.x=a+o/2,f.y=c,g.y=c+s):(f.y=g.y=c+s/2,f.x=a,g.x=a+o),s5t(t,f,g)}function CM(i,t,e,r){if(e===1)r.push(t);else{var n=Math.floor(e/2),o=i(t);CM(i,o[0],n,r),CM(i,o[1],e-n,r)}return r}function l5t(i,t){for(var e=[],r=0;r<t;r++)e.push(HF(i));return e}function u5t(i,t){t.setStyle(i.style),t.z=i.z,t.z2=i.z2,t.zlevel=i.zlevel}function c5t(i){for(var t=[],e=0;e<i.length;)t.push([i[e++],i[e++]]);return t}function h5t(i,t){var e=[],r=i.shape,n;switch(i.type){case"rect":n5t(r,t,e),n=jr;break;case"sector":A7(r,t,e),n=pl;break;case"circle":A7({r0:0,r:r.r,startAngle:0,endAngle:Math.PI*2,cx:r.cx,cy:r.cy},t,e),n=pl;break;default:var o=i.getComputedTransform(),s=o?Math.sqrt(Math.max(o[0]*o[0]+o[1]*o[1],o[2]*o[2]+o[3]*o[3])):1,a=ti(r5t(i.getUpdatedPathProxy(),s),function(R){return c5t(R)}),c=a.length;if(c===0)CM(C7,{points:a[0]},t,e);else if(c===t)for(var f=0;f<c;f++)e.push({points:a[f]});else{var g=0,v=ti(a,function(R){var z=[],N=[];sE(R,z,N);var H=(N[1]-z[1])*(N[0]-z[0]);return g+=H,{poly:R,area:H}});v.sort(function(R,z){return z.area-R.area});for(var y=t,f=0;f<c;f++){var w=v[f];if(y<=0)break;var I=f===c-1?y:Math.ceil(w.area/g*t);I<0||(CM(C7,{points:w.poly},I,e),y-=I)}}n=gl;break}if(!n)return l5t(i,t);for(var E=[],f=0;f<e.length;f++){var D=new n;D.setShape(e[f]),u5t(i,D),E.push(D)}return E}function d5t(i,t){var e=i.length,r=t.length;if(e===r)return[i,t];for(var n=[],o=[],s=e<r?i:t,a=Math.min(e,r),c=Math.abs(r-e)/6,f=(a-2)/6,g=Math.ceil(c/f)+1,v=[s[0],s[1]],y=c,w=2;w<a;){var I=s[w-2],E=s[w-1],D=s[w++],R=s[w++],z=s[w++],N=s[w++],H=s[w++],q=s[w++];if(y<=0){v.push(D,R,z,N,H,q);continue}for(var Y=Math.min(y,g-1)+1,J=1;J<=Y;J++){var it=J/Y;kp(I,D,z,H,it,n),kp(E,R,N,q,it,o),I=n[3],E=o[3],v.push(n[1],o[1],n[2],o[2],I,E),D=n[5],R=o[5],z=n[6],N=o[6]}y-=Y-1}return s===i?[v,t]:[i,v]}function M7(i,t){for(var e=i.length,r=i[e-2],n=i[e-1],o=[],s=0;s<t.length;)o[s++]=r,o[s++]=n;return o}function f5t(i,t){for(var e,r,n,o=[],s=[],a=0;a<Math.max(i.length,t.length);a++){var c=i[a],f=t[a],g=void 0,v=void 0;c?f?(e=d5t(c,f),g=e[0],v=e[1],r=g,n=v):(v=M7(n||c,c),g=c):(g=M7(r||f,f),v=f),o.push(g),s.push(v)}return[o,s]}function E7(i){for(var t=0,e=0,r=0,n=i.length,o=0,s=n-2;o<n;s=o,o+=2){var a=i[s],c=i[s+1],f=i[o],g=i[o+1],v=a*g-f*c;t+=v,e+=(a+f)*v,r+=(c+g)*v}return t===0?[i[0]||0,i[1]||0]:[e/t/3,r/t/3,t]}function p5t(i,t,e,r){for(var n=(i.length-2)/6,o=1/0,s=0,a=i.length,c=a-2,f=0;f<n;f++){for(var g=f*6,v=0,y=0;y<a;y+=2){var w=y===0?g:(g+y-2)%c+2,I=i[w]-e[0],E=i[w+1]-e[1],D=t[y]-r[0],R=t[y+1]-r[1],z=D-I,N=R-E;v+=z*z+N*N}v<o&&(o=v,s=f)}return s}function g5t(i){for(var t=[],e=i.length,r=0;r<e;r+=2)t[r]=i[e-r-2],t[r+1]=i[e-r-1];return t}function m5t(i,t,e,r){for(var n=[],o,s=0;s<i.length;s++){var a=i[s],c=t[s],f=E7(a),g=E7(c);o==null&&(o=f[2]<0!=g[2]<0);var v=[],y=[],w=0,I=1/0,E=[],D=a.length;o&&(a=g5t(a));for(var R=p5t(a,c,f,g)*6,z=D-2,N=0;N<z;N+=2){var H=(R+N)%z+2;v[N+2]=a[H]-f[0],v[N+3]=a[H+1]-f[1]}if(v[0]=a[R]-f[0],v[1]=a[R+1]-f[1],e>0)for(var q=r/e,Y=-r/2;Y<=r/2;Y+=q){for(var J=Math.sin(Y),it=Math.cos(Y),at=0,N=0;N<a.length;N+=2){var ut=v[N],ft=v[N+1],_t=c[N]-g[0],ct=c[N+1]-g[1],Dt=_t*it-ct*J,Et=_t*J+ct*it;E[N]=Dt,E[N+1]=Et;var bt=Dt-ut,Vt=Et-ft;at+=bt*bt+Vt*Vt}if(at<I){I=at,w=Y;for(var zt=0;zt<E.length;zt++)y[zt]=E[zt]}}else for(var Jt=0;Jt<D;Jt+=2)y[Jt]=c[Jt]-g[0],y[Jt+1]=c[Jt+1]-g[1];n.push({from:v,to:y,fromCp:f,toCp:g,rotation:-w})}return n}function MM(i){return i.__isCombineMorphing}var Yrt="__mOriginal_";function EM(i,t,e){var r=Yrt+t,n=i[r]||i[t];i[r]||(i[r]=i[t]);var o=e.replace,s=e.after,a=e.before;i[t]=function(){var c=arguments,f;return a&&a.apply(this,c),o?f=o.apply(this,c):f=n.apply(this,c),s&&s.apply(this,c),f}}function Ow(i,t){var e=Yrt+t;i[e]&&(i[t]=i[e],i[e]=null)}function D7(i,t){for(var e=0;e<i.length;e++)for(var r=i[e],n=0;n<r.length;){var o=r[n],s=r[n+1];r[n++]=t[0]*o+t[2]*s+t[4],r[n++]=t[1]*o+t[3]*s+t[5]}}function Krt(i,t){var e=i.getUpdatedPathProxy(),r=t.getUpdatedPathProxy(),n=f5t(EB(e),EB(r)),o=n[0],s=n[1],a=i.getComputedTransform(),c=t.getComputedTransform();function f(){this.transform=null}a&&D7(o,a),c&&D7(s,c),EM(t,"updateTransform",{replace:f}),t.transform=null;var g=m5t(o,s,10,Math.PI),v=[];EM(t,"buildPath",{replace:function(y){for(var w=t.__morphT,I=1-w,E=[],D=0;D<g.length;D++){var R=g[D],z=R.from,N=R.to,H=R.rotation*w,q=R.fromCp,Y=R.toCp,J=Math.sin(H),it=Math.cos(H);GI(E,q,Y,w);for(var at=0;at<z.length;at+=2){var ut=z[at],ft=z[at+1],_t=N[at],ct=N[at+1],Dt=ut*I+_t*w,Et=ft*I+ct*w;v[at]=Dt*it-Et*J+E[0],v[at+1]=Dt*J+Et*it+E[1]}var bt=v[0],Vt=v[1];y.moveTo(bt,Vt);for(var at=2;at<z.length;){var _t=v[at++],ct=v[at++],zt=v[at++],Jt=v[at++],ce=v[at++],be=v[at++];bt===_t&&Vt===ct&&zt===ce&&Jt===be?y.lineTo(ce,be):y.bezierCurveTo(_t,ct,zt,Jt,ce,be),bt=ce,Vt=be}}}})}function NN(i,t,e){if(!i||!t)return t;var r=e.done,n=e.during;Krt(i,t),t.__morphT=0;function o(){Ow(t,"buildPath"),Ow(t,"updateTransform"),t.__morphT=-1,t.createPathProxy(),t.dirtyShape()}return t.animateTo({__morphT:1},rr({during:function(s){t.dirtyShape(),n&&n(s)},done:function(){o(),r&&r()}},e)),t}function v5t(i,t,e,r,n,o){var s=16;i=n===e?0:Math.round(32767*(i-e)/(n-e)),t=o===r?0:Math.round(32767*(t-r)/(o-r));for(var a=0,c,f=(1<<s)/2;f>0;f/=2){var g=0,v=0;(i&f)>0&&(g=1),(t&f)>0&&(v=1),a+=f*f*(3*g^v),v===0&&(g===1&&(i=f-1-i,t=f-1-t),c=i,i=t,t=c)}return a}function DM(i){var t=1/0,e=1/0,r=-1/0,n=-1/0,o=ti(i,function(a){var c=a.getBoundingRect(),f=a.getComputedTransform(),g=c.x+c.width/2+(f?f[4]:0),v=c.y+c.height/2+(f?f[5]:0);return t=Math.min(g,t),e=Math.min(v,e),r=Math.max(g,r),n=Math.max(v,n),[g,v]}),s=ti(o,function(a,c){return{cp:a,z:v5t(a[0],a[1],t,e,r,n),path:i[c]}});return s.sort(function(a,c){return a.z-c.z}).map(function(a){return a.path})}function Jrt(i){return h5t(i.path,i.count)}function PB(){return{fromIndividuals:[],toIndividuals:[],count:0}}function _5t(i,t,e){var r=[];function n(q){for(var Y=0;Y<q.length;Y++){var J=q[Y];MM(J)?n(J.childrenRef()):J instanceof qr&&r.push(J)}}n(i);var o=r.length;if(!o)return PB();var s=e.dividePath||Jrt,a=s({path:t,count:o});if(a.length!==o)return console.error("Invalid morphing: unmatched splitted path"),PB();r=DM(r),a=DM(a);for(var c=e.done,f=e.during,g=e.individualDelay,v=new xd,y=0;y<o;y++){var w=r[y],I=a[y];I.parent=t,I.copyTransform(v),g||Krt(w,I)}t.__isCombineMorphing=!0,t.childrenRef=function(){return a};function E(q){for(var Y=0;Y<a.length;Y++)a[Y].addSelfToZr(q)}EM(t,"addSelfToZr",{after:function(q){E(q)}}),EM(t,"removeSelfFromZr",{after:function(q){for(var Y=0;Y<a.length;Y++)a[Y].removeSelfFromZr(q)}});function D(){t.__isCombineMorphing=!1,t.__morphT=-1,t.childrenRef=null,Ow(t,"addSelfToZr"),Ow(t,"removeSelfFromZr")}var R=a.length;if(g)for(var z=R,N=function(){z--,z===0&&(D(),c&&c())},y=0;y<R;y++){var H=g?rr({delay:(e.delay||0)+g(y,R,r[y],a[y]),done:N},e):e;NN(r[y],a[y],H)}else t.__morphT=0,t.animateTo({__morphT:1},rr({during:function(q){for(var Y=0;Y<R;Y++){var J=a[Y];J.__morphT=t.__morphT,J.dirtyShape()}f&&f(q)},done:function(){D();for(var q=0;q<i.length;q++)Ow(i[q],"updateTransform");c&&c()}},e));return t.__zr&&E(t.__zr),{fromIndividuals:r,toIndividuals:a,count:R}}function y5t(i,t,e){var r=t.length,n=[],o=e.dividePath||Jrt;function s(w){for(var I=0;I<w.length;I++){var E=w[I];MM(E)?s(E.childrenRef()):E instanceof qr&&n.push(E)}}if(MM(i)){s(i.childrenRef());var a=n.length;if(a<r)for(var c=0,f=a;f<r;f++)n.push(HF(n[c++%a]));n.length=r}else{n=o({path:i,count:r});for(var g=i.getComputedTransform(),f=0;f<n.length;f++)n[f].setLocalTransform(g);if(n.length!==r)return console.error("Invalid morphing: unmatched splitted path"),PB()}n=DM(n),t=DM(t);for(var v=e.individualDelay,f=0;f<r;f++){var y=v?rr({delay:(e.delay||0)+v(f,r,n[f],t[f])},e):e;NN(n[f],t[f],y)}return{fromIndividuals:n,toIndividuals:t,count:t.length}}function P7(i){return Ye(i[0])}function L7(i,t){for(var e=[],r=i.length,n=0;n<r;n++)e.push({one:i[n],many:[]});for(var n=0;n<t.length;n++){var o=t[n].length,s=void 0;for(s=0;s<o;s++)e[s%r].many.push(t[n][s])}for(var a=0,n=r-1;n>=0;n--)if(!e[n].many.length){var c=e[a].many;if(c.length<=1)if(a)a=0;else return e;var o=c.length,f=Math.ceil(o/2);e[n].many=c.slice(f,o),e[a].many=c.slice(0,f),a++}return e}var x5t={clone:function(i){for(var t=[],e=1-Math.pow(1-i.path.style.opacity,1/i.count),r=0;r<i.count;r++){var n=HF(i.path);n.setStyle("opacity",e),t.push(n)}return t},split:null};function Vk(i,t,e,r,n,o){if(!i.length||!t.length)return;var s=G0("update",r,n);if(!(s&&s.duration>0))return;var a=r.getModel("universalTransition").get("delay"),c=Object.assign({setToFinal:!0},s),f,g;P7(i)&&(f=i,g=t),P7(t)&&(f=t,g=i);function v(R,z,N,H,q){var Y=R.many,J=R.one;if(Y.length===1&&!q){var it=z?Y[0]:J,at=z?J:Y[0];if(MM(it))v({many:[it],one:at},!0,N,H,!0);else{var ut=a?rr({delay:a(N,H)},c):c;NN(it,at,ut),o(it,at,it,at,ut)}}else for(var ft=rr({dividePath:x5t[e],individualDelay:a&&function(Vt,zt,Jt,ce){return a(Vt+N,H)}},c),_t=z?_5t(Y,J,ft):y5t(J,Y,ft),ct=_t.fromIndividuals,Dt=_t.toIndividuals,Et=ct.length,bt=0;bt<Et;bt++){var ut=a?rr({delay:a(bt,Et)},c):c;o(ct[bt],Dt[bt],z?Y[bt]:R.one,z?R.one:Y[bt],ut)}}for(var y=f?f===i:i.length>t.length,w=f?L7(g,f):L7(y?t:i,[y?i:t]),I=0,E=0;E<w.length;E++)I+=w[E].many.length;for(var D=0,E=0;E<w.length;E++)v(w[E],y,D,I),D+=w[E].many.length}function Bm(i){if(!i)return[];if(Ye(i)){for(var t=[],e=0;e<i.length;e++)t.push(Bm(i[e]));return t}var r=[];return i.traverse(function(n){n instanceof qr&&!n.disableMorphing&&!n.invisible&&!n.ignore&&r.push(n)}),r}var Qrt=1e4,b5t=0,R7=1,k7=2,w5t=Wr();function S5t(i,t){for(var e=i.dimensions,r=0;r<e.length;r++){var n=i.getDimensionInfo(e[r]);if(n&&n.otherDims[t]===0)return e[r]}}function T5t(i,t,e){var r=i.getDimensionInfo(e),n=r&&r.ordinalMeta;if(r){var o=i.get(r.name,t);return n&&n.categories[o]||o+""}}function O7(i,t,e,r){var n=r?"itemChildGroupId":"itemGroupId",o=S5t(i,n);if(o){var s=T5t(i,t,o);return s}var a=i.getRawDataItem(t),c=r?"childGroupId":"groupId";if(a&&a[c])return a[c]+"";if(!r)return e||i.getId(t)}function z7(i){var t=[];return pt(i,function(e){var r=e.data,n=e.dataGroupId;if(!(r.count()>Qrt))for(var o=r.getIndices(),s=0;s<o.length;s++)t.push({data:r,groupId:O7(r,s,n,!1),childGroupId:O7(r,s,n,!0),divide:e.divide,dataIndex:s})}),t}function Uk(i,t,e){i.traverse(function(r){r instanceof qr&&xa(r,{style:{opacity:0}},t,{dataIndex:e,isFrom:!0})})}function Gk(i){if(i.parent){var t=i.getComputedTransform();i.setLocalTransform(t),i.parent.remove(i)}}function Gy(i){i.stopAnimation(),i.isGroup&&i.traverse(function(t){t.stopAnimation()})}function A5t(i,t,e){var r=G0("update",e,t);r&&i.traverse(function(n){if(n instanceof Ou){var o=Fxt(n);o&&n.animateFrom({style:o},r)}})}function I5t(i,t){var e=i.length;if(e!==t.length)return!1;for(var r=0;r<e;r++){var n=i[r],o=t[r];if(n.data.getId(n.dataIndex)!==o.data.getId(o.dataIndex))return!1}return!0}function tnt(i,t,e){var r=z7(i),n=z7(t);function o(N,H,q,Y,J){(q||N)&&H.animateFrom({style:q&&q!==N?Ne(Ne({},q.style),N.style):N.style},J)}var s=!1,a=b5t,c=Fi(),f=Fi();r.forEach(function(N){N.groupId&&c.set(N.groupId,!0),N.childGroupId&&f.set(N.childGroupId,!0)});for(var g=0;g<n.length;g++){var v=n[g].groupId;if(f.get(v)){a=R7;break}var y=n[g].childGroupId;if(y&&c.get(y)){a=k7;break}}function w(N,H){return function(q){var Y=q.data,J=q.dataIndex;return H?Y.getId(J):N?a===R7?q.childGroupId:q.groupId:a===k7?q.childGroupId:q.groupId}}var I=I5t(r,n),E={};if(!I)for(var g=0;g<n.length;g++){var D=n[g],R=D.data.getItemGraphicEl(D.dataIndex);R&&(E[R.id]=!0)}function z(N,H){var q=r[H],Y=n[N],J=Y.data.hostModel,it=q.data.getItemGraphicEl(q.dataIndex),at=Y.data.getItemGraphicEl(Y.dataIndex);if(it===at){at&&A5t(at,Y.dataIndex,J);return}it&&E[it.id]||at&&(Gy(at),it?(Gy(it),Gk(it),s=!0,Vk(Bm(it),Bm(at),Y.divide,J,N,o)):Uk(at,J,N))}new Bd(r,n,w(!0,I),w(!1,I),null,"multiple").update(z).updateManyToOne(function(N,H){var q=n[N],Y=q.data,J=Y.hostModel,it=Y.getItemGraphicEl(q.dataIndex),at=kn(ti(H,function(ut){return r[ut].data.getItemGraphicEl(r[ut].dataIndex)}),function(ut){return ut&&ut!==it&&!E[ut.id]});it&&(Gy(it),at.length?(pt(at,function(ut){Gy(ut),Gk(ut)}),s=!0,Vk(Bm(at),Bm(it),q.divide,J,N,o)):Uk(it,J,q.dataIndex))}).updateOneToMany(function(N,H){var q=r[H],Y=q.data.getItemGraphicEl(q.dataIndex);if(!(Y&&E[Y.id])){var J=kn(ti(N,function(at){return n[at].data.getItemGraphicEl(n[at].dataIndex)}),function(at){return at&&at!==Y}),it=n[N[0]].data.hostModel;J.length&&(pt(J,function(at){return Gy(at)}),Y?(Gy(Y),Gk(Y),s=!0,Vk(Bm(Y),Bm(J),q.divide,it,N[0],o)):pt(J,function(at){return Uk(at,it,N[0])}))}}).updateManyToMany(function(N,H){new Bd(H,N,function(q){return r[q].data.getId(r[q].dataIndex)},function(q){return n[q].data.getId(n[q].dataIndex)}).update(function(q,Y){z(N[q],H[Y])}).execute()}).execute(),s&&pt(t,function(N){var H=N.data,q=H.hostModel,Y=q&&e.getViewOfSeriesModel(q),J=G0("update",q,0);Y&&q.isAnimationEnabled()&&J&&J.duration>0&&Y.group.traverse(function(it){it instanceof qr&&!it.animators.length&&it.animateFrom({style:{opacity:0}},J)})})}function B7(i){var t=i.getModel("universalTransition").get("seriesKey");return t||i.id}function F7(i){return Ye(i)?i.sort().join(","):i}function ap(i){if(i.hostModel)return i.hostModel.getModel("universalTransition").get("divideShape")}function C5t(i,t){var e=Fi(),r=Fi(),n=Fi();return pt(i.oldSeries,function(o,s){var a=i.oldDataGroupIds[s],c=i.oldData[s],f=B7(o),g=F7(f);r.set(g,{dataGroupId:a,data:c}),Ye(f)&&pt(f,function(v){n.set(v,{key:g,dataGroupId:a,data:c})})}),pt(t.updatedSeries,function(o){if(o.isUniversalTransitionEnabled()&&o.isAnimationEnabled()){var s=o.get("dataGroupId"),a=o.getData(),c=B7(o),f=F7(c),g=r.get(f);if(g)e.set(f,{oldSeries:[{dataGroupId:g.dataGroupId,divide:ap(g.data),data:g.data}],newSeries:[{dataGroupId:s,divide:ap(a),data:a}]});else if(Ye(c)){var v=[];pt(c,function(I){var E=r.get(I);E.data&&v.push({dataGroupId:E.dataGroupId,divide:ap(E.data),data:E.data})}),v.length&&e.set(f,{oldSeries:v,newSeries:[{dataGroupId:s,data:a,divide:ap(a)}]})}else{var y=n.get(c);if(y){var w=e.get(y.key);w||(w={oldSeries:[{dataGroupId:y.dataGroupId,data:y.data,divide:ap(y.data)}],newSeries:[]},e.set(y.key,w)),w.newSeries.push({dataGroupId:s,data:a,divide:ap(a)})}}}}),e}function N7(i,t){for(var e=0;e<i.length;e++){var r=t.seriesIndex!=null&&t.seriesIndex===i[e].seriesIndex||t.seriesId!=null&&t.seriesId===i[e].id;if(r)return e}}function M5t(i,t,e,r){var n=[],o=[];pt(aa(i.from),function(s){var a=N7(t.oldSeries,s);a>=0&&n.push({dataGroupId:t.oldDataGroupIds[a],data:t.oldData[a],divide:ap(t.oldData[a]),groupIdDim:s.dimension})}),pt(aa(i.to),function(s){var a=N7(e.updatedSeries,s);if(a>=0){var c=e.updatedSeries[a].getData();o.push({dataGroupId:t.oldDataGroupIds[a],data:c,divide:ap(c),groupIdDim:s.dimension})}}),n.length>0&&o.length>0&&tnt(n,o,r)}function E5t(i){i.registerUpdateLifecycle("series:beforeupdate",function(t,e,r){pt(aa(r.seriesTransition),function(n){pt(aa(n.to),function(o){for(var s=r.updatedSeries,a=0;a<s.length;a++)(o.seriesIndex!=null&&o.seriesIndex===s[a].seriesIndex||o.seriesId!=null&&o.seriesId===s[a].id)&&(s[a][eC]=!0)})})}),i.registerUpdateLifecycle("series:transition",function(t,e,r){var n=w5t(e);if(n.oldSeries&&r.updatedSeries&&r.optionChanged){var o=r.seriesTransition;if(o)pt(aa(o),function(w){M5t(w,n,r,e)});else{var s=C5t(n,r);pt(s.keys(),function(w){var I=s.get(w);tnt(I.oldSeries,I.newSeries,e)})}pt(r.updatedSeries,function(w){w[eC]&&(w[eC]=!1)})}for(var a=t.getSeries(),c=n.oldSeries=[],f=n.oldDataGroupIds=[],g=n.oldData=[],v=0;v<a.length;v++){var y=a[v].getData();y.count()<Qrt&&(c.push(a[v]),f.push(a[v].get("dataGroupId")),g.push(y))}})}var D5t=function(){function i(){this.breaks=[],this._elapsedExtent=[1/0,-1/0]}return i.prototype.setBreaks=function(t){this.breaks=t.breaks},i.prototype.update=function(t){L5t(this,t);var e=this._elapsedExtent;e[0]=this.elapse(t[0]),e[1]=this.elapse(t[1])},i.prototype.hasBreaks=function(){return!!this.breaks.length},i.prototype.calcNiceTickMultiple=function(t,e){for(var r=0;r<this.breaks.length;r++){var n=this.breaks[r];if(n.vmin<t&&t<n.vmax){var o=e(t,n.vmax);return o}}return 0},i.prototype.getExtentSpan=function(){return this._elapsedExtent[1]-this._elapsedExtent[0]},i.prototype.normalize=function(t){var e=this._elapsedExtent[1]-this._elapsedExtent[0];return e===0?.5:(this.elapse(t)-this._elapsedExtent[0])/e},i.prototype.scale=function(t){return this.unelapse(t*(this._elapsedExtent[1]-this._elapsedExtent[0])+this._elapsedExtent[0])},i.prototype.elapse=function(t){for(var e=V7,r=U7,n=!0,o=0;o<this.breaks.length;o++){var s=this.breaks[o];if(t<=s.vmax){t>s.vmin?e+=s.vmin-r+(t-s.vmin)/(s.vmax-s.vmin)*s.gapReal:e+=t-r,r=s.vmax,n=!1;break}e+=s.vmin-r+s.gapReal,r=s.vmax}return n&&(e+=t-r),e},i.prototype.unelapse=function(t){for(var e=V7,r=U7,n=!0,o=0,s=0;s<this.breaks.length;s++){var a=this.breaks[s],c=e+a.vmin-r,f=c+a.gapReal;if(t<=f){t>c?o=a.vmin+(t-c)/(f-c)*(a.vmax-a.vmin):o=r+t-e,r=a.vmax,n=!1;break}e=f,r=a.vmax}return n&&(o=r+t-e),o},i}();function P5t(){return new D5t}var V7=0,U7=0;function L5t(i,t){var e=0,r={tpAbs:{span:0,val:0},tpPrct:{span:0,val:0}},n=function(){return{has:!1,span:NaN,inExtFrac:NaN,val:NaN}},o={S:{tpAbs:n(),tpPrct:n()},E:{tpAbs:n(),tpPrct:n()}};pt(i.breaks,function(a){var c=a.gapParsed;c.type==="tpPrct"&&(e+=c.val);var f=VN(a,t);if(f){var g=f.vmin!==a.vmin,v=f.vmax!==a.vmax,y=f.vmax-f.vmin;if(!(g&&v))if(g||v){var w=g?"S":"E";o[w][c.type].has=!0,o[w][c.type].span=y,o[w][c.type].inExtFrac=y/(a.vmax-a.vmin),o[w][c.type].val=c.val}else r[c.type].span+=y,r[c.type].val+=c.val}});var s=e*(0+(t[1]-t[0])+(r.tpAbs.val-r.tpAbs.span)+(o.S.tpAbs.has?(o.S.tpAbs.val-o.S.tpAbs.span)*o.S.tpAbs.inExtFrac:0)+(o.E.tpAbs.has?(o.E.tpAbs.val-o.E.tpAbs.span)*o.E.tpAbs.inExtFrac:0)-r.tpPrct.span-(o.S.tpPrct.has?o.S.tpPrct.span*o.S.tpPrct.inExtFrac:0)-(o.E.tpPrct.has?o.E.tpPrct.span*o.E.tpPrct.inExtFrac:0))/(1-r.tpPrct.val-(o.S.tpPrct.has?o.S.tpPrct.val*o.S.tpPrct.inExtFrac:0)-(o.E.tpPrct.has?o.E.tpPrct.val*o.E.tpPrct.inExtFrac:0));pt(i.breaks,function(a){var c=a.gapParsed;c.type==="tpPrct"&&(a.gapReal=e!==0?Math.max(s,0)*c.val/e:0),c.type==="tpAbs"&&(a.gapReal=c.val),a.gapReal==null&&(a.gapReal=0)})}function R5t(i,t,e,r,n,o){i!=="no"&&pt(e,function(s){var a=VN(s,o);if(a)for(var c=t.length-1;c>=0;c--){var f=t[c],g=r(f),v=n*3/4;g>a.vmin-v&&g<a.vmax+v&&(i!=="preserve_extent_bound"||g!==o[0]&&g!==o[1])&&t.splice(c,1)}})}function k5t(i,t,e,r){pt(t,function(n){var o=VN(n,e);o&&(i.push({value:o.vmin,break:{type:"vmin",parsedBreak:o},time:r?r(o):void 0}),i.push({value:o.vmax,break:{type:"vmax",parsedBreak:o},time:r?r(o):void 0}))}),t.length&&i.sort(function(n,o){return n.value-o.value})}function VN(i,t){var e=Math.max(i.vmin,t[0]),r=Math.min(i.vmax,t[1]);return e<r||e===r&&e>t[0]&&e<t[1]?{vmin:e,vmax:r,breakOption:i.breakOption,gapParsed:i.gapParsed,gapReal:i.gapReal}:null}function LB(i,t,e){var r=[];if(!i)return{breaks:r};function n(s,a){return s>=0&&s<1-1e-5}pt(i,function(s){if(!(!s||s.start==null||s.end==null)&&!s.isExpanded){var a={breakOption:Yi(s),vmin:t(s.start),vmax:t(s.end),gapParsed:{type:"tpAbs",val:0},gapReal:null};if(s.gap!=null){var c=!1;if(wi(s.gap)){var f=Du(s.gap);if(f.match(/%$/)){var g=parseFloat(f)/100;n(g)||(g=0),a.gapParsed.type="tpPrct",a.gapParsed.val=g,c=!0}}if(!c){var v=t(s.gap);(!isFinite(v)||v<0)&&(v=0),a.gapParsed.type="tpAbs",a.gapParsed.val=v}}if(a.vmin===a.vmax&&(a.gapParsed.type="tpAbs",a.gapParsed.val=0),e&&e.noNegative&&pt(["vmin","vmax"],function(w){a[w]<0&&(a[w]=0)}),a.vmin>a.vmax){var y=a.vmax;a.vmax=a.vmin,a.vmin=y}r.push(a)}}),r.sort(function(s,a){return s.vmin-a.vmin});var o=-1/0;return pt(r,function(s,a){o>s.vmin&&(r[a]=null),o=s.vmax}),{breaks:r.filter(function(s){return!!s})}}function UN(i,t){return RB(t)===RB(i)}function RB(i){return i.start+"_\0_"+i.end}function O5t(i,t,e){var r=[];pt(i,function(o,s){var a=t(o);a&&a.type==="vmin"&&r.push([s])}),pt(i,function(o,s){var a=t(o);if(a&&a.type==="vmax"){var c=Iv(r,function(f){return UN(t(i[f[0]]).parsedBreak.breakOption,a.parsedBreak.breakOption)});c&&c.push(s)}});var n=[];return pt(r,function(o){o.length===2&&n.push(e?o:[i[o[0]],i[o[1]]])}),n}function z5t(i,t,e,r){var n,o;if(i.break){var s=i.break.parsedBreak,a=Iv(e,function(v){return UN(v.breakOption,i.break.parsedBreak.breakOption)}),c=r(Math.pow(t,s.vmin),a.vmin),f=r(Math.pow(t,s.vmax),a.vmax),g={type:s.gapParsed.type,val:s.gapParsed.type==="tpAbs"?xo(Math.pow(t,s.vmin+s.gapParsed.val))-c:s.gapParsed.val};n={type:i.break.type,parsedBreak:{breakOption:s.breakOption,vmin:c,vmax:f,gapParsed:g,gapReal:s.gapReal}},o=a[i.break.type]}return{brkRoundingCriterion:o,vBreak:n}}function B5t(i,t,e){var r={noNegative:!0},n=LB(i,e,r),o=LB(i,e,r),s=Math.log(t);return o.breaks=ti(o.breaks,function(a){var c=Math.log(a.vmin)/s,f=Math.log(a.vmax)/s,g={type:a.gapParsed.type,val:a.gapParsed.type==="tpAbs"?Math.log(a.vmin+a.gapParsed.val)/s-c:a.gapParsed.val};return{vmin:c,vmax:f,gapParsed:g,gapReal:a.gapReal,breakOption:a.breakOption}}),{parsedOriginal:n,parsedLogged:o}}var F5t={vmin:"start",vmax:"end"};function N5t(i,t){return t&&(i=i||{},i.break={type:F5t[t.type],start:t.parsedBreak.vmin,end:t.parsedBreak.vmax}),i}function V5t(){l1t({createScaleBreakContext:P5t,pruneTicksByBreak:R5t,addBreaksToTicks:k5t,parseAxisBreakOption:LB,identifyAxisBreak:UN,serializeAxisBreakIdentifier:RB,retrieveAxisBreakPairs:O5t,getTicksLogTransformBreak:z5t,logarithmicParseBreaksFromOption:B5t,makeAxisLabelFormatterParamBreak:N5t})}var G7=Wr();function U5t(i,t){var e=Iv(i,function(r){return bo().identifyAxisBreak(r.parsedBreak.breakOption,t.breakOption)});return e||i.push(e={zigzagRandomList:[],parsedBreak:t,shouldRemove:!1}),e}function G5t(i){pt(i,function(t){return t.shouldRemove=!0})}function H5t(i){for(var t=i.length-1;t>=0;t--)i[t].shouldRemove&&i.splice(t,1)}function j5t(i,t,e,r,n){var o=e.axis;if(o.scale.isBlank()||!bo())return;var s=bo().retrieveAxisBreakPairs(o.scale.getTicks({breakTicks:"only_break"}),function(at){return at.break},!1);if(!s.length)return;var a=e.getModel("breakArea"),c=a.get("zigzagAmplitude"),f=a.get("zigzagMinSpan"),g=a.get("zigzagMaxSpan");f=Math.max(2,f||0),g=Math.max(f,g||0);var v=a.get("expandOnClick"),y=a.get("zigzagZ"),w=a.getModel("itemStyle"),I=w.getItemStyle(),E=I.stroke,D=I.lineWidth,R=I.lineDash,z=I.fill,N=new Ki({ignoreModelZ:!0}),H=o.isHorizontal(),q=G7(t).visualList||(G7(t).visualList=[]);G5t(q);for(var Y=function(at){var ut=s[at][0].break.parsedBreak,ft=[];ft[0]=o.toGlobalCoord(o.dataToCoord(ut.vmin,!0)),ft[1]=o.toGlobalCoord(o.dataToCoord(ut.vmax,!0)),ft[1]<ft[0]&&ft.reverse();var _t=U5t(q,ut);_t.shouldRemove=!1;var ct=new Ki;it(_t.zigzagRandomList,ct,ft[0],ft[1],H,ut),v&&ct.on("click",function(){var Dt={type:ME,breaks:[{start:ut.breakOption.start,end:ut.breakOption.end}]};Dt[o.dim+"AxisIndex"]=e.componentIndex,n.dispatchAction(Dt)}),ct.silent=!v,N.add(ct)},J=0;J<s.length;J++)Y(J);i.add(N),H5t(q);function it(at,ut,ft,_t,ct,Dt){var Et={stroke:E,lineWidth:D,lineDash:R,fill:"none"},bt=ct?0:1,Vt=1-bt,zt=r[vr[Vt]]+r[wo[Vt]];function Jt(Bt){var Zt=[],ge=[];Zt[bt]=ge[bt]=Bt,Zt[Vt]=r[vr[Vt]],ge[Vt]=zt;var $e={x1:Zt[0],y1:Zt[1],x2:ge[0],y2:ge[1]};return uE($e,$e,{lineWidth:1}),Zt[0]=$e.x1,Zt[1]=$e.y1,Zt[bt]}ft=Jt(ft),_t=Jt(_t);for(var ce=[],be=[],ve=!0,ke=r[vr[Vt]],ni=0;;ni++){var bi=ke===r[vr[Vt]],or=ke>=zt;or&&(ke=zt);var Ue=[],Ze=[];Ue[bt]=ft,Ze[bt]=_t,!bi&&!or&&(Ue[bt]+=ve?-c:c,Ze[bt]-=ve?c:-c),Ue[Vt]=ke,Ze[Vt]=ke,ce.push(Ue),be.push(Ze);var xe=void 0;if(ni<at.length?xe=at[ni]:(xe=Math.random(),at.push(xe)),ke+=xe*(g-f)+f,ve=!ve,or)break}var Ke=bo().serializeAxisBreakIdentifier(Dt.breakOption);if(ut.add(new Us({anid:"break_a_"+Ke,shape:{points:ce},style:Et,z:y})),Dt.gapReal!==0){ut.add(new Us({anid:"break_b_"+Ke,shape:{points:be},style:Et,z:y}));var We=be.slice();We.reverse();var Ti=ce.concat(We);ut.add(new gl({anid:"break_c_"+Ke,shape:{points:Ti},style:{fill:z,opacity:I.opacity},z:y}))}}}function W5t(i,t,e,r){var n=i.axis,o=e.transform;Vs(r.style);var s=n.getExtent();n.inverse&&(s=s.slice(),s.reverse());var a=bo().retrieveAxisBreakPairs(n.scale.getTicks({breakTicks:"only_break"}),function(D){return D.break},!1),c=ti(a,function(D){var R=D[0].break.parsedBreak,z=[n.dataToCoord(R.vmin,!0),n.dataToCoord(R.vmax,!0)];return z[0]>z[1]&&z.reverse(),{coordPair:z,brkId:bo().serializeAxisBreakIdentifier(R.breakOption)}});c.sort(function(D,R){return D.coordPair[0]-R.coordPair[0]});for(var f=s[0],g=null,v=0;v<c.length;v++){var y=c[v],w=Math.max(y.coordPair[0],s[0]),I=Math.min(y.coordPair[1],s[1]);f<=w&&E(f,w,g,y),f=I,g=y}f<=s[1]&&E(f,s[1],g,null);function E(D,R,z,N){function H(ft,_t){o&&(fo(ft,ft,o),fo(_t,_t,o))}function q(ft,_t){var ct={x1:ft[0],y1:ft[1],x2:_t[0],y2:_t[1]};uE(ct,ct,r.style),ft[0]=ct.x1,ft[1]=ct.y1,_t[0]=ct.x2,_t[1]=ct.y2}var Y=[D,0],J=[R,0],it=[D,5],at=[R,5];H(Y,it),q(Y,it),H(J,at),q(J,at),q(Y,J);var ut=new Oo(Ne({shape:{x1:Y[0],y1:Y[1],x2:J[0],y2:J[1]}},r));t.add(ut),ut.anid="breakLine_"+(z?z.brkId:"\0")+"_\0_"+(N?N.brkId:"\0")}}function $5t(i,t,e){if(Iv(e,function(z){return!z}))return;var r=new er;if(!IE(e[0],e[1],r,{direction:-(i?t+Math.PI:t),touchThreshold:0,bidirectional:!1}))return;var n=as();jp(n,n,-t);var o=ti(e,function(z){return z.transform?ph(as(),n,z.transform):n});function s(z){var N=e[0].localRect,H=new er(N[wo[z]]*o[0][0],N[wo[z]]*o[0][1]);return Math.abs(H.y)<1e-5}var a=.5;if(s(0)||s(1)){var c=ti(e,function(z,N){var H=z.localRect.clone();return H.applyTransform(o[N]),H}),f=new er;f.copy(e[0].label).add(e[1].label).scale(.5),f.transform(n);var g=r.clone().transform(n),v=c[0].x+c[1].x+(g.x>=0?c[0].width:c[1].width),y=(v+g.x)/2-f.x,w=Math.min(y,y-g.x),I=Math.max(y,y-g.x),E=I<0?I:w>0?w:0;a=(y-E)/g.x}var D=new er,R=new er;er.scale(D,r,-a),er.scale(R,r,1-a),zz(e[0],D),zz(e[1],R)}function Z5t(i,t){var e={breaks:[]};return pt(t.breaks,function(r){if(r){var n=Iv(i.get("breaks",!0),function(a){return bo().identifyAxisBreak(a,r)});if(n){var o=t.type,s={isExpanded:!!n.isExpanded};n.isExpanded=o===ME?!0:o===met?!1:o===vet?!n.isExpanded:n.isExpanded,e.breaks.push({start:n.start,end:n.end,isExpanded:!!n.isExpanded,old:s})}}}),e}function q5t(){iIt({adjustBreakLabelPair:$5t,buildAxisBreakLine:W5t,rectCoordBuildBreakAxis:j5t,updateModelAxisBreak:Z5t})}function X5t(i){cIt(i),V5t(),q5t()}function Y5t(){PIt(K5t)}function K5t(i,t){pt(i,function(e){if(!e.model.get(["axisLabel","inside"])){var r=J5t(e);if(r){var n=e.isHorizontal()?"height":"width",o=e.model.get(["axisLabel","margin"]);t[n]-=r[n]+o,e.position==="top"?t.y+=r.height+o:e.position==="left"&&(t.x+=r.width+o)}}})}function J5t(i){var t=i.model,e=i.scale;if(!t.get(["axisLabel","show"])||e.isBlank())return;var r,n,o=e.getExtent();e instanceof gS?n=e.count():(r=e.getTicks(),n=r.length);var s=i.getLabelModel(),a=X0(i),c,f=1;n>40&&(f=Math.ceil(n/40));for(var g=0;g<n;g+=f){var v=r?r[g]:{value:o[0]+g},y=a(v,g),w=s.getTextRect(y),I=E(w,s.get("rotate")||0);c?c.union(I):c=I}return c;function E(D,R){var z=R*Math.PI/180,N=D.width,H=D.height,q=N*Math.abs(Math.cos(z))+Math.abs(H*Math.sin(z)),Y=N*Math.abs(Math.sin(z))+Math.abs(H*Math.cos(z)),J=new sr(D.x,D.y,q,Y);return J}}Rr([V2t]);Rr([R2t]);Rr([cAt,MAt,UAt,JIt,gCt,dMt,GMt,MEt,eDt,hDt,xDt,DDt,RPt,aLt,_Lt,FLt,WLt,uRt,yRt,LRt,VRt,QRt,Nkt]);Rr(lOt);Rr(UOt);Rr(Wet);Rr(rzt);Rr(Lit);Rr(czt);Rr(Rzt);Rr(Gzt);Rr(GBt);Rr(hFt);Rr(QS);Rr(DFt);Rr(RFt);Rr(qFt);Rr(a3t);Rr(f3t);Rr(b3t);Rr(O3t);Rr(nNt);Rr(Vrt);Rr(Urt);Rr(PNt);Rr($rt);Rr(Zrt);Rr(ONt);Rr(VNt);Rr(QNt);Rr(i5t);Rr(E5t);Rr(KTt);Rr(X5t);Rr(Y5t);Rr(QIt);const Q5t={class:"route-card"},tVt={class:"route-header"},eVt={class:"route-title"},iVt={class:"route-subtitle"},rVt={class:"route-grid"},nVt={class:"route-col"},aVt={class:"time"},oVt={key:0},sVt={class:"metric"},lVt={class:"metric"},uVt={class:"metric"},cVt={class:"route-col"},hVt={class:"time"},dVt={key:0},fVt={key:0,class:"route-note"},pVt={__name:"RoutePopup",props:{street:{type:String,required:!0},hour:{type:Number,required:!0},carTime:{type:Number,default:null},bikeTime:{type:Number,default:null},carCo2:{type:Number,default:null},carCo:{type:Number,default:null},carPm25:{type:Number,default:null}},setup(i){const t=i,e=vo(null);let r=null;const n=f=>f===null||Number.isNaN(f)?"N/A":Number(f).toFixed(0),o=f=>f===null||Number.isNaN(f)?"N/A":Number(f).toFixed(2),a=(()=>{const f=t.carTime,g=t.bikeTime;if(f==null||g==null||Number.isNaN(f)||Number.isNaN(g))return"";const v=f-g;return v>0?`Cycling is ${v} min faster on this route.`:v<0?`Driving is ${Math.abs(v)} min faster, but with significantly higher emissions.`:"Both modes take similar time, but cycling avoids tailpipe emissions."})(),c=()=>{if(!e.value)return;r&&r.dispose();const f=e.value;if(!f.offsetWidth||!f.offsetHeight){setTimeout(c,30);return}r=lSt(f);const g=t.carTime??0,v=t.bikeTime??0,y=t.carCo2??0,w=t.carPm25??0,I={animation:!0,tooltip:{trigger:"axis",axisPointer:{type:"shadow"},textStyle:{fontSize:9}},legend:{data:["Car","Bicycle"],top:0,itemWidth:10,itemHeight:6,textStyle:{color:"#e5e7eb",fontSize:8}},grid:{left:32,right:6,top:20,bottom:16},xAxis:{type:"category",data:["Time","CO","PM2.5"],axisLabel:{color:"#9ca3af",fontSize:8},axisLine:{lineStyle:{color:"rgba(148,163,253,0.4)"}}},yAxis:{type:"value",axisLabel:{color:"#6b7280",fontSize:7},splitLine:{lineStyle:{color:"rgba(148,163,253,0.16)"}}},series:[{name:"Car",type:"bar",data:[g,y,w],barWidth:9},{name:"Bicycle",type:"bar",data:[v,0,0],barWidth:9}]};r.setOption(I),r.resize()};return Av(async()=>{await Fw(),c()}),tv(()=>[t.carTime,t.bikeTime,t.carCo2,t.carPm25,t.street],async()=>{await Fw(),c()}),LS(()=>{r&&(r.dispose(),r=null)}),(f,g)=>(Ka(),_o("div",Q5t,[le("div",tVt,[le("div",eVt,Hn(i.street),1),le("div",iVt,"Hour "+Hn(i.hour)+":00  Car vs Bicycle",1)]),le("div",rVt,[le("div",nVt,[g[0]||(g[0]=le("div",{class:"label label-car"},"BY CAR",-1)),le("div",aVt,[Dn(Hn(n(i.carTime)),1),i.carTime!==null?(Ka(),_o("span",oVt," min")):ev("",!0)]),le("div",sVt,"CO: "+Hn(o(i.carCo2))+" kg",1),le("div",lVt,"CO: "+Hn(o(i.carCo))+" g",1),le("div",uVt,"PM2.5: "+Hn(o(i.carPm25))+" g",1)]),le("div",cVt,[g[1]||(g[1]=le("div",{class:"label label-bike"},"BY BICYCLE",-1)),le("div",hVt,[Dn(Hn(n(i.bikeTime)),1),i.bikeTime!==null?(Ka(),_o("span",dVt," min")):ev("",!0)]),g[2]||(g[2]=le("div",{class:"metric"},"CO: 0 kg",-1)),g[3]||(g[3]=le("div",{class:"metric"},"CO: 0 g",-1)),g[4]||(g[4]=le("div",{class:"metric"},"PM2.5: 0 g",-1))])]),g[5]||(g[5]=le("div",{class:"route-chart-title"},[Dn(" Visualised comparison "),le("span",null,"(time & emissions)")],-1)),le("div",{class:"route-chart",ref_key:"chartRef",ref:e},null,512),wd(a)?(Ka(),_o("div",fVt,Hn(wd(a)),1)):ev("",!0)]))}},gVt=Gd(pVt,[["__scopeId","data-v-1fa99daf"]]);Em.accessToken="pk.eyJ1IjoieG1zMTIxMzgiLCJhIjoiY21oaWw5cnRoMDIyazJpc2Q4azF3ZW81eCJ9.p5vgHrhM1hR6Bvl-vjmO7A";const Yf="london-boroughs",xu="borough-fill",H7="borough-border-glow",j7="london-outer-glow",W7="borough-labels",wI="busiest-streets",$7="busiest-streets-line",mVt=0,Z7="http://10.129.111.25:3000",SI=i=>{const t=i.toLowerCase().trim();return t==="city of london"?"city of london":t.replace(/london borough of /g,"").replace(/royal borough of /g,"").replace(/city of /g,"").replace(/&/g,"and").replace(/\./g,"").replace(/\s+/g," ").trim()},vVt=(i,t)=>{const e=I=>I*Math.PI/180,r=I=>I*180/Math.PI,[n,o]=i,[s,a]=t,c=e(o),f=e(a),g=e(s-n),v=Math.sin(g)*Math.cos(f),y=Math.cos(c)*Math.sin(f)-Math.sin(c)*Math.cos(f)*Math.cos(g),w=Math.atan2(v,y);return(r(w)+360)%360},_Vt={components:{MapLegend:Yht,TimeSlider:Mvt},setup(){const i=vo(null),t=vo(mVt);let e=null,r=null,n=null,o=null,s=null,a=null,c=null,f=null,g=null,v=null;const y=vo(!1),w=vo(null);let I=null;const E=()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"auto"}),typeof document<"u"&&(document.documentElement&&(document.documentElement.scrollTop=0,document.documentElement.scrollLeft=0),document.body&&(document.body.scrollTop=0,document.body.scrollLeft=0))},D=()=>{if(c){try{c.unmount()}catch(_t){console.warn("RoutePopup unmount warning:",_t)}c=null}a=null,f=null},R=()=>{if(a&&(f&&(a.off("close",f),f=null),a.remove(),a=null),c){try{c.unmount()}catch(_t){console.warn("RoutePopup unmount warning:",_t)}c=null}},z=async _t=>{if(!n)return;const ct=new Set;n.features.forEach(Et=>{const bt=Et.properties.NAME||Et.properties.BOROUGH||Et.properties.LAD13NM||Et.properties.name;if(!bt)return;const Vt=SI(bt);Vt&&ct.add(Vt)});const Dt=await Promise.all(Array.from(ct).map(async Et=>{const bt=`${Et}_${_t}`,Vt=`${Z7}/api/hourly?borough=${encodeURIComponent(bt)}`;try{const zt=await fetch(Vt);if(!zt.ok)return console.warn(`Failed to fetch data for ${Et}: ${zt.status}`),null;const Jt=await zt.json();return{normName:Et,pm25:Jt.pm25_g_per_h,co:Jt.co_g_per_h,co2:Jt.co2_kg_per_h,vehicles:Jt.vehicles_per_hour}}catch(zt){return console.error("Error fetching data for",Et,zt),null}}));r=new Map,Dt.forEach(Et=>{Et&&r.set(Et.normName,{pm25:Et.pm25,co:Et.co,co2:Et.co2,vehicles:Et.vehicles})})},N=()=>!n||!r?null:{type:"FeatureCollection",features:n.features.map(_t=>{const ct=_t.properties.NAME||_t.properties.BOROUGH||_t.properties.LAD13NM||_t.properties.name,Dt=ct?SI(ct):null,Et=Dt?r.get(Dt)||{}:{},bt=Et.pm25??null,Vt=Et.co??null,zt=Et.co2??null,Jt=Et.vehicles??null;return{..._t,properties:{..._t.properties,BoroughName:ct||Dt||"Unknown",NormName:Dt||"",pm25:bt,co:Vt,co2:zt,vehicles:Jt}}})},H=async()=>{try{n||(n=await(await fetch("/london_boroughs.geojson")).json()),await z(t.value);const _t=N();if(!_t){console.error("No styledGeojson generated");return}e.getSource(Yf)?e.getSource(Yf).setData(_t):e.addSource(Yf,{type:"geojson",data:_t}),e.getLayer(xu)||e.addLayer({id:xu,type:"fill",source:Yf,paint:{"fill-color":["interpolate",["linear"],["get","pm25"],0,"#22c55e",200,"#84cc16",260,"#eab308",340,"#f97316",430,"#ef4444",550,"#7f1d1d"],"fill-opacity":.78}}),e.getLayer(j7)||e.addLayer({id:j7,type:"line",source:Yf,paint:{"line-color":"#a855f7","line-width":6,"line-opacity":.22}}),e.getLayer(H7)||e.addLayer({id:H7,type:"line",source:Yf,paint:{"line-color":"#ffffff","line-width":1.2,"line-opacity":.9}}),e.getLayer(W7)||e.addLayer({id:W7,type:"symbol",source:Yf,layout:{"text-field":["coalesce",["get","NAME"],["get","BOROUGH"],["get","LAD13NM"],["get","name"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":11,"text-anchor":"center","text-allow-overlap":!1},paint:{"text-color":"#ffffff","text-halo-color":"rgba(10,10,15,0.9)","text-halo-width":1.4}});const ct=new Em.LngLatBounds;_t.features.forEach(Dt=>{const Et=Dt.geometry;(Et.type==="Polygon"?Et.coordinates.flat():Et.coordinates.flat(2)).forEach(([Vt,zt])=>ct.extend([Vt,zt]))}),I=ct,e.fitBounds(ct,{padding:40,maxZoom:9.2}),e.on("mouseenter",xu,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",()=>{e.getCanvas().style.cursor=""}),e.on("click",xu,Dt=>{if(!Dt.features||!Dt.features.length)return;const bt=Dt.features[0].properties||{},Vt=bt.BoroughName||bt.NAME||bt.BOROUGH||bt.LAD13NM||bt.name||"Unknown borough",zt=SI(Vt),Jt=r&&r.get(zt)||{},ce=bt.pm25!==void 0&&bt.pm25!==null?Number(bt.pm25):Jt.pm25??null,be=bt.co!==void 0&&bt.co!==null?Number(bt.co):Jt.co??null,ve=bt.co2!==void 0&&bt.co2!==null?Number(bt.co2):Jt.co2??null,ke=bt.vehicles!==void 0&&bt.vehicles!==null?Number(bt.vehicles):Jt.vehicles??null;o&&(o.remove(),o=null),s&&(s.unmount(),s=null);const ni=!!g&&!!g.get(zt),bi=document.createElement("div");s=tO(bvt,{name:Vt,hour:t.value,pm25:ce,co:be,co2:ve,vehicles:ke,hasBusiestStreet:ni,onViewStreet:()=>{o&&(o.remove(),o=null),s&&(s.unmount(),s=null),J(zt)}}),s.mount(bi),o=new Em.Popup({closeButton:!0,closeOnClick:!1,offset:16}).setLngLat(Dt.lngLat).setDOMContent(bi).addTo(e),o.on("close",()=>{s&&(s.unmount(),s=null),o=null,e&&e.getLayer(xu)&&!y.value&&(e.setPaintProperty(xu,"fill-opacity",.78),v=null)})})}catch(_t){console.error("Failed to load map or backend data",_t)}},q=async()=>{if(e)try{const _t=await fetch("/busiest_streets.geojson");if(!_t.ok){console.warn("busiest_streets.geojson not found or failed to load:",_t.status);return}const ct=await _t.json();g=new Map,(ct.features||[]).forEach(Dt=>{const Et=Dt.properties||{},bt=Dt.geometry;if(!bt)return;const Vt=Et.borough||Et.BoroughName||Et.borough_name||"",zt=SI(Vt);if(!zt)return;let Jt=null;if(bt.type==="LineString"?Jt=bt.coordinates:bt.type==="MultiLineString"&&(Jt=bt.coordinates.flat()),!Jt||Jt.length<2)return;const ce=Jt.reduce((ke,ni)=>ke.extend(ni),new Em.LngLatBounds(Jt[0],Jt[0])),be=ce.getCenter(),ve=vVt(Jt[0],Jt[Jt.length-1]);g.set(zt,{center:[be.lng,be.lat],bearing:ve,bounds:ce,coords:Jt})}),e.getSource(wI)?e.getSource(wI).setData(ct):e.addSource(wI,{type:"geojson",data:ct}),e.getLayer($7)||e.addLayer({id:$7,type:"line",source:wI,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ff3b30","line-width":6,"line-opacity":.95,"line-blur":1.2}})}catch(_t){console.error("Error adding busiest streets layer",_t)}},Y=async _t=>{if(!e||!g)return;const ct=g.get(_t);if(!ct)return;const Dt=`${_t}_${t.value}`,Et=`${Z7}/api/solution?borough=${encodeURIComponent(Dt)}`;let bt;try{const bi=await fetch(Et);if(!bi.ok){console.warn("Failed to fetch solution data:",bi.status);return}bt=await bi.json()}catch(bi){console.error("Error fetching solution data",bi);return}const Vt=bt.busiest_street||"Recommended route",zt=Number.isFinite(Number(bt.crossing_time_min))?Number(bt.crossing_time_min):null,Jt=Number.isFinite(Number(bt.bicycle_crossing_min))?Number(bt.bicycle_crossing_min):null,ce=Number.isFinite(Number(bt.per_car_co2_kg_per_h))?Number(bt.per_car_co2_kg_per_h):null,be=Number.isFinite(Number(bt.per_car_co_g_per_h))?Number(bt.per_car_co_g_per_h):null,ve=Number.isFinite(Number(bt.per_car_pm25_g_per_h))?Number(bt.per_car_pm25_g_per_h):null;R();const ke=document.createElement("div");c=tO(gVt,{street:Vt,hour:t.value,carTime:zt,bikeTime:Jt,carCo2:ce,carCo:be,carPm25:ve}),c.mount(ke);let ni;if(ct.coords&&ct.coords.length>0){const bi=ct.coords[ct.coords.length-1];ni={lng:bi[0],lat:bi[1]}}else ct.bounds?ni=ct.bounds.getNorthEast():ct.center?ni={lng:ct.center[0],lat:ct.center[1]}:ni=e.getCenter();a=new Em.Popup({closeButton:!0,closeOnClick:!1,offset:[18,-12],anchor:"left",className:"solution-popup"}).setLngLat([ni.lng,ni.lat]).setDOMContent(ke).addTo(e),f=D,a.on("close",f)},J=async _t=>{if(!e||!g)return;const ct=g.get(_t);if(!ct)return;const{center:Dt,bearing:Et,bounds:bt}=ct;y.value||(w.value={center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}),e.getLayer(xu)&&(e.setPaintProperty(xu,"fill-opacity",["case",["==",["get","NormName"],_t],.15,.78]),v=_t),bt?e.fitBounds(bt,{padding:40,maxZoom:16.5,bearing:Et,pitch:60,duration:1800}):Dt&&e.flyTo({center:Dt,zoom:16.5,bearing:Et,pitch:60,duration:1800}),y.value=!0,await Y(_t)},it=async _t=>{if(!n||!e)return;await z(_t);const ct=N();if(!ct)return;const Dt=e.getSource(Yf);Dt&&Dt.setData(ct),o&&(o.remove(),o=null),s&&(s.unmount(),s=null),R(),e.getLayer(xu)&&e.setPaintProperty(xu,"fill-opacity",.78),v=null,y.value=!1,w.value=null},at=async _t=>{_t!==t.value&&(t.value=_t,await it(_t))},ut=()=>{if(e){if(w.value){const{center:_t,zoom:ct}=w.value;e.flyTo({center:_t,zoom:ct,bearing:0,pitch:0,duration:1500})}else I&&e.fitBounds(I,{padding:40,maxZoom:9.2,pitch:0,bearing:0,duration:1500});e.getLayer(xu)&&e.setPaintProperty(xu,"fill-opacity",.78),v=null,y.value=!1,w.value=null,R()}},ft=()=>{e||!i.value||(e=new Em.Map({container:i.value,style:"mapbox://styles/mapbox/standard",center:[-.1276,51.5072],zoom:9,maxBounds:[[-.6,51.2],[.4,51.8]]}),e.addControl(new Em.NavigationControl,"top-right"),e.on("load",async()=>{await H(),await q()}))};return Av(()=>{E(),ft()}),FM(()=>{E()}),LS(()=>{o&&(o.remove(),o=null),s&&(s.unmount(),s=null),R(),e&&(e.remove(),e=null),y.value=!1,w.value=null,v=null}),{mapContainer:i,activeHour:t,onHourChange:at,isStreetViewActive:y,exitStreetView:ut}}},yVt={class:"map-page"},xVt={class:"nav-links"},bVt={class:"main-container"},wVt={class:"map-container-wrapper"},SVt={ref:"mapContainer",class:"map-container"},TVt={class:"map-info"},AVt={class:"cta-container"};function IVt(i,t,e,r,n,o){const s=Qm("router-link"),a=Qm("TimeSlider"),c=Qm("MapLegend");return Ka(),_o("div",yVt,[le("nav",null,[t[5]||(t[5]=le("div",{class:"logo"},"ECOVISION",-1)),le("ul",xVt,[le("li",null,[Xn(s,{to:"/"},{default:$o(()=>[...t[1]||(t[1]=[Dn("HOME",-1)])]),_:1})]),le("li",null,[Xn(s,{to:"/page2"},{default:$o(()=>[...t[2]||(t[2]=[Dn("ABOUT",-1)])]),_:1})]),le("li",null,[Xn(s,{to:"/map",class:"active"},{default:$o(()=>[...t[3]||(t[3]=[Dn("MAP",-1)])]),_:1})]),le("li",null,[Xn(s,{to:"/page4"},{default:$o(()=>[...t[4]||(t[4]=[Dn("TEAM",-1)])]),_:1})])])]),le("div",bVt,[t[8]||(t[8]=le("div",{class:"page-header"},[le("h1",{class:"page-title"},"Interactive London Map"),le("p",{class:"page-subtitle"}," Real-time air quality visualization across 33 boroughs ")],-1)),le("div",wVt,[Xn(a,{"model-value":r.activeHour,"onUpdate:modelValue":r.onHourChange},null,8,["model-value","onUpdate:modelValue"]),r.isStreetViewActive?(Ka(),_o("button",{key:0,class:"map-back-btn",onClick:t[0]||(t[0]=(...f)=>r.exitStreetView&&r.exitStreetView(...f))},"  BACK TO OVERVIEW ")):ev("",!0),le("div",SVt,null,512),Xn(c)]),le("div",TVt,[t[7]||(t[7]=ep('<div class="info-grid"><div class="info-card"><h3>Historical Data</h3><p> Access previous month&#39;s air quality data to identify patterns and trends across London boroughs. </p></div><div class="info-card"><h3>Interactive Features</h3><p> Zoom, pan, and click on boroughs to see detailed air quality metrics and pollution sources. </p></div><div class="info-card"><h3>Time Slider</h3><p> Navigate through 24 hours of data to understand how air quality changes throughout the day. </p></div><div class="info-card"><h3>Data Sources</h3><p> Powered by the London Air Quality Network and TfL open datasets for accurate, reliable information. </p></div></div>',1)),le("div",AVt,[Xn(s,{to:"/page4",class:"pixel-button"},{default:$o(()=>[...t[6]||(t[6]=[Dn(" Support Our Research ",-1)])]),_:1})])])])])}const CVt=Gd(_Vt,[["render",IVt]]);const MVt={class:"team-page"},EVt={class:"nav-links"},DVt={class:"modal-content"},PVt={class:"modal-buttons"},LVt={class:"content"},RVt={class:"section survey-section"},kVt={class:"survey-container"},OVt={class:"form-group"},zVt={class:"form-group"},BVt={class:"form-group"},FVt={class:"form-group"},NVt={class:"checkbox-group"},VVt={class:"checkbox-item"},UVt={class:"checkbox-item"},GVt={class:"checkbox-item"},HVt={class:"checkbox-item"},jVt={class:"checkbox-item"},WVt={class:"checkbox-item"},$Vt={class:"form-group"},ZVt={class:"form-group"},qVt={class:"comments-header"},XVt={class:"comments-title"},YVt={class:"mode-indicator"},KVt={key:0,class:"no-comments"},JVt={class:"comment-header"},QVt={class:"comment-author"},t4t={class:"comment-date"},e4t={class:"comment-meta"},i4t=["onClick"],r4t={class:"comment-text"},n4t={__name:"Page4",setup(i){const t=()=>{window.scrollTo(0,0),document.body.scrollTop=0,document.documentElement.scrollTop=0;const E=document.getElementById("app");E&&(E.scrollTop=0)};Av(()=>{t()}),FM(()=>{t()});const e=DS({q1:"",q2:"",q3:"",barriers:[],q5:"",comments:""}),r=vo([]),n=vo(!1),o=vo(!1),s=vo(""),a=vo(!1),c=vo(""),f=Yl(()=>({background:n.value?"#10b981":"#888",color:"#fff",padding:"0.5rem 1rem",borderRadius:"4px",fontSize:"0.7rem",fontFamily:"'Press Start 2P', cursive"})),g=E=>new Date(E).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),v=()=>{const E={id:Date.now(),date:new Date().toISOString(),q1:e.q1,q2:e.q2,q3:e.q3,barriers:e.barriers.join(", ")||"None selected",q5:e.q5,comments:e.comments};r.value.unshift(E),Object.assign(e,{q1:"",q2:"",q3:"",barriers:[],q5:"",comments:""}),c.value="FEEDBACK SUBMITTED!",a.value=!0,setTimeout(()=>{a.value=!1},3e3),setTimeout(()=>{document.querySelector(".comments-section").scrollIntoView({behavior:"smooth",block:"start"})},500)},y=()=>{n.value?n.value=!1:o.value=!0},w=()=>{s.value==="ecovision2024"?(n.value=!0,o.value=!1,s.value="",c.value="ADMIN MODE ACTIVATED",a.value=!0,setTimeout(()=>{a.value=!1},2e3)):alert("Incorrect password")},I=E=>{n.value&&confirm("Delete this response?")&&(r.value.splice(E,1),c.value="RESPONSE DELETED",a.value=!0,setTimeout(()=>{a.value=!1},2e3))};return(E,D)=>{const R=Qm("router-link");return Ka(),_o("div",MVt,[le("nav",null,[D[17]||(D[17]=le("div",{class:"logo"},"ECOVISION",-1)),le("ul",EVt,[le("li",null,[Xn(R,{to:"/"},{default:$o(()=>[...D[13]||(D[13]=[Dn("HOME",-1)])]),_:1})]),le("li",null,[Xn(R,{to:"/page2"},{default:$o(()=>[...D[14]||(D[14]=[Dn("ABOUT",-1)])]),_:1})]),le("li",null,[Xn(R,{to:"/map"},{default:$o(()=>[...D[15]||(D[15]=[Dn("MAP",-1)])]),_:1})]),le("li",null,[Xn(R,{to:"/page4",class:"active"},{default:$o(()=>[...D[16]||(D[16]=[Dn("TEAM",-1)])]),_:1})])])]),le("div",{class:md(["success-message",{show:a.value}])},Hn(c.value),3),le("div",{class:md(["modal",{active:o.value}])},[le("div",DVt,[D[18]||(D[18]=le("h3",{class:"modal-title"},"ADMIN LOGIN",-1)),D[19]||(D[19]=le("p",{style:{color:"#888","font-size":"0.9rem","margin-bottom":"1rem"}}," Enter password to access admin mode ",-1)),gu(le("input",{type:"password",class:"modal-input","onUpdate:modelValue":D[0]||(D[0]=z=>s.value=z),onKeyup:rct(w,["enter"]),placeholder:"Enter admin password"},null,544),[[mG,s.value]]),le("div",PVt,[le("button",{class:"modal-btn cancel",onClick:D[1]||(D[1]=z=>o.value=!1)}," CANCEL "),le("button",{class:"modal-btn confirm",onClick:w},"LOGIN")])])],2),le("div",LVt,[D[51]||(D[51]=ep('<div class="hero" data-v-2425c5e3><h1 class="title" data-v-2425c5e3>OUR TEAM</h1><p class="subtitle" data-v-2425c5e3>Making a Difference Through Data and Action</p></div><div class="section team-intro-section" data-v-2425c5e3><div class="box" data-v-2425c5e3><h2 data-v-2425c5e3>Meet Our Team Members</h2><p data-v-2425c5e3> Our dedicated team brings together expertise in data science, design, development, and research to create EcoVision London. </p><div class="team-members-grid" data-v-2425c5e3><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Madina Diallo</h3><p class="member-title" data-v-2425c5e3>Project &amp; Data Integration Lead</p><p class="member-description" data-v-2425c5e3> Leading project coordination and managing data integration from multiple London air quality and transport sources. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Matilda Nelson</h3><p class="member-title" data-v-2425c5e3>Research &amp; Web Content Lead</p><p class="member-description" data-v-2425c5e3> Conducting research on London&#39;s air quality challenges and developing user-focused content strategies. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Vidan Gao</h3><p class="member-title" data-v-2425c5e3>Design &amp; Visualisation Lead</p><p class="member-description" data-v-2425c5e3> Creating intuitive visual designs and interactive data visualizations for the London borough mapping system. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Zihang He</h3><p class="member-title" data-v-2425c5e3>Technical &amp; Web Development Lead</p><p class="member-description" data-v-2425c5e3> Developing the technical infrastructure and web platform for real-time air quality data visualization. </p></div><div class="member-card" data-v-2425c5e3><div class="member-avatar" data-v-2425c5e3><span class="avatar-emoji" data-v-2425c5e3></span></div><h3 class="member-name" data-v-2425c5e3>Qingshan Luo</h3><p class="member-title" data-v-2425c5e3>Testing &amp; Editing Lead</p><p class="member-description" data-v-2425c5e3> Ensuring quality assurance, user testing, and content editing for optimal user experience and accuracy. </p></div></div></div></div><div class="section" data-v-2425c5e3><div class="box" data-v-2425c5e3><h2 data-v-2425c5e3>Our Team Structure</h2><p data-v-2425c5e3> Our diverse team of experts combines environmental science, data analytics, and community engagement to create meaningful change. </p><div class="team-grid" data-v-2425c5e3><div class="team-member" data-v-2425c5e3><div class="member-role" data-v-2425c5e3></div><h3 data-v-2425c5e3>Research Team</h3><p data-v-2425c5e3>Environmental scientists and data analysts</p></div><div class="team-member" data-v-2425c5e3><div class="member-role" data-v-2425c5e3></div><h3 data-v-2425c5e3>Tech Team</h3><p data-v-2425c5e3>Software engineers and UX designers</p></div><div class="team-member" data-v-2425c5e3><div class="member-role" data-v-2425c5e3></div><h3 data-v-2425c5e3>Community Team</h3><p data-v-2425c5e3>Outreach coordinators and educators</p></div></div></div></div><div class="section" data-v-2425c5e3><div class="box" data-v-2425c5e3><h2 data-v-2425c5e3>Community Impact</h2><p data-v-2425c5e3> EcoVision empowers Londoners to make informed decisions about their transport choices, contributing to a cleaner, healthier city for everyone. </p><div class="impact-stats" data-v-2425c5e3><div class="impact-card" data-v-2425c5e3><div class="impact-icon" data-v-2425c5e3></div><div class="impact-value" data-v-2425c5e3>10,000+</div><div class="impact-label" data-v-2425c5e3>Active Users</div></div><div class="impact-card" data-v-2425c5e3><div class="impact-icon" data-v-2425c5e3></div><div class="impact-value" data-v-2425c5e3>25%</div><div class="impact-label" data-v-2425c5e3>Increase in Cycling</div></div><div class="impact-card" data-v-2425c5e3><div class="impact-icon" data-v-2425c5e3></div><div class="impact-value" data-v-2425c5e3>30T</div><div class="impact-label" data-v-2425c5e3>CO Reduced (Annual)</div></div></div></div></div>',4)),le("div",RVt,[le("div",kVt,[D[49]||(D[49]=le("div",{class:"survey-header"},[le("h1",{class:"survey-title"},"SUPPORT OUR RESEARCH"),le("p",{class:"survey-subtitle"}," Help us understand London's transport preferences. Your feedback will inform policy recommendations to reduce vehicle emissions and improve air quality. ")],-1)),le("form",{class:"survey-form",onSubmit:ect(v,["prevent"])},[le("div",OVt,[D[21]||(D[21]=le("label",{class:"form-label"},"Do you prefer cycling over driving in London?",-1)),gu(le("select",{class:"form-select","onUpdate:modelValue":D[2]||(D[2]=z=>e.q1=z),required:""},[...D[20]||(D[20]=[ep('<option value="" data-v-2425c5e3>Select your preference</option><option value="Yes, always" data-v-2425c5e3>Yes, always prefer cycling</option><option value="Yes, mostly" data-v-2425c5e3>Yes, mostly prefer cycling</option><option value="Depends" data-v-2425c5e3>It depends on the situation</option><option value="No, mostly" data-v-2425c5e3>No, mostly prefer driving</option><option value="No, always" data-v-2425c5e3>No, always prefer driving</option>',6)])],512),[[q2,e.q1]])]),le("div",zVt,[D[23]||(D[23]=le("label",{class:"form-label"},"How often do you cycle in London?",-1)),gu(le("select",{class:"form-select","onUpdate:modelValue":D[3]||(D[3]=z=>e.q2=z),required:""},[...D[22]||(D[22]=[ep('<option value="" data-v-2425c5e3>Select frequency</option><option value="Daily" data-v-2425c5e3>Daily</option><option value="Several times a week" data-v-2425c5e3> Several times a week </option><option value="Once a week" data-v-2425c5e3>Once a week</option><option value="Once a month" data-v-2425c5e3>Once a month</option><option value="Rarely" data-v-2425c5e3>Rarely</option><option value="Never" data-v-2425c5e3>Never</option>',7)])],512),[[q2,e.q2]])]),le("div",BVt,[D[25]||(D[25]=le("label",{class:"form-label"},"What's your main reason for your transport choice?",-1)),gu(le("select",{class:"form-select","onUpdate:modelValue":D[4]||(D[4]=z=>e.q3=z),required:""},[...D[24]||(D[24]=[ep('<option value="" data-v-2425c5e3>Select main reason</option><option value="Environmental concerns" data-v-2425c5e3> Environmental concerns </option><option value="Health and fitness" data-v-2425c5e3>Health and fitness</option><option value="Cost savings" data-v-2425c5e3>Cost savings</option><option value="Convenience" data-v-2425c5e3>Convenience</option><option value="Speed" data-v-2425c5e3>Speed</option><option value="Safety" data-v-2425c5e3>Safety</option><option value="No alternative" data-v-2425c5e3>No alternative available</option>',8)])],512),[[q2,e.q3]])]),le("div",FVt,[D[32]||(D[32]=le("label",{class:"form-label"},"What are the main barriers to cycling more in London? (Select all that apply)",-1)),le("div",NVt,[le("div",VVt,[gu(le("input",{type:"checkbox",id:"b1",value:"Safety concerns with traffic","onUpdate:modelValue":D[5]||(D[5]=z=>e.barriers=z)},null,512),[[py,e.barriers]]),D[26]||(D[26]=le("label",{for:"b1"},"Safety concerns with traffic",-1))]),le("div",UVt,[gu(le("input",{type:"checkbox",id:"b2",value:"Weather conditions","onUpdate:modelValue":D[6]||(D[6]=z=>e.barriers=z)},null,512),[[py,e.barriers]]),D[27]||(D[27]=le("label",{for:"b2"},"Weather conditions",-1))]),le("div",GVt,[gu(le("input",{type:"checkbox",id:"b3",value:"Poor cycling infrastructure","onUpdate:modelValue":D[7]||(D[7]=z=>e.barriers=z)},null,512),[[py,e.barriers]]),D[28]||(D[28]=le("label",{for:"b3"},"Poor cycling infrastructure",-1))]),le("div",HVt,[gu(le("input",{type:"checkbox",id:"b4",value:"Distance of journeys","onUpdate:modelValue":D[8]||(D[8]=z=>e.barriers=z)},null,512),[[py,e.barriers]]),D[29]||(D[29]=le("label",{for:"b4"},"Distance of journeys",-1))]),le("div",jVt,[gu(le("input",{type:"checkbox",id:"b5",value:"Bike storage issues","onUpdate:modelValue":D[9]||(D[9]=z=>e.barriers=z)},null,512),[[py,e.barriers]]),D[30]||(D[30]=le("label",{for:"b5"},"Bike storage issues",-1))]),le("div",WVt,[gu(le("input",{type:"checkbox",id:"b6",value:"Air quality concerns","onUpdate:modelValue":D[10]||(D[10]=z=>e.barriers=z)},null,512),[[py,e.barriers]]),D[31]||(D[31]=le("label",{for:"b6"},"Air quality concerns",-1))])])]),le("div",$Vt,[D[34]||(D[34]=le("label",{class:"form-label"},"Which London borough do you live/work in most?",-1)),gu(le("select",{class:"form-select","onUpdate:modelValue":D[11]||(D[11]=z=>e.q5=z),required:""},[...D[33]||(D[33]=[ep('<option value="" data-v-2425c5e3>Select your borough</option><option value="City of London" data-v-2425c5e3>City of London</option><option value="Westminster" data-v-2425c5e3>Westminster</option><option value="Camden" data-v-2425c5e3>Camden</option><option value="Islington" data-v-2425c5e3>Islington</option><option value="Hackney" data-v-2425c5e3>Hackney</option><option value="Tower Hamlets" data-v-2425c5e3>Tower Hamlets</option><option value="Greenwich" data-v-2425c5e3>Greenwich</option><option value="Southwark" data-v-2425c5e3>Southwark</option><option value="Lambeth" data-v-2425c5e3>Lambeth</option><option value="Wandsworth" data-v-2425c5e3>Wandsworth</option><option value="Hammersmith and Fulham" data-v-2425c5e3> Hammersmith and Fulham </option><option value="Kensington and Chelsea" data-v-2425c5e3> Kensington and Chelsea </option><option value="Other" data-v-2425c5e3>Other borough</option>',14)])],512),[[q2,e.q5]])]),le("div",ZVt,[D[35]||(D[35]=le("label",{class:"form-label"},"Additional comments or suggestions for improving London's transport and air quality:",-1)),gu(le("textarea",{class:"form-textarea","onUpdate:modelValue":D[12]||(D[12]=z=>e.comments=z),placeholder:"Share your thoughts on how London can reduce vehicle emissions and improve cycling infrastructure..."},null,512),[[mG,e.comments]])]),D[36]||(D[36]=le("button",{type:"submit",class:"submit-btn"},"Submit Feedback",-1)),D[37]||(D[37]=le("div",{class:"form-footer"}," Your responses help inform policy recommendations for cleaner transport ",-1))],32),D[50]||(D[50]=ep('<div class="help-text" data-v-2425c5e3><strong data-v-2425c5e3> Instructions:</strong><br data-v-2425c5e3>  After submitting, your feedback will be displayed in &quot;COMMUNITY RESPONSES&quot; section below<br data-v-2425c5e3>  <strong data-v-2425c5e3>User mode</strong>: View only, cannot delete<br data-v-2425c5e3>  <strong data-v-2425c5e3>Admin mode</strong>: Can delete inappropriate comments<br data-v-2425c5e3>  Click <strong data-v-2425c5e3>ADMIN MODE</strong> button to switch to admin<br data-v-2425c5e3>  Admin password: <strong data-v-2425c5e3>ecovision2024</strong></div>',1)),le("div",{class:md(["comments-section",{"admin-mode":n.value}])},[le("div",qVt,[le("h2",XVt," COMMUNITY RESPONSES ("+Hn(r.value.length)+") ",1),le("div",YVt,[le("span",{class:"role-badge",style:O0(f.value)},Hn(n.value?"ADMIN MODE":"USER MODE"),5),le("button",{class:md(["admin-btn",{active:n.value}]),onClick:y},Hn(n.value?"EXIT ADMIN":"ADMIN MODE"),3)])]),r.value.length===0?(Ka(),_o("div",KVt," No responses yet. Be the first to share your feedback! ")):ev("",!0),(Ka(!0),_o(Xl,null,qB(r.value,(z,N)=>(Ka(),_o("div",{key:z.id,class:"comment"},[le("div",JVt,[le("div",null,[le("div",QVt," Response #"+Hn(r.value.length-N),1),le("div",t4t,Hn(g(z.date)),1)]),le("div",e4t,[le("button",{class:"delete-btn",onClick:H=>I(N)}," DELETE ",8,i4t)])]),le("div",r4t,[D[40]||(D[40]=le("strong",null,"Preference:",-1)),Dn(" "+Hn(z.q1),1),D[41]||(D[41]=le("br",null,null,-1)),D[42]||(D[42]=le("strong",null,"Frequency:",-1)),Dn(" "+Hn(z.q2),1),D[43]||(D[43]=le("br",null,null,-1)),D[44]||(D[44]=le("strong",null,"Main reason:",-1)),Dn(" "+Hn(z.q3),1),D[45]||(D[45]=le("br",null,null,-1)),D[46]||(D[46]=le("strong",null,"Barriers:",-1)),Dn(" "+Hn(z.barriers),1),D[47]||(D[47]=le("br",null,null,-1)),D[48]||(D[48]=le("strong",null,"Borough:",-1)),Dn(" "+Hn(z.q5)+" ",1),z.comments?(Ka(),_o(Xl,{key:0},[D[38]||(D[38]=le("br",null,null,-1)),D[39]||(D[39]=le("strong",null,"Comments:",-1)),Dn(" "+Hn(z.comments),1)],64)):ev("",!0)])]))),128))],2)])])])])}}},a4t=Gd(n4t,[["__scopeId","data-v-2425c5e3"]]),o4t=[{path:"/",name:"Home",component:Oht},{path:"/page2",name:"Page2",component:Ght},{path:"/map",name:"Map",component:CVt},{path:"/page4",name:"Page4",component:a4t},{path:"/test",name:"Test",component:()=>fct(()=>import("./Test-08fb12a1.js"),["assets/Test-08fb12a1.js","assets/Test-d6a6f5da.css"])}],s4t=yht({history:Kct("/casa0017-web-assessment-EcoVision/"),routes:o4t,scrollBehavior(i,t,e){return e||{left:0,top:0}}});tO(cct).use(s4t).mount("#app");export{Gd as _,LS as a,Qm as b,Ka as c,_o as d,le as e,Xn as f,jht as g,Dn as h,Em as m,Av as o,vo as r,Hn as t,$o as w};
